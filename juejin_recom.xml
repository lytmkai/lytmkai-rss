<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[传统RAG的局限被打破！三个轻量级智能体分工协作，如何让问答系统更精准？]]></title>    <link>https://juejin.cn/post/7570598043298119743</link>    <guid>https://juejin.cn/post/7570598043298119743</guid>    <pubDate>2025-11-10T08:09:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570598043298119743" data-draft-id="7570500819889471531" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="传统RAG的局限被打破！三个轻量级智能体分工协作，如何让问答系统更精准？"/> <meta itemprop="keywords" content="LLM,Agent,程序员"/> <meta itemprop="datePublished" content="2025-11-10T08:09:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            传统RAG的局限被打破！三个轻量级智能体分工协作，如何让问答系统更精准？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T08:09:22.000Z" title="Mon Nov 10 2025 08:09:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>近期，公司在AI相关项目，尤其是问答系统领域，对回答的准确率和表述质量提出了更高的要求。用户提出的问题不仅限于基础性问题，还可能涉及多样化、复杂化的场景。也就在上周五快下班的时候，项目经理向我反馈，之前的项目团队支持的某客户在使用问答系统时，除了查询私有知识库中的信息外，还会提出以下几类问题：</p>
<ol>
<li><strong>可直接由大语言模型（LLM）回答的问题</strong>：例如通用知识或常识性问题。</li>
<li><strong>非知识库相关的口头表达</strong>：如“谢谢”、“再见”等社交性语句。</li>
<li><strong>需要多步推理的复杂问题</strong>：例如涉及逻辑推理或上下文关联的问题。</li>
</ol>
<p>然而，之前项目团队采用的RAG技术存在一定的局限性：无论用户提出何种问题，系统均默认从知识库中检索答案，再交由LLM生成回答。针对非知识库问题（如口头表达），团队通过在prompt层面设置固定回复的方式进行处理。虽然这种方法能够部分解决问题，但其设计不够优雅，且无法有效应对需要多步推理的复杂问题。项目经理希望我能提出一种更优化的解决方案，以应对上述挑战。为此，我向他提出了一种轻量级的多智能体方案，在不修改检索器和LLM的前提下，优化整个RAG流程。</p>
<h2 data-id="heading-0">架构图</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c2ac68aaa86417fbcf2a41a1d7ef9db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763366961&amp;x-signature=yZC02V0w%2BxnHdCc6%2F1g9UaPpRZg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">定义三个智能体</h2>
<p>我们设计了三个专门的智能体——<strong>推理路由器（Reasoning Router）</strong> 、<strong>信息过滤器（Information Filter）和</strong> <strong>决策制定者（Decision Maker）</strong> ——以促进检索器与大型语言模型（LLM）之间的通信，每个轻量级智能体扮演不同的角色，通过有针对性的指令协同管理RAG（Retrieval-Augmented Generation）管道的各个方面。这种统一设计确保了高效的协调，同时保持了边缘部署的简洁性。三个智能体分别负责评估是否需要检索、生成有效的查询以及选择适合 LLMs 的信息。</p>
<h3 data-id="heading-2">推理路由器（Reasoning Router）</h3>
<p>从高层次视角确定给定问题的最佳推理策略。根据当前状态（即问题），它通过最多两步操作选择行动：</p>
<ol>
<li><strong>决定检索必要性</strong>：如果输出[No Retrieval]，则问题直接由LLM处理，利用其内部知识生成答案。</li>
<li><strong>确定问题复杂性</strong>：如果输出[Retrieval]，还会评估问题是否需要复杂推理。</li>
</ol>
<ul>
<li>对于简单问题，生成一个并与检索器交互以获取文档。检索到的文档随后由<strong>信息过滤器</strong>处理，提取出适合LLM的相关内容。最后，LLM使用过滤后的文档生成问题的答案。</li>
<li>对于复杂问题，输出[Planning]，这将触发需要多个智能体协调的多步推理策略。</li>
</ul>
<p><strong>具体示例如下</strong>：</p>
<ul>
<li><strong>示例1（无需检索）</strong> ：</li>
</ul>

<ul>
<li>输入问题：q = "What is the capital of France?"</li>
<li>输出：[No Retrieval]</li>
<li>解释：该问题属于常识性问题，可直接由LLM回答，无需检索。</li>
</ul>

<ul>
<li><strong>示例2（简单问题，需检索）</strong> ：</li>
</ul>

<ul>
<li>输入问题：q = "What is the population of Paris in 2023?"</li>
<li>输出：[Retrieval]&lt;population of Paris 2023&gt;</li>
<li>解释：该问题需要从外部知识库中检索最新数据。</li>
</ul>

<ul>
<li><strong>示例3（复杂问题，需多步推理）</strong> ：</li>
</ul>

<ul>
<li>输入问题：q = "How does the economic policy of Country A affect its trade relations with Country B?"</li>
<li>输出：[Planning]</li>
<li>解释：该问题涉及多步推理，需要分解为多个子目标并逐步解决。</li>
</ul>
<h3 data-id="heading-3">过滤器（Information Filter）</h3>
<p>用于处理和过滤检索到的信息，以识别适合LLM的内容。其状态空间包括问题、检索到的文档以及当前的推理目标（如果在[Planning]模式下运行）。</p>
<h3 data-id="heading-4">决策者（Decision Maker）</h3>
<p>根据当前状态在[Planning]策略中确定最佳行动。其状态空间包括问题、LLM生成的路线图以及推理历史中积累的文档。根据当前状态，智能地选择行动以评估进展并决定下一步操作。</p>
<h2 data-id="heading-5">智能体如何协作?</h2>
<p>直接回答策略（Direct Answering Strategy）<strong>和</strong>单次检索策略（Single-pass Strategy）已在推理路由器（Reasoning Router）的定义中介绍，分别对应于输出[No Retrieval]和[Retrieval]。</p>
<p>多步推理策略（Multi-Step Reasoning Strategy）对应于推理路由器输出的[Planning]。该策略旨在解决需要LLM生成高层次路线图以及多次检索-过滤循环的复杂问题，通过以下三个阶段实现迭代式信息收集和推理：</p>
<ol>
<li><strong>生成路线图（Generate Roadmap）</strong> ：LLM将复杂问题分解为一系列结构化的子目标，为智能体提供高层次的指导。这些子目标定义了解决问题的步骤和所需的信息类型。</li>
<li><strong>迭代检索与过滤（Iterative Retrieval and Filtering）</strong> ：根据生成的路线图，智能体通过多次检索-过滤循环逐步收集相关信息。每次循环中，推理路由器确定当前子目标是否需要检索，信息过滤器提取相关文档，决策制定者评估进展并决定下一步操作。</li>
<li><strong>综合与生成答案（Synthesis and Answer Generation）</strong> ：在完成所有子目标后，LLM综合收集到的信息，生成最终答案。这一过程确保了复杂问题能够得到全面且准确的回答。</li>
</ol>
<p>通过这三种策略，我们的多智能体系统能够自适应地处理不同复杂度的问题：</p>
<ul>
<li><strong>直接回答策略（Direct Answering Strategy）</strong> ：适用于通用知识问题，提供即时响应。</li>
<li><strong>单次检索策略（Single-pass Strategy）</strong> ：高效处理基于事实的问题，通过一次检索-过滤循环获取答案。</li>
<li><strong>多步推理策略（Multi-Step Strategy）</strong> ：通过引导式迭代推理解决复杂问题。</li>
</ul>
<h2 data-id="heading-6">prompt如何设计</h2>
<h3 data-id="heading-7">Reasoning Router</h3>
<p>推理路由器将按照以下步骤进行评估并输出相应的动作：</p>
<ol>
<li><strong>评估问题</strong>：</li>
</ol>
<ul>
<li>分析问题的<strong>特异性</strong>、<strong>复杂性</strong>和<strong>清晰度</strong>，判断是否需要检索或规划。</li>
<li>确定问题是否属于LLM的现有知识范围，或者是否需要外部信息支持。</li>
</ul>
<ol start="2">
<li><strong>决策类别</strong>：</li>
</ol>
<ul>
<li>如果问题<strong>复杂且需要规划</strong>，输出：[Planning]。</li>
<li>如果问题<strong>需要特定信息</strong>（如最新事件或LLM知识范围外的细分领域），输出：[Retrieval] ‘YOUR QUERY HERE‘。</li>
<li>如果问题<strong>可以直接由LLM回答</strong>，输出：[No Retrieval]。</li>
</ul>
<ol start="3">
<li><strong>输出格式</strong>：</li>
</ol>
<ul>
<li><strong>无需检索</strong>：[No Retrieval]</li>
<li><strong>需要检索</strong>：[Retrieval]（适用于简单问题）</li>
<li><strong>需要规划</strong>：[Planning]（适用于复杂问题）</li>
</ul>
<p>其对应的prompt可以如下设计：</p>
<pre><code class="hljs language-markdown" lang="markdown">你是一个智能助手，负责评估给定的问题是否需要通过检索获取更多信息，或者需要规划才能得出准确答案。你可以访问一个大型语言模型（LLM）来进行规划或回答问题，并且有一个检索系统来提供与查询相关的信息。
指令：
<span class="hljs-bullet">1.</span> <span class="hljs-strong">**评估问题**</span>：评估基于LLM的现有知识是否可以提供精确的答案。考虑问题的具体性、复杂性和清晰度。
<span class="hljs-bullet">2.</span> <span class="hljs-strong">**决策类别**</span>：
<span class="hljs-bullet">-</span> 如果问题是复杂的，并且在检索之前需要一个规划阶段，你的回应应该是：
[Planning]
<span class="hljs-bullet">-</span> 如果问题请求特定信息，你认为LLM不具备这些信息，或者涉及最近的事件或超出LLM知识范围的小众话题，请按照以下格式进行回应：
[Retrieval] ‘YOUR QUERY HERE‘
<span class="hljs-bullet">-</span> 如果你认为LLM可以在没有额外信息的情况下回答问题，请回复：
[No Retrieval]
<span class="hljs-bullet">3.</span> <span class="hljs-strong">**专注于评估**</span>：避免直接回答问题。只专注于确定是否需要检索或规划。
推理路由器状态
现在，请处理以下问题：
问题：{question}
推理路由器的所有可能操作输出
% 对于不需要检索的情况
[No Retrieval]
% 对于需要检索的情况
[Retrieval]&lt;查询内容&gt; （对于简单问题）
[Planning] （对于复杂问题）
</code></pre>
<h3 data-id="heading-8">Information Filter</h3>
<p>信息过滤器的状态空间根据系统当前采用的策略不同而有所区别：</p>
<ol>
<li><strong>单次检索策略（Single-pass Strategy）</strong> ：</li>
</ol>
<ul>
<li><strong>q</strong>：输入问题。</li>
<li><strong>retrieved documents</strong>：从检索系统中获取的相关文档。</li>
<li>状态空间：S2 = {q, retrieved documents}</li>
</ul>
<ol start="2">
<li><strong>多步推理策略（Multi-step Reasoning Strategy）</strong> ：</li>
</ol>
<ul>
<li><strong>q</strong>：输入问题。</li>
<li><strong>retrieved documents</strong>：从检索系统中获取的相关文档。</li>
<li><strong>current objective</strong>：当前推理目标（在多步推理模式下）。</li>
<li>状态空间：S2 = {q, retrieved documents, current objective}</li>
</ul>
<p>它会进行<strong>文档分析</strong>并按照下面的格式进行输出：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Thought: &lt;对每篇文档的分析&gt;</span>
<span class="hljs-section">Action: [&lt;选定的文档ID&gt;]</span>
</code></pre>
<h4 data-id="heading-9"><strong>示例</strong></h4>
<ol>
<li><strong>单次检索策略</strong>：</li>
</ol>
<ul>
<li>
<p><strong>问题</strong>：What is the population of Paris in 2023?</p>
</li>
<li>
<p><strong>检索到的文档</strong>：包含巴黎人口统计数据的多篇文档。</p>
</li>
<li>
<p><strong>信息过滤器输出</strong>：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Thought: Document 1 contains the most recent population data for Paris (2023).</span>
<span class="hljs-section">Action: [Document 1]</span>
</code></pre>
</li>
</ul>
<p><strong>2. 多步推理策略</strong>：</p>
<ul>
<li><strong>问题</strong>：How does the economic policy of Country A affect its trade relations with Country B?</li>
<li><strong>当前目标</strong>：分析Country A的经济政策。</li>
<li><strong>检索到的文档</strong>：多篇关于Country A经济政策的文档。</li>
</ul>
<p>对应的prompt如下设计：</p>
<pre><code class="hljs language-css" lang="css">你是一个智能助手，负责根据给定的问题和当前步骤的目标分析检索到的文档。你的角色是确定每个文档与问题和指定目标的相关性。
指令：
分析相关性：评估每个文档是否符合当前检索步骤的目标，并且包含对问题的直接回答。
思考过程：为每个文档提供简要分析，同时考虑答案内容和检索目标。
筛选文档：在你的思考过程之后，生成一个文档索引列表，指示保留哪些文档。
信息过滤状态
现在，请处理以下问题：
当前步骤的目标：{objective}（仅适用于<span class="hljs-selector-attr">[Planning]</span>模式）
问题：{question}
文档：{documents}
信息过滤输出
思考：&lt;对每个文档的分析&gt;
行动：<span class="hljs-selector-attr">[&lt;选定的文档ID&gt;]</span>
</code></pre>
<h3 data-id="heading-10">Decision Maker</h3>
<p>决策者的状态空间为：<strong>S3 = {q, Accumulated Documents, Roadmap}</strong></p>
<ul>
<li><strong>q</strong>：输入问题。</li>
<li><strong>Accumulated Documents</strong>：当前累积的文档（来自之前的检索-过滤循环）。</li>
<li><strong>Roadmap</strong>：由LLM生成的推理路线图（在多步推理策略中）。</li>
</ul>
<p>主要职责是根据当前状态评估推理进展，并决定是否需要进一步检索或直接生成最终答案。其动作空间包括以下两种可能的操作：</p>
<ol>
<li><strong>[Retrieval]</strong> ：</li>
</ol>
<ul>
<li>请求额外的检索-过滤循环，生成子查询以获取更多相关信息。</li>
<li><strong>适用场景</strong>：当前累积的文档不足以解决所有子目标。</li>
</ul>
<ol start="2">
<li><strong>[LLM]</strong> ：</li>
</ol>
<ul>
<li>将当前累积的所有文档传递给LLM，生成最终答案。</li>
<li><strong>适用场景</strong>：当前累积的文档已足够解决所有子目标。</li>
</ul>
<p>它的输出格式如下：</p>
<pre><code class="hljs language-css" lang="css">Thought: &lt;对当前进展和目标的分析&gt;
Action: {<span class="hljs-selector-attr">[Retrieval]</span>&lt;subquery <span class="hljs-attribute">content</span>&gt;, 或 <span class="hljs-selector-attr">[LLM]</span>}
</code></pre>
<h4 data-id="heading-11"><strong>示例</strong></h4>
<ol>
<li><strong>需要进一步检索</strong>：</li>
</ol>
<ul>
<li><strong>问题</strong>：How does the economic policy of Country A affect its trade relations with Country B?</li>
<li><strong>当前状态</strong>：</li>
</ul>

<ul>
<li><strong>Roadmap</strong>：下一步需要分析Country B的贸易政策。</li>
<li>Accumulated Documents：包含Country A经济政策的文档。</li>
</ul>

<ul>
<li>
<p><strong>决策者输出</strong>：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">Thought:</span> Additional information <span class="hljs-keyword">on</span> Country B<span class="hljs-comment">'s trade policy is required to complete the analysis.</span>
<span class="hljs-symbol">Action:</span> [Retrieval]&lt;trade policy <span class="hljs-keyword">of</span> Country B&gt;
</code></pre>
</li>
</ul>
<ol>
<li><strong>生成最终答案</strong>：</li>
</ol>
<ul>
<li><strong>问题</strong>：How does the economic policy of Country A affect its trade relations with Country B?</li>
<li><strong>当前状态</strong>：</li>
</ul>

<ul>
<li>Accumulated Documents：包含Country A经济政策和Country B贸易政策的文档。</li>
<li>Roadmap：所有子目标已完成。</li>
</ul>

<ul>
<li>
<p><strong>决策者输出</strong>：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">Thought:</span> Sufficient information has been accumulated <span class="hljs-keyword">to</span> generate the final answer.
<span class="hljs-symbol">Action:</span> [LLM]
</code></pre>
</li>
</ul>
<p>通过决策制定器的动态评估和决策，系统能够在多步推理策略中灵活调整检索和生成过程，确保复杂问题得到全面且准确的回答。</p>
<p>对应的prompt如下：</p>
<pre><code class="hljs language-markdown" lang="markdown">你是一个智能助手，负责根据提供的现有文档、计划和问题确定下一步的适当行动。你可以访问一个大型语言模型（LLM）来回答问题，并且有一个检索系统用于收集额外的文档。你的目标是决定是否编写查询以检索相关文档，或者基于现有文档和计划使用LLM生成全面的答案。
指令：
<span class="hljs-bullet">1.</span> <span class="hljs-strong">**评估现有文档**</span>：评估现有文档是否足以回答问题。
<span class="hljs-bullet">2.</span> <span class="hljs-strong">**遵循计划**</span>：了解计划中概述的下一步骤。
<span class="hljs-bullet">3.</span> <span class="hljs-strong">**决策类别**</span>：
<span class="hljs-bullet">-</span> 如果现有文档不足以需要额外检索，请回复：
[Retrieval] ‘YOUR QUERY HERE‘
<span class="hljs-bullet">-</span> 如果现有文档足以回答问题，请回复：
[LLM]
<span class="hljs-bullet">4.</span> <span class="hljs-strong">**专注于行动**</span>：不要直接回答问题；集中精力根据现有文档、计划和问题识别下一步的适当行动。
决策者状态
现在，请处理以下问题：现有文档：{accumulated documents}
路线图：{roadmap}
问题：{question}
决策者的输出
思考：[你对当前情况的分析（需要检索额外信息或使用LLM回答）]
行动：[基于分析的决定（[Retrieval]&lt;子查询内容&gt; 或 [LLM])]
</code></pre>
<h2 data-id="heading-12">总结</h2>
<p>通过引入多智能体协作的RAG优化方案，成功解决了传统RAG技术在处理多样化问题时的局限性。然而，这种设计较为依赖模型的能力，尤其是Reasoning Router的准确性。一旦Reasoning Router判断错误，最终结果可能不如预期。因此在资源允许的情况下，可以考虑使用一个7B小模型进行fine-tuning以提升Reasoning Router的表现。</p>
<h3 data-id="heading-13">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Coze+n8n实战：公众号文章从仿写到草稿箱，2分钟全搞定，你只需提交链接！]]></title>    <link>https://juejin.cn/post/7570500819888848939</link>    <guid>https://juejin.cn/post/7570500819888848939</guid>    <pubDate>2025-11-10T06:09:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570500819888848939" data-draft-id="7570339961908969515" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Coze+n8n实战：公众号文章从仿写到草稿箱，2分钟全搞定，你只需提交链接！"/> <meta itemprop="keywords" content="Coze,Agent,AIGC"/> <meta itemprop="datePublished" content="2025-11-10T06:09:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="后端小肥肠"/> <meta itemprop="url" content="https://juejin.cn/user/2966945320667536"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Coze+n8n实战：公众号文章从仿写到草稿箱，2分钟全搞定，你只需提交链接！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2966945320667536/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    后端小肥肠
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T06:09:19.000Z" title="Mon Nov 10 2025 06:09:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>大家好，我是小肥肠，专注 AI 干货知识分享！今天给带来的是n8n+Coze实战教程，一键仿写公众号文章到你的草稿箱中。</strong></p>
<h2 data-id="heading-0">1. 前言</h2>
<p>在前几个月我做过一个Coze+RPA的公众号工作流：<a href="https://juejin.cn/post/7523119147435507727" target="_blank" title="https://juejin.cn/post/7523119147435507727">躺赚必备！RPA+Coze+豆包：公众号自动发文，AI率0%亲测有效（附AI率0%提示词）</a>。最近不是都在研究n8n吗？有群友就问能不不能基于n8n仿写，我的回答是当然可以。<strong>只需要你提供一个对标文章链接，等待几秒钟后，一篇新的文章就会出现在你的公众号草稿箱当中，还配了封面图</strong>。</p>
<p>我用半天时间搭建了一个n8n工作流，操作方法非常简单，打开工作流界面，点击底部的 <strong>【Excute</strong> <strong>workflow</strong> <strong>】</strong> 按钮。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c430cf47db054b1d8fd1edf905b37a2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=ePDrRj4V24MGoC48mPyUE2mszO4%3D" alt="" loading="lazy"/></p>
<p>在弹出的表单中输入对标文章链接，点击【submit】按钮。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01ce3eb1d80e4b908cf80e0e0cc68e2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=v7ptEBepSodis5nVYN04vNrozN8%3D" alt="" loading="lazy"/></p>
<p>等待几秒后新的文章就会出现在我们的公众号草稿箱中。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e555527d65ca4f05b54ae394405b222e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=1bpyHbwYsVM8MvgQYWjoOlTNS7E%3D" alt="" loading="lazy"/></p>
<p>下图中左边是原文，右边是仿写新文 <strong>。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12a1849bec894d1fb0c9ba5d27727f5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=Jap38XNZBU6gxcKKYADhucgsY5U%3D" alt="" loading="lazy"/></p>
<p><strong>在</strong> <strong>新文</strong> <strong>里我没做配图，因为Coze之前做过同样功能的</strong> <strong>工作流</strong> <strong>，大家都反应想自己配图，所以在n8n这边就省略了工作流配图的步骤。对这个工作流感兴趣的读者赶紧码住跟练哦~</strong></p>
<h2 data-id="heading-1">2. 工作流搭建前置操作</h2>
<h3 data-id="heading-2">2.1. 开通图像生成服务</h3>
<p><strong>本</strong> <strong>工作流</strong> <strong>生图依托通义万相2.5</strong> <strong>MCP</strong> <strong>Server，故需要去对应网站开通服务。</strong></p>
<p>通义万相2.5-图像视频生成开通地址：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fbailian.console.aliyun.com%2F%3Fspm%3Da2c4g.11186623.0.0.7f477980N1ex6P%26tab%3Dmcp%23%2Fmcp-market%2Fdetail%2FWan25Media" target="_blank" title="https://bailian.console.aliyun.com/?spm=a2c4g.11186623.0.0.7f477980N1ex6P&amp;tab=mcp#/mcp-market/detail/Wan25Media" ref="nofollow noopener noreferrer">bailian.console.aliyun.com/?spm=a2c4g.…</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00a4560cc50442d5a06d6cee86a08460~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=83CMmQtBNrfNHrgesmQxI4Krnug%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">2.2. 下载n8n社区节点</h3>
<p>在n8n中新增社区节点n8n-nodes-wechat-offiaccount。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7da90d985ae144048f77c720c20f2cb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=qXGV5TGC1SV0R9Ez%2Bv1aNLpTlt8%3D" alt="" loading="lazy"/></p>
<p>安装完成后需要回到n8n界面，新建凭证（Wechat Official Account Credentials account）：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a733730717bc4d0eacd435124e0062ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=IEY8n8gV98lfgFZE9QIOBHceCOk%3D" alt="" loading="lazy"/></p>
<p>将公众号后台的appid和secret填入上述表单，同时需要将你的公网ip配置到白名单当中，公网ip获取指令为：curl ipinfo.io/ip。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7357898839814447bc3c2e0b7acc770d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=DifOTw%2BYYINyfka1MhhZhT0RThA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">3. 工作流搭建</h2>
<p>整个工作流如下图所示，接下来就开始依次拆解工作流的每个节点。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1430ddda028b499c8b763e0209422869~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=kmUR5RJI9D5v7L8LAtqZplp%2FWz4%3D" alt="" loading="lazy"/></p>
<p><strong>开始节点：</strong> 开始节点类型选择<strong>On form submission。</strong></p>
<ul>
<li>Form Title填写公众号仿写</li>
<li>点击 <strong>【add Form Element】</strong> 节点新增表单要素，在Field Name填入公众号链接，Element Type选择text，Placeholder任意填入一个公众号文章链接。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94a7bfcea310415b950ba26d499a6939~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=%2BAvruBTINVREJf%2BU9NU34Ih%2FcmM%3D" alt="" loading="lazy"/></p>
<p><strong>HTTP Request（调用Coze获取公众号文章内</strong> <strong>api</strong> <strong>）：</strong> 开始节点出来后点击【+】新增<strong>HTTP Request，</strong> 这个节点的作用是调用Coze工作流的api根据输入文章的url来获取文章的标题和内容。</p>
<ul>
<li>Method填写POST。</li>
<li>URL填写<a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.coze.cn%2Fv1%2Fworkflow%2Frun%25E3%2580%2582" target="_blank" title="https://api.coze.cn/v1/workflow/run%E3%80%82" ref="nofollow noopener noreferrer">api.coze.cn/v1/workflow…</a></li>
<li>Generic Auth Type选择Header Auth。</li>
<li>Header Auth填写Coze的凭证</li>
<li>打开Send Headers，Specify Headers选择Using Fields Below，Header Parameters中Name填写Content-Type，value填写application/json。</li>
<li>打开Send Body，Body Content Type选择JSON，Specify Body选择Using JSON，JSON中填写：</li>
</ul>

<pre><code class="hljs language-bash" lang="bash">{
  <span class="hljs-string">"workflow_id"</span>: <span class="hljs-string">"你的Coze工作流id"</span>,
  <span class="hljs-string">"parameters"</span>: {
    <span class="hljs-string">"input"</span>: <span class="hljs-string">"{{ <span class="hljs-variable">$json</span>['公众号链接'] }}"</span>
  }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b91fae9553f4c4abce4676f1913bb41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=7KdSgRvYMvAi1pRL%2F2Qet%2BnEIfQ%3D" alt="" loading="lazy"/></p>
<p>Coze工作流搭建很简单，就三个节点，核心就是通过Coze插件来获取公众号文章链接内容并清洗文章数据，排除干扰项（如发布时间这些无意义的字）后进行输出：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8169a4cb196c4447ab481dcca6c490d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=vwwA5rw%2BqAv3o2SThRoYMikL4VA%3D" alt="" loading="lazy"/></p>
<p>工作流搭建好以后就可以以API的形式进行调用了：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92bfe149546c42fd9953c048724a21c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=V86X0aBcbqKrHk9%2FBWlsru7a4NU%3D" alt="" loading="lazy"/></p>
<p><strong>Code in</strong> <strong>JavaScript</strong> <strong>（把字符串转换为</strong> <strong>json</strong> <strong>格式）：HTTP Request</strong>节点出来后点击【+】新增<strong>Code in JavaScript，</strong> 这是一个代码节点，它的主要作用就是把前置节点输出的字符串数据转换为json格式。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8b64c3c4e544524b549c37e39ace729~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=YHANrcgfJQHTJxOdD1yBV0cB0rE%3D" alt="" loading="lazy"/></p>
<p><strong>爆文仿写（</strong> <strong>AI</strong> <strong>Agent）：Code in</strong> <strong>JavaScript</strong>节点出来后点击【+】新增<strong>AI Agent</strong>节点，这个节点的作用获取前置节点输出的文章标题和内容基于gemini-2.5-pro模型进行深度二创。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3a0a2adbb6d45bca11a11eb81e6f695~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=28TRWIRa5aqshrZLWGWMSeAAgXM%3D" alt="" loading="lazy"/></p>
<ul>
<li>在Chat Model处点击【+】，新增聊天模型。</li>
<li>在Output Parser处点击【+】，规整输出格式，JSON Example处填入：</li>
</ul>

<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"title"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"content"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25e3a2c4e1e743f2ac7110b1951d8f0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=W4t0priBgc5qH84mf1TaBcxmZv8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">3.1 生成封面</h3>
<p><strong>生成封面（</strong> <strong>AI</strong> <strong>Agent）：爆文仿写（AI Agent）</strong> 节点出来后点击【+】新增<strong>AI Agent。</strong> 这个节点的作用的调用通义万相2.5的MCP Server来生成图片。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c597d490ed794789bb43582529cd3fc6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=mlU4O74mVUQb1btKcO0stsCT%2BWo%3D" alt="" loading="lazy"/></p>
<ul>
<li>Chat Model处点击【+】新增OpenAI Chat Mode（或DeepSeek Chat Model）。</li>
<li>Tool处点击【+】新增MCP Client Tool用于图片生成。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cce09ce1b97f41baaaa263cfc6dbb3bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=skWhz6Uk01mtftMiwjtrCNfhWCw%3D" alt="" loading="lazy"/></p>
<p>Endpoint填写<a href="https://link.juejin.cn?target=https%3A%2F%2Fdashscope.aliyuncs.com%2Fapi%2Fv1%2Fmcps%2FWan25Media%2Fsse%25E3%2580%2582" target="_blank" title="https://dashscope.aliyuncs.com/api/v1/mcps/Wan25Media/sse%E3%80%82" ref="nofollow noopener noreferrer">dashscope.aliyuncs.com/api/v1/mcps…</a></p>
<p>Server Transport选择Server Sent Events (Deprecated)。</p>
<p>Authentication选择Header Auth。</p>
<p>Credential for Header Auth点击Create new credential，Name填写Authorization，Value填写阿里云百炼的key（<a href="https://link.juejin.cn?target=https%3A%2F%2Fbailian.console.aliyun.com%2F%3Fspm%3Da2c4g.11186623.0.0.7f477980N1ex6P%26tab%3Dmodel%23%2Fapi-key%25EF%25BC%2589%25EF%25BC%258C%25E6%25B3%25A8%25E6%2584%258Fkey%25E5%2589%258D%25E9%259D%25A2%25E9%259C%2580%25E8%25A6%2581%25E5%258A%25A0Bearer%25E5%2592%258C%25E4%25B8%2580%25E4%25B8%25AA%25E8%258B%25B1%25E6%2596%2587%25E7%25A9%25BA%25E6%25A0%25BC%25E3%2580%2582**%25E6%259C%2580%25E5%2590%258E%25E6%258A%258A%25E8%25BF%2599%25E4%25B8%25AAAuth%25E5%2591%25BD%25E5%2590%258D%25E4%25B8%25BAbailian%25E3%2580%2582" target="_blank" title="https://bailian.console.aliyun.com/?spm=a2c4g.11186623.0.0.7f477980N1ex6P&amp;tab=model#/api-key%EF%BC%89%EF%BC%8C%E6%B3%A8%E6%84%8Fkey%E5%89%8D%E9%9D%A2%E9%9C%80%E8%A6%81%E5%8A%A0Bearer%E5%92%8C%E4%B8%80%E4%B8%AA%E8%8B%B1%E6%96%87%E7%A9%BA%E6%A0%BC%E3%80%82**%E6%9C%80%E5%90%8E%E6%8A%8A%E8%BF%99%E4%B8%AAAuth%E5%91%BD%E5%90%8D%E4%B8%BAbailian%E3%80%82" ref="nofollow noopener noreferrer">bailian.console.aliyun.com/?spm=a2c4g.…</a>**</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06923ce274f04160aec4dc5e7398a94a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=jW8EPc7np%2BoIsPasG6AZ1qJvntk%3D" alt="" loading="lazy"/></p>
<p><strong>HTTP Request1（将封面图链接转换为文件）：生成封面（</strong> <strong>AI</strong> <strong>Agent）</strong> 节点出来后点击【+】添加<strong>HTTP Request</strong>节点，这个节点的作用是把图片链接转换为文件格式。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75e5f45ed13d4ce5b887fd6ece0e744a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=2ic2T1T2aY%2BAJoI96iBuw3vrUNI%3D" alt="" loading="lazy"/></p>
<p><strong>Media:uploadOther media（上传封面图）：HTTP Request1</strong>节点出来后点击【+】新增<strong>Media:uploadOther media。</strong> 这个节点的作用是上传图片链接并返回一个media_id，后续填充到公众号封面中。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/006b504ac9374f5280747a9ce1c78ab8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=i92E%2BIsCQhP7ICI0VvrFGpFh2M0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">3.2. 生成正文</h3>
<p><strong>Code in JavaScript1：爆文仿写（</strong> <strong>AI</strong> <strong>Agent）</strong> 节点出来后点击【+】新增Code in JavaScript，这个节点的作用是将正文内容改写成html格式内容。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45a64f65af3b41ea911899620b9e1de9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=Pjg34iKv8cSA4owYyPRwOTvK%2FRI%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">3.3. 上传到草稿箱</h3>
<p><strong>Merge：Code in JavaScript1和Media:uploadOther media</strong>节点出来后点击【+】新增<strong>Merge。</strong> 这个节点的作用是整合前面生成的封面和仿写原文。</p>
<ul>
<li>Mode选择Combine</li>
<li>Combine By选择Position</li>
<li>Number of Inputs填写2</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7033e031e62d41d2960a9cc379c7bb6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=aPEkb%2BEZVqX4rcHLJfE2LEcFeqc%3D" alt="" loading="lazy"/></p>
<p><strong>新增草稿：Merge</strong>节点出来后点击【+】新增<strong>Draft:add draft</strong>节点，这个节点的作用是将前置节点生成的封面和正文都上传到公众号草稿当中。</p>
<p>草稿文章对象内容(Articles)填写：</p>
<pre><code class="hljs language-python" lang="python">[
  {
    <span class="hljs-string">"article_type"</span>: <span class="hljs-string">"news"</span>,
    <span class="hljs-string">"title"</span>: <span class="hljs-string">"{{ $('爆文仿写').item.json.output.title }}"</span>,
    <span class="hljs-string">"author"</span>: <span class="hljs-string">"小肥肠"</span>,
    <span class="hljs-string">"content"</span>: <span class="hljs-string">"{{ 
  $json.htmlContent
    .replaceAll("</span>\n<span class="hljs-string">", "</span>\n<span class="hljs-string">")   
    .replaceAll("</span>\<span class="hljs-string">r", "</span>\<span class="hljs-string">r")   
    .replaceAll("</span><span class="hljs-string">""</span>, <span class="hljs-string">"'"</span>)   
}}<span class="hljs-string">",
    "</span>thumb_media_id<span class="hljs-string">": "</span>{{ $json.media_id }}<span class="hljs-string">",
    "</span>show_cover_pic<span class="hljs-string">": 1,
    "</span>need_open_comment<span class="hljs-string">": 1,
    "</span>only_fans_can_comment<span class="hljs-string">": 0
  }
]
</span></code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34eff983330a401d88ae8c90b2fbabf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=u1nsGtMPR%2FlEPTB38j8Q921A2TQ%3D" alt="" loading="lazy"/></p>
<p>以上就是整个工作流的完整流程拆解，动手能力强的读者可以跟着教程实践一遍。如果想直接获取工作流，可以加入社群后我拉你进空间直接学习使用。</p>
<h2 data-id="heading-8">4. 结语</h2>
<p>本文详细拆解了如何利用 <strong>n8n</strong> 强大的自动化能力，配合 <strong>Coze</strong> 和 <strong>AI</strong> <strong>Agent</strong>（如 <strong>Gemini 2.5 Pro</strong> 模型）实现一个高度自动化的公众号文章仿写工作流。从前置服务的开通、社区节点的安装，到工作流的每一个节点——数据获取、内容深度二创、封面图生成、格式转换，直至最终上传到公众号<strong>草稿箱</strong>，我们完成了整个<strong>一键仿写</strong>的闭环。</p>
<p><strong>如本次分享对你有帮助，麻烦一键三连支持一下小肥肠，我们下期再见~</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a96bc810e0f4e9b9ba33c8bc628fc68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=yMZwLutQPoQH8yGkU0EzOKu92qY%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python SQLAlchemy 全生命周期指南：从模型、迁移到优雅会话管理]]></title>    <link>https://juejin.cn/post/7571005216910491667</link>    <guid>https://juejin.cn/post/7571005216910491667</guid>    <pubDate>2025-11-11T06:10:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571005216910491667" data-draft-id="7571007466823352372" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python SQLAlchemy 全生命周期指南：从模型、迁移到优雅会话管理"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-11T06:10:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI贺贺"/> <meta itemprop="url" content="https://juejin.cn/user/2506542241030365"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python SQLAlchemy 全生命周期指南：从模型、迁移到优雅会话管理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2506542241030365/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI贺贺
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:10:05.000Z" title="Tue Nov 11 2025 06:10:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">摘要</h2>
<p>在 Python 项目中，如何优雅地管理数据库是一个永恒的话题，尤其是在使用像 SQLAlchemy 这样的强大 ORM (Object-Relational Mapper) 时。Web 框架（如 FastAPI）的依赖注入系统为我们提供了便捷的自动化方案，但当代码运行在非 Web 环境（如定时任务、命令行工具、数据处理脚本）时，我们该何去何从？</p>
<p>本文将作为一份终极指南，带你走过 SQLAlchemy 应用的<strong>完整生命周期</strong>：从最初的<strong>模型定义</strong>，到使用 <strong>Alembic</strong> 进行健壮的<strong>数据库迁移</strong>，再到实现优雅高效的<strong>会话管理</strong>。读完本文，你将能够构建一个通用的数据库操作“瑞士军刀”，在任何场景下都能自信地与数据库交互。</p>
<hr/>
<h2 data-id="heading-1">一、ORM 基础：用 Pythonic 的方式定义数据模型</h2>
<p>一切始于模型。ORM 的核心魅力在于让我们用熟悉的 Python 类来描述数据库表结构。</p>
<h3 data-id="heading-2">1.1 SQLAlchemy <code>declarative_base</code></h3>
<p>首先，我们需要一个所有模型的基类，它包含了将类映射到表的元数据。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># src/core/database.py</span>
<span class="hljs-keyword">from</span> sqlalchemy.ext.declarative <span class="hljs-keyword">import</span> declarative_base

Base = declarative_base()
</code></pre>
<h3 data-id="heading-3">1.2 定义模型</h3>
<p>现在，我们可以通过继承 <code>Base</code> 来创建模型。每个类属性都使用 <code>Column</code> 来定义一个数据库字段。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># src/models/account.py</span>
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> Column, Integer, String, DateTime, func
<span class="hljs-keyword">from</span> src/core/database <span class="hljs-keyword">import</span> Base

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Account</span>(<span class="hljs-title class_ inherited__">Base</span>):
    __tablename__ = <span class="hljs-string">"accounts"</span>

    <span class="hljs-built_in">id</span> = Column(Integer, primary_key=<span class="hljs-literal">True</span>, index=<span class="hljs-literal">True</span>)
    nickname = Column(String, unique=<span class="hljs-literal">True</span>, index=<span class="hljs-literal">True</span>, nullable=<span class="hljs-literal">False</span>)
    status = Column(String, default=<span class="hljs-string">"ACTIVE"</span>, nullable=<span class="hljs-literal">False</span>)
    created_at = Column(DateTime, server_default=func.now())
</code></pre>
<h3 data-id="heading-4">1.3 关系映射 (<code>relationship</code>)</h3>
<p>当模型之间存在关联时（如用户和帖子），我们使用 <code>relationship</code> 来定义它们。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 一个用户可以有多篇帖子 (one-to-many)</span>
<span class="hljs-comment"># src/models/post.py</span>
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> Column, Integer, String, ForeignKey
<span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> relationship
<span class="hljs-keyword">from</span> src/core/database <span class="hljs-keyword">import</span> Base

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Post</span>(<span class="hljs-title class_ inherited__">Base</span>):
    __tablename__ = <span class="hljs-string">"posts"</span>
    <span class="hljs-built_in">id</span> = Column(Integer, primary_key=<span class="hljs-literal">True</span>)
    title = Column(String)
    owner_id = Column(Integer, ForeignKey(<span class="hljs-string">"accounts.id"</span>))

    <span class="hljs-comment"># 'back_populates' 属性用于双向关系，让 Account 模型也能通过 'posts' 访问到 Post</span>
    owner = relationship(<span class="hljs-string">"Account"</span>, back_populates=<span class="hljs-string">"posts"</span>)

<span class="hljs-comment"># 在 Account 模型中添加反向关系</span>
<span class="hljs-comment"># src/models/account.py</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Account</span>(<span class="hljs-title class_ inherited__">Base</span>):
    <span class="hljs-comment"># ... (已有列)</span>
    posts = relationship(<span class="hljs-string">"Post"</span>, back_populates=<span class="hljs-string">"owner"</span>)
</code></pre>
<h3 data-id="heading-5">1.4 <code>create_all</code> 的作用与局限性</h3>
<p>对于快速原型开发，<code>Base.metadata.create_all(engine)</code> 是个好工具，它可以根据你的模型创建所有表。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 仅适用于开发初期或测试</span>
<span class="hljs-keyword">from</span> src.core.database <span class="hljs-keyword">import</span> engine, Base
<span class="hljs-keyword">from</span> src.models <span class="hljs-keyword">import</span> account, post <span class="hljs-comment"># 导入所有模型</span>

<span class="hljs-built_in">print</span>(<span class="hljs-string">"Creating all tables..."</span>)
Base.metadata.create_all(bind=engine)
</code></pre>
<p><strong>局限性</strong>：<code>create_all</code> <strong>不会</strong>处理表的更新。如果你给模型增加了一个字段，它不会在现有数据库中添加这一列。这就是我们需要数据库迁移工具的原因。</p>
<hr/>
<h2 data-id="heading-6">二、数据库迁移的艺术：Alembic 核心工作流</h2>
<p>Alembic 是 SQLAlchemy 官方的数据库迁移工具。它能比对你的模型和当前数据库的状态，自动生成迁移脚本。</p>
<h3 data-id="heading-7">2.1 为什么需要 Alembic？</h3>
<ul>
<li><strong>版本控制</strong>：像 Git 管理代码一样，管理你的数据库结构变更。</li>
<li><strong>自动化</strong>：自动检测模型变化（增删改字段、建表、删表）。</li>
<li><strong>安全可靠</strong>：提供升级（<code>upgrade</code>）和降级（<code>downgrade</code>）操作，出问题时可以回滚。</li>
<li><strong>团队协作</strong>：确保团队中每个人的数据库结构都保持同步。</li>
</ul>
<h3 data-id="heading-8">2.2 Alembic 环境配置</h3>
<p>一个典型的 Alembic 项目包含两个核心配置文件：</p>
<ol>
<li>
<p><strong><code>alembic.ini</code></strong>: 主配置文件。最重要的配置是 <code>sqlalchemy.url</code>，它告诉 Alembic 要连接哪个数据库。为了不硬编码，我们通常让它从环境变量读取。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># alembic.ini</span>
<span class="hljs-section">[alembic]</span>
<span class="hljs-comment"># ...</span>
<span class="hljs-attr">sqlalchemy.url</span> = %(DATABASE_URL)s <span class="hljs-comment"># 从环境变量读取</span>
</code></pre>
</li>
<li>
<p><strong><code>env.py</code></strong>: 运行时环境配置。这里的关键是让 Alembic 知道你的模型定义在哪里，以便进行比对。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># alembic/env.py</span>
<span class="hljs-comment"># ...</span>
<span class="hljs-comment"># 导入你的模型基类</span>
<span class="hljs-keyword">from</span> src.core.database <span class="hljs-keyword">import</span> Base
<span class="hljs-comment"># 导入所有模型，确保 Alembic 能检测到它们</span>
<span class="hljs-keyword">from</span> src.models <span class="hljs-keyword">import</span> account, post

<span class="hljs-comment"># 将你的模型元数据设置为 target_metadata</span>
target_metadata = Base.metadata
<span class="hljs-comment"># ...</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-9">2.3 Alembic 三大核心命令</h3>
<p>掌握这三个命令，你就掌握了 Alembic 的 90%。</p>
<ol>
<li>
<p><code>alembic revision --autogenerate -m "描述信息"</code></p>
<ul>
<li><strong>作用</strong>：<strong>自动检测</strong>模型与数据库的差异，并<strong>生成</strong>一个新的迁移脚本文件。</li>
<li><strong>示例</strong>：给 <code>Account</code> 模型加一个 <code>email</code> 字段后，运行 <code>alembic revision --autogenerate -m "add email to account"</code>。</li>
</ul>
</li>
<li>
<p><code>alembic upgrade head</code></p>
<ul>
<li><strong>作用</strong>：<strong>应用</strong>所有未应用的迁移脚本，将数据库更新到最新版本（<code>head</code>）。你也可以指定一个版本号来更新到特定版本。</li>
<li><strong>示例</strong>：<code>alembic upgrade head</code> 会执行上一步生成的脚本，在数据库中添加 <code>email</code> 列。</li>
</ul>
</li>
<li>
<p><code>alembic downgrade -1</code></p>
<ul>
<li><strong>作用</strong>：<strong>回滚</strong>数据库。<code>-1</code> 表示回退一个版本。你也可以指定版本号来回退到特定状态。</li>
<li><strong>示例</strong>：<code>alembic downgrade -1</code> 会撤销刚刚的 <code>add email</code> 操作。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-10">2.4 最佳实践</h3>
<ul>
<li><strong>永远检查自动生成的脚本</strong>：<code>autogenerate</code> 很强大，但并非万能。对于复杂的操作（如数据迁移、复杂的约束变更），它可能需要你手动调整脚本。</li>
<li><strong>保持线性历史</strong>：在团队协作中，如果多人都生成了迁移脚本，合并时可能会产生冲突（多个 <code>head</code>）。通常的解决办法是 <code>rebase</code> 或 <code>merge</code> 迁移文件，确保一个清晰的、线性的升级路径。</li>
</ul>
<hr/>
<h2 data-id="heading-11">三、会话管理：从繁琐到优雅</h2>
<p>模型定义好了，数据库也准备就绪了，现在该如何安全高效地操作数据呢？</p>
<h3 data-id="heading-12">3.1 深入核心：<code>Session</code> 和连接池</h3>
<ul>
<li><strong><code>Engine</code></strong>: 程序的数据库接口，内部维护一个<strong>连接池</strong>。创建 <code>Engine</code> 成本较高，一个应用通常只有一个。</li>
<li><strong><code>Session</code></strong>: 一个轻量级的“工作区”或“记事本”，用于记录你将要对数据库做的所有操作（增、删、改）。它本身不持有数据库连接。</li>
<li><strong>连接池 (Connection Pooling)</strong>：<code>Engine</code> 预先创建并维护一组数据库连接。当 <code>Session</code> 第一次需要与数据库通信时，它会从池中“借用”一个连接，用完后“归还”，而不是每次都创建和销毁昂贵的真实连接。这正是高性能的关键。</li>
<li><strong><code>SessionLocal()</code></strong>: 一个“会话工厂”，调用它会创建一个新的 <code>Session</code> 实例。这个操作成本极低。</li>
</ul>
<h3 data-id="heading-13">3.2 模式演进：四种会话管理模式</h3>
<h4 data-id="heading-14">模式一：基础的 <code>try...finally</code> (不推荐日常使用)</h4>
<p>这是最原始的方式，能工作，但很繁琐且容易出错。</p>
<pre><code class="hljs language-python" lang="python">db = SessionLocal()
<span class="hljs-keyword">try</span>:
    <span class="hljs-comment"># ... 执行数据库操作 ...</span>
    db.commit()
<span class="hljs-keyword">finally</span>:
    db.close()
</code></pre>
<h4 data-id="heading-15">模式二：<code>with</code> 语句与上下文管理器 (推荐)</h4>
<p>Python 的 <code>with</code> 语句是处理这类“获取-使用-释放”资源的完美工具。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># src/core/database.py</span>
<span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> contextmanager

<span class="hljs-meta">@contextmanager</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">db_session_scope</span>():
    db = SessionLocal()
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">yield</span> db
        db.commit()
    <span class="hljs-keyword">except</span> Exception:
        db.rollback()
        <span class="hljs-keyword">raise</span>
    <span class="hljs-keyword">finally</span>:
        db.close()

<span class="hljs-comment"># 用法</span>
<span class="hljs-keyword">with</span> db_session_scope() <span class="hljs-keyword">as</span> db:
    user = db.query(Account).first()
</code></pre>
<h4 data-id="heading-16">模式三：装饰器 (<code>@decorator</code>) (推荐)</h4>
<p>对于封装好的业务逻辑函数，装饰器是减少样板代码的利器。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># src/core/database.py</span>
<span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> wraps

<span class="hljs-keyword">def</span> <span class="hljs-title function_">with_db_session</span>(<span class="hljs-params">func</span>):
<span class="hljs-meta">    @wraps(<span class="hljs-params">func</span>)</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):
        <span class="hljs-keyword">with</span> db_session_scope() <span class="hljs-keyword">as</span> db:
            <span class="hljs-keyword">return</span> func(db, *args, **kwargs)
    <span class="hljs-keyword">return</span> wrapper

<span class="hljs-comment"># 用法</span>
<span class="hljs-meta">@with_db_session</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_by_nickname</span>(<span class="hljs-params">db: Session, nickname: <span class="hljs-built_in">str</span></span>):
    <span class="hljs-keyword">return</span> db.query(Account).filter_by(nickname=nickname).first()

user = get_user_by_nickname(<span class="hljs-string">"admin"</span>)
</code></pre>
<h4 data-id="heading-17">模式四：高阶函数 (推荐)</h4>
<p>对于一次性的简单查询，一个接受 <code>lambda</code> 的高阶函数非常方便。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># src/core/database.py</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">run_with_db</span>(<span class="hljs-params">func: <span class="hljs-type">Callable</span></span>):
    <span class="hljs-keyword">with</span> db_session_scope() <span class="hljs-keyword">as</span> db:
        <span class="hljs-keyword">return</span> func(db)

<span class="hljs-comment"># 用法</span>
user_count = run_with_db(<span class="hljs-keyword">lambda</span> db: db.query(Account).count())
</code></pre>
<hr/>
<h2 data-id="heading-18">四、构建你的“瑞士军刀”：完整代码实现</h2>
<p>将上述工具整合到 <code>src/core/database.py</code> 中，你就拥有了一个强大的数据库操作工具箱。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># src/core/database.py (最终版本)</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> create_engine
<span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> sessionmaker, Session
<span class="hljs-keyword">from</span> sqlalchemy.ext.declarative <span class="hljs-keyword">import</span> declarative_base
<span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> contextmanager
<span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> wraps
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Callable</span>
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv

load_dotenv()
DATABASE_URL = os.getenv(<span class="hljs-string">"DATABASE_URL"</span>)

engine = create_engine(DATABASE_URL)
SessionLocal = sessionmaker(autocommit=<span class="hljs-literal">False</span>, autoflush=<span class="hljs-literal">False</span>, bind=engine)
Base = declarative_base()

<span class="hljs-comment"># --- 我们的工具箱 ---</span>

<span class="hljs-meta">@contextmanager</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">db_session_scope</span>():
    <span class="hljs-string">"""提供一个事务性的数据库会话作用域。"""</span>
    db = SessionLocal()
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">yield</span> db
        db.commit()
    <span class="hljs-keyword">except</span> Exception:
        db.rollback()
        <span class="hljs-keyword">raise</span>
    <span class="hljs-keyword">finally</span>:
        db.close()

<span class="hljs-keyword">def</span> <span class="hljs-title function_">with_db_session</span>(<span class="hljs-params">func: <span class="hljs-type">Callable</span></span>):
    <span class="hljs-string">"""装饰器：为函数注入一个 db session。"""</span>
<span class="hljs-meta">    @wraps(<span class="hljs-params">func</span>)</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):
        <span class="hljs-keyword">with</span> db_session_scope() <span class="hljs-keyword">as</span> db:
            <span class="hljs-keyword">return</span> func(db, *args, **kwargs)
    <span class="hljs-keyword">return</span> wrapper

<span class="hljs-keyword">def</span> <span class="hljs-title function_">run_with_db</span>(<span class="hljs-params">func: <span class="hljs-type">Callable</span></span>):
    <span class="hljs-string">"""高阶函数：在 db 会话中执行一个 lambda 或其他 callable。"""</span>
    <span class="hljs-keyword">with</span> db_session_scope() <span class="hljs-keyword">as</span> db:
        <span class="hljs-keyword">return</span> func(db)
</code></pre>
<hr/>
<h2 data-id="heading-19">五、实战演练</h2>
<p>下面的示例脚本展示了如何在实际项目中使用这些工具。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># examples/database_scope_demo.py</span>
<span class="hljs-keyword">from</span> src.core.database <span class="hljs-keyword">import</span> db_session_scope, with_db_session, run_with_db
<span class="hljs-keyword">from</span> src.models.account <span class="hljs-keyword">import</span> Account
<span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> Session

<span class="hljs-comment"># 1. with 语句</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_with</span>():
    <span class="hljs-keyword">with</span> db_session_scope() <span class="hljs-keyword">as</span> db:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"当前用户数: <span class="hljs-subst">{db.query(Account).count()}</span>"</span>)

<span class="hljs-comment"># 2. 装饰器</span>
<span class="hljs-meta">@with_db_session</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">find_user</span>(<span class="hljs-params">db: Session, nickname: <span class="hljs-built_in">str</span></span>):
    <span class="hljs-keyword">return</span> db.query(Account).filter_by(nickname=nickname).first()

<span class="hljs-comment"># 3. 高阶函数</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_lambda</span>():
    inactive_count = run_with_db(
        <span class="hljs-keyword">lambda</span> db: db.query(Account).filter_by(status=<span class="hljs-string">'INACTIVE'</span>).count()
    )
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"非活跃用户数: <span class="hljs-subst">{inactive_count}</span>"</span>)

<span class="hljs-comment"># --- 执行 ---</span>
demo_with()
user = find_user(<span class="hljs-string">"admin"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"找到用户: <span class="hljs-subst">{user.nickname <span class="hljs-keyword">if</span> user <span class="hljs-keyword">else</span> <span class="hljs-string">'无'</span>}</span>"</span>)
demo_lambda()
</code></pre>
<hr/>
<h2 data-id="heading-20">六、总结</h2>
<p>通过本文，我们建立了一套覆盖 SQLAlchemy 全生命周期的管理方案：</p>
<ol>
<li><strong>用 <code>declarative_base</code> 定义模型</strong>：代码即文档，清晰明了。</li>
<li><strong>用 <code>Alembic</code> 管理迁移</strong>：保证数据库结构的健壮、可追溯和团队同步。</li>
<li><strong>用三种模式管理会话</strong>：
<ul>
<li><code>with db_session_scope()</code>: 适用于复杂的、多步骤的业务逻辑。</li>
<li><code>@with_db_session</code>: 适用于封装独立的、可复用的业务函数。</li>
<li><code>run_with_db()</code>: 适用于执行简单的、一次性的查询。</li>
</ul>
</li>
</ol>
<p>将这些工具和理念融入你的项目，可以极大地提升代码质量、开发效率和系统的长期可维护性。从此告别混乱的数据库操作，拥抱 Pythonic 的优雅。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[离线工程集成其他推送]]></title>    <link>https://juejin.cn/post/7571005216910475283</link>    <guid>https://juejin.cn/post/7571005216910475283</guid>    <pubDate>2025-11-11T06:09:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571005216910475283" data-draft-id="7570976560708747327" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="离线工程集成其他推送"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-11T06:09:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Mr_汪"/> <meta itemprop="url" content="https://juejin.cn/user/1275089221598765"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            离线工程集成其他推送
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1275089221598765/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Mr_汪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:09:03.000Z" title="Tue Nov 11 2025 06:09:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>uniapp中推送通知</p>
<p>1.在app.vue中添加监听</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> globalEvent = uni.requireNativePlugin(<span class="hljs-string">'globalEvent'</span>);
globalEvent.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'myEvent'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
	<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'onPushMessage myEvent'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(e));
});
app.<span class="hljs-title function_">initEventBus</span>()
</code></pre>
<p>2、调用插件app.initEventBus()，注册EventBus</p>
<pre><code class="hljs language-js" lang="js">@<span class="hljs-title class_">UniJSMethod</span>(uiThread = <span class="hljs-literal">false</span>)
fun <span class="hljs-title function_">initEventBus</span>(): <span class="hljs-title class_">Int</span> {
    <span class="hljs-keyword">if</span> (!isRegistered) {
        <span class="hljs-title class_">EventBus</span>.<span class="hljs-title function_">getDefault</span>().<span class="hljs-title function_">register</span>(<span class="hljs-variable language_">this</span>)
        <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">d</span>(<span class="hljs-string">"onPushMessage"</span>,<span class="hljs-string">"onMessageEvent initEventBus"</span>)
        isRegistered = <span class="hljs-literal">true</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
}
</code></pre>
<p>3.收到通知设置通知点击跳转，跳转到MainActivity</p>
<pre><code class="hljs language-js" lang="js">public <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPandoraEntry</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">PandoraEntry</span>
</code></pre>
<p>4.如果是离线通知的话，直接跳转到MainActivity或者设置打开应用</p>
<blockquote>
<p>MyPandoraEntry启动模式设置成android:launchMode="singleTask"</p>
</blockquote>
<p>5.点击通知后，在startActivity获取到点击通知后intent发送postSticky广播</p>
<pre><code class="hljs language-js" lang="js">    @<span class="hljs-title class_">Override</span>
    public <span class="hljs-keyword">void</span> <span class="hljs-title function_">startActivity</span>(<span class="hljs-params">Intent intent</span>) {
        <span class="hljs-title class_">EventBus</span>.<span class="hljs-title function_">getDefault</span>().<span class="hljs-title function_">postSticky</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageEvent</span>(intent.<span class="hljs-title function_">getExtras</span>().<span class="hljs-title function_">get</span>(<span class="hljs-string">"key"</span>)));

    }
</code></pre>
<p>6.插件收到信息后，通知uniapp层</p>
<pre><code class="hljs language-js" lang="js">fun <span class="hljs-title function_">onMessageEvent</span>(<span class="hljs-params">event: MessageEvent</span>) {
    mUniSDKInstance.<span class="hljs-title function_">fireGlobalEventCallback</span>(<span class="hljs-string">"myEvent"</span>, params)
}
</code></pre>
<p>目前android ios 鸿蒙next都可以使用一样的方式，发送<strong>粘性广播</strong>，通过启动后监听。其中uniapp鸿蒙next需要自己使用接口，目前没有看到globalEvent</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Jetpack Compose 状态管理]]></title>    <link>https://juejin.cn/post/7571086754879881262</link>    <guid>https://juejin.cn/post/7571086754879881262</guid>    <pubDate>2025-11-11T06:03:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571086754879881262" data-draft-id="7570992947464110090" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Jetpack Compose 状态管理"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-11-11T06:03:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="循环不息优化不止"/> <meta itemprop="url" content="https://juejin.cn/user/3499064877398681"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Jetpack Compose 状态管理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3499064877398681/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    循环不息优化不止
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:03:36.000Z" title="Tue Nov 11 2025 06:03:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Jetpack Compose 状态管理</h2>
<p>Jetpack Compose 正在改变我们构建 Android UI 的方式。其声明式的特性让我们能更直观地描述界面，但同时也带来了一个核心问题：<strong>如何管理和持久化UI状态？</strong></p>
<h3 data-id="heading-1">Part 1: <code>remember</code> - Compose 的“短期记忆”</h3>
<p>在 Compose 中，当一个状态改变时，相关的 Composable 函数会<strong>重组（Recomposition）</strong>，也就是重新执行。这意味着，任何在函数体内的普通变量都会在每次重组时被重置。</p>
<p>为了解决这个问题，Compose 提供了 <code>remember</code>。</p>
<p><code>remember</code> 的核心作用是<strong>在多次重组之间“记住”一个值</strong>。它会将计算结果存储在组合树中，下次重组时直接返回缓存的值，而不是重新计算。</p>
<h4 data-id="heading-2">用例 1：记住 UI 状态</h4>
<p>这是最常见的用法。<code>remember</code> 与 <code>MutableState</code> 结合，让状态在重组后得以保留。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 如果没有 remember，每次重组 name 都会被重置为空字符串</span>
<span class="hljs-keyword">var</span> name <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-string">""</span>) }```

#### 用例 <span class="hljs-number">2</span>：缓存高成本计算

`remember` 不仅能记住宿主，还能记住任何计算结果，这对于避免重复执行昂贵操作至关重要。

​```kotlin
<span class="hljs-comment">// 创建 ShaderBrush 的操作（特别是加载位图）是昂贵的</span>
<span class="hljs-comment">// 使用 remember 可以确保它只在首次组合时被创建一次</span>
<span class="hljs-keyword">val</span> brush = remember {
    ShaderBrush(
        BitmapShader(
            ImageBitmap.imageResource(res, avatarRes).asAndroidBitmap(),
            Shader.TileMode.REPEAT,
            Shader.TileMode.REPEAT
        )
    )
}
</code></pre>
<blockquote>
<p><strong><code>remember</code> 的局限</strong>：它的记忆是“短期”的。当发生<strong>配置变更（如屏幕旋转）<strong>或</strong>系统因内存不足终止进程</strong>时，<code>remember</code> 记住的所有内容都会丢失。</p>
</blockquote>
<h3 data-id="heading-3">Part 2: <code>rememberSaveable</code> - 跨越配置变更的“长期记忆”</h3>
<p>为了解决 <code>remember</code> 的局限性，Compose 提供了 <code>rememberSaveable</code>。</p>
<p>顾名思义，<code>rememberSaveable</code> 不仅能在重组中记住状态，还能自动将数据保存到 Android 的 <code>Bundle</code> 中。这意味着即使用户旋转了屏幕，甚至应用进程被系统回收后，状态也能够被完美恢复。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 即使用户旋转屏幕，输入框中的文字也不会丢失</span>
<span class="hljs-keyword">var</span> name <span class="hljs-keyword">by</span> rememberSaveable { mutableStateOf(<span class="hljs-string">""</span>) }
</code></pre>
<h3 data-id="heading-4">Part 3: 让自定义对象变得“可保存”</h3>
<p><code>rememberSaveable</code> 对基本数据类型（Int, String, Boolean...）支持得很好，但如果我们想保存一个自定义的 <code>City</code> 对象呢？默认情况下，<code>rememberSaveable</code> 是做不到的，因为它不知道如何将一个 <code>City</code> 对象存入 <code>Bundle</code>。</p>
<p>我们有以下三种主流方案来解决这个问题。</p>
<h4 data-id="heading-5">方案一：<code>@Parcelize</code> - 自动化实现 (最推荐)</h4>
<p>如果我们可以修改这个类的源码，这是最简单、最优雅的方式。通过添加 <code>kotlin-parcelize</code> 插件并为数据类添加 <code>@Parcelize</code> 注解，编译器会自动为我们实现 <code>Parcelable</code> 接口。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 在 build.gradle 中启用插件</span>
plugins {
    id <span class="hljs-string">'kotlin-parcelize'</span>
}

<span class="hljs-comment">// 2. 为数据类添加注解并实现 Parcelable 接口</span>
<span class="hljs-meta">@Parcelize</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">City</span>(<span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> country: String) : Parcelable

<span class="hljs-comment">// 3. 直接在 rememberSaveable 中使用</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">CityScreen</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> selectedCity = rememberSaveable {
        mutableStateOf(City(<span class="hljs-string">"Madrid"</span>, <span class="hljs-string">"Spain"</span>))
    }
}
</code></pre>
<p><code>rememberSaveable</code> 会自动检测到 <code>City</code> 是 <code>Parcelable</code> 的，并知道如何处理它。</p>
<h4 data-id="heading-6">方案二：自定义 <code>Saver</code> - 当你无法修改源码时</h4>
<p>当我们无法修改类的定义时（例如，它来自第三方库），我们可以提供一个自定义的 <code>Saver</code> 对象，明确告诉 <code>rememberSaveable</code> 如何“保存”和“恢复”这个对象。</p>
<h5 data-id="heading-7"><strong><code>MapSaver</code> - 健壮且可读的选择</strong></h5>
<p><code>MapSaver</code> 将对象转换为一个 <code>Map&lt;String, Any&gt;</code>。因为值是通过键来存取的，所以它不依赖于顺序，非常健壮。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> CitySaver = mapSaver(
    save = { city -&gt;
        <span class="hljs-comment">// 保存：将 City 对象拆解成一个 Map</span>
        mapOf(<span class="hljs-string">"Name"</span> to city.name, <span class="hljs-string">"Country"</span> to city.country)
    },
    restore = { map -&gt;
        <span class="hljs-comment">// 恢复：从 Map 中读取值，重新构建 City 对象</span>
        City(map[<span class="hljs-string">"Name"</span>] <span class="hljs-keyword">as</span> String, map[<span class="hljs-string">"Country"</span>] <span class="hljs-keyword">as</span> String)
    }
)

<span class="hljs-comment">// 使用时，将自定义的 Saver 传递给 stateSaver 参数</span>
<span class="hljs-keyword">var</span> selectedCity = rememberSaveable(stateSaver = CitySaver) {
    mutableStateOf(City(<span class="hljs-string">"Madrid"</span>, <span class="hljs-string">"Spain"</span>))
}
</code></pre>
<h5 data-id="heading-8"><strong><code>ListSaver</code> - 简洁但需谨慎的选择</strong></h5>
<p><code>ListSaver</code> 将对象转换为一个 <code>List&lt;Any&gt;</code>。它通过索引来存取，代码更简洁，但也更“脆弱”。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> CitySaver = listSaver&lt;City, Any&gt;(
    save = {
        <span class="hljs-comment">// 保存：将属性按固定顺序放入列表</span>
        listOf(it.name, it.country)
    },
    restore = {
        <span class="hljs-comment">// 恢复：按相同顺序从列表中通过索引取值</span>
        City(it[<span class="hljs-number">0</span>] <span class="hljs-keyword">as</span> String, it[<span class="hljs-number">1</span>] <span class="hljs-keyword">as</span> String)
    }
)

<span class="hljs-comment">// 使用方法与 MapSaver 相同</span>
<span class="hljs-keyword">var</span> selectedCity = rememberSaveable(stateSaver = CitySaver) {
    mutableStateOf(City(<span class="hljs-string">"Madrid"</span>, <span class="hljs-string">"Spain"</span>))
}
</code></pre>






























<table><thead><tr><th align="left">特性</th><th align="left">MapSaver</th><th align="left">ListSaver</th></tr></thead><tbody><tr><td align="left"><strong>工作方式</strong></td><td align="left">键值对 (Key-Value)</td><td align="left">有序列表 (Index-based)</td></tr><tr><td align="left"><strong>健壮性</strong></td><td align="left"><strong>高</strong>，不依赖属性顺序</td><td align="left"><strong>低</strong>，顺序改变会导致错误</td></tr><tr><td align="left"><strong>代码量</strong></td><td align="left">略多</td><td align="left">非常简洁</td></tr><tr><td align="left"><strong>推荐场景</strong></td><td align="left">大多数自定义对象</td><td align="left">属性极少且顺序非常稳定的对象</td></tr></tbody></table>
<h3 data-id="heading-9">Part 4: 精准控制：当状态需要“重置”时</h3>
<p><code>remember</code> 和 <code>rememberSaveable</code> 都会一直持有缓存的值，直到它们离开组合树。但有时我们希望在<strong>输入参数变化时，主动重置或重新计算这个状态</strong>。这就是 <code>key</code> 和 <code>inputs</code> 参数的用武之地。</p>
<h4 data-id="heading-10"><code>remember</code> 与 <code>key</code></h4>
<p>当 <code>remember</code> 的 <code>key</code> 发生变化时，它会废弃旧的缓存，并重新执行其 lambda 计算块。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// avatarRes 是一个外部传入的图片资源 ID</span>
<span class="hljs-keyword">val</span> brush = remember(key1 = avatarRes) {
    <span class="hljs-comment">// 当 avatarRes 改变时，这段代码会重新执行，</span>
    <span class="hljs-comment">// 创建一个新的、包含新头像的 ShaderBrush</span>
    ShaderBrush(...)
}
</code></pre>
<h4 data-id="heading-11"><code>rememberSaveable</code> 与 <code>inputs</code></h4>
<p><code>rememberSaveable</code> 有着同样的能力，参数名为 <code>inputs</code>。当 <code>inputs</code> 变化时，<code>rememberSaveable</code> 会丢弃已保存的状态，并重新执行初始化。</p>
<p>这在“基于外部数据初始化，但允许用户本地修改”的场景下非常有用。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// typedQuery 是外部传入的搜索词</span>
<span class="hljs-keyword">var</span> userTypedQuery <span class="hljs-keyword">by</span> rememberSaveable(inputs = typedQuery, stateSaver = TextFieldValue.Saver) {
    <span class="hljs-comment">// 当外部的 typedQuery 改变时，文本框的内容会被重置为这个新值</span>
    mutableStateOf(
        TextFieldValue(text = typedQuery, selection = TextRange(typedQuery.length))
    )
}
</code></pre>
<h3 data-id="heading-12">Part 5: 架构与最佳实践 - 状态应该放在哪里？</h3>
<p>我们已经掌握了管理状态的工具，但更重要的问题是：状态应该放在哪里？</p>
<h4 data-id="heading-13">状态提升 (State Hoisting)</h4>
<p>这是一个核心原则：将状态从子 Composable 中“提升”到它们的共同父 Composable 中。这样做的好处是：</p>
<ul>
<li><strong>单一数据源</strong>：状态由一个地方统一管理。</li>
<li><strong>可复用性</strong>：子 Composable 变为<strong>无状态 (Stateless)</strong> 的，它们只负责接收数据并显示，不关心数据从何而来，因此可以在任何地方复用。</li>
<li><strong>可测试性</strong>：无状态的 Composable 更容易进行单元测试。</li>
</ul>
<h4 data-id="heading-14">ViewModel - 屏幕级别状态的最终归宿</h4>
<p>对于屏幕级别的状态（那些与业务逻辑紧密相关的状态），最佳实践是将其放在 <code>ViewModel</code> 中。</p>
<ul>
<li><code>ViewModel</code> 天然具备<strong>生命周期感知</strong>能力，它能在配置变更后存活，完美解决了状态持久化的问题。</li>
<li>它将业务逻辑与 UI 逻辑分离，使代码结构更清晰。</li>
<li>UI (Composable) 通过 <code>StateFlow</code> 或其他可观察类型来订阅 <code>ViewModel</code> 中的状态，并对其做出反应。</li>
</ul>
<h3 data-id="heading-15">结论</h3>
<p>掌握状态管理是精通 Jetpack Compose 的关键。让我们快速回顾一下核心工具和使用场景：</p>
<ul>
<li><strong><code>remember</code></strong>: 用于处理<strong>仅与 UI 相关</strong>、<strong>临时性</strong>的状态，以及<strong>缓存昂贵的计算</strong>。</li>
<li><strong><code>rememberSaveable</code></strong>: 用于需要<strong>跨越配置变更和进程终止</strong>来持久化的状态，如用户输入。</li>
<li><strong><code>@Parcelize</code>, <code>MapSaver</code>, <code>ListSaver</code></strong>: 用于让 <code>rememberSaveable</code> 支持你的<strong>自定义数据类型</strong>。</li>
<li><strong><code>key</code>/<code>inputs</code></strong>: 用于在<strong>外部依赖变化时，精准地重置或重新计算</strong>被记住的状态。</li>
<li><strong>状态提升 &amp; <code>ViewModel</code></strong>: 遵循这些架构原则，构建<strong>可维护、可测试、结构清晰</strong>的 Compose 应用。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GitHub 上的 3 个 AI 信息差利器，太绝了啊。]]></title>    <link>https://juejin.cn/post/7571021605318541364</link>    <guid>https://juejin.cn/post/7571021605318541364</guid>    <pubDate>2025-11-11T05:55:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571021605318541364" data-draft-id="7571068689765482536" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GitHub 上的 3 个 AI 信息差利器，太绝了啊。"/> <meta itemprop="keywords" content="GitHub,Git"/> <meta itemprop="datePublished" content="2025-11-11T05:55:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="逛逛GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GitHub 上的 3 个 AI 信息差利器，太绝了啊。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    逛逛GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T05:55:15.000Z" title="Tue Nov 11 2025 05:55:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>相信大家也和我一样，对优质的信息源极度关注。</p>
<p>我一般在 X、小宇宙播客、即刻等平台获取最优质的信息。但是信息一般会散落在各个平台，如果能聚合推送给我就好了。</p>
<p>哪怕是一些总结摘要，我也能快速知道自己关注的博主更新了啥，感兴趣就去详细了解一下。</p>
<p>其实 GitHub 上就有一些借助 AI 把优质信息聚合的开源利器，分享给大家。</p>
<p>希望对你有用。</p>
<h2 data-id="heading-0">01、AI 内容聚合平台</h2>
<p>BestBlogs 就可以把 X、小宇宙播客、优质推文、博客、视频啥的推给你，在一个平台看最近的 AI 科技大事儿。它利用 AI 大语言模型对文章进行摘要、评分和翻译，帮助用户高效筛选高价值内容。</p>
<p>基于这个开源项目构建的网站内容，来源于以下 400 多个 RSS 订阅源。</p>
<p>包含文章类、播客类、视频类、Twitter 类：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2c956c7fee54fa5a0f0a857ea70e991~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=vNiaTqsUk7NTR3ws7NofVMmxGSw%3D" alt="图片" loading="lazy"/></p>
<p>优质文章</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef1f518a86d94c03818e1812808eb546~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=mGoRxikvtxmqIHci5n60nd0lTJA%3D" alt="图片" loading="lazy"/></p>
<p>播客很棒，屠龙之术、张小珺、晚点、42 章经这些 AI 方向很优质的博客都有。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1804a523f4947f1b038a91bc443dd29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=uGtdLbbVnu9TdCvrmHOPhRkgTGk%3D" alt="图片" loading="lazy"/></p>
<p>点开播客栏目就能直接播放。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc9f60ffaa664cf290cec48d15638508~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=1vE0eRtsxmDkaj243yUNn5TR6aQ%3D" alt="图片" loading="lazy"/></p>
<p>而且 AI 还会帮你做摘要。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/900a1b5ca68946d69977b53a4e4e5b55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=m9C8B9hG9O9w5jrxcyp7nK2fYHs%3D" alt="图片" loading="lazy"/></p>
<p>只能对播客进行转录，还能区分发言人。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bedfbf91ca164fa09c985bdf97cc96e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=9e1ciauQ1ovS4mTaOw%2F4mW1KL0M%3D" alt="图片" loading="lazy"/></p>
<p>精选视频</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7a74c6d5ed34d9599d24d7bc3d4895f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=OcJfzcrbkFhj7S2gzanavCoCiIc%3D" alt="图片" loading="lazy"/></p>
<p>热门推文</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54d6afbd8aac42b28163ecfb41b7e07f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=e71C2Sy6a7wRmV6n9w0659xQmaI%3D" alt="图片" loading="lazy"/></p>
<p>从实现原理来看，BestBlogs 的工作流程非常细致：首先通过 RSS 协议爬取订阅源的文章信息，并使用无头浏览器提取完整内容。然后通过初步评分过滤低质量内容，接着利用大语言模型进行深度分析，生成一句话总结、详细摘要、主要观点、标签分类和质量评分。最后支持多语言翻译优化，确保内容可读性。</p>
<p>同时，项目集成了 Dify Workflow 等工具，使得智能分析流程可定制化。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/ginobefun/BestBlogs</span>
</code></pre>
<h2 data-id="heading-1">02、监控热点神器</h2>
<p>这个叫 TrendRadar 的开源项目可以一键监控今日头条、百度热搜、微博、抖音、知乎、B站等 35 个平台，把分散在各个平台的热搜合并起来。</p>
<p>按照你关心的热度重新排序，不再被各个平台的算法牵着走。它最大的特点是，小白也能部署成功。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa82c0c80712424e8e37863d583ef217~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=E1rbUnoOxVeYBqzeQaq5GJZoLLE%3D" alt="图片" loading="lazy"/></p>
<p>支持智能关键词筛选，比如设置个人关键词，比如：AI、开源，只推送相关热点，过滤无关信息，自动生成热点分析报告。</p>
<p>而且还能企业微信、飞书、钉钉推送，30 秒网页部署，1 分钟手机通知，无需编程基础。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06c1332560e1498c9fad4acc749130b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=dhVpElKR59rW5emHg6ySN5GNdoE%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4516c91f69354ef19e054b8de36f3146~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=MVfqFBg8qSF2C3thfessoGdFE5w%3D" alt="图片" loading="lazy"/></p>
<p>更值得一提的是它的 AI 分析功能，基于 MCP 协议实现了 13 种智能分析工具。你可以直接用自然语言提问，比如查询昨天知乎的热点或分析比特币最近的热度趋势，系统就会给出相应的分析结果。</p>
<p>如何部署</p>
<p>很简单，直接 Fork 这个开源项目到你的 GitHub 账户。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/sansan0/TrendRadar</span>
</code></pre>
<p>在你 Fork 后的仓库中，进入 <code>Settings</code> &gt; <code>Secrets and variables</code> &gt; <code>Actions</code> &gt; <code>New repository secret。</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72a6f6b5dc6b4716bdd9407853f6453f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=UdvqDW7yVfzSx6UKXf1vqXzftOw%3D" alt="图片" loading="lazy"/></p>
<p>然后配置一下你想在哪个平台收热点新闻通知，比如企业微信、飞书、钉钉啥的。可以同时配置多个平台，系统会向所有配置的平台发送通知。</p>
<p>拿企业微信机器人举例子，你可以在 <code>repository</code> secret 配置：</p>
<ul>
<li>名称：WEWORK_WEBHOOK_URL</li>
<li>值：你的企业微信机器人 Webhook 地址</li>
</ul>
<p>如何获取企业微信机器人的 Webhook 地址，你可以搜一下很简单的。效果类似下图，一个 name 对应一个 <code>repository</code> secret，保存完就行。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8eb30e5ae3b403b8548ca46155b101f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=Y5Mt2JDFcFlrz0VnBSH5LllgH7c%3D" alt="图片" loading="lazy"/></p>
<p>然后在 config/config.yaml 中配置推送模式和通知选项，frequency_words.txt 中添加你关心的关键词。</p>
<p>crawler.yml 中设置<strong>推送频率，</strong> 请谨慎调整，别贪心。</p>
<p><strong>手动测试新闻推送，</strong> 进入你 Fork 的开源项目 Actions，找到 "Hot News Crawler" 的点进去</p>
<p>点击 "Run workflow" 按钮运行，等待 1 分钟左右数据到你企业微信上了。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/sansan0/TrendRadar</span>
</code></pre>
<h2 data-id="heading-2">03、AI 资讯日报</h2>
<p>CloudFlare-AI-Insight-Daily 是一个基于 Cloudflare Workers 的内容聚合与生成平台。</p>
<p>它专门针对 AI 领域，每日自动抓取行业新闻、热门开源项目、前沿学术论文以及科技领袖的社交媒体内容。</p>
<p>我经常看这个，最近什么模型发布了、什么新产品，大 V 们说了什么有意思的事情，这个开源项目都能聚合爬取。如果使用 Folo 工具，也应该看到这个 AI Daily 的订阅源。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b83243c64a2c44c78656b2302a4dbaea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=Obs%2F6H8C6fbMzf%2FUcPKxD9P4CSc%3D" alt="图片" loading="lazy"/></p>
<p>项目目前已经形成了完整的内容产出生态，除了生成网页版日报外，还能自动生成播客脚本，支持 RSS 订阅，甚至可以通过微信公众号每日推送，满足不同用户的内容消费习惯。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/justlovemaki/CloudFlare-AI-Insight-Daily</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java中的“万物皆对象”：一场编程界的哲学革命]]></title>    <link>https://juejin.cn/post/7571088527677472794</link>    <guid>https://juejin.cn/post/7571088527677472794</guid>    <pubDate>2025-11-11T06:20:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571088527677472794" data-draft-id="7571086754880077870" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java中的“万物皆对象”：一场编程界的哲学革命"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-11-11T06:20:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="会编程的吕洞宾"/> <meta itemprop="url" content="https://juejin.cn/user/2506542242333832"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java中的“万物皆对象”：一场编程界的哲学革命
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2506542242333832/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    会编程的吕洞宾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:20:58.000Z" title="Tue Nov 11 2025 06:20:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Java中的“万物皆对象”：一场编程界的哲学革命</h2>
<blockquote>
<p>作者：会编程的吕洞宾</p>
<p>温馨提示：阅读本文前请确保您已服用"面向对象"牌仙丹，否则可能无法理解本文的玄妙之处</p>
</blockquote>
<h3 data-id="heading-1">什么是"万物皆对象"？</h3>
<p>想象一下，你走进一家神奇的超市，这里的<strong>一切</strong>都是商品对象：</p>
<ul>
<li>苹果是一个<code>Apple</code>对象</li>
<li>购物车是一个<code>ShoppingCart</code>对象</li>
<li>甚至收银员也是一个<code>Cashier</code>对象</li>
</ul>
<p>这就是Java世界的核心思想——<strong>万物皆对象</strong>！在Java的宇宙里，所有东西都是某种类的实例，就像现实世界中所有东西都属于某个类别一样。</p>
<h3 data-id="heading-2">对象的三要素：状态、行为、身份</h3>
<p>每个Java对象都像一个小人儿，有三个基本特征：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-comment">// 状态（内部数据）</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">"吕洞宾"</span>;
    <span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;  <span class="hljs-comment">// 修仙之人，年龄不是问题</span>
    
    <span class="hljs-comment">// 行为（方法）</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"御剑飞行中..."</span>);
    }
    
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">drink</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"品尝仙酒..."</span>);
    }
}
</code></pre>
<h3 data-id="heading-3">对象是如何"活"起来的？</h3>
<h4 data-id="heading-4">创建对象：new关键字的神奇魔法</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 就像变魔术一样，new一下对象就诞生了！</span>
<span class="hljs-type">Person</span> <span class="hljs-variable">ludongbin</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();
</code></pre>
<h4 data-id="heading-5">对象通信：消息传递</h4>
<p>对象之间通过"发送消息"（调用方法）来交流：</p>
<pre><code class="hljs language-java" lang="java">ludongbin.fly();      <span class="hljs-comment">// 发送"飞行"消息</span>
ludongbin.drink();    <span class="hljs-comment">// 发送"喝酒"消息</span>
</code></pre>
<h3 data-id="heading-6">为什么说"几乎"万物皆对象？</h3>
<p>聪明的你可能要问了："基本类型（int, double等）也是对象吗？"</p>
<p>问得好！这里有个小例外：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">42</span>;          <span class="hljs-comment">// 这是基本类型，不是对象</span>
<span class="hljs-type">Integer</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(<span class="hljs-number">42</span>);  <span class="hljs-comment">// 这才是对象！</span>
</code></pre>
<p>不过Java提供了"自动装箱"的魔法，让基本类型和包装类对象可以自由转换：</p>
<pre><code class="hljs language-java" lang="java">List&lt;Integer&gt; numbers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
numbers.add(<span class="hljs-number">42</span>);  <span class="hljs-comment">// 自动把int变成Integer对象</span>
</code></pre>
<h3 data-id="heading-7">对象的生命周期：从诞生到仙逝</h3>
<h4 data-id="heading-8">诞生时刻（构造器）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Immortal</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Immortal</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"新的仙人诞生了！"</span>);
    }
}
</code></pre>
<h4 data-id="heading-9">活跃时期（方法调用）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Immortal</span> <span class="hljs-variable">immortal</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Immortal</span>();
immortal.practice();  <span class="hljs-comment">// 修炼功法</span>
</code></pre>
<h4 data-id="heading-10">仙逝时刻（垃圾回收）</h4>
<pre><code class="hljs language-java" lang="java">immortal = <span class="hljs-literal">null</span>;  <span class="hljs-comment">// 解除引用</span>
<span class="hljs-comment">// 垃圾回收器会在合适的时候来"超度"这个对象</span>
</code></pre>
<h3 data-id="heading-11">实战演练：创建一个"修仙系统"</h3>
<p>让我们用"万物皆对象"的思想构建一个简单的修仙世界：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 法宝类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MagicTreasure</span> {
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> power;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">use</span><span class="hljs-params">()</span> {
        System.out.println(name + <span class="hljs-string">"发挥威力，造成"</span> + power + <span class="hljs-string">"点伤害！"</span>);
    }
}

<span class="hljs-comment">// 修仙者类  </span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Cultivator</span> {
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> level;
    <span class="hljs-keyword">private</span> MagicTreasure treasure;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cultivate</span><span class="hljs-params">()</span> {
        level++;
        System.out.println(name + <span class="hljs-string">"修炼突破，达到"</span> + level + <span class="hljs-string">"层境界！"</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fight</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (treasure != <span class="hljs-literal">null</span>) {
            treasure.use();
        }
    }
}

<span class="hljs-comment">// 使用我们的修仙系统</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImmortalWorld</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Cultivator</span> <span class="hljs-variable">hero</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cultivator</span>();
        <span class="hljs-type">MagicTreasure</span> <span class="hljs-variable">sword</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MagicTreasure</span>();
        
        hero.cultivate();  <span class="hljs-comment">// 修炼升级</span>
        hero.fight();      <span class="hljs-comment">// 使用法宝战斗</span>
    }
}
</code></pre>
<h3 data-id="heading-12">总结：对象思维的妙处</h3>
<p>"万物皆对象"不仅仅是技术概念，更是一种<strong>思维方式</strong>：</p>
<ol>
<li><strong>模块化</strong>：把复杂系统拆分成独立的对象</li>
<li><strong>复用性</strong>：创建一次，多次使用</li>
<li><strong>灵活性</strong>：容易修改和扩展</li>
<li><strong>现实映射</strong>：代码结构更贴近真实世界</li>
</ol>
<p>记住吕洞宾的修仙心得：<strong>"编程如修仙，对象即万物。心中有对象，代码自然成！"</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java封装：修仙界的"护体罡气"]]></title>    <link>https://juejin.cn/post/7571028035018801178</link>    <guid>https://juejin.cn/post/7571028035018801178</guid>    <pubDate>2025-11-11T06:22:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571028035018801178" data-draft-id="7571051830710108210" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java封装：修仙界的&quot;护体罡气&quot;"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-11-11T06:22:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="会编程的吕洞宾"/> <meta itemprop="url" content="https://juejin.cn/user/2506542242333832"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java封装：修仙界的"护体罡气"
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2506542242333832/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    会编程的吕洞宾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:22:06.000Z" title="Tue Nov 11 2025 06:22:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Java封装：修仙界的"护体罡气"</h2>
<blockquote>
<p>作者：会编程的吕洞宾</p>
<p>温馨提示：封装就像给法宝加上保护罩，既保护内部结构，又提供安全的使用方式！</p>
</blockquote>
<h3 data-id="heading-1">什么是封装？编程中的"护体神功"</h3>
<p>想象一下，你炼制了一件绝世法宝"诛仙剑"。你肯定不会把它的内部构造直接暴露给别人，而是提供一个"剑诀"接口，让使用者通过特定方式来操控。</p>
<p>这就是封装：<strong>隐藏对象的内部实现细节，只提供公共的访问方式</strong>。就像给法宝加上保护罩，既安全又易用。</p>
<h3 data-id="heading-2">封装的四大访问权限：修仙界的"门规等级"</h3>
<p>Java提供了四种访问权限，就像修仙门派的不同权限等级：</p>
<h4 data-id="heading-3">1. public：门派广场 - 完全公开</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ImmortalSect</span> {
    <span class="hljs-keyword">public</span> String sectName = <span class="hljs-string">"蜀山派"</span>;  <span class="hljs-comment">// 所有人都能看到</span>
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">welcomeDisciple</span>()</span> {   <span class="hljs-comment">// 所有人都能调用</span>
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"欢迎加入"</span> + sectName);
    }
}
</code></pre>
<h4 data-id="heading-4">2. protected：内门弟子 - 包内和子类可见</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CultivationMethod</span> {
    <span class="hljs-keyword">protected</span> String secretFormula;  <span class="hljs-comment">// 只有本包和子类能看到</span>
    
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">internalMeditation</span>()</span> {  <span class="hljs-comment">// 内部修炼方法</span>
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"内门心法修炼中..."</span>);
    }
}
</code></pre>
<h4 data-id="heading-5">3. 默认（包访问）：本门弟子 - 同包可见</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">InternalAffairs</span> {  <span class="hljs-comment">// 默认权限，同包可见</span>
    String internalRule = <span class="hljs-string">"门规第十条"</span>;  <span class="hljs-comment">// 同包可见</span>
    
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">manageDisciples</span>()</span> {  <span class="hljs-comment">// 内部管理方法</span>
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"管理弟子事务"</span>);
    }
}
</code></pre>
<h4 data-id="heading-6">4. private：密室传承 - 仅本类可见</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SupremeSword</span> {
    <span class="hljs-keyword">private</span> String forgingSecret = <span class="hljs-string">"玄铁百炼之法"</span>;  <span class="hljs-comment">// 只有本类能看到</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> spiritualPower = <span class="hljs-number">1000</span>;              <span class="hljs-comment">// 灵力值，内部使用</span>
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">secretForgingTechnique</span>()</span> {  <span class="hljs-comment">// 秘传锻造术</span>
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"施展"</span> + forgingSecret);
    }
    
    <span class="hljs-comment">// 提供公共接口来使用私有功能</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">activateSword</span>()</span> {
        <span class="hljs-keyword">if</span> (spiritualPower &gt; <span class="hljs-number">0</span>) {
            secretForgingTechnique();
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"飞剑激活，灵力："</span> + spiritualPower);
        }
    }
}
</code></pre>
<h3 data-id="heading-7">封装的实战：炼制"智能法宝"</h3>
<p>让我们炼制一个封装良好的法宝类：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 一个封装良好的法宝类</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MagicTreasure</span> {
    <span class="hljs-comment">// 私有属性：内部状态，外部不能直接访问</span>
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> powerLevel;
    <span class="hljs-keyword">private</span> boolean isActivated;
    <span class="hljs-keyword">private</span> String owner;
    
    <span class="hljs-comment">// 构造方法：初始化内部状态</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MagicTreasure</span>(<span class="hljs-params">String name, <span class="hljs-built_in">int</span> powerLevel, String owner</span>)</span> {
        <span class="hljs-keyword">this</span>.name = name;
        setPowerLevel(powerLevel);  <span class="hljs-comment">// 通过setter设置，进行验证</span>
        <span class="hljs-keyword">this</span>.owner = owner;
        <span class="hljs-keyword">this</span>.isActivated = <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">// 公共getter方法：提供受控的读取访问</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span>()</span> {
        <span class="hljs-keyword">return</span> name;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">getPowerLevel</span>()</span> {
        <span class="hljs-keyword">return</span> powerLevel;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getOwner</span>()</span> {
        <span class="hljs-keyword">return</span> owner;
    }
    
    <span class="hljs-comment">// 公共setter方法：提供受控的写入访问</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPowerLevel</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> powerLevel</span>)</span> {
        <span class="hljs-keyword">if</span> (powerLevel &gt;= <span class="hljs-number">0</span> &amp;&amp; powerLevel &lt;= <span class="hljs-number">1000</span>) {
            <span class="hljs-keyword">this</span>.powerLevel = powerLevel;
        } <span class="hljs-keyword">else</span> {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"灵力值必须在0-1000之间"</span>);
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">changeOwner</span>(<span class="hljs-params">String newOwner</span>)</span> {
        <span class="hljs-keyword">if</span> (newOwner != <span class="hljs-literal">null</span> &amp;&amp; !newOwner.trim().isEmpty()) {
            <span class="hljs-keyword">this</span>.owner = newOwner;
            System.<span class="hljs-keyword">out</span>.println(name + <span class="hljs-string">"的新主人："</span> + newOwner);
        }
    }
    
    <span class="hljs-comment">// 公共业务方法：封装复杂操作</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">activate</span>()</span> {
        <span class="hljs-keyword">if</span> (powerLevel &gt; <span class="hljs-number">0</span>) {
            isActivated = <span class="hljs-literal">true</span>;
            System.<span class="hljs-keyword">out</span>.println(name + <span class="hljs-string">"已激活！当前灵力："</span> + powerLevel);
        } <span class="hljs-keyword">else</span> {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"灵力不足，无法激活法宝"</span>);
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deactivate</span>()</span> {
        isActivated = <span class="hljs-literal">false</span>;
        System.<span class="hljs-keyword">out</span>.println(name + <span class="hljs-string">"已休眠"</span>);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">use</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> consumedPower</span>)</span> {
        <span class="hljs-keyword">if</span> (!isActivated) {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"请先激活法宝"</span>);
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-keyword">if</span> (consumedPower &lt;= powerLevel) {
            powerLevel -= consumedPower;
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"使用"</span> + name + <span class="hljs-string">"，消耗灵力"</span> + consumedPower);
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"剩余灵力："</span> + powerLevel);
        } <span class="hljs-keyword">else</span> {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"灵力不足！需要："</span> + consumedPower + <span class="hljs-string">"，当前："</span> + powerLevel);
        }
    }
    
    <span class="hljs-comment">// 私有辅助方法：内部实现细节</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">internalEnergyFlow</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"内部灵力运转中..."</span>);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> boolean <span class="hljs-title">checkSpiritualStability</span>()</span> {
        <span class="hljs-keyword">return</span> powerLevel &gt; <span class="hljs-number">100</span>;
    }
}
</code></pre>
<h3 data-id="heading-8">封装的好处：为什么需要"护体罡气"</h3>
<h4 data-id="heading-9">1. 数据保护：防止"走火入魔"</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 没有封装 - 危险！</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DangerousTreasure</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> powerLevel = <span class="hljs-number">100</span>;  <span class="hljs-comment">// 直接暴露，可能被设为负值</span>
}

<span class="hljs-comment">// 使用封装 - 安全！</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeTreasure</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> powerLevel = <span class="hljs-number">100</span>;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">setPowerLevel</span><span class="hljs-params">(<span class="hljs-type">int</span> value)</span> </span>{
        <span class="hljs-keyword">if</span> (value &gt;= <span class="hljs-number">0</span>) {  <span class="hljs-comment">// 数据验证</span>
            <span class="hljs-keyword">this</span>.powerLevel = value;
        }
    }
}
</code></pre>
<h4 data-id="heading-10">2. 实现隐藏：保留"改进空间"</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SmartPillFurnace</span> {
    <span class="hljs-comment">// 旧版本使用数组存储</span>
    <span class="hljs-comment">// private String[] ingredients = new String[10];</span>
    
    <span class="hljs-comment">// 新版本改用List，但接口不变！</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; ingredients = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    
    <span class="hljs-comment">// 公共接口保持不变，内部实现可以优化</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">addIngredient</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> ingredient</span>) {
        ingredients.<span class="hljs-title function_">add</span>(ingredient);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">makePill</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 内部实现可以完全重写，不影响使用者</span>
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"炼制仙丹，材料数量："</span> + ingredients.<span class="hljs-title function_">size</span>());
    }
}
</code></pre>
<h4 data-id="heading-11">3. 模块化：便于"分工合作"</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 法宝模块 - 吕洞宾负责</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MagicSword</span> {
    <span class="hljs-keyword">private</span> String bladeMaterial;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> sharpness;
    
    <span class="hljs-comment">// 只暴露必要的接口</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sharpen</span>()</span> { <span class="hljs-comment">/* 实现细节隐藏 */</span> }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">use</span>()</span> { <span class="hljs-comment">/* 使用接口 */</span> }
}

<span class="hljs-comment">// 剑诀模块 - 李白负责  </span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SwordTechnique</span> {
    <span class="hljs-keyword">private</span> MagicSword sword;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SwordTechnique</span>(<span class="hljs-params">MagicSword sword</span>)</span> {
        <span class="hljs-keyword">this</span>.sword = sword;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">performTechnique</span>()</span> {
        sword.use();  <span class="hljs-comment">// 只通过公共接口交互</span>
    }
}
</code></pre>
<h3 data-id="heading-12">封装的进阶技巧：修仙界的"高级心法"</h3>
<h4 data-id="heading-13">1. 包封装：门派的"护山大阵"</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 在com.immortal.sect.internal包中</span>
package com.immortal.sect.<span class="hljs-keyword">internal</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title">InternalCultivation</span> {  <span class="hljs-comment">// 包级私有，外部无法访问</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">secretMethod</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"门派秘传心法"</span>);
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PublicInterface</span> {
    <span class="hljs-keyword">private</span> InternalCultivation <span class="hljs-keyword">internal</span> = <span class="hljs-keyword">new</span> InternalCultivation();
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">publicMethod</span>()</span> {
        <span class="hljs-comment">// 内部实现隐藏，只暴露安全接口</span>
        <span class="hljs-keyword">internal</span>.secretMethod();
    }
}
</code></pre>
<h4 data-id="heading-14">2. 不变性封装：炼制"本命法宝"</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 不可变对象：一旦创建就不能修改</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImmortalPill</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> name;      <span class="hljs-comment">// final确保不可变</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> potency;      <span class="hljs-comment">// final确保不可变</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Date createDate;  <span class="hljs-comment">// 引用也要注意防御性拷贝</span>
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ImmortalPill</span><span class="hljs-params">(<span class="hljs-type">String</span> name, <span class="hljs-type">int</span> potency)</span> </span>{
        <span class="hljs-keyword">this</span>.name = name;
        <span class="hljs-keyword">this</span>.potency = potency;
        <span class="hljs-keyword">this</span>.createDate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();  <span class="hljs-comment">// 防御性拷贝</span>
    }
    
    <span class="hljs-comment">// 只有getter，没有setter</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> name; }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title">getPotency</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> potency; }
    <span class="hljs-function"><span class="hljs-keyword">public</span> Date <span class="hljs-title">getCreateDate</span><span class="hljs-params">()</span> </span>{ 
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(createDate.<span class="hljs-built_in">getTime</span>());  <span class="hljs-comment">// 返回拷贝，保护原始数据</span>
    }
}
</code></pre>
<h4 data-id="heading-15">3. Builder模式：复杂的"法宝炼制流程"</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 使用Builder模式封装复杂构造过程</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SupremeMagicItem</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> name;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> power;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> element;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> isBindable;
    
    <span class="hljs-comment">// 私有构造器，强制使用Builder</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">SupremeMagicItem</span><span class="hljs-params">(Builder builder)</span> </span>{
        <span class="hljs-keyword">this</span>.name = builder.name;
        <span class="hljs-keyword">this</span>.power = builder.power;
        <span class="hljs-keyword">this</span>.element = builder.element;
        <span class="hljs-keyword">this</span>.isBindable = builder.isBindable;
    }
    
    <span class="hljs-comment">// Builder内部类</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Builder</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> name;
        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> power;
        <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> element = <span class="hljs-string">"无"</span>;
        <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> isBindable = <span class="hljs-literal">false</span>;
        
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Builder</span><span class="hljs-params">(<span class="hljs-type">String</span> name, <span class="hljs-type">int</span> power)</span> </span>{
            <span class="hljs-keyword">this</span>.name = name;
            <span class="hljs-keyword">this</span>.power = power;
        }
        
        <span class="hljs-function"><span class="hljs-keyword">public</span> Builder <span class="hljs-title">element</span><span class="hljs-params">(<span class="hljs-type">String</span> element)</span> </span>{
            <span class="hljs-keyword">this</span>.element = element;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }
        
        <span class="hljs-function"><span class="hljs-keyword">public</span> Builder <span class="hljs-title">bindable</span><span class="hljs-params">(<span class="hljs-type">boolean</span> bindable)</span> </span>{
            <span class="hljs-keyword">this</span>.isBindable = bindable;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }
        
        <span class="hljs-function"><span class="hljs-keyword">public</span> SupremeMagicItem <span class="hljs-title">build</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">SupremeMagicItem</span>(<span class="hljs-keyword">this</span>);
        }
    }
    
    <span class="hljs-comment">// 使用示例</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>{
        SupremeMagicItem item = <span class="hljs-keyword">new</span> SupremeMagicItem.<span class="hljs-built_in">Builder</span>(<span class="hljs-string">"轩辕剑"</span>, <span class="hljs-number">999</span>)
            .<span class="hljs-built_in">element</span>(<span class="hljs-string">"金"</span>)
            .<span class="hljs-built_in">bindable</span>(<span class="hljs-literal">true</span>)
            .<span class="hljs-built_in">build</span>();
    }
}
</code></pre>
<h3 data-id="heading-16">实战：完整的封装修仙系统</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 完整的封装示例：修仙账户系统</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImmortalAccount</span> {
    <span class="hljs-comment">// 私有属性：核心数据</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> username;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> password;  <span class="hljs-comment">// 加密存储</span>
    <span class="hljs-keyword">private</span> int cultivationLevel;
    <span class="hljs-keyword">private</span> double spiritualEnergy;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; treasures;
    
    <span class="hljs-comment">// 构造方法封装初始化逻辑</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ImmortalAccount</span>(<span class="hljs-title class_">String</span> username, <span class="hljs-title class_">String</span> password) {
        <span class="hljs-title function_">setUsername</span>(username);
        <span class="hljs-title function_">setPassword</span>(password);  <span class="hljs-comment">// 密码加密</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cultivationLevel</span> = <span class="hljs-number">1</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">spiritualEnergy</span> = <span class="hljs-number">100.0</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">treasures</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    }
    
    <span class="hljs-comment">// 受控的setter方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setUsername</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> username</span>) {
        <span class="hljs-keyword">if</span> (username != <span class="hljs-literal">null</span> &amp;&amp; username.<span class="hljs-title function_">length</span>() &gt;= <span class="hljs-number">3</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">username</span> = username;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"用户名至少3个字符"</span>);
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setPassword</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> password</span>) {
        <span class="hljs-comment">// 密码加密逻辑</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">password</span> = <span class="hljs-title function_">encryptPassword</span>(password);
    }
    
    <span class="hljs-comment">// 业务方法封装复杂逻辑</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">login</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> inputPassword</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">encryptPassword</span>(inputPassword).<span class="hljs-title function_">equals</span>(password);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">cultivate</span>(<span class="hljs-params">int hours</span>) {
        <span class="hljs-keyword">if</span> (hours &gt; <span class="hljs-number">0</span>) {
            double energyGain = hours * <span class="hljs-number">10.0</span>;
            spiritualEnergy += energyGain;
            cultivationLevel += hours / <span class="hljs-number">100</span>;  <span class="hljs-comment">// 每修炼100小时升1级</span>
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"修炼"</span> + hours + <span class="hljs-string">"小时，获得灵力："</span> + energyGain);
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">addTreasure</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> treasure</span>) {
        <span class="hljs-keyword">if</span> (treasure != <span class="hljs-literal">null</span> &amp;&amp; !treasures.<span class="hljs-title function_">contains</span>(treasure)) {
            treasures.<span class="hljs-title function_">add</span>(treasure);
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"获得法宝："</span> + treasure);
        }
    }
    
    <span class="hljs-comment">// 私有辅助方法</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">encryptPassword</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> password</span>) {
        <span class="hljs-comment">// 简单的加密演示</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"encrypted_"</span> + password;
    }
    
    <span class="hljs-comment">// 只读的getter方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getUsername</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> username; }
    <span class="hljs-keyword">public</span> int <span class="hljs-title function_">getCultivationLevel</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> cultivationLevel; }
    <span class="hljs-keyword">public</span> double <span class="hljs-title function_">getSpiritualEnergy</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> spiritualEnergy; }
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">getTreasures</span>(<span class="hljs-params"/>) { 
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(treasures);  <span class="hljs-comment">// 返回拷贝，保护原始数据</span>
    }
}
</code></pre>
<h3 data-id="heading-17">吕洞宾的封装心法</h3>
<p>记住这几条修仙要诀：</p>
<ol>
<li><strong>"最小权限"</strong>：给每个成员最小必要的访问权限</li>
<li><strong>"数据隐藏"</strong>：私有属性，公共接口</li>
<li><strong>"防御性编程"</strong>：对外部输入保持警惕</li>
<li><strong>"接口稳定"</strong>：内部可以随便改，接口要保持稳定</li>
</ol>
<p>封装就像修仙者的"护体罡气"，保护内部脆弱的核心，同时提供强大的外部接口。掌握了封装，你的代码就能像修炼有成的仙人一样，外御强敌，内守本心！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从回调地狱到优雅异步：Promise 带你吃透 JS 异步编程核心]]></title>    <link>https://juejin.cn/post/7571086754880110638</link>    <guid>https://juejin.cn/post/7571086754880110638</guid>    <pubDate>2025-11-11T06:20:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571086754880110638" data-draft-id="7571086754880045102" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从回调地狱到优雅异步：Promise 带你吃透 JS 异步编程核心"/> <meta itemprop="keywords" content="Vue.js,Promise"/> <meta itemprop="datePublished" content="2025-11-11T06:20:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="生椰丝绒拿铁"/> <meta itemprop="url" content="https://juejin.cn/user/4185180725584116"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从回调地狱到优雅异步：Promise 带你吃透 JS 异步编程核心
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4185180725584116/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    生椰丝绒拿铁
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:20:53.000Z" title="Tue Nov 11 2025 06:20:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为前端开发者，你是否也曾被这样的场景折磨？想按顺序执行三个异步操作，最后写出层层嵌套的回调函数，代码像金字塔一样越堆越高，调试时找不着北。或者明明写了 <code>setTimeout</code> 想等上一步完成，结果代码却 “自作主张” 提前执行。</p>
<p>这一切的根源，都要从 JavaScript 的 “单线程” 特性说起。今天我们就从底层逻辑出发，用通俗的例子 + 实战代码，带你彻底搞懂 Promise—— 这个让异步代码变优雅的 “神器”。</p>
<h2 data-id="heading-0">先搞懂：JS 为什么需要异步？</h2>
<p>要理解 Promise，首先得明白 JS 的 “单线程困境”。</p>
<h3 data-id="heading-1">1. 单线程：JS 的 “天生设定”</h3>
<p>JavaScript 从诞生起就是单线程，意思是它只有一个 “代码执行线程”，同一时间只能做一件事。这个设定很合理：JS 主要负责操作 DOM，如果多线程同时修改 DOM，浏览器根本不知道该听谁的。</p>
<p>但问题也随之而来：如果遇到耗时操作（比如读取文件、网络请求、定时器），线程会被卡住。想象一下，点击按钮后发起网络请求，等待响应的 3 秒内页面完全无法交互，这体验简直灾难。</p>
<h3 data-id="heading-2">2. 同步 vs 异步：代码的 “两种执行姿势”</h3>
<p>为了解决这个问题，JS 设计了两种代码执行模式：</p>
<ul>
<li><strong>同步代码</strong>：按顺序从上到下执行，执行完一行再走下一行，比如 <code>console.log</code>、变量声明、for 循环，都是毫秒级完成的 “快任务”。</li>
<li><strong>异步代码</strong>：需要耗时的操作（比如网络请求、文件读取、<code>setTimeout</code>），JS 不会傻傻等待，而是先把它 “挂起来”，继续执行后面的同步代码，等耗时操作完成后再回头执行。</li>
</ul>
<h3 data-id="heading-3">3. 事件循环（Event Loop）：异步代码的 “调度中心”</h3>
<p>那被 “挂起来” 的异步代码怎么知道什么时候执行？答案是 <strong>事件循环</strong>。</p>
<p>简单说，JS 执行时会先处理同步代码，把异步任务放到 “任务队列” 里。等同步代码执行完，线程会不断循环检查任务队列，把里面完成的任务捞出来执行。这就是为什么 <code>setTimeout</code> 里的代码，永远会在所有同步代码之后执行。</p>
<p>看这个经典例子：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>);
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>);
}, <span class="hljs-number">3000</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>);
</code></pre>
<p>执行结果是 <code>1 → 3 → 2</code>，而不是 <code>1 → 2 → 3</code>。因为 <code>setTimeout</code> 是异步任务，被扔进了任务队列，要等同步代码 <code>console.log(1)</code> 和 <code>console.log(3)</code> 执行完，3 秒后才会被执行。</p>
<h2 data-id="heading-4">回调地狱：异步编程的 “史前困境”</h2>
<p>早期处理异步任务，全靠回调函数。比如要按顺序执行 “读取文件 A → 读取文件 B → 读取文件 C”，代码会变成这样：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript">fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">'./a.txt'</span>, <span class="hljs-function">(<span class="hljs-params">err, data1</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;
  fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">'./b.txt'</span>, <span class="hljs-function">(<span class="hljs-params">err, data2</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;
    fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">'./c.txt'</span>, <span class="hljs-function">(<span class="hljs-params">err, data3</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data1 + data2 + data3);
    });
  });
});
</code></pre>
<p>这种层层嵌套的代码被称为 “回调地狱”，问题很明显：</p>
<ul>
<li>代码可读性差，嵌套越多越像 “金字塔”，调试时要一层层找。</li>
<li>维护困难，修改内层逻辑可能影响外层，容易出错。</li>
<li>错误处理麻烦，每个回调都要写 <code>if (err)</code> 判断。</li>
</ul>
<p>这时候，Promise 应运而生，它的核心目标就是：<strong>让异步代码的执行顺序变得清晰，摆脱回调地狱</strong>。</p>
<h2 data-id="heading-5">Promise：异步编程的 “优雅解决方案”</h2>
<p>Promise 是 ES6 引入的异步编程工具类，本质是一个 “容器”，里面存放着一个未来才会完成的异步操作（比如网络请求、文件读取）。</p>
<h3 data-id="heading-6">1. Promise 的核心概念：三个状态</h3>
<p>一个 Promise 有三种状态，状态一旦改变就不可逆：</p>
<ul>
<li><strong>Pending（等待中）</strong> ：初始状态，异步任务还没完成。</li>
<li><strong>Fulfilled（已成功）</strong> ：异步任务执行完成，调用 <code>resolve()</code> 触发。</li>
<li><strong>Rejected（已失败）</strong> ：异步任务执行出错，调用 <code>reject()</code> 触发。</li>
</ul>
<h3 data-id="heading-7">2. 基本用法：把异步任务 “装进” Promise</h3>
<p>我们用 Promise 重构上面的文件读取例子：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>;

<span class="hljs-comment">// 创建 Promise 实例，传入执行器函数（立即执行）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">readFilePromise</span> = (<span class="hljs-params">filename</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    fs.<span class="hljs-title function_">readFile</span>(filename, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-title function_">reject</span>(err); <span class="hljs-comment">// 失败时调用 reject，传递错误信息</span>
        <span class="hljs-keyword">return</span>;
      }
      <span class="hljs-title function_">resolve</span>(data.<span class="hljs-title function_">toString</span>()); <span class="hljs-comment">// 成功时调用 resolve，传递结果</span>
    });
  });
};

<span class="hljs-comment">// 用 then 链式调用，按顺序执行</span>
<span class="hljs-title function_">readFilePromise</span>(<span class="hljs-string">'./a.txt'</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data1</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'a.txt 内容：'</span>, data1);
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">readFilePromise</span>(<span class="hljs-string">'./b.txt'</span>); <span class="hljs-comment">// 返回下一个 Promise</span>
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data2</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'b.txt 内容：'</span>, data2);
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">readFilePromise</span>(<span class="hljs-string">'./c.txt'</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data3</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'c.txt 内容：'</span>, data3);
  })
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'读取失败：'</span>, err); <span class="hljs-comment">// 所有错误统一处理</span>
  });
</code></pre>
<p>是不是瞬间清爽了？这里有两个关键改进：</p>
<ul>
<li>用 <code>then</code> 链式调用替代嵌套，代码从上到下执行，逻辑清晰。</li>
<li>用 <code>catch</code> 统一处理所有错误，不用每个回调都写错误判断。</li>
</ul>
<h3 data-id="heading-8">3. 实战拆解：Promise 如何改变执行顺序？</h3>
<p>再看一个浏览器端的例子，感受 Promise 如何让 “异步变同步”：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>);
<span class="hljs-comment">// 把定时器这个异步任务装进 Promise</span>
<span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>);
    <span class="hljs-title function_">resolve</span>(); <span class="hljs-comment">// 异步任务完成，调用 resolve 通知 then</span>
  }, <span class="hljs-number">3000</span>);
});

p.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>); <span class="hljs-comment">// 只有 resolve 被调用后，then 里的代码才执行</span>
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">4</span>);
</code></pre>
<p>执行结果是 <code>1 → 4 → 2 → 3</code>，这里的关键逻辑：</p>
<ol>
<li>同步代码 <code>console.log(1)</code> 先执行。</li>
<li>创建 Promise 时，执行器函数立即执行，里面的 <code>setTimeout</code> 被扔进任务队列。</li>
<li>同步代码 <code>console.log(4)</code> 执行。</li>
<li>3 秒后，<code>setTimeout</code> 执行 <code>console.log(2)</code>，然后调用 <code>resolve()</code>。</li>
<li>Promise 状态变为成功，触发 <code>then</code> 里的回调，执行 <code>console.log(3)</code>。</li>
</ol>
<p>通过 <code>resolve</code> 和 <code>then</code> 的配合，我们实现了 “等异步任务完成后再执行下一步” 的效果，这就是 Promise 让异步 “同步化” 的核心逻辑。</p>
<h3 data-id="heading-9">4. 真实场景：用 Promise 处理网络请求</h3>
<p>在实际开发中，网络请求是最常见的异步场景。比如用 <code>fetch</code> 获取 GitHub 组织成员列表：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">membersList</span> = document.getElementById(<span class="hljs-string">'memebers'</span>)<span class="hljs-comment">;</span>

// fetch 本身就返回一个 Promise
fetch('https://api.github.com/orgs/lemoncode/members')
  .then(<span class="hljs-attr">response</span> =&gt; response.json()) // 第一个 then 处理响应，返回新的 Promise
  .then(<span class="hljs-attr">members</span> =&gt; {
    // 第二个 then 处理数据，渲染到页面
    <span class="hljs-attr">membersList.innerHTML</span> = members.map(item =&gt; `&lt;li&gt;<span class="hljs-variable">${item.login}</span>&lt;/li&gt;`).join(<span class="hljs-string">''</span>)<span class="hljs-comment">;</span>
  })
  .catch(<span class="hljs-attr">err</span> =&gt; {
    console.log('请求失败：', err)<span class="hljs-comment">;</span>
    <span class="hljs-attr">membersList.innerHTML</span> = <span class="hljs-string">'&lt;li&gt;数据加载失败&lt;/li&gt;'</span><span class="hljs-comment">;</span>
  })<span class="hljs-comment">;</span>
</code></pre>
<p><code>fetch</code> 发起网络请求后，返回一个 Promise。当请求成功时，<code>then</code> 接收响应并转换为 JSON；当请求失败（比如网络错误、404），<code>catch</code> 会捕获错误并给出友好提示。</p>
<h2 data-id="heading-10">Promise 的进阶思考：为什么它能成为异步编程基石？</h2>
<p>Promise 之所以重要，不只是因为它解决了回调地狱，更因为它奠定了 JS 异步编程的基础范式。</p>
<h3 data-id="heading-11">1. 分离关注点：让代码职责更清晰</h3>
<p>Promise 把 “异步任务的执行” 和 “任务完成后的处理逻辑” 分离开来：</p>
<ul>
<li>执行器函数负责发起异步任务（比如读取文件、网络请求）。</li>
<li><code>then</code> 方法负责处理成功结果，<code>catch</code> 负责处理错误。这种分离让代码结构更清晰，可读性和可维护性大大提升。</li>
</ul>
<h3 data-id="heading-12">2. 链式调用：实现复杂异步流程</h3>
<p>Promise 的 <code>then</code> 方法会返回一个新的 Promise，这让链式调用成为可能。除了按顺序执行，还能实现更复杂的流程，比如：</p>
<ul>
<li>并行执行多个异步任务（用 <code>Promise.all</code>）。</li>
<li>只要有一个任务成功就执行（用 <code>Promise.race</code>）。</li>
<li>忽略失败任务，返回所有成功结果（用 <code>Promise.allSettled</code>）。</li>
</ul>
<h3 data-id="heading-13">3. 为 async/await 铺路</h3>
<p>ES7 引入的 <code>async/await</code> 语法，本质是 Promise 的语法糖。正是因为 Promise 规范了异步任务的状态和回调方式，<code>async/await</code> 才能实现 “用同步代码的写法写异步逻辑”。</p>
<p>比如用 <code>async/await</code> 重构网络请求代码：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-ini" lang="ini">async function getMembers() {
  try {
    const <span class="hljs-attr">response</span> = await fetch(<span class="hljs-string">'https://api.github.com/orgs/lemoncode/members'</span>)<span class="hljs-comment">;</span>
    const <span class="hljs-attr">members</span> = await response.json()<span class="hljs-comment">;</span>
    <span class="hljs-attr">membersList.innerHTML</span> = members.map(item =&gt; `&lt;li&gt;<span class="hljs-variable">${item.login}</span>&lt;/li&gt;`).join(<span class="hljs-string">''</span>)<span class="hljs-comment">;</span>
  } catch (err) {
    console.log('请求失败：', err)<span class="hljs-comment">;</span>
    <span class="hljs-attr">membersList.innerHTML</span> = <span class="hljs-string">'&lt;li&gt;数据加载失败&lt;/li&gt;'</span><span class="hljs-comment">;</span>
  }
}
</code></pre>
<p>如果没有 Promise 作为基础，<code>async/await</code> 就无从谈起。</p>
<h2 data-id="heading-14">常见误区：避开 Promise 的 “坑”</h2>
<p>学习 Promise 时，很容易陷入一些误区，这里总结几个高频坑：</p>
<ul>
<li><strong>误区 1</strong>：认为 <code>new Promise</code> 里的代码是异步的。其实执行器函数是立即同步执行的，里面的异步任务（比如 <code>setTimeout</code>）才是异步的。</li>
<li><strong>误区 2</strong>：忘记调用 <code>resolve</code> 或 <code>reject</code>，导致 <code>then</code> 或 <code>catch</code> 永远不执行。</li>
<li><strong>误区 3</strong>：链式调用时没有返回 Promise，导致后续 <code>then</code> 无法获取上一步的结果。</li>
<li><strong>误区 4</strong>：忽略错误处理，没有写 <code>catch</code>，导致异步任务失败时没有反馈。</li>
</ul>
<h2 data-id="heading-15">总结：Promise 带给我们的不止是优雅</h2>
<p>Promise 不仅仅是一个语法糖，它是 JS 异步编程的一次范式升级。它解决了回调地狱的痛点，让异步代码的逻辑更清晰、更易维护，同时为后续的 <code>async/await</code> 打下了基础。</p>
<p>理解 Promise 的核心，其实是理解 JS 单线程、事件循环的底层逻辑。掌握了这些，无论遇到多么复杂的异步场景，你都能游刃有余地处理。</p>
<p>如果你正在学习异步编程，建议多动手写实战代码：用 Promise 封装一个网络请求、用链式调用处理多个异步任务、尝试 <code>Promise.all</code> 等静态方法。只有实践，才能真正吃透这些概念。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[《效率翻倍！12个被90%前端忽视的CSS神技》]]></title>    <link>https://juejin.cn/post/7571176484514578447</link>    <guid>https://juejin.cn/post/7571176484514578447</guid>    <pubDate>2025-11-11T06:27:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571176484514578447" data-draft-id="7571021605318705204" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="《效率翻倍！12个被90%前端忽视的CSS神技》"/> <meta itemprop="keywords" content="CSS,前端,面试"/> <meta itemprop="datePublished" content="2025-11-11T06:27:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大知闲闲i"/> <meta itemprop="url" content="https://juejin.cn/user/3799545205237111"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            《效率翻倍！12个被90%前端忽视的CSS神技》
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3799545205237111/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大知闲闲i
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:27:03.000Z" title="Tue Nov 11 2025 06:27:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>告别重复劳动，让代码既优雅又高效</p>
</blockquote>
<p>在日常前端开发中，我们往往只使用了CSS的冰山一角。经过多个项目实践，我发现现代CSS隐藏着许多实用但被忽视的特性，掌握它们真的能让你少写50%的代码！</p>
<p>下面这12个神技，特别是第3个和第7个，彻底改变了我的开发方式。一起来看看：</p>
<h2 data-id="heading-0">1. accent-color - 表单主题色一键搞定</h2>
<p><strong>痛点</strong>：以前统一表单样式要写一堆选择器覆盖默认样式</p>
<p><strong>神技效果</strong>：一行代码统一所有表单控件主题色</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 传统写法 - 繁琐且兼容性差 */</span>
<span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type=<span class="hljs-string">"checkbox"</span>]</span>::-ms-check,
input[type=<span class="hljs-string">"radio"</span>]::-ms-check {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#4a90e2</span>;
}

<span class="hljs-comment">/* 现代写法 - 一行搞定 */</span>
<span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type=<span class="hljs-string">"checkbox"</span>]</span>,
<span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type=<span class="hljs-string">"radio"</span>]</span>,
<span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type=<span class="hljs-string">"range"</span>]</span>,
progress {
  accent-<span class="hljs-attribute">color</span>: <span class="hljs-number">#4a90e2</span>;
}
</code></pre>
<p><strong>优势</strong>：保持系统原生交互体验，视觉风格完美统一</p>
<h2 data-id="heading-1"> 2. caret-color - 输入光标的个性化定制</h2>
<p><strong>应用场景</strong>：深色模式、品牌色定制</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.dark-input</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#2d3748</span>;
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">caret-color</span>: <span class="hljs-number">#63b3ed</span>; <span class="hljs-comment">/* 再也不怕黑色光标突兀了 */</span>
}

<span class="hljs-selector-class">.brand-input</span> {
  <span class="hljs-attribute">caret-color</span>: <span class="hljs-number">#e53e3e</span>; <span class="hljs-comment">/* 品牌色光标 */</span>
}
</code></pre>
<h2 data-id="heading-2"> 3. currentColor - 智能颜色继承系统</h2>
<p><strong>这个真的绝了！</strong> 让颜色管理变得无比简单</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.icon-button</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#e53e3e</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid currentColor; <span class="hljs-comment">/* 边框自动继承 */</span>
  <span class="hljs-attribute">background</span>: none;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">4px</span> currentColor; <span class="hljs-comment">/* 阴影也同步 */</span>
}

<span class="hljs-selector-class">.icon-button</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#c53030</span>; <span class="hljs-comment">/* 只需改一个颜色，其他自动同步 */</span>
}

<span class="hljs-comment">/* 高级用法 - 渐变边框 */</span>
<span class="hljs-selector-class">.gradient-border</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#4a90e2</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid currentColor;
  <span class="hljs-attribute">position</span>: relative;
}

<span class="hljs-selector-class">.gradient-border</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
  <span class="hljs-attribute">position</span>: absolute;
  inset: -<span class="hljs-number">2px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">45deg</span>, currentColor, transparent);
  <span class="hljs-attribute">z-index</span>: -<span class="hljs-number">1</span>;
}
</code></pre>
<h2 data-id="heading-3"> 4. ::marker - 列表标记的终极解决方案</h2>
<p><strong>告别</strong>：繁琐的<code>::before</code>伪元素模拟</p>
<p>css</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 自定义图标列表 */</span>
<span class="hljs-selector-class">.custom-list</span> <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">::marker</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">"➤"</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#38a169</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.2em</span>;
}

<span class="hljs-comment">/* 个性化编号 */</span>
<span class="hljs-selector-class">.numbered-list</span> <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">::marker</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-built_in">counter</span>(list-item) <span class="hljs-string">". "</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#4a90e2</span>;
}

<span class="hljs-comment">/* 渐变数字效果 */</span>
<span class="hljs-selector-class">.gradient-marker</span> <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">::marker</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">"0"</span> <span class="hljs-built_in">counter</span>(list-item);
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">45deg</span>, <span class="hljs-number">#4a90e2</span>, <span class="hljs-number">#38a169</span>);
  -webkit-<span class="hljs-attribute">background-clip</span>: text;
  -webkit-text-fill-<span class="hljs-attribute">color</span>: transparent;
}
</code></pre>
<h2 data-id="heading-4"> 5. 智能表单验证 - 交互体验大升级</h2>
<p><strong>传统问题</strong>：<code>:invalid</code>太激进，用户一开始输入就报错</p>
<p><strong>现代方案</strong>：<code>:user-valid</code>和<code>:user-invalid</code>更人性化</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.form-input</span> {
  <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid <span class="hljs-number">#e2e8f0</span>;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-comment">/* 用户交互后才显示验证状态 */</span>
<span class="hljs-selector-class">.form-input</span>:user-valid {
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#48bb78</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f0fff4</span>;
}

<span class="hljs-selector-class">.form-input</span><span class="hljs-selector-pseudo">:user-invalid</span> {
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#f56565</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff5f5</span>;
}

<span class="hljs-comment">/* 聚焦时的微交互 */</span>
<span class="hljs-selector-class">.form-input</span><span class="hljs-selector-pseudo">:focus</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">1px</span>);
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">12px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">74</span>, <span class="hljs-number">144</span>, <span class="hljs-number">226</span>, <span class="hljs-number">0.2</span>);
}
</code></pre>
<h2 data-id="heading-5"> 6. :placeholder-shown - 空状态检测神器</h2>
<p><strong>应用场景</strong>：动态搜索框、智能表单提示</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.search-box</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-comment">/* 空状态样式 */</span>
<span class="hljs-selector-class">.search-box</span><span class="hljs-selector-pseudo">:placeholder-shown</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f7fafc</span>;
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#cbd5e0</span>;
}

<span class="hljs-comment">/* 有内容时的样式 */</span>
<span class="hljs-selector-class">.search-box</span><span class="hljs-selector-pseudo">:not</span>(<span class="hljs-selector-pseudo">:placeholder-shown</span>) {
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#4a90e2</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">8px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">74</span>, <span class="hljs-number">144</span>, <span class="hljs-number">226</span>, <span class="hljs-number">0.1</span>);
}

<span class="hljs-comment">/* 智能提示系统 */</span>
<span class="hljs-selector-class">.search-container</span><span class="hljs-selector-pseudo">:has</span>(<span class="hljs-selector-class">.search-box</span><span class="hljs-selector-pseudo">:placeholder-shown</span>) <span class="hljs-selector-class">.search-hints</span> {
  <span class="hljs-attribute">display</span>: block;
}

<span class="hljs-selector-class">.search-container</span><span class="hljs-selector-pseudo">:has</span>(<span class="hljs-selector-class">.search-box</span><span class="hljs-selector-pseudo">:not</span>(<span class="hljs-selector-pseudo">:placeholder-shown</span>)) <span class="hljs-selector-class">.search-results</span> {
  <span class="hljs-attribute">display</span>: block;
}
</code></pre>
<h2 data-id="heading-6"> 7. all: unset - 样式彻底重置大法</h2>
<p><strong>使用场景</strong>：组件开发、样式隔离、设计系统</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 自定义按钮组件 */</span>
<span class="hljs-selector-class">.custom-button</span> {
  <span class="hljs-attribute">all</span>: unset; <span class="hljs-comment">/* 彻底清除默认样式 */</span>
  <span class="hljs-attribute">display</span>: inline-flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span> <span class="hljs-number">24px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">45deg</span>, <span class="hljs-number">#4a90e2</span>, <span class="hljs-number">#38a169</span>);
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-selector-class">.custom-button</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">2px</span>);
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">8px</span> <span class="hljs-number">25px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">74</span>, <span class="hljs-number">144</span>, <span class="hljs-number">226</span>, <span class="hljs-number">0.3</span>);
}

<span class="hljs-comment">/* 重置链接样式 */</span>
<span class="hljs-selector-class">.reset-link</span> {
  <span class="hljs-attribute">all</span>: unset;
  <span class="hljs-attribute">color</span>: inherit;
  <span class="hljs-attribute">text-decoration</span>: none;
  <span class="hljs-attribute">cursor</span>: pointer;
}
</code></pre>
<h2 data-id="heading-7"> inset - 定位布局的终极简化</h2>
<p><strong>告别</strong>：<code>top: 0; right: 0; bottom: 0; left: 0;</code>的繁琐写法</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 全屏覆盖层 */</span>
<span class="hljs-selector-class">.overlay</span> {
  <span class="hljs-attribute">position</span>: fixed;
  inset: <span class="hljs-number">0</span>; <span class="hljs-comment">/* 一行替代四行 */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>);
  backdrop-<span class="hljs-attribute">filter</span>: <span class="hljs-built_in">blur</span>(<span class="hljs-number">5px</span>);
}

<span class="hljs-comment">/* 弹窗定位 */</span>
<span class="hljs-selector-class">.modal</span> {
  <span class="hljs-attribute">position</span>: absolute;
  inset: <span class="hljs-number">20px</span> <span class="hljs-number">40px</span>; <span class="hljs-comment">/* 上下20px，左右40px */</span>
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span>;
}

<span class="hljs-comment">/* 高级用法 - 安全区域适配 */</span>
<span class="hljs-selector-class">.safe-area</span> {
  <span class="hljs-attribute">position</span>: fixed;
  inset: <span class="hljs-built_in">env</span>(safe-area-inset-top) 
        <span class="hljs-built_in">env</span>(safe-area-inset-right) 
        <span class="hljs-built_in">env</span>(safe-area-inset-bottom) 
        <span class="hljs-built_in">env</span>(safe-area-inset-left);
}
</code></pre>
<h2 data-id="heading-8"> 9. text-wrap: balance - 文本排版的美学革命</h2>
<p><strong>让标题排版从此优雅起来</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">.card-title {
  text-wrap: balance;
  max-width: <span class="hljs-number">65</span>ch;
  font-size: <span class="hljs-number">1.5</span>rem;
  line-height: <span class="hljs-number">1.4</span>;
}

<span class="hljs-comment">/* 不同场景的文本换行策略 */</span>
.hero-title {
  text-wrap: balance; <span class="hljs-comment">/* 短文本平衡 */</span>
}

.<span class="hljs-type">long</span>-content {
  text-wrap: pretty; <span class="hljs-comment">/* 长段落优化 */</span>
}

.<span class="hljs-keyword">auto</span>-content {
  text-wrap: pretty; <span class="hljs-comment">/* 自动选择最佳换行 */</span>
}

<span class="hljs-comment">/* 结合容器查询 */</span>
@<span class="hljs-built_in">container</span> (min-width: <span class="hljs-number">400</span>px) {
  .responsive-title {
    text-wrap: balance;
  }
}
</code></pre>
<h2 data-id="heading-9"> 10. :is() - 选择器编写的效率利器</h2>
<p><strong>减少重复代码，提升可读性</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 传统写法 - 重复冗长 */</span>
<span class="hljs-selector-class">.card</span> <span class="hljs-selector-tag">h1</span>,
<span class="hljs-selector-class">.card</span> <span class="hljs-selector-tag">h2</span>, 
<span class="hljs-selector-class">.card</span> <span class="hljs-selector-tag">h3</span>,
<span class="hljs-selector-class">.card</span> <span class="hljs-selector-tag">h4</span> {
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">0.5em</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#2d3748</span>;
}

<span class="hljs-selector-class">.card</span> <span class="hljs-selector-tag">h1</span><span class="hljs-selector-pseudo">:hover</span>,
<span class="hljs-selector-class">.card</span> <span class="hljs-selector-tag">h2</span><span class="hljs-selector-pseudo">:hover</span>,
<span class="hljs-selector-class">.card</span> <span class="hljs-selector-tag">h3</span><span class="hljs-selector-pseudo">:hover</span>, 
<span class="hljs-selector-class">.card</span> <span class="hljs-selector-tag">h4</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#4a90e2</span>;
}

<span class="hljs-comment">/* 现代写法 - 简洁优雅 */</span>
<span class="hljs-selector-class">.card</span> <span class="hljs-selector-pseudo">:is</span>(<span class="hljs-selector-tag">h1</span>, <span class="hljs-selector-tag">h2</span>, <span class="hljs-selector-tag">h3</span>, <span class="hljs-selector-tag">h4</span>) {
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">0.5em</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#2d3748</span>;
}

<span class="hljs-selector-class">.card</span> <span class="hljs-selector-pseudo">:is</span>(<span class="hljs-selector-tag">h1</span>, <span class="hljs-selector-tag">h2</span>, <span class="hljs-selector-tag">h3</span>, <span class="hljs-selector-tag">h4</span>)<span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#4a90e2</span>;
}

<span class="hljs-comment">/* 复杂场景应用 */</span>
<span class="hljs-selector-pseudo">:is</span>(<span class="hljs-selector-class">.dark-theme</span>, <span class="hljs-selector-class">.high-contrast</span>) <span class="hljs-selector-pseudo">:is</span>(<span class="hljs-selector-tag">button</span>, <span class="hljs-selector-tag">a</span>) {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">border-color</span>: currentColor;
}
</code></pre>
<h2 data-id="heading-10">11. aspect-ratio - 宽高比控制的终极方案</h2>
<p><strong>告别</strong>：padding-top hack实现宽高比</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 视频容器 - 始终保持16:9 */</span>
<span class="hljs-selector-class">.video-wrapper</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  aspect-ratio: <span class="hljs-number">16</span> / <span class="hljs-number">9</span>;
  <span class="hljs-attribute">background</span>: black;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">overflow</span>: hidden;
}

<span class="hljs-comment">/* 正方形头像 */</span>
<span class="hljs-selector-class">.avatar</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">120px</span>;
  aspect-ratio: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">object-fit</span>: cover;
}

<span class="hljs-comment">/* 动态比例网格 */</span>
<span class="hljs-selector-class">.responsive-grid</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fit, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">250px</span>, <span class="hljs-number">1</span>fr));
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">1rem</span>;
}

<span class="hljs-selector-class">.grid-item</span> {
  aspect-ratio: <span class="hljs-number">4</span> / <span class="hljs-number">3</span>;
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">overflow</span>: hidden;
}

<span class="hljs-comment">/* 高级用法 - 可变比例 */</span>
<span class="hljs-selector-class">.adaptive-card</span> {
  aspect-ratio: <span class="hljs-number">3</span> / <span class="hljs-number">4</span>;
}

<span class="hljs-keyword">@container</span> (<span class="hljs-attribute">min-width</span>: <span class="hljs-number">768px</span>) {
  <span class="hljs-selector-class">.adaptive-card</span> {
    aspect-ratio: <span class="hljs-number">16</span> / <span class="hljs-number">9</span>;
  }
}
</code></pre>
<h2 data-id="heading-11"> 12. scroll-snap-type - 滚动体验的完美升级</h2>
<p><strong>创建应用级的滚动体验</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.image-gallery</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">overflow-x</span>: auto;
  <span class="hljs-attribute">scroll-snap-type</span>: x mandatory;
  scroll-behavior: smooth;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">1rem</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">1rem</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f7fafc</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span>;
}

<span class="hljs-selector-class">.image-gallery</span> <span class="hljs-selector-tag">img</span> {
  <span class="hljs-attribute">scroll-snap-align</span>: start;
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> auto;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">object-fit</span>: cover;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-selector-class">.image-gallery</span> <span class="hljs-selector-tag">img</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.05</span>);
}

<span class="hljs-comment">/* 垂直滚动定位 */</span>
<span class="hljs-selector-class">.vertical-list</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">400px</span>;
  <span class="hljs-attribute">overflow-y</span>: auto;
  <span class="hljs-attribute">scroll-snap-type</span>: y proximity;
}

<span class="hljs-selector-class">.vertical-list</span> <span class="hljs-selector-class">.item</span> {
  <span class="hljs-attribute">scroll-snap-align</span>: start;
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">1rem</span>;
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e2e8f0</span>;
}
</code></pre>
<h2 data-id="heading-12"> 实战建议与兼容性处理</h2>
<h3 data-id="heading-13">渐进增强策略</h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">/* 特性检测保障 */</span>
<span class="hljs-keyword">@supports</span> (<span class="hljs-attribute">aspect-ratio</span>: <span class="hljs-number">1</span>) {
  <span class="hljs-selector-class">.modern-card</span> {
    aspect-ratio: 3 / 4;
  }
}

<span class="hljs-keyword">@supports</span> <span class="hljs-keyword">not</span> (<span class="hljs-attribute">aspect-ratio</span>: <span class="hljs-number">1</span>) {
  <span class="hljs-selector-class">.modern-card</span> {
    <span class="hljs-attribute">height</span>: <span class="hljs-number">400px</span>; <span class="hljs-comment">/* 优雅降级 */</span>
  }
}

<span class="hljs-keyword">@supports</span> (<span class="hljs-built_in">selector</span>(:<span class="hljs-built_in">is</span>(h1))) {
  <span class="hljs-selector-class">.modern-selector</span> {
    <span class="hljs-comment">/* 使用现代选择器 */</span>
  }
}

<span class="hljs-keyword">@supports</span> <span class="hljs-keyword">not</span> (<span class="hljs-built_in">selector</span>(:<span class="hljs-built_in">is</span>(h1))) {
  <span class="hljs-selector-class">.fallback-selector</span> {
    <span class="hljs-comment">/* 传统写法回退 */</span>
  }
}
</code></pre>
<h3 data-id="heading-14">团队协作规范</h3>
<p>css</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 在团队中建立使用规范 */</span>

<span class="hljs-comment">/* 1. 表单主题色统一管理 */</span>
<span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--accent-color</span>: <span class="hljs-number">#4a90e2</span>;
  <span class="hljs-attr">--caret-color</span>: <span class="hljs-number">#63b3ed</span>;
}

<span class="hljs-comment">/* 2. 现代特性使用标记 */</span>
<span class="hljs-selector-class">.modern-feature</span> {
  <span class="hljs-comment">/*! modern: aspect-ratio */</span>
  aspect-ratio: <span class="hljs-number">16</span> / <span class="hljs-number">9</span>;
  
  <span class="hljs-comment">/*! fallback: padding-top 56.25% */</span>
  <span class="hljs-attribute">padding-top</span>: <span class="hljs-number">56.25%</span>;
}
</code></pre>
<h2 data-id="heading-15"> 总结</h2>
<p>这些CSS特性在现代浏览器中已经得到了很好的支持，掌握它们能够：</p>
<ul>
<li>
<p>✅ <strong>减少50%+的代码量</strong></p>
</li>
<li>
<p>✅ <strong>提升开发效率</strong></p>
</li>
<li>
<p>✅ <strong>改善用户体验</strong></p>
</li>
<li>
<p>✅ <strong>代码更易维护</strong></p>
</li>
<li>
<p>✅ <strong>界面更加精致</strong></p>
</li>
</ul>
<p>建议在实际项目中逐步尝试，你会发现前端开发原来可以如此优雅高效！</p>
<p><strong>现在就动手试试吧，相信你会回来感谢我的！</strong> 🚀</p>
<p>附：主要特性支持情况</p>
<ul>
<li>
<p>✅ Chrome 88+ 全面支持</p>
</li>
<li>
<p>✅ Firefox 78+ 良好支持</p>
</li>
<li>
<p>✅ Safari 14+ 基本支持</p>
</li>
<li>
<p>Edge 88+ 完全支持</p>
</li>
</ul>
<p>希望这些技巧能为你打开CSS新世界的大门！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[鸿蒙开发：this的指向问题]]></title>    <link>https://juejin.cn/post/7570995368739504170</link>    <guid>https://juejin.cn/post/7570995368739504170</guid>    <pubDate>2025-11-11T06:29:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570995368739504170" data-draft-id="7571005216910704659" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="鸿蒙开发：this的指向问题"/> <meta itemprop="keywords" content="HarmonyOS,Android,iOS"/> <meta itemprop="datePublished" content="2025-11-11T06:29:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员一鸣"/> <meta itemprop="url" content="https://juejin.cn/user/1398234520239095"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            鸿蒙开发：this的指向问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1398234520239095/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员一鸣
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:29:08.000Z" title="Tue Nov 11 2025 06:29:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">前言</h2>
<p>“你开发的组件，明明我数据改变了，为什么却没有变化？”</p>
<p>“不对吧，你这个封装的不行，我在@Builder函数中获取外部的属性，总是为undefined？”</p>
<p>可以说，以上的反馈，无论是在工作之中，还是在外部的开源中，遇到了无数次，我的回答就一句话，<strong>那是你的this指向不对。</strong></p>
<p>this，浅显易懂，就是指的自己，用于类中访问属性和方法，举一个很常见的一个案例，也是最简单的，通常我们给组件设置数据时，经常会用到this，如下所示，this就是指的当前组件Index。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"标题"</span>

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span>)
    }
  }
}
</code></pre>
<p>如果是正常的组件引用，一般this不会出现大的问题，但是在自定义组件，用到了@BuilderParam装饰器，在需要外部传递@Builder函数的时候，问题就暴露出来了，我们还是来一个案例。</p>
<p>首先自定义一个组件，如下所示，接收一个外部传递组件layout。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">export</span> struct <span class="hljs-title class_">Child</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"我是Child"</span>
  <span class="hljs-meta">@BuilderParam</span> <span class="hljs-attr">layout</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">layout</span>()
  }
}
</code></pre>
<p>我们把上述的自定义组件Child引用一下，然后自定义一个@Builder函数。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
 <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"我是Index"</span>

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Child</span>({
      <span class="hljs-attr">layout</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">TextView</span>
    })
  }

  <span class="hljs-meta">@Builder</span>
  <span class="hljs-title class_">TextView</span>() {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span>)
    }
  }
}
</code></pre>
<p>那么以上的案例，在运行之后，Text组件会显示 <strong>“我是Index”</strong> 还是 <strong>“我是</strong>Child <strong>”</strong> 呢？</p>
<p>答案是 <strong>“我是Child”。</strong></p>
<hr/>
<p>很多同学也会很懵，明明我在Index里调用的this，为什么不是显示Index里的 <strong>"我是Index"</strong> 数据呢？，哎，这就是this指向问题，也是很多同学在@Builder函数中一直困惑的问题。</p>
<h2 data-id="heading-1">this指向分析</h2>
<p>以上的案例中，我们在使用自定义组件的时候，是直接通过this传递的，此时的this指向的是自定义组件Child，所以，在@Builder装饰器函数中，this获取的是自定义组件Child里的数据，如果自定义组件中未有定义，那么就为undefined，这也是前言中很多同学的反馈。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-title class_">Child</span>({
      <span class="hljs-attr">layout</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">TextView</span>
    })
</code></pre>
<p>那么如何把this指向，修改宿主对象呢？也就是调用自定义组件的Index组件呢？很简单，只需要，修改为箭头函数即可。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-title class_">Child</span>({
      <span class="hljs-attr">layout</span>: <span class="hljs-function">()=&gt;</span>{
        <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">TextView</span>()
      }
    })
</code></pre>
<p>以上的案例，this指向的就是宿主对象，这样就解决了数据为什么为undefined，数据为什么无法更新的问题。</p>
<h2 data-id="heading-2">相关总结</h2>
<p>所以，在以后遇到@Builder函数的时候，如果你要用到外部宿主的this，书写方式为箭头函数()=&gt;{}，在大括号里引用你定义的@Builder函数，切记，箭头函数的this才是指向的是宿主对象，否则指向的是自定义组件。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript">()=&gt;{
  <span class="hljs-comment">//你定义的@Builder函数</span>
}
</code></pre>
<p>所以啊，老铁们，你们在使用别人自定义的组件时，一定要注意到这个this指向问题，并不是别人封装的不对，而是我们使用的方式不对。</p>
<p>希望这个this，能打开你的新世界大门！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3 渲染器源码实现]]></title>    <link>https://juejin.cn/post/7571060853371306034</link>    <guid>https://juejin.cn/post/7571060853371306034</guid>    <pubDate>2025-11-11T06:28:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571060853371306034" data-draft-id="7571051830710190130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3 渲染器源码实现"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-11-11T06:28:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Mrk"/> <meta itemprop="url" content="https://juejin.cn/user/2752832847754711"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3 渲染器源码实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2752832847754711/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Mrk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:28:04.000Z" title="Tue Nov 11 2025 06:28:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    17
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue3 渲染器源码实现详解：从虚拟DOM到Diff算法的完整实现</h2>
<h3 data-id="heading-1">引言</h3>
<p>Vue3 的渲染器是其性能提升的关键所在，它负责将虚拟DOM转换为真实DOM，并高效处理更新。本文将深入分析一个完整的 Vue3 渲染器实现，详细注释关键代码，帮助理解其核心原理。</p>
<h3 data-id="heading-2">1. 虚拟DOM (vnode) 系统</h3>
<p>虚拟DOM是Vue渲染系统的核心，它是对真实DOM的轻量级JavaScript对象表示。</p>
<p>javascript</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * 虚拟 DOM 节点类型枚举
 * 定义了不同类型的虚拟节点，每种类型对应不同的处理方式
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">VNODE_TYPES</span> = {
  <span class="hljs-attr">ELEMENT</span>: <span class="hljs-number">1</span>,     <span class="hljs-comment">// 普通HTML元素节点</span>
  <span class="hljs-attr">TEXT</span>: <span class="hljs-number">2</span>,        <span class="hljs-comment">// 文本节点  </span>
  <span class="hljs-attr">COMPONENT</span>: <span class="hljs-number">3</span>,   <span class="hljs-comment">// 组件节点</span>
  <span class="hljs-attr">FRAGMENT</span>: <span class="hljs-number">4</span>,    <span class="hljs-comment">// Fragment节点（多个根节点）</span>
  <span class="hljs-attr">COMMENT</span>: <span class="hljs-number">5</span>,     <span class="hljs-comment">// 注释节点</span>
};

<span class="hljs-comment">/**
 * 创建虚拟 DOM 节点
 * 这是构建虚拟DOM树的基石函数
 * 
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string|Object|Function</span>} <span class="hljs-variable">type</span> - 节点类型（标签名、组件对象或组件函数）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object|null</span>} <span class="hljs-variable">props</span> - 属性对象
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Array|string|number|null</span>} <span class="hljs-variable">children</span> - 子节点
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string|number|null</span>} <span class="hljs-variable">key</span> - 节点的key（用于diff算法优化）
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Object</span>} 虚拟DOM节点对象
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createVNode</span>(<span class="hljs-params"><span class="hljs-keyword">type</span>, props = <span class="hljs-literal">null</span>, children = <span class="hljs-literal">null</span>, key = <span class="hljs-literal">null</span></span>) {
  <span class="hljs-comment">// 确定节点类型：字符串为HTML元素，对象/函数为组件</span>
  <span class="hljs-keyword">let</span> vnodeType = <span class="hljs-variable constant_">VNODE_TYPES</span>.<span class="hljs-property">ELEMENT</span>;
  
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isString</span>(<span class="hljs-keyword">type</span>)) {
    vnodeType = <span class="hljs-variable constant_">VNODE_TYPES</span>.<span class="hljs-property">ELEMENT</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isObject</span>(<span class="hljs-keyword">type</span>) || <span class="hljs-title function_">isFunction</span>(<span class="hljs-keyword">type</span>)) {
    vnodeType = <span class="hljs-variable constant_">VNODE_TYPES</span>.<span class="hljs-property">COMPONENT</span>;
  }

  <span class="hljs-keyword">return</span> {
    <span class="hljs-keyword">type</span>,           <span class="hljs-comment">// 节点类型标识</span>
    props,          <span class="hljs-comment">// 属性集合</span>
    children,       <span class="hljs-comment">// 子节点数组或文本</span>
    key,            <span class="hljs-comment">// 用于diff算法的唯一标识</span>
    <span class="hljs-attr">el</span>: <span class="hljs-literal">null</span>,       <span class="hljs-comment">// 对应的真实DOM元素（挂载后赋值）</span>
    <span class="hljs-attr">component</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// 组件实例（组件节点专用）</span>
    <span class="hljs-attr">shapeFlag</span>: vnodeType, <span class="hljs-comment">// 节点形状标志，决定如何处理该节点</span>
    <span class="hljs-attr">__v_isVNode</span>: <span class="hljs-literal">true</span>,    <span class="hljs-comment">// 标识这是一个虚拟节点</span>
  };
}
</code></pre>
<p><strong>关键点说明：</strong></p>
<ul>
<li><code>shapeFlag</code> 使用位运算标志来快速判断节点类型</li>
<li><code>key</code> 属性是Diff算法优化的关键</li>
<li><code>el</code> 属性在挂载后指向对应的真实DOM，建立虚拟DOM与真实DOM的桥梁</li>
</ul>
<h3 data-id="heading-3">2. 渲染器核心架构</h3>
<p>渲染器是Vue3的核心，采用可插拔架构，支持不同平台的渲染。</p>
<p>javascript</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">/**
 * 创建渲染器 - Vue3渲染系统的核心工厂函数
 * 采用依赖注入模式，接收平台特定的DOM操作函数
 * 
 * <span class="hljs-doctag">@param</span> {Object} options - 渲染器选项（平台相关的DOM操作）
 * <span class="hljs-doctag">@returns</span> {Object} 包含render和createApp方法的渲染器对象
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createRenderer</span>(<span class="hljs-params">options</span>) </span>{
  <span class="hljs-comment">// 解构平台相关的DOM操作函数</span>
  <span class="hljs-keyword">const</span> {
    createElement,  <span class="hljs-comment">// 创建DOM元素</span>
    insert,         <span class="hljs-comment">// 插入DOM元素  </span>
    remove,         <span class="hljs-comment">// 移除DOM元素</span>
    setElementText, <span class="hljs-comment">// 设置元素文本</span>
    setText,        <span class="hljs-comment">// 设置文本节点内容</span>
    patchProp,      <span class="hljs-comment">// 更新元素属性</span>
  } = options;

  <span class="hljs-comment">// ... 渲染器核心实现</span>

  <span class="hljs-keyword">return</span> {
    render,
    createApp: <span class="hljs-title function_ invoke__">createAppAPI</span>(render),
  };
}
</code></pre>
<h3 data-id="heading-4">3. 挂载与更新机制</h3>
<h4 data-id="heading-5">3.1 挂载元素节点</h4>
<p>javascript</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/**
 * 挂载元素节点 - 将虚拟DOM转换为真实DOM的关键步骤
 * 
 * @param {Object} vnode - 虚拟节点
 * @param {HTMLElement} container - 容器元素
 * @param {HTMLElement|null} anchor - 锚点元素（插入位置参考）
 */</span>
function <span class="hljs-built_in">mountElement</span>(vnode, container, anchor = null) {
  <span class="hljs-comment">// 1. 创建对应的真实DOM元素</span>
  const el = <span class="hljs-built_in">createElement</span>(vnode.type);
  vnode<span class="hljs-selector-class">.el</span> = el;  <span class="hljs-comment">// 建立虚拟DOM与真实DOM的关联</span>

  <span class="hljs-comment">// 2. 处理属性：设置class、style、事件监听器等</span>
  if (vnode.props) {
    for (const key in vnode.props) {
      <span class="hljs-built_in">patchProp</span>(el, key, null, vnode.props[key]);
    }
  }

  <span class="hljs-comment">// 3. 处理子节点：递归挂载或设置文本内容</span>
  if (vnode.children) {
    if (isString(vnode.children) || typeof vnode<span class="hljs-selector-class">.children</span> === 'number') {
      <span class="hljs-comment">// 文本子节点直接设置</span>
      <span class="hljs-built_in">setElementText</span>(el, vnode.children);
    } else if (isArray(vnode.children)) {
      <span class="hljs-comment">// 数组子节点递归挂载</span>
      vnode<span class="hljs-selector-class">.children</span><span class="hljs-selector-class">.forEach</span>((child) =&gt; {
        <span class="hljs-built_in">patch</span>(null, child, el);
      });
    }
  }

  <span class="hljs-comment">// 4. 将创建的元素插入到容器中</span>
  <span class="hljs-built_in">insert</span>(el, container, anchor);
}
</code></pre>
<h4 data-id="heading-6">3.2 核心patch函数</h4>
<p>javascript</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/**
 * patch函数 - 渲染器的心脏，负责挂载新节点或更新已存在节点
 * 这是Vue3性能优化的核心，智能判断应该创建新节点还是更新现有节点
 * 
 * @param {Object|null} oldVNode - 旧的虚拟节点（null表示挂载新节点）
 * @param {Object} newVNode - 新的虚拟节点
 * @param {HTMLElement} container - 容器元素
 * @param {HTMLElement|null} anchor - 锚点元素（插入位置）
 */</span>
function <span class="hljs-built_in">patch</span>(oldVNode, newVNode, container, anchor = null) {
  <span class="hljs-comment">// 1. 如果旧节点存在且类型不同，需要卸载旧节点</span>
  if (oldVNode &amp;&amp; !isSameVNode(oldVNode, newVNode)) {
    <span class="hljs-built_in">unmount</span>(oldVNode);
    oldVNode = null;
  }

  const { shapeFlag } = newVNode;

  <span class="hljs-comment">// 2. 根据节点类型进行不同的处理</span>
  if (shapeFlag === VNODE_TYPES.TEXT) {
    <span class="hljs-comment">// 文本节点处理</span>
    if (!oldVNode) {
      <span class="hljs-built_in">mountText</span>(newVNode, container, anchor);
    } else {
      <span class="hljs-comment">// 更新文本内容</span>
      if (newVNode.children !== oldVNode.children) {
        <span class="hljs-built_in">setText</span>(newVNode.el, newVNode.children);
      }
    }
  } else if (shapeFlag === VNODE_TYPES.ELEMENT) {
    <span class="hljs-comment">// 元素节点处理</span>
    if (!oldVNode) {
      <span class="hljs-built_in">mountElement</span>(newVNode, container, anchor);
    } else {
      <span class="hljs-built_in">patchElement</span>(oldVNode, newVNode);
    }
  } else if (shapeFlag === VNODE_TYPES.COMPONENT) {
    <span class="hljs-comment">// 组件节点处理</span>
    if (!oldVNode) {
      <span class="hljs-built_in">mountComponent</span>(newVNode, container, anchor);
    } else {
      <span class="hljs-built_in">patchComponent</span>(oldVNode, newVNode);
    }
  }
}
</code></pre>
<h3 data-id="heading-7">4. Diff算法：Vue3性能的秘诀</h3>
<p>Vue3的Diff算法是其性能大幅提升的关键，采用双端比较和最长递增子序列优化。</p>
<h4 data-id="heading-8">4.1 双端比较算法</h4>
<p>javascript</p>
<pre><code class="hljs language-ini" lang="ini">/**
 * 带key的子节点diff算法（双端比较 + 最长递增子序列优化）
 * 这是Vue3相比Vue2性能提升的核心算法
 * 
 * @param {Array} oldChildren - 旧的子节点数组
 * @param {Array} newChildren - 新的子节点数组  
 * @param {HTMLElement} container - 容器元素
 */
function patchKeyedChildren(oldChildren, newChildren, container) {
  // 阶段1：双端比较 - 处理简单的头部和尾部相同情况
  let <span class="hljs-attr">oldStartIdx</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
  let <span class="hljs-attr">newStartIdx</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
  let <span class="hljs-attr">oldEndIdx</span> = oldChildren.length - <span class="hljs-number">1</span><span class="hljs-comment">;</span>
  let <span class="hljs-attr">newEndIdx</span> = newChildren.length - <span class="hljs-number">1</span><span class="hljs-comment">;</span>
  
  // 双端比较的四种简单情况处理
  while (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) {
    // 情况1：旧头节点 === 新头节点（位置不变，只需更新内容）
    if (isSameVNode(oldStartVNode, newStartVNode)) {
      patch(oldStartVNode, newStartVNode, container)<span class="hljs-comment">;</span>
      <span class="hljs-attr">oldStartVNode</span> = oldChildren[++oldStartIdx]<span class="hljs-comment">;</span>
      <span class="hljs-attr">newStartVNode</span> = newChildren[++newStartIdx]<span class="hljs-comment">;</span>
    }
    // 情况2：旧尾节点 === 新尾节点（位置不变，只需更新内容）  
    else if (isSameVNode(oldEndVNode, newEndVNode)) {
      patch(oldEndVNode, newEndVNode, container)<span class="hljs-comment">;</span>
      <span class="hljs-attr">oldEndVNode</span> = oldChildren[--oldEndIdx]<span class="hljs-comment">;</span>
      <span class="hljs-attr">newEndVNode</span> = newChildren[--newEndIdx]<span class="hljs-comment">;</span>
    }
    // 情况3：旧头节点 === 新尾节点（节点从头部移到尾部）
    else if (isSameVNode(oldStartVNode, newEndVNode)) {
      patch(oldStartVNode, newEndVNode, container)<span class="hljs-comment">;</span>
      // 移动DOM元素到正确位置
      insert(oldStartVNode.el, container, oldEndVNode.el.nextSibling)<span class="hljs-comment">;</span>
      <span class="hljs-attr">oldStartVNode</span> = oldChildren[++oldStartIdx]<span class="hljs-comment">;</span>
      <span class="hljs-attr">newEndVNode</span> = newChildren[--newEndIdx]<span class="hljs-comment">;</span>
    }
    // 情况4：旧尾节点 === 新头节点（节点从尾部移到头部）
    else if (isSameVNode(oldEndVNode, newStartVNode)) {
      patch(oldEndVNode, newStartVNode, container)<span class="hljs-comment">;</span>
      insert(oldEndVNode.el, container, oldStartVNode.el)<span class="hljs-comment">;</span>
      <span class="hljs-attr">oldEndVNode</span> = oldChildren[--oldEndIdx]<span class="hljs-comment">;</span>
      <span class="hljs-attr">newStartVNode</span> = newChildren[++newStartIdx]<span class="hljs-comment">;</span>
    }
    // 情况5：都不匹配，进入复杂情况处理
    else {
      break<span class="hljs-comment">;</span>
    }
  }
  
  // 阶段2：建立key映射表，处理复杂移动情况
  // 阶段3：使用最长递增子序列算法优化DOM移动操作
}
</code></pre>
<h4 data-id="heading-9">4.2 最长递增子序列算法</h4>
<p>javascript</p>
<pre><code class="hljs language-ini" lang="ini">/**
 * 最长递增子序列（Longest Increasing Subsequence）算法
 * 用于找出数组中保持递增顺序的最长子序列
 * 在Diff算法中用于识别不需要移动的节点，最小化DOM操作
 * 
 * 算法原理：贪心 + 二分查找，时间复杂度O(n log n)
 * 
 * @param {Array} arr - 输入数组
 * @returns {Array} 最长递增子序列的索引数组
 */
function getSequence(arr) {
  const <span class="hljs-attr">p</span> = arr.slice()<span class="hljs-comment">; // 前驱节点数组，用于回溯构建结果</span>
  const <span class="hljs-attr">result</span> = [<span class="hljs-number">0</span>]<span class="hljs-comment">;    // 当前最长递增子序列的索引</span>
  
  let i, j, u, v, c<span class="hljs-comment">;</span>
  const <span class="hljs-attr">len</span> = arr.length<span class="hljs-comment">;</span>
  
  for (<span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; len; i++) {</span>
    const <span class="hljs-attr">arrI</span> = arr[i]<span class="hljs-comment">;</span>
    
    // 跳过值为0的元素（表示新节点）
    if (arrI !== 0) {
      <span class="hljs-attr">j</span> = result[result.length - <span class="hljs-number">1</span>]<span class="hljs-comment">;</span>
      
      // 如果当前元素大于结果数组最后一个元素，直接添加
      if (arr<span class="hljs-section">[j]</span> &lt; arrI) {
        p<span class="hljs-section">[i]</span> = j<span class="hljs-comment">;           // 记录前驱节点</span>
        result.push(i)<span class="hljs-comment">;     // 添加到结果数组</span>
        continue<span class="hljs-comment">;</span>
      }
      
      // 否则使用二分查找找到应该插入的位置
      <span class="hljs-attr">u</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
      <span class="hljs-attr">v</span> = result.length - <span class="hljs-number">1</span><span class="hljs-comment">;</span>
      
      while (u &lt; v) {
        <span class="hljs-attr">c</span> = (u + v) &gt;&gt; <span class="hljs-number">1</span><span class="hljs-comment">;  // 二分查找中间位置</span>
        if (arr<span class="hljs-section">[result[c]]</span> &lt; arrI) {
          <span class="hljs-attr">u</span> = c + <span class="hljs-number">1</span><span class="hljs-comment">;</span>
        } else {
          <span class="hljs-attr">v</span> = c<span class="hljs-comment">;</span>
        }
      }
      
      // 替换找到的位置
      if (arrI &lt; arr<span class="hljs-section">[result[u]]</span>) {
        if (u &gt; 0) {
          p<span class="hljs-section">[i]</span> = result<span class="hljs-section">[u - 1]</span><span class="hljs-comment">;</span>
        }
        result<span class="hljs-section">[u]</span> = i<span class="hljs-comment">;</span>
      }
    }
  }
  
  // 回溯构建完整的最长递增子序列
  <span class="hljs-attr">u</span> = result.length<span class="hljs-comment">;</span>
  <span class="hljs-attr">v</span> = result[u - <span class="hljs-number">1</span>]<span class="hljs-comment">;</span>
  
  while (u-- &gt; 0) {
    result<span class="hljs-section">[u]</span> = v<span class="hljs-comment">;</span>
    <span class="hljs-attr">v</span> = p[v]<span class="hljs-comment">;</span>
  }
  
  return result<span class="hljs-comment">;</span>
}
</code></pre>
<p><strong>算法应用场景：</strong><br/>
当节点顺序发生变化时，LIS算法找出不需要移动的节点，只移动必要的节点，极大减少DOM操作。</p>
<h3 data-id="heading-10">5. 组件系统实现</h3>
<p>Vue3的组件系统基于组合式API，支持更灵活的代码组织方式。</p>
<p>javascript</p>
<pre><code class="hljs language-ini" lang="ini">/**
 * 挂载组件 - 处理组件节点的创建和渲染
 * 
 * @param {Object} vnode - 组件虚拟节点
 * @param {HTMLElement} container - 容器元素
 * @param {HTMLElement|null} anchor - 锚点元素
 */
function mountComponent(vnode, container, <span class="hljs-attr">anchor</span> = null) {
  // 1. 获取组件定义（可能是对象或函数）
  const <span class="hljs-attr">component</span> = vnode.type<span class="hljs-comment">;</span>
  
  // 2. 创建组件实例
  const <span class="hljs-attr">instance</span> = {
    vnode,
    type: component,
    props: vnode.props || {},
    setupState: {},     // setup函数返回的状态
    render: null,       // 组件的渲染函数
    subTree: null,      // 组件渲染的子树
    isMounted: false,
    update: null,       // 更新函数
  }<span class="hljs-comment">;</span>
  
  // 3. 处理不同类型的组件定义
  if (isFunction(component)) {
    // 函数式组件：直接使用函数作为render
    <span class="hljs-attr">instance.render</span> = component<span class="hljs-comment">;</span>
  } else if (isObject(component)) {
    // 选项式组件：处理setup和render
    if (component.setup) {
      // 调用setup函数，传入props和上下文
      const <span class="hljs-attr">setupResult</span> = component.setup(instance.props, {
        // 这里可以传入emit、slots等上下文
      })<span class="hljs-comment">;</span>
      
      if (isFunction(setupResult)) {
        // setup返回渲染函数
        <span class="hljs-attr">instance.render</span> = setupResult<span class="hljs-comment">;</span>
      } else if (isObject(setupResult)) {
        // setup返回状态对象
        <span class="hljs-attr">instance.setupState</span> = setupResult<span class="hljs-comment">;</span>
        <span class="hljs-attr">instance.render</span> = component.render || defaultRender<span class="hljs-comment">;</span>
      }
    } else if (component.render) {
      <span class="hljs-attr">instance.render</span> = component.render<span class="hljs-comment">;</span>
    }
  }
  
  <span class="hljs-attr">vnode.component</span> = instance<span class="hljs-comment">;</span>
  
  // 4. 执行渲染函数，得到子树并挂载
  <span class="hljs-attr">instance.subTree</span> = instance.render(instance.setupState, instance.props)<span class="hljs-comment">;</span>
  patch(null, instance.subTree, container, anchor)<span class="hljs-comment">;</span>
  <span class="hljs-attr">instance.isMounted</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
}
</code></pre>
<h3 data-id="heading-11">6. 浏览器DOM操作适配器</h3>
<p>javascript</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/**
 * 浏览器环境的渲染器选项
 * 将抽象的渲染操作映射到具体的DOM API
 */</span>
const rendererOptions = {
  <span class="hljs-comment">// 创建DOM元素</span>
  <span class="hljs-built_in">createElement</span>(tag) {
    return document<span class="hljs-selector-class">.createElement</span>(tag);
  },
  
  <span class="hljs-comment">// 插入DOM元素</span>
  <span class="hljs-built_in">insert</span>(el, parent, anchor = null) {
    parent<span class="hljs-selector-class">.insertBefore</span>(el, anchor);
  },
  
  <span class="hljs-comment">// 移除DOM元素  </span>
  <span class="hljs-built_in">remove</span>(el) {
    const parent = el<span class="hljs-selector-class">.parentNode</span>;
    if (parent) {
      parent<span class="hljs-selector-class">.removeChild</span>(el);
    }
  },
  
  <span class="hljs-comment">// 设置元素文本内容</span>
  <span class="hljs-built_in">setElementText</span>(el, text) {
    el<span class="hljs-selector-class">.textContent</span> = text;
  },
  
  <span class="hljs-comment">// 更新元素属性（包括事件、class、style等）</span>
  <span class="hljs-built_in">patchProp</span>(el, key, prevValue, nextValue) {
    <span class="hljs-comment">// 处理事件监听器（以on开头的属性）</span>
    if (/^on/.test(key)) {
      const eventName = key<span class="hljs-selector-class">.slice</span>(<span class="hljs-number">2</span>)<span class="hljs-selector-class">.toLowerCase</span>();
      
      <span class="hljs-comment">// 移除旧事件监听器</span>
      if (prevValue) {
        el<span class="hljs-selector-class">.removeEventListener</span>(eventName, prevValue);
      }
      
      <span class="hljs-comment">// 添加新事件监听器</span>
      if (nextValue) {
        el<span class="hljs-selector-class">.addEventListener</span>(eventName, nextValue);
      }
    }
    <span class="hljs-comment">// 处理class属性</span>
    else if (key === 'class') {
      el<span class="hljs-selector-class">.className</span> = nextValue || '';
    }
    <span class="hljs-comment">// 处理style属性</span>
    else if (key === 'style') {
      if (isObject(nextValue)) {
        <span class="hljs-comment">// 样式对象：逐个设置样式属性</span>
        for (const k in nextValue) {
          el<span class="hljs-selector-class">.style</span><span class="hljs-selector-attr">[k]</span> = nextValue<span class="hljs-selector-attr">[k]</span>;
        }
        <span class="hljs-comment">// 移除旧样式中不存在的属性</span>
        if (isObject(prevValue)) {
          for (const k in prevValue) {
            if (!(k in nextValue)) {
              el<span class="hljs-selector-class">.style</span><span class="hljs-selector-attr">[k]</span> = '';
            }
          }
        }
      } else {
        el<span class="hljs-selector-class">.style</span><span class="hljs-selector-class">.cssText</span> = nextValue || '';
      }
    }
    <span class="hljs-comment">// 处理其他属性</span>
    else {
      if (nextValue == null || nextValue === false) {
        el<span class="hljs-selector-class">.removeAttribute</span>(key);
      } else {
        el<span class="hljs-selector-class">.setAttribute</span>(key, nextValue);
      }
    }
  }
};
</code></pre>
<h3 data-id="heading-12">7. 应用实例创建</h3>
<p>javascript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 创建createApp API - Vue应用实例的工厂函数
 * 
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} <span class="hljs-variable">render</span> - 渲染函数
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Function</span>} createApp函数
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createAppAPI</span>(<span class="hljs-params">render</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createApp</span>(<span class="hljs-params">rootComponent</span>) {
    <span class="hljs-keyword">const</span> app = {
      <span class="hljs-attr">_component</span>: rootComponent,
      <span class="hljs-attr">_container</span>: <span class="hljs-literal">null</span>,
      
      <span class="hljs-comment">/**
       * 挂载应用到容器
       * 
       * <span class="hljs-doctag">@param</span> {<span class="hljs-type">HTMLElement|string</span>} <span class="hljs-variable">containerOrSelector</span> - 容器元素或选择器
       * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Object</span>} 应用实例
       */</span>
      <span class="hljs-title function_">mount</span>(<span class="hljs-params">containerOrSelector</span>) {
        <span class="hljs-comment">// 获取容器元素</span>
        <span class="hljs-keyword">const</span> container = <span class="hljs-keyword">typeof</span> containerOrSelector === <span class="hljs-string">'string'</span> 
          ? <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(containerOrSelector) 
          : containerOrSelector;
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_container</span> = container;
        
        <span class="hljs-comment">// 创建根组件的虚拟节点</span>
        <span class="hljs-keyword">const</span> vnode = <span class="hljs-title function_">createVNode</span>(rootComponent);
        
        <span class="hljs-comment">// 渲染到容器</span>
        <span class="hljs-title function_">render</span>(vnode, container);
        
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
      }
    };
    
    <span class="hljs-keyword">return</span> app;
  };
}
</code></pre>
<h3 data-id="heading-13">总结</h3>
<p>Vue3渲染器的核心创新点：</p>
<ol>
<li><strong>模块化设计</strong>：通过<code>createRenderer</code>工厂函数，支持多平台渲染</li>
<li><strong>高效的Diff算法</strong>：双端比较 + 最长递增子序列，最小化DOM操作</li>
<li><strong>灵活的组件系统</strong>：支持函数式和选项式组件，组合式API提供更好的逻辑复用</li>
<li><strong>静态提升</strong>：在编译阶段优化静态节点，减少运行时开销</li>
<li><strong>Tree Shaking友好</strong>：模块化的架构使未使用的功能可以被摇树优化</li>
</ol>
<p>这个实现虽然简化，但完整展示了Vue3渲染器的核心原理。实际Vue3源码中还有更多优化，如静态提升、补丁标志、缓存优化等，但基本架构和算法思想是一致的。</p>
<p>通过深入理解这个渲染器实现，开发者可以更好地掌握Vue3的性能优化技巧，编写更高效的Vue应用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从 JS 单线程到 Promise：彻底搞懂异步编程的 "同步化" 魔法]]></title>    <link>https://juejin.cn/post/7571051830710255666</link>    <guid>https://juejin.cn/post/7571051830710255666</guid>    <pubDate>2025-11-11T06:37:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571051830710255666" data-draft-id="7571051830710239282" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从 JS 单线程到 Promise：彻底搞懂异步编程的 &quot;同步化&quot; 魔法"/> <meta itemprop="keywords" content="JavaScript,前端"/> <meta itemprop="datePublished" content="2025-11-11T06:37:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="社恐的下水道蟑螂"/> <meta itemprop="url" content="https://juejin.cn/user/423789937565536"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从 JS 单线程到 Promise：彻底搞懂异步编程的 "同步化" 魔法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/423789937565536/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    社恐的下水道蟑螂
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:37:22.000Z" title="Tue Nov 11 2025 06:37:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在前端开发中，"异步" 是绕不开的核心概念。从早期的回调函数嵌套，到 ES6 引入的 Promise，再到 async/await 语法糖，异步编程的演进始终围绕一个目标：让复杂的异步逻辑变得像同步代码一样直观。</p>
<p>本文将从 JS 的单线程特性讲起，通过实例带你理解为什么需要 Promise，以及它如何优雅地解决异步流程控制问题。</p>
<h2 data-id="heading-0">一、从线程到 JS 单线程：为什么异步如此重要？</h2>
<p>要理解 JS 的异步机制，先得搞清楚两个基础概念：<strong>进程</strong>和<strong>线程</strong>。</p>
<ul>
<li><strong>进程</strong>：操作系统分配资源的最小单位（比如一个浏览器标签页就是一个进程）。</li>
<li><strong>线程</strong>：进程内执行代码的最小单位，一个进程可以包含多个线程。</li>
</ul>
<p>而 JavaScript 的核心特性之一就是：<strong>单线程</strong>—— 同一时间只能执行一段代码。</p>
<p>为什么 JS 要设计成单线程？这和它的应用场景密切相关：JS 需要操作 DOM、处理页面交互，如果允许多线程同时操作 DOM，会导致渲染冲突（比如两个线程同时修改同一个元素的样式）。单线程模型虽然简单，却带来了一个关键问题：<strong>如果遇到耗时任务（比如网络请求、定时器），会阻塞后续代码执行</strong>。</p>
<p>为了解决这个问题，JS 将代码分为两类：</p>
<h3 data-id="heading-1">1. 同步代码</h3>
<p>按顺序从上到下执行，执行完一段再执行下一段，比如：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-ini" lang="ini">console.log('start')<span class="hljs-comment">;</span>
let <span class="hljs-attr">a</span> = <span class="hljs-number">1</span> + <span class="hljs-number">2</span><span class="hljs-comment">;</span>
for (let <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; 3; i++) {</span>
  console.log(i)<span class="hljs-comment">;</span>
}
console.log('end')<span class="hljs-comment">;</span>
</code></pre>
<p>这类代码执行速度快（毫秒级），不会阻塞线程。</p>
<h3 data-id="heading-2">2. 异步代码</h3>
<p>耗时较长的操作（比如网络请求、<code>setTimeout</code>、文件读写），会被暂时 "挂起"，先执行后面的同步代码，等耗时操作完成后再回头执行。</p>
<p><strong>关键机制</strong>：JS 的单线程配合<strong>事件循环（Event Loop）</strong>  处理异步任务：</p>
<ul>
<li>同步代码直接进入主线程执行</li>
<li>异步任务会被放入 "任务队列" 等待</li>
<li>主线程执行完所有同步代码后，才会从任务队列中依次取出异步任务执行</li>
</ul>
<h2 data-id="heading-3">二、Promise：让异步代码 "同步化" 的利器</h2>
<p>早期处理异步逻辑依赖回调函数，但多个异步操作嵌套时，会出现 "回调地狱"：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 回调地狱示例</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第一步完成'</span>);
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第二步完成'</span>);
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第三步完成'</span>);
      <span class="hljs-comment">// ...更多嵌套</span>
    }, <span class="hljs-number">1000</span>);
  }, <span class="hljs-number">1000</span>);
}, <span class="hljs-number">1000</span>);
</code></pre>
<p>代码嵌套层级越深，可读性和可维护性越差。</p>
<p>ES6 引入的<strong>Promise</strong>彻底改变了这一局面，它通过链式调用（<code>.then()</code>）让异步流程变得线性、直观。</p>
<h3 data-id="heading-4">1. Promise 的核心特性</h3>
<ul>
<li><strong>状态不可逆</strong>：Promise 有三种状态，只能从<code>pending</code>（等待中）转为<code>fulfilled</code>（成功）或<code>rejected</code>（失败），且状态一旦改变就无法再变。</li>
<li><strong>链式调用</strong>：通过<code>.then()</code>处理成功结果，<code>.catch()</code>处理错误，解决嵌套问题。</li>
<li><strong>立即执行</strong>：创建 Promise 时，传入的执行器函数（executor）会立即执行。</li>
</ul>
<h3 data-id="heading-5">2. 基本用法</h3>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建Promise实例</span>
<span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-comment">// 执行异步任务（比如网络请求、定时器）</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> success = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (success) {
      <span class="hljs-comment">// 任务成功，调用resolve()，状态变为fulfilled</span>
      <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'任务完成'</span>); 
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 任务失败，调用reject()，状态变为rejected</span>
      <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'任务失败'</span>));
    }
  }, <span class="hljs-number">1000</span>);
});

<span class="hljs-comment">// 处理成功结果</span>
promise.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result); <span class="hljs-comment">// 输出："任务完成"</span>
}).<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
  <span class="hljs-comment">// 处理失败（如果调用了reject，会进入这里）</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error);
});
</code></pre>
<ul>
<li><code>resolve</code>：将 Promise 状态改为成功，触发<code>.then()</code>的回调。</li>
<li><code>reject</code>：将 Promise 状态改为失败，触发<code>.catch()</code>的回调。</li>
</ul>
<h2 data-id="heading-6">三、实战分析：那段代码的执行逻辑</h2>
<p>结合你提供的代码，我们一步步拆解执行过程，彻底搞懂 Promise 的异步执行顺序：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// 同步代码</span>

<span class="hljs-comment">// 创建Promise</span>
<span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
  <span class="hljs-comment">// 执行器函数立即执行，但内部的setTimeout是异步任务</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>); 
    <span class="hljs-title function_">resolve</span>(); <span class="hljs-comment">// 改变状态为fulfilled</span>
  }, <span class="hljs-number">3000</span>);
});

<span class="hljs-comment">// 注册成功回调（会在resolve()后执行）</span>
p.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>);
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">4</span>); <span class="hljs-comment">// 同步代码</span>
</code></pre>
<h3 data-id="heading-7">执行步骤详解：</h3>
<ol>
<li>
<p><strong>同步代码优先执行</strong>：</p>
<ul>
<li>先执行<code>console.log(1)</code>，输出 <code>1</code>。</li>
<li>创建 Promise 实例时，执行器函数立即运行，但函数内部的<code>setTimeout</code>是异步任务（宏任务），被放入任务队列等待。</li>
<li>继续执行<code>console.log(4)</code>，输出 <code>4</code>。此时主线程的同步代码已全部执行完毕。</li>
</ul>
</li>
<li>
<p><strong>异步任务进入事件循环</strong>：</p>
<ul>
<li>3 秒后，<code>setTimeout</code>的回调从任务队列进入主线程执行，输出 <code>2</code>。</li>
<li>执行<code>resolve()</code>，将 Promise 状态从<code>pending</code>改为<code>fulfilled</code>。</li>
<li>Promise 状态改变后，触发<code>.then()</code>中注册的回调，执行<code>console.log(3)</code>，输出 <code>3</code>。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-8">最终输出顺序：</h3>
<p>plaintext</p>
<pre><code class="hljs">1
4
2
3
</code></pre>
<h2 data-id="heading-9">四、Promise 的核心价值</h2>
<ol>
<li>
<p><strong>解决回调地狱</strong>：通过<code>.then()</code>链式调用，将嵌套的异步逻辑转为线性代码。</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 链式调用示例</span>
<span class="hljs-title function_">fetchData</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-title function_">processData</span>(data))
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> <span class="hljs-title function_">saveResult</span>(result))
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'全部完成'</span>))
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error));
</code></pre>
</li>
<li>
<p><strong>统一异步 API</strong>：无论定时器、网络请求还是文件操作，都可以用 Promise 包装，形成统一的异步处理模式。</p>
</li>
<li>
<p><strong>流程控制能力</strong>：结合<code>Promise.all()</code>（并行执行）、<code>Promise.race()</code>（竞速执行）等方法，轻松实现复杂的异步流程控制。</p>
</li>
</ol>
<h2 data-id="heading-10">总结</h2>
<p>JavaScript 的单线程模型决定了异步编程的必要性，而 Promise 则是异步编程的里程碑式解决方案。它通过状态管理和链式调用，让原本混乱的异步逻辑变得清晰可控。</p>
<p>理解 Promise 的关键在于：</p>
<ul>
<li>区分同步代码和异步代码的执行时机</li>
<li>掌握 Promise 的状态变化机制</li>
<li>学会用<code>.then()</code>链式调用替代嵌套回调</li>
</ul>
<p>后续学习中，你还会接触到<code>async/await</code>（Promise 的语法糖），它能让异步代码看起来和同步代码几乎一样。但在此之前，扎实掌握 Promise 的原理和用法，是深入理解 JS 异步编程的基础。</p>
<p>希望这篇文章能帮你彻底搞懂 Promise，下次遇到异步代码时，不再迷茫！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 数组方法完全指南]]></title>    <link>https://juejin.cn/post/7571056535440572416</link>    <guid>https://juejin.cn/post/7571056535440572416</guid>    <pubDate>2025-11-11T06:40:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571056535440572416" data-draft-id="7571156741396742159" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 数组方法完全指南"/> <meta itemprop="keywords" content="JavaScript,面试"/> <meta itemprop="datePublished" content="2025-11-11T06:40:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户971417181427"/> <meta itemprop="url" content="https://juejin.cn/user/2200564916558794"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 数组方法完全指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2200564916558794/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户971417181427
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:40:51.000Z" title="Tue Nov 11 2025 06:40:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript 数组方法完全指南</h2>
<h3 data-id="heading-1">前言</h3>
<p>数组是 JavaScript 中最常用的数据结构之一，它提供了丰富的内置方法来处理数据。掌握这些方法不仅能提高开发效率，还能让代码更加简洁优雅。本文将全面介绍 JavaScript 数组的各种方法，帮助你从入门到精通。</p>
<h3 data-id="heading-2">目录</h3>
<ul>
<li><a href="#%E6%95%B0%E7%BB%84%E5%9F%BA%E7%A1%80" title="#%E6%95%B0%E7%BB%84%E5%9F%BA%E7%A1%80">数组基础</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E7%BB%84" title="#%E5%88%9B%E5%BB%BA%E6%95%B0%E7%BB%84">创建数组</a></li>
<li><a href="#%E6%95%B0%E7%BB%84%E6%96%B9%E6%B3%95%E5%88%86%E7%B1%BB" title="#%E6%95%B0%E7%BB%84%E6%96%B9%E6%B3%95%E5%88%86%E7%B1%BB">数组方法分类</a>
<ul>
<li><a href="#%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E6%96%B9%E6%B3%95" title="#%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E6%96%B9%E6%B3%95">增删改查方法</a></li>
<li><a href="#%E9%81%8D%E5%8E%86%E6%96%B9%E6%B3%95" title="#%E9%81%8D%E5%8E%86%E6%96%B9%E6%B3%95">遍历方法</a></li>
<li><a href="#%E6%9F%A5%E6%89%BE%E6%96%B9%E6%B3%95" title="#%E6%9F%A5%E6%89%BE%E6%96%B9%E6%B3%95">查找方法</a></li>
<li><a href="#%E8%BD%AC%E6%8D%A2%E6%96%B9%E6%B3%95" title="#%E8%BD%AC%E6%8D%A2%E6%96%B9%E6%B3%95">转换方法</a></li>
<li><a href="#%E6%8E%92%E5%BA%8F%E5%92%8C%E5%8F%8D%E8%BD%AC" title="#%E6%8E%92%E5%BA%8F%E5%92%8C%E5%8F%8D%E8%BD%AC">排序和反转</a></li>
<li><a href="#%E5%88%A4%E6%96%AD%E6%96%B9%E6%B3%95" title="#%E5%88%A4%E6%96%AD%E6%96%B9%E6%B3%95">判断方法</a></li>
<li><a href="#%E5%BD%92%E7%BA%A6%E6%96%B9%E6%B3%95" title="#%E5%BD%92%E7%BA%A6%E6%96%B9%E6%B3%95">归约方法</a></li>
<li><a href="#es6-%E6%96%B0%E6%96%B9%E6%B3%95" title="#es6-%E6%96%B0%E6%96%B9%E6%B3%95">ES6+ 新方法</a></li>
</ul>
</li>
<li><a href="#%E6%96%B9%E6%B3%95%E5%AF%B9%E6%AF%94%E4%B8%8E%E9%80%89%E6%8B%A9" title="#%E6%96%B9%E6%B3%95%E5%AF%B9%E6%AF%94%E4%B8%8E%E9%80%89%E6%8B%A9">方法对比与选择</a></li>
<li><a href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" title="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">最佳实践</a></li>
<li><a href="#%E6%80%BB%E7%BB%93" title="#%E6%80%BB%E7%BB%93">总结</a></li>
</ul>
<hr/>
<h3 data-id="heading-3">数组基础</h3>
<p>在 JavaScript 中，数组是一种特殊的对象，用于存储有序的数据集合。数组具有以下特点：</p>
<ul>
<li><strong>可调整大小</strong>：数组长度可以动态变化</li>
<li><strong>可包含不同类型</strong>：同一个数组可以存储数字、字符串、对象等</li>
<li><strong>索引从 0 开始</strong>：第一个元素的索引是 0</li>
<li><strong>浅拷贝</strong>：数组复制操作创建的是浅拷贝</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 数组示例</span>
<span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits[<span class="hljs-number">0</span>]); <span class="hljs-comment">// 'apple'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits.<span class="hljs-property">length</span>); <span class="hljs-comment">// 3</span>
</code></pre>
<hr/>
<h3 data-id="heading-4">创建数组</h3>
<h4 data-id="heading-5">1. 字面量方式</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr1 = []; <span class="hljs-comment">// 空数组</span>
<span class="hljs-keyword">const</span> arr2 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]; <span class="hljs-comment">// 包含元素的数组</span>
<span class="hljs-keyword">const</span> arr3 = [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-literal">true</span>]; <span class="hljs-comment">// 混合类型</span>
</code></pre>
<h4 data-id="heading-6">2. Array 构造函数</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(); <span class="hljs-comment">// 空数组</span>
<span class="hljs-keyword">const</span> arr2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">5</span>); <span class="hljs-comment">// 长度为 5 的稀疏数组</span>
<span class="hljs-keyword">const</span> arr3 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>); <span class="hljs-comment">// [1, 2, 3]</span>
</code></pre>
<h4 data-id="heading-7">3. Array.of()</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr1 = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">of</span>(<span class="hljs-number">7</span>); <span class="hljs-comment">// [7]</span>
<span class="hljs-keyword">const</span> arr2 = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">of</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>); <span class="hljs-comment">// [1, 2, 3]</span>
<span class="hljs-comment">// 与 new Array(7) 不同，Array.of(7) 创建的是包含一个元素 7 的数组</span>
</code></pre>
<h4 data-id="heading-8">4. Array.from()</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 从类数组对象创建</span>
<span class="hljs-keyword">const</span> arr1 = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-string">'hello'</span>); <span class="hljs-comment">// ['h', 'e', 'l', 'l', 'o']</span>
<span class="hljs-keyword">const</span> arr2 = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">5</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i); <span class="hljs-comment">// [0, 1, 2, 3, 4]</span>

<span class="hljs-comment">// 从 Set/Map 创建</span>
<span class="hljs-keyword">const</span> set = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);
<span class="hljs-keyword">const</span> arr3 = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(set); <span class="hljs-comment">// [1, 2, 3]</span>
</code></pre>
<hr/>
<h3 data-id="heading-9">数组方法分类</h3>
<h4 data-id="heading-10">增删改查方法</h4>
<h5 data-id="heading-11">push() - 在末尾添加元素</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>];
fruits.<span class="hljs-title function_">push</span>(<span class="hljs-string">'orange'</span>); <span class="hljs-comment">// 返回新长度 3</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['apple', 'banana', 'orange']</span>

<span class="hljs-comment">// 可以一次添加多个元素</span>
fruits.<span class="hljs-title function_">push</span>(<span class="hljs-string">'grape'</span>, <span class="hljs-string">'mango'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['apple', 'banana', 'orange', 'grape', 'mango']</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>修改原数组</li>
<li>返回数组的新长度</li>
<li>可以添加多个元素</li>
</ul>
<h5 data-id="heading-12">pop() - 移除并返回最后一个元素</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];
<span class="hljs-keyword">const</span> last = fruits.<span class="hljs-title function_">pop</span>(); <span class="hljs-comment">// 'orange'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['apple', 'banana']</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(last); <span class="hljs-comment">// 'orange'</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>修改原数组</li>
<li>返回被移除的元素</li>
<li>如果数组为空，返回 <code>undefined</code></li>
</ul>
<h5 data-id="heading-13">unshift() - 在开头添加元素</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];
fruits.<span class="hljs-title function_">unshift</span>(<span class="hljs-string">'apple'</span>); <span class="hljs-comment">// 返回新长度 3</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['apple', 'banana', 'orange']</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>修改原数组</li>
<li>返回数组的新长度</li>
<li>性能比 <code>push()</code> 低（需要移动所有元素）</li>
</ul>
<h5 data-id="heading-14">shift() - 移除并返回第一个元素</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];
<span class="hljs-keyword">const</span> first = fruits.<span class="hljs-title function_">shift</span>(); <span class="hljs-comment">// 'apple'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['banana', 'orange']</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>修改原数组</li>
<li>返回被移除的元素</li>
<li>性能比 <code>pop()</code> 低</li>
</ul>
<h5 data-id="heading-15">splice() - 删除、插入或替换元素</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>, <span class="hljs-string">'grape'</span>];

<span class="hljs-comment">// 删除元素：从索引 1 开始删除 2 个元素</span>
<span class="hljs-keyword">const</span> removed = fruits.<span class="hljs-title function_">splice</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['apple', 'grape']</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(removed); <span class="hljs-comment">// ['banana', 'orange']</span>

<span class="hljs-comment">// 插入元素：从索引 1 开始，删除 0 个，插入新元素</span>
fruits.<span class="hljs-title function_">splice</span>(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-string">'mango'</span>, <span class="hljs-string">'peach'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['apple', 'mango', 'peach', 'grape']</span>

<span class="hljs-comment">// 替换元素：从索引 1 开始，删除 1 个，插入新元素</span>
fruits.<span class="hljs-title function_">splice</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">'banana'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['apple', 'banana', 'peach', 'grape']</span>
</code></pre>
<p><strong>语法</strong>：<code>array.splice(start, deleteCount, ...items)</code></p>
<p><strong>特点</strong>：</p>
<ul>
<li>修改原数组</li>
<li>返回被删除元素的数组</li>
<li>功能强大，可以删除、插入、替换</li>
</ul>
<h5 data-id="heading-16">slice() - 提取数组片段（不修改原数组）</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>, <span class="hljs-string">'grape'</span>, <span class="hljs-string">'mango'</span>];

<span class="hljs-comment">// 提取从索引 1 到 3（不包括 3）的元素</span>
<span class="hljs-keyword">const</span> sliced = fruits.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sliced); <span class="hljs-comment">// ['banana', 'orange']</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// 原数组不变</span>

<span class="hljs-comment">// 只提供开始索引，提取到末尾</span>
<span class="hljs-keyword">const</span> fromIndex2 = fruits.<span class="hljs-title function_">slice</span>(<span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fromIndex2); <span class="hljs-comment">// ['orange', 'grape', 'mango']</span>

<span class="hljs-comment">// 负数索引：从末尾开始计算</span>
<span class="hljs-keyword">const</span> lastTwo = fruits.<span class="hljs-title function_">slice</span>(-<span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(lastTwo); <span class="hljs-comment">// ['grape', 'mango']</span>

<span class="hljs-comment">// 复制整个数组</span>
<span class="hljs-keyword">const</span> copy = fruits.<span class="hljs-title function_">slice</span>();
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>返回新数组</li>
<li>常用于数组复制</li>
</ul>
<hr/>
<h4 data-id="heading-17">遍历方法</h4>
<h5 data-id="heading-18">forEach() - 遍历数组</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];

numbers.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">value, index, array</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`索引 <span class="hljs-subst">${index}</span>: 值 <span class="hljs-subst">${value}</span>`</span>);
});

<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// 索引 0: 值 1</span>
<span class="hljs-comment">// 索引 1: 值 2</span>
<span class="hljs-comment">// 索引 2: 值 3</span>
<span class="hljs-comment">// 索引 3: 值 4</span>
<span class="hljs-comment">// 索引 4: 值 5</span>

<span class="hljs-comment">// 修改原数组（不推荐，但可以）</span>
<span class="hljs-keyword">const</span> doubled = [];
numbers.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> {
  doubled.<span class="hljs-title function_">push</span>(num * <span class="hljs-number">2</span>);
});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doubled); <span class="hljs-comment">// [2, 4, 6, 8, 10]</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>不返回新数组（返回 <code>undefined</code>）</li>
<li>无法使用 <code>break</code> 或 <code>continue</code>（可以使用 <code>return</code> 跳过当前迭代）</li>
<li>不会跳过空槽（稀疏数组）</li>
</ul>
<h5 data-id="heading-19">map() - 映射数组（返回新数组）</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];

<span class="hljs-comment">// 将每个数字乘以 2</span>
<span class="hljs-keyword">const</span> doubled = numbers.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num * <span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doubled); <span class="hljs-comment">// [2, 4, 6, 8, 10]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(numbers); <span class="hljs-comment">// 原数组不变 [1, 2, 3, 4, 5]</span>

<span class="hljs-comment">// 提取对象属性</span>
<span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">35</span> }
];
<span class="hljs-keyword">const</span> names = users.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> user.<span class="hljs-property">name</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(names); <span class="hljs-comment">// ['Alice', 'Bob', 'Charlie']</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>返回新数组</li>
<li>新数组长度与原数组相同</li>
<li>最常用的数组方法之一</li>
</ul>
<h5 data-id="heading-20">filter() - 过滤数组</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>];

<span class="hljs-comment">// 筛选偶数</span>
<span class="hljs-keyword">const</span> evens = numbers.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(evens); <span class="hljs-comment">// [2, 4, 6, 8, 10]</span>

<span class="hljs-comment">// 筛选对象</span>
<span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">17</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> }
];
<span class="hljs-keyword">const</span> adults = users.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> user.<span class="hljs-property">age</span> &gt;= <span class="hljs-number">18</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(adults); <span class="hljs-comment">// [{ name: 'Alice', age: 25 }, { name: 'Charlie', age: 30 }]</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>返回新数组</li>
<li>新数组长度可能小于原数组</li>
<li>回调函数返回 <code>true</code> 的元素会被保留</li>
</ul>
<h5 data-id="heading-21">reduce() - 归约数组</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];

<span class="hljs-comment">// 求和</span>
<span class="hljs-keyword">const</span> sum = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">accumulator, currentValue</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> accumulator + currentValue;
}, <span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sum); <span class="hljs-comment">// 15</span>

<span class="hljs-comment">// 简化写法</span>
<span class="hljs-keyword">const</span> sum2 = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, cur</span>) =&gt;</span> acc + cur, <span class="hljs-number">0</span>);

<span class="hljs-comment">// 求最大值</span>
<span class="hljs-keyword">const</span> max = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, cur</span>) =&gt;</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(acc, cur));

<span class="hljs-comment">// 数组转对象</span>
<span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span> }
];
<span class="hljs-keyword">const</span> userMap = users.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, user</span>) =&gt;</span> {
  acc[user.<span class="hljs-property">id</span>] = user.<span class="hljs-property">name</span>;
  <span class="hljs-keyword">return</span> acc;
}, {});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(userMap); <span class="hljs-comment">// { 1: 'Alice', 2: 'Bob', 3: 'Charlie' }</span>

<span class="hljs-comment">// 数组扁平化</span>
<span class="hljs-keyword">const</span> nested = [[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>]];
<span class="hljs-keyword">const</span> flat = nested.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, cur</span>) =&gt;</span> acc.<span class="hljs-title function_">concat</span>(cur), []);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(flat); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6]</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>返回单个值</li>
<li>功能强大，可以实现很多复杂操作</li>
<li>初始值可选（建议总是提供）</li>
</ul>
<h5 data-id="heading-22">reduceRight() - 从右到左归约</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-comment">// 从右到左计算</span>
<span class="hljs-keyword">const</span> result = numbers.<span class="hljs-title function_">reduceRight</span>(<span class="hljs-function">(<span class="hljs-params">acc, cur</span>) =&gt;</span> acc - cur);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result); <span class="hljs-comment">// -2 (4 - 3 - 2 - 1 = -2)</span>

<span class="hljs-comment">// 与 reduce 对比</span>
<span class="hljs-keyword">const</span> result2 = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, cur</span>) =&gt;</span> acc - cur);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result2); <span class="hljs-comment">// -8 (1 - 2 - 3 - 4 = -8)</span>
</code></pre>
<hr/>
<h4 data-id="heading-23">查找方法</h4>
<h5 data-id="heading-24">indexOf() - 查找元素索引</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>, <span class="hljs-string">'banana'</span>];

<span class="hljs-keyword">const</span> index = fruits.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'banana'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(index); <span class="hljs-comment">// 1</span>

<span class="hljs-comment">// 从指定位置开始查找</span>
<span class="hljs-keyword">const</span> index2 = fruits.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'banana'</span>, <span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(index2); <span class="hljs-comment">// 3</span>

<span class="hljs-comment">// 找不到返回 -1</span>
<span class="hljs-keyword">const</span> index3 = fruits.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'grape'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(index3); <span class="hljs-comment">// -1</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>使用严格相等（===）比较</li>
<li>返回第一个匹配的索引</li>
<li>找不到返回 -1</li>
</ul>
<h5 data-id="heading-25">lastIndexOf() - 从后往前查找</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>, <span class="hljs-string">'banana'</span>];

<span class="hljs-keyword">const</span> index = fruits.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-string">'banana'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(index); <span class="hljs-comment">// 3</span>
</code></pre>
<h5 data-id="heading-26">includes() - 判断是否包含元素</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'banana'</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'grape'</span>)); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 从指定位置开始查找</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'apple'</span>, <span class="hljs-number">1</span>)); <span class="hljs-comment">// false</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>返回布尔值</li>
<li>ES6 新增方法</li>
<li>比 <code>indexOf() !== -1</code> 更语义化</li>
</ul>
<h5 data-id="heading-27">find() - 查找第一个满足条件的元素</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">17</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> }
];

<span class="hljs-comment">// 查找第一个年龄大于等于 18 的用户</span>
<span class="hljs-keyword">const</span> adult = users.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> user.<span class="hljs-property">age</span> &gt;= <span class="hljs-number">18</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(adult); <span class="hljs-comment">// { id: 1, name: 'Alice', age: 25 }</span>

<span class="hljs-comment">// 找不到返回 undefined</span>
<span class="hljs-keyword">const</span> senior = users.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> user.<span class="hljs-property">age</span> &gt; <span class="hljs-number">100</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(senior); <span class="hljs-comment">// undefined</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>返回第一个匹配的元素</li>
<li>找不到返回 <code>undefined</code></li>
</ul>
<h5 data-id="heading-28">findIndex() - 查找第一个满足条件的元素索引</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">17</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> }
];

<span class="hljs-keyword">const</span> index = users.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> user.<span class="hljs-property">age</span> &gt;= <span class="hljs-number">18</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(index); <span class="hljs-comment">// 0</span>

<span class="hljs-comment">// 找不到返回 -1</span>
<span class="hljs-keyword">const</span> notFound = users.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> user.<span class="hljs-property">age</span> &gt; <span class="hljs-number">100</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(notFound); <span class="hljs-comment">// -1</span>
</code></pre>
<h5 data-id="heading-29">findLast() - 查找最后一个满足条件的元素（ES2023）</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>];

<span class="hljs-keyword">const</span> lastEven = numbers.<span class="hljs-title function_">findLast</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(lastEven); <span class="hljs-comment">// 6</span>
</code></pre>
<h5 data-id="heading-30">findLastIndex() - 查找最后一个满足条件的元素索引（ES2023）</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>];

<span class="hljs-keyword">const</span> lastEvenIndex = numbers.<span class="hljs-title function_">findLastIndex</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(lastEvenIndex); <span class="hljs-comment">// 5</span>
</code></pre>
<hr/>
<h4 data-id="heading-31">转换方法</h4>
<h5 data-id="heading-32">join() - 数组转字符串</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits.<span class="hljs-title function_">join</span>()); <span class="hljs-comment">// 'apple,banana,orange'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits.<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>)); <span class="hljs-comment">// 'applebananaorange'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits.<span class="hljs-title function_">join</span>(<span class="hljs-string">' - '</span>)); <span class="hljs-comment">// 'apple - banana - orange'</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>默认使用逗号分隔</li>
<li>空数组返回空字符串</li>
</ul>
<h5 data-id="heading-33">toString() - 转换为字符串</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits.<span class="hljs-title function_">toString</span>()); <span class="hljs-comment">// 'apple,banana,orange'</span>
<span class="hljs-comment">// 等同于 fruits.join()</span>
</code></pre>
<h5 data-id="heading-34">toLocaleString() - 本地化字符串</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1234.56</span>, <span class="hljs-number">7890.12</span>];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(numbers.<span class="hljs-title function_">toLocaleString</span>(<span class="hljs-string">'zh-CN'</span>)); <span class="hljs-comment">// '1,234.56,7,890.12'</span>
</code></pre>
<h5 data-id="heading-35">flat() - 扁平化数组</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> nested = [<span class="hljs-number">1</span>, [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">4</span>, [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>]]];

<span class="hljs-comment">// 默认只扁平化一层</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(nested.<span class="hljs-title function_">flat</span>()); <span class="hljs-comment">// [1, 2, 3, 4, [5, 6]]</span>

<span class="hljs-comment">// 指定深度</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(nested.<span class="hljs-title function_">flat</span>(<span class="hljs-number">2</span>)); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6]</span>

<span class="hljs-comment">// 扁平化所有层级</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(nested.<span class="hljs-title function_">flat</span>(<span class="hljs-title class_">Infinity</span>)); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6]</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>ES2019 新增</li>
<li>可以指定扁平化深度</li>
</ul>
<h5 data-id="heading-36">flatMap() - 映射后扁平化</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];

<span class="hljs-comment">// 相当于 map().flat()</span>
<span class="hljs-keyword">const</span> result = numbers.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> [x, x * <span class="hljs-number">2</span>]);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result); <span class="hljs-comment">// [1, 2, 2, 4, 3, 6]</span>

<span class="hljs-comment">// 与 map().flat() 对比</span>
<span class="hljs-keyword">const</span> result2 = numbers.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> [x, x * <span class="hljs-number">2</span>]).<span class="hljs-title function_">flat</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result2); <span class="hljs-comment">// [1, 2, 2, 4, 3, 6]</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>ES2019 新增</li>
<li>性能比 <code>map().flat()</code> 更好</li>
</ul>
<hr/>
<h4 data-id="heading-37">排序和反转</h4>
<h5 data-id="heading-38">sort() - 排序</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>];

<span class="hljs-comment">// 默认按字符串排序（不推荐）</span>
numbers.<span class="hljs-title function_">sort</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(numbers); <span class="hljs-comment">// [1, 1, 2, 3, 4, 5, 6, 9]</span>

<span class="hljs-comment">// 数字排序（升序）</span>
<span class="hljs-keyword">const</span> numbers2 = [<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>];
numbers2.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a - b);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(numbers2); <span class="hljs-comment">// [1, 1, 2, 3, 4, 5, 6, 9]</span>

<span class="hljs-comment">// 数字排序（降序）</span>
<span class="hljs-keyword">const</span> numbers3 = [<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>];
numbers3.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> b - a);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(numbers3); <span class="hljs-comment">// [9, 6, 5, 4, 3, 2, 1, 1]</span>

<span class="hljs-comment">// 对象排序</span>
<span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">17</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> }
];
users.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a.<span class="hljs-property">age</span> - b.<span class="hljs-property">age</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(users);
<span class="hljs-comment">// [{ name: 'Bob', age: 17 }, { name: 'Alice', age: 25 }, { name: 'Charlie', age: 30 }]</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>修改原数组</strong></li>
<li>默认按字符串 Unicode 码点排序</li>
<li>需要提供比较函数进行数字排序</li>
</ul>
<h5 data-id="heading-39">reverse() - 反转数组</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];
fruits.<span class="hljs-title function_">reverse</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['orange', 'banana', 'apple']</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>修改原数组</strong></li>
<li>返回反转后的数组（原数组的引用）</li>
</ul>
<h5 data-id="heading-40">toSorted() - 排序（不修改原数组，ES2023）</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>];
<span class="hljs-keyword">const</span> sorted = numbers.<span class="hljs-title function_">toSorted</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a - b);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sorted); <span class="hljs-comment">// [1, 1, 3, 4, 5]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(numbers); <span class="hljs-comment">// [3, 1, 4, 1, 5] 原数组不变</span>
</code></pre>
<h5 data-id="heading-41">toReversed() - 反转（不修改原数组，ES2023）</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];
<span class="hljs-keyword">const</span> reversed = fruits.<span class="hljs-title function_">toReversed</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(reversed); <span class="hljs-comment">// ['orange', 'banana', 'apple']</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['apple', 'banana', 'orange'] 原数组不变</span>
</code></pre>
<hr/>
<h4 data-id="heading-42">判断方法</h4>
<h5 data-id="heading-43">every() - 判断是否所有元素都满足条件</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">10</span>];

<span class="hljs-comment">// 判断是否都是偶数</span>
<span class="hljs-keyword">const</span> allEven = numbers.<span class="hljs-title function_">every</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(allEven); <span class="hljs-comment">// true</span>

<span class="hljs-keyword">const</span> numbers2 = [<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>];
<span class="hljs-keyword">const</span> allEven2 = numbers2.<span class="hljs-title function_">every</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(allEven2); <span class="hljs-comment">// false</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>返回布尔值</li>
<li>空数组返回 <code>true</code>（空真值）</li>
</ul>
<h5 data-id="heading-44">some() - 判断是否有元素满足条件</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>];

<span class="hljs-comment">// 判断是否有偶数</span>
<span class="hljs-keyword">const</span> hasEven = numbers.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(hasEven); <span class="hljs-comment">// true</span>

<span class="hljs-keyword">const</span> numbers2 = [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>];
<span class="hljs-keyword">const</span> hasEven2 = numbers2.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(hasEven2); <span class="hljs-comment">// false</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>返回布尔值</li>
<li>空数组返回 <code>false</code></li>
</ul>
<hr/>
<h4 data-id="heading-45">归约方法</h4>
<h5 data-id="heading-46">reduce() 和 reduceRight()</h5>
<p>已在前面详细介绍，这里不再重复。</p>
<hr/>
<h4 data-id="heading-47">ES6+ 新方法</h4>
<h5 data-id="heading-48">Array.from() - 从类数组创建数组</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 从字符串</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-string">'hello'</span>); <span class="hljs-comment">// ['h', 'e', 'l', 'l', 'o']</span>

<span class="hljs-comment">// 从 Set</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])); <span class="hljs-comment">// [1, 2, 3]</span>

<span class="hljs-comment">// 从对象（需要 length 属性）</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">5</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i); <span class="hljs-comment">// [0, 1, 2, 3, 4]</span>

<span class="hljs-comment">// 从 NodeList</span>
<span class="hljs-keyword">const</span> divs = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'div'</span>);
<span class="hljs-keyword">const</span> divArray = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(divs);
</code></pre>
<h5 data-id="heading-49">Array.of() - 创建数组</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Array</span>.<span class="hljs-title function_">of</span>(<span class="hljs-number">7</span>); <span class="hljs-comment">// [7]</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">of</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>); <span class="hljs-comment">// [1, 2, 3]</span>
<span class="hljs-comment">// 与 new Array(7) 不同</span>
</code></pre>
<h5 data-id="heading-50">fill() - 填充数组</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 填充整个数组</span>
<span class="hljs-keyword">const</span> arr1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">5</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr1); <span class="hljs-comment">// [0, 0, 0, 0, 0]</span>

<span class="hljs-comment">// 从指定位置填充</span>
<span class="hljs-keyword">const</span> arr2 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
arr2.<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr2); <span class="hljs-comment">// [1, 2, 0, 0, 5]</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>修改原数组</strong></li>
<li>可以指定填充的起始和结束位置</li>
</ul>
<h5 data-id="heading-51">copyWithin() - 复制数组元素</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];

<span class="hljs-comment">// 将索引 0-2 的元素复制到索引 3 开始的位置</span>
arr.<span class="hljs-title function_">copyWithin</span>(<span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr); <span class="hljs-comment">// [1, 2, 3, 1, 2]</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>修改原数组</strong></li>
<li>使用场景较少</li>
</ul>
<h5 data-id="heading-52">entries() - 返回键值对迭代器</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [index, value] <span class="hljs-keyword">of</span> fruits.<span class="hljs-title function_">entries</span>()) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(index, value);
}
<span class="hljs-comment">// 0 'apple'</span>
<span class="hljs-comment">// 1 'banana'</span>
<span class="hljs-comment">// 2 'orange'</span>
</code></pre>
<h5 data-id="heading-53">keys() - 返回键迭代器</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> index <span class="hljs-keyword">of</span> fruits.<span class="hljs-title function_">keys</span>()) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(index);
}
<span class="hljs-comment">// 0</span>
<span class="hljs-comment">// 1</span>
<span class="hljs-comment">// 2</span>
</code></pre>
<h5 data-id="heading-54">values() - 返回值迭代器</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> value <span class="hljs-keyword">of</span> fruits.<span class="hljs-title function_">values</span>()) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value);
}
<span class="hljs-comment">// 'apple'</span>
<span class="hljs-comment">// 'banana'</span>
<span class="hljs-comment">// 'orange'</span>
</code></pre>
<h5 data-id="heading-55">at() - 按索引访问（支持负数，ES2022）</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits.<span class="hljs-title function_">at</span>(<span class="hljs-number">0</span>)); <span class="hljs-comment">// 'apple'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits.<span class="hljs-title function_">at</span>(-<span class="hljs-number">1</span>)); <span class="hljs-comment">// 'orange'（最后一个）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits.<span class="hljs-title function_">at</span>(-<span class="hljs-number">2</span>)); <span class="hljs-comment">// 'banana'（倒数第二个）</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>支持负数索引</li>
<li>比 <code>fruits[fruits.length - 1]</code> 更优雅</li>
</ul>
<h5 data-id="heading-56">with() - 修改指定索引的值（不修改原数组，ES2023）</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];
<span class="hljs-keyword">const</span> newFruits = fruits.<span class="hljs-title function_">with</span>(<span class="hljs-number">1</span>, <span class="hljs-string">'grape'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(newFruits); <span class="hljs-comment">// ['apple', 'grape', 'orange']</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['apple', 'banana', 'orange'] 原数组不变</span>
</code></pre>
<h5 data-id="heading-57">toSpliced() - 删除、插入或替换（不修改原数组，ES2023）</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];
<span class="hljs-keyword">const</span> newFruits = fruits.<span class="hljs-title function_">toSpliced</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">'grape'</span>, <span class="hljs-string">'mango'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(newFruits); <span class="hljs-comment">// ['apple', 'grape', 'mango', 'orange']</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['apple', 'banana', 'orange'] 原数组不变</span>
</code></pre>
<hr/>
<h3 data-id="heading-58">方法对比与选择</h3>
<h4 data-id="heading-59">修改原数组 vs 不修改原数组</h4>

























<table><thead><tr><th>修改原数组</th><th>不修改原数组</th></tr></thead><tbody><tr><td>push, pop, shift, unshift</td><td>map, filter, slice</td></tr><tr><td>splice, sort, reverse</td><td>concat, join, toString</td></tr><tr><td>fill, copyWithin</td><td>flat, flatMap</td></tr><tr><td/><td>toSorted, toReversed, with, toSpliced</td></tr></tbody></table>
<p><strong>选择建议</strong>：</p>
<ul>
<li>优先使用不修改原数组的方法（函数式编程）</li>
<li>需要修改原数组时，明确知道副作用</li>
</ul>
<h4 data-id="heading-60">查找方法对比</h4>



































<table><thead><tr><th>方法</th><th>返回值</th><th>使用场景</th></tr></thead><tbody><tr><td>indexOf</td><td>索引或 -1</td><td>简单值查找</td></tr><tr><td>includes</td><td>布尔值</td><td>判断是否存在</td></tr><tr><td>find</td><td>元素或 undefined</td><td>对象查找</td></tr><tr><td>findIndex</td><td>索引或 -1</td><td>对象查找索引</td></tr><tr><td>some</td><td>布尔值</td><td>判断是否有满足条件的元素</td></tr></tbody></table>
<h4 data-id="heading-61">遍历方法对比</h4>









































<table><thead><tr><th>方法</th><th>返回值</th><th>是否可中断</th><th>使用场景</th></tr></thead><tbody><tr><td>forEach</td><td>undefined</td><td>否</td><td>简单遍历</td></tr><tr><td>map</td><td>新数组</td><td>否</td><td>转换数组</td></tr><tr><td>filter</td><td>新数组</td><td>否</td><td>过滤数组</td></tr><tr><td>for...of</td><td>-</td><td>是</td><td>需要中断的遍历</td></tr><tr><td>reduce</td><td>单个值</td><td>否</td><td>归约计算</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-62">最佳实践</h3>
<h4 data-id="heading-63">1. 链式调用</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>];

<span class="hljs-comment">// 链式调用多个方法</span>
<span class="hljs-keyword">const</span> result = numbers
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>)  <span class="hljs-comment">// [2, 4, 6, 8, 10]</span>
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num * <span class="hljs-number">2</span>)            <span class="hljs-comment">// [4, 8, 12, 16, 20]</span>
  .<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, num</span>) =&gt;</span> sum + num, <span class="hljs-number">0</span>); <span class="hljs-comment">// 60</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result); <span class="hljs-comment">// 60</span>
</code></pre>
<h4 data-id="heading-64">2. 避免在遍历中修改数组</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 不推荐：在 forEach 中修改数组长度</span>
<span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
numbers.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">num, index</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>) {
    numbers.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>); <span class="hljs-comment">// 危险！会跳过元素</span>
  }
});

<span class="hljs-comment">// ✅ 推荐：使用 filter</span>
<span class="hljs-keyword">const</span> numbers2 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
<span class="hljs-keyword">const</span> odds = numbers2.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num % <span class="hljs-number">2</span> !== <span class="hljs-number">0</span>);
</code></pre>
<h4 data-id="heading-65">3. 使用解构赋值</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 交换变量</span>
<span class="hljs-keyword">let</span> a = <span class="hljs-number">1</span>, b = <span class="hljs-number">2</span>;
[a, b] = [b, a];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a, b); <span class="hljs-comment">// 2, 1</span>

<span class="hljs-comment">// 获取第一个和剩余元素</span>
<span class="hljs-keyword">const</span> [first, ...rest] = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(first); <span class="hljs-comment">// 1</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(rest); <span class="hljs-comment">// [2, 3, 4, 5]</span>
</code></pre>
<h4 data-id="heading-66">4. 性能优化</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 不推荐：多次遍历</span>
<span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
<span class="hljs-keyword">const</span> evens = numbers.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>);
<span class="hljs-keyword">const</span> doubled = evens.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n * <span class="hljs-number">2</span>);
<span class="hljs-keyword">const</span> sum = doubled.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>);

<span class="hljs-comment">// ✅ 推荐：单次遍历</span>
<span class="hljs-keyword">const</span> sum2 = numbers
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n * <span class="hljs-number">2</span>)
  .<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>);

<span class="hljs-comment">// ✅ 更推荐：使用 reduce 一次完成</span>
<span class="hljs-keyword">const</span> sum3 = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, n</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (n % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> acc + n * <span class="hljs-number">2</span>;
  }
  <span class="hljs-keyword">return</span> acc;
}, <span class="hljs-number">0</span>);
</code></pre>
<h4 data-id="heading-67">5. 处理空值和边界情况</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 安全的数组操作</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">safeArrayOperation</span>(<span class="hljs-params">arr</span>) {
  <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(arr) || arr.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> [];
  }
  <span class="hljs-keyword">return</span> arr.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item * <span class="hljs-number">2</span>);
}

<span class="hljs-comment">// 使用可选链和空值合并</span>
<span class="hljs-keyword">const</span> result = array?.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x * <span class="hljs-number">2</span>) ?? [];
</code></pre>
<h4 data-id="heading-68">6. 数组去重</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 方法 1：使用 Set</span>
<span class="hljs-keyword">const</span> unique1 = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>])];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(unique1); <span class="hljs-comment">// [1, 2, 3]</span>

<span class="hljs-comment">// 方法 2：使用 filter + indexOf</span>
<span class="hljs-keyword">const</span> unique2 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>].<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item, index, arr</span>) =&gt;</span> 
  arr.<span class="hljs-title function_">indexOf</span>(item) === index
);

<span class="hljs-comment">// 方法 3：对象数组去重</span>
<span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> }
];
<span class="hljs-keyword">const</span> uniqueUsers = users.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">user, index, arr</span>) =&gt;</span> 
  arr.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> u.<span class="hljs-property">id</span> === user.<span class="hljs-property">id</span>) === index
);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(uniqueUsers); <span class="hljs-comment">// [{ id: 1, name: 'Alice' }, { id: 2, name: 'Bob' }]</span>

<span class="hljs-comment">// 方法 4：使用 Map（性能更好）</span>
<span class="hljs-keyword">const</span> uniqueUsers2 = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(users.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> [user.<span class="hljs-property">id</span>, user])).<span class="hljs-title function_">values</span>()
);
</code></pre>
<h4 data-id="heading-69">7. 数组分组</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 reduce 实现分组</span>
<span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>, <span class="hljs-attr">city</span>: <span class="hljs-string">'Beijing'</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">city</span>: <span class="hljs-string">'Shanghai'</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>, <span class="hljs-attr">city</span>: <span class="hljs-string">'Beijing'</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'David'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">city</span>: <span class="hljs-string">'Shanghai'</span> }
];

<span class="hljs-comment">// 按城市分组</span>
<span class="hljs-keyword">const</span> groupedByCity = users.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, user</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> city = user.<span class="hljs-property">city</span>;
  <span class="hljs-keyword">if</span> (!acc[city]) {
    acc[city] = [];
  }
  acc[city].<span class="hljs-title function_">push</span>(user);
  <span class="hljs-keyword">return</span> acc;
}, {});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(groupedByCity);
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   Beijing: [{ name: 'Alice', ... }, { name: 'Charlie', ... }],</span>
<span class="hljs-comment">//   Shanghai: [{ name: 'Bob', ... }, { name: 'David', ... }]</span>
<span class="hljs-comment">// }</span>

<span class="hljs-comment">// 按年龄分组</span>
<span class="hljs-keyword">const</span> groupedByAge = users.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, user</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> age = user.<span class="hljs-property">age</span>;
  acc[age] = acc[age] || [];
  acc[age].<span class="hljs-title function_">push</span>(user);
  <span class="hljs-keyword">return</span> acc;
}, {});
</code></pre>
<h4 data-id="heading-70">8. 数组分块</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 将数组分割成指定大小的块</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">chunk</span>(<span class="hljs-params">array, size</span>) {
  <span class="hljs-keyword">const</span> chunks = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; array.<span class="hljs-property">length</span>; i += size) {
    chunks.<span class="hljs-title function_">push</span>(array.<span class="hljs-title function_">slice</span>(i, i + size));
  }
  <span class="hljs-keyword">return</span> chunks;
}

<span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">chunk</span>(numbers, <span class="hljs-number">3</span>)); <span class="hljs-comment">// [[1, 2, 3], [4, 5, 6], [7, 8, 9]]</span>

<span class="hljs-comment">// 使用 reduce 实现</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">chunk2</span> = (<span class="hljs-params">array, size</span>) =&gt; 
  array.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, _, i</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (i % size === <span class="hljs-number">0</span>) {
      acc.<span class="hljs-title function_">push</span>(array.<span class="hljs-title function_">slice</span>(i, i + size));
    }
    <span class="hljs-keyword">return</span> acc;
  }, []);
</code></pre>
<h4 data-id="heading-71">9. 数组合并</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// concat() - 合并数组（不修改原数组）</span>
<span class="hljs-keyword">const</span> arr1 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">const</span> arr2 = [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>];
<span class="hljs-keyword">const</span> arr3 = arr1.<span class="hljs-title function_">concat</span>(arr2);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr3); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr1); <span class="hljs-comment">// [1, 2, 3] 原数组不变</span>

<span class="hljs-comment">// 使用扩展运算符（推荐）</span>
<span class="hljs-keyword">const</span> arr4 = [...arr1, ...arr2];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr4); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6]</span>

<span class="hljs-comment">// 合并多个数组</span>
<span class="hljs-keyword">const</span> arr5 = [<span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>];
<span class="hljs-keyword">const</span> merged = [...arr1, ...arr2, ...arr5];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(merged); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6, 7, 8, 9]</span>
</code></pre>
<h4 data-id="heading-72">10. 数组交集、并集、差集</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr1 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
<span class="hljs-keyword">const</span> arr2 = [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>];

<span class="hljs-comment">// 交集：两个数组都有的元素</span>
<span class="hljs-keyword">const</span> intersection = arr1.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> arr2.<span class="hljs-title function_">includes</span>(item));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(intersection); <span class="hljs-comment">// [4, 5]</span>

<span class="hljs-comment">// 并集：两个数组的所有元素（去重）</span>
<span class="hljs-keyword">const</span> union = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([...arr1, ...arr2])];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(union); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6, 7, 8]</span>

<span class="hljs-comment">// 差集：arr1 有但 arr2 没有的元素</span>
<span class="hljs-keyword">const</span> difference = arr1.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> !arr2.<span class="hljs-title function_">includes</span>(item));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(difference); <span class="hljs-comment">// [1, 2, 3]</span>

<span class="hljs-comment">// 对称差集：两个数组独有的元素</span>
<span class="hljs-keyword">const</span> symmetricDifference = [
  ...arr1.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> !arr2.<span class="hljs-title function_">includes</span>(item)),
  ...arr2.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> !arr1.<span class="hljs-title function_">includes</span>(item))
];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(symmetricDifference); <span class="hljs-comment">// [1, 2, 3, 6, 7, 8]</span>
</code></pre>
<h4 data-id="heading-73">11. 数组随机打乱</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Fisher-Yates 洗牌算法</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">shuffle</span>(<span class="hljs-params">array</span>) {
  <span class="hljs-keyword">const</span> arr = [...array]; <span class="hljs-comment">// 避免修改原数组</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = arr.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt; <span class="hljs-number">0</span>; i--) {
    <span class="hljs-keyword">const</span> j = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * (i + <span class="hljs-number">1</span>));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  <span class="hljs-keyword">return</span> arr;
}

<span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">shuffle</span>(numbers)); <span class="hljs-comment">// 随机顺序</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(numbers); <span class="hljs-comment">// [1, 2, 3, 4, 5] 原数组不变</span>
</code></pre>
<h4 data-id="heading-74">12. 数组扁平化（多种方法）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> nested = [<span class="hljs-number">1</span>, [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">4</span>, [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>]]];

<span class="hljs-comment">// 方法 1：使用 flat()</span>
<span class="hljs-keyword">const</span> flat1 = nested.<span class="hljs-title function_">flat</span>(<span class="hljs-title class_">Infinity</span>);

<span class="hljs-comment">// 方法 2：使用 reduce + concat</span>
<span class="hljs-keyword">const</span> flat2 = nested.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, cur</span>) =&gt;</span> 
  acc.<span class="hljs-title function_">concat</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(cur) ? <span class="hljs-title function_">flat2</span>(cur) : cur), []
);

<span class="hljs-comment">// 方法 3：使用扩展运算符（仅一层）</span>
<span class="hljs-keyword">const</span> flat3 = [].<span class="hljs-title function_">concat</span>(...nested);

<span class="hljs-comment">// 方法 4：使用 toString()（仅适用于数字）</span>
<span class="hljs-keyword">const</span> numbers = [[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]];
<span class="hljs-keyword">const</span> flat4 = numbers.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">split</span>(<span class="hljs-string">','</span>).<span class="hljs-title function_">map</span>(<span class="hljs-title class_">Number</span>);
</code></pre>
<h4 data-id="heading-75">13. 数组统计</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>];

<span class="hljs-comment">// 求和</span>
<span class="hljs-keyword">const</span> sum = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>);

<span class="hljs-comment">// 平均值</span>
<span class="hljs-keyword">const</span> average = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / numbers.<span class="hljs-property">length</span>;

<span class="hljs-comment">// 最大值和最小值</span>
<span class="hljs-keyword">const</span> max = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...numbers);
<span class="hljs-keyword">const</span> min = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(...numbers);

<span class="hljs-comment">// 使用 reduce 求最大值和最小值</span>
<span class="hljs-keyword">const</span> max2 = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(a, b));
<span class="hljs-keyword">const</span> min2 = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(a, b));

<span class="hljs-comment">// 统计元素出现次数</span>
<span class="hljs-keyword">const</span> count = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, num</span>) =&gt;</span> {
  acc[num] = (acc[num] || <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>;
  <span class="hljs-keyword">return</span> acc;
}, {});
</code></pre>
<h4 data-id="heading-76">14. 数组转对象</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 键值对数组转对象</span>
<span class="hljs-keyword">const</span> entries = [[<span class="hljs-string">'name'</span>, <span class="hljs-string">'Alice'</span>], [<span class="hljs-string">'age'</span>, <span class="hljs-number">25</span>], [<span class="hljs-string">'city'</span>, <span class="hljs-string">'Beijing'</span>]];
<span class="hljs-keyword">const</span> obj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">fromEntries</span>(entries);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj); <span class="hljs-comment">// { name: 'Alice', age: 25, city: 'Beijing' }</span>

<span class="hljs-comment">// 对象数组转对象（以某个属性为键）</span>
<span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span> }
];
<span class="hljs-keyword">const</span> userMap = users.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, user</span>) =&gt;</span> {
  acc[user.<span class="hljs-property">id</span>] = user;
  <span class="hljs-keyword">return</span> acc;
}, {});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(userMap);
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   1: { id: 1, name: 'Alice' },</span>
<span class="hljs-comment">//   2: { id: 2, name: 'Bob' },</span>
<span class="hljs-comment">//   3: { id: 3, name: 'Charlie' }</span>
<span class="hljs-comment">// }</span>
</code></pre>
<h4 data-id="heading-77">15. 数组补全方法补充</h4>
<h5 data-id="heading-78">concat() - 合并数组</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr1 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">const</span> arr2 = [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>];

<span class="hljs-comment">// 合并数组</span>
<span class="hljs-keyword">const</span> merged = arr1.<span class="hljs-title function_">concat</span>(arr2);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(merged); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6]</span>

<span class="hljs-comment">// 可以合并多个数组</span>
<span class="hljs-keyword">const</span> arr3 = [<span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>];
<span class="hljs-keyword">const</span> all = arr1.<span class="hljs-title function_">concat</span>(arr2, arr3);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(all); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6, 7, 8, 9]</span>

<span class="hljs-comment">// 也可以合并值</span>
<span class="hljs-keyword">const</span> withValues = arr1.<span class="hljs-title function_">concat</span>(<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, [<span class="hljs-number">6</span>, <span class="hljs-number">7</span>]);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(withValues); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6, 7]</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>返回新数组</li>
<li>可以合并多个数组或值</li>
</ul>
<hr/>
<h3 data-id="heading-79">常见应用场景</h3>
<h4 data-id="heading-80">场景 1：数据处理和转换</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 从 API 获取数据后处理</span>
<span class="hljs-keyword">const</span> apiData = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'active'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'inactive'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'active'</span> }
];

<span class="hljs-comment">// 提取活跃用户的名字</span>
<span class="hljs-keyword">const</span> activeUsers = apiData
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> user.<span class="hljs-property">status</span> === <span class="hljs-string">'active'</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> user.<span class="hljs-property">name</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(activeUsers); <span class="hljs-comment">// ['Alice', 'Charlie']</span>
</code></pre>
<h4 data-id="heading-81">场景 2：表单验证</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 验证表单字段</span>
<span class="hljs-keyword">const</span> formFields = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'username'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'alice'</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'email'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'age'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'25'</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">false</span> }
];

<span class="hljs-comment">// 检查必填字段是否都已填写</span>
<span class="hljs-keyword">const</span> isValid = formFields
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> field.<span class="hljs-property">required</span>)
  .<span class="hljs-title function_">every</span>(<span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> field.<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>() !== <span class="hljs-string">''</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(isValid); <span class="hljs-comment">// false（email 为空）</span>
</code></pre>
<h4 data-id="heading-82">场景 3：购物车计算</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cart = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'商品A'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-number">2</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'商品B'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-number">1</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'商品C'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">50</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-number">3</span> }
];

<span class="hljs-comment">// 计算总价</span>
<span class="hljs-keyword">const</span> total = cart.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, item</span>) =&gt;</span> 
  sum + item.<span class="hljs-property">price</span> * item.<span class="hljs-property">quantity</span>, <span class="hljs-number">0</span>
);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(total); <span class="hljs-comment">// 450</span>

<span class="hljs-comment">// 计算商品总数</span>
<span class="hljs-keyword">const</span> totalQuantity = cart.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, item</span>) =&gt;</span> 
  sum + item.<span class="hljs-property">quantity</span>, <span class="hljs-number">0</span>
);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(totalQuantity); <span class="hljs-comment">// 6</span>
</code></pre>
<h4 data-id="heading-83">场景 4：数据筛选和搜索</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> products = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'iPhone'</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'手机'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">5000</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'iPad'</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'平板'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">3000</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'MacBook'</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'电脑'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">10000</span> }
];

<span class="hljs-comment">// 按价格筛选</span>
<span class="hljs-keyword">const</span> affordable = products.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.<span class="hljs-property">price</span> &lt; <span class="hljs-number">5000</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(affordable); <span class="hljs-comment">// [{ id: 2, name: 'iPad', ... }]</span>

<span class="hljs-comment">// 搜索功能</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">searchProducts</span>(<span class="hljs-params">products, keyword</span>) {
  <span class="hljs-keyword">return</span> products.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> 
    product.<span class="hljs-property">name</span>.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">includes</span>(keyword.<span class="hljs-title function_">toLowerCase</span>())
  );
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">searchProducts</span>(products, <span class="hljs-string">'phone'</span>)); 
<span class="hljs-comment">// [{ id: 1, name: 'iPhone', ... }]</span>
</code></pre>
<h4 data-id="heading-84">场景 5：数据分组和聚合</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> orders = [
  { <span class="hljs-attr">date</span>: <span class="hljs-string">'2024-01-01'</span>, <span class="hljs-attr">amount</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'电子产品'</span> },
  { <span class="hljs-attr">date</span>: <span class="hljs-string">'2024-01-01'</span>, <span class="hljs-attr">amount</span>: <span class="hljs-number">50</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'食品'</span> },
  { <span class="hljs-attr">date</span>: <span class="hljs-string">'2024-01-02'</span>, <span class="hljs-attr">amount</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'电子产品'</span> },
  { <span class="hljs-attr">date</span>: <span class="hljs-string">'2024-01-02'</span>, <span class="hljs-attr">amount</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'食品'</span> }
];

<span class="hljs-comment">// 按日期分组并计算总金额</span>
<span class="hljs-keyword">const</span> dailyTotal = orders.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, order</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> date = order.<span class="hljs-property">date</span>;
  acc[date] = (acc[date] || <span class="hljs-number">0</span>) + order.<span class="hljs-property">amount</span>;
  <span class="hljs-keyword">return</span> acc;
}, {});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dailyTotal);
<span class="hljs-comment">// { '2024-01-01': 150, '2024-01-02': 230 }</span>

<span class="hljs-comment">// 按类别分组</span>
<span class="hljs-keyword">const</span> categoryTotal = orders.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, order</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> category = order.<span class="hljs-property">category</span>;
  acc[category] = (acc[category] || <span class="hljs-number">0</span>) + order.<span class="hljs-property">amount</span>;
  <span class="hljs-keyword">return</span> acc;
}, {});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(categoryTotal);
<span class="hljs-comment">// { '电子产品': 300, '食品': 80 }</span>
</code></pre>
<hr/>
<h3 data-id="heading-85">性能注意事项</h3>
<h4 data-id="heading-86">1. 方法选择</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 性能较差：多次遍历</span>
<span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
<span class="hljs-keyword">const</span> evens = numbers.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>);
<span class="hljs-keyword">const</span> doubled = evens.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n * <span class="hljs-number">2</span>);

<span class="hljs-comment">// ✅ 性能较好：单次遍历</span>
<span class="hljs-keyword">const</span> doubled2 = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, n</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (n % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>) {
    acc.<span class="hljs-title function_">push</span>(n * <span class="hljs-number">2</span>);
  }
  <span class="hljs-keyword">return</span> acc;
}, []);
</code></pre>
<h4 data-id="heading-87">2. 大数组处理</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 对于大数组，考虑使用 for 循环</span>
<span class="hljs-keyword">const</span> largeArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">1000000</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i);

<span class="hljs-comment">// ❌ 可能较慢</span>
<span class="hljs-keyword">const</span> result1 = largeArray.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x * <span class="hljs-number">2</span>);

<span class="hljs-comment">// ✅ 可能更快</span>
<span class="hljs-keyword">const</span> result2 = [];
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; largeArray.<span class="hljs-property">length</span>; i++) {
  result2[i] = largeArray[i] * <span class="hljs-number">2</span>;
}
</code></pre>
<h4 data-id="heading-88">3. 提前退出</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 some() 或 find() 可以提前退出</span>
<span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>];

<span class="hljs-comment">// ✅ 找到第一个偶数就停止</span>
<span class="hljs-keyword">const</span> firstEven = numbers.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>);

<span class="hljs-comment">// ❌ 会遍历所有元素</span>
<span class="hljs-keyword">const</span> firstEven2 = numbers.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>)[<span class="hljs-number">0</span>];
</code></pre>
<hr/>
<h3 data-id="heading-89">总结</h3>
<p>JavaScript 数组提供了丰富而强大的方法，掌握这些方法可以大大提高开发效率。以下是关键要点：</p>
<h4 data-id="heading-90">核心方法分类</h4>
<ol>
<li><strong>增删改查</strong>：<code>push</code>, <code>pop</code>, <code>shift</code>, <code>unshift</code>, <code>splice</code>, <code>slice</code></li>
<li><strong>遍历转换</strong>：<code>forEach</code>, <code>map</code>, <code>filter</code>, <code>reduce</code></li>
<li><strong>查找判断</strong>：<code>find</code>, <code>findIndex</code>, <code>includes</code>, <code>some</code>, <code>every</code></li>
<li><strong>排序反转</strong>：<code>sort</code>, <code>reverse</code>, <code>toSorted</code>, <code>toReversed</code></li>
<li><strong>转换方法</strong>：<code>join</code>, <code>flat</code>, <code>flatMap</code>, <code>concat</code></li>
</ol>
<h4 data-id="heading-91">选择原则</h4>
<ul>
<li><strong>优先使用不修改原数组的方法</strong>（函数式编程）</li>
<li><strong>根据需求选择合适的方法</strong>（查找用 <code>find</code>，判断用 <code>some/every</code>）</li>
<li><strong>链式调用提高代码可读性</strong></li>
<li><strong>注意性能，大数组考虑使用传统循环</strong></li>
</ul>
<h4 data-id="heading-92">最佳实践</h4>
<ol>
<li>✅ 使用 <code>map</code> 转换数组</li>
<li>✅ 使用 <code>filter</code> 过滤数组</li>
<li>✅ 使用 <code>reduce</code> 进行复杂计算</li>
<li>✅ 使用 <code>find</code> 查找元素</li>
<li>✅ 使用 <code>includes</code> 判断存在性</li>
<li>❌ 避免在遍历中修改数组</li>
<li>❌ 避免不必要的多次遍历</li>
</ol>
<h4 data-id="heading-93">学习建议</h4>
<ol>
<li><strong>理解每个方法的返回值</strong>：是否修改原数组、返回什么类型</li>
<li><strong>掌握链式调用</strong>：组合使用多个方法</li>
<li><strong>熟悉常见场景</strong>：去重、分组、统计等</li>
<li><strong>注意边界情况</strong>：空数组、undefined、null 等</li>
<li><strong>关注性能</strong>：大数组时选择合适的方法</li>
</ol>
<p>希望这篇指南能帮助你更好地掌握 JavaScript 数组方法，在实际开发中灵活运用！</p>
<hr/>
<h3 data-id="heading-94">参考资源</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FArray" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" ref="nofollow noopener noreferrer">MDN Array 文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftc39.es%2Fecma262%2F" target="_blank" title="https://tc39.es/ecma262/" ref="nofollow noopener noreferrer">ECMAScript 规范</a></li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Solidity 学习历程]]></title>    <link>https://juejin.cn/post/7571005216910868499</link>    <guid>https://juejin.cn/post/7571005216910868499</guid>    <pubDate>2025-11-11T06:41:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571005216910868499" data-draft-id="7570995368739438634" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Solidity 学习历程"/> <meta itemprop="keywords" content="Solidity"/> <meta itemprop="datePublished" content="2025-11-11T06:41:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cainiaoeba"/> <meta itemprop="url" content="https://juejin.cn/user/4302806371543898"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Solidity 学习历程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4302806371543898/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cainiaoeba
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:41:53.000Z" title="Tue Nov 11 2025 06:41:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><hr/>
<h3 data-id="heading-0">从计数器到投票站：我的Solidity智能合约入门三部曲</h3>
<p>大家好，我是C。最近我一头扎进了Web3的世界，从最基础的Solidity智能合约开始学起。学习曲线或许陡峭，但每当一个合约在测试链上成功运行，那种成就感是无与伦比的。</p>
<p>今天，我想和大家分享我的入门学习路径——三个难度递增的经典合约：<strong>点击计数器 (ClickCounter)</strong>、<strong>名字存储器 (SaveMyName)</strong> 和 <strong>投票站 (PollStation)</strong>。这“三部曲”就像是为新手铺设的阶梯，每一步都建立在前一步的基础上，让你平滑地掌握核心概念。</p>
<p>希望这篇文章能像一本清晰的笔记，帮助正在入门的你，也欢迎各位大佬指点！</p>
<hr/>
<h4 data-id="heading-1">第一站：ClickCounter - 智能合约的 "Hello, World!"</h4>
<p>万事开头难，但<code>ClickCounter</code>合约完美地解决了这个问题。它的功能极其简单：在区块链上记录一个数字，并且允许任何人调用一个函数来让这个数字加一。这不就是我们学习任何编程语言时都会写的计数器吗？但在区块链上，它有了全新的意义。</p>
<p><strong>核心知识点：</strong></p>
<ol>
<li><strong>状态变量（State Variables）</strong>: 存储在区块链上的数据。</li>
<li><strong>函数（Functions）</strong>: 与合约交互的入口。</li>
<li><code>public</code> <strong>可见性修饰符</strong>: 允许任何人（包括外部账户和其他合约）调用或读取。</li>
</ol>
<p><strong>合约代码解析：</strong></p>
<p>下面是<code>ClickCounter</code>的完整代码，它非常简洁，是理解合约基本结构的绝佳范例。</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

/**
 * @title ClickCounter
 * @dev 一个简单的计数器合约，每次调用increment函数，count就会加1。
 */
contract ClickCounter {
    // 定义一个名为 count 的公共无符号整型变量
    // `public` 关键字会自动为我们创建一个同名的 getter 函数 (count())
    uint public count;

    /**
     * @dev 构造函数，在合约部署时执行一次。
     *      这里我们将 count 初始化为 0。
     */
    constructor() {
        count = 0;
    }

    /**
     * @dev 将 count 的值加 1。
     *      这是一个会修改状态的函数，所以它是一笔“交易”(Transaction)。
     */
    function increment() public {
        count++;
    }
}
</code></pre>
<p><strong>学习总结：</strong>
通过这个合约，我第一次理解了什么是“状态”。<code>count</code>变量的值被永久地记录在了区块链上，任何人都可以通过读取<code>count()</code>来查看它的当前值。而每次调用<code>increment()</code>函数，都是在发起一笔交易（Transaction），这笔交易会消耗Gas，因为它改变了链上的状态。</p>
<p>这个小小的计数器，让我直观地感受到了区块链的“全局共享状态机”这个概念。</p>
<hr/>
<h4 data-id="heading-2">第二站：SaveMyName - 开始与字符串和映射打交道</h4>
<p>掌握了基础的数字操作后，我们进入第二站：<code>SaveMyName</code>。这个合约的功能是让每个用户（由他们的以太坊地址标识）都能在链上存储一个属于自己的名字（字符串）。</p>
<p><strong>核心知识点：</strong></p>
<ol>
<li><strong>字符串（string）</strong>: Solidity中的一种数据类型，用于存储文本。</li>
<li><strong>映射（Mapping）</strong>: 强大的键值对存储结构，类似其他语言中的哈希表或字典。</li>
<li><code>address</code>: 以太坊账户地址的专属类型。</li>
<li><code>msg.sender</code>: 一个全局变量，代表当前调用函数的账户地址。</li>
</ol>
<p><strong>合约代码解析：</strong></p>
<p>这个合约引入了<code>mapping</code>，这是Solidity中极其重要和常用的数据结构，完美地用于“一个地址对应一个数据”的场景。</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

/**
 * @title SaveMyName
 * @dev 允许每个地址存储一个与之关联的名字。
 */
contract SaveMyName {
    // 定义一个映射，键是 address 类型，值是 string 类型
    // `names` 将存储从用户地址到其名字的映射关系
    mapping(address =&gt; string) public names;

    /**
     * @dev 存储调用者的名字。
     * @param _name 要存储的名字字符串。
     *      注意：函数参数需要指定内存位置，对于 string 类型通常是 `memory` 或 `calldata`。
     */
    function saveName(string memory _name) public {
        // msg.sender 是一个全局变量，代表调用此函数的账户地址
        // 这行代码将调用者的地址和他传入的名字关联起来
        names[msg.sender] = _name;
    }

    /**
     * @dev 读取指定地址的名字。
     * @param _userAddress 要查询的地址。
     * @return 返回该地址存储的名字。
     *      `view` 关键字表示这是一个只读函数，不修改状态，调用它不需要消耗Gas。
     */
    function getName(address _userAddress) public view returns (string memory) {
        return names[_userAddress];
    }
}
</code></pre>
<p><strong>学习总结：</strong>
<code>SaveMyName</code>合约让我领悟到了智能合约如何实现“身份”与“数据”的绑定。通过<code>mapping(address =&gt; string)</code>，我们创造了一个去中心化的数据库。<code>msg.sender</code>的使用是关键，它确保了用户只能修改属于自己的数据，这是构建多用户DApp的基础。</p>
<p>同时，<code>view</code>函数的概念也让我明白了读（Read）操作和写（Write）操作的区别。读操作是免费的，而写操作需要支付Gas费，这是区块链经济模型的核心之一。</p>
<hr/>
<h4 data-id="heading-3">第三站：PollStation - 构建一个简单的去中心化应用</h4>
<p>前两站是基础，第三站<code>PollStation</code>则是一个小型的“应用”了。它实现了一个简单的投票系统，具备以下功能：</p>
<ul>
<li>任何人都可以创建一个投票提案。</li>
<li>每个地址只能对一个提案投一票。</li>
<li>可以查询每个提案的票数。</li>
</ul>
<p><strong>核心知识点：</strong></p>
<ol>
<li><strong>结构体（Struct）</strong>: 用于定义复杂的数据类型，将多个变量组合在一起。</li>
<li><strong>数组（Array）</strong>: 用于存储一系列同类型的数据。</li>
<li><code>require()</code>: 用于检查条件，如果条件不满足，则撤销交易。这是保证合约逻辑正确性的重要工具。</li>
<li>事件（Events）: 用于在链上留下“日志”，方便前端应用监听合约状态的变化。</li>
</ol>
<p><strong>合约代码解析：</strong></p>
<p>这个合约的复杂性明显提升，它组合运用了前面学到的所有知识，并引入了结构体和数组来管理更复杂的数据。</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

/**
 * @title PollStation
 * @dev 一个简单的投票站合约。
 */
contract PollStation {
    // 定义一个结构体来表示一个投票提案
    struct Poll {
        string proposal; // 提案内容
        uint voteCount;  // 获得的票数
    }

    // 存储所有投票提案的动态数组
    Poll[] public polls;

    // 记录每个地址是否已经投过票
    // mapping(address =&gt; bool) private hasVoted; // 这个设计有缺陷，应针对每个提案
    // 更好的设计：记录每个用户对每个提案的投票状态
    mapping(uint =&gt; mapping(address =&gt; bool)) private hasVotedForPoll;

    // 定义一个事件，当有新投票时触发
    event Voted(uint indexed _pollId, address indexed _voter);

    /**
     * @dev 创建一个新的投票提案。
     * @param _proposal 提案的描述内容。
     */
    function createPoll(string memory _proposal) public {
        polls.push(Poll({
            proposal: _proposal,
            voteCount: 0
        }));
    }

    /**
     * @dev 为指定的提案投票。
     * @param _pollId 提案的ID (即它在数组中的索引)。
     */
    function vote(uint _pollId) public {
        // 检查提案ID是否存在
        require(_pollId &lt; polls.length, "Poll does not exist.");
        // 检查该地址是否已经对这个提案投过票
        require(!hasVotedForPoll[_pollId][msg.sender], "You have already voted for this poll.");

        // 标记该地址已投票
        hasVotedForPoll[_pollId][msg.sender] = true;
        // 对应提案的票数加 1
        polls[_pollId].voteCount++;

        // 触发投票事件
        emit Voted(_pollId, msg.sender);
    }

    /**
     * @dev 获取提案总数。
     * @return 返回当前有多少个提案。
     */
    function getPollsCount() public view returns (uint) {
        return polls.length;
    }
}
</code></pre>
<p><strong>学习总结：</strong>
<code>PollStation</code>是一个里程碑。它让我不再是简单地存储数据，而是开始构建有实际业务逻辑的应用。</p>
<ul>
<li><code>struct</code>和<code>array</code>的组合，让我学会了如何组织和管理复杂的数据集合。</li>
<li><code>require()</code>的使用，让我深刻体会到智能合约编程的严谨性——“Code is Law”，我们必须在代码层面处理掉所有无效的操作，以防资产损失或逻辑错误。</li>
<li><code>event</code>的引入，为智能合约和前端应用的交互打开了一扇窗。前端可以通过监听这些事件，来实时更新UI，而无需不断地轮询查询合约状态。</li>
</ul>
<hr/>
<h4 data-id="heading-4">反思与展望</h4>
<p>从<code>ClickCounter</code>的单个状态变量，到<code>SaveMyName</code>的键值对映射，再到<code>PollStation</code>中结构体、数组和事件的综合运用，这三个合约清晰地勾勒出了一条从入门到实践的学习路径。</p>
<p>这个过程让我明白，学习Solidity不仅仅是学习一门新的编程语言。更重要的是，它要求我们转变思维方式——从中心化服务器的思维，转变为在去中心化、透明、不可篡改的环境下构建应用的思维。你需要时刻考虑Gas消耗、交易的原子性以及安全性问题。</p>
<p>这“三部曲”仅仅是开始。接下来，还有ERC20代币标准、ERC721的NFT、DeFi协议等更广阔的世界等待我们去探索。</p>
<p>如果你也对Web3和智能合约开发感兴趣，不妨也从这三个小合约开始，动手敲一遍代码，部署到测试网亲自交互一下。相信我，你会收获良多！</p>
<p>感谢阅读，期待在Web3的世界里与你相遇！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kubernetes无缝集成Harbor，实现CI/CD流水线]]></title>    <link>https://juejin.cn/post/7571005216910917651</link>    <guid>https://juejin.cn/post/7571005216910917651</guid>    <pubDate>2025-11-11T06:45:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571005216910917651" data-draft-id="7571304204720521270" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kubernetes无缝集成Harbor，实现CI/CD流水线"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-11T06:45:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kubernetes无缝集成Harbor，实现CI/CD流水线
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:45:57.000Z" title="Tue Nov 11 2025 06:45:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Harbor 作为企业级的容器镜像仓库，在 Kubernetes 生态中扮演着核心的镜像管理角色。下面这个表格能帮你快速抓住其核心价值和在案例中的体现：</p>






























<table><thead><tr><th>特性维度</th><th>核心价值</th><th>在线书店案例体现</th></tr></thead><tbody><tr><td><strong>统一镜像源</strong></td><td>为集群所有节点提供稳定、快速的私有镜像拉取源，避免依赖公网。</td><td>所有服务镜像（如<code>book-service</code>, <code>user-service</code>）均从内部Harbor拉取。</td></tr><tr><td><strong>基于项目的访问控制 (RBAC)</strong></td><td>实现镜像的权限隔离，不同团队管理各自项目。</td><td>为前端、后端团队创建独立项目，成员只能访问被授权的项目。</td></tr><tr><td><strong>安全扫描</strong></td><td>集成漏洞扫描工具，提升供应链安全。</td><td>推送镜像时自动扫描，阻止含高危漏洞的镜像部署。</td></tr><tr><td><strong>高可用与持久化</strong></td><td>确保镜像仓库稳定运行，数据不丢失。</td><td>采用外部对象存储和数据库，即使Pod重建数据也完好。</td></tr></tbody></table>
<p>下面，我们以一个名为“BookStore”的<strong>在线书店微服务项目</strong>为例，详细介绍如何从零搭建Harbor，并将其无缝集成到Kubernetes集群中，实现CI/CD流水线。</p>
<h3 data-id="heading-0">🔧 安装与配置 Harbor</h3>
<h4 data-id="heading-1">1. 选择部署模式与前提准备</h4>
<p>首先，根据你的环境选择最合适的部署方式：</p>




















<table><thead><tr><th>部署方式</th><th>适用场景</th><th>关键步骤/命令</th></tr></thead><tbody><tr><td><strong>Helm Chart (K8s内)</strong></td><td>生产环境，希望与K8s统一管理。</td><td><code>helm repo add harbor https://helm.goharbor.io</code></td></tr><tr><td><strong>Docker Compose</strong></td><td>开发、测试环境，快速独立部署。</td><td>下载离线包，编辑<code>harbor.yml</code>，运行<code>./install.sh</code>。</td></tr></tbody></table>
<p><strong>前提准备</strong>：确保你的服务器已安装符合版本的 Docker 和 Docker Compose 。</p>
<h4 data-id="heading-2">2. 关键配置详解</h4>
<p>在启动安装前，需要仔细配置 <code>harbor.yml</code>（Docker Compose方式）或自定义的 <code>values.yaml</code>（Helm方式）。以下是几个关键配置点：</p>
<ul>
<li><strong>外部访问与证书</strong>：生产环境<strong>必须启用HTTPS</strong>。</li>
<li><strong>持久化存储</strong>：必须为 Harbor 配置持久化存储，以防止数据丢失 。</li>
<li><strong>管理员密码</strong>：<strong>务必修改</strong>默认的管理员密码（<code>harborAdminPassword</code>）。</li>
</ul>
<p>配置完成后，执行安装脚本（Docker Compose方式）或 Helm 命令即可启动所有服务。通过 <code>docker-compose ps</code>或 <code>kubectl get pods -n harbor</code>确认所有组件状态为 <code>Running</code>或 <code>Ready</code>。</p>
<h3 data-id="heading-3">📥 集成 Harbor 与 Kubernetes</h3>
<p>要让 Kubernetes 集群能够从私有的 Harbor 仓库拉取镜像，需要进行如下配置，其核心流程是通过创建一个包含 Harbor 认证信息的 Secret 来实现的：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/133069af87f241478f63a34349a6ca97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSVTmqZjlrZDnmq4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449386&amp;x-signature=kZ%2FcDl5oriUEeH35KHZ2Pbvea1w%3D" alt="image.png" loading="lazy"/></p>
<p>具体操作步骤如下：</p>
<ol>
<li>
<p><strong>创建镜像拉取密钥（ImagePullSecret）</strong></p>
<p>在打算部署应用的命名空间下，创建一个 <code>docker-registry</code>类型的 Secret 。</p>
<pre><code class="hljs language-ini" lang="ini">kubectl create secret docker-registry harbor-regcred \
  <span class="hljs-attr">--docker-server</span>=harbor.yourcompany.com \
  <span class="hljs-attr">--docker-username</span>=admin \
  <span class="hljs-attr">--docker-password</span>=yourpassword \
  <span class="hljs-attr">--namespace</span>=your-namespace
</code></pre>
</li>
<li>
<p><strong>在应用部署中引用该 Secret</strong></p>
<p>在你的 Deployment YAML 中，通过 <code>imagePullSecrets</code>字段指明使用刚才创建的 Secret 。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">book-service</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">book-service</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">harbor.yourcompany.com/bookstore/book-service:v1.0.0</span> <span class="hljs-comment"># 必须是完整地址</span>
      <span class="hljs-attr">imagePullSecrets:</span> <span class="hljs-comment"># 引用密钥</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">harbor-regcred</span>
</code></pre>
<p>请注意，<code>image</code>字段必须是 <strong>完整的镜像地址</strong>，包含仓库地址、项目路径和标签 。</p>
</li>
</ol>
<h3 data-id="heading-4">🚀 项目实战：在线书店的镜像管理</h3>
<p>假设你正在部署上述“在线书店”应用，它包含 <code>book-service</code>（图书服务）和 <code>user-service</code>（用户服务）。</p>
<ol>
<li>
<p><strong>在 Harbor 中创建项目</strong></p>
<p>登录 Harbor Web UI，为“在线书店”创建两个项目：<code>bookstore/backend</code>和 <code>bookstore/frontend</code>，并分别为后端和前端开发团队配置推送和拉取权限。</p>
</li>
<li>
<p><strong>推送镜像到 Harbor</strong></p>
<p>在 CI/CD 流水线或开发者本地，构建好镜像后，将其推送到 Harbor 对应的项目中 。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 为本地镜像打上符合Harbor规范的标签</span>
docker tag book-service:latest harbor.yourcompany.com/bookstore/backend/book-service:v1.0.0
<span class="hljs-comment"># 2. 登录Harbor（需要先在客户端配置信任证书或insecure-registry）</span>
docker login harbor.yourcompany.com
<span class="hljs-comment"># 3. 推送镜像</span>
docker push harbor.yourcompany.com/bookstore/backend/book-service:v1.0.0
</code></pre>
</li>
<li>
<p><strong>在 Kubernetes 中部署</strong></p>
<p>编写 Deployment YAML 文件，<code>image</code>字段指定为 Harbor 中的镜像地址，并正确引用 <code>imagePullSecrets</code>，然后应用配置 。</p>
<pre><code class="hljs">kubectl apply -f book-service-deployment.yaml -n bookstore
</code></pre>
</li>
</ol>
<h3 data-id="heading-5">🛡️ 企业级增强功能与高可用</h3>
<ul>
<li><strong>启用漏洞扫描</strong>：在 Harbor 中启用 Trivy 等扫描器，并配置策略，阻止携带高危漏洞的镜像被拉取 。</li>
<li><strong>高可用与性能优化</strong>：对于生产环境，应考虑 Harbor 组件本身的高可用 。</li>
</ul>
<h3 data-id="heading-6">🧩 常见问题排查 (Troubleshooting)</h3>
<ul>
<li>
<p><strong>Pod 状态为 <code>ImagePullBackOff</code>或 <code>ErrImagePull</code></strong>：</p>
<ul>
<li><strong>检查镜像地址和标签</strong>：使用 <code>docker pull &lt;镜像完整地址&gt;</code>在节点上手动测试。</li>
<li><strong>检查 Secret</strong>：确认 Secret 所在命名空间与 Pod 一致，且用户名密码正确。</li>
<li><strong>检查证书</strong>：确保 Kubernetes 节点信任 Harbor 的 HTTPS 证书 。</li>
</ul>
</li>
<li>
<p><strong>Harbor 服务无法访问</strong>：</p>
<ul>
<li>检查 Ingress Controller 或 NodePort 服务是否正常 。</li>
</ul>
</li>
<li>
<p><strong>推送镜像失败</strong>：</p>
<ul>
<li>检查客户端 Docker 守护进程的 <code>insecure-registries</code>配置（仅限 HTTP 或自签名证书测试环境）或是否信任了 Harbor 的 CA 证书 。</li>
</ul>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Solidity代理合约：解锁区块链代码的灵活升级大法]]></title>    <link>https://juejin.cn/post/7571067260053422106</link>    <guid>https://juejin.cn/post/7571067260053422106</guid>    <pubDate>2025-11-11T06:57:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571067260053422106" data-draft-id="7571060853371519026" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Solidity代理合约：解锁区块链代码的灵活升级大法"/> <meta itemprop="keywords" content="Solidity,智能合约,以太坊"/> <meta itemprop="datePublished" content="2025-11-11T06:57:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="天涯学馆"/> <meta itemprop="url" content="https://juejin.cn/user/3394916565129287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Solidity代理合约：解锁区块链代码的灵活升级大法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3394916565129287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    天涯学馆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:57:28.000Z" title="Tue Nov 11 2025 06:57:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Solidity里的代理合约（Proxy Contract），这可是区块链开发里一个超级实用的技术，能让你的智能合约像手机系统一样支持“升级”，同时保持数据和地址不变。区块链的合约一旦部署，默认是不可变的，但用代理合约，你可以把逻辑和数据分开，随时替换逻辑合约，简直是开发者的救星！不过，代理合约也有坑，比如存储冲突、权限管理、调用安全等。</p>
<h2 data-id="heading-0">代理合约核心概念</h2>
<p>先来搞清楚几个关键点：</p>
<ul>
<li><strong>代理合约（Proxy）</strong>：一个中间层合约，负责接收调用并转发到逻辑合约（Implementation），存储数据在代理合约中。</li>
<li><strong>逻辑合约（Implementation）</strong>：包含实际业务逻辑，升级时替换这个合约。</li>
<li><strong>存储分离</strong>：代理合约存储数据，逻辑合约只提供代码，防止存储冲突。</li>
<li><strong>委托调用（delegatecall）</strong>：代理合约通过<code>delegatecall</code>调用逻辑合约，代码在逻辑合约执行，但上下文（存储、msg.sender等）属于代理合约。</li>
<li><strong>升级机制</strong>：通过更新逻辑合约地址实现功能升级，不改变代理合约地址。</li>
<li><strong>安全风险</strong>：
<ul>
<li><strong>存储冲突</strong>：逻辑合约的存储布局必须与代理一致。</li>
<li><strong>权限控制</strong>：谁能升级？没限制可能被黑客篡改。</li>
<li><strong>初始化</strong>：新逻辑合约需要正确初始化。</li>
</ul>
</li>
<li><strong>OpenZeppelin</strong>：提供标准的代理合约实现，如透明代理（Transparent Proxy）和UUPS（Universal Upgradeable Proxy Standard）。</li>
<li><strong>Solidity 0.8.x</strong>：自带溢出/下溢检查，配合OpenZeppelin确保安全。</li>
<li><strong>Hardhat</strong>：开发和测试工具，支持部署和验证。</li>
</ul>
<p>咱们用Solidity 0.8.20，结合OpenZeppelin和Hardhat，从简单代理到复杂UUPS实现，逐步打造安全的代理合约。</p>
<h2 data-id="heading-1">环境准备</h2>
<p>用Hardhat搭建开发环境，写和测试合约。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> proxy-demo
<span class="hljs-built_in">cd</span> proxy-demo
npm init -y
npm install --save-dev hardhat @nomicfoundation/hardhat-toolbox @openzeppelin/contracts @openzeppelin/contracts-upgradeable
npm install ethers
</code></pre>
<p>初始化Hardhat：</p>
<pre><code class="hljs language-bash" lang="bash">npx hardhat init
</code></pre>
<p>选择TypeScript项目，安装依赖：</p>
<pre><code class="hljs language-bash" lang="bash">npm install --save-dev ts-node typescript @types/node @types/mocha
</code></pre>
<p>目录结构：</p>
<pre><code class="hljs language-lua" lang="lua">proxy-demo/
├── contracts/
│   ├── SimpleProxy.sol
│   ├── LogicV1.sol
│   ├── LogicV2.sol
│   ├── TransparentProxy.sol
│   ├── UUPSProxy.sol
├── scripts/
│   ├── deploy.ts
├── test/
│   ├── Proxy.test.ts
├── hardhat.<span class="hljs-built_in">config</span>.ts
├── tsconfig.json
├── <span class="hljs-built_in">package</span>.json
</code></pre>
<p><code>tsconfig.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ES2020"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"CommonJS"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"strict"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"esModuleInterop"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"moduleResolution"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"resolveJsonModule"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"outDir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"rootDir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"include"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"hardhat.config.ts"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"scripts"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"test"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><code>hardhat.config.ts</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">HardhatUserConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"hardhat/config"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">"@nomicfoundation/hardhat-toolbox"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">HardhatUserConfig</span> = {
  <span class="hljs-attr">solidity</span>: <span class="hljs-string">"0.8.20"</span>,
  <span class="hljs-attr">networks</span>: {
    <span class="hljs-attr">hardhat</span>: {
      <span class="hljs-attr">chainId</span>: <span class="hljs-number">1337</span>,
    },
  },
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> config;
</code></pre>
<p>跑本地节点：</p>
<pre><code class="hljs language-bash" lang="bash">npx hardhat node
</code></pre>
<h2 data-id="heading-2">基础代理合约</h2>
<p>先写一个简单的代理合约，理解<code>delegatecall</code>和升级机制。</p>
<h3 data-id="heading-3">合约代码</h3>
<p><code>contracts/LogicV1.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

contract LogicV1 {
    address public owner;
    uint256 public value;

    function initialize(address _owner) public {
        require(owner == address(0), "Already initialized");
        owner = _owner;
    }

    function setValue(uint256 _value) public {
        require(msg.sender == owner, "Only owner");
        value = _value;
    }

    function getValue() public view returns (uint256) {
        return value;
    }
}
</code></pre>
<p><code>contracts/LogicV2.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

contract LogicV2 {
    address public owner;
    uint256 public value;

    function initialize(address _owner) public {
        require(owner == address(0), "Already initialized");
        owner = _owner;
    }

    function setValue(uint256 _value) public {
        require(msg.sender == owner, "Only owner");
        value = _value * 2; // V2: Double the value
    }

    function getValue() public view returns (uint256) {
        return value;
    }
}
</code></pre>
<p><code>contracts/SimpleProxy.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

contract SimpleProxy {
    address public implementation;
    address public owner;

    constructor(address _implementation) {
        owner = msg.sender;
        implementation = _implementation;
    }

    function upgrade(address _newImplementation) public {
        require(msg.sender == owner, "Only owner");
        implementation = _newImplementation;
    }

    fallback() external payable {
        address impl = implementation;
        require(impl != address(0), "Implementation not set");

        assembly {
            let ptr := mload(0x40)
            calldatacopy(ptr, 0, calldatasize())
            let result := delegatecall(gas(), impl, ptr, calldatasize(), 0, 0)
            let size := returndatasize()
            returndatacopy(ptr, 0, size)
            switch result
            case 0 { revert(ptr, size) }
            default { return(ptr, size) }
        }
    }

    receive() external payable {}
}
</code></pre>
<h3 data-id="heading-4">解析</h3>
<ul>
<li><strong>LogicV1</strong>：
<ul>
<li>存储：<code>owner</code>（合约拥有者），<code>value</code>（一个数值）。</li>
<li><code>initialize</code>：设置<code>owner</code>，防止重复初始化。</li>
<li><code>setValue</code>：设置<code>value</code>，仅<code>owner</code>可调用。</li>
<li><code>getValue</code>：返回<code>value</code>。</li>
</ul>
</li>
<li><strong>LogicV2</strong>：升级版，<code>setValue</code>将输入值翻倍。</li>
<li><strong>SimpleProxy</strong>：
<ul>
<li>存储：<code>implementation</code>（逻辑合约地址），<code>owner</code>。</li>
<li><code>upgrade</code>：更新<code>implementation</code>，仅<code>owner</code>可调用。</li>
<li><code>fallback</code>：通过<code>delegatecall</code>转发调用到<code>implementation</code>，使用汇编确保低级调用。</li>
<li><code>receive</code>：接收ETH。</li>
</ul>
</li>
<li><strong>delegatecall</strong>：
<ul>
<li>执行<code>implementation</code>的代码，但使用代理合约的存储。</li>
<li>代理合约保存<code>owner</code>和<code>value</code>，逻辑合约只提供逻辑。</li>
</ul>
</li>
<li><strong>安全特性</strong>：
<ul>
<li><code>onlyOwner</code>限制升级。</li>
<li>检查<code>implementation</code>不为空。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5">测试</h3>
<p><code>test/Proxy.test.ts</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { ethers } <span class="hljs-keyword">from</span> <span class="hljs-string">"hardhat"</span>;
<span class="hljs-keyword">import</span> { expect } <span class="hljs-keyword">from</span> <span class="hljs-string">"chai"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SimpleProxy</span>, <span class="hljs-title class_">LogicV1</span>, <span class="hljs-title class_">LogicV2</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"../typechain-types"</span>;

<span class="hljs-title function_">describe</span>(<span class="hljs-string">"SimpleProxy"</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> <span class="hljs-attr">proxy</span>: <span class="hljs-title class_">SimpleProxy</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">logicV1</span>: <span class="hljs-title class_">LogicV1</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">logicV2</span>: <span class="hljs-title class_">LogicV2</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">owner</span>: <span class="hljs-built_in">any</span>, <span class="hljs-attr">addr1</span>: <span class="hljs-built_in">any</span>;

  <span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    [owner, addr1] = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getSigners</span>();
    <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV1Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>);
    logicV1 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> logicV1.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">ProxyFactory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"SimpleProxy"</span>);
    proxy = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProxyFactory</span>.<span class="hljs-title function_">deploy</span>(logicV1.<span class="hljs-property">address</span>);
    <span class="hljs-keyword">await</span> proxy.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV2Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV2"</span>);
    logicV2 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV2Factory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> logicV2.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-comment">// Initialize through proxy</span>
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>);
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">initialize</span>(owner.<span class="hljs-property">address</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should initialize correctly"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">owner</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(owner.<span class="hljs-property">address</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should set and get value through proxy"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">getValue</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">42</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should restrict setValue to owner"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">expect</span>(proxyAsLogicV1.<span class="hljs-title function_">connect</span>(addr1).<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>)).<span class="hljs-property">to</span>.<span class="hljs-property">be</span>.<span class="hljs-title function_">revertedWith</span>(<span class="hljs-string">"Only owner"</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should upgrade to LogicV2"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
    <span class="hljs-keyword">await</span> proxy.<span class="hljs-title function_">upgrade</span>(logicV2.<span class="hljs-property">address</span>);
    <span class="hljs-keyword">const</span> proxyAsLogicV2 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV2"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">10</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">getValue</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">20</span>); <span class="hljs-comment">// V2 doubles the value</span>
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">owner</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(owner.<span class="hljs-property">address</span>); <span class="hljs-comment">// Storage preserved</span>
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should restrict upgrade to owner"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">expect</span>(proxy.<span class="hljs-title function_">connect</span>(addr1).<span class="hljs-title function_">upgrade</span>(logicV2.<span class="hljs-property">address</span>)).<span class="hljs-property">to</span>.<span class="hljs-property">be</span>.<span class="hljs-title function_">revertedWith</span>(<span class="hljs-string">"Only owner"</span>);
  });
});
</code></pre>
<p>跑测试：</p>
<pre><code class="hljs language-bash" lang="bash">npx hardhat <span class="hljs-built_in">test</span>
</code></pre>
<ul>
<li><strong>解析</strong>：
<ul>
<li>部署：<code>LogicV1</code>和<code>SimpleProxy</code>，通过代理调用<code>initialize</code>。</li>
<li>操作：通过代理设置<code>value</code>为42，验证存储在代理合约。</li>
<li>升级：切换到<code>LogicV2</code>，<code>setValue(10)</code>返回20，<code>owner</code>保持不变。</li>
<li>权限：<code>addr1</code>无法升级。</li>
</ul>
</li>
<li><strong>存储</strong>：<code>owner</code>和<code>value</code>存储在代理合约的槽位，<code>delegatecall</code>确保逻辑合约操作代理的存储。</li>
</ul>
<h2 data-id="heading-6">存储冲突问题</h2>
<p>如果逻辑合约的存储布局变化，会导致数据错乱。</p>
<h3 data-id="heading-7">错误示例</h3>
<p><code>contracts/BadLogicV2.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

contract BadLogicV2 {
    uint256 public value; // Slot 0 (wrong order)
    address public owner; // Slot 1 (wrong order)

    function initialize(address _owner) public {
        require(owner == address(0), "Already initialized");
        owner = _owner;
    }

    function setValue(uint256 _value) public {
        require(msg.sender == owner, "Only owner");
        value = _value * 2;
    }

    function getValue() public view returns (uint256) {
        return value;
    }
}
</code></pre>
<p>测试：</p>
<p><code>test/Proxy.test.ts</code>（添加）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">it</span>(<span class="hljs-string">"should fail with storage collision"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
  <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">BadLogicV2Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"BadLogicV2"</span>);
  <span class="hljs-keyword">const</span> badLogicV2 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">BadLogicV2Factory</span>.<span class="hljs-title function_">deploy</span>();
  <span class="hljs-keyword">await</span> badLogicV2.<span class="hljs-title function_">deployed</span>();
  <span class="hljs-keyword">await</span> proxy.<span class="hljs-title function_">upgrade</span>(badLogicV2.<span class="hljs-property">address</span>);
  <span class="hljs-keyword">const</span> proxyAsBadLogicV2 = <span class="hljs-title class_">BadLogicV2Factory</span>.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>);
  <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsBadLogicV2.<span class="hljs-title function_">owner</span>()).<span class="hljs-property">to</span>.<span class="hljs-property">not</span>.<span class="hljs-title function_">equal</span>(owner.<span class="hljs-property">address</span>); <span class="hljs-comment">// Storage messed up</span>
});
</code></pre>
<ul>
<li><strong>问题</strong>：<code>LogicV1</code>的存储是<code>owner</code>(slot 0), <code>value</code>(slot 1)，<code>BadLogicV2</code>是<code>value</code>(slot 0), <code>owner</code>(slot 1)，升级后<code>owner</code>被覆盖为<code>value</code>的值。</li>
<li><strong>解决</strong>：新逻辑合约必须保持存储布局一致，或使用<code>storage</code>关键字显式声明槽位。</li>
</ul>
<h2 data-id="heading-8">透明代理（Transparent Proxy）</h2>
<p>用OpenZeppelin的透明代理，解决管理调用冲突。</p>
<p><code>contracts/LogicV1.sol</code>（更新，使用OpenZeppelin升级库）：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";
import "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol";

contract LogicV1 is Initializable, OwnableUpgradeable {
    uint256 public value;

    function initialize(address _owner) public initializer {
        __Ownable_init(_owner);
    }

    function setValue(uint256 _value) public onlyOwner {
        value = _value;
    }

    function getValue() public view returns (uint256) {
        return value;
    }
}
</code></pre>
<p><code>contracts/LogicV2.sol</code>（更新）：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";
import "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol";

contract LogicV2 is Initializable, OwnableUpgradeable {
    uint256 public value;

    function initialize(address _owner) public initializer {
        __Ownable_init(_owner);
    }

    function setValue(uint256 _value) public onlyOwner {
        value = _value * 2;
    }

    function getValue() public view returns (uint256) {
        return value;
    }
}
</code></pre>
<p><code>contracts/TransparentProxy.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts/proxy/transparent/TransparentUpgradeableProxy.sol";

contract TransparentProxy is TransparentUpgradeableProxy {
    constructor(address logic, address admin, bytes memory data)
        TransparentUpgradeableProxy(logic, admin, data)
    {}
}
</code></pre>
<h3 data-id="heading-9">解析</h3>
<ul>
<li><strong>LogicV1/V2</strong>：
<ul>
<li>使用<code>Initializable</code>和<code>OwnableUpgradeable</code>，支持代理初始化。</li>
<li><code>initializer</code>修饰符确保初始化只执行一次。</li>
</ul>
</li>
<li><strong>TransparentProxy</strong>：
<ul>
<li>继承OpenZeppelin的<code>TransparentUpgradeableProxy</code>。</li>
<li>构造函数：设置逻辑合约地址、管理员地址、初始化数据。</li>
<li>透明机制：管理员调用直接访问代理合约（升级功能），普通用户调用转发到逻辑合约。</li>
</ul>
</li>
<li><strong>安全特性</strong>：
<ul>
<li>防止管理员调用逻辑合约功能。</li>
<li><code>OwnableUpgradeable</code>管理权限。</li>
<li>存储布局由OpenZeppelin规范化。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-10">测试</h3>
<p><code>test/Proxy.test.ts</code>（更新）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { ethers } <span class="hljs-keyword">from</span> <span class="hljs-string">"hardhat"</span>;
<span class="hljs-keyword">import</span> { expect } <span class="hljs-keyword">from</span> <span class="hljs-string">"chai"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">TransparentProxy</span>, <span class="hljs-title class_">LogicV1</span>, <span class="hljs-title class_">LogicV2</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"../typechain-types"</span>;

<span class="hljs-title function_">describe</span>(<span class="hljs-string">"TransparentProxy"</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> <span class="hljs-attr">proxy</span>: <span class="hljs-title class_">TransparentProxy</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">logicV1</span>: <span class="hljs-title class_">LogicV1</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">logicV2</span>: <span class="hljs-title class_">LogicV2</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">owner</span>: <span class="hljs-built_in">any</span>, <span class="hljs-attr">addr1</span>: <span class="hljs-built_in">any</span>, <span class="hljs-attr">admin</span>: <span class="hljs-built_in">any</span>;

  <span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    [owner, addr1, admin] = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getSigners</span>();
    <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV1Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>);
    logicV1 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> logicV1.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">ProxyFactory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"TransparentProxy"</span>);
    <span class="hljs-keyword">const</span> initData = <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-property">interface</span>.<span class="hljs-title function_">encodeFunctionData</span>(<span class="hljs-string">"initialize"</span>, [owner.<span class="hljs-property">address</span>]);
    proxy = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProxyFactory</span>.<span class="hljs-title function_">deploy</span>(logicV1.<span class="hljs-property">address</span>, admin.<span class="hljs-property">address</span>, initData);
    <span class="hljs-keyword">await</span> proxy.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV2Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV2"</span>);
    logicV2 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV2Factory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> logicV2.<span class="hljs-title function_">deployed</span>();
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should initialize correctly"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">owner</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(owner.<span class="hljs-property">address</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should set and get value"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">getValue</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">42</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should restrict setValue to owner"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">expect</span>(proxyAsLogicV1.<span class="hljs-title function_">connect</span>(addr1).<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>)).<span class="hljs-property">to</span>.<span class="hljs-property">be</span>.<span class="hljs-title function_">revertedWith</span>(<span class="hljs-string">"Ownable: caller is not the owner"</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should upgrade to LogicV2"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
    <span class="hljs-keyword">const</span> <span class="hljs-title class_">ProxyAdminFactory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"ProxyAdmin"</span>, admin);
    <span class="hljs-keyword">const</span> proxyAdmin = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProxyAdminFactory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> proxyAdmin.<span class="hljs-title function_">deployed</span>();
    <span class="hljs-keyword">await</span> proxyAdmin.<span class="hljs-title function_">connect</span>(admin).<span class="hljs-title function_">upgrade</span>(proxy.<span class="hljs-property">address</span>, logicV2.<span class="hljs-property">address</span>);
    <span class="hljs-keyword">const</span> proxyAsLogicV2 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV2"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">10</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">getValue</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">20</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">owner</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(owner.<span class="hljs-property">address</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should restrict upgrade to admin"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> <span class="hljs-title class_">ProxyAdminFactory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"ProxyAdmin"</span>, admin);
    <span class="hljs-keyword">const</span> proxyAdmin = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProxyAdminFactory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> proxyAdmin.<span class="hljs-title function_">deployed</span>();
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">expect</span>(proxyAdmin.<span class="hljs-title function_">connect</span>(addr1).<span class="hljs-title function_">upgrade</span>(proxy.<span class="hljs-property">address</span>, logicV2.<span class="hljs-property">address</span>)).<span class="hljs-property">to</span>.<span class="hljs-property">be</span>.<span class="hljs-title function_">revertedWith</span>(<span class="hljs-string">"Ownable: caller is not the owner"</span>);
  });
});
</code></pre>
<ul>
<li><strong>解析</strong>：
<ul>
<li>部署：<code>LogicV1</code>和<code>TransparentProxy</code>，通过<code>initData</code>初始化。</li>
<li>操作：设置<code>value</code>为42，验证存储。</li>
<li>升级：用<code>ProxyAdmin</code>切换到<code>LogicV2</code>，<code>setValue(10)</code>返回20。</li>
<li>权限：只有<code>admin</code>可升级。</li>
</ul>
</li>
<li><strong>透明机制</strong>：管理员调用直接操作代理，普通用户调用转发到逻辑合约。</li>
</ul>
<h2 data-id="heading-11">UUPS代理（Universal Upgradeable Proxy Standard）</h2>
<p>UUPS将升级逻辑移到逻辑合约，减少代理合约存储。</p>
<p><code>contracts/UUPSLogicV1.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";
import "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol";
import "@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol";

contract UUPSLogicV1 is Initializable, OwnableUpgradeable, UUPSUpgradeable {
    uint256 public value;

    function initialize(address _owner) public initializer {
        __Ownable_init(_owner);
        __UUPSUpgradeable_init();
    }

    function setValue(uint256 _value) public onlyOwner {
        value = _value;
    }

    function getValue() public view returns (uint256) {
        return value;
    }

    function _authorizeUpgrade(address newImplementation) internal override onlyOwner {}
}
</code></pre>
<p><code>contracts/UUPSLogicV2.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";
import "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol";
import "@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol";

contract UUPSLogicV2 is Initializable, OwnableUpgradeable, UUPSUpgradeable {
    uint256 public value;

    function initialize(address _owner) public initializer {
        __Ownable_init(_owner);
        __UUPSUpgradeable_init();
    }

    function setValue(uint256 _value) public onlyOwner {
        value = _value * 2;
    }

    function getValue() public view returns (uint256) {
        return value;
    }

    function _authorizeUpgrade(address newImplementation) internal override onlyOwner {}
}
</code></pre>
<p><code>contracts/UUPSProxy.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts/proxy/ERC1967/ERC1967Proxy.sol";

contract UUPSProxy is ERC1967Proxy {
    constructor(address logic, bytes memory data) ERC1967Proxy(logic, data) {}
}
</code></pre>
<h3 data-id="heading-12">解析</h3>
<ul>
<li><strong>UUPSLogicV1/V2</strong>：
<ul>
<li>继承<code>UUPSUpgradeable</code>，包含升级逻辑。</li>
<li><code>_authorizeUpgrade</code>：限制升级权限。</li>
</ul>
</li>
<li><strong>UUPSProxy</strong>：
<ul>
<li>继承<code>ERC1967Proxy</code>，存储逻辑地址在特定槽位。</li>
<li>构造函数：设置逻辑合约和初始化数据。</li>
</ul>
</li>
<li><strong>UUPS优势</strong>：
<ul>
<li>代理合约更轻量，升级逻辑在逻辑合约。</li>
<li>可通过自毁移除升级功能。</li>
</ul>
</li>
<li><strong>安全特性</strong>：
<ul>
<li><code>onlyOwner</code>控制升级。</li>
<li><code>Initializer</code>防止重复初始化。</li>
<li>标准化的存储槽（ERC1967）。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-13">测试</h3>
<p><code>test/Proxy.test.ts</code>（更新）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { ethers } <span class="hljs-keyword">from</span> <span class="hljs-string">"hardhat"</span>;
<span class="hljs-keyword">import</span> { expect } <span class="hljs-keyword">from</span> <span class="hljs-string">"chai"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">UUPSProxy</span>, <span class="hljs-title class_">UUPSLogicV</span>1, <span class="hljs-title class_">UUPSLogicV</span>2 } <span class="hljs-keyword">from</span> <span class="hljs-string">"../typechain-types"</span>;

<span class="hljs-title function_">describe</span>(<span class="hljs-string">"UUPSProxy"</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> <span class="hljs-attr">proxy</span>: <span class="hljs-title class_">UUPSProxy</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">logicV1</span>: <span class="hljs-title class_">UUPSLogicV</span>1;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">logicV2</span>: <span class="hljs-title class_">UUPSLogicV</span>2;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">owner</span>: <span class="hljs-built_in">any</span>, <span class="hljs-attr">addr1</span>: <span class="hljs-built_in">any</span>;

  <span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    [owner, addr1] = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getSigners</span>();
    <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV1Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV1"</span>);
    logicV1 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> logicV1.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">ProxyFactory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSProxy"</span>);
    <span class="hljs-keyword">const</span> initData = <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-property">interface</span>.<span class="hljs-title function_">encodeFunctionData</span>(<span class="hljs-string">"initialize"</span>, [owner.<span class="hljs-property">address</span>]);
    proxy = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProxyFactory</span>.<span class="hljs-title function_">deploy</span>(logicV1.<span class="hljs-property">address</span>, initData);
    <span class="hljs-keyword">await</span> proxy.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV2Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV2"</span>);
    logicV2 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV2Factory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> logicV2.<span class="hljs-title function_">deployed</span>();
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should initialize correctly"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">owner</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(owner.<span class="hljs-property">address</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should set and get value"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">getValue</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">42</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should upgrade to LogicV2"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">upgradeTo</span>(logicV2.<span class="hljs-property">address</span>);
    <span class="hljs-keyword">const</span> proxyAsLogicV2 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV2"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">10</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">getValue</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">20</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">owner</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(owner.<span class="hljs-property">address</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should restrict upgrade to owner"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">expect</span>(proxyAsLogicV1.<span class="hljs-title function_">connect</span>(addr1).<span class="hljs-title function_">upgradeTo</span>(logicV2.<span class="hljs-property">address</span>)).<span class="hljs-property">to</span>.<span class="hljs-property">be</span>.<span class="hljs-title function_">revertedWith</span>(<span class="hljs-string">"Ownable: caller is not the owner"</span>);
  });
});
</code></pre>
<ul>
<li><strong>解析</strong>：
<ul>
<li>部署：<code>UUPSLogicV1</code>和<code>UUPSProxy</code>，通过<code>initData</code>初始化。</li>
<li>操作：设置<code>value</code>为42。</li>
<li>升级：调用<code>upgradeTo</code>切换到<code>LogicV2</code>，<code>setValue(10)</code>返回20。</li>
<li>权限：<code>addr1</code>无法升级。</li>
</ul>
</li>
<li><strong>UUPS特点</strong>：升级逻辑在逻辑合约，代理更轻量。</li>
</ul>
<h2 data-id="heading-14">部署脚本</h2>
<p><code>scripts/deploy.ts</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { ethers } <span class="hljs-keyword">from</span> <span class="hljs-string">"hardhat"</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [owner, admin] = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getSigners</span>();

  <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV1Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>);
  <span class="hljs-keyword">const</span> logicV1 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-title function_">deploy</span>();
  <span class="hljs-keyword">await</span> logicV1.<span class="hljs-title function_">deployed</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`LogicV1 deployed to: <span class="hljs-subst">${logicV1.address}</span>`</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title class_">ProxyFactory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"TransparentProxy"</span>);
  <span class="hljs-keyword">const</span> initData = <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-property">interface</span>.<span class="hljs-title function_">encodeFunctionData</span>(<span class="hljs-string">"initialize"</span>, [owner.<span class="hljs-property">address</span>]);
  <span class="hljs-keyword">const</span> proxy = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProxyFactory</span>.<span class="hljs-title function_">deploy</span>(logicV1.<span class="hljs-property">address</span>, admin.<span class="hljs-property">address</span>, initData);
  <span class="hljs-keyword">await</span> proxy.<span class="hljs-title function_">deployed</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`TransparentProxy deployed to: <span class="hljs-subst">${proxy.address}</span>`</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title class_">UUPSLogicV</span>1Factory = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV1"</span>);
  <span class="hljs-keyword">const</span> uupsLogicV1 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">UUPSLogicV</span>1Factory.<span class="hljs-title function_">deploy</span>();
  <span class="hljs-keyword">await</span> uupsLogicV1.<span class="hljs-title function_">deployed</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`UUPSLogicV1 deployed to: <span class="hljs-subst">${uupsLogicV1.address}</span>`</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title class_">UUPSProxyFactory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSProxy"</span>);
  <span class="hljs-keyword">const</span> uupsProxy = <span class="hljs-keyword">await</span> <span class="hljs-title class_">UUPSProxyFactory</span>.<span class="hljs-title function_">deploy</span>(uupsLogicV1.<span class="hljs-property">address</span>, initData);
  <span class="hljs-keyword">await</span> uupsProxy.<span class="hljs-title function_">deployed</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`UUPSProxy deployed to: <span class="hljs-subst">${uupsProxy.address}</span>`</span>);
}

<span class="hljs-title function_">main</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error);
  process.<span class="hljs-property">exitCode</span> = <span class="hljs-number">1</span>;
});
</code></pre>
<p>跑部署：</p>
<pre><code class="hljs language-bash" lang="bash">npx hardhat run scripts/deploy.ts --network hardhat
</code></pre>
<ul>
<li><strong>解析</strong>：部署透明代理和UUPS代理，记录地址。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用阿里云 ECS 安装 MongoDB并实现后端连接]]></title>    <link>https://juejin.cn/post/7571007466822991924</link>    <guid>https://juejin.cn/post/7571007466822991924</guid>    <pubDate>2025-11-11T04:43:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571007466822991924" data-draft-id="7569548172533858344" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用阿里云 ECS 安装 MongoDB并实现后端连接"/> <meta itemprop="keywords" content="MongoDB,Express"/> <meta itemprop="datePublished" content="2025-11-11T04:43:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="gongzemin"/> <meta itemprop="url" content="https://juejin.cn/user/3931509311681192"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用阿里云 ECS 安装 MongoDB并实现后端连接
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3931509311681192/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    gongzemin
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T04:43:48.000Z" title="Tue Nov 11 2025 04:43:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前面我们已经在ESC上部署了<a href="https://juejin.cn/post/7569038602434510857" target="_blank" title="https://juejin.cn/post/7569038602434510857">前端Vue应用</a>、<a href="https://juejin.cn/post/7564573165705936911" target="_blank" title="https://juejin.cn/post/7564573165705936911">后端Express</a>，现在就差数据库了。
本来是用<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.mongodb.com%2Fcloud%2Fatlas%2Fregister" target="_blank" title="https://www.mongodb.com/cloud/atlas/register" ref="nofollow noopener noreferrer">MongoDB Altas</a>(MongoDB 官方推出的云托管 MongoDB 数据库服务)，但是国外的数据库服务，网络有点不稳定，所以决定自己安装MongoDB 社区版</p>
<blockquote>
<p>我的ECS配置是2核2G 40g 云盘 系统是Alibaba Cloud Linux 4 LTS 64位</p>
</blockquote>
<p>我们开始吧</p>
<ol>
<li>安装mongoDB 社区版</li>
<li>启动mongoDB</li>
<li>为数据库添加访问控制，比如admin用户才可以（可选）</li>
<li>后端连接我们在ECS安装的mongoDB</li>
</ol>
<h5 data-id="heading-0">安装mongoDB 社区版</h5>
<p>我们看下<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.mongodb.com%2Fdocs%2Fmanual%2Fadministration%2Finstall-community%2F%3Foperating-system%3Dlinux%26linux-distribution%3Dred-hat%26linux-package%3Ddefault%26search-linux%3Dwith-search-linux%23std-label-install-mdb-community-edition" target="_blank" title="https://www.mongodb.com/docs/manual/administration/install-community/?operating-system=linux&amp;linux-distribution=red-hat&amp;linux-package=default&amp;search-linux=with-search-linux#std-label-install-mdb-community-edition" ref="nofollow noopener noreferrer">官网文档</a>，根据不同的系统，发行版本选择，对应的命令，比如我这里服务器是Alibaba Cloud Linux 4, 所以就是Linux, Red Hat</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7546240ac18463fa06e5562e096121f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=afRopHJMWk7R8sVbUqtyrCQDWeA%3D" alt="image.png" loading="lazy"/></p>
<h6 data-id="heading-1">配置 MongoDB 的 YUM 软件仓库地址，让系统知道从哪里下载 MongoDB</h6>
<pre><code class="hljs language-bash" lang="bash">[mongodb-org-8.2]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/8/mongodb-org/8.2/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://pgp.mongodb.com/server-8.0.asc
</code></pre>
<blockquote>
<p>MongoDB 8.2 使用 8.0 的 GPG 密钥
gpgkey=<a href="https://link.juejin.cn?target=https%3A%2F%2Fpgp.mongodb.com%2Fserver-8.0.asc" target="_blank" title="https://pgp.mongodb.com/server-8.0.asc" ref="nofollow noopener noreferrer">pgp.mongodb.com/server-8.0.…</a>  ✅ 正确</p>
</blockquote>
<p><strong>为什么 8.2 用 8.0 的密钥？</strong>     MongoDB 的 GPG 密钥是按主版本（major version）管理的</p>
<p><strong>1. 在ECS上创建一个 MongoDB 的 YUM 软件源配置文件</strong> ，以便通过<code>dnf</code>或<code>yum</code>包管理器安装MongoDB 8相关软件</p>
<p>登录ECS，执行命令</p>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">tee</span> /etc/yum.repos.d/mongodb-org-8.0.repo &lt;&lt;<span class="hljs-string">EOF
[mongodb-org-8.0]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/8/mongodb-org/8.0/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://pgp.mongodb.com/server-8.0.asc
EOF</span>
</code></pre>
<blockquote>
<p>为什么我不安装MongoDB 8.2版本呢，上面那个官方文档就是8.2，因为我当时是问了GROK ai，那个给的就是8.0版本，所以官方文档最靠谱</p>
</blockquote>
<p>各部分含义拆解如下：</p>
<ol>
<li>
<p><code>sudo</code></p>
<ul>
<li>以系统管理员(root)权限执行命令，因为写入<code>/etc/yum.repos.d/</code>目录（系统软件源配置目录）需要管理员权限</li>
</ul>
</li>
<li>
<p><code>tee /etc/yum.repos.d/mongodb-org-8.0.repo</code></p>
<ul>
<li>tee: 命令行工具，用户将输入内容同时写入指定文件和输出到屏幕（方便确认内容是否正确写入）</li>
<li><code>/etc/yum.repos.d/mongodb-org-8.0.repo</code>: 目标文件路径。<code>/etc/yum.repos.d</code> 是Linux系统默认存放软件源配置的目录，<code>.repo</code>是YUM/DNF源配置文件到标准后缀，文件名<code>mongodb-org-8.0.repo</code>明确标识了这是MongoDB8.0的源配置</li>
</ul>
</li>
<li>
<p>&lt;&lt;EOF 和 EOF</p>
<ul>
<li>这是<code>Shell</code>中的Here Document(嵌入文档）语法，用于将<code>&lt;&lt;EOF和EOF</code>之间的内容作为输入传递给<code>tee</code>命令。EOF是分隔符（可替换为其他字符串，如END), 前后必须一致且单独成行，确保内容边界清晰。</li>
</ul>
</li>
<li>
<p>中间的配置内容(MongoDB 8.0源信息）</p>
</li>
</ol>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[mongodb-org-8.0]</span>          <span class="hljs-comment"># 软件源的唯一标识（方括号内的名称），用于区分系统中的其他软件源</span>
<span class="hljs-attr">name</span>=MongoDB Repository    <span class="hljs-comment"># 软件源的描述名称，方便用户识别（此处为“MongoDB 仓库”）</span>
<span class="hljs-attr">baseurl</span>=https://repo.mongodb.org/yum/redhat/<span class="hljs-number">8</span>/mongodb-org/<span class="hljs-number">8.0</span>/x<span class="hljs-number">86_64</span>/  <span class="hljs-comment"># 软件包的实际下载地址：针对 Red Hat 8 系统、x86_64 架构的 MongoDB 8.0 官方源</span>
<span class="hljs-attr">gpgcheck</span>=<span class="hljs-number">1</span>                 <span class="hljs-comment"># 是否启用 GPG 签名校验（1 表示启用，用于验证软件包的完整性和安全性，防止被篡改）</span>
<span class="hljs-attr">enabled</span>=<span class="hljs-number">1</span>                  <span class="hljs-comment"># 是否启用该软件源（1 表示启用，0 表示禁用，启用后包管理器会从该源检索软件）</span>
<span class="hljs-attr">gpgkey</span>=https://pgp.mongodb.com/server-<span class="hljs-number">8.0</span>.asc  <span class="hljs-comment"># GPG 公钥文件的地址，用于校验软件包的签名</span>
</code></pre>
<p>总结
这条命令的最终效果是：<strong>在系统中创建一个 MongoDB 8.0 官方源的配置文件</strong>，告诉包管理器（dnf/yum）可以从该源下载并安装 MongoDB 8.0 相关软件，同时通过 GPG 校验确保软件包的安全性。执行后，即可通过 <code>sudo dnf install -y mongodb-org</code> 等命令安装 MongoDB 8.0 了。</p>
<h6 data-id="heading-2">导入 MongoDB 的 GPG 公钥到系统</h6>
<pre><code class="hljs language-bash" lang="bash">sudo rpm --import https://pgp.mongodb.com/server-8.0.asc
</code></pre>
<p>导入 MongoDB 的 GPG 公钥到系统, 为什么需要公钥</p>
<blockquote>
<p>下载软件包 → 验证签名 → 确认是官方发布 → 安全安装<br/>
↓<br/>
没有公钥 = 无法验证 = 安装失败或警告</p>
</blockquote>
<h6 data-id="heading-3">清理 DNF 包管理器的所有缓存</h6>
<pre><code class="hljs language-bash" lang="bash">sudo dnf clean all
</code></pre>
<p>为什么要清理缓存？</p>

























<table><thead><tr><th>原因</th><th>说明</th></tr></thead><tbody><tr><td>🔄 刚配置了新源</td><td>确保使用最新的源信息</td></tr><tr><td>🐛 缓存损坏</td><td>解决安装错误</td></tr><tr><td>💾 释放空间</td><td>清理不需要的旧文件</td></tr><tr><td>🆕 强制刷新</td><td>获取最新的软件包列表</td></tr></tbody></table>
<h6 data-id="heading-4">安装mongodb</h6>
<pre><code class="hljs language-bash" lang="bash">sudo yum install -y mongodb-org
</code></pre>
<p>配置 MongoDB 的 YUM 软件仓库地址，安装的完整截图</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e79addd00544298b7cd92d396916f1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=u%2BTzfPdRa570BoaipICpSYZvS64%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/022c33a5bd9c48a4af4b05c27544f07f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=UaNbLHbQyGNVRT9ejF%2Fi1rK5QMo%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58ce64be64a1451c9d8d147c088cfe91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=z8QREBWxShS1AhCvXKtVPIXNHy8%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-5">启动mongoDB服务</h5>
<p>上面我们已经成功的安装了<code>8.0.15-1</code>这个版本，我们先把数据库服务启动</p>
<h6 data-id="heading-6">启动 MongoDB 服务器（后台服务）</h6>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl start mongod  <span class="hljs-comment"># 启动 MongoDB 服务器</span>
sudo systemctl <span class="hljs-built_in">enable</span> mongod <span class="hljs-comment"># 设置开机启动</span>
sudo systemctl status mongod <span class="hljs-comment"># 检查服务状态</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3a88b61b205455faa89cf81338af799~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=xj%2Bbrxzt%2F5%2BwtW7sC%2BYkA2YtrJM%3D" alt="image.png" loading="lazy"/></p>
<h6 data-id="heading-7">启动 MongoDB Shell, 在ECS终端输入<code>mongosh</code></h6>
<pre><code class="hljs language-bash" lang="bash">// 连接到本地默认 MongoDB
mongosh
</code></pre>
<p>这样就可以开启, 与MongoDB数据库进行交互的命令行界面, 可以看到第一次连接数据库的时候, 产生了一些警告</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c98e868581184c65af3d264cb84da47a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=7EMLkyRZp4h28xxRaVrxO2MGShI%3D" alt="image.png" loading="lazy"/></p>
<p>比如截图的第二条</p>
<blockquote>
<p>Access control is not enabled for the database. Read and write access to data and configuration is unrestricted</p>
</blockquote>
<p>就是说咱们的数据库没有限制，谁都可以读写咱们的数据库</p>
<h5 data-id="heading-8">配置数据库访问权限</h5>
<h6 data-id="heading-9">编辑配置文件<code>/etc/mongod.conf</code>，启动验证</h6>
<p>我们编辑下配置文件</p>
<pre><code class="hljs language-bash" lang="bash">sudo nano /etc/mongod.conf
</code></pre>
<p>把security取消注释，authorization改为<code>enabled</code>，允许验证</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">security:</span>
 <span class="hljs-attr">authorization:</span> <span class="hljs-string">enabled</span>
</code></pre>
<p>保存（Ctrl+O &gt; Enter &gt; Ctrl+X for nano）。重启mongod服务</p>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl restart mongod
sudo systemctl status mongod  <span class="hljs-comment"># 确认running</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db5953f86bc149ea8295bd86f343a07f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=rL9MYQkYwpQyl%2FjkDz0XW4uZ5JI%3D" alt="image.png" loading="lazy"/></p>
<h6 data-id="heading-10">增加管理员用户</h6>
<p>我们先切换到 admin 数据库, 因为admin数据库是特殊的管理数据库</p>
<pre><code class="hljs language-bash" lang="bash">use admin
</code></pre>
<ul>
<li>MongoDB中admin数据库是系统级数据库</li>
<li>所有的管理员用户必须存储在admin数据库中</li>
<li>只有在admin数据库中创建的用户才能拥有跨数据库的管理权限</li>
</ul>
<p>如果你不先 use admin，而是在其他数据库（比如默认的 test）中创建管理员，<strong>这个用户就只能管理 test 数据库，无法管理整个 MongoDB 实例</strong>。</p>
<pre><code class="hljs language-php" lang="php">db.<span class="hljs-title function_ invoke__">createUser</span>({
  <span class="hljs-attr">user</span>: <span class="hljs-string">"admin"</span>,
  <span class="hljs-attr">pwd</span>: <span class="hljs-string">"xxxxxxxx"</span>,  // 用您实际密码替换
  <span class="hljs-attr">roles</span>: [
    { <span class="hljs-attr">role</span>: <span class="hljs-string">"userAdminAnyDatabase"</span>, <span class="hljs-attr">db</span>: <span class="hljs-string">"admin"</span> },
    { <span class="hljs-attr">role</span>: <span class="hljs-string">"readWriteAnyDatabase"</span>, <span class="hljs-attr">db</span>: <span class="hljs-string">"admin"</span> },
    { <span class="hljs-attr">role</span>: <span class="hljs-string">"dbAdminAnyDatabase"</span>, <span class="hljs-attr">db</span>: <span class="hljs-string">"admin"</span> }
  ]
})
</code></pre>
<p>咱们详细解释下上面命令</p>
<ul>
<li>user 是登录使用的账号名</li>
<li>pwd 账号对应的密码</li>
<li>roles 角色数组，定义了用户的权限。这里分配了三个角色：
<ul>
<li>userAdminAnyDatabase 用户管理权限，只管理用户，不能读写数据</li>
<li>readWriteAnyDatabase 在任何数据库中 读写数据</li>
<li>dbAdminAnyDatabase  管理数据库结构</li>
</ul>
</li>
</ul>

<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## 为什么需要三个角色？</span>
每个角色负责不同的职责，组合起来形成<span class="hljs-strong">**超级管理员**</span>：

userAdminAnyDatabase    → 管理用户和权限
<span class="hljs-bullet">+</span>
readWriteAnyDatabase    → 操作数据（增删改查）
<span class="hljs-bullet">+</span>
dbAdminAnyDatabase      → 管理数据库结构
=
完整的管理员权限
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42a46519f333467eadc11cefeb1a8454~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=wYp7TGQgVq5pzmbBnJx8L7k40XM%3D" alt="image.png" loading="lazy"/></p>
<p>执行成功，输出<code>{ ok: 1 }</code>，就表示用户创建成功了</p>
<pre><code class="hljs language-scss" lang="scss">db<span class="hljs-selector-class">.getUsers</span>()
</code></pre>
<p>通过db.getUsers(）也可以查看我们新增的用户是否成功</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52d67304230f40c59f41b71d7b703163~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=tk5ttiKNN2jmb34Tap6nf5R1KK4%3D" alt="image.png" loading="lazy"/></p>
<p><strong>由于我们现在已经启动验证</strong>，现在执行<code>mongosh</code>，是可以连接到mongoDB数据库，但是想要读写数据库，读写用户就不行了，会提示我们没有权限</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/265697cd30be469e94549b4f2168d759~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=xFNTRg9giH7ZvcFixNlxZYV8Q2M%3D" alt="image.png" loading="lazy"/></p>
<h6 data-id="heading-11">使用存储在 admin 数据库中的 admin 用户进行认证登录</h6>
<p>前面我们创建的admin用户就是保存在admin数据库，所以我们使用 admin 数据库中的admin用户认证</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">1. 使用 admin 数据库中的用户认证</span>
mongosh -u admin --authenticationDatabase admin
<span class="hljs-meta prompt_">
# </span><span class="bash">2. 登录后在 <span class="hljs-built_in">test</span> 数据库</span>
<span class="hljs-meta prompt_">test&gt; </span><span class="bash">
</span><span class="hljs-meta prompt_">
# </span><span class="bash">3. 可以切换到任何数据库工作</span>
<span class="hljs-meta prompt_">test&gt; </span><span class="bash">use myapp</span>
switched to db myapp
<span class="hljs-meta prompt_">
myapp&gt; </span><span class="bash">show collections</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">4. 也可以切换到 admin 数据库</span>
<span class="hljs-meta prompt_">myapp&gt; </span><span class="bash">use admin</span>
switched to db admin
<span class="hljs-meta prompt_">
admin&gt; </span><span class="bash">db.getUsers()</span>
</code></pre>
<ul>
<li>mongosh: 启动 MongoDB Shell 客户端</li>
<li>-u admin: 使用用户名 admin 登录</li>
<li>--authenticationDatabase admin: 指定认证数据库为 admin
<ul>
<li>去admin数据库中查找用户admin的认证信息</li>
<li>在admin数据库中验证密码是否正确</li>
</ul>
</li>
<li>登录后默认连接的是test数据库</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/310ee9e09b6d4f6dbeb2d548038b8d1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=vxMO2%2BIzKR6TTZX9%2Fr1RLoS6FpY%3D" alt="image.png" loading="lazy"/></p>
<p>如果想直接连接到特定数据库
可以在连接字符串中指定：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 认证使用 admin，但直接进入 myapp 数据库工作</span>
mongosh <span class="hljs-string">"mongodb://admin:password@localhost:27017/myapp?authSource=admin"</span>
</code></pre>
<h5 data-id="heading-12">后端express连接mongoDB</h5>
<p>前面我们mongod.conf配置文件，关于网络的，绑定IP是<code>127.0.0.1</code>，那就是ECS上的Mongo服务器, 只允许ECS上的后端服务访问，虽然也可以修改IP，开放外网</p>
<p>mongod.conf配置文件, 只允许本地访问</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># network interfaces</span>
net:
 port: 27017
 bindIp: 127.0.0.1 <span class="hljs-comment"># Enter 0.0.0.0,:: </span>
</code></pre>
<blockquote>
<p>数据库默认不对外开放端口：为了安全，服务器上的 MongoDB、MySQL 等数据库，通常只监听本地回环地址（127.0.0.1），拒绝外部直接访问，本地服务无法通过公网 IP + 数据库端口连接。<br/>
<strong>生产环境的数据库应该只监听本地，不暴露到公网！</strong></p>
</blockquote>
<p>可是我们本地开发也需要连接，这就需要用到SSH端口转发</p>
<h6 data-id="heading-13">SSH 端口转发（SSH Tunneling） 命令</h6>
<p>看下什么是SSH端口转发</p>
<pre><code class="hljs language-scss" lang="scss">你的电脑                    SSH 隧道                  远程服务器
(本地)                   (加密连接)              (<span class="hljs-number">114.215</span>.<span class="hljs-number">200.219</span>)
   |                                                    |
   |  访问 localhost:<span class="hljs-number">27017</span>                              |
   |  ────────────────────────────&gt;                    |
   |          通过 SSH 加密传输                         |
   |                                   转发到本地 MongoDB
   |                                   localhost:<span class="hljs-number">27017</span>
   |  &lt;────────────────────────────                    |
   |          返回数据                                  |
</code></pre>
<p>就是说本地服务 → 连接本地映射的端口 → SSH 加密通道 → 服务器 SSH 服务 → 转发到服务器本地的数据库端口，相当于通过 SSH “搭桥”，让本地服务间接访问到服务器上不对外暴露的数据库。</p>
<p>先查询 27017 端口（MongoDB 默认端口）相关进程信息，</p>
<pre><code class="hljs language-bash" lang="bash">lsof -i:27017
</code></pre>
<ul>
<li>lsof：List Open Files 的缩写，用于列出系统中所有打开的文件（在 Linux 中，网络连接、端口等也被视为 “文件”）。</li>
<li>-i:27017：-i 选项用于筛选网络相关的 “文件”（即网络连接 / 端口），:27017 指定筛选 端口号为 27017 的网络连接。</li>
</ul>
<p>可以看到我本地mongod已经占用了27017端口，
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4d3796537eb4eaaaa3d37f850de66f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=QKS%2BEz77ROBwyFAI7bWgQuS2Juc%3D" alt="image.png" loading="lazy"/></p>
<p>这样我就要停掉这个端口，如果我还要用这个端口做转发的话，不然转发的时候会报错，像这样提示Address already in use
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61f4ac4e38364bb990811029fbd10767~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=l5dIZA6spPhk%2F4IPAXp8raSTQyM%3D" alt="image.png" loading="lazy"/></p>
<p>我先把本地占用27017的进程给停掉</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">kill</span> -9 914
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50494ed75b9444f4b993050d188d534f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=4Wl6nnFOYhiDmFYBWbehOrPLDiE%3D" alt="image.png" loading="lazy"/></p>
<p>执行如下的端口转发命令</p>
<pre><code class="hljs language-bash" lang="bash">ssh -CNL 27017:127.0.0.1:27017 root@114.215.200.219
</code></pre>
<p>命令解释</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">### 1. <span class="hljs-strong">**`ssh`**</span></span>
<span class="hljs-bullet">-</span> SSH 客户端命令

<span class="hljs-section">### 2. <span class="hljs-strong">**`-C`**</span> (Compression)</span>
<span class="hljs-bullet">-</span> 表示<span class="hljs-strong">**启用数据压缩**</span>
<span class="hljs-bullet">-</span> 在传输过程中压缩数据以节省带宽

详细说明：
<span class="hljs-bullet">-</span> <span class="hljs-strong">**作用**</span>：压缩 SSH 连接中传输的所有数据
<span class="hljs-bullet">-</span> <span class="hljs-strong">**优势**</span>：在网络带宽有限或延迟高的情况下提升速度
<span class="hljs-bullet">-</span> <span class="hljs-strong">**适用**</span>：特别适合传输文本数据（如数据库查询结果）

<span class="hljs-section">### 3. <span class="hljs-strong">**`-N`**</span> (No command)</span>
<span class="hljs-bullet">-</span> 表示<span class="hljs-strong">**不执行远程命令**</span>
<span class="hljs-bullet">-</span> 只做端口转发，不打开远程 shell

详细说明：
<span class="hljs-bullet">-</span> <span class="hljs-strong">**作用**</span>：登录后不显示命令行提示符
<span class="hljs-bullet">-</span> <span class="hljs-strong">**优势**</span>：不占用远程 shell 会话，更加轻量
<span class="hljs-bullet">-</span> <span class="hljs-strong">**效果**</span>：终端光标停留，专注于端口转发功能

<span class="hljs-section">### 4. <span class="hljs-strong">**`-L`**</span> (Local Port Forwarding)</span>
<span class="hljs-bullet">-</span> 表示<span class="hljs-strong">**本地端口转发**</span>
<span class="hljs-bullet">-</span> 将本地端口映射到远程服务器的端口

<span class="hljs-section">### 5. <span class="hljs-strong">**`27017:127.0.0.1:27017`**</span></span>
这是转发规则，格式为：<span class="hljs-code">`本地端口:目标主机:目标端口`</span>

27017          :    127.0.0.1    :    27017
  ↓                     ↓                ↓
本地端口          目标主机           目标端口


详细说明：
<span class="hljs-bullet">-</span> <span class="hljs-strong">**第一个 27017**</span>：你本地电脑的端口
<span class="hljs-bullet">-</span> <span class="hljs-strong">**127.0.0.1**</span>：从<span class="hljs-strong">**远程服务器**</span>的角度看，目标主机是它自己（localhost）
<span class="hljs-bullet">-</span> <span class="hljs-strong">**第二个 27017**</span>：远程服务器上的 MongoDB 端口

<span class="hljs-section">### 6. <span class="hljs-strong">**`root@114.215.200.219`**</span></span>
<span class="hljs-bullet">-</span> 用户名：<span class="hljs-code">`root`</span>
<span class="hljs-bullet">-</span> 远程服务器 IP：<span class="hljs-code">`114.215.200.219`</span>
</code></pre>
<p>以 root 用户连接到 114.215.200.219 服务器，启用数据压缩（-C），不执行远程命令（-N），建立本地端口转发（-L），将本地 27017 端口映射到远程服务器的 127.0.0.1:27017</p>
<p>执行后会提示我们输入密码，root@114.215.200.219， 服务器root用户对应的密码，密码输入完后，该终端窗口会卡在那里（这代表隧道保持打开）。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67f47ae4a65e48c2822efe25fbb8801c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=EJnHOss5ewR2eh8vwQDt4nJ7W%2BM%3D" alt="image.png" loading="lazy"/></p>
<p>新开一个终端执行：</p>
<pre><code class="hljs language-css" lang="css">lsof -<span class="hljs-selector-tag">i</span>:<span class="hljs-number">27017</span>
</code></pre>
<p>看到是SSH占用了ssh 占用了 27017，说明隧道建立成功。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3572972e4e394b70b13a2c929ed9b851~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=%2BUAPtzugOqLcb0yApimynnuleRg%3D" alt="image.png" loading="lazy"/></p>
<h6 data-id="heading-14">在express服务里配置.env MONGODB_URI</h6>
<p>配置.env</p>
<pre><code class="hljs language-bash" lang="bash">MONGODB_URI=mongodb://admin:替换自己的密码@127.0.0.1:27017/admin?authSource=admin
</code></pre>
<p>上面代码解释如下</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## 连接字符串结构</span>
mongodb://  admin  :  密码  @  127.0.0.1  :  27017  /  admin  ?  authSource=admin
<span class="hljs-code">    ↓        ↓        ↓         ↓           ↓        ↓         ↓
  协议     用户名    密码    服务器地址    端口   默认数据库   认证数据库
  
// 连接后
admin&gt;  ← 直接在 admin 数据库中
</span>
<span class="hljs-section">### 6. <span class="hljs-strong">**`?authSource=admin`**</span> (认证数据库)</span>
<span class="hljs-bullet">-</span> <span class="hljs-strong">**指定去哪个数据库验证用户身份**</span>
<span class="hljs-bullet">-</span> 这里指定在 <span class="hljs-code">`admin`</span> 数据库中查找用户并验证密码

连接到：127.0.0.1:27017 的 MongoDB
默认数据库：admin（连接后工作的数据库）
认证方式：使用存储在 admin 数据库中的 admin 用户进行身份验证
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2d3808e2a134526ada84b824e2ee14c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=ZQ8LtiH4E8TUZpP8Gk8XuimMcwo%3D" alt="image.png" loading="lazy"/></p>
<p>如果没有建立SSH端口转发，就会提示如下，连接错误，拒绝连接</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/022a43e08f184db6995999f530f52649~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=CXUsTVvPsvAk0GUVAK9VKfW81OE%3D" alt="image.png" loading="lazy"/></p>
<p>还有一点要说的是，如果咱们关掉SSH连接终端窗口，就会导致本地连接错误，所以本地连接ECS数据库，需要保持SSH隧道连接</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 Java、Spring Boot 和 Spring AI 开发符合 A2A 标准的 AI 智能体]]></title>    <link>https://juejin.cn/post/7571086754879635502</link>    <guid>https://juejin.cn/post/7571086754879635502</guid>    <pubDate>2025-11-11T05:00:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571086754879635502" data-draft-id="7570992947463962634" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 Java、Spring Boot 和 Spring AI 开发符合 A2A 标准的 AI 智能体"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2025-11-11T05:00:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="信码由缰"/> <meta itemprop="url" content="https://juejin.cn/user/2110664941509214"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 Java、Spring Boot 和 Spring AI 开发符合 A2A 标准的 AI 智能体
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2110664941509214/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    信码由缰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T05:00:53.000Z" title="Tue Nov 11 2025 05:00:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>AI 智能体指的是一种软件实体，它能够利用自然语言处理、机器学习或推理系统等人工智能技术，自主感知、推理和行动，以实现特定目标。</p>
</blockquote>
<p><img src="https://cf-blog.icodebuddy.com/image/86/86-0.png" alt="" loading="lazy"/></p>
<p>我为 <a href="https://link.juejin.cn?target=https%3A%2F%2Ftelex.im%2F" target="_blank" title="https://telex.im/" ref="nofollow noopener noreferrer">Telex</a> 开发了一个 AI 智能体，该智能体接收一个正则表达式模式，并就该模式所匹配的字符串类型提供易于理解的解释。开发此智能体的灵感源于我在此之前开发的一个 API（您可以在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbituann%2Fstring-analyzer-api" target="_blank" title="https://github.com/bituann/string-analyzer-api" ref="nofollow noopener noreferrer">此处</a>查看该项目），在该 API 中我必须使用正则表达式进行一些自然语言处理。尽管我之前学习过正则表达式，但感觉像是第一次见到它。正则表达式就是这样。因此，当 Telex 为其平台寻求更多 AI 智能体时，我决定开发这个智能体。</p>
<p>以下是我使用 Java、Spring AI 和 Spring Boot 实现它的过程。</p>
<h2 data-id="heading-0">初始设置</h2>
<h3 data-id="heading-1">1. Spring Boot 项目初始化</h3>
<p>我使用 Spring 提供的<a href="https://link.juejin.cn?target=https%3A%2F%2Fstart.spring.io%2F" target="_blank" title="https://start.spring.io/" ref="nofollow noopener noreferrer">初始化工具</a>来初始化项目。请注意，我在依赖项中包含了 Spring Web 和 Open AI。</p>
<p><img src="https://cf-blog.icodebuddy.com/image/86/86-1.png" alt="初始化 Spring 项目" loading="lazy"/></p>
<h3 data-id="heading-2">2. 设置 API 凭证</h3>
<p>在我的 <code>application.properties</code> 文件中，我设置了 Spring AI 以使用我的 API 凭证（我的 API 密钥）。我通过 Google AI Studio 获得了一个免费的 Google Gemini API 密钥。我的 <code>application.properties</code> 文件设置如下：</p>
<pre><code class="hljs language-properties" lang="properties">
spring.config.import=classpath:AI.properties

  


spring.application.name=regexplain

spring.ai.openai.api-key = ${GEMINI_API_KEY}

spring.ai.openai.base-url https://generativelanguage.googleapis.com/v1beta/openai

spring.ai.openai.chat.completions-path = /chat/completions

spring.ai.openai.chat.options.model = gemini-2.5-pro

</code></pre>
<p>第一行导入了包含我 API 密钥的文件。重要的是不要将您的 API 密钥暴露给公众。该文件与 <code>application.properties</code> 位于同一文件夹中。</p>
<h3 data-id="heading-3">3. 首次项目运行</h3>
<p>使用我的包管理器（Maven），我安装了所需的依赖项。然后我运行了我的主类，以确保一切正常。如果您到目前为止一切都做对了，您的项目应该可以无错误运行。如果遇到任何错误，请在 Google 上查找解决方法。</p>
<h2 data-id="heading-4">A2A 请求和响应模型</h2>
<p>在深入实现之前，让我们先谈谈符合 A2A 标准的请求和响应的结构。A2A 协议遵循标准的 JSON-RPC 2.0 结构来处理请求和响应。</p>
<p>所有方法调用都封装在一个请求对象中，其结构如下：</p>
<pre><code class="hljs language-json" lang="json">
<span class="hljs-punctuation">{</span>

<span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>

<span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"String"</span><span class="hljs-punctuation">,</span>

<span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"String | Integer"</span><span class="hljs-punctuation">,</span>

<span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Message"</span>

<span class="hljs-punctuation">}</span>

</code></pre>
<p>响应对象有些类似：</p>
<pre><code class="hljs language-json" lang="json">
<span class="hljs-punctuation">{</span>

<span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>

<span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"String | Integer | null"</span><span class="hljs-punctuation">,</span>

<span class="hljs-attr">"result?"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Task | Message | null"</span><span class="hljs-punctuation">,</span>

<span class="hljs-attr">"error?"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"JSONRPCError"</span>

<span class="hljs-punctuation">}</span>

</code></pre>
<p>响应中的 ID <strong>必须</strong>与请求中的 ID 相同。</p>
<p>有关 A2A 协议的更多信息，请查阅 <a href="https://link.juejin.cn?target=https%3A%2F%2Fa2a-protocol.org%2Flatest%2F" target="_blank" title="https://a2a-protocol.org/latest/" ref="nofollow noopener noreferrer">A2A 协议文档</a>。</p>
<p>以上就是请求和响应的通用结构。我开发这个智能体是为了在 Telex 平台上使用，因此我的部分实现可能特定于 Telex。</p>
<p>现在进入实现部分。我创建了一个名为 <code>model</code> 的文件夹，用于存储我的模型。请求模型类 <code>A2ARequest</code> 如下所示：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">A2ARequest</span> {

<span class="hljs-keyword">private</span> String id;

<span class="hljs-keyword">private</span> RequestParamsProperty params;

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">A2ARequest</span><span class="hljs-params">(String id, RequestParamsProperty params)</span> {

<span class="hljs-built_in">this</span>.id = id;

<span class="hljs-built_in">this</span>.params = params;

}

  


<span class="hljs-comment">// getters and setters</span>

}

</code></pre>
<p><code>RequestParamsProperty</code> 类代表了 <code>params</code> 中包含信息的结构。它如下所示：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestParamsProperty</span> {

<span class="hljs-keyword">private</span> HistoryMessage message;

<span class="hljs-keyword">private</span> String messageId;

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">RequestParamsProperty</span><span class="hljs-params">(HistoryMessage message, String messageId)</span> {

<span class="hljs-built_in">this</span>.message = message;

<span class="hljs-built_in">this</span>.messageId = messageId;

}

  


<span class="hljs-comment">// getters and setter</span>

}

</code></pre>
<p><code>HistoryMessage</code> 类如下所示：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-meta">@JsonIgnoreProperties(ignoreUnknown = true)</span>

<span class="hljs-meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HistoryMessage</span> {

<span class="hljs-keyword">private</span> String kind;

<span class="hljs-keyword">private</span> String role;

<span class="hljs-keyword">private</span> List&lt;MessagePart&gt; parts;

<span class="hljs-keyword">private</span> String messageId;

<span class="hljs-keyword">private</span> String taskId;

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">HistoryMessage</span><span class="hljs-params">()</span> {}

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">HistoryMessage</span><span class="hljs-params">(String role, List&lt;MessagePart&gt; parts, String messageId, String taskId)</span> {

<span class="hljs-built_in">this</span>.kind = <span class="hljs-string">"message"</span>;

<span class="hljs-built_in">this</span>.role = role;

<span class="hljs-built_in">this</span>.parts = parts;

<span class="hljs-built_in">this</span>.messageId = messageId;

<span class="hljs-built_in">this</span>.taskId = taskId;

}

  


<span class="hljs-comment">// getters and setters</span>

}

</code></pre>
<p>注解的作用是让 Spring 知道在请求和响应的 JSON 表示中包含什么。如果请求中不存在某个属性，它应该忽略它并在类中将其设置为 null。如果某个属性设置为 null，则不应将其包含在响应中。</p>
<p><code>MessagePart</code> 类如下所示：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-meta">@JsonIgnoreProperties(ignoreUnknown = true)</span>

<span class="hljs-meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessagePart</span> {

<span class="hljs-keyword">private</span> String kind;

<span class="hljs-keyword">private</span> String text;

<span class="hljs-keyword">private</span> List&lt;MessagePart&gt; data;

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">MessagePart</span><span class="hljs-params">(String kind, String text, List&lt;MessagePart&gt; data)</span> {

<span class="hljs-built_in">this</span>.kind = kind;

<span class="hljs-built_in">this</span>.text = text;

<span class="hljs-built_in">this</span>.data = data;

}

  


<span class="hljs-comment">// getters and setters</span>

}

</code></pre>
<p>以上就是表示从 Telex 接收的请求结构所需的所有类。现在需要为我的响应创建一个模型，以及表示响应所需的所有支持类。</p>
<p><code>A2AResponse</code> 类：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">A2AResponse</span> {

<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String jsonrpc;

<span class="hljs-meta">@JsonInclude(JsonInclude.Include.ALWAYS)</span>

<span class="hljs-keyword">private</span> String id;

<span class="hljs-keyword">private</span> Result result;

<span class="hljs-keyword">private</span> CustomError error;

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">A2AResponse</span><span class="hljs-params">()</span> {

<span class="hljs-built_in">this</span>.jsonrpc = <span class="hljs-string">"2.0"</span>;

}

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">A2AResponse</span><span class="hljs-params">(String id, Result result, CustomError error)</span> {

<span class="hljs-built_in">this</span>.jsonrpc = <span class="hljs-string">"2.0"</span>;

<span class="hljs-built_in">this</span>.id = id;

<span class="hljs-built_in">this</span>.result = result;

<span class="hljs-built_in">this</span>.error = error;

}

  


<span class="hljs-comment">//getters and setters</span>

}

</code></pre>
<p><code>Result</code> 类：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Result</span> {

<span class="hljs-keyword">private</span> String id;

<span class="hljs-keyword">private</span> String contextId;

<span class="hljs-keyword">private</span> TaskStatus status;

<span class="hljs-keyword">private</span> List&lt;Artifact&gt; artifacts;

<span class="hljs-keyword">private</span> List&lt;HistoryMessage&gt; history;

<span class="hljs-keyword">private</span> String kind;

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">Result</span><span class="hljs-params">()</span> {}

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">Result</span><span class="hljs-params">(String id, String contextId, TaskStatus status, List&lt;Artifact&gt; artifacts, List&lt;HistoryMessage&gt; history, String task)</span> {

<span class="hljs-built_in">this</span>.id = id;

<span class="hljs-built_in">this</span>.contextId = contextId;

<span class="hljs-built_in">this</span>.status = status;

<span class="hljs-built_in">this</span>.artifacts = artifacts;

<span class="hljs-built_in">this</span>.history = history;

<span class="hljs-built_in">this</span>.kind = task;

}

  


<span class="hljs-comment">// getters and setters</span>

}

</code></pre>
<p><code>CustomError</code> 类：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomError</span> {

<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> code;

<span class="hljs-keyword">private</span> String message;

<span class="hljs-keyword">private</span> Map&lt;String, String&gt; data;

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">CustomError</span><span class="hljs-params">(<span class="hljs-type">int</span> code, String message, Map&lt;String, String&gt; data)</span> {

<span class="hljs-built_in">this</span>.code = code;

<span class="hljs-built_in">this</span>.message = message;

<span class="hljs-built_in">this</span>.data = data;

}

  


<span class="hljs-comment">// getters and setters</span>

}

</code></pre>
<p><code>TaskStatus</code> 类：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskStatus</span> {

<span class="hljs-keyword">private</span> String state;

<span class="hljs-keyword">private</span> Instant timestamp;

<span class="hljs-keyword">private</span> HistoryMessage message;

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">TaskStatus</span><span class="hljs-params">()</span> {}

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">TaskStatus</span><span class="hljs-params">(String state, Instant timestamp, HistoryMessage message)</span> {

<span class="hljs-built_in">this</span>.state = state;

<span class="hljs-built_in">this</span>.timestamp = timestamp;

<span class="hljs-built_in">this</span>.message = message;

}

  


<span class="hljs-comment">// getters and setters</span>

}

</code></pre>
<p><code>Artifact</code> 类：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Artifact</span> {

<span class="hljs-keyword">private</span> String artifactId;

<span class="hljs-keyword">private</span> String name;

<span class="hljs-keyword">private</span> List&lt;MessagePart&gt; parts; <span class="hljs-comment">// 稍后复查此类型</span>

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">Artifact</span><span class="hljs-params">()</span> {}

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">Artifact</span><span class="hljs-params">(String artifactId, String name, List&lt;MessagePart&gt; parts)</span> {

<span class="hljs-built_in">this</span>.artifactId = artifactId;

<span class="hljs-built_in">this</span>.name = name;

<span class="hljs-built_in">this</span>.parts = parts;

}

  


<span class="hljs-comment">// getters and setters</span>

}

</code></pre>
<p>A2A 协议还包含一个称为"智能体卡片"的东西。我也为它创建了一个模型。</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentCard</span> {

<span class="hljs-keyword">private</span> String name;

<span class="hljs-keyword">private</span> String description;

<span class="hljs-keyword">private</span> String url;

<span class="hljs-keyword">private</span> Map&lt;String, String&gt; provider;

<span class="hljs-keyword">private</span> String version;

<span class="hljs-keyword">private</span> Map&lt;String, Boolean&gt; capabilities;

<span class="hljs-keyword">private</span> List&lt;String&gt; defaultInputModes;

<span class="hljs-keyword">private</span> List&lt;String&gt; defaultOutputModes;

<span class="hljs-keyword">private</span> List&lt;Map&lt;String, Object&gt;&gt; skills;

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">AgentCard</span><span class="hljs-params">()</span> {

<span class="hljs-built_in">this</span>.provider = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

<span class="hljs-built_in">this</span>.capabilities = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

<span class="hljs-built_in">this</span>.skills = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

}

  


<span class="hljs-comment">// getters and setters</span>

}

</code></pre>
<p>模型部分就这些了。继续...</p>
<h2 data-id="heading-5">服务类</h2>
<p>我的智能体的作用是获取一个正则表达式字符串，然后使用预定义的提示词将其发送到 OpenAI 的 API。服务类负责与 OpenAI 通信，发送提示词并接收响应。我创建了另一个名为 <code>service</code> 的文件夹，我的服务类就放在这里。我是这样编写我的服务类的：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-meta">@Service</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RegExPlainService</span> {

<span class="hljs-keyword">private</span> ChatClient chatClient;

  


RegExPlainService(ChatClient.Builder chatClientBuilder) {

<span class="hljs-built_in">this</span>.chatClient = chatClientBuilder.build();

}

  


<span class="hljs-meta">@Tool(name = "regexplain", description = "An agent that explains what type of string a regex pattern matches")</span>

<span class="hljs-keyword">public</span> String <span class="hljs-title function_">generateResponse</span><span class="hljs-params">(String regex)</span> {

<span class="hljs-keyword">return</span> chatClient

.prompt(<span class="hljs-string">"Give me a simple explanation of the type of string matched by this regex pattern: %s. No validating statements from you. Just straight to the point"</span>.formatted(regex))

.call()

.content();

}

}

</code></pre>
<p><code>@Service</code> 注解允许 Spring Boot 将服务注入到您的控制器中。<code>@Tool</code> 注解将该方法标记为一个智能体工具，如果将来要扩展该智能体以包含该功能，它可以被自主调用。不过目前并不需要它。</p>
<h2 data-id="heading-6">控制器</h2>
<p>控制器通过 REST API 暴露该智能体。在这个案例中，我有两个端点，一个 GET 端点和一个 POST 端点。我在一个名为 <code>controller</code> 的文件夹中创建了我的控制器。实现如下：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-meta">@RestController</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RegExPlainController</span> {

<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RegExPlainService regexplainService;

  


<span class="hljs-meta">@Autowired</span>

RegExPlainController (RegExPlainService regexplainService) {

<span class="hljs-built_in">this</span>.regexplainService = regexplainService;

}

  


<span class="hljs-meta">@GetMapping("/a2a/agent/regexplain/.well-known/agent.json")</span>

<span class="hljs-keyword">public</span> ResponseEntity&lt;AgentCard&gt; <span class="hljs-title function_">getAgentCard</span> <span class="hljs-params">()</span> {

<span class="hljs-type">AgentCard</span> <span class="hljs-variable">agentCard</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AgentCard</span>();

agentCard.setName(<span class="hljs-string">"regexplain"</span>);

agentCard.setDescription(<span class="hljs-string">"An agent that provides a simple explanation of the type of string a regex pattern matches"</span>);

agentCard.setUrl(<span class="hljs-string">"regexplain-production.up.railway.app/api"</span>);

agentCard.setProvider(<span class="hljs-string">"Bituan"</span>, <span class="hljs-literal">null</span>); <span class="hljs-comment">// 假设 setProvider 处理 Map 的填充</span>

agentCard.setVersion(<span class="hljs-string">"1.0"</span>);

agentCard.setCapabilities(<span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>); <span class="hljs-comment">// 假设 setCapabilities 处理 Map 的填充</span>

agentCard.setDefaultInputModes(List.of(<span class="hljs-string">"text/plain"</span>));

agentCard.setDefaultOutputModes(List.of(<span class="hljs-string">"application/json"</span>, <span class="hljs-string">"text/plain"</span>));

agentCard.setSkill(<span class="hljs-string">"skill-001"</span>, <span class="hljs-string">"Explain Regex"</span>, <span class="hljs-string">"Provides a simple explanation of the type of string a regex pattern matches"</span>,

List.of(<span class="hljs-string">"text/plain"</span>), List.of(<span class="hljs-string">"text/plain"</span>), List.of());

  


<span class="hljs-keyword">return</span> ResponseEntity.ok(agentCard);

}

  


<span class="hljs-meta">@PostMapping("/a2a/agent/regexplain")</span>

<span class="hljs-keyword">public</span> ResponseEntity&lt;A2AResponse&gt; <span class="hljs-title function_">explainRegex</span> <span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> A2ARequest request)</span> {

String regexRequest;

String responseText;

  


<span class="hljs-comment">// 如果参数无效，返回 403</span>

<span class="hljs-keyword">try</span> {

regexRequest = request.getParams().getMessage().getParts().get(<span class="hljs-number">0</span>).getText();

} <span class="hljs-keyword">catch</span> (Exception e) {

<span class="hljs-type">CustomError</span> <span class="hljs-variable">error</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomError</span>(-<span class="hljs-number">32603</span>, <span class="hljs-string">"Invalid Parameter"</span>, Map.of(<span class="hljs-string">"details"</span>, e.getMessage()));

<span class="hljs-type">A2AResponse</span> <span class="hljs-variable">errorResponse</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A2AResponse</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, error);

<span class="hljs-keyword">return</span> ResponseEntity.status(HttpStatusCode.valueOf(<span class="hljs-number">403</span>)).body(errorResponse);

}

  


<span class="hljs-comment">// 如果调用服务失败，返回错误 500</span>

<span class="hljs-keyword">try</span> {

responseText = regexplainService.generateResponse(regexRequest);

} <span class="hljs-keyword">catch</span> (Exception e) {

<span class="hljs-type">CustomError</span> <span class="hljs-variable">error</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomError</span>(-<span class="hljs-number">32603</span>, <span class="hljs-string">"Internal Error"</span>, Map.of(<span class="hljs-string">"details"</span>, e.getMessage()));

<span class="hljs-type">A2AResponse</span> <span class="hljs-variable">errorResponse</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A2AResponse</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, error);

<span class="hljs-keyword">return</span> ResponseEntity.internalServerError().body(errorResponse);

}

  


<span class="hljs-comment">// 构建响应</span>

<span class="hljs-type">A2AResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A2AResponse</span>();

response.setId(request.getId());

  


<span class="hljs-comment">// 构建响应 -&gt; 构建结果</span>

<span class="hljs-type">Result</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>();

result.setId(UUID.randomUUID().toString());

result.setContextId(UUID.randomUUID().toString());

result.setKind(<span class="hljs-string">"task"</span>);

  


<span class="hljs-comment">// 构建响应 -&gt; 构建结果 -&gt; 构建状态</span>

<span class="hljs-type">TaskStatus</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskStatus</span>();

status.setState(<span class="hljs-string">"completed"</span>);

status.setTimestamp(Instant.now());

  


<span class="hljs-comment">// 构建响应 -&gt; 构建结果 -&gt; 构建状态 -&gt; 构建消息</span>

<span class="hljs-type">HistoryMessage</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HistoryMessage</span>();

message.setRole(<span class="hljs-string">"agent"</span>);

message.setParts(List.of(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessagePart</span>(<span class="hljs-string">"text"</span>, responseText, <span class="hljs-literal">null</span>)));

message.setKind(<span class="hljs-string">"message"</span>);

message.setMessageId(UUID.randomUUID().toString());

  


<span class="hljs-comment">// 构建响应 -&gt; 构建结果 -&gt; 构建状态 (续)</span>

status.setMessage(message);

  


<span class="hljs-comment">// 构建响应 -&gt; 构建结果 -&gt; 构建工件</span>

List&lt;Artifact&gt; artifacts = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

<span class="hljs-type">Artifact</span> <span class="hljs-variable">artifact</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Artifact</span>();

artifact.setArtifactId(UUID.randomUUID().toString());

artifact.setName(<span class="hljs-string">"regexplainerResponse"</span>);

artifact.setParts(List.of(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessagePart</span>(<span class="hljs-string">"text"</span>, responseText, <span class="hljs-literal">null</span>)));

artifacts.add(artifact);

  


<span class="hljs-comment">// 构建响应 -&gt; 构建结果 -&gt; 构建历史记录</span>

List&lt;HistoryMessage&gt; history = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

  


<span class="hljs-comment">// 构建响应 -&gt; 构建结果 (续)</span>

result.setStatus(status);

result.setArtifacts(artifacts);

result.setHistory(history);

  


<span class="hljs-comment">// 构建响应 (续)</span>

response.setResult(result);

  


<span class="hljs-keyword">return</span> ResponseEntity.ok(response);

}

}

</code></pre>
<ul>
<li>
<p>GET 端点使用的路由路径是 A2A 协议标准中用于获取智能体卡片的部分。智能体卡片是对智能体及其功能的描述。</p>
</li>
<li>
<p>POST 端点接收一个符合 A2A 标准的请求，执行智能体，然后返回适当的响应。</p>
</li>
</ul>
<h2 data-id="heading-7">结论</h2>
<p>就是这样。这就是我编写 Regexplain 的过程。</p>
<blockquote>
<p>通过这个示例，您可以从头开始构建您的 AI 智能体并使其符合 A2A 标准。或者，至少我希望这能让您对如何使用 Java 开发符合 A2A 标准的 AI 智能体有所了解。</p>
</blockquote>
<hr/>
<p>【注】本文译自：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.to%2Fbituan%2Fdeveloping-an-a2a-compliant-ai-agent-with-java-spring-boot-and-spring-ai-3l5e" target="_blank" title="https://dev.to/bituan/developing-an-a2a-compliant-ai-agent-with-java-spring-boot-and-spring-ai-3l5e" ref="nofollow noopener noreferrer">Developing an A2A-compliant AI Agent with Java, Spring Boot and Spring AI - DEV Community</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Day 8：06. 基于Nuxt开发博客项目-我的服务模块开发]]></title>    <link>https://juejin.cn/post/7570976560708583487</link>    <guid>https://juejin.cn/post/7570976560708583487</guid>    <pubDate>2025-11-11T05:37:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570976560708583487" data-draft-id="7571304204720144438" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Day 8：06. 基于Nuxt开发博客项目-我的服务模块开发"/> <meta itemprop="keywords" content="前端,后端,程序员"/> <meta itemprop="datePublished" content="2025-11-11T05:37:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="申阳"/> <meta itemprop="url" content="https://juejin.cn/user/4353721775165486"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Day 8：06. 基于Nuxt开发博客项目-我的服务模块开发
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4353721775165486/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    申阳
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T05:37:08.000Z" title="Tue Nov 11 2025 05:37:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e38b54a2eb8e40fda49a2e46ccc01311~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763444227&amp;x-signature=wu3%2FSa7o5TnXYIhuvlKDOolVD4k%3D" alt="PixPin_2025-11-11_13-32-01.gif" loading="lazy"/></p>
<h2 data-id="heading-0">一、前言</h2>
<p>大家好，今天是基于<code>Nuxt.js</code>开发个人博客的第8天。前面完成了首页的开发，接下来这个是我们"个人公司"的核心 - 【我的服务】模块。</p>
<p>这个模块，远不止是简单罗列你能提供的服务。它是你从“被动”的内容输出者，转变为“主动”的价值提供者的关键一步，是你“个人公司”的<strong>商业门户</strong>。</p>
<p>这个是我的示例站点，在这里可以看到我目前的进度，<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.csyblog.cn%2F" target="_blank" title="https://www.csyblog.cn/" ref="nofollow noopener noreferrer">www.csyblog.cn/</a></p>
<h2 data-id="heading-1">二、为什么你的博客必须有一个专业的“服务模块”？</h2>
<ol>
<li><strong>清晰的价值锚点：</strong> 一篇篇深入的文章展示了你的技术深度，而“服务模块”则清晰地告诉访客：“我能用这些技术为你解决什么问题？”（例如：定制化网站开发、技术咨询、SEO优化、企业培训）。这直接回答了潜在客户最关心的问题：“你能为我做什么？”</li>
<li><strong>建立专业信任感：</strong> 一个结构清晰、描述专业的服务页面，能极大增强你的可信度。它表明你不仅仅是一个技术爱好者，更是一位严谨的、可以提供商业解决方案的专业人士。</li>
<li><strong>高效的流量转化器：</strong> 你的技术博客通过SEO带来了精准的流量（例如，搜索“Nuxt4 项目实战”的开发者，很可能有相关项目需求）。一个醒目的“服务”入口，能将这部分高质量流量无缝引导至你的商业合作通道，实现从“阅读”到“咨询”的自然转化。</li>
<li><strong>提升个人品牌形象：</strong> 它将你的技能、经验和成功案例打包成一个完整的“产品”，让你的个人品牌更具商业价值和辨识度。</li>
</ol>
<h2 data-id="heading-2">三、<strong>个人公司展示服务的常见难点与我的解决方案</strong></h2>
<p>在开发这个模块时，我们深刻认识到个人公司面临的独特挑战，并在设计中予以解决：</p>
<h3 data-id="heading-3">难点1：服务项目多而杂，难以系统化展示。</h3>
<blockquote>
<p>作为“全能型”选手，你可能既能做前端，也能写后端，还能搞运维。但一股脑儿地罗列技能，反而会让访客对你的专业性产生质疑。</p>
</blockquote>
<p><strong>我的解决方案：</strong></p>
<blockquote>
<p>不要罗列技术栈，将服务进行逻辑归类（如：web开发、项目指导、经验分享），并为每个服务打上明确的标签。这样访客可以快速的定位到自己关心的领域，清晰直观。</p>
</blockquote>
<h3 data-id="heading-4">难点2：缺乏知名大客户背书，如何取信于人？</h3>
<blockquote>
<p>没有具体的服务经历，如何证明自己的能力？</p>
</blockquote>
<p><strong>我的解决方案：</strong></p>
<blockquote>
<p>在每项服务下，可以直接展示与之相关的<strong>个人项目案例</strong>。这些项目就是你最好的“客户”。</p>
<p>关联你写的相关<strong>技术博客</strong>。一篇深入剖析某个技术难点的文章，其说服力可能远超一句“我精通此技术”。这巧妙地用你的技术干货为你的服务能力做了强力背书。</p>
</blockquote>
<h3 data-id="heading-5">难点3：沟通成本高，如何高效筛选精准客户？</h3>
<blockquote>
<p>担心收到大量不匹配的咨询，浪费彼此时间。</p>
</blockquote>
<p><strong>我的解决方案：</strong></p>
<blockquote>
<p>在服务描述中，清晰界定服务内容、交付物、周期和预估价格范围。这几乎可以帮我们过滤掉<code>90%</code>的无效咨询。</p>
</blockquote>
<h2 data-id="heading-6">四、我的服务模块展示</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/825d8696a943463caefb66ecbdaa4908~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763444227&amp;x-signature=KUD%2BaBG0q2S2C8UPpfv2bn5TA8I%3D" alt="image-20251111115004063.png" loading="lazy"/></p>
<h2 data-id="heading-7">五、总结</h2>
<p>“我的服务”模块，是你博客的商业引擎。它不是为了炫耀，而是为了连接，将你的专业能力与市场的真实需求连接起来。</p>
<p><strong>你的博客，不应只是思想的仓库，更应是生意的起点。</strong></p>
<p><strong>千里之行，始于足下。你的“个人公司”从这第一个2小时开始。欢迎在评论区分享你的进展或遇到的卡点，我会逐一查看，尽可能的帮助解决。我们下一篇文章见！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS 上架工具全解析，从 Xcode 到 开心上架（Appuploader）跨平台命令行免 Mac 上传指南]]></title>    <link>https://juejin.cn/post/7571007466823204916</link>    <guid>https://juejin.cn/post/7571007466823204916</guid>    <pubDate>2025-11-11T05:40:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571007466823204916" data-draft-id="7571021605318443060" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS 上架工具全解析，从 Xcode 到 开心上架（Appuploader）跨平台命令行免 Mac 上传指南"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-11T05:40:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aiopencode"/> <meta itemprop="url" content="https://juejin.cn/user/1898230261493865"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS 上架工具全解析，从 Xcode 到 开心上架（Appuploader）跨平台命令行免 Mac 上传指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1898230261493865/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aiopencode
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T05:40:16.000Z" title="Tue Nov 11 2025 05:40:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 iOS 应用发布流程中，<strong>选择合适的上架工具</strong> 直接决定了开发效率与审核体验。
传统的上架方式依赖 macOS 与 Xcode，而随着跨平台开发的普及，开发者越来越需要更灵活、跨系统、自动化的解决方案。</p>
<p>本文将带你全面了解 iOS 上架工具的生态格局，从官方工具到第三方自动化方案，再到跨平台使用。</p>
<hr/>
<h2 data-id="heading-0">一、iOS 应用上架流程简述</h2>
<p>在分析工具前，我们先明确 App Store 上架的标准流程：</p>





























<table><thead><tr><th>阶段</th><th>操作内容</th></tr></thead><tbody><tr><td>1</td><td>注册 Apple Developer 开发者账号（$99/年）</td></tr><tr><td>2</td><td>创建签名证书与描述文件</td></tr><tr><td>3</td><td>打包生成 IPA 文件</td></tr><tr><td>4</td><td>上传 IPA 到 App Store</td></tr><tr><td>5</td><td>提交审核并发布上线</td></tr></tbody></table>
<p>上传环节是整个流程中最容易出错、最耗时间的部分。
不同工具的选择，会显著影响上架体验。</p>
<hr/>
<h2 data-id="heading-1">二、官方 iOS 上架工具总览</h2>
<h3 data-id="heading-2">Xcode（官方最全方案）</h3>
<ul>
<li><strong>系统要求</strong>：macOS</li>
<li><strong>特点</strong>：集成度高，可直接构建、签名、上传</li>
<li><strong>使用方式</strong>：
<ul>
<li>打包：<code>Product → Archive</code></li>
<li>上传：<code>Distribute App → App Store Connect</code></li>
</ul>
</li>
</ul>
<p>优点：稳定、官方支持
缺点：必须使用 Mac；手动流程多，不适合跨平台团队。</p>
<hr/>
<h3 data-id="heading-3">Transporter（App Store Connect 官方工具）</h3>
<ul>
<li><strong>系统要求</strong>：仅限 macOS</li>
<li><strong>使用方式</strong>：拖拽 IPA 上传至 App Store</li>
<li><strong>适合对象</strong>：非开发人员、需要批量上传的企业账号</li>
</ul>
<p>优点：图形化操作简单
缺点：仅支持 macOS；无法命令行自动化。</p>
<hr/>
<h3 data-id="heading-4">altool（已废弃）</h3>
<ul>
<li>
<p><strong>系统要求</strong>：macOS + Xcode Command Line Tools</p>
</li>
<li>
<p><strong>命令示例</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">xcrun altool --upload-app -f MyApp.ipa -u dev@icloud.com -p xxx
</code></pre>
</li>
<li>
<p><strong>现状</strong>：被 Transporter 接口替代，不推荐新项目使用。</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-5">Fastlane（自动化工具链）</h3>
<ul>
<li>
<p><strong>系统要求</strong>：macOS（可虚拟）</p>
</li>
<li>
<p><strong>主要功能</strong>：打包、签名、上传、截图管理</p>
</li>
<li>
<p><strong>常用命令</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">fastlane pilot upload --ipa ./build/MyApp.ipa
</code></pre>
</li>
</ul>
<p>优点：高度自动化、适合持续集成（CI/CD）
缺点：依赖 Mac 环境，对初学者配置较复杂。</p>
<hr/>
<h2 data-id="heading-6">三、第三方跨平台 iOS 上架工具对比</h2>
<p>随着跨平台开发（Flutter、uni-app、React Native）的流行，
许多开发者在 Windows 或 Linux 系统中工作，
这促生了一批 <strong>跨系统上架工具</strong>。</p>





























<table><thead><tr><th>工具</th><th>系统支持</th><th>上传方式</th><th>特点</th></tr></thead><tbody><tr><td><strong>Appuploader（开心上架）</strong></td><td>Win / Linux / macOS</td><td>图形界面 + 命令行</td><td>支持免 Mac 上传</td></tr><tr><td><strong>Fastlane + Transporter API</strong></td><td>macOS / Linux（API 模式）</td><td>命令行</td><td>可用于自动化上传</td></tr><tr><td><strong>第三方代上架平台</strong></td><td>Web 平台</td><td>远程代传</td><td>成本高、安全风险较大</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-7">四、开心上架（Appuploader）：全平台免 Mac 解决方案</h2>
<p>新版 <strong>开心上架（Appuploader）命令行工具</strong> 提供了真正意义上的跨平台能力，
开发者无需 Mac，即可在任意系统上传 iOS 应用到 App Store。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbec2faa28384353bd31bbf23e3812d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWlvcGVuY29kZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763444415&amp;x-signature=whNuWJpSkw7SV5PD6L%2BUg7ZO5N8%3D" alt="首页" loading="lazy"/></p>
<h3 data-id="heading-8">命令行示例：</h3>
<pre><code class="hljs language-bash" lang="bash">appuploader_cli -u ios@team.com -p xxx-xxx-xxx-xxx -c 2 -f ./release/MyApp.ipa
</code></pre>

























<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>-u</code></td><td>Apple 开发者账号</td></tr><tr><td><code>-p</code></td><td>App 专用密码（非 Apple ID 密码）</td></tr><tr><td><code>-c</code></td><td>上传通道（1=旧通道，2=新通道）</td></tr><tr><td><code>-f</code></td><td>指定要上传的 IPA 文件路径</td></tr></tbody></table>
<p><strong>核心特性</strong>：</p>
<ul>
<li>支持 <strong>Windows / Linux / macOS</strong>；</li>
<li>完全免 Xcode、免 Mac；</li>
<li>支持多通道上传；</li>
<li>提供命令行自动化接口；</li>
<li>不携带设备信息，安全稳定；</li>
<li>可集成 Fastlane / Jenkins / GitLab CI 流水线。</li>
</ul>
<hr/>
<h2 data-id="heading-9">五、开心上架与 Fastlane 的自动化组合</h2>
<p>在持续集成（CI/CD）环境中，开发者可将两者结合：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 构建应用</span>
fastlane gym --scheme <span class="hljs-string">"MyApp"</span> --output_directory <span class="hljs-string">"./build"</span>

<span class="hljs-comment"># 上传应用</span>
appuploader_cli -u dev@icloud.com -p xxx-xxx-xxx-xxx -c 2 -f ./build/MyApp.ipa
</code></pre>
<p>这样即可在 <strong>Windows / Linux</strong> CI 环境中自动上传 IPA 文件，
实现 “构建 → 上传 → 审核” 全自动上架流程。</p>
<hr/>
<h2 data-id="heading-10">六、不同 iOS 上架工具的对比总结</h2>








































<table><thead><tr><th>工具</th><th>平台</th><th>自动化支持</th><th>是否免 Mac</th><th>适合场景</th></tr></thead><tbody><tr><td>Xcode</td><td>macOS</td><td>不支持</td><td>否</td><td>原生开发者</td></tr><tr><td>Transporter</td><td>macOS</td><td>不支持</td><td>否</td><td>小规模手动上传</td></tr><tr><td>Fastlane</td><td>macOS / Linux（API 模式）</td><td>支持</td><td>部分</td><td>自动化流水线</td></tr><tr><td>Appuploader（开心上架）</td><td>Win / Linux / macOS</td><td>支持</td><td>是</td><td>跨平台团队与个人开发者</td></tr></tbody></table>
<p><strong>结论</strong>：
对于没有 Mac 环境的开发者或跨平台团队，
<strong>开心上架 CLI 是当前最具性价比的 iOS 上架工具方案</strong>。</p>
<hr/>
<h2 data-id="heading-11">七、常见问题与解决方案</h2>



































<table><thead><tr><th>问题</th><th>原因</th><th>解决方式</th></tr></thead><tbody><tr><td>上传失败 “Invalid Credentials”</td><td>密码错误</td><td>使用 App 专用密码</td></tr><tr><td>上传速度慢</td><td>网络不稳</td><td>切换上传通道（<code>-c 2</code>）</td></tr><tr><td>签名无效</td><td>证书配置错误</td><td>使用 Appuploader 自动生成</td></tr><tr><td>审核被拒</td><td>隐私声明缺失</td><td>补充 Info.plist 权限说明</td></tr><tr><td>构建未显示</td><td>Bundle ID 不匹配</td><td>检查证书与 App ID 对应关系</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-12">八、iOS 上架工具的选择建议</h2>





























<table><thead><tr><th>场景</th><th>推荐方案</th></tr></thead><tbody><tr><td>个人开发者</td><td>开心上架（Appuploader）命令行版</td></tr><tr><td>团队协作</td><td>Fastlane + Appuploader 自动化</td></tr><tr><td>Mac 用户</td><td>Xcode + Transporter 组合</td></tr><tr><td>无 Mac 环境</td><td>Appuploader 独立使用</td></tr><tr><td>多系统混合团队</td><td>HBuilderX 打包 + Appuploader 上传</td></tr></tbody></table>
<p>无论哪种方案，确保 IPA 包签名正确是成功上传的前提。</p>
<hr/>
<p><strong>iOS 上架工具</strong> 的演进，见证了从封闭到开放、从手动到自动化的变迁。
如今，开发者不再被 Mac 环境限制，通过一些跨平台工具，即可在任何系统中高效、安全地完成 App 上传与发布。</p>
<p>参考链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.applicationloader.net%2Ftutorial%2Fzh%2F83%2F83.html" target="_blank" title="https://www.applicationloader.net/tutorial/zh/83/83.html" ref="nofollow noopener noreferrer">www.applicationloader.net/tutorial/zh…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3响应式系统中，对象新增属性、数组改索引、原始值代理的问题如何解决？]]></title>    <link>https://juejin.cn/post/7570984257667366958</link>    <guid>https://juejin.cn/post/7570984257667366958</guid>    <pubDate>2025-11-11T03:13:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570984257667366958" data-draft-id="7571028035017867290" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Vue3响应式系统中，对象新增属性、数组改索引、原始值代理的问题如何解决？  "/> <meta itemprop="keywords" content="前端,Trae,AI编程"/> <meta itemprop="datePublished" content="2025-11-11T03:13:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="kknone"/> <meta itemprop="url" content="https://juejin.cn/user/1366025597879930"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Vue3响应式系统中，对象新增属性、数组改索引、原始值代理的问题如何解决？  
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1366025597879930/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    kknone
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T03:13:12.000Z" title="Tue Nov 11 2025 03:13:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、响应式系统的工作原理</h3>
<p>Vue3的响应式系统基于<strong>Proxy</strong>实现，通过代理对象（或数组）跟踪属性的<strong>读取</strong>（<code>get</code>）和<strong>修改</strong>（<code>set</code>）操作。当属性变化时，Vue会自动触发依赖更新，同步视图。</p>
<p>但Proxy并非“全能”——它只能跟踪<strong>初始存在的属性</strong>和<strong>已知的变更操作</strong>，对于一些“非常规”修改（如新增属性、直接修改数组索引），无法自动触发响应，需要我们手动规避。</p>
<h3 data-id="heading-1">二、对象的局限性：新增/删除属性不响应</h3>
<h4 data-id="heading-2">1. 问题描述</h4>
<p>用<code>reactive</code>创建的响应式对象，<strong>新增属性</strong>或<strong>删除属性</strong>时，无法触发视图更新。因为Proxy默认只跟踪对象初始化时的<strong>已有属性</strong>，新增/删除的属性不在初始跟踪范围内。</p>
<p>示例（错误用法）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> });

<span class="hljs-comment">// 新增属性：视图不更新</span>
user.<span class="hljs-property">age</span> = <span class="hljs-number">20</span>;

<span class="hljs-comment">// 删除属性：视图不更新</span>
<span class="hljs-keyword">delete</span> user.<span class="hljs-property">name</span>;
</code></pre>
<h4 data-id="heading-3">2. 规避方案</h4>
<p>针对对象的新增/删除操作，Vue3提供了3种标准解决方案：</p>
<h5 data-id="heading-4">(1) 使用<code>set</code>/<code>delete</code>函数</h5>
<p><code>set</code>（<code>Vue.set</code>的简写）用于向响应式对象<strong>新增属性</strong>，<code>delete</code>（<code>Vue.delete</code>的简写）用于<strong>删除属性</strong>，两者都会触发响应式更新。</p>
<p>示例（正确用法）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { reactive, set, <span class="hljs-keyword">delete</span> <span class="hljs-keyword">as</span> vueDelete } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> });

<span class="hljs-comment">// 新增响应式属性</span>
<span class="hljs-title function_">set</span>(user, <span class="hljs-string">'age'</span>, <span class="hljs-number">20</span>); <span class="hljs-comment">// 视图更新为 { name: 'Alice', age: 20 }</span>

<span class="hljs-comment">// 删除响应式属性</span>
<span class="hljs-title function_">vueDelete</span>(user, <span class="hljs-string">'name'</span>); <span class="hljs-comment">// 视图更新为 { age: 20 }</span>
</code></pre>
<h5 data-id="heading-5">(2) 扩展运算符生成新对象</h5>
<p>通过<strong>扩展运算符</strong>（<code>...</code>）创建新对象，替换原对象。新对象会继承原对象的响应式能力，触发视图更新。</p>
<p>示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> userRef = <span class="hljs-title function_">ref</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> }); <span class="hljs-comment">// 用ref包裹对象</span>

<span class="hljs-comment">// 新增属性：生成新对象</span>
userRef.<span class="hljs-property">value</span> = { ...userRef.<span class="hljs-property">value</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span> }; <span class="hljs-comment">// 响应式更新</span>
</code></pre>
<h5 data-id="heading-6">(3) 初始定义所有可能的属性</h5>
<p>如果提前知道对象的所有属性，可以在<code>reactive</code>初始化时就定义（值为<code>undefined</code>），后续修改时会自动触发响应。</p>
<details>
<summary>往期文章归档</summary>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbc287e1e36287afd90750fd907eca85e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bc287e1e36287afd90750fd907eca85e/" ref="nofollow noopener noreferrer">Vue 3中watch侦听器的正确使用姿势你掌握了吗？深度监听、与watchEffect的差异及常见报错解析 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F654b9447ef1ba7ec1126a1bc26a4726d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/654b9447ef1ba7ec1126a1bc26a4726d/" ref="nofollow noopener noreferrer">Vue响应式声明的API差异、底层原理与常见陷阱你都搞懂了吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F654b9447ef1ba7ec1126a1bc26a4726d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/654b9447ef1ba7ec1126a1bc26a4726d/" ref="nofollow noopener noreferrer">Vue响应式声明的API差异、底层原理与常见陷阱你都搞懂了吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc405a8d9950af5b7c63b56c348ac36b6%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c405a8d9950af5b7c63b56c348ac36b6/" ref="nofollow noopener noreferrer">为什么Vue 3需要ref函数？它的响应式原理与正确用法是什么？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa7e9abb9691a81e4404d9facabe0f7c3%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a7e9abb9691a81e4404d9facabe0f7c3/" ref="nofollow noopener noreferrer">Vue 3中reactive函数如何通过Proxy实现响应式？使用时要避开哪些误区？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbd995ea45161727597fb85b62566c43d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bd995ea45161727597fb85b62566c43d/" ref="nofollow noopener noreferrer">Vue3响应式系统的底层原理与实践要点你真的懂吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F53e3f270a80675df662c6857a3332c0f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/53e3f270a80675df662c6857a3332c0f/" ref="nofollow noopener noreferrer">Vue 3模板如何通过编译三阶段实现从声明式语法到高效渲染的跨越 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fddbce4f2a23aa72c96b1c0473900321e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ddbce4f2a23aa72c96b1c0473900321e/" ref="nofollow noopener noreferrer">快速入门Vue模板引用：从收DOM“快递”到调子组件方法，你玩明白了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F23a2d5a334e15575277814c16e45df50%2F" target="_blank" title="https://blog.cmdragon.cn/posts/23a2d5a334e15575277814c16e45df50/" ref="nofollow noopener noreferrer">快速入门Vue模板里的JS表达式有啥不能碰？计算属性为啥比方法更能打？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6be38de6382e31d282659b689c5b17f0%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6be38de6382e31d282659b689c5b17f0/" ref="nofollow noopener noreferrer">快速入门Vue的v-model表单绑定：语法糖、动态值、修饰符的小技巧你都掌握了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F60ce517684f4a418f453d66aa805606c%2F" target="_blank" title="https://blog.cmdragon.cn/posts/60ce517684f4a418f453d66aa805606c/" ref="nofollow noopener noreferrer">快速入门Vue3事件处理的挑战题：v-on、修饰符、自定义事件你能通关吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fe4ae7d5e4a9205bb11b2baccb230c637%2F" target="_blank" title="https://blog.cmdragon.cn/posts/e4ae7d5e4a9205bb11b2baccb230c637/" ref="nofollow noopener noreferrer">快速入门Vue3的v-指令：数据和DOM的“翻译官”到底有多少本事？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F999ce4fb32259ff4fbf4bf7bcb851654%2F" target="_blank" title="https://blog.cmdragon.cn/posts/999ce4fb32259ff4fbf4bf7bcb851654/" ref="nofollow noopener noreferrer">快速入门Vue3，插值、动态绑定和避坑技巧你都搞懂了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa6997d81b49cd232b87e1cf603888ad1%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a6997d81b49cd232b87e1cf603888ad1/" ref="nofollow noopener noreferrer">想让PostgreSQL快到飞起？先找健康密码还是先换引擎？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F1fee7afbb9abd4540b8aa9c141d6845d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/1fee7afbb9abd4540b8aa9c141d6845d/" ref="nofollow noopener noreferrer">想让PostgreSQL查询快到飞起？分区表、物化视图、并行查询这三招灵不灵？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F79c590fbd87ece535b11a71c9667884f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/79c590fbd87ece535b11a71c9667884f/" ref="nofollow noopener noreferrer">子查询总拖慢查询？把它变成连接就能解决？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F748cdac2536008199abf8a8a2cd0ec85%2F" target="_blank" title="https://blog.cmdragon.cn/posts/748cdac2536008199abf8a8a2cd0ec85/" ref="nofollow noopener noreferrer">PostgreSQL全表扫描慢到崩溃？建索引+改查询+更统计信息三招能破？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F32ca943703226d317d4276a8fb53b0dd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/32ca943703226d317d4276a8fb53b0dd/" ref="nofollow noopener noreferrer">复杂查询总拖后腿？PostgreSQL多列索引+覆盖索引的神仙技巧你get没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fca93f1d53aa910e7ba5ffd8df611c12b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ca93f1d53aa910e7ba5ffd8df611c12b/" ref="nofollow noopener noreferrer">只给表子集建索引？用函数结果建索引？PostgreSQL这俩操作凭啥能省空间又加速？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Ff507856ebfddd592448813c510a53669%2F" target="_blank" title="https://blog.cmdragon.cn/posts/f507856ebfddd592448813c510a53669/" ref="nofollow noopener noreferrer">B-tree索引像字典查词一样工作？那哪些数据库查询它能加速，哪些不能？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb2213bfcb5b88a862f2138404c03d596%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b2213bfcb5b88a862f2138404c03d596/" ref="nofollow noopener noreferrer">想抓PostgreSQL里的慢SQL？pg_stat_statements基础黑匣子和pg_stat_monitor时间窗，谁能帮你更准揪出性能小偷？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F26614eb7da6c476dde41d367ad888d2f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/26614eb7da6c476dde41d367ad888d2f/" ref="nofollow noopener noreferrer">PostgreSQL的“时光机”MVCC和锁机制是怎么搞定高并发的？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F69f99bc6972a860d559c74aad7280da4%2F" target="_blank" title="https://blog.cmdragon.cn/posts/69f99bc6972a860d559c74aad7280da4/" ref="nofollow noopener noreferrer">PostgreSQL性能暴涨的关键？内存IO并发参数居然要这么设置？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F7b7053f392147a8b3b1a16bebeb08d0a%2F" target="_blank" title="https://blog.cmdragon.cn/posts/7b7053f392147a8b3b1a16bebeb08d0a/" ref="nofollow noopener noreferrer">大表查询慢到翻遍整个书架？PostgreSQL分区表教你怎么“分类”才高效</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc856e3cb073822349f3bf2d29995dcfc%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c856e3cb073822349f3bf2d29995dcfc/" ref="nofollow noopener noreferrer">PostgreSQL 查询慢？是不是忘了优化 GROUP BY、ORDER BY 和窗口函数？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc096347d18e67b7431faacd2c4757093%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c096347d18e67b7431faacd2c4757093/" ref="nofollow noopener noreferrer">PostgreSQL里的子查询和CTE居然在性能上“掐架”？到底该站哪边？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F2eca89463454fd4250d7b66243b9fe5a%2F" target="_blank" title="https://blog.cmdragon.cn/posts/2eca89463454fd4250d7b66243b9fe5a/" ref="nofollow noopener noreferrer">PostgreSQL选Join策略有啥小九九？Nested Loop/Merge/Hash谁是它的菜？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F068ecb772a87d7df20a8c9fb4b233f8e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/068ecb772a87d7df20a8c9fb4b233f8e/" ref="nofollow noopener noreferrer">PostgreSQL新手SQL总翻车？这7个性能陷阱你踩过没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd498f63cd0a2d5a77e445c688a8b88db%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d498f63cd0a2d5a77e445c688a8b88db/" ref="nofollow noopener noreferrer">PostgreSQL索引选B-Tree还是GiST？“瑞士军刀”和“多面手”的差别你居然还不知道？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F9101b75bdec6faea9b35d54f14e37f36%2F" target="_blank" title="https://blog.cmdragon.cn/posts/9101b75bdec6faea9b35d54f14e37f36/" ref="nofollow noopener noreferrer">想知道数据库怎么给查询“算成本选路线”？EXPLAIN能帮你看明白？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd527f8ebb6e3dae2c7dfe4c8d8979444%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d527f8ebb6e3dae2c7dfe4c8d8979444/" ref="nofollow noopener noreferrer">PostgreSQL处理SQL居然像做蛋糕？解析到执行的4步里藏着多少查询优化的小心机？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6bfdae84f313cf7ad0bb7045c4392347%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6bfdae84f313cf7ad0bb7045c4392347/" ref="nofollow noopener noreferrer">PostgreSQL备份不是复制文件？物理vs逻辑咋选？误删还能精准恢复到1分钟前？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fde3672803de34dbad244d0a8d48b0eb5%2F" target="_blank" title="https://blog.cmdragon.cn/posts/de3672803de34dbad244d0a8d48b0eb5/" ref="nofollow noopener noreferrer">转账不翻车、并发不干扰，PostgreSQL的ACID特性到底有啥魔法？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fe463e8a2668abdf00a228c9b79324ded%2F" target="_blank" title="https://blog.cmdragon.cn/posts/e463e8a2668abdf00a228c9b79324ded/" ref="nofollow noopener noreferrer">银行转账不白扣钱、电商下单不超卖，PostgreSQL事务的诀窍是啥？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F5c967e595058c4a1fc4474a68e64031d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/5c967e595058c4a1fc4474a68e64031d/" ref="nofollow noopener noreferrer">PostgreSQL里的PL/pgSQL到底是啥？能让SQL从“说目标”变“讲步骤”？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F325047855e3e23b5ef82f7d2db134fbd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/325047855e3e23b5ef82f7d2db134fbd/" ref="nofollow noopener noreferrer">PostgreSQL视图不存数据？那它怎么简化查询还能递归生成序列和控制权限？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd2dba50bb6e4df7b27e735245a06a2a2%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d2dba50bb6e4df7b27e735245a06a2a2/" ref="nofollow noopener noreferrer">PostgreSQL索引这么玩，才能让你的查询真的“飞”起来？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F849ae5bab0f8c66e94c2f6ad1bb798e3%2F" target="_blank" title="https://blog.cmdragon.cn/posts/849ae5bab0f8c66e94c2f6ad1bb798e3/" ref="nofollow noopener noreferrer">PostgreSQL的表关系和约束，咋帮你搞定用户订单不混乱、学生选课不重复？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fef4800975ffa84f1ca51976a70a1585b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ef4800975ffa84f1ca51976a70a1585b/" ref="nofollow noopener noreferrer">PostgreSQL查询的筛子、排序、聚合、分组？你会用它们搞定数据吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbf54711525c507c5eacfa7b0151c39d2%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bf54711525c507c5eacfa7b0151c39d2/" ref="nofollow noopener noreferrer">PostgreSQL数据类型怎么选才高效不踩坑？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F887809b3e0375f5956873cd442f516d8%2F" target="_blank" title="https://blog.cmdragon.cn/posts/887809b3e0375f5956873cd442f516d8/" ref="nofollow noopener noreferrer">想解锁PostgreSQL查询从基础到进阶的核心知识点？你都get了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F934be1203725e8be9d6f6e9104e5abcc%2F" target="_blank" title="https://blog.cmdragon.cn/posts/934be1203725e8be9d6f6e9104e5abcc/" ref="nofollow noopener noreferrer">PostgreSQL DELETE居然有这些操作？返回数据、连表删你试过没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F0f0622e9b7402b599e618150d0596ffe%2F" target="_blank" title="https://blog.cmdragon.cn/posts/0f0622e9b7402b599e618150d0596ffe/" ref="nofollow noopener noreferrer">PostgreSQL UPDATE语句怎么玩？从改邮箱到批量更新的避坑技巧你都会吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F0e3bf7efc030b024ea67ee855a00f2de%2F" target="_blank" title="https://blog.cmdragon.cn/posts/0e3bf7efc030b024ea67ee855a00f2de/" ref="nofollow noopener noreferrer">PostgreSQL插入数据还在逐条敲？批量、冲突处理、返回自增ID的技巧你会吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb6cd3c86da6aac26ed829e472d34078e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b6cd3c86da6aac26ed829e472d34078e/" ref="nofollow noopener noreferrer">PostgreSQL的“仓库-房间-货架”游戏，你能建出电商数据库和表吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fba1f545a3410144552fbdbfcf31b5265%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ba1f545a3410144552fbdbfcf31b5265/" ref="nofollow noopener noreferrer">PostgreSQL 17安装总翻车？Windows/macOS/Linux避坑指南帮你搞定？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb5474d1480509c5072085abc80b3dd9f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b5474d1480509c5072085abc80b3dd9f/" ref="nofollow noopener noreferrer">能当关系型数据库还能玩对象特性，能拆复杂查询还能自动管库存，PostgreSQL凭什么这么香？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fcc098d8836e787baa8a4d92e4d56d5c5%2F" target="_blank" title="https://blog.cmdragon.cn/posts/cc098d8836e787baa8a4d92e4d56d5c5/" ref="nofollow noopener noreferrer">给接口加新字段又不搞崩老客户端？FastAPI的多版本API靠哪三招实现？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F46d05151c5bd31cf37a7bcf0b8f5b0b8%2F" target="_blank" title="https://blog.cmdragon.cn/posts/46d05151c5bd31cf37a7bcf0b8f5b0b8/" ref="nofollow noopener noreferrer">流量突增要搞崩FastAPI？熔断测试是怎么防系统雪崩的？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F65ce343cc5df9faf3a8e2eeaab42ae45%2F" target="_blank" title="https://blog.cmdragon.cn/posts/65ce343cc5df9faf3a8e2eeaab42ae45/" ref="nofollow noopener noreferrer">FastAPI秒杀库存总变负数？Redis分布式锁能帮你守住底线吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Feed6cd8985d9be0a4b092a7da38b3e0c%2F" target="_blank" title="https://blog.cmdragon.cn/posts/eed6cd8985d9be0a4b092a7da38b3e0c/" ref="nofollow noopener noreferrer">FastAPI的CI流水线怎么自动测端点，还能让Allure报告美到犯规？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6157d87338ce894d18c013c3c4777abb%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6157d87338ce894d18c013c3c4777abb/" ref="nofollow noopener noreferrer">如何用GitHub Actions为FastAPI项目打造自动化测试流水线？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Ffc4ef84559e04693a620d0714cb30787%2F" target="_blank" title="https://blog.cmdragon.cn/posts/fc4ef84559e04693a620d0714cb30787/" ref="nofollow noopener noreferrer">如何用Git Hook和CI流水线为FastAPI项目保驾护航？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F02b0c96842d1481c72dab63a149ce0dd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/02b0c96842d1481c72dab63a149ce0dd/" ref="nofollow noopener noreferrer">FastAPI如何用契约测试确保API的「菜单」与「菜品」一致？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc9c1e3bb0fdc15303b9b3b1f20124b0b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c9c1e3bb0fdc15303b9b3b1f20124b0b/" ref="nofollow noopener noreferrer">为什么TDD能让你的FastAPI开发飞起来？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fddbfa0447a5d0d6f9af12e7a6b206f70%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ddbfa0447a5d0d6f9af12e7a6b206f70/" ref="nofollow noopener noreferrer">如何用FastAPI玩转多模块测试与异步任务，让代码不再“闹脾气”？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbf9883a75ffa46b523a03b16ec56ce48%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bf9883a75ffa46b523a03b16ec56ce48/" ref="nofollow noopener noreferrer">如何在FastAPI中玩转“时光倒流”的数据库事务回滚测试？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbe553dbd5d51835d2c69553f4a773e2d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/be553dbd5d51835d2c69553f4a773e2d/" ref="nofollow noopener noreferrer">如何在FastAPI中优雅地模拟多模块集成测试？ - cmdragon's Blog</a></li>
</ul>
</details>
<details>
<summary>免费好用的热门在线工具</summary>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fraid-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/raid-calculator" ref="nofollow noopener noreferrer">RAID 计算器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fphotoshop-online" target="_blank" title="https://tools.cmdragon.cn/zh/apps/photoshop-online" ref="nofollow noopener noreferrer">在线PS - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmermaid-live-editor" target="_blank" title="https://tools.cmdragon.cn/zh/apps/mermaid-live-editor" ref="nofollow noopener noreferrer">Mermaid 在线编辑器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmath-solver-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/math-solver-calculator" ref="nofollow noopener noreferrer">数学求解计算器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsmart-teleprompter" target="_blank" title="https://tools.cmdragon.cn/zh/apps/smart-teleprompter" ref="nofollow noopener noreferrer">智能提词器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmagic-resume" target="_blank" title="https://tools.cmdragon.cn/zh/apps/magic-resume" ref="nofollow noopener noreferrer">魔法简历 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-puzzle-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-puzzle-tool" ref="nofollow noopener noreferrer">Image Puzzle Tool - 图片拼图工具 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsubtitle-downloader" target="_blank" title="https://tools.cmdragon.cn/zh/apps/subtitle-downloader" ref="nofollow noopener noreferrer">字幕下载工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Flyrics-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/lyrics-generator" ref="nofollow noopener noreferrer">歌词生成工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcloud-drive-search" target="_blank" title="https://tools.cmdragon.cn/zh/apps/cloud-drive-search" ref="nofollow noopener noreferrer">网盘资源聚合搜索 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fascii-art-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ascii-art-generator" ref="nofollow noopener noreferrer">ASCII字符画生成器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fjwt-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/jwt-tool" ref="nofollow noopener noreferrer">JSON Web Tokens 工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbcrypt-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/bcrypt-tool" ref="nofollow noopener noreferrer">Bcrypt 密码工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fgif-composer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/gif-composer" ref="nofollow noopener noreferrer">GIF 合成器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fgif-decomposer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/gif-decomposer" ref="nofollow noopener noreferrer">GIF 分解器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-steganography" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-steganography" ref="nofollow noopener noreferrer">文本隐写术 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh" target="_blank" title="https://tools.cmdragon.cn/zh" ref="nofollow noopener noreferrer">CMDragon 在线工具 - 高级AI工具箱与开发者套件 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%3Fcategory%3Dtrending" target="_blank" title="https://tools.cmdragon.cn/zh/apps?category=trending" ref="nofollow noopener noreferrer">应用商店 - 发现1000+提升效率与开发的AI工具和实用程序 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fchangelog" target="_blank" title="https://tools.cmdragon.cn/zh/changelog" ref="nofollow noopener noreferrer">CMDragon 更新日志 - 最新更新、功能与改进 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fsponsor" target="_blank" title="https://tools.cmdragon.cn/zh/sponsor" ref="nofollow noopener noreferrer">支持我们 - 成为赞助者 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-to-image-ai" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-to-image-ai" ref="nofollow noopener noreferrer">AI文本生成图像 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftemp-email" target="_blank" title="https://tools.cmdragon.cn/zh/apps/temp-email" ref="nofollow noopener noreferrer">临时邮箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fqrcode-parser" target="_blank" title="https://tools.cmdragon.cn/zh/apps/qrcode-parser" ref="nofollow noopener noreferrer">二维码解析器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-to-mindmap" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-to-mindmap" ref="nofollow noopener noreferrer">文本转思维导图 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fregex-visualizer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/regex-visualizer" ref="nofollow noopener noreferrer">正则表达式可视化工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsteganography-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/steganography-tool" ref="nofollow noopener noreferrer">文件隐写工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fiptv-explorer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/iptv-explorer" ref="nofollow noopener noreferrer">IPTV 频道探索器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsnapdrop" target="_blank" title="https://tools.cmdragon.cn/zh/apps/snapdrop" ref="nofollow noopener noreferrer">快传 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Flucky-draw" target="_blank" title="https://tools.cmdragon.cn/zh/apps/lucky-draw" ref="nofollow noopener noreferrer">随机抽奖工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fanime-scene-finder" target="_blank" title="https://tools.cmdragon.cn/zh/apps/anime-scene-finder" ref="nofollow noopener noreferrer">动漫场景查找器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftime-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/time-toolkit" ref="nofollow noopener noreferrer">时间工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fspeed-test" target="_blank" title="https://tools.cmdragon.cn/zh/apps/speed-test" ref="nofollow noopener noreferrer">网速测试 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbackground-remover" target="_blank" title="https://tools.cmdragon.cn/zh/apps/background-remover" ref="nofollow noopener noreferrer">AI 智能抠图工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbackground-replacer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/background-replacer" ref="nofollow noopener noreferrer">背景替换工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fartistic-qrcode" target="_blank" title="https://tools.cmdragon.cn/zh/apps/artistic-qrcode" ref="nofollow noopener noreferrer">艺术二维码生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fopen-graph-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/open-graph-generator" ref="nofollow noopener noreferrer">Open Graph 元标签生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-comparison" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-comparison" ref="nofollow noopener noreferrer">图像对比工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-compressor" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-compressor" ref="nofollow noopener noreferrer">图片压缩专业版 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fpassword-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/password-generator" ref="nofollow noopener noreferrer">密码生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsvg-optimizer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/svg-optimizer" ref="nofollow noopener noreferrer">SVG优化器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcolor-palette" target="_blank" title="https://tools.cmdragon.cn/zh/apps/color-palette" ref="nofollow noopener noreferrer">调色板生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fonline-metronome" target="_blank" title="https://tools.cmdragon.cn/zh/apps/online-metronome" ref="nofollow noopener noreferrer">在线节拍器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-geolocation" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-geolocation" ref="nofollow noopener noreferrer">IP归属地查询 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcss-grid-layout" target="_blank" title="https://tools.cmdragon.cn/zh/apps/css-grid-layout" ref="nofollow noopener noreferrer">CSS网格布局生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Femail-validator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/email-validator" ref="nofollow noopener noreferrer">邮箱验证工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcalligraphy-practice" target="_blank" title="https://tools.cmdragon.cn/zh/apps/calligraphy-practice" ref="nofollow noopener noreferrer">书法练习字帖 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ffinance-calculator-suite" target="_blank" title="https://tools.cmdragon.cn/zh/apps/finance-calculator-suite" ref="nofollow noopener noreferrer">金融计算器套件 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fchinese-kinship-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/chinese-kinship-calculator" ref="nofollow noopener noreferrer">中国亲戚关系计算器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fprotobuf-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/protobuf-toolkit" ref="nofollow noopener noreferrer">Protocol Buffer 工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-geolocation" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-geolocation" ref="nofollow noopener noreferrer">IP归属地查询 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-upscaler" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-upscaler" ref="nofollow noopener noreferrer">图片无损放大 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-compare" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-compare" ref="nofollow noopener noreferrer">文本比较工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-batch-lookup" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-batch-lookup" ref="nofollow noopener noreferrer">IP批量查询工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fdomain-finder" target="_blank" title="https://tools.cmdragon.cn/zh/apps/domain-finder" ref="nofollow noopener noreferrer">域名查询工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fdns-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/dns-toolkit" ref="nofollow noopener noreferrer">DNS工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ffavicon-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/favicon-generator" ref="nofollow noopener noreferrer">网站图标生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fsitemap_index.xml" target="_blank" title="https://tools.cmdragon.cn/sitemap_index.xml" ref="nofollow noopener noreferrer">XML Sitemap</a></li>
</ul>
</details>
<p>示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> user = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">age</span>: <span class="hljs-literal">undefined</span> }); <span class="hljs-comment">// 初始定义age</span>

user.<span class="hljs-property">age</span> = <span class="hljs-number">20</span>; <span class="hljs-comment">// 响应式更新（视图显示20）</span>
</code></pre>
<h3 data-id="heading-7">三、数组的局限性：直接修改索引/长度不响应</h3>
<h4 data-id="heading-8">1. 问题描述</h4>
<p>用<code>reactive</code>或<code>ref</code>包裹的数组，<strong>直接修改索引</strong>或<strong>修改长度</strong>时，Vue3早期版本无法触发响应（官网文档仍保留此说明）。尽管最新版本（v3.4+）已支持，但为了兼容性，仍建议用<strong>变异方法</strong>或<code>set</code>函数。</p>
<p>示例（不推荐用法）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> list = <span class="hljs-title function_">ref</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);

<span class="hljs-comment">// 直接修改索引：早期版本不响应</span>
list.<span class="hljs-property">value</span>[<span class="hljs-number">0</span>] = <span class="hljs-number">4</span>;

<span class="hljs-comment">// 修改长度：早期版本不响应</span>
list.<span class="hljs-property">value</span>.<span class="hljs-property">length</span> = <span class="hljs-number">2</span>;
</code></pre>
<h4 data-id="heading-9">2. 规避方案</h4>
<p>Vue3推荐用<strong>数组变异方法</strong>或<code>set</code>函数修改数组，确保响应式：</p>
<h5 data-id="heading-10">(1) 使用数组变异方法</h5>
<p>Vue3自动跟踪数组的<strong>变异方法</strong>（修改原数组的方法），这些方法会触发响应式更新。常用变异方法：</p>
<ul>
<li><code>push()</code>：末尾添加元素</li>
<li><code>pop()</code>：末尾删除元素</li>
<li><code>splice()</code>：插入/删除/替换元素</li>
<li><code>sort()</code>：排序</li>
<li><code>reverse()</code>：反转</li>
</ul>
<p>示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> list = <span class="hljs-title function_">ref</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);

<span class="hljs-comment">// 修改索引0的值：用splice</span>
list.<span class="hljs-property">value</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>); <span class="hljs-comment">// 替换第0个元素为4（响应式）</span>

<span class="hljs-comment">// 修改长度：用splice</span>
list.<span class="hljs-property">value</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">2</span>); <span class="hljs-comment">// 删除索引2及之后的元素（长度变为2，响应式）</span>
</code></pre>
<h5 data-id="heading-11">(2) 使用<code>set</code>函数</h5>
<p><code>set</code>函数可直接修改数组的指定索引，触发响应式更新。</p>
<p>示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { ref, set } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">const</span> list = <span class="hljs-title function_">ref</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);

<span class="hljs-comment">// 修改索引0的值：响应式</span>
<span class="hljs-title function_">set</span>(list.<span class="hljs-property">value</span>, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>);
</code></pre>
<h3 data-id="heading-12">四、原始值的局限性：<code>reactive</code>无法代理</h3>
<h4 data-id="heading-13">1. 问题描述</h4>
<p><code>reactive</code>只能代理<strong>对象或数组</strong>，无法代理<strong>原始值</strong>（如<code>number</code>、<code>string</code>、<code>boolean</code>）。直接用<code>reactive</code>包裹原始值会报错。</p>
<p>示例（错误用法）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-comment">// 报错：value cannot be made reactive: 0</span>
<span class="hljs-keyword">const</span> count = <span class="hljs-title function_">reactive</span>(<span class="hljs-number">0</span>);
</code></pre>
<h4 data-id="heading-14">2. 规避方案：使用<code>ref</code></h4>
<p><code>ref</code>是Vue3专门用于代理<strong>原始值</strong>的API，它会将原始值包裹在一个带<code>value</code>属性的响应式对象中。访问或修改时需通过<code>.value</code>（模板中无需<code>.value</code>，Vue会自动解包）。</p>
<p>示例（正确用法）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-comment">// 用ref代理原始值</span>
<span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);

<span class="hljs-comment">// 修改值：响应式</span>
count.<span class="hljs-property">value</span>++; <span class="hljs-comment">// 变为1</span>

<span class="hljs-comment">// 模板中使用：自动解包</span>
<span class="hljs-comment">// &lt;div&gt;{{ count }}&lt;/div&gt; // 显示1</span>
</code></pre>
<h3 data-id="heading-15">五、实践案例：购物车功能的响应式处理</h3>
<p>我们用上述知识实现一个<strong>购物车功能</strong>，包含商品的添加、删除和数量修改：</p>
<h4 data-id="heading-16">1. 需求分析</h4>
<ul>
<li>商品列表：响应式数组，支持添加、删除。</li>
<li>数量修改：点击“+”/“-”按钮，更新商品数量并同步总价。</li>
<li>总价计算：根据商品数量和单价，实时更新。</li>
</ul>
<h4 data-id="heading-17">2. 完整代码</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="cart"&gt;
    &lt;h2&gt;购物车&lt;/h2&gt;
    &lt;!-- 商品列表 --&gt;
    &lt;div v-for="(item, index) in cart" :key="item.id" class="cart-item"&gt;
      &lt;span&gt;{{ item.name }}&lt;/span&gt;
      &lt;button @click="decrement(index)"&gt;-&lt;/button&gt;
      &lt;span&gt;{{ item.quantity }}&lt;/span&gt;
      &lt;button @click="increment(index)"&gt;+&lt;/button&gt;
      &lt;button @click="removeItem(index)"&gt;删除&lt;/button&gt;
    &lt;/div&gt;
    &lt;!-- 总价 --&gt;
    &lt;p class="total"&gt;总价：{{ totalPrice }} 元&lt;/p&gt;
    &lt;!-- 添加商品按钮 --&gt;
    &lt;button @click="addItem" class="add-btn"&gt;添加商品&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, computed } from 'vue';

// 1. 用ref包裹购物车数组（支持响应式）
const cart = ref([
  { id: 1, name: '商品A', quantity: 1, price: 100 },
  { id: 2, name: '商品B', quantity: 2, price: 200 }
]);

// 2. 计算总价（响应式：依赖cart的变化）
const totalPrice = computed(() =&gt; {
  return cart.value.reduce((sum, item) =&gt; sum + item.quantity * item.price, 0);
});

// 3. 增加数量：用splice修改数组（遵循官网推荐）
function increment(index) {
  const item = cart.value[index];
  // 生成新商品对象（避免直接修改原对象）
  const newItem = { ...item, quantity: item.quantity + 1 };
  // 用splice替换原商品（触发响应式）
  cart.value.splice(index, 1, newItem);
}

// 4. 减少数量：用splice修改数组
function decrement(index) {
  const item = cart.value[index];
  if (item.quantity &gt; 1) {
    const newItem = { ...item, quantity: item.quantity - 1 };
    cart.value.splice(index, 1, newItem);
  }
}

// 5. 删除商品：用splice修改数组
function removeItem(index) {
  cart.value.splice(index, 1);
}

// 6. 添加商品：用push修改数组
function addItem() {
  const newItem = {
    id: Date.now(), // 用时间戳作为唯一ID
    name: `商品${cart.value.length + 1}`,
    quantity: 1,
    price: Math.floor(Math.random() * 100) + 50 // 随机单价（50-149元）
  };
  cart.value.push(newItem); // push是变异方法，触发响应式
}
&lt;/script&gt;

&lt;style scoped&gt;
.cart { max-width: 400px; margin: 20px auto; padding: 20px; border: 1px solid #eee; }
.cart-item { display: flex; align-items: center; margin: 10px 0; }
.cart-item span { margin: 0 10px; }
.total { font-weight: bold; margin: 20px 0; }
.add-btn { padding: 8px 16px; background: #42b983; color: #fff; border: none; border-radius: 4px; }
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-18">3. 代码说明</h4>
<ul>
<li><strong><code>ref</code>包裹数组</strong>：<code>cart</code>是<code>ref</code>对象，<code>cart.value</code>是响应式数组，修改时需通过<code>.value</code>。</li>
<li><strong>变异方法的使用</strong>：<code>splice</code>（修改数量、删除商品）、<code>push</code>（添加商品）都是数组变异方法，确保响应式。</li>
<li><strong>计算属性<code>computed</code></strong>：<code>totalPrice</code>依赖<code>cart</code>的变化，自动更新总价，无需手动触发。</li>
</ul>
<h3 data-id="heading-19">课后Quiz：测试你的理解</h3>
<h4 data-id="heading-20">问题1</h4>
<p>用<code>reactive</code>创建的对象<code>const user = reactive({ name: 'Alice' })</code>，如何新增响应式属性<code>age</code>？（至少2种方法）</p>
<h4 data-id="heading-21">问题2</h4>
<p>用<code>ref</code>包裹的数组<code>const list = ref([1,2,3])</code>，如何修改索引0的值为4？（至少2种方法）</p>
<h4 data-id="heading-22">答案解析</h4>
<p><strong>问题1答案</strong>：</p>
<ol>
<li>使用<code>set</code>函数：<code>set(user, 'age', 20)</code>。</li>
<li>扩展运算符生成新对象：<code>const userRef = ref(user); userRef.value = { ...userRef.value, age: 20 }</code>（<code>reactive</code>对象不能直接赋值，需用<code>ref</code>包裹）。</li>
</ol>
<p><strong>问题2答案</strong>：</p>
<ol>
<li>用<code>splice</code>：<code>list.value.splice(0, 1, 4)</code>。</li>
<li>用<code>set</code>函数：<code>set(list.value, 0, 4)</code>。</li>
<li>直接修改（最新版本支持）：<code>list.value[0] = 4</code>。</li>
</ol>
<h3 data-id="heading-23">常见报错解决方案</h3>
<h4 data-id="heading-24">报错1：<code>value cannot be made reactive: 0</code></h4>
<ul>
<li><strong>原因</strong>：<code>reactive</code>无法代理原始值（如<code>number</code>）。</li>
<li><strong>解决</strong>：用<code>ref</code>代替<code>reactive</code>：<code>const count = ref(0)</code>。</li>
</ul>
<h4 data-id="heading-25">报错2：<code>Cannot add property age, object is not extensible</code></h4>
<ul>
<li><strong>原因</strong>：<code>reactive</code>对象被冻结（<code>Object.freeze</code>），无法新增属性。</li>
<li><strong>解决</strong>：不要冻结响应式对象，或用<code>ref</code>包裹后修改<code>.value</code>。</li>
</ul>
<h4 data-id="heading-26">报错3：<code>TypeError: Cannot read properties of undefined (reading 'value')</code></h4>
<ul>
<li><strong>原因</strong>：<code>ref</code>对象未初始化，或模板中错误使用<code>.value</code>。</li>
<li><strong>解决</strong>：确保<code>ref</code>初始值非<code>undefined</code>，模板中直接用变量名（如<code>{{ count }}</code>而非<code>{{ count.value }}</code>）。</li>
</ul>
<h3 data-id="heading-27">预防报错的建议</h3>
<ol>
<li><strong>原始值用<code>ref</code></strong>：<code>reactive</code>只代理对象/数组，原始值优先用<code>ref</code>。</li>
<li><strong>数组用变异方法</strong>：修改数组时，优先用<code>push</code>、<code>splice</code>等变异方法，避免直接修改索引。</li>
<li><strong>对象新增属性用<code>set</code></strong>：新增对象属性时，用<code>set</code>函数而非直接赋值。</li>
</ol>
<h3 data-id="heading-28">参考链接</h3>
<ul>
<li>Vue3官网“响应式系统的局限性”：<a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fguide%2Fessentials%2Freactivity-fundamentals.html%23limitations-of-reactive" target="_blank" title="https://vuejs.org/guide/essentials/reactivity-fundamentals.html#limitations-of-reactive" ref="nofollow noopener noreferrer">vuejs.org/guide/essen…</a></li>
<li>Vue3官网“Ref API”：<a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fapi%2Freactivity-core.html%23ref" target="_blank" title="https://vuejs.org/api/reactivity-core.html#ref" ref="nofollow noopener noreferrer">vuejs.org/api/reactiv…</a></li>
<li>Vue3官网“数组变异方法”：<a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fguide%2Fessentials%2Freactivity-fundamentals.html%23caveat-in-arrays-and-collections" target="_blank" title="https://vuejs.org/guide/essentials/reactivity-fundamentals.html#caveat-in-arrays-and-collections" ref="nofollow noopener noreferrer">vuejs.org/guide/essen…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Object.fromEntries 实操]]></title>    <link>https://juejin.cn/post/7570976274238308398</link>    <guid>https://juejin.cn/post/7570976274238308398</guid>    <pubDate>2025-11-11T03:47:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570976274238308398" data-draft-id="7571086754879455278" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Object.fromEntries 实操"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-11T03:47:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Ric970"/> <meta itemprop="url" content="https://juejin.cn/user/1181319736075502"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Object.fromEntries 实操
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1181319736075502/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Ric970
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T03:47:09.000Z" title="Tue Nov 11 2025 03:47:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>上周帮实习生排查需求，发现他用 for 循环遍历数组转对象，写了 12 行代码还容易出错 —— 其实用 Object.fromEntries，3 行就能搞定，还能避免职场踩坑。</p>
<hr/>
<h2 data-id="heading-0">一、原理拆解：为什么 Object.fromEntries 更高效？</h2>
<h3 data-id="heading-1">核心逻辑</h3>
<p><code>Object.fromEntries()</code> 是 ES2019 新增的 API，作用是<strong>将键值对数组转换成对象</strong>，本质是 <code>Object.entries()</code> 的逆操作：</p>
<ul>
<li>输入：格式为 <code>[[key1, value1], [key2, value2]]</code> 的二维数组</li>
<li>输出：对应键值对组成的普通对象</li>
<li>底层：直接映射键值关系，无需手动维护索引和赋值，性能比 for 循环更优</li>
</ul>
<h3 data-id="heading-2">职场痛点关联</h3>
<p>新人常踩的 3 个坑，用它能直接规避：</p>
<ol>
<li>循环遍历漏处理空值，导致对象缺属性；</li>
<li>手动赋值时键名拼写错误，排查半小时；</li>
<li>嵌套数组转对象时，代码冗余难维护。</li>
</ol>
<hr/>
<h2 data-id="heading-3">二、实操步骤：3 种核心场景 + 代码示例</h2>
<h3 data-id="heading-4">场景 1：基础数组转对象（最常用）</h3>
<h4 data-id="heading-5">步骤：</h4>
<ol>
<li>准备键值对二维数组；</li>
<li>直接传入 <code>Object.fromEntries()</code>；</li>
<li>接收返回的目标对象。</li>
</ol>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 原始数组（接口返回常见格式）</span>
const userList = <span class="hljs-selector-attr">[  [<span class="hljs-string">'name'</span>, <span class="hljs-string">'张三'</span>]</span>,
  <span class="hljs-selector-attr">[<span class="hljs-string">'age'</span>, 28]</span>,
  <span class="hljs-selector-attr">[<span class="hljs-string">'role'</span>, <span class="hljs-string">'前端开发'</span>]</span>
];

<span class="hljs-comment">// 转换（仅1行代码）</span>
const userObj = <span class="hljs-selector-tag">Object</span><span class="hljs-selector-class">.fromEntries</span>(userList);

console<span class="hljs-selector-class">.log</span>(userObj);
<span class="hljs-comment">// 输出：{ name: '张三', age: 28, role: '前端开发' }</span>
</code></pre>
<h3 data-id="heading-6">场景 2：数组处理后转对象（结合 map）</h3>
<h4 data-id="heading-7">步骤：</h4>
<ol>
<li>用 <code>map()</code> 处理原始数组，生成键值对结构；</li>
<li>链式调用 <code>Object.fromEntries()</code> 完成转换。</li>
</ol>
<pre><code class="hljs language-ini" lang="ini">// 原始数据（后端返回的列表）
const <span class="hljs-attr">goodsList</span> = [
  { id: <span class="hljs-string">'g1'</span>, price: <span class="hljs-number">99</span> },
  { id: <span class="hljs-string">'g2'</span>, price: <span class="hljs-number">199</span> },
  { id: <span class="hljs-string">'g3'</span>, price: <span class="hljs-number">299</span> }
]<span class="hljs-comment">;</span>

// 转换为「商品ID-价格」映射对象
const <span class="hljs-attr">priceMap</span> = Object.fromEntries(
  goodsList.map(<span class="hljs-attr">goods</span> =&gt; [goods.id, goods.price]) // 生成键值对数组
)<span class="hljs-comment">;</span>

console.log(priceMap)<span class="hljs-comment">;</span>
// 输出：{ g1: 99, g2: 199, g3: 299 }
</code></pre>
<h3 data-id="heading-8">场景 3：嵌套数组转多层对象（进阶）</h3>
<h4 data-id="heading-9">步骤：</h4>
<ol>
<li>处理嵌套结构，提取深层键值；</li>
<li>分步骤转换或结合递归（复杂场景）。</li>
</ol>
<pre><code class="hljs language-css" lang="css">// 嵌套数组（配置项场景）
const configList = <span class="hljs-selector-attr">[  [<span class="hljs-string">'theme'</span>, [<span class="hljs-string">'color'</span>, <span class="hljs-string">'dark'</span>]</span>],
  <span class="hljs-selector-attr">[<span class="hljs-string">'layout'</span>, [<span class="hljs-string">'mode'</span>, <span class="hljs-string">'flex'</span>]</span>]
];

// 转多层对象
const configObj = <span class="hljs-selector-tag">Object</span><span class="hljs-selector-class">.fromEntries</span>(
  configList<span class="hljs-selector-class">.map</span>((<span class="hljs-selector-attr">[key, [subKey, subValue]</span>]) =&gt; <span class="hljs-selector-attr">[key, { [subKey]</span>: subValue }])
);

console<span class="hljs-selector-class">.log</span>(configObj);
// 输出：{ theme: { <span class="hljs-attribute">color</span>: <span class="hljs-string">'dark'</span> }, layout: { mode: <span class="hljs-string">'flex'</span> } }
</code></pre>
<hr/>
<h2 data-id="heading-10">三、注意事项：避坑 4 个关键细节</h2>
<ol>
<li><strong>键名重复问题</strong>：后出现的键值会覆盖前面的，需提前去重：</li>
</ol>
<pre><code class="hljs language-css" lang="css">const duplicateArr = <span class="hljs-selector-attr">[[<span class="hljs-string">'name'</span>, <span class="hljs-string">'李四'</span>]</span>, <span class="hljs-selector-attr">[<span class="hljs-string">'name'</span>, <span class="hljs-string">'王五'</span>]</span>];
console<span class="hljs-selector-class">.log</span>(<span class="hljs-selector-tag">Object</span><span class="hljs-selector-class">.fromEntries</span>(duplicateArr)); // { name: <span class="hljs-string">'王五'</span> }
</code></pre>
<ol start="2">
<li><strong>非数组参数报错</strong>：必须传入可迭代对象（数组、Map 等），否则抛错：</li>
</ol>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 错误用法</span>
<span class="hljs-selector-tag">Object</span><span class="hljs-selector-class">.fromEntries</span>(<span class="hljs-string">'invalid'</span>); <span class="hljs-comment">// Uncaught TypeError: Invalid iterable object</span>
</code></pre>
<ol start="3">
<li><strong>null/undefined 处理</strong>：值为 null/undefined 会正常保留，不会过滤：</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr = [[<span class="hljs-string">'address'</span>, <span class="hljs-literal">null</span>], [<span class="hljs-string">'phone'</span>, <span class="hljs-literal">undefined</span>]];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">fromEntries</span>(arr)); <span class="hljs-comment">// { address: null, phone: undefined }</span>
</code></pre>
<ol start="4">
<li><strong>兼容性</strong>：支持 ES2019 及以上环境，IE 完全不支持，需兼容时加 polyfill：</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 简单polyfill（兼容低版本浏览器）</span>
<span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Object</span>.<span class="hljs-property">fromEntries</span>) {
  <span class="hljs-title class_">Object</span>.<span class="hljs-property">fromEntries</span> = <span class="hljs-function"><span class="hljs-params">arr</span> =&gt;</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, ...arr.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[k, v]</span>) =&gt;</span> ({ [k]: v })));
}
</code></pre>
<hr/>
<h2 data-id="heading-11">四、差异化亮点：别人没说的实用技巧</h2>
<p>多数文章只讲基础用法，但实际开发中：</p>
<ul>
<li>结合 <code>Object.fromEntries + new Map()</code> 可实现有序对象（Map 的键顺序保留）：</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> orderedMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-string">'b'</span>, <span class="hljs-number">2</span>], [<span class="hljs-string">'a'</span>, <span class="hljs-number">1</span>]]);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">fromEntries</span>(orderedMap)); <span class="hljs-comment">// { b: 2, a: 1 }（保留插入顺序）</span>
</code></pre>
<ul>
<li>处理接口返回的「键值对数组」时，搭配解构能快速提取所需属性，比 for 循环提效 60%，这也是前端职场中「高效编码」的核心细节。</li>
</ul>
<hr/>
<p>建议收藏本文，下次遇到数组转对象需求直接对照实操。你在开发中遇到过哪些数组转对象的坑？或者有更简洁的写法？欢迎在评论区交流～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 CSS `perspective` 实现 3D 卡片效果]]></title>    <link>https://juejin.cn/post/7571086754879520814</link>    <guid>https://juejin.cn/post/7571086754879520814</guid>    <pubDate>2025-11-11T04:04:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571086754879520814" data-draft-id="7570992947463815178" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 CSS `perspective` 实现 3D 卡片效果"/> <meta itemprop="keywords" content="前端,CSS"/> <meta itemprop="datePublished" content="2025-11-11T04:04:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿明Drift"/> <meta itemprop="url" content="https://juejin.cn/user/3667626522083448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 CSS `perspective` 实现 3D 卡片效果
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3667626522083448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿明Drift
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T04:04:39.000Z" title="Tue Nov 11 2025 04:04:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>一个简单但能显著提升网页用户体验的 3D 卡片组件。本文将带你从零开始理解 <code>perspective</code> 的原理，并结合 React 生态中的优秀库（如 <code>react-tilt</code>），打造一个随鼠标移动而动态倾斜的 3D 卡片组件。</p>
</blockquote>
<p>在现代网页设计中，3D 效果不仅能提升视觉吸引力，还能增强用户交互体验。其中 CSS 的 <code>perspective</code> 属性是实现基础 3D 变换的核心属性之一。本文将通过实际案例，深入解析如何利用 CSS <code>perspective</code> 创建令人印象深刻的 3D 卡片效果。</p>
<p>起因是在浏览一个壁纸网站时看到一个引人注目的 3D 卡片效果，作为一个优秀的前端开发，那必须得研究并借鉴一下。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d21c9e5f4a8948f587e3d8bbfb195529~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5piORHJpZnQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763439146&amp;x-signature=aZjfouNtsZ1d5RuElKmDMxNfMWs%3D" alt="6-thumb.gif" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">前置知识</h2>
<h3 data-id="heading-1">基本概念</h3>
<h4 data-id="heading-2">1. 什么是透视（Perspective）？</h4>
<p>在现实世界中，远处的物体看起来更小，近处的物体看起来更大。这种效果称为<strong>透视</strong>。<br/>
CSS 的 <code>perspective</code> 就是用来模拟这种视觉效果的。</p>
<h4 data-id="heading-3">2. 默认情况</h4>
<p>默认情况下，所有变换都是 <strong>正交投影</strong>（orthographic projection），没有远近缩放效果。启用 <code>perspective</code> 后，就会变成 <strong>透视投影</strong>（perspective projection）。</p>
<hr/>
<h3 data-id="heading-4">语法</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">perspective</span>: none | &lt;length&gt;;
</code></pre>
<ul>
<li><code>none</code>：默认值，表示不应用透视（等同于无穷远的视角，无深度感）。</li>
<li><code>&lt;length&gt;</code>：指定观察者与 Z=0 平面的距离，单位通常是 <code>px</code>。值越小，透视效果越强；值越大，效果越弱（趋近于无透视）。</li>
</ul>
<blockquote>
<p>注意：<code>perspective</code> <strong>不能为负值</strong>，也不能使用百分比。</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">两种使用方式</h3>
<h4 data-id="heading-6">方式 1：作为父容器的属性（推荐）</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">perspective</span>: <span class="hljs-number">600px</span>;
}
<span class="hljs-selector-class">.child</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">45deg</span>);
}
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span>&gt;</span>3D 元素<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>✅ <strong>优点</strong>：</p>
<ul>
<li>所有子元素共享同一个消失点（vanishing point），看起来更自然。</li>
<li>更符合真实世界的透视逻辑。</li>
</ul>
<h4 data-id="heading-7">方式 2：作为 <code>transform</code> 的函数（不推荐用于复杂场景）</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.element</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">perspective</span>(<span class="hljs-number">600px</span>) <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">45deg</span>);
}
</code></pre>
<p>⚠️ <strong>缺点</strong>：</p>
<ul>
<li>每个元素都有自己的消失点，多个元素同时变换时会显得不协调。</li>
<li>不适合构建复杂的 3D 场景。</li>
</ul>
<hr/>
<h3 data-id="heading-8">相关属性详解</h3>
<h4 data-id="heading-9">perspective-origin</h4>
<ul>
<li><code>perspective-origin</code> 定义了透视的"观察中心点"，默认是元素的中心（<code>50% 50%</code>）。</li>
<li>类似于相机对准的位置。</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">perspective</span>: <span class="hljs-number">800px</span>;
    <span class="hljs-attribute">perspective-origin</span>: top left; <span class="hljs-comment">/* 从左上角观察 */</span>
}
</code></pre>
<h4 data-id="heading-10">transform-style</h4>
<ul>
<li>决定子元素如何在 3D 空间中渲染</li>
<li><code>flat</code>（默认）：子元素在 2D 平面中渲染，不保留 3D 层级关系</li>
<li><code>preserve-3d</code>：保留 3D 层级关系，子元素在 3D 空间中渲染</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">perspective</span>: <span class="hljs-number">800px</span>;
    <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;
}
</code></pre>
<h4 data-id="heading-11">transform-style: flat</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aed5d05dd5b5452aaa9e762268732180~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5piORHJpZnQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763439146&amp;x-signature=Mmuh6pP7HkG6rq0TPXQAcYT75G4%3D" alt="style-flat" loading="lazy"/></p>
<h4 data-id="heading-12">transform-style: preserve-3d</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8400572c82e494d85a05b1ee2e646eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5piORHJpZnQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763439146&amp;x-signature=jNzh3uvTPITmf3oe0CyGuOMwjqI%3D" alt="6-style-3d.png" loading="lazy"/></p>
<h4 data-id="heading-13">backface-visibility</h4>
<ul>
<li>控制元素背面是否可见</li>
<li><code>visible</code>（默认）：背面可见</li>
<li><code>hidden</code>：背面不可见</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.card</span> {
    <span class="hljs-attribute">backface-visibility</span>: hidden;
}
</code></pre>
<h3 data-id="heading-14">总结</h3>





























<table><thead><tr><th>特性</th><th>说明</th></tr></thead><tbody><tr><td>作用</td><td>控制 3D 变换的透视强度</td></tr><tr><td>值越小</td><td>透视越强（夸张的近大远小）</td></tr><tr><td>值越大</td><td>透视越弱（接近平面）</td></tr><tr><td>推荐用法</td><td>应用于父容器，而非单个元素</td></tr><tr><td>配合属性</td><td><code>transform</code>, <code>transform-style</code>, <code>perspective-origin</code></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-15">注意事项</h3>
<ol>
<li><strong>只有设置了 <code>perspective</code> 的祖先元素内的 3D 变换才会呈现透视效果</strong>。</li>
<li><code>perspective</code> 本身不会触发 3D 渲染上下文，必须配合 <code>transform</code> 使用。</li>
<li>使用 <code>transform-style: preserve-3d</code> 可以保持 3D 层级关系。</li>
<li>合理使用 <code>backface-visibility: hidden</code> 可以避免不必要的渲染问题。</li>
</ol>
<hr/>
<h2 data-id="heading-16">实际应用场景</h2>
<h3 data-id="heading-17">带透视的 3D 响应式卡片</h3>
<p>现在用 <code>perspective</code> 来复刻一个开头说的壁纸网站的 3D 卡片效果：当鼠标在卡片上移动时，卡片会根据鼠标位置做出响应式的旋转效果，产生逼真的 3D 倾斜感。</p>
<p>关键点就在于要<strong>动态计算旋转的角度</strong>。</p>
<h4 data-id="heading-18">原生 JavaScript 版本</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>3D Hover Card with Perspective<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
            <span class="hljs-selector-tag">body</span> {
                <span class="hljs-attribute">display</span>: flex;
                <span class="hljs-attribute">justify-content</span>: center;
                <span class="hljs-attribute">align-items</span>: center;
                <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100vh</span>;
                <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
                <span class="hljs-attribute">background</span>: <span class="hljs-number">#f0f2f5</span>;
                <span class="hljs-attribute">font-family</span>: Arial, sans-serif;
            }

            <span class="hljs-comment">/* 关键：设置 perspective 在父容器上 */</span>
            <span class="hljs-selector-class">.card-container</span> {
                <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
                <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
                <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000px</span>; <span class="hljs-comment">/* 透视距离，控制3D强度 */</span>
            }

            <span class="hljs-selector-class">.card</span> {
                <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
                <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
                <span class="hljs-attribute">background</span>: white;
                <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">16px</span>;
                <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span> <span class="hljs-number">30px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.2</span>);
                <span class="hljs-attribute">display</span>: flex;
                <span class="hljs-attribute">justify-content</span>: center;
                <span class="hljs-attribute">align-items</span>: center;
                <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
                <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
                <span class="hljs-attribute">cursor</span>: pointer;

                <span class="hljs-comment">/* 启用3D变换上下文 */</span>
                <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;
                <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.1s</span> ease-out;

                <span class="hljs-comment">/* 初始轻微倾斜（可选） */</span>
                <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateX</span>(<span class="hljs-number">5deg</span>) <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">0deg</span>);
            }
        </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-container"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"card"</span>&gt;</span>✨ 3D Hover Card<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
            <span class="hljs-keyword">const</span> card = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'card'</span>);
            <span class="hljs-keyword">const</span> container = card.<span class="hljs-property">parentElement</span>;

            container.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousemove'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
                <span class="hljs-comment">// 获取容器尺寸和鼠标位置</span>
                <span class="hljs-keyword">const</span> rect = container.<span class="hljs-title function_">getBoundingClientRect</span>();
                <span class="hljs-keyword">const</span> x = e.<span class="hljs-property">clientX</span> - rect.<span class="hljs-property">left</span>;
                <span class="hljs-keyword">const</span> y = e.<span class="hljs-property">clientY</span> - rect.<span class="hljs-property">top</span>;

                <span class="hljs-comment">// 计算中心点偏移（归一化到 -1 ~ 1）</span>
                <span class="hljs-keyword">const</span> centerX = (x - rect.<span class="hljs-property">width</span> / <span class="hljs-number">2</span>) / (rect.<span class="hljs-property">width</span> / <span class="hljs-number">2</span>); <span class="hljs-comment">// -1 到 1</span>
                <span class="hljs-keyword">const</span> centerY = (y - rect.<span class="hljs-property">height</span> / <span class="hljs-number">2</span>) / (rect.<span class="hljs-property">height</span> / <span class="hljs-number">2</span>); <span class="hljs-comment">// -1 到 1</span>

                <span class="hljs-comment">// 控制旋转角度（可调节灵敏度）</span>
                <span class="hljs-keyword">const</span> rotateY = centerX * <span class="hljs-number">15</span>; <span class="hljs-comment">// 水平方向最大 ±15 度</span>
                <span class="hljs-keyword">const</span> rotateX = -centerY * <span class="hljs-number">15</span>; <span class="hljs-comment">// 垂直方向（注意负号：向下移动应向上仰）</span>

                card.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">`rotateX(<span class="hljs-subst">${rotateX}</span>deg) rotateY(<span class="hljs-subst">${rotateY}</span>deg)`</span>;
            });

            container.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mouseleave'</span>, <span class="hljs-function">() =&gt;</span> {
                <span class="hljs-comment">// 鼠标离开时恢复原状</span>
                card.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">'rotateX(5deg) rotateY(0deg)'</span>;
            });
        </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-19">使用 React 开源库 <code>react-tilt</code></h4>
<h5 data-id="heading-20">安装</h5>
<pre><code class="hljs language-bash" lang="bash">npm install react-tilt
</code></pre>
<h5 data-id="heading-21">使用示例</h5>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Tilt</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react-tilt'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">TiltCard</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> options = {
        <span class="hljs-attr">reverse</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 是否反转方向</span>
        <span class="hljs-attr">max</span>: <span class="hljs-number">35</span>, <span class="hljs-comment">// 最大倾斜角度</span>
        <span class="hljs-attr">perspective</span>: <span class="hljs-number">1000</span>, <span class="hljs-comment">// 透视距离（对应 CSS perspective）</span>
        <span class="hljs-attr">scale</span>: <span class="hljs-number">1.1</span>, <span class="hljs-comment">// 鼠标悬停时放大比例</span>
        <span class="hljs-attr">speed</span>: <span class="hljs-number">1000</span>, <span class="hljs-comment">// 过渡动画速度（ms）</span>
        <span class="hljs-attr">transition</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">axis</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// 锁定轴（'x' 或 'y'）</span>
        <span class="hljs-attr">reset</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 鼠标离开后是否重置</span>
        <span class="hljs-attr">easing</span>: <span class="hljs-string">'cubic-bezier(.03,.98,.52,.99)'</span>,
    };

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Tilt</span> <span class="hljs-attr">options</span>=<span class="hljs-string">{options}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"tilt-root"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"card-content"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Dynamic 3D Card<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Move your mouse around!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Tilt</span>&gt;</span></span>
    );
}
</code></pre>
<p>我应用到了自己的博客列表页，作为卡片式的结构</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/242463654d624677baf656a2c2f962b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5piORHJpZnQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763439146&amp;x-signature=6Dnwfo450gtxhv8veiuGo44AzsU%3D" alt="6-myblog.gif" loading="lazy"/></p>
<h3 data-id="heading-22">其他应用场景</h3>
<ul>
<li>产品展示（如 360° 查看）</li>
<li>3D 轮播图</li>
<li>游戏或交互式 UI（如倾斜视差效果）</li>
</ul>
<hr/>
<h2 data-id="heading-23">性能优化建议</h2>
<ol>
<li><strong>使用 <code>transform</code> 和 <code>opacity</code> 进行动画</strong>：这两个属性不会触发重排（reflow）和重绘（repaint），性能更好。</li>
<li><strong>合理使用 <code>will-change</code> 属性</strong>：提前告知浏览器哪些属性将要发生变化，让浏览器提前进行优化。</li>
<li><strong>避免过度复杂的 3D 变换</strong>：过多的 3D 变换可能会影响页面性能，特别是在移动设备上。</li>
<li><strong>使用 CSS 硬件加速</strong>：通过 <code>transform: translateZ(0)</code> 或 <code>transform: translate3d(0, 0, 0)</code> 触发硬件加速。</li>
</ol>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.card</span> {
    <span class="hljs-attribute">will-change</span>: transform;
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateZ</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">/* 触发硬件加速 */</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-24"><strong>附：参考资料</strong></h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1Ur421G7A6" target="_blank" title="https://www.bilibili.com/video/BV1Ur421G7A6" ref="nofollow noopener noreferrer">Bilibili 视频：透视 perspective 让三维变换更真实</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FCSS%2Fperspective" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/CSS/perspective" ref="nofollow noopener noreferrer">MDN - CSS perspective</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FCSS%2Ftransform-style" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/CSS/transform-style" ref="nofollow noopener noreferrer">MDN - CSS transform-style</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FCSS%2Fbackface-visibility" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/CSS/backface-visibility" ref="nofollow noopener noreferrer">MDN - CSS backface-visibility</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Freact-tilt" target="_blank" title="https://www.npmjs.com/package/react-tilt" ref="nofollow noopener noreferrer">react-tilt - npm</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FCSS%2Fwill-change" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/CSS/will-change" ref="nofollow noopener noreferrer">CSS will-change 属性</a></li>
</ul>
<hr/>
<blockquote>
<p>学习优秀作品，是提升技术的最佳路径。本文作为自己的学习笔记，也希望这篇解析对你有所帮助</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Unsloth 的全微调之路丨从 Adapter 到 Full Fine-tuning]]></title>    <link>https://juejin.cn/post/7571005216910327827</link>    <guid>https://juejin.cn/post/7571005216910327827</guid>    <pubDate>2025-11-11T05:44:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571005216910327827" data-draft-id="7570976560708173887" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Unsloth 的全微调之路丨从 Adapter 到 Full Fine-tuning"/> <meta itemprop="keywords" content="Agent,LLM,程序员"/> <meta itemprop="datePublished" content="2025-11-11T05:44:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI大模型"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Unsloth 的全微调之路丨从 Adapter 到 Full Fine-tuning
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI大模型
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T05:44:37.000Z" title="Tue Nov 11 2025 05:44:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p><strong>本文完整的测试代码位置</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxinyuwei-david%2Fdavid-share%2Ftree%2Fmaster%2FDeep-Learning%2FUnsloth-Full-SFT" target="_blank" title="https://github.com/xinyuwei-david/david-share/tree/master/Deep-Learning/Unsloth-Full-SFT" ref="nofollow noopener noreferrer">github.com/xinyuwei-da…</a></p>
<p><strong>GitHub repo</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxinyuwei-david%2Fdavid-share.git" target="_blank" title="https://github.com/xinyuwei-david/david-share.git" ref="nofollow noopener noreferrer">github.com/xinyuwei-da…</a></p>
<p>大语言模型（LLM）最近发展得非常快，一动就是好几亿甚至上百亿的参数，让很多 AI 工程师在微调这些大模型时犯了难。Unsloth 这个框架，原本主要是靠支持 LoRA、QLoRA 等 Adapter 微调而出名，重点就是省内存、训练快。</p>
<p>现在它又更进一步，支持了全参数微调（Full Fine-tuning），也就是说，单卡环境就能搞定大规模模型的完整训练。接下来我想聊一聊 Unsloth 全微调的背景、它用到的关键技术，以及在实际工程中怎么把它用好。</p>
<p><strong>从 LoRA/QLoRA 到 Full Fine-tuning：</strong></p>
<p><strong>Unsloth 的进化历程</strong></p>
<p><strong>初期聚焦</strong></p>
<p>LoRA &amp; QLoRA 早期的 Unsloth 仅支持基于 LoRA/QLoRA 的适配器微调（Adapter Fine-tuning）。它通过动态量化、稀疏优化、梯度检查点等技术手段，大幅减少显存占用，让工程师能在单卡或少卡环境下，对 LLM 进行有效训练。</p>
<p><strong>为什么最初只支持 Adapter 微调？</strong></p>
<ul>
<li><strong>实惠的硬件门槛</strong>：Adapter 微调只需更新部分额外参数，不必动用整套模型，从而有效减少 GPU 显存需求和训练开销。</li>
<li><strong>高性价比</strong>：对于大部分应用场景来说，使用 LoRA/QLoRA 得到的微调效果已足以解决“任务定制”需求，而且成本远低于全量微调。</li>
<li><strong>工程实现相对简单</strong>：无须管理全部模型权重的更新和保存，只需管理 LoRA 等附加层的参数即可。</li>
</ul>
<p>全参数微调走上日程 随着用户对微调需求的精细化、对模型性能的极致追求，以及在更大规模的 LLM 上进行高保真的领域适配需求日益增长，Unsloth 社区在 2024 ~ 2025 年间逐步加入了对 full fine-tuning 的支持，使得你无需额外插入Adapter，也能直接训练整个模型的全部参数。</p>
<p><strong>Unsloth 全微调：关键技术解析</strong></p>
<p><strong>梯度检查点（Gradient Checkpointing）</strong></p>
<ul>
<li>在单 GPU 进行全微调时，重新计算部分前向激活以节省显存成为了必然需求。</li>
<li>PyTorch 本身提供了 checkpoint 工具，但 Unsloth 在此基础上做了更深入的工程优化，大幅降低部分场景下的额外重算开销。</li>
</ul>
<p><strong>激活值卸载（Activation Offloading）</strong></p>
<p>当显存不足时，将部分激活值转存到 CPU 内存。Unsloth 会智能地在训练过程中安排卸载与回传时机，确保在最“恰当”的时刻介入，从而减小对训练速度的冲击。</p>
<p><strong>优化器状态分页（Optimizer Paging）</strong></p>
<ul>
<li>在大模型训练中，单卡不仅需要存储模型本身的参数，还要存储优化器状态，这也是显存占用的一大来源。</li>
<li>通过 8-bit 甚至更低精度的优化器（如 paged_adamw_8bit），即能把部分优化器状态分页至 CPU，释放 GPU 显存，进一步帮助单卡支持更大规模的模型。</li>
</ul>
<p><strong>工程上的部署实例与硬件选择</strong></p>
<p>以常用的 H100 94GB，H200 141GB， AMD MI300X 192 为例：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/936bf17fde304827b95221a9f2f13761~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763444677&amp;x-signature=YkKQa43BYQDEPGDEdLfAJVT0iwo%3D" alt="" loading="lazy"/></p>
<ul>
<li>Unsloth 已默认开启多种优化机制（包括梯度检查点与分页式优化器），一般情况下无需额外配置。</li>
<li>全参数微调时显存压力高于 LoRA/QLoRA 等适配器方法，特别需注意的是：</li>
</ul>

<ul>
<li>若单卡 GPU 显存不足（低于80GB），请务必维持分页优化器（Paged Optimizer）默认开启的状态。</li>
<li>适当减小 batch size 通常会减少激活值卸载频率，从而获得整体更高的训练速度。</li>
</ul>

<ul>
<li>实际微调过程建议进行小规模实验验证，逐步调整相关超参数（batch size、序列长度等），结合自身的硬件配置和应用场景找到最佳性能与内存占用平衡点。</li>
</ul>
<p><strong>为什么不直接自己实现这些内存优化？</strong></p>
<ol>
<li><strong>维护难度高</strong>：手动在代码层面开发 offload、checkpoints 等逻辑，面对不同版本的 PyTorch / CUDA / 驱动，以及不同模型结构，调试复杂度极高，且易产生潜在内存泄露、兼容性问题。</li>
<li><strong>社区打磨与更新</strong>：Unsloth 在社区中已有大量真实使用场景与案例，经过了版本迭代与优化，加之官方维护的更新日志（release notes），更易确保长久可用与持续优化。</li>
<li><strong>专注业务逻辑</strong>：使用 Unsloth 可将时间投入到数据集清洗、任务工程化、下游效果评估，而不是消耗在重复开发类似的底层内存管理功能上。</li>
</ol>
<p><strong>最佳实践：如何平衡内存占用与训练效率</strong></p>
<p><strong>保持小 Batch Size（1~2 常见）</strong></p>
<ul>
<li>过大的 batch size 会导致 Unsloth 频繁进行激活值卸载，反而拖慢训练速度。</li>
<li>在单 GPU 场景中，小 batch + 累积梯度(gradient_accumulation_steps) 通常更优。</li>
</ul>
<p><strong>分阶段调试</strong></p>
<ul>
<li>先用小模型、短序列长度跑通流程，观察 GPU 负载与日志，用以确认 offloading 时机与显存开销。</li>
<li>一旦找到稳定训练配置，再逐步扩展到更大模型或更长序列。</li>
</ul>
<p><strong>充分启用 paged optimizer</strong></p>
<p>对于全参数微调而言，优化器状态空间非常可观，将其分页至 CPU，可以显著降低 GPU 显存峰值占用。</p>
<h2 data-id="heading-0">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[postgresql数据库的安装]]></title>    <link>https://juejin.cn/post/7571176484515643444</link>    <guid>https://juejin.cn/post/7571176484515643444</guid>    <pubDate>2025-11-11T04:02:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571176484515643444" data-draft-id="7570984341414707215" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="postgresql数据库的安装"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2025-11-11T04:02:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="蓝色猪猪侠"/> <meta itemprop="url" content="https://juejin.cn/user/791248051648253"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            postgresql数据库的安装
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/791248051648253/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    蓝色猪猪侠
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T04:02:36.000Z" title="Tue Nov 11 2025 04:02:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>官网下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.postgresql.org%2Fdownload%2F" target="_blank" title="https://www.postgresql.org/download/" ref="nofollow noopener noreferrer">PostgreSQL: Downloads</a></p>
<p>centos7安装postgresql18为例：</p>
<p>1、下载，使用官方的source地址下载：</p>
<p>wget <a href="https://link.juejin.cn?target=https%3A%2F%2Fftp.postgresql.org%2Fpub%2Fsource%2Fv18.0%2Fpostgresql-18.0.tar.gz" target="_blank" title="https://ftp.postgresql.org/pub/source/v18.0/postgresql-18.0.tar.gz" ref="nofollow noopener noreferrer">ftp.postgresql.org/pub/source/…</a></p>
<p>2、解压 tar -xvf postgresql-18.0.tar.gz</p>
<p>3、编译安装时需要c++的相关依赖，若缺失，需要安装(yum install gcc gcc-c++ make libicu-devel bison flex readline-devel zlib-devel)</p>
<p>4、编译与安装
./configure --prefix=安装目录  make &amp;&amp; make install</p>
<p>5、新建数据库用户，并新建数据存储目录</p>
<pre><code class="hljs language-bash" lang="bash">useradd postgres
<span class="hljs-built_in">mkdir</span> 数据库安装目录/data
<span class="hljs-built_in">chown</span> postgres:postgres 数据库安装目录/data
</code></pre>
<p>6、配置环境变量，指定数据存储目录</p>
<pre><code class="hljs language-bash" lang="bash">vim /etc/profile.d/pgsql.sh
<span class="hljs-built_in">export</span> PGHOME=pg安装目录
<span class="hljs-built_in">export</span> PGDATA==pg安装目录/data
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PGHOME</span>/bin:<span class="hljs-variable">$PATH</span>
</code></pre>
<p>7、切换到postgres用户，并初始化数据库,已进入到bin目录</p>
<pre><code class="hljs language-bash" lang="bash">./initdb -D ../data/
</code></pre>
<p>8、编辑配置文件信息</p>
<pre><code class="hljs language-bash" lang="bash">vim ../data/postgresql.conf
相关参数解析：
listen_address：监听地址，默认localhost，*表示所有
port：端口号，默认5432
max_connections：最大连接数
</code></pre>
<p>9、启动服务，使用自带脚本</p>
<pre><code class="hljs language-bash" lang="bash">将源码中的脚本拷贝到/etc/init.d/目录下
<span class="hljs-built_in">cp</span> 源码目录/contrib/start-scripts/linux /etc/init.d/postgresql
添加执行权限 <span class="hljs-built_in">chmod</span> +x /etc/init.d/postgresql
开机自启动  chkconfig --add postgresql
启动 service postgresql start
关闭 service postgresql stop
重启 service postgresql restart
</code></pre>
<p>10、指定远程连接规则</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">data</span>目录下编辑: <span class="hljs-selector-tag">vim</span> <span class="hljs-selector-tag">pg_hba</span><span class="hljs-selector-class">.conf</span>
<span class="hljs-selector-id">#postgres</span>用户不允许远程连接
<span class="hljs-selector-tag">host</span> <span class="hljs-keyword">all</span> <span class="hljs-selector-tag">postgres</span> <span class="hljs-number">0.0</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.0</span>/<span class="hljs-number">0</span> <span class="hljs-selector-tag">reject</span>
<span class="hljs-selector-tag">host</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">all</span> <span class="hljs-number">0.0</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.0</span>/<span class="hljs-number">0</span> <span class="hljs-selector-tag">password</span>
端口号不是默认的<span class="hljs-number">5432</span>的连接方式
<span class="hljs-selector-tag">psql</span> <span class="hljs-selector-tag">-h</span> &lt;主机名或<span class="hljs-selector-tag">IP</span>&gt; <span class="hljs-selector-tag">-p</span> &lt;端口号&gt; <span class="hljs-selector-tag">-U</span> &lt;用户名&gt; <span class="hljs-selector-tag">-d</span> &lt;数据库名&gt;
</code></pre>
<p>11、创建用户并授予权限</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> 用户名 <span class="hljs-keyword">with</span> password 密码;
授予管理员权限
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> 用户名 <span class="hljs-keyword">with</span> superuser;
创建一个与用户名一致的数据库
<span class="hljs-keyword">create</span> database 用户名
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java基础（六：线程、线程同步，线程池）]]></title>    <link>https://juejin.cn/post/7571176484514316303</link>    <guid>https://juejin.cn/post/7571176484514316303</guid>    <pubDate>2025-11-11T05:48:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571176484514316303" data-draft-id="7570940025581715496" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java基础（六：线程、线程同步，线程池）"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-11-11T05:48:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="爱分享的鱼鱼"/> <meta itemprop="url" content="https://juejin.cn/user/3901536646733133"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java基础（六：线程、线程同步，线程池）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3901536646733133/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    爱分享的鱼鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T05:48:05.000Z" title="Tue Nov 11 2025 05:48:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><h2 data-id="heading-0">1. 多线程基础概念</h2>
<h3 data-id="heading-1">1.1 线程与进程</h3>
<ul>
<li><strong>进程</strong>：操作系统中正在运行的程序实例，拥有独立的内存空间，可以看做是一个正在运行的程序实例，进程之间是相互独立的。</li>
<li><strong>线程</strong>：进程中的执行单元，一个进程中可以包含多个线程，共享进程的内存空间。线程使用的资源开销更小，而且线程通信因为共享内存所以更轻松。</li>
</ul>
<h3 data-id="heading-2">1.2 线程的应用</h3>
<h4 data-id="heading-3">1. 并发处理</h4>
<ul>
<li><strong>Web服务器</strong>: 处理多个客户端请求，每个请求由独立 <code>Thread</code> 处理</li>
<li><strong>数据库连接池</strong>: 多个 <code>Thread</code> 共享数据库连接资源</li>
<li><strong>文件I/O操作</strong>: 同时读写多个文件</li>
</ul>
<h4 data-id="heading-4">2. 异步任务执行</h4>
<ul>
<li><strong>后台任务</strong>: 日志记录、数据备份等不需要用户等待的操作</li>
<li><strong>定时任务</strong>: 使用 <code>ScheduledExecutorService</code> 执行周期性任务</li>
<li><strong>消息队列消费者</strong>: 并行处理消息队列中的任务</li>
</ul>
<h4 data-id="heading-5">3. UI应用程序</h4>
<ul>
<li><strong>事件处理</strong>: GUI应用中使用 <code>Thread</code> 分离用户界面响应和后台计算</li>
<li><strong>动画效果</strong>: 在单独 <code>Thread</code> 中处理界面动画，避免阻塞主线程</li>
</ul>
<h4 data-id="heading-6">4. 计算密集型任务</h4>
<ul>
<li><strong>并行计算</strong>: 将大型计算任务分解为多个子任务并行执行</li>
<li><strong>数据处理</strong>: 多 <code>Thread</code> 处理大量数据集</li>
<li><strong>图像处理</strong>: 并行处理图像的不同区域</li>
</ul>
<h4 data-id="heading-7">5. 网络编程</h4>
<ul>
<li><strong>Socket通信</strong>: 服务器端使用多 <code>Thread</code> 处理多个客户端连接</li>
<li><strong>HTTP客户端</strong>: 并发发送多个HTTP请求</li>
<li><strong>RPC调用</strong>: 并行执行远程过程调用</li>
</ul>
<h3 data-id="heading-8">1.3 线程状态</h3>
<p>Java线程有以下几种状态：</p>
<ul>
<li><strong>NEW</strong>：新建状态，线程被创建但未启动</li>
<li><strong>RUNNABLE</strong>：可运行状态，包括运行中和就绪状态</li>
<li><strong>BLOCKED</strong>：阻塞状态，等待监视器锁</li>
<li><strong>WAITING</strong>：等待状态，无限期等待其他线程执行特定操作</li>
<li><strong>TIMED_WAITING</strong>：超时等待状态，有限时间等待</li>
<li><strong>TERMINATED</strong>：终止状态，线程执行完毕</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c85a909c0ccb4b9689c813179565c53f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5YiG5Lqr55qE6bG86bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763444885&amp;x-signature=WlmtnJh48GD%2BUssxaaUOorIULI4%3D" alt="image.png" loading="lazy"/></p>
<p>这张图展示了Java线程的生命周期和状态转换。一个线程从创建开始，经过就绪、运行、阻塞、等待等状态，最终结束。简单来说：线程刚创建时是"新建"状态
调用start()后进入"就绪"状态，等着CPU来执行一旦拿到CPU时间就开始"运行"如果遇到需要等待的情况（比如等待锁、休眠），就会进入相应的等待状态当等待条件满足或时间到，又会回到就绪状态继续竞争CPU最终线程执行完任务就"死亡"了。</p>
<h3 data-id="heading-9">1.4 线程的创建方式</h3>
<h4 data-id="heading-10">方式一：继承 Thread 类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 线程执行的代码</span>
        System.out.println(<span class="hljs-string">"线程执行中..."</span>);
    }
}

<span class="hljs-comment">// 使用方式</span>
<span class="hljs-type">MyThread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyThread</span>();
thread.start(); <span class="hljs-comment">// 启动线程</span>
</code></pre>
<h4 data-id="heading-11">方式二：实现 Runnable 接口</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRunnable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 线程执行的代码</span>
        System.out.println(<span class="hljs-string">"线程执行中..."</span>);
    }
}

<span class="hljs-comment">// 使用方式</span>
<span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyRunnable</span>());
thread.start();
</code></pre>
<h4 data-id="heading-12">方式三：实现 Callable 接口</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.Callable;
<span class="hljs-keyword">import</span> java.util.concurrent.FutureTask;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCallable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Callable</span>&lt;String&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"执行结果"</span>;
    }
}

<span class="hljs-comment">// 使用方式</span>
FutureTask&lt;String&gt; futureTask = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureTask</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyCallable</span>());
<span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(futureTask);
thread.start();
<span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> futureTask.get(); <span class="hljs-comment">// 获取执行结果</span>
</code></pre>
<p>通过实现Runnable接口可以避免单继承的限制，提供更好的灵活性，因此最常用的创建方式是Runnable接口</p>
<h3 data-id="heading-13">1.5 线程控制方法</h3>
<p>Java线程控制方法主要包括以下几种：</p>
<ul>
<li><code>start()</code>: 启动线程，使线程进入就绪状态</li>
<li><code>run()</code>: 线程执行的具体任务逻辑</li>
<li><code>join()</code>: 等待线程执行完毕</li>
<li><code>sleep(long millis)</code>: 使当前线程休眠指定时间</li>
<li><code>yield()</code>: 暂停当前线程，让出CPU时间片</li>
<li><code>interrupt()</code>: 中断线程</li>
<li><code>isAlive()</code>: 判断线程是否存活</li>
<li><code>currentThread()</code>: 获取当前线程实例</li>
</ul>
<h2 data-id="heading-14">2. 线程安全与线程同步</h2>
<h3 data-id="heading-15">2.1 概念</h3>
<p><strong>线程安全</strong>‌是一个核心概念，它描述了一个类、方法或对象在多线程环境下‌行为正确的特性。当多个线程同时访问同一个共享资源（如一个变量、一个对象或一个静态字段）时，如果系统始终能产生‌正确的行为和结果，那么这个资源就是线程安全的。线程不安全源于多个线程在没有适当保护的情况下，对共享数据进行“‌<strong>读-改-写</strong>‌”操作。这会导致数据竞争和脏读，最终得到不可预知、错误的结果。线程安全的目标是保证数据的‌<strong>一致性</strong>‌和‌<strong>可见性</strong>‌。一个线程修改了数据，其他线程能立即看到修改后的、一致的数据。</p>
<h4 data-id="heading-16">一个经典的线程不安全例子（银行取款）：</h4>
<p>假设一个银行账户初始有1000元，夫妻二人同时用两张卡从两个ATM机取款1000元。</p>
<ol>
<li>线程A（丈夫）读取余额：1000元。</li>
<li>线程B（妻子）读取余额：1000元。</li>
<li>线程A计算：1000 - 1000 = 0，并将0写回余额。</li>
<li>线程B计算：1000 - 1000 = 0，并将0写回余额。</li>
</ol>
<p>最终账户余额为0元，但实际只应扣款一次，正确的余额应为0元（或根据逻辑处理为负数不允许操作），但这个过程银行损失了1000元。这就是线程不安全导致的数据错误。</p>
<p><strong>线程同步</strong>作为实现线程安全的核心技术体系，其本质在于通过协调多个线程的执行顺序和控制共享资源访问权限，建立并发的秩序。具体而言，这一机制通过两种关键方式保障系统可靠性：一是通过互斥锁（如synchronized或Lock）将可能被多线程同时访问的“临界区”代码转化为串行化执行，确保任一时刻仅有一个线程能操作共享资源；二是通过线程间通信机制（如wait/notify）使不同线程能够有序协作，将原本杂乱的并发操作转化为可控的有序流程。这种双重保障既防范了数据竞争导致的计算错误，又确保了资源状态的一致性，最终使得多线程程序在高效运行的同时保持行为的可预测性与正确性。</p>
<h3 data-id="heading-17">2.2 synchronized 关键字</h3>
<p><code>synchronized</code> 是Java中最基本的线程同步机制，可以保证同一时刻只有一个线程执行被它修饰的代码块。</p>
<h4 data-id="heading-18">修饰实例方法</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        count++; <span class="hljs-comment">// 同一时刻只有一个线程能执行此方法</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCount</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> count;
    }
}
</code></pre>
<h4 data-id="heading-19">修饰静态方法</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StaticCounter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        count++; <span class="hljs-comment">// 对类的所有实例同步</span>
    }
}
</code></pre>
<h4 data-id="heading-20">修饰代码块</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlockSynchronization</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span>(lock) {
            count++; <span class="hljs-comment">// 只对lock对象加锁</span>
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">decrement</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span>(<span class="hljs-built_in">this</span>) {
            count--; <span class="hljs-comment">// 对当前实例加锁</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-21">2.3 volatile 关键字</h3>
<p>‌volatile通过强制主内存读写和禁止指令重排序，解决了共享变量的可见性和有序性问题，是线程安全的必要组成部分，但不保证原子性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VolatileExample</span> {‌**<span class="hljs-keyword">volatile</span>通过强制主内存读写和禁止指令重排序，解决了共享变量的可见性和有序性问题，是线程安全的必要组成部分
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 保证可见性</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> <span class="hljs-variable">counter</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// 保证可见性</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFlag</span><span class="hljs-params">(<span class="hljs-type">boolean</span> flag)</span> {
        <span class="hljs-built_in">this</span>.flag = flag; <span class="hljs-comment">// 修改立即对其他线程可见</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">getFlag</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> flag; <span class="hljs-comment">// 读取最新的值</span>
    }
}
</code></pre>
<p><strong>注意</strong>：<code>volatile</code> 不能替代 <code>synchronized</code>，因为它不保证复合操作的原子性：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
    count++; <span class="hljs-comment">// 这不是原子操作，仍可能出现线程安全问题</span>
}
</code></pre>
<h2 data-id="heading-22">3. 线程池入门 Executors</h2>
<h3 data-id="heading-23">3.1 什么是线程池</h3>
<p>线程池是一种基于池化思想管理线程的工具，通过预先创建一定数量的线程来处理任务，避免频繁创建和销毁线程带来的开销。
举个例子，想象一家汉堡店（线程池）：</p>
<ol>
<li>‌<strong>核心员工（核心线程）</strong> ‌：常驻3位厨师（<code>corePoolSize=3</code>），日常订单由他们处理。</li>
<li>‌<strong>临时工（非核心线程）</strong> ‌：高峰期新增2位兼职（<code>maximumPoolSize=5</code>），应对客流激增。</li>
<li>‌<strong>候餐区（任务队列）</strong> ‌：10个座位（<code>ArrayBlockingQueue(10)</code>），新顾客在此排队。</li>
<li>‌<strong>拒绝策略（饱和策略）</strong> ‌：</li>
</ol>
<ul>
<li>‌<strong>抛异常</strong>‌：座位满时新顾客直接被告知"无法接待"（<code>AbortPolicy</code>）</li>
<li>‌<strong>调用者做</strong>‌：经理亲自做汉堡（<code>CallerRunsPolicy</code>）</li>
<li>‌<strong>丢弃队列最旧</strong>‌：请走排队最久的顾客（<code>DiscardOldestPolicy</code>）</li>
<li>‌<strong>直接拒绝</strong>‌：新顾客直接被拒（<code>DiscardPolicy</code>）</li>
</ul>
<h4 data-id="heading-24">⚡ ‌<strong>运作场景</strong>‌</h4>
<ul>
<li>
<p>‌<strong>低峰期</strong>‌：3位厨师处理订单，候餐区空置。</p>
</li>
<li>
<p>‌<strong>高峰期</strong>‌：</p>
<ul>
<li>订单涌入 → 候餐区坐满10人</li>
<li>继续来客 → 激活2位临时工</li>
<li>‌<strong>超负荷</strong>‌：新顾客触发拒绝策略（如经理道歉劝离）</li>
</ul>
</li>
<li>
<p>‌<strong>回归平静</strong>‌：临时工闲置超过<code>keepAliveTime</code>（如30分钟）后被解雇。</p>
</li>
</ul>
<h4 data-id="heading-25">🔧 ‌<strong>关键配置类比</strong>‌</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(
  <span class="hljs-number">3</span>,    <span class="hljs-comment">// 核心厨师3人  </span>
  <span class="hljs-number">5</span>,    <span class="hljs-comment">// 最大厨师5人  </span>
  <span class="hljs-number">30</span>,   <span class="hljs-comment">// 临时工空闲30分钟下班  </span>
  TimeUnit.MINUTES,  
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">10</span>) <span class="hljs-comment">// 10个候餐位  </span>
);
</code></pre>
<hr/>
<h4 data-id="heading-26">💡 ‌<strong>为什么用线程池？</strong> ‌</h4>
<ul>
<li>‌<strong>避免重复开销</strong>‌：不重复雇佣/解雇厨师（线程创建/销毁耗资源）</li>
<li>‌<strong>流量控制</strong>‌：队列缓冲突发订单，拒绝策略防系统崩溃</li>
<li>‌<strong>资源复用</strong>‌：厨师持续接单提升效率</li>
</ul>
<blockquote>
<p>就像快餐店不会为每个顾客雇新厨师，线程池‌<strong>复用线程</strong>‌处理任务，避免频繁创建销毁的开销，用队列和扩容机制平衡系统负载。</p>
</blockquote>
<h3 data-id="heading-27">3.2 常见的线程池类型</h3>
<h4 data-id="heading-28">FixedThreadPool 固定大小线程池</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.ExecutorService;
<span class="hljs-keyword">import</span> java.util.concurrent.Executors;

<span class="hljs-comment">// 创建固定大小为5的线程池</span>
<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">fixedThreadPool</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">5</span>);

<span class="hljs-comment">// 提交任务</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">taskId</span> <span class="hljs-operator">=</span> i;
    fixedThreadPool.submit(() -&gt; {
        System.out.println(<span class="hljs-string">"任务 "</span> + taskId + <span class="hljs-string">" 正在执行，线程："</span> + Thread.currentThread().getName());
    });
}

fixedThreadPool.shutdown(); <span class="hljs-comment">// 关闭线程池</span>
</code></pre>
<h4 data-id="heading-29">CachedThreadPool 缓存线程池</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 创建缓存线程池，可根据需要创建新线程，空闲线程会被回收</span>
<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">cachedThreadPool</span> <span class="hljs-operator">=</span> Executors.newCachedThreadPool();

<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">taskId</span> <span class="hljs-operator">=</span> i;
    cachedThreadPool.submit(() -&gt; {
        System.out.println(<span class="hljs-string">"任务 "</span> + taskId + <span class="hljs-string">" 正在执行"</span>);
    });
}

cachedThreadPool.shutdown();
</code></pre>
<h4 data-id="heading-30">SingleThreadExecutor 单线程池</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 创建单线程池，保证所有任务按顺序执行</span>
<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">singleThreadExecutor</span> <span class="hljs-operator">=</span> Executors.newSingleThreadExecutor();

<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">taskId</span> <span class="hljs-operator">=</span> i;
    singleThreadExecutor.submit(() -&gt; {
        System.out.println(<span class="hljs-string">"任务 "</span> + taskId + <span class="hljs-string">" 正在执行"</span>);
    });
}

singleThreadExecutor.shutdown();
</code></pre>
<h4 data-id="heading-31">ScheduledThreadPool 定时任务线程池</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.ScheduledExecutorService;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-comment">// 创建定时任务线程池</span>
<span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">scheduledThreadPool</span> <span class="hljs-operator">=</span> Executors.newScheduledThreadPool(<span class="hljs-number">3</span>);

<span class="hljs-comment">// 延迟执行</span>
scheduledThreadPool.schedule(() -&gt; {
    System.out.println(<span class="hljs-string">"延迟3秒执行的任务"</span>);
}, <span class="hljs-number">3</span>, TimeUnit.SECONDS);

<span class="hljs-comment">// 周期性执行</span>
scheduledThreadPool.scheduleAtFixedRate(() -&gt; {
    System.out.println(<span class="hljs-string">"每2秒执行一次的任务"</span>);
}, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, TimeUnit.SECONDS);

<span class="hljs-comment">// scheduledThreadPool.shutdown(); // 注意：定时任务通常不立即关闭</span>
</code></pre>
<h2 data-id="heading-32">4. ThreadPoolExecutor 使用</h2>
<h3 data-id="heading-33">4.1 ThreadPoolExecutor 构造参数详解</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.*;

<span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(
    <span class="hljs-number">5</span>,                          <span class="hljs-comment">// corePoolSize: 核心线程数</span>
    <span class="hljs-number">10</span>,                         <span class="hljs-comment">// maximumPoolSize: 最大线程数</span>
    <span class="hljs-number">60L</span>,                        <span class="hljs-comment">// keepAliveTime: 空闲线程存活时间</span>
    TimeUnit.SECONDS,           <span class="hljs-comment">// unit: 时间单位</span>
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="hljs-number">100</span>), <span class="hljs-comment">// workQueue: 工作队列</span>
    Executors.defaultThreadFactory(), <span class="hljs-comment">// threadFactory: 线程工厂</span>
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.AbortPolicy() <span class="hljs-comment">// handler: 拒绝策略</span>
);
</code></pre>
<h3 data-id="heading-34">4.2 核心参数说明</h3>

































<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>corePoolSize</code></td><td>核心线程数，即使空闲也会保留的线程数量</td></tr><tr><td><code>maximumPoolSize</code></td><td>最大线程数，线程池允许创建的最大线程数量</td></tr><tr><td><code>keepAliveTime</code></td><td>非核心线程的空闲存活时间</td></tr><tr><td><code>workQueue</code></td><td>用于存放待执行任务的阻塞队列</td></tr><tr><td><code>threadFactory</code></td><td>创建新线程的工厂</td></tr><tr><td><code>handler</code></td><td>拒绝策略，当线程池和队列都满时的处理策略</td></tr></tbody></table>
<h3 data-id="heading-35">4.3 工作流程</h3>
<ol>
<li>如果当前线程数小于 <code>corePoolSize</code>，即使线程池中有空闲线程，也会创建新的核心线程来执行任务</li>
<li>如果当前线程数等于或大于 <code>corePoolSize</code>，任务将被放入 <code>workQueue</code></li>
<li>如果 <code>workQueue</code> 已满，且当前线程数小于 <code>maximumPoolSize</code>，会创建新的非核心线程来执行任务</li>
<li>如果当前线程数已经达到 <code>maximumPoolSize</code>，且 <code>workQueue</code> 已满，则根据拒绝策略处理新任务</li>
</ol>
<h3 data-id="heading-36">4.4 拒绝策略</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// AbortPolicy: 直接抛出异常（默认策略）</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.AbortPolicy()

<span class="hljs-comment">// CallerRunsPolicy: 由调用线程执行任务</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.CallerRunsPolicy()

<span class="hljs-comment">// DiscardPolicy: 直接丢弃任务</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.DiscardPolicy()

<span class="hljs-comment">// DiscardOldestPolicy: 丢弃队列最前面的任务，然后重新尝试执行</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.DiscardOldestPolicy()
</code></pre>
<h3 data-id="heading-37">4.5 自定义 ThreadPoolExecutor 示例</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPoolExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 自定义线程池</span>
        <span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(
            <span class="hljs-number">3</span>,                                      <span class="hljs-comment">// 核心线程数</span>
            <span class="hljs-number">6</span>,                                      <span class="hljs-comment">// 最大线程数</span>
            <span class="hljs-number">30L</span>,                                    <span class="hljs-comment">// 空闲线程存活时间</span>
            TimeUnit.SECONDS,                       <span class="hljs-comment">// 时间单位</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">10</span>),          <span class="hljs-comment">// 有界阻塞队列</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadFactory</span>() {                  <span class="hljs-comment">// 自定义线程工厂</span>
                <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">counter</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> Thread <span class="hljs-title function_">newThread</span><span class="hljs-params">(Runnable r)</span> {
                    <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(r, <span class="hljs-string">"CustomThread-"</span> + counter++);
                    thread.setDaemon(<span class="hljs-literal">false</span>);
                    <span class="hljs-keyword">return</span> thread;
                }
            },
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.CallerRunsPolicy() <span class="hljs-comment">// 拒绝策略</span>
        );
        
        <span class="hljs-comment">// 提交任务</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">taskId</span> <span class="hljs-operator">=</span> i;
            executor.submit(() -&gt; {
                System.out.println(<span class="hljs-string">"任务 "</span> + taskId + <span class="hljs-string">" 由 "</span> + 
                    Thread.currentThread().getName() + <span class="hljs-string">" 执行"</span>);
                <span class="hljs-keyword">try</span> {
                    Thread.sleep(<span class="hljs-number">2000</span>); <span class="hljs-comment">// 模拟任务执行</span>
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                }
            });
        }
        
        <span class="hljs-comment">// 关闭线程池</span>
        executor.shutdown();
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 等待所有任务完成</span>
            <span class="hljs-keyword">if</span> (!executor.awaitTermination(<span class="hljs-number">60</span>, TimeUnit.SECONDS)) {
                executor.shutdownNow(); <span class="hljs-comment">// 强制关闭</span>
            }
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            executor.shutdownNow();
        }
    }
}
</code></pre>
<h3 data-id="heading-38">4.6 线程池状态管理</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 常用的线程池管理方法</span>
executor.shutdown();           <span class="hljs-comment">// 平滑关闭，不再接受新任务，等待已有任务完成</span>
executor.shutdownNow();        <span class="hljs-comment">// 立即关闭，尝试中断所有正在执行的任务</span>
executor.isShutdown();         <span class="hljs-comment">// 判断是否已关闭</span>
executor.isTerminated();       <span class="hljs-comment">// 判断是否所有任务都已完成</span>
executor.getPoolSize();        <span class="hljs-comment">// 获取当前线程数</span>
executor.getActiveCount();     <span class="hljs-comment">// 获取活跃线程数</span>
executor.getCompletedTaskCount(); <span class="hljs-comment">// 获取已完成任务数</span>
</code></pre>
<h2 data-id="heading-39">5. 最佳实践建议</h2>
<ol>
<li><strong>优先使用 ThreadPoolExecutor</strong> 而不是 <code>Executors</code> 工厂方法，可以更精确地控制线程池行为</li>
<li><strong>合理设置线程池大小</strong>：CPU密集型任务设置为CPU核心数+1，IO密集型任务可以设置更大</li>
<li><strong>选择合适的队列类型</strong>：<code>ArrayBlockingQueue</code> 适合有界队列，<code>LinkedBlockingQueue</code> 适合无界队列</li>
<li><strong>正确处理异常</strong>：在线程任务中捕获并处理异常，避免线程意外终止</li>
<li><strong>及时关闭线程池</strong>：应用结束前调用 <code>shutdown()</code> 或 <code>shutdownNow()</code> 方法</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[全网最细，Qwen3大模型极致微调与推理实战：Unsloth一站式教程]]></title>    <link>https://juejin.cn/post/7570976560708730943</link>    <guid>https://juejin.cn/post/7570976560708730943</guid>    <pubDate>2025-11-11T05:52:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570976560708730943" data-draft-id="7570976560708714559" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="全网最细，Qwen3大模型极致微调与推理实战：Unsloth一站式教程"/> <meta itemprop="keywords" content="LLM,程序员,Agent"/> <meta itemprop="datePublished" content="2025-11-11T05:52:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI大模型"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            全网最细，Qwen3大模型极致微调与推理实战：Unsloth一站式教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI大模型
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T05:52:01.000Z" title="Tue Nov 11 2025 05:52:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>在大模型快速迭代的今天，Qwen3 作为开源圈的黑马，凭借强悍的推理能力、多语言支持和灵活的“思考模式”切换，吸引了无数开发者关注。</p>
<p>你想让自己的AI项目更聪明、更高效吗？今天就带你全流程掌握如何用 <code>Unsloth</code> 框架对 Qwen3 进行高效微调、推理和评估，让你的应用一飞冲天！</p>
<h2 data-id="heading-0">一、Qwen3模型亮点全解析</h2>
<p>Qwen3 是新一代开源大语言模型，主打以下几个核心优势：</p>
<ul>
<li> <strong>多尺寸可选、部署灵活</strong>：无论是手机、智能眼镜还是自动驾驶、机器人，Qwen3 都能按需选择模型大小，适配边缘设备或云端服务器。</li>
<li> <strong>推理透明可控</strong>：独特的“思考模式”能让模型在输出答案前，先展示推理过程，极大方便调试、教学和代码生成。</li>
<li> <strong>多语言天花板</strong>：支持119种语言及方言，轻松应对全球化产品需求。</li>
<li> <strong>超长上下文处理</strong>：最大支持128K tokens，适合法律、代码、文档等超长文本场景。</li>
<li> <strong>高性能低成本</strong>：MoE（专家混合）架构只激活部分专家，推理快、成本低，媲美甚至超越同体量闭源大模型。</li>
<li> <strong>开源可定制</strong>：Apache 2.0协议，权重可随意下载、二次开发，直接对接Hugging Face生态。</li>
</ul>
<hr/>
<h2 data-id="heading-1">二、Qwen3“思考模式”揭秘：让你的AI会“思考”</h2>
<p>Qwen3 的最大特色就是“思考模式”与“非思考模式”自由切换：</p>
<ul>
<li> <strong>思考模式</strong>：模型在输出答案前，会用<code>&lt;think&gt;...&lt;/think&gt;</code>标签详细展示推理步骤，比如数学计算、逻辑推断等，让你清楚看到AI的思路。</li>
<li> <strong>非思考模式</strong>：直接给出答案，速度更快，适合对话机器人、实时助手等场景。</li>
</ul>
<p>你可以通过三种方式控制思考模式：</p>
<ol>
<li><strong>API参数</strong>：<code>enable_thinking=True</code>（默认开启，输出完整推理过程）；<code>enable_thinking=False</code>（只输出答案，不展示推理）。</li>
<li><strong>Prompt指令</strong>：在用户消息中加<code>/no_think</code>，即使API参数为True，也强制关闭思考展示。</li>
<li><strong>后处理</strong>：如果只想要纯答案，可以在输出后通过字符串处理移除<code>&lt;think&gt;</code>标签。</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d74f84508484aa994230bf80079c37c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445121&amp;x-signature=Yaz2Bi5H16t7eCb4jixaJwiP%2Fak%3D" alt="" loading="lazy"/></p>
<p><strong>应用场景举例</strong>：</p>
<ul>
<li>教育/数学题讲解：展示每一步推导，AI秒变“讲题老师”。</li>
<li>代码生成/调试：看到AI决策流程，快速定位bug。</li>
<li>聊天助手/智能客服：关闭思考模式，响应更快，体验更丝滑。</li>
</ul>
<hr/>
<h2 data-id="heading-2">三、Qwen3 + Unsloth 微调与推理全流程（附代码）</h2>
<p>下面以 PyTorch + Unsloth 框架为例，手把手教你微调和推理 Qwen3：</p>
<h3 data-id="heading-3">1. 环境准备</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> torch  
<span class="hljs-keyword">from</span> unsloth <span class="hljs-keyword">import</span> FastLanguageModel  
<span class="hljs-keyword">import</span> weave  <span class="hljs-comment"># 可选，用于可视化和分析  </span>
weave.init(<span class="hljs-string">'think_test'</span>)
</code></pre>
<h3 data-id="heading-4">2. 模型加载与配置</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">BASE_MODEL_NAME</span> = <span class="hljs-string">"unsloth/Qwen3-8B"</span>  
<span class="hljs-attr">max_seq_length</span> = <span class="hljs-number">2048</span>  
<span class="hljs-attr">dtype</span> = None  
<span class="hljs-attr">load_in_4bit</span> = <span class="hljs-literal">False</span>  
  
BASE_MODEL, <span class="hljs-attr">TOKENIZER</span> = FastLanguageModel.from_pretrained(  
    <span class="hljs-attr">model_name</span>=BASE_MODEL_NAME,  
    <span class="hljs-attr">max_seq_length</span>=max_seq_length,  
    <span class="hljs-attr">dtype</span>=dtype,  
    <span class="hljs-attr">load_in_4bit</span>=load_in_4bit  
)  
BASE_MODEL.eval().to("cuda")  
FastLanguageModel.for_inference(BASE_MODEL)
</code></pre>
<h3 data-id="heading-5">3. Prompt构建与推理函数</h3>
<pre><code class="hljs language-ini" lang="ini">def make_prompt(instruction):  
    return <span class="hljs-section">[{"role": "user", "content": instruction}]</span>  
  
defapply_chat_template(prompt, tokenizer, <span class="hljs-attr">enable_thinking</span>=<span class="hljs-literal">True</span>):  
    <span class="hljs-attr">messages</span> = make_prompt(prompt)  
    return tokenizer.apply_chat_template(  
        messages,  
        <span class="hljs-attr">tokenize</span>=<span class="hljs-literal">False</span>,  
        <span class="hljs-attr">add_generation_prompt</span>=<span class="hljs-literal">True</span>,  
        <span class="hljs-attr">enable_thinking</span>=enable_thinking  
    )  
  
@weave.op  
defgenerate_response(prompt, <span class="hljs-attr">enable_thinking</span>=<span class="hljs-literal">True</span>):  
    <span class="hljs-attr">prompt_text</span> = apply_chat_template(prompt, TOKENIZER, enable_thinking)  
    <span class="hljs-attr">inputs</span> = TOKENIZER([prompt_text], return_tensors=<span class="hljs-string">"pt"</span>).to(<span class="hljs-string">"cuda"</span>)  
    with torch.no_grad():  
        <span class="hljs-attr">gen_output</span> = BASE_MODEL.generate(  
            **inputs,  
            <span class="hljs-attr">max_new_tokens</span>=<span class="hljs-number">128</span>,  
            <span class="hljs-attr">use_cache</span>=<span class="hljs-literal">False</span>,  
            <span class="hljs-attr">temperature</span>=<span class="hljs-number">0.7</span>,  
            <span class="hljs-attr">top_p</span>=<span class="hljs-number">0.8</span>,  
            <span class="hljs-attr">top_k</span>=<span class="hljs-number">20</span>,  
            <span class="hljs-attr">min_p</span>=<span class="hljs-number">0.0</span>,  
        )  
    <span class="hljs-attr">output_text</span> = TOKENIZER.decode(gen_output[<span class="hljs-number">0</span>], skip_special_tokens=<span class="hljs-literal">True</span>)  
    return output_text
</code></pre>
<h3 data-id="heading-6">4. 实战测试</h3>
<pre><code class="hljs language-scss" lang="scss">math_question = "What is <span class="hljs-number">256</span> multiplied by <span class="hljs-number">17</span>?"  
math_question_no_think = "/no_think\nWhat is <span class="hljs-number">256</span> multiplied by <span class="hljs-number">17</span>?"  
  
<span class="hljs-built_in">print</span>("=== enable_thinking=True (默认) ===")  
<span class="hljs-built_in">print</span>(generate_response(math_question, enable_thinking=True)<span class="hljs-selector-class">.strip</span>())  
  
<span class="hljs-built_in">print</span>("=== enable_thinking=False ===")  
<span class="hljs-built_in">print</span>(generate_response(math_question, enable_thinking=False)<span class="hljs-selector-class">.strip</span>())  
  
<span class="hljs-built_in">print</span>("=== enable_thinking=True + /no_think in prompt ===")  
<span class="hljs-built_in">print</span>(generate_response(math_question_no_think, enable_thinking=True)<span class="hljs-selector-class">.strip</span>())
</code></pre>
<p><strong>效果说明</strong>：</p>
<ul>
<li>默认模式下，输出包含详细推理过程。</li>
<li>关闭思考模式，输出直接给答案。</li>
<li>Prompt加 <code>/no_think</code>，无论API参数如何，都只输出答案。</li>
</ul>
<h2 data-id="heading-7">四、Qwen3适用场景与实战建议</h2>
<ul>
<li> <strong>多端部署</strong>：适合手机、IoT、车载等多种硬件，灵活选型。</li>
<li> <strong>高透明度AI</strong>：教育、科研、代码生成等需要“可解释性”的场合首选。</li>
<li> <strong>超长文本/多语言</strong>：文档分析、全球化产品、法律合规等强需求。</li>
<li> <strong>高性价比推理</strong>：MoE架构让企业级部署更省钱。</li>
<li> <strong>开源自定义</strong>：二次开发、私有化部署无压力。</li>
</ul>
<h2 data-id="heading-8">五、总结</h2>
<p>Qwen3 + Unsloth 的组合，堪称国产大模型微调和推理的新范式。无论你是AI开发新手还是企业技术负责人，都能用极低门槛把AI能力集成到自己的产品中。只要学会上面这套流程，你就能让AI“会思考”、会解释、会多语言，还能轻松微调出专属模型！</p>
<h2 data-id="heading-9">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[让代码更清晰：Android 中的 MVC、MVP 与 MVVM]]></title>    <link>https://juejin.cn/post/7570630923711135796</link>    <guid>https://juejin.cn/post/7570630923711135796</guid>    <pubDate>2025-11-10T07:50:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570630923711135796" data-draft-id="7570247858869338164" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="让代码更清晰：Android 中的 MVC、MVP 与 MVVM"/> <meta itemprop="keywords" content="Android,MVVM,MVC"/> <meta itemprop="datePublished" content="2025-11-10T07:50:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨白"/> <meta itemprop="url" content="https://juejin.cn/user/2549135752044601"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            让代码更清晰：Android 中的 MVC、MVP 与 MVVM
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2549135752044601/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨白
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T07:50:10.000Z" title="Mon Nov 10 2025 07:50:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">真正的问题</h2>
<p>在没有引入架构时，我们的 <code>Activity</code> 或 <code>Fragment</code> 非常臃肿：既要负责展示 View，又要负责响应点击事件，还需要去负责网络请求，处理业务逻辑，管理数据状态...</p>
<p>这导致了高耦合性，这种代码几乎无法测试且难以维护。</p>
<p>所以我们引入了架构模式，就是为了拆开 <code>Activity</code> 或 <code>Fragment</code>。</p>
<h2 data-id="heading-1">MVC 和 MVP 的关系</h2>
<p>首先澄清一个误区：MVP 并不是 MVC 的改进版本，只是解决同一个问题的两种不同的拆分思路。</p>
<p>我们通常认为原生 Android 就是 MVC，其中 <code>Activity</code> 是 Controller，XML 布局是 View，</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Model: 业务逻辑和数据</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterModel</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> count = <span class="hljs-number">0</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span></span> {
        count++
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getCount</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span> = count
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> model = CounterModel()

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        setContentView(R.layout.view_counter_content)

        <span class="hljs-keyword">val</span> countTextView = findViewById&lt;TextView&gt;(R.id.count_text_view)
        <span class="hljs-keyword">val</span> incrementButon = findViewById&lt;Button&gt;(R.id.increment_button)
        incrementButon.setOnClickListener {
            model.increment()
            countTextView.text = model.getCount().toString()
        }
    }
}
</code></pre>
<p><code>view_counter_content.xml</code> 文件布局代码：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span>
    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span>
    <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"center"</span>
    <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">"vertical"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span>
        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/count_text_view"</span>
        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"0"</span>
        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"24sp"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/increment_button"</span>
        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"Increment"</span> /&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span>
</code></pre>
<p>但 XML（View）只负责布局，肩负的职责太少，显示都是由 <code>Activity</code>（Controller）来完成的，所以 C、V 还是耦合在了一起，我们可以称其为 “M-VC” 架构。</p>
<h3 data-id="heading-2">MVC 拆 View：解耦视图</h3>
<p>我们可以封装一个自定义 View，让它自己在管理内部的 UI 和事件，对外暴露接口和回调。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Model: 业务逻辑和数据</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterModel</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> count = <span class="hljs-number">0</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span></span> {
        count++
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getCount</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span> = count
}


<span class="hljs-comment">// 管理自己的子视图和 UI 事件</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterView</span>(context: Context, attrs: AttributeSet?) : LinearLayout(context, attrs) {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> countTextView: TextView
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> incrementButon: Button

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> onIncrementListener: (() -&gt; <span class="hljs-built_in">Unit</span>)? = <span class="hljs-literal">null</span>

    <span class="hljs-keyword">init</span> {
        <span class="hljs-comment">// 加载布局</span>
        inflate(context, R.layout.view_counter_content, <span class="hljs-keyword">this</span>)

        countTextView = findViewById(R.id.count_text_view)
        incrementButon = findViewById(R.id.increment_button)

        incrementButon.setOnClickListener {
            <span class="hljs-comment">// 通知 Controller 发生了点击事件</span>
            onIncrementListener?.invoke()
        }
    }

    <span class="hljs-comment">// 让 Controller 更新 UI</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setCount</span><span class="hljs-params">(count: <span class="hljs-type">Int</span>)</span></span> {
        countTextView.text = count.toString()
    }

    <span class="hljs-comment">// 让 Controller 监听 UI 事件 (命名已统一)</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setOnIncrementListener</span><span class="hljs-params">(listener: () -&gt; <span class="hljs-type">Unit</span>)</span></span> {
        <span class="hljs-keyword">this</span>.onIncrementListener = listener
    }

}

<span class="hljs-comment">// Controller: Activity，负责调度</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MVCActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> model = CounterModel()
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        setContentView(R.layout.activity_mvc)

        <span class="hljs-keyword">val</span> counterView = findViewById&lt;CounterView&gt;(R.id.counter_view)
        <span class="hljs-comment">// Controller 初始加载数据</span>
        counterView.setCount(model.getCount())

        <span class="hljs-comment">// Controller 监听 UI 事件</span>
        counterView.setOnIncrementListener {
            <span class="hljs-comment">// 事件触发，更新 Model</span>
            model.increment()
            <span class="hljs-comment">// 使用 Model 的新数据更新 UI</span>
            counterView.setCount(model.getCount())
        }
    }
}
</code></pre>
<p><code>activity_mvc</code> 布局代码：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">com.example.app.CounterView</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/counter_view"</span>
    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span>
    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span>
    <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"center"</span>
    <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">"vertical"</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">com.example.app.CounterView</span>&gt;</span>
</code></pre>
<p>这样 <code>Activity</code>（Controller） 就很干净了，只负责调度，并不用关心控件的存在。</p>
<h3 data-id="heading-3">MVP 拆 Controller：解耦控制器</h3>
<p>MVP 拆分的不是 View，它认为 <code>Activity</code> 也是 View（因为它持有 View 的引用）。</p>
<p>MVP 把所有的调度和业务逻辑抽取到了 <code>Presenter</code> 中，通过接口和 <code>Activity</code> 通信。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Model: 业务逻辑和数据</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterModel</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> count = <span class="hljs-number">0</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span></span> {
        count++
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getCount</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span> = count
}

<span class="hljs-comment">// Contract: 定义 View 和 Presenter 的接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">CounterContract</span> {
    <span class="hljs-comment">// View 的接口</span>
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">View</span> {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">showCount</span><span class="hljs-params">(count: <span class="hljs-type">Int</span>)</span></span>
    }

    <span class="hljs-comment">// Presenter 的接口</span>
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Presenter</span> {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadInitialCount</span><span class="hljs-params">()</span></span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">incrementCount</span><span class="hljs-params">()</span></span>
    }
}

<span class="hljs-comment">// Presenter: 控制器，负责所有逻辑</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterPresenter</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> view: CounterContract.View,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> model: CounterModel
) : CounterContract.Presenter {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadInitialCount</span><span class="hljs-params">()</span></span> {
        view.showCount(model.getCount())
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">incrementCount</span><span class="hljs-params">()</span></span> {
        model.increment()
        view.showCount(model.getCount())
    }
}


<span class="hljs-comment">// View: Activity，实现接口，所有逻辑委托给 Presenter</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MVPActivity</span> : <span class="hljs-type">AppCompatActivity</span>(), CounterContract.View {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> presenter: CounterContract.Presenter
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> countTextView: TextView
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> incrementButton: Button

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        setContentView(R.layout.activity_mvp)

        countTextView = findViewById(R.id.count_text_view)
        incrementButton = findViewById(R.id.increment_button)
        presenter = CounterPresenter(<span class="hljs-keyword">this</span>, CounterModel())

        <span class="hljs-comment">// 绑定按钮点击事件到 Presenter</span>
        incrementButton.setOnClickListener {
            presenter.incrementCount()
        }

        <span class="hljs-comment">// 加载初始数据</span>
        presenter.loadInitialCount()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">showCount</span><span class="hljs-params">(count: <span class="hljs-type">Int</span>)</span></span> {
        countTextView.text = count.toString()
    }
}
</code></pre>
<blockquote>
<p><code>activity_mvp</code> 布局文件的代码和 <code>view_counter_content</code> 布局一样。</p>
</blockquote>
<p><code>Presenter</code> 是一个纯粹的类，而 <code>Activity</code> 变为了被动的视图，只负责实现接口。</p>
<p>现在，我们就知道了 MVC 和 MVP 都是为了解耦 V 和 C，只不过两者的方向不同。MVP 并没有比 MVC 更好。</p>
<h2 data-id="heading-4">MVVM 与数据绑定</h2>
<p>MVP 解决了耦合性，但也带来了新的问题，随着业务变得复杂，<code>CounterContract.View</code> 接口也会越来越臃肿，Presenter 和 View 存在了大量的命令式调用。</p>
<p>那么我们能不能让 View 订阅数据，我们负责修改数据，View 自动更新呢？</p>
<p>这就是 MVVM 的核心思想：数据绑定。</p>
<p>我们通常会使用 <code>ViewModel</code> 和 <code>LiveData</code> 这两个<strong>工具</strong>来实现它：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Model: 业务逻辑和数据</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterModel</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> count = <span class="hljs-number">0</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span></span> {
        count++
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getCount</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span> = count
}

<span class="hljs-comment">// ViewModel: 持有 Model，暴露状态</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterViewModel</span> : <span class="hljs-type">ViewModel</span>() {

    <span class="hljs-comment">// ViewModel 自己创建和管理 Model</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> model = CounterModel()

    <span class="hljs-comment">// 对外暴露 LiveData</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> _count = MutableLiveData&lt;<span class="hljs-built_in">Int</span>&gt;()
    <span class="hljs-keyword">val</span> count: LiveData&lt;<span class="hljs-built_in">Int</span>&gt; = _count

    <span class="hljs-keyword">init</span> {
        <span class="hljs-comment">// 加载初始状态</span>
        _count.value = model.getCount()
    }

    <span class="hljs-comment">//  对外暴露业务逻辑方法</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">incrementCount</span><span class="hljs-params">()</span></span> {
        model.increment()
        _count.value = model.getCount()
    }
}


<span class="hljs-comment">// View: Activity，持有 ViewModel</span>
<span class="hljs-comment">// 订阅 ViewModel 的 LiveData，调用 ViewModel 的方法</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MVVMActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> countTextView: TextView
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> incrementButton: Button
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> viewModel: CounterViewModel <span class="hljs-keyword">by</span> viewModels()

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        setContentView(R.layout.activity_mvvm) <span class="hljs-comment">// 同 activity_mvp.xml</span>

        countTextView = findViewById(R.id.count_text_view)
        incrementButton = findViewById(R.id.increment_button)

        incrementButton.setOnClickListener {
            <span class="hljs-comment">// 调用 ViewModel 的方法</span>
            viewModel.incrementCount()
        }

        <span class="hljs-comment">// 订阅 ViewModel 的 LiveData</span>
        viewModel.count.observe(<span class="hljs-keyword">this</span>) { newCount -&gt;
            <span class="hljs-comment">// 状态改变时，更新 UI</span>
            countTextView.text = newCount.toString()
        }
    }
}
</code></pre>
<p><code>Activity</code> 不需要实现任何接口，<code>ViewModel</code> 也无需持有 <code>Activity</code> 的引用，真正实现了 V 和 VM 的解耦。</p>
<h3 data-id="heading-5">ViewModel 的角色</h3>
<p><code>androidx.lifecycle.ViewModel</code> 最初是为了解决屏幕旋转等配置变更时的数据存活问题而诞生的，无论是 <code>Presenter</code> 或是自定义的 VM 对象，都会在 Activity 销毁时重建。</p>
<blockquote>
<p>数据绑定的本质是观察者模式，也可以通过其他方式来实现数据绑定，所以 VM 不一定代表了 <code>androidx.lifecycle.ViewModel</code>。</p>
</blockquote>
<p>但由于 <code>ViewModel</code> 的特性，能够持有状态、完成逻辑处理，因此，它完美地承担了 VM 的角色。</p>
<p>所以，现在 MVVM 架构中：</p>
<ul>
<li>VM 指的一般是 ViewModel（内部持有 <code>LiveData</code> 或 <code>StateFlow</code>）</li>
<li>V 指的是 Activity / Fragment / Composable，</li>
<li>M 是 Model（在复杂项目中通常是 <code>Repository</code> 或 <code>UseCase</code>）</li>
</ul>
<h2 data-id="heading-6">总结</h2>
<p>架构设计的真正核心就是<strong>拆分</strong>，无论是 MVC（拆分 View）、MVP（拆分 Controller）还是 MVVM（用数据绑定解耦）。它们的目的都是将臃肿的集合体，拆分为清晰的、各司其职的组件。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[关于scoped样式隔离原理和失效情况&&常见样式隔离方案]]></title>    <link>https://juejin.cn/post/7570902473432498176</link>    <guid>https://juejin.cn/post/7570902473432498176</guid>    <pubDate>2025-11-10T09:00:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570902473432498176" data-draft-id="7570604028633432099" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="关于scoped样式隔离原理和失效情况&amp;&amp;常见样式隔离方案"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2025-11-10T09:00:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="拉不动的猪"/> <meta itemprop="url" content="https://juejin.cn/user/1429793504759630"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            关于scoped样式隔离原理和失效情况&amp;&amp;常见样式隔离方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1429793504759630/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    拉不动的猪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T09:00:33.000Z" title="Mon Nov 10 2025 09:00:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="an-old-hope">.hljs-comment,.hljs-quote{color:#b6b18b}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#eb3c54}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#e7ce56}.hljs-attribute{color:#ee7c2b}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#4fb4d7}.hljs-section,.hljs-title{color:#78bb65}.hljs-keyword,.hljs-selector-tag{color:#b45ea4}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1c1d21;color:#c0c5ce}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Vue 的 <code>scoped</code> 样式隔离看似简单，实则有明确的实现逻辑，未隔离成功往往是没搞懂它的工作原理。下面从「核心机制→实现步骤→隔离边界→常见误区」四个维度详细拆解：</p>
<h3 data-id="heading-0">一、核心结论</h3>
<p><code>scoped</code> 的本质是 <strong>通过给组件内元素添加唯一属性 + 样式选择器绑定该属性</strong>，让样式仅作用于当前组件的元素，从而实现隔离。<strong>但它无法隔离全局选择器（如标签、通配符）</strong>，这也是遇到 两个组件“类名不同仍被影响”（一个加了scoped，另一个不加scoped） 的核心原因。</p>
<hr/>
<h3 data-id="heading-1">二、<code>scoped</code> 样式隔离的完整实现步骤</h3>
<p>Vue 编译组件时，会对 <code>scoped</code> 样式做 3 件关键事，全程自动化：</p>
<h4 data-id="heading-2">1. 给组件内所有元素添加「唯一属性」</h4>
<p>编译后，组件模板中的所有元素（包括子元素、根元素）都会被添加一个格式为 <code>data-v-xxx</code> 的自定义属性，<code>xxx</code> 是组件的唯一哈希值（每个组件的哈希值不同）。</p>
<p><strong>示例（编译前）</strong> ：</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 组件 A（带 scoped） --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>组件 A 内容<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p><strong>示例（编译后）</strong> ：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 每个元素都多了 data-v-123（123 是组件 A 的唯一哈希） --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span> <span class="hljs-attr">data-v-123</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">data-v-123</span>&gt;</span>组件 A 内容<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">2. 给组件内所有样式规则添加「属性选择器」</h4>
<p>组件内的所有 CSS 选择器，都会被自动追加 <code>[data-v-xxx]</code> 属性选择器，强制让样式只匹配带该属性的元素（也就是当前组件内的元素）。</p>
<p><strong>示例（编译前，scoped 样式）</strong> ：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f0f0f0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}
<span class="hljs-selector-class">.text</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><strong>示例（编译后，全局生效的样式）</strong> ：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 自动追加 [data-v-123]，只匹配组件 A 内的 .box */</span>
<span class="hljs-selector-class">.box</span><span class="hljs-selector-attr">[data-v-123]</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f0f0f0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}
<span class="hljs-comment">/* 自动追加 [data-v-123]，只匹配组件 A 内的 .text */</span>
<span class="hljs-selector-class">.text</span><span class="hljs-selector-attr">[data-v-123]</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
}
</code></pre>
<h4 data-id="heading-4">3. 子组件根元素的「属性继承」（关键细节）</h4>
<p>如果组件 A 包含子组件 B（也带 scoped），子组件 B 的<strong>根元素</strong>会同时拥有组件 A 的 <code>data-v-xxx</code> 和组件 B 自己的 <code>data-v-yyy</code> 属性。</p>
<p>目的是：让父组件的 <code>scoped</code> 样式能作用于子组件的根元素（方便父组件控制子组件布局），但子组件内部的元素仍受自己的 <code>scoped</code> 保护。</p>
<p><strong>示例</strong>：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 组件 A 包含组件 B，编译后 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span> <span class="hljs-attr">data-v-123</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 子组件 B 的根元素，同时有 data-v-123（父）和 data-v-456（子） --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child-root"</span> <span class="hljs-attr">data-v-456</span> <span class="hljs-attr">data-v-123</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 子组件 B 内部元素，只有自己的 data-v-456 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child-text"</span> <span class="hljs-attr">data-v-456</span>&gt;</span>子组件 B 内容<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">三、<code>scoped</code> 的「隔离边界」：哪些情况会失效？</h3>
<p><code>scoped</code> 只能隔离「带组件唯一属性的选择器」，以下 3 种情况会突破隔离，这也是你遇到问题的核心原因：</p>
<h4 data-id="heading-6">1. 未使用 <code>scoped</code> 的组件使用「全局选择器」</h4>
<p>未加 <code>scoped</code> 的组件样式是全局生效的，如果它用了 <strong>标签选择器（div/p）、通配符（*）、属性选择器</strong>，这些选择器不会被添加 <code>data-v-xxx</code> 限制，会匹配页面上所有对应元素 —— 包括带 <code>scoped</code> 的组件内的元素。</p>
<p><strong>示例（问题场景）</strong> ：</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 组件 X（未用 scoped，全局样式） --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 全局标签选择器，匹配所有 div，包括组件 A 内的 div */</span>
<span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">color</span>: red; <span class="hljs-comment">/* 组件 A 内的 div 会被染成红色，即使类名不同 */</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 组件 A（用 scoped） --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.my-box</span> { <span class="hljs-comment">/* 类名不同，但内部 div 仍被组件 X 影响 */</span>
  <span class="hljs-comment">/* 样式被覆盖 */</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h4 data-id="heading-7">2. 选择器权重问题</h4>
<p>未加 <code>scoped</code> 的全局样式如果用了「更具体的选择器」（如 <code>父类 子类</code> 嵌套），权重可能高于 <code>scoped</code> 样式（<code>类名[data-v-xxx]</code>），从而覆盖样式。</p>
<p><strong>示例</strong>：</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 全局样式（未 scoped） --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 权重：10 + 10 = 20 */</span>
<span class="hljs-selector-class">.container</span> <span class="hljs-selector-class">.content</span> {
  <span class="hljs-attribute">background</span>: blue;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

<span class="hljs-comment">&lt;!-- scoped 组件 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 权重：10（类名） + 10（属性） = 20，若全局样式在后面，会覆盖 */</span>
<span class="hljs-selector-class">.content</span> {
  <span class="hljs-attribute">background</span>: white;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h4 data-id="heading-8">3. 深度作用选择器（::v-deep）的反向影响</h4>
<p>如果带 <code>scoped</code> 的组件用了 <code>::v-deep</code>（或 <code>/deep/</code>），会穿透自己的 <code>scoped</code> 限制，样式作用于子组件内部；但如果全局样式（未 scoped）用了类似穿透逻辑（少见），也可能影响 <code>scoped</code> 组件。</p>
<hr/>
<h3 data-id="heading-9">四、问题解决方案</h3>
<p>假设场景是「未 scoped 组件影响了 scoped 组件，类名不同」，直接按以下步骤排查修复：</p>
<ol>
<li>
<p><strong>检查未 scoped 组件的样式</strong>：</p>
<ul>
<li>删掉或修改全局的「标签选择器、通配符、属性选择器」，改用「类名选择器」（如 <code>.component-x-div</code> 而非 <code>div</code>）。</li>
<li>若必须用全局样式，给未 scoped 的组件样式添加「命名空间」（如给根元素加唯一类名，样式嵌套在里面）。</li>
</ul>
<p><strong>修复示例</strong>：</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 未 scoped 的组件 X（修复后） --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"component-x"</span>&gt;</span> <span class="hljs-comment">&lt;!-- 根元素加唯一命名空间 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>组件 X 内容<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 嵌套选择器，只作用于组件 X 内部，不影响其他组件 */</span>
<span class="hljs-selector-class">.component-x</span> <span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">color</span>: red;
}
<span class="hljs-selector-class">.component-x</span> <span class="hljs-selector-tag">div</span> { <span class="hljs-comment">/* 即使是标签选择器，也被命名空间限制 */</span>
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
</li>
<li>
<p><strong>提升 scoped 组件样式的权重</strong>：</p>
<ul>
<li>给 scoped 组件的样式添加更具体的选择器（如嵌套类名），或用 <code>!important</code>（谨慎使用，仅在必要时）。</li>
</ul>
<p><strong>示例</strong>：</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 更具体的选择器，权重更高 */</span>
<span class="hljs-selector-class">.parent</span> <span class="hljs-selector-class">.child</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span> <span class="hljs-meta">!important</span>; <span class="hljs-comment">/* 覆盖全局样式 */</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
</li>
<li>
<p><strong>给未 scoped 的组件添加 scoped（推荐）</strong> ：</p>
<ul>
<li>除非需要全局样式，否则尽量给所有组件都加 <code>scoped</code>，从根源避免样式污染。</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-10">总结</h3>
<p><code>scoped 的隔离核心是「属性绑定」，但它管不住全局的标签选择器、通配符等宽泛选择器。</code>你遇到的问题，本质是未 scoped 组件的全局选择器 “误伤” 了 scoped 组件内的元素 —— 和类名是否相同无关，只和选择器的匹配范围有关。</p>
<h2 data-id="heading-11">其他常见隔离方案</h2>
<p>在 Vue 中，除了 <code>scoped</code> 之外，还有多种样式隔离方案，适用于不同场景（如全局样式管理、组件库开发、避免选择器冲突等）。以下是常用的 5 种方法：</p>
<h3 data-id="heading-12">1. <strong>CSS Modules（CSS 模块化）</strong></h3>
<h4 data-id="heading-13">原理：</h4>
<p>通过 Webpack 等构建工具，将 CSS 类名编译为<strong>唯一哈希值</strong>（如 <code>box</code> → <code>_3zyde4l1yATCOkgn-DBWEL</code>），确保每个组件的类名在全局唯一，避免冲突。（类似 <code>scoped</code>，但隔离粒度是 “类名” 而非 “元素属性”）</p>
<h4 data-id="heading-14">使用方式：</h4>
<ul>
<li>样式文件命名为 <code>xxx.module.css</code>（或 <code>xxx.module.scss</code>）</li>
<li>在组件中通过 <code>import</code> 引入，以对象形式使用类名</li>
</ul>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 组件中使用 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"styles.box"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"styles.text"</span>&gt;</span>CSS Modules 示例<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">'./xxx.module.css'</span>; <span class="hljs-comment">// 引入模块化样式</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> { styles };
  }
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- xxx.module.css --&gt;</span>
.box {
  padding: 20px;
  background: #f0f0f0;
}
.text {
  color: #333;
}
</code></pre>
<h4 data-id="heading-15">编译后效果：</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"_3zyde4l1yATCOkgn-DBWEL"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"_13lgc6x90aWZ7VQrN5Qx9u"</span>&gt;</span>CSS Modules 示例<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
._3zyde4l1yATCOkgn-DBWEL { <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; <span class="hljs-attribute">background</span>: <span class="hljs-number">#f0f0f0</span>; }
._13lgc6x90aWZ7VQrN5Qx9u { <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>; }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h4 data-id="heading-16">适用场景：</h4>
<ul>
<li>大型项目，需要严格隔离组件样式，避免类名冲突</li>
<li>配合预处理器（Sass/LESS）使用，支持嵌套和变量</li>
<li>不希望依赖 <code>scoped</code> 的属性标记（如对 DOM 纯净度有要求）</li>
</ul>
<h3 data-id="heading-17">2. <strong>BEM 命名规范（手动隔离，不推荐：写法麻烦，字又多，劣势大于优势）</strong></h3>
<h4 data-id="heading-18">原理：</h4>
<p>通过<strong>统一的类名命名规则</strong>手动避免冲突，核心是 “组件名 + 元素名 + 修饰符” 的命名格式，让类名自带 “作用域”。格式：<code>block__element--modifier</code>（块__元素 -- 修饰符）</p>
<h4 data-id="heading-19">使用方式：</h4>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 以组件名（todo-list）作为 block 前缀 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"todo-list"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"todo-list__item"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"todo-list__text todo-list__text--completed"</span>&gt;</span>任务 1<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 所有类名带组件前缀，避免全局冲突 */</span>
<span class="hljs-selector-class">.todo-list</span> { <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>; }
<span class="hljs-selector-class">.todo-list__item</span> { <span class="hljs-attribute">margin</span>: <span class="hljs-number">5px</span> <span class="hljs-number">0</span>; }
<span class="hljs-selector-class">.todo-list__text--completed</span> { <span class="hljs-attribute">text-decoration</span>: line-through; }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h4 data-id="heading-20">适用场景：</h4>
<ul>
<li>中小型项目，不想依赖工具链（纯手动管理）</li>
<li>团队有统一命名规范，需要可读性强的类名</li>
<li>与全局样式共存时，明确区分组件样式范围</li>
</ul>
<h3 data-id="heading-21">3. <strong>CSS-in-JS（样式写在 JS 中）</strong></h3>
<h4 data-id="heading-22">原理：</h4>
<p>将 CSS 样式以 JavaScript 对象的形式编写，通过动态生成唯一类名或内联样式实现隔离。常见库：<code>styled-components</code>、<code>vue-styled-components</code>、<code>emotion</code>。</p>
<h4 data-id="heading-23">使用方式（以 <code>vue-styled-components</code> 为例）：</h4>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">StyledBox</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">StyledText</span>&gt;</span>CSS-in-JS 示例<span class="hljs-tag">&lt;/<span class="hljs-name">StyledText</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">StyledBox</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> styled <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-styled-components'</span>;

<span class="hljs-comment">// 定义带样式的组件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">StyledBox</span> = styled.<span class="hljs-property">div</span><span class="hljs-string">`
  padding: 20px;
  background: #f0f0f0;
`</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">StyledText</span> = styled.<span class="hljs-property">p</span><span class="hljs-string">`
  color: #333;
  font-size: 16px;
`</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">components</span>: { <span class="hljs-title class_">StyledBox</span>, <span class="hljs-title class_">StyledText</span> }
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-24">编译后效果：</h4>
<p>自动生成唯一类名（如 <code>sc-bdVaJa</code>），样式通过 <code>&lt;style&gt;</code> 标签插入头部，仅作用于对应组件。</p>
<h4 data-id="heading-25">适用场景：</h4>
<ul>
<li>需要动态生成样式（如根据 props 动态修改样式）</li>
<li>习惯组件化思维，将样式与组件逻辑紧密结合</li>
<li>大型项目，希望样式完全由 JS 管理（便于动态计算、主题切换）</li>
</ul>
<h3 data-id="heading-26">4. <strong>作用域隔离（基于 CSS 特性，方便&amp;&amp;见名之义）</strong></h3>
<p>利用 CSS 原生特性或预处理器的 “作用域” 功能，实现隔离：</p>
<h4 data-id="heading-27">（1）CSS 嵌套与命名空间</h4>
<p>通过父级类名嵌套所有子样式，形成 “命名空间隔离”（类似 BEM，但更简化）：</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user-card"</span>&gt;</span> <span class="hljs-comment">&lt;!-- 命名空间 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title"</span>&gt;</span>用户信息<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"desc"</span>&gt;</span>这是用户卡片<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 所有样式嵌套在命名空间下，避免冲突 */</span>
<span class="hljs-selector-class">.user-card</span> {
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#eee</span>;
  
  <span class="hljs-selector-class">.title</span> { <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>; }
  <span class="hljs-selector-class">.desc</span> { <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>; }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h4 data-id="heading-28">（2）CSS @layer（层级隔离）</h4>
<p>通过 <code>@layer</code> 定义样式层级，控制优先级，避免全局样式覆盖组件样式（需要浏览器支持）：</p>
<p>css</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">/* 全局样式 */</span>
<span class="hljs-variable">@layer</span> global {
  <span class="hljs-selector-class">.box</span> { <span class="hljs-attribute">color</span>: red; }
}

<span class="hljs-comment">/* 组件样式，层级优先级更高 */</span>
<span class="hljs-variable">@layer</span> component {
  <span class="hljs-selector-class">.box</span> { <span class="hljs-attribute">color</span>: blue; }
}
</code></pre>
<h3 data-id="heading-29">5. <strong>Shadow DOM（影子 DOM，完全隔离）</strong></h3>
<p><strong>Shadow DOM 更适合需要 <strong>强隔离、高封装性</strong> 的场景，核心是解决 “样式 / DOM 绝对不干扰” 的需求</strong></p>
<h4 data-id="heading-30">原理：</h4>
<p>利用浏览器原生的 Shadow DOM 特性，创建一个完全独立的 DOM 子树，其内部样式与外部完全隔离（外部样式无法影响内部，内部样式也不会泄漏到外部）。</p>
<h4 data-id="heading-31">使用方式（在 Vue 中需手动创建）：</h4>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"shadowHost"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="xml">
export default {
  mounted() {
    // 创建 Shadow DOM
    const shadowRoot = this.$refs.shadowHost.attachShadow({ mode: 'closed' });
    // 插入组件内容和样式
    shadowRoot.innerHTML = `
      <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-class">.box</span> { <span class="hljs-attribute">background</span>: <span class="hljs-number">#f0f0f0</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; }
        <span class="hljs-selector-tag">p</span> { <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>; }
      </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Shadow DOM 示例（完全隔离）<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    `;
  }
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-32">特点：</h4>
<ul>
<li>完全隔离：外部样式无法影响 Shadow DOM 内部，内部样式也不会污染全局</li>
<li>封闭性：<code>mode: 'closed'</code> 时，外部 JS 无法访问 Shadow DOM 内部元素</li>
<li>兼容性：现代浏览器支持良好，IE 不支持</li>
</ul>
<h4 data-id="heading-33">适用场景：</h4>
<ul>
<li>开发独立组件库（如 UI 组件），确保样式不受外部环境影响</li>
<li>需要严格隔离的场景（如嵌入第三方内容）</li>
</ul>
<h3 data-id="heading-34">各种方案对比与选择建议</h3>















































<table><thead><tr><th>方案</th><th>隔离原理</th><th>优点</th><th>缺点</th><th>适用场景</th></tr></thead><tbody><tr><td><code>scoped</code></td><td>元素添加唯一属性</td><td>简单易用，Vue 原生支持</td><td>无法隔离全局标签选择器</td><td>大多数日常组件</td></tr><tr><td>CSS Modules</td><td>类名编译为唯一哈希</td><td>隔离彻底，支持预处理器</td><td>需要构建工具，类名可读性差</td><td>大型项目，严格隔离需求</td></tr><tr><td>BEM 命名</td><td>手动规范类名</td><td>无工具依赖，类名可读</td><td>类名冗长，依赖团队规范</td><td>中小型项目，团队协作</td></tr><tr><td>CSS-in-JS</td><td>JS 动态生成唯一类名</td><td>样式动态性强，与组件逻辑结合紧密</td><td>增加 JS 体积，学习成本高</td><td>动态样式需求，组件库开发</td></tr><tr><td>Shadow DOM</td><td>浏览器原生隔离机制</td><td>完全隔离，不依赖 CSS 规则</td><td>兼容性有限，灵活性低</td><td>独立组件库，强隔离需求</td></tr></tbody></table>
<p>根据项目规模和需求选择：</p>
<ul>
<li>日常开发：优先 <code>scoped</code> 或 CSS Modules</li>
<li>团队协作：BEM 命名规范更易维护</li>
<li>动态样式：CSS-in-JS 更合适</li>
<li>强隔离需求：Shadow DOM 是终极方案</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Swift 协议（Protocol）指南（一）：从语法到实战]]></title>    <link>https://juejin.cn/post/7570299986530009115</link>    <guid>https://juejin.cn/post/7570299986530009115</guid>    <pubDate>2025-11-09T23:54:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570299986530009115" data-draft-id="7554003417887735842" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Swift 协议（Protocol）指南（一）：从语法到实战"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2025-11-09T23:54:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Swift 协议（Protocol）指南（一）：从语法到实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T23:54:33.000Z" title="Sun Nov 09 2025 23:54:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    19
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">基础语法：一份“合同”长什么样</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 1. 定义协议：只声明，不实现</span>
<span class="hljs-keyword">protocol</span> <span class="hljs-title class_">FullyNamed</span> {
    <span class="hljs-comment">// 只要可读，不要求可写</span>
    <span class="hljs-keyword">var</span> fullName: <span class="hljs-type">String</span> { <span class="hljs-keyword">get</span> }
}

<span class="hljs-comment">// 2. 遵守协议：编译器会强制兑现</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Person</span>: <span class="hljs-title class_">FullyNamed</span> {
    <span class="hljs-comment">// 存储属性即可满足</span>
    <span class="hljs-keyword">var</span> fullName: <span class="hljs-type">String</span>           
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Starship</span>: <span class="hljs-title class_">FullyNamed</span> {
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">prefix</span>: <span class="hljs-type">String</span>?
    <span class="hljs-keyword">var</span> name: <span class="hljs-type">String</span>
    <span class="hljs-keyword">init</span>(<span class="hljs-params">name</span>: <span class="hljs-type">String</span>, <span class="hljs-params">prefix</span>: <span class="hljs-type">String</span>? <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>) {
        <span class="hljs-keyword">self</span>.name <span class="hljs-operator">=</span> name
        <span class="hljs-keyword">self</span>.prefix <span class="hljs-operator">=</span> <span class="hljs-keyword">prefix</span>
    }
    <span class="hljs-comment">// 计算属性同样可以满足协议</span>
    <span class="hljs-keyword">var</span> fullName: <span class="hljs-type">String</span> {
        (<span class="hljs-keyword">prefix</span> <span class="hljs-operator">!=</span> <span class="hljs-literal">nil</span> <span class="hljs-operator">?</span> <span class="hljs-keyword">prefix</span><span class="hljs-operator">!</span> <span class="hljs-operator">+</span> <span class="hljs-string">" "</span> : <span class="hljs-string">""</span>) <span class="hljs-operator">+</span> name
    }
}
</code></pre>
<p>知识点小结</p>
<ul>
<li>协议不分存储/计算属性，只关心“名字+类型+读写权限”。</li>
<li>协议不能规定默认值、不能要求存储/计算属性二选一。</li>
</ul>
<h2 data-id="heading-1">方法需求与变体方法（mutating）</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Togglable</span> {
    <span class="hljs-comment">// 允许修改值类型自身</span>
    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">toggle</span>()          
}

<span class="hljs-keyword">enum</span> <span class="hljs-title class_">OnOffSwitch</span>: <span class="hljs-title class_">Togglable</span> {
    <span class="hljs-keyword">case</span> off, on
    <span class="hljs-comment">// enum 必须标记 mutating</span>
    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">toggle</span>() {        
        <span class="hljs-keyword">self</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span> <span class="hljs-operator">==</span> .off <span class="hljs-operator">?</span> .on : .off
    }
}

<span class="hljs-keyword">var</span> s <span class="hljs-operator">=</span> <span class="hljs-type">OnOffSwitch</span>.off
s.toggle() <span class="hljs-comment">// on</span>
</code></pre>
<p>Tips</p>
<ul>
<li>class 实现 mutating 方法时不需要写 <code>mutating</code>（引用类型默认可变）。</li>
<li>协议里的 <code>init</code> 需求，在 class 实现时必须写 <code>required</code>，保证子类也能履约。</li>
</ul>
<h2 data-id="heading-2">协议里的初始化器 &amp; 可失败初始化器</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">SomeProtocol</span> {
    <span class="hljs-keyword">init</span>(<span class="hljs-params">param</span>: <span class="hljs-type">Int</span>)          <span class="hljs-comment">// 非可失败</span>
    <span class="hljs-keyword">init?</span>(<span class="hljs-params">failParam</span>: <span class="hljs-type">Double</span>)  <span class="hljs-comment">// 可失败</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>: <span class="hljs-title class_">SomeProtocol</span> {
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">init</span>(<span class="hljs-params">param</span>: <span class="hljs-type">Int</span>) {}          <span class="hljs-comment">// 必须写 required</span>
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">init?</span>(<span class="hljs-params">failParam</span>: <span class="hljs-type">Double</span>) {}  <span class="hljs-comment">// 可失败版本也要 required</span>
}
</code></pre>
<h2 data-id="heading-3">协议作为类型：面向接口编程</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">let</span> things: [<span class="hljs-type">TextRepresentable</span>] <span class="hljs-operator">=</span> [game, d12, simonTheHamster]
<span class="hljs-keyword">for</span> thing <span class="hljs-keyword">in</span> things {
    <span class="hljs-built_in">print</span>(thing.textualDescription)   <span class="hljs-comment">// 统一调用，无需关心真实类型</span>
}
</code></pre>
<p>三种“协议类型”场景</p>
<ol>
<li>泛型约束 <code>&lt;T: SomeProtocol&gt;</code></li>
<li>不透明类型 <code>some SomeProtocol</code>（编译期确定，调用方看不到具体类型）</li>
<li>装箱协议类型（Existential）<code>any SomeProtocol</code>（运行时决定，有微小性能开销）</li>
</ol>
<h2 data-id="heading-4">委托（Delegation）模式实战</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 1. 定义协议（嵌套在类内部）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DiceGame</span> {
    <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> delegate: <span class="hljs-type">Delegate</span>?   <span class="hljs-comment">// 弱引用防循环引用</span>
    <span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Delegate</span>: <span class="hljs-title class_">AnyObject</span> { <span class="hljs-comment">// 类专属协议</span>
        <span class="hljs-keyword">func</span> <span class="hljs-title function_">gameDidStart</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">game</span>: <span class="hljs-type">DiceGame</span>)
        <span class="hljs-keyword">func</span> <span class="hljs-title function_">game</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">game</span>: <span class="hljs-type">DiceGame</span>, <span class="hljs-params">didEndRound</span>: <span class="hljs-type">Int</span>, <span class="hljs-params">winner</span>: <span class="hljs-type">Int</span>?)
        <span class="hljs-keyword">func</span> <span class="hljs-title function_">gameDidEnd</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">game</span>: <span class="hljs-type">DiceGame</span>)
    }
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">play</span>(<span class="hljs-params">rounds</span>: <span class="hljs-type">Int</span>) {
        (<span class="hljs-number">0</span><span class="hljs-operator">..&lt;</span>rounds).forEach { i <span class="hljs-keyword">in</span>
            delegate<span class="hljs-operator">?</span>.gameDidStart(<span class="hljs-keyword">self</span>)
            delegate<span class="hljs-operator">?</span>.game(<span class="hljs-keyword">self</span>, didEndRound: i, winner: i)
            delegate<span class="hljs-operator">?</span>.gameDidEnd(<span class="hljs-keyword">self</span>)
        }
    }
}

<span class="hljs-comment">// 2. 任何类都能当“记录员”</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DiceGameTracker</span>: <span class="hljs-title class_">DiceGame</span>.<span class="hljs-title class_">Delegate</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">gameDidStart</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">game</span>: <span class="hljs-type">DiceGame</span>) { <span class="hljs-built_in">print</span>(<span class="hljs-string">"开始新游戏"</span>) }
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">game</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">game</span>: <span class="hljs-type">DiceGame</span>, <span class="hljs-params">didEndRound</span> <span class="hljs-params">r</span>: <span class="hljs-type">Int</span>, <span class="hljs-params">winner</span>: <span class="hljs-type">Int</span>?) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"第<span class="hljs-subst">\(r)</span>轮 winner=<span class="hljs-subst">\(winner <span class="hljs-operator">??</span> <span class="hljs-number">0</span>)</span>"</span>)
    }
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">gameDidEnd</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">game</span>: <span class="hljs-type">DiceGame</span>) { <span class="hljs-built_in">print</span>(<span class="hljs-string">"游戏结束"</span>) }
}

<span class="hljs-comment">// 3. 运行</span>
<span class="hljs-keyword">let</span> game <span class="hljs-operator">=</span> <span class="hljs-type">DiceGame</span>()
<span class="hljs-keyword">let</span> gameTracker <span class="hljs-operator">=</span> <span class="hljs-type">DiceGameTracker</span>()
game.delegate <span class="hljs-operator">=</span> gameTracker
game.play(rounds: <span class="hljs-number">3</span>)
</code></pre>
<h2 data-id="heading-5">协议扩展：给协议“写实现”</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">RandomNumberGenerator</span> {}
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">RandomNumberGenerator</span> {
    <span class="hljs-comment">// 所有遵守者自动获得</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">randomBool</span>() -&gt; <span class="hljs-type">Bool</span> {          
        random() <span class="hljs-operator">&gt;</span> <span class="hljs-number">0.5</span>
    }
}

<span class="hljs-comment">// 默认实现 + where 约束</span>
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">Collection</span> <span class="hljs-title class_">where</span> <span class="hljs-title class_">Element</span>: <span class="hljs-title class_">Equatable</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">allEqual</span>() -&gt; <span class="hljs-type">Bool</span> {
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> first <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.first <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.allSatisfy { <span class="hljs-variable">$0</span> <span class="hljs-operator">==</span> first }
    }
}
</code></pre>
<p>好处</p>
<ul>
<li>避免重复代码；</li>
<li>允许“协议+约束”泛型算法；</li>
<li>提供默认实现后，类型可再自定义覆盖。</li>
</ul>
<h2 data-id="heading-6">协议继承与协议组合</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">TextRepresentable</span> {}
<span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Named</span> {
    <span class="hljs-keyword">var</span> name: <span class="hljs-type">String</span> { <span class="hljs-keyword">get</span> }
}
<span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Aged</span> {
    <span class="hljs-keyword">var</span> age: <span class="hljs-type">Int</span> { <span class="hljs-keyword">get</span> }
}
<span class="hljs-comment">// 继承TextRepresentable</span>
<span class="hljs-keyword">protocol</span> <span class="hljs-title class_">PrettyTextRepresentable</span>: <span class="hljs-title class_">TextRepresentable</span> {
    <span class="hljs-keyword">var</span> pretty: <span class="hljs-type">String</span> { <span class="hljs-keyword">get</span> }
}

<span class="hljs-keyword">func</span> <span class="hljs-title function_">birthday</span>(<span class="hljs-params">person</span>: <span class="hljs-type">Named</span> &amp; <span class="hljs-type">Aged</span>) {   <span class="hljs-comment">// 同时遵守两个协议</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Happy <span class="hljs-subst">\(person.age)</span>, <span class="hljs-subst">\(person.name)</span>!"</span>)
}
</code></pre>
<h2 data-id="heading-7">可选协议需求（仅兼容 Objective-C）</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">@objc</span> <span class="hljs-keyword">protocol</span> <span class="hljs-title class_">CounterDataSource</span> {
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">optional</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">increment</span>(<span class="hljs-params">forCount</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span>
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">optional</span> <span class="hljs-keyword">var</span> fixedInc: <span class="hljs-type">Int</span> { <span class="hljs-keyword">get</span> }
}
</code></pre>
<ul>
<li>必须 <code>@objc &amp; class</code> 才能用；</li>
<li>调用时用可选链 <code>dataSource?.increment?(forCount: 5)</code>。</li>
</ul>
<h2 data-id="heading-8">隐式合成与条件一致性</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">TextRepresentable</span> {
    <span class="hljs-keyword">var</span> textualDescription: <span class="hljs-type">String</span> { <span class="hljs-keyword">get</span> }
}

<span class="hljs-comment">// 1. 编译器自动帮你实现 Equatable / Hashable / Comparable</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Point3D</span>: <span class="hljs-title class_">Equatable</span> {          <span class="hljs-comment">// 不自己写 == 也行</span>
    <span class="hljs-keyword">var</span> x, y, z: <span class="hljs-type">Double</span>
}

<span class="hljs-comment">// 2. 条件一致性：给泛型类型“按需”加协议</span>
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">Array</span>: <span class="hljs-title class_">TextRepresentable</span> <span class="hljs-title class_">where</span> <span class="hljs-title class_">Element</span>: <span class="hljs-title class_">TextRepresentable</span> {
    <span class="hljs-keyword">var</span> textualDescription: <span class="hljs-type">String</span> {
        <span class="hljs-string">"["</span> <span class="hljs-operator">+</span> map(\.textualDescription).joined(separator: <span class="hljs-string">", "</span>) <span class="hljs-operator">+</span> <span class="hljs-string">"]"</span>
    }
}
</code></pre>
<h2 data-id="heading-9">检查与转换协议类型</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">for</span> object <span class="hljs-keyword">in</span> objects {
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> areaObj <span class="hljs-operator">=</span> object <span class="hljs-keyword">as?</span> <span class="hljs-type">HasArea</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"面积=<span class="hljs-subst">\(areaObj.area)</span>"</span>)
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"没有面积属性"</span>)
    }
}
</code></pre>
<h2 data-id="heading-10">实战技巧 &amp; 常见坑</h2>
<ol>
<li>性能：
<ul>
<li>Existential（装箱协议）有微小间接调用开销，热点代码可改泛型 <code>&lt;T: Protocol&gt;</code> 或 <code>some Protocol</code>。</li>
</ul>
</li>
<li>关联类型：
<ul>
<li>带 <code>associatedtype</code> 的协议只能当泛型约束，不能直接当变量类型（后续文章展开）。</li>
</ul>
</li>
<li>循环引用：
<ul>
<li>委托一定用 <code>weak</code> + 类专属协议 <code>: AnyObject</code>。</li>
</ul>
</li>
<li>协议粒度：
<ul>
<li>小功能拆小协议，再 <code>&amp;</code> 组合，比“胖协议”更灵活。</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[word文档转html（mammoth ）]]></title>    <link>https://juejin.cn/post/7570912420567285770</link>    <guid>https://juejin.cn/post/7570912420567285770</guid>    <pubDate>2025-11-10T09:33:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570912420567285770" data-draft-id="7570902804450344970" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="word文档转html（mammoth ）"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-10T09:33:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="耀耀切克闹灬"/> <meta itemprop="url" content="https://juejin.cn/user/1781681116679854"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            word文档转html（mammoth ）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1781681116679854/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    耀耀切克闹灬
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T09:33:56.000Z" title="Mon Nov 10 2025 09:33:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<blockquote>
<p>最近老有需要把协议Word转化为html纯预览展示的需求，为了后面方便摸鱼，用工具包脚本直接转化（手动狗头），主要使用的是 mammoth 。</p>
</blockquote>
<h2 data-id="heading-1">Word 转 HTML 工具</h2>
<p>使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmwilliamson%2Fmammoth.js" target="_blank" title="https://github.com/mwilliamson/mammoth.js" ref="nofollow noopener noreferrer">mammoth</a> 将 Word 文档转换为 HTML，特别适用于协议文档的在线预览。</p>
<h3 data-id="heading-2">安装依赖</h3>
<p>bash</p>
<pre><code class="hljs">npm install mammoth
</code></pre>
<h3 data-id="heading-3">完整代码</h3>
<p>javascript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> mammoth = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mammoth'</span>)
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getFileConfig</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> inputDir = path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'input'</span>);
  <span class="hljs-keyword">const</span> files = fs.<span class="hljs-title function_">readdirSync</span>(inputDir).<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.docx'</span>));
  <span class="hljs-keyword">return</span> files.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">inputPath</span>: path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'input'</span>,f),
      <span class="hljs-attr">outputPath</span>: path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'output'</span>, f.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'.docx'</span>, <span class="hljs-string">'.html'</span>))
    }
  });
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">transformParagraph</span>(<span class="hljs-params">element</span>) {
  <span class="hljs-keyword">let</span> styleName = <span class="hljs-string">""</span>;
  <span class="hljs-keyword">if</span> (element.<span class="hljs-property">alignment</span> === <span class="hljs-string">"center"</span>) {
    styleName = <span class="hljs-string">"text-center"</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (element.<span class="hljs-property">alignment</span> === <span class="hljs-string">"right"</span>) {
    styleName = <span class="hljs-string">"text-right"</span>;
  }
  
  <span class="hljs-keyword">return</span> {
      ...element,
      styleName
  };
}

<span class="hljs-keyword">const</span> options = {
  <span class="hljs-attr">styleMap</span>: [
    <span class="hljs-string">"p[style-name='text-center'] =&gt; p.text-center:fresh"</span>,
    <span class="hljs-string">"p[style-name='text-right'] =&gt; p.text-right:fresh"</span>,
     <span class="hljs-string">"u =&gt; span.text-underline:fresh"</span>
  ],
  <span class="hljs-attr">transformDocument</span>: mammoth.<span class="hljs-property">transforms</span>.<span class="hljs-title function_">paragraph</span>(transformParagraph)
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">convertToHtml</span> = (<span class="hljs-params">config</span>) =&gt; {
  <span class="hljs-keyword">const</span> { inputPath, outputPath } = config;
  <span class="hljs-keyword">return</span> mammoth.<span class="hljs-title function_">convertToHtml</span>({ <span class="hljs-attr">path</span>: inputPath }, options).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>){
    <span class="hljs-keyword">const</span> html = result.<span class="hljs-property">value</span>
    <span class="hljs-keyword">const</span> templatePath = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'template.html'</span>)
    <span class="hljs-keyword">const</span> tempHtml = fs.<span class="hljs-title function_">readFileSync</span>(templatePath, <span class="hljs-string">'utf8'</span>)
    <span class="hljs-keyword">const</span> insertTag = <span class="hljs-string">'&lt;div id="app"&gt;'</span>
    <span class="hljs-keyword">const</span> insertIndex = tempHtml.<span class="hljs-title function_">lastIndexOf</span>(insertTag) + insertTag.<span class="hljs-property">length</span>
    <span class="hljs-keyword">const</span> resHtml = tempHtml.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, insertIndex) + html + tempHtml.<span class="hljs-title function_">slice</span>(insertIndex)
    fs.<span class="hljs-title function_">writeFileSync</span>(outputPath, resHtml, <span class="hljs-string">'utf8'</span>)
  }).<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>){
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err);
  });
}

<span class="hljs-keyword">const</span> allFileConfig = <span class="hljs-title function_">getFileConfig</span>();
<span class="hljs-keyword">const</span> allFileConfigLength = allFileConfig.<span class="hljs-property">length</span>;
<span class="hljs-comment">// 清空 output 目录</span>
<span class="hljs-keyword">if</span> (fs.<span class="hljs-title function_">existsSync</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'output'</span>))) {
  fs.<span class="hljs-title function_">rmdirSync</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'output'</span>), { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">force</span>: <span class="hljs-literal">true</span> });
}
fs.<span class="hljs-title function_">mkdirSync</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'output'</span>));

<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`开始转换，共 <span class="hljs-subst">${allFileConfigLength}</span> 个文件`</span>);
<span class="hljs-keyword">function</span> <span class="hljs-title function_">runNext</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (index &gt;= allFileConfigLength) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'文件转换完成，请查看 output 目录'</span>);
    <span class="hljs-keyword">return</span>;
  }
  
  <span class="hljs-keyword">const</span> config = allFileConfig[index];
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>: <span class="hljs-subst">${path.basename(config.inputPath)}</span>`</span>);
  
  <span class="hljs-title function_">convertToHtml</span>(config).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    index++;
    <span class="hljs-title function_">runNext</span>();
  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Error processing file <span class="hljs-subst">${path.basename(config.inputPath)}</span>:`</span>, err);
    index++;
    <span class="hljs-title function_">runNext</span>();
  });
}

<span class="hljs-title function_">runNext</span>();




</code></pre>
<h3 data-id="heading-4">目录结构</h3>
<p>text</p>
<pre><code class="hljs language-css" lang="css">word-<span class="hljs-selector-tag">to</span>-<span class="hljs-selector-tag">html</span>/
├── <span class="hljs-selector-tag">input</span>/                 # 存放要转换的 <span class="hljs-selector-class">.docx</span> 文件
│   ├── 协议<span class="hljs-number">1</span><span class="hljs-selector-class">.docx</span>
│   └── 协议<span class="hljs-number">2</span><span class="hljs-selector-class">.docx</span>
├── output/                # 转换后的 <span class="hljs-selector-tag">HTML</span> 文件输出目录
├── template<span class="hljs-selector-class">.html</span>          # <span class="hljs-selector-tag">HTML</span> 模板文件   
├──index<span class="hljs-selector-class">.js</span>
</code></pre>
<h3 data-id="heading-5">在package.json的scripts中添加命令行脚本</h3>
<pre><code class="hljs language-js" lang="js">  <span class="hljs-string">"convert-doc"</span>: <span class="hljs-string">"node ./bin/word-to-html/index.js"</span>,
</code></pre>
<h3 data-id="heading-6">使用方法</h3>
<ol>
<li>将 Word 文档 (.docx) 放入 <code>input</code> 目录</li>
<li>运行脚本：</li>
<li>查看 <code>output</code> 目录获取转换后的 HTML 文件</li>
</ol>
<h3 data-id="heading-7">模板文件示例 (template.html)</h3>
<pre><code class="hljs language-xml" lang="xml">
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>协议文档预览<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">body</span> {
            <span class="hljs-attribute">font-family</span>: <span class="hljs-string">"Microsoft YaHei"</span>, sans-serif;
            <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.8</span>;
            <span class="hljs-attribute">max-width</span>: <span class="hljs-number">800px</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#f5f5f5</span>;
        }
        <span class="hljs-selector-id">#app</span> {
            <span class="hljs-attribute">background</span>: white;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">40px</span>;
            <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
        }
        <span class="hljs-selector-class">.text-center</span> { <span class="hljs-attribute">text-align</span>: center; }
        <span class="hljs-selector-class">.text-right</span> { <span class="hljs-attribute">text-align</span>: right; }
        <span class="hljs-selector-class">.text-underline</span> { <span class="hljs-attribute">text-decoration</span>: underline; }
        <span class="hljs-selector-tag">table</span> {
            <span class="hljs-attribute">border-collapse</span>: collapse;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">15px</span> <span class="hljs-number">0</span>;
        }
        <span class="hljs-selector-tag">table</span>, <span class="hljs-selector-tag">th</span>, <span class="hljs-selector-tag">td</span> {
            <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;
        }
        <span class="hljs-selector-tag">th</span>, <span class="hljs-selector-tag">td</span> {
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
            <span class="hljs-attribute">text-align</span>: left;
        }
        <span class="hljs-selector-tag">th</span> {
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f8f9fa</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-8">注意事项</h3>
<ul>
<li>确保 Word 文档为 .docx 格式</li>
<li>复杂表格样式可能需要额外调整</li>
<li>脚本会自动覆盖 output 目录中的现有文件</li>
<li>建议在转换前备份重要的 Word 文档</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 3 接入谷歌登录 （小白版）]]></title>    <link>https://juejin.cn/post/7571005216910376979</link>    <guid>https://juejin.cn/post/7571005216910376979</guid>    <pubDate>2025-11-11T05:56:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571005216910376979" data-draft-id="7570999443446448164" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Vue 3 接入谷歌登录 （小白版）"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2025-11-11T05:56:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端卿年"/> <meta itemprop="url" content="https://juejin.cn/user/2277843825591400"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Vue 3 接入谷歌登录 （小白版）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2277843825591400/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端卿年
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T05:56:50.000Z" title="Tue Nov 11 2025 05:56:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>本文档介绍如何在 Vue 3 项目中接入 Google OAuth 登录功能。</p>
<hr/>
<h2 data-id="heading-0">📋 前置准备</h2>
<h3 data-id="heading-1">1. 获取 Google 客户端 ID （若已有可直接跳过下面步骤直接到项目集成）</h3>
<h4 data-id="heading-2">步骤一：访问 Google Cloud Console</h4>
<p>访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.cloud.google.com%2Fapis%2Fcredentials" target="_blank" title="https://console.cloud.google.com/apis/credentials" ref="nofollow noopener noreferrer">Google Cloud Console</a></p>
<h4 data-id="heading-3">步骤二：创建项目</h4>
<ol>
<li>点击 "创建项目" 或选择现有项目</li>
<li>输入项目名称（例如：<code>testDemo</code>）</li>
<li>点击 "创建"
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e748e22787124633a9d9e2ce0f5b082f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5Y2_5bm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445553&amp;x-signature=0hhA66iyRyxpDzFXiEvEG48wfOg%3D" alt="Snipaste_2025-11-11_11-41-54.png" loading="lazy"/></li>
</ol>
<h4 data-id="heading-4">步骤四：创建 OAuth 客户端 ID</h4>
<ol>
<li>点击 "创建凭据" → "OAuth 客户端 ID".
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f50aa74553994692b4dcf03968baab61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5Y2_5bm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445553&amp;x-signature=GQ0B9FVVYk5L9w4AqnqNCKZOjvw%3D" alt="Snipaste_2025-11-11_11-43-31.png" loading="lazy"/></li>
<li>选择应用类型：<strong>Web 应用</strong></li>
<li>填写配置信息：
<ul>
<li><strong>名称</strong>：<code>xxx</code></li>
<li><strong>已获授权的 JavaScript 来源</strong>：
<ul>
<li><code>http://localhost:5173</code> （开发环境）</li>
<li><code>https://your-production-domain.com</code> （生产环境）</li>
</ul>
</li>
<li><strong>已获授权的重定向 URI</strong>：
<ul>
<li><code>http://localhost:5173</code> （开发环境）</li>
<li><code>https://your-production-domain.com/</code> （生产环境）</li>
</ul>
</li>
</ul>
</li>
<li>点击 "创建"</li>
<li>保存生成的<strong>客户端 ID</strong></li>
</ol>
<h2 data-id="heading-5"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4b73bf9c4d34b008f6042ae39c5d5f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5Y2_5bm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445553&amp;x-signature=PTAdm2kcI7P%2FvzYjJoEjaplvZsI%3D" alt="Snipaste_2025-11-11_11-44-49.png" loading="lazy"/></h2>
<h2 data-id="heading-6">🚀 项目集成</h2>
<h3 data-id="heading-7">2. 安装依赖</h3>
<pre><code class="hljs language-bash" lang="bash">pnpm add vue3-google-login
</code></pre>
<p>📚 <strong>官方文档</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevbaji.github.io%2Fvue3-google-login%2F" target="_blank" title="https://devbaji.github.io/vue3-google-login/" ref="nofollow noopener noreferrer">vue3-google-login</a></p>
<hr/>
<h3 data-id="heading-8">3. 配置插件</h3>
<p>在 <code>src/main.ts</code> 中注册插件：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-comment">// 关键代码 引入插件</span>
<span class="hljs-keyword">import</span> vue3GoogleLogin <span class="hljs-keyword">from</span> <span class="hljs-string">'vue3-google-login'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>;

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);

<span class="hljs-comment">// 关键代码 注册 Google Login 插件</span>
app.<span class="hljs-title function_">use</span>(vue3GoogleLogin, {
  <span class="hljs-attr">clientId</span>: xxxx, <span class="hljs-comment">// 这里为客户端id</span>
});

app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>);
</code></pre>
<hr/>
<h2 data-id="heading-9">💻 使用方式</h2>
<h3 data-id="heading-10">方式一：获取auth_code</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { googleAuthCodeLogin vv} from "vue3-google-login"
const login = () =&gt; {
  googleAuthCodeLogin().then((response) =&gt; {
    console.log("Handle the response", response)
  })
}
&lt;/script&gt;

&lt;template&gt;
  &lt;button @click="login"&gt;Login Using Google&lt;/button&gt;
&lt;/template&gt;
</code></pre>
<hr/>
<h3 data-id="heading-11">方式二：获取access_token</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { googleTokenLogin } from "vue3-google-login"
const login = () =&gt; {
  googleTokenLogin().then((response) =&gt; {
    console.log("Handle the response", response)
  })
}
&lt;/script&gt;

&lt;template&gt;
  &lt;button @click="login"&gt;Login Using Google&lt;/button&gt;
&lt;/template&gt;
</code></pre>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深度解析：解决 backdrop-filter 与 border-radius 的圆角漏光问题]]></title>    <link>https://juejin.cn/post/7570646659865985050</link>    <guid>https://juejin.cn/post/7570646659865985050</guid>    <pubDate>2025-11-10T06:52:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570646659865985050" data-draft-id="7570769486706458662" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深度解析：解决 backdrop-filter 与 border-radius 的圆角漏光问题"/> <meta itemprop="keywords" content="前端,JavaScript,HTML"/> <meta itemprop="datePublished" content="2025-11-10T06:52:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="_志哥_"/> <meta itemprop="url" content="https://juejin.cn/user/3474112476882071"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深度解析：解决 backdrop-filter 与 border-radius 的圆角漏光问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3474112476882071/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    _志哥_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T06:52:47.000Z" title="Mon Nov 10 2025 06:52:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    22
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">引言</h3>
<p>在现代Web开发中，<code>backdrop-filter</code> 属性为创建毛玻璃等高级视觉效果提供了强大的支持，极大地提升了用户界面的层次感和现代感。然而，当我们将它与 <code>border-radius</code> 结合使用时，一个常见的渲染问题便会浮现：圆角边缘出现不应有的“漏光”现象。本文将深入探讨该问题的根源，分析现有解决方案的局限性，并最终提供一个基于 CSS Mask 的、行之有效的终极解决方案。</p>
<h3 data-id="heading-1">问题根源：渲染层级的冲突</h3>
<p>要理解“漏光”现象，我们必须深入浏览器的渲染机制。这个问题的核心在于 <code>backdrop-filter</code> 和 <code>border-radius</code> 在渲染流水线中的工作顺序和方式存在根本性的冲突。</p>
<ol>
<li>
<p><strong><code>backdrop-filter</code> 的工作原理</strong>：<br/>
<code>backdrop-filter</code> 作用于元素背后的所有内容。它会获取这些内容，应用指定的滤镜（如 <code>blur</code>），然后将结果绘制在当前元素的背景区域。关键在于，这个模糊效果的绘制是基于元素的<strong>边界框</strong>，即一个矩形区域。</p>
</li>
<li>
<p><strong>模糊效果的“溢出”</strong> ：<br/>
模糊算法的本质是像素向周围扩散，这会导致模糊后的图像尺寸大于原始图像，形成一个“光晕”或“溢出”边缘。这个溢出部分会超出元素原始的矩形边界。</p>
</li>
<li>
<p><strong><code>border-radius</code> 的工作原理</strong>：<br/>
<code>border-radius</code> 是一个裁剪属性。它在元素的内容（包括背景、边框等）被绘制完成后，对元素自身进行几何裁剪，使其呈现圆角。</p>
</li>
<li>
<p><strong>渲染冲突点</strong>：<br/>
浏览器的渲染流程决定了 <code>backdrop-filter</code> 的模糊效果（包括其溢出的光晕）会先被完整地绘制在一个矩形区域内。随后，<code>border-radius</code> 才对这个元素进行裁剪。结果是，<code>border-radius</code> 只能裁剪元素本身的内容，却无法裁剪那个已经绘制完成、并溢出到圆角之外的模糊光晕。这便导致了我们观察到的“漏光”现象。</p>
<p>可以将其类比为：先在一块方形玻璃上喷涂了带有边缘扩散效果的油漆，然后再用圆形模具去切割这块玻璃。油漆的扩散边缘依然会从圆形轮廓外显露出来。</p>
</li>
</ol>
<h3 data-id="heading-2">常见解决方案及其局限性</h3>
<p>面对此问题，开发者通常会尝试一些标准的裁剪方法，但往往收效甚微。</p>
<p><strong>尝试方案：使用 <code>clip-path</code></strong></p>
<p>一个直观的思路是使用功能更强大的 <code>clip-path</code> 属性进行裁剪。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">clip-path</span>: <span class="hljs-built_in">inset</span>(<span class="hljs-number">0</span> round <span class="hljs-number">12px</span>);
</code></pre>
<p>然而，此方案同样无法解决问题。其根本原因与 <code>border-radius</code> 类似：<code>clip-path</code> 也在内容绘制之后生效，它无法影响已经“溢出”到元素边界之外的模糊光晕。因此，它和 <code>border-radius</code> 在这个特定场景下都面临着相同的渲染顺序限制。</p>
<h3 data-id="heading-3">终极解决方案：利用 CSS Mask 进行预裁剪</h3>
<p>既然事后裁剪无效，我们需要换一种思路：<strong>在内容绘制之前就约束其绘制区域</strong>。这正是 CSS <code>mask</code> 属性的核心能力。<code>mask</code> 不会在内容绘制后进行裁剪，而是作为一个蒙版，只有蒙版不透明的区域才会被绘制内容。</p>
<p>通过 <code>mask-image</code>，我们可以创建一个与期望圆角完全一致的蒙版，从根本上杜绝模糊效果溢出的可能。</p>
<p><strong>核心实现代码：</strong></p>
<p>该方案应应用于 <code>video</code> 元素的<strong>外层容器</strong>。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.video-container</span> {
  <span class="hljs-comment">/* ... 其他布局样式 ... */</span>

  <span class="hljs-comment">/* 核心解决方案：应用径向渐变蒙版 */</span>
  -webkit-<span class="hljs-attribute">mask-image</span>: <span class="hljs-built_in">-webkit-radial-gradient</span>(white, black);
  <span class="hljs-attribute">mask-image</span>: <span class="hljs-built_in">radial-gradient</span>(white, black);

  <span class="hljs-comment">/* 关键优化：触发硬件加速，确保蒙版效果稳定 */</span>
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateZ</span>(<span class="hljs-number">0</span>);
}
</code></pre>
<p><strong>原理解析：</strong></p>
<ol>
<li><strong><code>mask-image: radial-gradient(white, black);</code></strong><br/>
我们使用 <code>radial-gradient</code> 创建了一个从中心白色到边缘黑色的径向渐变作为蒙版。在 CSS Mask 中，渐变的透明度决定了内容的可见性：<strong>白色（不透明）部分显示内容，黑色（完全透明）部分隐藏内容</strong>。这个圆形蒙版强制浏览器只在圆角区域内渲染所有子元素和效果，包括 <code>backdrop-filter</code> 产生的模糊。任何试图溢出到蒙版之外的光晕都会被直接隐藏，从而在根源上解决了漏光问题。</li>
<li><strong><code>transform: translateZ(0);</code></strong><br/>
这是一个重要的性能和稳定性优化。该属性会触发元素的硬件加速，将其提升到一个独立的渲染层。这可以确保 <code>mask</code> 的效果被 GPU 正确、高效地合成，避免在某些复杂布局或浏览器中可能出现的渲染错位或失效问题，保证了方案的健壮性。</li>
</ol>
<h4 data-id="heading-4">完整代码示例</h4>
<p>以下是一个完整的、可直接使用的代码结构，清晰地展示了如何应用此方案。复制代码到本地，替换video的url就行：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>圆角视频播放器<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-tag">body</span> {
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">justify-content</span>: center;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100vh</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#000</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">font-family</span>: -apple-system, BlinkMacSystemFont, <span class="hljs-string">'Segoe UI'</span>, Roboto, <span class="hljs-string">'Helvetica Neue'</span>, Arial, sans-serif;
    }

    <span class="hljs-selector-class">.video-player-wrapper</span> {
      <span class="hljs-attribute">position</span>: relative;
      <span class="hljs-attribute">width</span>: <span class="hljs-number">800px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">450px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span>;
      <span class="hljs-attribute">overflow</span>: hidden;
      <span class="hljs-attribute">clip-path</span>: <span class="hljs-built_in">inset</span>(<span class="hljs-number">0</span> round <span class="hljs-number">12px</span>);
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#000</span>;
      <span class="hljs-comment">/* 强制创建合成层并尝试让圆角生效（兼容性增强） */</span>
      -webkit-<span class="hljs-attribute">mask-image</span>: <span class="hljs-built_in">-webkit-radial-gradient</span>(white, black);
      <span class="hljs-attribute">mask-image</span>: <span class="hljs-built_in">radial-gradient</span>(white, black);
      <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateZ</span>(<span class="hljs-number">0</span>);
    }

    <span class="hljs-selector-class">.video-player-wrapper</span> <span class="hljs-selector-tag">video</span><span class="hljs-selector-class">.video-element</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">object-fit</span>: cover;
      <span class="hljs-attribute">display</span>: block;
    }

    <span class="hljs-selector-class">.video-title</span> {
      <span class="hljs-attribute">position</span>: absolute;
      <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">28px</span>;
      <span class="hljs-attribute">color</span>: white;
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
      <span class="hljs-attribute">line-height</span>: <span class="hljs-number">28px</span>;
      <span class="hljs-attribute">padding-left</span>: <span class="hljs-number">12px</span>;
      <span class="hljs-attribute">box-sizing</span>: border-box;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>);
      -webkit-backdrop-<span class="hljs-attribute">filter</span>: <span class="hljs-built_in">blur</span>(<span class="hljs-number">20px</span>);
      backdrop-<span class="hljs-attribute">filter</span>: <span class="hljs-built_in">blur</span>(<span class="hljs-number">20px</span>);
      <span class="hljs-attribute">overflow</span>: hidden;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"video-player-wrapper"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"video-element"</span> <span class="hljs-attr">controls</span> <span class="hljs-attr">autoplay</span> <span class="hljs-attr">muted</span> <span class="hljs-attr">loop</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"xxx.mp4"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"video-title"</span>&gt;</span>
      我是video标题
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-5">结案陈词</h3>
<p>看，再顽固的渲染BUG，也敌不过我们对底层原理的理解和一点点“骚操作”的智慧。从理解渲染顺序的“先斩后奏”，到放弃无效的 <code>clip-path</code>，最后用 <code>mask-image</code> 实现降维打击，整个过程就像一场精彩的侦探推理。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uniapp之WebView容器原理详解]]></title>    <link>https://juejin.cn/post/7570866247979728948</link>    <guid>https://juejin.cn/post/7570866247979728948</guid>    <pubDate>2025-11-10T08:30:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570866247979728948" data-draft-id="7570866247979712564" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uniapp之WebView容器原理详解"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-10T08:30:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端一课"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uniapp之WebView容器原理详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端一课
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T08:30:57.000Z" title="Mon Nov 10 2025 08:30:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    29
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style>
<h2 data-id="heading-0">UniApp WebView容器原理详解</h2>
<h3 data-id="heading-1">一、WebView容器概述</h3>
<p>UniApp之所以能够实现跨平台开发，其核心原理是"uniapp 主要是运行在webview容器中的"。这句话揭示了UniApp的底层架构：它本质上是一个基于WebView的混合应用框架。</p>
<h4 data-id="heading-2">1.1 什么是WebView容器</h4>
<p>WebView是一种系统组件，可以嵌入到原生应用中，用于显示网页内容。它本质上是一个迷你浏览器，提供了网页渲染、JavaScript执行环境以及与原生功能的桥接能力。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// WebView的基本结构（概念图）</span>
+---------------------------+
|      原生应用外壳         |
|  +---------------------+  |
|  |                     |  |
|  |    <span class="hljs-title class_">WebView</span>容器      |  |
|  |                     |  |
|  |  +---------------+  |  |
|  |  |   <span class="hljs-variable constant_">HTML</span>/<span class="hljs-variable constant_">CSS</span>/<span class="hljs-variable constant_">JS</span> |  |  |
|  |  +---------------+  |  |
|  |                     |  |
|  +---------------------+  |
|                           |
+---------------------------+
</code></pre>
<h4 data-id="heading-3">1.2 UniApp与WebView的关系</h4>
<p>UniApp利用WebView作为运行环境，将Vue代码编译成可在WebView中运行的HTML/CSS/JavaScript代码，然后通过原生外壳包装成跨平台应用。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// UniApp应用架构（概念图）</span>
+------------------------------------------------------+
|                  <span class="hljs-title class_">UniApp</span>应用                          |
|  +----------------+  +----------------+  +---------+ |
|  |   <span class="hljs-title class_">Android</span>外壳  |  |    iOS外壳     |  | <span class="hljs-variable constant_">H5</span>外壳  | |
|  |                |  |                |  |         | |
|  |  +----------+  |  |  +----------+  |  |  浏览器  | |
|  |  | <span class="hljs-title class_">WebView</span>  |  |  |  | <span class="hljs-title class_">WebView</span>  |  |  |         | |
|  |  +----------+  |  |  +----------+  |  |         | |
|  |       |         |  |       |         |  |         | |
|  |  +----------+  |  |  +----------+  |  |         | |
|  |  | <span class="hljs-title class_">UniApp</span>   |  |  |  | <span class="hljs-title class_">UniApp</span>   |  |  |  <span class="hljs-title class_">UniApp</span> | |
|  |  | 运行时   |  |  |  | 运行时   |  |  |  运行时 | |
|  |  +----------+  |  |  +----------+  |  |         | |
|  +----------------+  +----------------+  +---------+ |
+------------------------------------------------------+
</code></pre>
<h3 data-id="heading-4">二、WebView容器的工作原理</h3>
<h4 data-id="heading-5">2.1 渲染机制</h4>
<p>UniApp在WebView容器中的渲染过程如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// UniApp渲染流程（伪代码）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderUniApp</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 1. Vue模板编译</span>
  <span class="hljs-keyword">const</span> template = <span class="hljs-title function_">compileVueTemplate</span>();
  
  <span class="hljs-comment">// 2. 生成虚拟DOM</span>
  <span class="hljs-keyword">const</span> vdom = <span class="hljs-title function_">createVirtualDOM</span>(template);
  
  <span class="hljs-comment">// 3. 转换为真实DOM</span>
  <span class="hljs-keyword">const</span> dom = <span class="hljs-title function_">createRealDOM</span>(vdom);
  
  <span class="hljs-comment">// 4. WebView渲染DOM</span>
  webView.<span class="hljs-title function_">render</span>(dom);
  
  <span class="hljs-comment">// 5. 应用样式</span>
  <span class="hljs-title function_">applyCSSStyles</span>();
}
</code></pre>
<h4 data-id="heading-6">2.2 JavaScript执行环境</h4>
<p>UniApp的JavaScript代码在WebView的JavaScript引擎中执行，不同平台使用不同的引擎：</p>
<ul>
<li><strong>Android</strong>: 通常使用V8引擎</li>
<li><strong>iOS</strong>: 使用JavaScriptCore</li>
<li><strong>H5</strong>: 使用浏览器的JavaScript引擎</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// UniApp JavaScript执行环境（概念图）</span>
+---------------------------+
|      <span class="hljs-title class_">WebView</span>容器         |
|                           |
|  +---------------------+  |
|  |  <span class="hljs-title class_">JavaScript</span>引擎      |  |
|  |                     |  |
|  |  +-----------------+ |  |
|  |  |   <span class="hljs-title class_">UniApp</span>框架    | |  |
|  |  |                 | |  |
|  |  |  +-------------+ | |  |
|  |  |  |   <span class="hljs-title class_">Vue</span>代码   | | |  |
|  |  |  +-------------+ | |  |
|  |  |                 | |  |
|  |  |  +-------------+ | |  |
|  |  |  |   <span class="hljs-variable constant_">API</span>桥接   | | |  |
|  |  |  +-------------+ | |  |
|  |  +-----------------+ |  |
|  +---------------------+  |
+---------------------------+
</code></pre>
<h4 data-id="heading-7">2.3 原生能力桥接</h4>
<p>UniApp通过桥接机制实现JavaScript与原生功能的交互：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// UniApp原生桥接机制（简化版）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UniBridge</span> {
  <span class="hljs-comment">// 调用原生功能</span>
  <span class="hljs-title function_">callNative</span>(<span class="hljs-params">api, params, callback</span>) {
    <span class="hljs-comment">// 1. 将调用参数序列化</span>
    <span class="hljs-keyword">const</span> message = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
      <span class="hljs-attr">api</span>: api,
      <span class="hljs-attr">params</span>: params,
      <span class="hljs-attr">callbackId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generateCallbackId</span>()
    });
    
    <span class="hljs-comment">// 2. 通过WebView接口发送消息到原生</span>
    <span class="hljs-keyword">if</span> (isAndroid) {
      androidInterface.<span class="hljs-title function_">postMessage</span>(message);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isIOS) {
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">webkit</span>.<span class="hljs-property">messageHandlers</span>.<span class="hljs-property">iosInterface</span>.<span class="hljs-title function_">postMessage</span>(message);
    }
    
    <span class="hljs-comment">// 3. 注册回调函数</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">registerCallback</span>(callbackId, callback);
  }
  
  <span class="hljs-comment">// 接收原生回调</span>
  <span class="hljs-title function_">onNativeCallback</span>(<span class="hljs-params">callbackId, result</span>) {
    <span class="hljs-keyword">const</span> callback = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCallback</span>(callbackId);
    <span class="hljs-keyword">if</span> (callback) {
      <span class="hljs-title function_">callback</span>(result);
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">unregisterCallback</span>(callbackId);
    }
  }
}
</code></pre>
<h3 data-id="heading-8">三、WebView容器的优势</h3>
<h4 data-id="heading-9">3.1 跨平台能力</h4>
<p>WebView容器是所有现代移动操作系统都提供的标准组件，这使得UniApp能够实现真正的"一次开发，多端运行"。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 跨平台代码示例</span>
<span class="hljs-comment">// 这段代码可以在Android、iOS和H5环境中运行</span>
uni.<span class="hljs-title function_">showToast</span>({
  <span class="hljs-attr">title</span>: <span class="hljs-string">'提示信息'</span>,
  <span class="hljs-attr">icon</span>: <span class="hljs-string">'none'</span>,
  <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span>
});

<span class="hljs-comment">// UniApp编译后的代码（简化版）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">showToast</span>(<span class="hljs-params">options</span>) {
  <span class="hljs-comment">// 根据平台调用不同的实现</span>
  <span class="hljs-keyword">if</span> (platform === <span class="hljs-string">'android'</span>) {
    <span class="hljs-comment">// 通过桥接调用Android原生Toast</span>
    <span class="hljs-title class_">UniBridge</span>.<span class="hljs-title function_">callNative</span>(<span class="hljs-string">'showToast'</span>, options);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (platform === <span class="hljs-string">'ios'</span>) {
    <span class="hljs-comment">// 通过桥接调用iOS原生Toast</span>
    <span class="hljs-title class_">UniBridge</span>.<span class="hljs-title function_">callNative</span>(<span class="hljs-string">'showToast'</span>, options);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// H5环境使用Web实现</span>
    <span class="hljs-keyword">const</span> toast = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
    toast.<span class="hljs-property">textContent</span> = options.<span class="hljs-property">title</span>;
    toast.<span class="hljs-property">className</span> = <span class="hljs-string">'uni-toast'</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(toast);
    
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(toast);
    }, options.<span class="hljs-property">duration</span>);
  }
}
</code></pre>
<h4 data-id="heading-10">3.2 开发效率</h4>
<p>基于WebView的开发模式允许开发者使用Web技术栈，大大提高了开发效率：</p>
<ul>
<li><strong>熟悉的开发语言</strong>: HTML/CSS/JavaScript</li>
<li><strong>丰富的生态系统</strong>: NPM包、前端框架等</li>
<li><strong>热更新能力</strong>: 无需重新安装应用即可更新代码</li>
<li><strong>调试便利</strong>: 可以使用浏览器开发者工具进行调试</li>
</ul>
<h4 data-id="heading-11">3.3 成本优势</h4>
<ul>
<li><strong>人力成本</strong>: 一套代码多端运行，减少开发人员数量</li>
<li><strong>时间成本</strong>: 同时发布到多个平台，缩短开发周期</li>
<li><strong>维护成本</strong>: 统一代码库，降低维护复杂度</li>
</ul>
<h3 data-id="heading-12">四、WebView容器的局限性</h3>
<h4 data-id="heading-13">4.1 性能限制</h4>
<p>WebView容器的性能相比原生应用有一定差距：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 性能对比（概念数据）</span>
<span class="hljs-keyword">const</span> performanceComparison = {
  <span class="hljs-string">'原生应用'</span>: {
    <span class="hljs-string">'启动速度'</span>: <span class="hljs-string">'100%'</span>,
    <span class="hljs-string">'渲染性能'</span>: <span class="hljs-string">'100%'</span>,
    <span class="hljs-string">'内存占用'</span>: <span class="hljs-string">'100%'</span>,
    <span class="hljs-string">'CPU使用'</span>: <span class="hljs-string">'100%'</span>
  },
  <span class="hljs-string">'WebView应用'</span>: {
    <span class="hljs-string">'启动速度'</span>: <span class="hljs-string">'70-80%'</span>,
    <span class="hljs-string">'渲染性能'</span>: <span class="hljs-string">'60-80%'</span>,
    <span class="hljs-string">'内存占用'</span>: <span class="hljs-string">'120-150%'</span>,
    <span class="hljs-string">'CPU使用'</span>: <span class="hljs-string">'110-130%'</span>
  }
};
</code></pre>
<h4 data-id="heading-14">4.2 功能限制</h4>
<p>某些原生功能在WebView中难以实现或性能不佳：</p>
<ul>
<li><strong>复杂动画</strong>: CSS动画和JavaScript动画性能不如原生动画</li>
<li><strong>大量数据处理</strong>: JavaScript处理大数据的能力有限</li>
<li><strong>图形渲染</strong>: 复杂图形和游戏渲染性能不足</li>
<li><strong>后台任务</strong>: WebView在后台时执行能力受限</li>
</ul>
<h4 data-id="heading-15">4.3 平台差异</h4>
<p>尽管WebView是标准组件，但不同平台的实现仍有差异：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 平台差异示例</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handlePlatformDifferences</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// Android WebView特有问题</span>
  <span class="hljs-keyword">if</span> (isAndroid) {
    <span class="hljs-comment">// 处理Android WebView的兼容性问题</span>
    <span class="hljs-title function_">fixAndroidWebViewIssues</span>();
  }
  
  <span class="hljs-comment">// iOS WebView特有问题</span>
  <span class="hljs-keyword">if</span> (isIOS) {
    <span class="hljs-comment">// 处理iOS WebView的兼容性问题</span>
    <span class="hljs-title function_">fixIOSWebViewIssues</span>();
  }
  
  <span class="hljs-comment">// 不同版本的WebView也有差异</span>
  <span class="hljs-title function_">handleWebViewVersionDifferences</span>();
}
</code></pre>
<h3 data-id="heading-16">五、UniApp对WebView容器的优化</h3>
<h4 data-id="heading-17">5.1 渲染优化</h4>
<p>UniApp通过多种方式优化WebView的渲染性能：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 渲染优化策略</span>
<span class="hljs-keyword">const</span> renderingOptimizations = {
  <span class="hljs-comment">// 1. 虚拟列表</span>
  <span class="hljs-attr">virtualList</span>: {
    <span class="hljs-attr">description</span>: <span class="hljs-string">'只渲染可视区域内的元素'</span>,
    <span class="hljs-attr">implementation</span>: <span class="hljs-string">'使用uni-list组件实现虚拟滚动'</span>
  },
  
  <span class="hljs-comment">// 2. 懒加载</span>
  <span class="hljs-attr">lazyLoading</span>: {
    <span class="hljs-attr">description</span>: <span class="hljs-string">'延迟加载非关键资源'</span>,
    <span class="hljs-attr">implementation</span>: <span class="hljs-string">'使用uni.lazyLoad图片懒加载'</span>
  },
  
  <span class="hljs-comment">// 3. 减少重排重绘</span>
  <span class="hljs-attr">reduceReflow</span>: {
    <span class="hljs-attr">description</span>: <span class="hljs-string">'批量更新DOM，减少重排重绘'</span>,
    <span class="hljs-attr">implementation</span>: <span class="hljs-string">'使用setData批量更新数据'</span>
  },
  
  <span class="hljs-comment">// 4. CSS优化</span>
  <span class="hljs-attr">cssOptimization</span>: {
    <span class="hljs-attr">description</span>: <span class="hljs-string">'使用高效的CSS选择器和属性'</span>,
    <span class="hljs-attr">implementation</span>: <span class="hljs-string">'避免复杂选择器，使用transform和opacity'</span>
  }
};
</code></pre>
<h4 data-id="heading-18">5.2 内存管理</h4>
<p>针对WebView内存占用高的问题，UniApp提供了多种优化方案：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 内存管理优化</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">optimizeMemoryUsage</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 1. 及时释放资源</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">cleanupResources</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 清理不再使用的对象</span>
    unusedObjects = <span class="hljs-literal">null</span>;
    
    <span class="hljs-comment">// 取消未完成的网络请求</span>
    <span class="hljs-title function_">cancelPendingRequests</span>();
    
    <span class="hljs-comment">// 移除事件监听器</span>
    <span class="hljs-title function_">removeEventListeners</span>();
  }
  
  <span class="hljs-comment">// 2. 图片内存优化</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">optimizeImageMemory</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 使用适当的图片格式和尺寸</span>
    <span class="hljs-title function_">useOptimizedImageFormat</span>();
    
    <span class="hljs-comment">// 及时释放图片资源</span>
    <span class="hljs-title function_">releaseImageResources</span>();
  }
  
  <span class="hljs-comment">// 3. 数据缓存优化</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">optimizeDataCache</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 限制缓存大小</span>
    <span class="hljs-title function_">limitCacheSize</span>();
    
    <span class="hljs-comment">// 使用LRU缓存策略</span>
    <span class="hljs-title function_">implementLRUCache</span>();
  }
}
</code></pre>
<h4 data-id="heading-19">5.3 原生能力增强</h4>
<p>UniApp通过原生插件机制弥补WebView的功能限制：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 原生插件机制（概念图）</span>
+------------------------------------------------------+
|                  <span class="hljs-title class_">UniApp</span>应用                          |
|  +----------------+  +----------------+  +---------+ |
|  |   <span class="hljs-title class_">Android</span>外壳  |  |    iOS外壳     |  | <span class="hljs-variable constant_">H5</span>外壳  | |
|  |                |  |                |  |         | |
|  |  +----------+  |  |  +----------+  |  |  浏览器  | |
|  |  | <span class="hljs-title class_">WebView</span>  |  |  |  | <span class="hljs-title class_">WebView</span>  |  |  |         | |
|  |  +----------+  |  |  +----------+  |  |         | |
|  |       |         |  |       |         |  |         | |
|  |  +----------+  |  |  +----------+  |  |         | |
|  |  | <span class="hljs-title class_">UniApp</span>   |  |  |  | <span class="hljs-title class_">UniApp</span>   |  |  |  <span class="hljs-title class_">UniApp</span> | |
|  |  | 运行时   |  |  |  | 运行时   |  |  |  运行时 | |
|  |  +----+-----+  |  |  +----+-----+  |  |         | |
|  |       |         |  |       |         |  |         | |
|  |  +----v-----+  |  |  +----v-----+  |  |         | |
|  |  | 原生插件  |  |  |  | 原生插件  |  |  |         | |
|  |  +----------+  |  |  +----------+  |  |         | |
|  +----------------+  +----------------+  +---------+ |
+------------------------------------------------------+
</code></pre>
<h3 data-id="heading-20">六、总结</h3>
<p>"uniapp 主要是运行在webview容器中的"这句话揭示了UniApp的核心架构原理。通过WebView容器，UniApp实现了跨平台能力，使开发者能够使用Web技术栈开发移动应用。这种架构既有优势（跨平台、开发效率高、成本低），也有局限性（性能限制、功能限制、平台差异）。</p>
<p>UniApp通过渲染优化、内存管理和原生插件等方式，不断弥补WebView容器的不足，提升应用性能和用户体验。理解WebView容器的工作原理，有助于开发者更好地使用UniApp框架，开发出高质量的跨平台应用。</p>
<p>对于物流元宇宙PDA项目这样的应用，理解WebView容器的原理尤为重要，因为PDA设备通常资源有限，需要特别关注内存占用和性能优化。通过合理使用UniApp提供的优化方案，可以在WebView容器中实现流畅的用户体验，同时保持跨平台的优势。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从字符串满天飞到优雅枚举：JavaScript 常量管理的几种姿势]]></title>    <link>https://juejin.cn/post/7570598043298611263</link>    <guid>https://juejin.cn/post/7570598043298611263</guid>    <pubDate>2025-11-10T09:43:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570598043298611263" data-draft-id="7570896170920837183" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从字符串满天飞到优雅枚举：JavaScript 常量管理的几种姿势"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-10T09:43:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从字符串满天飞到优雅枚举：JavaScript 常量管理的几种姿势
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T09:43:34.000Z" title="Mon Nov 10 2025 09:43:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>重构老项目的时候，看到代码里到处都是这样的判断：</p>
<pre><code class="hljs language-ini" lang="ini">if (<span class="hljs-attr">status</span> === <span class="hljs-string">'pending'</span>) { }
if (<span class="hljs-attr">status</span> === <span class="hljs-string">'processing'</span>) { }
if (<span class="hljs-attr">orderStatus</span> === <span class="hljs-string">'pending'</span>) { }  // 等等，这个 pending 跟上面那个一样吗？
</code></pre>
<p>字符串满天飞，每次都要小心翼翼地打字，生怕打错一个字母。想用枚举来管理这些常量，但 JavaScript 又没有原生的 <code>enum</code> 关键字。</p>
<p>网上搜了一圈，发现大家的做法五花八门：</p>
<ul>
<li>有人用普通对象：<code>const Status = { PENDING: 'pending' }</code></li>
<li>有人用 <code>Object.freeze()</code>：<code>const Status = Object.freeze({ PENDING: 'pending' })</code></li>
<li>还有人干脆直接用字符串，说"够用就行"</li>
</ul>
<p>那到底哪种方式好？有没有更优雅的写法？</p>
<p>最近看到 Dr. Axel Rauschmayer 的一篇文章，介绍了用 Proxy 实现枚举的技巧。虽然他明确说这是个教学示例，不建议直接用在生产环境，但这个思路确实挺巧妙，能帮我们更好地理解 Proxy 和解构赋值的工作原理。</p>
<h2 data-id="heading-0">为什么 JavaScript 需要枚举？</h2>
<h3 data-id="heading-1">字符串常量的问题</h3>
<p>直接用字符串当常量，问题不少：</p>
<pre><code class="hljs language-scss" lang="scss">function <span class="hljs-built_in">updateOrder</span>(status) {
  if (status === 'shiped') {  <span class="hljs-comment">// 拼错了！应该是 shipped</span>
    <span class="hljs-comment">// ...</span>
  }
}
​
<span class="hljs-built_in">updateOrder</span>('shipped');  <span class="hljs-comment">// 运行时才发现不匹配</span>
</code></pre>
<p>JavaScript 是弱类型语言，拼错字符串编辑器不会报错，只能在运行时才发现问题。而且满屏的字符串字面量，维护起来真的头疼。</p>
<h3 data-id="heading-2">魔法数字更糟糕</h3>
<p>有些老代码喜欢用数字：</p>
<pre><code class="hljs language-scss" lang="scss">if (userLevel === <span class="hljs-number">3</span>) {  <span class="hljs-comment">// 3 是什么意思？</span>
  <span class="hljs-comment">// ...</span>
}
​
if (priority === <span class="hljs-number">3</span>) {  <span class="hljs-comment">// 这个 3 又是什么意思？</span>
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>半年后回头看代码，鬼知道这个 <code>3</code> 代表什么。</p>
<p>问题的根源在于：<strong>JavaScript 缺少一种原生的、类型安全的方式来定义常量集合</strong>。</p>
<h2 data-id="heading-3">常见的枚举实现方式</h2>
<h3 data-id="heading-4">方式 1：普通对象</h3>
<p>最简单的做法：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> OrderStatus = {
  PENDING: <span class="hljs-string">'pending'</span>,
  PROCESSING: <span class="hljs-string">'processing'</span>,
  SHIPPED: <span class="hljs-string">'shipped'</span>,
  DELIVERED: <span class="hljs-string">'delivered'</span>
};
​
<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">if</span> (order.status === OrderStatus.SHIPPED) {
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>这种方式的问题是，对象属性可以被修改：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">OrderStatus.PENDING</span> = <span class="hljs-string">'xxx'</span><span class="hljs-comment">;  // 能改，但不应该改</span>
<span class="hljs-attr">OrderStatus.CANCELLED</span> = <span class="hljs-string">'cancelled'</span><span class="hljs-comment">;  // 能加新属性</span>
</code></pre>
<h3 data-id="heading-5">方式 2：Object.freeze()</h3>
<p>冻结对象，防止修改：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">OrderStatus</span> = Object.<span class="hljs-title function_ invoke__">freeze</span>({
 <span class="hljs-attr"> PENDING</span>: <span class="hljs-string">'pending'</span>,
 <span class="hljs-attr"> PROCESSING</span>: <span class="hljs-string">'processing'</span>,
 <span class="hljs-attr"> SHIPPED</span>: <span class="hljs-string">'shipped'</span>,
 <span class="hljs-attr"> DELIVERED</span>: <span class="hljs-string">'delivered'</span>
});
​
OrderStatus.PENDING = <span class="hljs-string">'xxx'</span>;  <span class="hljs-comment">// 严格模式下报错</span>
</code></pre>
<p>这个方式好一些，但每次都要写 <code>PENDING: 'pending'</code> 这种重复的键值对，有点啰嗦。特别是当枚举值就是字段名的小写形式时，这种重复更明显。</p>
<h3 data-id="heading-6">方式 3：TypeScript 的 enum</h3>
<p>如果用 TypeScript，有两种枚举方式：</p>
<p><strong>数字枚举</strong>（默认）：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">MyEnum</span> { 
  foo,    <span class="hljs-comment">// 0</span>
  bar,    <span class="hljs-comment">// 1</span>
  baz     <span class="hljs-comment">// 2</span>
}
​
console.<span class="hljs-built_in">log</span>(MyEnum.foo);  <span class="hljs-comment">// 0</span>
console.<span class="hljs-built_in">log</span>(MyEnum.bar);  <span class="hljs-comment">// 1</span>
</code></pre>
<p>这种方式和很多编程语言（C、Java）的枚举类似，但调试起来不太直观——看到数字 <code>0</code> 你得想一下它代表什么。</p>
<p><strong>字符串枚举</strong>（推荐）：</p>
<pre><code class="hljs language-ini" lang="ini">enum OrderStatus {
  <span class="hljs-attr">PENDING</span> = <span class="hljs-string">'pending'</span>,
  <span class="hljs-attr">PROCESSING</span> = <span class="hljs-string">'processing'</span>,
  <span class="hljs-attr">SHIPPED</span> = <span class="hljs-string">'shipped'</span>,
  <span class="hljs-attr">DELIVERED</span> = <span class="hljs-string">'delivered'</span>
}
​
console.log(OrderStatus.PENDING)<span class="hljs-comment">;  // 'pending' - 一眼就能看懂</span>
</code></pre>
<p>字符串枚举的好处是调试时能直接看到有意义的值，不用去查数字对应什么。但这需要 TypeScript 环境，纯 JavaScript 项目怎么办？</p>
<h2 data-id="heading-7">用 Proxy 实现的巧妙方案</h2>
<p>这里有个挺有意思的技巧，用 Proxy 可以让枚举定义变得更简洁。理解这个技巧需要先了解两个关键点。</p>
<h3 data-id="heading-8">关键点 1：Proxy 拦截器</h3>
<p>核心思路是：创建一个特殊的对象，读取它的任何属性时，都返回属性名本身。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> keyProxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>({}, {
  <span class="hljs-title function_">get</span>(<span class="hljs-params">_target, propKey, _receiver</span>) {
    <span class="hljs-keyword">return</span> propKey;
  }
});
​
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(keyProxy.<span class="hljs-property">foo</span>);    <span class="hljs-comment">// 'foo'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(keyProxy.<span class="hljs-property">bar</span>);    <span class="hljs-comment">// 'bar'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(keyProxy.<span class="hljs-property">hello</span>);  <span class="hljs-comment">// 'hello'</span>
</code></pre>
<p>看到了吗？不管你访问什么属性，都能得到属性名的字符串。</p>
<h3 data-id="heading-9">关键点 2：解构赋值的属性简写</h3>
<p>接下来，配合 ES6 的解构赋值：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> { PENDING, PROCESSING, SHIPPED, DELIVERED } = keyProxy;
​
console.<span class="hljs-built_in">log</span>(PENDING);     <span class="hljs-comment">// 'PENDING'</span>
console.<span class="hljs-built_in">log</span>(PROCESSING);  <span class="hljs-comment">// 'PROCESSING'</span>
console.<span class="hljs-built_in">log</span>(SHIPPED);     <span class="hljs-comment">// 'SHIPPED'</span>
</code></pre>
<p>这里利用了解构赋值的<strong>属性简写</strong>（property value shorthand）特性。</p>
<p>写 <code>{ foo }</code> 其实是 <code>{ foo: foo }</code> 的简写。这两种写法是<strong>完全等价的</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 简写形式</span>
<span class="hljs-type">const</span> { foo, bar, baz } = keyProxy;
​
<span class="hljs-comment">// 完整形式（等价）</span>
<span class="hljs-type">const</span> { foo: foo, bar: bar, baz: baz } = keyProxy;
</code></pre>
<p>意思是：</p>
<ul>
<li>从 <code>keyProxy</code> 对象中读取 <code>foo</code> 属性</li>
<li>把读到的值赋给变量 <code>foo</code></li>
</ul>
<p>所以上面的代码实际执行的是：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">PENDING</span> = keyProxy.PENDING<span class="hljs-comment">;      // 'PENDING'</span>
const <span class="hljs-attr">PROCESSING</span> = keyProxy.PROCESSING<span class="hljs-comment">; // 'PROCESSING'</span>
const <span class="hljs-attr">SHIPPED</span> = keyProxy.SHIPPED<span class="hljs-comment">;      // 'SHIPPED'</span>
</code></pre>
<p><strong>两个要素结合</strong>就产生了这个效果：</p>
<ol>
<li>Proxy 让属性访问返回属性名</li>
<li>解构赋值让我们同时定义多个常量</li>
</ol>
<p>一行代码搞定所有枚举值的定义。</p>
<h3 data-id="heading-10">实际使用</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 定义枚举</span>
const { PENDING, PROCESSING, SHIPPED, DELIVERED } = keyProxy;
​
<span class="hljs-comment">// 使用</span>
function <span class="hljs-built_in">updateOrder</span>(status) {
  if (status === SHIPPED) {
    console<span class="hljs-selector-class">.log</span>('订单已发货');
  }
}
​
<span class="hljs-built_in">updateOrder</span>(SHIPPED);
</code></pre>
<p>看起来是不是简洁多了？不用重复写键值对，也不用每次都写 <code>Status.PENDING</code> 这样的前缀。</p>
<h2 data-id="heading-11">进阶：用 Symbol 提高类型安全</h2>
<p>如果想要更强的类型安全性，可以把字符串换成 Symbol。</p>
<p>切换到 Symbol 版本只需要改动一行代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> symbolProxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>({}, {
  <span class="hljs-title function_">get</span>(<span class="hljs-params">_target, propKey, _receiver</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Symbol</span>(propKey);  <span class="hljs-comment">// 只改这一行</span>
  }
});
​
<span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">PENDING</span>, <span class="hljs-variable constant_">PROCESSING</span>, <span class="hljs-variable constant_">SHIPPED</span> } = symbolProxy;
​
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> <span class="hljs-variable constant_">PENDING</span>);  <span class="hljs-comment">// 'symbol'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">String</span>(<span class="hljs-variable constant_">PENDING</span>)); <span class="hljs-comment">// 'Symbol(PENDING)'</span>
</code></pre>
<p>其他代码完全不用动，只是把返回值从字符串改成 Symbol。</p>
<h3 data-id="heading-12">Symbol 的好处</h3>
<p><strong>防止误用字符串</strong>：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 用字符串的情况</span>
const { PENDING } = keyProxy;
<span class="hljs-built_in">updateOrder</span>('PENDING');  <span class="hljs-comment">// 能工作，但可能不是你想要的</span>
<span class="hljs-built_in">updateOrder</span>(PENDING);    <span class="hljs-comment">// 也能工作</span>
​
<span class="hljs-comment">// 用 Symbol 的情况</span>
const { PENDING } = symbolProxy;
<span class="hljs-built_in">updateOrder</span>('PENDING');  <span class="hljs-comment">// 不会匹配，因为类型不对</span>
<span class="hljs-built_in">updateOrder</span>(PENDING);    <span class="hljs-comment">// 只有这个才能匹配</span>
</code></pre>
<p>Symbol 是唯一的，即使描述相同，两个 Symbol 也不相等：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'foo'</span>) === <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'foo'</span>)  <span class="hljs-comment">// false</span>
</code></pre>
<p>所以用 Symbol 做枚举值，基本不可能出现误匹配的情况。</p>
<p><strong>更好的调试体验</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino">console.<span class="hljs-built_in">log</span>(PENDING);  <span class="hljs-comment">// Symbol(PENDING) - 一眼就能看出是什么</span>
</code></pre>
<h2 data-id="heading-13">这个方案的优缺点</h2>
<h3 data-id="heading-14">优势</h3>
<p><strong>简洁</strong>：</p>
<ul>
<li>不用重复写键值对</li>
<li>一行代码搞定所有常量定义</li>
</ul>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 传统方式</span>
<span class="hljs-type">const</span> Status = {
  PENDING: <span class="hljs-string">'PENDING'</span>,
  PROCESSING: <span class="hljs-string">'PROCESSING'</span>,
  SHIPPED: <span class="hljs-string">'SHIPPED'</span>,
  DELIVERED: <span class="hljs-string">'DELIVERED'</span>
};
​
<span class="hljs-comment">// Proxy 方式</span>
<span class="hljs-type">const</span> { PENDING, PROCESSING, SHIPPED, DELIVERED } = keyProxy;
</code></pre>
<p><strong>灵活</strong>：</p>
<ul>
<li>想要字符串就用字符串版本的 Proxy</li>
<li>想要 Symbol 就用 Symbol 版本的 Proxy</li>
<li>随用随取，不需要预先定义所有常量</li>
</ul>
<h3 data-id="heading-15">缺点</h3>
<p><strong>理解成本</strong>：</p>
<p>这个技巧本质上是个教学示例，主要用来展示 Proxy 和解构赋值的灵活性。对于不熟悉这些特性的同事来说，代码可能不够直观。</p>
<p><strong>没有命名空间</strong>：</p>
<p>传统方式的枚举有明确的命名空间：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">OrderStatus</span> = { PENDING: <span class="hljs-string">'pending'</span> }<span class="hljs-comment">;</span>
const <span class="hljs-attr">UserStatus</span> = { PENDING: <span class="hljs-string">'pending'</span> }<span class="hljs-comment">;</span>
​
// 两个 PENDING 不会混淆
</code></pre>
<p>但 Proxy 方式定义的常量是独立的变量：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> { PENDING: OrderPending } = keyProxy;
<span class="hljs-type">const</span> { PENDING: UserPending } = keyProxy;
​
<span class="hljs-comment">// 需要手动区分变量名</span>
</code></pre>
<p><strong>IDE 支持有限</strong>：</p>
<p>传统对象方式，IDE 能提示你有哪些可用的枚举值：</p>
<pre><code class="hljs language-arduino" lang="arduino">OrderStatus.  <span class="hljs-comment">// IDE 会列出 PENDING, PROCESSING 等</span>
</code></pre>
<p>但 Proxy 方式定义的是普通变量，IDE 不知道你定义了哪些常量。</p>
<h2 data-id="heading-16">实际使用建议</h2>
<p>这个 Proxy 技巧的价值主要在于<strong>学习和理解</strong>，而不是直接应用到生产环境。就像算法题一样，重点是理解思路，而不是把巧妙的解法用在工作代码里。</p>
<h3 data-id="heading-17">适合的场景</h3>
<p><strong>临时常量和快速原型</strong>：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 写测试代码时快速定义一些常量</span>
const { SUCCESS, FAILURE, PENDING } = keyProxy;
​
<span class="hljs-built_in">test</span>('should handle all states', () =&gt; {
  <span class="hljs-built_in">expect</span>(handler(SUCCESS))<span class="hljs-selector-class">.toBe</span>(true);
  <span class="hljs-built_in">expect</span>(handler(FAILURE))<span class="hljs-selector-class">.toBe</span>(false);
  <span class="hljs-built_in">expect</span>(handler(PENDING))<span class="hljs-selector-class">.toBe</span>(null);
});
</code></pre>
<p>在快速开发阶段，不想花时间写繁琐的枚举定义，这个方式很方便。</p>
<h3 data-id="heading-18">生产环境的建议</h3>
<p>对于业务核心的枚举（订单状态、用户角色等），建议还是用传统方式：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 清晰、有命名空间、IDE 友好</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">OrderStatus</span> = Object.<span class="hljs-title function_ invoke__">freeze</span>({
 <span class="hljs-attr"> PENDING</span>: <span class="hljs-string">'pending'</span>,
 <span class="hljs-attr"> PROCESSING</span>: <span class="hljs-string">'processing'</span>,
 <span class="hljs-attr"> SHIPPED</span>: <span class="hljs-string">'shipped'</span>,
 <span class="hljs-attr"> DELIVERED</span>: <span class="hljs-string">'delivered'</span>
});
</code></pre>
<p>或者如果项目使用 TypeScript，直接用 <code>enum</code>：</p>
<pre><code class="hljs language-ini" lang="ini">enum OrderStatus {
  <span class="hljs-attr">PENDING</span> = <span class="hljs-string">'pending'</span>,
  <span class="hljs-attr">PROCESSING</span> = <span class="hljs-string">'processing'</span>,
  <span class="hljs-attr">SHIPPED</span> = <span class="hljs-string">'shipped'</span>,
  <span class="hljs-attr">DELIVERED</span> = <span class="hljs-string">'delivered'</span>
}
</code></pre>
<h3 data-id="heading-19">如果真要用，可以封装</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils/enum.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> stringEnum = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>({}, {
  <span class="hljs-title function_">get</span>(<span class="hljs-params">_target, propKey</span>) {
    <span class="hljs-keyword">return</span> propKey;
  }
});
​
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> symbolEnum = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>({}, {
  <span class="hljs-title function_">get</span>(<span class="hljs-params">_target, propKey</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Symbol</span>(propKey);
  }
});
​
<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">import</span> { stringEnum } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/enum'</span>;
<span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">PENDING</span>, <span class="hljs-variable constant_">PROCESSING</span> } = stringEnum;
</code></pre>
<p>这样至少让代码意图更明确一些。</p>
<h2 data-id="heading-20">写在最后</h2>
<p>这个 Proxy 技巧确实挺巧妙的，理解它的原理也挺有意思。用来学习和理解 JavaScript 的高级特性很有价值。</p>
<p>就像健身房里练单手俯卧撑，不是为了以后干活只用一只手，而是为了提升整体力量。这个技巧也一样：</p>
<ul>
<li>加深对 Proxy 的理解</li>
<li>学会解构赋值的更多玩法</li>
<li>知道"简单特性组合"能产生的效果</li>
</ul>
<p>实际写枚举的时候，老老实实用 <code>Object.freeze()</code> 或者 TypeScript 的 <code>enum</code> 比较好。但如果哪天面试被问到"你能用 Proxy 做点什么有趣的事"，这个例子正好能派上用场。</p>
<p>代码不是越巧妙越好，够清楚、好维护才是王道。</p>
<hr/>
<h2 data-id="heading-21">相关文档</h2>
<ol>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2F2ality.com%2F2018%2F08%2Fenums-via-proxies.html" target="_blank" title="https://2ality.com/2018/08/enums-via-proxies.html" ref="nofollow noopener noreferrer">Enums via proxies (原文)</a></strong> - Dr. Axel Rauschmayer 的原文</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FProxy" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy" ref="nofollow noopener noreferrer">Proxy - MDN</a></strong> - Proxy 的详细用法</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FSymbol" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Symbol" ref="nofollow noopener noreferrer">Symbol - MDN</a></strong> - Symbol 类型说明</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2FDestructuring_assignment" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment" ref="nofollow noopener noreferrer">解构赋值 - MDN</a></strong> - 解构赋值的详细说明</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FObject%2Ffreeze" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze" ref="nofollow noopener noreferrer">Object.freeze() - MDN</a></strong> - 冻结对象的方法</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.typescriptlang.org%2Fdocs%2Fhandbook%2Fenums.html" target="_blank" title="https://www.typescriptlang.org/docs/handbook/enums.html" ref="nofollow noopener noreferrer">TypeScript Enums</a></strong> - TypeScript 的枚举实现</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot性能优化实战：我从10万QPS项目中总结的7个核心技巧]]></title>    <link>https://juejin.cn/post/7571068689765122088</link>    <guid>https://juejin.cn/post/7571068689765122088</guid>    <pubDate>2025-11-11T04:18:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571068689765122088" data-draft-id="7571056535439884288" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot性能优化实战：我从10万QPS项目中总结的7个核心技巧"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-11-11T04:18:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT_陈寒"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot性能优化实战：我从10万QPS项目中总结的7个核心技巧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT_陈寒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T04:18:06.000Z" title="Tue Nov 11 2025 04:18:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>SpringBoot性能优化实战：我从10万QPS项目中总结的7个核心技巧</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>在现代高并发场景下，SpringBoot作为Java生态中最流行的微服务框架之一，其性能表现直接决定了系统的稳定性和用户体验。最近，我在一个日均请求量突破10万QPS的电商项目中深度参与了性能调优工作，从中总结了7个经过实战验证的核心优化技巧。这些技巧不仅帮助我们将系统响应时间降低了60%，还将服务器资源消耗减少了40%。本文将详细分享这些实践经验，涵盖从代码层到架构层的全方位优化思路。</p>
<hr/>
<h2 data-id="heading-2">一、JVM参数调优：从默认配置到精准定制</h2>
<h3 data-id="heading-3">1.1 堆内存分配策略</h3>
<p>默认的JVM堆内存设置（-Xms和-Xmx）往往无法适应高并发场景。通过以下调整显著提升了GC效率：</p>
<ul>
<li><strong>分代大小调整</strong>：年轻代（-Xmn）设置为堆的40%~50%，避免频繁Young GC</li>
<li><strong>Survivor区优化</strong>：-XX:SurvivorRatio=8（Eden与Survivor比例），减少对象晋升到老年代的概率</li>
<li><strong>元空间限制</strong>：-XX:MaxMetaspaceSize=256m 防止元空间无限膨胀</li>
</ul>
<h3 data-id="heading-4">1.2 GC算法选择</h3>
<p>针对低延迟要求场景，推荐组合：</p>
<pre><code class="hljs language-bash" lang="bash">-XX:+UseG1GC -XX:MaxGCPauseMillis=200 -XX:G1HeapRegionSize=4m
</code></pre>
<p>实测显示G1相比CMS减少20%的STW时间，尤其适合堆内存大于4GB的场景。</p>
<hr/>
<h2 data-id="heading-5">二、连接池优化：打破数据库瓶颈</h2>
<h3 data-id="heading-6">2.1 HikariCP参数精调</h3>
<p>SpringBoot默认的HikariCP配置需要针对性优化：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring.datasource.hikari:</span>
  <span class="hljs-attr">maximum-pool-size:</span> <span class="hljs-number">50</span>   <span class="hljs-comment"># 根据CPU核心数×2 + 磁盘数公式调整</span>
  <span class="hljs-attr">minimum-idle:</span> <span class="hljs-number">10</span>
  <span class="hljs-attr">connection-timeout:</span> <span class="hljs-number">3000</span>
  <span class="hljs-attr">leak-detection-threshold:</span> <span class="hljs-number">60000</span>
</code></pre>
<p>关键点在于避免"连接风暴"——通过合理的minimum-idle维持预热连接。</p>
<h3 data-id="heading-7">2.2 PgBouncer应用</h3>
<p>对于PostgreSQL等数据库，在前置层部署PgBouncer实现连接复用，使实际数据库连接数从1000+降至200。</p>
<hr/>
<h2 data-id="heading-8">三、缓存策略的多级协同</h2>
<h3 data-id="heading-9">3.1 Caffeine本地缓存</h3>
<p>高频访问数据采用Caffeine实现进程内缓存：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> Cache&lt;String, Object&gt; <span class="hljs-title function_">localCache</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> Caffeine.newBuilder()
        .maximumSize(<span class="hljs-number">10000</span>)
        .expireAfterWrite(<span class="hljs-number">5</span>, TimeUnit.MINUTES)
        .recordStats()
        .build();
}
</code></pre>
<p>配合@Cacheable注解，命中率提升至85%以上。</p>
<h3 data-id="heading-10">3.2 Redis分层设计</h3>
<ul>
<li>L1：热点数据用Redis Cluster+短TTL（30秒）</li>
<li>L2：普通数据用Redis Sentinel+长TTL（30分钟）<br/>
通过Redisson的RBuckets接口实现批量操作降低网络开销。</li>
</ul>
<hr/>
<h2 data-id="heading-11">四、异步化改造实践</h2>
<h3 data-id="heading-12">4.1 @Async深度优化</h3>
<p>避免直接使用默认线程池，改为定制化配置：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAsync</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AsyncConfigurer</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Executor <span class="hljs-title function_">getAsyncExecutor</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ThreadPoolTaskExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolTaskExecutor</span>();
        executor.setCorePoolSize(<span class="hljs-number">8</span>);
        executor.setMaxPoolSize(<span class="hljs-number">32</span>);
        executor.setQueueCapacity(<span class="hljs-number">1000</span>);
        executor.setThreadNamePrefix(<span class="hljs-string">"AsyncService-"</span>);
        executor.initialize();
        <span class="hljs-keyword">return</span> executor;
    }
}
</code></pre>
<h3 data-id="heading-13">4.2 CompletableFuture组合编程</h3>
<p>对于多依赖异步任务，采用链式调用：</p>
<pre><code class="hljs language-java" lang="java">CompletableFuture.supplyAsync(() -&gt; serviceA.call(), poolA)
    .thenCombineAsync(
        CompletableFuture.supplyAsync(() -&gt; serviceB.call(), poolB),
        (a, b) -&gt; combineResult(a, b)
    );
</code></pre>
<hr/>
<h2 data-id="heading-14">五、SQL与JPA性能陷阱规避</h2>
<h3 data-id="heading-15">5.1 N+1查询解决方案</h3>
<ul>
<li>JPA中使用@EntityGraph替代FetchType.LAZY</li>
<li>MyBatis Plus启用二级缓存+@Interceptor实现自动防重查询</li>
</ul>
<h3 data-id="heading-16">5.2 Explain强制使用制度</h3>
<p>所有上线SQL必须附带Explain执行计划，重点关注：</p>
<ul>
<li>type至少达到range级别</li>
<li>Extra字段避免出现"Using filesort"、"Using temporary"</li>
</ul>
<hr/>
<h2 data-id="heading-17">六、HTTP层极致优化</h2>
<h3 data-id="heading-18">6.1 Tomcat参数调优</h3>
<pre><code class="hljs language-properties" lang="properties">server.tomcat.max-threads=200       # CPU密集型建议核数×2
server.tomcat.accept-count=100      # Linux下建议≥somaxconn/2
server.tomcat.max-connections=10000 # Epoll下可适当放大
</code></pre>
<h3 data-id="heading-19">6.2 SpringMVC加速技巧</h3>
<ul>
<li>@ControllerAdvice统一包装响应体改为@ResponseBody直接序列化</li>
<li>Jackson启用afterburner模块提升JSON处理速度15%：</li>
</ul>
<pre><code class="hljs language-java" lang="java">mapper.registerModule(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AfterburnerModule</span>());
</code></pre>
<hr/>
<h2 data-id="heading-20">七、监控体系的闭环建设</h2>
<h3 data-id="heading-21">7.1 Prometheus+Grafana监控矩阵</h3>
<p>关键指标采集配置示例：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">management.metrics.export.prometheus:</span>
    <span class="hljs-attr">step:</span> <span class="hljs-string">30s</span> 
    <span class="hljs-attr">descriptions:</span> <span class="hljs-literal">false</span>

<span class="hljs-attr">metrics:</span>
    <span class="hljs-attr">tags:</span>
        <span class="hljs-attr">region:</span> <span class="hljs-string">${REGION}</span>
</code></pre>
<h3 data-id="heading-22">7.2 Arthas线上诊断实战案例</h3>
<p>通过Arthas快速定位慢查询：</p>
<pre><code class="hljs language-bash" lang="bash">trace com.example.service.OrderService queryOrderById <span class="hljs-string">'#cost &gt; 50'</span>
</code></pre>
<hr/>
<h2 data-id="heading-23">总结回顾</h2>
<p>本文的7大优化技巧构成了一个完整的性能提升体系：</p>
<ol>
<li>JVM层解决内存管理根本问题</li>
<li>连接池优化消除数据库瓶颈</li>
<li>多级缓存降低IO压力</li>
<li/>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[低代码Agent开发框架使用指南（七）—Coze 数据库详解]]></title>    <link>https://juejin.cn/post/7571067260052783130</link>    <guid>https://juejin.cn/post/7571067260052783130</guid>    <pubDate>2025-11-11T04:50:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571067260052783130" data-draft-id="7569123141877694516" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="低代码Agent开发框架使用指南（七）—Coze 数据库详解"/> <meta itemprop="keywords" content="人工智能,Coze,Agent"/> <meta itemprop="datePublished" content="2025-11-11T04:50:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型真好玩"/> <meta itemprop="url" content="https://juejin.cn/user/3140624091453053"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            低代码Agent开发框架使用指南（七）—Coze 数据库详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3140624091453053/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型真好玩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T04:50:12.000Z" title="Tue Nov 11 2025 04:50:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">前言</h2>
<p>上篇文章《<a href="https://juejin.cn/post/7566896033210794020" target="_blank" title="https://juejin.cn/post/7566896033210794020">低代码Agent开发框架使用指南（六）—Coze 变量与长期记忆</a>》深入介绍了Coze平台中变量与长期记忆两大核心功能：变量用于动态存储用户信息，实现个性化交互；长期记忆则记录对话历史，赋予智能体跨会话的连贯理解能力。笔者通过实际示例，展示了如何借助这两类功能有效提升智能体的交互体验。</p>
<p>在智能体的构建过程中，除了对用户状态与对话历史的动态管理，如何有效利用结构化数据也是实现复杂功能的关键。尤其在当前数据日益成为重要资产的环境下，从App用户行为到企业系统日志，各类信息的记录、存储与调用无处不在。为帮助开发者更系统化地管理和运用这些数据资源，本文笔者将聚焦于Coze平台中的数据库功能，带大家了解它如何进一步扩展智能体的数据处理能力，实现更强大的数据驱动型交互场景。</p>
<p>低代码Agent开发相关文章已全部收录于笔者专栏<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fweixin_42782643%2Fcategory_13062185.html" target="_blank" title="https://blog.csdn.net/weixin_42782643/category_13062185.html" ref="nofollow noopener noreferrer">《AI应用工厂：低代码智能体开发使用指南》</a>。本专栏致力于帮助零代码经验的朋友快速上手智能体搭建，学会该技能可以轻松实现如旅游助手、自动文档处理、自动视频生成等实用工具，让大模型技术真正赋能日常生活。</p>
<p>对于有编程基础、喜欢写代码的开发者也可以阅读笔者的<a href="https://juejin.cn/column/7526240014499495972" target="_blank" title="https://juejin.cn/column/7526240014499495972">LangChain/LangGraph系列教程</a>专栏。该专栏融合了笔者在实战中积累的深度经验，系统讲解如何基于LangChain与LangGraph框架高效开发智能体，并通过众多实战项目助大家快速构建专业级应用。大家感兴趣可以关注笔者掘金账号和系列专栏，更可关注笔者同名微信公众号: <strong>大模型真好玩</strong>, 每期分享涉及的代码均可在公众号私信: <strong>LangChain智能体开发</strong>获得。</p>
<h2 data-id="heading-1">一、数据库基本概念</h2>
<p>一提到数据库，很多人首先会想到 MySQL、Oracle、SQL Server 这类传统关系型数据库。它们长期为各类企业及应用提供稳定、高效的数据管理支持，可以说是现代软件系统中不可或缺的组成部分。</p>
<p>从本质上讲，传统数据库是一个高度结构化的数据仓库，可以将其理解为一个功能强大的“表格系统”——类似于我们熟悉的 Excel 表格，但具备更强的并发处理与数据一致性保障。数据按照预定义的结构（行与列）进行存储，每一条数据的各个属性都对应表格中的一个字段，从而支持高效的检索与操作。例如，下面是一个用于存储文章数据的示例表结构，每条记录都包含文章标题、作者和发表时间等字段：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57288ba644964317aafbfbd98cf095ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=%2FomJfG7kr7HeolNe8HwhJFT%2FkzA%3D" alt="0.png" loading="lazy"/></p>
<p>总体来看，传统数据库具备以下几项核心特性：</p>
<ul>
<li><strong>结构化存储</strong>：数据以表格形式组织，每个字段具有明确的数据类型与约束。</li>
<li><strong>支持复杂查询</strong>：借助 SQL（结构化查询语言），用户能够灵活实现条件筛选、多表关联、聚合计算等高级查询操作。</li>
<li><strong>强数据一致性</strong>：通过事务机制与完整性约束，确保数据在并发场景下的准确性与可靠性。</li>
</ul>
<p>不过，这些特性也带来了相应的使用门槛。传统数据库通常要求用户具备专业的运维与 SQL 知识，理解其结构规范与查询语法，对于普通用户而言，独立完成建表、查询与数据处理并非易事。</p>
<p>那么，有没有一种更直观的数据操作方式，能够让我们直接使用自然语言与数据库“对话”？答案是肯定的——<strong>Coze 数据库</strong>正是为此而来。</p>
<h2 data-id="heading-2">二、Coze数据库使用指南</h2>
<h3 data-id="heading-3">2.1 Coze数据库的创新之处</h3>
<p>与传统数据库较高的学习门槛不同，Coze数据库创新性地融合了大模型能力，允许用户直接使用自然语言对数据库进行操作。用户无需专门学习SQL语法，仅需用日常语言描述需求，即可完成数据的查询、录入、修改等一系列操作，大幅降低了使用门槛。</p>
<p>举例来说，假设有一个记录书籍信息的数据库，想要查询作者为“大模型真好玩”的所有书籍。在传统模式下，用户需要编写如下SQL语句：</p>
<pre><code class="hljs language-ini" lang="ini">SELECT * FROM books WHERE <span class="hljs-attr">author</span>=<span class="hljs-string">"大模型真好玩"</span><span class="hljs-comment">;</span>
</code></pre>
<p>而在Coze数据库中，用户只需直接输入自然语言指令：“查询所有作者为大模型真好玩的书籍”，系统便能自动理解你的意图并执行查询。这种直观的交互方式，让数据库操作变得前所未有的简单友好！</p>
<h3 data-id="heading-4">2.2 Coze数据库的创建与使用</h3>
<p>Coze平台提供了强大易用的数据库功能，支持通过自然语言完成数据表的创建、数据的插入、查询与修改，极大简化了数据管理和处理流程。下面笔者将详细介绍如何在Coze平台上创建和使用数据表。</p>
<ol>
<li>
<p><strong>进入平台与数据库选项</strong>：首先访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.coze.cn%2Fstudio%3FforceToStudio%3Dtrue" target="_blank" title="https://www.coze.cn/studio?forceToStudio=true" ref="nofollow noopener noreferrer">Coze平台</a>。为方便快速测试，笔者使用<a href="https://juejin.cn/post/7559893593608192040" target="_blank" title="https://juejin.cn/post/7559893593608192040">先前文章</a>中创建的“NBA新闻助手”智能体进行演示。在该智能体的“编排”页面中，可以找到“数据库”选项，点击“添加表”。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70faa9cc05164534a8f0b5487c3fc062~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=MgoHwd8ao46pd0Er2btiiRcerZU%3D" alt="1.png" loading="lazy"/></p>
</li>
<li>
<p><strong>创建数据库的三种方法</strong>：Coze平台提供了三种创建数据表的方式，如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f1da0ccb7fd412bb7241e7fd80c43cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=8B1ZSliCk%2BxirD6dETrP%2FbXW86I%3D" alt="2.png" loading="lazy"/></p>
</li>
</ol>
<ul>
<li>
<p><strong>基于模板创建</strong>：在新建数据表下拉框中点击“基于模板创建”按钮，Coze会使用默认的“书籍相关数据库”模板生成对应的数据表结构。默认表名为<code>reading_notes</code>，包含<code>id</code>、<code>sys_platform</code>、<code>uuid</code>、<code>bstudio_create_time</code>等系统预置字段。用户可以参照此模板修改或增添新字段。每个字段都包含数据类型定义和“是否必要”的约束选项，勾选后则该字段为必填项。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/395efe167e3344abb29935641b788cbf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=aMy%2FlX7gPdvttOdf2ocrvUowsgA%3D" alt="3.png" loading="lazy"/></p>
</li>
<li>
<p><strong>自定义数据表</strong>：在新建数据表下拉框中点击“自定义数据表”按钮，手动输入表名、字段名及类型等信息。系统会提供一个包含<code>id</code>等四个默认字段的表格，不需要的字段可以删除。用户可以点击“新增”按钮添加自定义字段，例如添加一个<code>test</code>属性。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2218c35731c34f968a7cf2023e00a185~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=NoIghKAxeU3OOeSbTMqYkQMvN60%3D" alt="4.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7d69e3ee9344bd98520d73865807ed9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=FXWqWbGCUPlVeIbzdeewvfsEHbs%3D" alt="5.png" loading="lazy"/></p>
</li>
<li>
<p><strong>使用AI新建</strong>：如果觉得以上方法仍不够便捷，可以使用“使用AI新建”功能。只需输入用户想创建的数据表的自然语言描述，例如：“我想创建一个NBA新闻存储表，可以存储新闻标题，摘要和发布时间”，Coze便会根据描述自动生成数据表结构，之后可在此基础上进行微调。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/548fa402ec9f4f39a7e7d776edb093d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=wWmDocHfxvoKQ1foAGbsG0WZ7JY%3D" alt="6.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1a4f0f521864e6194706d70bcf7ba28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=wUhYFSlflBnfNc0bxjpdCAEqP5A%3D" alt="7.png" loading="lazy"/></p>
</li>
</ul>
<ol start="3">
<li>
<p><strong>使用自然语言插入数据</strong>：数据表创建完成后，即可使用自然语言向表中插入数据。以NBA新闻助手为例，输入指令：“帮我查询当日NBA新闻，并存储到数据库中”。观察运行过程可以发现，智能体依次调用了获取当前时间、查询头条新闻，最后通过<code>TableMemory</code>功能将数据存入数据库。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf4d15d939684300944aa14fd5891a33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=qz6pxbmK5FCpQUxcRP8OjwImTmY%3D" alt="8.png" loading="lazy"/></p>
</li>
<li>
<p><strong>处理执行过程与问题排查</strong>：点击已调用的<code>TableMemory</code>步骤，可以查看操作详情。Coze会将自然语言指令转换为SQL语句并执行。如果首次插入数据时报错也无需担心，可以继续向大模型提问，让它协助分析问题并修正。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8baaabf650b7458b884d20fcb5d8f680~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=yjWPuevlWmXKjQfiaMQGEVSMBh8%3D" alt="9.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b86733ad634e40f58238a2aeced76607~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=uXsvY1WXVmkhYJgJMY2Tvm%2BNBVI%3D" alt="10.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cf820762cff43fe900e8480cce36d30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=23PRU9HcetZAcvVSm80eDHex3XQ%3D" alt="11.png" loading="lazy"/></p>
</li>
<li>
<p><strong>查看表中数据</strong>：要查看已存储的数据，可以在编排面板点击对应数据表的“编辑”按钮，即可浏览表中的全部记录。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/242d447575594fd5a8270185f75ba78a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=LC1SM5aoKsaK1PSwWXQbrX5FWp8%3D" alt="12.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8610fb50146f4dba852863659a940602~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=4T9vT7DZ%2Fw2%2FIM%2FiddqXRJ7QKYg%3D" alt="13.png" loading="lazy"/></p>
</li>
<li>
<p><strong>使用自然语言增删改查</strong>：同样，用户可以通过自然语言对话对数据进行增删改查。例如，输入指令：“请帮我删掉数据库中标题中包含东契奇的数据”。执行后，可以观察到表中的记录总数减少了一条，证明操作成功。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9cd01f02d60420bbb16f4e86cc02af5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=ED6ZUDMZr0Llb2hStw%2B6inWsq8s%3D" alt="14.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19894c9e4b4d4b5d816c2f5d861fe1d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=fPrxfLzBLgJi1Ee78cGxNUaPu28%3D" alt="15.png" loading="lazy"/></p>
</li>
</ol>
<p>通过以上步骤，笔者带大家完整体验了Coze数据库从创建到使用的便捷流程。无需编写复杂SQL，仅凭自然语言即可驾驭数据。建议大家亲自上手，尝试对数据库进行各种操作，感受它的强大功能！</p>
<h2 data-id="heading-5">三、数据库操作延伸扩展</h2>
<h3 data-id="heading-6">3.1 数据分析与可视化</h3>
<ol>
<li><strong>创建智能体与数据库</strong>： 首先新建一个名为“数据库可视化”的Coze智能体。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d77c3dc2c2f453baf7993aa3b1eb5af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=%2FuGXNMKdHCdqEc5JMoIteYrNkU0%3D" alt="16.png" loading="lazy"/></p>
<ol start="2">
<li><strong>创建数据表</strong>：创建一个名为"task_data"的数据库，在数据库中添加<code>task_name</code>任务名称，<code>task_desc</code>任务描述，<code>ddl</code>截止日期和<code>priority</code>优先级四个字段。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d31b839f943d4b86806502f9162f21c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=0V0GsQUiz%2BvTsjAruN2XIQUCin0%3D" alt="17.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59ea347e02814985bf67124bbfc7deec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=g6Cg0qa6dO9bphMac6RR3wbT2HA%3D" alt="18.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a59e5eab60744dfaddc6ea6bcf23f87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=954x4DFNreRnWmrT0A5wYV9NP8Q%3D" alt="21.png" loading="lazy"/></p>
<ol start="3">
<li><strong>插入数据：单条与批量操作</strong>： 表结构创建后，即可通过自然语言插入数据。输入如下指令单挑插入一条数据</li>
</ol>

<pre><code class="hljs language-go" lang="go">请在<span class="hljs-string">`任务表`</span>中添加一条数据，任务标题为<span class="hljs-string">`完成周报`</span>，任务描述为<span class="hljs-string">`总结本周工作内容，并提交给老板审阅`</span>，优先级为<span class="hljs-string">`高`</span>，截止日期为<span class="hljs-string">`2025-11-30`</span>。
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/837cab127dac474289aadf279f7d4c64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=%2FFZDIKLiQWcJRYfBw3jHNbSLBJ0%3D" alt="23.png" loading="lazy"/></p>
<p>Coze同样支持高效批量操作，可以一次性输入多条数据：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">请在`任务表`中批量添加以下数据：</span>
<span class="hljs-string">任务标题：</span> <span class="hljs-string">完成周报，</span> <span class="hljs-string">任务描述：</span> <span class="hljs-string">总结本周工作内容，并提交给经理审阅，</span> <span class="hljs-string">优先级：</span> <span class="hljs-string">高，</span> <span class="hljs-string">截止日期：</span> <span class="hljs-number">2025-11-30</span><span class="hljs-string">;</span>
<span class="hljs-string">任务标题：</span> <span class="hljs-string">准备会议材料，</span> <span class="hljs-string">任务描述：</span> <span class="hljs-string">制作下周项目会议的</span> <span class="hljs-string">PPT</span> <span class="hljs-string">材料，</span> <span class="hljs-string">优先级：</span> <span class="hljs-string">高，</span> <span class="hljs-string">截止日期：</span> <span class="hljs-number">2025-12-02</span><span class="hljs-string">；</span>
<span class="hljs-string">任务标题：</span> <span class="hljs-string">回复客户邮件，</span> <span class="hljs-string">任务描述：</span> <span class="hljs-string">及时回复客户关于产品售后服务的咨询邮件，</span> <span class="hljs-string">优先级：</span> <span class="hljs-string">中，</span> <span class="hljs-string">截止日期：</span> <span class="hljs-number">2025-12-04</span><span class="hljs-string">;</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afe7fcb7db144f4ea9767785cfc0195a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=rBRnegCRprfAE6YOJamYHnkGm7c%3D" alt="24.png" loading="lazy"/></p>
<ol start="4">
<li><strong>执行数据查询</strong>：数据录入后，可以随时进行查询。例如，要查找所有高优先级任务，只需输入：</li>
</ol>

<pre><code class="hljs language-go" lang="go">请查询<span class="hljs-string">`任务表`</span>中所有优先级为<span class="hljs-string">`高`</span>的任务数据。
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8f85b7c1dba40b0bbdd30d37e8f473a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=WeYHk%2BwHeACxdQv4Y9PnnOasLkE%3D" alt="25.png" loading="lazy"/></p>
<ol start="5">
<li><strong>集成插件实现数据分析与可视化</strong>：增删查改这种玩法已经不高级了，Coze 数据库最强大的功能在于可以利用 Coze 平台的其他强大功能，对数据进行智能分析和可视化展示。比如，可以先在智能体编辑页面添加几个跟数据分析有关的插件，比如官方的 <code>图表大师</code>：</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcdc55741fc64b4798638ead6050d8df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=2M8qjpiqH06ZjFsawaYm1ZW%2Fo3I%3D" alt="26.png" loading="lazy"/></p>
<ol start="6">
<li><strong>生成数据分析报告</strong>：插件配置完成后，即可通过自然语言指令，让智能体基于数据库内容生成全面的分析报告。智能体会自动查询数据、进行分析，并调用“图表大师”插件生成直观的可视化图表，最终呈现一份图文并茂的分析报告。</li>
</ol>

<pre><code class="hljs language-go" lang="go">请根据<span class="hljs-string">`任务表`</span>的数据，分析我的任务优先级情况，并生成一份任务优先级情况情况分析报告。内容包括按优先级统计的任务分布，以文字和图表的形式呈现。
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a74911db27e94970a1b835e87c6604de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=qQ7MvstqMHczE5MdSDkno5FS9zQ%3D" alt="27.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47092da15b134f0e91de185c744a48bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441411&amp;x-signature=Z7W2SHxMINe%2BIpd7k%2FT7h%2Bda7l0%3D" alt="28.png" loading="lazy"/></p>
<p>整个过程无需手动编写任何查询或图表代码，充分展现了Coze在数据智能处理方面的强大与便捷，是不是很神奇！</p>
<h3 data-id="heading-7">3.2 Coze数据库的最佳实践</h3>
<p>为了更高效、可靠地使用Coze数据库，遵循以下最佳实践至关重要。</p>
<h4 data-id="heading-8">实践一：使用标准化的数据格式和明确的表结构</h4>
<p>良好的设计是后续所有数据应用的基础。</p>
<ul>
<li><strong>统一数据类型</strong>：确保同一字段的数据格式一致。例如，日期统一采用<code>YYYY-MM-DD</code>格式，数值明确单位和精度。</li>
<li><strong>规范命名</strong>：为数据表和字段设置清晰、规范的名称，建议使用下划线分隔单词，并避免使用数据库保留字。</li>
<li><strong>审慎设置字段约束</strong>：对于关键业务字段，应开启“是否必要”选项，强制填写以保证数据完整性。同时，需评估可选字段为空值（NULL）的可行性，避免影响数据质量和功能稳定性。</li>
</ul>
<p>通过以上措施，可以显著提升数据质量，减少不一致和冗余，为复杂的数据处理奠定坚实基础。</p>
<h4 data-id="heading-9">实践二：明确 Coze 数据库的使用边界</h4>
<p>Coze数据库作为一款轻量级、面向自然语言交互的产品，在易用性上表现出色，但其功能和性能与传统企业级数据库相比存在差异。因此，明确其适用边界至关重要。</p>
<p>Coze平台提供了多种数据管理工具，应根据具体场景选择：</p>
<ul>
<li><strong>变量 (Variables)</strong> ：适用于保存临时性的、会话级别的数据，如用户在单次对话中提供的偏好信息。</li>
<li><strong>长期记忆 (Long-term Memory)</strong> ：用于自动记录并总结用户跨会话的交互历史，为实现个性化服务提供上下文。</li>
<li><strong>知识库 (Knowledge Base)</strong> ：专为存储和管理非结构化的静态文档知识设计，支持高效的检索任务。</li>
<li><strong>Coze 数据库</strong>：核心用于存储和管理结构化的业务数据，适合数据量不大、查询分析逻辑相对简单的场景。</li>
</ul>
<p>对于数据安全性与一致性要求极高的核心业务系统，或需要处理海量数据、执行复杂高频查询的应用，目前仍建议通过开发<strong>自定义插件</strong>或<strong>工作流</strong>，来安全地对接外部专业数据库系统。</p>
<p>简而言之，将Coze数据库用于其擅长的轻量级结构化数据管理，并与变量、记忆、知识库等功能组合使用，方能构建出既智能又稳健的应用。</p>
<h3 data-id="heading-10">3.3 Coze数据库实际运用案例</h3>
<p>以下两个案例展示了Coze数据库在具体场景中的应用价值。</p>
<p><strong>1. 个人记账助手</strong><br/>
利用Coze数据库，可以快速搭建一个智能记账助手。</p>
<ul>
<li><strong>数据管理</strong>：用户通过自然语言创建包含类型、金额、日期、备注等字段的记账表。</li>
<li><strong>轻松记账</strong>：直接说“今天午餐消费35元”即可记录支出。</li>
<li><strong>智能查询</strong>：通过“查询我本月的餐饮总支出”等指令，快速获取消费洞察。</li>
<li><strong>可视化报告</strong>：结合插件，自动生成月度收支饼图或趋势图，让财务状况一目了然。</li>
</ul>
<p><strong>2. 智能日程管理助手</strong><br/>
结合数据库与工作流，可以打造一个能干的日程管家。</p>
<ul>
<li><strong>自然语言编排</strong>：用户可通过“下周三下午三点安排与客户的会议”直接创建日程。</li>
<li><strong>自动提醒</strong>：利用工作流在日程开始前通过指定渠道（如钉钉、飞书）自动发送提醒。</li>
<li><strong>冲突检测</strong>：智能体可自动检测时间冲突，并在用户添加新日程时发出预警。</li>
</ul>
<p>以上案例仅是Coze数据库能力的初步展现。借助其自然语言交互与数据管理能力，开发者可以高效构建出各类创新应用，为用户提供更智能、更便捷的数字化服务。</p>
<h2 data-id="heading-11">四、总结</h2>
<p>Coze 数据库作为 Coze 平台的一个重要组成部分，为 AI 智能体应用开发提供了实用的数据存储和管理能力。它基于自然语言交互，使得数据操作门槛大大降低。同时，它与 Coze 平台的工作流、变量、插件等功能深度集成，可以实现灵活多样的数据应用。此外，笔者还提到可以将数据库与Coze 平台的其他存储能力灵活搭配，构建更加智能化的应用。当然了除了讲过的 <code>变量</code>、<code>长期记忆</code>、<code>数据库</code>这些记忆存储外，Coze还有一种存储海量、非结构化数据的存储方式——也就是现在非常流行的知识库啦，我们下期讲解~</p>
<p>大家阅读后感兴趣可关注笔者掘金账号和专栏。 低代码Agent开发相关文章已全部收录于笔者专栏<a href="https://juejin.cn/column/7558439013464932362" title="https://juejin.cn/column/7558439013464932362" target="_blank">《AI应用工厂：低代码智能体开发使用指南》</a>。对于有经验喜欢写代码的开发者也可以阅读笔者的<a href="https://juejin.cn/column/7526240014499495972" title="https://juejin.cn/column/7526240014499495972" target="_blank">LangChain/LangGraph系列教程</a>专栏，目前已经更完22节并还在持续更新中。该专栏融合了笔者在实战中积累的深度经验，系统讲解如何基于LangChain与LangGraph框架高效开发智能体，助你快速构建专业级应用。大家可关注笔者同名微信公众号: <strong>大模型真好玩</strong>, 每期分享涉及的代码均可在公众号私信: <strong>LangChain智能体开发</strong>获得。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[通过 Chaos Mesh 验证 KubeBlocks Addon 可用性的实践]]></title>    <link>https://juejin.cn/post/7570999443446104100</link>    <guid>https://juejin.cn/post/7570999443446104100</guid>    <pubDate>2025-11-11T04:04:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570999443446104100" data-draft-id="7570976560708337727" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="通过 Chaos Mesh 验证 KubeBlocks Addon 可用性的实践"/> <meta itemprop="keywords" content="Kubernetes"/> <meta itemprop="datePublished" content="2025-11-11T04:04:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小猿姐"/> <meta itemprop="url" content="https://juejin.cn/user/1286882438155148"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            通过 Chaos Mesh 验证 KubeBlocks Addon 可用性的实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1286882438155148/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小猿姐
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T04:04:11.000Z" title="Tue Nov 11 2025 04:04:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、引言</h2>
<h3 data-id="heading-1">背景</h3>
<p>在云原生环境中，复杂数据库集群的高可用性管理是企业的核心挑战之一。KubeBlocks 作为开源的多引擎数据库管理平台，致力于保障数据库服务在各种故障场景下的稳定性。然而，传统测试方法难以模拟真实生产环境中的复杂故障，无法充分验证系统韧性。</p>
<h3 data-id="heading-2">解决方案</h3>
<p>混沌工程通过主动注入可控故障，帮助提前发现系统弱点，驱动系统加固。基于 Chaos Mesh 的系统化测试，我们验证了 KubeBlocks 在主机异常、进程异常、网络异常、压力异常和系统服务异常等场景下的高可用性表现：主节点秒级切换、数据零丢失，并总结了一系列最佳实践。</p>
<p>本文将介绍如何利用 Chaos Mesh 工具，通过故障注入演练验证并提升 KubeBlocks 的高可用能力。</p>
<h2 data-id="heading-3">二、Chaos Mesh 简介</h2>
<p>Chaos Mesh 是一个开源的混沌工程平台，用于在 Kubernetes 环境中进行分布式系统的混沌测试。通过模拟故障和异常（如网络延迟、服务故障、资源耗尽等），Chaos Mesh 能够帮助开发者和运维人员验证系统的稳定性、容错性和高可用性。</p>
<h3 data-id="heading-4">核心架构</h3>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77812c12c1af41a6bc22dc2588d3db8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP54y_5aeQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763438650&amp;x-signature=oXhEd%2Ba%2B%2B39Gj%2Br2WovCbE%2FXFRI%3D" alt="1.png" loading="lazy"/></p>
<p align="center">**架构图**</p>
<h3 data-id="heading-5">优势</h3>
<p>Chaos Mesh 凭借 K8s 原生集成、精细化的故障控制能力及声明式实验管理，与 KubeBlocks 数据库管理场景契合。</p>
<ul>
<li>K8s 原生集成：基于 CRD 实现故障注入，直接操作 KubeBlocks 管理的数据库 Pod，无需额外适配。</li>
<li>精细化的故障控制能力：直接针对 K8s 资源注入故障（如模拟节点宕机、网络隔离、资源过载），可验证 KubeBlocks 数据库集群的故障切换能力、数据同步机制及脑裂防护。</li>
<li>声明式实验管理：通过 YAML 定义故障参数（如丢包率 100%、CPU 负载 100%），适配 KubeBlocks 的声明式数据库管理模型，支持高频、可重复的混沌测试，实验过程自动化，支持与 CI/CD 流水线集成</li>
<li>安全隔离性：利用 cgroup 限制资源故障影响范围，确保 CPU/内存压力仅作用于目标容器，保障测试期间 KubeBlocks 数据库集群其他节点不受干扰，避免故障污染生产环境。</li>
</ul>
<p>通过声明式实验验证了 KubeBlocks 的核心高可用能力：主节点秒级切换、数据零丢失，并驱动多引擎架构持续优化，为云原生数据库的韧性提供了可量化、可复现的故障测试基准。</p>
<h2 data-id="heading-6">三、KubeBlocks 引擎高可用测试</h2>
<h3 data-id="heading-7">测试目标</h3>
<ul>
<li>验证 KubeBlocks 管理的各类数据库引擎在真实故障场景下的自愈能力。</li>
<li>评估集群数据一致性保障机制的有效性。</li>
<li>检测监控告警系统的及时性与准确性。</li>
</ul>
<h3 data-id="heading-8">测试场景</h3>

































































<table><thead><tr><th><strong>故障类型</strong></th><th><strong>模拟场景</strong></th><th><strong>预期行为</strong></th><th><strong>验证目标</strong></th></tr></thead><tbody><tr><td><strong>PodChaos</strong></td><td>主节点 Pod 强制删除</td><td>从节点迅速晋升为新主，应用连接短暂中断后恢复</td><td>主节点选举、故障切换时间</td></tr><tr><td><strong>PodChaos</strong></td><td>单副本 Pod 持续重启</td><td>服务可用性不受影响，副本集自动恢复</td><td>副本冗余有效性</td></tr><tr><td><strong>NetworkChaos</strong></td><td>主节点网络延迟 (1000ms+)</td><td>触发主节点失联，集群选举新主</td><td>网络分区容忍性、脑裂防护</td></tr><tr><td><strong>NetworkChaos</strong></td><td>主从节点间 100% 丢包</td><td>主从复制延迟增大，最终一致性保障</td><td>异步复制健壮性</td></tr><tr><td><strong>NetworkChaos</strong></td><td>节点间网络分区</td><td>形成多数派分区继续服务，少数派分区不可写</td><td>分区容忍性 (PACELC)</td></tr><tr><td><strong>StressChaos</strong></td><td>主节点 CPU 过载 (100%)</td><td>主节点响应变慢，可能触发探活超时导致 Failover</td><td>资源隔离、资源过载防护、探活灵敏度</td></tr><tr><td><strong>StressChaos</strong></td><td>从节点内存压力 (OOM 模拟)</td><td>从进程崩溃，K8s 自动重启副本</td><td>资源隔离、进程恢复能力</td></tr><tr><td><strong>DNSChaos</strong></td><td>集群内部 DNS 解析随机失败</td><td>副本间通信偶发失败，依赖重试机制恢复</td><td>服务发现可靠性、客户端重试</td></tr><tr><td><strong>TimeChaos</strong></td><td>主节点时钟向前跳跃 2 小时</td><td>可能导致 Raft Term 混乱或过期事务，触发主节点驱逐</td><td>时钟漂移敏感性、逻辑时钟保障</td></tr></tbody></table>
<h3 data-id="heading-9">测试执行</h3>
<p>以主节点 Pod 强制删除场景为例：</p>
<ol>
<li>环境部署**：**KubeBlocks 部署目标数据库集群 (如 MySQL Cluster)。</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/049f533b50c84f008de17013c334168c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP54y_5aeQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763438650&amp;x-signature=dUvCWBPwUCZ%2FS9EDJyMth3ut3Dk%3D" alt="2.png" loading="lazy"/></p>
<ol>
<li>故障定义**：**编写对应故障场景的 <code>chaos-experiment.yaml</code></li>
</ol>
<pre><code class="hljs language-YAML" lang="YAML"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">chaos-mesh.org/v1alpha1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">PodChaos</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">test-primary-pod-kill</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">action:</span> <span class="hljs-string">pod-kill</span>
  <span class="hljs-attr">mode:</span> <span class="hljs-string">one</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">namespaces:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">kubeblocks-cloud-ns</span>
    <span class="hljs-attr">labelSelectors:</span>
      <span class="hljs-attr">app.kubernetes.io/instance:</span> <span class="hljs-string">mysql-875777cc4</span>
      <span class="hljs-attr">kubeblocks.io/role:</span> <span class="hljs-string">primary</span>
</code></pre>
<ol>
<li>注入故障**：**<code>kubectl apply -f chaos-experiment.yaml</code>。</li>
</ol>
<pre><code class="hljs language-YAML" lang="YAML"><span class="hljs-string">kubectl</span> <span class="hljs-string">describe</span> <span class="hljs-string">PodChaos</span> <span class="hljs-string">test-primary-pod-kill</span>
                     
<span class="hljs-attr">Status:</span>
  <span class="hljs-attr">Experiment:</span>
    <span class="hljs-attr">Container Records:</span>
      <span class="hljs-attr">Events:</span>
        <span class="hljs-attr">Operation:</span>      <span class="hljs-string">Apply</span>
        <span class="hljs-attr">Timestamp:</span>      <span class="hljs-string">&lt;span</span> <span class="hljs-string">style="color:</span> <span class="hljs-comment">#FBBFBC"&gt;**2025-07-18T07:55:17Z**&lt;/span&gt;</span>
        <span class="hljs-attr">Type:</span>           <span class="hljs-string">Succeeded</span>
      <span class="hljs-attr">Id:</span>               <span class="hljs-string">kubeblocks-cloud-ns/mysql-875777cc4-mysql-0</span>
      <span class="hljs-attr">Injected Count:</span>   <span class="hljs-number">1</span>
      <span class="hljs-attr">Phase:</span>            <span class="hljs-string">Injected</span>
      <span class="hljs-attr">Recovered Count:</span>  <span class="hljs-number">0</span>
      <span class="hljs-attr">Selector Key:</span>     <span class="hljs-string">.</span>
    <span class="hljs-attr">Desired Phase:</span>      <span class="hljs-string">Run</span>
<span class="hljs-attr">Events:</span>
  <span class="hljs-string">Type</span>    <span class="hljs-string">Reason</span>           <span class="hljs-string">Age</span>   <span class="hljs-string">From</span>            <span class="hljs-string">Message</span>
  <span class="hljs-string">----</span>    <span class="hljs-string">------</span>           <span class="hljs-string">----</span>  <span class="hljs-string">----</span>            <span class="hljs-string">-------</span>
  <span class="hljs-string">Normal</span>  <span class="hljs-string">FinalizerInited</span>  <span class="hljs-string">15m</span>   <span class="hljs-string">initFinalizers</span>  <span class="hljs-string">Finalizer</span> <span class="hljs-string">has</span> <span class="hljs-string">been</span> <span class="hljs-string">inited</span>
  <span class="hljs-string">Normal</span>  <span class="hljs-string">Updated</span>          <span class="hljs-string">15m</span>   <span class="hljs-string">initFinalizers</span>  <span class="hljs-string">Successfully</span> <span class="hljs-string">update</span> <span class="hljs-string">finalizer</span> <span class="hljs-string">of</span> <span class="hljs-string">resource</span>
  <span class="hljs-string">Normal</span>  <span class="hljs-string">Updated</span>          <span class="hljs-string">15m</span>   <span class="hljs-string">desiredphase</span>    <span class="hljs-string">Successfully</span> <span class="hljs-string">update</span> <span class="hljs-string">desiredPhase</span> <span class="hljs-string">of</span> <span class="hljs-string">resource</span>
  <span class="hljs-string">Normal</span>  <span class="hljs-string">Applied</span>          <span class="hljs-string">15m</span>   <span class="hljs-string">records</span>         <span class="hljs-string">Successfully</span> <span class="hljs-string">apply</span> <span class="hljs-string">chaos</span> <span class="hljs-string">for</span> <span class="hljs-string">kubeblocks-cloud-ns/mysql-875777cc4-mysql-0</span>
  <span class="hljs-string">Normal</span>  <span class="hljs-string">Updated</span>          <span class="hljs-string">15m</span>   <span class="hljs-string">records</span>         <span class="hljs-string">Successfully</span> <span class="hljs-string">update</span> <span class="hljs-string">records</span> <span class="hljs-string">of</span> <span class="hljs-string">resource</span>
</code></pre>
<ol>
<li>集群监控**：**能看到从节点迅速切换为主节点，故障节点自动恢复后服务正常。</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5b12299370a4ee29c480e6372ae5292~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP54y_5aeQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763438650&amp;x-signature=JY5op4HgiTsdJP7otMHSCnUZ%2B10%3D" alt="3.png" loading="lazy"/></p>
<ol>
<li>结果分析**：<strong>主节点秒级切换</strong>（**在主节点 Pod 被删除之后，从节点 2s 切换为主节点）。</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac7b97fca6294ec89834e16e4e179343~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP54y_5aeQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763438650&amp;x-signature=0NRXdZVuv1XZwhDsmG%2BK4qInEew%3D" alt="4.png" loading="lazy"/></p>
<pre><code class="hljs language-YAML" lang="YAML"><span class="hljs-string">kubectl</span> <span class="hljs-string">logs</span> <span class="hljs-string">-n</span> <span class="hljs-string">kubeblocks-cloud-ns</span> <span class="hljs-string">mysql-875777cc4-mysql-1</span> <span class="hljs-string">lorry</span>
<span class="hljs-attr">2025-07-18T07:55:17Z        INFO        DCS-K8S        pod selector:</span> <span class="hljs-string">app.kubernetes.io/instance=mysql-875777cc4,app.kubernetes.io/managed-by=kubeblocks,apps.kubeblocks.io/component-name=mysql</span>
<span class="hljs-attr">2025-07-18T07:55:18Z        INFO        DCS-K8S        podlist:</span> <span class="hljs-number">2</span>
<span class="hljs-attr">2025-07-18T07:55:18Z        INFO        DCS-K8S        members count:</span> <span class="hljs-number">2</span>
<span class="hljs-number">2025-07-18T07:55:18Z</span>        <span class="hljs-string">DEBUG</span>        <span class="hljs-string">checkrole</span>        <span class="hljs-string">check</span> <span class="hljs-string">member</span>        {<span class="hljs-attr">"member":</span> <span class="hljs-string">"mysql-875777cc4-mysql-0"</span>, <span class="hljs-attr">"role":</span> <span class="hljs-string">""</span>}
<span class="hljs-number">2025-07-18T07:55:18Z</span>        <span class="hljs-string">DEBUG</span>        <span class="hljs-string">checkrole</span>        <span class="hljs-string">check</span> <span class="hljs-string">member</span>        {<span class="hljs-attr">"member":</span> <span class="hljs-string">"mysql-875777cc4-mysql-1"</span>, <span class="hljs-attr">"role":</span> <span class="hljs-string">"secondary"</span>}
<span class="hljs-attr">2025-07-18T07:55:18Z        INFO        event        send event:</span> <span class="hljs-string">map[event:Success</span> <span class="hljs-string">operation:checkRole</span> <span class="hljs-string">originalRole:secondary</span> <span class="hljs-string">role:{"term":"1752825318001682","PodRoleNamePairs":[{"podName":"mysql-875777cc4-mysql-1","roleName":"primary","podUid":"ccf5126a-4784-4841-b238-4bf30f98b172"}]}]</span>
<span class="hljs-number">2025-07-18T07:55:18Z</span>        <span class="hljs-string">INFO</span>        <span class="hljs-string">event</span>        <span class="hljs-string">send</span> <span class="hljs-string">event</span> <span class="hljs-string">success</span>        {<span class="hljs-attr">"message":</span> <span class="hljs-string">"{\"event\":\"Success\",\"operation\":\"checkRole\",\"originalRole\":\"secondary\",\"role\":\"{\\\"term\\\":\\\"1752825318001682\\\",\\\"PodRoleNamePairs\\\":[{\\\"podName\\\":\\\"mysql-875777cc4-mysql-1\\\",\\\"roleName\\\":\\\"primary\\\",\\\"podUid\\\":\\\"ccf5126a-4784-4841-b238-4bf30f98b172\\\"}]}\"}"</span>}
</code></pre>
<h3 data-id="heading-10">测试结果</h3>
<p>基于 KubeBlocks 对多种数据库引擎（包括 MySQL、PostgreSQL、Redis、MongoDB 和 SQLServer 等）的 Chaos Mesh 故障注入测试，测试结果验证了 KubeBlocks 在保障数据库高可用性方面的有效性。</p>


























































































<table><thead><tr><th><strong>测试场景</strong></th><th><strong>测试指标</strong></th><th><strong>测试结果</strong></th></tr></thead><tbody><tr><td><strong>PodChaos - 主节点 Pod 强制删除</strong></td><td>故障切换时间</td><td>MySQL/PostgreSQL/Redis/MongoDB ≤ 10 秒SQLServer Always On ≤ 30 秒</td></tr><tr><td/><td>服务恢复</td><td>新主节点自动接管，应用连接中断 ≤ 2 秒</td></tr><tr><td/><td>数据一致性</td><td>数据零丢失（通过 WAL/Raft 等日志同步保障）</td></tr><tr><td><strong>PodChaos - 单副本 Pod 持续重启</strong></td><td>服务可用性</td><td>≥ 99.9%（副本自动重建期间请求自动路由到健康节点）</td></tr><tr><td/><td>副本恢复时间</td><td>K8s 30 秒内重启 Pod，数据同步延迟 ≤ 5 秒</td></tr><tr><td><strong>NetworkChaos - 主节点网络延迟</strong></td><td>故障转移触发</td><td>MySQL Raft Group 数据库引擎探活超时（默认 15 秒）触发自动选主</td></tr><tr><td/><td>脑裂防护</td><td>Raft 共识协议阻止双主，仅多数派分区可写</td></tr><tr><td/><td>性能影响</td><td>请求延迟峰值 ≤ 35%，切换后恢复正常</td></tr><tr><td><strong>NetworkChaos - 主从节点间 100% 丢包</strong></td><td>数据同步</td><td>异步复制中断期间无数据丢失，恢复后自动追增</td></tr><tr><td><strong>NetworkChaos - 节点间网络分区</strong></td><td>分区容忍性</td><td>多数派分区服务持续可用，少数派分区拒绝写入</td></tr><tr><td><strong>StressChaos - 主节点 CPU 过载 (100%)</strong></td><td>Failover 触发</td><td>Redis Sentinel 主节点 CPU 持续过载 2 分钟后，触发 failover，新主接管，旧主恢复后自动加入为备库</td></tr><tr><td/><td>资源隔离</td><td>从节点性能不受影响（K8s cgroup 隔离生效）</td></tr><tr><td><strong>StressChaos - 从节点内存压力 (OOM 模拟)</strong></td><td>进程恢复</td><td>K8s 60 秒内自动重启 Pod，服务自愈</td></tr><tr><td/><td>数据同步</td><td>重启后主从节点全量同步，无状态泄漏</td></tr><tr><td><strong>DNSChaos - 集群内部 DNS 解析随机失败</strong></td><td>服务发现</td><td>客户端重试机制保障请求成功率 ≥ 99.9%</td></tr><tr><td><strong>TimeChaos - 主节点时钟向前跳跃 2 小时</strong></td><td>事务完整性</td><td>已提交事务无回滚，时钟校准后集群状态一致</td></tr></tbody></table>
<h2 data-id="heading-11">四、总结与展望</h2>
<p>通过将 Chaos Mesh 深度集成并实践，KubeBlocks 已初步建立起一套标准化的数据库高可用验证体系，成功应对了 Pod 故障、网络故障、资源压力、时间故障、DNS 故障等核心故障场景的挑战。然而，保障数据库服务的持续高可用性是一个永无止境的征程。未来，我们计划在以下方向进行更深层次的探索与实践，以持续提升 KubeBlocks 的可用性保障能力：</p>
<h3 data-id="heading-12">短期计划</h3>
<ul>
<li>场景精细化：混合故障注入（如网络延迟+节点重启），更贴近真实生产环境中复杂的、连锁发生的故障模式。</li>
<li>复杂度提升：模拟区域性故障（如可用区级网络隔离），验证 KubeBlocks 在多 AZ/Region 部署架构下的跨域容灾与恢复能力。</li>
<li>覆盖度：将混沌工程实践覆盖 KubeBlocks 自身的管控面组件，确保平台本身的健壮性。</li>
</ul>
<h3 data-id="heading-13">长期目标</h3>
<ul>
<li>生态扩展：探索与更广泛的云原生可观测性、告警、自愈工具链（如 Prometheus, AlertManager, Argo Rollouts）的深度集成，构建闭环的韧性保障体系。</li>
<li>智能化演进：探索基于 AIOps 的智能故障预测与演练编排，根据历史监控数据、拓扑关系和风险模型，自动生成并执行最具价值的混沌实验。</li>
</ul>
<h3 data-id="heading-14">最佳实践</h3>
<ul>
<li>通过渐进式混沌演练（从单点故障到混合场景）暴露系统弱点。结合三大黄金指标监控（SLA/RTO/RPO）量化韧性。将关键故障测试集成至 CI/CD 流水线实现常态化验证。</li>
<li>依据测试数据调整部署拓扑与参数，联动监控系统实现分钟级故障感知，定期验证恢复预案有效性，并通过跨团队演练驱动架构持续优化，最终构建“故障暴露-预案执行-数据驱动优化”的高可用闭环。</li>
</ul>
<h2 data-id="heading-15">参考资料</h2>
<p>Chaos Mesh 简介：<a href="https://link.juejin.cn?target=https%3A%2F%2Fchaos-mesh.org%2Fzh%2Fdocs%2F" target="_blank" title="https://chaos-mesh.org/zh/docs/" ref="nofollow noopener noreferrer">chaos-mesh.org/zh/docs/</a></p>
<p>KubeBlocks 简介：<a href="https://link.juejin.cn?target=https%3A%2F%2Fkubeblocks.io%2Fdocs%2Fpreview%2Fuser_docs%2Foverview%2Fintroduction" target="_blank" title="https://kubeblocks.io/docs/preview/user_docs/overview/introduction" ref="nofollow noopener noreferrer">kubeblocks.io/docs/previe…</a></p>
<p>KubeBlocks v1.0.0 高可用测试报告：<a href="https://link.juejin.cn?target=https%3A%2F%2Fkubeblocks.io%2Freports%2Fkubeblocks%2Fv1-0-0%2FTEST_REPORT_CHAOS" target="_blank" title="https://kubeblocks.io/reports/kubeblocks/v1-0-0/TEST_REPORT_CHAOS" ref="nofollow noopener noreferrer">kubeblocks.io/reports/kub…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[当你的Ant-Design成了你最大的技术债]]></title>    <link>https://juejin.cn/post/7571176484515659828</link>    <guid>https://juejin.cn/post/7571176484515659828</guid>    <pubDate>2025-11-11T04:04:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571176484515659828" data-draft-id="7571176484515381300" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="当你的Ant-Design成了你最大的技术债"/> <meta itemprop="keywords" content="前端,JavaScript,前端框架"/> <meta itemprop="datePublished" content="2025-11-11T04:04:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ErpanOmer"/> <meta itemprop="url" content="https://juejin.cn/user/3878732754331096"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            当你的Ant-Design成了你最大的技术债
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3878732754331096/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ErpanOmer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T04:04:38.000Z" title="Tue Nov 11 2025 04:04:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0d65e9f93954e25ab63eab763055f2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763438678&amp;x-signature=wsEuJIK2mtVQIf9v%2FhBbWsu6Trw%3D" alt="image.png" loading="lazy"/></p>
<p>大家好😁</p>
<p>如果你是一个前端，尤其是在B端（中后台）领域，<a href="https://link.juejin.cn?target=https%3A%2F%2Fant.design%2Findex-cn" target="_blank" title="https://ant.design/index-cn" ref="nofollow noopener noreferrer"><code>Ant Design</code></a>（antd）这个名字，你不可能没听过。</p>
<p>在过去的5年里，我们团队的<strong>所有</strong>新项目，技术选型里的第一行，永远是<code>antd</code>。它专业、开箱即用、文档齐全，拥有一切你想要的组件, 帮我们这些小团队，一夜之间就拥有了大厂的专业门面。</p>
<p>我们靠它，快速地交付了一个又一个项目。</p>
<p>但是，从去年开始，我发现，这个曾经的经典，正在变成我们团队脖子上最重的枷锁。</p>
<p><strong><code>Ant Design</code>，这个我们当初用来解决技术债的核心组件库，现在，却成了我们最大的技术债本身😖。</strong></p>
<p>这是一篇团队血泪史, 讲一讲感想🤷‍♂️。</p>
<hr/>
<h4 data-id="heading-0"><strong>我们为什么会爱上 AntD？</strong></h4>
<p>我们必须承认，从无到有阶段，<code>antd</code>是无敌的。</p>
<p>你一个3人的小团队，用上<code>antd</code>，做出来的东西，看起来和阿里几百人团队做的系统，没什么区别。</p>
<p><code>Table</code>、<code>Form</code>、<code>Modal</code>、<code>Menu</code>... 你需要的一切，它都以一种极其标准的方式给你了。你不再需要自己造轮子。</p>
<p>当你发现<code>@ant-design/pro-components</code>时，一个<code>ProTable</code>，直接帮你搞定了请求、分页、查询表单、工具栏... 你甚至都不用写<code>useState</code>了。</p>
<p>在那个阶段，我们以为我们找到了大结局。</p>
<hr/>
<h4 data-id="heading-1"><strong>当个性化成为 我们的 KPI</strong></h4>
<p>美好可能是短暂的，从我们的产品经理和UI设计师开始👇：</p>
<p><strong>能不能...不要长得这么 <code>Ant Design</code>？🤣</strong></p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe65af3e6556407a84fdc4c793175653~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763438678&amp;x-signature=X%2BRjQyFqFJt8kak2KQmBx%2BGGy3Y%3D" alt="image.png" loading="lazy"/></p>
<p>这是我们设计师，在评审会上，小心翼翼提出来的第一句话。</p>
<p>老板也说：我们要做自己的品牌，现在的系统，太千篇一律了!!!</p>
<p>于是，我们接到了第一个简单的需求：<strong>把全局的主题色，从橙色改成我们的品牌红。</strong></p>
<p>这很简单，不就是 <code>ConfigProvider</code>嘛🤔。我们改了。</p>
<p>然后，第二个需求来了：<strong>这个<code>Modal</code>弹窗的关闭按钮，能不能不要放在右上角？我们要放在左下角，和确认按钮放在一起。</strong>(有点反人类🤷‍♂️)</p>
<p><strong>灾难，就从这里开始了。</strong></p>
<p><code>antd</code>的<code>Modal</code>组件，根本就<strong>没提供</strong>这个插槽或<code>prop</code>。我们唯一的办法，是 <strong>强改</strong>。</p>
<p>于是，我们的代码里，开始出现这种恶臭的CSS：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 一个高权重的全局CSS文件 */</span>
<span class="hljs-selector-class">.ant-modal-header</span> {
  <span class="hljs-comment">/* ... */</span>
}

<span class="hljs-comment">/* 嘿，那个右上角的关闭按钮，给我藏起来！ */</span>
<span class="hljs-selector-class">.ant-modal-close-x</span> {
  <span class="hljs-attribute">display</span>: none <span class="hljs-meta">!important</span>; 
}
</code></pre>
<p>为了把那个 <strong>X</strong> 藏起来，我们用了<code>!important</code>。我们亲手打开了潘多拉魔盒。</p>
<p><strong>这个表格的筛选图标，能换成我们自己画的吗？😖</strong></p>
<p><code>antd</code>的<code>Table</code>，是一个重灾区。它太强大了，也很黑盒。</p>
<p>我们设计师，重新画了一套筛选、排序的图标。但我们发现，<code>antd</code>的<code>Table</code>组件，根本没想过让你换这个。</p>
<p>我们唯一的办法，就是用 <strong>CSS选择器</strong>，一层一层地穿进<code>antd</code>的DOM结构里，找到那个<code>&lt;span&gt;</code>，然后用<code>background-image</code>去盖掉它。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 另一个人写的，更恶臭的CSS */</span>
<span class="hljs-selector-class">.ant-table-thead</span> &gt; <span class="hljs-selector-tag">tr</span> &gt; <span class="hljs-selector-tag">th</span><span class="hljs-selector-class">.ant-table-column-has-filters</span> <span class="hljs-selector-class">.ant-table-filter-trigger</span> {
  <span class="hljs-comment">/* 妈呀，这是啥？ */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">'our-own-icon.svg'</span>) <span class="hljs-meta">!important</span>;
}

<span class="hljs-selector-class">.ant-table-thead</span> &gt; <span class="hljs-selector-tag">tr</span> &gt; <span class="hljs-selector-tag">th</span><span class="hljs-selector-class">.ant-table-column-has-filters</span> <span class="hljs-selector-class">.ant-table-filter-trigger</span> &gt; svg {
  <span class="hljs-comment">/* 藏起来，藏起来！ */</span>
  <span class="hljs-attribute">display</span>: none <span class="hljs-meta">!important</span>;
}
</code></pre>
<p><strong>我们被拖累了。</strong></p>
<p>我们花在 <strong>覆盖<code>antd</code>默认样式</strong>上的时间，已经远远超过了<strong>我们自己写一个组件</strong>的时间。</p>
<hr/>
<h4 data-id="heading-2"><strong>压死骆驼的最后一根稻草</strong></h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15a08ba6964e4c03b52b0f3d80e4aa09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763438678&amp;x-signature=5J%2Bn8GIhy69jKCcjY49Akg3V%2FJI%3D" alt="image.png" loading="lazy"/></p>
<p>我们用了<code>ProTable</code>，它的查询表单和表格是强耦合的。当产品经理提出一个我希望查询表单，在页面滚动时，吸附在顶部的需求时... 我们发现，我们改不动。我们被<code>ProComponents</code>的黑盒，锁死了。</p>
<p>然后我们的<code>vendor.js</code>打包出来，<code>2.5MB</code>。用<code>webpack-bundle-analyzer</code>一看，<code>antd</code>和<code>@ant-design/icons</code>，占了<code>1.2MB</code>。我们为了一个<code>Button</code>和<code>Icon</code>，引入了一个全家桶。<code>antd</code>的按需加载？别闹了，在<code>ProComponents</code>面前，它几乎是全量的。</p>
<p>而且 <code>antd</code>从<code>v3</code>到<code>v4</code>，我们花了一个月。从<code>v4</code>到<code>v5</code>，我们花了半个月。每一次升级，都是一次大型重构，因为我们那些写法一样被CSS覆盖，在新版里，全失效了🤷‍♂️。</p>
<p><strong>我们本想找一个可靠的组件库，这么久过来，结果它成了债主。</strong></p>
<hr/>
<h4 data-id="heading-3"><strong>我们真正需要的可能是轮子</strong></h4>
<p>我终于想明白了。</p>
<p><code>Ant Design</code>，它不是一个组件库（Library），它是一个<strong>UI框架</strong>（Framework）。它是一套<strong>解决方案</strong>，它有它自己强势的 <strong>设计价值观</strong>。</p>
<p>当你的需求，和它的价值观一致时，它就是圣经。
当你的需求，和它的价值观不一致时，它就变成枷锁。</p>
<p><strong>我们当初要的，其实是一个带样式的<code>Button</code>；而<code>antd</code>给我的，是一个内置了<code>loading</code>、<code>disabled</code>、<code>onClick</code>时会有水波纹动画、并且必须是蓝色或白色的<code>Button</code>。</strong></p>
<hr/>
<h4 data-id="heading-4"><strong>我们的自救之路</strong></h4>
<p>在我们新的项目中，我忍痛做出了一个决定🤷‍♂️：</p>
<p><strong>原则上，不再使用<code>antd</code>。</strong></p>
<p>我们新的技术栈，转向了：
<strong><code>Tailwind CSS</code> + <code>Headless UI</code> 方案（比如<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.radix-ui.com%2Fthemes%2Fdocs%2Foverview%2Fgetting-started" target="_blank" title="https://www.radix-ui.com/themes/docs/overview/getting-started" ref="nofollow noopener noreferrer"><code>Radix UI</code></a>）</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65a472594a95467e868d372bc514521d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763438678&amp;x-signature=DGFyFCblpcxPmAjOdAKw6egp8pY%3D" alt="image.png" loading="lazy"/></p>
<p>这个组合，才是我们想要的：</p>
<ul>
<li><strong><code>Headless UI</code></strong>：它只提供<strong>功能</strong>和<strong>无障碍</strong>。比如，一个<code>Dialog</code>（模态框），它帮我搞定了按<code>Esc</code>关闭、焦点管理。但它<strong>没有任何样式</strong>。</li>
<li><strong><code>Tailwind CSS</code></strong>：我拿到了这个无样式的<code>Dialog</code>，然后用<code>Tailwind</code>的<code>class</code>，在<strong>5分钟内</strong>，在AI的帮助下，把它拼成了我们设计师想要的、独一无二的弹窗。</li>
</ul>
<p><strong>我们拿回了CSS的完全控制权，同时又享受了 AI + 组件开发的便利。</strong></p>
<p>我依然尊敬<code>Ant Design</code>，它在前端B端历史上，是个丰碑。
对于那些从0到1的、对UI没有要求的内部系统，我可能依然会用它。</p>
<p>但对于那些需要品牌、体验、个性化的核心产品，我必须和它说再见了。</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/442d7c66b8da46599870175c85856478~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763438678&amp;x-signature=kjiwxbmV8%2B%2B%2Bzk1FjDOLipEA8C4%3D" alt="Suggestion.gif" loading="lazy"/></p>
<p>因为，当你的组件库开始控制你的设计和性能时，它就不是你的资产了。</p>
<p>而变成你最大的技术债🙌。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[数据分析师的基本功总结]]></title>    <link>https://juejin.cn/post/7571086754879619118</link>    <guid>https://juejin.cn/post/7571086754879619118</guid>    <pubDate>2025-11-11T04:53:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571086754879619118" data-draft-id="7571051830709813298" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="数据分析师的基本功总结"/> <meta itemprop="keywords" content="后端,数据分析,求职"/> <meta itemprop="datePublished" content="2025-11-11T04:53:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="databook"/> <meta itemprop="url" content="https://juejin.cn/user/3526889035006702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            数据分析师的基本功总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3526889035006702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    databook
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T04:53:43.000Z" title="Tue Nov 11 2025 04:53:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是否对数据分析这个行业充满好奇，但又不知从何下手？</p>
<p>别担心，这篇文章将用最通俗易懂的语言，系统地介绍数据分析师需要具备哪些“基本功”，</p>
<p>并且结合实际生活中的例子和Python代码，为你铺平通往数据分析世界的大门。</p>
<h2 data-id="heading-0">1. 数据分析的“套路”：核心步骤全解析</h2>
<p>数据分析就像是侦探破案，需要遵循一套严谨的流程，才能从纷繁复杂的数据中找到线索，最终得出结论。</p>
<p>这个过程，我们可以总结为以下六个核心步骤：</p>
<h3 data-id="heading-1">1.1. 明确目标：我们到底想知道什么？</h3>
<p>这是所有数据分析工作的起点，也是最重要的一步。如果目标不明确，后续的所有工作都可能是在“无用功”。</p>
<p>比如：假设你是一家连锁奶茶店的运营，最近发现A门店的销售额总是不如B门店。你想通过数据分析找出原因，并提升A门店的业绩。</p>
<p>那么，你的<strong>分析目标</strong>就是：“对比A、B门店的各项运营数据，找出导致销售额差异的关键因素，并提出针对性的优化建议。”</p>
<h3 data-id="heading-2">1.2. 数据采集：去哪里寻找“破案”的线索？</h3>
<p>明确了目标，我们就要开始寻找相关的数据。数据采集的方式有很多种，比如：</p>
<ul>
<li><strong>利用现有数据</strong>： 公司内部的数据库、业务报表、用户调研数据等。</li>
<li><strong>网络爬虫</strong>： 从网页上抓取公开的数据。</li>
<li><strong>API接口</strong>： 通过应用程序接口获取第三方平台的数据。</li>
<li><strong>公开数据集</strong>： 政府、研究机构等发布的公开数据。</li>
</ul>
<h3 data-id="heading-3">1.3. 数据清洗：去伪存真，让数据“能说人话”</h3>
<p>从各种渠道收集来的原始数据，往往是“脏”的，存在着各种问题，比如：</p>
<ul>
<li><strong>缺失值</strong>： 数据中有些字段是空白的。</li>
<li><strong>重复值</strong>： 同样的数据出现了多次。</li>
<li><strong>异常值</strong>： 明显不符合常理的数据，比如一个人的年龄是200岁。</li>
<li><strong>格式不一致</strong>： 比如日期格式有的是“2023-10-26”，有的是“2023/10/26”。</li>
</ul>
<p>数据清洗的目的，就是把这些“脏”数据处理干净，为后续的分析打下坚实的基础。</p>
<h3 data-id="heading-4">1.4. 数据存储：给清洗好的数据安个“家”</h3>
<p>清洗干净的数据，需要妥善地存储起来，方便随时调用和分析。</p>
<p>常见的数据存储方式有：</p>
<ul>
<li><strong>Excel/CSV文件</strong>： 适合小批量的数据。</li>
<li><strong>关系型数据库</strong>（如MySQL, PostgreSQL）： 适合结构化的数据，是企业中最常用的存储方式。</li>
<li><strong>非关系型数据库</strong>（如MongoDB）： 适合非结构化的数据，比如文本、图片等。</li>
</ul>
<h3 data-id="heading-5">1.5. 数据分析：深入挖掘，发现数据背后的“秘密”</h3>
<p>这是数据分析的核心环节。通过各种分析方法，从数据中提取有价值的信息。常用的分析方法包括：</p>
<ul>
<li><strong>对比分析</strong>： 比较不同维度下的数据差异，比如前面提到的A、B门店的对比。</li>
<li><strong>趋势分析</strong>： 观察数据随时间变化的规律，比如分析近一年来网站用户量的增长趋势。</li>
<li><strong>用户画像分析</strong>： 了解你的用户是谁，他们有什么特点。</li>
<li><strong>漏斗分析</strong>： 分析用户在完成某个流程（如注册、购买）时，每一步的转化率和流失率。</li>
</ul>
<h3 data-id="heading-6">1.6. 结果可视化与决策支持：让数据“开口说话”</h3>
<p><strong>“一图胜千言”</strong>。将分析结果通过图表的形式直观地展示出来，可以帮助我们更好地理解数据，也更容易向他人传达我们的发现。常见的可视化图表有：</p>
<ul>
<li><strong>柱状图</strong>： 比较不同类别的数据大小。</li>
<li><strong>折线图</strong>： 展示数据随时间变化的趋势。</li>
<li><strong>饼图</strong>： 显示各部分占总体的比例。</li>
<li><strong>散点图</strong>： 观察两个变量之间的关系。</li>
</ul>
<p>最终，数据分析的价值在于支持决策。基于可视化的结果，我们可以得出结论，并提出具体的行动建议。</p>
<p>比如，通过分析发现A门店的水果茶系列销量远低于B门店，我们就可以建议A门店增加水果茶的品类，或者推出相关的优惠活动。</p>
<h2 data-id="heading-7">2. 技能大盘点：成为数据分析师，你需要掌握什么？</h2>
<h3 data-id="heading-8">2.1. 业务理解能力：懂业务，才能做好分析</h3>
<p>数据分析师不能只埋头于数据，更要理解数据背后的业务逻辑。</p>
<p>只有深入了解业务，才能提出有价值的分析目标，并对分析结果做出合理的解读。</p>
<h3 data-id="heading-9">2.2. 数据采集工具</h3>
<ul>
<li><code>SQL</code>： 操作数据库的语言，是数据分析师的必备技能。你需要掌握基本的增删改查（CRUD）操作。</li>
<li>网络爬虫： 如果需要从网络上获取数据，最基本的<code>Python</code>中的<code>requests</code>和<code>BeautifulSoup</code>库是你的好帮手。</li>
</ul>
<h3 data-id="heading-10">2.3. 数据分析软件/工具</h3>
<ul>
<li><code>Excel</code>： 虽然功能有限，但对于快速处理小批量数据、制作简单的图表来说，<code>Excel</code>依然是一个非常高效的工具。</li>
<li><code>Python/R</code>： 这是数据分析师的“瑞士军刀”。<code>Python</code>凭借其丰富的第三方库（如<code>Pandas</code>, <code>NumPy</code>, <code>Matplotlib</code>, <code>Seaborn</code>, <code>Scikit-learn</code>）和强大的社区支持，成为了目前最主流的数据分析编程语言。</li>
<li><strong>BI工具</strong>（如<code>Tableau</code>, <code>Power BI</code>）： 这些工具可以帮助你快速地将数据转化为交互式的可视化报告，非常适合做业务监控和报表展示。</li>
</ul>
<h2 data-id="heading-11">3. 统计学基础：数据分析的“灵魂”</h2>
<p>统计学是数据分析的理论基础，它能帮助我们更科学、更严谨地进行数据分析。</p>
<p>主要包括：描述性统计学，数理统计学和推断性统计学。</p>
<h3 data-id="heading-12">3.1. 描述性统计学：给数据画个“像”</h3>
<p><strong>描述性统计学</strong>主要是用一些指标来描述数据的基本情况，比如：</p>
<ul>
<li><strong>集中趋势</strong>： 平均值、中位数、众数。</li>
<li><strong>离散程度</strong>： 方差、标准差、极差。</li>
<li><strong>数据分布</strong>： 偏度、峰度。</li>
</ul>
<h3 data-id="heading-13">3.2. 数理统计学：从样本看“世界”</h3>
<p><strong>数理统计学</strong>研究的是如何根据样本数据去推断总体的特征。</p>
<p>它是连接<strong>描述性统计学</strong>和<strong>推断性统计学</strong>的桥梁。</p>
<h3 data-id="heading-14">3.3. 推断性统计学：从数据中得出“结论”</h3>
<p><strong>推断性统计学</strong>是数据分析的**“重头戏”**，它能帮助我们从样本数据中得出关于总体的结论，并判断这个结论的可靠性。主要包括：</p>
<ul>
<li><strong>假设检验</strong>： 判断样本与样本、样本与总体之间是否存在显著差异。
<ul>
<li>比如： 某款新药声称可以有效降低血压。我们可以通过假设检验来判断，服用该药的患者血压下降的数据，是否足以证明该药真实有效，还是仅仅是偶然发生的。</li>
</ul>
</li>
<li><strong>置信区间</strong>： 估计总体参数（如平均值）所在的范围。
<ul>
<li>比如： 我们想知道全国所有男性的平均身高，但我们不可能测量每个人的身高。我们可以抽取一部分男性作为样本，计算出样本的平均身高，然后通过置信区间来估计全国男性的平均身高可能在哪个范围内。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-15">4. 总结</h2>
<p>本文首先系统地拆解了数据分析的六大核心步骤：从<strong>明确目标</strong>、<strong>采集数据</strong>，到<strong>数据清洗</strong>、<strong>存储</strong>，再到核心的<strong>分析</strong>环节与最终的<strong>可视化呈现</strong>和决策支持，建立对完整流程有了直观认识。</p>
<p>接着，总结了数据分析师必备的技能组合，强调了业务理解、SQL、Python等技术以及统计学理论基础的重要性，特别是推断性统计在数据驱动决策中的关键作用。</p>
<p>总之，想要成为一名优秀的数据分析师，不仅需要掌握实用的工具和编程技能，更要培养严谨的分析思维和深入的业务洞察力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别犹豫，用过才知道 AI 还能这样玩]]></title>    <link>https://juejin.cn/post/7570992947463946250</link>    <guid>https://juejin.cn/post/7570992947463946250</guid>    <pubDate>2025-11-11T04:30:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570992947463946250" data-draft-id="7571060853370945586" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别犹豫，用过才知道 AI 还能这样玩"/> <meta itemprop="keywords" content="开源,GitHub"/> <meta itemprop="datePublished" content="2025-11-11T04:30:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HelloGitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1574156384091320"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别犹豫，用过才知道 AI 还能这样玩
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1574156384091320/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HelloGitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T04:30:47.000Z" title="Tue Nov 11 2025 04:30:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>一直以来，我都比较克制收录依赖 LLM API 的开源项目，总感觉调“API + prompt”没什么新鲜的。</p>
<p>但最近老是被它们频繁刷屏，我还是没忍住，实际体验了几款开源 LLM 应用，这些应用安装和配置都很简单。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8344dc06e9f4ff3b3fcf1cebb97f076~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763440246&amp;x-signature=Vq4Jtxf3Jt1e4ftPlLN05n9wERI%3D" alt="" loading="lazy"/></p>
<p>玩了一圈，我才发现自己之前只用网页对话和 Claude Code 写代码，确实有点落伍了。尤其是在 AI 发展日新月异的今天，我更应该放下对 AI 的偏见，用开放的心态去体验和接受它们。</p>
<p>虽然在我的体验过程中，很少有被 AI 惊艳到或一次跑成功的经历，但这一次我选择拥抱不完美，或许这就是 AI 来时的路。</p>
<h2 data-id="heading-0">一、开源的 AI 浏览器：BrowserOS</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33faaa1e7fac43a2b08da8a079e69e18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763440246&amp;x-signature=w%2BIQeC2%2BiSVWHe%2BOQmhDg0NCJkE%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：C++</strong>，<strong>Star：7.3k</strong></p>
<p>该项目是基于 Chromium 的开源 AI 浏览器，能够在本地浏览器中运行 AI Agents，可作为 ChatGPT Atlas、Perplexity Comet 和 Dia 的开源替代品。它在保留 Chrome 熟悉界面与扩展兼容性（插件）的同时，实现了 AI 驱动的浏览器自动化与智能问答功能，并支持自定义 LLM 服务或本地大模型。</p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbrowseros-ai%2FBrowserOS" target="_blank" title="https://github.com/browseros-ai/BrowserOS" ref="nofollow noopener noreferrer">github.com/browseros-a…</a></p>
</blockquote>
<p><strong>使用感受</strong>：BrowserOS 开箱即用，使用起来和 Chrome 基本一模一样，区别就是它集成了 AI 能力，可以让 AI 帮你自动完成操作（不好用）、基于网页的信息回答你的问题（好用，但也取决于用什么模型）。我试了 Agent 和 Teach 模式，均以失败告终😅</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5dca4e8878b74310832b83953e7ec4b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763440246&amp;x-signature=Y2gC0pj391DNwT0RtVL1CpACXIE%3D" alt="" loading="lazy"/></p>
<p><strong>结论</strong>：如果你只是想体验一下 AI 浏览器，BrowserOS 使用门槛很低，它不像使用 ChatGPT Atlas 等工具时，需要先解决 OpenAI 帐号以及网络等问题。但目前 Agent 自动化操作的体验很差，只有在官方演示的那几个网站才能跑通，比如 GitHub、Amazon。</p>
<h2 data-id="heading-1">二、免费跨平台的语音转录工具：Handy</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c888bdd918a4caea2ad4fba5ba4dced~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763440246&amp;x-signature=J0w01sTCaXGQo2x7PU%2B0IEDaadc%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：TypeScript、Rust</strong>，<strong>Star：6.2k</strong></p>
<p>这是一款基于 Tauri 开发的跨平台语音转文字桌面应用，完全免费开源、本地运行。它界面清爽、交互简单，你只需按下快捷键即可开始转录，并且会将语音转文字的结果，插入到当前文本输入框，体验非常丝滑。</p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcjpais%2FHandy" target="_blank" title="https://github.com/cjpais/Handy" ref="nofollow noopener noreferrer">github.com/cjpais/Hand…</a></p>
</blockquote>
<p><strong>使用感受</strong>：虽然语音转文字的工具很多，但 Handy 的简洁给我留下了深刻的印象，无需复杂的配置、功能虽少但十分实用。最新版本还支持自定义 LLM 服务和提示词，还可 AI 后处理转录文本，提高输出的文字质量。但此功能需要通过 <code>ctrl/cmd+shift+d</code> 开启实验模式，才能使用。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c45630b3322a4b00ab332a7f211b19ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763440246&amp;x-signature=K%2FLfiqo8ZHBVexd059%2FnGg4y9lA%3D" alt="" loading="lazy"/></p>
<p><strong>结论</strong>：真正完全免费、开源的语音转录工具，核心功能做得很好，并且通过 AI 的加持做到了锦上添花。</p>
<h2 data-id="heading-2">三、自动生成每日时间线的 macOS 应用：Dayflow</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51ac1f91bebe47d898656d47c8c0aac6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763440246&amp;x-signature=t2USMalfbtj5TYIqFgMO5GzuX9Y%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：Swift</strong>，<strong>Star：4.4k</strong></p>
<p>这是一款用 Swift 开发的 macOS 应用，通过录制屏幕活动并结合 AI，自动生成每日时间线。它以每秒 1 帧的频率录制屏幕，每 15 分钟利用 AI 分析录像内容，生成简洁的活动总结。同时，支持自动删除超过 3 天的录制文件，节省存储空间。</p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJerryZLiu%2FDayflow" target="_blank" title="https://github.com/JerryZLiu/Dayflow" ref="nofollow noopener noreferrer">github.com/JerryZLiu/D…</a></p>
</blockquote>
<p><strong>使用感受</strong>：确实很轻量，使用起来毫无痛感，它只会安静的运行在你的后台，并且所有数据保留在本地。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ab65b2be63244f4ac2610551e78ea2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763440246&amp;x-signature=qxPS5UZAXg7qh6nZWmZeMpFqbT0%3D" alt="" loading="lazy"/></p>
<p><strong>结论</strong>：Dayflow 样样都好，唯一不足的就是仅支持 Gemini API，且只适用于 macOS 平台。</p>
<h2 data-id="heading-3">四、开源的 AI 虚拟伴侣：AIRI</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7eb407783e8c4d78a5c781d12e8000f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763440246&amp;x-signature=4h%2B%2BslrNg9C0TSsZEclV5sNE00s%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：Vue、TypeScript</strong>，<strong>Star：15k</strong></p>
<p>这是一个开源跨平台的 AI 虚拟伴侣，能够将二次元虚拟角色（waifu）等智能体带到你的身边。支持实时文字和语音聊天，可陪你玩 Minecraft、异星工厂等游戏，并提供 Web 端和桌面端应用。</p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoeru-ai%2Fairi" target="_blank" title="https://github.com/moeru-ai/airi" ref="nofollow noopener noreferrer">github.com/moeru-ai/ai…</a></p>
</blockquote>
<p><strong>使用感受</strong>：开箱即用但要是想要真正玩起来，除了文本大模型，还需要配置语音、视觉、声音、记忆等服务。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6d48d22f6b54ba9bc0e4c5016cd6e4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763440246&amp;x-signature=48ZTUKt28P2JR2xJ1T0w3iAb69U%3D" alt="" loading="lazy"/></p>
<p><strong>结论</strong>：懒人无需安装，网页版即可体验。</p>
<h2 data-id="heading-4">五、写在最后</h2>
<p>在体验这些开源项目的过程中，我发现大多数的 LLM 开源项目，都存在绑定 LLM 服务、无法自定义 LLM API 地址、网络问题和部分功能收费等问题。所以体验一圈下来，我只推荐了上面的 4 个开源项目，虽然他们也都或多或少存在不足之处，但最起码能用，而且只需要自备 LLM API 和 key。</p>
<p>说到这里，就必须得感谢下我们的老朋友七牛云。<strong>感谢七牛云无偿发放的抵扣券</strong>，让我可以放心体验。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1101f3a85c7342a2ace4c59499ba4339~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763440246&amp;x-signature=EwTUDnxrcxoTSWei7bGflFtG25A%3D" alt="" loading="lazy"/></p>
<p>如果你也需要一个可靠的大模型服务，我推荐「七牛云 AI 大模型推理服务平台」：<strong>一站式调用 50+ 海内外顶级大模型，兼容 OpenAI 和 Anthropic 的 API 标准</strong>，支持流式调用、MCP，可轻松接入主流 AI 客户端、IDE 与 CLI。</p>
<pre><code class="hljs language-arduino" lang="arduino">curl https:<span class="hljs-comment">//api.qnaigc.com/v1/chat/completions \
  --request POST \
  --header 'Authorization: Bearer &lt;七牛云 AI API KEY&gt;' \
  --header 'Content-Type: application/json' \
  --data '{</span>
  <span class="hljs-string">"stream"</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-string">"model"</span>: <span class="hljs-string">"g-2.5-pro"</span>,
  <span class="hljs-string">"messages"</span>: [
    {
      <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>,
      <span class="hljs-string">"content"</span>: <span class="hljs-string">"你好!"</span>
    }
  ]
}'
</code></pre>
<p>我实测了好几天，<strong>七牛云 AI 大模型服务速度快、靠谱且稳定</strong>。我再贴一张 API 服务的测速结果（测试工具 aiperf.top）</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/619340356c17434989cf2838fc4c45d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763440246&amp;x-signature=LbN86ibYqq5U391LLHe%2FmwO6eac%3D" alt="" loading="lazy"/></p>
<p>如果你也想试试，可以参与七牛云邀请好友得免费 Token 的活动：</p>
<ul>
<li><strong>推广者</strong>：每邀请 1 位好友体验，返 500 万 Token，多邀多得上不封顶。邀请达标最高可得百亿 Token 奖励，单项奖励最高 30 亿 Token。</li>
<li><strong>被邀请者</strong>：首次体验获 300 万 Token，通过好友邀请完成首次体验，还可额外获得 1000 万 Token（可与 300 万叠加）。</li>
<li><strong>所有 Token 奖励自领取/发放之日起，有效期为 2 年。</strong></li>
</ul>
<blockquote>
<p>活动地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fs.qiniu.com%2FIBNrYf" target="_blank" title="https://s.qiniu.com/IBNrYf" ref="nofollow noopener noreferrer">s.qiniu.com</a></p>
</blockquote>
<p>最后，不管你是普通用户，还是准备开发 AI 应用的开发者，搞一个靠谱、优质的 AI 大模型服务 key，肯定有用得着的时候！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI时代，金融科技如何落地“对话就能办业务”？]]></title>    <link>https://juejin.cn/post/7571005077802303498</link>    <guid>https://juejin.cn/post/7571005077802303498</guid>    <pubDate>2025-11-11T03:00:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571005077802303498" data-draft-id="7571060853370617906" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI时代，金融科技如何落地“对话就能办业务”？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-11T03:00:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="FinClip"/> <meta itemprop="url" content="https://juejin.cn/user/395479918322696"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI时代，金融科技如何落地“对话就能办业务”？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/395479918322696/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    FinClip
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T03:00:01.000Z" title="Tue Nov 11 2025 03:00:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在金融行业数字化转型的浪潮中，AI技术的崛起正以前所未有的速度重塑着业务逻辑与技术架构。从颠覆传统风控的智能大脑，到赋能普惠金融的智能投顾，再到驱动精准营销的客户洞察，AI已不再仅仅是提升效率的工具，而是作为一种革命性的力量，重新定义着金融服务的本质与边界。</p>
<p><strong>从“拥有AI”到“用好AI”，金融机构如何破局落地困境？</strong></p>
<p>在2025香港金融科技周上，凡泰极客创始人梁启鸿先生发表了对AI时代金融科技服务价值的深刻见解：尽管金融机构在AI硬件和平台上的投入巨大，但真正的业务场景融合却困难重重。</p>
<p>梁启鸿先生深入剖析了其背后的核心痛点，主要可归结为以下三点： </p>
<p>1、场景价值缺失，AI与业务流程脱节</p>
<p>当前许多金融机构的“AI应用”存在名不符实的问题。其应用形态大多仍固守在智能客服、静态知识库问答等最基础的层面。这类应用本质上只是一个“可对话的说明书”，仅能实现信息查询功能，而缺乏执行具体业务操作、驱动业务流程的自动化能力。对内，员工感受不到工作效率的实质提升；对外，用户体验依然停留在“问什么答什么”的层面，无法通过自然交互完成业务办理，感受不到智能服务的便捷与高效。</p>
<p>2、基础设施断层，缺乏AI原生技术基座</p>
<p>金融机构历经数十年建设的信息系统（Infrastructure），其架构与当前AI所需的技术栈存在巨大“代沟”。传统的IOE架构并非为处理大规模非结构化数据、进行高并发模型推理而设计。因此，支撑AI规模化、常态化应用的“AI Infra”（AI原生基础设施） 普遍缺失。这就像想在一条乡间小路上运行高铁，缺乏合适的轨道，再先进的AI模型也难以在企业内部全速奔跑，实现真正的业务创新。 </p>
<p>3、内部能力受限，难以突破“最后一公里”</p>
<p>金融机构内部并非没有人才，其团队既懂业务也具备IT能力，但在推进AI落地时却往往步履维艰。</p>
<p>他们普遍受困于三方面阻力：一是组织惯性，现有工作流程和部门墙阻碍了AI与业务的快速迭代与融合；二是沉重的技术债务，改造历史悠久的核心系统成本高、风险大；三是资源分配挑战，在保障系统稳定运行的同时，难以抽调足够资源进行前沿探索，难以独立完成从技术验证到规模化应用的“最后一公里”，无法产生规模价值。</p>
<p><strong>FinClip+AI：会话流与点击流的融合创新</strong></p>
<p>面对以上挑战，梁启鸿分享了凡泰极客的价值定位思考。他认为，科技服务商的独特价值不在于“比客户更懂业务”，而在于帮助金融机构跨越从“有AI”到“用AI”的鸿沟，尤其是在那些关键的“最后一公里”中积累系统化能力。 </p>
<p>“大模型本地化部署后的多模型调度、数据存储与治理、前端用户体验设计、业务流程嵌入……这些细节虽不炫目，却决定了AI能否真正落地。”梁启鸿强调，凡泰极客专注于构建“AI中间件”，不是简单地调用API接口、做一层“AI皮肤”，而是搭建稳定、可扩展、可量化的技术桥梁，让AI能力真正融入金融机构的日常运营。</p>
<p><strong>三大能力，深入业务场景，构建可持续价值</strong></p>
<p>科技服务商需要既要深入业务场景，构建符合需求的基础设施，又要避免被大模型厂商“吞噬”，保持自身的技术独立性与迭代能力。梁先生特别强调，如果不能证明AI应用的实际效果、缺乏可衡量的价值输出，这样的技术堆砌终将被市场淘汰。 </p>
<p>对于未来发展趋势，梁启鸿提出了独到见解：AI正在重塑用户与产品交互的方式，用户既渴望"说话就能办业务"的自然交互，又需要精准可控的功能操作。 </p>
<p>凡泰极客推出的FinClip ChatKit，正是为这一融合趋势而生的AI组件，具备三大核心能力： </p>
<p>上下文管理：通过整合用户实时信息，让AI从"会聊天"升级为"能理解"； </p>
<p>生成式UI框架：支持在对话中动态生成可交互界面，实现从"听懂"到"执行"的无缝衔接； </p>
<p>安全沙箱：通过三层防护机制，在释放AI能力的同时确保企业安全可控。 </p>
<p>通过三大能力的协同，FinClip ChatKit有效破解金融机构在AI落地最后一公里的难题，让智能服务真正融入业务场景。</p>
<p>无论是业务查询、产品购买还是复杂业务流程，用户都能在自然对话与精准操作间自由切换，享受更智能、更安全的数字金融服务体验。 </p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fdf5414c8a884833b7ac4d980ef2fd5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRmluQ2xpcA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763434801&amp;x-signature=vDFXUmiuV27T8cRmYghN4kTpR%2BA%3D" alt="图片" loading="lazy"/></p>
<p>传统的“点击流”与新兴的“会话流”并非对立，而是互补，未来的金融APP，需要融合点击与对话，在复杂业务与大众化服务之间找到平衡，为用户提供更自然、更高效的体验。</p>
<p><strong>从“技术供应商”到“AI落地共建者”</strong></p>
<p>AI技术的真正价值不在于技术本身，而在于其对业务模式的重塑能力。凡泰极客正从传统的技术供应商，转型为金融机构的“数字化共创伙伴”。 这种新型合作关系不取代客户的业务主导权，而是通过技术赋能，帮助金融机构在AI时代建立可持续的创新能力。 </p>
<p>“这条路不易，但值得坚持。”梁启鸿先生最后强调，真正推动行业进步的，从来不是技术的堆叠，而是技术与业务之间那最后一公里的、持续而坚定的桥梁搭建。 </p>
<p>如果您的机构也正面临AI落地难题，或希望探索“会话流+点击流”融合体验在实际业务场景中的应用：</p>
<p> ✅ 欢迎免费咨询FinClip ChatKit场景解决方案</p>
<p> ✅ 申请预约产品演示与技术交流</p>
<p> ✅ 获取金融行业AI交互方案</p>
<p>📩 联系我们：<a href="https://link.juejin.cn?target=https%3A%2F%2Ffinclip.com%2F" target="_blank" title="https://finclip.com/" ref="nofollow noopener noreferrer">finclip.com/</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[阿里巴巴 AI Coding 分享会 —— Qoder Together 广州站来啦！]]></title>    <link>https://juejin.cn/post/7571007466822631476</link>    <guid>https://juejin.cn/post/7571007466822631476</guid>    <pubDate>2025-11-11T03:08:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571007466822631476" data-draft-id="7571007466822549556" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="阿里巴巴 AI Coding 分享会 —— Qoder Together 广州站来啦！"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-11-11T03:08:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云云原生"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            阿里巴巴 AI Coding 分享会 —— Qoder Together 广州站来啦！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云云原生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T03:08:40.000Z" title="Tue Nov 11 2025 03:08:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><ul>
<li>时间：11 月 16 日</li>
<li>地点：广州阿里中心</li>
</ul>
<p>一场专属于开发者与 AI 编程爱好者的线下聚会！</p>
<p>🔹 与 Qoder 技术团队面对面，聊聊产品的深入解析和应用</p>
<p>🔹 听资深用户分享使用 Qoder 的实战经验与技巧</p>
<p>🔹 现场 AI Coding 黑客松，一起体验智能编程的新范式，边写边学边碰撞</p>
<p>无论你是好奇 AI 编程的新手，还是深度玩家，这里都有你的位置！</p>
<p>现场还有惊喜彩蛋 &amp; 限量周边等你来拿～</p>
<p><strong>点击下方链接立即报名</strong>：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.huodongxing.com%2Fevent%2F8832377969300" target="_blank" title="https://www.huodongxing.com/event/8832377969300" ref="nofollow noopener noreferrer">www.huodongxing.com/event/88323…</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78cbfaef80cb41bcb5de479b78d45f9f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763435320&amp;x-signature=dNOrnh46B7YkYkPQyc%2FsjshrMsA%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[教你如何设计一个高价值的 Prompt：从思维到架构实现]]></title>    <link>https://juejin.cn/post/7571176484515266612</link>    <guid>https://juejin.cn/post/7571176484515266612</guid>    <pubDate>2025-11-11T02:44:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571176484515266612" data-draft-id="7571007466822418484" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="教你如何设计一个高价值的 Prompt：从思维到架构实现"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-11T02:44:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="DBLens数据库管理和开发工具"/> <meta itemprop="url" content="https://juejin.cn/user/1071389652820281"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            教你如何设计一个高价值的 Prompt：从思维到架构实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1071389652820281/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    DBLens数据库管理和开发工具
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T02:44:32.000Z" title="Tue Nov 11 2025 02:44:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    19
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Prompt（提示词）是人与 AI 之间的“编程语言”。它决定了 AI 输出的质量、方向和可控性。要设计出高价值 Prompt，就像设计一张高效的数据库表：要结构清晰、字段明确、逻辑自洽。本文将教你如何用“<strong>表、视图、函数、事件</strong>”四层思维，构建你的 Prompt 设计系统。</p>
<hr/>
<h2 data-id="heading-0">一、表（Table）——构建 Prompt 的数据模型</h2>
<p>表是信息的载体。设计 Prompt 时，首先要建立“表结构”，明确输入、输出和上下文。可以将 Prompt 拆解为四个核心字段：</p>






























<table><thead><tr><th>字段</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><strong>目标 (Goal)</strong></td><td>你希望 AI 达成的目的</td><td>“生成一份市场调研报告”</td></tr><tr><td><strong>角色 (Role)</strong></td><td>告诉 AI 扮演的身份</td><td>“你是一名市场分析师”</td></tr><tr><td><strong>输入 (Input)</strong></td><td>提供原始素材或数据</td><td>“以下是我们竞争对手的产品描述”</td></tr><tr><td><strong>约束 (Constraints)</strong></td><td>输出的风格、格式、限制</td><td>“使用表格展示结果，字数不超过1000字”</td></tr></tbody></table>
<p>👉 一个高质量 Prompt 的“表结构”示例：</p>
<pre><code class="hljs">角色：你是一位经验丰富的数据库架构师。
目标：设计一个能帮助初学者理解数据库规范化的课程大纲。
输入：目标受众为大学生，课程时长为3小时。
约束：结构清晰，包含章节标题、学习目标、案例。
</code></pre>
<p>这就相当于一张表的完整定义，AI 能快速理解任务上下文。</p>
<hr/>
<h2 data-id="heading-1">二、视图（View）——复用与聚合不同场景的 Prompt</h2>
<p>视图是数据库中对多张表的抽象集合。同理，一个“视图式 Prompt”可以在不同任务中复用核心逻辑。</p>
<p>例如，我们可以创建“写作助手视图”：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> 写作助手 <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span>
  Role <span class="hljs-operator">=</span> "你是一名专业写作教练",
  Goal <span class="hljs-operator">=</span> "帮助用户优化文本内容",
  Constraints <span class="hljs-operator">=</span> "输出应包含：修改建议、改进后的版本"
</code></pre>
<p>在不同任务中，只需要在输入字段中更换内容即可：</p>
<pre><code class="hljs language-text" lang="text">Input = "以下是一段用户写的产品文案：……"
</code></pre>
<p>这样就实现了 <strong>Prompt 模板化 + 场景复用</strong>，避免每次从零开始。</p>
<hr/>
<h2 data-id="heading-2">三、函数（Function）——逻辑运算与动态生成 Prompt</h2>
<p>函数可以理解为 Prompt 的“自动化逻辑”，通过参数化实现动态生成。</p>
<h3 data-id="heading-3">✅ 示例：生成 Prompt 的函数</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_prompt</span>(<span class="hljs-params">role, goal, input_text, constraints</span>):
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"""
角色：<span class="hljs-subst">{role}</span>
目标：<span class="hljs-subst">{goal}</span>
输入：<span class="hljs-subst">{input_text}</span>
约束：<span class="hljs-subst">{constraints}</span>
"""</span>
</code></pre>
<p>调用时：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-built_in">print</span>(generate_prompt(
    role=<span class="hljs-string">"你是一名AI产品经理"</span>,
    goal=<span class="hljs-string">"撰写一份Prompt设计培训课程"</span>,
    input_text=<span class="hljs-string">"受众为企业内部产品经理团队"</span>,
    constraints=<span class="hljs-string">"逻辑清晰，含实战案例"</span>
))
</code></pre>
<p>输出结果就是一份高质量 Prompt。这种函数化思维，让 Prompt 设计从“艺术”变成了“工程”。</p>
<hr/>
<h2 data-id="heading-4">四、事件（Event）——让 Prompt 有状态、有反应</h2>
<p>事件（Event）相当于触发器，可以让 AI 对不同输入状态自动响应。例如：</p>
<ul>
<li><strong>on_input</strong>：当用户输入新信息时，自动补全提示。</li>
<li><strong>on_feedback</strong>：根据用户反馈调整 Prompt。</li>
<li><strong>on_context_change</strong>：当任务上下文改变时，重构 Prompt。</li>
</ul>
<h3 data-id="heading-5">示例：动态事件响应 Prompt</h3>
<pre><code class="hljs language-markdown" lang="markdown">当用户输入一个新主题时：
<span class="hljs-bullet">    -</span> 检查是否与现有上下文冲突；
<span class="hljs-bullet">    -</span> 如果冲突，则提示“是否重置对话上下文？”；
<span class="hljs-bullet">    -</span> 否则自动扩展 Prompt。
</code></pre>
<p>这类事件逻辑可嵌入应用层（例如通过 LangChain、Flowise 等框架），形成智能 Prompt 系统。</p>
<hr/>
<h2 data-id="heading-6">五、整合示例：高价值 Prompt 设计蓝图</h2>
<p>一个高价值 Prompt 系统就像一个数据库架构：</p>






























<table><thead><tr><th>层级</th><th>功能</th><th>示例</th></tr></thead><tbody><tr><td>表</td><td>定义基础结构</td><td>角色、目标、输入、约束</td></tr><tr><td>视图</td><td>提供任务模板</td><td>写作助手、代码审查、商业报告</td></tr><tr><td>函数</td><td>动态生成逻辑</td><td>根据参数自动拼接 Prompt</td></tr><tr><td>事件</td><td>响应状态变化</td><td>用户反馈触发优化</td></tr></tbody></table>
<p>📘 示例完整 Prompt：</p>
<pre><code class="hljs">角色：你是一名AI写作教练。
目标：帮助我优化一篇关于Prompt设计的文章，使其更具逻辑性和教育性。
输入：以下是原文……
约束：输出分为“修改建议”和“改进后文本”，使用中文表达。
</code></pre>
<hr/>
<h2 data-id="heading-7">六、总结：让 Prompt 设计成为一门“可维护的工程”</h2>
<ul>
<li><strong>结构化思维</strong>：用数据库建模法定义 Prompt。</li>
<li><strong>模块化设计</strong>：用视图、函数实现可复用逻辑。</li>
<li><strong>事件驱动优化</strong>：通过反馈和触发器不断改进。</li>
</ul>
<p>最终，你会拥有一套能<strong>持续进化、自动优化</strong>的 Prompt 系统，而不仅仅是一个提示词。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[处理volta切换node版本之后pnpm没有识别的问题]]></title>    <link>https://juejin.cn/post/7570995368738603050</link>    <guid>https://juejin.cn/post/7570995368738603050</guid>    <pubDate>2025-11-11T03:19:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570995368738603050" data-draft-id="7570975737635340329" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="处理volta切换node版本之后pnpm没有识别的问题"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-11T03:19:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="火车叼位"/> <meta itemprop="url" content="https://juejin.cn/user/1345457960792808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            处理volta切换node版本之后pnpm没有识别的问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1345457960792808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    火车叼位
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T03:19:40.000Z" title="Tue Nov 11 2025 03:19:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为前端开发者，我们追求极致的开发效率。Volta 带来了无感的 Node.js 版本切换，而 pnpm 则以其高效的磁盘利用率和快速的安装速度成为我们的首选包管理器。但当这两大神器相遇时，一个恼人的问题时常出现：<code>volta pin</code> 的 Node 版本和 <code>pnpm</code> 实际使用的版本不一致，导致环境混乱，构建失败。
别担心，这个问题有解！本文将带你一步步定位问题、解决问题，并验证效果，确保你的开发环境坚如磐石。</p>
<h2 data-id="heading-0">问题复现：眼见为实</h2>
<p>让我们先通过一个简单的实验来重现这个冲突。
<strong>1. 初始化项目</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> volta-pnpm-test &amp;&amp; <span class="hljs-built_in">cd</span> volta-pnpm-test
npm init -y
</code></pre>
<p><strong>2. 修改 <code>package.json</code></strong>
在 <code>package.json</code> 的 <code>scripts</code> 中加入一个用于查看 Node 版本的命令：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"volta-pnpm-test"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"node-v"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node --version"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>3. 使用 Volta 固定 Node 版本</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 固定项目使用 Node.js 18</span>
volta pin node@18
</code></pre>
<p><strong>4. 验证版本冲突</strong>
现在，关键的时刻来了。我们分别使用 <code>npm</code> 和 <code>pnpm</code> 来执行同一个脚本：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 npm 执行，会调用 Volta 管理的 Node</span>
npm run node-v
<span class="hljs-comment"># 预期输出: v18.x.x</span>
<span class="hljs-comment"># 使用 pnpm 执行，可能会调用系统的全局 Node 或其他路径的 Node</span>
pnpm run node-v
<span class="hljs-comment"># 可能输出: v16.x.x 或其他版本 (与 v18.x.x 不符)</span>
</code></pre>
<p>如果 <code>pnpm run node-v</code> 的输出与 <code>npm run node-v</code> 不一致，你就遇到了我们今天要解决的问题。</p>
<h2 data-id="heading-1">根源分析：为什么会产生冲突？</h2>
<p>默认情况下，Volta 通过代理机制（shim）来接管 <code>node</code>、<code>npm</code> 等命令。当你运行 <code>node</code> 时，实际上是运行了 Volta 的代理，由它来找到并执行正确的 Node 版本。
然而，<code>pnpm</code> 在执行脚本时，为了追求极致性能，可能会绕过 Volta 的代理机制，直接使用它自己找到的 <code>node</code> 路径（例如，系统 PATH 中的第一个 <code>node</code>），这就导致了版本不一致。</p>
<h2 data-id="heading-2">解决方案：启用 <code>VOLTA_FEATURE_PNPM</code></h2>
<p>Volta 官方早已预见到了这个问题，并提供了一个内置的解决方案：<code>VOLTA_FEATURE_PNPM</code> 环境变量。启用它，就等于告诉 Volta：“请接管 pnpm 的 Node 版本管理！”</p>
<h3 data-id="heading-3">配置步骤</h3>
<p><strong>对于 macOS / Linux:</strong>
打开你的 shell 配置文件（如 <code>~/.zshrc</code>, <code>~/.bash_profile</code>），在文件末尾添加：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> VOLTA_FEATURE_PNPM=1
</code></pre>
<p>然后，让配置生效：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">source</span> ~/.zshrc  <span class="hljs-comment"># 或 source ~/.bash_profile</span>
</code></pre>
<p><strong>对于 Windows:</strong></p>
<ol>
<li>打开“系统属性” -&gt; “高级” -&gt; “环境变量”。</li>
<li>在“用户变量”或“系统变量”中，点击“新建”。</li>
<li>变量名填入：<code>VOLTA_FEATURE_PNPM</code></li>
<li>变量值填入：<code>1</code></li>
<li>点击确定保存。重启你的终端即可。</li>
</ol>
<h2 data-id="heading-4">效果验证：见证和谐的一刻</h2>
<p>配置完成后，让我们回到刚才的项目，再次验证。
<strong>1. 重新固定 Node 版本（或切换版本）</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 切换到 Node.js 22</span>
volta pin node@22
</code></pre>
<p><strong>2. 再次验证</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 npm 执行</span>
npm run node-v
<span class="hljs-comment"># 输出: v22.x.x</span>
<span class="hljs-comment"># 使用 pnpm 执行</span>
pnpm run node-v
<span class="hljs-comment"># 输出: v22.x.x (与 npm 输出完全一致！)</span>
</code></pre>
<h3 data-id="heading-5">现在，无论你是用 <code>npm run</code> 还是 <code>pnpm run</code>，脚本执行的 Node 版本都严格遵守 <code>volta pin</code> 的设定，冲突彻底解决！</h3>
<h3 data-id="heading-6"><strong>快速备忘单</strong></h3>













































<table><thead><tr><th align="left">场景</th><th align="left">命令/配置</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><strong>固定项目 Node 版本</strong></td><td align="left"><code>volta pin node@18</code></td><td align="left">在项目根目录生成 <code>volta.json</code></td></tr><tr><td align="left"><strong>验证版本 (npm)</strong></td><td align="left"><code>npm run node-v</code></td><td align="left">应显示 Volta 固定的版本</td></tr><tr><td align="left"><strong>验证版本 (pnpm)</strong></td><td align="left"><code>pnpm run node-v</code></td><td align="left"><strong>问题点：</strong> 可能显示不同版本</td></tr><tr><td align="left"><strong>启用 Volta 对 pnpm 的支持</strong></td><td align="left"><code>export VOLTA_FEATURE_PNPM=1</code></td><td align="left"><strong>解决方案：</strong> 添加到 shell 配置文件</td></tr><tr><td align="left"><strong>Windows 环境变量</strong></td><td align="left"><code>VOLTA_FEATURE_PNPM=1</code></td><td align="left">在系统环境变量中设置</td></tr><tr><td align="left"><strong>验证修复</strong></td><td align="left"><code>pnpm run node-v</code></td><td align="left"><strong>修复后：</strong> 应显示与 npm 一致的版本</td></tr><tr><td align="left"><strong>查看所有已安装工具</strong></td><td align="left"><code>volta list all</code></td><td align="left">管理 Volta 安装的所有工具</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS 抓包软件哪款更适合团队？工具职责、实战流程与替代方案解析]]></title>    <link>https://juejin.cn/post/7570976274238177326</link>    <guid>https://juejin.cn/post/7570976274238177326</guid>    <pubDate>2025-11-11T03:25:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570976274238177326" data-draft-id="7571005077802467338" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS 抓包软件哪款更适合团队？工具职责、实战流程与替代方案解析"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-11T03:25:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aiopencode"/> <meta itemprop="url" content="https://juejin.cn/user/1898230261493865"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS 抓包软件哪款更适合团队？工具职责、实战流程与替代方案解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1898230261493865/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aiopencode
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T03:25:12.000Z" title="Tue Nov 11 2025 03:25:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 iOS 开发与运维场景中，<strong>iOS 抓包软件</strong>不仅是定位接口异常的第一步，更决定了排查效率与复现能力。本文从工程视角出发，按功能模块讲清常用抓包工具的职责、可复制的排查流程、遇到代理或加密链路受限时的替代方案，以及如何把工具组合成一套可交付的分析链路。</p>
<h2 data-id="heading-0">工具按职责拆分（别把所有事都交给一个工具）</h2>
<ul>
<li><strong>代理式抓包（应用层，解密）</strong>：Charles、Fiddler、Proxyman、mitmproxy。适合快速查看请求/响应、断点修改、模拟异常回包。前提：终端必须能安装并信任代理 CA。</li>
<li><strong>底层抓包与协议分析</strong>：tcpdump / tshark / Wireshark。在网关或后端抓 <code>-s 0</code> 的 pcap，适用于分析 TCP 三次握手、TLS 握手、重传、UDP（QUIC）等底层问题。</li>
<li><strong>脚本化与自动化</strong>：mitmproxy 脚本、pyshark、scapy。用于批量提取 TLS Alert、统计重传或自动化回放。</li>
<li><strong>补充型抓包工具</strong>：当代理不可用或不能在终端上信任 CA、遇到证书 pinning、mTLS 或 QUIC 边界协议时，需要能按 App/域名过滤并导出 pcap 的方案（便于与后端 pcap 做逐帧对比）。抓包大师（Sniffmaster）在这类流程中可作为补充工具，支持按进程/域名过滤、HTTPS 抓取与解密、拦截器与 JavaScript 脚本改写、导出 Wireshark 兼容 pcap 和单包二进制。</li>
</ul>
<hr/>
<h2 data-id="heading-1">抓包前必须准备的三件事</h2>
<ol>
<li><strong>明确目标层级</strong>：网络层（TCP）、传输层（TLS）还是应用层（HTTP）？先定层级再抓。</li>
<li><strong>记录复现信息</strong>：终端型号、系统版本、App 版本、网络类型、精确时间（秒）与 request-id。</li>
<li><strong>合规与过滤</strong>：生产抓包要限定时间窗、使用最小化过滤（IP/端口/时间），并按安全规范加密存储导出文件。</li>
</ol>
<hr/>
<h2 data-id="heading-2">可复制的排查流程（TCP → TLS → HTTP）</h2>
<ol>
<li><strong>TCP 层</strong>：确认三次握手是否完成。后端常用命令：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">sudo tcpdump -i any host &lt;client_ip&gt; and port 443 -s 0 -w /tmp/cap.pcap
</code></pre>
<p>查看是否存在 SYN、SYN/ACK、RST 或重传。
\2. <strong>TLS 层</strong>：检查 ClientHello（SNI、cipher）、ServerHello、证书链与 TLS Alert：</p>
<pre><code class="hljs language-bash" lang="bash">openssl s_client -connect api.example.com:443 -servername api.example.com -showcerts
</code></pre>
<p>在 Wireshark 中过滤 <code>tls.handshake.type == 1</code> 与 <code>tls.alert_message</code>。
\3. <strong>应用层</strong>：在能解密的环境用 Charles 或 mitmproxy 检查请求头、签名、Cookie 与响应体；若代理不可行，依赖 pcap 与上下游日志比对。</p>
<hr/>
<h2 data-id="heading-3">常见难点与对策（针对 iOS 抓包软件场景）</h2>
<ul>
<li><strong>证书 pinning / 自定义 TLS</strong>：若浏览器能抓但 App 不能，通常是 pinning 或内置 TLS 导致。短期：请开发提供测试构建或打开 debug 开关；长期：pin 公钥（SPKI）并保留备用 key。</li>
<li><strong>HTTP/3（QUIC）</strong>：QUIC 使用 UDP（通常 UDP/443），传统 TCP 代理与某些抓包工具无效。对策：在测试环境强制退回到 TCP+HTTP/2 或在服务端抓 UDP 包进行验证。</li>
<li><strong>企业网络或运营商中间件</strong>：若问题只在某类网络复现，抓取该网络下的后端 pcap 并比对客户端看到的证书 Issuer，可判断是否存在透明代理替换证书。</li>
</ul>
<hr/>
<h2 data-id="heading-4">抓包大师（Sniffmaster）在常见场景的应用说明</h2>
<p>抓包大师的功能设计贴合工程化排查需要：无需修改 App 即可按进程/域名过滤抓取数据流、支持 HTTPS 抓取与受控解密、内建拦截器并允许用 JavaScript 脚本修改请求/响应、能导出 Wireshark 兼容的 pcap 与单包二进制，便于与后端 tcpdump 文件逐帧对比。将其作为“替代/补抓”工具可以解决代理受限、pinning 或 QUIC 场景下的盲区。</p>
<hr/>
<h2 data-id="heading-5">交付样板：一次合格的抓包分析应包含</h2>
<ul>
<li>复现时间窗（精确到秒）与请求标识（request-id / trace-id）</li>
<li>抓包位置与文件（server.pcap / capture.pcap），并加密保存</li>
<li>Wireshark 关键帧截图（ClientHello、tls.alert、HTTP Header）</li>
<li>分析结论（定位：终端/网络中间件/服务端）与可执行修复建议（如补 fullchain、放行 QUIC、调整 pin 策略）</li>
</ul>
<hr/>
<h2 data-id="heading-6">建议</h2>
<p>选择 iOS 抓包软件时，别只看界面好看与否，要按职责分配工具：代理类用于快速联调，tcpdump/Wireshark 用于证据化分析，脚本化工具用于自动化统计，而在代理无效或协议边界时用能按 App/域名过滤并导出 pcap 的补充工具（如抓包大师 Sniffmaster）能把许多“无法复现”的问题变成可验证的工单。
标准化抓包与交付流程、脚本化常用命令，会显著提升团队的故障定位效率。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何解决 uv run 因网络问题导致的 Python 下载失败]]></title>    <link>https://juejin.cn/post/7571005077802483722</link>    <guid>https://juejin.cn/post/7571005077802483722</guid>    <pubDate>2025-11-11T03:31:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571005077802483722" data-draft-id="7569889957743362074" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何解决 uv run 因网络问题导致的 Python 下载失败"/> <meta itemprop="keywords" content="Python,GitHub"/> <meta itemprop="datePublished" content="2025-11-11T03:31:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mortimer"/> <meta itemprop="url" content="https://juejin.cn/user/4441682704623992"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何解决 uv run 因网络问题导致的 Python 下载失败
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4441682704623992/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mortimer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T03:31:40.000Z" title="Tue Nov 11 2025 03:31:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;font-weight:400;line-height:2;font-size:17px;overflow-x:hidden;color:#000}.markdown-body strong{padding:1px;color:#ee3f4d}.markdown-body em{padding:0 2px;color:#f33b1f}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;margin-top:30px;margin-bottom:20px;line-height:1.5;font-weight:700}.markdown-body h1{text-align:center;padding-bottom:5px;font-size:32px;color:#ac1f18}.markdown-body h1:after{content:"";display:block;margin:4px auto 0;width:100px;height:2px;border-bottom:2px solid #f33b1f}.markdown-body h2{font-size:28px;border-bottom:1px solid #f33b1f}.markdown-body h2:before{content:"# "!important;color:#f33b1f}.markdown-body h3{font-size:24px;padding-left:9px;border-left:6px solid #f33b1f}.markdown-body h4{font-size:20px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #bbb;margin:16px 0}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:#f9f1db;color:#ee2746;border-radius:2px;font-size:16px;padding:1px 2px}.markdown-body code,.markdown-body pre{font-family:-apple-system,-apple-system-body,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,PingFang SC,思源黑体 CN,思源黑体,JetBrains Mono,Fira Code,Menlo,Ubuntu Mono,Consolas,sans-serif}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{margin:12px 0!important;border-radius:3px;font-size:15px;padding:16px 12px;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f7f7f7}.markdown-body a{text-decoration:none;color:#1781b5;padding:0 2px;border-bottom:1px solid #1781b5}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #f33b1f;color:#ac1f18}.markdown-body blockquote{color:#3d3d3d;background-color:#fff9f9;padding:6px 16px;margin:16px 0;border-left:3px solid #f07c82}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:6px 0}.markdown-body ol,.markdown-body ul{padding-left:30px}.markdown-body ol li,.markdown-body ul li{margin-bottom:6px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:6px}.markdown-body ol li{padding-left:6px}.markdown-body ::marker{color:#f33b1f}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body .task-list-item input[type=checkbox]{position:relative}.markdown-body .task-list-item input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:#fff;border:1px solid #f07c82;border-radius:3px;box-sizing:border-box;z-index:1}.markdown-body .task-list-item input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-5px;left:0;right:0;bottom:0;width:0;height:0;color:#f33b1f;font-size:16px;font-weight:700;z-index:2}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border-spacing:0;border-collapse:collapse}.markdown-body table thead{background:#fff9f9;color:#000;text-align:left;font-size:15px}.markdown-body table tr:nth-child(2n){background-color:#fcfcfc}.markdown-body table tr:hover{background-color:#fff9f9}.markdown-body table td,.markdown-body table th{padding:12px 7px;line-height:24px;border:1px solid #f9f1db}.markdown-body table td{min-width:120px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><p><code>uv</code> 是一个极其出色的 Python 项目和虚拟环境管理工具。通过简单的 <code>uv run &lt;你的脚本.py&gt;</code> 命令，它就能在后台自动下载所需的 Python 版本并配置好运行环境，整个过程丝滑流畅。</p>
<p>然而，由于 <code>uv</code> 默认从 GitHub.com 下载预编译的 Python，限于墙的威力，可能会遇到连接超时或下载失败的问题。错误信息通常如下图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f25e823aab644fc6ac6e1f8935f435ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbW9ydGltZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763436700&amp;x-signature=jiRKlFyaWYKdr%2BV2MqW4BBMOSvA%3D" alt="" loading="lazy"/></p>
<p>当看到这个错误时，请不要担心，这只是网络问题。我们可以通过“手动搬运”的方式轻松解决。下面是详细的操作步骤。</p>
<h2 data-id="heading-0">第一步：解读错误信息，定位所需版本</h2>
<p>首先，仔细查看终端里的报错信息。您需要从里面找到两个关键信息：</p>
<ol>
<li><strong>Python 版本</strong>: 类似 <code>cpython-3.12.0</code> 这样的字符串，这告诉我们 <code>uv</code> 尝试下载的是 <code>3.12.0</code> 版本的 CPython。</li>
<li><strong>系统架构</strong>: 紧跟在版本号后面的部分，例如 <code>aarch64-apple-darwin</code> 代表 ARM 架构的 macOS 系统，而 Windows 用户通常会看到 <code>x86_64-pc-windows</code> 或类似的标识。</li>
</ol>
<p>掌握这两个信息后，我们就可以准备手动下载了。</p>
<h2 data-id="heading-1">第二步：手动下载对应的 Python 压缩包</h2>
<p>根据您在第一步中确定的 <strong>Python 版本</strong>和<strong>系统架构</strong>，访问以下地址，找到并下载对应的 <code>.tar.gz</code> 压缩包。</p>
<p>这里列出了一些常见 Windows (<code>x86_64-windows</code>) 版本的下载链接：</p>
<ul>
<li>
<p><strong>Python 3.14.x（如果显示 <code>3.14.</code> 开头，可以下载这个）</strong></p>
<ul>
<li><code>x86_64-windows</code>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fastral-sh%2Fpython-build-standalone%2Freleases%2Fdownload%2F20251007%2Fcpython-3.14.0%2B20251007-x86_64-pc-windows-msvc-install_only.tar.gz" target="_blank" title="https://github.com/astral-sh/python-build-standalone/releases/download/20251007/cpython-3.14.0+20251007-x86_64-pc-windows-msvc-install_only.tar.gz" ref="nofollow noopener noreferrer">github.com/astral-sh/p…</a></li>
</ul>
</li>
<li>
<p><strong>Python 3.13.x（如果显示 <code>3.13.</code> 开头，可以下载这个）</strong></p>
<ul>
<li><code>x86_64-windows</code>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fastral-sh%2Fpython-build-standalone%2Freleases%2Fdownload%2F20251031%2Fcpython-3.13.9%2B20251031-x86_64-pc-windows-msvc-install_only.tar.gz" target="_blank" title="https://github.com/astral-sh/python-build-standalone/releases/download/20251031/cpython-3.13.9+20251031-x86_64-pc-windows-msvc-install_only.tar.gz" ref="nofollow noopener noreferrer">github.com/astral-sh/p…</a></li>
</ul>
</li>
<li>
<p><strong>Python 3.12.x（如果显示 <code>3.12.</code>开头，可以下载这个）</strong></p>
<ul>
<li><code>x86_64-windows</code>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fastral-sh%2Fpython-build-standalone%2Freleases%2Fdownload%2F20231002%2Fcpython-3.12.0%2B20231002-x86_64-pc-windows-msvc-static-install_only.tar.gz" target="_blank" title="https://github.com/astral-sh/python-build-standalone/releases/download/20231002/cpython-3.12.0+20231002-x86_64-pc-windows-msvc-static-install_only.tar.gz" ref="nofollow noopener noreferrer">github.com/astral-sh/p…</a></li>
</ul>
</li>
<li>
<p><strong>Python 3.11.x（如果显示 <code>3.11.</code> 开头，可以下载这个）</strong></p>
<ul>
<li><code>x86_64-windows</code>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fastral-sh%2Fpython-build-standalone%2Freleases%2Fdownload%2F20251031%2Fcpython-3.11.14%2B20251031-x86_64-pc-windows-msvc-install_only.tar.gz" target="_blank" title="https://github.com/astral-sh/python-build-standalone/releases/download/20251031/cpython-3.11.14+20251031-x86_64-pc-windows-msvc-install_only.tar.gz" ref="nofollow noopener noreferrer">github.com/astral-sh/p…</a></li>
</ul>
</li>
<li>
<p><strong>Python 3.10.x（如果显示 <code>3.10.</code> 开头，可以下载这个）</strong></p>
<ul>
<li><code>x86_64-windows</code>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fastral-sh%2Fpython-build-standalone%2Freleases%2Fdownload%2F20251031%2Fcpython-3.10.19%2B20251031-x86_64-pc-windows-msvc-install_only.tar.gz" target="_blank" title="https://github.com/astral-sh/python-build-standalone/releases/download/20251031/cpython-3.10.19+20251031-x86_64-pc-windows-msvc-install_only.tar.gz" ref="nofollow noopener noreferrer">github.com/astral-sh/p…</a></li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>提示</strong>：如果您的版本或系统不在此列，可以访问 <code>uv</code> 的 Python 构建发布页面 <code>https://github.com/astral-sh/python-build-standalone/releases</code> 自行查找。</p>
</blockquote>
<h2 data-id="heading-2">第三步：解压并正确重命名文件夹</h2>
<p>下载完成后，您会得到一个 <code>.tar.gz</code> 格式的压缩文件。</p>
<ol>
<li>
<p><strong>解压文件</strong>：将其完全解压。解压后，您会得到一个名为 <code>python</code> 的文件夹。</p>
</li>
<li>
<p><strong>重命名文件夹</strong>：这是最关键的一步！您需要将这个 <code>python</code> 文件夹重命名为 <code>uv</code> 能够识别的格式。命名规则通常是 <code>&lt;解释器&gt;-&lt;版本&gt;-&lt;平台&gt;-&lt;架构&gt;-&lt;ABI&gt;</code>。</p>
<p>如果你是从上面列出的下载链接进行的下载，那么重命名规则如下：</p>
<ul>
<li><code>3.14.x</code> 版本应重命名为: <strong><code>cpython-3.14.0-windows-x86_64-none</code></strong></li>
<li><code>3.13.x</code> 版本应重命名为: <strong><code>cpython-3.13.9-windows-x86_64-none</code></strong></li>
<li><code>3.12.x</code> 版本应重命名为: <strong><code>cpython-3.12.0-windows-x86_64-none</code></strong></li>
<li><code>3.11.x</code> 版本应重命名为: <strong><code>cpython-3.11.14-windows-x86_64-none</code></strong></li>
<li><code>3.10.x</code> 版本应重命名为: <strong><code>cpython-3.10.19-windows-x86_64-none</code></strong></li>
<li>...以此类推。</li>
</ul>
<p>重命名后的文件夹如下图所示：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6c7f0acf37642469d90dff158e24189~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbW9ydGltZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763436700&amp;x-signature=T8eYOCUF6syHoCHFETi%2Bqo5E%2FrQ%3D" alt="" loading="lazy"/></p>
</li>
</ol>
<h2 data-id="heading-3">第四步：将文件夹放入 <code>uv</code> 的 Python 安装目录</h2>
<p>接下来，我们需要将这个重命名好的文件夹“搬”到 <code>uv</code> 存放 Python 解释器的地方。</p>
<ol>
<li>
<p><strong>打开 AppData 目录</strong>：在 Windows 上，这个目录通常位于 <code>%APPDATA%</code> (即 <code>Roaming</code> 文件夹)下。打开任意文件夹，在地址栏输入 <code>%APPDATA%</code>，然后回车，即进入该文件夹。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4008c040c3cc459f86cdffa8de31a2e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbW9ydGltZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763436700&amp;x-signature=L%2BZoNzvTIqULHafMXewuH1FkF4U%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>定位或创建目标路径</strong>：</p>
<ul>
<li>首先，找到或新建一个名为 <code>uv</code> 的文件夹。</li>
<li>接着进入 <code>uv</code> 文件夹，再找到或新建一个名为 <code>python</code> 的文件夹。</li>
</ul>
</li>
<li>
<p><strong>复制文件夹</strong>：将您在第三步中重命名好的 Python 文件夹（例如 <code>cpython-3.11.14-windows-x86_64-none</code>）复制或移动到这个 <code>python</code> 目录中。</p>
<p>最终的文件结构应如下图所示：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/612c9fd6f4fc42b4a30685d40d624867~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbW9ydGltZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763436700&amp;x-signature=MTA386x5MOu5044Kq5C32MDr5Wc%3D" alt="" loading="lazy"/></p>
</li>
</ol>
<h2 data-id="heading-4">第五步：大功告成，重新执行命令</h2>
<p>现在，所有准备工作都已完成。回到您的终端，重新执行之前的 <code>uv run &lt;脚本.py&gt;</code> 命令。</p>
<p>这一次，<code>uv</code> 会在工具链目录中检测到已存在的 Python 版本，跳过下载步骤，直接开始创建虚拟环境和执行脚本。您会发现命令瞬间就成功运行了！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深度解析 Android 崩溃捕获原理及从崩溃到归因的闭环实践]]></title>    <link>https://juejin.cn/post/7571068689764925480</link>    <guid>https://juejin.cn/post/7571068689764925480</guid>    <pubDate>2025-11-11T03:37:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571068689764925480" data-draft-id="7571068689764843560" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深度解析 Android 崩溃捕获原理及从崩溃到归因的闭环实践"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-11-11T03:37:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云云原生"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深度解析 Android 崩溃捕获原理及从崩溃到归因的闭环实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云云原生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T03:37:55.000Z" title="Tue Nov 11 2025 03:37:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作者：路锦（小蘭）</p>
<h2 data-id="heading-0">背景：Android 应用崩溃的挑战</h2>
<p>在移动应用的世界里，稳定性是用户体验的基石。任何异常都可能导致用户失望、给出差评，并最终卸载应用。对于开发者而言，快速识别、定位和修复这些问题至关重要。正如线上应用崩溃了，我们收到的却往往只是一个无情的“已停止运行”提示。尤其面对 Native 崩溃和代码混淆，堆栈信息如同一本“天书”，让问题定位变得异常困难。本文将系统性地拆解 Android 崩溃捕获的底层原理与核心技术难点，并提供一套统一的框架设计思路，旨在点亮线上崩溃的“盲区”，实现从捕获到精准归因的闭环。</p>
<h2 data-id="heading-1">崩溃采集的技术原理与方案调研</h2>
<p>要捕获崩溃，我们首先需要理解 Android 系统中两类主要崩溃的底层触发机制。</p>
<h3 data-id="heading-2">2.1 Java/Kotlin 崩溃采集原理</h3>
<p>Java 和 Kotlin 代码都运行在 ART (Android Runtime) 上，当代码中抛出一个异常（如 <code>NullPointerException</code>）而没有被任何 <code>try-catch</code> 块捕获时，这个异常会沿着调用栈一路向上传递。如果最终抵达线程的顶部仍未被处理，ART 就会终止该线程。在终止前，ART 会调用一个可供开发者设置的回调接口——<code>Thread.UncaughtExceptionHandler</code>。</p>
<p>这正是我们捕获 Java 崩溃的入口。通过调用 Thread.setDefaultUncaughtExceptionHandler()，我们可以注册一个全局处理器。当任何线程发生未捕获异常时，我们的处理器便会接管，从而获得在进程完全死亡前的宝贵时机，用以记录崩溃现场的关键信息。</p>
<h3 data-id="heading-3">2.2 Native 崩溃原理：深入信号处理与现场捕获</h3>
<p>Native 崩溃发生在 C/C++ 代码层，它不受 ART 虚拟机管理，因此 <code>UncaughtExceptionHandler</code> 对其无能为力。Native 崩溃的本质是 CPU 执行了非法指令，进而被操作系统内核检测到。内核会向对应的进程发送一个 Linux 信号 (Signal) 来通知这一事件，这是一种内核与进程之间进行异步通信的机制。</p>
<h4 data-id="heading-4">常见致命信号详解</h4>
<ul>
<li><code>SIGSEGV</code> (Segmentation Fault)：段错误。这是最常见的 Native 崩溃原因，本质是程序试图访问一块它无权访问的内存。例如：解引用一个 NULL 指针、访问已释放对象的内存（Use-After-Free）、数组越界、试图写入只读内存段等。</li>
<li><code>SIGILL</code> (Illegal Instruction)：非法指令。当 CPU 的指令指针指向一个无效或包含损坏数据的地址时，CPU 无法识别将要执行的指令，便会触发此信号。例如：函数指针错误导致跳转到非代码区、栈被破坏导致返回地址错误等。</li>
<li><code>SIGABRT</code> (Abort)：程序异常终止。这通常是程序“主动”选择的崩溃，一般由调用 <code>abort()</code> 函数触发。在 C/C++ 中，很多断言库（<code>assert</code>）在断言失败后会调用<code>abort()</code>，表明程序进入了一个绝对不应存在的状态。</li>
<li><code>SIGFPE</code> (Floating-Point Exception)：浮点数异常。例如：整数除以零、浮点数上溢或下溢等。</li>
</ul>
<h4 data-id="heading-5">捕获流程四部曲</h4>
<p>捕获这些信号并还原现场，是一个精细且严谨的过程：</p>
<ol>
<li>
<p><strong>注册处理器</strong> (<code>sigaction</code>)：这是捕获流程的第一步。我们使用 <code>sigaction()</code> 系统调用来为我们关心的信号（如 <code>SIGSEGV</code>）注册一个自定义的回调函数。相比于老旧的 <code>signal()</code> 函数，<code>sigaction</code> 提供了更丰富的功能，特别是通过设置 <code>SA_SIGINFO</code> 标志，可以让我们的回调函数接收到一个包含详细上下文的 <code>siginfo_t</code> 结构体，其中包括了导致崩溃的具体内存地址 (<code>si_addr</code>) 等宝贵信息。</p>
</li>
<li>
<p><strong>安全第一</strong>：<code>async-signal-safe</code> 环境: 信号处理器函数在一个非常特殊且严苛的环境中执行。在这个环境中，我们不能假定全局数据结构是完好无损的，也不能调用绝大多数标准库函数（如 <code>malloc, free, printf, strcpy</code>），因为它们不是“异步信号安全”的，调用它们极易导致二次崩溃或死锁。我们能做的，只有调用少数被明确标记为“安全”的函数（如 <code>write, open, read</code>）。</p>
</li>
<li>
<p><strong>堆栈回溯</strong> (Stack Unwinding)：为了得到函数调用链，我们需要在信号处理器中进行堆栈回溯。这是一个通过分析当前线程的栈指针（SP）、帧指针（FP）以及栈上的返回地址，来逐层还原函数调用关系的过程。<code>libunwind</code> 等库被广泛用于此目的。然而，在 Native 崩溃场景下，栈本身可能已经被破坏，这使得实时回溯的成功率并非 100%。</p>
</li>
<li>
<p><strong>生成报告</strong> (Minidump)：正因为实时回溯的不可靠性，业界最佳实践（如 Google Breakpad）并非在信号处理器中直接进行复杂的堆栈回溯。更可靠的做法是：在信号处理器这个“安全环境”中，只做最少、最核心的操作——即收集所有线程的寄存器上下文、原始的堆栈内存片段、已加载的模块列表等信息，并将它们“打包”成一个结构化的 Minidump 文件。这个过程不涉及复杂的逻辑，失败风险低。真正的堆栈回溯和符号化分析，则被推迟到服务端，在更安全、资源更充裕的环境中离线进行。</p>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa815971c2034488ac7b03284b3e9c0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763437075&amp;x-signature=ZXyVDAeQwymoDV8zlfGpUeDRDfw%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-6">2.3 业界方案调研</h3>
<p>基于以上原理，业界涌现了众多优秀的开源及商业化方案。它们本质上都是对上述原理的工程化封装。</p>
<ul>
<li><strong>Google Breakpad/Crashpad</strong>：它们是 Native 崩溃捕获的“黄金标准”，提供了从信号捕获、Minidump 生成到后台解析的全套工具链。它们是许多商业方案的技术基石，但自行集成和后台搭建成本较高。</li>
<li><strong>Firebase Crashlytics &amp; Sentry</strong>：这类商业化平台（SaaS）提供了“SDK + 后台”的一站式服务。它们封装了底层的捕获逻辑，并提供了强大的后台用于报告聚合、符号化解析和统计分析，极大地降低了开发者的使用门槛。</li>
<li><strong>xCrash</strong>：这是一个功能强大的开源库，不仅支持 Native 和 Java 崩溃，还对各种复杂场景下的堆栈回溯做了深度优化，信息采集能力非常出色。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b55446b629264948bc8525c909e88f0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763437075&amp;x-signature=LZKVAQngOqFcfI6U4t7IN19Ix68%3D" alt="图片" loading="lazy"/></p>
<p>经过对比分析，本文选择 Google Breakpad 作为 Native 崩溃采集的核心技术。Breakpad 采用业界标准的 Minidump 格式，这一格式已被 Chrome、Firefox 等全球主流产品广泛采用，技术成熟。从能力覆盖角度看，Breakpad 在 Native 崩溃捕获、多架构支持、跨平台兼容等核心场景上表现完整，配套的符号化工具链（如 dump_syms、minidump_stackwalk）也十分成熟。虽然 Breakpad 专注于 Native 层面，但 Java 崩溃可通过上述 UncaughtExceptionHandler 机制补齐，整体能力覆盖性满足崩溃采集的要求。</p>
<h2 data-id="heading-7">核心技术难点解析</h2>
<p>实现一个可靠的崩溃采集方案，需要克服以下三大技术难点。</p>
<h3 data-id="heading-8">难点一：捕获时机与信息保存的可靠性</h3>
<p>崩溃发生时，整个进程已处于极不稳定的濒死状态。此时执行复杂操作（如网络请求）风险极高。我们必须确保信息记录的过程足够快且绝对可靠。因此，“同步写入、延迟上报”是最佳策略。即在捕获到崩溃的瞬间，以最快的同步方式将信息写入本地文件，然后等到应用下一次正常启动时，再从容地读取文件并上报到服务器。</p>
<h3 data-id="heading-9">难点二：Native 崩溃的“黑盒”特性</h3>
<p>相比于 Java 崩溃，Native 崩溃现场更易遭到破坏。非法的内存操作可能已污染了堆栈，导致传统的堆栈回溯方法失效。因此，简单地记录几个寄存器值是远远不够的。我们需要的是一个包含线程、寄存器、堆栈内存、已加载模块等信息的完整“现场快照”。这正是 Breakpad 提出的 Minidump（小型转储）概念的价值所在。</p>
<h3 data-id="heading-10">难点三：堆栈的“天书”——混淆与符号化</h3>
<p>为了安全和包体大小，线上代码通常经过了混淆（ProGuard/R8）。这会导致崩溃堆栈中的类名和方法名变成无意义的 <code>a, b, c</code>，如同天书。对于 Native 代码，发布的是不含符号信息的二进制文件，其堆栈也是一串无意义的内存地址。因此，符号化 (Symbolication)是必不可少的一环。我们必须在编译时生成并保留对应的符号表文件（Java 的 <code>mapping.txt</code>，Native 的 <code>.so</code> 文件），在服务端利用这些文件将“天书”翻译回可读的、有意义的堆栈信息。</p>
<h2 data-id="heading-11">Android 应用崩溃采集及堆栈解析实践</h2>
<p>为了全面应对这些挑战，我们设计了一个统一的异常采集方案，遵循“捕获-持久化-上报-解析”的生命周期。无论是 Java 还是 Native 崩溃，客户端的核心任务都是可靠地将现场信息保存到本地。真正的解析和分析工作则交由服务端完成。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0563040a4db244c1bff8bcce67916f6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763437075&amp;x-signature=egu5eF9Iysnbn93hXn%2BCFA4tQa8%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-12">4.1 Java/Kotlin 崩溃处理</h3>
<p>我们使用 <code>Thread.setDefaultUncaughtExceptionHandler</code> 来捕获 Java/Kotlin 的异常。这是一个回调接口，无论是 Java 还是 Kotlin，其编译后的字节码均由 ART 执行。当抛出未捕获异常时，ART 会触发当前线程的异常分发机制，最终调用注册的 uncaughtException 方法。因此 <code>Thread.setDefaultUncaughtExceptionHandler</code> 能够实现全局 Java/Kotlin 异常捕获。</p>
<p>首先需要设置一个全局的未捕获异常处理器来捕获 Java 崩溃，通过实现<code>Thread.setDefaultUncaughtExceptionHandler</code> 的 uncaughtException 方法实现一个处理器，我们可以将自己实现的 handler 设置为所有线程的默认处理器。这就给了我们在应用彻底崩溃前的最后一刻“力挽狂澜”的机会——记录下导致崩溃的元凶。需要注意我们要保留原始的处理器：originalHandler。</p>
<p>当崩溃发生时，该处理器会收集异常及堆栈关键信息，最终将其同步持久化到 <code>SharedPreferences</code>。由于进程即将终止，当前的步骤必须保证同步完成，因此我们持久化写缓存也使用同步提交 (<code>editor.commit()</code>) ，异步的 <code>apply()</code> 可能无法确保成功持久化。关键的异常信息例如：</p>
<ul>
<li><strong>时间戳 (Timestamp)</strong>：崩溃发生的精确时间。</li>
<li><strong>异常类型 (Exception Type)</strong>：是 <code>NullPointerException</code> 还是 <code>IndexOutOfBoundsException</code> 等。</li>
<li><strong>异常信息 (Exception Message)</strong>：异常对象中包含的描述性信息。</li>
<li><strong>堆栈轨迹 (Stack Trace)</strong>：这是最重要的部分，它告诉我们崩溃发生在哪个类的哪一行代码。</li>
<li><strong>线程信息 (Thread Name)</strong>：崩溃发生在主线程还是某个后台线程。</li>
</ul>
<p>“下次启动时上报”是核心策略。它避免了在应用崩溃时不稳定的网络环境中尝试上报数据，大大提高了成功率。我们在 <code>start()</code> 方法中调用此检查。这个方法可以在后台线程中执行，防止阻塞应用主线程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7cdac604cf44b2c9eebc8bed99c514b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763437075&amp;x-signature=wVT4IAD8xputPi%2FQobo1vj6r3qY%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Override</span>
public void uncaughtException(Thread thread, Throwable throwable) {
    try {
        <span class="hljs-comment">// 核心难点1：收集崩溃信息</span>
        CrashData crashData = <span class="hljs-built_in">collectCrashData</span>(thread, throwable);
        <span class="hljs-comment">// 核心难点2：保证濒死前数据能被同步、可靠地保存</span>
        <span class="hljs-built_in">saveCrashData</span>(crashData);
    } finally {
        <span class="hljs-comment">// 核心难点3：将控制权交还，确保系统默认行为（如弹窗）执行</span>
        if (originalHandler != null) {
            originalHandler<span class="hljs-selector-class">.uncaughtException</span>(thread, throwable);
        }
    }
}
private void <span class="hljs-built_in">saveCrashData</span>(CrashData data) {
    <span class="hljs-comment">// 使用 SharedPreferences 的同步 commit() 方法</span>
    prefs<span class="hljs-selector-class">.edit</span>()<span class="hljs-selector-class">.putString</span>("last_crash", data.toJson())<span class="hljs-selector-class">.commit</span>(); 
}
</code></pre>
<h3 data-id="heading-13">4.2 Native 崩溃处理</h3>
<p>对于 Native 崩溃，我们集成了一个基于 Breakpad 的解决方案。在启动时加载一个 Native 库，该库为常见的崩溃信号设置了信号处理器。</p>
<p><strong>1. 初始化</strong>：在 App 启动时，我们初始化 Native 库，并为其提供一个专用的目录来写入崩溃转储文件（crash dump）。</p>
<p><strong>2. 崩溃发生</strong>：当 Native 崩溃发生时，信号处理器会捕获它，并将一个 <code>.dmp</code> (minidump) 文件写入指定目录。</p>
<p><strong>3. 下次启动时处理</strong>：在下一次 App 启动时，我们的框架会检查此目录中是否有任何 <code>.dmp</code> 文件。如果找到，它会调用一个 Native 方法来解析 minidump，提取堆栈信息和其他相关信息。解析后的数据随后被上报到我们的后端，并且转储文件被删除。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ef3f0d1b02c4636904d4ddb8bc7c2bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763437075&amp;x-signature=u9AAvnLyAUN%2FoMUq7Cgq%2FDzl8ds%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-scss" lang="scss">public void <span class="hljs-built_in">start</span>() {
    <span class="hljs-comment">// 核心难点1：尽早初始化 Native 层的信号处理器</span>
    NativeBridge<span class="hljs-selector-class">.initialize</span>(crashDir.getAbsolutePath());
    <span class="hljs-comment">// 核心难点2：在下次启动时，异步检查并处理上次崩溃留下的产物</span>
    new <span class="hljs-built_in">Thread</span>(this::processExistingDumps)<span class="hljs-selector-class">.start</span>();
}
private void <span class="hljs-built_in">processExistingDumps</span>() {
    <span class="hljs-comment">// 遍历指定目录下的 .dmp 文件</span>
    File<span class="hljs-selector-attr">[]</span> dumpFiles = crashDir<span class="hljs-selector-class">.listFiles</span>();
    for (File dumpFile : dumpFiles) {
        <span class="hljs-comment">// 此处无需解析，直接将原始 .dmp 文件上报</span>
        <span class="hljs-built_in">reportToServer</span>(dumpFile);
        dumpFile<span class="hljs-selector-class">.delete</span>();
    }
}
<span class="hljs-comment">// JNI 桥接，是 Java 层与 C++ 层通信的唯一途径</span>
static class NativeBridge {
    <span class="hljs-comment">// 加载实现了信号捕获和 minidump 写入的 so 库</span>
    static { System<span class="hljs-selector-class">.loadLibrary</span>("crash-handler"); }
    <span class="hljs-comment">// JNI 方法，通知 C++ 层开始工作</span>
    public static native void <span class="hljs-built_in">initialize</span>(String dumpPath);
}
</code></pre>
<p>转储文件中我们能获取到的异常信息有很多，使用时我们通常需要关注以下的关键信息：</p>
<p><strong>1. 异常信息 (Exception Information)</strong></p>
<ul>
<li>异常流 (Exception Stream)：
<ul>
<li>崩溃线程 ID (Thread ID)：明确指出是哪一个线程引发了这次崩溃。</li>
<li>崩溃信号（Signal），例如 SIGSEGV（段错误) 和 SIGILL (非法指令)。</li>
<li>异常地址 (Exception Address)：异常发生时，CPU 指令指针（Program Counter）所在的内存地址。这直接指向了导致崩溃的那一行机器码。</li>
</ul>
</li>
</ul>
<p><strong>2. 线程列表与状态 (Thread List &amp; States)</strong></p>
<ul>
<li>线程 ID (Thread ID)：该线程的唯一标识符。</li>
<li>线程上下文。</li>
<li>线程堆栈内存 (Stack Memory Dump)：包含了每个线程栈上一部分内存的原始二进制拷贝。</li>
</ul>
<p><strong>3. 模块列表 (Module List)：</strong> 崩溃时进程加载的所有动态链接库（在 Android 上是 .so 文件）和可执行文件</p>
<p><strong>4. 系统信息 (System Information)</strong></p>
<ul>
<li>操作系统信息：操作系统类型（如 Linux）、版本号（如 Android 12, API 31）。</li>
<li>CPU 信息：CPU 架构（如 ARM64, x86）、CPU 型号、核心数量等。</li>
</ul>

<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 崩溃信息</span>
Caused <span class="hljs-keyword">by</span>: SIGSEGV /SEGV_ACCERR
<span class="hljs-comment">// 系统信息</span>
Kernel version: <span class="hljs-string">'0.0.0 Linux 6.6.66-android15-8-g807ce3b4f02f-ab12996908-4k #1 SMP PREEMPT Fri Jan 31 21:59:26 UTC 2025 aarch64'</span>  ABI: <span class="hljs-string">'arm64'</span> 
</code></pre>
<p>堆栈样例：<a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">#00</a> pc 0x3538 libtest-native.so</p>
<h3 data-id="heading-14">4.3 应用混淆堆栈解析</h3>
<p>当前很多线上应用为了安全和包体大小，代码通常经过了混淆（如 ProGuard/R8），这使得原始的崩溃堆栈变得几乎无法阅读。</p>
<h4 data-id="heading-15">混淆 Java 堆栈解析</h4>
<p>当线上应用发生崩溃时，你捕获到的堆栈信息是经过混淆的，看起来就像这样，这个堆栈对我们来说几乎是无用的：</p>
<ul>
<li>类名 a.b.c.a 和方法名 a 毫无意义。</li>
<li>行号信息也丢失了，显示为 Unknown Source。</li>
</ul>

<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.NullPointerException</span>: <span class="hljs-selector-tag">Attempt</span> <span class="hljs-selector-tag">to</span> <span class="hljs-selector-tag">invoke</span> <span class="hljs-selector-tag">virtual</span> <span class="hljs-selector-tag">method</span> '<span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.b</span><span class="hljs-selector-class">.d</span><span class="hljs-selector-class">.a</span><span class="hljs-selector-class">.a</span>(a.b.e.a)' <span class="hljs-selector-tag">on</span> <span class="hljs-selector-tag">a</span> <span class="hljs-selector-tag">null</span> <span class="hljs-selector-tag">object</span> <span class="hljs-selector-tag">reference</span>
       <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.b</span><span class="hljs-selector-class">.c</span><span class="hljs-selector-class">.a</span><span class="hljs-selector-class">.a</span>(Unknown <span class="hljs-attribute">Source</span>:<span class="hljs-number">8</span>)
       <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.b</span><span class="hljs-selector-class">.c</span><span class="hljs-selector-class">.b</span><span class="hljs-selector-class">.onClick</span>(Unknown <span class="hljs-attribute">Source</span>:<span class="hljs-number">2</span>)
       <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">android</span><span class="hljs-selector-class">.view</span><span class="hljs-selector-class">.View</span><span class="hljs-selector-class">.performClick</span>(View.<span class="hljs-attribute">java</span>:<span class="hljs-number">7448</span>)
</code></pre>
<p>接下来我们了解一下混淆堆栈的解析原理：</p>
<p>当你在 Android 项目中启用代码混淆（通常是在 release 构建类型中设置 minifyEnabled true）并进行打包时，R8 工具会在处理你的代码的同时，在 build/outputs/mapping/release/ 目录下生成一个 mapping.txt 文件，这个文件我们可以理解为“字典”。</p>
<p>而解析工具会读取上述文件，将混淆后的堆栈逐行翻译为原始文件和方法名。</p>
<p><strong>1. 逐行读取堆栈：</strong> 工具读取混淆堆栈的每一行，例如 at a.b.c.a.a(Unknown Source:8)。</p>
<p><strong>2. 解析关键信息：</strong> 它从这行中提取出关键部分：</p>
<ul>
<li>类名：a.b.c.a</li>
<li>方法名：a</li>
<li>（可能的）行号：8</li>
</ul>
<p><strong>3. 查询</strong> <code>mapping.txt</code>：</p>
<ul>
<li>工具在 mapping.txt 中查找 a.b.c.a: 这一行，找到它对应的原始类名，例如：com.example.myapp.ui.MainActivity。</li>
<li>接着，在 MainActivity 的映射条目下，它会继续查找哪个原始方法被混淆成了a。假设它找到了 void updateUserProfile(com.example.myapp.model.User) -&gt; a。</li>
</ul>
<p><strong>4. 恢复行号：</strong> R8 在优化过程中可能会内联方法或移除代码，导致行号变化。mapping.txt中也包含了行号的映射信息。Retrace 工具会利用这些信息，将混淆后的行号（如：8）精确地还原为原始的源文件行号。</p>
<p><strong>5. 替换与输出：</strong> 工具将混淆的行替换为解析后的、可读的行。</p>
<h4 data-id="heading-16">Native 堆栈解析</h4>
<p>这是一个我们采集到的 Native 堆栈其中的一行，分别包含以下信息：</p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">#00</a>：堆栈帧序号。00 代表栈顶，是程序崩溃的直接位置。</li>
<li>pc 0x3538：程序计数器地址 (Program Counter)。这是我们需要解析的关键信息，代表 CPU 在 libtest-native.so 这个库中执行到的指令的相对地址。</li>
<li>libtest-native.so：动态库路径。指明了崩溃发生在哪一个 .so 文件中。这是设备上运行时的路径。</li>
</ul>

<pre><code class="hljs language-bash" lang="bash"> <span class="hljs-comment">#00 pc 0x3538 libtest-native.so</span>
</code></pre>
<p>然而我们拿到这个堆栈仍然无法解析出具体发生崩溃的文件和方法，因此我们需要解析 C++ 堆栈，还原为可读的崩溃真实信息。</p>
<p>与 Java 堆栈解析的核心思想一致，Native 堆栈解析也是一个“查表翻译”的过程。只不过它的“密码本”不再是 mapping.txt，而是包含了 DWARF 调试信息的、与线上版本完全一致的 <code>unstripped</code> 库文件：libtest-native.so 文件；“翻译工具”则是 NDK 提供的 addr2line 等命令行程序。执行类似如下的命令：</p>
<pre><code class="hljs language-bash" lang="bash"> <span class="hljs-comment"># 使用 NDK 中的 addr2line 工具</span>
 <span class="hljs-comment"># -C: Demangle C++ 的函数名 (例如将 _Z... 还原成 MyClass::MyMethod)</span>
 <span class="hljs-comment"># -f: 显示函数名</span>
 <span class="hljs-comment"># -e: 指定带符号的库文件</span>
addr2line -C -f -e /path/to/unstripped/libtest-native.so 0x3538
</code></pre>
<p>工作原理：</p>
<ul>
<li>
<p>addr2line 工具加载 unstripped 的 .so 文件。</p>
</li>
<li>
<p>它解析文件中的 DWARF 调试信息段，这些信息段中存储了从机器码地址到源代码行号的映射表。</p>
</li>
<li>
<p>它在映射表中查找地址 0x3538 落在哪个函数地址范围之内。</p>
</li>
<li>
<p>找到函数后，它进一步在行号表中查找该地址精确对应的文件名和行号。</p>
</li>
<li>
<p>同时，它利用 -C 参数对 C++ 的“符号修饰名”（mangled name）进行“解修饰”（demangle），将其还原成我们代码中编写的、可读的命名空间::类名::方法名(参数) 形式。</p>
</li>
</ul>
<p>addr2line 工具执行完毕后，就会解析出我们期望得到的结果，因此我们能够定位到发生崩溃的具体文件和方法：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">CrashCore::makeArrayIndexOutOfBoundsException()</span>
<span class="hljs-section">/xxx/xxx/xxx/android-demo/app/src/main/cpp/CrashCore.cpp:51</span>
</code></pre>
<h2 data-id="heading-17">总结</h2>
<p>通过本文的探讨，我们解构了 Android 崩溃捕获的底层原理，并围绕三大核心技术难点（<strong>捕获时机、黑盒现场、堆栈混淆</strong>）设计了一套捕获方案。无论是 Java 层的 UncaughtExceptionHandler 机制，还是 Native 层的信号处理与 Minidump 技术，其最终目的都是在进程“灰飞烟灭”前，尽可能可靠地抢救出最有价值的现场信息。阿里云 RUM 针对 Android 端实现了对应用性能、稳定性、和用户行为的无侵入式采集 SDK。可以参考接入文档 <strong>[</strong> <strong>1]</strong> 体验使用。相关问题可以加入“RUM 用户体验监控支持群”（<strong>钉钉群号：67370002064</strong>）进行咨询。</p>
<p><strong>相关链接：</strong></p>
<p>[1] 接入文档</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Farms%2Fuser-experience-monitoring%2Faccess-to-android-applications" target="_blank" title="https://help.aliyun.com/zh/arms/user-experience-monitoring/access-to-android-applications" ref="nofollow noopener noreferrer">help.aliyun.com/zh/arms/use…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>