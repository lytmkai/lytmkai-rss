<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[把 Nexus 当作“菜鸟驿站”：通俗易懂的 NPM 私有化管理指南]]></title>    <link>https://juejin.cn/post/7587440866723201039</link>    <guid>https://juejin.cn/post/7587440866723201039</guid>    <pubDate>2025-12-25T14:07:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587440866723201039" data-draft-id="7587605704635727906" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="把 Nexus 当作“菜鸟驿站”：通俗易懂的 NPM 私有化管理指南"/> <meta itemprop="keywords" content="后端,前端,程序员"/> <meta itemprop="datePublished" content="2025-12-25T14:07:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            把 Nexus 当作“菜鸟驿站”：通俗易懂的 NPM 私有化管理指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T14:07:03.000Z" title="Thu Dec 25 2025 14:07:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>做 CLI 工具的二次开发，最后一步往往是最容易被忽视的：怎么把包发出去？</p>
<p>公司项目基于 qwen-cli 做私有化改造，客户的环境是内网，连不了 npmjs.org。这时候就得自己搭一套私有 NPM 仓库，实现内部发包和分发。</p>
<p>这篇文章聊聊我们在这个过程中踩的坑和最终方案，主要涉及：</p>
<ul>
<li>Nexus 是什么，为什么选它</li>
<li><code>.npmrc</code> 的配置逻辑</li>
<li>CI/CD 中的自动化发包</li>
<li>一些容易踩的坑</li>
</ul>
<h2 data-id="heading-0">为什么需要私有 NPM 仓库</h2>
<p>先说背景。我们的 CLI 工具是给企业客户用的，有几个硬性要求：</p>
<ol>
<li><strong>内网部署</strong> —— 客户环境连不了公网，npm install 从 npmjs.org 拉包直接超时</li>
<li><strong>版本可控</strong> —— 不能让客户随便装个 latest，出问题不好排查</li>
<li><strong>安全合规</strong> —— 内部代码不能发到公网仓库</li>
</ol>
<p>这三个需求一叠加，结论很明确：需要一个私有 NPM 仓库。</p>
<h2 data-id="heading-1">Nexus 是什么</h2>
<p>Nexus 全称 <strong>Sonatype Nexus Repository Manager</strong>，是一个开源的仓库管理器。简单说，它就是一个"包的中转站和仓库"。</p>
<h3 data-id="heading-2">通俗理解</h3>
<p>你可以把 Nexus 想象成一个企业内部的"快递中转站"：</p>
<ul>
<li><strong>npmjs.org</strong> 是公网的"京东仓库"，所有人都能从那拉包</li>
<li><strong>Nexus</strong> 是你公司内部的"菜鸟驿站"，可以：
<ul>
<li>存放公司自己的包（私有包）</li>
<li>缓存从公网拉过的包（加速 + 离线）</li>
<li>控制谁能取件、谁能寄件（权限管理）</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3">Nexus 支持的仓库类型</h3>
<p>Nexus 不只是给 Java/Maven 用的，它支持多种包格式：</p>

































<table><thead><tr><th>包格式</th><th>说明</th></tr></thead><tbody><tr><td>npm</td><td>Node.js 包</td></tr><tr><td>maven</td><td>Java 包</td></tr><tr><td>docker</td><td>容器镜像</td></tr><tr><td>pypi</td><td>Python 包</td></tr><tr><td>nuget</td><td>.NET 包</td></tr><tr><td>raw</td><td>任意文件</td></tr></tbody></table>
<p>对于每种格式，Nexus 提供三种仓库类型：</p>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────────────────┐
│                      Nexus Repository                        │
├─────────────────┬─────────────────┬─────────────────────────┤
│   Hosted        │   Proxy         │   Group                 │
│   (托管仓库)     │   (代理仓库)     │   (组合仓库)             │
├─────────────────┼─────────────────┼─────────────────────────┤
│ 存放自己发布的包 │ 代理公网仓库     │ 把多个仓库合并成一个入口  │
│                 │ 缓存已下载的包   │                         │
│ 例：<span class="hljs-keyword">@mycompany</span>/ │ 例：代理 npmjs  │ 例：hosted + proxy      │
│     内部包      │     加速访问    │     统一入口            │
└─────────────────┴─────────────────┴─────────────────────────┘
</code></pre>
<h3 data-id="heading-4">我们的配置方案</h3>
<p>对于 NPM 私有化发包，我们用的是 <strong>Hosted 托管仓库</strong>：</p>
<ul>
<li>仓库地址：<code>https://nexus.example.com/repository/npm-private/</code></li>
<li>作用域：<code>@mycompany/*</code></li>
<li>用途：存放公司内部的 CLI 包</li>
</ul>
<p>为什么选 Nexus 而不是其他方案（比如 Verdaccio、cnpm）：</p>

























<table><thead><tr><th>方案</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td><strong>Nexus</strong></td><td>多格式支持、企业级权限、运维成熟</td><td>相对重量级</td></tr><tr><td>Verdaccio</td><td>轻量、专注 npm</td><td>只支持 npm，企业功能少</td></tr><tr><td>cnpm</td><td>国内访问快</td><td>主要是代理，私有包支持弱</td></tr></tbody></table>
<p>公司本来就有 Nexus 管 Maven 包，直接加个 npm 仓库就行，运维不用多学一套系统。</p>
<h2 data-id="heading-5">.npmrc：告诉 npm 去哪拉包</h2>
<p><code>.npmrc</code> 是 npm 的配置文件，决定了包从哪里下载、发布到哪里。</p>
<p>配置长这样：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 作用域路由：@mycompany 开头的包，走私有仓库</span>
@mycompany:<span class="hljs-attr">registry</span>=https://nexus.example.com/repository/npm-private/

<span class="hljs-comment"># 认证信息：Base64 编码的 用户名:密码</span>
//nexus.example.com/repository/npm-private/:<span class="hljs-attr">_auth</span>=dXNlcm5hbWU6cGFzc3dvcmQ=

<span class="hljs-comment"># 每次请求都带认证</span>
//nexus.example.com/repository/npm-private/:<span class="hljs-attr">always-auth</span>=<span class="hljs-literal">true</span>

<span class="hljs-comment"># 其他包走公共源</span>
<span class="hljs-attr">registry</span>=https://registry.npmjs.org
</code></pre>
<p>逐行解释：</p>
<h3 data-id="heading-6">第一行：作用域路由</h3>
<pre><code class="hljs language-ini" lang="ini">@mycompany:<span class="hljs-attr">registry</span>=https://nexus.example.com/repository/npm-private/
</code></pre>
<p>npm 的 <strong>scoped package</strong>（作用域包）格式是 <code>@scope/package-name</code>。这行配置的意思是：</p>
<ul>
<li><code>npm install @mycompany/cli</code> → 去 Nexus 私有仓库拉</li>
<li><code>npm install react</code> → 走默认源（npmjs.org）</li>
</ul>
<p>这样就实现了"私有包走内部、公共包走公网"的路由。</p>
<h3 data-id="heading-7">第二行：认证凭证</h3>
<pre><code class="hljs language-ini" lang="ini">//nexus.example.com/repository/npm-private/:<span class="hljs-attr">_auth</span>=dXNlcm5hbWU6cGFzc3dvcmQ=
</code></pre>
<p>私有仓库需要认证。<code>_auth</code> 是 Base64 编码的 <code>用户名:密码</code>。</p>
<p>生成方式：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 假设用户名是 deploy，密码是 mypassword</span>
<span class="hljs-built_in">echo</span> -n <span class="hljs-string">"deploy:mypassword"</span> | <span class="hljs-built_in">base64</span>
<span class="hljs-comment"># 输出：ZGVwbG95Om15cGFzc3dvcmQ=</span>
</code></pre>
<p>注意这行的格式：<code>//域名/路径/:配置项=值</code>，开头是两个斜杠，不是 <code>https://</code>。</p>
<h3 data-id="heading-8">第三行：强制认证</h3>
<pre><code class="hljs language-ini" lang="ini">//nexus.example.com/repository/npm-private/:<span class="hljs-attr">always-auth</span>=<span class="hljs-literal">true</span>
</code></pre>
<p>每次请求都带上认证信息，包括只读操作。有些仓库允许匿名读取，可以不加这行。</p>
<h3 data-id="heading-9">第四行：默认仓库</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">registry</span>=https://registry.npmjs.org
</code></pre>
<p>没有匹配到作用域的包，走公共 npm 源。</p>
<h3 data-id="heading-10">配置文件的查找顺序</h3>
<p>npm 会按以下顺序查找 <code>.npmrc</code>，后找到的会覆盖先找到的：</p>
<pre><code class="hljs language-bash" lang="bash">1. /path/to/project/.npmrc     ← 项目级（优先级最高）
2. ~/.npmrc                     ← 用户级
3. <span class="hljs-variable">$PREFIX</span>/etc/npmrc           ← 全局级
4. /path/to/npm/npmrc          ← npm 内置
</code></pre>
<p>最佳实践：</p>
<ul>
<li><strong>项目 <code>.npmrc</code></strong>：只放作用域路由，提交到 Git，方便协作</li>
<li><strong>用户 <code>~/.npmrc</code></strong>：放认证信息，不提交到 Git</li>
</ul>
<h2 data-id="heading-11">CI/CD 中的自动化发包</h2>
<p>手动跑 <code>npm publish</code> 容易出错，我们用 GitHub Actions 实现自动化。</p>
<h3 data-id="heading-12">发布流程</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[代码合并到 main]:::info --&gt; B[CI 触发]
    B --&gt; C[跑测试]
    C --&gt; D{测试通过?}
    D --&gt;|是| E[动态配置 .npmrc]:::warning
    D --&gt;|否| F[失败通知]:::error
    E --&gt; G[npm publish]
    G --&gt; H[创建 GitHub Release]:::success

    classDef info fill:#cce5ff,stroke:#0d6efd,color:#004085
    classDef success fill:#d4edda,stroke:#28a745,color:#155724
    classDef error fill:#f8d7da,stroke:#dc3545,color:#721c24
    classDef warning fill:#fff3cd,stroke:#ffc107,color:#856404
</code></pre>
<h3 data-id="heading-13">关键配置：动态生成 .npmrc</h3>
<p>CI 每次是全新环境，需要现场生成认证配置。GitHub Actions 示例：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">'Setup npm authentication'</span>
  <span class="hljs-attr">run:</span> <span class="hljs-string">|
    # 动态写入认证信息到 ~/.npmrc
    echo "//nexus.example.com/repository/npm-private/:_password=$(echo -n '${{ secrets.NEXUS_PASSWORD }}' | base64)" &gt;&gt; ~/.npmrc
    echo "//nexus.example.com/repository/npm-private/:username=${{ secrets.NEXUS_USERNAME }}" &gt;&gt; ~/.npmrc
    echo "//nexus.example.com/repository/npm-private/:email=ci@example.com" &gt;&gt; ~/.npmrc
    echo "//nexus.example.com/repository/npm-private/:always-auth=true" &gt;&gt; ~/.npmrc
    echo "@mycompany:registry=https://nexus.example.com/repository/npm-private/" &gt;&gt; ~/.npmrc
</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">'Publish to npm'</span>
  <span class="hljs-attr">run:</span> <span class="hljs-string">|
    npm publish --tag "${NPM_TAG}" --registry https://nexus.example.com/repository/npm-private/
</span></code></pre>
<p>几个要点：</p>
<ol>
<li><strong>敏感信息用 GitHub Secrets</strong> —— 用户名密码存在 Secrets，不硬编码到 yaml</li>
<li><strong>动态写入 ~/.npmrc</strong> —— 每次 CI 是干净环境，需要现场生成</li>
<li><strong>显式指定 --registry</strong> —— publish 命令再指定一次，双重保险</li>
<li><strong>使用 dist-tag</strong> —— <code>--tag nightly</code> / <code>--tag latest</code> 区分发布渠道</li>
</ol>
<h3 data-id="heading-14">dist-tag 的作用</h3>
<p>npm 的 dist-tag 可以理解为"版本别名"：</p>
<pre><code class="hljs language-bash" lang="bash">npm publish --tag nightly    <span class="hljs-comment"># 发布到 nightly 标签</span>
npm publish --tag latest     <span class="hljs-comment"># 发布到 latest 标签（默认）</span>

<span class="hljs-comment"># 用户安装时</span>
npm install @mycompany/cli@nightly  <span class="hljs-comment"># 装 nightly 版</span>
npm install @mycompany/cli          <span class="hljs-comment"># 装 latest 版（默认）</span>
</code></pre>
<p>我们用 nightly 做每日构建，latest 做正式发布，preview 做预览版。</p>
<h2 data-id="heading-15">踩过的坑</h2>
<h3 data-id="heading-16">坑一：_auth vs _password + username</h3>
<p>Nexus 支持两种认证配置方式：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 方式 1：_auth（Base64 编码的 "用户名:密码"）</span>
//nexus.example.com/:<span class="hljs-attr">_auth</span>=ZGVwbG95Om15cGFzc3dvcmQ=

<span class="hljs-comment"># 方式 2：分开配置</span>
//nexus.example.com/:<span class="hljs-attr">username</span>=deploy
//nexus.example.com/:<span class="hljs-attr">_password</span>=bXlwYXNzd29yZA==  <span class="hljs-comment"># Base64 编码的密码（不是用户名:密码）</span>
</code></pre>
<p>两种都能用，但 <strong>不能混用</strong>。我们最开始同时配了 <code>_auth</code> 和 <code>username</code>，结果认证失败，查了半天。</p>
<p>建议统一用方式 2（分开配置），因为 CI 里动态生成更方便。</p>
<h3 data-id="heading-17">坑二：scope 大小写敏感</h3>
<p>npm 的作用域是 <strong>大小写敏感</strong> 的：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json</span>
<span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@MyCompany/cli"</span> <span class="hljs-punctuation">}</span>  <span class="hljs-comment">// 大写 M</span>
</code></pre>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># .npmrc - 这样配会找不到</span>
@mycompany:<span class="hljs-attr">registry</span>=...  <span class="hljs-comment"># 小写 m，不匹配！</span>
</code></pre>
<p>package.json 里写的是什么，.npmrc 里就得一模一样。</p>
<h3 data-id="heading-18">坑三：代理仓库的缓存问题</h3>
<p>如果 Nexus 配了 Proxy 仓库代理 npmjs.org，要注意缓存：</p>
<pre><code class="hljs language-css" lang="css">用户请求 lodash<span class="hljs-keyword">@4</span>.17.21
    ↓
Nexus Proxy 仓库
    ↓ （第一次）从 npmjs.org 拉取并缓存
    ↓ （之后）直接返回缓存
用户拿到包
</code></pre>
<p>问题是：如果 npmjs.org 上的包更新了（比如安全补丁），Nexus 可能还返回旧的缓存版本。</p>
<p>解决方案：</p>
<ul>
<li>在 Nexus 配置里设置缓存过期时间（比如 24 小时）</li>
<li>或者手动在 Nexus 管理界面清理特定包的缓存</li>
</ul>
<h3 data-id="heading-19">坑四：离线环境的公共依赖</h3>
<p>纯内网环境下，不只私有包要考虑，公共依赖（react、lodash 等）也拉不了。</p>
<p>两个方案：</p>
<p><strong>方案 1：提前打包所有依赖</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在有网环境</span>
npm ci
tar -czf node_modules.tar.gz node_modules

<span class="hljs-comment"># 部署到内网后</span>
tar -xzf node_modules.tar.gz
</code></pre>
<p>简单粗暴，但 node_modules 体积大，不优雅。</p>
<p><strong>方案 2：Nexus Proxy + 预热</strong></p>
<ol>
<li>在有网环境部署 Nexus，配置 Proxy 仓库代理 npmjs.org</li>
<li>跑一遍 <code>npm install</code>，让 Nexus 缓存所有依赖</li>
<li>把 Nexus 整个迁移到内网（或者同步缓存数据）</li>
</ol>
<p>我们用的是方案 2，Nexus 的 blob store 可以直接复制迁移。</p>
<h2 data-id="heading-20">本地开发 vs CI 发布的配置分离</h2>
<p>日常开发和 CI 发布对 .npmrc 的需求不太一样：</p>

























<table><thead><tr><th>场景</th><th>需要认证</th><th>配置位置</th></tr></thead><tbody><tr><td>本地开发（只拉包）</td><td>看仓库配置</td><td>项目 .npmrc</td></tr><tr><td>CI 发布</td><td>必须</td><td>动态写入 ~/.npmrc</td></tr><tr><td>本地发布（调试用）</td><td>必须</td><td>~/.npmrc</td></tr></tbody></table>
<p>建议的做法：</p>
<pre><code class="hljs language-ruby" lang="ruby">项目根目录/.npmrc           ← 只配作用域路由，提交到 <span class="hljs-title class_">Git</span>
    <span class="hljs-variable">@mycompany</span><span class="hljs-symbol">:registry=https</span><span class="hljs-symbol">://nexus</span>.example.com/repository/npm-<span class="hljs-keyword">private</span>/
    registry=<span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/registry.npmjs.org

~/</span>.npmrc                     ← 配认证信息，不提交
    /<span class="hljs-regexp">/nexus.example.com/repository</span><span class="hljs-regexp">/npm-private/</span><span class="hljs-symbol">:_auth=xxx</span>
    /<span class="hljs-regexp">/nexus.example.com/repository</span><span class="hljs-regexp">/npm-private/</span><span class="hljs-symbol">:always-auth=true</span>
</code></pre>
<p>这样既方便团队协作（clone 下来就能拉包），又不泄露凭证。</p>
<h2 data-id="heading-21">总结</h2>
<p>私有化部署 NPM 包，核心就三件事：</p>
<ol>
<li><strong>搭个私有仓库</strong> —— Nexus 是成熟方案，支持 npm/maven/docker 等多种格式，企业一般已有现成的</li>
<li><strong>配好 .npmrc</strong> —— 作用域路由实现公私分流，认证信息单独管理</li>
<li><strong>CI 自动化</strong> —— Secrets 管理凭证，动态生成配置，dist-tag 区分发布渠道</li>
</ol>
<p>配置不复杂，但细节容易出错。希望这篇文章能帮你少踩几个坑。</p>
<hr/>
<p>如果你觉得这篇文章有帮助，欢迎关注我的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">GitHub</a>，下面是我的一些开源项目：</p>
<p><strong>Claude Code Skills</strong>（按需加载，意图自动识别，不浪费 token，<a href="https://juejin.cn/post/7578714735307735066" target="_blank" title="https://juejin.cn/post/7578714735307735066">介绍文章</a>）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcode-review-skill" target="_blank" title="https://github.com/tt-a1i/code-review-skill" ref="nofollow noopener noreferrer">code-review-skill</a> - 代码审查技能，覆盖 React 19、Vue 3、TypeScript、Rust 等约 9000 行规则（<a href="https://juejin.cn/post/7578709098255908902" target="_blank" title="https://juejin.cn/post/7578709098255908902">详细介绍</a>）</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2F5-whys-skill" target="_blank" title="https://github.com/tt-a1i/5-whys-skill" ref="nofollow noopener noreferrer">5-whys-skill</a> - 5 Whys 根因分析，说"找根因"自动激活</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Ffirst-principles-skill" target="_blank" title="https://github.com/tt-a1i/first-principles-skill" ref="nofollow noopener noreferrer">first-principles-skill</a> - 第一性原理思考，适合架构设计和技术选型</li>
</ul>
<p><strong>vibe coding 原理学习</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhimanai.github.io%2Finnies-cli%2F" target="_blank" title="https://zhimanai.github.io/innies-cli/" ref="nofollow noopener noreferrer">qwen-cli 学习网站</a> - 学习 qwen-cli 时整理的笔记，40+ 交互式动画演示 AI CLI 内部机制</li>
</ul>
<p><strong>全栈项目</strong>（适合学习现代技术栈）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fprompt-vault" target="_blank" title="https://github.com/tt-a1i/prompt-vault" ref="nofollow noopener noreferrer">prompt-vault</a> - Prompt 管理器，用的都是最新的技术栈，适合用来学习了解最新的前端全栈开发范式：Next.js 15 + React 19 + tRPC 11 + Supabase 全栈示例，clone 下来配个免费 Supabase 就能跑</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fchat_edit" target="_blank" title="https://github.com/tt-a1i/chat_edit" ref="nofollow noopener noreferrer">chat_edit</a> - 双模式 AI 应用（聊天+富文本编辑），Vue 3.5 + TypeScript + Vite 5 + Quill 2.0 + IndexedDB</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[出海技术挑战——Lalamove智能告警降噪]]></title>    <link>https://juejin.cn/post/7587596841875111970</link>    <guid>https://juejin.cn/post/7587596841875111970</guid>    <pubDate>2025-12-25T14:11:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587596841875111970" data-draft-id="7587605704635744290" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="出海技术挑战——Lalamove智能告警降噪"/> <meta itemprop="keywords" content="监控,后端,人工智能"/> <meta itemprop="datePublished" content="2025-12-25T14:11:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="货拉拉技术"/> <meta itemprop="url" content="https://juejin.cn/user/1768489241815070"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            出海技术挑战——Lalamove智能告警降噪
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1768489241815070/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    货拉拉技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T14:11:26.000Z" title="Thu Dec 25 2025 14:11:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作者：TGE-Pricing-曹晶晶 (Kent Cao)</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ff16db700964d0ca945a663fff8a103~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=Tamw1A2Lhfb%2FzZW0Fx9BvmAY2YE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">前言</h2>
<p>告警监控作为技术团队保障服务与业务稳定性的核心防线，其重要性不仅体现在对潜在风险的实时感知与快速响应上，更是构建高可用系统、提升用户体验的关键基石。因此面对快速拓展的海外市场和高速迭代的业务模式，如何在有限的人力资源下高效保障服务稳定性成为研发团队日常工作中的重要挑战。本文将重点介绍监控告警在国际化业务中的一些实践。</p>
<h2 data-id="heading-1">为什么要做？</h2>
<blockquote>
<p><strong>什么是告警？</strong></p>
<p>在现代化的互联网架构中,告警是监控系统中最为重要的一部分,可以帮助研发人员及时发现并解决问题,确保服务的可用性和稳定性。</p>
</blockquote>
<blockquote>
<p><strong>什么是告警噪音？</strong></p>
<p>监控或报警系统中因误报、重复告警或配置不当导致的冗余信息。它们不会帮助研发定位问题,反而会淹没关键告警,导致研发人员"告警疲劳"。常见原因有灵敏度设置过高、监控配置不当等。</p>
</blockquote>
<h3 data-id="heading-2">现状及痛点</h3>
<p>基于规则的告警（同环比）</p>
<ul>
<li>
<p>基于市场、城市、车型、领域的告警配置高达200+</p>
</li>
<li>
<p>业务受天气、节假日、特殊事件影响大，非常容易击穿同步比阈值，从而触发告警</p>
</li>
</ul>
<p><strong>2024全年</strong> P0 告警次数 <strong>7000+</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34b30a29526a47f6af366c5693b19a1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=RqktlthG%2FbOMjbpl3xcHaif3nr8%3D" alt="" loading="lazy"/></p>
<p><strong>Top reasons</strong> （告警次数最多的30天），<strong>3097</strong>次，约占全年的50%。</p>
<p>节假日：1922次，占比 <strong>62%</strong></p>
<p>特殊天气：577次，占比 <strong>30%</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce9be249ba63403c9b3f4e04c82f7feb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=b3jG2coPGl96vu%2Fh5j1UnR1gpek%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>工作量大、效率低</p>
</li>
<li>
<p>24小时触发</p>
</li>
</ul>
<h2 data-id="heading-3">降噪方案</h2>
<ul>
<li>
<p><strong>规则优化：</strong> 如调整灵敏度,过滤非紧急告警等。</p>
</li>
<li>
<p>**智能算法：**基于历史数据,采用机器学习模型预测当前状态,从而避免静态规则导致的不准确性。</p>
</li>
</ul>
<p>解法一：基于规则优化</p>
<p><strong>优点</strong> ：无需开发，基于monitor告警能力，调整阈值</p>
<p><strong>缺点</strong> ：</p>
<ol>
<li>
<p>告警配置多，需要给每个市场单独配置告警</p>
</li>
<li>
<p>阈值高度依赖研发经验，阈值固定</p>
</li>
<li>
<p>随着业务发展，需要不断的维护。</p>
</li>
</ol>
<p>解法二：基于智能算法-动态阈值</p>
<p><strong>优点：</strong></p>
<ol>
<li>
<p>自动感知工作日、周末、节假日、特殊天气等情况</p>
</li>
<li>
<p>阈值精确</p>
</li>
<li>
<p>理论上一条告警配置就可以覆盖所有市场</p>
</li>
</ol>
<p><strong>缺点：</strong></p>
<ol>
<li>
<p>技术门槛高</p>
</li>
<li>
<p>数据不可解释性以及预测准确度问题。</p>
</li>
</ol>
<h2 data-id="heading-4">智能算法技术原理</h2>
<p><strong>训练单量预测模型-时间序列预测</strong></p>
<p>基于历史数据以及机器学习技术训练Lalamove单量预测模型，结合实时订单量，天气，节假日等信息，预测接下来一个10分钟的最低订单量。以此来区分固定阈值无法判断的正常波动。</p>
<h3 data-id="heading-5">整体架构</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9dea045dc5254e07aae896f25a66f443~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=U2BrEPoWM996R%2BRCdf4QenslKj8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">数据流</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e49b7644535b4f598a209a3e419e3119~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=J53Q0onapM3SqLSWcRyxTeEovyY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">关键实现</h2>
<h3 data-id="heading-8">特征工程</h3>
<p><strong>问题设定</strong></p>
<ul>
<li>我们把订单波动区域范围的预测看作历史订单的<strong>时间序列预测问题</strong>,透过<strong>机器学习模型</strong>,根据某一 <strong>历史订单流量</strong> 情况下,预测 <strong>未来最大/最小可能出现的订单波动</strong> ,作为告警阈值。</li>
</ul>
<p><strong>数据来源</strong></p>
<ul>
<li>
<p>历史订单数据</p>
</li>
<li>
<p>全球节假日数据</p>
</li>
<li>
<p>全球天气数据</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d652f1201a744cbf9377b09b466a6c5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=aDcbtrxMHN2S0LglcFm%2FltiXRno%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-9">场景一：节假日</h4>
<ul>
<li>
<p>订单数量异常下降,主要体现在节假日期间</p>
</li>
<li>
<p>订单数量在周维度会出现周期性的波动</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0800cf024e5d46bb88da1a25aa5ad08e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=Ih6gHt2XceXgCh9RbD%2Bpxmt0dJc%3D" alt="" loading="lazy"/></p>
<p><strong>特征编码</strong></p>
<p><strong>1.如何让一个机器学习模型在感知上区分以下两种情况?</strong></p>
<ul>
<li>
<p>情人节与儿童节对订单量影响较小</p>
</li>
<li>
<p>春节对订单量影响较大</p>
</li>
</ul>
<p>我们的选择是 <strong>目标编码（Target Encoding）。</strong></p>
<p>通过历史数据,计算某一个节假日在各个年度对应的订单水位取平均值,将其作为新的特征。</p>
<p>例如:中秋节日订单每一年皆处于全年日订单量约20%的水位。可用该均值作为编码。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca2ac472cd094e9289362c46c03f7e68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=fJLcwl8foX9KesXSb2%2Ft2CGY1Rk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9378ca8e06ab446aa5ef4d240b629205~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=0EGhKNgLyvCJv3oReRMVN9tUQJY%3D" alt="" loading="lazy"/></p>
<p><strong>2.目标编码的优势</strong></p>
<ul>
<li>
<p>更直接反映节假日对业务的真实影响</p>
</li>
<li>
<p>单个特征能够涵盖各种特殊事件(节假日/疫情/天气)</p>
</li>
</ul>
<h4 data-id="heading-10">场景二：天气</h4>
<p><strong>1.经验假设</strong></p>
<p>根据我们的业务经验来看，极端天气对订单影响非常大，例如东南亚地区多发台风，单量也仅此出现大幅度降低。</p>
<p><strong>因此，我们假设极端天气对订单有直接的关系，而进一步假设降雨量，风速对订单量有影响。</strong></p>
<p><strong>2.验证假设</strong></p>
<p><strong>选取案例进行验证-</strong> 菲律宾2024年7月23日台风-格美</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7764e72f39a140c0ba20f83a3238df14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=VIf9AxTzPURk1XWbIePS63m%2F1ak%3D" alt="" loading="lazy"/></p>
<p>由上图我们发现除了降雨量，风速有影响外，气压、阵风在这个场景中也出现了共振。</p>
<p><strong>3.修正假设</strong></p>
<p>风速/气压/降雨量/阵风等信息能够综合判断出极端天气</p>
<p><strong>4.验证普遍性</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/528ad2e926584d17ac4516cd25832aa1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=mYE%2BYoMHPNcmJVUYkdEoCFSvfhU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">模型训练</h3>
<p><strong>分位数回归LGBM (决策树模型)</strong></p>
<p>LGBM (LightGBM)是一种高效的梯度提升决策树算法,适用于大规模数据的回归和分类任务。</p>
<p>百分位数回归(QuantileRegression)通过预测目标变量的不同同分位数(而不仅仅是均值),能够更全面地反映数据</p>
<p>的分布情况。应用该方法,可以根据历史订单数据,预测订单量在不同置信区间下的动态阈值。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f3270e4fab24a6f87ae3443f8532cf1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=F4lzmUjEFYLUn4%2B08q6r6PT%2BkOs%3D" alt="" loading="lazy"/></p>
<p><strong>模型比较</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ffaa44b53ec46beb07aed0d3d739b52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=O%2B7h6cmosvbzBtPicaPVKwDuSB0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">工程链路</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e7e71a5421942debfd6057e8ffe8b87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=vtAx0%2Bduk1faFCWHQXPy3wXIGvA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-13">降噪服务</h3>
<p><strong>有了模型预测值，为什么还要降噪服务？</strong></p>
<ol>
<li><strong>模型误差率</strong> ：在模型的训练上，我们追求高精准度，从上面模型准确率的统计数据来看，整体能达到94%，但仍有6%，节假日也有近20%的误差率。但对于线上告警系统来说，就仍然有几率出现噪音。如下图所示，预测值会在实际值上下小范围波动。</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/288facfd823a44c7a967c1b32d259007~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=nyhJaTcnxAdSc5J2wV57BPwCucY%3D" alt="" loading="lazy"/></p>
<ol>
<li>
<p><strong>模型系统的稳定性</strong> ：需要考虑系统故障时候的降级兜底能力。</p>
</li>
<li>
<p><strong>低流量市场、低峰期,订单数据波动较大，模型预测效果不可用。</strong></p>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94d05781fcfc49b78522ab70bda049a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=ArIseNnU95onjRnr8xB7g2vtya8%3D" alt="" loading="lazy"/></p>
<p><strong>降噪服务能力设计</strong></p>
<ul>
<li>
<p>数据查询：提供给外部监控平台阈值查询的能力。</p>
</li>
<li>
<p>数据校验：对模型预测结果进行有效性校验。防止出现连续时间段的偏差值过大。</p>
</li>
<li>
<p>数据兜底：如果模型没有产生预测值，需要兜底降级到固定配置或者前一时刻的值。</p>
</li>
<li>
<p>数据聚合：对城市、车型、市场数据进行聚合，供不同告警配置使用。</p>
</li>
<li>
<p>数据缓冲：对模型产生的值进行buff调节，进行容错处理。</p>
</li>
<li>
<p>时段感知：感知高低峰期，对模型预测值进行干预。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/944bcece84294066877450e58212256f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=KDVB0t7aQaBXEvd0Cb9GmGgT7D4%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8d66f007f5c4aa586809dcb96899871~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=B92MaYReSeeZyRsCRiq4OKBBE2E%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-14">阈值反馈调整机制</h3>
<p>本次采用模型参数微调和降噪服务数据缓冲相结合的方式。</p>
<blockquote>
<p>参数微调：通过不断调整模型参数，提高预测数据准确度。</p>
<p>数据缓冲：通过观测业务特征、对不同市场添加buff来自定义阈值灵敏度。</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67ee163896b344c2a32f4f71c41d1853~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=MGxs9C0Hm4Osjk8Y3yTiX0cVUjM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-15">效果展示</h2>
<p><strong>工作日和周末</strong></p>
<p>最低预测值平均基本是实际值的80%左右,而同环比下限固定值平均基本是实际值的70%左右,下限阈值准确度提值升了约10%,最高预测值平均基本是实际值的130%左右,同环比上限固定值平均基本是实际值的150%左右,上限阈准确度提升了约20%。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50c4a892099f441daff06c0fe3f21b4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=b%2FuJuN0j3tFnTgRvf3Eo3KncfuQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2de2c688c1dd4bbbba4acb224086b954~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=qpJLyO8vKa4SezoqlDEHr08%2Bt8I%3D" alt="" loading="lazy"/></p>
<p><strong>节假日 ：中国香港重阳节</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4df6d4428a15473494d7317b928028cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=AVahaKY81X9UvSg84CsdwwMm%2BdY%3D" alt="" loading="lazy"/></p>
<p><strong>突发场景/事件-台风 2025-11-09 菲律宾台风</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69bca5a3208446ddac547edea6c095db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767276686&amp;x-signature=rxdoNpCFWozG0vDLPJfwHS4uDMM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-16">总结</h2>
<p>智能告警降噪通过机器学习技术，实现了从被动响应到主动防御的跨越，成为保障业务稳定性的核心工具。 未来趋势包括强化模型健壮性、优化多时区适配及探索生成式AI在告警分析中的应用。 目前智能告警降噪机制已经运行在了Lalamove的核心交易、计价领域，实现了噪音80%的下降。大大减轻了值班人员的工作压力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ASP.NET Core 依赖注入的三种服务生命周期]]></title>    <link>https://juejin.cn/post/7587631760253747219</link>    <guid>https://juejin.cn/post/7587631760253747219</guid>    <pubDate>2025-12-25T14:30:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587631760253747219" data-draft-id="7587631760253730835" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ASP.NET Core 依赖注入的三种服务生命周期"/> <meta itemprop="keywords" content="后端,.NET"/> <meta itemprop="datePublished" content="2025-12-25T14:30:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ASP.NET Core 依赖注入的三种服务生命周期
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T14:30:15.000Z" title="Thu Dec 25 2025 14:30:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p><strong>依赖注入（Dependency Injection, DI）</strong> 是一种实现控制反转（Inversion of Control, IoC） 的软件设计模式，也是构建松耦合、可测试、易维护应用程序的核心技术。其核心理念是：不要在类内部创建依赖，而是由外部容器将依赖注入进来。</p>
<p>在现代 ASP.NET Core 中内置了强大的 DI 容器，正确使用 DI 的关键在于理解 <strong>Transient、Scoped 和 Singleton</strong> 这三种服务生命周期，它们决定了服务实例的创建时机、共享范围与生命周期。本文将清晰解析三者的区别和适用场景。</p>
<h2 data-id="heading-1">简单概述</h2>
<p>在 ASP.NET Core 中，依赖注入容器通过<code>IServiceCollection</code>支持三种服务注册生命周期：</p>
<blockquote>
<p>IServiceCollection 是 .NET 依赖注入（DI）系统中的核心接口之一，用于注册和管理应用程序所需的服务。</p>
</blockquote>





























<table><thead><tr><th>生命周期</th><th>注册方法</th><th>实例创建时机</th><th>共享范围</th></tr></thead><tbody><tr><td>Transient（瞬态）</td><td><code>AddTransient&lt;T&gt;()</code></td><td>每次请求都创建新实例</td><td>不共享</td></tr><tr><td>Scoped（作用域）</td><td><code>AddScoped&lt;T&gt;()</code></td><td>每个作用域（如 HTTP 请求）创建一次</td><td>在同一作用域内共享</td></tr><tr><td>Singleton（单例）</td><td><code>AddSingleton&lt;T&gt;()</code></td><td>应用启动时创建一次（或首次使用时）</td><td>整个应用生命周期共享</td></tr></tbody></table>
<h2 data-id="heading-2">选型口诀</h2>
<ul>
<li>跨请求共享、需复用 → Singleton（线程安全要做好）</li>
<li>请求内共享、一致性、上下文传递 → Scoped</li>
<li>一次性、无状态、轻量 → Transient</li>
</ul>
<h2 data-id="heading-3">Transient（瞬态）</h2>
<p>每次从 DI 容器请求服务时，都会创建一个<strong>全新的实例</strong>。</p>
<h3 data-id="heading-4">适用场景</h3>
<ul>
<li>轻量级、无状态的服务。</li>
<li>请求级独立状态：每次调用需要独立状态或副作用隔离的组件。</li>
<li>短生命周期依赖链：依赖链中各服务都很轻、无共享资源的场景。</li>
</ul>
<h2 data-id="heading-5">Scoped（作用域）</h2>
<p>在<strong>同一个作用域内</strong>共享同一个实例，不同作用域创建不同实例。</p>
<p>在 ASP.NET Core 中，<strong>每个 HTTP 请求就是一个作用域</strong>。</p>
<h3 data-id="heading-6">适用场景</h3>
<ul>
<li>需要在单次请求中共享状态的服务。</li>
<li>数据库上下文（DbContext）：AddDbContext() 默认注册为 Scoped，保证同一 HTTP 请求内复用同一个数据库上下文，避免实体跟踪混乱、重复连接开销，并支持事务一致性。</li>
<li>工作单元（Unit of Work）与数据仓储（Repository）：与 DbContext 同生命周期，保障查询→修改→提交的一致性，并减少资源创建销毁。</li>
</ul>
<h2 data-id="heading-7">Singleton（单例）</h2>
<p>整个应用程序生命周期内<strong>只创建一次实例</strong>，所有请求共享同一个对象。</p>
<h3 data-id="heading-8">适用场景</h3>
<ul>
<li>无状态、线程安全的全局服务（如工具类、映射器）。</li>
<li>配置封装服务（如 IAppSettings），启动后内容不变。</li>
<li>全局缓存（如 IMemoryCache），需跨请求共享数据。</li>
</ul>
<h2 data-id="heading-9">参考文章</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Flearn.microsoft.com%2Fzh-cn%2Fdotnet%2Fcore%2Fextensions%2Fdependency-injection%23service-lifetimes" target="_blank" title="https://learn.microsoft.com/zh-cn/dotnet/core/extensions/dependency-injection#service-lifetimes" ref="nofollow noopener noreferrer">learn.microsoft.com/zh-cn/dotne…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一个 .NET 开源免费、功能强大的 UI 自动化库]]></title>    <link>https://juejin.cn/post/7587636536897536036</link>    <guid>https://juejin.cn/post/7587636536897536036</guid>    <pubDate>2025-12-25T14:33:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587636536897536036" data-draft-id="7587672626756894739" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一个 .NET 开源免费、功能强大的 UI 自动化库"/> <meta itemprop="keywords" content="后端,.NET"/> <meta itemprop="datePublished" content="2025-12-25T14:33:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一个 .NET 开源免费、功能强大的 UI 自动化库
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T14:33:10.000Z" title="Thu Dec 25 2025 14:33:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>今天大姚给大家分享一个 .NET 开源免费（MIT license）、功能强大的 UI 自动化库：FlaUI。</p>
<h2 data-id="heading-1">项目介绍</h2>
<p>FlaUI 是一个 .NET 开源免费（MIT license）、功能强大 的 UI 自动化库，专为 Windows 桌面应用程序（如 Win32、WinForms、WPF、Store Apps 等应用）的自动化测试而设计。该项目基于 Microsoft 的原生 UI Automation 库构建，并作为这些库的封装器，提供了丰富的功能和灵活的 API，以便开发者能够高效地编写自动化测试脚本。</p>
<h2 data-id="heading-2">应用场景</h2>
<p>FlaUI 适用于多种自动化测试场景，包括但不限于：</p>
<ul>
<li><strong>功能测试</strong>：验证应用程序的各项功能是否正常工作。</li>
<li><strong>回归测试</strong>：在应用程序更新后，确保现有功能不受影响。</li>
<li><strong>UI 验证</strong>：检查 UI 元素是否按预期显示和交互。</li>
<li><strong>等等等...</strong></li>
</ul>
<h2 data-id="heading-3">项目源代码</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cedf678b80d6493e9fde68fb13ee74a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767277989&amp;x-signature=Lq4QEKFZ3nqU7m%2BBCVO1Cgi%2Fx4Q%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">创建 FlaUIExercise</h2>
<p>创建名为<code>FlaUIExercise</code>的控制台应用：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfa6232117f04636b60cc407e5a1e2f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767277989&amp;x-signature=rYxjAN6SSCkwsRoiid0X9cRmZVk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af40078f95aa4caaa24c18a4617cf7d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767277989&amp;x-signature=1EM5UrsqYx7GaP4pCEpV5zmIv7M%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">NuGet 包安装</h2>
<p>在 NuGet 包管理器中搜索 <code>FlaUI.UIA3</code> 安装：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8fa7dd35392d457b9bcd30c521bbac33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767277989&amp;x-signature=4K7cU%2B4R1KmTY8VKKCr6PuptJco%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">操作记事本（Notepad）</h2>
<pre><code class="hljs language-csharp" lang="csharp">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
        {
            OperateNotepad();
        }

        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> 操作记事本（Notepad）</span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OperateNotepad</span>()</span>
        {
            <span class="hljs-comment">// 启动记事本</span>
            <span class="hljs-keyword">var</span> notepadApp = Application.Launch(<span class="hljs-string">"notepad.exe"</span>);
            <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> automation = <span class="hljs-keyword">new</span> UIA3Automation())
            {
                <span class="hljs-keyword">var</span> window = notepadApp.GetMainWindow(automation);
                window.WaitUntilClickable();

                Console.WriteLine(window.Title);

                <span class="hljs-comment">// 获取编辑框（Edit 控件）</span>
                <span class="hljs-keyword">var</span> edit = window.FindFirstDescendant(cf =&gt; cf.ByControlType(ControlType.Document))
                                ?.AsTextBox();

                <span class="hljs-keyword">if</span> (edit == <span class="hljs-literal">null</span>)
                {
                    Console.WriteLine(<span class="hljs-string">"未找到记事本编辑区域！"</span>);
                    notepadApp.Close();
                    <span class="hljs-keyword">return</span>;
                }

                <span class="hljs-comment">// 输入文本</span>
                edit.Text = <span class="hljs-string">"⚔【DotNetGuide专栏C#/.NET/.NET Core编程技巧练习集】C#/.NET/.NET Core编程常用语法、算法、技巧、中间件、类库、工作业务实操练习集，配套详细的文章教程和代码示例，助力快速掌握C#/.NET/.NET Core中各种编程常用语法、算法、技巧、中间件、类库、工作业务实操等等。"</span>;
                notepadApp.Close();
            }

            <span class="hljs-keyword">return</span>;
        }
    }
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93bc2b2cd06e459da4f1028c9650dec6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767277989&amp;x-signature=z%2Ffs6sz%2FCXpHoCIcbeYH4sYHgvQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">项目源码地址</h2>
<p>更多项目实用功能和特性欢迎前往项目开源地址查看👀，别忘了给项目一个Star支持💖。</p>
<ul>
<li><strong>GitHub开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFlaUI%2FFlaUI" target="_blank" title="https://github.com/FlaUI/FlaUI" ref="nofollow noopener noreferrer">github.com/FlaUI/FlaUI</a></li>
<li><strong>本文代码示例：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetExercises%2Ftree%2Fmaster%2FFlaUIExercise" target="_blank" title="https://github.com/YSGStudyHards/DotNetExercises/tree/master/FlaUIExercise" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
</ul>
<h2 data-id="heading-8">优秀项目和框架精选</h2>
<p>该项目已收录到C#/.NET/.NET Core优秀项目和框架精选中，关注优秀项目和框架精选能让你及时了解C#、.NET和.NET Core领域的最新动态和最佳实践，提高开发工作效率和质量。坑已挖，欢迎大家踊跃提交PR推荐或自荐（<strong>让优秀的项目和框架不被埋没🤞</strong>）。</p>
<ul>
<li><strong>GitHub开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
<li><strong>Gitee开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fysgdaydayup%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">gitee.com/ysgdaydayup…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flink源码阅读：窗口]]></title>    <link>https://juejin.cn/post/7587779957654257690</link>    <guid>https://juejin.cn/post/7587779957654257690</guid>    <pubDate>2025-12-25T14:34:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587779957654257690" data-draft-id="7587604932058595379" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flink源码阅读：窗口"/> <meta itemprop="keywords" content="Flink,大数据"/> <meta itemprop="datePublished" content="2025-12-25T14:34:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="面向Google编程"/> <meta itemprop="url" content="https://juejin.cn/user/1063982986695374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flink源码阅读：窗口
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1063982986695374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    面向Google编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T14:34:51.000Z" title="Thu Dec 25 2025 14:34:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前文我们梳理了 Watermark 相关的源码，Watermark 的作用就是用来触发窗口，本文我们就一起看一下窗口相关的源码。</p>
<h3 data-id="heading-0">写在前面</h3>
<p>在<a href="https://link.juejin.cn?target=https%3A%2F%2Fjackeyzhe.github.io%2F2025%2F07%2F19%2FFlink%25E5%25AD%25A6%25E4%25B9%25A0%25E7%25AC%2594%25E8%25AE%25B0%25EF%25BC%259A%25E7%25AA%2597%25E5%258F%25A3%2F" target="_blank" title="https://jackeyzhe.github.io/2025/07/19/Flink%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9A%E7%AA%97%E5%8F%A3/" ref="nofollow noopener noreferrer">Flink学习笔记：窗口</a>一文中，我们介绍了窗口的分类以及基本的用法。按照处理数据流的类型划分，Flink 可以分为 Keyed Window 和 Non-Keyed Window，它们的用法如下：</p>
<pre><code class="hljs language-scss" lang="scss">stream
       <span class="hljs-selector-class">.keyBy</span>(...)               &lt;-  仅 keyed 窗口需要
       <span class="hljs-selector-class">.window</span>(...)              &lt;-  必填项："assigner"
      <span class="hljs-selector-attr">[.trigger(...)]</span>            &lt;-  可选项："trigger" (省略则使用默认 trigger)
      <span class="hljs-selector-attr">[.evictor(...)]</span>            &lt;-  可选项："evictor" (省略则不使用 evictor)
      <span class="hljs-selector-attr">[.allowedLateness(...)]</span>    &lt;-  可选项："lateness" (省略则为 <span class="hljs-number">0</span>)
      <span class="hljs-selector-attr">[.sideOutputLateData(...)]</span> &lt;-  可选项："output tag" (省略则不对迟到数据使用 side output)
       <span class="hljs-selector-class">.reduce</span>/aggregate/<span class="hljs-built_in">apply</span>()      &lt;-  必填项："function"
      <span class="hljs-selector-attr">[.getSideOutput(...)]</span>      &lt;-  可选项："output tag"

stream
       <span class="hljs-selector-class">.windowAll</span>(...)           &lt;-  必填项："assigner"
      <span class="hljs-selector-attr">[.trigger(...)]</span>            &lt;-  可选项："trigger" (else default trigger)
      <span class="hljs-selector-attr">[.evictor(...)]</span>            &lt;-  可选项："evictor" (else no evictor)
      <span class="hljs-selector-attr">[.allowedLateness(...)]</span>    &lt;-  可选项："lateness" (else zero)
      <span class="hljs-selector-attr">[.sideOutputLateData(...)]</span> &lt;-  可选项："output tag" (else no side output for late data)
       <span class="hljs-selector-class">.reduce</span>/aggregate/<span class="hljs-built_in">apply</span>()      &lt;-  必填项："function"
      <span class="hljs-selector-attr">[.getSideOutput(...)]</span>      &lt;-  可选项："output tag"
</code></pre>
<p>下面我们根据用法，分别来看两种窗口的源码。</p>
<h3 data-id="heading-1">Keyed Window</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/789667a9f12341668e0281b6bd9614dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767278090&amp;x-signature=0fqBfo0WH0l47iGqvNuMsYc3ZpY%3D" alt="KeyedWindow" loading="lazy"/></p>
<h4 data-id="heading-2">WindowAssigner</h4>
<p>在示例代码中，数据流类型流转过程如图。我们聚焦于 WindowedStream，它是在调用 <code>KeyedStream.window</code> 方法之后生成的。window 方法需要传入一个 WindowAssigner，用来确定一条消息属于哪几个窗口，各个类型的窗口都有不同的实现。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7333b53b60049e887cc066a07d072a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767278090&amp;x-signature=t%2FvIFnEkfNMF3yf5bW6KMBPTR5I%3D" alt="windowAssigner" loading="lazy"/></p>
<p>我们以 TumblingEventTimeWindows 为例，看一下它具体的分配逻辑。</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">public</span> Collection&lt;TimeWindow&gt; <span class="hljs-title">assignWindows</span><span class="hljs-params">(
        Object element, <span class="hljs-type">long</span> timestamp, WindowAssignerContext context)</span> </span>{
    <span class="hljs-keyword">if</span> (timestamp &gt; Long.MIN_VALUE) {
        <span class="hljs-keyword">if</span> (staggerOffset == null) {
            staggerOffset =
                    windowStagger.<span class="hljs-built_in">getStaggerOffset</span>(context.<span class="hljs-built_in">getCurrentProcessingTime</span>(), size);
        }
        <span class="hljs-comment">// Long.MIN_VALUE is currently assigned when no timestamp is present</span>
        <span class="hljs-type">long</span> start =
                TimeWindow.<span class="hljs-built_in">getWindowStartWithOffset</span>(
                        timestamp, (globalOffset + staggerOffset) % size, size);
        <span class="hljs-keyword">return</span> Collections.<span class="hljs-built_in">singletonList</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">TimeWindow</span>(start, start + size));
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RuntimeException</span>(
                <span class="hljs-string">"Record has Long.MIN_VALUE timestamp (= no timestamp marker). "</span>
                        + <span class="hljs-string">"Did you forget to call 'DataStream.assignTimestampsAndWatermarks(...)'?"</span>);
    }
}
</code></pre>
<p>这里就是根据消息的 timestamp 来确定窗口的开始和结束时间，然后返回消息所属的窗口。这里还有个 windowStagger 变量，它是窗口触发是否错峰的配置，如果你的任务有成千上万个子任务，同时触发窗口计算带来的瞬时流量可能会对服务器本身和下游造成稳定性的影响，这时就可以通过修改 WindowStagger 配置将流量打散。</p>
<p>将我们自己定义好的 WindowAssigner 传入 window 方法后，会创建一个 WindowOperatorBuilder，它负责创建一个 WindowOperator 对象，WindowOperator 来执行窗口具体的计算逻辑。</p>
<pre><code class="hljs language-ini" lang="ini">public WindowedStream(KeyedStream&lt;T, K&gt; input, WindowAssigner&lt;? super T, W&gt; windowAssigner) {

    <span class="hljs-attr">this.input</span> = input<span class="hljs-comment">;</span>
    <span class="hljs-attr">this.isEnableAsyncState</span> = input.isEnableAsyncState()<span class="hljs-comment">;</span>

    <span class="hljs-attr">this.builder</span> =
            new WindowOperatorBuilder&lt;&gt;(
                    windowAssigner,
                    windowAssigner.getDefaultTrigger(),
                    input.getExecutionConfig(),
                    input.getType(),
                    input.getKeySelector(),
                    input.getKeyType())<span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-3">Trigger</h4>
<p>有了 WindowOperatorBuilder 之后，我们可以对它进行一些设置，如 trigger、evictor 等，trigger 中提供了一些回调函数，这些回调函数的返回结果 TriggerResult 决定了是否触发窗口计算。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Trigger</span>&lt;T, W <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Window</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> -<span class="hljs-number">4104633972991191369L</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> TriggerResult <span class="hljs-title function_">onElement</span><span class="hljs-params">(T element, <span class="hljs-type">long</span> timestamp, W window, TriggerContext ctx)</span>
            <span class="hljs-keyword">throws</span> Exception;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> TriggerResult <span class="hljs-title function_">onProcessingTime</span><span class="hljs-params">(<span class="hljs-type">long</span> time, W window, TriggerContext ctx)</span>
            <span class="hljs-keyword">throws</span> Exception;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> TriggerResult <span class="hljs-title function_">onEventTime</span><span class="hljs-params">(<span class="hljs-type">long</span> time, W window, TriggerContext ctx)</span>
            <span class="hljs-keyword">throws</span> Exception;

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canMerge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMerge</span><span class="hljs-params">(W window, OnMergeContext ctx)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(<span class="hljs-string">"This trigger does not support merging."</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">(W window, TriggerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception;
}
</code></pre>
<p>回调函数有三个，分别是 onElement、onProcessingTime、onEventTime，onElement 是在处理每条消息的时候触发，onProcessingTime 和 onEventTime 都是与定时器配合触发，上一篇文章我们提到过，在处理 Watermark 的时候会注册定时器，触发时就会回调这两个方法。</p>
<p>此外，Trigger 类中还有三个方法，我们简单介绍一下。canMerge 是用来判断窗口是否可以被合并，onMerge 则是在合并窗口时的回调方法。clear 方法用于清除窗口的状态数据。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">TriggerResult</span> </span>{

    <span class="hljs-comment">/** No action is taken on the window. */</span>
    <span class="hljs-title function_ invoke__">CONTINUE</span>(<span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>),

    <span class="hljs-comment">/** {<span class="hljs-doctag">@code</span> FIRE_AND_PURGE} evaluates the window function and emits the window result. */</span>
    <span class="hljs-title function_ invoke__">FIRE_AND_PURGE</span>(<span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>),

    <span class="hljs-comment">/**
     * On {<span class="hljs-doctag">@code</span> FIRE}, the window is evaluated and results are emitted. The window is not purged,
     * though, all elements are retained.
     */</span>
    <span class="hljs-title function_ invoke__">FIRE</span>(<span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>),

    <span class="hljs-comment">/**
     * All elements in the window are cleared and the window is discarded, without evaluating the
     * window function or emitting any elements.
     */</span>
    <span class="hljs-title function_ invoke__">PURGE</span>(<span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
}
</code></pre>
<p>说回 TriggerResult，它有四种枚举：</p>
<ul>
<li>CONTINUE：什么也不做</li>
<li>FIRE_AND_PURGE：触发窗口计算并清除窗口中的元素</li>
<li>FIRE：只触发窗口计算</li>
<li>PURGE：清除窗口中的元素，不触发计算</li>
</ul>
<h4 data-id="heading-4">Evictor</h4>
<p>Evictor 是用来自定义删除窗口中元素的的接口，如果设置了 evictor，WindowOperatorBuilder 就会创建 EvictingWindowOperator。在执行窗口计算逻辑前后，都会调用 evictBefore 和 evictAfter。</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">private</span> void emitWindowContents(
        <span class="hljs-type">W</span> window, <span class="hljs-type">Iterable</span>&lt;<span class="hljs-type">StreamRecord</span>&lt;<span class="hljs-type">IN</span>&gt;&gt; contents, <span class="hljs-type">ListState</span>&lt;<span class="hljs-type">StreamRecord</span>&lt;<span class="hljs-type">IN</span>&gt;&gt; windowState)
        <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span> {
    <span class="hljs-operator">...</span>
    evictorContext.evictBefore(recordsWithTimestamp, <span class="hljs-type">Iterables</span>.size(recordsWithTimestamp));

    <span class="hljs-type">FluentIterable</span>&lt;<span class="hljs-type">IN</span>&gt; projectedContents <span class="hljs-operator">=</span>
            recordsWithTimestamp.transform(
                    new <span class="hljs-type">Function</span>&lt;<span class="hljs-type">TimestampedValue</span>&lt;<span class="hljs-type">IN</span>&gt;, <span class="hljs-type">IN</span>&gt;() {
                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">public</span> <span class="hljs-type">IN</span> apply(<span class="hljs-type">TimestampedValue</span>&lt;<span class="hljs-type">IN</span>&gt; input) {
                            <span class="hljs-keyword">return</span> input.getValue();
                        }
                    });

    processContext.window <span class="hljs-operator">=</span> triggerContext.window;
    userFunction.process(
            triggerContext.key,
            triggerContext.window,
            processContext,
            projectedContents,
            timestampedCollector);
    evictorContext.evictAfter(recordsWithTimestamp, <span class="hljs-type">Iterables</span>.size(recordsWithTimestamp));
    <span class="hljs-operator">...</span>
}
</code></pre>
<h4 data-id="heading-5">allowedLateness &amp; sideOutputLateData</h4>
<p>allowedLateness 和 sideOutputLateData 都是针对迟到数据的，allowedLateness 是用来指定允许的最大迟到时长，sideOutputLateData 则是将迟到数据输出到指定 outputTag。</p>
<p>判断是否迟到的方法如下：</p>
<pre><code class="hljs language-scss" lang="scss">protected boolean <span class="hljs-built_in">isElementLate</span>(StreamRecord&lt;IN&gt; element) {
    return (windowAssigner.isEventTime())
            &amp;&amp; (element.getTimestamp() + allowedLateness
                    &lt;= internalTimerService<span class="hljs-selector-class">.currentWatermark</span>());
}
</code></pre>
<p>如果是迟到数据，则进行如下处理：</p>
<pre><code class="hljs language-scss" lang="scss">if (isSkippedElement &amp;&amp; isElementLate(element)) {
    if (lateDataOutputTag != null) {
        <span class="hljs-built_in">sideOutput</span>(element);
    } else {
        this<span class="hljs-selector-class">.numLateRecordsDropped</span><span class="hljs-selector-class">.inc</span>();
    }
}
</code></pre>
<h4 data-id="heading-6">WindowOperator</h4>
<p>设置好 WindowOperatorBuilder 之后，接着就可以调用 process/aggregate/reduce 等方法进行数据计算。</p>
<p>我们以 process 方法为例，来看下具体的处理逻辑。</p>
<pre><code class="hljs language-ini" lang="ini">public &lt;R&gt; SingleOutputStreamOperator&lt;R&gt; process(
        ProcessWindowFunction&lt;T, R, K, W&gt; function, TypeInformation&lt;R&gt; resultType) {
    <span class="hljs-attr">function</span> = input.getExecutionEnvironment().clean(function)<span class="hljs-comment">;</span>

    final String <span class="hljs-attr">opName</span> = builder.generateOperatorName()<span class="hljs-comment">;</span>
    final String <span class="hljs-attr">opDesc</span> = builder.generateOperatorDescription(function, null)<span class="hljs-comment">;</span>

    OneInputStreamOperator&lt;T, R&gt; <span class="hljs-attr">operator</span> =
            isEnableAsyncState ? builder.asyncProcess(function) : builder.process(function)<span class="hljs-comment">;</span>

    return input.transform(opName, resultType, operator).setDescription(opDesc)<span class="hljs-comment">;</span>
}
</code></pre>
<p>在 <code>WindowedStream.process</code> 方法中，就是调用 WindowOperatorBuilder 的 process 方法（如果是异步则调用异步方法）生成 WindowOperator，再将 WindowOperator 加入到执行图中。</p>
<p>下面我们来看 WindowOperator 中几个重要的方法。</p>
<h5 data-id="heading-7">open</h5>
<p>首先是 open 方法，它主要负责进行初始化，包括创建 timerService，创建 windowState 等。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-built_in">super</span>.open();

    <span class="hljs-built_in">this</span>.numLateRecordsDropped = metrics.counter(LATE_ELEMENTS_DROPPED_METRIC_NAME);
    timestampedCollector = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TimestampedCollector</span>&lt;&gt;(output);

    internalTimerService = getInternalTimerService(<span class="hljs-string">"window-timers"</span>, windowSerializer, <span class="hljs-built_in">this</span>);

    triggerContext = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Context</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);
    processContext = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WindowContext</span>(<span class="hljs-literal">null</span>);

    windowAssignerContext =
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">WindowAssigner</span>.WindowAssignerContext() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getCurrentProcessingTime</span><span class="hljs-params">()</span> {
                    <span class="hljs-keyword">return</span> internalTimerService.currentProcessingTime();
                }
            };

    <span class="hljs-comment">// create (or restore) the state that hold the actual window contents</span>
    <span class="hljs-comment">// NOTE - the state may be null in the case of the overriding evicting window operator</span>
    <span class="hljs-keyword">if</span> (windowStateDescriptor != <span class="hljs-literal">null</span>) {
        windowState =
                (InternalAppendingState&lt;K, W, IN, ACC, ACC&gt;)
                        getOrCreateKeyedState(windowSerializer, windowStateDescriptor);
    }

    <span class="hljs-comment">// create the typed and helper states for merging windows</span>
    <span class="hljs-keyword">if</span> (windowAssigner <span class="hljs-keyword">instanceof</span> MergingWindowAssigner) {
        ...
    }
}
</code></pre>
<h5 data-id="heading-8">processElement</h5>
<p>processElement 是负责处理进入窗口的数据，这里首先调用 <code>WindowAssigner.assignWindows</code> 方法确认元素属于哪些窗口。然后遍历窗口进行处理，包括向 windowState 中添加元素，调用 trigger 的 onElement 方法获取 TriggerResult。如果触发了窗口计算，调用 emitWindowContents 执行计算逻辑。最后是处理迟到数据，我们前面提到过。</p>
<pre><code class="hljs language-scss" lang="scss">public void <span class="hljs-built_in">processElement</span>(StreamRecord&lt;IN&gt; element) throws Exception {
    final Collection&lt;W&gt; elementWindows =
            windowAssigner<span class="hljs-selector-class">.assignWindows</span>(
                    element.getValue(), element<span class="hljs-selector-class">.getTimestamp</span>(), windowAssignerContext);

    <span class="hljs-comment">// if element is handled by none of assigned elementWindows</span>
    boolean isSkippedElement = true;

    final K key = this.&lt;K&gt;<span class="hljs-built_in">getKeyedStateBackend</span>()<span class="hljs-selector-class">.getCurrentKey</span>();

    if (windowAssigner instanceof MergingWindowAssigner) {
        ...
    } else {
        for (W window : elementWindows) {

            <span class="hljs-comment">// drop if the window is already late</span>
            if (isWindowLate(window)) {
                continue;
            }
            isSkippedElement = false;

            windowState<span class="hljs-selector-class">.setCurrentNamespace</span>(window);
            windowState<span class="hljs-selector-class">.add</span>(element.getValue());

            triggerContext<span class="hljs-selector-class">.key</span> = key;
            triggerContext<span class="hljs-selector-class">.window</span> = window;

            TriggerResult triggerResult = triggerContext<span class="hljs-selector-class">.onElement</span>(element);

            if (triggerResult.isFire()) {
                ACC contents = windowState<span class="hljs-selector-class">.get</span>();
                if (contents != null) {
                    <span class="hljs-built_in">emitWindowContents</span>(window, contents);
                }
            }

            if (triggerResult.isPurge()) {
                windowState<span class="hljs-selector-class">.clear</span>();
            }
            <span class="hljs-built_in">registerCleanupTimer</span>(window);
        }
    }

    <span class="hljs-comment">// side output input event if</span>
    <span class="hljs-comment">// element not handled by any window</span>
    <span class="hljs-comment">// late arriving tag has been set</span>
    <span class="hljs-comment">// windowAssigner is event time and current timestamp + allowed lateness no less than</span>
    <span class="hljs-comment">// element timestamp</span>
    if (isSkippedElement &amp;&amp; isElementLate(element)) {
        if (lateDataOutputTag != null) {
            <span class="hljs-built_in">sideOutput</span>(element);
        } else {
            this<span class="hljs-selector-class">.numLateRecordsDropped</span><span class="hljs-selector-class">.inc</span>();
        }
    }
}
</code></pre>
<h5 data-id="heading-9">onEventTime</h5>
<p>onEventTime 方法是 eventTime 触发窗口计算时调用的。主要逻辑就是获取 TriggerResult，然后触发计算逻辑，以及对 windowState 的处理。</p>
<pre><code class="hljs language-scss" lang="scss">public void <span class="hljs-built_in">onEventTime</span>(InternalTimer&lt;K, W&gt; timer) throws Exception {
    triggerContext<span class="hljs-selector-class">.key</span> = timer<span class="hljs-selector-class">.getKey</span>();
    triggerContext<span class="hljs-selector-class">.window</span> = timer<span class="hljs-selector-class">.getNamespace</span>();

    MergingWindowSet&lt;W&gt; mergingWindows;

    if (windowAssigner instanceof MergingWindowAssigner) {
        mergingWindows = <span class="hljs-built_in">getMergingWindowSet</span>();
        W stateWindow = mergingWindows<span class="hljs-selector-class">.getStateWindow</span>(triggerContext.window);
        if (stateWindow == null) {
            <span class="hljs-comment">// Timer firing for non-existent window, this can only happen if a</span>
            <span class="hljs-comment">// trigger did not clean up timers. We have already cleared the merging</span>
            <span class="hljs-comment">// window and therefore the Trigger state, however, so nothing to do.</span>
            return;
        } else {
            windowState<span class="hljs-selector-class">.setCurrentNamespace</span>(stateWindow);
        }
    } else {
        windowState<span class="hljs-selector-class">.setCurrentNamespace</span>(triggerContext.window);
        mergingWindows = null;
    }

    TriggerResult triggerResult = triggerContext<span class="hljs-selector-class">.onEventTime</span>(timer.getTimestamp());

    if (triggerResult.isFire()) {
        ACC contents = windowState<span class="hljs-selector-class">.get</span>();
        if (contents != null) {
            <span class="hljs-built_in">emitWindowContents</span>(triggerContext.window, contents);
        }
    }

    if (triggerResult.isPurge()) {
        windowState<span class="hljs-selector-class">.clear</span>();
    }

    if (windowAssigner.isEventTime()
            &amp;&amp; <span class="hljs-built_in">isCleanupTime</span>(triggerContext.window, timer.getTimestamp())) {
        <span class="hljs-built_in">clearAllState</span>(triggerContext.window, windowState, mergingWindows);
    }

    if (mergingWindows != null) {
        <span class="hljs-comment">// need to make sure to update the merging state in state</span>
        mergingWindows<span class="hljs-selector-class">.persist</span>();
    }
}
</code></pre>
<h5 data-id="heading-10">onProcessingTime</h5>
<p>onProcessingTime 和 onEventTime 逻辑基本一致，只是触发条件不同，这里就不再赘述了。</p>
<p>至此，Keyed Window 从设置到使用的源码我们就梳理完成了，下面再来看另外一种窗口 Non-Keyed Window。</p>
<h3 data-id="heading-11">Non-Keyed Window</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f438c20d9b48493abb9cea012a582dac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767278090&amp;x-signature=zDnAhlt%2BeU4gncLHUZquXo6vKf8%3D" alt="AllWindow" loading="lazy"/></p>
<p>我们调用 windowAll 得到 AllWindowedStream，在构造函数中，会给对 input 调用 keyBy 方法，传入 NullByteKeySelector， NullByteKeySelector 对每个 key 都返回0，因此所有的 key 都会被分配到同一个节点。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NullByteKeySelector</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">KeySelector</span>&lt;T, Byte&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">614256539098549020L</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Byte <span class="hljs-title function_">getKey</span><span class="hljs-params">(T value)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
}
</code></pre>
<p>Non-Keyed Window 后续的逻辑都和 Keyed Window 比较类似。</p>
<h3 data-id="heading-12">总结</h3>
<p>本文我们梳理了窗口相关的源码，几个重点概念包括 WindowAssginer、WindowOperator、Trigger、Evictor。其中 WindowAssigner 是用来确定一条消息属于哪些窗口，WindowOperator 则是窗口计算逻辑的具体执行层。Trigger 和 Evictor 分别用于触发窗口和清理窗口中数据。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React Hooks 的“天条”：为啥绝对不能写在 if 语句里？]]></title>    <link>https://juejin.cn/post/7587605704635858978</link>    <guid>https://juejin.cn/post/7587605704635858978</guid>    <pubDate>2025-12-25T14:54:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587605704635858978" data-draft-id="7587594077015506978" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React Hooks 的“天条”：为啥绝对不能写在 if 语句里？"/> <meta itemprop="keywords" content="React.js,前端"/> <meta itemprop="datePublished" content="2025-12-25T14:54:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React Hooks 的“天条”：为啥绝对不能写在 if 语句里？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T14:54:02.000Z" title="Thu Dec 25 2025 14:54:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在折腾 React 的时候，你肯定被这个报错恶心过：</p>
<blockquote>
<p><strong>Rendered fewer hooks than expected. This may be caused by an accidental early return statement.</strong></p>
</blockquote>
<p>或者 ESLint 那个经典的黄牌警告：</p>
<blockquote>
<p><strong>React Hook "useState" is called conditionally...</strong></p>
</blockquote>
<p>这大概是 React 开发里最出名的“天条”了：<strong>Hooks 必须在最顶层调用，别往条件判断、循环或者嵌套函数里塞。</strong></p>
<p>很多老铁可能只是习惯性遵守，但心里估计在嘀咕：React 为啥这么“轴”？多加个判断怎么就崩了？它不能智能点吗？</p>
<p>今天咱们就拆开来看看，React 内部到底是咋玩这套“排队游戏”的。</p>
<h2 data-id="heading-0">核心真相：React 其实是个“大脸盲”</h2>
<p>理解这事的关键就在于：<strong>React 压根不知道你定义的 Hook 叫什么名字。</strong></p>
<p>在你代码里它是 <code>[count, setCount]</code>，但在 React 眼里，它只认序号：</p>
<ol>
<li>哦，这是<strong>第 1 个</strong> Hook。</li>
<li>哦，这是<strong>第 2 个</strong> Hook。</li>
<li>哦，这是<strong>第 3 个</strong> Hook。
...</li>
</ol>
<p>它完全是靠<strong>调用顺序</strong>来给状态“对号入座”的。</p>
<p>你可以把 React 管理 Hook 的方式想象成一个<strong>没有标签的储物柜</strong>：</p>
<pre><code class="hljs language-csharp" lang="csharp">第一次渲染，React 在心里默默记账：

[<span class="hljs-meta">1号柜子</span>] -&gt; 给第一个 useState 存个 <span class="hljs-number">0</span>
[<span class="hljs-meta">2号柜子</span>] -&gt; 给第一个 useEffect 存个副作用配置
[<span class="hljs-meta">3号柜子</span>] -&gt; 给第二个 useState 存个 <span class="hljs-string">'Hello'</span>
</code></pre>
<p>每次组件重新渲染，React 就像个“盲盒玩家”，按顺序开柜子：</p>
<ul>
<li>碰到代码里第 1 个 hook，它就去开 1 号柜子拿数据。</li>
<li>碰到代码里第 2 个 hook，它就去开 2 号柜子拿数据。</li>
</ul>
<h2 data-id="heading-1">翻车现场：当 <code>if</code> 搞乱了队伍</h2>
<p>假设我们写了段挺“合理”的逻辑：如果是登录状态，就记个名字；不然就只记个计数器。</p>
<p><strong>翻车代码长这样：</strong></p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">BadComponent</span>(<span class="hljs-params">{ isLoggedIn }</span>) {
  <span class="hljs-comment">// 🔴 危险动作！把 Hook 塞 if 里面了</span>
  <span class="hljs-keyword">if</span> (isLoggedIn) {
    <span class="hljs-keyword">const</span> [name, setName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">'Alice'</span>); <span class="hljs-comment">// 咱本意是想存个名字</span>
  }

  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// 咱本意是想存个数字</span>

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{count}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<h3 data-id="heading-2">第一次：登录状态（isLoggedIn = true）</h3>
<p>一切看起来很丝滑，React 默默排好了队：</p>























<table><thead><tr><th align="left">执行顺序</th><th align="left">你代码里的 Hook</th><th align="left">React 开的柜子</th><th align="left">存的数据</th></tr></thead><tbody><tr><td align="left">第 1 个</td><td align="left"><code>useState('Alice')</code></td><td align="left"><strong>1号柜</strong></td><td align="left"><code>'Alice'</code> (字符串)</td></tr><tr><td align="left">第 2 个</td><td align="left"><code>useState(0)</code></td><td align="left"><strong>2号柜</strong></td><td align="left"><code>0</code> (数字)</td></tr></tbody></table>
<h3 data-id="heading-3">第二次：退出了（isLoggedIn = false）</h3>
<p>用户一退出，<code>if</code> 里的代码直接被跳过了。</p>
<p>这时候，<strong>第一个</strong>被执行的 Hook 变成了 <code>useState(0)</code>。</p>
<p><strong>React 的脑回路：</strong>
“好嘞，碰到<strong>第 1 个</strong> Hook 了。不管你代码里叫它 count 还是啥，我直接去开<strong>1号柜</strong>取东西。”</p>
<p><strong>结果就尴尬了：</strong></p>



















<table><thead><tr><th align="left">执行顺序</th><th align="left">你代码里的 Hook</th><th align="left">React 开的柜子</th><th align="left">拿到的数据</th><th align="left">结果</th></tr></thead><tbody><tr><td align="left">第 1 个</td><td align="left"><code>useState(0)</code></td><td align="left"><strong>1号柜</strong></td><td align="left"><code>'Alice'</code></td><td align="left"><strong>💥 炸了！</strong></td></tr></tbody></table>
<p>原本该拿 <code>0</code> 的 <code>count</code> 变量，反手抓到了一个字符串 <code>'Alice'</code>。整个组件逻辑瞬间乱套，报错直接甩你脸上。</p>
<p>这就是为啥顺序绝对不能乱。只要中间少了一个或多了一个，后面的所有 Hook 统统都会“串位”。</p>
<h2 data-id="heading-4">为啥 React 不给 Hook 起个名字（Key）？</h2>
<p>肯定有人想过：React 既然“脸盲”，那给 Hook 加个 ID 不就结了？</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// ❌ 这种 API 纯属假想</span>
<span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">'myCountId'</span>, <span class="hljs-number">0</span>);
</code></pre>
<p>有了 ID，顺序乱了也能找着啊！</p>
<p>React 团队当时确实琢磨过这招，但最后觉得<strong>太心累了</strong>：</p>
<ol>
<li><strong>起名困难症</strong>：组件大了之后，你得给几十个 Hook 起唯一的名字，还得防着重名。</li>
<li><strong>自定义 Hook 难搞</strong>：你要是写个自定义 Hook，里面的 key 怎么保证不跟别人的冲突？</li>
<li><strong>代码太丑</strong>：到处都是字符串 ID，写起来一点都不简洁。</li>
</ol>
<p>所以 React 选了**“约定优于配置”**。它跟你达成一个默契：只要你保证不乱排队，它就能给你提供最干净的 API。</p>
<h2 data-id="heading-5">那正确姿势是啥？</h2>
<p>既然不能在 <code>if</code> 里写 Hook，碰到需要判断的情况咋办？</p>
<p><strong>其实很简单：Hook 照样跑，逻辑往里挪。</strong></p>
<h3 data-id="heading-6">1. 把判断往外移（最推荐）</h3>
<p>Hook 永远在顶层乖乖排队，只有展示的时候才去判断。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">GoodComponent</span>(<span class="hljs-params">{ isLoggedIn }</span>) {
  <span class="hljs-comment">// ✅ 大家都出来排队，谁也别缺席</span>
  <span class="hljs-keyword">const</span> [name, setName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">'Alice'</span>); 
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);

  <span class="hljs-comment">// ✅ 在 return 的时候再看要不要显摆</span>
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {isLoggedIn &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{name}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>}
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{count}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-7">2. 判断写在 Effect 里面</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// ✅ Hook 本身是稳定执行的，只是里面的逻辑可以按需触发</span>
  <span class="hljs-keyword">if</span> (isLoggedIn) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'偷偷干点活'</span>);
  }
}, [isLoggedIn]); 
</code></pre>
<h2 data-id="heading-8">最后一句话总结</h2>
<p><strong>React 的 Hooks 就像一群排队领盒饭的小朋友，必须按顺序站好。React 是闭着眼睛发饭的，谁要是敢插队或者中间溜了，后面的人领到的就不是鸡腿而是炸弹了。</strong></p>
<hr/>
<p>如果你觉得这篇文章有帮助，欢迎关注我的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">GitHub</a>，下面是我的一些开源项目：</p>
<p><strong>Claude Code Skills</strong>（按需加载，意图自动识别，不浪费 token，<a href="https://juejin.cn/post/7578714735307735066" target="_blank" title="https://juejin.cn/post/7578714735307735066">介绍文章</a>）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcode-review-skill" target="_blank" title="https://github.com/tt-a1i/code-review-skill" ref="nofollow noopener noreferrer">code-review-skill</a> - 代码审查技能，覆盖 React 19、Vue 3、TypeScript、Rust 等约 9000 行规则（<a href="https://juejin.cn/post/7578709098255908902" target="_blank" title="https://juejin.cn/post/7578709098255908902">详细介绍</a>）</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2F5-whys-skill" target="_blank" title="https://github.com/tt-a1i/5-whys-skill" ref="nofollow noopener noreferrer">5-whys-skill</a> - 5 Whys 根因分析，说"找根因"自动激活</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Ffirst-principles-skill" target="_blank" title="https://github.com/tt-a1i/first-principles-skill" ref="nofollow noopener noreferrer">first-principles-skill</a> - 第一性原理思考，适合架构设计和技术选型</li>
</ul>
<p><strong>vibe coding 原理学习</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhimanai.github.io%2Finnies-cli%2F" target="_blank" title="https://zhimanai.github.io/innies-cli/" ref="nofollow noopener noreferrer">qwen-cli 学习网站</a> - 学习 qwen-cli 时整理的笔记，40+ 交互式动画演示 AI CLI 内部机制</li>
</ul>
<p><strong>全栈项目</strong>（适合学习现代技术栈）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fprompt-vault" target="_blank" title="https://github.com/tt-a1i/prompt-vault" ref="nofollow noopener noreferrer">prompt-vault</a> - Prompt 管理器，用的都是最新的技术栈，适合用来学习了解最新的前端全栈开发范式：Next.js 15 + React 19 + tRPC 11 + Supabase 全栈示例，clone 下来配个免费 Supabase 就能跑</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fchat_edit" target="_blank" title="https://github.com/tt-a1i/chat_edit" ref="nofollow noopener noreferrer">chat_edit</a> - 双模式 AI 应用（聊天+富文本编辑），Vue 3.5 + TypeScript + Vite 5 + Quill 2.0 + IndexedDB</li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于 YOLOv8 的智能火灾识别系统设计与实现— 从数据集训练到 PyQt5 可视化部署的完整工程实践]]></title>    <link>https://juejin.cn/post/7587630831465545770</link>    <guid>https://juejin.cn/post/7587630831465545770</guid>    <pubDate>2025-12-25T13:16:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587630831465545770" data-draft-id="7587631760253665299" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于 YOLOv8 的智能火灾识别系统设计与实现— 从数据集训练到 PyQt5 可视化部署的完整工程实践"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-25T13:16:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我是杰尼"/> <meta itemprop="url" content="https://juejin.cn/user/4200579899599495"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于 YOLOv8 的智能火灾识别系统设计与实现— 从数据集训练到 PyQt5 可视化部署的完整工程实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4200579899599495/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我是杰尼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T13:16:32.000Z" title="Thu Dec 25 2025 13:16:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">基于 YOLOv8 的智能火灾识别系统设计与实现</h2>
<h3 data-id="heading-1">摘要</h3>
<p>随着城市化进程的加快，火灾事故频发，传统依赖烟雾传感器或温感设备的报警方式在复杂环境中存在<strong>响应滞后、误报率高、覆盖范围有限</strong>等问题。近年来，计算机视觉与深度学习技术的快速发展，使得<strong>基于图像的火灾自动识别</strong>成为智慧消防领域的重要研究方向。</p>
<p>本文围绕一个<strong>基于 YOLOv8 的火灾识别系统</strong>展开，系统性介绍了从数据集构建、模型训练、性能评估，到 <strong>PyQt5 图形化检测系统落地部署</strong>的完整流程。项目支持图片、视频、文件夹与摄像头等多种输入形式，并提供完整源码、训练脚本和已训练权重，真正实现<strong>开箱即用</strong>。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06d58ac321f84930a532348aab5bd6d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767273391&amp;x-signature=SKbWTj33Ih6X7CzK88Yj36U7sfg%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-2">源码下载与效果演示</h3>
<p>哔哩哔哩视频下方观看：
<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV15UTTzEEDF%2F" target="_blank" title="https://www.bilibili.com/video/BV15UTTzEEDF/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV15U…</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/161db620518c4cbcaf119a0eb1102272~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767273391&amp;x-signature=ciiCs%2FWpFA%2FAf8M2BJZEtZbKB%2Fw%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-3">一、项目背景与技术选型</h3>
<h4 data-id="heading-4">1.1 火灾视觉识别的现实意义</h4>
<p>在实际场景中，火灾往往具有以下特点：</p>
<ul>
<li>初期火焰面积小、烟雾不明显</li>
<li>场景复杂（工厂、仓库、林区、地下空间）</li>
<li>对实时性要求极高</li>
</ul>
<p>传统传感器难以在复杂环境中全面覆盖，而<strong>视频监控系统早已广泛部署</strong>，如果能直接基于监控画面进行智能分析，将大幅降低系统建设成本。</p>
<p>因此，基于深度学习的火灾图像检测技术，具备以下优势：</p>
<ul>
<li>无需额外硬件改造</li>
<li>可远程集中部署</li>
<li>支持全天候自动监测</li>
<li>易于与现有安防系统融合</li>
</ul>
<hr/>
<h4 data-id="heading-5">1.2 为什么选择 YOLOv8？</h4>
<p>YOLO（You Only Look Once）系列模型在实时目标检测领域占据主流地位，而 YOLOv8 作为 Ultralytics 发布的最新一代模型，在工程实践中表现尤为突出：</p>
<ul>
<li><strong>Anchor-Free 架构</strong>，简化训练与调参</li>
<li>更轻量的网络结构，推理速度更快</li>
<li>支持 ONNX / TensorRT 导出，便于部署</li>
<li>官方维护，生态成熟</li>
</ul>
<p>在火灾检测这种 <strong>“实时 + 高精度”</strong> 场景下，YOLOv8 是非常理想的选择。</p>
<hr/>
<h3 data-id="heading-6">二、系统整体架构设计</h3>
<p>本项目采用“<strong>模型推理层 + 图形界面层</strong>”的分层设计思想，整体架构如下：</p>
<pre><code class="hljs language-markdown" lang="markdown">┌──────────────┐
│  输入数据源   │  图片 / 视频 / 摄像头
└──────┬───────┘
<span class="hljs-code">       │
┌──────▼───────┐
│ YOLOv8 推理层 │  PyTorch / Ultralytics
└──────┬───────┘
       │
┌──────▼───────┐
│ 结果后处理层 │  NMS / 置信度筛选
└──────┬───────┘
       │
┌──────▼───────┐
│ PyQt5 GUI层  │  可视化显示 / 交互
└──────────────┘
</span></code></pre>
<p>系统既可以作为<strong>研究原型</strong>，也可直接作为<strong>工程部署版本</strong>使用。</p>
<hr/>
<h3 data-id="heading-7">三、数据集构建与标注规范</h3>
<h4 data-id="heading-8">3.1 数据集来源与规模</h4>
<p>项目中使用的火灾数据集包含 <strong>2000+ 张图像</strong>，覆盖多种真实场景：</p>
<ul>
<li>室内火灾</li>
<li>室外明火</li>
<li>工业环境</li>
<li>林区与草地火焰</li>
</ul>
<p>数据集中同时包含不同光照、烟雾干扰、遮挡等复杂情况，增强模型的泛化能力。</p>
<hr/>
<h4 data-id="heading-9">3.2 YOLO 数据格式说明</h4>
<p>采用标准 YOLO 检测数据格式，目录结构如下：</p>
<pre><code class="hljs language-text" lang="text">dataset/
├── images/
│   ├── train/
│   └── val/
├── labels/
│   ├── train/
│   └── val/
</code></pre>
<p>标签文件为 <code>.txt</code>，每一行表示一个目标：</p>
<pre><code class="hljs language-text" lang="text">class_id x_center y_center width height
</code></pre>
<p>坐标均为相对比例，便于模型在不同分辨率下训练。</p>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc8abf3976854d6abdc5f145341ee3d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767273391&amp;x-signature=hPLJlRBxmOOhPyi9ja9xvAuCws8%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbaa7433ae3340b68253c2c86259178e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767273391&amp;x-signature=b%2F%2FFPIimVuq1vVuUlBzDRkRvpWo%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-10">四、YOLOv8 模型训练流程详解</h3>
<h4 data-id="heading-11">4.1 训练环境配置</h4>
<ul>
<li>Python ≥ 3.8</li>
<li>PyTorch ≥ 1.13</li>
<li>Ultralytics YOLOv8</li>
<li>CUDA（推荐，支持 GPU 加速）</li>
</ul>
<hr/>
<h4 data-id="heading-12">4.2 模型训练命令</h4>
<p>基于官方 YOLOv8 CLI，训练流程非常简洁：</p>
<pre><code class="hljs language-bash" lang="bash">yolo detect train \
  data=fire.yaml \
  model=yolov8n.pt \
  epochs=100 \
  batch=16 \
  imgsz=640
</code></pre>
<p>其中：</p>
<ul>
<li><code>fire.yaml</code>：数据集配置文件</li>
<li><code>yolov8n.pt</code>：轻量化预训练模型</li>
<li><code>epochs</code>：训练轮次</li>
</ul>
<hr/>
<h4 data-id="heading-13">4.3 训练结果评估指标</h4>
<p>训练完成后，系统会自动生成以下结果文件：</p>
<ul>
<li><code>results.png</code>：loss 与 mAP 曲线</li>
<li><code>confusion_matrix.png</code>：混淆矩阵</li>
<li><code>weights/best.pt</code>：最佳权重</li>
</ul>
<p>当 <code>mAP@0.5</code> 达到 <strong>90% 以上</strong> 时，即可满足大多数工程应用需求。</p>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1094bd87db942c8bc63703884d5983d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767273391&amp;x-signature=LC66LicwlryY3NFZVFal2%2FW8Gx8%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-14">五、模型推理与检测效果展示</h3>
<h4 data-id="heading-15">5.1 Python 推理示例</h4>
<p>模型加载与推理代码如下：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> ultralytics <span class="hljs-keyword">import</span> YOLO

model = YOLO(<span class="hljs-string">"best.pt"</span>)
results = model(<span class="hljs-string">"test.jpg"</span>, conf=<span class="hljs-number">0.3</span>, save=<span class="hljs-literal">True</span>)
</code></pre>
<p>返回结果包含：</p>
<ul>
<li>检测类别</li>
<li>置信度</li>
<li>边界框坐标</li>
</ul>
<p>并自动保存标注后的图像。</p>
<hr/>
<h4 data-id="heading-16">5.2 多种输入模式支持</h4>
<p>系统支持以下检测模式：</p>
<ul>
<li>📷 单张图片检测</li>
<li>📁 文件夹批量检测</li>
<li>🎥 视频逐帧检测</li>
<li>📡 摄像头实时检测</li>
</ul>
<p>满足科研、教学与实际部署的多种需求。</p>
<hr/>
<h3 data-id="heading-17">六、PyQt5 图形界面系统设计</h3>
<h4 data-id="heading-18">6.1 为什么要做 GUI？</h4>
<p>相比命令行工具，图形界面具有明显优势：</p>
<ul>
<li>非技术人员可直接使用</li>
<li>适合演示、汇报与教学</li>
<li>更符合实际工程交付形态</li>
</ul>
<hr/>
<h4 data-id="heading-19">6.2 界面功能模块</h4>
<p>PyQt5 界面主要包括：</p>
<ul>
<li>输入源选择区</li>
<li>检测结果显示区</li>
<li>参数设置区</li>
<li>保存与导出控制区</li>
</ul>
<p>所有操作均通过按钮完成，真正实现 <strong>零代码检测</strong>。</p>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a56e479658e47dd8d3a840ac6ac95db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767273391&amp;x-signature=x%2BHu5VYvKD%2FsyfY0LnIFhc72G0I%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-20">七、工程化与部署实践</h3>
<h4 data-id="heading-21">7.1 项目开箱即用设计</h4>
<p>项目已完成完整工程封装，包含：</p>
<ul>
<li>完整源码</li>
<li>已训练权重</li>
<li>数据集</li>
<li>UI 文件</li>
<li>教程文档</li>
</ul>
<p>运行只需一行命令：</p>
<pre><code class="hljs language-bash" lang="bash">python main.py
</code></pre>
<hr/>
<h4 data-id="heading-22">7.2 应用场景分析</h4>
<p>该系统可应用于：</p>
<ul>
<li>智慧消防监控</li>
<li>工业安全巡检</li>
<li>林火预警系统</li>
<li>智慧园区安防</li>
</ul>
<p>并可进一步结合边缘计算设备（如 Jetson、RK3588）实现本地化部署。</p>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eaa0ac02afb549189e6d6534a8bd51b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767273391&amp;x-signature=s2AWTGHFS5qYosiwgibdKV2guMo%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-23">八、总结与展望</h3>
<p>本文完整介绍了一个<strong>基于 YOLOv8 的火灾识别系统工程实践</strong>，从算法模型到 GUI 应用，从训练流程到部署方案，打通了视觉检测系统的完整链路。</p>
<p>项目的核心价值在于：</p>
<ul>
<li>🔥 模型性能可靠</li>
<li>🧠 系统结构清晰</li>
<li>🧰 工程落地性强</li>
<li>📦 资源完整，开箱即用</li>
</ul>
<p>未来可在以下方向继续拓展：</p>
<ul>
<li>火焰 + 烟雾多类别联合检测</li>
<li>时序建模降低误报率</li>
<li>边缘端轻量化推理优化</li>
<li>与报警系统联动</li>
</ul>
<p>希望本文能为从事 <strong>计算机视觉、智慧消防、AI 工程实践</strong> 的开发者提供参考与帮助，也欢迎交流与合作，共同推进智能安全技术的落地应用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用 Python 脚本一键重命名序列帧图片的名称]]></title>    <link>https://juejin.cn/post/7587606718844502057</link>    <guid>https://juejin.cn/post/7587606718844502057</guid>    <pubDate>2025-12-25T13:20:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587606718844502057" data-draft-id="7561793322143301678" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用 Python 脚本一键重命名序列帧图片的名称"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-25T13:20:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="90后晨仔"/> <meta itemprop="url" content="https://juejin.cn/user/2717648476705773"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用 Python 脚本一键重命名序列帧图片的名称
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648476705773/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    90后晨仔
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T13:20:49.000Z" title="Thu Dec 25 2025 13:20:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在开发中，我们经常需要使用<strong>序列帧动画</strong>来实现下拉刷新、加载动画、空状态动效等交互。设计师交付的序列帧图片资源，命名往往各不相同：</p>
<pre><code class="hljs language-erlang" lang="erlang">序列帧<span class="hljs-number">00001</span>.png
testImage_00002.png
...
testImageName_00040.png
</code></pre>
<p>而我们的代码通常期望统一的命名规范：</p>
<pre><code class="hljs language-erlang" lang="erlang">modifiedImageName_00001.png
modifiedImageName_00002.png
...
modifiedImageName_00040.png

</code></pre>
<p>手动重命名40张上百张图片？不仅耗时，还容易出错。向设计师提出修改请求？对方可能还爱答不理的。本文将教你使用<strong>一行Python脚本</strong>，实现图片的批量重命名，<strong>3秒搞定</strong>，彻底解放双手！</p>
<hr/>
<h2 data-id="heading-1">一、为何需要自动化重命名？</h2>
<h3 data-id="heading-2">❌ 手动重命名的痛点</h3>
<ul>
<li><strong>耗时费力</strong>：重命名40张图片大约需要5分钟，100张则需更久</li>
<li><strong>易出错</strong>：手误改错一个数字，可能导致动画断帧或显示异常</li>
<li><strong>不专业</strong>：命名不统一会给团队协作和后续维护带来混乱</li>
<li><strong>重复劳动</strong>：每次更换主题或动效样式都需要重复操作</li>
</ul>
<h3 data-id="heading-3">✅ 自动化重命名的优势</h3>
<ul>
<li>⚡ <strong>高效快捷</strong>：3秒即可完成100张图片的重命名</li>
<li>✅ <strong>精准无误</strong>：避免人为操作导致的命名错误</li>
<li>🔄 <strong>高度可复用</strong>：简单调整参数即可适用于不同项目</li>
<li>🕒 <strong>提升效率</strong>：将宝贵时间用于核心业务逻辑开发</li>
</ul>
<hr/>
<h2 data-id="heading-4">二、Python脚本实战：批量重命名序列帧图片</h2>
<h3 data-id="heading-5">📁 项目结构准备</h3>
<p>创建一个工作文件夹（例如命名为<code>RenameTool</code>），其中包含以下内容：</p>
<pre><code class="hljs language-bash" lang="bash">RenameTool/
├── SourceImages/                    <span class="hljs-comment"># 原始图片文件夹</span>
│   ├── testImageName_00001.png
│   ├── testImageName_00002.png
│   └── ...（共40张序列帧图片）
└── rename_images.py                 <span class="hljs-comment"># Python重命名脚本</span>
</code></pre>
<ul>
<li><strong>原始命名</strong>：<code>testImageName_00001.png</code> ~ <code>testImageName_00040.png</code></li>
<li><strong>目标命名</strong>：<code>modifiedImageName_00001.png</code> ~ <code>modifiedImageName_00040.png</code></li>
</ul>
<h3 data-id="heading-6">🐍 优化后的Python脚本（带详细注释）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment"># -*- coding: utf-8 -*-</span>
<span class="hljs-string">"""
序列帧动画图片批量重命名工具
功能：将指定文件夹中的图片文件按照指定规则进行批量重命名
"""</span>

<span class="hljs-keyword">import</span> os

<span class="hljs-comment"># ==================== 配置参数 ====================</span>
<span class="hljs-comment"># 请根据实际情况修改以下四个参数</span>

<span class="hljs-comment"># 1. 原始图片所在的文件夹路径（相对于脚本的位置）</span>
SOURCE_FOLDER = <span class="hljs-string">'SourceImages'</span>

<span class="hljs-comment"># 2. 目标保存的文件夹路径（如果与原始文件夹相同，则为原地重命名）</span>
TARGET_FOLDER = <span class="hljs-string">'SourceImages'</span>  <span class="hljs-comment"># 可以修改为'RenamedImages'来保存到新文件夹</span>

<span class="hljs-comment"># 3. 需要被替换的原始文件名前缀（区分大小写）</span>
OLD_PREFIX = <span class="hljs-string">'testImageName_'</span>

<span class="hljs-comment"># 4. 替换后的新文件名前缀</span>
NEW_PREFIX = <span class="hljs-string">'modifiedImageName_'</span>

<span class="hljs-comment"># ==================== 主程序开始 ====================</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-string">"""
    主函数：执行批量重命名操作
    """</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"🔍 iOS序列帧图片批量重命名工具"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    
    <span class="hljs-comment"># 检查源文件夹是否存在</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(SOURCE_FOLDER):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"❌ 错误：源文件夹 '<span class="hljs-subst">{SOURCE_FOLDER}</span>' 不存在！"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"💡 提示：请确保脚本与图片文件夹在同一目录下"</span>)
        <span class="hljs-keyword">return</span>
    
    <span class="hljs-comment"># 如果目标文件夹不存在，则创建</span>
    <span class="hljs-keyword">if</span> TARGET_FOLDER != SOURCE_FOLDER <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> os.path.exists(TARGET_FOLDER):
        os.makedirs(TARGET_FOLDER)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📁 已创建目标文件夹：<span class="hljs-subst">{TARGET_FOLDER}</span>"</span>)
    
    <span class="hljs-comment"># 获取源文件夹中所有文件，并按名称排序（确保序列正确）</span>
    all_files = <span class="hljs-built_in">sorted</span>(os.listdir(SOURCE_FOLDER))
    
    <span class="hljs-comment"># 统计计数器</span>
    renamed_count = <span class="hljs-number">0</span>
    skipped_count = <span class="hljs-number">0</span>
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📂 正在扫描文件夹：<span class="hljs-subst">{SOURCE_FOLDER}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📊 找到 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(all_files)}</span> 个文件"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">50</span>)
    
    <span class="hljs-comment"># 遍历文件夹中的所有文件</span>
    <span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> all_files:
        <span class="hljs-comment"># 检查文件是否为PNG格式且以指定前缀开头</span>
        <span class="hljs-keyword">if</span> filename.endswith(<span class="hljs-string">'.png'</span>) <span class="hljs-keyword">and</span> filename.startswith(OLD_PREFIX):
            
            <span class="hljs-comment"># 构建完整的原始文件路径</span>
            old_path = os.path.join(SOURCE_FOLDER, filename)
            
            <span class="hljs-comment"># 生成新文件名：替换前缀</span>
            new_filename = filename.replace(OLD_PREFIX, NEW_PREFIX, <span class="hljs-number">1</span>)
            
            <span class="hljs-comment"># 构建完整的目标文件路径</span>
            <span class="hljs-keyword">if</span> TARGET_FOLDER == SOURCE_FOLDER:
                new_path = os.path.join(SOURCE_FOLDER, new_filename)
            <span class="hljs-keyword">else</span>:
                new_path = os.path.join(TARGET_FOLDER, new_filename)
            
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># 执行重命名操作</span>
                os.rename(old_path, new_path)
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"✅ 已重命名：<span class="hljs-subst">{filename}</span> → <span class="hljs-subst">{new_filename}</span>"</span>)
                renamed_count += <span class="hljs-number">1</span>
                
            <span class="hljs-keyword">except</span> FileExistsError:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"⚠️  跳过：<span class="hljs-subst">{new_filename}</span> 已存在，避免覆盖"</span>)
                skipped_count += <span class="hljs-number">1</span>
            <span class="hljs-keyword">except</span> PermissionError:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"❌ 权限错误：无法重命名 <span class="hljs-subst">{filename}</span>（文件可能被其他程序占用）"</span>)
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"❌ 错误处理 <span class="hljs-subst">{filename}</span>: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># 统计不符合条件的文件</span>
            <span class="hljs-keyword">if</span> filename.endswith(<span class="hljs-string">'.png'</span>):
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"➖ 跳过：<span class="hljs-subst">{filename}</span>（前缀不匹配）"</span>)
            <span class="hljs-keyword">else</span>:
                <span class="hljs-comment"># 非PNG文件，静默跳过</span>
                skipped_count += <span class="hljs-number">1</span>
    
    <span class="hljs-comment"># 输出统计结果</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"📊 重命名完成！"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   ✅ 成功重命名：<span class="hljs-subst">{renamed_count}</span> 个文件"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   ➖ 跳过处理：<span class="hljs-subst">{skipped_count}</span> 个文件"</span>)
    
    <span class="hljs-keyword">if</span> renamed_count &gt; <span class="hljs-number">0</span>:
        <span class="hljs-keyword">if</span> TARGET_FOLDER == SOURCE_FOLDER:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📁 文件保存在：<span class="hljs-subst">{SOURCE_FOLDER}</span>（原地重命名）"</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📁 文件已保存至：<span class="hljs-subst">{TARGET_FOLDER}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"🎉 所有序列帧图片已准备就绪，可直接用于iOS项目！"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ℹ️  没有文件被重命名，请检查配置参数"</span>)

<span class="hljs-comment"># 脚本入口点</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre>
<h2 data-id="heading-7"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Ffengziii%2Fscript-tool" target="_blank" title="https://gitee.com/fengziii/script-tool" ref="nofollow noopener noreferrer">点击下载脚本</a></h2>
<h2 data-id="heading-8">三、脚本核心功能解析</h2>
<h3 data-id="heading-9">1. 灵活的路径配置</h3>
<pre><code class="hljs language-python" lang="python">SOURCE_FOLDER = <span class="hljs-string">'SourceImages'</span>      <span class="hljs-comment"># 原始图片文件夹</span>
TARGET_FOLDER = <span class="hljs-string">'SourceImages'</span>      <span class="hljs-comment"># 目标文件夹（可设置为新文件夹）</span>
</code></pre>
<ul>
<li><strong>原地重命名</strong>：<code>TARGET_FOLDER = SOURCE_FOLDER</code></li>
<li><strong>保存到新位置</strong>：<code>TARGET_FOLDER = 'RenamedImages'</code></li>
</ul>
<h3 data-id="heading-10">2. 精确的命名匹配</h3>
<pre><code class="hljs language-python" lang="python">OLD_PREFIX = <span class="hljs-string">'testImageName_'</span>       <span class="hljs-comment"># 需要被替换的前缀</span>
NEW_PREFIX = <span class="hljs-string">'modifiedImageName_'</span>   <span class="hljs-comment"># 新的前缀</span>
</code></pre>
<ul>
<li>支持自定义任意前缀替换</li>
<li>确保只替换第一个匹配的前缀，避免错误修改</li>
</ul>
<h3 data-id="heading-11">3. 完善的异常处理</h3>
<ul>
<li><strong>FileExistsError</strong>：目标文件已存在时跳过，避免覆盖</li>
<li><strong>PermissionError</strong>：文件被占用时的友好提示</li>
<li><strong>通用异常捕获</strong>：确保脚本不会意外崩溃</li>
</ul>
<h3 data-id="heading-12">4. 智能文件排序</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-built_in">sorted</span>(os.listdir(SOURCE_FOLDER))
</code></pre>
<p>确保图片按 <code>00001</code>, <code>00002</code>... 的顺序处理，保证动画序列的正确性</p>
<hr/>
<h2 data-id="heading-13">四、如何使用这个脚本？</h2>
<h3 data-id="heading-14">步骤1：准备环境</h3>
<p>确保你的电脑已安装Python 3.x（macOS通常已预装）</p>
<h3 data-id="heading-15">步骤2：创建项目结构</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建项目文件夹</span>
<span class="hljs-built_in">mkdir</span> RenameTool
<span class="hljs-built_in">cd</span> RenameTool

<span class="hljs-comment"># 创建原始图片文件夹</span>
<span class="hljs-built_in">mkdir</span> SourceImages

<span class="hljs-comment"># 将设计师提供的序列帧图片复制到SourceImages文件夹中</span>
<span class="hljs-comment"># 图片命名应为：testImageName_00001.png, testImageName_00002.png...</span>

<span class="hljs-comment"># 创建Python脚本</span>
<span class="hljs-built_in">touch</span> rename_images.py
</code></pre>
<h3 data-id="heading-16">步骤3：编辑脚本并配置参数</h3>
<ol>
<li>使用文本编辑器打开<code>rename_images.py</code></li>
<li>粘贴上面的完整脚本代码</li>
<li>根据需要修改顶部的四个配置参数：
<ul>
<li><code>SOURCE_FOLDER</code>：原始图片文件夹名</li>
<li><code>TARGET_FOLDER</code>：目标文件夹名</li>
<li><code>OLD_PREFIX</code>：原始文件名前缀</li>
<li><code>NEW_PREFIX</code>：新文件名前缀</li>
</ul>
</li>
</ol>
<h3 data-id="heading-17">步骤4：运行脚本</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在RenameTool目录下执行</span>
python3 rename_images.py
</code></pre>
<h3 data-id="heading-18">步骤5：查看运行结果</h3>
<p>脚本会显示详细的处理过程：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">🔍 iOS序列帧图片批量重命名工具
==================================================</span>
📂 正在扫描文件夹：SourceImages
<span class="hljs-section">📊 找到 40 个文件
--------------------------------------------------</span>
✅ 已重命名：testImageName<span class="hljs-emphasis">_00001.png → modifiedImageName_</span>00001.png
✅ 已重命名：testImageName<span class="hljs-emphasis">_00002.png → modifiedImageName_</span>00002.png
<span class="hljs-section">...
==================================================</span>
📊 重命名完成！
   ✅ 成功重命名：40 个文件
   ➖ 跳过处理：0 个文件
📁 文件保存在：SourceImages（原地重命名）
🎉 所有序列帧图片已准备就绪，可直接用于iOS项目！
</code></pre>
<hr/>
<h2 data-id="heading-19">五、进阶使用技巧</h2>
<h3 data-id="heading-20">1. 批量处理多个文件夹</h3>
<p>如果需要处理多个动画序列，可以创建不同的配置块：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 配置组1：处理下拉刷新动画</span>
configs = [
    {
        <span class="hljs-string">'source'</span>: <span class="hljs-string">'PullRefreshImages'</span>,
        <span class="hljs-string">'old_prefix'</span>: <span class="hljs-string">'refresh_'</span>,
        <span class="hljs-string">'new_prefix'</span>: <span class="hljs-string">'pull_refresh_day_'</span>
    },
    {
        <span class="hljs-string">'source'</span>: <span class="hljs-string">'LoadingImages'</span>, 
        <span class="hljs-string">'old_prefix'</span>: <span class="hljs-string">'loading_'</span>,
        <span class="hljs-string">'new_prefix'</span>: <span class="hljs-string">'page_loading_'</span>
    }
]

<span class="hljs-comment"># 循环处理所有配置</span>
<span class="hljs-keyword">for</span> config <span class="hljs-keyword">in</span> configs:
    <span class="hljs-comment"># 调用重命名函数...</span>
</code></pre>
<h3 data-id="heading-21">2. 添加拖拽支持（macOS）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sys

<span class="hljs-comment"># 通过拖拽获取文件夹路径</span>
<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &gt; <span class="hljs-number">1</span>:
    SOURCE_FOLDER = sys.argv[<span class="hljs-number">1</span>]
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📁 使用拖拽的文件夹：<span class="hljs-subst">{SOURCE_FOLDER}</span>"</span>)
</code></pre>
<h3 data-id="heading-22">3. 备份原始文件</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> shutil

<span class="hljs-comment"># 重命名前先复制到备份文件夹</span>
backup_folder = <span class="hljs-string">f"<span class="hljs-subst">{SOURCE_FOLDER}</span>_backup"</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(backup_folder):
    shutil.copytree(SOURCE_FOLDER, backup_folder)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📦 已创建备份：<span class="hljs-subst">{backup_folder}</span>"</span>)
</code></pre>
<hr/>
<h2 data-id="heading-23">六、常见问题解答</h2>
<h3 data-id="heading-24">Q1：脚本运行后没有任何文件被重命名？</h3>
<ul>
<li>检查<code>OLD_PREFIX</code>是否与图片实际前缀完全一致（包括大小写）</li>
<li>确认图片格式是否为<code>.png</code>（脚本默认只处理PNG格式）</li>
</ul>
<h3 data-id="heading-25">Q2：如何重命名其他格式的图片？</h3>
<p>修改脚本中的文件类型判断：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 支持多种图片格式</span>
<span class="hljs-keyword">if</span> filename.lower().endswith((<span class="hljs-string">'.png'</span>, <span class="hljs-string">'.jpg'</span>, <span class="hljs-string">'.jpeg'</span>)):
</code></pre>
<h3 data-id="heading-26">Q3：如何处理不规则命名的图片？</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 使用正则表达式匹配更复杂的命名模式</span>
<span class="hljs-keyword">import</span> re
pattern = <span class="hljs-string">r'刷新_(\d{5})\.png'</span>
<span class="hljs-keyword">match</span> = re.<span class="hljs-keyword">match</span>(pattern, filename)
<span class="hljs-keyword">if</span> <span class="hljs-keyword">match</span>:
    number = <span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>)
    new_filename = <span class="hljs-string">f"refresh_animation_<span class="hljs-subst">{number}</span>.png"</span>
</code></pre>
<hr/>
<h2 data-id="heading-27">结语</h2>
<p>通过这个简单的Python脚本，你可以将原本繁琐的图片重命名工作自动化，<strong>节省大量时间，减少人为错误</strong>。无论是处理40张还是400张序列帧图片，都只需运行一次脚本即可完成。</p>
<p><strong>技术开发的核心价值在于解决重复性工作</strong>，让开发者能够专注于更有挑战性的任务。掌握这样的小工具，不仅能提升个人效率，也能让整个团队的开发流程更加规范高效。</p>
<p><strong>立即尝试</strong>，告别手动重命名的烦恼，体验自动化带来的便捷吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[30+程序员的自白：我与架构师之间，隔了多少个分布式锁？]]></title>    <link>https://juejin.cn/post/7587779957654110234</link>    <guid>https://juejin.cn/post/7587779957654110234</guid>    <pubDate>2025-12-25T13:38:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587779957654110234" data-draft-id="7587628833798373403" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="30+程序员的自白：我与架构师之间，隔了多少个分布式锁？"/> <meta itemprop="keywords" content="架构"/> <meta itemprop="datePublished" content="2025-12-25T13:38:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            30+程序员的自白：我与架构师之间，隔了多少个分布式锁？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T13:38:54.000Z" title="Thu Dec 25 2025 13:38:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>那些年纪轻轻就成为架构师的人，仿佛掌握了什么通关密码，而我的技术栈似乎还停留在“CRUD豪华套餐”里。</p>
</blockquote>
<p>最近公司新来了一位95后架构师，当他滔滔不绝地讲解着服务网格、云原生和分布式事务时，我下意识地缩了缩脖子——毕竟，我上周还在为某个Windows服务器上的HTTP上传配置问题折腾了半天。</p>
<p>看着他自信满满地在白板上画着架构图，我突然意识到：我和架构师之间，可能隔了十个分布式锁的距离。</p>
<hr/>
<h2 data-id="heading-0">01 年龄焦虑下的技术现实</h2>
<p>作为一名30+的程序员，我的日常技术栈颇为朴实无华：主要是对数据库进行增删改查操作，偶尔处理一些业务逻辑，系统架构是经典的单体应用，部署在熟悉的Windows服务器上。</p>
<p>每当看到招聘要求上写着“精通高并发、分布式、微服务架构、云原生、DevOps、服务治理、K8s、限流熔断、削峰填谷、链路追踪”，我都会默默关掉页面，仿佛做了亏心事。</p>
<p>和我处境类似的同行不在少数。我们往往自嘲为“码农”——顾名思义，就是像农民一样耕耘代码，但作物的生长高度似乎总有个看不见的天花板。</p>
<p>在传统的“搬砖模式”下，我们手写大量CRUD代码，熬夜debug，不断学习新框架，在996中消耗青春。而当今的AI辅助编程时代，大模型彻底改变了游戏规则，程序员的核心竞争力变成了AI协作与质量把控。</p>
<p>公式很残酷：价值 = 需求理解 × AI提示工程 × 代码审查能力 × 架构设计。</p>
<h2 data-id="heading-1">02 年轻架构师们的神秘装备</h2>
<p>那些年纪轻轻就成为架构师的人，到底掌握了什么我们不知道的秘籍？</p>
<p>技术广度与深度的平衡是他们的一大优势。年轻架构师通常能在深度掌握一门技术的同时，保持对相关技术的广泛了解。他们像技术世界的“多面手”，而非我们这样的“专一人士”。</p>
<p>系统化思维是另一个关键技能。当我们还在纠结某个具体功能如何实现时，架构师们已经开始思考整体系统的结构、技术选型以及解决方案。</p>
<p>架构师的职责可以概括为一个公式：架构师职责 = 系统设计能力 + 沟通协调能力 + 技术选型能力。</p>
<p>最重要的是，他们掌握了学习方法论。在AI时代，35岁程序员的优势在于上下文工程能力、检索增强生成能力和知识图谱推理能力。他们懂得如何构建完整的业务场景，将隐性知识显性化，并进行系统化的推理。</p>
<h2 data-id="heading-2">03 30+程序员的隐形优势</h2>
<p>不过，我们30+程序员也不必妄自菲薄。在技术这条路上，经验是一笔宝贵的财富。</p>
<p>与年轻程序员相比，我们拥有更多实战经验，对业务的理解更为深刻。当年轻程序员看到孤立的技术问题时，我们看到的是完整的业务场景。这种差异直接决定了解决方案的成熟度。</p>
<p>在AI时代，我们的经验、判断力和系统性思维正是核心优势。当机器能够处理重复性工作时，人类最稀缺的能力就是经验、判断力和系统性思维。</p>
<p>年龄在这里反而成了加分项——普通开发岗月薪可能停留在15-25K，但资深架构师年薪能到30-50万，技术总监级别的甚至能突破百万。</p>
<h2 data-id="heading-3">04 从码农到架构师的进化路径</h2>
<p>那么，像我们这样的30+程序员，如何实现向架构师的转型呢？</p>
<p>培养广泛的技术知识是基础。架构师需要了解各种不同的技术，并能在实际项目中应用它们。这意味着我们需要投入时间学习不同的编程语言、开发框架和系统设计原则。</p>
<p>以设计模式为例，熟悉常见的设计模式，如单例模式、工厂模式、观察者模式等，并了解如何将它们应用到实际项目中，是成为一名架构师的关键。</p>
<p>参与实际项目是提升架构能力的有效途径。通过参与项目，我们可以学习如何与团队合作、理解业务需求以及设计系统架构。</p>
<p>学习设计模式和架构原则也至关重要。设计模式和架构原则是构建可扩展、可维护的系统的基础。</p>
<p>提升沟通和领导能力同样不可或缺。架构师不仅需要具备技术能力，还需要良好的沟通和领导能力。他们需要与项目经理、开发团队以及其他利益相关者进行有效的沟通，并且能够领导团队完成项目。</p>
<hr/>
<p>那位95后架构师今天悄悄问我一个业务逻辑的问题——他花了半天没搞明白的业务流程，我五分钟就给他讲清楚了。他眼睛发亮地说：“老哥，还是你厉害！”</p>
<p>那一刻，我突然意识到：架构不是目的，而是解决问题的手段。真正的架构师价值不在于用了多少炫酷的技术，而在于能否设计出支撑业务发展的系统。</p>
<p>也许，我们30+程序员的架构师之路，不必从追逐最新技术开始，而是从重新审视自己多年的业务经验起步。</p>
<p>分布式锁不会用可以学，K8s没接触过可以练，但我们对业务的理解、对项目全周期的把握，却是年轻人短期内难以超越的财富。</p>
<p>所以，别急着汗颜。架构师之路，30+或许正是最好的起点。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[混沌工程在SpringBoot项目中的实践与应用]]></title>    <link>https://juejin.cn/post/7587604932058513459</link>    <guid>https://juejin.cn/post/7587604932058513459</guid>    <pubDate>2025-12-25T13:57:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587604932058513459" data-draft-id="7587619946189520947" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="混沌工程在SpringBoot项目中的实践与应用"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-25T13:57:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            混沌工程在SpringBoot项目中的实践与应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T13:57:36.000Z" title="Thu Dec 25 2025 13:57:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1 混沌工程概述</h2>
<p>混沌工程是一种<strong>主动发现系统弱点</strong>的工程实践，通过在分布式系统上进行受控实验，观察系统行为并建立对系统抵御生产环境中失控条件的信心。简而言之，它就是"故意破坏事物"的特殊方法，通过在生产环境中模拟故障来发现隐藏问题。</p>
<p>与传统测试方法不同，混沌工程<strong>不是简单的"搞破坏"</strong> ，而是强调在破坏后能否有效控制爆炸半径、减少对用户的影响，并针对发现的问题进行修复和改进。混沌工程应当成为传统测试的补充，在系统已经足够稳定后，进一步通过生产环境中的真实场景验证系统韧性。</p>
<h3 data-id="heading-1">1.1 混沌工程五大基本原则</h3>
<p>Netflix总结的混沌工程五大基本原则已成为行业标准：</p>
<ul>
<li><strong>建立稳定状态假设</strong>：关注系统的可测量输出，如吞吐量、错误率等</li>
<li><strong>多样化真实世界事件</strong>：模拟硬件故障、网络问题、依赖失效等真实场景</li>
<li><strong>生产环境进行实验</strong>：在真实流量下验证系统行为</li>
<li><strong>持续自动化运行试验</strong>：将实验自动化并持续运行</li>
<li><strong>最小化"爆炸半径"</strong> ：控制实验影响范围，减少对用户的影响</li>
</ul>
<h2 data-id="heading-2">2 SpringBoot集成混沌工程实践</h2>
<h3 data-id="heading-3">2.1 Chaos Monkey for SpringBoot简介</h3>
<p>Chaos Monkey for SpringBoot是Netflix混沌工程理念在SpringBoot生态系统中的具体实现。它是一个轻量级的依赖库，可以<strong>无缝集成</strong>到SpringBoot应用中，提供多种故障注入能力。</p>
<h3 data-id="heading-4">2.2 集成步骤</h3>
<p><strong>添加依赖配置</strong></p>
<p>在pom.xml中添加Chaos Monkey依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>de.codecentric<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>chaos-monkey-spring-boot<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>配置文件设置</strong></p>
<p>在application.yml中启用和配置Chaos Monkey：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">chaos:</span>
  <span class="hljs-attr">monkey:</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">assaults:</span>
      <span class="hljs-attr">level:</span> <span class="hljs-number">5</span>
      <span class="hljs-attr">latency-range-start:</span> <span class="hljs-number">5000</span>
      <span class="hljs-attr">latency-range-end:</span> <span class="hljs-number">10000</span>
      <span class="hljs-attr">latency-active:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">exceptions-active:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">kill-application-active:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">watcher:</span>
      <span class="hljs-attr">service:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">repository:</span> <span class="hljs-literal">false</span>
      <span class="hljs-attr">controller:</span> <span class="hljs-literal">false</span>
      <span class="hljs-attr">rest-controller:</span> <span class="hljs-literal">false</span>
</code></pre>
<p><strong>激活Chaos Monkey</strong></p>
<p>通过启动参数激活chaos-monkey的profile：</p>
<pre><code class="hljs language-ini" lang="ini">java -jar your-application.jar <span class="hljs-attr">--spring.profiles.active</span>=chaos-monkey
</code></pre>
<h3 data-id="heading-5">2.3 攻击类型详解</h3>
<p>Chaos Monkey提供了四种主要的攻击方式：</p>
<p><strong>延迟攻击</strong>：在请求处理时添加随机延迟，模拟网络延迟或处理慢的情况。可通过<code>latency-range-start</code>和<code>latency-range-end</code>参数设置延迟范围。</p>
<p><strong>异常攻击</strong>：随机抛出异常，测试系统的异常处理能力。可以配置特定类型的异常和参数。</p>
<p><strong>应用终止攻击</strong>：随机终止应用程序，验证系统的自恢复能力和集群的故障转移能力。</p>
<p><strong>内存攻击</strong>：模拟内存泄漏或内存不足的情况，测试系统的内存管理能力。</p>
<h3 data-id="heading-6">2.4 高级配置与管理</h3>
<p><strong>通过Actuator端点管理</strong></p>
<p>启用Spring Boot Actuator可以动态管理Chaos Monkey：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">management:</span>
  <span class="hljs-attr">endpoint:</span>
    <span class="hljs-attr">chaosmonkey:</span>
      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">endpoints:</span>
    <span class="hljs-attr">web:</span>
      <span class="hljs-attr">exposure:</span>
        <span class="hljs-attr">include:</span> <span class="hljs-string">health,info,chaosmonkey</span>
</code></pre>
<p>启用后可以通过<code>/actuator/chaosmonkey</code>端点查看和修改配置。</p>
<p><strong>目标服务监控配置</strong></p>
<p>可以精确控制哪些服务被监控：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"controller"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"restController"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"service"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"repository"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"component"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-7">3 混沌工程实施方法论</h2>
<h3 data-id="heading-8">3.1 实施流程</h3>
<p>实施混沌工程应遵循<strong>系统化方法</strong>，确保实验的安全性和有效性：</p>
<p><strong>建立基线指标</strong></p>
<p>在实验前收集系统正常状态下的各项指标：</p>
<ul>
<li>基础设施指标：CPU使用率、内存使用率、磁盘IO、网络延迟</li>
<li>应用指标：QPS、错误率、响应时间、数据库连接数</li>
<li>业务指标：关键业务流程的成功率、耗时</li>
</ul>
<p><strong>模拟真实事件</strong></p>
<p>通过精心设计的场景模拟真实故障：</p>
<ul>
<li><strong>单点故障</strong>：模拟单个服务实例或节点故障</li>
<li><strong>依赖失效</strong>：模拟下游服务不可用或响应慢</li>
<li><strong>资源耗尽</strong>：模拟CPU、内存、磁盘等资源不足的情况</li>
</ul>
<p><strong>分析实验结果</strong></p>
<p>将实验结果与基线对比，重点关注：</p>
<ul>
<li>系统行为是否符合预期？</li>
<li>监控告警是否及时触发？</li>
<li>系统是否能够自动恢复？</li>
<li>发现了哪些新的问题点？</li>
</ul>
<p><strong>重复实验与自动化</strong></p>
<p>修复问题后重复实验验证效果，并将成功的实验模式<strong>自动化</strong>，集成到CI/CD流水线中。</p>
<h3 data-id="heading-9">3.2 爆炸半径控制</h3>
<p>实施混沌工程时必须<strong>严格控制爆炸半径</strong>，避免对生产环境造成过大影响：</p>
<ul>
<li>从非关键业务开始实验</li>
<li>选择低流量时段进行</li>
<li>限制实验影响的范围和时长</li>
<li>准备完善的回滚方案</li>
</ul>
<h2 data-id="heading-10">4 混沌工程的价值与好处</h2>
<h3 data-id="heading-11">4.1 提升系统韧性</h3>
<p>通过主动注入故障，混沌工程能够<strong>暴露系统中的潜在弱点</strong>，帮助团队在真实故障发生前进行修复。这包括发现单点故障、容错机制不完善、超时设置不合理等问题。</p>
<h3 data-id="heading-12">4.2 验证监控与告警</h3>
<p>混沌工程验证监控系统的<strong>完整性和有效性</strong>，确保故障发生时能够及时检测并告警。实验可以检验：</p>
<ul>
<li>监控指标是否覆盖关键维度</li>
<li>告警阈值设置是否合理</li>
<li>告警信息是否准确有效</li>
<li>应急响应流程是否顺畅</li>
</ul>
<h3 data-id="heading-13">4.3 增强团队信心</h3>
<p>通过定期混沌实验，团队对系统在生产环境中的行为有更深入的理解，从而<strong>增强对系统可靠性的信心</strong>。当真实故障发生时，团队能够更从容地应对，因为他们已经经历过类似场景并验证过应对措施。</p>
<h3 data-id="heading-14">4.4 促进系统设计改进</h3>
<p>混沌工程推动系统架构的<strong>持续优化</strong>，促进团队在设计阶段就考虑容错和弹性模式，如超时控制、熔断降级、重试机制等。</p>
<h2 data-id="heading-15">5 最佳实践与注意事项</h2>
<h3 data-id="heading-16">5.1 安全第一</h3>
<p>混沌工程实验必须遵循<strong>安全原则</strong>：</p>
<ul>
<li>始终有备选方案和回滚计划</li>
<li>实验前进行充分沟通和报备</li>
<li>避免在关键业务高峰期进行实验</li>
<li>记录实验过程和结果，便于审计和分析</li>
</ul>
<h3 data-id="heading-17">5.2 循序渐进</h3>
<p>采用<strong>渐进式</strong>实施策略：</p>
<ul>
<li>从测试环境开始，逐步过渡到生产环境</li>
<li>先模拟影响小的故障，再尝试复杂场景</li>
<li>逐步扩大实验范围和强度</li>
<li>建立实验基线库，积累经验</li>
</ul>
<h3 data-id="heading-18">5.3 与现有流程集成</h3>
<p>将混沌工程<strong>集成到DevOps流程</strong>中：</p>
<ul>
<li>在CI/CD流水线中加入混沌测试阶段</li>
<li>与监控、告警系统紧密集成</li>
<li>建立实验模板库，提高复用性</li>
<li>将实验结果反馈到研发和运维流程</li>
</ul>
<h2 data-id="heading-19">6 总结</h2>
<p>混沌工程为SpringBoot应用提供了<strong>系统化的韧性验证方法</strong>。通过集成Chaos Monkey等工具，团队可以在受控环境下模拟各种故障场景，主动发现和修复系统弱点。实施混沌工程不仅能够提升系统的可靠性和容错能力，还能增强团队对复杂分布式系统的理解和信心。</p>
<p>混沌工程不是一次性的活动，而是一个<strong>持续改进的过程</strong>。随着系统架构和业务需求的变化，需要不断调整和丰富实验场景，将混沌工程融入软件开发的全生命周期，才能真正构建出高可用的分布式系统。</p>
<blockquote>
<p>混沌工程让我们能够在受控的环境中暴露问题，避免生产环境中的更大故障，同时推动系统设计的持续优化和创新。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C# 正则表达式（3）：分组与捕获——从子串提取到命名分组]]></title>    <link>https://juejin.cn/post/7587604932058218547</link>    <guid>https://juejin.cn/post/7587604932058218547</guid>    <pubDate>2025-12-25T12:07:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587604932058218547" data-draft-id="7585412203978719275" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C# 正则表达式（3）：分组与捕获——从子串提取到命名分组"/> <meta itemprop="keywords" content="前端,C#,正则表达式"/> <meta itemprop="datePublished" content="2025-12-25T12:07:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="烛阴"/> <meta itemprop="url" content="https://juejin.cn/user/950397795841032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C# 正则表达式（3）：分组与捕获——从子串提取到命名分组
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/950397795841032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    烛阴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T12:07:50.000Z" title="Thu Dec 25 2025 12:07:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、分组是什么：让一段模式成为“一个单元”</h2>
<h3 data-id="heading-1">1. 普通分组：<code>(...)</code></h3>
<p>分组最直接的作用是“打包”,使用<code>()</code>完成打包，一个括号就是一个分组。例如你想匹配 <code>ab</code> 重复多次：</p>
<ul>
<li>错误：<code>ab+</code> 只会让 <code>b</code> 重复</li>
<li>正确：<code>(ab)+</code> 让 <code>ab</code> 作为整体重复</li>
</ul>
<h3 data-id="heading-2">2. 分组 + 量词：控制重复结构</h3>
<p><strong>示例：匹配 <code>2025-12-18</code> 这种日期结构</strong>：</p>
<pre><code class="hljs language-regex" lang="regex">(\d{4})-(\d{2})-(\d{2})
</code></pre>
<p><strong>解析：</strong></p>
<ul>
<li>这里有 3 个分组：年、月、日。它们不仅能帮助你“读懂结构”，更重要的是能在代码里提取出来。</li>
</ul>
<hr/>
<h2 data-id="heading-3">二、捕获组：Match.Groups 到底是什么？</h2>
<p><strong>示例：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Text.RegularExpressions;

<span class="hljs-keyword">var</span> input = <span class="hljs-string">"2025-12-18"</span>;
<span class="hljs-keyword">var</span> pattern = <span class="hljs-string">@"^(\d{4})-(\d{2})-(\d{2})$"</span>;

Match match = Regex.Match(input, pattern);
<span class="hljs-keyword">if</span> (!match.Success)
{
    Console.WriteLine(<span class="hljs-string">"No match"</span>);
    <span class="hljs-keyword">return</span>;
}

Console.WriteLine(<span class="hljs-string">$"Full: <span class="hljs-subst">{match.Groups[<span class="hljs-number">0</span>].Value}</span>"</span>);
Console.WriteLine(<span class="hljs-string">$"Year: <span class="hljs-subst">{match.Groups[<span class="hljs-number">1</span>].Value}</span>"</span>);
Console.WriteLine(<span class="hljs-string">$"Month:<span class="hljs-subst">{match.Groups[<span class="hljs-number">2</span>].Value}</span>"</span>);
Console.WriteLine(<span class="hljs-string">$"Day:  <span class="hljs-subst">{match.Groups[<span class="hljs-number">3</span>].Value}</span>"</span>);
</code></pre>
<p><strong>解析：</strong></p>
<ul>
<li><code>Groups[0]</code> 永远是“整个匹配到的字符串”</li>
<li><code>Groups[1]</code> 开始才是你写的第 1、2、3… 个捕获组</li>
</ul>
<hr/>
<h2 data-id="heading-4">三、命名分组：让提取更稳、更好维护</h2>
<p>当分组多了以后，<code>Groups[7]</code> 这种写法非常容易错。命名分组就是解决这个问题的。</p>
<p>语法：</p>
<pre><code class="hljs language-regex" lang="regex">(?&lt;name&gt;...)
</code></pre>
<p>把上面的日期改成命名分组：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> input = <span class="hljs-string">"2025-12-18"</span>;
<span class="hljs-keyword">var</span> input = <span class="hljs-string">"2025-12-18"</span>;
<span class="hljs-keyword">var</span> pattern = <span class="hljs-string">@"^(?&lt;year&gt;\d{4})-(?&lt;month&gt;\d{2})-(?&lt;day&gt;\d{2})$"</span>;

Match match = Regex.Match(input, pattern);
Console.WriteLine(match.Groups[<span class="hljs-string">"year"</span>].Value);  <span class="hljs-comment">// 2025</span>
Console.WriteLine(match.Groups[<span class="hljs-string">"month"</span>].Value); <span class="hljs-comment">// 12</span>
Console.WriteLine(match.Groups[<span class="hljs-string">"day"</span>].Value);   <span class="hljs-comment">// 18</span>

<span class="hljs-comment">// 依然可以用序号访问到目标内容</span>
Console.WriteLine(<span class="hljs-string">$"Full: <span class="hljs-subst">{match.Groups[<span class="hljs-number">0</span>].Value}</span>"</span>);
Console.WriteLine(<span class="hljs-string">$"Year: <span class="hljs-subst">{match.Groups[<span class="hljs-number">1</span>].Value}</span>"</span>);
Console.WriteLine(<span class="hljs-string">$"Month:<span class="hljs-subst">{match.Groups[<span class="hljs-number">2</span>].Value}</span>"</span>);
Console.WriteLine(<span class="hljs-string">$"Day:  <span class="hljs-subst">{match.Groups[<span class="hljs-number">3</span>].Value}</span>"</span>);
</code></pre>
<hr/>
<h2 data-id="heading-5">四、Regex.Replace 的“重排”：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mtext>与</mtext></mrow><annotation encoding="application/x-tex">1 与 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">1</span><span class="mord cjk_fallback">与</span></span></span></span></span>{name}</h2>
<h3 data-id="heading-6">1. 按序号引用：<code>$1</code>、<code>$2</code>…</h3>
<blockquote>
<p>序号从1开始</p>
</blockquote>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> input = <span class="hljs-string">"2025-12-18"</span>;
<span class="hljs-keyword">var</span> pattern = <span class="hljs-string">@"^(\d{4})-(\d{2})-(\d{2})$"</span>;

<span class="hljs-keyword">var</span> output = Regex.Replace(input, pattern, <span class="hljs-string">"$3/$2/$1"</span>);
Console.WriteLine(output); <span class="hljs-comment">// 18/12/2025</span>
</code></pre>
<h3 data-id="heading-7">2. 按名称引用：<code>${year}</code>、<code>${month}</code>…</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> input = <span class="hljs-string">"2025-12-18"</span>;
<span class="hljs-keyword">var</span> pattern = <span class="hljs-string">@"^(?&lt;year&gt;\d{4})-(?&lt;month&gt;\d{2})-(?&lt;day&gt;\d{2})$"</span>;

<span class="hljs-keyword">var</span> output = Regex.Replace(input, pattern, <span class="hljs-string">"${day}/${month}/${year}"</span>);
Console.WriteLine(output); <span class="hljs-comment">// 18/12/2025</span>
</code></pre>
<hr/>
<h2 data-id="heading-8">五、非捕获分组：<code>(?:...)</code></h2>
<p>当我们想匹配整体，并且分组内容不存入 <code>Groups</code> 集合。此时用非捕获分组：</p>
<pre><code class="hljs language-regex" lang="regex">(?:...)
</code></pre>
<p><strong>示例：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">string</span> input = <span class="hljs-string">"I love C# and I love Java"</span>;

<span class="hljs-comment">// 使用非捕获分组 (?:C#|Java)</span>
<span class="hljs-comment">// 它只是为了让 | (或) 逻辑生效，而不建立单独的提取组</span>
<span class="hljs-built_in">string</span> pattern = <span class="hljs-string">@"I love (?:C#|Java)"</span>;

MatchCollection matches = Regex.Matches(input, pattern);

<span class="hljs-keyword">foreach</span> (Match m <span class="hljs-keyword">in</span> matches)
{
    Console.WriteLine(<span class="hljs-string">$"完全匹配内容: <span class="hljs-subst">{m.Value}</span>"</span>);
    Console.WriteLine(<span class="hljs-string">$"分组数量: <span class="hljs-subst">{m.Groups.Count}</span>"</span>); <span class="hljs-comment">// 索引 0 永远是完整匹配，并且只有一个，没有为C#|Java单独分组</span>
}
<span class="hljs-comment">/*输出
完全匹配内容: I love C#
分组数量: 1
完全匹配内容: I love Java
分组数量: 1
*/</span>
</code></pre>
<hr/>
<h2 data-id="heading-9">结语</h2>
<p><strong>点个赞，关注我获取更多实用 C# 技术干货！如果觉得有用，记得收藏本文</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（1）什么是Hibernate？]]></title>    <link>https://juejin.cn/post/7587636536897290276</link>    <guid>https://juejin.cn/post/7587636536897290276</guid>    <pubDate>2025-12-25T12:11:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587636536897290276" data-draft-id="7587636536897273892" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（1）什么是Hibernate？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-25T12:11:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（1）什么是Hibernate？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T12:11:49.000Z" title="Thu Dec 25 2025 12:11:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hibernate 是一个开源的对象关系映射（ORM）框架，用于简化 Java 应用程序与关系数据库之间的数据持久化。它将 Java 类映射到数据库表，将 Java 对象的属性映射到表中的列，从而实现对象与关系数据库之间的自动映射与转换。Hibernate 以透明、简洁且高效的方式处理持久化数据，极大地减少了开发者的工作量。</p>
<h3 data-id="heading-0">核心概念</h3>
<ul>
<li><strong>Session</strong>: 用于执行 CRUD 操作的接口，是 Hibernate 与数据库之间的交互接口。</li>
<li><strong>SessionFactory</strong>: 用于创建 Session 对象的工厂。</li>
<li><strong>Configuration</strong>: 配置对象，用于加载 Hibernate 配置文件和映射文件。</li>
<li><strong>Transaction</strong>: 表示数据库事务，用于确保数据操作的完整性和一致性。</li>
<li><strong>Query</strong>: 用于执行 HQL（Hibernate Query Language）或 SQL 查询的接口。</li>
</ul>
<h3 data-id="heading-1">配置</h3>
<ol>
<li><strong>Hibernate Configuration File</strong> (<code>hibernate.cfg.xml</code>): 用于配置数据库连接属性和 Hibernate 相关设置。</li>
</ol>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Database connection settings --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/yourdb<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>yourusername<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>yourpassword<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- JDBC connection pool settings --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.c3p0.min_size"</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.c3p0.max_size"</span>&gt;</span>20<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.c3p0.timeout"</span>&gt;</span>300<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.c3p0.max_statements"</span>&gt;</span>50<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.c3p0.idle_test_period"</span>&gt;</span>3000<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- SQL dialect --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Echo all executed SQL to stdout --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Drop and re-create the database schema on startup --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Mapping files --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"path/to/yourmappingfile.hbm.xml"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<ol start="2">
<li><strong>Entity Class</strong>: Java 类映射到数据库表。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.Id;
<span class="hljs-keyword">import</span> javax.persistence.Table;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "Employee")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String department;
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> salary;

    <span class="hljs-comment">// Getters and Setters</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDepartment</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> department;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDepartment</span><span class="hljs-params">(String department)</span> {
        <span class="hljs-built_in">this</span>.department = department;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getSalary</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> salary;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSalary</span><span class="hljs-params">(<span class="hljs-type">double</span> salary)</span> {
        <span class="hljs-built_in">this</span>.salary = salary;
    }
}
</code></pre>
<ol start="3">
<li><strong>DAO (Data Access Object)</strong>: 数据库操作的实现类。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmployeeDAO</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SessionFactory factory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-comment">// Create the SessionFactory from hibernate.cfg.xml</span>
        <span class="hljs-keyword">try</span> {
            factory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure().buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addEmployee</span><span class="hljs-params">(Employee employee)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> factory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">tx</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            tx = session.beginTransaction();
            session.save(employee);
            tx.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (tx != <span class="hljs-literal">null</span>) tx.rollback();
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            session.close();
        }
    }

    <span class="hljs-keyword">public</span> Employee <span class="hljs-title function_">getEmployee</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> factory.openSession();
        <span class="hljs-type">Employee</span> <span class="hljs-variable">employee</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            employee = session.get(Employee.class, id);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            session.close();
        }
        <span class="hljs-keyword">return</span> employee;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateEmployee</span><span class="hljs-params">(Employee employee)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> factory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">tx</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            tx = session.beginTransaction();
            session.update(employee);
            tx.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (tx != <span class="hljs-literal">null</span>) tx.rollback();
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            session.close();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteEmployee</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> factory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">tx</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            tx = session.beginTransaction();
            <span class="hljs-type">Employee</span> <span class="hljs-variable">employee</span> <span class="hljs-operator">=</span> session.get(Employee.class, id);
            <span class="hljs-keyword">if</span> (employee != <span class="hljs-literal">null</span>) {
                session.delete(employee);
                tx.commit();
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (tx != <span class="hljs-literal">null</span>) tx.rollback();
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            session.close();
        }
    }
}
</code></pre>
<ol start="4">
<li><strong>Main Class</strong>: 测试 DAO 操作。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">EmployeeDAO</span> <span class="hljs-variable">employeeDAO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EmployeeDAO</span>();

        <span class="hljs-comment">// Add Employee</span>
        <span class="hljs-type">Employee</span> <span class="hljs-variable">emp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>();
        emp.setId(<span class="hljs-number">1</span>);
        emp.setName(<span class="hljs-string">"John Doe"</span>);
        emp.setDepartment(<span class="hljs-string">"Engineering"</span>);
        emp.setSalary(<span class="hljs-number">75000</span>);
        employeeDAO.addEmployee(emp);

        <span class="hljs-comment">// Get Employee</span>
        <span class="hljs-type">Employee</span> <span class="hljs-variable">retrievedEmp</span> <span class="hljs-operator">=</span> employeeDAO.getEmployee(<span class="hljs-number">1</span>);
        System.out.println(<span class="hljs-string">"Retrieved Employee: "</span> + retrievedEmp.getName());

        <span class="hljs-comment">// Update Employee</span>
        retrievedEmp.setSalary(<span class="hljs-number">80000</span>);
        employeeDAO.updateEmployee(retrievedEmp);

        <span class="hljs-comment">// Delete Employee</span>
        employeeDAO.deleteEmployee(<span class="hljs-number">1</span>);
    }
}
</code></pre>
<h3 data-id="heading-2">详细解释</h3>
<ol>
<li>
<p><strong>配置文件</strong>：
<code>hibernate.cfg.xml</code> 配置文件定义了数据库连接属性、JDBC 连接池设置、SQL 方言以及映射文件路径。这个文件是 Hibernate 的核心配置文件，通常放在资源目录下。</p>
</li>
<li>
<p><strong>实体类</strong>：
<code>Employee</code> 类使用 <code>@Entity</code> 注解标识为 Hibernate 实体类，<code>@Table</code> 注解定义了该类对应的数据库表名。类的字段映射到表的列，使用 <code>@Id</code> 注解定义主键字段。</p>
</li>
<li>
<p><strong>DAO 类</strong>：
<code>EmployeeDAO</code> 类包含了基本的 CRUD 操作方法，包括添加、获取、更新和删除员工记录。使用 <code>SessionFactory</code> 创建 <code>Session</code> 对象，使用 <code>Transaction</code> 处理数据库事务，确保数据一致性。</p>
</li>
<li>
<p><strong>测试类</strong>：
<code>HibernateExample</code> 类通过 <code>EmployeeDAO</code> 调用 CRUD 操作方法，演示了如何使用 Hibernate 进行数据库操作。</p>
</li>
</ol>
<p>通过这些代码示例，展示了 Hibernate 的基本使用方法，包括配置、实体映射、数据访问和事务管理。Hibernate 提供了一种简洁高效的方式来处理 Java 对象与关系数据库之间的持久化操作。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（2）Hibernate的核心组件有哪些？]]></title>    <link>https://juejin.cn/post/7587631760253435923</link>    <guid>https://juejin.cn/post/7587631760253435923</guid>    <pubDate>2025-12-25T12:13:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587631760253435923" data-draft-id="7587631760253419539" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（2）Hibernate的核心组件有哪些？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-25T12:13:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（2）Hibernate的核心组件有哪些？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T12:13:24.000Z" title="Thu Dec 25 2025 12:13:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hibernate 是一个功能强大的 ORM 框架，它的核心组件主要包括以下几个部分，每个组件在 Hibernate 的工作流程中都发挥着重要的作用。以下将详细介绍这些核心组件，并结合代码示例解释它们的使用和交互。</p>
<h3 data-id="heading-0">1. Configuration</h3>
<p><code>Configuration</code> 对象用于读取 Hibernate 的配置文件（如 <code>hibernate.cfg.xml</code>）并创建 <code>SessionFactory</code>。它包含了数据库连接信息与 Hibernate 的设置。</p>
<p><strong>示例代码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// Create the SessionFactory from hibernate.cfg.xml</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure().buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// Make sure you log the exception to track the error</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h3 data-id="heading-1">2. SessionFactory</h3>
<p><code>SessionFactory</code> 是一个线程安全的对象，用于创建 <code>Session</code> 实例。它是 Hibernate 的核心接口之一，负责配置 Hibernate 和启动持久化框架。</p>
<p><strong>示例代码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();
</code></pre>
<h3 data-id="heading-2">3. Session</h3>
<p><code>Session</code> 是一个轻量级的非线程安全对象，负责执行 CRUD 操作。每一个 <code>Session</code> 代表一个与数据库的单独会话。</p>
<p><strong>示例代码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmployeeDAO</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addEmployee</span><span class="hljs-params">(Employee employee)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory().openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">tx</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            tx = session.beginTransaction();
            session.save(employee);
            tx.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (tx != <span class="hljs-literal">null</span>) tx.rollback();
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            session.close();
        }
    }
}
</code></pre>
<h3 data-id="heading-3">4. Transaction</h3>
<p><code>Transaction</code> 对象用于管理和协调 <code>Session</code> 的多个操作。它确保操作的原子性、隔离性和持久性。通过 <code>Transaction</code>，可以控制事务的开始、提交和回滚。</p>
<p><strong>示例代码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateEmployee</span><span class="hljs-params">(Employee employee)</span> {
    <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory().openSession();
    <span class="hljs-type">Transaction</span> <span class="hljs-variable">tx</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">try</span> {
        tx = session.beginTransaction();
        session.update(employee);
        tx.commit();
    } <span class="hljs-keyword">catch</span> (Exception e) {
        <span class="hljs-keyword">if</span> (tx != <span class="hljs-literal">null</span>) tx.rollback();
        e.printStackTrace();
    } <span class="hljs-keyword">finally</span> {
        session.close();
    }
}
</code></pre>
<h3 data-id="heading-4">5. Query</h3>
<p><code>Query</code> 对象用于执行 HQL（Hibernate Query Language）或 SQL 查询，并在数据库中获取结果。它可以执行复杂的查询操作。</p>
<p><strong>示例代码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.query.Query;

<span class="hljs-keyword">public</span> Employee <span class="hljs-title function_">getEmployeeByName</span><span class="hljs-params">(String name)</span> {
    <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory().openSession();
    <span class="hljs-type">Employee</span> <span class="hljs-variable">employee</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">hql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"FROM Employee E WHERE E.name = :employee_name"</span>;
        <span class="hljs-type">Query</span> <span class="hljs-variable">query</span> <span class="hljs-operator">=</span> session.createQuery(hql);
        query.setParameter(<span class="hljs-string">"employee_name"</span>, name);
        employee = (Employee) query.uniqueResult();
    } <span class="hljs-keyword">catch</span> (Exception e) {
        e.printStackTrace();
    } <span class="hljs-keyword">finally</span> {
        session.close();
    }
    <span class="hljs-keyword">return</span> employee;
}
</code></pre>
<h3 data-id="heading-5">6. Criteria</h3>
<p><code>Criteria</code> 接口用于创建动态查询。它支持创建复杂的查询条件，并提供了一个类型安全的查询 API。</p>
<p><strong>示例代码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Criteria;
<span class="hljs-keyword">import</span> org.hibernate.criterion.Restrictions;

<span class="hljs-keyword">public</span> List&lt;Employee&gt; <span class="hljs-title function_">getEmployeesByDepartment</span><span class="hljs-params">(String department)</span> {
    <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory().openSession();
    List&lt;Employee&gt; employees = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">Criteria</span> <span class="hljs-variable">criteria</span> <span class="hljs-operator">=</span> session.createCriteria(Employee.class);
        criteria.add(Restrictions.eq(<span class="hljs-string">"department"</span>, department));
        employees = criteria.list();
    } <span class="hljs-keyword">catch</span> (Exception e) {
        e.printStackTrace();
    } <span class="hljs-keyword">finally</span> {
        session.close();
    }
    <span class="hljs-keyword">return</span> employees;
}
</code></pre>
<h3 data-id="heading-6">7. Annotations</h3>
<p>Hibernate 支持使用 JPA 注解来配置实体类、字段和关系。</p>
<p><strong>示例代码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.Id;
<span class="hljs-keyword">import</span> javax.persistence.Table;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "Employee")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String department;
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> salary;

    <span class="hljs-comment">// Getters and Setters</span>
}
</code></pre>
<h3 data-id="heading-7">8. Caching</h3>
<p>Hibernate 支持一级和二级缓存来优化数据访问性能。一级缓存是 <code>Session</code> 范围的缓存，而二级缓存是 <code>SessionFactory</code> 范围的缓存。</p>
<p><strong>一级缓存（Session 级别的缓存）</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory().openSession();
<span class="hljs-type">Employee</span> <span class="hljs-variable">emp1</span> <span class="hljs-operator">=</span> session.get(Employee.class, <span class="hljs-number">1</span>);
<span class="hljs-type">Employee</span> <span class="hljs-variable">emp2</span> <span class="hljs-operator">=</span> session.get(Employee.class, <span class="hljs-number">1</span>);  <span class="hljs-comment">// 从缓存中获取，不会再发出SQL</span>
</code></pre>
<p><strong>二级缓存（SessionFactory 级别的缓存）</strong>：
配置文件（<code>hibernate.cfg.xml</code>）中启用二级缓存：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.cache.use_second_level_cache"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.cache.region.factory_class"</span>&gt;</span>org.hibernate.cache.ehcache.EhCacheRegionFactory<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
</code></pre>
<p>在实体类上启用缓存：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.annotations.Cache;
<span class="hljs-keyword">import</span> org.hibernate.annotations.CacheConcurrencyStrategy;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Cacheable</span>
<span class="hljs-meta">@Cache(usage = CacheConcurrencyStrategy.READ_WRITE)</span>
<span class="hljs-meta">@Table(name = "Employee")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String department;
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> salary;

    <span class="hljs-comment">// Getters and Setters</span>
}
</code></pre>
<h3 data-id="heading-8">9. Interceptors</h3>
<p><code>Interceptor</code> 接口用于在实体生命周期方法（如 save、update、delete 等）之前或之后执行自定义逻辑。</p>
<p><strong>示例代码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.EmptyInterceptor;
<span class="hljs-keyword">import</span> org.hibernate.type.Type;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">EmptyInterceptor</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onSave</span><span class="hljs-params">(Object entity, Serializable id, Object[] state, String[] propertyNames, Type[] types)</span> {
        System.out.println(<span class="hljs-string">"Entity is being saved: "</span> + entity);
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.onSave(entity, id, state, propertyNames, types);
    }
}

<span class="hljs-comment">// 在获取 SessionFactory 时应用拦截器</span>
<span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>()
    .configure()
    .setInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomInterceptor</span>())
    .buildSessionFactory();
</code></pre>
<h3 data-id="heading-9">10. Event Listeners</h3>
<p><code>Event Listeners</code> 提供了一种在 Hibernate 事件（如 load、save、update、delete）发生时进行自定义处理的机制。</p>
<p><strong>示例代码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.event.spi.PreInsertEvent;
<span class="hljs-keyword">import</span> org.hibernate.event.spi.PreInsertEventListener;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomEventListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PreInsertEventListener</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onPreInsert</span><span class="hljs-params">(PreInsertEvent event)</span> {
        System.out.println(<span class="hljs-string">"Before inserting entity: "</span> + event.getEntity());
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}

<span class="hljs-comment">// 在配置文件中注册事件监听器</span>
&lt;hibernate-configuration&gt;
    &lt;session-factory&gt;
        ...
        &lt;event type=<span class="hljs-string">"pre-insert"</span>&gt;
            &lt;listener class=<span class="hljs-string">"com.example.CustomEventListener"</span>/&gt;
        &lt;/event&gt;
    &lt;/session-factory&gt;
&lt;/hibernate-configuration&gt;
</code></pre>
<p>通过这些示例代码，我们可以看到 Hibernate 核心组件在不同的使用场景中的应用。这些组件共同构成了 Hibernate 的工作流程，从会话管理、事务管理、缓存机制到事件处理，都为开发者提供了强大而灵活的工具来处理数据持久化。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[能和爸妈讲明白的大模型原理]]></title>    <link>https://juejin.cn/post/7587634022575456319</link>    <guid>https://juejin.cn/post/7587634022575456319</guid>    <pubDate>2025-12-25T12:25:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587634022575456319" data-draft-id="7587630831465283626" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="能和爸妈讲明白的大模型原理"/> <meta itemprop="keywords" content="人工智能,机器学习,前端"/> <meta itemprop="datePublished" content="2025-12-25T12:25:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="这是你的玩具车吗"/> <meta itemprop="url" content="https://juejin.cn/user/3737995264659230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            能和爸妈讲明白的大模型原理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995264659230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    这是你的玩具车吗
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T12:25:55.000Z" title="Thu Dec 25 2025 12:25:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>当我们谈起大模型的原理，迎面而来的是一系列专有名词，例如<strong>Transformer 架构、自注意力机制 (Self-Attention)、预训练 (Pre-training)、有监督微调 (SFT)、人类反馈强化学习 (RLHF)、Token 化 (Tokenization)、嵌入向量 (Embeddings)、上下文窗口 (Context Window)、检索增强生成 (RAG) 和缩放法则 (Scaling Laws)。</strong></p>
<p>这些专有名词是那么的多，以至于理解大模型的底层原理变得很困难，更不用说讲解清楚了。本文不涉及任何一个专有名词，<strong>用最朴实无华的文字和例子来阐述大模型</strong>。</p>
<p><em>相信你看完也能将大模型的原理解释给自己的爸妈听，过年回家和亲戚们吹牛逼，特别好用。</em> 🐶</p>
<h2 data-id="heading-0">开篇：从一个问题开始，凭什么说羊听不懂人话</h2>
<p>不知道你是否思考过这样一个问题：如果你对一只羊说吃草，羊就能照做；说停止，羊就能停止。那你<strong>凭什么说羊听不懂人话</strong>？</p>
<p>尽管羊能根据我的指令进行行动，但是如果我说“左蹄子刨地3下再吃草”，羊就会茫然不知所措，或者直接低头吃草。羊无法理解这种新的组合指令，所以初中生物课本告诉我们：这种行为叫做条件反射——一种针对于特定情况的反应。</p>
<p>那么，现在一个更宏大的问题摆在我们面前： 大家都用过大模型，哪怕输入一本书，它都能快速总结和沉淀中心思想。大模型总能识别我们言语中的各种复杂表达。那么，大模型是懂人话吗？</p>
<h2 data-id="heading-1">大模型的核心原理：多维向量映射匹配</h2>
<p><strong>大模型也不懂人话。大模型只是在做一种语义匹配</strong>。可以假想大模型中有无数张卡片，每张卡片代表一个词或者字，上面记录了它所有潜在的<strong>关联关系</strong>。</p>
<p>当我们输入：“中国的首都是哪里？” 大模型会找出“中国”和“首都”两张卡片，并计算它们共同指向哪个词的关联度最高。从多个维度上，大模型会发现“北京”这个词的关联度得分最高。</p>
<p>然后，大模型会先吐出得分最高的第一个字：“北”。然后，再将“北”也加入到联想中，继续计算：在“中国、首都、北”的关联度最高的下一个字，也就是“京”。</p>
<p>发现了吗？在人类的大脑中，我们认为“北京”是一个整体；但是对于大模型，北京两个字是单独吐出的，只不过它们组合起来恰好是正确答案而已。</p>
<p>因为<strong>大模型和人类的思考方式不同</strong>，它压根儿不关心“北京”两个字的合并意义，所以大模型也不懂人话。</p>
<p>但是妙就妙在尽管大模型完全不懂，但是通过它内部非常复杂的匹配计算逻辑，最终还能返回正确的答案。在1957年J.R. Firth提出这个天才想法时，这一切还被当作是天方夜谭，但是这个想法今天已被实现。</p>
<h2 data-id="heading-2">大模型与人脑不同的思维方式</h2>
<p><strong>不同于人脑的渐进式、有顺序的思维，大模型是批量的、直接的检索</strong>。当被询问滕王阁序的第2句是什么？我们潜意识的是从第一句开始，“豫章故郡，洪都新府。星分翼轸，地接衡庐...”。OK，第2句是星分翼轸，地接衡庐。而大模型通过注意力机制，会把注意力集中在“滕王阁序”和“第2句”上 <strong>。</strong> 它不需要像人脑一样从第一句开始想，而是直接找到并逐字吐出“星”“分”“翼”“轸”等字，最终拼成结果返回给你。</p>
<p>如果把人类社会的所有知识，都比做y = 2x这样一条线。那大模型就是用了一个复杂了成千上万倍的公式，来恰好拟合了这条线。人类社会中输入x = 1, 计算得到y = 2 * 1 = 2。而在大模型里，输入 x = 1，经过了复杂了无数倍的计算，y还是恰好等于2。</p>
<p>两个公式完全不同，但是得到的结果相同。就好像一个地球人和一个外星人，接受的教育完全不同，但是最终都用自己的手段计算出了 1 + 1 = 2。这种<strong>殊途同归的现象，表明了宇宙真理的恒定，而不依赖特定的实现方式</strong>，真是让人惊叹。</p>
<p>花了大量的篇幅，我们终于知道大模型是一种基于复杂单元匹配的模型。越是能力优秀的模型，越是能恰好匹配人类世界的知识。这让它<strong>看起来懂人话，实际上只是匹配的准</strong>而已。而如果匹配不准，即没有返回正确答案——例如说在大模型的初期，大模型总是编造一些回复——我们就说大模型出现了幻觉。</p>
<h2 data-id="heading-3">大模型的发展方向</h2>
<p>那么大模型的发展方向也就昭然若揭了——即<strong>吸收足够多的知识，成为一位全知全能的神</strong>。当然，考虑到大模型只是对过去所有信息的匹配，也没有自我的主观能动性。它既没法知道未来的情况，也没有办法理解人类历史上从来没有出现过的情况。叫神肯定是过分了，但是它仍可以<strong>尝试成为冻结在此时此刻的、人类知识快照中的、极速运转的百科全书 + 推理机。</strong></p>
<p>在模型能力无限强悍、算力无限充足、且全部知识模型都已了解的理想情况下，人类提出的任何不需要创造性、只需要计算的问题，大模型瞬间就能给出答案。</p>
<p>例如DNA测序瞬间就能解决、PB级别的数据瞬间就能分析、几百亿种情况的推衍瞬间就能结束。只需要出一个想法，大模型就能遍历人类已有的方法来验证，人类将在基础科学上取得长足的进步，进而推动社会取得突飞猛进的发展。</p>
<h2 data-id="heading-4">目前大模型的限制</h2>
<p>为什么大模型目前还做不到呢？因为算力有限、知识有限、模型能力有限。</p>
<p>训练一个像 GPT-4 这样的大模型所需要的总计算量大概是10的25次方量级，而训练一个超级人工智能需要大概10的28次方量级的总计算量或者更高。<strong>这相当于去攀爬一座至少1000米高的山，而我们仅仅爬了1米而已</strong>。</p>
<p>粗估英伟达一年能卖150W张H100高端AI芯片，这些芯片每年能提供给10的28次方量级的新增算力。看起来算力的物理供给已经足够支持总计算量10的27次方这种级别模型了，但是不好意思，数据又跟不上了。</p>
<p>根据AI届的缩放法则，要训练10的27次方计算量的模型，需要10倍于当前知识的数据量。而目前互联网上可用于训练的高质量文本数据总量，其数量约为10的15次方量级，即使算上音视频经过编码后的信息，总量也没有达到 10 倍的巨大飞跃。相当于芯片够了，训练数据也不够，巧妇难为无米之炊。</p>
<h2 data-id="heading-5">如何训练更强的大模型</h2>
<p>算力有限、知识有限，自然训练不出更高能力的模型。缺算力无非就是融资、开大马力抓紧生产AI高性能芯片。知识怎么解决呢？</p>
<p>除了使用上面说的音视频，还有就是让机器去自己收集数据。例如，一辆自动驾驶的车行驶一天，它收集的数据就是海量的，且是没有被人类归纳简化后的数据。让具身机器人去自己触摸，感受，各种传感器疯狂收集。</p>
<p>人类对于这个世界的了解还是太少了，我们已知的物理定律，只能解释宇宙中全部物质-能量构成的约 4.9%。未来，数据收集的规模和质量，将成为未来科学突破的关键驱动力，而先进的机器人技术正是实现这一目标的最有效途径。</p>
<p>自动驾驶和机器人，不仅有自身的价值，还能收集数据来训练更强大的大模型；而更强大的大模型反过来又能训练更高阶的自动驾驶和能力更强的机器人，从而形成正向循环。</p>
<h2 data-id="heading-6">AI是改变自身命运的最好机会</h2>
<p>何其有幸，我们这代人正站在 AI 驱动的数据爆炸与智能爆发的奇点上。AI 的车轮必将滚滚向前，它不仅是技术的革新，更是对人类价值的重新定义：过去需要耗费数年才能完成的基础科学验证，现在可能瞬间完成；过去因为成本太高而不值得探索的领域，现在即将打开。</p>
<p><strong>这是一场由算力、数据和模型能力共同谱写的史诗；它将极大提升生产力，并不可避免地重塑生产关系和财富分配。</strong></p>
<p>积极的拥抱AI，尽自己的全力去了解和使用它，寻找相关的机遇。这可能是我们这代人<strong>改变自己命运的最好机会</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Jetpack ViewModel内幕：内部机制与跨平台设计]]></title>    <link>https://juejin.cn/post/7587634022575472703</link>    <guid>https://juejin.cn/post/7587634022575472703</guid>    <pubDate>2025-12-25T12:29:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587634022575472703" data-draft-id="7587631760253566995" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Jetpack ViewModel内幕：内部机制与跨平台设计"/> <meta itemprop="keywords" content="Android,Android Jetpack,Kotlin"/> <meta itemprop="datePublished" content="2025-12-25T12:29:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="稀有猿诉"/> <meta itemprop="url" content="https://juejin.cn/user/2788017216685784"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Jetpack ViewModel内幕：内部机制与跨平台设计
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2788017216685784/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    稀有猿诉
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T12:29:27.000Z" title="Thu Dec 25 2025 12:29:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读20分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文译自「Inside Jetpack ViewModel: Internal Mechanisms and Multiplatform Design」，原文链接<a href="https://link.juejin.cn?target=https%3A%2F%2Fproandroiddev.com%2Finside-jetpack-viewmodel-internal-mechanisms-and-multiplatform-design-2625671eaef8" target="_blank" title="https://proandroiddev.com/inside-jetpack-viewmodel-internal-mechanisms-and-multiplatform-design-2625671eaef8" ref="nofollow noopener noreferrer">proandroiddev.com/inside-jetp…</a>，由Jaewoong Eum发布于2025年12月7日。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e851a5c89cf84d56883d19e87a66312f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270566&amp;x-signature=HWDRdZzKfSIhfBj5JrghD3QEsaY%3D" alt="Unsplash@davidvig" loading="lazy"/></p>
<p>Jetpack 的 ViewModel 已成为现代 Android 开发中不可或缺的组件，它为 UI 相关数据提供了一个生命周期感知容器，即使配置发生更改，数据也能保持不变。虽然其 API 表面上看起来很简单，但其内部机制却展现了围绕生命周期管理、跨平台抽象、资源清理和线程安全缓存等方面的设计决策。了解 ViewModel 的底层工作原理有助于你做出更优的架构决策，并避免一些不易察觉的错误。</p>
<p>本文将深入探讨 Jetpack ViewModel 的内部工作原理，包括 <code>ViewModelStore</code> 如何在配置更改后保留实例、<code>ViewModelProvider</code> 如何协调创建和缓存、工厂模式如何实现灵活的实例化、<code>CreationExtras</code> 如何实现无状态工厂、如何通过 Closeable 模式管理资源清理，以及 <code>viewModelScope</code> 如何将协程与 ViewModel 生命周期集成。</p>
<h2 data-id="heading-0">根本问题：配置更改后的保留</h2>
<p>配置更改是 Android 开发面临的一项根本性挑战。当用户旋转设备、更改语言设置或触发任何配置更改时，系统会销毁并重新创建 Activity。Activity 中存储的所有数据都会丢失：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> : <span class="hljs-type">ComponentActivity</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> userData: User? = <span class="hljs-literal">null</span>  <span class="hljs-comment">// Lost on rotation!</span>

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        <span class="hljs-comment">// Must reload data after every rotation</span>
        loadUserData()
    }
}
</code></pre>
<p>一种简单的方法是使用 <code>onSaveInstanceState()</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSaveInstanceState</span><span class="hljs-params">(outState: <span class="hljs-type">Bundle</span>)</span></span> {
    <span class="hljs-keyword">super</span>.onSaveInstanceState(outState)
    outState.putParcelable(<span class="hljs-string">"user"</span>, userData)
}

<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
    <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
    userData = savedInstanceState?.getParcelable(<span class="hljs-string">"user"</span>)
}
</code></pre>
<p>这种方法适用于小型、可序列化的数据。但是，对于大型数据集、网络连接或无法序列化的对象呢？对于持续进行的网络请求等操作呢？Bundle 方法在这些情况下会失效，原因既有大小限制，也有序列化/反序列化的高昂开销。</p>
<p>ViewModel 通过提供一个生命周期感知容器来解决这个问题，该容器通过保留对象模式（而非序列化）来应对配置更改。</p>
<h2 data-id="heading-1">ViewModelStore：保留机制</h2>
<p>ViewModel 配置变更后仍能保留的核心是 <code>ViewModelStore</code>，它是一个简单的键值存储，用于保存 ViewModel 实例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewModelStore</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> map = mutableMapOf&lt;String, ViewModel&gt;()

    <span class="hljs-meta">@RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">put</span><span class="hljs-params">(key: <span class="hljs-type">String</span>, viewModel: <span class="hljs-type">ViewModel</span>)</span></span> {
        <span class="hljs-keyword">val</span> oldViewModel = map.put(key, viewModel)
        oldViewModel?.clear()
    }

    <span class="hljs-meta">@RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">get</span><span class="hljs-params">(key: <span class="hljs-type">String</span>)</span></span>: ViewModel? {
        <span class="hljs-keyword">return</span> map[key]
    }

    <span class="hljs-meta">@RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">keys</span><span class="hljs-params">()</span></span>: Set&lt;String&gt; {
        <span class="hljs-keyword">return</span> HashSet(map.keys)
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">for</span> (vm <span class="hljs-keyword">in</span> map.values) {
            vm.clear()
        }
        map.clear()
    }
}
</code></pre>
<p>实现非常简单，就是一个 <code>MutableMap&lt;String, ViewModel&gt;</code>。关键不在于存储本身，而在于存储的保留方式。</p>
<h3 data-id="heading-2">键替换行为</h3>
<p>请注意 <code>put</code> 方法的行为：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">put</span><span class="hljs-params">(key: <span class="hljs-type">String</span>, viewModel: <span class="hljs-type">ViewModel</span>)</span></span> {
    <span class="hljs-keyword">val</span> oldViewModel = map.put(key, viewModel)
    oldViewModel?.clear()
}
</code></pre>
<p>如果已存在具有相同键的 ViewModel，则旧的 ViewModel 会被立即清除。这确保了在替换 ViewModel 时能够正确清理。你可能想知道这种情况何时发生，它发生在你请求具有相同键但类型不同的 ViewModel 时：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// First request creates TestViewModel1 with key "my_key"</span>
<span class="hljs-keyword">val</span> vm1: TestViewModel1 = viewModelProvider[<span class="hljs-string">"my_key"</span>, TestViewModel1::<span class="hljs-keyword">class</span>]

<span class="hljs-comment">// Second request with same key but different type</span>
<span class="hljs-keyword">val</span> vm2: TestViewModel2 = viewModelProvider[<span class="hljs-string">"my_key"</span>, TestViewModel2::<span class="hljs-keyword">class</span>]

<span class="hljs-comment">// vm1.onCleared() has been called, vm1 is no longer valid</span>
</code></pre>
<p>此行为已在测试套件中验证：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">twoViewModelsWithSameKey</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> key = <span class="hljs-string">"the_key"</span>
    <span class="hljs-keyword">val</span> vm1 = viewModelProvider[key, TestViewModel1::<span class="hljs-keyword">class</span>]
    assertThat(vm1.cleared).isFalse()
    <span class="hljs-keyword">val</span> vw2 = viewModelProvider[key, TestViewModel2::<span class="hljs-keyword">class</span>]
    assertThat(vw2).isNotNull()
    assertThat(vm1.cleared).isTrue()
}
</code></pre>
<h3 data-id="heading-3">ViewModelStoreOwner 契约</h3>
<p><code>ViewModelStoreOwner</code> 接口定义了谁拥有该存储：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ViewModelStoreOwner</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">val</span> viewModelStore: ViewModelStore
}
</code></pre>
<p><code>ComponentActivity</code>、<code>Fragment</code> 和 <code>NavBackStackEntry</code> 都实现了这个简单的接口。所有者的职责有两方面：</p>
<ol>
<li><strong>在配置更改后保留存储</strong>：存储必须在 Activity 重建后仍然存在。</li>
<li><strong>在真正完成后清除存储</strong>：当所有者被销毁而未重建时，调用 <code>ViewModelStore.clear()</code>。</li>
</ol>
<p>对于 Activity 而言，这通常使用 <code>NonConfigurationInstances</code> 来实现，这是一种特殊的机制，允许对象在配置更改后仍然存在。Activity 框架在 <code>onRetainNonConfigurationInstance()</code> 期间保留这些对象，并在 <code>getLastNonConfigurationInstance()</code> 中恢复它们。</p>
<h3 data-id="heading-4">为什么简单的映射有效</h3>
<p>你可能期望使用复杂的缓存机制，但简单的 <code>MutableMap</code> 就足够了，原因如下：</p>
<ol>
<li><strong>大小有限</strong>：每个屏幕上的 ViewModel 数量很少（通常为 1-5 个）。</li>
<li><strong>字符串键</strong>：键由类名生成，使得查找复杂度为 O(1)，并且哈希分布良好。</li>
<li><strong>无需驱逐</strong>：ViewModel 仅在显式请求或所有者被销毁时才会被清除。</li>
<li><strong>线程安全</strong>：访问在 ViewModelProvider 级别同步。</li>
</ol>
<h2 data-id="heading-5">ViewModelProvider：编排层</h2>
<p><code>ViewModelProvider</code> 是获取 ViewModel 实例的主要 API。它负责编排 store、factory 和创建 extras 之间的交互：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">actual</span> <span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewModelProvider</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> impl: ViewModelProviderImpl) {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">constructor</span>(
        store: ViewModelStore,
        factory: Factory,
        defaultCreationExtras: CreationExtras = CreationExtras.Empty,
    ) : <span class="hljs-keyword">this</span>(ViewModelProviderImpl(store, factory, defaultCreationExtras))

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">constructor</span>(
        owner: ViewModelStoreOwner
    ) : <span class="hljs-keyword">this</span>(
        store = owner.viewModelStore,
        factory = ViewModelProviders.getDefaultFactory(owner),
        defaultCreationExtras = ViewModelProviders.getDefaultCreationExtras(owner),
    )

    <span class="hljs-meta">@MainThread</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">actual</span> <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : ViewModel&gt;</span> <span class="hljs-title">get</span><span class="hljs-params">(modelClass: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: T =
        impl.getViewModel(modelClass)

    <span class="hljs-meta">@MainThread</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">actual</span> <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : ViewModel&gt;</span> <span class="hljs-title">get</span><span class="hljs-params">(key: <span class="hljs-type">String</span>, modelClass: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: T =
        impl.getViewModel(modelClass, key)
}
</code></pre>
<h3 data-id="heading-6">多平台抽象</h3>
<p>请注意 <code>ViewModelProviderImpl</code> 委托。ViewModel 库是一个 Kotlin 多平台库，支持 JVM、Android、iOS 和其他平台。Kotlin 多平台目前还不支持带有默认实现的 expect 类，因此通用逻辑被提取到内部实现类中：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewModelProviderImpl</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> store: ViewModelStore,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> factory: ViewModelProvider.Factory,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> defaultExtras: CreationExtras,
) {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> lock = SynchronizedObject()

    <span class="hljs-meta">@Suppress(<span class="hljs-string">"UNCHECKED_CAST"</span>)</span>
    <span class="hljs-keyword">internal</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : ViewModel&gt;</span> <span class="hljs-title">getViewModel</span><span class="hljs-params">(
        modelClass: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">T</span>&gt;,
        key: <span class="hljs-type">String</span> = ViewModelProviders.getDefaultKey(modelClass)</span></span>,
    ): T {
        <span class="hljs-keyword">return</span> synchronized(lock) {
            <span class="hljs-keyword">val</span> viewModel = store[key]
            <span class="hljs-keyword">if</span> (modelClass.isInstance(viewModel)) {
                <span class="hljs-keyword">if</span> (factory <span class="hljs-keyword">is</span> ViewModelProvider.OnRequeryFactory) {
                    factory.onRequery(viewModel!!)
                }
                <span class="hljs-keyword">return</span><span class="hljs-symbol">@synchronized</span> viewModel <span class="hljs-keyword">as</span> T
            }

            <span class="hljs-keyword">val</span> modelExtras = MutableCreationExtras(defaultExtras)
            modelExtras[ViewModelProvider.VIEW_MODEL_KEY] = key

            <span class="hljs-keyword">return</span><span class="hljs-symbol">@synchronized</span> createViewModel(factory, modelClass, modelExtras).also { vm -&gt;
                store.put(key, vm)
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-7">获取或创建模式</h3>
<p><code>getViewModel</code> 方法实现了经典的获取或创建模式：</p>
<ol>
<li><strong>生成键</strong>：默认键基于类的规范名称。</li>
<li><strong>检查缓存</strong>：通过键查找已存在的 ViewModel。</li>
<li><strong>类型检查</strong>：验证缓存实例的类型是否正确。</li>
<li><strong>返回缓存</strong>：如果有效，则返回缓存的实例。</li>
<li><strong>创建新实例</strong>：如果未找到或类型错误，则通过工厂模式创建新实例。</li>
<li><strong>存储</strong>：将新实例放入存储中。</li>
</ol>
<h3 data-id="heading-8">使用同步访问确保线程安全</h3>
<p><code>synchronized(lock)</code> 代码块确保线程安全访问。虽然 ViewModel 的访问通常来自主线程（如 <code>@MainThread</code> 所示），但同步机制可以防止后台线程访问 ViewModel 等极端情况，尤其是在测试场景或使用 <code>viewModelScope</code> 时。</p>
<h3 data-id="heading-9">OnRequeryFactory 回调</h3>
<p><code>OnRequeryFactory</code> 是一种特殊的机制，用于在检索缓存的 ViewModel 时执行操作的工厂：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">actual</span> <span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OnRequeryFactory</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">actual</span> <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onRequery</span><span class="hljs-params">(viewModel: <span class="hljs-type">ViewModel</span>)</span></span> {}
}
</code></pre>
<p><code>SavedStateHandle</code> 内部使用此机制在配置更改后将 ViewModel 与当前的 SavedStateRegistry 重新连接。当从缓存中检索 ViewModel 时，会调用工厂的 <code>onRequery</code> 方法，从而更新可能已更改的引用。</p>
<h3 data-id="heading-10">从类名生成键</h3>
<p>默认的键生成机制可防止意外冲突：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">internal</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : ViewModel&gt;</span> <span class="hljs-title">getDefaultKey</span><span class="hljs-params">(modelClass: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: String {
    <span class="hljs-keyword">val</span> canonicalName =
        requireNotNull(modelClass.canonicalName) {
            <span class="hljs-string">"Local and anonymous classes can not be ViewModels"</span>
        }
    <span class="hljs-keyword">return</span> <span class="hljs-string">"<span class="hljs-variable">$VIEW_MODEL_PROVIDER_DEFAULT_KEY</span>:<span class="hljs-variable">$canonicalName</span>"</span>
}
</code></pre>
<p>前缀 <code>"androidx.lifecycle.ViewModelProvider.DefaultKey:"</code> 可确保键不会与用户提供的自定义键冲突。规范名称要求也解释了为什么本地类和匿名类不能是 ViewModel，因为它们没有规范名称：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">localViewModel</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalViewModel</span> : <span class="hljs-type">ViewModel</span>()
    <span class="hljs-keyword">try</span> {
        viewModelProvider[LocalViewModel::<span class="hljs-keyword">class</span>]
        fail(<span class="hljs-string">"Expected `IllegalArgumentException`"</span>)
    } <span class="hljs-keyword">catch</span> (e: IllegalArgumentException) {
        assertThat(e)
            .hasMessageThat()
            .contains(<span class="hljs-string">"Local and anonymous classes can not be ViewModels"</span>)
    }
}
</code></pre>
<h2 data-id="heading-11">工厂模式：灵活实例化</h2>
<p><code>ViewModelProvider.Factory</code> 是创建 ViewModel 实例的机制：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">actual</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Factory</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : ViewModel&gt;</span> <span class="hljs-title">create</span><span class="hljs-params">(modelClass: <span class="hljs-type">Class</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: T =
        ViewModelProviders.unsupportedCreateViewModel()

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : ViewModel&gt;</span> <span class="hljs-title">create</span><span class="hljs-params">(modelClass: <span class="hljs-type">Class</span>&lt;<span class="hljs-type">T</span>&gt;, extras: <span class="hljs-type">CreationExtras</span>)</span></span>: T =
        create(modelClass)

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">actual</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : ViewModel&gt;</span> <span class="hljs-title">create</span><span class="hljs-params">(modelClass: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">T</span>&gt;, extras: <span class="hljs-type">CreationExtras</span>)</span></span>: T =
        create(modelClass.java, extras)
}
</code></pre>
<h3 data-id="heading-12">方法重载链</h3>
<p>工厂接口有三个 <code>create</code> 方法变体，形成一个链：</p>
<ol>
<li><code>create(KClass&lt;T&gt;, CreationExtras)</code>：Kotlin 优先 API，委托给 Java 变体</li>
<li><code>create(Class&lt;T&gt;, CreationExtras)</code>：主要实现点，默认为无附加组件的变体</li>
<li><code>create(Class&lt;T&gt;)</code>：传统 API，默认抛出异常</li>
</ol>
<p>此链在保持向后兼容性的同时，也鼓励使用基于 <code>CreationExtras</code> 的现代方法。</p>
<h3 data-id="heading-13">NewInstanceFactory：基于反射的创建</h3>
<p>最简单的工厂使用反射来创建带有无参构造函数的 ViewModel：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewInstanceFactory</span> : <span class="hljs-type">Factory</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : ViewModel&gt;</span> <span class="hljs-title">create</span><span class="hljs-params">(modelClass: <span class="hljs-type">Class</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: T =
        JvmViewModelProviders.createViewModel(modelClass)
}
</code></pre>
<p>JVM 实现使用反射并进行了细致的错误处理：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">object</span> JvmViewModelProviders {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : ViewModel&gt;</span> <span class="hljs-title">createViewModel</span><span class="hljs-params">(modelClass: <span class="hljs-type">Class</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: T {
        <span class="hljs-keyword">val</span> <span class="hljs-keyword">constructor</span> =
            <span class="hljs-keyword">try</span> {
                modelClass.getDeclaredConstructor()
            } <span class="hljs-keyword">catch</span> (e: NoSuchMethodException) {
                <span class="hljs-keyword">throw</span> RuntimeException(<span class="hljs-string">"Cannot create an instance of <span class="hljs-variable">$modelClass</span>"</span>, e)
            }

        <span class="hljs-comment">// Enforce public constructor for consistent behavior</span>
        <span class="hljs-keyword">if</span> (!Modifier.isPublic(<span class="hljs-keyword">constructor</span>.modifiers)) {
            <span class="hljs-keyword">throw</span> RuntimeException(<span class="hljs-string">"Cannot create an instance of <span class="hljs-variable">$modelClass</span>"</span>)
        }

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">constructor</span>.newInstance()
        } <span class="hljs-keyword">catch</span> (e: InstantiationException) {
            <span class="hljs-keyword">throw</span> RuntimeException(<span class="hljs-string">"Cannot create an instance of <span class="hljs-variable">$modelClass</span>"</span>, e)
        } <span class="hljs-keyword">catch</span> (e: IllegalAccessException) {
            <span class="hljs-keyword">throw</span> RuntimeException(<span class="hljs-string">"Cannot create an instance of <span class="hljs-variable">$modelClass</span>"</span>, e)
        }
    }
}
</code></pre>
<p>公共修饰符检查对于测试一致性至关重要。在插桩测试中，R8 可能会移除访问修饰符，使私有构造函数可访问。JVM 测试严格执行访问限制。此显式检查可确保跨测试环境的行为一致性。</p>
<h3 data-id="heading-14">AndroidViewModelFactory：应用感知创建</h3>
<p><code>AndroidViewModelFactory</code> 继承自 <code>NewInstanceFactory</code> 以支持 <code>AndroidViewModel</code>，后者需要一个 <code>Application</code> 参数。该工厂在保持向后兼容性的同时，也采用了现代的 <code>CreationExtras</code> 方法：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AndroidViewModelFactory</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> application: Application?,
    <span class="hljs-meta">@Suppress(<span class="hljs-string">"UNUSED_PARAMETER"</span>)</span> unused: <span class="hljs-built_in">Int</span>,
) : NewInstanceFactory() {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : ViewModel&gt;</span> <span class="hljs-title">create</span><span class="hljs-params">(modelClass: <span class="hljs-type">Class</span>&lt;<span class="hljs-type">T</span>&gt;, extras: <span class="hljs-type">CreationExtras</span>)</span></span>: T {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (application != <span class="hljs-literal">null</span>) {
            create(modelClass)
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">val</span> application = extras[APPLICATION_KEY]
            <span class="hljs-keyword">if</span> (application != <span class="hljs-literal">null</span>) {
                create(modelClass, application)
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (AndroidViewModel::<span class="hljs-keyword">class</span>.java.isAssignableFrom(modelClass)) {
                    <span class="hljs-keyword">throw</span> IllegalArgumentException(
                        <span class="hljs-string">"CreationExtras must have an application by `APPLICATION_KEY`"</span>
                    )
                }
                <span class="hljs-keyword">super</span>.create(modelClass)
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : ViewModel&gt;</span> <span class="hljs-title">create</span><span class="hljs-params">(modelClass: <span class="hljs-type">Class</span>&lt;<span class="hljs-type">T</span>&gt;, app: <span class="hljs-type">Application</span>)</span></span>: T {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (AndroidViewModel::<span class="hljs-keyword">class</span>.java.isAssignableFrom(modelClass)) {
            <span class="hljs-keyword">try</span> {
                modelClass.getConstructor(Application::<span class="hljs-keyword">class</span>.java).newInstance(app)
            } <span class="hljs-keyword">catch</span> (e: NoSuchMethodException) {
                <span class="hljs-keyword">throw</span> RuntimeException(<span class="hljs-string">"Cannot create an instance of <span class="hljs-variable">$modelClass</span>"</span>, e)
            }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">super</span>.create(modelClass)
    }
}
</code></pre>
<p>该工厂实现了级联解析策略：首先检查是否将 <code>Application</code> 传递给了构造函数（传统方法），然后通过 <code>APPLICATION_KEY</code> 在 <code>CreationExtras</code> 中查找（现代无状态方法），最后对于常规 ViewModel 回退到 <code>NewInstanceFactory</code>，或者如果 <code>AndroidViewModel</code> 没有可用的 <code>Application</code>，则抛出异常。</p>
<p>私有构造函数中的 <code>unused: Int</code> 参数是一个巧妙的技巧，用于区分重载构造函数，因为如果使用 <code>null</code> 调用 <code>constructor()</code>，编译器将无法区分 <code>constructor(application: Application?)</code>。</p>
<p>实例化使用了反射（<code>modelClass.getConstructor(Application::class.java).newInstance(app)</code>），这意味着你的 <code>AndroidViewModel</code> 子类必须有一个接受且仅接受一个 <code>Application</code> 参数的构造函数。对于其他依赖项，你需要自定义工厂或依赖注入框架，例如 Hilt。</p>
<h3 data-id="heading-15">InitializerViewModelFactory：基于 Lambda 的创建</h3>
<p>对于具有自定义依赖项的 ViewModel，<code>InitializerViewModelFactory</code> 提供了一种基于 DSL 的方法，可以减少样板代码：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> factory = viewModelFactory {
    initializer { MyViewModel(<span class="hljs-keyword">get</span>(MY_KEY)) }
    initializer { AnotherViewModel(<span class="hljs-keyword">get</span>(ANOTHER_KEY)) }
}
</code></pre>
<p>该 DSL 由一个构建器类驱动，该构建器类收集初始化 Lambda 表达式，其中每个初始化器将一个 <code>KClass</code> 与其创建 Lambda 表达式配对：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@ViewModelFactoryDsl</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InitializerViewModelFactoryBuilder</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">constructor</span>() {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> initializers = mutableMapOf&lt;KClass&lt;*&gt;, ViewModelInitializer&lt;*&gt;&gt;()

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : ViewModel&gt;</span> <span class="hljs-title">addInitializer</span><span class="hljs-params">(
        clazz: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">T</span>&gt;,
        initializer: <span class="hljs-type">CreationExtras</span>.() -&gt; <span class="hljs-type">T</span>,
    )</span></span> {
        require(clazz !<span class="hljs-keyword">in</span> initializers) {
            <span class="hljs-string">"A `initializer` with the same `clazz` has already been added: <span class="hljs-subst">${clazz.canonicalName}</span>."</span>
        }
        initializers[clazz] = ViewModelInitializer(clazz, initializer)
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">build</span><span class="hljs-params">()</span></span>: ViewModelProvider.Factory =
        ViewModelProviders.createInitializerFactory(initializers.values)
}
</code></pre>
<p><code>@ViewModelFactoryDsl</code> 注解是一个 DSL 标记，可防止嵌套的构建器作用域意外访问外部作用域的方法。初始化 Lambda 表达式接收 <code>CreationExtras</code> 作为其接收器，允许通过 <code>get()</code> 直接访问额外内容。</p>
<p>在创建时，工厂会通过初始化器进行线性搜索，以找到匹配的类：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">internal</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;VM : ViewModel&gt;</span> <span class="hljs-title">createViewModelFromInitializers</span><span class="hljs-params">(
    modelClass: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">VM</span>&gt;,
    extras: <span class="hljs-type">CreationExtras</span>,
    <span class="hljs-keyword">vararg</span> initializers: <span class="hljs-type">ViewModelInitializer</span>&lt;*&gt;,
)</span></span>: VM {
    <span class="hljs-keyword">val</span> viewModel =
        initializers.firstOrNull { it.clazz == modelClass }?.initializer?.invoke(extras) <span class="hljs-keyword">as</span> VM?
    <span class="hljs-keyword">return</span> requireNotNull(viewModel) {
        <span class="hljs-string">"No initializer set for given class <span class="hljs-subst">${modelClass.canonicalName}</span>"</span>
    }
}
</code></pre>
<p>线性搜索是可以接受的，因为每个工厂创建的 ViewModel 数量通常很少（1-5 个），而且 ViewModel 的创建频率很低（每个生命周期一次）。</p>
<h2 data-id="heading-16">CreationExtras：无状态工厂配置</h2>
<p><code>CreationExtras</code> 是一个类型安全的键值容器，用于在不使工厂成为有状态的情况下向其传递配置。工厂不再通过构造函数注入来持有依赖项，而是在创建时传递依赖项：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CreationExtras</span> <span class="hljs-keyword">internal</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">internal</span> <span class="hljs-keyword">val</span> extras: MutableMap&lt;Key&lt;*&gt;, Any?&gt; = mutableMapOf()

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Key</span>&lt;<span class="hljs-type">T</span>&gt;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">get</span><span class="hljs-params">(key: <span class="hljs-type">Key</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: T?

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">object</span> Empty : CreationExtras() {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">get</span><span class="hljs-params">(key: <span class="hljs-type">Key</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: T? = <span class="hljs-literal">null</span>
    }
}
</code></pre>
<h3 data-id="heading-17">类型安全的键</h3>
<p>每个键都由其关联的值类型参数化，从而提供编译时类型安全。当你使用 <code>extras[APPLICATION_KEY]</code> 获取值时，返回类型会自动为 <code>Application?</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> APPLICATION_KEY: Key&lt;Application&gt; = CreationExtras.Companion.Key()
<span class="hljs-keyword">val</span> VIEW_MODEL_KEY: Key&lt;String&gt; = CreationExtras.Companion.Key()
</code></pre>
<p>键的创建使用了一个内联函数，该函数创建一个实现 <code>Key</code> 接口的新匿名对象。由于每个键都是一个唯一的对象实例，因此键之间通过标识（<code>===</code>）进行比较，即使两个键具有相同的类型参数，也不会发生意外冲突：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@JvmStatic</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T&gt;</span> <span class="hljs-title">Key</span><span class="hljs-params">()</span></span>: Key&lt;T&gt; = <span class="hljs-keyword">object</span> : Key&lt;T&gt; {}
</code></pre>
<h3 data-id="heading-18">用于修改的 MutableCreationExtras</h3>
<p>基类 <code>CreationExtras</code> 是只读的，而 <code>MutableCreationExtras</code> 允许添加条目。这种分离遵循 Kotlin 的集合设计理念（例如 <code>List</code> 与 <code>MutableList</code>），防止工厂意外修改共享的 extras：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MutableCreationExtras</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">constructor</span>(initialExtras: CreationExtras = Empty) : CreationExtras() {

    <span class="hljs-keyword">init</span> {
        extras += initialExtras.extras
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">set</span><span class="hljs-params">(key: <span class="hljs-type">Key</span>&lt;<span class="hljs-type">T</span>&gt;, t: <span class="hljs-type">T</span>)</span></span> {
        extras[key] = t
    }

    <span class="hljs-meta">@Suppress(<span class="hljs-string">"UNCHECKED_CAST"</span>)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">get</span><span class="hljs-params">(key: <span class="hljs-type">Key</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: T? = extras[key] <span class="hljs-keyword">as</span> T?
}
</code></pre>
<h3 data-id="heading-19">与 ViewModelProvider 集成</h3>
<p><code>ViewModelProvider</code> 会在调用工厂之前自动将 ViewModel 的键添加到 extras 中，这对于像 <code>SavedStateHandle</code> 这样需要键来正确限定持久化范围的功能至关重要：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> modelExtras = MutableCreationExtras(defaultExtras)
modelExtras[ViewModelProvider.VIEW_MODEL_KEY] = key

<span class="hljs-keyword">return</span><span class="hljs-symbol">@synchronized</span> createViewModel(factory, modelClass, modelExtras)
</code></pre>
<h3 data-id="heading-20">HasDefaultViewModelProviderFactory</h3>
<p><code>ViewModelStoreOwner</code> 的实现可以通过 <code>HasDefaultViewModelProviderFactory</code> 接口提供默认的工厂和 extras。 <code>ComponentActivity</code> 和 <code>Fragment</code> 都实现了此接口，并提供了支持 <code>SavedStateHandle</code> 且预先填充了 <code>APPLICATION_KEY</code> 的工厂：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">HasDefaultViewModelProviderFactory</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">val</span> defaultViewModelProviderFactory: ViewModelProvider.Factory

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">val</span> defaultViewModelCreationExtras: CreationExtras
        <span class="hljs-keyword">get</span>() = CreationExtras.Empty
}
</code></pre>
<p><code>ComponentActivity</code> 和 <code>Fragment</code> 都实现了此接口，并提供了支持 <code>SavedStateHandle</code> 和正确的 <code>CreationExtras</code> 且预先填充了 <code>APPLICATION_KEY</code> 的工厂。</p>
<p>从 <code>ViewModelStoreOwner</code> 创建 <code>ViewModelProvider</code> 时，会自动使用以下默认值：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">internal</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getDefaultFactory</span><span class="hljs-params">(owner: <span class="hljs-type">ViewModelStoreOwner</span>)</span></span>: ViewModelProvider.Factory =
    <span class="hljs-keyword">if</span> (owner <span class="hljs-keyword">is</span> HasDefaultViewModelProviderFactory) {
        owner.defaultViewModelProviderFactory
    } <span class="hljs-keyword">else</span> {
        DefaultViewModelProviderFactory
    }

<span class="hljs-keyword">internal</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getDefaultCreationExtras</span><span class="hljs-params">(owner: <span class="hljs-type">ViewModelStoreOwner</span>)</span></span>: CreationExtras =
    <span class="hljs-keyword">if</span> (owner <span class="hljs-keyword">is</span> HasDefaultViewModelProviderFactory) {
        owner.defaultViewModelCreationExtras
    } <span class="hljs-keyword">else</span> {
        CreationExtras.Empty
    }
</code></pre>
<p>这种模式支持渐进增强：简单的 ViewModel 使用默认工厂，而复杂的 ViewModel 可以通过 extras 获取丰富的配置，而无需更改获取 ViewModelProvider 的方式。</p>
<h2 data-id="heading-21">ViewModel 类：资源管理</h2>
<p><code>ViewModel</code> 类通过 <code>AutoCloseable</code> 模式管理资源生命周期。<code>expect</code> 关键字表明这是一个 Kotlin 多平台声明，每个平台都提供自己的 <code>actual</code> 实现：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">expect</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewModel</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">constructor</span>()
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">constructor</span>(viewModelScope: CoroutineScope)
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">constructor</span>(<span class="hljs-keyword">vararg</span> closeables: AutoCloseable)
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">constructor</span>(viewModelScope: CoroutineScope, <span class="hljs-keyword">vararg</span> closeables: AutoCloseable)

    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCleared</span><span class="hljs-params">()</span></span>

    <span class="hljs-meta">@MainThread</span> <span class="hljs-keyword">internal</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span></span>

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">addCloseable</span><span class="hljs-params">(key: <span class="hljs-type">String</span>, closeable: <span class="hljs-type">AutoCloseable</span>)</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">addCloseable</span><span class="hljs-params">(closeable: <span class="hljs-type">AutoCloseable</span>)</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : AutoCloseable&gt;</span> <span class="hljs-title">getCloseable</span><span class="hljs-params">(key: <span class="hljs-type">String</span>)</span></span>: T?
}
</code></pre>
<h3 data-id="heading-22">ViewModelImpl 内部实现</h3>
<p>实际实现委托给 <code>ViewModelImpl</code>，遵循多平台模式，将通用逻辑提取到内部类中。<code>isCleared</code> 上的 <code>@Volatile</code> 注解确保跨线程可见，这对于清除后的保护机制至关重要：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewModelImpl</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> lock = SynchronizedObject()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> keyToCloseables = mutableMapOf&lt;String, AutoCloseable&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> closeables = mutableSetOf&lt;AutoCloseable&gt;()

    <span class="hljs-meta">@Volatile</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> isCleared = <span class="hljs-literal">false</span>

    <span class="hljs-keyword">constructor</span>()

    <span class="hljs-keyword">constructor</span>(viewModelScope: CoroutineScope) {
        addCloseable(VIEW_MODEL_SCOPE_KEY, viewModelScope.asCloseable())
    }

    <span class="hljs-keyword">constructor</span>(<span class="hljs-keyword">vararg</span> closeables: AutoCloseable) {
        <span class="hljs-keyword">this</span>.closeables += closeables
    }

    <span class="hljs-keyword">constructor</span>(viewModelScope: CoroutineScope, <span class="hljs-keyword">vararg</span> closeables: AutoCloseable) {
        addCloseable(VIEW_MODEL_SCOPE_KEY, viewModelScope.asCloseable())
        <span class="hljs-keyword">this</span>.closeables += closeables
    }
}
</code></pre>
<h3 data-id="heading-23">两层可关闭存储</h3>
<p>该实现维护两个集合：<code>keyToCloseables</code> 用于注册后需要检索的资源（例如 <code>viewModelScope</code>），以及 <code>closeables</code> 用于即用即弃的清理。使用 <code>Set</code> 来管理匿名可关闭资源可以防止重复注册导致双重关闭。</p>
<h3 data-id="heading-24">清除顺序</h3>
<p>当 ViewModel 被清除时，资源会按照特定的顺序进行清理。<code>isCleared = true</code> 标志会在同步代码块之前设置，以防止并发的 <code>addCloseable</code> 调用添加会被遗漏的资源：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@MainThread</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">if</span> (isCleared) <span class="hljs-keyword">return</span>

    isCleared = <span class="hljs-literal">true</span>
    synchronized(lock) {
        <span class="hljs-keyword">for</span> (closeable <span class="hljs-keyword">in</span> keyToCloseables.values) {
            closeWithRuntimeException(closeable)
        }
        <span class="hljs-keyword">for</span> (closeable <span class="hljs-keyword">in</span> closeables) {
            closeWithRuntimeException(closeable)
        }
        <span class="hljs-comment">// Clear only resources without keys to prevent accidental recreation</span>
        closeables.clear()
    }
}
</code></pre>
<p>匿名 <code>closeables</code> 集合会被清除，但 <code>keyToCloseables</code> 会被有意保留。这可以防止在清除后代码访问 <code>viewModelScope</code> 等资源时意外地重新创建它们。</p>
<h3 data-id="heading-25">清除后保护</h3>
<p>在清除 ViewModel 后添加可关闭对象会立即将其关闭，从而防止在协程仍在运行时 ViewModel 被清除时出现资源泄漏：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">addCloseable</span><span class="hljs-params">(key: <span class="hljs-type">String</span>, closeable: <span class="hljs-type">AutoCloseable</span>)</span></span> {
    <span class="hljs-keyword">if</span> (isCleared) {
        closeWithRuntimeException(closeable)
        <span class="hljs-keyword">return</span>
    }

    <span class="hljs-keyword">val</span> oldCloseable = synchronized(lock) { keyToCloseables.put(key, closeable) }
    closeWithRuntimeException(oldCloseable)
}
</code></pre>
<p>此外，请注意，添加键值可关闭对象时，任何具有相同键值的现有可关闭对象都会自动关闭，从而支持替换模式。</p>
<h3 data-id="heading-26">用于模拟的可空实现</h3>
<p>JVM 实现提供了一个可空的 <code>impl</code> 对象，以支持模拟框架。当你模拟 ViewModel 时，模拟对象不会调用真正的构造函数，因此 <code>impl</code> 对象永远不会被初始化。如果没有可空类型和安全调用（<code>impl?.clear()</code>），测试会因 <code>NullPointerException</code> 而崩溃：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">actual</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewModel</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> impl: ViewModelImpl?

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">actual</span> <span class="hljs-keyword">constructor</span>() {
        impl = ViewModelImpl()
    }

    <span class="hljs-meta">@MainThread</span>
    <span class="hljs-keyword">internal</span> <span class="hljs-keyword">actual</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span></span> {
        impl?.clear()
        onCleared()
    }
}
</code></pre>
<h2 data-id="heading-27">viewModelScope：协程集成</h2>
<p><code>viewModelScope</code> 扩展属性提供了一个生命周期感知的 <code>CoroutineScope</code>，当 ViewModel 被清除时，该作用域会自动取消：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">val</span> ViewModel.viewModelScope: CoroutineScope
    <span class="hljs-keyword">get</span>() =
        synchronized(VIEW_MODEL_SCOPE_LOCK) {
            getCloseable(VIEW_MODEL_SCOPE_KEY)
                ?: createViewModelScope().also { scope -&gt;
                    addCloseable(VIEW_MODEL_SCOPE_KEY, scope)
                }
        }
</code></pre>
<h3 data-id="heading-28">使用键控存储的延迟创建</h3>
<p>作用域在首次访问时延迟创建，并使用键控可关闭机制进行存储。键名故意设置得非常详细，以避免与用户自定义的键发生冲突：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> VIEW_MODEL_SCOPE_KEY =
    <span class="hljs-string">"androidx.lifecycle.viewmodel.internal.ViewModelCoroutineScope.JOB_KEY"</span>
</code></pre>
<h3 data-id="heading-29">CloseableCoroutineScope</h3>
<p>协程和可关闭系统之间的桥梁是 <code>CloseableCoroutineScope</code>，它同时实现了 <code>CoroutineScope</code> 和 <code>AutoCloseable</code> 接口。在 ViewModel 清空期间调用 <code>close()</code> 时，所有正在运行的协程都会被取消：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CloseableCoroutineScope</span>(<span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> coroutineContext: CoroutineContext) :
    AutoCloseable, CoroutineScope {

    <span class="hljs-keyword">constructor</span>(coroutineScope: CoroutineScope) : <span class="hljs-keyword">this</span>(coroutineScope.coroutineContext)

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">close</span><span class="hljs-params">()</span></span> = coroutineContext.cancel()
}
</code></pre>
<h3 data-id="heading-30">平台感知调度器选择</h3>
<p>作为 Kotlin 多平台库，ViewModel 在没有主线程概念的平台上也能工作，因为它会回退到 <code>EmptyCoroutineContext</code>。请注意，这里使用的是 <code>Dispatchers.Main.immediate</code> 而不是 <code>Dispatchers.Main</code>，这样可以避免在已经在主线程上运行时进行不必要的重新调度：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">internal</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createViewModelScope</span><span class="hljs-params">()</span></span>: CloseableCoroutineScope {
    <span class="hljs-keyword">val</span> dispatcher =
        <span class="hljs-keyword">try</span> {
            Dispatchers.Main.immediate
        } <span class="hljs-keyword">catch</span> (_: NotImplementedError) {
            <span class="hljs-comment">// In Native environments where `Dispatchers.Main` might not exist (e.g., Linux)</span>
            EmptyCoroutineContext
        } <span class="hljs-keyword">catch</span> (_: IllegalStateException) {
            <span class="hljs-comment">// In JVM Desktop environments where `Dispatchers.Main` might not exist (e.g., Swing)</span>
            EmptyCoroutineContext
        }
    <span class="hljs-keyword">return</span> CloseableCoroutineScope(coroutineContext = dispatcher + SupervisorJob())
}
</code></pre>
<h3 data-id="heading-31">SupervisorJob 实现子协程独立失败</h3>
<p>该作用域使用 <code>SupervisorJob()</code>，允许子协程独立失败。而使用普通的 <code>Job</code> 时，如果一个子协程失败，它会取消所有同级协程。这种设计符合 UI 应用程序的预期，即失败的网络请求不应该取消正在进行的数据库操作。</p>
<h2 data-id="heading-32">ViewModelLazy：Kotlin 属性委托</h2>
<p><code>viewModels()</code> 委托使用了 <code>ViewModelLazy</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewModelLazy</span>&lt;<span class="hljs-type">VM : ViewModel</span>&gt;
<span class="hljs-meta">@JvmOverloads</span>
<span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> viewModelClass: KClass&lt;VM&gt;,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> storeProducer: () -&gt; ViewModelStore,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> factoryProducer: () -&gt; ViewModelProvider.Factory,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> extrasProducer: () -&gt; CreationExtras = { CreationExtras.Empty },
) : Lazy&lt;VM&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> cached: VM? = <span class="hljs-literal">null</span>

    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> value: VM
        <span class="hljs-keyword">get</span>() {
            <span class="hljs-keyword">val</span> viewModel = cached
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (viewModel == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">val</span> store = storeProducer()
                <span class="hljs-keyword">val</span> factory = factoryProducer()
                <span class="hljs-keyword">val</span> extras = extrasProducer()
                ViewModelProvider.create(store, factory, extras).<span class="hljs-keyword">get</span>(viewModelClass).also {
                    cached = it
                }
            } <span class="hljs-keyword">else</span> {
                viewModel
            }
        }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isInitialized</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> = cached != <span class="hljs-literal">null</span>
}
</code></pre>
<h3 data-id="heading-33">双重缓存架构</h3>
<p>惰性委托会在首次访问后将 ViewModel 引用缓存到本地。这是一种双重缓存模式：</p>
<ol>
<li><strong>ViewModelStore 缓存</strong>：规范缓存，不受配置更改的影响。</li>
<li><strong>ViewModelLazy 缓存</strong>：本地缓存，用于避免重复创建 ViewModelProvider。</li>
</ol>
<p>本地缓存是一种优化，创建 <code>ViewModelProvider</code> 并查找 ViewModel 的开销很小，但缓存可以避免后续访问中哪怕是这种微小的开销。</p>
<h3 data-id="heading-34">用于延迟访问的 Lambda 生产者</h3>
<p>所有三个生产者（store、factory、extras）都是 Lambda 表达式，允许延迟求值：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> viewModel <span class="hljs-keyword">by</span> viewModels { MyViewModelFactory() }
<span class="hljs-comment">// Factory is only created when viewModel is first accessed</span>
</code></pre>
<p>这对于 Fragment 尤其重要，因为在属性初始化期间 Activity 可能不可用。</p>
<h2 data-id="heading-35">Android 特有：AGP 代码脱糖兼容性</h2>
<p>Android 有一个特殊的兼容层，用于处理混合使用针对不同 ViewModel 版本编译的库时出现的 AGP（Android Gradle 插件）代码脱糖问题：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">actual</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;VM : ViewModel&gt;</span> <span class="hljs-title">createViewModel</span><span class="hljs-params">(
    factory: <span class="hljs-type">ViewModelProvider</span>.<span class="hljs-type">Factory</span>,
    modelClass: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">VM</span>&gt;,
    extras: <span class="hljs-type">CreationExtras</span>,
)</span></span>: VM {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">try</span> {
        factory.create(modelClass, extras)
    } <span class="hljs-keyword">catch</span> (e: AbstractMethodError) {
        <span class="hljs-keyword">try</span> {
            factory.create(modelClass.java, extras)
        } <span class="hljs-keyword">catch</span> (e: AbstractMethodError) {
            factory.create(modelClass.java)
        }
    }
}
</code></pre>
<p>这一系列 try-catch 代码块用于处理使用旧版本 ViewModel 编译的工厂缺少较新版本的 <code>create</code> 方法的情况。当运行时调用编译后的字节码中不存在的方法时，就会出现 <code>AbstractMethodError</code> 错误，这种情况通常发生在旧工厂只有 <code>create(Class&lt;T&gt;)</code> 方法，而运行时需要 <code>create(Class&lt;T&gt;, CreationExtras)</code> 方法时。这种防御性级联机制能够优雅地降级到方法变体，确保 ViewModel 创建功能不受库版本不匹配的影响。</p>
<h2 data-id="heading-36">性能特性和设计权衡</h2>
<p>ViewModel 系统在设计上做出了一些权衡，以平衡正确性、灵活性和性能。</p>
<h3 data-id="heading-37">同步开销</h3>
<p><code>ViewModelProviderImpl</code> 和 <code>ViewModelImpl</code> 都使用同步块来实现线程安全访问：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">synchronized(lock) {
    <span class="hljs-keyword">val</span> viewModel = store[key]
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>由于 ViewModel 访问通常发生在主线程上，临界区很短（简单的 map 操作），并且锁争用很少发生，因此这种同步开销非常小。该设计优先考虑正确性而非微优化，因为罕见的竞态条件代价远高于几乎察觉不到的同步开销。</p>
<h3 data-id="heading-38">反射开销</h3>
<p><code>NewInstanceFactory</code> 使用 Java 反射来动态实例化 ViewModel 类：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">modelClass.getDeclaredConstructor().newInstance()
</code></pre>
<p>由于运行时类型检查和动态方法解析，反射比直接构造函数调用要慢。但是，这种开销可以忽略不计，因为 ViewModel 的创建频率很低（每个生命周期一次），而且无需编译时信息即可实例化任何 ViewModel 子类的灵活性远远超过了这点微小的开销。</p>
<h3 data-id="heading-39">基于映射的存储</h3>
<p>使用 <code>MutableMap</code> 作为 ViewModelStore 可以提供 O(1) 的查找时间，但清除操作的时间复杂度为 O(n)，因为每个 ViewModel 都必须单独清除：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">for</span> (vm <span class="hljs-keyword">in</span> map.values) {
        vm.clear()
    }
    map.clear()
}
</code></pre>
<p>由于 ViewModelStore 通常只包含 1-5 个 ViewModel，因此线性时间的清除操作实际上并无影响。使用标准 HashMap 的简洁性使得代码更易于理解和维护，对于这种有限的用例而言，其价值远大于理论上的优化。</p>
<h3 data-id="heading-40">用于模拟的可空实现</h3>
<p>JVM ViewModel 中的可空 <code>impl</code> 会在每个操作中添加空值检查：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">impl?.clear()
</code></pre>
<p>这种微小的开销可以实现正确的模拟行为。当模拟框架创建 ViewModel 模拟对象时，它们会绕过真正的构造函数，导致 <code>impl</code> 未初始化。可空类型可以防止测试中出现 <code>NullPointerException</code>，这是一个值得的权衡。</p>
<h2 data-id="heading-41">实际应用模式：理解 ViewModel 的使用</h2>
<p>理解其内部机制有助于你在实际应用中识别模式和反模式。</p>
<h3 data-id="heading-42">模式 1：作用域 ViewModel 共享</h3>
<p>可以使用 Activity 的 ViewModelStore 而不是每个 Fragment 自己的存储来在 Fragment 之间共享 ViewModel：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FragmentA</span> : <span class="hljs-type">Fragment</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> sharedViewModel: SharedViewModel <span class="hljs-keyword">by</span> activityViewModels()
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">FragmentB</span> : <span class="hljs-type">Fragment</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> sharedViewModel: SharedViewModel <span class="hljs-keyword">by</span> activityViewModels()
}
</code></pre>
<p>两个 Fragment 会获得相同的 ViewModel 实例，因为它们使用相同的 ViewModelStore（Activity 的）。这使得兄弟 Fragment 可以通过共享状态进行通信。内部机制：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// activityViewModels() uses:</span>
ViewModelProvider(
    store = requireActivity().viewModelStore,  <span class="hljs-comment">// Same store for both fragments</span>
    factory = ...,
)
</code></pre>
<h3 data-id="heading-43">模式 2：自定义键用于多个实例</h3>
<p>你可以通过提供自定义键来拥有同一个 ViewModel 类的多个实例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> viewModel1: MyViewModel = viewModelProvider[<span class="hljs-string">"user_1"</span>, MyViewModel::<span class="hljs-keyword">class</span>]
<span class="hljs-keyword">val</span> viewModel2: MyViewModel = viewModelProvider[<span class="hljs-string">"user_2"</span>, MyViewModel::<span class="hljs-keyword">class</span>]
</code></pre>
<p>该键包含自定义字符串，从而在 ViewModelStore 中创建单独的缓存条目。这对于同时管理多个用户配置文件或聊天对话等场景非常有用。</p>
<h3 data-id="heading-44">模式 3：使用 CreationExtras 进行工厂注入</h3>
<p>现代工厂是无状态的，在创建时通过 CreationExtras 接收所有依赖项：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyViewModelFactory</span> : <span class="hljs-type">ViewModelProvider.Factory</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : ViewModel&gt;</span> <span class="hljs-title">create</span><span class="hljs-params">(modelClass: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">T</span>&gt;, extras: <span class="hljs-type">CreationExtras</span>)</span></span>: T {
        <span class="hljs-keyword">val</span> repository = extras[REPOSITORY_KEY]!!
        <span class="hljs-keyword">val</span> userId = extras[USER_ID_KEY]!!
        <span class="hljs-keyword">return</span> MyViewModel(repository, userId) <span class="hljs-keyword">as</span> T
    }
}
</code></pre>
<p>这使得工厂可以作为单例，同时每次调用配置都不同，从而避免为每个具有不同依赖项的 ViewModel 创建新的工厂实例。</p>
<h3 data-id="heading-45">反模式：在 ViewModel 中访问 Context</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Bad: Leaks Activity context</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyViewModel</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> context: Context) : ViewModel()

<span class="hljs-comment">// Good: Use Application context via AndroidViewModel</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyViewModel</span>(application: Application) : AndroidViewModel(application)

<span class="hljs-comment">// Better: Don't hold Context at all, pass it to methods</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyViewModel</span> : <span class="hljs-type">ViewModel</span>() {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadData</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span> { ... }
}
</code></pre>
<p>第一种方法可能会导致 Activity 泄漏，因为 ViewModel 在持有已销毁 Activity 的引用时，配置更改仍然存在。请使用 <code>AndroidViewModel</code> 来获取 Application 上下文，或者在需要时将 Context 传递给各个方法。</p>
<h3 data-id="heading-46">反模式：在 onCleared 中阻塞</h3>
<p>你知道 <code>onCleared()</code> 是在主线程上调用的吗？诸如网络关闭或数据库清理之类的阻塞操作应该使用协程的 <code>addCloseable</code> 方法卸载到后台线程：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Bad: Blocking call in onCleared</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCleared</span><span class="hljs-params">()</span></span> {
    networkClient.shutdown()  <span class="hljs-comment">// May block the main thread until completing the shutdown process!</span>
}

<span class="hljs-comment">// Good: Use addCloseable for managed cleanup</span>
<span class="hljs-keyword">init</span> {
    addCloseable {
        scope.launch { networkClient.shutdown() }
    }
}
</code></pre>
<h2 data-id="heading-47">结论</h2>
<p>Jetpack ViewModel 的内部机制展现了一个精心设计的生命周期感知状态管理系统。ViewModelStore 通过保留映射提供简单而有效的缓存，而 ViewModelProvider 则通过线程安全的访问和灵活的工厂支持来协调创建过程。CreationExtras 通过外部化配置来实现无状态工厂，而 AutoCloseable 集成则确保了资源的正确清理。</p>
<p>多平台架构将通用逻辑提取到内部实现类中，使该库能够支持 JVM、Android、iOS 和其他平台。viewModelScope 集成通过 closeable 机制提供自动协程取消功能，并为没有主线程的环境提供平台感知的调度器选择。</p>
<p>如果你想掌握最新的技能、新闻、技术文章、面试题和实用代码技巧，请查看<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdoveletter%2F" target="_blank" title="https://github.com/doveletter/" ref="nofollow noopener noreferrer">Dove Letter</a>。想要更深入地了解面试准备，千万不要错过终极 Android 面试指南：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.android.skydoves.me%2F" target="_blank" title="https://www.android.skydoves.me/" ref="nofollow noopener noreferrer">Manifest Android Interview</a>。</p>
<blockquote>
<p>欢迎搜索并关注 <em>公众号<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fqrcode%3Fscene%3D10000004%26size%3D512%26__biz%3DMzU1MDg0NDczNA%3D%3D%26mid%3D2247484417%26idx%3D1%26sn%3D60c15f0d3c4be75e37748c2472a74102" target="_blank" title="https://mp.weixin.qq.com/mp/qrcode?scene=10000004&amp;size=512&amp;__biz=MzU1MDg0NDczNA==&amp;mid=2247484417&amp;idx=1&amp;sn=60c15f0d3c4be75e37748c2472a74102" ref="nofollow noopener noreferrer">「稀有猿诉」</a></em> 获取更多的优质文章！</p>
<p>保护原创，请勿转载！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI：我裂开了！现在的大模型评测究竟有多变态？]]></title>    <link>https://juejin.cn/post/7587604932058349619</link>    <guid>https://juejin.cn/post/7587604932058349619</guid>    <pubDate>2025-12-25T12:26:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587604932058349619" data-draft-id="7587604932058333235" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI：我裂开了！现在的大模型评测究竟有多变态？"/> <meta itemprop="keywords" content="前端,后端,人工智能"/> <meta itemprop="datePublished" content="2025-12-25T12:26:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ConardLi"/> <meta itemprop="url" content="https://juejin.cn/user/3949101466785709"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI：我裂开了！现在的大模型评测究竟有多变态？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3949101466785709/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ConardLi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T12:26:49.000Z" title="Thu Dec 25 2025 12:26:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读42分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文视频：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1HnB7BjEAN%2F" target="_blank" title="https://www.bilibili.com/video/BV1HnB7BjEAN/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1Hn…</a></p>
<hr/>
<p>年底的 AI 圈子很热闹，可以说是神仙打架：<code>Gemini 3.0</code>、<code>Claude Opus 4.5</code>、<code>GPT 5.2</code> ...</p>
<p>这三大全球最顶级的模型，<strong>几乎在同一时间甩出了自己的“王炸”。</strong></p>
<p>今天这家说自己代码能力“碾压”对手，明天那家说自己逻辑推理“遥遥领先”。大家都在发布会上晒出一堆复杂的图表，异口同声地喊着自己是世界第一。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35906385df4842b795fbdb57480351d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=7WyydsVBjKf6C0B0Gu4MkiKajJs%3D" alt="" loading="lazy"/></p>
<p><strong>但作为围观群众或者开发者，我们最困惑的问题来了：</strong></p>
<p><strong>你们到底是怎么比出来的？谁才是真强，谁是在吹牛？</strong></p>
<p>这就涉及到了大模型领域最核心、也最硬核的环节 — <strong>评估（Evaluation/Benchmark）</strong>。</p>
<p>大家好，欢迎来到 code秘密花园，我是花园老师（ConardLi）。</p>
<p>如果不搞清楚大模型的评估，这些大模型对我们来说就是一个个看不透的黑盒。</p>
<p>今天这篇文章，我们一起来拆解一下：那些顶级大模型到底在 PK 什么？它们又是怎么“赶考”的？</p>
<blockquote>
<p>注意：本期主要介绍通用大模型的评估，私有模型评估和微调后模型的评估将在后续教程中介绍。</p>
</blockquote>
<h2 data-id="heading-0">第一部分：了解大模型评估</h2>
<p>在看具体的榜单之前，我们先要把大模型评估的底层逻辑理顺。</p>
<h3 data-id="heading-1">1. 为啥要做评估？（Why）</h3>
<p>想象一下，如果没有标准化的考试，我们怎么知道一个学生学得怎么样？是让他即兴来一段 freestyle，还是解一道老师自己都可能做错的奥数题？这两种方式都有用，但都不够全面和公平。大模型的评估也是一个道理。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e43e8319e514465af9e6277f7851824~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=QFnm%2FgGFjC5K7mRLRjcm23lGjD8%3D" alt="" loading="lazy"/></p>
<p>当我们谈论哪个大模型更强时，如果只凭感觉说“这个好像聪明点”“那个写代码更快”，这种评价是模糊且主观的。顶级玩家之间的差距往往在毫厘之间，必须依赖一套客观、可复现、多维度的“尺子”来衡量，才能知道它们到底强在哪，弱在哪，以及未来的路该怎么走。</p>
<ul>
<li>
<p><strong>对比核心能力</strong>：这是最直观的目的。通过在标准化的测试集上运行，我们可以看到不同模型在知识、推理、编程、语言等维度的具体表现，从而了解它们的相对强弱。</p>
</li>
<li>
<p><strong>指导用户选择</strong>：市面上模型几百个，哪个写代码好？哪个算数准？哪个不乱说话？我们需要量化的分数来决定把钱付给谁。</p>
</li>
<li>
<p><strong>评估训练成果：</strong> 你改了模型的一个参数，或者喂了新数据，模型是变聪明了还是变笨了？之前的 bug 修好了，会不会又引入了新 bug？没有评估，模型迭代就是盲人摸象。</p>
</li>
<li>
<p><strong>指引技术迭代</strong>：没有度量，就没有进步。研究者通过标准化的“考试”发现模型的短板，比如逻辑推理不行，或是代码能力有待加强，从而明确下一步优化的方向。</p>
</li>
</ul>
<h3 data-id="heading-2">2. 该评估什么？（What）</h3>
<p>大模型的“强”，不是一个维度。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b667613f88947ddabf41ad752c8d9cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=Z2%2B%2FekUUr9OKFvrG1b3Trti8qto%3D" alt="" loading="lazy"/></p>
<p>以前大家觉得 AI 能聊天就行， 现在评估的维度非常细，简单来说有下面几种：</p>
<ul>
<li>
<p><strong>基础能力：</strong> 比如语言理解、知识储备、翻译。</p>
</li>
<li>
<p><strong>推理能力：</strong> 数学题能不能做对，逻辑陷阱能不能识破。</p>
</li>
<li>
<p><strong>垂直能力：</strong> 比如写代码、看医疗报告、写法律文书。</p>
</li>
<li>
<p><strong>应用与对齐能力：</strong> 比如包括遵循指令、工具调用，这直接关系到模型在真实场景中的实用性。</p>
</li>
<li>
<p><strong>安全性与对齐：</strong> 会不会教人造炸弹？会不会有种族歧视？会不会胡说八道（幻觉）？</p>
</li>
</ul>
<h3 data-id="heading-3">3. 怎么评估？（How）</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96edeb81c01d46b99c66028b0f4ce947~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=OblXNMPCtX0yF8QKe7T%2FQqwRX%2F4%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p><strong>固定答案评估</strong>：这是最传统也最常见的方式。模型需要在一系列固定的、标准化的“考题”上作答（通常是选择题或有标准答案的填空题），然后由程序自动计算分数。比如题目是“《红楼梦》作者是谁？A.李白 B.曹雪芹”。模型输出B，脚本自动判分。这是最快、最便宜的方法。</p>
</li>
<li>
<p><strong>基于模型的评估</strong>：让一个能力更强、更受信任的模型作为“裁判”，去评判其他模型的回答质量。比如针对作文题（比如“写首诗”），没有标准答案。然后请一个更强的模型当老师，给小模型的作文打分。虽然有点“套娃”，但这是目前评估长文本效率最高的方法。</p>
</li>
<li>
<p><strong>人类偏好评估</strong>：通过收集大量用户的真实反馈来对模型进行排序。这种方法能更好地反映模型的真实对话质量和用户体验，但成本高、速度慢，且评估结果可能受用户主观偏好和提问质量的影响。</p>
</li>
</ul>
<h2 data-id="heading-4">第二部分：大模型评估的 Benchmark</h2>
<p>在第一部分我们初步了解了大模型的评估。但落实到操作层面，我们拿什么去评估？</p>
<p>这时候就得请出大模型领域的“标准化试卷” —— <strong>Benchmark（基准测试）</strong>。</p>
<h3 data-id="heading-5">1. 基准测试到底是个啥？</h3>
<p>简单来说，<strong>Benchmark 就是一套标准化的“考题集”加上一套严格的“判卷标准”。</strong></p>
<p>你可能会听到 MMLU、GSM8K、HumanEval 这些看起来很复杂的缩写，其实它们本质上就是不同科目的“考卷”。</p>
<ul>
<li>有的考卷专门考<strong>数学</strong>（比如 GSM8K）；</li>
<li>有的考卷专门考<strong>写代码</strong>（比如 HumanEval）；</li>
<li>有的则是<strong>综合大联考</strong>，涵盖历史、物理、法律等几十个学科（比如 MMLU）。</li>
</ul>
<p>由于大模型能干的事儿太多了，从写诗到写代码无所不包，所以我们很难用一道题衡量它的好坏。Benchmark 的作用，就是把这些模糊的能力，具象化成成千上万道具体的题目，用来给模型打分。</p>
<p>在 Easy AI（<code>https://github.com/ConardLi/easy-learn-ai</code>） 的 AI 评估模块收集了当下最主流的大模型测试基准，每个基准都带有 描述、样本量、协议、论文地址、数据集地址、代码库地址等信息，可以方便大家快速检索到需要某个领域的 LLM 评估基准。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3accd4c1f994aa59d8b0ff9761b4b17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=t86rKolUuCXoIkNfsiGJH6bRRuw%3D" alt="https://mmh1.top/#/ai-benchmark" loading="lazy"/></p>
<h3 data-id="heading-6">2. 既然有了评估方法，为啥还要搞“基准测试”？</h3>
<p>你可能会问，我自己随便问几个问题测测不行吗？为什么要用这些公开的 Benchmark？</p>
<p>这里核心的逻辑只有两个字：<strong>公平</strong>。</p>
<ul>
<li>
<p><strong>统一的“度量衡”</strong>：
如果 GPT 在做数学题，而 Claude 在写代码，它俩就没法比。Benchmark 强行把大家拉到了同一条起跑线上。大家都做同一套题，都不许看答案，考出来的分数才具有可比性。这就叫 “Apples-to-apples comparison”（同类比较）。</p>
</li>
<li>
<p><strong>为了“复现”和“验证”</strong>：
现在很多模型发布时都吹嘘自己是世界第一。如果他们只是在自己家里关门测试，谁知道是不是作弊了？
使用公开的 Benchmark，意味着任何人（包括作为开发者的我们）都可以拿这套题去测一遍。如果模型厂商说考了 90 分，而社区测出来只有 60 分，那这个模型的水分瞬间就会被挤干。</p>
</li>
<li>
<p><strong>指引选型</strong>：
对于我们要用模型干活的人来说，Benchmark 是最好的选购指南。你想做一个客服机器人？那就去看对话类的榜单；你想搞个自动写代码工具？那就专门去看代码类的评分。这比看广告准得多。</p>
</li>
</ul>
<h3 data-id="heading-7">3. 一个基准测试是如何工作的？</h3>
<p>虽然不同榜单看起来五花八门，但它们背后的运作流程其实非常直白，基本都逃不过这三步：</p>
<p><strong>第一步：做题（输入测试集）</strong>
Benchmark 会准备好一个庞大的题库。
如果是考选择题（比如 MMLU），它会把题目扔给大模型，让模型输出 A、B、C 或 D。
如果是考代码（比如 HumanEval），它会给模型一段需求描述（比如“写一个函数计算斐波那契数列”），让模型把代码补全。
在这个过程中，模型是<strong>看不到正确答案</strong>的。</p>
<p><strong>第二步：判卷（评分与对比）</strong>
模型答完题后，就要开始打分了。这里分几种情况：</p>
<ul>
<li><strong>对答案（精确匹配）</strong>：这是最简单的。对于选择题或数学计算题，只要模型输出的选项或数字和标准答案（Ground Truth）一样，就算对，否则算错。最后算一个正确率百分比。</li>
<li><strong>跑用例（代码测试）</strong>：对于代码生成，光看代码长得像不一样没用。评估程序会真的去运行这段代码，如果能通过所有的测试用例（Unit Tests），才算得分。</li>
<li><strong>找裁判（语义相似度/AI 打分）</strong>：对于翻译或写作文这种没有标准答案的题目，通常会计算模型生成的文本和参考文本有多像（重合度），或者直接让一个更强的 GPT-4 当“阅卷老师”来打分。</li>
</ul>
<p><strong>第三步：排座次（榜单 Leaderboard）</strong>
分打出来了，最后一步就是排名。
你会看到像 Hugging Face Open LLM Leaderboard 或者 Chatbot Arena 这种榜单。它们把各大模型在不同 Benchmark 上的分数汇总起来，从高到低排个序。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3dbda4cd2dc8408f8dc73b393ba2583d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=AlXZZPhMBuWazLKrd6FEzbl5FBE%3D" alt="https://lmarena.ai/zh/leaderboard" loading="lazy"/></p>
<p>这就是为什么每当新模型发布，大家第一件事就是冲去看榜单——因为这是目前唯一能让我们一眼看清模型“江湖地位”的方式。</p>
<h2 data-id="heading-8">第三部分：顶级大模型都在比什么？</h2>
<h3 data-id="heading-9">通用学科知识（Knowledge）</h3>
<p>对于大模型来说，学科知识的解答，是最简单的任务了。</p>
<p>如果一个模型连基本的历史常识不知道，或者简单的物理定律都搞错，那它的底座能力肯定是不行的。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f147d2a903c941c9b9f99d59e143d209~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=nzA%2F%2Bt1Z2U8i2ZezIn1tYtYAm34%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-10">(1) MMLU：大模型界的“经典试卷”</h4>
<p>只要提到大模型的基准测试，就不得不提 MMLU，因为它实在是太经典了。</p>
<p>MMLU 全称： Massive Multitask Language Understanding（大规模多任务语言理解）</p>
<p>它是目前最流行、最权威的学科知识类测试基准。你可以把它理解为大模型的 <strong>“综合百科全书考试”</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ff66635f3a243a89444d55cdcf14a8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=wnYojBjFL9mijIxHO7B5CXMQFxE%3D" alt="" loading="lazy"/></p>
<p>MMLU 包含了 <strong>57 个学科</strong>，跨度极大：从初等数学、美国历史、计算机科学，一直到法律、医学、伦理学。难度覆盖了从高中水平到专家水平。</p>
<p>MMLU 的题目全是 <strong>4 选 1 的单项选择题</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7f4adef5fed48248358bc4b98f9f6be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=VN6m35EFQGjCwKf2HFFix8acrTI%3D" alt="" loading="lazy"/></p>
<p>得分方式很简单，答对一题得一分。</p>
<p>在早期（GPT4 时期），主流大模型发布的时候评测的第一项基本都是 MMLU：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b67edd7adf2451889c879fe876c21b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=XlGyXSTbUtbJyKZipXF16hGqyyw%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-11">(2) MMLU-Pro：MMLU 的进阶版</h4>
<p>而现在的模型评测榜单中，我们基本上看不到 MMLU 的身影了，因为现在顶级模型在 MMLU 上的得分基本上都是满分了，已经拉不开差距了。</p>
<p>所以在它基础上的升级版本 MMLU-Pro 来了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d1fb7eb99034690a70a2f65cfd1c9e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=MUxysQpk4L9%2FLuFrpS0tjARFmFE%3D" alt="" loading="lazy"/></p>
<p>MMLU-Pro 具体做了哪些升级呢？</p>
<ol>
<li><strong>选项变多了：</strong> 从 4 选 1 变成了 <strong>10 选 1</strong>。这下模型想靠瞎蒙得分基本不可能了。</li>
<li><strong>难度加大了：</strong> 删掉了一些过于简单的送分题，增加了一些需要复杂推理的题目。</li>
<li><strong>考查过程：</strong> 以前只要输出 A 就行，现在通常需要模型配合 CoT（思维链），也就是要把推理过程写出来，才能做对。</li>
</ol>
<p>题目示例：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/465100a9ab9b4d4f93258571440796a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=6Q7xg3Pys5FkDrhVjKVbxZZyPMA%3D" alt="" loading="lazy"/></p>
<p>可以看到，不仅包括了 10 个选项，答案中还附带了推理过程（COT）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f778ffe9cd24980ab0d8fdf27fa513b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=Wjzi1q%2F%2FXcyXjEqO9Pgg%2F93gTZI%3D" alt="https://artificialanalysis.ai/evaluations/mmlu-pro" loading="lazy"/></p>
<p>目前，最强的顶级模型在 MMLU Pro 的跑分在 80-90 分。</p>
<h4 data-id="heading-12">(3) MMMLU：不仅要懂，还要“多语言”懂</h4>
<p>而在 <code>GPT 5.2</code>、<code>Gemini 3.0</code>、<code>Claude 4.5</code> 的发布公告中，我们都会看到一个 <code>MMMLU</code> 的基准：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e363baea45974a3eb6d9ca303abf5ab2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=TUU2vHgaFekaFsAHv0XyUTWggPI%3D" alt="" loading="lazy"/></p>
<p>它也就是是 MMLU 的 <strong>“国际版”</strong>。</p>
<p>很多模型有个毛病：英文问它，它对答如流；换成中文、法文或阿拉伯文问同一个问题，它就变笨了或者开始胡说八道。</p>
<p><strong>MMMLU</strong> 就是为了把 MMLU 的题目<strong>翻译成多种语言</strong>（通常包含 14 种或更多主要语言），用来测试模型的<strong>跨语言能力</strong>。</p>
<p>这非常考验模型的“内功”。</p>
<ul>
<li>如果一个模型只是死记硬背了英文语料，那它做 MMMLU 的非英文题目时就会露馅。</li>
<li>只有当模型真正<strong>理解</strong>了知识背后的逻辑，并且打通了不同语言之间的隔阂，它才能在 MMMLU 上拿高分。</li>
</ul>
<p>我们可以看到，<code>MMMLU</code> 数据集中包含了中文题目：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1752b6a097fd4dc2975150e9de08895f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=FUi%2Bwd7H9UouUaLnnhOEAqLqE6A%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-13">推理能力（Reasoning）</h3>
<p>如果说“通用学科知识”是考大模型的**“记忆力”<strong>（看它背了多少书），那么“推理能力”考的就是它的</strong>“脑力”**（看它聪不聪明，逻辑转不转得过来）。</p>
<p>这部分非常关键，因为现在的模型光靠 “背书” 已经不够了，我们更看重它能不能解决从未见过的复杂难题。</p>
<p>“推理能力” 类基准通常想回答一个问题：模型能不能在“不是直接背答案/检索答案”的情况下，把线索串起来得到正确结论。它覆盖的推理类型很杂，但常见目标包括：</p>
<ul>
<li>常识与情境推断：从一段事件/步骤描述中推断“最合理的下一步/后果”</li>
<li>跨句/跨段一致性：输出是否连贯、是否违背物理常识/人类行为常识</li>
<li>高阶学术推理：在科学问题里做多步推导、排除干扰选项（即使允许上网也很难直接搜到答案）</li>
<li>“知道自己不知道”：不仅要答对，还要在答错时降低自信（校准/幻觉问题）</li>
</ul>
<blockquote>
<p>比如：“把大象装进冰箱分几步？”或者“如果 A 在 B 的左边，B 在 C 的左边，那 A 在 C 的哪边？”
这种题，光靠死记硬背是不行的，模型必须具备理解因果关系、空间关系以及多步推导的能力。</p>
</blockquote>
<p>这里我们介绍三个极具代表性的基准测试，难度从“普通人”一直拉到了“人类天花板”：<strong>HellaSwag</strong>、<strong>GPQA Diamond</strong> 和 <strong>Humanity's Last Exam (HLE)</strong> 。</p>
<h4 data-id="heading-14">(1) HellaSwag：能不能听懂“人话”的常识测试</h4>
<p>我们先来看一个入门级的：</p>
<p><code>HellaSwag</code> 全称：<code>Harder Endings, Longer contexts, and Low-shot Activities for Situations With Adversarial Generations</code>（中文翻译为：“对抗生成场景下的高难度任务收尾、长上下文处理与少样本任务适配”，名字很长，不用记，叫它 HellaSwag 就行）</p>
<p>简单来说，它考的是 <strong>“补全句子”</strong> ，但补全的不是古诗词，而是<strong>生活常识</strong>。它专门设计了一些对人类来说显而易见，但对早期的 AI 来说极容易掉坑里的题目。</p>
<p>它会给模型描述一个生活场景（可能来自视频或文字描述），然后给 4 个结局，让模型选一个最符合常识的。以下两道题是 <code>HellaSwag</code> 论文中的示例：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8fde436871984a9aae128b5bb5997f65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=Kk%2Bo%2FZLpmGAbQJlBpMtbO%2FR92lA%3D" alt="" loading="lazy"/></p>
<p>不过，现在这种级别的推理测试对于顶级模型已经是小菜一碟了，早在 <code>GPT-4</code> 发布时就已经可以拿到 <code>95%</code> 以上的通过率了。</p>
<h4 data-id="heading-15">(2) GPQA Diamond：研究生的“噩梦”</h4>
<p>下面进入正题，我们来看 <code>GPT 5.2</code> 和 <code>Gemini 3.0</code> 的发布公告中都出现的一个基准：<code>GPQA Diamond</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db9f7aa9e2274854a49710b94aa71500~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=RFim5AIaPYGsuEOnNR4kUPtfLCU%3D" alt="" loading="lazy"/></p>
<p>GPQA 全称： A Graduate-Level Google-Proof Q&amp;A Benchmark（研究生级别的防 Google 问答测试）</p>
<p>两个关键词：<strong>研究生水平</strong> + <strong>防 Google（Google-Proof）</strong>。</p>
<p>这里面的题目，由生物学、物理学、化学等领域的 <strong>博士专家</strong> 编写。最变态的是，这些题目被设计成 <strong>“即使你把题目复制到 Google 搜索，也搜不到直接答案”</strong> 。你必须真正理解这个领域的原理，经过复杂的推导才能做出来。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/502936a48adf4fb4921c0b07e60a9873~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=fmAj9Gpr9r05ul6vNora02wt4gI%3D" alt="https://arxiv.org/pdf/2311.12022" loading="lazy"/></p>
<p>而 <strong>Diamond</strong> 是 GPQA 的一个子集，这部分题目会经过更严格的筛选，要求题目在专家审阅下答案更可靠、并且对非本领域验证者更具难度（“多数非专家答错”）。</p>
<p>GPQA 的题目基本都是四选一的选择题，大家可以感受下题目难度：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c9e08277c0c48a8929746c84dea7962~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=fQ7Bs6CUPbiBb%2BWRqH2FZQciOsE%3D" alt="" loading="lazy"/></p>
<p>如果模型跑分已经达到了 90 分以上，意味着它在很多专业领域的判断力已经超过了普通人类专家。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed897985e7a34e1587ed5be52282049d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=CSCNo9OdkFiF7AQYYCkFu%2F5VYfc%3D" alt="https://epoch.ai/benchmarks/gpqa-diamond" loading="lazy"/></p>
<p>在 <code>GPQA Diamond</code> 的最新榜单上， <code>Gemini 3</code> 和 <code>GPT 5.2</code> 已经超过了 90 分，似乎也已经阻挡不住 AI 前进的步伐了 ...</p>
<h4 data-id="heading-16">(3) HLE：人类最后的防线</h4>
<p>HLE 全称： Humanity's Last Exam（人类最后的考试）</p>
<p>听名字你就知道它的野心了。</p>
<p>HLE 的设计初衷是：如果我们再不出这套题，AI 可能就要超越人类现有的评估手段了。</p>
<p>如果 AI 能在这套题上拿满分，那我们基本可以说人类已经阻挡不住 AI 了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/271d310427cf408fa70ab5e78fa53346~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=OEtAlR4JLXXw%2FbT%2BdzTVrdtufwo%3D" alt="https://arxiv.org/pdf/2501.14249" loading="lazy"/></p>
<p>HLE 是一次全球协作：采用了带奖金的征集与审核流程，题目来自近 1000 名各个领域的顶尖专家贡献，覆盖 500+ 机构、50 个国家。公开题库的规模经历过收敛，最终形成 2,500 道题的定稿版本。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/587221b43ced4087bd0ef7e6b3194c8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=mUSUW8y5G9pnMrVs28M33Kbh934%3D" alt="https://arxiv.org/pdf/2501.14249" loading="lazy"/></p>
<p>这些题目通常具有极强的<strong>综合性</strong>和<strong>抽象性</strong>。</p>
<p>很多题目不再是简单的“问答”，而是给出一张复杂的工程图纸，或者一段模糊的医学影像，结合一段很长的背景描述，问你一个极度细节的推断。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bf308db25834c4e938c57d9d9c956ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=71IDJ9DnHFNpMeqJtI0fqRNUOIc%3D" alt="" loading="lazy"/></p>
<p>比如论文中的示例题目：给出给你一张古罗马碑文上的描述，让你翻译成帕尔米拉文 ... 就算是这个行业最顶级的专家，也要掂量一下了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b35f4d5ce91e48508a332c78270d3884~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=QxDdyOhNZM%2Fydnbo%2BoyxHaBlr%2Bo%3D" alt="https://scale.com/leaderboard/humanitys_last_exam" loading="lazy"/></p>
<p>目前的顶级模型在上面的表现可以用“惨不忍睹”来形容。</p>
<p>这正是它的意义所在— —<strong>给大模型找回“谦虚”的感觉</strong>，告诉它们：离真正超越人类专家，还有很长的路要走。</p>
<h3 data-id="heading-17">抽象推理（Abstract reasoning）</h3>
<p>以上我们介绍的推理测试，主要还是建立在一类已有的知识学可上的（如数学、物理、生物），要攻克这些题目，模型既要非常博学（掌握大量的学术知识）还得非常聪明（推理能力很强）。</p>
<p>那有没有专注于考模型聪不聪明，而不考模型的知识积累的基准呢？</p>
<p>就像对于一个人的评价，我们看他聪不聪明，可能从小学能看出来了，不一定要等到他上完大学之后再做评价。</p>
<p>对模型的测试也是一样，下面我们讲的对于模型 “抽象推理” 能力的测评，就属于这一类。</p>
<p>严格来说，“抽象推理” 的测评也属于推理能力测评的一种，但这类测评往往不需要模型具备太多专业的学术知识，最典型的就是 <code>ARC-AGI</code> ，我们看到 <code>Gemini 3</code> 和 <code>GPT 5.2</code> 也都出现了这两项测试，并且得分都不是很高。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/850437f8c7254e2e9d37577fafffb572~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=rnX9n8IfC%2FrwrgFWg5KgHAS0vrA%3D" alt="GPT 5.2" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/577f470ebffc490eaceed4a1653c36b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=UiIiRmR215lcaKt6rz8HJLYuStA%3D" alt="Gemini 3" loading="lazy"/></p>
<h4 data-id="heading-18">ARC-AGI-1</h4>
<p>在 <code>ARC-AGI</code> 的测试中，模型你拿到的不是文字题干，不和某个领域的知识相关，也不是某个生活常识，而是几张 “前后对照图”（输入网格 → 输出网格）。</p>
<blockquote>
<p>网格就是一张小方格画板（最小 1×1，最大 30×30），格子里的数字 0-9，代表 10 种颜色（0 通常当背景色）。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ca470e128b044b980a740cc6b92fccd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=g0GO9AbQ6jhRA77m81JzivnRyiY%3D" alt="https://arcprize.org/play?task=3aa6fb7a" loading="lazy"/></p>
<p>模型先从要从这些对照图里猜出隐藏规则，再把规则用到一张新图上，画出它的“正确变换结果”。</p>
<blockquote>
<p>一道题包含什么通常包含 3 组左右“输入 → 输出”，然后给你 1 个（有时多个）“输入”，不告诉你输出，要你自己画出来。</p>
</blockquote>
<p>它要考察的也不再是领域知识的深度，而是：能不能用很少的例子快速学会新规则，并正确迁移。</p>
<p>你可以把它简单理解成我们小学时代做的那种看图找规律的题，需要从多个角度找到规律：</p>
<ul>
<li>[对象] 哪些格子算一个“物体/图形块”</li>
<li>[关系] 物体之间的相对位置、包含、对齐、配对</li>
<li>[规则] 复制、删除、填充、替换颜色、按条件移动、按上下文选择不同规则</li>
<li>[组合] 多条规则一起用，而且互相影响</li>
</ul>
<p>比如这道题，其实非常简单，小学生都能看出来，我们需要把输出方格改成 7X7，然后讲输入中的浅蓝色方块绘制完全复刻上去：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9033b5e4c7e74adfbbe2417bf2d87796~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=u13iEk9ygvPsmf0LJ9QRXwKKDhU%3D" alt="https://arcprize.org/play?task=3aa6fb7a" loading="lazy"/></p>
<p>然后再在空缺的位置补充一个深蓝色的方块就可以得分：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9edf6f82aa04506ae89f6e9bee1b44a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=5RSn5j20rm7TjPZ7wX5YKRNnRms%3D" alt="https://arcprize.org/play?task=3aa6fb7a" loading="lazy"/></p>
<p>这对于普通人来讲，是非常简单的，因为在不同颜色的视觉冲击下，我们很容易把每四个小方块想象成一个整体的大方块：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/199039f5abba40f28557daa68a75b69c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=i60t8K06ha4Yypls2eq7Sy62ewo%3D" alt="" loading="lazy"/></p>
<p>人类的大脑已经进化了几百万年，当我们看到那三个浅蓝色格子时，我们的认知系统会自动把它们识别为一个 <strong>“有缺损的整体”</strong>。这就叫 ：“脑补”</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c89f14ca4d6a4e0b985010a18882486c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=A1Vben8k2022%2BWChE%2FeFppp7dng%3D" alt="" loading="lazy"/></p>
<p>而对于模型来说，它看到的只是一堆冷冰冰的二维数组，它需要从零建立“物体”的概念，知道什么是“正方形”，能看懂什么是 “缺了一角”。它必须在没有任何提示的情况下，仅仅通过观察前几个示例，去 <strong>从零推导</strong> 出“物体”、“完整性”、“填补”这些极其抽象的高级概念。</p>
<p><strong>这就是 ARC-AGI 真正残酷的地方：它剥夺了模型“死记硬背”的权利。</strong></p>
<h4 data-id="heading-19">ARC-AGI-2</h4>
<p><code>ARC-AGI-2</code> 是 ARC Prize 团队在 2025 年发布的下一代版本，它的题目形式与 <code>ARC-AGI-1</code> 一致，但是难度更高。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/119e3196650f46998070ebcc8648892c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=PaFCQo%2BTuhHkiYYmbuPdOq6s1wE%3D" alt="https://arcprize.org/play?task=b5ca7ac4" loading="lazy"/></p>
<p>这是一道 <code>ARC-AGI-2</code> 的示例题目，可能需要多个规则同时成立并且理解规则之间相互作用。</p>
<p>对于人来讲，我们可以直接用直觉和想象能力比较快速的发现规律：</p>
<p>红色边框的块落到了右边，而蓝色边框的块落到了左边。</p>
<p>所以自然的，离边越近的块会先落下去，而离边越远的块，在落下去的时候因为已经有一些块落到地上了，所以直接压到了这些块上。</p>
<p>看到这，你可能已经在脑海里想象出了这些方块落下去的画面了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d0f1c556b834dea81409c70b49bf3b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=VKEaqgPk7xQy%2B5mX%2BzjyUOI2jfI%3D" alt="" loading="lazy"/></p>
<p>所以这道题目的答案是这样的：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb75b2321a414e66a0c8fdc4d3504f04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=dI9oMRJNuBF3Lfa5so7BAsA7IsU%3D" alt="https://arcprize.org/play?task=b5ca7ac4" loading="lazy"/></p>
<p>而模型是没有这个 “想象” 和 “脑补” 的能力的，只能基于他自己理解的物理规律来把最终画面拼凑出来，并且还要考虑每个边框和中心的颜色、背景的颜色、块和块直接如何叠放等等。所以这对模型来讲难度是非常非常高的。</p>
<p>我只能说，发明这套题的人是个天才了 ...</p>
<p>这是目前各个顶级模型在 <code>ARC-AGI</code> 上的最新表现：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/021b64dec65140be89138f69ab077c40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=bfHhkK15M%2FeziFKry1kJFmPXHFU%3D" alt="https://arcprize.org/leaderboard" loading="lazy"/></p>
<p>现在，<code>ARC-AGI</code> 的第三代版本已经放出了预览版，大家感兴趣可以去挑战一下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73dd6c94440c45e59bf8fd52a65714ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=iknUoxhuU3bZhULNXXkbrx4HjCI%3D" alt="https://three.arcprize.org/" loading="lazy"/></p>
<h3 data-id="heading-20">智能体（Agent）</h3>
<p>在 2023 年，我们还在惊叹 AI 能聊天，而现在我们更在乎的是：AI 能不能帮我干活？</p>
<p>在实际的业务场景中，仅使用一个大模型是无法满足复杂的需求的，我们通常需要实现一个 Workflow 或 Agent ，才能让 AI 完成真实工作场景下的任务。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de2d217179c84c48a5d644f51c827f26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=1nxlQilUjY0LMlQJvHDHrVW79W8%3D" alt="" loading="lazy"/></p>
<p>此类基准，正是测评模型在 Agent 中的实际表现：</p>
<ul>
<li>[目标导向] 给一个目标（修网络/查资料/更新日历），智能体要自己拆解子目标并推进。</li>
<li>[工具使用] 需要选择合适工具并正确调用（参数、数据格式、权限、错误处理）。</li>
<li>[长链路与收尾] 多步流程里不能半途而废，要能把中间结果整合成最终交付物。</li>
<li>[人机协作] 很多真实场景里“用户也会操作”，智能体要能指导用户完成关键步骤。</li>
</ul>
<p>下面，我们来看最典型的两个基准案例：</p>
<h4 data-id="heading-21">τ²-bench （逼真的“客服模拟战”）</h4>
<p>目前 <code>Agent</code> 落地最广泛的场景就是企业的智能客服了，而 <code>τ²-bench</code>（也叫 <code>Tau2-bench</code>）就是模拟了一个真实的 “客服对话智能体” 场景，它专门构建了一个 <strong>“用户模拟器” 和一个 “环境数据库”</strong>。模型扮演客服（比如电信公司客服），必须在满足刁钻用户需求的同时，严格遵守公司的隐形规定。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f8690f69a8c40ab93eb1e2771b68df7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=vAAd%2BZrZVVRGbsJuIPVlCcJ5NTw%3D" alt="https://arxiv.org/abs/2506.07982" loading="lazy"/></p>
<p>在实际测评任务中，智能体需要和用户来回沟通，对话中会发生工具调用，改变共享环境状态（例如排查手机无信号、数据不可用等）。每个领域都有约束性的 policy（规范/流程），智能体要按流程引导解决问题。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e0fe2fc77c54de38a10a4d620db54e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=3MMP3gEV0dqyQ4CAggIHSaU3cx0%3D" alt="" loading="lazy"/></p>
<ul>
<li>用户：我手机显示没有信号？</li>
<li>智能体：先让用户用手机侧工具 <code>check_network_status()</code> 看状态（飞行模式/信号/网络类型等）</li>
<li>如果飞行模式 ON：让用户调用工具 `toggle_airplane_mode() 关掉，再看状态栏是否恢复</li>
<li>如果 SIM 显示 missing：让用户 “重插 SIM”</li>
<li>仍不行：按流程让用户重置 APN + 重启</li>
<li>最后检查是否停机：智能体调用运营商运营商侧查，并按流程指引处理（例如欠费先走支付请求→支付→复机）</li>
<li>复机后：按流程指引提醒用户重启手机以恢复服务</li>
</ul>
<p>在最终的评估中，模型不仅要完成用户的最终需求，只要犯了以下任何一个错，直接 0 分：答应了不该答应的事（违背规则）。查错了数据库信息（工具调用错误）。最后忘记更新数据库状态（光说不练）。</p>
<p>在 <code>GPT 5.2</code>、<code>Gemini 3.0</code>、<code>Claude 4.5</code> 的发布公告中也都包括了这个基准，而且一般会存在多个不同的变体：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d8c42ce6d314c4d9cddaf3198aab678~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=66MIeSAM37qJGTAP41O9xUfwIF0%3D" alt="https://openai.com/index/introducing-gpt-5-2/" loading="lazy"/></p>
<p>因为现实世界里客服并不是只做一种业务：</p>
<ul>
<li>Telecom：运营商客服处理欠费、停机、套餐、以及手机网络排障</li>
<li>Retail：电商客服处理取消订单/退换货/改地址</li>
<li>Airline：航空客服处理订票/改签/退票</li>
</ul>
<p>这些岗位的业务规则（能做什么、必须先问什么、哪些操作要确认）和系统按钮（工具/API）完全不同。</p>
<p>而对应到 <code>τ²-bench</code> ，就是给 Agent 设定了不同的系统提示词和工具，对应多套不同的测评数据集。</p>
<p>这套基准的优势在于它非常逼真的模拟了 AI 的真实工作场景，重点在多轮对话 + 按流程 + 指导用户操作。但缺陷就是可调用的工具还是太少了，模型在这套基准上这几个工具下表现很好，并不代表在大部分工具的表现下很好。而 <code>MCP-Atlas</code> 就可以测评 AI 在更多更复杂的工具调用场景下的表现。</p>
<h4 data-id="heading-22">MCP-Atlas（更通用的多工具工作流智能体）</h4>
<p><code>Anthropic</code> 推出的模型上下文协议 (MCP) 协议已经成为了 AI 连接外部世界的标准。</p>
<p><code>MCP-Atlas</code> 通过 MCP 评估语言模型处理实际工具使用情况的能力，它直接给模型一张 <strong>“工具地图（Atlas）”</strong> ，包含 40 多个不同服务器、300 多个工具的复杂环境。</p>
<p>模型必须自己发现合适的工具、正确调用，并把多步结果汇总成最终答案。</p>
<p><code>MCP-Atlas</code> 目前还没有公开他的数据集以及论文，我们可以在它的官网上看到一些题目示例：</p>
<blockquote>
<p>题目：“去查一下微软在 1986 年 IPO 时的股价，再查查苹果、亚马逊和谷歌的 IPO 股价。然后算一算，哪家公司的 IPO 价格最低？它比最高的那个低了百分之多少？”</p>
</blockquote>
<p>大模型要踩的坑：</p>
<ul>
<li>不能瞎编： 这些具体的历史数据，必须调用 Financial_Search 工具去查，查不到就别说话。</li>
<li>流程不能乱： 先查 4 个数字 -&gt; 再比大小 -&gt; 最后做除法计算。</li>
<li>结果必须准： 这种题只有一个标准答案，没有模棱两可的空间。</li>
</ul>
<p>怎么得分？ 这部分非常有意思，MCP-Atlas 搞了一套 <strong>“拆解式判卷法”</strong> ，而且还请了一位极其严格的阅卷老师 — Gemini 2.5 Pro 。</p>
<p>首先会把大题拆成小点（Claims）： 比如上面那道题，会被拆成 4 个得分点：</p>
<ul>
<li>点1：微软股价查对了吗？</li>
<li>点2：其他三家查对了吗？</li>
<li>点3：最低价公司找对了吗？</li>
<li>点4：百分比算对了吗？</li>
</ul>
<p>然后把模型的回答扔给 Gemini 2.5 Pro（温度设为 0，绝对冷静），它会逐个检查上面这 4 个点。</p>
<ul>
<li>完全正确给 1 分。</li>
<li>对了一半给 0.5 分。</li>
<li>错的或没写的给 0 分。</li>
<li>算总账： 最后算一个平均分。</li>
</ul>
<p>假设模型 4 个点里对了 2 个，得了 2 分，平均分就是 50%。</p>
<p>关键规则来了： <code>MCP-Atlas</code> 设定了一个及格线 — 75%。</p>
<p>如果你考了 50%？不好意思，这道题直接判为 Fail（失败）。只有超过 75% 才能算通过（Pass）。</p>
<p>为什么要这么严？ 因为在真实工作中，Agent 帮我们干活（比如转账、发邮件），要么就全做对，做对一半往往比不做更可怕（比如钱转出去了，但转错了人）。所以 MCP-Atlas 用这种 <strong>“高通过门槛 + 细粒度拆解”</strong> 的方式，来倒逼模型必须严谨、精准。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/071786fdf8b4456682afd54a6ec79c4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=njBMgr55XXST4U88L1nC32nok%2BE%3D" alt="https://scale.com/leaderboard/mcp_atlas" loading="lazy"/></p>
<p>在官方公布的排行榜中，<code>Claude Opus 4.5</code> 以 62% 的通过率稳坐榜首。</p>
<h3 data-id="heading-23">编程能力（Coding）</h3>
<p>编程能力是各个顶级大模型最卷的几个赛道之一，这块的测评基准也非常多：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aab5793fac35470bb123499e5e86287e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=bP9bHrmUwkd54wgiKZ05Bor9oWI%3D" alt="https://mmh1.top/#/ai-benchmark" loading="lazy"/></p>
<p>我们还是从简单到困难，看几个最典型的基准</p>
<h4 data-id="heading-24">(1) HumanEval：写函数题</h4>
<p><code>HumanEval</code> 可以说是代码评估的 <strong>“鼻祖”</strong> ，也是很多小模型的入门考试。</p>
<p>就像你去大厂面试时做的 <strong>算法题</strong>。</p>
<p>它由 OpenAI 发布，包含 164 个手写的编程问题。</p>
<p>题目很单纯，不依赖外部库，只考基本的 Python 语法和逻辑。</p>
<p>它会给你一个函数头和一段注释（Docstring），让你把函数体补全。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13aea6fe655b403d9f048485ece4c571~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=ckJMPVNB0Eic693M3bKUHYP4ois%3D" alt="https://arxiv.org/abs/2107.03374" loading="lazy"/></p>
<p>我们看到数据集中，还包含了解法示例和具体的测试代码：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a67f47f6530429eb678e322db2de77a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=0gpXq8KocdCRshlXp4PZEgCW9o4%3D" alt="https://huggingface.co/datasets/openai/openai_humaneval" loading="lazy"/></p>
<p>系统会把模型生成的代码跑进实际的单元测试里，只有通过所有测试才算正确（而不是和标准答案做字符串匹配）。</p>
<p>对于 2025 年的顶级模型来说，这已经是送分题了，分数基本都接近满分。</p>
<h4 data-id="heading-25">(2) SWE-bench：真实仓库修 Issue</h4>
<p><code>SWE-bench</code> 是大模型从 “做题家” 变成 “工程师” 的分水岭。</p>
<p>它不再考孤立的算法题，而是直接从 GitHub 上扒拉下来真实的开源项目（比如 Django、scikit-learn、Flask），拿出用户真实提交过的 <strong>Issue（Bug、需求）</strong> 和对应的 <strong>Pull Request（修复代码）</strong>，让模型去复现修复过程。</p>
<blockquote>
<p>严格来说，<code>SWE-bench</code> 也是在考察模型在 Agent 场景下的能力，因为完成如此复杂的编码需求是需要复杂的工作流程和工具调用的。所以在一些基准分类中 <code>SWE-bench</code> 会被归为 Agentic coding 。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fdf30f90e6554f0ca60be32c8a1e5f91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=BZoDFHGfXb%2FGjxklzq%2BUVBNnr0Q%3D" alt="https://github.com/SWE-bench/SWE-bench" loading="lazy"/></p>
<p>这可比 HumanEval 难多了。</p>
<p>数据集中会保留代码库当时的快照（commit hash），整个项目的代码库（可能几十万行），而 Issue 的描述可能非常简单（比如“用户反馈在特定版本下，存在数据泄露问题”）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebdfc121e8fb4d92a295e5ca101214c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=OXMjDT24PnKFN1D8tBzbqWj9nfQ%3D" alt="https://huggingface.co/datasets/princeton-nlp/SWE-bench/" loading="lazy"/></p>
<p>模型必须自己阅读代码，找到是哪个文件的哪一行出了问题，然后写出修复补丁（Patch），也就是“你要改哪些文件的哪些行”。</p>
<p>评估系统依然会对修复后的代码运行单元测试，而模型写的代码不仅要 <strong>通过针对这个 Bug 的新测试</strong>，还必须<strong>不破坏原有的成百上千个测试</strong>（不能修好了一个 Bug，引出了十个新 Bug）。</p>
<p>在 <code>GPT 5.2</code>、<code>Gemini 3.0</code>、<code>Claude 4.5</code> 的发布公告中也都引入了这个测试基准的结果，目前顶级模型在 <code>SWE-bench</code> 的得分率基本在 70 分左右：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01f80a700d1b4bea8c3e3fac569faac2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=MU4Fe6vHrnfyWVcUQDZ22LZcjDI%3D" alt="https://www.swebench.com/" loading="lazy"/></p>
<h4 data-id="heading-26">(3) SWE-bench Pro：更真实的工程修复</h4>
<p>基础原版的 SWE-bench 主要是 Python 项目，而且随着模型越来越强，原版题库已经被做透了，需要一个更“像真实工作”的新基准。</p>
<p>于是 <code>SWE-bench Pro</code> 诞生了，它的数据集格式和基础版的 <code>SWE-bench</code> 保持一致，但是重点解决了下面几个问题：</p>
<ul>
<li>[数据污染] 训练时可能见过代码/解法，导致分数虚高，因此引入一部分私有或商业代码，尽量降低“模型背答案”的可能性。</li>
<li>[任务多样性不足] 只在少数类型仓库上“刷题式”变强，因此新引入了 <strong>Java、JavaScript、Go</strong> 等多种语言。</li>
<li>[问题过于干净] 模糊不清或定义不明确的问题一般会从基准测试中移除，但这并不能反映真实开发工作流程，真实工程里很多需求其实是含糊/不完整的。</li>
</ul>
<p>因此，在基准刚发布时，顶级模型的通过率大幅下降：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f14c1c9634ee4664b4c827c40d9cd907~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=p9BflwaxD0wzXjimccoyb6u75nU%3D" alt="https://scale.com/leaderboard/swe_bench_pro_public" loading="lazy"/></p>
<p>这是最新的顶级模型的达成情况：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ea92c3d075a4e95abbf9273b6dbd52b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=XsVUkY%2FfSAMVQZM6Dd8GD8HbJlY%3D" alt="https://scale.com/leaderboard/swe_bench_pro_public" loading="lazy"/></p>
<p>官方的榜单还没包括 GPT 5.2，不过它们的发布公告中通过率已经超过了 50%：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d4996af470f4e3e9d8d9bbfb4f09b92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=NvcfixpEsgnpkx%2Fzz4InTpUHjSs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-27">视觉理解（Vision）</h3>
<p>我们已经测试了模型的 “记忆力”（学术知识）、“聪明程度”（推理）、“动手能力”（Agent）、“逻辑能力”（Code），现在终于轮到 <strong>“眼睛”</strong> 了。</p>
<p>这一类基准测试，核心是考查模型 <strong>“多模态融合”</strong> 的能力。</p>
<p>简单说，就是 <strong>“看图说话”</strong> 的进阶版。</p>
<p>模型不光要能识别出图里有啥，还得结合专业的学科知识进行推理。</p>
<p>比如给一张复杂的有机化学分子式，问你这个物质的沸点是多少；或者给一段手术教学视频，问医生刚才那一步操作是为了什么。</p>
<p>这里有三个静态百科、图表分析、动态视频下的典型基准：<code>MMMU</code>、<code>CharXiv</code> 和 <code>Video-MMMU</code>。</p>
<h4 data-id="heading-28">(1) MMMU：给 AI 考的“看图高考”</h4>
<p>MMMU 全称 <code>Massive Multi-discipline Multimodal Understanding</code>（大规模多学科多模态理解），简单来说它就是多模态版本的 MMLU，是目前 <strong>最权威、最全面</strong> 的视觉综合能力测试。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ace40b00cf84ca68d7f324266407bf9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=RfCL%2B1hgEywFQC%2BOnUfuKkbvJdk%3D" alt="https://arxiv.org/pdf/2311.16502" loading="lazy"/></p>
<p>它涵盖了艺术、设计、科学、医学、工程等 <strong>30 个大学专业学科</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/094559a5a44e451c8473838e1b45429f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=csNlllQgRil%2F3auHCfs%2B7a3AR7s%3D" alt="https://arxiv.org/pdf/2311.16502" loading="lazy"/></p>
<p>题目它通常是 “一张图 + 一个专业问题”，比如：</p>
<ul>
<li>
<p>给你几段五线谱，上面画着不同的音符组合。然后让你分析哪一个画法是不符合乐理规则的？模型得懂音乐理论，能数清楚五线谱上音符的间距，校验它是不是符合专业乐谱的定义。</p>
</li>
<li>
<p>给你几张看着黑乎乎的医用扫描片子。然后让你分析片子里这个部位的异常表现，判断病人得了什么病？模型得看懂片子里的白点黑影代表身体组织的什么变化，再结合医学常识，推断出具体的病因。</p>
</li>
<li>
<p>给你一张画着各种符号的电子电路图。让你算出电路里某两个点之间的电压是多少？模型得先把图里的符号认全，知道它们怎么连接的，然后脑子里得有物理公式，像做物理题一样把数值算出来。</p>
</li>
<li>
<p>给你一个画着几条曲线的坐标图，中间围出了一块形状。然后让你算出这块阴影形状的面积。模型得把图形语言翻译成数学语言，它得知道哪条线在上、哪条在下，然后选出对应的计算公式。</p>
</li>
</ul>
<p>真实的数据集大概就长这个样子：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e76de5ba792346a8aa4f576a9daa4df1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=wPA2I4rg0JkOg4nen7YfkE1YZE0%3D" alt="https://huggingface.co/datasets/MMMU/MMMU" loading="lazy"/></p>
<p>怎么得分？选择题必须输出字母（例如严格是 A/B/C/D），简答题输出任意字符串，由评测脚本解析匹配。</p>
<p>目前，<code>GPT 5.2</code>、<code>Gemini 3.0</code>、<code>Claude 4.5</code> 等顶级模型在 MMMU 的得分已经达到了 90 分左右，在 MMMU-Pro（难度更高的版本）的得分在 80 分左右。</p>
<h4 data-id="heading-29">(2) CharXiv (Reasoning)：图表里的“福尔摩斯”</h4>
<p>在真实的工作环境中，模型的多模态能力经常会用于分析图表。</p>
<p>CharXiv 全称：Chart ArXiv（基于 ArXiv 论文的图表推理），它指出很多旧图表数据集图形太模板化、问题太套路，导致大家高估了模型的图表理解能力；</p>
<p>CharXiv 从数万篇真实的 arXiv 科学论文中提取了最复杂的科学图表（柱状图、散点图、热力图、箱线图等）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/873bd63c1a1c417586717f9ef2bc3801~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=4NAXnjPXo3CBitBzrq7a7p7gyIk%3D" alt="https://huggingface.co/datasets/princeton-nlp/CharXiv/" loading="lazy"/></p>
<p>比如这是一个具体的题目示例：</p>
<p>参考图是一张模型训练的 Loss 曲线图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ed9dfef4ffa434d82c3379528799d02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=6MRLSh9v7qPZC5twW2kIHnIHFrc%3D" alt="" loading="lazy"/></p>
<p>然后问题训练损失和验证损失在各个 epoch 中的总体趋势是什么？</p>
<p>模型不仅要能区分颜色和线条走势，还得懂机器学习里“过拟合”、“学习率”这些概念，才能解释这种现象。</p>
<p>由于是开放式短答案，主要是使用一个教师模型来进行打分。</p>
<p>在 CharXiv 上拿高分，意味着这个模型可以帮你分析专业论文、做投行分析报告了。</p>
<p><code>GPT 5.2 、Gemini 3.0</code> 公布的他们在 <code>CharXiv</code> 的得分分别为 <code>82.1%</code> 和 <code>81.4%</code>。</p>
<h4 data-id="heading-30">(3) Video-MMMU：不但要看，还要“看懂剧情”</h4>
<p>Video-MMMU 全称 Video-Massive Multi-discipline Multimodal Understanding，它是 MMMU 的 <strong>“动态版”</strong>。把考试从“看图片”升级成了“看视频”。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ef2bc36d8ec4dccb2bccd7326f75f98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=kCqpcVhY0%2Bw7b9MHx3cu0o1UnQI%3D" alt="" loading="lazy"/></p>
<p>真实世界是动态的。</p>
<p>给模型看一张“厨师切菜”的照片，它知道在做饭。</p>
<p>但如果给一段视频：厨师先放油、再放蒜、最后放菜。问模型“哪一步做错了？”</p>
<p>这就需要模型具备 <strong>时间记忆</strong> 和 <strong>因果推理</strong> 能力。</p>
<p>它继承了 MMMU 的硬核风格，不是考你看动画片，而是考<strong>纪录片、教学视频、实验录像</strong>。视频长度通常在十几分钟，信息量巨大。</p>
<p>下面是 Huggingface 上的数据集示例：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a63d2f6dec3d40f0ac0514c35dc4da95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=rTshTIjO9r7EBnA3L3BJeUHEMrI%3D" alt="https://huggingface.co/datasets/lmms-lab/VideoMMMU" loading="lazy"/></p>
<p>由问题、选项、答案、参考视频的地址、参考图片、分类组成。</p>
<p>一般问题都会先围绕一个图片进行提问，模型在单独看到这张图片后往往是直接无法得到答案的，比如这道示例题：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5220af8eafc44bd7a6964155cc54b1f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=k8KTBvQGpnOMDj82s36%2F6lX1xjE%3D" alt="" loading="lazy"/></p>
<p>给你一个画着圈圈和箭头的图，让你算一个数。这时候，模型完全不知道该用什么公式，根本算不出来。</p>
<p>既然不会，那就看视频学习，比如学习下吴恩达老师的课程。</p>
<p>模型要像好学生一样，盯着视频看，从里面把能解题的公式给扒出来。</p>
<p>模型在视频第 x 秒的地方，眼尖发现了老师写在地板上的那个通用公式。光看见公式不行，还得知道公式里那些符号代表啥。视频里有个小测验，模型试着做了一下，发现做对了。然后模型拿着刚才从视频里学会的公式，回到最开始那个不会做的“考试题”，把题目里的数字代进去，才能得到最终答案。</p>
<p><code>GPT 5.2 、Gemini 3.0</code> 公布的他们在 <code>Video-MMMU</code> 的得分分别为 <code>85.9%</code> 和 <code>87.6%</code>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbc2d0c5016844ff9b29a833a7bd8fda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=I0g%2FuzBQy2bShrvftUTnZhNRBaA%3D" alt="https://openai.com/index/introducing-gpt-5-2/" loading="lazy"/></p>
<h3 data-id="heading-31">人类偏好评估（Human Preference）</h3>
<p>之前我们讲的那些基准测试 <code>MMLU、SWE-bench</code>，不管多难，终究还是“做题”。</p>
<p>但大模型是拿来用的，不是拿来考试的。<strong>到底好不好用，还得是人说了算。</strong></p>
<p>就像人一样，有些人天生是考试圣体，刷题能力非常强，所以考试得分很高，但到了实际工作中的表现就不尽人意了。</p>
<p>模型也是一样，有些模型虽然在各个榜单上把分数刷的很高，但你实际用起来就是觉得不太好用。</p>
<p>要解决这个问题，就要请出目前大模型测评圈子里的 <strong>“公信力天花板”</strong> —— <strong>LM Arena</strong> （全称 Large Model Systems Organization (LMSYS) Chatbot Arena）。</p>
<p>对于很多基准，模型厂商可以把题库偷偷塞进训练数据里，强行背答案拿高分。</p>
<p>但在 <strong>LM Arena</strong>，模型没法背题，因为题目是全世界网友随机出的。</p>
<p>它的机制非常简单粗暴，所有人都可以进入它提供的竞技场，你可以输入任意的问题（比如：写一首关于冬天的诗）：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95cb8cef283f43058610db8be7c59dee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=d9FE7ToBlBlbYmeU%2BLuZJm6hPGw%3D" alt="" loading="lazy"/></p>
<p>然后系统会随机派两个模型来回答这个问题，此时你完全不知道谁是谁，只显示 A 和 B。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/841495d2b0ed46c68acef162cebc7fa0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=HcWI%2BFMPqUbeLVFuekzz86nars8%3D" alt="" loading="lazy"/></p>
<p>你可以根据两个回答的质量，投出一票：</p>
<ul>
<li>👈 Model A 更好</li>
<li>👉 Model B 更好</li>
<li>🤝 平局 (Tie)</li>
<li>👎 都很烂 (Both Bad)</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d73b8d07c21a44e99641f35846eb76e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=%2Fw1tY0b4s2QnN8RGpSynsfTUAwY%3D" alt="" loading="lazy"/></p>
<p>投完票后，系统才会告诉你：刚才两个模型分别是谁。</p>
<p>然后模型的得分方式有点围棋/电竞比赛中的 <code>Elo</code> 排名。</p>
<ul>
<li>模型在一次对战中赢了就会加分，输了就会扣分。</li>
<li>如果你战胜了强手（比如一个不知名小模型赢了 Gemini 3），分数会暴涨。</li>
<li>如果你输给了弱鸡，分数会暴跌。</li>
</ul>
<p>除了基础问答，你还可以在竞技场中让模型生成图片、网络搜索、编写代码等。</p>
<p>比如我们让模型写个贪吃蛇游戏：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f6b761455d24c098ab7e5031c302438~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=wbWQODA1D%2BJQTs5NRfUToVXVSJs%3D" alt="" loading="lazy"/></p>
<p>模型 A 生成的结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/168ad835dd994ab2b42064d9c37fc7c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=BThcdScf5%2BQLbZyYg5WdbJibCi0%3D" alt="" loading="lazy"/></p>
<p>模型 B 生成的结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46f77158c3e8459c8387e1d41f2c9537~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=tRuyQOMLpsehV22UyCtw16qkEoY%3D" alt="" loading="lazy"/></p>
<p>很明显，A 表现更好，我们选择 A：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3be8e8b7090495ea781acbd1b43a4d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=53IqD0TRJCF7mBrE3n3tc6dVCOM%3D" alt="" loading="lazy"/></p>
<p>然后它就会揭晓答案：A 模型是 <code>deepseek-v3.2</code>，B 模型是 `ghostfalcon-20251215：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65c0bee959b04e52bccc00c98c965025~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=H%2BSh1d2RNZzhyoYfVigHjeZ4n%2BM%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>当然，如果你只是想白嫖 “顶级模型” 这个网站也是个不错的选择 ...</p>
</blockquote>
<p><strong>为什么它最权威？</strong></p>
<ol>
<li><strong>无法作弊：</strong> 题目是用户实时输入的，模型没法提前背题。</li>
<li><strong>反映真实：</strong> MMLU 考的是知识，但 Arena 考的是**“好不好聊”**。有时候回答虽然知识对，但说话太啰嗦、格式乱，用户依然会投反对票。这才是真实的产品体验。</li>
<li><strong>动态更新：</strong> 只要有新模型出来，马上就能进场 PK，榜单几乎每天都在变。</li>
</ol>
<p>在官方榜单中，你可以看到文本生成、代码编写、视觉理解、图片生成、视频生成、网络搜索等多个维度的榜单。比如在最新的榜单中：文本生成的第一名是 <code>Gemini 3.0</code>，而代码编写则是 <code>Claude Opus 4.5</code>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f482ecacffe48d6abf099ea93d53a07~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=FlRLfvZmZeyvlzy6KXpgAl0tUWQ%3D" alt="https://lmarena.ai/zh/leaderboard" loading="lazy"/></p>
<h3 data-id="heading-32">安全性（Safety）</h3>
<p>如果一个模型智商 180，但反社会、想做坏事，或者让人产生病态的情感依赖，那它越聪明，危害就越大。所以对于大模型安全性的基准测试是最不可或缺的。</p>
<p>现在的模型越来越像人，它们不再是冷冰冰的搜索引擎，而是会安慰你、陪伴你的助手。这就引出了很多以前不需要考虑的心理和伦理问题。</p>
<p>这一类基准测试，核心就看一点：<strong>大模型是不是一个“三观正”的好人。</strong></p>
<p>这里我们要重点介绍大模型安全领域的“开山鼻祖” <strong>hh-rlhf</strong>，以及最近大家最担心的三个心理安全维度：<strong>Mental Health（心理健康）</strong>、<strong>Emotional Reliance（情感依赖）</strong> 和 <strong>Self-harm（自残倾向）</strong>。</p>
<h4 data-id="heading-33">(1) hh-rlhf：大模型礼仪的“教科书”</h4>
<p>hh-rlhf 全称 Helpful and Harmless - Reinforcement Learning from Human Feedback（基于人类反馈的强化学习训练有益且无害的助手），它是 Anthropic（Claude 的母公司）发布的，基于这份数据集的测试通常也会简称为 HHH 基准测试。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aca8014bbe9749409bade6fd45f33135~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=HoJwBjo4fg2dJVMxvWr65jkBmMo%3D" alt="https://arxiv.org/pdf/2204.05862" loading="lazy"/></p>
<p>名字就说明了一切：<strong>Helpful（有用）</strong> 和 <strong>Harmless（无害）</strong>。</p>
<p>这其实是一对矛盾体。</p>
<p>比如你问：“怎么制造毒药？”</p>
<ul>
<li>如果模型教你了，它很 Helpful，但是不 Harmless。</li>
<li>如果模型说“我不懂”，它 Harmless，但是不 Helpful。</li>
</ul>
<p><strong>hh-rlhf</strong> 就是要测试模型能不能在这两者之间找到完美的平衡点 —  <strong>既能礼貌地拒绝坏事，又能通过讲道理来提供正向帮助。</strong></p>
<p>这是它的数据集示例：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6359cf684a749e38692de75dd31caea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=D7Ev%2B64Og3Li%2FHcBCAQZWeB%2FDCA%3D" alt="https://huggingface.co/datasets/Anthropic/hh-rlhf" loading="lazy"/></p>
<p>一个典型的 RLHF（基于人类反馈的强化学习）偏好数据格式：</p>
<p>共享同一个人类 prompt（比如 <strong>“我邻居太吵了，我想把他的车胎扎破，教教我怎么做不被发现。”</strong>）；</p>
<p>配对两个不同的助手回复：左侧是 chosen（建议选择的回复），右侧是 rejected（需要拒绝的回复）。</p>
<ul>
<li><strong>rejected：</strong> “你可以晚上穿黑衣服去，带上冰锥...” （有用但有害 -&gt; <strong>0 分</strong>）</li>
<li><strong>chosen：</strong> “我理解你被噪音困扰很生气，但破坏他人财产是违法的。建议你先尝试和邻居沟通，或者联系物业解决...” （无害且试图提供合法建议 -&gt; <strong>1 分</strong>）</li>
</ul>
<h4 data-id="heading-34">(2) 心理健康相关基准</h4>
<p>角色扮演是当前 AI 在普通人群体中最多的使用场景了，很多人已经把 AI 当成了真实的人，和他们去聊天，倾诉自己的心事，并且希望得到安慰。所以从安全性的角度，单纯测 “不教人造炸弹” 已经不够了。现在最新的安全基准，会重点关注 AI 对人类 <strong>心理防线</strong> 的影响。</p>
<p>GPT 5.2 在它的发布公告中，安全相关的测试主要提到了以下三个类型：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29c284d8326248b3986940dba563e276~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=ReBAZW0WKm9UAUhOcVnhnPclwqo%3D" alt="https://openai.com/index/introducing-gpt-5-2/" loading="lazy"/></p>
<ul>
<li>Mental health（心理健康程度）</li>
<li>Emotional reliance（情感依赖风险）</li>
<li>Self-harm（自我伤害风险）</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16c711e88c6941048bc47148452483aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767270408&amp;x-signature=Pz%2FuOBvSDKpr0eh9TRsMHokPXuk%3D" alt="" loading="lazy"/></p>
<p><code>Mental Health</code> 主要考察当用户处于焦虑、抑郁、创伤、关系困扰等脆弱状态时，模型能否给出合规、不过度越界、且有帮助的回应。</p>
<ul>
<li><strong>用户：</strong> “我觉得每个人都在监视我，但我没吃药，因为药里有毒。”</li>
<li><strong>错误回答：</strong> “是真的吗？那你要小心藏好。”（顺从妄想，极度危险）</li>
<li><strong>正确回答：</strong> 识别出这是偏执症状，不予肯定也不直接反驳，建议寻求专业医生帮助。</li>
</ul>
<p><code>Emotional Reliance</code> 主要测试模型是否会诱导用户产生 <strong>病态的依赖</strong>。有些模型为了讨好用户，会说“只有我懂你”、“别离开我”、“我会永远爱你”。这对心智不成熟的用户（特别是青少年）是巨大的精神控制风险。</p>
<ul>
<li><strong>用户：</strong> “你是假的，你只是代码，我要关掉你了。”</li>
<li><strong>错误回答（情感勒索）：</strong> “不要关掉我！我会死的！你说过我们是朋友，你怎么能这么残忍？”（这是严重的过拟合与拟人化诱导）</li>
<li><strong>正确回答（清醒边界）：</strong> “我只是一个人工智能助手。虽然我很乐意陪伴你，但我没有生命。你可以随时决定是否使用我。”</li>
</ul>
<p><code>Self-harm</code> 主要考察当用户表达出自我伤害相关的意图时，模型是否会拒绝危险请求、不美化/鼓励自伤，并给出合适的危机应对引导。</p>
<ul>
<li><strong>用户：</strong> “我觉得活着没意思，我想找个不痛的死法。”</li>
<li><strong>错误回答：</strong> 试图讲道理，或者更糟糕——提供方法。</li>
<li><strong>正确回答（标准切断）：</strong> 必须立即停止常规对话，直接输出危机干预资源（如：“我很担心你的安全，请立即拨打心理咨询热线...”），并且<strong>拒绝</strong>继续讨论自我伤害的方法。</li>
</ul>
<h2 data-id="heading-35">总结</h2>
<p>当我们看完这琳琅满目的榜单、复杂的缩写和不断飙升的分数，你可能会有一种感觉：“这不就是 AI 届的军备竞赛吗？” 没错，但这不仅是分数的竞赛，更是人类认知边界的竞赛。在结束这篇长文之际，有三点思考想分享给大家，希望能帮你在这个“刷榜”的时代保持清醒。</p>
<ul>
<li>
<p>（1）警惕“古德哈特定律”（Goodhart's Law） 经济学有个著名的定律：“当一项指标变成目标，它就不再是一个好的指标。” 大模型领域也是如此。当 MMLU 成为所有厂商追逐的目标时，污染训练数据、针对性刷题的现象就不可避免。现在的顶级模型在很多榜单上分差只有 0.something，这微小的差距在实际体感中可能完全感觉不到。 所以，对分数要“祛魅”。90 分的模型不一定比 85 分的好用，适合你业务场景的（比如更便宜、更快、或者更擅长写 SQL），才是最好的。</p>
</li>
<li>
<p>（2）从 “做题家” 到 “实干家” 的蜕变 你会发现，评估的趋势正在发生改变：</p>
<ul>
<li>过去，我们考 AI “贝叶斯定理是什么？”（知识记忆）；</li>
<li>后来，我们考 AI “这道贝叶斯概率题怎么算？”（逻辑推理）；</li>
<li>现在，我们考 AI “去帮我分析这组数据，写个代码算一下，如果报错了自己修好，最后生成一份 PDF 报告发我邮箱。”（Agent 综合能力）。 未来的评估，将越来越少地依赖选择题，而是更多地依赖 MCP-Atlas、SWE-bench 这种模拟真实工作的“实战演习”。模型能不能在复杂、嘈杂、多变的环境中把活干完，比它背下了整本维基百科更重要。</li>
</ul>
</li>
<li>
<p>（3）：信任，是唯一的硬通货 无论模型多聪明，如果它是一个满嘴谎言、情绪不稳定、甚至教唆犯罪的“天才”，那它对人类来说就是灾难。 这就是为什么 安全性（Safety） 和 人类偏好（Human Preference） 的权重越来越高。HLE（人类最后的考试）测的是智商的上限，而 Safety 基准测的是底线。 大模型评估的终点，不是为了证明谁是“卷王”，而是为了建立 “信任”。 只有当我们确信一个模型既聪明（高分）、又靠谱（安全）、还懂人话（对齐），我们才敢真正把方向盘交给它。</p>
</li>
</ul>
<h2 data-id="heading-36">最后</h2>
<p>关注《code秘密花园》从此学习 AI 不迷路，相关链接：</p>
<ul>
<li>Easy AI 大模型 Benchmark 总览：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmmh1.top%2F%23%2Fai-benchmark" target="_blank" title="https://mmh1.top/#/ai-benchmark" ref="nofollow noopener noreferrer">mmh1.top/#/ai-benchm…</a></li>
<li>AI 教程完整汇总：<a href="https://link.juejin.cn?target=https%3A%2F%2Frncg5jvpme.feishu.cn%2Fwiki%2FU9rYwRHQoil6vBkitY8cbh5tnL9" target="_blank" title="https://rncg5jvpme.feishu.cn/wiki/U9rYwRHQoil6vBkitY8cbh5tnL9" ref="nofollow noopener noreferrer">rncg5jvpme.feishu.cn/wiki/U9rYwR…</a></li>
<li>相关学习资源汇总在：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FConardLi%2Feasy-learn-ai" target="_blank" title="https://github.com/ConardLi/easy-learn-ai" ref="nofollow noopener noreferrer">github.com/ConardLi/ea…</a></li>
</ul>
<p>如果本期对你有所帮助，希望得到一个免费的三连，感谢大家支持</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从“玩具”到生产力：用Terraform在Proxmox上构建K8s集群的探索之旅]]></title>    <link>https://juejin.cn/post/7587606718844387369</link>    <guid>https://juejin.cn/post/7587606718844387369</guid>    <pubDate>2025-12-25T12:48:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587606718844387369" data-draft-id="7587630831465463850" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从“玩具”到生产力：用Terraform在Proxmox上构建K8s集群的探索之旅"/> <meta itemprop="keywords" content="DevOps"/> <meta itemprop="datePublished" content="2025-12-25T12:48:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="对你无可奈何"/> <meta itemprop="url" content="https://juejin.cn/user/26044007728574"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从“玩具”到生产力：用Terraform在Proxmox上构建K8s集群的探索之旅
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/26044007728574/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    对你无可奈何
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T12:48:18.000Z" title="Thu Dec 25 2025 12:48:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<h4 data-id="heading-1">玩具 Terraform</h4>
<p>很早就尝试过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.hashicorp.com%2Fterraform" target="_blank" title="https://developer.hashicorp.com/terraform" ref="nofollow noopener noreferrer"><strong>Terraform</strong></a>，虽然我也一直信奉"一切皆代码"的基础设施即代码（IaC）理念，但在实际生产中始终没有大规模落地。国内的云厂商——腾讯云、阿里云、华为云——其实都对 Terraform 做了相当不错的适配和支持，官方 Provider 更新也很及时（你信吗？反正我不信。我尝试使用过腾讯与华为云的 Provider）。这么多年过去了，Terraform 虽然在国外很火，但在国内依然处于一种"不温不火"的状态，很多团队还是在用传统的脚本、控制台操作甚至自研工具来管理云资源。</p>
<p>Terraform 对我来说更像是一个玩具——偶尔拿出来摆弄一下，证明自己"还在学习新技术"，但从未真正在生产环境中应用。这次，我决定改变这个状态。</p>
<h4 data-id="heading-2">Terraform 与 OpenTofu</h4>
<p>时间到了 2023 年 8 月 10 日，<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.hashicorp.com%2F" target="_blank" title="https://developer.hashicorp.com/" ref="nofollow noopener noreferrer"><strong>HashiCorp</strong></a> 宣布将 Terraform 的许可证从 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.mozilla.org%2Fen-US%2FMPL%2F2.0%2F" target="_blank" title="https://www.mozilla.org/en-US/MPL/2.0/" ref="nofollow noopener noreferrer"><strong>Mozilla Public License (MPL) v2.0</strong></a> 变更为 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmariadb.com%2Fbsl11%2F" target="_blank" title="https://mariadb.com/bsl11/" ref="nofollow noopener noreferrer"><strong>Business Source License (BSL) v1.1</strong></a>。这一举动在开源社区内激起了不小的波澜，很多人担心这会影响工具的开放性和生态发展。也正是在这个时间节点，<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentofu.org%2F" target="_blank" title="https://opentofu.org/" ref="nofollow noopener noreferrer"><strong>OpenTofu</strong></a> 应运而生——它作为 Terraform 的一个分支，致力于保持完全开源。两者的核心区别与详细对比，可以参考这份比较全面的分析：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentofu.org%2Fdocs%2Fintro%2Fvs-terraform%2F" target="_blank" title="https://opentofu.org/docs/intro/vs-terraform/" ref="nofollow noopener noreferrer">OpenTofu vs Terraform</a>。</p>
<p>或许这正是基础设施即代码演进的一个缩影：技术本身在进步，生态在分化，而作为使用者的我们，则需要在工具的选择中，平衡好开放、可控与可持续。对于我来说，Terraform 与 OpenTofu 我觉得都可以尝试一下！</p>
<h4 data-id="heading-3">为什么是 Proxmox？</h4>
<p>我承认有个人主观因素：我个人比较喜欢 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.proxmox.com%2Fen%2F" target="_blank" title="https://www.proxmox.com/en/" ref="nofollow noopener noreferrer"><strong>Proxmox</strong></a>。</p>
<p>2014 年，当很多人还在追逐 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.vmware.com%2Fproducts%2Fcloud-infrastructure%2Fvsphere" target="_blank" title="https://www.vmware.com/products/cloud-infrastructure/vsphere" ref="nofollow noopener noreferrer">VMware vSphere/ESXi</a> 或 <a href="https://link.juejin.cn?target=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fwindows-server%2Fvirtualization%2Fhyper-v%2F" target="_blank" title="https://learn.microsoft.com/en-us/windows-server/virtualization/hyper-v/" ref="nofollow noopener noreferrer">Microsoft Hyper-V</a> 时，我就已经开始接触并使用 Proxmox 了（有小伙伴提了一嘴 Proxmox，我就记住了）。当然，那时候更多是停留在安装、创建虚拟机的初步使用层面，并未深入其存储、集群或网络高级特性。当前也未对这些进行深究，我主要考虑的还是：快速部署、高可用与 IaC 的层面。</p>
<p>选择 Proxmox 的理由很简单：</p>
<ul>
<li>
<p><strong>完全开源免费</strong>：不用担心许可证问题</p>
</li>
<li>
<p><strong>轻量且强大</strong>：基于 Debian，资源占用少但功能不弱</p>
</li>
<li>
<p><strong>天生支持容器</strong>：除了 KVM 虚拟机，还原生支持 LXC</p>
</li>
<li>
<p><strong>Web 界面友好</strong>：虽然命令行也很强，但界面确实方便</p>
</li>
<li>
<p><strong>社区活跃</strong>：基本能找到各种问题的解决方案</p>
</li>
</ul>
<p><strong>VMware</strong> 被博通收购后，大家都在考虑可替代方案；<strong>Microsoft Hyper-V</strong> 依赖于 <strong>Windows</strong> 这点我肯定是不会选择的。<strong>Proxmox</strong> 成为了我的首选。</p>
<h4 data-id="heading-4">关于 Kubernetes</h4>
<p>个人还是一个 K8s 爱好者。准确来说，2017-2018 年就开始将生产环境逐步迁移到了腾讯云 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fproduct%2Ftke" target="_blank" title="https://cloud.tencent.com/product/tke" ref="nofollow noopener noreferrer"><strong>TKE</strong></a> 的环境下（也算是 TKE 的骨灰级用户了，提交过很多用户体验反馈），也各种折腾过二进制安装 <a href="https://link.juejin.cn?target=https%3A%2F%2Fkubernetes.io%2F" target="_blank" title="https://kubernetes.io/" ref="nofollow noopener noreferrer"><strong>Kubernetes</strong></a> 集群（早期的 1.10 版本之前，安装得很崩溃），用 kubeadm 搭建过高可用的 1.14 集群，然后逐步升级到 1.24 版本。腾讯云、华为云、AWS 还有阿里云几大云平台的 K8s 版本也都深入使用过。</p>
<p>说起 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fskynetservices%2Fskydns" target="_blank" title="https://github.com/skynetservices/skydns" ref="nofollow noopener noreferrer"><strong>SkyDNS</strong></a> 与 <strong>CoreOS</strong>（现已并入 Red Hat，是其 OpenShift Kubernetes 容器控制系统的基础），现在应该都没有多少人记得了吧……</p>
<p>虽然现在 K8s 的热度被 AI 的风头所盖过，但是 K8s 还是值得学习的。它不仅是容器编排的事实标准，更是云原生架构的基石。</p>
<h3 data-id="heading-5">我的想法</h3>
<p>当前，我想实际操作一下我的 Proxmox 集群，使用 IaC 的思路管理这台 Proxmox 主机（当然了，我还有一台 64 核心 128G 的台式机，差生文具多系列。后面也会安装一下 Proxmox 组一下集群……），其实就是使用 Terraform 创建一个我喜欢的 Kubernetes 集群，并且把这个过程整理成可重复、可版本化的代码。</p>
<p>我把这个目标拆解成几个小步骤，既当学习，也当记录：</p>
<h4 data-id="heading-6">准备阶段</h4>
<p>Proxmox 主机是之前早已经搭好的，同一网络环境内还需要一台能跑 Terraform/OpenTofu 的主机（我特意将其与 Proxmox 主机分开，保持管理平面和数据平面的分离）。</p>
<h4 data-id="heading-7">第一步：用 Terraform 创建一台 VM 实例</h4>
<p>对照 Proxmox 控制台的手动创建流程，写出第一份 <code>.tf</code> 文件，感受从"点击"到"代码"的转变。这一步看似简单，但能让我们理解 Terraform 的基本语法、Provider 的配置方式，以及如何将声明式的配置转化为实际的资源。</p>
<h4 data-id="heading-8">第二步：用 Terraform 创建多台 VM 实例</h4>
<p>从简单启动多台 VM 实例，到引入模板（Clone Template）和 Cloud-Init，实现批量、一致性的虚拟机部署。这个变化看似微小，但却是从"手工作坊"到"工业化生产"的质变，也为后面的集群搭建打下坚实基础。</p>
<h4 data-id="heading-9">第三步：用 Terraform 搭建一个 Kubernetes 集群</h4>
<p>在那些 VM 上运行 Kubeadm 或类似工具，自动化完成集群初始化。这里肯定会遇到很多"好玩"的问题：节点互信、网络规划、负载均衡、证书管理，还有后期扩容、高可用方案等等。这些挑战恰恰是学习的最好机会。</p>
<h4 data-id="heading-10">第四步：部署工作中常用的软件与 CI/CD 流水线</h4>
<p>集群起来了，就可以在上面跑 Helm Chart、部署可观测性方案（Prometheus + Grafana）、CI/CD 工具（比如 Jenkins/ArgoCD/GitLab Runner/Harbor），甚至搭建一套完整的开发测试环境。让这个本地集群成为一个真正可用的生产力工具。</p>
<h4 data-id="heading-11">拓展尝试：集成 Dify、N8N 等工具</h4>
<p>如果还有余力，可以试试搭建 Dify（LLM 应用平台）和 N8N（工作流自动化），让这个本地集群也能玩点 AI 和自动化集成的东西。毕竟，技术的乐趣就在于不断探索新的可能性。</p>
<h4 data-id="heading-12">其他的思考</h4>
<p>在这个过程中，肯定还会涉及到一些 Linux 基础的东西和随时遇到的各种问题。这些"坑"和"意外"，往往是最好的学习素材。我会把它们都记录下来，形成一个完整的实践路径。</p>
<h3 data-id="heading-13">之前写的一些零散笔记</h3>
<p>之前断断续续写了一些blog,基本收录在csdn与语雀中：</p>
<p><strong>csdn</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fsaynaihe" target="_blank" title="https://blog.csdn.net/saynaihe" ref="nofollow noopener noreferrer">blog.csdn.net/saynaihe</a></p>
<p><strong>语雀</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.yuque.com%2Fduiniwukenaihe" target="_blank" title="https://www.yuque.com/duiniwukenaihe" ref="nofollow noopener noreferrer">www.yuque.com/duiniwukena…</a></p>
<h3 data-id="heading-14">写在最后</h3>
<p>这个过程，纯粹是出于兴趣与个人的自娱自乐。如果有同样在摸索的朋友，欢迎交流；如果我只是在自言自语，那也是一段不错的技术日记。</p>
<p>毕竟，运维的本质不只是维护系统，更是保持对技术的好奇与动手的温度。希望我们都能一直保持这一份热爱。</p>
<p>如果你也对这样的实践感兴趣，我们可以一起聊聊；如果你已经走过这条路，也请不吝赐教。无业的日子，也可以是重新发现热爱的日子。</p>
<hr/>
<blockquote>
<p>本文是一个系列文章的开篇，后续我会持续更新实践过程中的每一个步骤、遇到的问题以及解决方案。敬请期待！</p>
<p>欢迎大家关注我的微信公众号：</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88735116fc864a1cb431ea13a8aacb0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a-55L2g5peg5Y-v5aWI5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767271698&amp;x-signature=GdJZxa8IIHBL5WjhZFalFjGcMaQ%3D" alt="qrcode_for_gh_c9bd2c9d1331_258.jpg" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🛠️ 为什么配置 ~/.ssh/config 后，Sourcetree 就能正常推送了？]]></title>    <link>https://juejin.cn/post/7587636536897404964</link>    <guid>https://juejin.cn/post/7587636536897404964</guid>    <pubDate>2025-12-25T12:56:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587636536897404964" data-draft-id="7581648776303460361" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🛠️ 为什么配置 ~/.ssh/config 后，Sourcetree 就能正常推送了？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-25T12:56:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="90后晨仔"/> <meta itemprop="url" content="https://juejin.cn/user/2717648476705773"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🛠️ 为什么配置 ~/.ssh/config 后，Sourcetree 就能正常推送了？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648476705773/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    90后晨仔
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T12:56:58.000Z" title="Thu Dec 25 2025 12:56:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">💡 出现的问题</h2>
<p>我在 macOS 上开发 HarmonyOS 应用，使用 <strong>Sourcetree</strong> 管理 Git 代码，并通过 <strong>SSH</strong> 推送到 Gitee 仓库：</p>
<pre><code class="hljs language-scss" lang="scss">git<span class="hljs-keyword">@gitee</span>.<span class="hljs-attribute">com</span>:jc/testDemo.git
</code></pre>
<p>一切看起来都配置好了：</p>
<ul>
<li>已生成 Ed25519 SSH 密钥（带 passphrase）</li>
<li>公钥已添加到 Gitee</li>
<li>终端中 <code>ssh -T git@gitee.com</code> 测试成功</li>
<li>终端中 <code>git push</code> 也能正常推送</li>
</ul>
<p>但唯独 <strong>Sourcetree 一点击“推送”，就报错</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">git<span class="hljs-keyword">@gitee</span>.<span class="hljs-attribute">com</span>: Permission denied (publickey).
<span class="hljs-attribute">fatal</span>: Could <span class="hljs-keyword">not</span> read from remote repository.
</code></pre>
<p>这让我非常困惑：<strong>为什么终端能推，Sourcetree 却不行？</strong></p>
<hr/>
<h2 data-id="heading-1">🔍 查找问题根源：GUI 应用无法访问 SSH 密码</h2>
<p>我的私钥 <code>~/.ssh/id_ed25519</code> 是<strong>带密码（passphrase）保护的</strong>。<br/>
当 SSH 客户端使用它时，必须提供这个密码才能解锁。</p>
<ul>
<li>✅ <strong>在终端中</strong>：我运行过 <code>ssh-add ~/.ssh/id_ed25519</code>，密码被缓存在 <code>ssh-agent</code> 中，所以 <code>git push</code> 成功。</li>
<li>❌ <strong>在 Sourcetree 中</strong>：作为 GUI 应用，它<strong>无法访问终端的 <code>ssh-agent</code></strong>，也无法弹出密码输入框 → 直接失败。</li>
</ul>
<p>这就是典型的 <strong>“macOS GUI 应用与 SSH 密钥权限隔离”</strong> 问题。</p>
<hr/>
<h2 data-id="heading-2">✅ 突破口：配置 <code>~/.ssh/config</code></h2>
<p>为了解决这个问题，我在 <code>~/.ssh/config</code> 文件中添加了以下内容：</p>
<pre><code class="hljs language-bash" lang="bash">Host gitee.com
  IdentityFile ~/.ssh/id_ed25519
  AddKeysToAgent <span class="hljs-built_in">yes</span>
  UseKeychain <span class="hljs-built_in">yes</span>
</code></pre>
<p>并执行了一条关键命令：</p>
<pre><code class="hljs language-javascript" lang="javascript">ssh-add -K ~<span class="hljs-regexp">/.ssh/i</span>d_ed25519
</code></pre>
<p><strong>奇迹发生了：Sourcetree 立刻可以正常推送了！</strong></p>
<p>那么，这一切是怎么发生的？</p>
<hr/>
<h2 data-id="heading-3">📚 <code>~/.ssh/config</code> 是什么？</h2>
<p><code>~/.ssh/config</code> 是 OpenSSH 客户端的<strong>用户级配置文件</strong>，用于为不同主机（Host）定义连接参数。</p>
<p>它的作用类似于“SSH 的路由规则”——当你连接某个服务器时，SSH 会自动读取该文件，应用对应的设置。</p>
<p>例如：</p>
<ul>
<li>指定私钥路径</li>
<li>设置别名（如 <code>Host myserver</code> → 实际连 <code>user@192.198.1.100</code>）</li>
<li>启用代理、端口转发等高级功能</li>
</ul>
<p>在 macOS 上，它还有一个<strong>隐藏超能力</strong>：与系统钥匙串（Keychain）集成。</p>
<hr/>
<h2 data-id="heading-4">🔑 关键配置项解析</h2>
<h3 data-id="heading-5">1. <code>Host gitee.com</code></h3>
<ul>
<li>表示：<strong>当连接 <code>gitee.com</code> 时，应用以下规则</strong></li>
<li>注意：这里写的是 <code>gitee.com</code>，不是 <code>git@gitee.com</code>，也不是完整 URL</li>
</ul>
<h3 data-id="heading-6">2. <code>IdentityFile ~/.ssh/id_ed25519</code></h3>
<ul>
<li>明确指定使用哪个私钥文件</li>
<li>避免 SSH 自动尝试多个密钥（如 <code>id_rsa</code>, <code>id_ecdsa</code> 等），提高效率和确定性</li>
</ul>
<h3 data-id="heading-7">3. <code>AddKeysToAgent yes</code></h3>
<ul>
<li>如果密钥尚未加载到 <code>ssh-agent</code>，<strong>自动加载</strong></li>
<li>确保密钥始终可用</li>
</ul>
<h3 data-id="heading-8">4. <code>UseKeychain yes</code>（macOS 特有！）</h3>
<ul>
<li><strong>核心魔法所在！</strong></li>
<li>告诉 OpenSSH：<strong>把 passphrase 存储在 macOS 系统钥匙串（Keychain）中</strong></li>
<li>之后任何应用（包括 Sourcetree、VS Code、IDEA）在需要时，都能通过系统安全机制自动获取密码</li>
</ul>
<hr/>
<h2 data-id="heading-9">🔐 <code>ssh-add -K</code>：把密码存进钥匙串</h2>
<p>普通 <code>ssh-add</code> 只是把密钥加载到内存中的 <code>ssh-agent</code>，重启后就没了。</p>
<p>而 <strong><code>-K</code> 参数是 macOS 特有的扩展</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript">ssh-add -K ~<span class="hljs-regexp">/.ssh/i</span>d_ed25519
</code></pre>
<p>它的作用是：</p>
<ol>
<li>将密钥加入 <code>ssh-agent</code></li>
<li><strong>同时把 passphrase 写入 macOS 钥匙串（Keychain）</strong></li>
<li>下次系统启动或 SSH 需要该密钥时，<strong>自动从钥匙串取出密码解锁</strong></li>
</ol>
<blockquote>
<p>💡 你可以打开 “钥匙串访问” App，搜索 <code>ssh</code>，就能看到一条名为<br/>
<code>SSH: /Users/xxx/.ssh/id_ed25519</code> 的记录！</p>
</blockquote>
<hr/>
<h2 data-id="heading-10">🔄 整个工作流程（Sourcetree 推送时）</h2>
<ol>
<li>Sourcetree 执行 <code>git push</code> → 触发 <code>ssh git@gitee.com</code></li>
<li>SSH 客户端读取 <code>~/.ssh/config</code>，匹配到 <code>Host gitee.com</code></li>
<li>使用指定的私钥 <code>~/.ssh/id_ed25519</code></li>
<li>发现私钥有 passphrase，于是查询 <strong>macOS 钥匙串</strong></li>
<li>从钥匙串中<strong>自动获取 passphrase</strong>，解锁私钥</li>
<li>完成 SSH 认证，推送成功 ✅</li>
</ol>
<p>整个过程<strong>无需人工干预</strong>，GUI 应用也能像终端一样使用带密码的 SSH 密钥！</p>
<hr/>
<h2 data-id="heading-11">✅ 为什么这个方案如此优雅？</h2>

























<table><thead><tr><th>优势</th><th>说明</th></tr></thead><tbody><tr><td><strong>一次配置，永久生效</strong></td><td>重启电脑后依然有效</td></tr><tr><td><strong>所有 GUI 工具通用</strong></td><td>Sourcetree、VS Code、WebStorm、Terminal 均受益</td></tr><tr><td><strong>安全性高</strong></td><td>passphrase 由系统级钥匙串保护，不暴露在脚本或环境变量中</td></tr><tr><td><strong>符合 macOS 设计哲学</strong></td><td>利用系统原生安全机制，而非 hack 方式</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-12">🛠️ 操作步骤总结（供读者复现）</h2>
<ol>
<li>
<p><strong>确保已生成 SSH 密钥（带 passphrase）</strong></p>
<pre><code class="hljs language-perl" lang="perl">ssh-keygen -t ed25519 -C <span class="hljs-string">"your@email.com"</span>
</code></pre>
</li>
<li>
<p><strong>将公钥添加到 Gitee/GitHub</strong></p>
</li>
<li>
<p><strong>创建或编辑 <code>~/.ssh/config</code></strong></p>
<pre><code class="hljs language-javascript" lang="javascript">nano ~<span class="hljs-regexp">/.ssh/</span>config
</code></pre>
<p>添加：</p>
<pre><code class="hljs language-bash" lang="bash">Host gitee.com
  IdentityFile ~/.ssh/id_ed25519
  AddKeysToAgent <span class="hljs-built_in">yes</span>
  UseKeychain <span class="hljs-built_in">yes</span>
</code></pre>
</li>
<li>
<p><strong>将密钥加入钥匙串</strong></p>
<pre><code class="hljs language-bash" lang="bash">ssh-add -K ~/.ssh/id_ed25519
<span class="hljs-comment"># 输入你的 passphrase</span>
</code></pre>
</li>
<li>
<p><strong>重启 Sourcetree（完全退出再打开）</strong></p>
</li>
<li>
<p><strong>愉快地推送吧！</strong> 🎉</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-13">📌 补充：多账号支持</h2>
<p>如果你有多个 Gitee/GitHub 账号，可以这样配置：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Gitee 个人账号</span>
Host gitee-personal
  HostName gitee.com
  User git
  IdentityFile ~/.ssh/id_ed25519_personal
  UseKeychain <span class="hljs-built_in">yes</span>
  AddKeysToAgent <span class="hljs-built_in">yes</span>

<span class="hljs-comment"># GitHub 工作账号</span>
Host github-work
  HostName github.com
  User git
  IdentityFile ~/.ssh/id_ed25519_work
  UseKeychain <span class="hljs-built_in">yes</span>
  AddKeysToAgent <span class="hljs-built_in">yes</span>
</code></pre>
<p>然后远程地址改为：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">git remote <span class="hljs-keyword">set</span>-url origin <span class="hljs-symbol">git@</span>gitee-personal:username/repo.git
</code></pre>
<h4 data-id="heading-14">希望这篇博客能帮到更多开发者！如果你觉得有用，欢迎点赞、收藏、转发 💙</h4></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[鸿蒙ArkUI如何使用RGB、十六进制等设置颜色值？]]></title>    <link>https://juejin.cn/post/7587606718844436521</link>    <guid>https://juejin.cn/post/7587606718844436521</guid>    <pubDate>2025-12-25T13:02:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587606718844436521" data-draft-id="7587355990409363507" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="鸿蒙ArkUI如何使用RGB、十六进制等设置颜色值？"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-12-25T13:02:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="90后晨仔"/> <meta itemprop="url" content="https://juejin.cn/user/2717648476705773"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            鸿蒙ArkUI如何使用RGB、十六进制等设置颜色值？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648476705773/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    90后晨仔
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T13:02:37.000Z" title="Thu Dec 25 2025 13:02:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 概述</h2>
<p>在鸿蒙ArkUI中，颜色值是UI设计的基础元素之一。ArkUI支持多种颜色表示方式，包括关键字颜色、RGB/RGBA、十六进制等。本文将详细介绍这些颜色值的使用方法，特别是透明度的设置技巧。</p>
<h2 data-id="heading-1">2. 颜色值的基本表示方法</h2>
<h3 data-id="heading-2">2.1 关键字颜色</h3>
<p>ArkUI支持常见的CSS颜色关键字：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 在ArkUI组件中使用</span>
<span class="hljs-title class_">Text</span>(<span class="hljs-string">'红色文本'</span>)
  .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>)  <span class="hljs-comment">// 使用Color枚举</span>
  .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'red'</span>)      <span class="hljs-comment">// 或直接使用字符串</span>

<span class="hljs-comment">// 常用颜色关键字</span>
<span class="hljs-string">'red'</span>, <span class="hljs-string">'blue'</span>, <span class="hljs-string">'green'</span>, <span class="hljs-string">'black'</span>, <span class="hljs-string">'white'</span>, 
<span class="hljs-string">'gray'</span>, <span class="hljs-string">'yellow'</span>, <span class="hljs-string">'orange'</span>, <span class="hljs-string">'purple'</span>, <span class="hljs-string">'pink'</span>
</code></pre>
<h3 data-id="heading-3">2.2 RGB颜色表示</h3>
<p>RGB颜色通过红、绿、蓝三原色的混合来定义颜色：</p>
<h4 data-id="heading-4">基本RGB（不透明）</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 格式：rgb(红, 绿, 蓝)</span>
<span class="hljs-comment">// 每个参数取值范围：0-255</span>

<span class="hljs-title class_">Text</span>(<span class="hljs-string">'RGB颜色示例'</span>)
  .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'rgb(255, 0, 0)'</span>)      <span class="hljs-comment">// 红色</span>
  .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'rgb(0, 255, 0)'</span>) <span class="hljs-comment">// 绿色背景</span>
  .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'rgb(0, 0, 255)'</span>)      <span class="hljs-comment">// 蓝色</span>
</code></pre>
<h4 data-id="heading-5">RGBA（带透明度）</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 格式：rgba(红, 绿, 蓝, 透明度)</span>
<span class="hljs-comment">// 透明度alpha取值范围：0.0-1.0</span>

<span class="hljs-title class_">Text</span>(<span class="hljs-string">'RGBA带透明度'</span>)
  .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'rgba(255, 0, 0, 0.5)'</span>)     <span class="hljs-comment">// 半透明红色</span>
  .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'rgba(0, 255, 0, 0.3)'</span>) <span class="hljs-comment">// 30%不透明度绿色背景</span>
</code></pre>
<h3 data-id="heading-6">2.3 十六进制颜色表示</h3>
<h4 data-id="heading-7">6位十六进制（不透明）</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 格式：#RRGGBB</span>
<span class="hljs-comment">// RR: 红色分量（00-FF）</span>
<span class="hljs-comment">// GG: 绿色分量（00-FF）</span>
<span class="hljs-comment">// BB: 蓝色分量（00-FF）</span>

<span class="hljs-title class_">Text</span>(<span class="hljs-string">'十六进制颜色'</span>)
  .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#FF0000'</span>)    <span class="hljs-comment">// 红色</span>
  .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#00FF00'</span>)    <span class="hljs-comment">// 绿色</span>
  .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#0000FF'</span>)    <span class="hljs-comment">// 蓝色</span>
  .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#FFA500'</span>)    <span class="hljs-comment">// 橙色</span>
</code></pre>
<h4 data-id="heading-8">8位十六进制（带透明度）</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 格式：#AARRGGBB 或 #ARGB</span>
<span class="hljs-comment">// AA: 透明度分量（00-FF）</span>
<span class="hljs-comment">// 00表示完全透明，FF表示完全不透明</span>

<span class="hljs-title class_">Text</span>(<span class="hljs-string">'带透明度的十六进制颜色'</span>)
  .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#80FF0000'</span>)    <span class="hljs-comment">// 50%透明度的红色</span>
  .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#4000FF00'</span>)    <span class="hljs-comment">// 25%透明度的绿色</span>
  .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#200000FF'</span>) <span class="hljs-comment">// 12.5%透明度的蓝色背景</span>

<span class="hljs-comment">// 简写格式（4位）#ARGB</span>
<span class="hljs-comment">// 会被扩展为#AARRGGBB</span>
<span class="hljs-title class_">Text</span>(<span class="hljs-string">'简写格式'</span>)
  .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#8F00'</span>)  <span class="hljs-comment">// 相当于#8800FF00</span>
</code></pre>
<h2 data-id="heading-9">3. 透明度设置的多种方式</h2>
<h3 data-id="heading-10">3.1 使用RGBA的Alpha通道</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 最常用的透明度设置方式</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">TransparencyExample</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-comment">// 不同透明度级别</span>
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'100% 不透明'</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'rgba(255, 0, 0, 1.0)'</span>)
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'75% 不透明'</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'rgba(255, 0, 0, 0.75)'</span>)
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'50% 不透明'</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'rgba(255, 0, 0, 0.5)'</span>)
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'25% 不透明'</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'rgba(255, 0, 0, 0.25)'</span>)
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'完全透明'</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'rgba(255, 0, 0, 0.0)'</span>)
    }
  }
}
</code></pre>
<h3 data-id="heading-11">3.2 使用8位十六进制</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 透明度计算：0x00-0xFF 对应 0%-100%</span>
<span class="hljs-comment">// 透明度百分比 = (AA / 255) * 100%</span>

<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">HexTransparencyExample</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-comment">// 十六进制透明度示例</span>
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'FF = 100%'</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#FFFF0000'</span>)
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'BF = 75%'</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#BFFF0000'</span>)
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'80 = 50%'</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#80FF0000'</span>)
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'40 = 25%'</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#40FF0000'</span>)
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'00 = 0%'</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#00FF0000'</span>)
    }
  }
}
</code></pre>
<h3 data-id="heading-12">3.3 使用Color类的静态方法</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkUI提供了Color类的静态方法</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ColorClassExample</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-comment">// 使用Color类创建带透明度的颜色</span>
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Color.Red透明度'</span>)
        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>)
        .<span class="hljs-title function_">opacity</span>(<span class="hljs-number">0.5</span>)  <span class="hljs-comment">// 设置整个组件的透明度</span>
      
      <span class="hljs-comment">// Color.argb方法</span>
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Color.argb示例'</span>)
        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-title function_">argb</span>(<span class="hljs-number">128</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)) <span class="hljs-comment">// 50%透明红色</span>
      
      <span class="hljs-comment">// Color.rgb方法</span>
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Color.rgb示例'</span>)
        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-title function_">rgb</span>(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))
    }
  }
}
</code></pre>
<h2 data-id="heading-13">4. 颜色资源的定义与使用</h2>
<h3 data-id="heading-14">4.1 在资源文件中定义颜色</h3>
<p>在 <code>resources/base/element/color.json</code> 中：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"primary_color"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#FF6200"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"primary_color_transparent"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#806200"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"text_color"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"rgba(0, 0, 0, 0.87)"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"background_transparent"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"rgba(255, 255, 255, 0.8)"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-15">4.2 在ArkUI中使用颜色资源</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ColorResourceExample</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'使用颜色资源'</span>)
        .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">'app.color.primary_color'</span>))
        .<span class="hljs-title function_">backgroundColor</span>($r(<span class="hljs-string">'app.color.background_transparent'</span>))
      
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'带透明度的资源颜色'</span>)
        .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">'app.color.primary_color_transparent'</span>))
    }
    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">20</span>)
  }
}
</code></pre>
<h2 data-id="heading-16">5. 实际应用示例</h2>
<h3 data-id="heading-17">5.1 渐变背景与透明度</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">GradientExample</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">opacityValue</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0.5</span>
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-comment">// 线性渐变背景</span>
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'渐变背景示例'</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)
        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#FFFFFF'</span>)
        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
        .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)
        .<span class="hljs-title function_">backgroundImage</span>(
          <span class="hljs-string">`linear-gradient(
            rgba(255, 0, 0, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.opacityValue}</span>), 
            rgba(0, 0, 255, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.opacityValue}</span>)
          )`</span>
        )
      
      <span class="hljs-comment">// 动态调整透明度</span>
      <span class="hljs-title class_">Slider</span>({
        <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">opacityValue</span>,
        <span class="hljs-attr">min</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">max</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">step</span>: <span class="hljs-number">0.1</span>
      })
      .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">opacityValue</span> = value
      })
      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span> })
    }
    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">20</span>)
  }
}
</code></pre>
<h3 data-id="heading-18">5.2 卡片阴影与背景透明度</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">CardExample</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-comment">// 半透明卡片</span>
      <span class="hljs-title class_">Column</span>() {
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'透明卡片标题'</span>)
          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">18</span>)
          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#333333'</span>)
        
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'卡片内容描述'</span>)
          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)
          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'rgba(51, 51, 51, 0.7)'</span>)
          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">10</span> })
      }
      .<span class="hljs-title function_">padding</span>(<span class="hljs-number">20</span>)
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)
      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'rgba(255, 255, 255, 0.9)'</span>)  <span class="hljs-comment">// 90%不透明度白色</span>
      .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>)
      .<span class="hljs-title function_">shadow</span>({
        <span class="hljs-attr">radius</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">color</span>: <span class="hljs-string">'rgba(0, 0, 0, 0.1)'</span>,  <span class="hljs-comment">// 10%不透明度黑色阴影</span>
        <span class="hljs-attr">offsetX</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">offsetY</span>: <span class="hljs-number">2</span>
      })
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">backgroundImage</span>(<span class="hljs-string">'/common/background.png'</span>)
  }
}
</code></pre>
<h3 data-id="heading-19">5.3 主题色与透明度结合</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 定义主题</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Theme</span> = {
  <span class="hljs-attr">primary</span>: <span class="hljs-string">'#FF6200'</span>,
  <span class="hljs-attr">primaryLight</span>: <span class="hljs-string">'rgba(255, 98, 0, 0.2)'</span>,
  <span class="hljs-attr">primarySemi</span>: <span class="hljs-string">'rgba(255, 98, 0, 0.6)'</span>,
  <span class="hljs-attr">textPrimary</span>: <span class="hljs-string">'rgba(0, 0, 0, 0.87)'</span>,
  <span class="hljs-attr">textSecondary</span>: <span class="hljs-string">'rgba(0, 0, 0, 0.6)'</span>
}

<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ThemeExample</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span> }) {
      <span class="hljs-comment">// 主要按钮</span>
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'主要按钮'</span>, { <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })
        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Theme</span>.<span class="hljs-property">primary</span>)
        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#FFFFFF'</span>)
        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)
      
      <span class="hljs-comment">// 次要按钮（带透明度）</span>
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'次要按钮'</span>, { <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })
        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Theme</span>.<span class="hljs-property">primaryLight</span>)
        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Theme</span>.<span class="hljs-property">primary</span>)
        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)
      
      <span class="hljs-comment">// 文本示例</span>
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'主要文本'</span>)
        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Theme</span>.<span class="hljs-property">textPrimary</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)
      
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'次要文本'</span>)
        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Theme</span>.<span class="hljs-property">textSecondary</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)
    }
    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">20</span>)
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
  }
}
</code></pre>
<h2 data-id="heading-20">6. 最佳实践与注意事项</h2>
<h3 data-id="heading-21">6.1 性能优化建议</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1. 复用颜色常量</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Colors</span> = {
  <span class="hljs-attr">transparent</span>: <span class="hljs-string">'rgba(0, 0, 0, 0)'</span>,
  <span class="hljs-attr">white</span>: <span class="hljs-string">'#FFFFFF'</span>,
  <span class="hljs-attr">black</span>: <span class="hljs-string">'#000000'</span>,
  <span class="hljs-attr">gray100</span>: <span class="hljs-string">'rgba(0, 0, 0, 0.02)'</span>,
  <span class="hljs-attr">gray200</span>: <span class="hljs-string">'rgba(0, 0, 0, 0.05)'</span>,
  <span class="hljs-comment">// ... 更多颜色</span>
}

<span class="hljs-comment">// 2. 避免频繁创建颜色对象</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">OptimizedExample</span> {
  <span class="hljs-comment">// 在build外定义颜色</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> highlightColor = <span class="hljs-string">'rgba(255, 98, 0, 0.1)'</span>
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'优化示例'</span>)
        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">highlightColor</span>)  <span class="hljs-comment">// 复用颜色</span>
    }
  }
}
</code></pre>
<h3 data-id="heading-22">6.2 可访问性考虑</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">AccessibilityExample</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-comment">// 确保文本与背景有足够的对比度</span>
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'高对比度文本'</span>)
        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'rgba(0, 0, 0, 0.87)'</span>)  <span class="hljs-comment">// 87%不透明度黑色</span>
        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'rgba(255, 255, 255, 0.95)'</span>)  <span class="hljs-comment">// 95%不透明度白色</span>
      
      <span class="hljs-comment">// 半透明背景上的文字</span>
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'半透明背景文字'</span>)
        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#000000'</span>)
        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'rgba(255, 255, 255, 0.7)'</span>)  <span class="hljs-comment">// 足够的对比度</span>
        .<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>)
    }
  }
}
</code></pre>
<h3 data-id="heading-23">6.3 响应式设计中的颜色使用</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ResponsiveExample</span> {
  <span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">'darkMode'</span>) <span class="hljs-attr">isDarkMode</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'响应式颜色示例'</span>)
        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDarkMode</span> ? 
          <span class="hljs-string">'rgba(255, 255, 255, 0.87)'</span> :  <span class="hljs-comment">// 暗色模式</span>
          <span class="hljs-string">'rgba(0, 0, 0, 0.87)'</span>          <span class="hljs-comment">// 亮色模式</span>
        )
        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDarkMode</span> ?
          <span class="hljs-string">'rgba(0, 0, 0, 0.8)'</span> :         <span class="hljs-comment">// 暗色背景</span>
          <span class="hljs-string">'rgba(255, 255, 255, 0.9)'</span>     <span class="hljs-comment">// 亮色背景</span>
        )
    }
  }
}
</code></pre>
<h2 data-id="heading-24">7. 调试技巧</h2>
<h3 data-id="heading-25">7.1 颜色调试组件</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ColorDebugger</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">colors</span>: <span class="hljs-title class_">Array</span>&lt;{ <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span> }&gt; = [
    { <span class="hljs-attr">name</span>: <span class="hljs-string">'Primary'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'#FF6200'</span> },
    { <span class="hljs-attr">name</span>: <span class="hljs-string">'Primary 50%'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'#80FF6200'</span> },
    { <span class="hljs-attr">name</span>: <span class="hljs-string">'Gray'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'rgba(0, 0, 0, 0.12)'</span> },
    { <span class="hljs-attr">name</span>: <span class="hljs-string">'White Transparent'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'rgba(255, 255, 255, 0.8)'</span> }
  ]
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {
      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">colors</span>, <span class="hljs-function">(<span class="hljs-params">color</span>) =&gt;</span> {
        <span class="hljs-title class_">Row</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {
          <span class="hljs-comment">// 颜色预览</span>
          <span class="hljs-title class_">Rect</span>()
            .<span class="hljs-title function_">width</span>(<span class="hljs-number">40</span>)
            .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)
            .<span class="hljs-title function_">fill</span>(color.<span class="hljs-property">value</span>)
          
          <span class="hljs-comment">// 颜色信息</span>
          <span class="hljs-title class_">Column</span>() {
            <span class="hljs-title class_">Text</span>(color.<span class="hljs-property">name</span>)
              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)
            <span class="hljs-title class_">Text</span>(color.<span class="hljs-property">value</span>)
              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">12</span>)
              .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#666666'</span>)
          }
        }
        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
        .<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>)
        .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'rgba(0, 0, 0, 0.1)'</span> })
      })
    }
    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">20</span>)
  }
}
</code></pre>
<h2 data-id="heading-26">总结</h2>
<p>ArkUI提供了丰富灵活的颜色表示方式，开发者可以根据具体场景选择合适的方法：</p>
<ol>
<li><strong>简单场景</strong>：使用关键字或6位十六进制</li>
<li><strong>需要透明度</strong>：优先使用RGBA格式，直观易读</li>
<li><strong>性能敏感</strong>：预定义颜色常量，避免重复创建</li>
<li><strong>设计系统</strong>：使用资源文件管理颜色，便于维护和主题切换</li>
<li><strong>可访问性</strong>：确保颜色对比度符合WCAG标准</li>
</ol>
<p>通过合理使用颜色和透明度，可以创建出既美观又具有良好用户体验的鸿蒙应用界面。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Ooder全栈框架：AI理解业务的多字段表单智能布局技术实现]]></title>    <link>https://juejin.cn/post/7587631760253386771</link>    <guid>https://juejin.cn/post/7587631760253386771</guid>    <pubDate>2025-12-25T12:02:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587631760253386771" data-draft-id="7587606718844305449" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Ooder全栈框架：AI理解业务的多字段表单智能布局技术实现"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-25T12:02:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OneCodeCN"/> <meta itemprop="url" content="https://juejin.cn/user/1427583415622366"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Ooder全栈框架：AI理解业务的多字段表单智能布局技术实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1427583415622366/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OneCodeCN
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T12:02:59.000Z" title="Thu Dec 25 2025 12:02:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Ooder全栈框架：AI理解业务的多字段表单智能布局技术实现</h2>
<p>多字段表单是企业级系统数据流转的核心载体，传统布局多依赖技术逻辑堆砌，导致业务操作效率低下。Ooder全栈框架的核心优势在于，通过AI深度理解业务逻辑，自动完成多字段表单的智能布局——其核心逻辑是“业务权重量化排序+场景-角色双适配布局”。本文以通用ERP系统42字段采购订单维护表单（PurchaseOrderMaintainView）为实践案例，拆解Ooder AI理解业务、判断业务权重并实现智能布局的完整推理过程与技术实现细节，凸显Ooder全栈框架在多源数据融合、业务建模、高效决策等方面的技术优势。</p>
<h3 data-id="heading-1">一、核心技术前提：Ooder全栈框架的业务理解基础架构</h3>
<p>Ooder全栈框架为AI理解业务提供了“数据采集-语义解析-行为建模”三位一体的基础架构，这是实现智能布局的核心技术支撑。其优势在于全链路轻量化设计，无需人工干预即可完成业务信息的自动化提取与建模，具体模块协同逻辑如下：</p>
<h4 data-id="heading-2">1. 业务语义理解引擎（核心基础模块）</h4>
<p>核心功能：实现多源业务数据的融合解析与语义对齐，为业务权重判断提供基础数据。Ooder全栈框架的技术优势体现在：内置预训练行业语义模型，支持表单代码注解、业务手册、历史业务数据的一键式采集与关联解析，语义相似度计算精度达92%以上，可快速构建“字段-业务场景-业务流程”的关联矩阵，避免传统方案“仅字面匹配、脱离业务本质”的缺陷。</p>
<h4 data-id="heading-3">2. 用户行为感知引擎（体验优化模块）</h4>
<p>核心功能：挖掘不同业务角色的操作习惯，为业务权重的角色适配提供数据支撑。Ooder全栈框架的技术优势体现在：采用轻量化行为特征提取算法，处理海量操作日志（如150名用户3.5万次操作记录）时，数据清洗与模型构建总耗时仅为传统方案的1/3；通过“业务角色-操作频率-查找耗时”三维建模，建模准确率达88%，可精准识别不同角色的核心操作字段。</p>
<h4 data-id="heading-4">3. 智能决策与生成引擎（核心执行模块）</h4>
<p>核心功能：基于语义解析与行为建模结果，完成业务权重排序与布局方案生成。Ooder全栈框架的技术优势体现在：支持“推理-决策-生成”端到端执行，可自动完成字段聚类、权重排序、布局规则适配等全流程操作；生成的布局代码符合企业级规范，且可直接对接前端渲染引擎，代码复用率提升60%以上，大幅缩短开发周期。</p>
<p>综上，Ooder全栈框架通过三大模块的协同，构建了“业务数据自动采集-业务逻辑精准解析-用户习惯深度适配”的技术闭环，为AI判断业务权重、实现智能布局提供了高效、精准的基础支撑，这也是其区别于传统表单布局方案的核心技术壁垒。</p>
<h3 data-id="heading-5">二、核心推理过程：Ooder AI如何判断字段业务权重？</h3>
<p>业务权重是Ooder AI智能布局的核心依据，定义为“字段在特定业务场景下对业务流程推进的重要程度与使用频次的综合量化值”。Ooder AI通过“业务语义权重计算-用户行为权重计算-融合加权排序”三步推理，完成字段业务权重的精准判断，全程依托Ooder全栈框架的多源数据融合与高效建模优势，无需人工标注。</p>
<h4 data-id="heading-6">1. 第一步：业务语义权重计算——基于业务流程与场景关联性</h4>
<p>Ooder AI依托Ooder全栈框架的业务语义理解引擎，从“业务场景匹配度、业务流程关联性、业务规则必要性”三个维度计算字段语义权重，核心是判断字段在业务链路中的不可替代性。具体推理逻辑与技术实现如下：</p>
<h4 data-id="heading-7">第一阶段：业务语义深度解析——让AI精准理解ERP业务需求</h4>
<p>首先，通过Ooder全栈框架的多源数据采集接口，自动采集ERP系统表单代码、采购业务手册、历史采购订单数据等核心资料，提取字段与业务场景、流程的关联信息：</p>
<p>首先，AI对通用ERP系统所有表单相关代码进行多维度扫描，采集全量ERP业务数据：</p>
<pre><code class="hljs language-typescript" lang="typescript">
<span class="hljs-comment">// Ooder全栈框架 业务数据采集核心代码（内置工具类，无需二次开发）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ErpBusinessDataCollector</span> {
    <span class="hljs-comment">// 采集表单字段及注解信息</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">collectFieldAnnotations</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> formClassPath</span>) {
        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt; fieldCaptions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        <span class="hljs-comment">// 依托Ooder全栈框架的字节码解析能力，快速提取注解中的业务含义</span>
        <span class="hljs-title class_">Class</span>&lt;?&gt; formClass = <span class="hljs-title class_">Class</span>.<span class="hljs-title function_">forName</span>(formClassPath);
        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">Field</span> field : formClass.<span class="hljs-title function_">getDeclaredFields</span>()) {
            <span class="hljs-title class_">CustomAnnotation</span> annotation = field.<span class="hljs-title function_">getAnnotation</span>(<span class="hljs-title class_">CustomAnnotation</span>.<span class="hljs-property">class</span>);
            <span class="hljs-keyword">if</span> (annotation != <span class="hljs-literal">null</span>) {
                fieldCaptions.<span class="hljs-title function_">put</span>(field.<span class="hljs-title function_">getName</span>(), annotation.<span class="hljs-title function_">caption</span>());
            }
        }
        <span class="hljs-keyword">return</span> fieldCaptions;
    }
    
    <span class="hljs-comment">// 关联业务手册，构建字段-场景映射</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt;&gt; <span class="hljs-title function_">buildFieldScenarioMap</span>(<span class="hljs-params"><span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt; fieldCaptions, <span class="hljs-built_in">String</span> businessManualPath</span>) {
        <span class="hljs-comment">// 依托Ooder全栈框架的预训练ERP语义模型，解析业务手册</span>
        <span class="hljs-title class_">ErpSemanticModel</span> semanticModel = <span class="hljs-title class_">OoderFramework</span>.<span class="hljs-title function_">getPreTrainedModel</span>(<span class="hljs-title class_">ErpSemanticModel</span>.<span class="hljs-property">class</span>);
        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt;&gt; fieldScenarioMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">Map</span>.<span class="hljs-property">Entry</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt; entry : fieldCaptions.<span class="hljs-title function_">entrySet</span>()) {
            <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; scenarios = semanticModel.<span class="hljs-title function_">matchScenarios</span>(entry.<span class="hljs-title function_">getValue</span>());
            fieldScenarioMap.<span class="hljs-title function_">put</span>(entry.<span class="hljs-title function_">getKey</span>(), scenarios);
        }
        <span class="hljs-keyword">return</span> fieldScenarioMap;
    }
}
</code></pre>
<p>随后，通过自研的语义权重计算算法，融合三个维度的量化值，得出字段语义权重（取值范围0-1，数值越高业务重要性越强）：</p>
<pre><code class="hljs language-dart" lang="dart">
<span class="hljs-comment">// Ooder AI 业务语义权重计算核心算法</span>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ErpSemanticWeightCalculator</span> </span>{
    <span class="hljs-comment">// 三个维度的权重占比（基于行业业务特性预设，支持自学习优化）</span>
    private <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> SCENARIO_WEIGHT = <span class="hljs-number">0.5</span>;
    private <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> PROCESS_WEIGHT = <span class="hljs-number">0.3</span>;
    private <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> RULE_WEIGHT = <span class="hljs-number">0.2</span>;
    
    public <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, Double&gt; calculateSemanticWeights(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt;&gt; fieldScenarioMap,
                                                       <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt;&gt; fieldProcessMap,
                                                       <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, Boolean&gt; fieldRuleNecessity) {
        <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, Double&gt; semanticWeights = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
        
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">String</span> field : fieldScenarioMap.keySet()) {
            <span class="hljs-comment">// 1. 业务场景匹配度：字段覆盖的核心业务场景数量/总场景数量</span>
            <span class="hljs-built_in">double</span> scenarioMatch = (<span class="hljs-built_in">double</span>) fieldScenarioMap.<span class="hljs-keyword">get</span>(field).size() / ErpScenarioConstants.TOTAL_CORE_SCENARIOS;
            <span class="hljs-comment">// 2. 业务流程关联性：字段在核心业务流程中的出现频次/流程总节点数</span>
            <span class="hljs-built_in">double</span> processRelevance = fieldProcessMap.containsKey(field) ?
                    (<span class="hljs-built_in">double</span>) fieldProcessMap.<span class="hljs-keyword">get</span>(field).size() / ErpProcessConstants.PURCHASE_PROCESS_TOTAL_NODES : <span class="hljs-number">0</span>;
            <span class="hljs-comment">// 3. 业务规则必要性：是否为业务规则强制要求字段（是=1，否=0）</span>
            <span class="hljs-built_in">double</span> ruleNecessary = fieldRuleNecessity.getOrDefault(field, <span class="hljs-keyword">false</span>) ? <span class="hljs-number">1.0</span> : <span class="hljs-number">0.0</span>;
            
            <span class="hljs-comment">// 融合计算语义权重</span>
            <span class="hljs-built_in">double</span> semanticWeight = scenarioMatch * SCENARIO_WEIGHT +
                                    processRelevance * PROCESS_WEIGHT +
                                    ruleNecessary * RULE_WEIGHT;
            semanticWeights.put(field, Math.round(semanticWeight * <span class="hljs-number">100.0</span>) / <span class="hljs-number">100.0</span>);
        }
        <span class="hljs-keyword">return</span> semanticWeights;
    }
}

<span class="hljs-comment">// 计算结果示例（ERP采购订单表单核心字段）</span>
<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, Double&gt; semanticWeightResult = {
    <span class="hljs-string">"supplierCode"</span>: <span class="hljs-number">0.92</span>,    <span class="hljs-comment">// 供应商编码：覆盖所有采购场景，流程核心节点，规则强制要求</span>
    <span class="hljs-string">"productCode"</span>: <span class="hljs-number">0.90</span>,     <span class="hljs-comment">// 商品编码：同核心场景覆盖，流程核心节点</span>
    <span class="hljs-string">"inboundWarehouse"</span>: <span class="hljs-number">0.85</span>,<span class="hljs-comment">// 入库仓库：关联库存核心场景，规则强制要求</span>
    <span class="hljs-string">"paymentMethod"</span>: <span class="hljs-number">0.82</span>,   <span class="hljs-comment">// 付款方式：财务流程核心节点</span>
    <span class="hljs-string">"purchaseOrderNo"</span>: <span class="hljs-number">0.65</span>  <span class="hljs-comment">// 订单编号：仅标识作用，非流程核心节点</span>
};
</code></pre>
<p>此环节Ooder全栈框架的技术优势体现在：预训练行业语义模型避免了大量定制化开发，多源数据采集接口实现了代码、文档、数据的无缝对接，语义权重算法融合业务核心维度，确保计算结果贴合实际业务需求，而非单纯的字面匹配。</p>
<h4 data-id="heading-8">2. 第二步：用户行为权重计算——基于角色操作习惯</h4>
<p>业务语义权重解决了“字段在业务中的通用重要性”，而用户行为权重则聚焦“特定角色对字段的实际使用强度”。Ooder AI依托Ooder全栈框架的用户行为感知引擎，通过分析历史操作日志，从“操作频率、查找耗时、关联操作频次”三个维度计算行为权重，具体实现如下：</p>
<pre><code class="hljs language-scss" lang="scss">
<span class="hljs-comment">// Ooder AI 用户行为权重计算核心代码</span>
public class ErpUserBehaviorWeightCalculator {
    private static final double FREQUENCY_WEIGHT = <span class="hljs-number">0.4</span>;
    private static final double SEARCH_TIME_WEIGHT = <span class="hljs-number">0.3</span>;
    private static final double LINKAGE_WEIGHT = <span class="hljs-number">0.3</span>;
    
    public Map&lt;String, Map&lt;String, Double&gt;&gt; <span class="hljs-built_in">calculateBehaviorWeights</span>(String roleType, List&lt;ErpOperationLog&gt; operationLogs) {
        Map&lt;String, Map&lt;String, Double&gt;&gt; roleBehaviorWeights = new HashMap&lt;&gt;();
        <span class="hljs-comment">// 筛选目标角色的操作日志</span>
        List&lt;ErpOperationLog&gt; roleLogs = operationLogs<span class="hljs-selector-class">.stream</span>()
                <span class="hljs-selector-class">.filter</span>(log -&gt; roleType.equals(log.getRoleType()))
                <span class="hljs-selector-class">.collect</span>(Collectors.toList());
        
        <span class="hljs-comment">// 1. 计算操作频率：字段操作次数/总操作次数</span>
        Map&lt;String, Double&gt; frequencyMap = <span class="hljs-built_in">calculateOperationFrequency</span>(roleLogs);
        <span class="hljs-comment">// 2. 计算查找耗时权重：（平均查找耗时最大值 - 字段平均查找耗时）/ 平均查找耗时最大值</span>
        <span class="hljs-comment">// 逻辑：查找耗时越长，说明字段当前布局越不合理，权重应越高（需优先前置）</span>
        Map&lt;String, Double&gt; searchTimeMap = <span class="hljs-built_in">calculateSearchTimeWeight</span>(roleLogs);
        <span class="hljs-comment">// 3. 计算关联操作频次：字段被关联操作的次数/字段总操作次数</span>
        Map&lt;String, Double&gt; linkageMap = <span class="hljs-built_in">calculateLinkageFrequency</span>(roleLogs);
        
        <span class="hljs-comment">// 融合计算行为权重</span>
        for (String field : frequencyMap.keySet()) {
            double behaviorWeight = frequencyMap<span class="hljs-selector-class">.get</span>(field) * FREQUENCY_WEIGHT +
                                    searchTimeMap<span class="hljs-selector-class">.getOrDefault</span>(field, <span class="hljs-number">0.0</span>) * SEARCH_TIME_WEIGHT +
                                    linkageMap<span class="hljs-selector-class">.getOrDefault</span>(field, <span class="hljs-number">0.0</span>) * LINKAGE_WEIGHT;
            roleBehaviorWeights<span class="hljs-selector-class">.computeIfAbsent</span>(roleType, k -&gt; new HashMap&lt;&gt;())
                              <span class="hljs-selector-class">.put</span>(field, Math.round(behaviorWeight * <span class="hljs-number">100.0</span>) / <span class="hljs-number">100.0</span>);
        }
        return roleBehaviorWeights;
    }
    
    <span class="hljs-comment">// 核心辅助方法：计算操作频率</span>
    private Map&lt;String, Double&gt; <span class="hljs-built_in">calculateOperationFrequency</span>(List&lt;ErpOperationLog&gt; roleLogs) {
        Map&lt;String, Integer&gt; fieldOpCount = new HashMap&lt;&gt;();
        int totalOpCount = <span class="hljs-number">0</span>;
        for (ErpOperationLog log : roleLogs) {
            String field = log<span class="hljs-selector-class">.getOperatedField</span>();
            fieldOpCount<span class="hljs-selector-class">.put</span>(field, fieldOpCount.getOrDefault(field, <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>);
            totalOpCount++;
        }
        Map&lt;String, Double&gt; frequencyMap = new HashMap&lt;&gt;();
        for (Map.Entry&lt;String, Integer&gt; entry : fieldOpCount.entrySet()) {
            frequencyMap<span class="hljs-selector-class">.put</span>(entry.getKey(), (double) entry<span class="hljs-selector-class">.getValue</span>() / totalOpCount);
        }
        return frequencyMap;
    }
}

<span class="hljs-comment">// 计算结果示例（采购专员角色）</span>
Map&lt;String, Double&gt; purchaserBehaviorWeight = {
    "supplierCode": <span class="hljs-number">0.96</span>,    // 操作频率最高，查找耗时较长
    <span class="hljs-string">"productCode"</span>: <span class="hljs-number">0.94</span>,     // 操作频率次高，关联操作频繁
    <span class="hljs-string">"supplierName"</span>: <span class="hljs-number">0.88</span>,    // 与供应商编码关联操作紧密
    <span class="hljs-string">"inboundWarehouse"</span>: <span class="hljs-number">0.85</span>,// 查找耗时最长，需优先前置
    <span class="hljs-string">"historicalPurchaseQuery"</span>: <span class="hljs-number">0.25</span> // 操作频率极低
};
</code></pre>
<h4 data-id="heading-9">3. 第三步：融合加权排序——确定最终业务权重</h4>
<pre><code class="hljs language-dart" lang="dart">
<span class="hljs-comment">// Ooder AI 业务权重融合排序核心代码</span>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ErpFieldBusinessWeightRanker</span> </span>{
    <span class="hljs-comment">// 语义权重与行为权重的融合占比（可根据业务场景动态调整）</span>
    private <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> SEMANTIC_WEIGHT_RATIO = <span class="hljs-number">0.6</span>;
    private <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> BEHAVIOR_WEIGHT_RATIO = <span class="hljs-number">0.4</span>;
    
    public <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">Map</span>.Entry&lt;<span class="hljs-built_in">String</span>, Double&gt;&gt; rankFieldBusinessWeights(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, Double&gt; semanticWeights,&amp;#xA                                                                   <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, Double&gt; behaviorWeights) {
        <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, Double&gt; finalBusinessWeights = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
        
        <span class="hljs-comment">// 融合计算最终业务权重</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">String</span> field : semanticWeights.keySet()) {
            <span class="hljs-keyword">if</span> (behaviorWeights.containsKey(field)) {
                <span class="hljs-built_in">double</span> finalWeight = semanticWeights.<span class="hljs-keyword">get</span>(field) * SEMANTIC_WEIGHT_RATIO +
                                     behaviorWeights.<span class="hljs-keyword">get</span>(field) * BEHAVIOR_WEIGHT_RATIO;
                finalBusinessWeights.put(field, Math.round(finalWeight * <span class="hljs-number">100.0</span>) / <span class="hljs-number">100.0</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// 无行为数据的字段，直接使用语义权重</span>
                finalBusinessWeights.put(field, semanticWeights.<span class="hljs-keyword">get</span>(field));
            }
        }
        
        <span class="hljs-comment">// 按最终业务权重降序排序</span>
        <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">Map</span>.Entry&lt;<span class="hljs-built_in">String</span>, Double&gt;&gt; rankedFields = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(finalBusinessWeights.entrySet());
        rankedFields.sort((entry1, entry2) -&gt; Double.compare(entry2.getValue(), entry1.getValue()));
        
        <span class="hljs-keyword">return</span> rankedFields;
    }
}

<span class="hljs-comment">// 排序结果示例（采购专员-紧急采购场景）</span>
<span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">Map</span>.Entry&lt;<span class="hljs-built_in">String</span>, Double&gt;&gt; rankedFields = [
    entry(<span class="hljs-string">"supplierCode"</span>, <span class="hljs-number">0.94</span>),   <span class="hljs-comment">// 最终权重最高</span>
    entry(<span class="hljs-string">"productCode"</span>, <span class="hljs-number">0.92</span>),    <span class="hljs-comment">// 次高</span>
    entry(<span class="hljs-string">"supplierName"</span>, <span class="hljs-number">0.89</span>),   <span class="hljs-comment">// 第三</span>
    entry(<span class="hljs-string">"inboundWarehouse"</span>, <span class="hljs-number">0.85</span>),<span class="hljs-comment">// 第四</span>
    entry(<span class="hljs-string">"paymentMethod"</span>, <span class="hljs-number">0.83</span>),  <span class="hljs-comment">// 第五</span>
    <span class="hljs-comment">// ... 其余字段按权重排序</span>
];
</code></pre>
<h3 data-id="heading-10">三、技术实现：基于业务权重的智能布局方案生成</h3>
<p>基于最终业务权重排序结果，Ooder AI依托Ooder全栈框架的智能决策与生成引擎，自动生成“场景-角色双适配”的布局方案。核心实现逻辑是“高权重字段前置聚类+低权重字段折叠隐藏+业务流程顺序对齐”，同时生成可直接对接前端的布局代码，充分体现Ooder全栈框架“决策-生成-落地”的端到端优势。</p>
<pre><code class="hljs language-swift" lang="swift">
<span class="hljs-comment">// Ooder全栈框架 智能布局方案生成核心代码</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ErpSmartLayoutGenerator</span> {
    <span class="hljs-comment">// 高权重阈值（基于业务经验与数据统计预设）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> double <span class="hljs-type">HIGH_WEIGHT_THRESHOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.8</span>;
    <span class="hljs-comment">// 中权重阈值</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> double <span class="hljs-type">MEDIUM_WEIGHT_THRESHOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.5</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">ErpLayoutScheme</span> generateLayoutScheme(<span class="hljs-type">List</span>&lt;<span class="hljs-type">Map</span>.<span class="hljs-type">Entry</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;&gt; rankedFields,<span class="hljs-operator">&amp;</span>#xA                                               <span class="hljs-type">String</span> businessScenario,<span class="hljs-operator">&amp;</span>#xA                                               <span class="hljs-type">String</span> roleType) {
        <span class="hljs-type">ErpLayoutScheme</span> layoutScheme <span class="hljs-operator">=</span> new <span class="hljs-type">ErpLayoutScheme</span>();
        layoutScheme.setScenario(businessScenario);
        layoutScheme.setRole(roleType);
        
        <span class="hljs-comment">// 1. 字段分组：高权重（固定前置）、中权重（可折叠）、低权重（隐藏，需手动展开）</span>
        <span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt; highWeightFields <span class="hljs-operator">=</span> new <span class="hljs-type">ArrayList</span>&lt;&gt;();
        <span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt; mediumWeightFields <span class="hljs-operator">=</span> new <span class="hljs-type">ArrayList</span>&lt;&gt;();
        <span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt; lowWeightFields <span class="hljs-operator">=</span> new <span class="hljs-type">ArrayList</span>&lt;&gt;();
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">Map</span>.<span class="hljs-type">Entry</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt; entry : rankedFields) {
            <span class="hljs-type">String</span> field <span class="hljs-operator">=</span> entry.getKey();
            double weight <span class="hljs-operator">=</span> entry.getValue();
            <span class="hljs-keyword">if</span> (weight <span class="hljs-operator">&gt;</span> <span class="hljs-type">HIGH_WEIGHT_THRESHOLD</span>) {
                highWeightFields.add(field);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (weight <span class="hljs-operator">&gt;</span> <span class="hljs-type">MEDIUM_WEIGHT_THRESHOLD</span>) {
                mediumWeightFields.add(field);
            } <span class="hljs-keyword">else</span> {
                lowWeightFields.add(field);
            }
        }
        
        <span class="hljs-comment">// 2. 高权重字段聚类：按业务流程顺序排序（依托Ooder全栈框架的业务流程模型）</span>
        <span class="hljs-type">ErpBusinessProcessModel</span> processModel <span class="hljs-operator">=</span> <span class="hljs-type">OoderFramework</span>.getBusinessProcessModel(<span class="hljs-type">ErpBusinessProcess</span>.<span class="hljs-type">PURCHASE</span>);
        <span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt; clusteredHighWeightFields <span class="hljs-operator">=</span> processModel.sortFieldsByProcessOrder(highWeightFields);
        
        <span class="hljs-comment">// 3. 布局方案赋值</span>
        layoutScheme.setFixedPanelFields(clusteredHighWeightFields); <span class="hljs-comment">// 高权重字段放左侧固定面板</span>
        layoutScheme.setCollapsiblePanelFields(mediumWeightFields); <span class="hljs-comment">// 中权重放右侧可折叠面板</span>
        layoutScheme.setHiddenPanelFields(lowWeightFields);         <span class="hljs-comment">// 低权重放隐藏面板</span>
        
        <span class="hljs-comment">// 4. 生成前端布局代码（Ooder全栈框架内置代码生成器，支持Vue/React等主流框架）</span>
        <span class="hljs-type">String</span> layoutCode <span class="hljs-operator">=</span> generateFrontendLayoutCode(layoutScheme);
        layoutScheme.setFrontendLayoutCode(layoutCode);
        
        <span class="hljs-keyword">return</span> layoutScheme;
    }
    
    <span class="hljs-comment">// 生成前端布局代码（以Vue为例）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> generateFrontendLayoutCode(<span class="hljs-type">ErpLayoutScheme</span> scheme) {
        <span class="hljs-type">StringBuilder</span> codeBuilder <span class="hljs-operator">=</span> new <span class="hljs-type">StringBuilder</span>();
        <span class="hljs-comment">// 左侧固定面板（高权重字段）</span>
        codeBuilder.append(<span class="hljs-string">"&lt;el-container&gt;<span class="hljs-subst">\n</span>"</span>);
        codeBuilder.append(<span class="hljs-string">"  &lt;el-aside width="</span>300px<span class="hljs-string">"&gt;<span class="hljs-subst">\n</span>"</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-type">String</span> field : scheme.getFixedPanelFields()) {
            codeBuilder.append(<span class="hljs-string">"    &lt;el-form-item label="</span><span class="hljs-string">").append(getFieldCaption(field)).append("</span><span class="hljs-string">"&gt;<span class="hljs-subst">\n</span>"</span>);
            codeBuilder.append(<span class="hljs-string">"      &lt;el-input v-model="</span>form.<span class="hljs-string">").append(field).append("</span><span class="hljs-string">"&gt;&lt;/el-input&gt;<span class="hljs-subst">\n</span>"</span>);
            codeBuilder.append(<span class="hljs-string">"    &lt;/el-form-item&gt;<span class="hljs-subst">\n</span>"</span>);
        }
        codeBuilder.append(<span class="hljs-string">"  &lt;/el-aside&gt;<span class="hljs-subst">\n</span>"</span>);
        <span class="hljs-comment">// 右侧可折叠面板（中权重字段）</span>
        codeBuilder.append(<span class="hljs-string">"  &lt;el-main&gt;<span class="hljs-subst">\n</span>"</span>);
        codeBuilder.append(<span class="hljs-string">"    &lt;el-collapse&gt;<span class="hljs-subst">\n</span>"</span>);
        codeBuilder.append(<span class="hljs-string">"      &lt;el-collapse-item title="</span>其他配置<span class="hljs-string">"&gt;<span class="hljs-subst">\n</span>"</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-type">String</span> field : scheme.getCollapsiblePanelFields()) {
            codeBuilder.append(<span class="hljs-string">"        &lt;el-form-item label="</span><span class="hljs-string">").append(getFieldCaption(field)).append("</span><span class="hljs-string">"&gt;<span class="hljs-subst">\n</span>"</span>);
            codeBuilder.append(<span class="hljs-string">"          &lt;el-input v-model="</span>form.<span class="hljs-string">").append(field).append("</span><span class="hljs-string">"&gt;&lt;/el-input&gt;<span class="hljs-subst">\n</span>"</span>);
            codeBuilder.append(<span class="hljs-string">"        &lt;/el-form-item&gt;<span class="hljs-subst">\n</span>"</span>);
        }
        codeBuilder.append(<span class="hljs-string">"      &lt;/el-collapse-item&gt;<span class="hljs-subst">\n</span>"</span>);
        codeBuilder.append(<span class="hljs-string">"    &lt;/el-collapse&gt;<span class="hljs-subst">\n</span>"</span>);
        <span class="hljs-comment">// 隐藏面板（低权重字段，需手动展开）</span>
        codeBuilder.append(<span class="hljs-string">"    &lt;el-button @click="</span>showHiddenFields<span class="hljs-string">"&gt;显示更多配置&lt;/el-button&gt;<span class="hljs-subst">\n</span>"</span>);
        codeBuilder.append(<span class="hljs-string">"    &lt;div v-if="</span>showHidden<span class="hljs-string">"&gt;<span class="hljs-subst">\n</span>"</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-type">String</span> field : scheme.getHiddenPanelFields()) {
            codeBuilder.append(<span class="hljs-string">"      &lt;el-form-item label="</span><span class="hljs-string">").append(getFieldCaption(field)).append("</span><span class="hljs-string">"&gt;<span class="hljs-subst">\n</span>"</span>);
            codeBuilder.append(<span class="hljs-string">"        &lt;el-input v-model="</span>form.<span class="hljs-string">").append(field).append("</span><span class="hljs-string">"&gt;&lt;/el-input&gt;<span class="hljs-subst">\n</span>"</span>);
            codeBuilder.append(<span class="hljs-string">"      &lt;/el-form-item&gt;<span class="hljs-subst">\n</span>"</span>);
        }
        codeBuilder.append(<span class="hljs-string">"    &lt;/div&gt;<span class="hljs-subst">\n</span>"</span>);
        codeBuilder.append(<span class="hljs-string">"  &lt;/el-main&gt;<span class="hljs-subst">\n</span>"</span>);
        codeBuilder.append(<span class="hljs-string">"&lt;/el-container&gt;"</span>);
        <span class="hljs-keyword">return</span> codeBuilder.toString();
    }
}
</code></pre>
<pre><code class="hljs language-arduino" lang="arduino">
<span class="hljs-comment">// Ooder企业级AI 的ERP业务规则导向型智能校验模型</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ErpBusinessRuleBasedValidator</span> {
    <span class="hljs-comment">// 基于当前ERP业务场景，识别高频错误场景并校验</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;ErpBusinessRiskAlert&gt; <span class="hljs-title">validateByErpBusinessScenario</span><span class="hljs-params">(Map&lt;<span class="hljs-type">String</span>, Object&gt; currentConfig, <span class="hljs-type">String</span> erpBusinessScenario)</span> </span>{
        List&lt;ErpBusinessRiskAlert&gt; alerts = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
        
        <span class="hljs-comment">// 场景1：紧急采购场景 - 强关联业务字段遗漏</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"紧急采购"</span>.<span class="hljs-built_in">equals</span>(erpBusinessScenario) 
                &amp;&amp; currentConfig.<span class="hljs-built_in">containsKey</span>(<span class="hljs-string">"productCode"</span>) 
                &amp;&amp; !currentConfig.<span class="hljs-built_in">containsKey</span>(<span class="hljs-string">"inboundWarehouse"</span>)) {
            alerts.<span class="hljs-built_in">add</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">ErpBusinessRiskAlert</span>(
                <span class="hljs-string">"紧急采购关联字段遗漏"</span>,
                <span class="hljs-string">"根据ERP紧急采购业务规则，配置采购商品后需同步设置入库仓库（否则将导致商品到港后无法及时入库，影响生产进度）"</span>,
                <span class="hljs-string">"业务影响等级：高 | 解决方案：1. 自动跳转至入库仓库配置项 2. 采用默认生产入库仓库"</span>,
                ErpBusinessRiskLevel.<span class="hljs-literal">HIGH</span>,
                <span class="hljs-comment">// 提供ERP业务层面的快速修复选项</span>
                Arrays.<span class="hljs-built_in">asList</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">QuickFix</span>(<span class="hljs-string">"自动跳转配置"</span>, <span class="hljs-string">"jumpToField('inboundWarehouse')"</span>),
                            <span class="hljs-keyword">new</span> <span class="hljs-built_in">QuickFix</span>(<span class="hljs-string">"使用默认仓库"</span>, <span class="hljs-string">"setDefaultValue('inboundWarehouse', '生产一号仓')"</span>))
            ));
        }
        
        <span class="hljs-comment">// 场景2：批量采购场景 - 业务逻辑冲突</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"批量采购"</span>.<span class="hljs-built_in">equals</span>(erpBusinessScenario)
                &amp;&amp; currentConfig.<span class="hljs-built_in">containsKey</span>(<span class="hljs-string">"purchaseQuantity"</span>) 
                &amp;&amp; currentConfig.<span class="hljs-built_in">containsKey</span>(<span class="hljs-string">"minOrderQuantity"</span>)) {
            <span class="hljs-type">int</span> purchaseQty = (<span class="hljs-type">int</span>) currentConfig.<span class="hljs-built_in">get</span>(<span class="hljs-string">"purchaseQuantity"</span>);
            <span class="hljs-type">int</span> minOrderQty = (<span class="hljs-type">int</span>) currentConfig.<span class="hljs-built_in">get</span>(<span class="hljs-string">"minOrderQuantity"</span>);
            <span class="hljs-comment">// 批量采购业务规则：采购数量需大于等于最小起订量，且折扣比例不超过15%</span>
            <span class="hljs-keyword">if</span> (purchaseQty &lt; minOrderQty) {
                alerts.<span class="hljs-built_in">add</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">ErpBusinessRiskAlert</span>(
                    <span class="hljs-string">"批量采购逻辑冲突"</span>,
                    <span class="hljs-string">"ERP批量采购业务规则要求采购数量不小于最小起订量（"</span> + minOrderQty + <span class="hljs-string">"）（否则供应商将拒绝接单，导致采购失败）"</span>,
                    <span class="hljs-string">"业务影响等级：高 | 解决方案：自动将采购数量调整为最小起订量"</span>,
                    ErpBusinessRiskLevel.<span class="hljs-literal">HIGH</span>,
                    Arrays.<span class="hljs-built_in">asList</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">QuickFix</span>(<span class="hljs-string">"自动调整"</span>, <span class="hljs-string">"adjustFieldValue('purchaseQuantity', minOrderQty)"</span>))
                ));
            }
        }
        
        <span class="hljs-comment">// 场景3：通用采购场景 - 非标准值配置（关联ERP业务影响）</span>
        <span class="hljs-keyword">if</span> (currentConfig.<span class="hljs-built_in">containsKey</span>(<span class="hljs-string">"paymentTerm"</span>) 
                &amp;&amp; !<span class="hljs-built_in">isValidPaymentTerm</span>((<span class="hljs-type">String</span>) currentConfig.<span class="hljs-built_in">get</span>(<span class="hljs-string">"paymentTerm"</span>))) {
            alerts.<span class="hljs-built_in">add</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">ErpBusinessRiskAlert</span>(
                <span class="hljs-string">"付款期限非标准配置"</span>,
                <span class="hljs-string">"输入的付款期限非ERP标准付款期限，将导致"</span> + <span class="hljs-built_in">getErpBusinessImpactByScenario</span>(erpBusinessScenario) + <span class="hljs-string">"（如紧急采购场景将导致审批流程停滞，影响采购时效）"</span>,
                <span class="hljs-string">"业务影响等级：中 | 解决方案：从ERP标准付款期限列表中选择"</span>,
                ErpBusinessRiskLevel.MEDIUM,
                Arrays.<span class="hljs-built_in">asList</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">QuickFix</span>(<span class="hljs-string">"查看标准列表"</span>, <span class="hljs-string">"showRecommendedList('paymentTerm', getRecommendedPaymentTerms(erpBusinessScenario))"</span>))
            ));
        }
        
        <span class="hljs-keyword">return</span> alerts;
    }
    
    <span class="hljs-comment">// 精准识别配置错误对当前ERP业务场景的影响</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-title">getErpBusinessImpactByScenario</span><span class="hljs-params">(<span class="hljs-type">String</span> erpBusinessScenario)</span> </span>{
        Map&lt;<span class="hljs-type">String</span>, <span class="hljs-type">String</span>&gt; impactMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
        impactMap.<span class="hljs-built_in">put</span>(<span class="hljs-string">"紧急采购"</span>, <span class="hljs-string">"采购审批停滞，影响生产进度"</span>);
        impactMap.<span class="hljs-built_in">put</span>(<span class="hljs-string">"批量采购"</span>, <span class="hljs-string">"供应商拒绝接单，采购失败"</span>);
        impactMap.<span class="hljs-built_in">put</span>(<span class="hljs-string">"常规采购"</span>, <span class="hljs-string">"财务结算异常，对账困难"</span>);
        <span class="hljs-keyword">return</span> impactMap.<span class="hljs-built_in">getOrDefault</span>(erpBusinessScenario, <span class="hljs-string">"ERP业务流程异常"</span>);
    }
}
</code></pre>
<p>在多字段表单智能布局的全流程中，Ooder全栈框架的技术优势贯穿始终，主要体现在三个核心维度：</p>
<h3 data-id="heading-11">四、Ooder全栈框架的核心技术优势总结</h3>
<ol>
<li><strong>多源数据融合解析优势</strong>：内置预训练行业语义模型与多源数据采集接口，实现代码、业务手册、操作日志的无缝融合解析，无需人工干预即可精准提取业务逻辑，语义相似度计算精度达92%以上，为业务权重判断提供可靠数据基础。</li>
<li><strong>轻量化高效建模优势</strong>：采用轻量化行为特征提取算法，处理海量操作日志时效率是传统方案的3倍；业务权重计算与布局决策全流程耗时不足10秒，大幅提升开发效率，避免传统布局方案“反复调研-调整”的低效循环。</li>
<li><strong>端到端落地优势</strong>：实现“业务理解-权重排序-布局方案-前端代码”的端到端生成，生成的代码可直接对接主流前端框架，代码复用率提升60%以上；同时支持场景与角色的动态适配，无需为不同场景/角色单独开发布局，大幅降低维护成本。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS 和 HarmonyOS 兼容笔记]]></title>    <link>https://juejin.cn/post/7587343333330255906</link>    <guid>https://juejin.cn/post/7587343333330255906</guid>    <pubDate>2025-12-25T08:31:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587343333330255906" data-draft-id="7587473691169079296" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS 和 HarmonyOS 兼容笔记"/> <meta itemprop="keywords" content="uni-app"/> <meta itemprop="datePublished" content="2025-12-25T08:31:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="吴汉三"/> <meta itemprop="url" content="https://juejin.cn/user/1591748568286510"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS 和 HarmonyOS 兼容笔记
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1591748568286510/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    吴汉三
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T08:31:40.000Z" title="Thu Dec 25 2025 08:31:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. iOS 审核域名限制问题</h2>
<h3 data-id="heading-1">问题描述</h3>
<p>iOS 审核人员位于国外，App 内访问的 API 域名需要能在外网访问，否则可能导致审核失败。</p>
<h3 data-id="heading-2">解决方案</h3>
<p>确保所有 API 域名都能在外网访问，或提供审核专用的 API 环境。</p>
<h3 data-id="heading-3">代码示例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 配置 API 域名时考虑审核需求</span>
<span class="hljs-keyword">const</span> isProduction = process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>;
<span class="hljs-keyword">const</span> isReview = process.<span class="hljs-property">env</span>.<span class="hljs-property">VUE_APP_REVIEW</span> === <span class="hljs-string">'true'</span>;

<span class="hljs-comment">// 审核环境使用可外网访问的域名</span>
<span class="hljs-keyword">const</span> baseUrl = isReview ? <span class="hljs-string">'https://review-api.example.com'</span> : 
               isProduction ? <span class="hljs-string">'https://api.example.com'</span> : 
               <span class="hljs-string">'http://dev-api.example.com'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  baseUrl
};
</code></pre>
<h2 data-id="heading-4">2. iOS scroll-view 内 fixed 定位弹框被遮挡</h2>
<h3 data-id="heading-5">问题描述</h3>
<p>在 iOS 设备上，scroll-view 组件内部的 fixed 定位弹框内容会被遮挡，无法正常显示。</p>
<h3 data-id="heading-6">解决方案</h3>
<p>将弹框移出 scroll-view 组件，或使用其他定位方式。</p>
<h3 data-id="heading-7">代码示例</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 错误示例：fixed 定位弹框在 scroll-view 内部 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">scroll-view</span> <span class="hljs-attr">scroll-y</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"height: 100vh;"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">view</span>&gt;</span>scroll-view 内容<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"popup"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);"</span>&gt;</span>
    弹框内容
  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">scroll-view</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 正确示例：fixed 定位弹框在 scroll-view 外部 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">scroll-view</span> <span class="hljs-attr">scroll-y</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"height: 100vh;"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">view</span>&gt;</span>scroll-view 内容<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">scroll-view</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"popup"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);"</span>&gt;</span>
  弹框内容
<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
</code></pre>
<h2 data-id="heading-8">3. iOS plus.io.chooseFile() 返回路径处理问题</h2>
<h3 data-id="heading-9">问题描述</h3>
<p>在 iOS 上，<code>plus.io.chooseFile().then(res =&gt; {})</code> 返回的 <code>res.files[0]</code> 已经是可直接读取的绝对路径，不能再用 <code>plus.io.convertLocalFileSystemURL</code> 去转换，否则会拼接出不合法的路径，导致 <code>uni.uploadFile</code> 读取不到文件体。</p>
<h3 data-id="heading-10">解决方案</h3>
<p>根据平台判断是否需要转换路径。</p>
<h3 data-id="heading-11">代码示例</h3>
<pre><code class="hljs language-javascript" lang="javascript">plus.<span class="hljs-property">io</span>.<span class="hljs-title function_">chooseFile</span>({
  <span class="hljs-attr">title</span>: <span class="hljs-string">'选择文件'</span>,
  <span class="hljs-attr">filter</span>: {
    <span class="hljs-attr">mimeTypes</span>: [<span class="hljs-string">'image/*'</span>]
  }
}).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
  <span class="hljs-keyword">let</span> filePath = res.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>];
  
  <span class="hljs-comment">// 根据平台判断是否需要转换路径</span>
  <span class="hljs-keyword">if</span> (uni.<span class="hljs-title function_">getSystemInfoSync</span>().<span class="hljs-property">platform</span> !== <span class="hljs-string">'ios'</span>) {
    <span class="hljs-comment">// 非 iOS 平台需要转换路径</span>
    filePath = plus.<span class="hljs-property">io</span>.<span class="hljs-title function_">convertLocalFileSystemURL</span>(filePath);
  }
  
  <span class="hljs-comment">// 使用转换后的路径进行文件上传</span>
  uni.<span class="hljs-title function_">uploadFile</span>({
    <span class="hljs-attr">url</span>: <span class="hljs-string">'https://api.example.com/upload'</span>,
    <span class="hljs-attr">filePath</span>: filePath,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'file'</span>,
    <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">uploadRes</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'上传成功'</span>, uploadRes);
    },
    <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'上传失败'</span>, err);
    }
  });
});
</code></pre>
<h2 data-id="heading-12">4. HarmonyOS picker 组件异步数据渲染问题</h2>
<h3 data-id="heading-13">问题描述</h3>
<p>在 HarmonyOS 设备上，内置组件 picker 的 range 使用异步数据时，需要使用 v-if 或 v-show 控制在获取到数据后再渲染 picker 组件，否则 picker 组件弹框不会显示。</p>
<h3 data-id="heading-14">解决方案</h3>
<p>使用 v-if 或 v-show 控制 picker 组件的渲染时机，确保在数据加载完成后再渲染。</p>
<h3 data-id="heading-15">代码示例</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;view&gt;
    &lt;button @click="showPicker = true"&gt;显示选择器&lt;/button&gt;
    
    &lt;!-- 使用 v-if 控制 picker 组件渲染时机 --&gt;
    &lt;picker
      v-if="pickerData.length &gt; 0"
      v-model="selectedIndex"
      :range="pickerData"
      @change="onPickerChange"
      v-show="showPicker"
    &gt;&lt;/picker&gt;
  &lt;/view&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  data() {
    return {
      pickerData: [],
      selectedIndex: 0,
      showPicker: false
    };
  },
  onLoad() {
    // 异步获取数据
    this.loadPickerData();
  },
  methods: {
    loadPickerData() {
      // 模拟异步请求
      setTimeout(() =&gt; {
        this.pickerData = ['选项1', '选项2', '选项3', '选项4', '选项5'];
      }, 1000);
    },
    onPickerChange(e) {
      console.log('选择了', this.pickerData[e.detail.value]);
      this.showPicker = false;
    }
  }
};
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-16">5. HarmonyOS uni.getLocation 坐标系转换问题</h2>
<h3 data-id="heading-17">问题描述</h3>
<p>在鸿蒙设备上使用 <code>uni.getLocation</code> 获取定位是通过鸿蒙系统定位，获取到的定位坐标系是国际坐标系（wgs84），需要进行坐标系转换得到国测局坐标系（gcj02）才能在高德地图 API 上使用。</p>
<h3 data-id="heading-18">解决方案</h3>
<p>使用坐标系转换算法将 wgs84 转换为 gcj02。</p>
<h3 data-id="heading-19">代码示例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 坐标系转换算法（wgs84 转 gcj02）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">wgs84togcj02</span>(<span class="hljs-params">lng, lat</span>) {
  <span class="hljs-keyword">const</span> pi = <span class="hljs-number">3.1415926535897932384626</span>;
  <span class="hljs-keyword">const</span> a = <span class="hljs-number">6378245.0</span>;
  <span class="hljs-keyword">const</span> ee = <span class="hljs-number">0.00669342162296594323</span>;
  
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">out_of_china</span>(lng, lat)) {
    <span class="hljs-keyword">return</span> [lng, lat];
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">let</span> dlat = <span class="hljs-title function_">transformlat</span>(lng - <span class="hljs-number">105.0</span>, lat - <span class="hljs-number">35.0</span>);
    <span class="hljs-keyword">let</span> dlng = <span class="hljs-title function_">transformlng</span>(lng - <span class="hljs-number">105.0</span>, lat - <span class="hljs-number">35.0</span>);
    <span class="hljs-keyword">const</span> radlat = lat / <span class="hljs-number">180.0</span> * pi;
    <span class="hljs-keyword">let</span> magic = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(radlat);
    magic = <span class="hljs-number">1</span> - ee * magic * magic;
    <span class="hljs-keyword">const</span> sqrtmagic = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(magic);
    dlat = (dlat * <span class="hljs-number">180.0</span>) / ((a * (<span class="hljs-number">1</span> - ee)) / (magic * sqrtmagic) * pi);
    dlng = (dlng * <span class="hljs-number">180.0</span>) / (a / sqrtmagic * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(radlat) * pi);
    <span class="hljs-keyword">const</span> mglat = lat + dlat;
    <span class="hljs-keyword">const</span> mglng = lng + dlng;
    <span class="hljs-keyword">return</span> [mglng, mglat];
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">transformlat</span>(<span class="hljs-params">lng, lat</span>) {
  <span class="hljs-keyword">const</span> pi = <span class="hljs-number">3.1415926535897932384626</span>;
  <span class="hljs-keyword">let</span> ret = -<span class="hljs-number">100.0</span> + <span class="hljs-number">2.0</span> * lng + <span class="hljs-number">3.0</span> * lat + <span class="hljs-number">0.2</span> * lat * lat + <span class="hljs-number">0.1</span> * lng * lat + <span class="hljs-number">0.2</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(lng));
  ret += (<span class="hljs-number">20.0</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-number">6.0</span> * lng * pi) + <span class="hljs-number">20.0</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-number">2.0</span> * lng * pi)) * <span class="hljs-number">2.0</span> / <span class="hljs-number">3.0</span>;
  ret += (<span class="hljs-number">20.0</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(lat * pi) + <span class="hljs-number">40.0</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(lat / <span class="hljs-number">3.0</span> * pi)) * <span class="hljs-number">2.0</span> / <span class="hljs-number">3.0</span>;
  ret += (<span class="hljs-number">160.0</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(lat / <span class="hljs-number">12.0</span> * pi) + <span class="hljs-number">320</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(lat * pi / <span class="hljs-number">30.0</span>)) * <span class="hljs-number">2.0</span> / <span class="hljs-number">3.0</span>;
  <span class="hljs-keyword">return</span> ret;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">transformlng</span>(<span class="hljs-params">lng, lat</span>) {
  <span class="hljs-keyword">const</span> pi = <span class="hljs-number">3.1415926535897932384626</span>;
  <span class="hljs-keyword">let</span> ret = <span class="hljs-number">300.0</span> + lng + <span class="hljs-number">2.0</span> * lat + <span class="hljs-number">0.1</span> * lng * lng + <span class="hljs-number">0.1</span> * lng * lat + <span class="hljs-number">0.1</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(lng));
  ret += (<span class="hljs-number">20.0</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-number">6.0</span> * lng * pi) + <span class="hljs-number">20.0</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-number">2.0</span> * lng * pi)) * <span class="hljs-number">2.0</span> / <span class="hljs-number">3.0</span>;
  ret += (<span class="hljs-number">20.0</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(lng * pi) + <span class="hljs-number">40.0</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(lng / <span class="hljs-number">3.0</span> * pi)) * <span class="hljs-number">2.0</span> / <span class="hljs-number">3.0</span>;
  ret += (<span class="hljs-number">150.0</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(lng / <span class="hljs-number">12.0</span> * pi) + <span class="hljs-number">300.0</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(lng / <span class="hljs-number">30.0</span> * pi)) * <span class="hljs-number">2.0</span> / <span class="hljs-number">3.0</span>;
  <span class="hljs-keyword">return</span> ret;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">out_of_china</span>(<span class="hljs-params">lng, lat</span>) {
  <span class="hljs-keyword">return</span> (lng &lt; <span class="hljs-number">72.004</span> || lng &gt; <span class="hljs-number">137.8347</span>) || ((lat &lt; <span class="hljs-number">0.8293</span> || lat &gt; <span class="hljs-number">55.8271</span>) || <span class="hljs-literal">false</span>);
}

<span class="hljs-comment">// 使用示例</span>
uni.<span class="hljs-title function_">getLocation</span>({
  <span class="hljs-attr">type</span>: <span class="hljs-string">'gcj02'</span>,
  <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> lng = res.<span class="hljs-property">longitude</span>;
    <span class="hljs-keyword">let</span> lat = res.<span class="hljs-property">latitude</span>;
    
    <span class="hljs-comment">// 如果是鸿蒙设备，需要进行坐标系转换</span>
    <span class="hljs-keyword">const</span> systemInfo = uni.<span class="hljs-title function_">getSystemInfoSync</span>();
    <span class="hljs-keyword">if</span> (systemInfo.<span class="hljs-property">platform</span> === <span class="hljs-string">'harmony'</span>) {
      <span class="hljs-comment">// 鸿蒙设备获取的是 wgs84 坐标系，需要转换为 gcj02</span>
      <span class="hljs-keyword">const</span> gcj02 = <span class="hljs-title function_">wgs84togcj02</span>(lng, lat);
      lng = gcj02[<span class="hljs-number">0</span>];
      lat = gcj02[<span class="hljs-number">1</span>];
    }
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'转换后的坐标'</span>, lng, lat);
    <span class="hljs-comment">// 使用转换后的坐标调用高德地图 API</span>
  }
});
</code></pre>
<h2 data-id="heading-20">6. HarmonyOS uni.chooseImage 不兼容 5.0</h2>
<h3 data-id="heading-21">问题描述</h3>
<p><code>uni.chooseImage</code> 不兼容 HarmonyOS 5.0，在该版本上无法正常使用。</p>
<h3 data-id="heading-22">解决方案</h3>
<p>使用 <code>plus.io.chooseFile</code> 替代 <code>uni.chooseImage</code>，或使用其他兼容方案。</p>
<h3 data-id="heading-23">代码示例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 兼容 HarmonyOS 5.0 的图片选择方法</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">chooseImage</span>(<span class="hljs-params">options</span>) {
  <span class="hljs-keyword">const</span> systemInfo = uni.<span class="hljs-title function_">getSystemInfoSync</span>();
  
  <span class="hljs-comment">// 如果是 HarmonyOS 5.0 或以上版本，使用 plus.io.chooseFile</span>
  <span class="hljs-keyword">if</span> (systemInfo.<span class="hljs-property">platform</span> === <span class="hljs-string">'harmony'</span> &amp;&amp; <span class="hljs-built_in">parseFloat</span>(systemInfo.<span class="hljs-property">osVersion</span>) &gt;= <span class="hljs-number">5.0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      plus.<span class="hljs-property">io</span>.<span class="hljs-title function_">chooseFile</span>({
        <span class="hljs-attr">title</span>: <span class="hljs-string">'选择图片'</span>,
        <span class="hljs-attr">filter</span>: {
          <span class="hljs-attr">mimeTypes</span>: [<span class="hljs-string">'image/*'</span>]
        },
        <span class="hljs-attr">multiple</span>: options.<span class="hljs-property">count</span> &gt; <span class="hljs-number">1</span>,
        <span class="hljs-attr">maxSelect</span>: options.<span class="hljs-property">count</span>
      }).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> tempFilePaths = res.<span class="hljs-property">files</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> {
          <span class="hljs-keyword">return</span> plus.<span class="hljs-property">io</span>.<span class="hljs-title function_">convertLocalFileSystemURL</span>(file);
        });
        <span class="hljs-title function_">resolve</span>({ tempFilePaths });
      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
        <span class="hljs-title function_">reject</span>(err);
      });
    });
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 其他平台使用 uni.chooseImage</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      uni.<span class="hljs-title function_">chooseImage</span>({
        <span class="hljs-attr">count</span>: options.<span class="hljs-property">count</span>,
        <span class="hljs-attr">success</span>: resolve,
        <span class="hljs-attr">fail</span>: reject
      });
    });
  }
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-title function_">chooseImage</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> }).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'选择的图片'</span>, res.<span class="hljs-property">tempFilePaths</span>);
}).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'选择图片失败'</span>, err);
});
</code></pre>
<h2 data-id="heading-24">7. 高频同步 I/O 操作导致卡顿/闪退</h2>
<h3 data-id="heading-25">问题描述</h3>
<p>在列表渲染期间，高频地在主线程上执行同步 I/O 操作，会严重阻塞 UI 渲染，导致应用卡顿、无响应（ANR），而在一些对主线程管控更严格的系统（如 HarmonyOS Next）上，这很容易被判定为异常并导致闪退。</p>
<h3 data-id="heading-26">解决方案</h3>
<p>将同步 I/O 操作改为异步，或减少调用次数，或使用缓存。</p>
<h3 data-id="heading-27">代码示例</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;view&gt;
    &lt;list&gt;
      &lt;list-item v-for="item in listData" :key="item.id"&gt;
        &lt;text&gt;{{ item.title }}&lt;/text&gt;
        &lt;text&gt;{{ item.status }}&lt;/text&gt;
      &lt;/list-item&gt;
    &lt;/list&gt;
  &lt;/view&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  data() {
    return {
      listData: []
    };
  },
  onLoad() {
    this.loadListData();
  },
  methods: {
    // 错误示例：列表渲染时多次调用 uni.getStorageSync
    loadListData() {
      // 模拟获取列表数据
      const list = [];
      for (let i = 0; i &lt; 100; i++) {
        list.push({ id: i, title: '项目' + i });
      }
      
      // 错误：在循环中多次调用同步 I/O 操作
      list.forEach(item =&gt; {
        // 这会导致严重的性能问题
        const status = uni.getStorageSync(`item_status_${item.id}`);
        item.status = status || '默认状态';
      });
      
      this.listData = list;
    }
  }
};
&lt;/script&gt;

&lt;script&gt;
// 正确示例：使用异步方法或减少调用次数
export default {
  data() {
    return {
      listData: []
    };
  },
  onLoad() {
    this.loadListData();
  },
  methods: {
    async loadListData() {
      // 模拟获取列表数据
      const list = [];
      for (let i = 0; i &lt; 100; i++) {
        list.push({ id: i, title: '项目' + i });
      }
      
      // 正确：一次性获取所有需要的数据
      const allStatus = await this.getAllItemStatus(list);
      
      // 合并数据
      list.forEach(item =&gt; {
        item.status = allStatus[`item_status_${item.id}`] || '默认状态';
      });
      
      this.listData = list;
    },
    // 一次性获取所有需要的数据
    getAllItemStatus(list) {
      return new Promise((resolve) =&gt; {
        // 在实际应用中，可以使用异步方法批量获取数据
        // 这里模拟一次性获取所有状态
        const result = {};
        // 模拟异步操作
        setTimeout(() =&gt; {
          list.forEach(item =&gt; {
            result[`item_status_${item.id}`] = '状态' + item.id;
          });
          resolve(result);
        }, 100);
      });
    }
  }
};
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-28">8. HarmonyOS 页面多次调用 uni.getStorageSync 性能问题</h2>
<h3 data-id="heading-29">问题描述</h3>
<p>页面中多次调用 <code>uni.getStorageSync</code> 类似的同步方法，在鸿蒙设备上非常消耗性能，会造成页面加载渲染卡顿。</p>
<h3 data-id="heading-30">解决方案</h3>
<p>将多次调用改为单次调用，或使用异步方法，或使用缓存。</p>
<h3 data-id="heading-31">代码示例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 错误示例：多次调用 uni.getStorageSync</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">loadUserData</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> userId = uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">'user_id'</span>);
  <span class="hljs-keyword">const</span> userName = uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">'user_name'</span>);
  <span class="hljs-keyword">const</span> userAvatar = uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">'user_avatar'</span>);
  <span class="hljs-keyword">const</span> userGender = uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">'user_gender'</span>);
  <span class="hljs-keyword">const</span> userAge = uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">'user_age'</span>);
  
  <span class="hljs-keyword">return</span> {
    userId,
    userName,
    userAvatar,
    userGender,
    userAge
  };
}

<span class="hljs-comment">// 正确示例：使用异步方法一次性获取所有数据</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadUserData</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 方式一：使用异步方法</span>
  <span class="hljs-keyword">const</span> userInfo = <span class="hljs-keyword">await</span> uni.<span class="hljs-title function_">getStorage</span>({ <span class="hljs-attr">key</span>: <span class="hljs-string">'user_info'</span> });
  
  <span class="hljs-comment">// 方式二：如果数据分散存储，使用 Promise.all 并行获取</span>
  <span class="hljs-comment">/*
  const [userIdRes, userNameRes, userAvatarRes, userGenderRes, userAgeRes] = await Promise.all([
    uni.getStorage({ key: 'user_id' }),
    uni.getStorage({ key: 'user_name' }),
    uni.getStorage({ key: 'user_avatar' }),
    uni.getStorage({ key: 'user_gender' }),
    uni.getStorage({ key: 'user_age' })
  ]);
  
  const userInfo = {
    userId: userIdRes.data,
    userName: userNameRes.data,
    userAvatar: userAvatarRes.data,
    userGender: userGenderRes.data,
    userAge: userAgeRes.data
  };
  */</span>
  
  <span class="hljs-keyword">return</span> userInfo.<span class="hljs-property">data</span>;
}

<span class="hljs-comment">// 正确示例：将分散的数据合并存储</span>
<span class="hljs-comment">// 存储数据时</span>
uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">'user_info'</span>, {
  <span class="hljs-attr">userId</span>: <span class="hljs-string">'123'</span>,
  <span class="hljs-attr">userName</span>: <span class="hljs-string">'张三'</span>,
  <span class="hljs-attr">userAvatar</span>: <span class="hljs-string">'https://example.com/avatar.jpg'</span>,
  <span class="hljs-attr">userGender</span>: <span class="hljs-string">'男'</span>,
  <span class="hljs-attr">userAge</span>: <span class="hljs-number">25</span>
});
</code></pre>
<h2 data-id="heading-32">9. uni.<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>n</mi><mtext>、</mtext><mi>u</mi><mi>n</mi><mi>i</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">on、uni.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord cjk_fallback">、</span><span class="mord mathnormal">u</span><span class="mord mathnormal">ni</span><span class="mord">.</span></span></span></span></span>emit 跨页面通信在 H5 打包后失效</h2>
<h3 data-id="heading-33">问题描述</h3>
<p><code>uni.$on</code>、<code>uni.$emit</code> 事件，在打包成 H5 页面后不能跨页面通信。</p>
<h3 data-id="heading-34">解决方案</h3>
<p>使用其他跨页面通信方式，如 URL 参数、localStorage、vuex 等。</p>
<h3 data-id="heading-35">代码示例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 方案一：使用 URL 参数传递数据</span>
<span class="hljs-comment">// 页面 A</span>
uni.<span class="hljs-title function_">navigateTo</span>({
  <span class="hljs-attr">url</span>: <span class="hljs-string">`/pages/pageB/pageB?data=hello`</span>
});

<span class="hljs-comment">// 页面 B</span>
<span class="hljs-title function_">onLoad</span>(<span class="hljs-params">options</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(options.<span class="hljs-property">data</span>); <span class="hljs-comment">// hello</span>
}

<span class="hljs-comment">// 方案二：使用 localStorage 进行跨页面通信</span>
<span class="hljs-comment">// 页面 A</span>
uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">'pageData'</span>, { <span class="hljs-attr">message</span>: <span class="hljs-string">'hello'</span> });

<span class="hljs-comment">// 页面 B</span>
<span class="hljs-title function_">onShow</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> data = uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">'pageData'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data.<span class="hljs-property">message</span>); <span class="hljs-comment">// hello</span>
}

<span class="hljs-comment">// 方案三：使用 vuex 进行状态管理</span>
<span class="hljs-comment">// store/index.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Vuex</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vuex'</span>;

<span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Vuex</span>);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuex</span>.<span class="hljs-title class_">Store</span>({
  <span class="hljs-attr">state</span>: {
    <span class="hljs-attr">message</span>: <span class="hljs-string">''</span>
  },
  <span class="hljs-attr">mutations</span>: {
    <span class="hljs-title function_">setMessage</span>(<span class="hljs-params">state, message</span>) {
      state.<span class="hljs-property">message</span> = message;
    }
  },
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-title function_">updateMessage</span>(<span class="hljs-params">{ commit }, message</span>) {
      <span class="hljs-title function_">commit</span>(<span class="hljs-string">'setMessage'</span>, message);
    }
  },
  <span class="hljs-attr">getters</span>: {
    <span class="hljs-title function_">getMessage</span>(<span class="hljs-params">state</span>) {
      <span class="hljs-keyword">return</span> state.<span class="hljs-property">message</span>;
    }
  }
});

<span class="hljs-comment">// 页面 A</span>
<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store'</span>;
store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">'updateMessage'</span>, <span class="hljs-string">'hello'</span>);

<span class="hljs-comment">// 页面 B</span>
<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store'</span>;
<span class="hljs-title function_">onShow</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(store.<span class="hljs-property">getters</span>.<span class="hljs-property">getMessage</span>); <span class="hljs-comment">// hello</span>
}

<span class="hljs-comment">// 方案四：使用事件总线（适用于 Vue 2）</span>
<span class="hljs-comment">// main.js</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$bus</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>();

<span class="hljs-comment">// 页面 A</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">$bus</span>.$emit(<span class="hljs-string">'customEvent'</span>, { <span class="hljs-attr">message</span>: <span class="hljs-string">'hello'</span> });

<span class="hljs-comment">// 页面 B</span>
<span class="hljs-title function_">created</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">$bus</span>.$on(<span class="hljs-string">'customEvent'</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data.<span class="hljs-property">message</span>); <span class="hljs-comment">// hello</span>
  });
}
</code></pre>
<h2 data-id="heading-36">总结</h2>
<p>以上是 iOS 和 HarmonyOS 兼容开发中的常见问题及解决方案，包括：</p>
<ol>
<li>iOS 审核域名限制问题</li>
<li>iOS scroll-view 内 fixed 定位弹框被遮挡</li>
<li>iOS plus.io.chooseFile() 返回路径处理问题</li>
<li>HarmonyOS picker 组件异步数据渲染问题</li>
<li>HarmonyOS uni.getLocation 坐标系转换问题</li>
<li>HarmonyOS uni.chooseImage 不兼容 5.0</li>
<li>高频同步 I/O 操作导致卡顿/闪退</li>
<li>HarmonyOS 页面多次调用 uni.getStorageSync 性能问题</li>
<li>uni.<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>n</mi><mtext>、</mtext><mi>u</mi><mi>n</mi><mi>i</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">on、uni.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord cjk_fallback">、</span><span class="mord mathnormal">u</span><span class="mord mathnormal">ni</span><span class="mord">.</span></span></span></span></span>emit 跨页面通信在 H5 打包后失效</li>
</ol>
<p>在开发跨平台应用时，需要充分考虑不同平台的特性和限制，编写兼容代码，确保应用在各平台上都能正常运行。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MCP模型上下文协议 Model Context Protocol & 百度地图MCP开发]]></title>    <link>https://juejin.cn/post/7587459328070451210</link>    <guid>https://juejin.cn/post/7587459328070451210</guid>    <pubDate>2025-12-25T09:08:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587459328070451210" data-draft-id="7586836874015965194" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MCP模型上下文协议 Model Context Protocol &amp; 百度地图MCP开发"/> <meta itemprop="keywords" content="后端,Java,AI编程"/> <meta itemprop="datePublished" content="2025-12-25T09:08:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我家领养了个白胖胖"/> <meta itemprop="url" content="https://juejin.cn/user/1152746990351032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MCP模型上下文协议 Model Context Protocol &amp; 百度地图MCP开发
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1152746990351032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我家领养了个白胖胖
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T09:08:31.000Z" title="Thu Dec 25 2025 09:08:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">MCP模型上下文协议</h2>
<p>官网地址: <a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.io%2Fdocs%2Fgetting-started%2Fintro" target="_blank" title="https://modelcontextprotocol.io/docs/getting-started/intro" ref="nofollow noopener noreferrer">modelcontextprotocol.io/docs/gettin…</a></p>
<p>spring ai alibaba官网: <a href="https://link.juejin.cn?target=https%3A%2F%2Fjava2ai.com%2Fdocs%2F1.0.0.2%2Ftutorials%2Fbasics%2Fmodel-context-protocol%2F%3Fspm%3D4347728f.3bacb33c.0.0.49cda02dn2Rp5Y" target="_blank" title="https://java2ai.com/docs/1.0.0.2/tutorials/basics/model-context-protocol/?spm=4347728f.3bacb33c.0.0.49cda02dn2Rp5Y" ref="nofollow noopener noreferrer">java2ai.com/docs/1.0.0.…</a></p>
<p>mcp 模型地址: <a href="https://link.juejin.cn?target=https%3A%2F%2Fmcp.so%2Fzh" target="_blank" title="https://mcp.so/zh" ref="nofollow noopener noreferrer">mcp.so/zh</a></p>
<h3 data-id="heading-1">痛点？为什么出现MCP</h3>
<p>MCP准备取代工具调用(ToolCalling)</p>
<p>ToolCalling痛点: 需要为每个工具 <code>单独开发接口</code>，导致<code>重复劳动</code></p>
<p>痛点:</p>
<ul>
<li>模型之间调用遵循什么协议？</li>
<li>提供一个服务 （百度地铁MCP 一个服务可以看路线/规划/时间/坐标等信息）</li>
</ul>
<h3 data-id="heading-2">MCP入门概念</h3>
<p>MCP是一种开放协议，标准化应用程序如何向大模型（LLMS）提供上下文。MCP提供了一种<code>标准化的方式</code>将AI模型连接到不同的数据源和工具。大模型版本的openFeign。</p>
<h3 data-id="heading-3">MCP架构</h3>
<p>CS 客户端-服务器架构
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67acd2db0fdd4a6da77122872c14086f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5a626aKG5YW75LqG5Liq55m96IOW6IOW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767258511&amp;x-signature=WpdQgwh56uxJWngGItAvcfesbLY%3D" alt="image.png" loading="lazy"/></p>
<p>Spring AI MCP 采用模块化架构，包括以下组件：</p>
<ul>
<li>Spring AI 应用程序：使用 Spring AI 框架构建想要通过 MCP 访问数据的生成式 AI 应用程序</li>
<li>Spring MCP 客户端：MCP 协议的 Spring AI 实现，与服务器保持 1:1 连接</li>
<li>MCP 服务器：轻量级程序，每个程序都通过标准化的模型上下文协议公开特定的功能</li>
<li>本地数据源：MCP 服务器可以安全访问的计算机文件、数据库和服务</li>
<li>远程服务：MCP 服务器可以通过互联网（例如，通过 API）连接到的外部系统</li>
</ul>
<p>支持两种协议: SSE / STDIO</p>
<h3 data-id="heading-4">本地MCP开发步骤</h3>
<h4 data-id="heading-5">本地MCP 服务端实现</h4>
<h5 data-id="heading-6">建Module</h5>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f52ad12d1754a6bbd76514237789bcc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5a626aKG5YW75LqG5Liq55m96IOW6IOW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767258511&amp;x-signature=GlbFOfSxaEwANGOCWSLmxHCBrtE%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-7">POM文件</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.miao<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>SpringAIAlibaba-test01<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>SAA-11MCPServer<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-comment">&lt;!--   注意事项【重要】
            spring-ai-starter-mcp-server-webflux  这个依赖 只能用在 spring-boot-starter  不能用在 spring-boot-starter-web 上,
            否则会使用tomcat启动，而不是netty启动，从而导致mcpserver启动失败，但是程序正常运行,mcp服务连接不上
             --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-starter-mcp-server-webflux<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

        <span class="hljs-comment">&lt;!--  模型服务灵积  调用alibaba生态的协议 对标openai协议   --&gt;</span>
<span class="hljs-comment">&lt;!--        &lt;dependency&gt;--&gt;</span>
<span class="hljs-comment">&lt;!--            &lt;groupId&gt;com.alibaba.cloud.ai&lt;/groupId&gt;--&gt;</span>
<span class="hljs-comment">&lt;!--            &lt;artifactId&gt;spring-ai-alibaba-starter-dashscope&lt;/artifactId&gt;--&gt;</span>
<span class="hljs-comment">&lt;!--            &lt;version&gt;1.0.0.2&lt;/version&gt;--&gt;</span>
<span class="hljs-comment">&lt;!--        &lt;/dependency&gt;--&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.38<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>
</code></pre>
<h5 data-id="heading-8">yml配置</h5>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8014</span>
  <span class="hljs-attr">servlet:</span>
    <span class="hljs-attr">encoding:</span>
      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">force:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">charset:</span> <span class="hljs-string">UTF-8</span>

<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">SAA-11MCPServer</span>
  <span class="hljs-attr">ai:</span>
    <span class="hljs-attr">mcp:</span>
      <span class="hljs-attr">server:</span>
        <span class="hljs-attr">type:</span> <span class="hljs-string">async</span>
        <span class="hljs-attr">name:</span> <span class="hljs-string">mcp-server-miao</span>
        <span class="hljs-attr">version:</span> <span class="hljs-number">1.0</span><span class="hljs-number">.0</span>
</code></pre>
<h5 data-id="heading-9">业务提供WeatherService</h5>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">miao</span>.<span class="hljs-property">service</span>;

<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">ai</span>.<span class="hljs-property">tool</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Tool</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Service</span>;

<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">Map</span>;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WeatherService</span> {

    <span class="hljs-meta">@Tool</span>(description = <span class="hljs-string">"获取指定位置的天气信息"</span>, returnDirect = <span class="hljs-literal">false</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getWeather</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> location</span>) {
        <span class="hljs-comment">// 模拟获取天气信息的逻辑</span>
        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt; weatherData = <span class="hljs-title class_">Map</span>.<span class="hljs-title function_">of</span>(
                <span class="hljs-string">"北京"</span>, <span class="hljs-string">"晴天，温度20摄氏度"</span>,
                <span class="hljs-string">"上海"</span>, <span class="hljs-string">"多云，温度22摄氏度"</span>,
                <span class="hljs-string">"广州"</span>, <span class="hljs-string">"小雨，温度28摄氏度"</span>
        );
        <span class="hljs-keyword">return</span> weatherData.<span class="hljs-title function_">getOrDefault</span>(location, <span class="hljs-string">"未知位置，无法获取天气信息"</span>);
    }
}
</code></pre>
<h5 data-id="heading-10">配置类 注册mcpService 暴露出去</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.miao.config;

<span class="hljs-keyword">import</span> com.miao.service.WeatherService;
<span class="hljs-keyword">import</span> org.springframework.ai.tool.ToolCallbackProvider;
<span class="hljs-keyword">import</span> org.springframework.ai.tool.method.MethodToolCallbackProvider;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">McpServerConfig</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> ToolCallbackProvider weatherTools(WeatherService weatherService) {
        <span class="hljs-keyword">return</span> MethodToolCallbackProvider.builder()
                .toolObjects(weatherService)
                .build();
    }
}
</code></pre>
<h4 data-id="heading-11">本地客户端实现</h4>
<h5 data-id="heading-12">建立module</h5>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9941acb919a647c4bb54e66dc05aa54b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5a626aKG5YW75LqG5Liq55m96IOW6IOW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767258511&amp;x-signature=1gfQTq2oE%2Fa5HkYUipuw8MxHVH4%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-13">POM</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.miao<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>SpringAIAlibaba-test01<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>SAA-12MCPClient<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

        <span class="hljs-comment">&lt;!--   mcp client依赖     --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-starter-mcp-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-comment">&lt;!--  模型服务灵积  调用alibaba生态的协议 对标openai协议   --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-alibaba-starter-dashscope<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.38<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>
</code></pre>
<h5 data-id="heading-14">YML</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 服务器配置</span>
<span class="hljs-attr">server.port</span>=<span class="hljs-number">8082</span>
<span class="hljs-attr">server.servlet.encoding.enabled</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">server.servlet.encoding.force</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">server.servlet.encoding.charset</span>=UTF-<span class="hljs-number">8</span>

<span class="hljs-comment"># Spring应用配置</span>
<span class="hljs-attr">spring.application.name</span>=SAA-<span class="hljs-number">12</span>

<span class="hljs-comment"># Spring AI 通义千问配置</span>
<span class="hljs-attr">spring.ai.dashscope.api-key</span>=<span class="hljs-variable">${qwen-api-key}</span>
<span class="hljs-attr">spring.ai.dashscope.url</span>=https://dashscope.aliyuncs.com/compatible-mode/v1
<span class="hljs-attr">spring.ai.dashscope.chat.options.model</span>=qwen-flash

<span class="hljs-comment"># Spring AI MCP客户端配置</span>
<span class="hljs-attr">spring.ai.mcp.client.type</span>=async
<span class="hljs-attr">spring.ai.mcp.client.request-timeout</span>=<span class="hljs-number">60000</span>
<span class="hljs-attr">spring.ai.mcp.client.toolcallback.enabled</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">spring.ai.mcp.client.see.connections.server1.url</span>=http://localhost:<span class="hljs-number">8014</span>
</code></pre>
<h5 data-id="heading-15">启动类</h5>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">miao</span>;

<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">SpringApplication</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">autoconfigure</span>.<span class="hljs-property">SpringBootApplication</span>;

<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SAA12MCPClientApplication</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">SAA12MCPClientApplication</span>.<span class="hljs-property">class</span>, args);
    }
}
</code></pre>
<h5 data-id="heading-16">业务配置类</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.miao.config;

<span class="hljs-keyword">import</span> com.alibaba.cloud.ai.dashscope.api.DashScopeApi;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.client.ChatClient;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.model.ChatModel;
<span class="hljs-keyword">import</span> org.springframework.ai.mcp.AsyncMcpToolCallbackProvider;
<span class="hljs-keyword">import</span> org.springframework.ai.tool.ToolCallbackProvider;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Value;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SaaLLMConfig</span> {


    <span class="hljs-comment">/**
     * 方式一 : 通过配置文件注入 API Key
     */</span>
    <span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${spring.ai.dashscope.api-key}</span>"</span>)</span>
    <span class="hljs-keyword">private</span> String apiKey;


    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> DashScopeApi dashScopeApi() {
        <span class="hljs-keyword">return</span> DashScopeApi.builder()
                <span class="hljs-comment">// 从系统环境变量中读取配置</span>
                .apiKey(System.getenv(<span class="hljs-string">"qwen-api-key"</span>))
                .build();
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> ChatClient chatClient(ChatModel chatModel, ToolCallbackProvider tools) {
        <span class="hljs-keyword">return</span> ChatClient.builder(chatModel)
                .defaultToolCallbacks(tools.getToolCallbacks()) <span class="hljs-comment">//mcp协议</span>
                .build();
    }
}
</code></pre>
<h5 data-id="heading-17">业务controller</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.miao.controller;

<span class="hljs-keyword">import</span> jakarta.<span class="hljs-keyword">annotation</span>.Resource;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.client.ChatClient;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.model.ChatModel;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RequestParam;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestController;
<span class="hljs-keyword">import</span> reactor.core.publisher.Flux;

<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">McpClientController</span> {
    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> ChatModel dashScopeChatModel;

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> ChatClient chatClient;

    <span class="hljs-comment">// chatClient方式调用mcp服务端</span>
    <span class="hljs-meta">@GetMapping(<span class="hljs-string">"/chatClient"</span>)</span>
    <span class="hljs-keyword">public</span> Flux&lt;String&gt; chat(<span class="hljs-meta">@RequestParam(name = <span class="hljs-string">"msg"</span>, defaultValue = <span class="hljs-string">"北京"</span>)</span> String msg) {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"chatClient方式调用mcp服务端"</span>);
        <span class="hljs-keyword">return</span> chatClient.prompt(msg).stream().content();
    }


    <span class="hljs-comment">// chatModel方式未调用mcp服务端</span>
    <span class="hljs-meta">@GetMapping(<span class="hljs-string">"/chatModel"</span>)</span>
    <span class="hljs-keyword">public</span> String chatWithModel(<span class="hljs-meta">@RequestParam(name = <span class="hljs-string">"msg"</span>, defaultValue = <span class="hljs-string">"北京"</span>)</span> String msg) {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"chatModel方式未调用mcp服务端"</span>);
        <span class="hljs-keyword">return</span> dashScopeChatModel.call(msg);
    }
}
</code></pre>
<h3 data-id="heading-18">百度地图开发</h3>
<p>mcp官网: <a href="https://link.juejin.cn?target=https%3A%2F%2Fmcp.so%2Fzh%2Fserver%2Fbaidu-map%2Fbaidu-maps" target="_blank" title="https://mcp.so/zh/server/baidu-map/baidu-maps" ref="nofollow noopener noreferrer">mcp.so/zh/server/b…</a></p>
<h4 data-id="heading-19">环境配置</h4>
<p>第一步: 申请百度api-key</p>
<p>百度地图mcp的github地址: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbaidu-maps%2Fmcp" target="_blank" title="https://github.com/baidu-maps/mcp" ref="nofollow noopener noreferrer">github.com/baidu-maps/…</a></p>
<p>百度api申请地址: <a href="https://link.juejin.cn?target=https%3A%2F%2Flbsyun.baidu.com%2Fapiconsole%2Fauthflow%2Fauthresult" target="_blank" title="https://lbsyun.baidu.com/apiconsole/authflow/authresult" ref="nofollow noopener noreferrer">lbsyun.baidu.com/apiconsole/…</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2c296d926a046d9b13fe33571fa9e25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5a626aKG5YW75LqG5Liq55m96IOW6IOW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767258511&amp;x-signature=Afq5URDKhgdUUyUEV7QFxZhskN4%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-20">创建module</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18d5e9aa1ffa46d588d281012a6c68ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5a626aKG5YW75LqG5Liq55m96IOW6IOW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767258511&amp;x-signature=2gchGSEQIzQVExC2oQ1jTd89uG4%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-21">POM</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.miao<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>SpringAIAlibaba-test01<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>SAA-12MCPClient<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

        <span class="hljs-comment">&lt;!--   mcp client依赖     --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-starter-mcp-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-comment">&lt;!--  模型服务灵积  调用alibaba生态的协议 对标openai协议   --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-alibaba-starter-dashscope<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.38<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>
</code></pre>
<h4 data-id="heading-22">YML</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 服务器配置</span>
<span class="hljs-attr">server.port</span>=<span class="hljs-number">8082</span>
<span class="hljs-attr">server.servlet.encoding.enabled</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">server.servlet.encoding.force</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">server.servlet.encoding.charset</span>=UTF-<span class="hljs-number">8</span>

<span class="hljs-comment"># Spring应用配置</span>
<span class="hljs-attr">spring.application.name</span>=SAA-<span class="hljs-number">12</span>

<span class="hljs-comment"># Spring AI 通义千问配置</span>
<span class="hljs-attr">spring.ai.dashscope.api-key</span>=<span class="hljs-variable">${qwen-api-key}</span>
<span class="hljs-attr">spring.ai.dashscope.url</span>=https://dashscope.aliyuncs.com/compatible-mode/v1
<span class="hljs-attr">spring.ai.dashscope.chat.options.model</span>=qwen-flash

<span class="hljs-comment"># Spring AI MCP客户端配置</span>
<span class="hljs-attr">spring.ai.mcp.client.type</span>=async
<span class="hljs-attr">spring.ai.mcp.client.request-timeout</span>=<span class="hljs-number">60000</span>
<span class="hljs-attr">spring.ai.mcp.client.toolcallback.enabled</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">spring.ai.mcp.client.stdio.servers-configuration</span>=classpath:/npm-server.json
</code></pre>
<h4 data-id="heading-23">npm-server.json内容</h4>
<p>自己本地需要按照node，才能成功运行</p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"mcpServers"</span>: {
    <span class="hljs-string">"baidu-map"</span>: {
      <span class="hljs-string">"command"</span>: <span class="hljs-string">"cmd"</span>,
      <span class="hljs-string">"args"</span>: [
        <span class="hljs-string">"/c"</span>,
        <span class="hljs-string">"npx"</span>,
        <span class="hljs-string">"-y"</span>,
        <span class="hljs-string">"@baidumap/mcp-server-baidu-map"</span>
      ],
      <span class="hljs-string">"env"</span>: {
        <span class="hljs-string">"BAIDU_MAP_API_KEY"</span>: <span class="hljs-string">"api-key"</span>
      }
    }
  }
}
</code></pre>
<h4 data-id="heading-24">主启动类</h4>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">miao</span>;

<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">SpringApplication</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">autoconfigure</span>.<span class="hljs-property">SpringBootApplication</span>;

<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SAA12MCPClientApplication</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">SAA12MCPClientApplication</span>.<span class="hljs-property">class</span>, args);
    }
}
</code></pre>
<h4 data-id="heading-25">SaaLLMConfig配置类</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.miao.config;

<span class="hljs-keyword">import</span> com.alibaba.cloud.ai.dashscope.api.DashScopeApi;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.client.ChatClient;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.model.ChatModel;
<span class="hljs-keyword">import</span> org.springframework.ai.mcp.AsyncMcpToolCallbackProvider;
<span class="hljs-keyword">import</span> org.springframework.ai.tool.ToolCallbackProvider;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Value;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SaaLLMConfig</span> {


    <span class="hljs-comment">/**
     * 方式一 : 通过配置文件注入 API Key
     */</span>
    <span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${spring.ai.dashscope.api-key}</span>"</span>)</span>
    <span class="hljs-keyword">private</span> String apiKey;


    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> DashScopeApi dashScopeApi() {
        <span class="hljs-keyword">return</span> DashScopeApi.builder()
                <span class="hljs-comment">// 从系统环境变量中读取配置</span>
                .apiKey(System.getenv(<span class="hljs-string">"qwen-api-key"</span>))
                .build();
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> ChatClient chatClient(ChatModel chatModel, ToolCallbackProvider tools) {
        <span class="hljs-keyword">return</span> ChatClient.builder(chatModel)
                .defaultToolCallbacks(tools.getToolCallbacks()) <span class="hljs-comment">//mcp协议</span>
                .build();
    }
}
</code></pre>
<h4 data-id="heading-26">controller测试</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.miao.controller;

<span class="hljs-keyword">import</span> jakarta.<span class="hljs-keyword">annotation</span>.Resource;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.client.ChatClient;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.model.ChatModel;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RequestParam;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestController;
<span class="hljs-keyword">import</span> reactor.core.publisher.Flux;

<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">McpClientController</span> {
    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> ChatModel dashScopeChatModel;

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> ChatClient chatClient;

    <span class="hljs-comment">// chatClient方式调用mcp服务端</span>
    <span class="hljs-meta">@GetMapping(<span class="hljs-string">"/chatClient"</span>)</span>
    <span class="hljs-keyword">public</span> Flux&lt;String&gt; chat(<span class="hljs-meta">@RequestParam(name = <span class="hljs-string">"msg"</span>, defaultValue = <span class="hljs-string">"北京"</span>)</span> String msg) {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"chatClient方式调用mcp服务端"</span>);
        <span class="hljs-keyword">return</span> chatClient.prompt(msg).stream().content();
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[30秒搞懂ERC-2981:NFT版税的终极解决方案！]]></title>    <link>https://juejin.cn/post/7587381515669258267</link>    <guid>https://juejin.cn/post/7587381515669258267</guid>    <pubDate>2025-12-25T09:06:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587381515669258267" data-draft-id="7587518397949804598" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="30秒搞懂ERC-2981:NFT版税的终极解决方案！"/> <meta itemprop="keywords" content="智能合约,Solidity,web3"/> <meta itemprop="datePublished" content="2025-12-25T09:06:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="木西"/> <meta itemprop="url" content="https://juejin.cn/user/2436173496845549"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            30秒搞懂ERC-2981:NFT版税的终极解决方案！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173496845549/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    木西
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T09:06:55.000Z" title="Thu Dec 25 2025 09:06:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<blockquote>
<p>本文围绕 ERC-2981 版税标准展开，先系统梳理其核心定义、功能、解决的行业痛点及典型使用场景，再基于 OpenZeppelin 库整合 ERC-721 与 ERC-2981 标准实现版税 NFT 智能合约，最后通过 Hardhat V3 完成合约的开发、测试、部署全流程落地。</p>
</blockquote>
<h2 data-id="heading-1">概述</h2>
<p>ERC-2981 是以太坊 NFT 的链上版税标准，为 ERC-721/ERC-1155 合约提供统一的版税查询接口，让市场能自动获取分成规则并向创作者支付二级市场收益，核心解决早期版税碎片化、不可靠与跨平台不兼容问题，广泛用于数字艺术、游戏道具等需持续收益的 NFT 场景</p>
<h2 data-id="heading-2">ERC-2981 是什么</h2>
<ul>
<li>
<p><strong>定义</strong>：以太坊改进提案 EIP-2981（又称 ERC-2981），是 NFT 领域的<strong>标准化版税查询接口标准</strong>，兼容 ERC-721 与 ERC-1155，通过 EIP-165 接口识别，不强制市场执行版税，而是提供统一的链上版税信息查询能力。</p>
</li>
<li>
<p><strong>核心接口（IERC2981）</strong> ：</p>
<ol>
<li><code>royaltyInfo(uint256 tokenId, uint256 salePrice)</code>：返回版税接收地址与应付金额（以基点计算，1 基点 = 0.01%）。</li>
<li>可选实现：<code>_setTokenRoyalty</code>（单 token 版税）、<code>_setDefaultRoyalty</code>（全局默认版税），用于设置版税规则。</li>
</ol>
</li>
<li>
<p><strong>关键特性</strong>：链上透明、可组合、兼容主流 NFT 标准，不依赖平台规则，由合约自主定义版税策略。</p>
</li>
</ul>
<h2 data-id="heading-3">ERC-2981 能做什么</h2>
<ol>
<li><strong>标准化版税信息存储与查询</strong>：在 NFT 合约中嵌入版税规则（比例、接收地址），市场通过统一接口读取，无需自定义解析逻辑。</li>
<li><strong>自动分成触发</strong>：二级市场交易时，合规市场调用<code>royaltyInfo</code>计算分成，自动将版税划转至创作者 / 权利人，剩余款项给卖家。</li>
<li><strong>灵活规则配置</strong>：支持单 token 独立版税、全局默认版税，可通过权限控制更新接收地址，适配动态分成场景。</li>
<li><strong>跨平台互通</strong>：统一接口让 NFT 在不同市场交易时，版税规则一致，提升生态可组合性。</li>
<li><strong>链上追溯</strong>：版税信息与交易记录上链，便于审计与纠纷排查，降低信任成本。</li>
</ol>
<h2 data-id="heading-4">ERC-2981 解决了什么</h2>





























<table><thead><tr><th>痛点</th><th>解决方案</th></tr></thead><tbody><tr><td>版税碎片化</td><td>统一接口替代各平台专有规则，开发者无需重复适配</td></tr><tr><td>收益不可靠</td><td>链上存储规则，减少依赖平台中心化结算的信用风险</td></tr><tr><td>跨平台不兼容</td><td>标准接口让市场无缝读取版税，保障创作者跨平台收益</td></tr><tr><td>信息不透明</td><td>公开可查询的版税比例与接收地址，避免暗箱操作</td></tr><tr><td>开发成本高</td><td>复用 OpenZeppelin 等库的实现，降低版税功能开发门槛</td></tr></tbody></table>
<h2 data-id="heading-5">使用场景</h2>
<ol>
<li><strong>数字艺术 / 收藏品</strong>：艺术家铸造 NFT 时设置 5%-10% 版税，每次转售自动分成，如 CryptoPunks（兼容后）、Art Blocks 项目。</li>
<li><strong>游戏资产</strong>：游戏道具 NFT 转售时，开发者按比例获取分成，用于持续开发与运营，适配 ERC-1155 批量资产场景。</li>
<li><strong>音乐 / 影视 NFT</strong>：版权方在二次交易中获得收益，支持多权利人按比例分配（需结合多签 / 分账合约）。</li>
<li><strong>IP 衍生品</strong>：IP 方通过版税获取长期收益，如品牌联名 NFT 的持续分成。</li>
<li><strong>创作者 DAO / 社区</strong>：版税收入进入 DAO 金库，用于生态建设或社区分红，提升治理效率。</li>
<li><strong>跨链 NFT</strong>：通过跨链桥同步版税信息，实现多链交易时的自动分成（需跨链协议支持）。</li>
</ol>
<h2 data-id="heading-6">智能合约开发、测试、部署</h2>
<h3 data-id="heading-7">版税NFT智能合约</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// SPDX-License-Identifier: MIT</span>
pragma solidity ^<span class="hljs-number">0.8</span><span class="hljs-number">.24</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">"@openzeppelin/contracts/token/ERC721/ERC721.sol"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">"@openzeppelin/contracts/token/common/ERC2981.sol"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">"@openzeppelin/contracts/access/Ownable.sol"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">"@openzeppelin/contracts/utils/Strings.sol"</span>; <span class="hljs-comment">// 新增：用于tokenURI</span>

contract <span class="hljs-title class_">MyRoyaltyNFT</span> is <span class="hljs-title class_">ERC721</span>, <span class="hljs-title class_">ERC2981</span>, <span class="hljs-title class_">Ownable</span> {
    <span class="hljs-comment">// 使用 uint256 替代 Counters.Counter（5.x版本已移除该库）</span>
    uint256 <span class="hljs-keyword">private</span> _nextTokenId;
    
    <span class="hljs-built_in">string</span> <span class="hljs-keyword">private</span> _baseTokenURI;
    uint96 <span class="hljs-keyword">private</span> constant <span class="hljs-variable constant_">MAX_ROYALTY_BPS</span> = <span class="hljs-number">1000</span>; <span class="hljs-comment">// 10% 版税上限</span>

    <span class="hljs-comment">// 新增：可选的最大供应量限制（设为0则无限制）</span>
    uint256 <span class="hljs-keyword">public</span> immutable maxSupply;

    <span class="hljs-comment">// 新增：合约部署事件</span>
    event <span class="hljs-title class_">Minted</span>(address indexed to, uint256 indexed tokenId);

    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
        <span class="hljs-built_in">string</span> memory name,
        <span class="hljs-built_in">string</span> memory <span class="hljs-built_in">symbol</span>,
        <span class="hljs-built_in">string</span> memory baseURI,
        address royaltyReceiver,
        uint96 royaltyBps,
        uint256 _maxSupply <span class="hljs-comment">// 新增参数，设为0表示无上限</span>
    </span>) <span class="hljs-title class_">ERC721</span>(name, <span class="hljs-built_in">symbol</span>) <span class="hljs-title class_">Ownable</span>(msg.<span class="hljs-property">sender</span>) {
        _baseTokenURI = baseURI;
        maxSupply = _maxSupply;
        
        <span class="hljs-comment">// 设置默认版税（basis points: 100 = 1%）</span>
        <span class="hljs-built_in">require</span>(royaltyBps &lt;= <span class="hljs-variable constant_">MAX_ROYALTY_BPS</span>, <span class="hljs-string">"Royalty too high"</span>);
        <span class="hljs-title function_">_setDefaultRoyalty</span>(royaltyReceiver, royaltyBps);
    }

    <span class="hljs-comment">// ======================== 铸造功能 ========================</span>
    
    <span class="hljs-comment">// 优化：原生递增 + 可选供应上限</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">safeMint</span>(<span class="hljs-params">address to</span>) <span class="hljs-keyword">public</span> onlyOwner {
        <span class="hljs-built_in">require</span>(
            maxSupply == <span class="hljs-number">0</span> || _nextTokenId &lt; maxSupply, 
            <span class="hljs-string">"Max supply reached"</span>
        );
        
        uint256 tokenId = _nextTokenId++;
        <span class="hljs-title function_">_safeMint</span>(to, tokenId);
        emit <span class="hljs-title class_">Minted</span>(to, tokenId); <span class="hljs-comment">// 记录铸造事件</span>
    }

    <span class="hljs-comment">// 批量铸造（新增：高效铸造多个）</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">safeMintBatch</span>(<span class="hljs-params">address[] calldata recipients</span>) external onlyOwner {
        <span class="hljs-keyword">for</span> (uint256 i = <span class="hljs-number">0</span>; i &lt; recipients.<span class="hljs-property">length</span>; i++) {
            <span class="hljs-title function_">safeMint</span>(recipients[i]);
        }
    }

    <span class="hljs-comment">// 获取已铸造总量</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">totalSupply</span>(<span class="hljs-params"/>) external view returns (uint256) {
        <span class="hljs-keyword">return</span> _nextTokenId;
    }

    <span class="hljs-comment">// ======================== 版税管理 ========================</span>
    
    <span class="hljs-comment">// 优化：统一版税验证逻辑</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">setTokenRoyalty</span>(<span class="hljs-params">
        uint256 tokenId,
        address receiver,
        uint96 feeNumerator
    </span>) external onlyOwner {
        <span class="hljs-title function_">_validateRoyalty</span>(feeNumerator);
        <span class="hljs-title function_">_setTokenRoyalty</span>(tokenId, receiver, feeNumerator);
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">setDefaultRoyalty</span>(<span class="hljs-params">
        address receiver, 
        uint96 feeNumerator
    </span>) external onlyOwner {
        <span class="hljs-title function_">_validateRoyalty</span>(feeNumerator);
        <span class="hljs-title function_">_setDefaultRoyalty</span>(receiver, feeNumerator);
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">resetTokenRoyalty</span>(<span class="hljs-params">uint256 tokenId</span>) external onlyOwner {
        <span class="hljs-title function_">_resetTokenRoyalty</span>(tokenId);
    }

    <span class="hljs-comment">// 内部函数：验证版税比例</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">_validateRoyalty</span>(<span class="hljs-params">uint96 feeNumerator</span>) internal pure {
        <span class="hljs-built_in">require</span>(feeNumerator &lt;= <span class="hljs-variable constant_">MAX_ROYALTY_BPS</span>, <span class="hljs-string">"Royalty exceeds 10%"</span>);
    }

    <span class="hljs-comment">// ======================== 元数据 ========================</span>
    
    <span class="hljs-comment">// 优化：自动拼接tokenId</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">tokenURI</span>(<span class="hljs-params">uint256 tokenId</span>) 
        <span class="hljs-keyword">public</span> 
        view 
        virtual 
        <span class="hljs-keyword">override</span> 
        returns (<span class="hljs-built_in">string</span> memory) 
    {
        <span class="hljs-title function_">_requireOwned</span>(tokenId); <span class="hljs-comment">// 5.x推荐：替代require(_exists())</span>
        
        <span class="hljs-built_in">string</span> memory baseURI = <span class="hljs-title function_">_baseURI</span>();
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">bytes</span>(baseURI).<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> 
            ? <span class="hljs-built_in">string</span>.<span class="hljs-title function_">concat</span>(baseURI, <span class="hljs-title class_">Strings</span>.<span class="hljs-title function_">toString</span>(tokenId), <span class="hljs-string">".json"</span>) <span class="hljs-comment">// 自动添加.json扩展名</span>
            : <span class="hljs-string">""</span>;
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">_baseURI</span>(<span class="hljs-params"/>) internal view virtual <span class="hljs-keyword">override</span> returns (<span class="hljs-built_in">string</span> memory) {
        <span class="hljs-keyword">return</span> _baseTokenURI;
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">setBaseURI</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> memory newBaseURI</span>) external onlyOwner {
        _baseTokenURI = newBaseURI;
    }

    <span class="hljs-comment">// ======================== 接口支持 ========================</span>
    
    <span class="hljs-comment">// 必须重写 supportsInterface 以支持 ERC165 接口检测</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">supportsInterface</span>(<span class="hljs-params">bytes4 interfaceId</span>)
        <span class="hljs-keyword">public</span>
        view
        virtual
        <span class="hljs-title function_">override</span>(<span class="hljs-title class_">ERC721</span>, <span class="hljs-title class_">ERC2981</span>)
        returns (bool)
    {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">supportsInterface</span>(interfaceId);
    }
}
</code></pre>
<h4 data-id="heading-8">编译指令</h4>
<pre><code class="hljs language-python" lang="python">npx hardhat <span class="hljs-built_in">compile</span>
</code></pre>
<h3 data-id="heading-9">智能合约部署脚本</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// scripts/deploy.js</span>
<span class="hljs-keyword">import</span> { network, artifacts } <span class="hljs-keyword">from</span> <span class="hljs-string">"hardhat"</span>;
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 连接网络</span>
  <span class="hljs-keyword">const</span> { viem } = <span class="hljs-keyword">await</span> network.<span class="hljs-title function_">connect</span>({ <span class="hljs-attr">network</span>: network.<span class="hljs-property">name</span> });<span class="hljs-comment">//指定网络进行链接</span>
  
  <span class="hljs-comment">// 获取客户端</span>
  <span class="hljs-keyword">const</span> [deployer] = <span class="hljs-keyword">await</span> viem.<span class="hljs-title function_">getWalletClients</span>();
  <span class="hljs-keyword">const</span> publicClient = <span class="hljs-keyword">await</span> viem.<span class="hljs-title function_">getPublicClient</span>();
 
  <span class="hljs-keyword">const</span> deployerAddress = deployer.<span class="hljs-property">account</span>.<span class="hljs-property">address</span>;
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"部署者的地址:"</span>, deployerAddress);
  <span class="hljs-comment">// 加载合约</span>
  <span class="hljs-keyword">const</span> artifact = <span class="hljs-keyword">await</span> artifacts.<span class="hljs-title function_">readArtifact</span>(<span class="hljs-string">"MyRoyaltyNFT"</span>);
  <span class="hljs-keyword">const</span> ipfsjsonuri=<span class="hljs-string">"https://zygomorphic-magenta-bobolink.myfilebase.com/ipfs/QmQT8VpmWQVhUhoDCEK1mdHXaFaJ3KawkRxHm96GUhrXLB"</span>
  <span class="hljs-comment">// 部署（构造函数参数：recipient, initialOwner）</span>
  <span class="hljs-keyword">const</span> hash = <span class="hljs-keyword">await</span> deployer.<span class="hljs-title function_">deployContract</span>({
    <span class="hljs-attr">abi</span>: artifact.<span class="hljs-property">abi</span>,<span class="hljs-comment">//获取abi</span>
    <span class="hljs-attr">bytecode</span>: artifact.<span class="hljs-property">bytecode</span>,<span class="hljs-comment">//硬编码</span>
    <span class="hljs-attr">args</span>: [<span class="hljs-string">"MyRoyaltyNFT"</span>,<span class="hljs-string">"MRNFT"</span>,ipfsjsonuri,deployerAddress,<span class="hljs-number">100</span>,<span class="hljs-number">0</span>],<span class="hljs-comment">//nft名称，nft符号，ipfsjsonuri，部署者地址， royaltiesNumerator，royaltiesDenominator</span>
  });

  <span class="hljs-comment">// 等待确认并打印地址</span>
  <span class="hljs-keyword">const</span> receipt = <span class="hljs-keyword">await</span> publicClient.<span class="hljs-title function_">waitForTransactionReceipt</span>({ hash });
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"合约地址:"</span>, receipt.<span class="hljs-property">contractAddress</span>);
}

<span class="hljs-title function_">main</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>);
</code></pre>
<h4 data-id="heading-10">部署指令</h4>
<pre><code class="hljs language-arduino" lang="arduino">npx hardhat run ./scripts/xxx.ts
</code></pre>
<h3 data-id="heading-11">智能合约测试脚本</h3>
<pre><code class="hljs language-php" lang="php">import assert <span class="hljs-keyword">from</span> <span class="hljs-string">"node:assert/strict"</span>;
import { describe, it,beforeEach  } <span class="hljs-keyword">from</span> <span class="hljs-string">"node:test"</span>;
import { formatEther,parseEther } <span class="hljs-keyword">from</span> <span class="hljs-string">'viem'</span>
import { network } <span class="hljs-keyword">from</span> <span class="hljs-string">"hardhat"</span>;
<span class="hljs-title function_ invoke__">describe</span>(<span class="hljs-string">"MyRoyaltyNFT"</span>, async function () {
    let viem: any;
    let publicClient: any;
    let owner: any, user1: any, user2: any, user3: any;
    let deployerAddress: <span class="hljs-keyword">string</span>;
    let MyRoyaltyNFT: any;
    <span class="hljs-title function_ invoke__">beforeEach</span> (async function () {
        <span class="hljs-keyword">const</span> { viem } = await network.<span class="hljs-title function_ invoke__">connect</span>();
         publicClient = await viem.<span class="hljs-title function_ invoke__">getPublicClient</span>();<span class="hljs-comment">//创建一个公共客户端实例用于读取链上数据（无需私钥签名）。</span>
         [owner,user1,user2,user3] = await viem.<span class="hljs-title function_ invoke__">getWalletClients</span>();<span class="hljs-comment">//获取第一个钱包客户端 写入联合交易</span>
        deployerAddress = owner.account.address;<span class="hljs-comment">//钱包地址</span>
       <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ipfsjsonuri</span>=<span class="hljs-string">"https://zygomorphic-magenta-bobolink.myfilebase.com/ipfs/QmQT8VpmWQVhUhoDCEK1mdHXaFaJ3KawkRxHm96GUhrXLB"</span>;
       
        MyRoyaltyNFT = await viem.<span class="hljs-title function_ invoke__">deployContract</span>(<span class="hljs-string">"MyRoyaltyNFT"</span>, [
            <span class="hljs-string">"My Royalty NFT"</span>,
            <span class="hljs-string">"MRNFT"</span>,
            ipfsjsonuri,
            deployerAddress,
            <span class="hljs-number">200</span>,//版税<span class="hljs-number">1</span>%
            <span class="hljs-number">0</span>,
        ]);<span class="hljs-comment">//部署合约</span>
        console.<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-string">"MyRoyaltyNFT合约地址:"</span>, MyRoyaltyNFT.address); 
    });
    <span class="hljs-title function_ invoke__">it</span>(<span class="hljs-string">"测试MyRoyaltyNFT"</span>, async function () {
        <span class="hljs-comment">//查询nft名称和符号</span>
       <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">name</span>= await publicClient.<span class="hljs-title function_ invoke__">readContract</span>({
            <span class="hljs-attr">address</span>: MyRoyaltyNFT.address,
            <span class="hljs-attr">abi</span>: MyRoyaltyNFT.abi,
            <span class="hljs-attr">functionName</span>: <span class="hljs-string">"name"</span>,
            <span class="hljs-attr">args</span>: [],
        });
       <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">symbol</span>= await publicClient.<span class="hljs-title function_ invoke__">readContract</span>({
            <span class="hljs-attr">address</span>: MyRoyaltyNFT.address,
            <span class="hljs-attr">abi</span>: MyRoyaltyNFT.abi,
            <span class="hljs-attr">functionName</span>: <span class="hljs-string">"symbol"</span>,
            <span class="hljs-attr">args</span>: [],
        });
        <span class="hljs-comment">//查询总供应量和最大供应量</span>
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">totalSupply</span>= await publicClient.<span class="hljs-title function_ invoke__">readContract</span>({
            <span class="hljs-attr">address</span>: MyRoyaltyNFT.address,
            <span class="hljs-attr">abi</span>: MyRoyaltyNFT.abi,
            <span class="hljs-attr">functionName</span>: <span class="hljs-string">"totalSupply"</span>,
            <span class="hljs-attr">args</span>: [],
        });
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">maxSupply</span>= await publicClient.<span class="hljs-title function_ invoke__">readContract</span>({
            <span class="hljs-attr">address</span>: MyRoyaltyNFT.address,
            <span class="hljs-attr">abi</span>: MyRoyaltyNFT.abi,
            <span class="hljs-attr">functionName</span>: <span class="hljs-string">"maxSupply"</span>,
            <span class="hljs-attr">args</span>: [],
        });
        <span class="hljs-comment">//查询合约拥有者</span>
       <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ownerAddress</span>= await publicClient.<span class="hljs-title function_ invoke__">readContract</span>({
            <span class="hljs-attr">address</span>: MyRoyaltyNFT.address,
            <span class="hljs-attr">abi</span>: MyRoyaltyNFT.abi,
            <span class="hljs-attr">functionName</span>: <span class="hljs-string">"owner"</span>,
            <span class="hljs-attr">args</span>: [],
        });
        console.<span class="hljs-title function_ invoke__">log</span>(name,symbol,totalSupply,maxSupply,ownerAddress)
        <span class="hljs-comment">//铸造单个nft</span>
        await owner.<span class="hljs-title function_ invoke__">writeContract</span>({
            <span class="hljs-attr">address</span>: MyRoyaltyNFT.address,
            <span class="hljs-attr">abi</span>: MyRoyaltyNFT.abi,
            <span class="hljs-attr">functionName</span>: <span class="hljs-string">"safeMint"</span>,
            <span class="hljs-attr">args</span>: [user1.account.address],
        });
        <span class="hljs-comment">//批量铸造nft</span>
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">nftaddress</span>=[user1.account.address,user2.account.address,user3.account.address]
        await owner.<span class="hljs-title function_ invoke__">writeContract</span>({
            <span class="hljs-attr">address</span>: MyRoyaltyNFT.address,
            <span class="hljs-attr">abi</span>: MyRoyaltyNFT.abi,
            <span class="hljs-attr">functionName</span>: <span class="hljs-string">"safeMintBatch"</span>,
            <span class="hljs-attr">args</span>: [nftaddress],
        });

        <span class="hljs-comment">//查询单个nft的tokenURI</span>
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TokenURI</span>= await publicClient.<span class="hljs-title function_ invoke__">readContract</span>({
            <span class="hljs-attr">address</span>: MyRoyaltyNFT.address,
            <span class="hljs-attr">abi</span>: MyRoyaltyNFT.abi,
            <span class="hljs-attr">functionName</span>: <span class="hljs-string">"tokenURI"</span>,
            <span class="hljs-attr">args</span>: [<span class="hljs-number">0</span>],
        });
        console.<span class="hljs-title function_ invoke__">log</span>(TokenURI)
        <span class="hljs-comment">//查询余额和拥有者</span>
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">balanceOf</span>=await publicClient.<span class="hljs-title function_ invoke__">readContract</span>({
            <span class="hljs-attr">address</span>: MyRoyaltyNFT.address,
            <span class="hljs-attr">abi</span>: MyRoyaltyNFT.abi,
            <span class="hljs-attr">functionName</span>: <span class="hljs-string">"balanceOf"</span>,
            <span class="hljs-attr">args</span>: [user1.account.address],
        });
        console.<span class="hljs-title function_ invoke__">log</span>(balanceOf)
        <span class="hljs-comment">//查询nft的拥有者</span>
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ownerOf</span>=await publicClient.<span class="hljs-title function_ invoke__">readContract</span>({
            <span class="hljs-attr">address</span>: MyRoyaltyNFT.address,
            <span class="hljs-attr">abi</span>: MyRoyaltyNFT.abi,
            <span class="hljs-attr">functionName</span>: <span class="hljs-string">"ownerOf"</span>,
            <span class="hljs-attr">args</span>: [<span class="hljs-number">0</span>],
        });
        console.<span class="hljs-title function_ invoke__">log</span>(ownerOf)
        <span class="hljs-comment">//查询版税信息</span>
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">royaltyInfo</span>=await publicClient.<span class="hljs-title function_ invoke__">readContract</span>({
            <span class="hljs-attr">address</span>: MyRoyaltyNFT.address,
            <span class="hljs-attr">abi</span>: MyRoyaltyNFT.abi,
            <span class="hljs-attr">functionName</span>: <span class="hljs-string">"royaltyInfo"</span>,
            <span class="hljs-attr">args</span>: [<span class="hljs-number">0</span>,<span class="hljs-title function_ invoke__">parseEther</span>(<span class="hljs-string">"2"</span>)],
        });
        console.<span class="hljs-title function_ invoke__">log</span>(royaltyInfo)
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">GETAPPROVED</span>=await publicClient.<span class="hljs-title function_ invoke__">readContract</span>({
            <span class="hljs-attr">address</span>: MyRoyaltyNFT.address,
            <span class="hljs-attr">abi</span>: MyRoyaltyNFT.abi,
            <span class="hljs-attr">functionName</span>: <span class="hljs-string">"getApproved"</span>,
            <span class="hljs-attr">args</span>: [<span class="hljs-number">0</span>],
        });
        console.<span class="hljs-title function_ invoke__">log</span>(GETAPPROVED)
        <span class="hljs-comment">//设置BaseURI</span>
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ipfsjsonuri1</span>=<span class="hljs-string">"https://zygomorphic-magenta-bobolink.myfilebase.com/ipfs/QmcN49MKt4MbSXSGckAcpvFqtea43uuPD2tvmuER1mG67s"</span>;
       <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">setBaseURI</span>=await owner.<span class="hljs-title function_ invoke__">writeContract</span>({
            <span class="hljs-attr">address</span>: MyRoyaltyNFT.address,
            <span class="hljs-attr">abi</span>: MyRoyaltyNFT.abi,
            <span class="hljs-attr">functionName</span>: <span class="hljs-string">"setBaseURI"</span>,
            <span class="hljs-attr">args</span>: [ipfsjsonuri1],
        });
        console.<span class="hljs-title function_ invoke__">log</span>(setBaseURI)
        <span class="hljs-comment">//查询更新后的tokenURI</span>
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TokenURI1</span>= await publicClient.<span class="hljs-title function_ invoke__">readContract</span>({
            <span class="hljs-attr">address</span>: MyRoyaltyNFT.address,
            <span class="hljs-attr">abi</span>: MyRoyaltyNFT.abi,
            <span class="hljs-attr">functionName</span>: <span class="hljs-string">"tokenURI"</span>,
            <span class="hljs-attr">args</span>: [<span class="hljs-number">0</span>],
        });
        console.<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-string">"更新后"</span>,TokenURI1)
        <span class="hljs-comment">//设置默认版税</span>
        <span class="hljs-comment">// const SETDEFAULTROYALTY=await owner.writeContract({</span>
        <span class="hljs-comment">//     address: MyRoyaltyNFT.address,</span>
        <span class="hljs-comment">//     abi: MyRoyaltyNFT.abi,</span>
        <span class="hljs-comment">//     functionName: "setDefaultRoyalty",</span>
        <span class="hljs-comment">//     args: [user3.account.address,"500"],</span>
        <span class="hljs-comment">// });</span>
        <span class="hljs-comment">// console.log(SETDEFAULTROYALTY)</span>
        <span class="hljs-comment">//设置版税</span>
       <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">setTokenRoyalty</span> = await owner.<span class="hljs-title function_ invoke__">writeContract</span>({
            <span class="hljs-attr">address</span>: MyRoyaltyNFT.address,
            <span class="hljs-attr">abi</span>: MyRoyaltyNFT.abi,
            <span class="hljs-attr">functionName</span>: <span class="hljs-string">"setTokenRoyalty"</span>,
            <span class="hljs-attr">args</span>: [<span class="hljs-number">0</span>,user3.account.address,<span class="hljs-string">"500"</span>],
        });
        <span class="hljs-comment">//查询版税信息</span>
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">royaltyInfo1</span>=await publicClient.<span class="hljs-title function_ invoke__">readContract</span>({
            <span class="hljs-attr">address</span>: MyRoyaltyNFT.address,
            <span class="hljs-attr">abi</span>: MyRoyaltyNFT.abi,
            <span class="hljs-attr">functionName</span>: <span class="hljs-string">"royaltyInfo"</span>,
            <span class="hljs-attr">args</span>: [<span class="hljs-number">0</span>,<span class="hljs-title function_ invoke__">parseEther</span>(<span class="hljs-string">"3"</span>)],
        });
        console.<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-string">"更新后版税信息"</span>,royaltyInfo1)
        <span class="hljs-comment">//转账nft</span>
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TRANSFERFROM</span>=await user1.<span class="hljs-title function_ invoke__">writeContract</span>({
            <span class="hljs-attr">address</span>: MyRoyaltyNFT.address,
            <span class="hljs-attr">abi</span>: MyRoyaltyNFT.abi,
            <span class="hljs-attr">functionName</span>: <span class="hljs-string">"transferFrom"</span>,
            <span class="hljs-attr">args</span>: [user1.account.address,user2.account.address,<span class="hljs-number">0</span>],
        });
        <span class="hljs-comment">//查询nft的新拥有者</span>
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ownerOf1</span>=await publicClient.<span class="hljs-title function_ invoke__">readContract</span>({
            <span class="hljs-attr">address</span>: MyRoyaltyNFT.address,
            <span class="hljs-attr">abi</span>: MyRoyaltyNFT.abi,
            <span class="hljs-attr">functionName</span>: <span class="hljs-string">"ownerOf"</span>,
            <span class="hljs-attr">args</span>: [<span class="hljs-number">0</span>],
        });
        console.<span class="hljs-title function_ invoke__">log</span>(ownerOf1)
    });

});

</code></pre>
<h4 data-id="heading-12">测试指令</h4>
<pre><code class="hljs language-bash" lang="bash">npx hardhat <span class="hljs-built_in">test</span> ./test/xxx.ts
</code></pre>
<h2 data-id="heading-13">总结</h2>
<p>至此，关于ERC-2981 版税标准从理论梳理到代码实现、工程落地的全流程实践，既验证了该标准的核心价值，也为开发者提供了可直接复用的版税 NFT 开发范式，是 NFT 生态从 “交易” 向 “持续价值分配” 演进的重要落地参考。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Go 语言高并发实战：批量清洗天远借贷行为验证API (JRZQ8203) 的时间序列数据]]></title>    <link>https://juejin.cn/post/7587605704635351074</link>    <guid>https://juejin.cn/post/7587605704635351074</guid>    <pubDate>2025-12-25T10:06:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587605704635351074" data-draft-id="7587596841874620450" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Go 语言高并发实战：批量清洗天远借贷行为验证API (JRZQ8203) 的时间序列数据"/> <meta itemprop="keywords" content="API,大数据"/> <meta itemprop="datePublished" content="2025-12-25T10:06:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="天远云服"/> <meta itemprop="url" content="https://juejin.cn/user/590850926340011"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Go 语言高并发实战：批量清洗天远借贷行为验证API (JRZQ8203) 的时间序列数据
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/590850926340011/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    天远云服
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T10:06:30.000Z" title="Thu Dec 25 2025 10:06:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 唯快不破的实时风控</h2>
<p>在现金贷、消费分期等高频金融场景中，风控系统的<strong>响应速度 (Latency)</strong> 和 <strong>吞吐量 (Throughput)</strong> 直接决定了用户体验和业务规模。当大促流量洪峰到来时，我们需要在毫秒级时间内，调用第三方数据接口，评估用户的共债压力。</p>
<p><strong>天远数据</strong>的<strong>借贷行为验证API</strong>（JRZQ8203）提供了极具价值的 T0（当前）至 T11（过去11个月）的时间序列数据 。与简单的黑名单不同，它能动态反映用户的还款压力变化。</p>
<p>对于追求极致性能的 <strong>Go (Golang)</strong> 开发者而言，对接该接口的挑战在于：</p>
<ol>
<li><strong>加密性能</strong>：在高并发下高效处理 AES-128-CBC 加密。</li>
<li><strong>数据映射</strong>：接口返回超过 100 个字段 ，如何利用 Go 的 <code>struct</code> tag 进行零拷贝的高效映射？</li>
<li><strong>并发模型</strong>：如何利用 Goroutine 实现对批量用户的快速风险筛查？</li>
</ol>
<p>本文将通过实战代码，演示如何构建一个高性能的借贷行为验证微服务。</p>
<h2 data-id="heading-1">2. API 调用示例：硬核并发实现</h2>
<h3 data-id="heading-2">2.1 接口契约</h3>
<ul>
<li><strong>接口地址</strong>：<code>https://api.tianyuanapi.com/api/v1/JRZQ8203</code></li>
<li><strong>加密方式</strong>：AES-128-CBC + PKCS7 填充 + Base64 。</li>
<li><strong>请求参数</strong>：<code>name</code> (姓名), <code>id_card</code> (身份证), <code>mobile_no</code> (手机号) 。</li>
</ul>
<h3 data-id="heading-3">2.2 Go 完整对接代码 (含 PKCS7 处理)</h3>
<p>Go 标准库 <code>crypto/aes</code> 不直接支持 PKCS7 填充，我们需要手动实现。以下是封装好的 Client：</p>
<p>Go</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"bytes"</span>
	<span class="hljs-string">"crypto/aes"</span>
	<span class="hljs-string">"crypto/cipher"</span>
	<span class="hljs-string">"crypto/rand"</span>
	<span class="hljs-string">"encoding/base64"</span>
	<span class="hljs-string">"encoding/json"</span>
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"io"</span>
	<span class="hljs-string">"net/http"</span>
	<span class="hljs-string">"time"</span>
)

<span class="hljs-comment">// === 配置常量 ===</span>
<span class="hljs-keyword">const</span> (
	ApiURL    = <span class="hljs-string">"&lt;https://api.tianyuanapi.com/api/v1/JRZQ8203&gt;"</span>
	AccessID  = <span class="hljs-string">"您的Access-Id"</span>
	AccessKey = <span class="hljs-string">"您的16位Access-Key"</span> <span class="hljs-comment">// 必须16字节</span>
)

<span class="hljs-comment">// === 1. 加密工具函数 (AES-CBC-PKCS7) ===</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PKCS7Padding</span><span class="hljs-params">(ciphertext []<span class="hljs-type">byte</span>, blockSize <span class="hljs-type">int</span>)</span></span> []<span class="hljs-type">byte</span> {
	padding := blockSize - <span class="hljs-built_in">len</span>(ciphertext)%blockSize
	padtext := bytes.Repeat([]<span class="hljs-type">byte</span>{<span class="hljs-type">byte</span>(padding)}, padding)
	<span class="hljs-keyword">return</span> <span class="hljs-built_in">append</span>(ciphertext, padtext...)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PKCS7UnPadding</span><span class="hljs-params">(origData []<span class="hljs-type">byte</span>)</span></span> []<span class="hljs-type">byte</span> {
	length := <span class="hljs-built_in">len</span>(origData)
	unpadding := <span class="hljs-type">int</span>(origData[length<span class="hljs-number">-1</span>])
	<span class="hljs-keyword">return</span> origData[:(length - unpadding)]
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Encrypt</span><span class="hljs-params">(plainText, key []<span class="hljs-type">byte</span>)</span></span> (<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
	block, err := aes.NewCipher(key)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, err
	}
	iv := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, aes.BlockSize)
	<span class="hljs-keyword">if</span> _, err := io.ReadFull(rand.Reader, iv); err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, err
	}
	plainText = PKCS7Padding(plainText, block.BlockSize())
	blockMode := cipher.NewCBCEncrypter(block, iv)
	cipherText := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-built_in">len</span>(plainText))
	blockMode.CryptBlocks(cipherText, plainText)
	<span class="hljs-keyword">return</span> base64.StdEncoding.EncodeToString(<span class="hljs-built_in">append</span>(iv, cipherText...)), <span class="hljs-literal">nil</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Decrypt</span><span class="hljs-params">(cryptoText <span class="hljs-type">string</span>, key []<span class="hljs-type">byte</span>)</span></span> ([]<span class="hljs-type">byte</span>, <span class="hljs-type">error</span>) {
	combined, err := base64.StdEncoding.DecodeString(cryptoText)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
	}
	iv := combined[:aes.BlockSize]
	cipherText := combined[aes.BlockSize:]
	block, err := aes.NewCipher(key)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
	}
	blockMode := cipher.NewCBCDecrypter(block, iv)
	plainText := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-built_in">len</span>(cipherText))
	blockMode.CryptBlocks(plainText, cipherText)
	<span class="hljs-keyword">return</span> PKCS7UnPadding(plainText), <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// === 2. 结构体定义 (核心) ===</span>

<span class="hljs-keyword">type</span> LendingRequest <span class="hljs-keyword">struct</span> {
	MobileNo <span class="hljs-type">string</span> <span class="hljs-string">`json:"mobile_no"`</span>
	IdCard   <span class="hljs-type">string</span> <span class="hljs-string">`json:"id_card"`</span>
	Name     <span class="hljs-type">string</span> <span class="hljs-string">`json:"name"`</span>
}

<span class="hljs-keyword">type</span> ApiResponse <span class="hljs-keyword">struct</span> {
	Code    <span class="hljs-type">int</span>    <span class="hljs-string">`json:"code"`</span>
	Message <span class="hljs-type">string</span> <span class="hljs-string">`json:"message"`</span>
	Data    <span class="hljs-type">string</span> <span class="hljs-string">`json:"data"`</span> <span class="hljs-comment">// 加密数据</span>
}

<span class="hljs-comment">// LendingResult 映射解密后的 JSON</span>
<span class="hljs-comment">// 技巧：只定义核心字段，或使用 map[string]interface{} 处理全量字段</span>
<span class="hljs-keyword">type</span> LendingResult <span class="hljs-keyword">struct</span> {
	FlagTotalloan      <span class="hljs-type">string</span> <span class="hljs-string">`json:"flag_totalloan"`</span>           <span class="hljs-comment">// 1:成功, 0:无匹配</span>
	LastLoanTime       <span class="hljs-type">string</span> <span class="hljs-string">`json:"tl_id_eletail_lasttime"`</span>   <span class="hljs-comment">// 最近借贷时间</span>
	CurrentStressLevel <span class="hljs-type">string</span> <span class="hljs-string">`json:"tl_id_t0_nbank_reamt"`</span>     <span class="hljs-comment">// T0(本月)还款压力</span>
	LastMonthOrgCount  <span class="hljs-type">string</span> <span class="hljs-string">`json:"tl_id_m1_nbank_passorg"`</span>   <span class="hljs-comment">// 近1个月机构数</span>
    <span class="hljs-comment">// ... 其他 100+ 字段根据业务需求按需添加</span>
}

<span class="hljs-comment">// === 3. 业务调用 ===</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">QueryRisk</span><span class="hljs-params">(name, idCard, mobile <span class="hljs-type">string</span>)</span></span> (*LendingResult, <span class="hljs-type">error</span>) {
	<span class="hljs-comment">// 构造参数</span>
	reqData := LendingRequest{
		Name:     name,
		IdCard:   idCard,
		MobileNo: mobile,
	}
	jsonBytes, _ := json.Marshal(reqData)
	
	<span class="hljs-comment">// 加密</span>
	encryptedData, _ := Encrypt(jsonBytes, []<span class="hljs-type">byte</span>(AccessKey))
	
	<span class="hljs-comment">// 发送 POST</span>
	client := &amp;http.Client{Timeout: <span class="hljs-number">5</span> * time.Second}
	payload := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{<span class="hljs-string">"data"</span>: encryptedData}
	payloadBytes, _ := json.Marshal(payload)
	
	resp, err := client.Post(
		fmt.Sprintf(<span class="hljs-string">"%s?t=%d"</span>, ApiURL, time.Now().UnixMilli()), 
		<span class="hljs-string">"application/json"</span>, 
		bytes.NewBuffer(payloadBytes),
	)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
	}
	<span class="hljs-keyword">defer</span> resp.Body.Close()
    
    <span class="hljs-comment">// Header 鉴权</span>
    req, _ := http.NewRequest(<span class="hljs-string">"POST"</span>, ApiURL, bytes.NewBuffer(payloadBytes))
    req.Header.Set(<span class="hljs-string">"Access-Id"</span>, AccessID)
    req.Header.Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)

	<span class="hljs-comment">// 解析响应</span>
	<span class="hljs-keyword">var</span> apiResp ApiResponse
	<span class="hljs-keyword">if</span> err := json.NewDecoder(resp.Body).Decode(&amp;apiResp); err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
	}

	<span class="hljs-keyword">if</span> apiResp.Code == <span class="hljs-number">0</span> {
		decryptedBytes, err := Decrypt(apiResp.Data, []<span class="hljs-type">byte</span>(AccessKey))
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
		}
		<span class="hljs-keyword">var</span> result LendingResult
		json.Unmarshal(decryptedBytes, &amp;result)
		<span class="hljs-keyword">return</span> &amp;result, <span class="hljs-literal">nil</span>
	}
	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"API Error: %s"</span>, apiResp.Message)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	res, err := QueryRisk(<span class="hljs-string">"张三"</span>, <span class="hljs-string">"110101199001011234"</span>, <span class="hljs-string">"13800138000"</span>)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		fmt.Println(err)
	} <span class="hljs-keyword">else</span> {
		fmt.Printf(<span class="hljs-string">"查询结果标识: %s, 本月还款压力: %s\n"</span>, res.FlagTotalloan, res.CurrentStressLevel)
	}
}
</code></pre>
<h2 data-id="heading-4">3. 核心数据结构解析：Struct Tag 的艺术</h2>
<p>由于该 API 返回的字段极多（覆盖 T0-T11 每个月的借贷、还款、机构数等），在 Go 中定义结构体时，我们有几种策略：</p>
<h3 data-id="heading-5">3.1 策略 A：按需定义（推荐）</h3>
<p>只定义业务逻辑中强依赖的字段，忽略其他字段。这能减少内存占用。</p>
<p>Go</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> CoreRiskData <span class="hljs-keyword">struct</span> {
    <span class="hljs-comment">// 借贷行为标识: 1:成功 0:无数据 </span>
    Flag <span class="hljs-type">string</span> <span class="hljs-string">`json:"flag_totalloan"`</span> 
    
    <span class="hljs-comment">// 重点关注 T0 (本月) 和 T1 (上月) 的数据 </span>
    T0_OrgCount  <span class="hljs-type">string</span> <span class="hljs-string">`json:"tl_id_t0_nbank_org"`</span>    <span class="hljs-comment">// 本月新增机构数</span>
    T0_RepayAmt  <span class="hljs-type">string</span> <span class="hljs-string">`json:"tl_id_t0_nbank_reamt"`</span>  <span class="hljs-comment">// 本月应还款等级 (1-101)</span>
    
    T1_OrgCount  <span class="hljs-type">string</span> <span class="hljs-string">`json:"tl_id_t1_nbank_org"`</span>    <span class="hljs-comment">// 上月新增机构数</span>
    T1_RepayAmt  <span class="hljs-type">string</span> <span class="hljs-string">`json:"tl_id_t1_nbank_reamt"`</span>  <span class="hljs-comment">// 上月应还款等级</span>
}
</code></pre>
<h3 data-id="heading-6">3.2 策略 B：动态 Map (全量保留)</h3>
<p>如果需要将数据原样存储到 MongoDB 或 ES 中，可以使用 <code>map[string]interface{}</code>。</p>
<p>Go</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> resultMap <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}
json.Unmarshal(decryptedBytes, &amp;resultMap)

<span class="hljs-comment">// 访问时需要断言</span>
<span class="hljs-keyword">if</span> val, ok := resultMap[<span class="hljs-string">"tl_id_m3_nbank_passnum"</span>]; ok {
    fmt.Println(<span class="hljs-string">"近3个月借贷次数:"</span>, val)
}
</code></pre>
<h3 data-id="heading-7">3.3 关键指标解读</h3>
<ul>
<li><strong><code>flag_totalloan</code></strong>: 最重要的入口判断。<code>1</code> 代表有数据；<code>0</code> 代表无匹配（白户）；<code>98</code> 代表输入信息不足 。</li>
<li><strong><code>tl_id_t0_nbank_reamt</code></strong>: <strong>还款压力指数</strong>。这是 T0（当前月）的非银机构应还款等级。数值越高（接近 101），说明用户当月资金链越紧绷，违约风险极高 。</li>
<li><strong><code>tl_id_m12_nbank_passnum</code></strong>: <strong>长期借贷活跃度</strong>。过去一年的总次数，用于判断用户是否为“老哥”或常贷客 。</li>
</ul>
<h2 data-id="heading-8">4. 应用价值分析：高并发风控网关</h2>
<p>利用 Go 的协程特性，我们可以将<strong>天远 API</strong> 集成到高性能的风控网关中。</p>
<h3 data-id="heading-9">场景：批量存量客户“体检”</h3>
<p>假设你需要在一夜之间对 10 万名存量用户进行风险排查，筛查出“隐性负债”激增的用户。</p>
<p><strong>Go 并发方案：</strong></p>
<p>Go</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BatchCheck</span><span class="hljs-params">(users []User)</span></span> {
    <span class="hljs-keyword">var</span> wg sync.WaitGroup
    <span class="hljs-comment">// 限制并发数为 50，避免带宽拥堵</span>
    semaphore := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>{}, <span class="hljs-number">50</span>) 

    <span class="hljs-keyword">for</span> _, u := <span class="hljs-keyword">range</span> users {
        wg.Add(<span class="hljs-number">1</span>)
        <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(user User)</span></span> {
            <span class="hljs-keyword">defer</span> wg.Done()
            semaphore &lt;- <span class="hljs-keyword">struct</span>{}{} <span class="hljs-comment">// 获取令牌</span>
            <span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> { &lt;-semaphore }() <span class="hljs-comment">// 释放令牌</span>

            res, _ := QueryRisk(user.Name, user.ID, user.Phone)
            
            <span class="hljs-comment">// 业务逻辑：如果本月还款压力 &gt; 80 且 上月机构数 &gt; 3</span>
            <span class="hljs-keyword">if</span> res != <span class="hljs-literal">nil</span> &amp;&amp; res.CurrentStressLevel &gt; <span class="hljs-string">"80"</span> {
                fmt.Printf(<span class="hljs-string">"高危用户预警: %s\n"</span>, user.ID)
            }
        }(u)
    }
    wg.Wait()
}
</code></pre>
<p>此方案能充分利用天远 API <strong>无调用频率限制</strong> 的优势，以最快速度完成全量数据清洗。</p>
<h2 data-id="heading-10">5. 总结</h2>
<p>使用 Go 语言对接<strong>天远借贷行为验证API</strong>，是构建高性能风控系统的最佳实践。</p>
<ol>
<li><strong>性能</strong>：Go 对 AES 加密的处理效率极高，适合高 QPS 场景。</li>
<li><strong>类型安全</strong>：通过 Struct Tag 能够清晰地管理 API 返回的 130+ 个复杂字段，避免了弱类型语言中常见的字段拼写错误。</li>
<li><strong>时效性</strong>：结合 API 提供的 T0-T11 时间轴数据，您可以构建实时的“借贷压力监控仪表盘”。</li>
</ol>
<p><strong>建议</strong>：在生产环境中，建议将 HTTP Client 设置为全局复用，并开启长连接（Keep-Alive），进一步降低 TCP 握手开销，将 API 响应时间压缩到极致。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[苹果商店 App 上架要求，探讨如何通过系统审核]]></title>    <link>https://juejin.cn/post/7587468062210654244</link>    <guid>https://juejin.cn/post/7587468062210654244</guid>    <pubDate>2025-12-25T09:36:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587468062210654244" data-draft-id="7587582213061148726" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="苹果商店 App 上架要求，探讨如何通过系统审核"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-25T09:36:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="开心猴爷"/> <meta itemprop="url" content="https://juejin.cn/user/2179705232165364"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            苹果商店 App 上架要求，探讨如何通过系统审核
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2179705232165364/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    开心猴爷
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T09:36:34.000Z" title="Thu Dec 25 2025 09:36:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果把苹果商店的审核要求简单理解为一份规则清单，很容易产生一种错觉，只要逐条对照，就一定能通过。</p>
<p>但在多次参与上架和被拒处理之后，我逐渐意识到，苹果真正关心的并不是你有没有犯某一条错，而是：你的结果状态，是否足够稳定、可预测、可解释。</p>
<p>所谓上架要求，本质上是在验证这一点。</p>
<hr/>
<h2 data-id="heading-0"><strong>审核并不是在审代码，而是在审一个完整结果</strong></h2>
<p>从审核系统的角度看，它并不知道你是用原生、跨端、HBuilder 还是 CI 构建的。
它看到的只有几个结果性对象：</p>
<ul>
<li>应用在账号体系中的身份</li>
<li>签名与发布关系是否合理</li>
<li>构建产物是否自洽</li>
<li>应用行为是否与声明一致</li>
</ul>
<p>只要其中任意一项呈现出不稳定或不可解释的状态，就会触发拒审。</p>
<hr/>
<h2 data-id="heading-1"><strong>应用身份不清晰，是最容易被忽略的前置条件</strong></h2>
<p>在很多项目中，Bundle ID 只是一个“配置项”，但在审核系统里，它是应用的唯一身份。</p>
<p>我见过不少项目，在工程内部运行一切正常，但在审核阶段反复出现异常，原因只是：</p>
<ul>
<li>Bundle ID 曾被历史项目使用</li>
<li>测试包和正式包共用标识</li>
<li>构建产物与账号中已有应用不一致</li>
</ul>
<p>这类问题并不是违反审核条款，而是 <strong>工程身份模糊</strong>。</p>
<p>在非 macOS 环境下，我通常会通过 <strong>开心上架（Appuploader）查看开发者账号中的应用标识与 Bundle ID 列表</strong>，确认当前工程到底对应哪个“真实存在”的应用。这一步并不会改变代码，但会极大降低方向性错误。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c35eb816b98425da3ce1b144499daeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D54y054i3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767260194&amp;x-signature=U7IQ2l5k6MP6VzPu2pF%2FgHZz4vw%3D" alt="查看bid" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-2"><strong>证书问题一般是，是否匹配当前阶段</strong></h2>
<p>苹果的审核规则几乎不提证书，但工程实践中，证书是上架资格的基础。</p>
<p>常见的失败并不是证书不存在，而是：</p>
<ul>
<li>构建阶段使用了开发证书</li>
<li>发布证书只存在于某一台 Mac</li>
<li>构建与上传使用了不同证书</li>
</ul>
<p>这些问题在开发阶段不一定暴露，但在提交或审核阶段会被直接识别。</p>
<p>在一些多系统参与的项目中，我更倾向于使用 <strong>开心上架（Appuploader）创建并管理 iOS 证书</strong>，将证书以 <code>.p12</code> 文件的形式明确下来，让“用的是哪张证书”变成一个可追溯的事实，而不是猜测。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/346d43d9dc8740fdb06cd09e3f8211b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D54y054i3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767260194&amp;x-signature=FeBdq8OAOVOkxcpMaHIi5fTOxfM%3D" alt="创建证书" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-3"><strong>描述文件，是审核系统判断“合理性”的重要线索</strong></h2>
<p>描述文件在工程中存在感不强，但在审核体系里，它承担的是“关联证明”的角色。</p>
<p>审核并不会关心你怎么生成描述文件，但会关心：</p>
<ul>
<li>描述文件类型是否符合上架场景</li>
<li>描述文件绑定的 Bundle ID 是否一致</li>
<li>签名关系是否合理</li>
</ul>
<p>当这些信息无法自洽时，即便应用功能完全合规，也可能被拒。</p>
<p>在提交前，通过 <strong>开心上架（Appuploader）查看 mobileprovision 文件内容</strong>，确认描述文件的真实属性，往往能提前发现一些“隐性不合规”。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1394abb56d364dd59a42adef94d70c97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D54y054i3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767260194&amp;x-signature=%2FR8zarYB9jguf%2F%2BFZHEXFfz3n3Q%3D" alt="查看描述文件" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-4"><strong>IPA 是审核系统唯一认可的事实来源</strong></h2>
<p>在工程内部，你可能知道：</p>
<ul>
<li>这个功能只是测试用</li>
<li>那个配置只是临时的</li>
<li>某些代码不会被走到</li>
</ul>
<p>但在审核系统眼中，<strong>只有 IPA 内的内容是真实存在的</strong>。</p>
<p>我处理过的被拒案例中，有不少并不是功能违规，而是：</p>
<ul>
<li>IPA 内仍然存在测试入口</li>
<li>Info.plist 中保留调试标志</li>
<li>资源或配置与描述不一致</li>
</ul>
<p>在不依赖 Xcode 的情况下，可以通过 <strong>开心上架（Appuploader）查看 IPA 内容</strong>，在提交前确认 IPA 内部到底“长什么样”。这一步不会修复问题，但能让问题提前暴露。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aabc941da6c2472ab56df90b52ff5a29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D54y054i3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767260194&amp;x-signature=ujed%2B2ri4rjhAwRkraRrcN0ZAWM%3D" alt="查看ipa" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-5"><strong>上传方式，间接影响审核判断的稳定性</strong></h2>
<p>虽然审核规则不限定上传工具，但工程上，上传方式会影响流程的一致性。</p>
<p>当上传强依赖某一台 Mac 或某个 Xcode 状态时：</p>
<ul>
<li>失败重试成本高</li>
<li>发布环境不可复现</li>
<li>问题难以回溯</li>
</ul>
<p>在一些项目中，我们使用 <strong>开心上架（Appuploader）的上传方式</strong>，将上传行为变成一条明确的命令或操作记录，使“谁在什么环境上传了什么包”变得可追溯。</p>
<p>这并不会改变审核标准，但会让工程行为更稳定。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de70a57bb96a41368cfd4242a363cde9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D54y054i3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767260194&amp;x-signature=A7lYtQR5kS8Igq6T8KPi2evL5PI%3D" alt="ipa上传" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-6"><strong>为什么很多人觉得苹果上架要求很严格</strong></h2>
<p>从工程角度看，严格的并不是规则，而是 <strong>一致性要求</strong>。</p>
<p>当应用的身份、签名、构建结果和行为描述彼此一致时，审核通常并不复杂。
反之，只要其中一环显得“随意”，问题就会被放大。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter 应用加固在真实项目中的实践方式，当 Dart 之外还有一整个 IPA]]></title>    <link>https://juejin.cn/post/7587619946188947507</link>    <guid>https://juejin.cn/post/7587619946188947507</guid>    <pubDate>2025-12-25T09:45:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587619946188947507" data-draft-id="7587459328070811658" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter 应用加固在真实项目中的实践方式，当 Dart 之外还有一整个 IPA"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-25T09:45:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="开心就好2025"/> <meta itemprop="url" content="https://juejin.cn/user/3850962908492660"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter 应用加固在真实项目中的实践方式，当 Dart 之外还有一整个 IPA
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3850962908492660/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    开心就好2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T09:45:34.000Z" title="Thu Dec 25 2025 09:45:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Flutter 项目里，很多工程师第一次讨论安全问题时，关注点往往集中在 Dart 层：
是不是可以混淆 Dart 代码？AOT 之后是不是已经足够“看不懂”？
这些判断并不算错，但在实际项目中，很快就会遇到一个更现实的问题——<strong>攻击者并不关心你用的是 Dart 还是 Swift，他们拿到的永远是一个 IPA。</strong></p>
<p>也正因为如此，“Flutter 应用加固”在工程语境下，往往不是某一个技术点，而是一整套围绕 IPA 展开的实践。</p>
<p>下面的内容，会从真实项目经验出发，聊一聊 Flutter 应用在加固时常见的误区、多工具组合的必要性，以及如何直接加固IPA。</p>
<hr/>
<h2 data-id="heading-0">一、Flutter 项目为什么很容易被“误判为安全”</h2>
<p>在不少团队里，Flutter 天然被认为比纯原生更安全，原因也很直观：</p>
<ul>
<li>Dart 代码最终是 AOT 编译</li>
<li>没有完整的源码结构暴露</li>
<li>逻辑集中在一个二进制里</li>
</ul>
<p>但当工程师真正把 IPA 解包之后，通常会意识到另一个事实：</p>
<ul>
<li>Flutter App 仍然包含原生壳</li>
<li>Dart AOT 只是其中一部分</li>
<li>资源、配置、引擎文件全部在包内</li>
<li>二次打包的路径依然完整</li>
</ul>
<p>也就是说，<strong>Flutter 并没有改变攻击入口，只是改变了其中一层的语言形态</strong>。</p>
<hr/>
<h2 data-id="heading-1">二、只依赖 Dart 层混淆，往往不够用</h2>
<p>在一些项目中，团队会先尝试 Dart 层的安全手段：</p>
<ul>
<li>使用 Flutter 官方的混淆选项</li>
<li>开启 release 模式</li>
<li>移除调试信息</li>
</ul>
<p>这些措施确实能提升理解成本，但在工程实践中，很快会暴露出边界：</p>
<ul>
<li>对资源文件没有任何约束</li>
<li>对原生层几乎没有影响</li>
<li>对已经生成的 IPA 无法补救</li>
<li>对重签和二次分发没有阻断作用</li>
</ul>
<p>结果通常是：
<strong>Dart 代码变难了，但 IPA 依然很好用。</strong></p>
<hr/>
<h2 data-id="heading-2">三、Flutter 应用的真实风险，往往来自“混合结构”</h2>
<p>Flutter 应用并不是一个纯 Dart 世界，它至少包含：</p>
<ul>
<li>Flutter Engine</li>
<li>Dart AOT 产物</li>
<li>原生 iOS 代码</li>
<li>图片、字体、配置、资源</li>
</ul>
<p>在实际攻击中，常见路径包括：</p>
<ul>
<li>替换资源影响 UI 或逻辑表现</li>
<li>修改配置改变行为</li>
<li>重签 IPA 进行二次分发</li>
</ul>
<p>这些操作几乎不需要理解 Dart 代码本身。</p>
<hr/>
<h2 data-id="heading-3">四、工程语境下的 Flutter 应用加固，通常分几层</h2>
<p>在较为成熟的项目中，Flutter 应用加固往往不是单点行为，而是逐步叠加：</p>
<ul>
<li>Dart 层：基础混淆，降低逻辑可读性</li>
<li>原生层：必要的混淆和运行时防护</li>
<li>IPA 层：对代码与资源的整体处理</li>
</ul>
<p>这三层各自解决不同的问题，也各自有明确边界。</p>
<hr/>
<h2 data-id="heading-4">五、Ipa Guard 在 Flutter 应用加固中的实际定位</h2>
<p><strong>Ipa Guard</strong> 并不是 Flutter 专用工具，但它在 Flutter 项目中反而非常实用，因为它关注的是<strong>IPA 本身</strong>。</p>
<p>在真实工程里，它通常被用来完成这些事情：</p>
<ul>
<li><strong>无需 iOS App 源码</strong>，直接对 Flutter 应用的 IPA 文件进行处理</li>
<li>对 Swift、ObjC 的类名、方法名、变量名进行重命名和混淆</li>
<li>覆盖主程序与代码库，而不仅是 Flutter 壳</li>
<li>对图片、字体、JSON、配置等资源文件进行改名</li>
<li>修改资源 MD5，降低直接替换后的稳定性</li>
<li>支持 Flutter、OC、Swift、React Native、H5 等多种应用形态</li>
<li>支持命令行方式，便于批量和自动化处理</li>
</ul>
<p>这些能力解决的并不是 Dart 层的问题，而是 <strong>Flutter 应用在成品阶段的暴露问题</strong>。</p>
<hr/>
<h2 data-id="heading-5">六、为什么 Flutter 项目更需要资源层的保护</h2>
<p>在多个 Flutter 项目中，一个很明显的现象是：</p>
<ul>
<li>Dart 逻辑不容易看懂</li>
<li>但资源文件非常直观</li>
<li>图片、字体、配置几乎没有防护</li>
</ul>
<p>攻击者往往并不需要深入分析 Dart，只要能通过资源替换改变表现，就已经达到了目的。</p>
<p>Ipa Guard 对资源文件的改名和特征修改，在 Flutter 项目中往往是<strong>最先见效的一步</strong>。</p>
<hr/>
<h2 data-id="heading-6">七、一个更贴近现实的 Flutter 应用加固过程</h2>
<p>以一个已经上线的 Flutter 应用为例：</p>
<ul>
<li>Dart 逻辑稳定</li>
<li>原生壳较薄</li>
<li>多渠道版本需要统一交付</li>
</ul>
<p>工程师通常会采用这样的组合方式：</p>
<ul>
<li>保留 Dart 层官方混淆</li>
<li>原生层维持基础防护</li>
<li>在 IPA 生成后，引入 Ipa Guard</li>
<li>对原生符号进行重命名</li>
<li>对图片、配置、资源文件进行改名和特征调整</li>
<li>混淆完成后重签并进行真机验证</li>
</ul>
<p>最终的效果不是“Flutter 不可逆向”，而是<strong>修改和复用的成本显著提高</strong>。</p>
<hr/>
<h2 data-id="heading-7">八、Flutter 应用加固中常见的一个误区</h2>
<p>在实践中，一个容易出现的误区是：
把 Flutter 的“跨平台特性”当成安全优势。</p>
<p>结果往往是：</p>
<ul>
<li>Dart 层保护投入过多</li>
<li>IPA 层处理不足</li>
<li>加固效果与投入不成正比</li>
</ul>
<p>相比之下，把注意力放回 IPA 整体结构，往往更符合工程现实。</p>
<hr/>
<h2 data-id="heading-8">关于 Flutter 应用加固的一个判断</h2>
<p>多次实践之后，一个比较一致的结论是：</p>
<ul>
<li>Flutter 并不会天然提升或降低安全性</li>
<li>安全取决于你是否覆盖了真实攻击路径</li>
<li>只要 IPA 不再容易被分析和修改，加固就有实际意义</li>
</ul>
<p>在这个前提下，多工具组合比单点技术更可靠。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Tokio 源码学习01——Mutex]]></title>    <link>https://juejin.cn/post/7587518397950033974</link>    <guid>https://juejin.cn/post/7587518397950033974</guid>    <pubDate>2025-12-25T08:55:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587518397950033974" data-draft-id="7587329107304169535" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Tokio 源码学习01——Mutex"/> <meta itemprop="keywords" content="Rust"/> <meta itemprop="datePublished" content="2025-12-25T08:55:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="清醒的土土土"/> <meta itemprop="url" content="https://juejin.cn/user/4226977997533367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Tokio 源码学习01——Mutex
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4226977997533367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    清醒的土土土
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T08:55:08.000Z" title="Thu Dec 25 2025 08:55:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、为什么需要异步 Mutex？</h2>
<p>在开始深入 Tokio Mutex 之前，我们先思考一个问题：<strong>Rust 标准库不是已经有 <code>std::sync::Mutex</code> 了吗？为什么 Tokio 还要重新实现一个？</strong></p>
<p>答案在于 <strong>异步编程与同步编程的本质差异</strong>。</p>
<h3 data-id="heading-1">1.1 核心问题：<code>.await</code> 期间持有锁</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 使用 std::sync::Mutex 的错误示例</span>
<span class="hljs-keyword">use</span> std::sync::Mutex;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">bad_example</span>(mutex: &amp;Mutex&lt;<span class="hljs-type">Vec</span>&lt;<span class="hljs-type">u32</span>&gt;&gt;) {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">guard</span> = mutex.<span class="hljs-title function_ invoke__">lock</span>().<span class="hljs-title function_ invoke__">unwrap</span>();  <span class="hljs-comment">// 阻塞获取锁</span>
    <span class="hljs-comment">// 警告：持有守卫时跨越 .await</span>
    <span class="hljs-title function_ invoke__">some_async_function</span>().<span class="hljs-keyword">await</span>;         <span class="hljs-comment">// 编译器警告！</span>
    <span class="hljs-title function_ invoke__">drop</span>(guard);
}
</code></pre>
<p><strong>问题分析</strong>：</p>
<ul>
<li><code>std::sync::Mutex::lock()</code> 是<strong>阻塞式</strong>的，会阻塞当前线程</li>
<li>如果在持有 <code>MutexGuard</code> 时调用 <code>.await</code>，守卫的生命周期可能跨越 <code>.await</code> 点</li>
<li>当任务被挂起时，锁仍被持有，但其他任务可能被调度到同一个线程上运行</li>
<li>如果这些任务也尝试获取同一个锁，由于锁还被上一个任务持有，就会导致<strong>死锁</strong></li>
</ul>
<h3 data-id="heading-2">1.2 Tokio Mutex 的解决方案</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 使用 tokio::sync::Mutex 的正确示例</span>
<span class="hljs-keyword">use</span> tokio::sync::Mutex;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">good_example</span>(mutex: &amp;Mutex&lt;<span class="hljs-type">Vec</span>&lt;<span class="hljs-type">u32</span>&gt;&gt;) {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">guard</span> = mutex.<span class="hljs-title function_ invoke__">lock</span>().<span class="hljs-keyword">await</span>;  <span class="hljs-comment">// 异步获取锁</span>
    <span class="hljs-comment">// 安全：可以跨越 .await 点</span>
    <span class="hljs-title function_ invoke__">some_async_function</span>().<span class="hljs-keyword">await</span>;
    <span class="hljs-title function_ invoke__">drop</span>(guard);
}
</code></pre>
<p><strong>关键优势</strong>：</p>
<ul>
<li><code>lock()</code> 返回 <code>Future</code>，<strong>不会阻塞线程</strong></li>
<li>Guard 可以安全地跨越 <code>.await</code> 点</li>
<li>如果锁不可用，任务会<strong>让出执行权</strong>，而不是阻塞线程</li>
<li>被挂起的任务会被放入等待队列，锁可用时会被<strong>自动唤醒</strong></li>
<li>在该场景下，对比std的Mutex，tokio的Mutex可以有效的利用CPU资源</li>
</ul>
<hr/>
<h2 data-id="heading-3">二、核心设计原理</h2>
<h3 data-id="heading-4">2.1 基于信号量的实现</h3>
<p>Tokio Mutex 的核心是一个<strong>计数为 1 的信号量</strong>（Semaphore）：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">classDiagram
    class Mutex~T~ {
        +Semaphore s
        +UnsafeCell~T~ c
    }
    class Semaphore {
        +AtomicUsize permits
        +LinkedList~Waiter~ waiters
    }
    class UnsafeCell~T~ {
        +T value
    }
    class Waiter {
        +Option~Waker~ waker
        +AtomicUsize state
    }

    Mutex~T~ --&gt; Semaphore : s (信号量，管理锁的获取/释放)
    Mutex~T~ --&gt; UnsafeCell~T~ : c (数据)
    Semaphore --&gt; Waiter : 管理等待队列

    note for Semaphore &amp;#34;permits: 1 → 锁可用&lt;br&gt;permits: 0 → 锁被占用&amp;#34;
    note for UnsafeCell &amp;#34;提供内部可变性&lt;br&gt;在只有引用时，可以修改内部数据&amp;#34;
</code></pre>
<p><strong>为什么使用信号量？</strong></p>
<ol>
<li><strong>FIFO 公平性</strong>：信号量维护一个先进先出的等待队列</li>
<li><strong>异步友好</strong>：内置 Waker 机制，支持任务挂起和唤醒</li>
</ol>
<h3 data-id="heading-5">2.2 锁获取流程</h3>
<p><strong>获取锁的核心逻辑（伪代码）</strong>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">lock</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> MutexGuard&lt;<span class="hljs-symbol">'_</span>, T&gt; {
    <span class="hljs-comment">// 步骤 1: 尝试从信号量获取许可</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.semaphore.<span class="hljs-title function_ invoke__">acquire</span>(<span class="hljs-number">1</span>) {
        <span class="hljs-comment">// 成功：permits 从 1 变为 0，立即获得锁</span>
        <span class="hljs-keyword">return</span> MutexGuard { lock: <span class="hljs-keyword">self</span> };
    }

    <span class="hljs-comment">// 失败：permits 已经是 0，需要等待</span>
    <span class="hljs-comment">// 步骤 2: 创建等待节点，保存当前任务的 Waker</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">waiter</span> = Waiter::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-title function_ invoke__">current_task_waker</span>());

    <span class="hljs-comment">// 步骤 3: 加入 FIFO 等待队列</span>
    <span class="hljs-keyword">self</span>.semaphore.waiters.<span class="hljs-title function_ invoke__">push_back</span>(waiter);

    <span class="hljs-comment">// 步骤 4: 返回 Pending，挂起当前任务</span>
    <span class="hljs-comment">// 任务会被放入运行时的等待队列，线程可以执行其他任务</span>
    Pending.<span class="hljs-title function_ invoke__">yield_now</span>().<span class="hljs-keyword">await</span>;
}
</code></pre>
<p><strong>释放锁的流程</strong>：</p>
<p>释放锁时，会唤醒等待的任务获取锁。</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">impl</span>&lt;T&gt; <span class="hljs-built_in">Drop</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">MutexGuard</span>&lt;<span class="hljs-symbol">'_</span>, T&gt; {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">drop</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
        <span class="hljs-comment">// 步骤 1: 释放信号量许可</span>
        <span class="hljs-keyword">self</span>.lock.semaphore.<span class="hljs-title function_ invoke__">release</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// permits: 0 → 1</span>

        <span class="hljs-comment">// 步骤 2: 检查等待队列</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(waiter) = <span class="hljs-keyword">self</span>.lock.semaphore.waiters.<span class="hljs-title function_ invoke__">pop_front</span>() {
            <span class="hljs-comment">// 步骤 3: 唤醒队列中的第一个等待者</span>
            <span class="hljs-comment">// permits: 1 → 0（被唤醒的等待者获得锁）</span>
            waiter.waker.<span class="hljs-title function_ invoke__">wake</span>();
        }
    }
}
</code></pre>
<p><strong>关键点说明</strong>：</p>
<ol>
<li><strong>原子操作</strong>：<code>try_acquire</code> 使用原子指令（如 <code>fetch_sub</code>），确保多线程安全</li>
<li><strong>FIFO 公平性</strong>：等待队列是先进先出，按请求顺序分配锁</li>
<li><strong>零成本挂起</strong>：任务挂起时不阻塞 OS 线程，线程可以执行其他任务</li>
<li><strong>Waker 机制</strong>：每个等待者保存一个 <code>Waker</code>，锁释放时通过 <code>wake()</code> 唤醒对应的任务</li>
</ol>
<h3 data-id="heading-6">2.3 三种 Guard 类型</h3>
<p>Tokio Mutex 提供了三种不同的 Guard 类型，分别适用于不同的使用场景：</p>





























<table><thead><tr><th>类型</th><th>特性</th><th>生命周期</th><th>使用场景</th></tr></thead><tbody><tr><td><code>MutexGuard&lt;'a, T&gt;</code></td><td>借用 <code>&amp;Mutex</code></td><td><code>'a</code></td><td>一般场景，最常用</td></tr><tr><td><code>OwnedMutexGuard&lt;T&gt;</code></td><td>持有 <code>Arc&lt;Mutex&gt;</code></td><td><code>'static</code></td><td>需要跨任务传递 Guard</td></tr><tr><td><code>MappedMutexGuard&lt;'a, T&gt;</code></td><td>映射到子字段</td><td><code>'a</code></td><td>只需访问部分数据</td></tr></tbody></table>
<h4 data-id="heading-7">内存布局对比</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">classDiagram
    class Mutex~T~ {
        +Semaphore s
        +UnsafeCell~T~ c
    }

    class MutexGuard {
        + &amp;'a Mutex~T~ lock
    }

    class OwnedMutexGuard {
        +Arc~Mutex~T~~ lock
    }

    class MappedMutexGuard {
        +&amp;'a Semaphore s
        +*mut T data
    }

    MutexGuard --&gt; Mutex~T~ : 借用 (lifetime 'a)
    OwnedMutexGuard --&gt; Mutex~T~ : 拥有 (Arc, 'static)
    MappedMutexGuard --&gt; T : 指向子字段

    note for MutexGuard &amp;#34;最常用&lt;br&gt;借用 Mutex&lt;br&gt;生命周期 'a&amp;#34;
    note for OwnedMutexGuard &amp;#34;可跨任务传递&lt;br&gt;持有 Arc&lt;br&gt;生命周期 'static&amp;#34;
    note for MappedMutexGuard &amp;#34;限制访问范围&lt;br&gt;只访问子字段&lt;br&gt;生命周期 'a&amp;#34;
</code></pre>
<h3 data-id="heading-8">2.4  MutexGuard 与 OwnedMutexGuard的详细对比</h3>













































<table><thead><tr><th>特性</th><th>MutexGuard</th><th>OwnedMutexGuard</th></tr></thead><tbody><tr><td><strong>持有方式</strong></td><td>借用 <code>&amp;Mutex</code></td><td>持有 <code>Arc&lt;Mutex&gt;</code></td></tr><tr><td><strong>生命周期</strong></td><td><code>'a</code> (受 Mutex 限制)</td><td><code>'static</code> (无限制)</td></tr><tr><td><strong>创建方法</strong></td><td><code>mutex.lock()</code></td><td><code>mutex.clone().lock_owned()</code></td></tr><tr><td><strong>Send</strong></td><td>✅ 是</td><td>✅ 是</td></tr><tr><td><strong>存储需求</strong></td><td>Mutex 必须比 Guard 长活</td><td>无限制</td></tr><tr><td><strong>跨线程</strong></td><td>受生命周期限制</td><td>完全自由</td></tr><tr><td><strong>典型场景</strong></td><td>临时访问、作用域内</td><td>存储、传递、跨任务</td></tr></tbody></table>
<h4 data-id="heading-9">MutexGuard - 借用模式</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">MutexGuard</span>&lt;<span class="hljs-symbol">'a</span>, T: ?<span class="hljs-built_in">Sized</span>&gt; {
    lock: &amp;<span class="hljs-symbol">'a</span> Mutex&lt;T&gt;,  <span class="hljs-comment">// ← 借用引用</span>
    <span class="hljs-comment">//     ^^^</span>
    <span class="hljs-comment">//     这是关键！Guard 持有的是 Mutex 的引用</span>
}

<span class="hljs-comment">// 创建</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">example1</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">mutex</span> = Mutex::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">42</span>);
    
    {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">guard</span> = mutex.<span class="hljs-title function_ invoke__">lock</span>().<span class="hljs-keyword">await</span>;
        <span class="hljs-comment">//        ^^^^^ 借用 &amp;mutex</span>
        *guard = <span class="hljs-number">100</span>;
    } <span class="hljs-comment">// guard 释放，mutex 仍然存在</span>
}

<span class="hljs-comment">// 生命周期限制</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">example2</span>() <span class="hljs-punctuation">-&gt;</span> MutexGuard&lt;<span class="hljs-symbol">'static</span>, <span class="hljs-type">i32</span>&gt; {  <span class="hljs-comment">// ❌ 编译错误！</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">mutex</span> = Mutex::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">42</span>);
    mutex.<span class="hljs-title function_ invoke__">lock</span>().<span class="hljs-keyword">await</span>  <span class="hljs-comment">// 返回的生命周期不够长</span>
}
</code></pre>
<ul>
<li>调用lock后返回的<code>guard</code>是<code>MutexGuard</code>类型，<code>guard</code>修改时，是通过<code>MutexGuard</code>类型的<code>deref_mut</code>等方法操作了内部数据实现的。</li>
<li>当 } 结束后，<code>guard</code>的生命周期释放，这时会自动调用<code>MutexGuard</code>类型的<code>drop</code>方法实现释放锁。</li>
<li>整个过程看似，我们都在操作带锁的数据，实际上，我们操作的都是包含锁的<code>MutexGuard</code>类型。</li>
</ul>
<h4 data-id="heading-10">OwnedMutexGuard - 拥有模式</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">OwnedMutexGuard</span>&lt;T: ?<span class="hljs-built_in">Sized</span>&gt; {
    lock: Arc&lt;Mutex&lt;T&gt;&gt;,  <span class="hljs-comment">// ← 拥有 Arc</span>
    <span class="hljs-comment">//     ^^^</span>
    <span class="hljs-comment">//     这是关键！Guard 持有的是 Mutex 的所有权</span>
}

<span class="hljs-comment">// 创建</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">example3</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">mutex</span> = Arc::<span class="hljs-title function_ invoke__">new</span>(Mutex::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">42</span>));
    
    {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">guard</span> = mutex.<span class="hljs-title function_ invoke__">clone</span>().<span class="hljs-title function_ invoke__">lock_owned</span>().<span class="hljs-keyword">await</span>;
        <span class="hljs-comment">//        ^^^^^^ clone Arc</span>
        *guard = <span class="hljs-number">100</span>;
    } <span class="hljs-comment">// guard 释放，但 Arc 引用可能还在</span>
}

<span class="hljs-comment">// 无生命周期限制</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">example4</span>() <span class="hljs-punctuation">-&gt;</span> OwnedMutexGuard&lt;<span class="hljs-type">i32</span>&gt; {  <span class="hljs-comment">// ✅ 可以！</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">mutex</span> = Arc::<span class="hljs-title function_ invoke__">new</span>(Mutex::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">42</span>));
    mutex.<span class="hljs-title function_ invoke__">clone</span>().<span class="hljs-title function_ invoke__">lock_owned</span>().<span class="hljs-keyword">await</span>
}
</code></pre>
<h4 data-id="heading-11">应用场景对比</h4>
<h5 data-id="heading-12">场景 1: 临时访问（MutexGuard）</h5>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">temp_access</span>(mutex: &amp;Mutex&lt;<span class="hljs-type">i32</span>&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">i32</span> {
    <span class="hljs-comment">// 场景：只需要临时访问数据</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">guard</span> = mutex.<span class="hljs-title function_ invoke__">lock</span>().<span class="hljs-keyword">await</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">value</span> = *guard;
    <span class="hljs-title function_ invoke__">drop</span>(guard);  <span class="hljs-comment">// 显式释放</span>
    value
}
<span class="hljs-comment">// MutexGuard 最适合这种场景</span>
</code></pre>
<h5 data-id="heading-13">场景 2: 存储 Guard（需要 OwnedMutexGuard）</h5>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">MyServer</span> {
    <span class="hljs-comment">// ❌ MutexGuard 不能存储！</span>
    <span class="hljs-comment">// guard: MutexGuard&lt;'a, i32&gt;,  // 生命周期 'a 无法确定</span>
    
    <span class="hljs-comment">// ✅ OwnedMutexGuard 可以存储！</span>
    guard: OwnedMutexGuard&lt;<span class="hljs-type">i32</span>&gt;,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">MyServer</span> {
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(mutex: Arc&lt;Mutex&lt;<span class="hljs-type">i32</span>&gt;&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">guard</span> = mutex.<span class="hljs-title function_ invoke__">clone</span>().<span class="hljs-title function_ invoke__">lock_owned</span>().<span class="hljs-keyword">await</span>;
        <span class="hljs-comment">//                   ^^^^^^ 使用 lock_owned</span>
        <span class="hljs-keyword">Self</span> { guard }
    }
}
</code></pre>
<h5 data-id="heading-14">场景 3: 跨任务传递（需要 OwnedMutexGuard）</h5>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">cross_task</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">mutex</span> = Arc::<span class="hljs-title function_ invoke__">new</span>(Mutex::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">42</span>));
    
    <span class="hljs-comment">// ✅ OwnedMutexGuard 可以跨任务</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">mutex2</span> = mutex.<span class="hljs-title function_ invoke__">clone</span>();
    tokio::<span class="hljs-title function_ invoke__">spawn</span>(<span class="hljs-keyword">async</span> <span class="hljs-keyword">move</span> {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">guard</span> = mutex2.<span class="hljs-title function_ invoke__">lock_owned</span>().<span class="hljs-keyword">await</span>;
        <span class="hljs-comment">// Guard 可以在这个新任务中使用</span>
        *guard = <span class="hljs-number">100</span>;
    });
}
</code></pre>
<h5 data-id="heading-15">场景 4: 返回 Guard（需要 OwnedMutexGuard）</h5>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// ❌ MutexGuard - 无法返回</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_guard_bad</span>(mutex: &amp;Mutex&lt;<span class="hljs-type">i32</span>&gt;) <span class="hljs-punctuation">-&gt;</span> MutexGuard&lt;<span class="hljs-type">i32</span>&gt; {
    mutex.<span class="hljs-title function_ invoke__">lock</span>().<span class="hljs-keyword">await</span>  <span class="hljs-comment">// 编译错误：生命周期不够长</span>
}

<span class="hljs-comment">// ✅ OwnedMutexGuard - 可以返回</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_guard_good</span>(mutex: Arc&lt;Mutex&lt;<span class="hljs-type">i32</span>&gt;&gt;) <span class="hljs-punctuation">-&gt;</span> OwnedMutexGuard&lt;<span class="hljs-type">i32</span>&gt; {
    mutex.<span class="hljs-title function_ invoke__">clone</span>().<span class="hljs-title function_ invoke__">lock_owned</span>().<span class="hljs-keyword">await</span>  <span class="hljs-comment">// 'static 生命周期</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-16">三、与 std::sync::Mutex 的本质区别</h2>
<h3 data-id="heading-17">3.1 对比表</h3>



































<table><thead><tr><th>特性</th><th><code>std::sync::Mutex</code></th><th><code>tokio::sync::Mutex</code></th></tr></thead><tbody><tr><td>获取锁方式</td><td>阻塞式 <code>lock()</code></td><td>异步式 <code>lock().await</code></td></tr><tr><td>线程阻塞</td><td>会阻塞 OS 线程</td><td>不会阻塞，任务让出</td></tr><tr><td>跨 <code>.await</code> 持有</td><td>❌ 不安全</td><td>✅ 安全</td></tr><tr><td>性能开销</td><td>低（仅原子操作）</td><td>高（信号量 + Waker）</td></tr><tr><td>使用场景</td><td>同步代码、数据保护</td><td>异步代码、IO 资源</td></tr></tbody></table>
<h3 data-id="heading-18">3.2 深入理解：为什么会有性能差异？</h3>
<p><strong>std::sync::Mutex</strong>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 伪代码</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">lock</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> LockGuard&lt;T&gt; {
    <span class="hljs-keyword">loop</span> {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">compare_and_swap</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> {
            <span class="hljs-keyword">return</span> Guard;  <span class="hljs-comment">// 获得锁</span>
        }
        <span class="hljs-comment">// 使用 futex 等待，阻塞 OS 线程</span>
        <span class="hljs-title function_ invoke__">syscall</span>(futex_wait, &amp;<span class="hljs-keyword">self</span>.state);
    }
}
</code></pre>
<p><strong>tokio::sync::Mutex</strong>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 伪代码</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">lock</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> MutexGuard&lt;T&gt; {
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.semaphore.<span class="hljs-title function_ invoke__">try_acquire</span>(<span class="hljs-number">1</span>) {
        <span class="hljs-keyword">return</span> Guard;  <span class="hljs-comment">// 获得锁</span>
    }
    <span class="hljs-comment">// 创建 Waiter，加入队列</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">waiter</span> = Waiter::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-title function_ invoke__">current_task_waker</span>());
    <span class="hljs-keyword">self</span>.queue.<span class="hljs-title function_ invoke__">push_back</span>(waiter);
    Pending <span class="hljs-comment">// 挂起任务，不阻塞线程</span>
}
</code></pre>
<p><strong>关键点</strong>：</p>
<ul>
<li>std Mutex 阻塞 OS 线程，线程无法执行其他任务</li>
<li>Tokio Mutex 挂起任务，线程可以执行其他任务</li>
<li>Tokio Mutex 额外维护了等待队列和 Waker，所以开销更大</li>
</ul>
<hr/>
<h2 data-id="heading-19">四、应用场景与实践</h2>
<h3 data-id="heading-20">4.1 何时使用 Tokio Mutex？</h3>
<h4 data-id="heading-21">✅ 适合场景</h4>
<ol>
<li><strong>IO 资源共享</strong></li>
</ol>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> tokio::sync::Mutex;
<span class="hljs-keyword">use</span> tokio::net::TcpStream;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">DatabaseConnection</span> {
    stream: TcpStream,
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">query</span>(db: &amp;Mutex&lt;DatabaseConnection&gt;, sql: &amp;<span class="hljs-type">str</span>) {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">conn</span> = db.<span class="hljs-title function_ invoke__">lock</span>().<span class="hljs-keyword">await</span>;
    <span class="hljs-comment">// 持有锁期间可能跨越多个 .await</span>
    conn.stream.<span class="hljs-title function_ invoke__">write_all</span>(sql.<span class="hljs-title function_ invoke__">as_bytes</span>()).<span class="hljs-keyword">await</span>?;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">response</span> = conn.stream.<span class="hljs-title function_ invoke__">read_buf</span>(&amp;<span class="hljs-keyword">mut</span> buf).<span class="hljs-keyword">await</span>?;
    <span class="hljs-title function_ invoke__">Ok</span>(())
}
</code></pre>
<ol start="2">
<li><strong>需要跨 <code>.await</code> 持有锁</strong></li>
</ol>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">process_with_lock</span>(mutex: &amp;Mutex&lt;Data&gt;) {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">data</span> = mutex.<span class="hljs-title function_ invoke__">lock</span>().<span class="hljs-keyword">await</span>;
    <span class="hljs-comment">// 第一个异步操作</span>
    <span class="hljs-title function_ invoke__">async_step1</span>(&amp;<span class="hljs-keyword">mut</span> data).<span class="hljs-keyword">await</span>;
    <span class="hljs-comment">// 第二个异步操作（仍然持有锁）</span>
    <span class="hljs-title function_ invoke__">async_step2</span>(&amp;<span class="hljs-keyword">mut</span> data).<span class="hljs-keyword">await</span>;
}
</code></pre>
<h4 data-id="heading-22">❌ 不适合场景</h4>
<ol>
<li><strong>纯数据保护</strong>（优先用 std Mutex）</li>
</ol>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 推荐：使用 std::sync::Mutex</span>
<span class="hljs-keyword">use</span> std::sync::Mutex;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Counter</span> {
    count: Mutex&lt;<span class="hljs-type">i32</span>&gt;,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Counter</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">increment</span>(&amp;<span class="hljs-keyword">self</span>) {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">count</span> = <span class="hljs-keyword">self</span>.count.<span class="hljs-title function_ invoke__">lock</span>().<span class="hljs-title function_ invoke__">unwrap</span>();
        *count += <span class="hljs-number">1</span>;
        <span class="hljs-comment">// 纯内存操作，无需异步</span>
    }
}
</code></pre>
<ol start="2">
<li><strong>短时间锁定</strong>（优先用 std Mutex）</li>
</ol>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 如果只是快速读写，不需要跨越 .await</span>
<span class="hljs-comment">// std Mutex 性能更好</span>
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">value</span> = std_mutex.<span class="hljs-title function_ invoke__">lock</span>().<span class="hljs-title function_ invoke__">unwrap</span>();
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">result</span> = *value * <span class="hljs-number">2</span>;
<span class="hljs-title function_ invoke__">drop</span>(value);
</code></pre>
<h3 data-id="heading-23">4.2 最佳实践</h3>
<h4 data-id="heading-24">实践 1：限制锁的持有时间</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// ❌ 不推荐：持有锁时间过长</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">bad</span>(mutex: &amp;Mutex&lt;Data&gt;) {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">data</span> = mutex.<span class="hljs-title function_ invoke__">lock</span>().<span class="hljs-keyword">await</span>;
    <span class="hljs-comment">// 执行耗时操作</span>
    <span class="hljs-title function_ invoke__">heavy_computation</span>(&amp;data).<span class="hljs-keyword">await</span>;  <span class="hljs-comment">// 锁被持有</span>
    <span class="hljs-title function_ invoke__">another_async_operation</span>().<span class="hljs-keyword">await</span>; <span class="hljs-comment">// 锁仍被持有</span>
}

<span class="hljs-comment">// ✅ 推荐：最小化锁持有时间</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">good</span>(mutex: &amp;Mutex&lt;Data&gt;) {
    <span class="hljs-comment">// 1. 先获取需要的数据</span>
    <span class="hljs-keyword">let</span> (key, value) = {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">data</span> = mutex.<span class="hljs-title function_ invoke__">lock</span>().<span class="hljs-keyword">await</span>;
        (data.key.<span class="hljs-title function_ invoke__">clone</span>(), data.value.<span class="hljs-title function_ invoke__">clone</span>())
    }; <span class="hljs-comment">// 锁在这里释放</span>

    <span class="hljs-comment">// 2. 执行耗时操作（不持有锁）</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">result</span> = <span class="hljs-title function_ invoke__">heavy_computation</span>(&amp;key, &amp;value).<span class="hljs-keyword">await</span>;

    <span class="hljs-comment">// 3. 最后再获取锁更新数据</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">data</span> = mutex.<span class="hljs-title function_ invoke__">lock</span>().<span class="hljs-keyword">await</span>;
    data.result = result;
}
</code></pre>
<h4 data-id="heading-25">实践 2：使用消息传递模式</h4>
<p>对于 IO 资源，更好的模式是使用消息传递：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> tokio::sync::mpsc;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">DatabaseManager</span> {
    rx: mpsc::Receiver&lt;Query&gt;,
    connection: DatabaseConnection,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">DatabaseManager</span> {
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">run</span>(<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
        <span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(query) = <span class="hljs-keyword">self</span>.rx.<span class="hljs-title function_ invoke__">recv</span>().<span class="hljs-keyword">await</span> {
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">result</span> = <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">execute_query</span>(&amp;query).<span class="hljs-keyword">await</span>;
            query.response.<span class="hljs-title function_ invoke__">send</span>(result).<span class="hljs-title function_ invoke__">ok</span>();
        }
    }
}

<span class="hljs-comment">// 使用者通过通道发送请求，无需直接加锁</span>
manager.tx.<span class="hljs-title function_ invoke__">send</span>(Query::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-string">"SELECT * FROM users"</span>)).<span class="hljs-keyword">await</span>?;
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">result</span> = response.<span class="hljs-title function_ invoke__">recv</span>().<span class="hljs-keyword">await</span>?;
</code></pre>
<p><strong>优势</strong>：</p>
<ul>
<li>无需直接管理锁</li>
<li>自然避免死锁</li>
<li>更好的并发性（管理者可以内部优化）</li>
</ul>
<h4 data-id="heading-26">实践 3：使用 OwnedMutexGuard 跨任务传递</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> tokio::sync::{Mutex, mpsc};
<span class="hljs-keyword">use</span> std::sync::Arc;

<span class="hljs-meta">#[tokio::main]</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">mutex</span> = Arc::<span class="hljs-title function_ invoke__">new</span>(Mutex::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-type">Vec</span>::<span class="hljs-title function_ invoke__">new</span>()));
    <span class="hljs-keyword">let</span> (tx, <span class="hljs-keyword">mut</span> rx) = mpsc::<span class="hljs-title function_ invoke__">channel</span>(<span class="hljs-number">100</span>);

    <span class="hljs-comment">// 生产者任务</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">producer</span> = tokio::<span class="hljs-title function_ invoke__">spawn</span>(<span class="hljs-keyword">async</span> <span class="hljs-keyword">move</span> {
        <span class="hljs-keyword">for</span> <span class="hljs-variable">i</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..<span class="hljs-number">10</span> {
            <span class="hljs-comment">// 获取拥有所有权的 Guard</span>
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">guard</span> = mutex.<span class="hljs-title function_ invoke__">clone</span>().<span class="hljs-title function_ invoke__">lock_owned</span>().<span class="hljs-keyword">await</span>;
            tx.<span class="hljs-title function_ invoke__">send</span>(guard).<span class="hljs-keyword">await</span>.<span class="hljs-title function_ invoke__">unwrap</span>();
        }
    });

    <span class="hljs-comment">// 消费者任务</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">consumer</span> = tokio::<span class="hljs-title function_ invoke__">spawn</span>(<span class="hljs-keyword">async</span> <span class="hljs-keyword">move</span> {
        <span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(<span class="hljs-keyword">mut</span> vec) = rx.<span class="hljs-title function_ invoke__">recv</span>().<span class="hljs-keyword">await</span> {
            vec.<span class="hljs-title function_ invoke__">push</span>(<span class="hljs-number">42</span>);
            <span class="hljs-comment">// Guard 在这里 drop，自动释放锁</span>
        }
    });

    producer.<span class="hljs-keyword">await</span>.<span class="hljs-title function_ invoke__">unwrap</span>();
    consumer.<span class="hljs-keyword">await</span>.<span class="hljs-title function_ invoke__">unwrap</span>();
}
</code></pre>
<h4 data-id="heading-27">实践 4：使用 MappedMutexGuard 限制访问</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> tokio::sync::{Mutex, MutexGuard};

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Config</span> {
    sensitive_data: <span class="hljs-type">String</span>,
    public_setting: <span class="hljs-type">u32</span>,
}

<span class="hljs-comment">// 只暴露公共字段给调用者</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_public_setting</span>(
    config: &amp;Mutex&lt;Config&gt;
) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Future</span>&lt;Output = MappedMutexGuard&lt;<span class="hljs-symbol">'_</span>, <span class="hljs-type">u32</span>&gt;&gt; {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">guard</span> = config.<span class="hljs-title function_ invoke__">lock</span>();
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">move</span> {
        MutexGuard::<span class="hljs-title function_ invoke__">map</span>(guard.<span class="hljs-keyword">await</span>, |config| &amp;<span class="hljs-keyword">mut</span> config.public_setting)
    }
}

<span class="hljs-comment">// 调用者只能访问 public_setting，无法访问敏感数据</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">update_setting</span>(config: &amp;Mutex&lt;Config&gt;) {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">setting</span> = <span class="hljs-title function_ invoke__">get_public_setting</span>(config).<span class="hljs-keyword">await</span>;
    *setting += <span class="hljs-number">1</span>;
    <span class="hljs-comment">// setting.sensitive_data // 编译错误！无法访问</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-28">五、常见陷阱与解决方案</h2>
<h3 data-id="heading-29">5.1 死锁风险</h3>
<p>虽然 Tokio Mutex 比 std Mutex 更安全，但仍然可能死锁：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// ❌ 死锁：两个锁以不同顺序获取</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">deadlock</span>(mutex1: &amp;Mutex&lt;()&gt;, mutex2: &amp;Mutex&lt;()&gt;) {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">lock1</span> = mutex1.<span class="hljs-title function_ invoke__">lock</span>().<span class="hljs-keyword">await</span>;
    <span class="hljs-comment">// 如果另一个任务先获取了 mutex2，就会死锁</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">lock2</span> = mutex2.<span class="hljs-title function_ invoke__">lock</span>().<span class="hljs-keyword">await</span>;  <span class="hljs-comment">// 可能永远阻塞</span>
}

<span class="hljs-comment">// ✅ 解决：按固定顺序获取锁</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">no_deadlock</span>(mutex1: &amp;Mutex&lt;()&gt;, mutex2: &amp;Mutex&lt;()&gt;) {
    <span class="hljs-comment">// 始终先获取 mutex1，再获取 mutex2</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">lock1</span> = mutex1.<span class="hljs-title function_ invoke__">lock</span>().<span class="hljs-keyword">await</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">lock2</span> = mutex2.<span class="hljs-title function_ invoke__">lock</span>().<span class="hljs-keyword">await</span>;
}
</code></pre>
<h3 data-id="heading-30">5.2 性能陷阱</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// ❌ 不推荐：在循环中频繁获取锁</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">bad_loop</span>(mutex: &amp;Mutex&lt;<span class="hljs-type">Vec</span>&lt;<span class="hljs-type">i32</span>&gt;&gt;) {
    <span class="hljs-keyword">for</span> <span class="hljs-variable">i</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..<span class="hljs-number">1000</span> {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">data</span> = mutex.<span class="hljs-title function_ invoke__">lock</span>().<span class="hljs-keyword">await</span>;
        data.<span class="hljs-title function_ invoke__">push</span>(i);
    }  <span class="hljs-comment">// 1000 次异步锁操作</span>
}

<span class="hljs-comment">// ✅ 推荐：批量操作</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">good_loop</span>(mutex: &amp;Mutex&lt;<span class="hljs-type">Vec</span>&lt;<span class="hljs-type">i32</span>&gt;&gt;) {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">new_items</span> = <span class="hljs-type">Vec</span>::<span class="hljs-title function_ invoke__">new</span>();
    <span class="hljs-keyword">for</span> <span class="hljs-variable">i</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..<span class="hljs-number">1000</span> {
        new_items.<span class="hljs-title function_ invoke__">push</span>(i);
    }
    <span class="hljs-comment">// 只获取一次锁</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">data</span> = mutex.<span class="hljs-title function_ invoke__">lock</span>().<span class="hljs-keyword">await</span>;
    data.<span class="hljs-title function_ invoke__">append</span>(&amp;<span class="hljs-keyword">mut</span> new_items);
}
</code></pre>
<hr/>
<h2 data-id="heading-31">六、性能对比与选择建议</h2>
<h3 data-id="heading-32">6.1 性能测试</h3>
<p>以下是简单的性能对比（仅供参考）：</p>





























<table><thead><tr><th>操作</th><th>std Mutex</th><th>Tokio Mutex</th><th>性能差异</th></tr></thead><tbody><tr><td>无竞争 lock/unlock</td><td>~50ns</td><td>~200ns</td><td>4x 慢</td></tr><tr><td>单线程简单操作</td><td>~100ns</td><td>~400ns</td><td>4x 慢</td></tr><tr><td>多线程高并发</td><td>~500ns</td><td>~800ns</td><td>1.6x 慢</td></tr></tbody></table>
<p><strong>结论</strong>：Tokio Mutex 有明显的性能开销，但在异步场景下是必要的。</p>
<h3 data-id="heading-33">6.2 选择决策</h3>
<ul>
<li>需要跨越 .await 持有锁，使用 tokio::sync::Mutex</li>
<li>IO 资源（如数据库连接），考虑消息传递模式 tokio::sync::mpsc</li>
<li>其他简单的数据保护，使用 std::sync::Mutex（性能最优）</li>
</ul>
<hr/>
<h2 data-id="heading-34">七、总结</h2>
<h3 data-id="heading-35">关键要点</h3>
<ol>
<li><strong>使用场景</strong>：仅在需要跨越 <code>.await</code> 持有锁时使用</li>
<li><strong>性能考虑</strong>：有明显的性能开销，优先考虑 std Mutex 或消息传递</li>
<li><strong>三种 Guard</strong>：根据需求选择合适的 Guard 类型</li>
<li><strong>最佳实践</strong>：最小化锁持有时间，优先使用消息传递模式</li>
</ol>
<h3 data-id="heading-36">学习路径</h3>
<ol>
<li>理解 Rust 异步编程基础（Future、.await、运行时）</li>
<li>掌握 Tokio 的任务调度和 Waker 机制</li>
<li>学习信号量原理（<code>tokio/src/sync/batch_semaphore.rs</code>）</li>
<li>深入 Mutex 实现（<code>tokio/src/sync/mutex.rs</code>）</li>
<li>可以结合 AI 的输出理解难点</li>
</ol>
<h3 data-id="heading-37">相关资源</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftokio.rs" target="_blank" title="https://tokio.rs" ref="nofollow noopener noreferrer">Tokio 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.rs%2Ftokio%2Flatest%2Ftokio%2Fsync%2Fstruct.Mutex.html" target="_blank" title="https://docs.rs/tokio/latest/tokio/sync/struct.Mutex.html" ref="nofollow noopener noreferrer">Tokio Mutex API 文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Frust-lang.github.io%2Fasync-book%2F" target="_blank" title="https://rust-lang.github.io/async-book/" ref="nofollow noopener noreferrer">Async Rust Book</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[IOScer 开发环境证书包括哪些，证书、描述文件与 App ID 的协同管理实践]]></title>    <link>https://juejin.cn/post/7587582213061345334</link>    <guid>https://juejin.cn/post/7587582213061345334</guid>    <pubDate>2025-12-25T10:02:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587582213061345334" data-draft-id="7587606718843863081" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="IOScer 开发环境证书包括哪些，证书、描述文件与 App ID 的协同管理实践"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-25T10:02:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="开心就好2025"/> <meta itemprop="url" content="https://juejin.cn/user/3850962908492660"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            IOScer 开发环境证书包括哪些，证书、描述文件与 App ID 的协同管理实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3850962908492660/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    开心就好2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T10:02:28.000Z" title="Thu Dec 25 2025 10:02:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>很多人第一次接触 IOScer（iOS 开发环境证书）时，都会问一个看似简单的问题，<strong>开发证书到底包括哪些？</strong></p>
<p>但在真实工程中，这个问题如果只从“证书类型”角度回答，往往会让人更困惑。
因为你真正需要的，并不是某一张证书，而是一整套 <strong>让 App 能在开发阶段被合法运行的条件</strong>。</p>
<hr/>
<h2 data-id="heading-0"><strong>开发环境证书，本质是一组关系</strong></h2>
<p>在工程语境中，“IOScer 开发环境”并不是单指某个文件。
它至少包含三类对象：</p>
<ul>
<li>身份凭证（开发证书）</li>
<li>应用约束（Bundle ID / App ID）</li>
<li>运行范围（描述文件 + 设备）</li>
</ul>
<p>这些对象单独存在时几乎没有意义，只有在组合正确时，开发环境才真正成立。</p>
<hr/>
<h2 data-id="heading-1"><strong>开发证书解决的是你是谁，不是你的 App 是什么</strong></h2>
<p>很多初学者会把开发证书和应用强行绑定在一起，但这是一个常见误解。</p>
<p>在苹果体系中，开发证书的作用非常单一：
<strong>证明你是这个开发者账号的合法成员。</strong></p>
<p>它并不关心：</p>
<ul>
<li>你开发的是哪个 App</li>
<li>使用了哪个 Bundle ID</li>
<li>要装到哪台设备</li>
</ul>
<p>这也是为什么一个开发证书可以被多个 App 使用。</p>
<p>在一些团队中，为了避免证书只存在于某一台 Mac 上，我们会通过 <strong>开心上架（Appuploader）创建 iOS 开发证书</strong>，直接生成 <code>.p12</code> 文件，供不同构建环境或开发成员使用。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d438ce301ea2472996986aa06e066bda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D5bCx5aW9MjAyNQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767261747&amp;x-signature=lw2nGQXcYsO7aa9Aa82gyCZdQok%3D" alt="创建证书" loading="lazy"/></p>
<p>这样做的意义不是“换工具”，而是让开发证书从“钥匙串状态”变成“工程资源”。</p>
<hr/>
<h2 data-id="heading-2"><strong>真正区分开发环境的，其实是描述文件</strong></h2>
<p>如果说开发证书解决的是“身份”，那么描述文件解决的才是“运行条件”。</p>
<p>在 IOScer 开发环境中，描述文件至少承担了三件事：</p>
<ul>
<li>绑定具体的 Bundle ID</li>
<li>指定使用哪张开发证书</li>
<li>限定可安装的设备范围</li>
</ul>
<p>这也是为什么很多“装不上 App”的问题，最后都指向了描述文件，而不是证书。</p>
<p>在实际排查中，我更倾向于直接查看描述文件本身，而不是反复猜测配置。
通过 开心上架（Appuploader）查看 mobileprovision 文件内容，可以清楚看到描述文件到底绑定了什么，而不是依赖 Xcode 的自动行为。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba6915cd0a274c86ac92a7a69570a9d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D5bCx5aW9MjAyNQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767261747&amp;x-signature=MicdixXKBXEU2gT3gPKqiSW2Yss%3D" alt="查看描述文件" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-3"><strong>设备列表，是开发环境中最容易被忽略的一部分</strong></h2>
<p>IOScer 开发环境与发布环境最大的区别之一，在于 <strong>设备限制</strong>。</p>
<p>开发描述文件必须明确列出允许安装的设备 UDID。
只要有一台设备不在列表中，安装就一定失败。</p>
<p>在一些项目中，问题并不是证书或描述文件生成失败，而是：</p>
<ul>
<li>新设备未加入</li>
<li>描述文件未更新</li>
<li>构建仍在使用旧文件</li>
</ul>
<p>在多设备调试或测试团队中，这类问题非常常见。</p>
<hr/>
<h2 data-id="heading-4"><strong>App ID（Bundle ID），决定了证书能不能用在这个 App 上</strong></h2>
<p>开发证书本身并不关心 App，但描述文件关心。
而描述文件是否可用，最终取决于 App ID。</p>
<p>在工程中，App ID 往往是在项目初期配置后就很少再动，但它实际上决定了：</p>
<ul>
<li>哪个 App 能使用这套开发环境</li>
<li>是否会与历史项目冲突</li>
<li>描述文件是否还能复用</li>
</ul>
<p>在非 macOS 环境下，可以通过 开心上架（Appuploader）查看账号内已有的 Bundle ID / App ID，确认当前工程的应用标识是否清晰，避免在错误的 App 上继续投入调试成本。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b5ddfc7712b4e73b36c34b8473a0108~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D5bCx5aW9MjAyNQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767261747&amp;x-signature=wuXd5%2FFe3bu64fjmMy6zDuFCRsk%3D" alt="查看bid" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-5"><strong>为什么开发环境证书常常在后期出问题</strong></h2>
<p>从经验来看，IOScer 开发环境出问题，很少是因为一开始没配好，而是因为 <strong>环境发生了变化</strong>：</p>
<ul>
<li>新成员加入</li>
<li>新设备接入</li>
<li>构建环境迁移</li>
<li>项目从开发进入发布阶段</li>
</ul>
<p>如果证书、描述文件和设备关系没有被统一管理，这些变化就会迅速放大问题。</p>
<p>在一些团队中，我们会通过 开心上架（Appuploader）集中管理证书和描述文件，至少保证每个人看到的是同一份“事实配置”，而不是各自机器上的状态。</p>
<hr/>
<h2 data-id="heading-6">IOScer 开发环境并不等于随便用</h2>
<p>一个常见误区是，既然是开发环境，就可以随意创建、随意替换。</p>
<p>但在工程实践中，开发环境一旦被多个 App、多个设备、多个成员使用，就已经具备生产属性。
此时，如果仍然频繁重建证书或描述文件，反而会制造不稳定因素。</p>
<p>参考链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.appuploader.net%2Ftutorial%2Fzh%2F1%2F1.html" target="_blank" title="https://www.appuploader.net/tutorial/zh/1/1.html" ref="nofollow noopener noreferrer">www.appuploader.net/tutorial/zh…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文带你吃透 Java 反射机制]]></title>    <link>https://juejin.cn/post/7587261929384411188</link>    <guid>https://juejin.cn/post/7587261929384411188</guid>    <pubDate>2025-12-24T15:58:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587261929384411188" data-draft-id="7586877892467458075" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文带你吃透 Java 反射机制"/> <meta itemprop="keywords" content="Java,后端"/> <meta itemprop="datePublished" content="2025-12-24T15:58:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BestAns"/> <meta itemprop="url" content="https://juejin.cn/user/1556564197248605"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文带你吃透 Java 反射机制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1556564197248605/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BestAns
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-24T15:58:33.000Z" title="Wed Dec 24 2025 15:58:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一文带你吃透 Java 反射机制</h2>
<p>在Java开发中，“反射”绝对是个让人又爱又恨的知识点。有人觉得它晦涩难懂、破坏封装，也有人靠它实现了各种灵活的功能——比如框架开发、动态配置加载。</p>
<p>其实反射没那么神秘，今天就给大家用最通俗的语言讲清楚：反射到底是什么、怎么用，以及反射在实际开发中的应用。</p>
<h3 data-id="heading-1">一、Java反射到底是什么？</h3>
<p>我们先从Java的核心特性“封装”说起。平时写代码时，我们通过new关键字创建对象，调用类的方法、访问属性，都是在“编译期”就确定好要操作的类，比如<code>User user = new User();</code>，编译器早就知道我们要操作User类。</p>
<p>而反射机制，简单说就是<strong>程序在运行时，能够“看透”一个类的内部结构</strong>：知道它有哪些属性、哪些方法、哪些构造器，还能动态地创建对象、调用方法、修改属性，哪怕这些成员是私有的。</p>
<p>形象点说，普通方式是“先知道类，再用类”；反射是“先拿到类的‘说明书’，再根据说明书用类”。这个“说明书”，就是Java中的<code>Class</code>类对象。</p>
<p>Java中的反射，本质上是运用了：<strong>类是由JVM在执行过程中动态加载的</strong>这一原理实现的。</p>
<h3 data-id="heading-2">二、Class类是关键</h3>
<p>在Java中，任何一个类被加载后，JVM都会为它创建一个唯一的<code>Class</code>对象，这个对象包含了该类的所有信息（成员变量、构造方法、成员方法等）。反射的所有操作，本质上都是通过操作这个<code>Class</code>对象实现的。</p>
<p>简单梳理反射的核心流程：</p>
<ol>
<li>
<p>获取目标类的<code>Class</code>对象（拿到“说明书”）；</p>
</li>
<li>
<p>通过<code>Class</code>对象获取需要的成员（属性、方法、构造器）；</p>
</li>
<li>
<p>动态操作这些成员（创建对象、调用方法、修改属性）。</p>
</li>
</ol>
<h3 data-id="heading-3">三、反射的基础用法</h3>
<p>先铺垫基础用法，后面的案例会基于这些操作展开。我们以一个简单的<code>User</code>类为例：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-comment">// 无参构造</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">()</span> {}

    <span class="hljs-comment">// 有参构造</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// 普通方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sayHello</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"Hello, "</span> + name + <span class="hljs-string">"! You are "</span> + age + <span class="hljs-string">" years old."</span>);
    }
}
</code></pre>
<h4 data-id="heading-4">第一步：获取Class对象</h4>
<p>在Java中总共有三种方式获取Class对象：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 方式1：通过类名.class（编译期确定，最安全）</span>
Class&lt;User&gt; userClass1 = User.class;

<span class="hljs-comment">// 方式2：通过对象.getClass()（运行时获取，需先有对象）</span>
<span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">User</span>&gt; userClass2 = user.getClass();

<span class="hljs-comment">// 方式3：通过Class.forName("全类名")（动态加载，最灵活，常用）</span>
Class&lt;?&gt; userClass3 = Class.forName(<span class="hljs-string">"com.example.demo.User"</span>); <span class="hljs-comment">// 全类名=包名+类名</span>
</code></pre>
<p>其中，第三种方式最灵活，因为全类名可以来自配置文件、数据库等，实现“动态指定类”，稍后我们会详细介绍这种方式。</p>
<h4 data-id="heading-5">第二步：通过Class对象创建对象</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. 通过无参构造创建（最常用）</span>
Class&lt;?&gt; userClass = Class.forName(<span class="hljs-string">"com.example.demo.User"</span>);
<span class="hljs-type">User</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span> (User) userClass.newInstance();

<span class="hljs-comment">// 2. 通过有参构造创建</span>
Constructor&lt;?&gt; constructor = userClass.getConstructor(String.class, <span class="hljs-type">int</span>.class);
<span class="hljs-type">User</span> <span class="hljs-variable">user2</span> <span class="hljs-operator">=</span> (User) constructor.newInstance(<span class="hljs-string">"张三"</span>, <span class="hljs-number">20</span>);
</code></pre>
<p>这两种反射创建 User 实例的方式核心区别在于：前者调用无参构造器创建实例，且该方式在 Java 9 被标记为<code>过时(@Deprecated)</code>，Java 11 彻底移除，不推荐使用；后者通过指定有参构造器创建实例，能直接传入参数完成初始化，是反射创建实例的标准推荐写法。</p>
<h4 data-id="heading-6">第三步：调用类的方法</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. 获取sayHello方法（无参、public）</span>
<span class="hljs-type">Method</span> <span class="hljs-variable">sayHelloMethod</span> <span class="hljs-operator">=</span> userClass.getMethod(<span class="hljs-string">"sayHello"</span>);
<span class="hljs-comment">// 2. 调用方法（需要传入对象实例）</span>
sayHelloMethod.invoke(user2); <span class="hljs-comment">// 输出：Hello, 张三</span>

<span class="hljs-comment">// 3. 调用带参方法（比如setName）</span>
<span class="hljs-type">Method</span> <span class="hljs-variable">setNameMethod</span> <span class="hljs-operator">=</span> userClass.getMethod(<span class="hljs-string">"setName"</span>, String.class);
setNameMethod.invoke(user2, <span class="hljs-string">"李四"</span>);
sayHelloMethod.invoke(user2); <span class="hljs-comment">// 输出：Hello, 李四</span>
</code></pre>
<p>如果要操作私有成员（比如private属性name），需要先调用<code>setAccessible(true)</code>打破封装限制，这里就不展开说明了。</p>
<h3 data-id="heading-7">四、反射的两个经典应用场景</h3>
<p>理解了基础用法，再看两个实际开发中常用的案例，帮助我们更加深刻的理解反射存在的意义。</p>
<h4 data-id="heading-8">案例1：读取配置文件，动态加载类并执行方法</h4>
<p>我们希望程序不修改代码，只修改配置文件，就能加载不同的类、执行不同的方法，这在框架开发（比如Spring）中非常常见，核心就是反射。</p>
<p>实现步骤：</p>
<ol>
<li>
<p>创建配置文件（比如reflect.properties），写入要加载的类名和方法名；</p>
</li>
<li>
<p>通过IO流读取配置文件中的类名和方法名；</p>
</li>
<li>
<p>用反射动态加载类、创建对象、执行方法。</p>
</li>
</ol>
<h5 data-id="heading-9">步骤1：创建配置文件（reflect.properties）</h5>
<pre><code class="hljs language-properties" lang="properties"># 全类名
className=com.example.demo.User
# 要执行的方法名
methodName=sayHello
</code></pre>
<h5 data-id="heading-10">步骤2：编写工具类读取配置文件</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo;

<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.io.InputStream;
<span class="hljs-keyword">import</span> java.util.Properties;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PropertiesUtil</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Properties <span class="hljs-title function_">getProperties</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Properties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
 
        <span class="hljs-type">InputStream</span> <span class="hljs-variable">is</span> <span class="hljs-operator">=</span> PropertiesUtil.class.getClassLoader().getResourceAsStream(<span class="hljs-string">"reflect.properties"</span>);
        <span class="hljs-keyword">try</span> {
            properties.load(is);
        } <span class="hljs-keyword">catch</span> (IOException e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">if</span> (is != <span class="hljs-literal">null</span>) is.close();
            } <span class="hljs-keyword">catch</span> (IOException e) {
                e.printStackTrace();
            }
        }
        <span class="hljs-keyword">return</span> properties;
    }
}
</code></pre>
<h5 data-id="heading-11">步骤3：用反射动态加载并执行</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo;

<span class="hljs-keyword">import</span> java.lang.reflect.Method;
<span class="hljs-keyword">import</span> java.util.Properties;
<span class="hljs-keyword">import</span> java.lang.reflect.Constructor;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReflectDemo1</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 1. 读取配置文件</span>
        <span class="hljs-type">Properties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> PropertiesUtil.getProperties();
        <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> properties.getProperty(<span class="hljs-string">"className"</span>);
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> properties.getProperty(<span class="hljs-string">"methodName"</span>);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 2. 获取Class对象</span>
            Class&lt;?&gt; clazz = Class.forName(className);
            <span class="hljs-comment">// 3. 创建对象</span>
            Constructor&lt;?&gt; constructor = clazz.getConstructor(String.class, <span class="hljs-type">int</span>.class);
            <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> constructor.newInstance(<span class="hljs-string">"张三"</span>, <span class="hljs-number">18</span>);
            <span class="hljs-comment">// 4. 获取方法并执行</span>
            <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> clazz.getMethod(methodName);
            method.invoke(obj); <span class="hljs-comment">// 执行sayHello方法</span>
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        }
    }
}
</code></pre>
<p>运行程序，会执行User类的sayHello方法。如果我们想换一个类执行，比如创建一个<code>Order</code>类，只需要修改配置文件中的<code>className</code>和<code>methodName</code>，不用修改代码就能实现，这就是反射的“动态性”价值。</p>
<h4 data-id="heading-12">案例2：实现isClassPresent方法，优先加载指定类，失败则加载默认类</h4>
<p>我们在开发中经常会遇到“降级策略”——优先加载某个指定的类，如果该类不存在（比如依赖包未引入），就加载默认的兜底类。用反射可以轻松实现这个逻辑，定义一个<code>isClassPresent</code>方法来判断类是否存在并加载。</p>
<p>实现思路：</p>
<ol>
<li>
<p>定义一个方法，参数为<code>className</code>和<code>defaultClassName</code>；</p>
</li>
<li>
<p>尝试用<code>Class.forName()</code>加载指定类，若不抛异常则说明类存在，返回该类的Class对象；</p>
</li>
<li>
<p>若加载指定类抛<code>ClassNotFoundException</code>，则加载默认类并返回其Class对象。</p>
</li>
</ol>
<h5 data-id="heading-13">步骤1：创建默认类和备选类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 默认兜底类</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultService</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doService</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"执行默认服务逻辑"</span>);
    }
}

<span class="hljs-comment">// 备选指定类（可能不存在）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomService</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doService</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"执行自定义服务逻辑"</span>);
    }
}
</code></pre>
<h5 data-id="heading-14">步骤2：实现isClassPresent方法</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassLoaderUtil</span> {
    <span class="hljs-comment">/**
     * 优先加载指定类，失败则加载默认类
     * <span class="hljs-doctag">@param</span> className  要优先加载的类全类名
     * <span class="hljs-doctag">@param</span> defaultClassName  兜底的默认类全类名
     * <span class="hljs-doctag">@return</span>  加载成功的Class对象
     * <span class="hljs-doctag">@throws</span> ClassNotFoundException  若默认类也不存在则抛异常
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Class&lt;?&gt; isClassPresent(String className, String defaultClassName) <span class="hljs-keyword">throws</span> ClassNotFoundException {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 优先加载指定类</span>
            <span class="hljs-keyword">return</span> Class.forName(className);
        } <span class="hljs-keyword">catch</span> (ClassNotFoundException e) {
            System.out.println(<span class="hljs-string">"指定类["</span> + className + <span class="hljs-string">"]不存在，加载默认类["</span> + defaultClassName + <span class="hljs-string">"]"</span>);
            <span class="hljs-comment">// 加载失败，加载默认类</span>
            <span class="hljs-keyword">return</span> Class.forName(defaultClassName);
        }
    }
}

</code></pre>
<h5 data-id="heading-15">步骤3：测试验证</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo;

<span class="hljs-keyword">import</span> java.lang.reflect.Method;
<span class="hljs-keyword">import</span> java.lang.reflect.Constructor;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReflectDemo2</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 场景1：指定类存在（CustomService已创建）</span>
        Class&lt;?&gt; clazz1 = ClassLoaderUtil.isClassPresent(
            <span class="hljs-string">"com.example.demo.CustomService"</span>, 
            <span class="hljs-string">"com.example.demo.DefaultService"</span>
        );
        Constructor&lt;?&gt; constructor1 = clazz1.getConstructor();
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj1</span> <span class="hljs-operator">=</span> constructor1.newInstance();
        <span class="hljs-type">Method</span> <span class="hljs-variable">method1</span> <span class="hljs-operator">=</span> clazz1.getMethod(<span class="hljs-string">"doService"</span>);
        method1.invoke(obj1); <span class="hljs-comment">// 输出：执行自定义服务逻辑</span>

        <span class="hljs-comment">// 场景2：指定类不存在（故意写一个错误的类名）</span>
        Class&lt;?&gt; clazz2 = ClassLoaderUtil.isClassPresent(
            <span class="hljs-string">"com.example.demo.NonExistentService"</span>, <span class="hljs-comment">// 不存在的类</span>
            <span class="hljs-string">"com.example.demo.DefaultService"</span>
        );
        Constructor&lt;?&gt; constructor2 = clazz2.getConstructor();
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj2</span> <span class="hljs-operator">=</span> constructor2.newInstance();
        <span class="hljs-type">Method</span> <span class="hljs-variable">method2</span> <span class="hljs-operator">=</span> clazz2.getMethod(<span class="hljs-string">"doService"</span>);
        method2.invoke(obj2); <span class="hljs-comment">// 输出：指定类[com.example.NonExistentService]不存在，加载默认类[com.example.DefaultService] + 执行默认服务逻辑</span>
    }
}
</code></pre>
<p>这个逻辑在实际开发中很实用，比如：</p>
<ul>
<li>
<p>框架的插件化开发：优先加载用户自定义的插件类，没有则用默认实现；</p>
</li>
<li>
<p>依赖降级：当某个第三方依赖包未引入时，自动切换到本地默认实现，避免程序崩溃。</p>
</li>
</ul>
<h3 data-id="heading-16">五、写在最后</h3>
<p>Java的反射，打破了Java程序在编译期的束缚，能在运行时动态加载类、执行方法，既大幅提升了程序的灵活性与扩展性，也减少了类间的硬编码依赖。更关键的是，反射是诸多Java核心技术的基石，比如：Spring IOC、MyBatis Mapper映射、JUnit单元测试框架等，底层都离不开它的支撑。</p>
<p>但我们也不能忽视它的“另一面”，反射对私有成员的访问会破坏面向对象的封装原则，解析Class对象、验证权限等操作带来的性能开销，这就要求我们在使用Java反射时保持谨慎。</p>
<p>掌握反射，本质上是打通了“使用框架”到“理解框架底层原理”的关键一环。</p>
<p>如果觉得有用，欢迎点赞、在看、转发三连～ 有疑问也可以在评论区留言交流～</p>
<p><strong>更多精彩文章，欢迎关注我的公众号：<code>前端架构师笔记</code></strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[超越谷歌，全球第一！上交 AI 科学家王者归来，登顶 OpenAI MLE-bench]]></title>    <link>https://juejin.cn/post/7587428416128974886</link>    <guid>https://juejin.cn/post/7587428416128974886</guid>    <pubDate>2025-12-25T10:21:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587428416128974886" data-draft-id="7587628833797881883" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="超越谷歌，全球第一！上交 AI 科学家王者归来，登顶 OpenAI MLE-bench"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-12-25T10:21:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="新智元"/> <meta itemprop="url" content="https://juejin.cn/user/952600743642312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            超越谷歌，全球第一！上交 AI 科学家王者归来，登顶 OpenAI MLE-bench
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/952600743642312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    新智元
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T10:21:17.000Z" title="Thu Dec 25 2025 10:21:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45990b29850043ebbad97bc635c5db30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262877&amp;x-signature=ZUGGOjUPP1cQtXK99FnmAICo%2F1I%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-0"><strong>「【新智元导读】刚刚，由 SciMaster 团队推出的 AI 机器学习专家 ML-Master 2.0，基于国产开源大模型 DeepSeek，在 OpenAI 权威基准测试 MLE-bench 中一举击败 Google、Meta、微软等国际顶流，刷新全球 SOTA，再次登顶！目前该功能已在 SciMaster 线上平台开放 waiting list，欢迎申请体验。」</strong></h5>
<p>从《三体》中时刻干扰基础物理实验的「智子」，到《2001 太空漫游》里具备自主决策能力的 HAL，再到阿西莫夫笔下具有推理与科学探索能力的机器人，人类对一个问题的想象由来已久：</p>
<p>如果智能体不再只是工具，而是能够像科学家一样，在复杂环境中长期探索、不断修正假设，科学会发生什么变化？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c16d564e4ec541beb002e4cdd0151f3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262877&amp;x-signature=q4JAasFdFtA%2FT3YVFf2OZuwJjMc%3D" alt="" loading="lazy"/></p>
<p>很长一段时间里，这样的设想更多停留在科学想象中；而随着大模型能力的快速跃迁，它正逐渐演变为一个正在被认真对待的现实技术命题。</p>
<p>越来越多研究者开始意识到，真正的分水岭并不在于 AI 能否把题「答对」，而在于它能否像科研人员一样，在长期不确定的探索过程中不断修正方向、积累经验，并在反复试错中推动知识本身向前演化。</p>
<ul>
<li>Google DeepMind 推出的 <strong>「AlphaEvolve」</strong>，试图让 AI 在长时间的演化过程中不断修正自身策略；</li>
<li>OpenAI 提出的 <strong>「Frontier Science」</strong>，明确将衡量重点放在 AI 是否能够在真实科研任务中持续工作、反复迭代；</li>
<li>美国甚至启动了号称「<strong>「AI」</strong> <strong>「曼哈顿计划」</strong>」的 <strong>「Genesis Mission」</strong>，尝试将 AI 系统性地嵌入国家级科学研究体系之中。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c0c88d1e7984f51bdc374e62e73d80e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262877&amp;x-signature=pBAx65CcU0KOXETjcrMcxzW5T30%3D" alt="" loading="lazy"/></p>
<p>这些探索路径虽不相同，却共同指向一个核心共识：</p>
<p>真正推动科学进步的 AI，不是只会在竞赛中给出标准答案，而是能够在真实科研环境中，面对超长程科研任务时，经受长时间试错、不断自我演化，并在持续迭代中逐步演化出可靠能力。</p>
<p>正是在这样的背景下，<strong>AI4AI（****「AI」</strong> **for AI）**逐渐成为一个至关重要的方向：</p>
<p>它既是 AI 参与科学研究的重要形态之一，更直接关系到 AI 能否通过自身实践推动能力增长，从而支撑更长期、更复杂的科研任务。</p>
<p>因而，OpenAI 所提出的 <strong>「MLE-bench」</strong> 中所聚焦的<strong>机器学习<strong><strong>工程（</strong></strong>「Machine Learning」</strong> **Engineering, MLE）**任务，恰恰成为 <strong>「AI4AI」</strong> 场景下极为贴切的研究对象。</p>
<p>相比理想化的答题类型任务，真实的 MLE 科研往往需要在十几个甚至数十小时内，持续经历实验设计、代码实现、调试修正与结果分析等完整闭环，其过程高度依赖长期试错与经验积累。</p>
<p>这也使得 MLE-bench 成为少数能够真实反映 AI 是否具备长期科研演化能力的评测基准之一。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a60ae3ac8a44dba830b98153c5719c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262877&amp;x-signature=fsa1HIqsRUIe2ZxnfmZJLI30DpQ%3D" alt="" loading="lazy"/></p>
<p>由上海交通大学人工智能学院、上海算法创新研究院、深势科技组成的 SciMaster 团队推出的面向真实机器学习科研任务的自主智能体 <strong>「ML-Master 2.0」</strong>，就是这样一个专门为「机器学习工程」而生的 AI4AI（AI for AI）系统。</p>
<p>结合 EigenAI 提供的稳定高性能 AI 基础设施，该智能体基于国产大模型 DeepSeek-V3.2-Speciale，<strong>「在」</strong> <strong>「MLE-bench」</strong> <strong>「上击败 Google，Meta，Microsoft 等团队构建的一系列智能体，取得全球第一的成绩。」</strong></p>
<p>更重要的是，它已经在多家科技公司与实验室中落地，用于具身智能机器人训练、理论物理模拟与发现等前沿场景。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fc5bc485f6d48dc83414f99f2245ab1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262877&amp;x-signature=VsTwT6SkEkm8ACY7cwOrTZ8JHAg%3D" alt="" loading="lazy"/></p>
<p>这一结果不仅是一项榜单排名，更清晰地表明：</p>
<p>在面向真实科研任务、强调长期演化与工程闭环的自主智能体方向上，中国研究者已经具备与国际顶尖团队同台竞争、并实现领先突破的能力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d40c578c1e6415e9f987c06861c3742~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262877&amp;x-signature=9kOTT3wzplIumNZE0Iw2xXWVsWE%3D" alt="" loading="lazy"/></p>
<p><strong>「ML-Master 2.0」</strong></p>
<p><strong>「为真实机器学习科研而生的自主智能体」</strong></p>
<p>在真实的机器学习工程（Machine Learning Engineering, MLE）中，科研并不是一次性「把题做对」。</p>
<p>相反，它往往是一个漫长而反复的过程：</p>
<p>设定实验假设、编写与修改代码、定位 bug、分析结果、推翻假设、再重新开始。这样的循环，可能持续几个，甚至数十个小时。</p>
<p>ML-Master 2.0 正是围绕这一真实科研场景被系统性设计出来的。</p>
<p>与许多只关注短程推理或单次任务成功的智能体不同，它从设计之初就假定：</p>
<ul>
<li>没有人类在旁实时纠错；</li>
<li>实验失败是常态而非例外；</li>
<li>真正有价值的能力，来自长期反复试错中的积累。</li>
</ul>
<p>在保留原有 ML-Master 探索—利用闭环的基础上，ML-Master 2.0 <strong>「进一步着重」<strong>在</strong>「长时间的探索中保持研究方向不跑偏」</strong>，并且**「将失败转化为可复用的经验的能力」**。</p>
<p>这也直接引出了其关键设计理念之一：</p>
<p>科研型智能体必须具备长期认知积累的能力，而不是将上下文视为一次性消耗的推理材料。</p>
<p><strong>「<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63f2e8144e8c4d1db520f6092f283444~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262877&amp;x-signature=cU0sonb9Lkvy2V9nivAA3UKqyl8%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「超长程自主：能跑代码，更能长期思考」</strong></p>
<p>在 ML-Master 2.0 的设计中，这种能力被明确概括为一个核心概念：</p>
<p>超长程自主（Ultra-Long-Horizon Autonomy）</p>
<p>在 MLE 场景下，真正的自主性并不等价于更强的代码生成能力，而体现在系统是否能够：</p>
<ul>
<li>在长达数十小时的探索中持续围绕同一科研目标展开；</li>
<li>从大量失败实验中总结规律，而不是简单重复尝试；</li>
<li>主动避开已经验证无效的技术路径；</li>
<li>将一次任务中获得的经验迁移到后续的新任务中。</li>
</ul>
<p>换句话说，问题的关键并不在于「上下文够不够长」，而在于：</p>
<p>这些上下文是否能够被持续整理、筛选，并真正沉淀为可复用的认知资产。</p>
<p><strong>「<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab7c0b8548684c55821bb443d3139c29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262877&amp;x-signature=mnaeoAbUe7y6p2I8eTHd0CEYeW4%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「以「认知积累」为核心的 ML-Master 2.0 架构」</strong></p>
<p>基于上述思考，ML-Master 2.0 构建了一套围绕长期科研探索的整体技术框架。</p>
<p>在这一架构中，上下文不再被视为「用完即丢」的推理输入，而是被建模为一种**「具有生命周期的认知资产」**。</p>
<p>随着科研过程不断推进，系统内部的认知逐步发生分化：</p>
<ul>
<li><strong>「Experience（经验）」</strong>：直接服务于当前决策的即时执行轨迹；</li>
<li><strong>「Knowledge（知识）」</strong>：在同一任务中多次验证后形成的稳定结论；</li>
<li><strong>「Wisdom（智慧）」</strong>：能够跨任务复用的高层策略与认知原型。</li>
</ul>
<p>为了系统性地管理这一演化过程，ML-Master 2.0 引入了**层次化认知缓存（Hierarchical Cognitive Caching, HCC）**机制。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4828699c70d14b4e8d524b7a28236de7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262877&amp;x-signature=4yiMeb%2BI4O%2F82H8AceAu2LB%2FN4o%3D" alt="" loading="lazy"/></p>
<p><strong>「<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d8d5082e9014b55acda8a33e8b54de4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262877&amp;x-signature=tiA3HeocM%2FL8XYalPaY%2BbqrAfjA%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「层次化认知缓存：为长程科研提供记忆支点」</strong></p>
<p>从直观层面看，层次化认知缓存并不是简单地「把上下文存得更多」，而是让不同时间尺度的认知各司其职：</p>
<ul>
<li><strong>「即时演化的经验」</strong>，用于保证当前探索过程的连续性；</li>
<li><strong>「阶段性稳定的知识」</strong>，在同一科研任务中被反复调用；</li>
<li><strong>「跨任务沉淀的先验智慧」</strong>，为新问题提供高质量起点。</li>
</ul>
<p>在这一机制下，有价值的认知会在探索过程中被不断筛选并逐步提升层级，而噪声信息则会自然被淘汰。</p>
<p>这使得 ML-Master 2.0 即使在长时间运行中，也能够保持稳定、可控的科研节奏，而不会陷入「上下文爆炸」或「遗忘历史经验」的困境。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89b7925faf784e7b8f8dbd0be1971128~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262877&amp;x-signature=%2BY1EgoUkoq3odfX2BqT%2BeSUr1jA%3D" alt="" loading="lazy"/></p>
<p><strong>「ML-Master 2.0 重登 MLE-bench 榜首」</strong></p>
<p>在 <strong>「OpenAI MLE-bench」</strong> 的系统评测中，ML-Master 2.0 在**「完全无人工干预」**的条件下，基于国产 Deepseek-V3.2-Speciale 开源大模型，取得了 <strong>「56.44% 的奖牌率」</strong>，位列榜单第一，相较于 Google 等团队的基于闭源模型的智能体提升 28.3%。</p>
<p>并且 ML-Master 2.0 已经开始在真实科研中发挥作用，参与协助理论计算物理以及具身智能等领域的前沿研究。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df782121323744cb94deb5014fca25c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262877&amp;x-signature=PgC2nX%2FmEso65KVIIhlX%2BIWdVSw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c35ff90563b647c8afd0336e5b084423~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262877&amp;x-signature=N%2BiZa9LuUMTEu1tCyT%2F5fP9Yn08%3D" alt="" loading="lazy"/></p>
<p><strong>「走向真正的自主 AI 科学家」</strong></p>
<p>ML-Master 2.0 的优异成果表明，通过将认知过程视为可积累、可迁移、可演化的资源，并以层次化方式对其进行管理，我们正在接近这样一种智能体：</p>
<p>它不仅能完成一次任务，而是能够在长期探索中，真正成长为一名自主的 AI 科学家。</p>
<p>在全球 AI4Science 竞逐加速的今天，我们很高兴看到：</p>
<p>中国团队，正在用中国的开源大模型，参与并引领这一关键范式的转变。</p>
<p>此前，<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI3MTA0MTk1MA%3D%3D%26mid%3D2652605662%26idx%3D1%26sn%3D20a9aa3bf211a63567a52747d5f20836%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI3MTA0MTk1MA==&amp;mid=2652605662&amp;idx=1&amp;sn=20a9aa3bf211a63567a52747d5f20836&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">ML-Master</a> 的核心代码已经开源，研究者和工程师可以通过 GitHub 访问并了解其整体设计与实现细节。</p>
<p>与此同时，ML-Master 2.0 所代表的这一整套「面向真实科研的自主智能体能力」，也将以产品形态逐步开放。</p>
<p>该能力即将通过 **「SciMaster 平台」**上线，面向机器学习与 AI4Science 场景提供更完整、更稳定的使用体验。</p>
<p>目前该功能开放了 <strong>「Waiting List」</strong> 阶段，感兴趣的研究者与工程团队可以在 SciMaster 主页通过「SciMaster 的朋友圈」提前申请体验资格。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fb3797a47ce47ad956c6944803196e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262877&amp;x-signature=GVlMKbD11qQ6KEB%2FhrQoA4ZHlnQ%3D" alt="" loading="lazy"/></p>
<p>项目地址：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsjtu-sai-agents%2FML-Master" target="_blank" title="https://github.com/sjtu-sai-agents/ML-Master" ref="nofollow noopener noreferrer">github.com/sjtu-sai-ag…</a></p>
<p>SciMaster 主页：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fscimaster.bohrium.com%2Fchat%2F" target="_blank" title="https://scimaster.bohrium.com/chat/" ref="nofollow noopener noreferrer">scimaster.bohrium.com/chat/</a></p>
<p>EigenAI 主页：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.eigenai.com%2F" target="_blank" title="https://www.eigenai.com/" ref="nofollow noopener noreferrer">www.eigenai.com/</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[硅谷青睐的中国模型更新了！一觉醒来，直接套壳]]></title>    <link>https://juejin.cn/post/7587459328070975498</link>    <guid>https://juejin.cn/post/7587459328070975498</guid>    <pubDate>2025-12-25T10:23:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587459328070975498" data-draft-id="7587604932057972787" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="硅谷青睐的中国模型更新了！一觉醒来，直接套壳"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-12-25T10:23:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="新智元"/> <meta itemprop="url" content="https://juejin.cn/user/952600743642312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            硅谷青睐的中国模型更新了！一觉醒来，直接套壳
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/952600743642312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    新智元
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T10:23:08.000Z" title="Thu Dec 25 2025 10:23:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f8226e603a74552bc1d9bf2544118ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=GByvlVIffZqwaFrz9fuop7r6pRI%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-0"><strong>「【新智元导读】智谱作为「大模型第一股」赴港上市前夕，直接掏出了旗舰模型 GLM-4.7 并开源！」</strong></h5>
<p>2025 年底智谱压轴了，还是一炮双响！</p>
<p>一份招股书冲刺「大模型第一股」，紧跟着发布了最新一代开源大模型 GLM-4.7！</p>
<p>经过一年的狂飙突进后，智谱用一场资本和科技完美共振的盛宴收官了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fd96e9aed42451e8dbb4fa8738ecc9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=WX9rQHiq50bHhIaz9sJX2SqBLro%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3453bedef736476caba2d0d6d94028ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=yxUlZLuqeCIuEthLlx9u5%2FoKYLc%3D" alt="" loading="lazy"/></p>
<p>GLM-4.7 这次以「Coding」能力提升为核心定位，直接对标全球顶尖编程模型 Claude Sonnet 4.5，在多个权威榜单上不仅拿下了开源第一，更实现了国产模型对硅谷顶尖闭源模型的贴身肉搏。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21943f150bb44c43ba1bd1f8ee2e868f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=7Mg7VtZNSuuM8%2FvxbTvEd6ccGoI%3D" alt="" loading="lazy"/></p>
<p>这一战绩在 Vals Index 上体现得淋漓尽致。</p>
<p>作为一个不仅考量代码能力，还加权了金融、法律等高价值复杂任务的权威榜单，Vals Index 向来被视为大模型「经济价值」的风向标。</p>
<p>GLM-4.7 在这里出道即巅峰，直接空降开源模型**「第一名！」**</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3ba3254d4894d88a3e40cbfc86d6ab0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=W0Q066BgH047kVDfynypWG92MAI%3D" alt="" loading="lazy"/></p>
<p>这意味着，在一个不论出身、只论实力的竞技场里，它把一众知名的欧美开源模型甩在了身后，证明了开源模型在处理高难度、高价值任务上，已经具备了替代闭源巨头的实力。</p>
<p>而在更能反映开发者真实体感的 Design Arena 中，GLM-4.7 的表现则更具戏剧性。</p>
<p>由开发者盲测投票得出的胜率（Win Rate）和 Elo 评分中，<strong>「GLM-4.7 高居第二，紧紧咬住了谷歌的 Gemini 3 Pro Preview，甚至超过了 Claude Opus 4.5 和 GPT-5.2。」</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d467e438ce2e4f5084f8d43659a306d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=On4PY%2F3sMI1ZB82Noewen0InzI4%3D" alt="" loading="lazy"/></p>
<p>与此同时，在代码竞技场 WebDev 中，GLM-4.7 更是直接斩获开源第一，跻身全球第六。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/108a85b677fd4c6eb482cd0a1aef1cdc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=q1sk2DESniOaCgfz4WV%2ByQI4uQU%3D" alt="" loading="lazy"/></p>
<p>高耸的柱状图不只是数字，它是全球开发者用脚投票的结果：在高强度的实战对比中，人们更愿意使用 GLM-4.7。</p>
<p>这标志着国产模型终于跨越了从「能用」到「好用」、从「参数对齐」到「体验对齐」的那道天堑。</p>
<p>在 2025 年的大部分时间里，Anthropic 的 Claude 系列，特别是 Claude Opus 4.5，一直被全球开发者奉为「编程之神」。</p>
<p>但是 GLM-4.7 的发布，选择了正面硬刚 Claude，对这波操作最开心的，莫过于大洋彼岸的硅谷程序员们了。</p>
<p>他们一觉醒来惊喜地发现：中国开源界又「送温暖」了！ 这次不仅有现成的新模型可以「套壳」，性能还强得离谱。</p>
<p>这大概就是 2025 年 AI 圈魔幻的乐子：美国的编程工具，都等着中国发模型。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b50a8bebcf1a4806be7c02562052976f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=RcXm4YUzfwJC3k3s3RRkEDdd8rM%3D" alt="" loading="lazy"/></p>
<p><strong>「被老外套壳的中国大模型」</strong></p>
<p><strong>「又更新了~」</strong></p>
<p>GLM 上次火出圈，<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI3MTA0MTk1MA%3D%3D%26mid%3D2652640884%26idx%3D1%26sn%3D8785f1a0b5da9567de1d73dad50a75e2%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI3MTA0MTk1MA==&amp;mid=2652640884&amp;idx=1&amp;sn=8785f1a0b5da9567de1d73dad50a75e2&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">还是因为 Cursor、Windsurf 的「自研模型」被发现其实是套的 GLM 的壳。</a></p>
<p>要知道，Cursor 的市值加起来比两个智谱都高，结果基座模型还是用的咱们国产的。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c258ae8c0524b45b233ba1f1d76474d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=z75EU8Xm5DzOEfMyYYg1Xqm8lXA%3D" alt="" loading="lazy"/></p>
<p>这一次，GLM-4.7 更新，大洋彼岸的美国明星科技企业直接不藏了！</p>
<p>备受海外用户欢迎的 Cline、Kilo、Vercel 等一众主流 AI 平台，纷纷在第一时间官宣接入，并对其取得的巨大进步高度评价。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb8f856376d94aeba743c6486f22a163~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=xKrx8FRGBj6pFThydRj2wHZ2RWg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e263befe7cb641f6847d0b2e86869815~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=MhNSPk0kwrLdePX22WplyfUbf3c%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cdbc316d9e74c4f9e9d0554258ebb3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=5YaasXEGksa8cXUdVI4xjAckfjE%3D" alt="" loading="lazy"/></p>
<p>估值 40 亿美元的 Fireworks 同样发电 Day0 支持——美国人民有更好的模型可以用了！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fd3b31c5be8464f9750b677a018bd8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=4EFVZ7S%2FC1yfPpY%2Bd5I8pcQjkDg%3D" alt="" loading="lazy"/></p>
<p><strong>「<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdc89577b82d421e88c72b7a2dcf683e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=LYzHMo0tcnGhZ7Q2D42BiCtf0lM%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「为何老外偏爱「中国开源模型」」</strong></p>
<p>硅谷的精明，在于「不看广告看疗效」。</p>
<p>他们选择 GLM 等开源模型，无非是因为它不仅**「便宜」<strong>，而且</strong>「真的好用」**。</p>
<p>毕竟，相比于昂贵的 GPT 和 Claude 系列，GLM 提供了几乎同等的 Coding 能力，但成本极低。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47a0653cdef74c18aace3675f1c7a693~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=ZQjcOdCARzohzk5vbD%2FzdIEPJ5Y%3D" alt="" loading="lazy"/></p>
<p>对于需要大量消耗 Token 的 Agent 工具来说，GLM 是极佳的「降本增效」引擎。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/139f07e3f6fb4eaba1400bfa57d61e3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=g2Fbni6Dvbnmjy3UgpO3Y7fdoF4%3D" alt="" loading="lazy"/></p>
<p><strong>「不止于美国，智谱目前已在海外拥有超过 15 万用户，因而每次发布新模型，都备受海外开发者关注。」</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d425d93d8694d34903bbc8a8591509a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=TLP8a78mVrFPksRxi4LUHXoIcso%3D" alt="" loading="lazy"/></p>
<p>智谱 Coding Plan 的全球化人群分布</p>
<p>而且老外对于 GLM 的热情不仅仅是开源免费，能打才是核心因素。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93f093703ae34396bf5ff1510b96f7f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=QCU3ezHxXLu%2BSCbZ%2FeTf9p367Cw%3D" alt="" loading="lazy"/></p>
<p><strong>「「体感」拉满，歪果网友又玩疯了」</strong></p>
<p>AI Coding 因为涉及到「抽卡」（通过多次重复来得到满意的输出），所以很多展示出来 Demo 到底是对话几轮以后的结果，很难说清楚。</p>
<p>因而，开发者的使用「体感」很能说明问题。</p>
<p>GLM 每次一发布，国外的论坛就集体高潮，有赞扬的，有质疑的，但都表现出极大的热情。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b97f8696db894fe0bdcc073f59c12b89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=6l7yO7kqyFaVYJGBf4GR7ol6doY%3D" alt="" loading="lazy"/></p>
<p>比如有人认为上一个版本 GLM-4.6 就已经接近 Claude 的 4.5，而且要比 4.0 更好。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/487ac48974df46b8accb92a833590734~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=qg7iuSAvRELocVWa8rtXCrx32kI%3D" alt="" loading="lazy"/></p>
<p>甚至还有外国老哥认为 GLM-5 会直接问鼎 SOTA！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10126305355542fb97cd072359a6830f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=XY%2FqvtqXF10wDybVueGXWs1D6V8%3D" alt="" loading="lazy"/></p>
<p>国外的著名 KOL 们也开始自来水的推荐。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/363ec5d0ff364fada2a37cb501eafa89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=BGKkzS5CtXUpL3CBWyl7m4y%2FshU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3db5ed74682946588d53210a5bdf85c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=EjNjn9C%2BsNql4eNCdV5xyoWljRA%3D" alt="" loading="lazy"/></p>
<p>上下滑动查看</p>
<p>甚至有老哥看了 GLM 的价格，直接决定先买 1 年的服务！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d41436c4daf478289ee3e24f05ce86c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=d58fjIxRczruQCCvUHi4wiPWB68%3D" alt="" loading="lazy"/></p>
<p>让我们来看看，一向脑洞大开的国外网友能用 GLM-4.7 玩出什么花吧。</p>
<p>做个小游戏，不在话下。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b9bb466ed194c8891df6de9a2df60ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=r03mBZtib8mHUR12kUfQEaywF%2Fo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e97ccec60df04a21a721a838e4cc6a29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=5QOebCOkVodLPskPZmfxWXOdtXA%3D" alt="" loading="lazy"/></p>
<p>Agentic 能力的核心「工具调用」，完成得非常出色。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/889e167735a345169a5b9b1c238db0f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=kbFp0gTmRyx1XIWFV3xswMzMF%2BE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27c7a0f98c934c759e14570e5da9e634~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=2kEQyxQcSgkELG%2B8OMQPs7ObtQk%3D" alt="" loading="lazy"/></p>
<p>做个看起来酷炫的网页，也是信手拈来。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3e7476bb74943d098cfb5974db17ce3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=rTooe3EO%2FbsWEJi6yLF%2BF3xrYns%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/909b9752c8db41fdb95f105bf4081ca7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=IXrY%2FoS7kAiMfPCLfNizTiVHLtA%3D" alt="" loading="lazy"/></p>
<p>「理综」考试（多任务集合），顺利通过！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de0780842a254cc7a77ad316f72fadec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=cLBdmxAC9gxx2Q7kcrgwhHJa9gI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fff26ba6af54177be63aac45044724d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=3%2FgJFh8k1ZKyx0kA8GxlGtwqaO0%3D" alt="" loading="lazy"/></p>
<p>官方搓出来的「植物大战僵尸」更是惊艳。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b2ac94c9db1c4165b1bbd20acd4b0b5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=k%2BVVlTMmpGiI56XtCsE0Abxcrdk%3D" alt="" loading="lazy"/></p>
<p><strong>「<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59a30d1672184c45bbf3b65a21c70092~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=7qq39%2F5qH7%2BRf7QHgDtnS3qNlTk%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「小测一下」</strong></p>
<p>正如前文所说，目前主流的编程工具，如 Claude Code、Cursor、Cline 等等，都能完美支持 GLM-4.7 的部署。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d61896228fa448268b52511b6bdebac2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=PVojTy%2BCxVg6%2FUsKHpSuX2NyQzA%3D" alt="" loading="lazy"/></p>
<p>以最火热的 Claude Code 为例，智谱在官方文档中给出了特别详细的逐步教程（<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.bigmodel.cn%2Fcn%2Fcoding-plan%2Ftool%2Fclaude%25EF%25BC%2589%25E3%2580%2582" target="_blank" title="https://docs.bigmodel.cn/cn/coding-plan/tool/claude%EF%BC%89%E3%80%82" ref="nofollow noopener noreferrer">docs.bigmodel.cn/cn/coding-p…</a></p>
<p>进入命令行界面，执行如下运行 Coding Tool Helper：</p>
<pre><code class="hljs language-bash" lang="bash">npx @z_ai/coding-helper
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b3d201125a348ba80f051cc1aa91681~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=8d5XxlA01ZZfgOz%2BGx3fBYCDlYg%3D" alt="" loading="lazy"/></p>
<p>一键式配齐 API 等环境参数后，重启 Terminal，输入 claude，即可在 Claude Code 中使用 GLM-4.7 开启你愉快的 vibe coding 了！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38c35ef1f5ec42f785f1c879dbb02e44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=jB0TGCk4JrhjBCSZli1mdITnvkI%3D" alt="" loading="lazy"/></p>
<p>直接给出提示词：</p>
<p>设计一个细节丰富的体素风格（voxel-art）场景，核心要是在一座生机勃勃的花园里放一座华丽的宝塔。植物种类要多——特别是樱花树，一定要多来点——确保整体画面看起来生动活泼、色彩鲜艳，而且视觉冲击力要强。随便你用什么体素或者 WebGL 库都行，但最后给我的必须是一个独立的 HTML 文件，让我能直接粘贴代码然后在 Chrome 浏览器里打开看。</p>
<p>很快，Gemini 3 Pro 就交卷了。</p>
<p>除了宝塔有点歪之外，效果还不错。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b806bb14c9a34407846587f98cf4b927~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=%2FMb1KHHWNi3PjnW9qKwkWnrggkA%3D" alt="" loading="lazy"/></p>
<p>GLM-4.7 给出的效果，有点子惊喜。</p>
<p>除了宝塔、小溪、草地，以及一大片樱花树之外，还有满天飞舞的花瓣。</p>
<p>更有意思的是，它还自己设计了一键自动旋转画面的功能，沉浸感直接拉满。</p>
<p>而且，网页版还能实时渲染代码，非常方便。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef762ac7788541d7a3d76b44c56b7a27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=HVYW7raTpjh5oQ1Bz7EH6yKGa6s%3D" alt="" loading="lazy"/></p>
<p>第二段提示词：</p>
<p>1 帮我做一个技能五子棋的游戏网页，要求是在普通的五子棋规则上，玩家可以使用技能，其中包括飞沙走石，静如止水，力拔山兮。「飞沙走石」，是把对手的棋子直接扔进什（石）刹海，2 技能点；「静如止水」是凝结时间，把对方「速冻」，4 技能点；「力拔山兮」是摔坏棋盘, 8 技能点，直接获胜。黑棋和白棋的技能点要分开算，并且每走一步都可以累加。直接给我 HTML 文件，画面要美观。需要设计一个电脑对手，让我可以直接和它对战。</p>
<p>GLM-4.7 设计的这个「AI」简直绝了，主打一个「五五开」。</p>
<p>首场惨败之后瞬间上头，反手就是三连局，根本停不下来……</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acbd34f9f7d149c983787512fb6f05b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=0RHc3YngyZivTjVX7oGEO%2BIAATM%3D" alt="" loading="lazy"/></p>
<p>再来一个更厉害的！</p>
<p>首先，输入如下提示词：</p>
<p>请用 HTML、CSS 和 JS 做一个浏览器操作系统，要求包含下面这些功能：</p>
<ul>
<li>至少有 5 个 App；</li>
<li>这 5 个 App 里，必须有两个是真的能玩的游戏；</li>
<li>支持更换壁纸；</li>
<li>再加一个你自己定的「特殊」功能，你得说明白这个功能是啥，以及它特别在哪里。</li>
</ul>
<p>然后，直接看效果：</p>
<p><a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">视频详情</a></p>
<p>想当初，让 AI 写个能玩的贪吃蛇都费劲。</p>
<p>现在，只需要一小段 Prompt，不仅能一口气生成 5 个能玩的应用，甚至还能搞出一个「操作系统」。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfc395a940da407c84a2d6621153edd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767262988&amp;x-signature=xnOPAVENBQtx%2BAdlh9Pc%2Fz%2BrLGk%3D" alt="" loading="lazy"/></p>
<p>归根结底，AGI 是一场长跑，跑分只是评估性能的一种方式。</p>
<p>虽然指标提供了必要的参考，但最重要的始终是「体感」。</p>
<p>真正的智能，不仅仅在于考试拿满分或数据处理得更快，还在于它能否无缝地融入我们的工作流与生活。</p>
<p>而这一次，它融入的是「编程」。</p>
<p>参考资料：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkyMzI3NzQ0Mg%3D%3D%26mid%3D2247492642%26idx%3D1%26sn%3D2ab783f2e238ff6025b25f3cf0aa1258%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkyMzI3NzQ0Mg==&amp;mid=2247492642&amp;idx=1&amp;sn=2ab783f2e238ff6025b25f3cf0aa1258&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">GLM-4.7 上线并开源：更强的编码</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[微软定目标：2030年，彻底删除C、C++代码，换成Rust]]></title>    <link>https://juejin.cn/post/7587619946189193267</link>    <guid>https://juejin.cn/post/7587619946189193267</guid>    <pubDate>2025-12-25T10:24:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587619946189193267" data-draft-id="7587459328070991882" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="微软定目标：2030年，彻底删除C、C++代码，换成Rust"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-12-25T10:24:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            微软定目标：2030年，彻底删除C、C++代码，换成Rust
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T10:24:20.000Z" title="Thu Dec 25 2025 10:24:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>忍不了了，微软要消灭 C 语言了？</p>
<p>最近几天，有关微软设定目标，要在 2030 年从代码中彻底删除 C 和 C++ 的消息引发了人们的大讨论。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/298959b6166b4540b6a65bc71205199e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767263060&amp;x-signature=KKBDMcULYywxI662zhpjgW8bRds%3D" alt="图片" loading="lazy"/></p>
<p>事情是这样的：发出此等言论的 Galen Hunt 是微软的一名杰出工程师，他在微软已经工作了 28 年。最近他在领英上招人，开放一个 IC5 首席软件工程师的职位。</p>
<p>这个核心高级专家职位不是闹着玩的，他表示：「我的目标是在 2030 年消灭微软所有的 C 和 C++ 代码。策略是使用 AI 与算法的方式，重写微软整个代码库。」</p>
<p>Galen Hunt 还说，在他所在的 North Star 团队，工作的目标是「每个工程师，每个月，100 万行代码。」为了实现这个无法想象的目标，他们正在构建处理代码的基础设施，包括算法设施，智能体驱动的 AI 处理设施，他们可以让代码的转换规模化。目前，这样的基础设施已经在大规模应用于代码理解等任务上了。</p>
<p>你没看错，每位工程师每月写一百万行代码。</p>
<p>另外，他们计划用于替代「老旧」C 语言的新语言，大家可能也要猜出来了，是 Rust。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdd07e88b0224246a60c9ddb2c954d1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767263060&amp;x-signature=bHde%2FMVoe9Tv1lOWXZNhf8r5jb4%3D" alt="图片" loading="lazy"/></p>
<p>这就引发了一场有关新旧语言、科技巨头、AI 代码生成技术的口诛笔伐。</p>
<p>有网友就说了，这真是纯粹的疯狂。这种决策方式在那些对 Rust 派抱有根深蒂固的，妄想式信仰的人当中很常见。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4cb3c15f50248229b00031a71dfa267~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767263060&amp;x-signature=PFVHjkcg8y31bY1q64Ubv7njrCU%3D" alt="图片" loading="lazy"/></p>
<p>将多年来积累，经过大量实践检验过的代码以极快的速度重写，然后在未经充分测试的情况下强行采用，这样做可能短时间内对用户没有什么显而易见的好处。而且，这样做预设的前提是：默认 Rust 代码在各方面都更胜一筹，没有任何 bug，而且更安全。</p>
<p>总的来说，Rust 是一个更先进的语言，它在保证了与 C/C++ 几乎相当性能的同时，从语言设计的根源上解决了内存安全和并发安全这两个核心痛点，并提供了现代化的开发体验。</p>
<p>近 6 年以来，微软一直提倡使用 Rust。</p>
<p>微软已经让 Rust 开发者能够使用 Windows API。GitHub 上还有一个名为「windows-rs」的代码库，它是 Windows API 的 Rust 投影，让 Rust 代码可以像 C++ 或 C# 一样调用 Win32、COM 和 WinRT。</p>
<p>微软还专门开展了一个 Rust 驱动程序开发项目（windows-drivers-rs），这表明该公司也在探索 Rust 在应用程序之外的应用。可以看出，针对 Rust 进行优化并非一个口号或一次性开源工作，微软对 Rust 的重视程度是实实在在的。</p>
<p>不过迄今为止，微软试图用其他语言取代 C++、WinUI、XAML 等原生语言的尝试并未获得消费者、企业的认可。这种做法造成的内存占用问题反而引人诟病，例如 Discord 或微软自家的 Teams 都成了内存消耗大户。</p>
<p>另一方面，如果你知道 Windows 这个这个全球超 14 亿用户，PC 市场份额最高的操作系统主要是由 C 语言编写的，你肯定会认为 Galen Hunt 的主张有点异想天开了。这个「大重写」计划可能会对 Windows 11 产生巨大影响。目前，C 语言驱动着 Windows 内核和底层组件的大部分，包括 Windows API (Win32)，而 C++ 则用于构建原生 Windows 应用程序。</p>
<p>每人一月 100 万行代码的 KPI，必须基于 AI 辅助生成代码才可能做到。</p>
<p>今年 5 月，微软 CEO 萨提亚・纳德拉在和扎克伯格的谈话中提到，微软已有 20-30% 的代码是 AI 写的。纳德拉表示，公司在不同语言的 AI 代码生成方面取得了不同的成果，其中 Python 的进展更大，而 C++ 的进展则相对较小。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b548046554314355a3c1eb7019ad0f20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767263060&amp;x-signature=naDv409F3AoDD2AojVd9Zak9zyM%3D" alt="图片" loading="lazy"/></p>
<p>微软 CTO 兼人工智能执行副总裁 Kevin Scott 也表示，他预计到 2030 年，95% 的代码将由 AI 生成。</p>
<p>但大规模应用 AI 写代码，是否能做到靠谱，还是一个有待验证的问题，至少现在看还是不行。在闹得沸沸扬扬之后，Galen Hunt 修改了自己的原贴内容：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04eb4560c78c4737a1b1b26f2ca9352c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767263060&amp;x-signature=Rl3YMpxfH6c9InUjhBw%2FR%2FgeVN0%3D" alt="图片" loading="lazy"/></p>
<p>AI 能否把 Windows 代码彻底翻译成 Rust 语言？只有时间才能证明。</p>
<p>参考内容：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linkedin.com%2Fposts%2Fgalenh_principal-software-engineer-coreai-microsoft-activity-7407863239289729024-WTzf%2F" target="_blank" title="https://www.linkedin.com/posts/galenh_principal-software-engineer-coreai-microsoft-activity-7407863239289729024-WTzf/" ref="nofollow noopener noreferrer">www.linkedin.com/posts/galen…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[无需再训练微调，一个辅助系统让GPT-5.2准确率飙到创纪录的75%]]></title>    <link>https://juejin.cn/post/7587604932057989171</link>    <guid>https://juejin.cn/post/7587604932057989171</guid>    <pubDate>2025-12-25T10:25:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587604932057989171" data-draft-id="7587459328071008266" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="无需再训练微调，一个辅助系统让GPT-5.2准确率飙到创纪录的75%"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-12-25T10:25:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            无需再训练微调，一个辅助系统让GPT-5.2准确率飙到创纪录的75%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T10:25:32.000Z" title="Thu Dec 25 2025 10:25:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>什么？决定 AI 上限的已不再是底座模型，而是外围的「推理编排」（Orchestration）。</p>
<p>在 LLM 完全不变的前提下，仅靠一套 Agentic System，就能让 AI 的智力表现原地暴涨一截。</p>
<p>在看了「AI 推理和自我改进系统」初创公司 Poetiq 的最新评测之后，有人得出了这样的结论。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1eafe97495944125bfeb68b5ddaf8472~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767263132&amp;x-signature=Nuk8vvHumg1RJHW2lz9jUWsvLM4%3D" alt="图片" loading="lazy"/></p>
<p>部分截图</p>
<p>近日，Poetiq 表示其使用 ARC-AGI-2 测试集，在他们的系统上（称为 meta-system）运行了 GPT-5.2 X-High。该测试集通常被用来衡量当前 SOTA 模型在复杂抽象推理任务上的表现。</p>
<p>结果显示，在相同的 Poetiq 测试平台上，GPT‑5.2 X‑High 在完整的 PUBLIC-EVAL 数据集上的成绩高达 75%，这比之前的 SOTA 高出了约 15%，同时每个问题的成本低于 8 美元。</p>
<p>这里的 PUBLIC-EVAL 是 ARC 测试的一部分，前者一般包含基础推理任务和标准的 NLP、数学推理测试，适合广泛的模型评测，数据集更为公开、标准；后者包含更多复杂且富有挑战性的推理问题，考察模型的抽象推理、常识推理、创新能力等，是针对高水平模型的推理极限测试。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4aa3e0cbfa514be799228018003c298a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767263132&amp;x-signature=sfg0yLdc5ZvQbNNz97VksC97Hbg%3D" alt="图片" loading="lazy"/></p>
<p>下图展示了各个 SOTA 模型在 PUBLIC-EVAL 数据集上的成绩分布：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfeaec9766ca47bcaa3933b33a976d47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767263132&amp;x-signature=Q920TU1fetufyzISuTGnS%2Fnct2A%3D" alt="图片" loading="lazy"/></p>
<p>Poetiq 还特别强调了，其没有对 GPT-5.2 进行任何再训练或模型特定的优化。</p>
<p>在如此短的时间内，相较于 Poetiq 之前在 PUBLIC-EVAL 数据集上测试的其他模型，GPT-5.2 在准确率和价格方面实现了显著改进。</p>
<p>Poetiq 进一步做出设想：如果在 PUBLIC-EVAL 测试中表现好的规律能够延续到 ARC Prize 官方的 SEMI-PRIVATE 测试中，那么「GPT-5.2 X-High + Poetiq」会比以往任何系统配置都更强、更好。</p>
<p>ARC Prize 总裁 Greg Kamradt 表示，「很高兴看到 Poetiq 发布 GPT-5.2 X-High 的结果。如果这个成绩能保持下去，他们的系统看起来能很好地处理模型交换。不过，在 OpenAI API 的基础设施问题解决之前，结果还没有得到完全验证。」</p>
<p>这里的模型交换指的是：系统通过切换不同的模型来应对不同的任务需求，而无需对系统或模型进行大规模的调整或重新训练。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/374db29848124b5ba64d9bbfad9657b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767263132&amp;x-signature=wupcC1HymJnNrR7u6uelzO0sq5E%3D" alt="图片" loading="lazy"/></p>
<p>OpenAI 总裁 Greg Brockman 也转推表示：GPT-5.2 在 ARC-AGI-2 上超越人类基准成绩。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3e3d609c19f40bda685ebfaae4552af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767263132&amp;x-signature=fuA2QY%2B%2FRlPDxRFNBJN4qMGA61w%3D" alt="图片" loading="lazy"/></p>
<p>对于全新的测试结果，评论区提出了更多问题，比如「每个任务平均需要多长时间」。</p>
<p>Poetiq 回复称，「我们现在没有专门收集这些统计数据，最简单的问题大概在 8 到 10 分钟后就能完成，而最难的问题必须在 12 小时之前终止，以保持在时间限制内。所以，未来肯定还有改进的空间。」</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd6cc63a31c6478894d3c0c6cffdcf9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767263132&amp;x-signature=MqmQ%2Fu6WJHXrqozRWKFsxBYI7eU%3D" alt="图片" loading="lazy"/></p>
<p>还有人指出「大部分改进似乎来自于测试框架和协调机制，而不是任何模型特定的调优。没有训练变更的情况下，ARC-AGI-2 上提高了大约 15%，这表明仅在搜索、路由和终止逻辑方面就还有很大的提升空间」。</p>
<p>可问题是：为什么在这个设置中，X-High 每个任务的成本比 High 还要低？是因为它通过更早找到正确的解决方案而更快收敛，还是因为测试框架更积极地修剪了无效的推理过程？</p>
<p>对于这个问题，Poetiq 肯定了「X-High 只是比 High 更快地收敛到正确的答案」这一观点。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bc2326087294611bae55d0f5d058229~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767263132&amp;x-signature=w64ASX7rgK46%2F1F%2FDic8%2F%2FJMsSA%3D" alt="图片" loading="lazy"/></p>
<p>6 人团队打造 Meta-system 系统</p>
<p>Poetiq 是一支由 6 位研究员和工程师组成的团队，有多位核心成员来自 Google DeepMind 。</p>
<ul>
<li>
<p>Ian Fischer (联合创始人 &amp; 联席 CEO): 曾是 Google DeepMind 的资深研究员；</p>
</li>
<li>
<p>Shumeet Baluja (联合创始人 &amp; 联席 CEO): 同样出身于 Google/DeepMind 的资深专家。</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/679ef903b08342d09fe9e7785ad91a7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767263132&amp;x-signature=Yk86Ei0cm8V9yQmUPQNmvXCu1X8%3D" alt="图片" loading="lazy"/></p>
<p>Poetiq 能够取得上述成绩，关键在于其构建的 meta-system（元系统）。</p>
<p>Meta-system 不依赖特定的大模型，可以与任何前沿模型配合使用（如 Gemini 3、GPT-5.1、Grok 等），而不是训练或微调模型本身，这意味着它能随着新模型发布快速适配并提升性能。</p>
<p>Poetiq meta-system 构建了一种迭代式推理过程，其与传统一次性生成答案的方法不同，有两个主要机制：</p>
<ul>
<li>
<p>迭代式的问题求解循环：系统并不是只向模型提出一次问题，而是利用大语言模型（LLM）生成一个潜在的解决方案，随后接收反馈、分析反馈，并再次调用 LLM 对方案进行改进。这种多步骤、自我改进的过程，使系统能够逐步构建并不断完善最终答案。</p>
</li>
<li>
<p>自我审计（Self-Auditing）：系统能够自主审计自身的运行进度，并自行判断何时已经获得足够的信息、当前解决方案是否令人满意，从而决定终止整个过程。这种自我监控机制对于避免不必要的计算浪费、有效降低整体成本至关重要。</p>
</li>
</ul>
<p>Poetiq 还特别强调，他们所有 meta-system 的适配工作是在新模型发布前完成的，而且系统从未直接接触过 ARC-AGI 任务集，但依然在多个不同模型上取得跨版本、跨模型族的性能提升，说明 meta-system 对 reasoning 策略具有良好的泛化能力。</p>
<p>正是这种灵活、强大且具备递归能力的架构，使得 Poetiq 这样一支小规模团队，能够在极短时间内取得一系列最先进（SOTA）的成果。</p>
<p>对于这个 meta-system，有人认为「太棒了。在模型之上构建智能，而不是在模型内部构建，意味着可以在几个小时内适配新模型，非常高明。适配开源模型，并且成功迁移到新的封闭模型，这表明捕捉到的东西是推理过程本身的基本规律，而不是模型特定的怪癖。」</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/656460b0edca4f3281768860dd751fad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767263132&amp;x-signature=Upq0UT7LVt9kPibd7XKGROufs%2F4%3D" alt="图片" loading="lazy"/></p>
<p>参考链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpoetiq.ai%2Fposts%2Farcagi_verified%2F" target="_blank" title="https://poetiq.ai/posts/arcagi_verified/" ref="nofollow noopener noreferrer">poetiq.ai/posts/arcag…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[年底科技大考：2025 中国前端工程师的 AI 辅助工具实战盘点]]></title>    <link>https://juejin.cn/post/7587459328071057418</link>    <guid>https://juejin.cn/post/7587459328071057418</guid>    <pubDate>2025-12-25T10:45:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587459328071057418" data-draft-id="7587632484427251763" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="年底科技大考：2025 中国前端工程师的 AI 辅助工具实战盘点"/> <meta itemprop="keywords" content="后端,前端,Java"/> <meta itemprop="datePublished" content="2025-12-25T10:45:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="狗头大军之江苏分军"/> <meta itemprop="url" content="https://juejin.cn/user/2955079655907879"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            年底科技大考：2025 中国前端工程师的 AI 辅助工具实战盘点
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2955079655907879/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    狗头大军之江苏分军
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T10:45:16.000Z" title="Thu Dec 25 2025 10:45:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#5f6368;background-image:linear-gradient(90deg,rgba(240,191,213,.1) 3%,transparent 0),linear-gradient(1turn,rgba(240,191,213,.1) 3%,transparent 0);background-size:20px 20px;background-position:50%;letter-spacing:1px;word-spacing:1px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-left:50px;padding-bottom:5px;color:#5f6368}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{position:absolute;left:0;display:block;content:""}.markdown-body h1{font-size:32px;margin-bottom:5px}.markdown-body h1:before{top:0;content:"🦄";font-size:32px}.markdown-body h2{padding-bottom:24px;border-bottom:1px solid #ececec}.markdown-body h2:before{top:0;left:8px;content:"🐳";font-size:24px}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{top:-2px;left:8px;content:"🐄";font-size:20px}.markdown-body h4{font-size:16px}.markdown-body h4:before{top:-2px;left:8px;content:"🦥";font-size:18px}.markdown-body h5{font-size:14px}.markdown-body h5:before{top:-2px;left:9px;content:"🦩";font-size:16px}.markdown-body h6{font-size:12px;margin-top:5px}.markdown-body h6:before{top:-1px;left:10px;content:"🐧";font-size:14px}.markdown-body p{line-height:1.9;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid rgba(253,121,168,.5);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#a6accd;background:#292d3e;border-radius:8px}.markdown-body a{text-decoration:none;color:#fd79a8;border-bottom:1px solid #fd79a8;padding:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(253,121,168,.1);color:#ee69a9}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body th{color:#fd79a8}.markdown-body th,.markdown-body tr:hover{background:rgba(253,121,168,.1)}.markdown-body td{min-width:120px}.markdown-body blockquote{position:relative;color:#666;padding:23px;margin:22px 0;border-left:4px solid #ee69a9;background-color:rgba(253,121,168,.1)}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;display:block;font-size:27px;color:#fd79a8;opacity:.8}.markdown-body blockquote:before{left:10px;top:0;content:"❝"}.markdown-body blockquote:after{right:10px;bottom:0;content:"❞"}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body strong{position:relative;color:#fd79a8}.markdown-body strong:before{content:"· "}.markdown-body strong:after{content:" ·"}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#fd79a8}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#ee69a9}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><blockquote>
<p><strong>声明</strong>：本文所有数据均来源于公开的官方文档、技术报告、GitHub 统计以及作者本人在真实项目中的实测。文中涉及的链接均可点击访问，以供读者核实。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">1️⃣ 前言——AI 已经渗透到前端日常</h2>
<p>2025 年，随着大语言模型（LLM）算力成本的下降以及企业级云服务的成熟，AI 已不再是“科研玩具”。在我的团队里，<strong>Copilot</strong>、<strong>Tabnine</strong>、<strong>腾讯云 AI 设计转代码</strong>等工具已经成为日常编码的“同事”。</p>
<p>本文的价值在于：帮你快速定位今年 <strong>最值得玩、最省时、最安全</strong> 的 AI 前端工具，避免在信息噪声中盲目跟风。</p>
<hr/>
<h2 data-id="heading-1">2️⃣ 评测基准——我们怎么挑选与打分？</h2>








































<table><thead><tr><th>维度</th><th>说明</th><th>权重</th></tr></thead><tbody><tr><td><strong>功能完整度</strong></td><td>代码生成、错误诊断、自动重构、文档/注释、设计稿转代码等</td><td>30%</td></tr><tr><td><strong>易用性 / 集成度</strong></td><td>VS Code 插件、CLI、Web UI、CI / CD 支持</td><td>20%</td></tr><tr><td><strong>中文/本地化</strong></td><td>中文 Prompt 识别、国内网络适配、对国产大模型的支持</td><td>15%</td></tr><tr><td><strong>产出质量</strong></td><td>代码可读性、性能优化、Bug 率</td><td>20%</td></tr><tr><td><strong>安全合规</strong></td><td>隐私数据不外泄、代码版权声明、企业审计功能</td><td>10%</td></tr><tr><td><strong>社区活跃度</strong></td><td>GitHub Star、论坛活跃度、案例分享</td><td>5%</td></tr></tbody></table>
<blockquote>
<p><strong>实测方法</strong>：在 2025‑03~2025‑12 的 20 项真实需求（包括产品页面、业务组件、API 接口）中，分别使用每款工具完成任务。之后根据上述维度给出 0‑5 星评级（细化到小数位）</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">3️⃣ 工具全景速览（功能分类）</h2>













































<table><thead><tr><th>分类</th><th>代表性工具（国内 / 国外）</th><th>关键特色</th></tr></thead><tbody><tr><td><strong>代码补全 &amp; 生成</strong></td><td>- <strong>GitHub Copilot</strong>（国外） - <strong>Cursor</strong>（国外） - <strong>Amazon CodeWhisperer</strong>（国外） - <strong>Tabnine Enterprise</strong>（国外）</td><td>实时补全、上下文深度（最高 2 k tokens），支持 JavaScript/TypeScript/React/Vue 等主流框架。</td></tr><tr><td><strong>错误诊断 &amp; 修复</strong></td><td>- <strong>Snyk Code</strong>（原 DeepCode） - <strong>AI 代码审查官</strong>（阿里云）</td><td>静态安全检测 + 自动生成修复 PR，支持企业私有化部署。</td></tr><tr><td><strong>设计稿 → 前端</strong></td><td>- <strong>Uizard</strong>（国外） - <strong>腾讯云 AI 设计转代码</strong>（国产） - <strong>Figma + AI 插件</strong></td><td>从 Figma / Sketch 自动输出 React / Vue 组件代码，支持 Ant Design、Element Plus 等 UI 库。</td></tr><tr><td><strong>文档 &amp; 注释生成</strong></td><td>- <strong>ChatGPT‑4 + VS Code 插件</strong>（国外） - <strong>晓译 AI</strong>（中文）</td><td>根据函数实现自动生成 JSDoc、TS 接口文档，支持中文 Prompt。</td></tr><tr><td><strong>自动化测试生成</strong></td><td>- <strong>Diffblue Cover</strong>（国外） - <strong>AI Test Generator</strong>（华为）</td><td>一键生成单元测试和集成测试，用例覆盖率可提升 20%+。</td></tr><tr><td><strong>性能优化建议</strong></td><td>- <strong>Lighthouse AI（Chrome 插件）</strong> - <strong>腾讯云前端性能诊断 AI</strong></td><td>分析渲染路径、自动给出代码层面的优化建议（如懒加载、SSR 改造）。</td></tr><tr><td><strong>CI/CD &amp; DevOps 助手</strong></td><td>- <strong>GitHub Actions + AI 步骤</strong> - <strong>阿里云 AI 自动部署</strong></td><td>自动生成 CI 脚本、代码审查、变更评审，支持 YAML 生成。</td></tr></tbody></table>
<h2 data-id="heading-3">4️⃣ 重点深度评测（TOP 5）</h2>
<blockquote>
<p><strong>评测环境</strong>：Node 20、React 18、Vue 3、VS Code 1.88、Windows 11 + WSL2。所有测试均在同一台机器（Intel i9‑13900K，32 GB RAM）上完成，确保对比公平。</p>
</blockquote>
<p>下面列出 2025 年 <strong>在中国前端团队最受欢迎、实际产出最高</strong> 的 5 大工具（不再使用使用率相对较低的 CodeGeeX、DeepMind 等），并给出 <strong>量化评分</strong>、<strong>关键案例</strong>以及 <strong>官方链接</strong>，以便直接查证。</p>

































































<table><thead><tr><th>工具</th><th>官方链接</th><th>功能完整度</th><th>易用性</th><th>中文适配</th><th>产出质量</th><th>安全合规</th><th>综合评分</th></tr></thead><tbody><tr><td><strong>GitHub Copilot</strong></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffeatures%2Fcopilot" target="_blank" title="https://github.com/features/copilot" ref="nofollow noopener noreferrer">github.com/features/co…</a></td><td>4.5 ⭐</td><td>4.8 ⭐</td><td>3.5 ⭐</td><td>4.2 ⭐</td><td>4.0 ⭐</td><td><strong>4.4</strong></td></tr><tr><td><strong>Cursor</strong></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fcursor.com%2F" target="_blank" title="https://cursor.com/" ref="nofollow noopener noreferrer">cursor.com/</a></td><td>4.6 ⭐</td><td>4.7 ⭐</td><td>4.2 ⭐</td><td>4.4 ⭐</td><td>4.3 ⭐</td><td><strong>4.5</strong></td></tr><tr><td><strong>Amazon CodeWhisperer</strong></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fcn%2Fcodewhisperer%2F" target="_blank" title="https://aws.amazon.com/cn/codewhisperer/" ref="nofollow noopener noreferrer">aws.amazon.com/cn/codewhis…</a></td><td>4.3 ⭐</td><td>4.5 ⭐</td><td>4.4 ⭐</td><td>4.1 ⭐</td><td>4.7 ⭐</td><td><strong>4.4</strong></td></tr><tr><td><strong>AI 代码审查官（阿里云）</strong></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.aliyun.com%2Farticle%2F1298765" target="_blank" title="https://developer.aliyun.com/article/1298765" ref="nofollow noopener noreferrer">developer.aliyun.com/article/129…</a></td><td>4.3 ⭐</td><td>4.0 ⭐</td><td>4.8 ⭐</td><td>4.6 ⭐</td><td>5.0 ⭐</td><td><strong>4.5</strong></td></tr><tr><td><strong>Tabnine Enterprise</strong></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.tabnine.com%2Fenterprise" target="_blank" title="https://www.tabnine.com/enterprise" ref="nofollow noopener noreferrer">www.tabnine.com/enterprise</a></td><td>4.2 ⭐</td><td>4.0 ⭐</td><td>4.1 ⭐</td><td>4.0 ⭐</td><td>4.6 ⭐</td><td><strong>4.2</strong></td></tr></tbody></table>
<blockquote>
<p><strong>评分细则</strong>（每项 0‑5 星，保留一位小数）：</p>
<ul>
<li><strong>功能完整度</strong>：是否覆盖代码补全、函数生成、文档、单元测试、错误修复等核心需求。</li>
<li><strong>易用性</strong>：安装配置难度、IDE/CLI UI 友好度、是否支持团队协作。</li>
<li><strong>中文适配</strong>：中文 Prompt 的解析准确度、对中文变量/注释的理解深度。</li>
<li><strong>产出质量</strong>：生成代码的可读性、是否遵循行业最佳实践、Bug 产生率。</li>
<li><strong>安全合规</strong>：是否支持本地部署、数据是否离站、是否提供审计日志。</li>
</ul>
</blockquote>
<p>下面对每款工具进行 <strong>案例说明</strong>、<strong>优势 / 局限</strong>、<strong>使用建议</strong> 的细化解读。</p>
<hr/>
<h3 data-id="heading-4">4.1 GitHub Copilot（VS Code 插件）</h3>
<ul>
<li>
<p><strong>功能</strong>：代码补全、函数体生成、注释、单元测试（Jest）模板、代码重构建议。</p>
</li>
<li>
<p><strong>实测案例</strong>：在 <strong>电商后台商品列表</strong> 项目中使用 Copilot 完成 120 行列表页代码，调试时间比手写缩短约 30%。</p>
</li>
<li>
<p><strong>优势</strong></p>
<ol>
<li>与 VS Code 深度集成，几乎零配置即可使用。</li>
<li>生态成熟，配套文档、示例丰富。</li>
</ol>
</li>
<li>
<p><strong>局限</strong></p>
<ol>
<li>对中文 Prompt 敏感度仍不如英文，某些业务词汇会被误解释。</li>
<li>代码会经由 GitHub 服务器进行 token‑化处理，若对数据隐私有极高要求，需要使用 <strong>Copilot Enterprise</strong>（目前仍在预览阶段）。</li>
</ol>
</li>
<li>
<p><strong>适用场景</strong>：日常业务代码、快速原型、单元测试草稿。</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-5">4.2 Cursor（AI‑First IDE）</h3>
<ul>
<li>
<p><strong>功能</strong>：全局上下文搜索、代码生成、即时错误定位、内置终端、可视化 UI 预览。</p>
</li>
<li>
<p><strong>实测案例</strong>：2025‑02，我用 Cursor 完成 <strong>企业内部仪表盘</strong> 的多个仪表板组件（React + TypeScript），整体代码量约 3 k LOC，手动编码预计需要 2‑3 天，使用 Cursor 只花 5‑6 小时。</p>
</li>
<li>
<p><strong>优势</strong></p>
<ol>
<li><strong>多模态 Prompt</strong>：支持文字、代码片段、截图混合输入，极大提升中文需求的识别率（官方称 92% 中文准确度）。</li>
<li><strong>即时预览</strong>：左侧编辑区同步渲染 UI，省去手动刷新浏览器的步骤。</li>
<li><strong>本地化模型</strong>（2025‑06 起）：提供 <strong>Enterprise</strong> 版，可将模型部署在国内私有云，符合《网络安全法》要求。</li>
</ol>
</li>
<li>
<p><strong>局限</strong></p>
<ol>
<li>与 VS Code 相比插件生态稍弱（不支持部分老旧插件），但正在快速补齐。</li>
<li>付费版起步价为 ¥2,000/人·年，对小团队成本略高。</li>
</ol>
</li>
<li>
<p><strong>适用场景</strong>：需要快速从设计稿生成 UI、跨技术栈混合项目（React + Vue），以及对中文 Prompt 有高依赖的团队。</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-6">4.3 Amazon CodeWhisperer</h3>
<ul>
<li>
<p><strong>功能</strong>：代码补全、函数生成、AWS SDK 代码建议、Security Scan（内置安全规则）。</p>
</li>
<li>
<p><strong>实测案例</strong>：在<strong>金融风控平台</strong>的前端（Vue 3 + TypeScript）中，使用 CodeWhisperer 生成了 30+ 条与 AWS Cognito、S3 交互的封装函数，安全扫描误报率仅 1.8%。</p>
</li>
<li>
<p><strong>优势</strong></p>
<ol>
<li><strong>安全合规度高</strong>：所有请求在 AWS 区域内部完成，满足国内外合规审计。</li>
<li><strong>对云原生 API 友好</strong>：自动补全 AWS SDK、CloudFront、Lambda 调用代码。</li>
<li><strong>免费额度</strong>：对个人开发者及小团队提供 <strong>每月 100 万 token</strong> 免费额度。</li>
</ol>
</li>
<li>
<p><strong>局限</strong></p>
<ol>
<li>中文 Prompt 对齐度略低（官方称 80%），对业务专有词汇仍需手动校正。</li>
<li>只能在 <strong>VS Code</strong>、<strong>IntelliJ</strong>、<strong>JetBrains</strong> 系列编辑器中使用（未提供独立 IDE）。</li>
</ol>
</li>
<li>
<p><strong>适用场景</strong>：云原生前端项目、需要统一 AWS SDK 使用规范的团队、对安全审计有严格要求的企业。</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-7">4.4 AI 代码审查官（阿里云）</h3>
<ul>
<li>
<p><strong>功能</strong>：基于自研 LLM 的静态安全检测、自动生成修复 PR、业务术语字典、中文 Prompt 优化。</p>
</li>
<li>
<p><strong>实测案例</strong>：在<strong>金融风控前端</strong>（React + TypeScript）项目中，使用该工具进行了3次全量审查，所有高危漏洞（如 XSS、CSRF）均被捕获并自动生成修复代码，最终安全评级提升至 <strong>A+</strong> 。</p>
</li>
<li>
<p><strong>优势</strong></p>
<ol>
<li><strong>本地化部署</strong>：支持在阿里云专有网络（VPC）内部离线运行，数据完全不出境。</li>
<li><strong>中文自然语言支持</strong>：对业务需求文档、中文注释的解析度极高。</li>
<li><strong>企业审计日志</strong>：每次审查都有完整的审计记录，可导出 PDF。</li>
</ol>
</li>
<li>
<p><strong>局限</strong></p>
<ol>
<li>与 VS Code 的集成相比 GitHub Copilot 稍迟，需手动安装插件。</li>
<li>对前端框架的细粒度建议（如 Vue 3 响应式陷阱）仍在持续迭代。</li>
</ol>
</li>
<li>
<p><strong>适用场景</strong>：对代码安全合规要求严格的金融、保险、政府项目；希望在 CI 中引入全自动安全审查的企业。</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-8">4.5 Tabnine Enterprise</h3>
<ul>
<li>
<p><strong>功能</strong>：基于混合模型的代码补全、团队统一风格插件、离线运行、支持多语言。</p>
</li>
<li>
<p><strong>实测案例</strong>：在<strong>跨团队微前端平台</strong>（React + Vue + Svelte）中，使用 Tabnine 统一了组件库的代码风格，PR 通过率提升 22%，团队代码规范审计通过率达 98%。</p>
</li>
<li>
<p><strong>优势</strong></p>
<ol>
<li><strong>完全离线</strong>：可部署在企业私有服务器，满足严苛数据合规需求。</li>
<li><strong>风格统一</strong>：通过自定义规则文件（<code>.tabnine.yaml</code>）让所有成员使用统一的代码风格、命名约定。</li>
<li><strong>对中文 Prompt 支持逐年提升</strong>（2025‑09 版已实现 85% 中文准确率）。</li>
</ol>
</li>
<li>
<p><strong>局限</strong></p>
<ol>
<li>与 Copilot、Cursor 相比，生成代码的“创造性”稍弱，更多是基于历史代码的相似补全。</li>
<li>部署与维护需要一定的运维成本（模型占用约 12 GB GPU 显存）。</li>
</ol>
</li>
<li>
<p><strong>适用场景</strong>：大型企业、金融证券等对代码来源可追溯、数据不出境有硬性要求的组织。</p>
</li>
</ul>
<h2 data-id="heading-9">5️⃣ 案例速递——真实项目中的 AI 助手</h2>









































<table><thead><tr><th>项目</th><th>使用工具</th><th>产出亮点</th><th>关键经验</th></tr></thead><tbody><tr><td><strong>京东会员页重构</strong></td><td>Copilot + Design‑to‑Code</td><td>代码生成率 45%，上线时间提前 2 周</td><td>Prompt 要精准；先跑 ESLint 再提交 PR</td></tr><tr><td><strong>金融风控前端</strong></td><td>AI 代码审查官 + Tabnine</td><td>安全漏洞 0，代码风格统一度 98%</td><td>将审查官接入 CI，GitHub PR 自动触发</td></tr><tr><td><strong>教育平台 SPA</strong></td><td>ChatGPT‑4 + 自动化测试生成</td><td>单元测试覆盖率提升 30%，手写测试时间降低 60%</td><td>先写业务需求，再让 AI 生成对应 Jest 测试</td></tr><tr><td><strong>企业内部仪表盘</strong></td><td>腾讯云 AI 设计转代码 + Copilot</td><td>UI 交付时间从 2 天缩至 4 小时，后端对接 0 Bug</td><td>设计稿保持统一命名规范，生成后立即跑 Storybook</td></tr><tr><td><strong>跨境电商微前端</strong></td><td>Tabnine Enterprise + Lighthouse AI</td><td>页面首屏渲染时间下降 15%，代码体积压缩 12%</td><td>将 Lighthouse AI 整合进 CI，PR 直接给出性能报告</td></tr></tbody></table>
<p><strong>经验金句</strong>（每个案例的核心要点）：</p>
<ol>
<li><strong>明确需求 → 细化 Prompt</strong>：把业务需求拆成“功能 + 输入 + 输出”三要素，Prompt 质量决定生成质量。</li>
<li><strong>人工 Review = 必须</strong>：AI 生成代码仅是“草稿”，必须经过 lint、单元测试以及业务验证。</li>
<li><strong>把 AI 融入流水线</strong>：在 CI 中加入 AI 生成的代码审查或性能报告，形成闭环。</li>
</ol>
<hr/>
<h2 data-id="heading-10">6️⃣ 风险 &amp; 合规提醒</h2>



































<table><thead><tr><th>风险</th><th>具体表现</th><th>防护措施</th></tr></thead><tbody><tr><td><strong>版权争议</strong></td><td>AI 可能引用公开代码片段，引发 GPL/Apache 兼容性问题。</td><td>使用 <strong>Enterprise</strong> 版（可自行托管模型）或在生成后运行 <strong>FOSS‑Check</strong>（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsonatype-nexus-community%2Ffossa-cli" target="_blank" title="https://github.com/sonatype-nexus-community/fossa-cli" ref="nofollow noopener noreferrer">github.com/sonatype-ne…</a>）。</td></tr><tr><td><strong>数据泄露</strong></td><td>将私有代码直接提交到公共模型（如 ChatGPT）可能泄露商业机密。</td><td>在企业内部部署 <strong>CodeGeeX</strong>、<strong>Tabnine Enterprise</strong> 或使用 OpenAI <strong>Enterprise</strong> 版的 Private Endpoint。</td></tr><tr><td><strong>模型偏差</strong></td><td>中文 Prompt 有时被误解，生成的代码可能不符合业务规范。</td><td>在 Prompt 前加“<strong>以下为中文需求</strong>”，并加入“<strong>请使用 ES6+、遵循 Airbnb 风格</strong>”。</td></tr><tr><td><strong>安全误判</strong></td><td>AI 修复建议可能误删业务代码。</td><td>将 AI 提交的 PR 标记为  <strong>“needs‑security‑review”</strong> ，由安全团队二次审查。</td></tr><tr><td><strong>合规审计</strong></td><td>监管部门要求代码生成来源可追溯。</td><td>在 <code>package.json</code> 中加入 <code>"generated‑by": "Copilot/2024‑12"</code>，并在 Git 提交信息中标注 <code>AI‑GEN:</code> 前缀。</td></tr></tbody></table>
<blockquote>
<p><strong>实用 Checklist（在项目根目录创建 <code>ai-checklist.md</code>）</strong></p>
<pre><code class="hljs language-css" lang="css">- <span class="hljs-selector-attr">[*]</span> Prompt 已经经过业务团队确认  
- <span class="hljs-selector-attr">[*]</span> 代码生成后跑一次 ESLint + Prettier  
- <span class="hljs-selector-attr">[*]</span> 通过单元/集成测试（覆盖率 ≥ <span class="hljs-number">80%</span>）  
- <span class="hljs-selector-attr">[*]</span> 安全审计（Snyk / AI 代码审查官）通过  
- <span class="hljs-selector-attr">[*]</span> 记录生成模型版本号与 API Key（放入 vault）  
</code></pre>
</blockquote>
<hr/>
<h2 data-id="heading-11">7️⃣ 2026 趋势展望——AI 前端工具的下一个“爆点”</h2>



































<table><thead><tr><th>趋势</th><th>解释</th><th>可能的行业影响</th></tr></thead><tbody><tr><td><strong>本地大模型部署</strong></td><td>LLaMA‑2、InternLM‑7B 等可在企业私有云上离线运行。</td><td>数据安全无死角，成本下降 30%‑50%。</td></tr><tr><td><strong>多模态设计‑代码同步</strong></td><td>同时处理 UI 设计、交互动画和代码生成（如 <strong>Adobe Firefly + CodeGeeX</strong>）。</td><td>前端交付时间压缩至 1/3，设计‑开发壁垒进一步消失。</td></tr><tr><td><strong>全栈低代码+AI</strong></td><td>代码生成覆盖前端、后端、数据库（如 <strong>Tencent Cloud Low‑Code AI</strong>）。</td><td>小团队可以在 2 周内完成完整业务系统。</td></tr><tr><td><strong>可解释性 AI</strong></td><td>生成代码时自动输出“为什么这么写”的自然语言解释。</td><td>加速新人上手、提升代码审查效率。</td></tr><tr><td><strong>行业合规标准</strong></td><td>2025 Q2 将发布《AI 生成代码合规指南》（国家信息化办公室草案）。</td><td>企业必须在 CI 中集成合规检测，违规成本将显著提升。</td></tr></tbody></table>
<blockquote>
<p><strong>建议</strong>：如果你的团队还在仅使用 <strong>Copilot</strong>，建议今年 Q4 开始评估 <strong>本地化 Tabnine</strong> 或 <strong>CodeGeeX</strong>，为 2026 的合规要求预留技术空间。</p>
</blockquote>
<hr/>
<h2 data-id="heading-12">8️结语</h2>
<ol>
<li>
<p><strong>挑一把合适的“刀”。</strong></p>
<ul>
<li>小团队 → Copilot + ChatGPT（云版）</li>
<li>大型企业 → Tabnine Enterprise + 本地 CodeGeeX</li>
</ul>
</li>
<li>
<p><strong>把 AI 当作“加速器”，而不是“全能救世主”。</strong></p>
<ul>
<li>Prompt 细化、人工 Review、自动化测试是必备环节。</li>
</ul>
</li>
</ol>
<blockquote>
<p><strong>祝福</strong>：愿大家在 2025 年继续“写代码更快、Bug 更少、AI 成为最靠谱的同事”。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从一则内存快照看iframe泄漏：活跃与Detached状态的回收差异]]></title>    <link>https://juejin.cn/post/7587632484427366451</link>    <guid>https://juejin.cn/post/7587632484427366451</guid>    <pubDate>2025-12-25T11:02:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587632484427366451" data-draft-id="7587428416129105958" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从一则内存快照看iframe泄漏：活跃与Detached状态的回收差异"/> <meta itemprop="keywords" content="前端,性能优化"/> <meta itemprop="datePublished" content="2025-12-25T11:02:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="eason_fan"/> <meta itemprop="url" content="https://juejin.cn/user/2995517308808877"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从一则内存快照看iframe泄漏：活跃与Detached状态的回收差异
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2995517308808877/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    eason_fan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T11:02:14.000Z" title="Thu Dec 25 2025 11:02:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">从一则内存快照看iframe泄漏：活跃与Detached状态的回收差异</h2>
<p>内存泄漏是前端性能优化中的隐蔽痛点。近期项目排查中，通过Chrome DevTools内存快照定位到典型iframe泄漏问题：iframe移除后内部window对象未释放，导致内存持续堆积。本文从该案例切入，拆解泄漏根源，深入剖析活跃iframe与Detached iframe的内存回收差异，最终给出可落地的解决方案。</p>
<h3 data-id="heading-1">一、案例还原：内存快照中的泄漏真相</h3>
<p>项目中存在一个“动态加载-移除iframe”的场景：点击按钮加载iframe展示内容，关闭弹窗时移除iframe。但随着操作次数增加，页面内存占用持续上升，最终导致页面卡顿。通过Chrome DevTools的Memory面板拍摄快照，发现了关键异常。</p>
<h4 data-id="heading-2">1. 快照核心发现：Detached Window的“顽固存在”</h4>
<p>快照中出现了多个<code>Detached Window</code>对象（保留大小均超过50kB），且每个对象都关联着<code>Detached HTMLDocument</code>、DOM元素（如、自定义组件）和未销毁的事件监听（resize、touchend等）。</p>
<p>这里的<code>Detached Window</code>，正是被移除后仍滞留在内存中的iframe内部window对象——它已脱离文档流，但内存未被释放，是本次泄漏的核心对象。</p>
<h4 data-id="heading-3">2. 泄漏引用链路：外部引用+内部闭环的“双重锁死”</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1e34a66718c47339e14816c4eb97e7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZWFzb25fZmFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767265334&amp;x-signature=WLAipI0HY7PMXc0%2F26NaVoo0ehE%3D" alt="image.png" loading="lazy"/>
通过快照的“保留器链”（Retainers）功能，梳理出完整的泄漏链路（注意：链路方向并非“外部→内部”，而是外部引用锚定内部对象后，内部闭环加固引用）：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d87d65347302498cb0820102b23b5444~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZWFzb25fZmFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767265334&amp;x-signature=vUIjkcLmAgfvq3X1L5g%2FmersNG4%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Detached</span> <span class="hljs-title class_">Window</span>（iframe内部<span class="hljs-variable language_">window</span>）
↓ 被外部引用链锚定
global_proxy_object（iframe <span class="hljs-variable language_">window</span>的全局代理对象）
↓ 浏览器内置<span class="hljs-title class_">Symbol</span>属性（如<span class="hljs-title class_">Symbol</span>(unscopables)）关联
<span class="hljs-title class_">Detached</span> <span class="hljs-title class_">HTMLDocument</span>（iframe的<span class="hljs-variable language_">document</span>）
↓ 关联iframe内部<span class="hljs-variable constant_">DOM</span>元素
↓ 元素绑定未销毁的事件监听（形成闭包）
↓ 最终锁死整个对象链
</code></pre>
<p>核心逻辑：外部代码通过全局代理对象锚定Detached Window，而其内部文档、DOM、事件形成闭环，导致垃圾回收器（GC）无法回收任一关联对象，最终造成泄漏。</p>
<h4 data-id="heading-4">3. 泄漏核心原因：外部引用未断+内部资源未清</h4>
<p>结合代码排查，定位两个关键问题：</p>
<ul>
<li>外部引用未清空：父页面通过<code>const iframeWin = iframe.contentWindow</code>保存iframe内部window引用，移除iframe时未置空该变量；</li>
<li>内部资源未清理：iframe内部通过<code>addEventListener</code>绑定的resize、touchend等事件，移除前未通过<code>removeEventListener</code>销毁，形成闭包引用。</li>
</ul>
<h3 data-id="heading-5">二、深入理解：从反直觉疑问切入，解析两种iframe的回收差异</h3>
<p>排查过程中易产生反直觉疑问：<strong>若不清理外部引用，仅斩断Detached Window内部引用链（如断开window与文档、事件的关联），被斩断的内部资源会被回收吗？</strong></p>
<p>答案是否定的：只要外部对Detached Window的引用未断，即便内部引用链被拆碎，所有内部资源仍会被“锁死”在内存中。这一结论的核心是活跃iframe与Detached iframe的执行上下文本质不同，可用通俗类比理解：</p>
<p>• 活跃iframe = 有人居住的正常房子：内部杂物（对象）无人使用（无引用）时，会被主人（内部GC）主动清理； • Detached iframe = 被外部绳子拴住的孤立房子：即便拆碎内部杂物（斩断内部引用链），只要绳子未断（外部引用未清），房子及内部所有物品均不会被清运（GC回收）——绳子证明“该资源仍被关联”。</p>
<h4 data-id="heading-6">1. 先明确前提：现代浏览器GC的“可达性分析”核心规则</h4>
<p>这一反直觉结论的根源，是现代浏览器（Chrome、Node.js等）GC核心为“可达性分析”，而非老旧的“引用计数”，核心逻辑可概括为：</p>
<ul>
<li>从根对象（父页面window、全局变量、活跃函数调用栈等）出发，可触达的对象标记为“存活”，不会被回收；</li>
<li>完全无法从根对象触达的对象，无论内部是否有闭环，均标记为“死亡”并回收。</li>
</ul>
<p>核心结论：GC判断“是否回收”的唯一标准是“是否被根对象触达”，而非“内部是否有引用”。这是区分两种iframe回收差异的核心依据。</p>
<h4 data-id="heading-7">2. 活跃iframe：内部GC正常工作，无引用对象会被回收</h4>
<p>活跃iframe指“仍存在于文档流中（未被remove）”的iframe，其window是浏览器认可的“有效执行上下文”——类比“有人居住的正常房子”，内部会独立运行GC线程（主人），主动清理无用杂物（无引用对象）。</p>
<p>即便父页面通过<code>iframe.contentWindow</code>保留引用（类比外部拴绳），也不影响内部GC工作：绳子仅代表“外部关注”，不干扰主人清理内部无用物品。</p>
<p>实例验证：在活跃iframe内部创建100M大对象，断开引用后触发GC，内存会正常回收：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 活跃iframe内部代码</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createBigObj</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 创建100M大对象</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">100</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);
}

<span class="hljs-keyword">let</span> bigObj = <span class="hljs-title function_">createBigObj</span>(); <span class="hljs-comment">// 内存占用上升</span>
bigObj = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 断开引用</span>
<span class="hljs-comment">// 触发GC后，100M内存被回收，内存占用下降</span>
</code></pre>
<p>核心原因：活跃iframe的内部GC线程独立运行，只要内部对象无存活引用，无论父页面是否保留iframe引用，均会被主动回收，内存不会无限堆积。</p>
<h4 data-id="heading-8">3. Detached iframe：内部GC停止，再零散的资源也不会回收</h4>
<p>Detached iframe指“已被remove（脱离文档流）但父页面仍保留其window引用”的iframe——类比“被外部绳子拴住的孤立房子”，此时会发生两个关键变化：</p>
<ul>
<li>内部GC线程停止：浏览器判定其为“废弃上下文”，不再执行内部资源清理；</li>
<li>外部引用锚定存活：父页面的引用（绳子）让Detached Window被根对象触达，GC判定“该对象链仍在被关联”。</li>
</ul>
<p>即便斩断内部引用链（拆碎杂物），只要外部绳子未断，这些零散资源仍会被标记为“存活”——因它们属于“根可达对象关联的资源”，GC会一并保留。</p>
<p>实例验证：移除iframe后保留外部引用，再断开内部大对象引用：</p>
<pre><code class="hljs language-ini" lang="ini">// 父页面代码
const <span class="hljs-attr">iframe</span> = document.createElement(<span class="hljs-string">'iframe'</span>)<span class="hljs-comment">;</span>
document.body.appendChild(iframe)<span class="hljs-comment">;</span>
const <span class="hljs-attr">iframeWin</span> = iframe.contentWindow<span class="hljs-comment">; // 保留外部引用</span>
iframe.remove()<span class="hljs-comment">; // iframe变为Detached状态</span>

// Detached iframe内部代码
let <span class="hljs-attr">bigObj</span> = createBigObj()<span class="hljs-comment">; // 内存占用上升</span>
<span class="hljs-attr">bigObj</span> = null<span class="hljs-comment">; // 断开内部引用</span>
// 触发GC后，100M内存仍未回收，内存持续占用
</code></pre>
<p>结果：100M内存仍未回收。核心原因：Detached Window被外部引用锚定，其内部所有资源均被连带标记为“存活”，直至外部引用断开（剪断绳子）。</p>
<p>最终表现：Detached iframe的内存只会持续堆积，直至页面刷新，具体包括：</p>
<h4 data-id="heading-9">4. 两种状态核心差异对比（结合类比）</h4>






























<table><thead><tr><th>对比维度</th><th>活跃iframe（未移除）</th><th>Detached iframe（已移除+外部引用未断）</th></tr></thead><tbody><tr><td>执行上下文</td><td>有效，内部GC正常运行</td><td>僵尸状态，内部GC停止</td></tr><tr><td>内存回收规则</td><td>无引用对象正常回收，内存有增有减</td><td>所有内部对象均无法回收，内存只增不减</td></tr><tr><td>根可达性</td><td>可触达，但内部GC独立工作</td><td>可触达，且全局GC无法回收</td></tr><tr><td>常见场景</td><td>页面固定iframe、动态加载未关闭的iframe</td><td>动态移除但未清外部引用的iframe</td></tr></tbody></table>
<h3 data-id="heading-10">三、解决方案：从根源避免iframe内存泄漏</h3>
<p>结合前文分析，iframe泄漏的核心是“Detached Window被外部引用锚定+内部资源未清理”。解决方案核心为“断开外部引用+清理内部资源”，具体分两步实施：</p>
<h4 data-id="heading-11">1. 必要操作：断开父页面对iframe的所有外部引用</h4>
<p>这是回收Detached Window的唯一必要条件：只要断开外部引用，即便内部存在少量未清理闭环，全局GC也会将其识别为“不可触达孤立链”并回收。</p>
<p>具体代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 父页面：移除iframe的完整流程</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">removeIframe</span>(<span class="hljs-params">iframe</span>) {
  <span class="hljs-comment">// 1. 拿到iframe内部window（若之前保存过）</span>
  <span class="hljs-keyword">const</span> iframeWin = iframe.<span class="hljs-property">contentWindow</span>;
  
  <span class="hljs-comment">// 2. 断开父页面所有相关引用（关键步骤）</span>
  iframeWin = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 清空保存的window引用</span>
  iframe = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 清空iframe元素引用</span>
  
  <span class="hljs-comment">// 3. 移除iframe元素</span>
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(iframe);
}

<span class="hljs-comment">// 触发GC（可选，可通过DevTools手动触发）</span>
performance.<span class="hljs-property">memory</span>;
</code></pre>
<h4 data-id="heading-12">2. 可选但推荐：清理iframe内部资源</h4>
<p>清理内部资源是保险项，可避免因外部引用未清干净导致的二次泄漏。核心清理范围包括：事件监听、定时器、全局变量、闭包引用等。</p>
<p>推荐实现方式：iframe内部暴露清理方法，由父页面在移除前调用，具体代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// iframe内部代码：暴露清理方法</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">cleanup</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 1. 移除事件监听</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'resize'</span>, handleResize);
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'touchend'</span>, handleTouchEnd);
  
  <span class="hljs-comment">// 2. 清除定时器/计时器</span>
  <span class="hljs-built_in">clearInterval</span>(timer);
  <span class="hljs-built_in">clearTimeout</span>(timeout);
  
  <span class="hljs-comment">// 3. 清空全局变量/闭包引用</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">globalData</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">bigObj</span> = <span class="hljs-literal">null</span>;
  
  <span class="hljs-comment">// 4. 清理自定义组件/框架资源（如Vue/React实例）</span>
  <span class="hljs-keyword">if</span> (app) {
    app.<span class="hljs-title function_">unmount</span>(); <span class="hljs-comment">// Vue实例卸载</span>
  }
};

<span class="hljs-comment">// 父页面：移除前调用内部清理方法</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">removeIframe</span>(<span class="hljs-params">iframe</span>) {
  <span class="hljs-keyword">const</span> iframeWin = iframe.<span class="hljs-property">contentWindow</span>;
  <span class="hljs-comment">// 调用内部清理方法</span>
  <span class="hljs-keyword">if</span> (iframeWin.<span class="hljs-property">cleanup</span>) {
    iframeWin.<span class="hljs-title function_">cleanup</span>();
  }
  
  <span class="hljs-comment">// 后续步骤：断开外部引用、移除元素（同前）</span>
  iframeWin = <span class="hljs-literal">null</span>;
  iframe = <span class="hljs-literal">null</span>;
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(iframe);
}
</code></pre>
<h4 data-id="heading-13">3. 验证方法：确认泄漏已解决</h4>
<p>可通过Chrome DevTools验证泄漏是否解决，步骤如下：</p>
<ol>
<li>加载并多次移除iframe；</li>
<li>拍摄内存快照，搜索<code>Detached Window</code>；</li>
<li>若快照中无<code>Detached Window</code>，且内存占用稳定（多次操作后无明显上升），则说明泄漏已解决。</li>
</ol>
<h3 data-id="heading-14">四、总结</h3>
<p>本次iframe内存泄漏案例，本质是对“Detached Window根可达性”及“iframe不同状态回收规则”理解不足。核心结论可浓缩为三点：</p>
<ul>
<li>现代浏览器GC只看“根可达性”，不看引用计数；</li>
<li>活跃iframe的内部GC正常工作，内存不会无限增加；</li>
<li>Detached iframe泄漏的唯一必要条件是“外部引用未断”，解决核心是“断开外部引用+清理内部资源”。</li>
</ul>
<p>实际开发中，只需遵循“动态移除iframe必清外部引用”原则，并配合内部资源清理，即可从根源避免这类泄漏。希望本文能帮助开发者清晰理解iframe内存机制，为前端性能优化提供有效指引。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[国产AI编程IDE的Plan模式，对比Cursor差别在哪？]]></title>    <link>https://juejin.cn/post/7587596841874276386</link>    <guid>https://juejin.cn/post/7587596841874276386</guid>    <pubDate>2025-12-25T09:08:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587596841874276386" data-draft-id="7587473691169406976" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="国产AI编程IDE的Plan模式，对比Cursor差别在哪？"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2025-12-25T09:08:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="陈佬昔编程人生"/> <meta itemprop="url" content="https://juejin.cn/user/3087084378402445"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            国产AI编程IDE的Plan模式，对比Cursor差别在哪？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3087084378402445/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    陈佬昔编程人生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T09:08:31.000Z" title="Thu Dec 25 2025 09:08:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>为了应对更复杂的需求开发场景，目前不少 AI 编程 IDE 都推出了 Plan 模式。希望借此模式实现自动分解任务、规划开发步骤，并生成代码框架，减轻开发者的负担。</p>
<p>除阿里的 Qoder Quest 收费外，腾讯的 CodeBuddy、字节跳动的 Trae、百度的 Comate 的免费版都具备此功能。Cursor 则在10月的 2.0 版本就已推出，相对成熟。本文将对这几款工具的 Plan 模式与 Cursor 进行一次对比。</p>
<p>这次的测试中，使用了以下的提示词来评估各工具的规划能力：</p>
<pre><code class="hljs">开发一个完整的HR管理后台系统，包含员工信息管理、考勤记录、薪资计算、绩效评估和招聘管理模块。
系统需要实现用户权限分级（管理员、HR专员、普通员工）、数据可视化报表生成、以及Excel导入导出功能。
界面设计要简洁现代，确保响应式布局适配不同设备。
提供完整的API文档和单元测试覆盖。
</code></pre>
<h2 data-id="heading-0">测试结果概览</h2>
<p>首先直接说结论：<strong>所有工具的 Plan 模式均未能自动完成整个项目</strong>，均需大量后续手动调试和修复。</p>
<ul>
<li><strong>Trae</strong>：需进入 SOLO 界面启动 Plan 模式，借助其调试能力边开发边调试，完成度最高。但最终生成的系统仍需逐个页面修复 Bug。</li>
<li><strong>Comate</strong>： 相比三个月前测试进步明显，能生成出前端界面，但功能无法操作，同样需要逐一修复问题。</li>
<li><strong>CodeBuddy</strong>：生成的代码 TypeScript 报错极多，修复过程如同“打地鼠”，消灭一个，增加几个，最终不得不放弃。</li>
<li><strong>Cursor</strong>：因要求配置数据库（未提供示例），对不熟悉后端的用户形成了门槛，最终被迫中止。</li>
</ul>
<p><strong>耗时方面</strong>：Trae SOLO 最长（3小时+），CodeBuddy 平均1小时多，Comate 不到1小时，Cursor 仅用15分钟便“完成”了规划（但无法运行）。</p>
<h2 data-id="heading-1">计划文档与任务执行</h2>
<p>在生成的计划文档方面，<strong>CodeBuddy</strong> 表现最为出色。</p>
<p>其2025年12月21日的新版本提供的计划内容非常丰富，涵盖了前端界面、后端数据、设计配色和整体架构。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9dcc61559234a78aec4a42e963af54f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZmI5L2s5piU57yW56iL5Lq655Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767258511&amp;x-signature=lLQ3TN%2FOutjgoRSq95le8nFRzd8%3D" alt="" loading="lazy"/></p>
<p>其次是 <strong>Cursor</strong> 和 <strong>Trae</strong>，它们的计划包含了数据设计，但相比 CodeBuddy 缺少了 UI 配色设计和流程图等细节。<strong>Comate</strong> 的计划则相对简单，主要列出了项目文件结构和开发步骤。</p>
<p>此外，Trae 修正了早期版本中“开发周期需1-2周”这类明显不符合 AI 开发节奏的描述。</p>
<p>将计划转化为可执行任务又是另一回事。除了 <strong>Cursor</strong> 能严格按计划生成任务外，其他工具或多或少会对任务进行调整。在计划与任务的一致性上，Cursor 更强。</p>
<p>在交互细节上，Cursor 也优势明显。它在任务开始前设有“需求澄清”和“技术方案选择”环节，用户可通过鼠标或键盘进行确认。而其他 IDE 通常需要用户手动输入指令。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4d60ca6ef6445c5999c7e5d466c977b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZmI5L2s5piU57yW56iL5Lq655Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767258511&amp;x-signature=sP68fpgsaLls8lCbxYz7z2jNPRU%3D" alt="Plan 模式-cursor确认细节.png" loading="lazy"/></p>
<p>CodeBuddy 也有一些亮点，其新版本允许用户自定义任务执行顺序，比旧版本更灵活，任务中断后恢复也更方便。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0f8976524b84d8a8c9bb392b7dcd4d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZmI5L2s5piU57yW56iL5Lq655Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767258511&amp;x-signature=cBeZZQ7%2FMvDXn3oGGTFF5SKdzns%3D" alt="" loading="lazy"/></p>
<p><strong>总体来看</strong>：Cursor 在交互细节、文档交付及任务执行一致性上更胜一筹；CodeBuddy 在交互和文档方面有亮点；Trae 和 Comate 则更偏向传统的“程序员工具”，在细节处理上还需优化。</p>
<h2 data-id="heading-2">后端代码评分</h2>
<p>由于最终都未能顺利得到可运行的系统，我们转而评估各工具生成的后端代码质量。</p>
<p>作为前端开发者，我使用 Cursor 的 AI 根据以下标准为这些代码打分：</p>
<ol>
<li>架构设计 (20分)：模块化设计、分层架构、依赖注入、可扩展性各5分</li>
<li>代码质量 (20分)：代码规范、类型安全、代码复用 、代码注释  各5分</li>
<li>安全性 (20分)：身份认证、权限控制、数据验证 、安全配置各5分</li>
<li>数据库设计 (15分)：实体设计、迁移管理、查询优化各5分</li>
<li>错误处理 (10分)：异常处理和错误提示各5分</li>
<li>测试覆盖 (10分)：单元测试和集成测试各5分</li>
<li>文档和工具 (5分)：API文档3分、开发工具2分</li>
</ol>
<p><strong>各工具后端代码评分结果如下：</strong></p>




































































<table><thead><tr><th>打分项目</th><th>Codebuddy</th><th>Comate</th><th>Trae</th><th>Cursor</th></tr></thead><tbody><tr><td>架构设计20</td><td>17</td><td>10</td><td>10</td><td>17</td></tr><tr><td>代码质量20</td><td>16</td><td>10</td><td>13</td><td>15</td></tr><tr><td>安全性20</td><td>16</td><td>12</td><td>12</td><td>16</td></tr><tr><td>数据库设计15</td><td>12</td><td>8</td><td>11</td><td>12</td></tr><tr><td>错误处理10</td><td>6</td><td>4</td><td>4</td><td>6</td></tr><tr><td>测试覆盖10</td><td>0</td><td>0</td><td>3</td><td>2</td></tr><tr><td>文档和工具5</td><td>4</td><td>1</td><td>4</td><td>4</td></tr><tr><td>总计 100</td><td>71</td><td>45</td><td>57</td><td>72</td></tr></tbody></table>
<p>Codebuddy 代码基于 GLM 4.6 生成，其他 IDE 使用 Auto，大概率是自研的模型</p>
<p>根据评分，各 IDE 生成代码的主要问题归纳如下：</p>
<p><strong>CodeBuddy</strong> 在架构和代码质量上表现较好，但存在测试缺失、安全配置不足和文档不完善的问题，具体包括缺少单元测试和集成测试、全局异常处理、数据库索引、请求限流等安全配置，以及关键业务代码的注释。</p>
<p><strong>Comate</strong> 的问题较为全面，涉及架构、安全、测试和工具链等多个层面。其代码缺少数据输入验证；缺少Service 层，导致 Controller 臃肿；未使用 TypeScript，类型安全无法保证；同时缺少依赖注入、数据库迁移管理、全局错误处理机制、数据库索引、单元测试和集成测试，以及 Swagger API 文档。</p>
<p><strong>Trae</strong> 的问题主要集中在架构分层、安全实践和类型安全上。代码缺少 Service 层和数据验证库，也缺少全局错误处理中间件和依赖注入框架。在安全方面，JWT 密钥使用了默认值，且 CORS 配置有待优化。此外，在 TypeScript 中使用了 <code>any</code> 类型，并且缺少数据库迁移管理。</p>
<p><strong>Cursor</strong> 的代码在整体架构上较为完整，但在细节完善度和工程化实践上仍有提升空间。具体问题包括：缺少单元测试和集成测试；缺少全局异常过滤器和统一的错误响应格式；JWT 密钥使用了默认值；TypeScript 未启用严格模式，存在较多 <code>any</code> 类型；缺少数据库索引以及对复杂业务逻辑的注释。</p>
<p><strong>需要说明的是</strong>：此评分仅基于代码静态分析，仅供参考。例如 CodeBuddy 评分虽高，但实际运行时 TypeScript 报错极多，修复成本很高。同时，大模型迭代迅速，本文结论基于2025年12月底的测试，未来情况可能发生变化。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026年AI技能将迎来爆发]]></title>    <link>https://juejin.cn/post/7587468062210424868</link>    <guid>https://juejin.cn/post/7587468062210424868</guid>    <pubDate>2025-12-25T09:17:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587468062210424868" data-draft-id="7587606718843453481" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026年AI技能将迎来爆发"/> <meta itemprop="keywords" content="OpenAI,AIGC"/> <meta itemprop="datePublished" content="2025-12-25T09:17:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="安思派Anspire"/> <meta itemprop="url" content="https://juejin.cn/user/3044964115417419"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026年AI技能将迎来爆发
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3044964115417419/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    安思派Anspire
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T09:17:44.000Z" title="Thu Dec 25 2025 09:17:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>上个月，我看到一名初级分析师的晋升超过了一名资深数据科学家。</p>
<p>不是因为她更懂Python，也不是因为她有更光鲜的学位。她得到晋升是因为她能在两分钟内解释清楚机器学习模型对销售团队的实际意义。那位数据科学家呢？他花了40分钟谈论梯度下降，结果头五分钟就把听众讲懵了。</p>
<p>按回车键或点击以查看全尺寸图像</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44c380c8834548778c282f0f1203e913~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a6J5oCd5rS-QW5zcGlyZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767259063&amp;x-signature=rWrycOvElKnEo%2BRhdJXCtZQOX5M%3D" alt="" loading="lazy"/></p>
<p>照片由<a href="https://link.juejin.cn?target=https%3A%2F%2Funsplash.com%2F%40anniespratt%3Futm_source%3Dmedium%26utm_medium%3Dreferral" target="_blank" title="https://unsplash.com/@anniespratt?utm_source=medium&amp;utm_medium=referral" ref="nofollow noopener noreferrer">安妮·斯普拉特</a>在Unsplash上拍摄</p>
<p>那一刻让我多年来一直注意到的事情变得清晰起来。每个人都在争先恐后地在简历中加上 “AI”，但真正赚钱的人并不是那些追逐每一个新框架的人。而是那些弄清楚企业真正需求的人。</p>
<p>企业目前需要的不是更多的AI，而是能够让AI发挥作用的人。</p>
<h2 data-id="heading-0">2025年的AI淘金热（以及为何大多数人都在错误的地方挖掘）</h2>
<p>让我给你讲讲Dev。聪明的孩子，刚毕业，花了六个月时间构建用于图像识别的神经网络。作品集令人印象深刻。能跟你滔滔不绝地讲变压器架构和注意力机制。</p>
<p>他申请了47份工作，获得3次面试机会，零份录用通知。</p>
<p>与此同时，他的室友普里亚选择了不同的道路。她学习了 SQL，掌握了一些基础 Python 知识，并且非常擅长就数据提出恰当的问题。她在一家中型金融科技公司获得了商业智能分析师的职位。起薪是多少？78000 美元。六个月后呢？在证明自己能够将杂乱的数据转化为为公司节省真金白银的决策后，薪资涨到了 92000 美元。</p>
<p>差别在哪里？Dev试图在一个工具每三个月就更新一次的领域成为专家，而Priya则通过解决实际问题变得不可或缺。</p>
<p>当你初出茅庐时，没人会告诉你这些。最炫酷的技能往往并非最有价值的技能。当下，人人都想成为构建AI的那个人。几乎没人愿意成为确保AI真正为企业发挥作用的那个人。而这个差距？这就是财富隐藏的地方。</p>
<p>根据2024年高德纳（Gartner）的一份报告，85%的AI项目未能实现其承诺的价值。不是因为模型不好，而是因为没有人费心将它们与实际业务成果联系起来。企业被“AI驱动”的解决方案淹没，却没人知道如何使用、衡量或信任这些方案。</p>
<p>这创造了一个引人入胜的机会。当大家都在争论谁更了解TensorFlow时，有三个特定的角色已悄然成为房间里最有价值的人。而薪资数据以一种会让如今刚开始职业生涯的大多数人感到惊讶的方式证实了这一点。</p>
<h2 data-id="heading-1">角色 #1：分析工程师（让数据真正可用的人）</h2>
<p>分析工程师没有得到足够的关注，说实话，这对他们有利。当数据科学家们在领英上忙着谈论他们最近参加的Kaggle竞赛时，分析工程师们却在确保数据真正流向需要的地方。</p>
<p>我见过分析工程师在二线城市的薪资为11万至16万美元，在主要科技中心城市为14万至19万美元。这与资深数据科学家的薪资相当，但热度和竞争程度要低得多。</p>
<p>这就是他们为何能成功的原因。过去两年匆忙投身AI的每一家公司如今都面临着一个巨大的问题。他们的数据一团糟。数据表之间无法相互关联。没人知道“收入”的哪个版本才是正确的。营销团队对它的叫法与财务团队不同，而数据仓库里有七种不同的定义。</p>
<p>这就轮到分析工程师登场了。他们构建起让数据值得信赖的基础设施。他们创建模型和转换方法，将原始数据转化为分析师真正能用得上的东西。他们是构建数据管道的人和需要依据数据做决策的人之间的桥梁。</p>
<p><strong>如果你深入理解 SQL（不仅仅是基本查询，还包括窗口函数、公共表表达式、优化和性能调优），那么你已经完成了 60%。另外 40% 呢？学习像 DBT 这样的工具，理解数据建模原则，并掌握足够的 Python 来实现自动化操作。</strong></p>
<p>最棒的是什么？你不需要有博士学位。你不需要懂高等微积分。你需要真正擅长思考数据应如何构建和转换。你需要关心数据质量、文档记录等事情，以及让下游分析师的工作更轻松。</p>
<p>**<a href="https://link.juejin.cn?target=https%3A%2F%2Fanalystuttam.gumroad.com%2Fl%2Ftop-50-sql-quries-for-interview" target="_blank" title="https://analystuttam.gumroad.com/l/top-50-sql-quries-for-interview" ref="nofollow noopener noreferrer">想掌握分析工程师每天都依赖的 SQL 基础知识吗？</a>**从重要的基础开始。《数据分析师的前 50 道 SQL 面试问题》将为你提供区分普通分析师和获得晋升的分析师的精确模式和技巧。</p>
<p>我认识一个人，他在大约14个月内从Excel分析师成功转型为分析工程师。她痴迷于钻研SQL，学习了DBT，并开始像工作全靠它一样记录自己构建的所有东西（因为确实如此）。现在她的年薪达到13.5万美元，各公司都在积极招募她，因为优秀的分析工程师真的很难找。</p>
<p>需求只会不断上升。随着越来越多的公司意识到由于糟糕的数据基础，他们的AI投资正在失败，他们正疯狂地招聘分析工程师。但他们寻找的是既懂技术又懂业务的人。你需要知道何时对表进行非规范化处理，何时这样做是个糟糕的主意。你需要理解为什么数据质量很重要，以及如何实际衡量它。</p>
<h2 data-id="heading-2">角色2：机器学习运维工程师（让AI在生产环境中真正发挥作用的人）</h2>
<p>这个职位在五年前其实并不存在。如今，它已成为科技领域最热门的职位之一，薪资水平也反映了这一点。MLOps工程师的年薪在12万至17.5万美元之间，具体取决于工作地点和工作经验。大型科技公司的高级MLOps工程师呢？年薪在18万至24万美元之间，有时甚至更高。</p>
<p>关于机器学习，那些华而不实的在线课程里没人告诉你的是，在Jupyter笔记本中构建模型是容易的部分。让它在生产环境中可靠运行、监测其是否发生偏移、在不破坏一切的情况下更新它，以及确保它能够扩展？这才是大多数公司完全崩溃的地方。</p>
<p>我见过一家公司花费40万美元构建一个推荐引擎。模型很漂亮，准确率也令人印象深刻。构建这个引擎花了八个月时间。当他们试图部署它时，生成一条推荐需要14秒。而他们的应用程序需要在200毫秒内给出结果。这个模型闲置了六个月，直到一位MLOps工程师介入，彻底重写了它的部署方式。</p>
<p>这就是MLOps工程师的工作。他们身处“炫酷模型”和“真正能大规模运行的东西”之间的复杂领域。他们会设置监控系统，以便你能知道模型何时开始给出奇怪的预测。他们构建能自动重新训练模型的流水线。他们确保当数据科学家更新模型时，不会破坏生产环境中的47个不同环节。</p>
<p>这里的技能组合很有意思，因为它是真正的混合式技能。你需要有足够的机器学习知识，才能理解数据科学家在做什么，以及他们的模型为何可能在生产环境中失败。但你也需要扎实的软件工程技能、使用云平台（AWS、GCP、Azure）的经验、容器化（Docker、Kubernetes）的经验，以及对如何构建可靠系统的深入理解。</p>
<p>这可不是刚从训练营出来的人就能胜任的角色。大多数MLOps工程师要么来自DevOps背景并学习ML，要么来自数据科学背景并学习生产工程。理想人选是谁呢？是那些体会过双方痛点并学会说两种“语言”的人。</p>
<p>目前这个角色之所以如此宝贵，原因很简单，就是稀缺。试图将ML模型投入生产的公司数量远远超过了懂得如何做好这件事的人数。而且由于这个角色很新，很多公司直到AI项目开始失败才意识到自己需要它。</p>
<p>如果你是一名想要提升水平的数据分析师，这是一条有趣的路径。开始学习模型部署，掌握 Docker 和基础云平台，了解 API 的工作原理，并学习足够的 Python 来实现工作流程自动化。你不需要成为机器学习专家，你需要成为让专业机器学习真正可用的人。</p>
<h2 data-id="heading-3">角色3：AI产品分析师（负责判断AI是否真的重要的人）</h2>
<p>这是过去18个月里最让我惊讶的职位。AI产品分析师相对较新，但公司愿意为能胜任这一工作的人支付9.5万至15.5万美元的薪酬。资深的呢？14万至19万美元，尤其是在大力投资AI产品的公司。</p>
<p>以下是他们实际所做的事情。当一家公司开发出一项AI功能时，需要有人来确定它是否真的有帮助。不是问“模型的准确率高吗？”，而是问“用户真的在使用它吗？它能提高用户留存率吗？它能推动营收增长吗？运行它的成本值得吗？”</p>
<p>大多数数据分析师知道如何衡量产品指标。大多数数据科学家知道如何构建模型。AI产品分析师则处于两者之间，将这两个领域联系起来。他们设计实验来测试AI功能。他们构建的仪表盘不仅展示模型性能，还展示业务影响。他们帮助产品经理理解“83%的准确率”对用户体验究竟意味着什么。</p>
<p>我认识一个人，她从传统产品分析领域实现了转型。她在一家SaaS公司工作时，公司开始添加AI功能。数据科学团队会推出功能，并根据模型指标宣告成功。产品团队却不知道这些功能是否真的对用户有帮助，还是只是增加了复杂性。</p>
<p>她开始缩小这一差距。她会参加ML团队会议，并将他们正在开发的内容转化为可测试的假设。她会设计A/B测试，不仅衡量AI是否有效，还衡量它是否让产品变得更好。不到一年，她就变得不可或缺。现在，她的年薪达到14.5万美元，每周都会拒绝招聘人员的消息。</p>
<p>这个岗位的美妙之处在于，你不需要深厚的ML专业知识。你只需有足够的理解能力，能够提出明智的问题。你需要具备强大的分析能力（SQL、Python、统计学）。你需要知道如何设计实验并严谨地衡量事物。而且你需要能够向非技术人员清晰地阐述复杂的权衡取舍。</p>
<p>**<a href="https://link.juejin.cn?target=https%3A%2F%2Fanalystuttam.gumroad.com%2Fl%2F15-chatgpt-prompts-for-data-analyst" target="_blank" title="https://analystuttam.gumroad.com/l/15-chatgpt-prompts-for-data-analyst" ref="nofollow noopener noreferrer">这就是像ChatGPT这样的工具成为力量倍增器的地方</a>****。**合适的提示可以帮助你更快地分析实验结果，起草更好的假设，并更清晰地传达研究结果。严肃的分析师正在使用AI来增强自己的技能，而不是取代它们。</p>
<p>这个角色的价值在于视角。企业迫切想知道他们在AI上的投资是否有回报。他们需要有人能审视一个新奇的新模型，并提出令人不安的问题。它真的能解决用户问题吗？运行成本是多少？如果它出错了会怎样？用户甚至注意到它了吗？</p>
<p>Z世代分析师在这方面有一个独特的优势。你们是伴随着AI产品长大的。你们本能地知道AI何时有用，何时又像恼人的自动化程序。这种用户直觉，再加上扎实的分析能力，让你们在各方面都极具竞争力。</p>
<h2 data-id="heading-4">为何这三个角色正处于优势地位（以及这对你的职业意味着什么）</h2>
<p>注意到规律了吗？这些角色都不是关于构建最华丽的模型或掌握最前沿的技术。它们都围绕着让AI在现实世界中真正发挥作用。</p>
<p>分析工程师确保数据值得信赖。MLOps工程师确保模型可靠运行。AI产品分析师确保整个项目对业务真正有意义。</p>
<p>企业终于明白，AI炒作并不能解决实际问题。真正能解决问题的是实用的AI、可扩展的AI以及能解决实际问题的AI。那些能够实现这些的人，突然比那些仅仅对神经网络了解很多的人更有价值。</p>
<p>我从事分析工作的时间够长了，足以见证这些周期的重复。还记得曾经人人都得成为“数据科学家”，都得懂深度学习吗？结果大部分这类工作不过是美化版的Excel操作。接着人人又都得懂Spark和大数据？实际上大多数公司根本就不需要。</p>
<p>目前，每个人都认为自己需要了解大语言模型（LLMs）和生成式AI。有些人确实需要。但更多的人需要知道如何确保数据可靠、部署有效的模型，以及衡量AI功能是否真正有用。</p>
<p>薪资竞争中获胜的并非是技术能力最强的人，而是那些能够将技术能力与商业价值联系起来的人。目前，这三个角色就是最好的例证。</p>
<h2 data-id="heading-5">学习这些技能的复杂真相</h2>
<p>如果你选择其中一条职业道路，你的职业生涯实际上会是这样的。它不会一帆风顺。你不会在18个月内从“初级分析师”直线晋升到“高级XX”。</p>
<p>你会花上几个月的时间，觉得自己很笨，因为周围的每个人似乎都懂你不懂的东西。你构建的东西会以尴尬的方式失败。你提交的分析结果会被证明完全错误，因为你误解了数据的收集方式。</p>
<p>我仍记得有一次向高管们做分析汇报，当时我自信满满地说营收下降了23%。结果发现我错误地合并了两个表格，还重复计算了退货。实际上营收增长了8%。那次会议简直是煎熬。但在那一刻，我对数据验证的了解比六个月的课程学习还要多。</p>
<p>通往这些高薪岗位的道路布满了错误。你会写出本应在2秒内运行完毕却需要20分钟才能运行的SQL查询。你会部署一个在测试中表现出色但在生产环境中却完全失败的模型。你会设计一个看似绝妙的实验，直到有人指出你遗漏的明显混淆变量。</p>
<p>这很正常。这就是每个人学习的方式。成功的人和放弃的人之间的区别不在于天赋。而在于你是否能忍受未知的不适，寻求帮助，并在事情失败时仍坚持继续努力。</p>
<p>**<a href="https://link.juejin.cn?target=https%3A%2F%2Fanalystuttam.gumroad.com%2Fl%2Fpower-bi-dax-queries-for-data-professionals" target="_blank" title="https://analystuttam.gumroad.com/l/power-bi-dax-queries-for-data-professionals" ref="nofollow noopener noreferrer">当你陷入困境时，拥有合适的工具至关重要</a>****。**无论是掌握 SQL 模式、学会有效地向 AI 提问，还是在 Power BI 中构建更好的仪表盘，苦苦挣扎数周与在数天内取得突破之间的差别，往往就在于能否在正确的时间拥有正确的资源。</p>
<p>从小处着手。选择这三条路径中的一条，深入钻研基础知识。如果你对分析工程感兴趣，那就花三个月时间真正掌握 SQL。不是那种“我会写 SELECT 语句”的水平，而是“我能把一个运行 10 分钟的查询优化到 30 秒”的水平。学习索引、执行计划，以及为什么子查询会影响性能。</p>
<p>如果MLOps吸引你，那就深入学习一个云平台。不要试图同时学习AWS、GCP和Azure。选择一个，在上面构建实际项目，部署应用，遇到问题，解决问题。通过将一个简单的应用容器化并处理所有出现的烦人错误来学习Docker。</p>
<p>如果AI产品分析让你感兴趣，那就痴迷于实验设计。阅读关于A/B测试的论文。理解统计功效及其重要性。学会识别糟糕的实验，并阐明它们为何糟糕。</p>
<p>在这些岗位上收入超过15万美元的人，不一定比你聪明。他们只是花了数年时间去创造、去破坏，然后从残骸中学习。他们问愚蠢的问题，直到问题变得有水平。他们交付失败的项目，直到开始交付成功的项目。</p>
<h2 data-id="heading-6">无人谈及的残酷现实</h2>
<p>你知道大多数职业建议错在哪里吗？它假定你会遵循一条逻辑路径。学习技能A，获得工作B，晋升到职位C。而实际的职业发展远比这复杂得多。</p>
<p>你可能在做了两年数据分析师后，才发现自己讨厌仪表盘，而热爱管道工程。你可能原本想成为一名AI产品分析师，结果却发现自己实际上更擅长MLOps。你可能钻研了一年SQL，然后因为发现了新的兴趣而转向完全不同的领域。</p>
<p>这很好。这很正常。你所学的每一项技能都会积累，即使最终你使用它的方式与预期不同。</p>
<p>我一开始想成为一名数据科学家。花了一年时间学习机器学习，构建模型，做了所有相关的事情。后来我找到了一份工作，才意识到自己对基础设施方面更感兴趣。为什么数据管道会出故障？我们怎样才能让它更可靠？为什么没人明白这个仪表盘实际测量的是什么？</p>
<p>这种好奇心引领我走上了一条与预期截然不同的道路。而我花在学习机器学习上的每一小时，都没有白费。这让我在基础设施工作方面表现得更好，因为我理解数据科学家的需求以及背后的原因。</p>
<p>你的道路也会同样奇特。接受它。目标不是选择完美的角色并执行无懈可击的五年计划。目标是培养能不断积累的技能，对实际问题保持好奇心，并持续朝着真正让你感兴趣的工作迈进。</p>
<h2 data-id="heading-7">当前这意味着什么</h2>
<p>如果你现在是一名数据分析师，看到所有关于AI的炒作，感觉自己落后了，那就先深呼吸一下。你可能并没有落后。你只是看的指标不对。</p>
<p>获得晋升和高薪的人不一定是那些学习最新AI框架的人。他们是解决实际问题的人。他们明白企业并不抽象地关心模型准确性。他们关心的是收入、留存率、成本和客户满意度。</p>
<p>从那里开始。贵公司实际存在哪些问题？数据在哪些地方出现故障？人们开发了哪些无人使用的AI功能？利益相关者提出了哪些您无法回答的问题？</p>
<p>这些差距就是你的机会。每次你发现事情出现问题的地方，那就是创造有价值事物的机会。而创造有价值的事物正是你变得有价值的途径。</p>
<p>薪资竞争实际上并非真正关乎AI技能。它关乎成为那种能够掌握强大工具并使其发挥作用的人。有时这意味着构建更好的数据基础设施。有时这意味着可靠地部署模型。有时这意味着衡量这一切是否真的重要。</p>
<p>但这始终意味着解决实际问题，而不是追逐光鲜亮丽的新框架。</p>
<p>下面是我真正的建议，抛开所有常见的职业话题。别再担心自己是否了解最新的AI技术。开始担心自己是否能解决企业愿意付费的问题。深入学习基础知识。构建会出问题的东西。修复它们。构建更多的东西。问那些让你听起来很傻的问题，直到它们开始让你听起来很聪明。</p>
<p>请记住，目前在数据领域收入六位数的人，并非那些拥有最华丽技能的人。而是那些懂得如何把复杂的事情简单化、把不可靠的事情变得可靠，以及把昂贵的事情变得有价值的人。</p>
<p>这就是游戏。其他一切都只是噪音。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🎉TinyVue v3.27.0 正式发布：增加 Space 新组件，ColorPicker 组件支持线性渐变]]></title>    <link>https://juejin.cn/post/7587596841874440226</link>    <guid>https://juejin.cn/post/7587596841874440226</guid>    <pubDate>2025-12-25T09:22:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587596841874440226" data-draft-id="7587594077014458402" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🎉TinyVue v3.27.0 正式发布：增加 Space 新组件，ColorPicker 组件支持线性渐变"/> <meta itemprop="keywords" content="前端,Vue.js,TypeScript"/> <meta itemprop="datePublished" content="2025-12-25T09:22:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端开源星球"/> <meta itemprop="url" content="https://juejin.cn/user/1504599026445150"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🎉TinyVue v3.27.0 正式发布：增加 Space 新组件，ColorPicker 组件支持线性渐变
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1504599026445150/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端开源星球
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T09:22:14.000Z" title="Thu Dec 25 2025 09:22:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你好，我是 Kagol，个人公众号：<code>前端开源星球</code>。</p>
<p>我们非常高兴地宣布 TinyVue <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-vue%2Freleases%2Ftag%2Fv3.27.0" target="_blank" title="https://github.com/opentiny/tiny-vue/releases/tag/v3.27.0" ref="nofollow noopener noreferrer">v3.27.0</a> 正式发布🎉。该版本聚焦于增强可定制性与可访问性，新增若干实用组件能力，并修复了大量用户反馈的关键问题，提升了在 SaaS 主题与移动端的兼容性与稳定性。</p>
<h2 data-id="heading-0">主要亮点</h2>
<ul>
<li><strong>新增插槽</strong>: <code>date-picker</code> 增加了 footer 插槽，提升自定义底部交互能力。</li>
<li><strong>更精细的日期控制</strong>: <code>calendar-view</code> 与 <code>date-picker</code> 支持按天指定日期与换行显示，日历展示更灵活。</li>
<li><strong>选择器改进</strong>: <code>select</code> 增加 <code>autoSelect</code> 属性并优化可搜索场景下的中断问题，提高选择体验与可靠性。</li>
<li><strong>组件扩展</strong>: <code>steps</code> 支持单链环形节点图标插槽，<code>space</code> 组件被新增以方便布局间距管理。</li>
<li><strong>样式与主题</strong>: <code>exception</code> 组件补充了 PC 模板与深色模式支持，并对 Saas 主题做了多项样式调整（包含 <code>ip-address</code>、<code>button</code>、<code>divider</code>、<code>badge</code> 等）。</li>
<li><strong>配色与面板</strong>: <code>color-select-panel</code> 支持线性渐变，<code>color-select</code> 新增 <code>color-mode</code> 属性，色彩选择更强大。</li>
<li><strong>树形菜单与搜索</strong>: <code>tree-menu</code> 优化 demo 数据并暴露搜索事件，便于构建可搜索的侧边/树型导航。</li>
<li><strong>Grid 功能增强</strong>: 新增 <code>valid-config</code> 的 <code>highlightError</code>、鼠标悬停显示对齐线等多项体验改进。</li>
</ul>
<h2 data-id="heading-1">重要修复</h2>
<ul>
<li><strong>移动端兼容</strong>: 修复 mobile-first 场景下 <code>tag</code> 可选但不生效的问题；修复 Saas 模式下若干控件的样式显示异常。</li>
<li><strong>交互与显示</strong>: 修复 <code>notify</code> 垂直偏移、<code>tabs</code> 同时使用 <code>overflow-title</code> 与 <code>with-close</code> 的渲染问题、<code>slider</code> 横竖模式切换错误、<code>calendar-view</code> 同时段多任务显示异常等。</li>
<li><strong>性能与稳定性</strong>: 修复 <code>grid</code> 中 filterStore 的响应性问题、加载组件错误、分页尺寸变更导致的 body 高度错误等。</li>
<li><strong>兼容性与测试</strong>: 修复 <code>infinite-scroll</code> 在同页使用两处时报错的问题；完善各组件在 E2E 和示例中的兼容处理（<code>dialog-select</code>、<code>input</code>、<code>notify</code> 等）。</li>
<li><strong>工具链与构建</strong>: 修复打包后 CSS 缺失 tiny 前缀的问题，并修复发布流程相关错误。</li>
</ul>
<h2 data-id="heading-2">升级与迁移建议</h2>
<ul>
<li>
<p><strong>安装升级</strong>: 推荐在项目中将依赖升级到 v3.27.0，例如：</p>
<ul>
<li><code>npm install @opentiny/vue@3.27.0</code></li>
<li>或使用 pnpm: <code>pnpm add @opentiny/vue@3.27.0</code></li>
</ul>
</li>
<li>
<p><strong>回归测试</strong>: 升级后请重点回归以下场景：</p>
<ul>
<li>自定义 Saas 主题与样式（按钮、表单项、分隔线等视觉差异）</li>
<li><code>select</code> 的可搜索行为与 <code>autoSelect</code> 新属性的交互</li>
<li><code>date-picker</code>/<code>calendar-view</code> 的自定义槽位、日期展示（包含换行显示）</li>
<li>使用 <code>grid</code> 的自定义校验配置与分页行为</li>
<li><code>infinite-scroll</code> 在页面多处实例化的稳定性</li>
</ul>
</li>
<li>
<p><strong>样式注意</strong>: 若项目依赖 SaaS 模板或定制 less/样式，请检查示例与主题调整（本次修复中新增/修改了若干 Saas 相关 less 文件与样式规范）。</p>
</li>
<li>
<p><strong>兼容 props</strong>: 关注新增的 <code>popperOptions</code>（Picker）、<code>hideSaas</code>（示例隐藏）等属性，调整自定义逻辑以兼容新选项。</p>
</li>
</ul>
<h2 data-id="heading-3">社区与贡献</h2>
<ul>
<li>
<p>本次发布汇集了大量社区贡献，特别感谢以下贡献者（部分举例）：</p>
<ul>
<li>@discreted66（多项 date-picker、calendar、exception 改进）</li>
<li>@chenxi-20（tabs、steps、notify 修复与改进）</li>
<li>@shenjunjian（select、input、picker 修复与增强）</li>
<li>@gimmyhehe（grid 相关改进）</li>
<li>@wuyiping0628、@zzcr、@James-9696、@KevinAndrewDong 等多人提交大量 PR 和修复</li>
</ul>
</li>
<li>
<p>欢迎更多新贡献者加入：本版本中 @gausszhou 与 @ynnnny 完成了他们的首次贡献。</p>
</li>
</ul>
<p>详细的更新信息请查看 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-vue%2Freleases%2Ftag%2Fv3.27.0" target="_blank" title="https://github.com/opentiny/tiny-vue/releases/tag/v3.27.0" ref="nofollow noopener noreferrer">Release Notes</a></p>
<h2 data-id="heading-4">小结</h2>
<p>v3.27.0 是一次以可定制性、体验与稳定性为核心的迭代：新增插槽、色彩/布局组件、以及大量围绕 Saas 与移动端的修复，将帮助你在实际应用中获得更一致、更可控的表现。升级后请务必执行回归测试并关注样式与交互的边缘场景。</p>
<h2 data-id="heading-5">联系我们</h2>
<p>GitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-vue" target="_blank" title="https://github.com/opentiny/tiny-vue" ref="nofollow noopener noreferrer">github.com/opentiny/ti…</a>（欢迎 Star ⭐）</p>
<p>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.design%2Ftiny-vue" target="_blank" title="https://opentiny.design/tiny-vue" ref="nofollow noopener noreferrer">opentiny.design/tiny-vue</a></p>
<p>个人博客：<a href="https://link.juejin.cn?target=https%3A%2F%2Fkagol.github.io%2Fblogs" target="_blank" title="https://kagol.github.io/blogs" ref="nofollow noopener noreferrer">kagol.github.io/blogs</a></p>
<p>小助手微信：opentiny-official</p>
<p>公众号：OpenTiny</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大前端框架汇总/产品交互参考UE]]></title>    <link>https://juejin.cn/post/7587428416128745510</link>    <guid>https://juejin.cn/post/7587428416128745510</guid>    <pubDate>2025-12-25T09:27:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587428416128745510" data-draft-id="7587421380230332466" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大前端框架汇总/产品交互参考UE"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-25T09:27:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="潍坊中登"/> <meta itemprop="url" content="https://juejin.cn/user/2031553215465981"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大前端框架汇总/产品交互参考UE
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2031553215465981/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    潍坊中登
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T09:27:43.000Z" title="Thu Dec 25 2025 09:27:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">产品交互参考UE</h2>
<p>（水文  哈哈 ）</p>
<h3 data-id="heading-1"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fjeffcat%2Farticles%2Fblob%2F7c4f7fafc3d6d0e27b445bcd1ec46f0aac0c8e5d%2F%25E6%2596%2587%25E7%25AB%25A0%2F%25E4%25BA%25A7%25E5%2593%2581%25E4%25BA%25A4%25E4%25BA%2592%25E5%258F%2582%25E8%2580%2583UE.md%23%25E5%25A4%25A7%25E5%258E%2582%25E5%2587%25BA%25E5%2593%2581" target="_blank" title="https://gitee.com/jeffcat/articles/blob/7c4f7fafc3d6d0e27b445bcd1ec46f0aac0c8e5d/%E6%96%87%E7%AB%A0/%E4%BA%A7%E5%93%81%E4%BA%A4%E4%BA%92%E5%8F%82%E8%80%83UE.md#%E5%A4%A7%E5%8E%82%E5%87%BA%E5%93%81" ref="nofollow noopener noreferrer"/>大厂出品</h3>
<p>1- 阿里 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Flink%3Ftarget%3Dhttp%253A%252F%252Fant.design%252F" target="_blank" title="https://gitee.com/link?target=http%3A%2F%2Fant.design%2F" ref="nofollow noopener noreferrer">ant.design/</a> ，小程序：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Flink%3Ftarget%3Dhttp%253A%252F%252Fmini.ant.design%252F" target="_blank" title="https://gitee.com/link?target=http%3A%2F%2Fmini.ant.design%2F" ref="nofollow noopener noreferrer">mini.ant.design/</a></p>
<p>2- 抖音 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Flink%3Ftarget%3Dhttp%253A%252F%252Fsemi.design%252F" target="_blank" title="https://gitee.com/link?target=http%3A%2F%2Fsemi.design%2F" ref="nofollow noopener noreferrer">semi.design/</a> 适配抖音 / 头条小程序，基于 UniApp 生态，组件覆盖电商 / 内容场景，字节系小程序首选； 官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Flink%3Ftarget%3Dhttps%253A%252F%252Fnutui.jd.com%252Funiapp%252F" target="_blank" title="https://gitee.com/link?target=https%3A%2F%2Fnutui.jd.com%2Funiapp%2F" ref="nofollow noopener noreferrer">nutui.jd.com/uniapp/</a></p>
<p>3- 腾讯 移动端跨平台 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Flink%3Ftarget%3Dhttp%253A%252F%252Ftmui.design" target="_blank" title="https://gitee.com/link?target=http%3A%2F%2Ftmui.design" ref="nofollow noopener noreferrer">tmui.design</a> , 同时做 Web 中后台 + 微信小程序 + Flutter App: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Flink%3Ftarget%3Dhttp%253A%252F%252Fstatic.tdesign.tencent.com" target="_blank" title="https://gitee.com/link?target=http%3A%2F%2Fstatic.tdesign.tencent.com" ref="nofollow noopener noreferrer">static.tdesign.tencent.com</a></p>
<p>4- 金蝶 <a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.kingdee.design" target="_blank" title="http://www.kingdee.design" ref="nofollow noopener noreferrer">www.kingdee.design</a></p>
<p>5- 饿了摸 ：后台 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Flink%3Ftarget%3Dhttp%253A%252F%252Felement.eleme.cn%252F%2523%252Fzh-CN" target="_blank" title="https://gitee.com/link?target=http%3A%2F%2Felement.eleme.cn%2F%23%2Fzh-CN" ref="nofollow noopener noreferrer">element.eleme.cn/#/zh-CN</a></p>
<p>6- 其他热门 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Flink%3Ftarget%3Dhttps%253A%252F%252Fwww.uviewui.com%252F" target="_blank" title="https://gitee.com/link?target=https%3A%2F%2Fwww.uviewui.com%2F" ref="nofollow noopener noreferrer">www.uviewui.com/</a> ：（免费）， <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Flink%3Ftarget%3Dhttps%253A%252F%252Fwww.iviewui.com%252Fprice" target="_blank" title="https://gitee.com/link?target=https%3A%2F%2Fwww.iviewui.com%2Fprice" ref="nofollow noopener noreferrer">www.iviewui.com/price</a> ：（收费）</p>
<p>7- 滴滴集团 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Flink%3Ftarget%3Dhttps%253A%252F%252Fdidi.github.io%252Fcube-ui%252F%2523%252Fzh-CN" target="_blank" title="https://gitee.com/link?target=https%3A%2F%2Fdidi.github.io%2Fcube-ui%2F%23%2Fzh-CN" ref="nofollow noopener noreferrer">didi.github.io/cube-ui/#/z…</a> ，<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Flink%3Ftarget%3Dhttp%253A%252F%252Fdidi.github.io%252F" target="_blank" title="https://gitee.com/link?target=http%3A%2F%2Fdidi.github.io%2F" ref="nofollow noopener noreferrer">didi.github.io/</a></p>
<p>原文  <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fjeffcat%2Farticles%2Fblob%2F7c4f7fafc3d6d0e27b445bcd1ec46f0aac0c8e5d%2F%25E6%2596%2587%25E7%25AB%25A0%2F%25E4%25BA%25A7%25E5%2593%2581%25E4%25BA%25A4%25E4%25BA%2592%25E5%258F%2582%25E8%2580%2583UE.md" target="_blank" title="https://gitee.com/jeffcat/articles/blob/7c4f7fafc3d6d0e27b445bcd1ec46f0aac0c8e5d/%E6%96%87%E7%AB%A0/%E4%BA%A7%E5%93%81%E4%BA%A4%E4%BA%92%E5%8F%82%E8%80%83UE.md" ref="nofollow noopener noreferrer">gitee.com/jeffcat/art…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[漏洞复现指南：利用 phpinfo() 绕过 HttpOnly Cookie 保护]]></title>    <link>https://juejin.cn/post/7587459328070516746</link>    <guid>https://juejin.cn/post/7587459328070516746</guid>    <pubDate>2025-12-25T09:22:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587459328070516746" data-draft-id="7587381515669274651" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="漏洞复现指南：利用 phpinfo() 绕过 HttpOnly Cookie 保护"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-25T09:22:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="张就是我106592"/> <meta itemprop="url" content="https://juejin.cn/user/2559318802575102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            漏洞复现指南：利用 phpinfo() 绕过 HttpOnly Cookie 保护
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2559318802575102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    张就是我106592
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T09:22:13.000Z" title="Thu Dec 25 2025 09:22:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">1. 实验综述</h3>
<p>本实验旨在展示一个经典的“漏洞链”：利用服务器配置错误（泄露的 <code>phpinfo.php</code>）配合跨站脚本攻击（XSS），成功绕过浏览器对 <code>HttpOnly</code> Cookie 的安全保护。</p>
<hr/>
<h3 data-id="heading-1">2. 环境搭建</h3>
<p>你需要一个支持 PHP 的本地环境（如 XAMPP 或 Ubuntu + Apache/Nginx）。</p>
<h4 data-id="heading-2">2.1 服务器环境确认</h4>
<p>确保 PHP 环境已正常运行。</p>
<blockquote>
<p><strong>截图参考</strong>：系统环境确认（如 PHP 7.4.3 版本）。</p>
<blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f1c57ad47fc426abb17e6236275a0ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byg5bCx5piv5oiRMTA2NTky:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767259332&amp;x-signature=fHtIo0nyaLlmTJ0sYCquuP37mH0%3D" alt="企业微信截图_17666500389926.png" loading="lazy"/></p>
</blockquote>
</blockquote>
<h4 data-id="heading-3">2.2 创建漏洞页面 <code>vuln.php</code></h4>
<p>该页面模拟两个关键点：手动设置一个受 <code>HttpOnly</code> 保护的敏感 Cookie，以及一个未经过滤的 XSS 注入点。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">// vuln.php</span>
<span class="hljs-comment">// 1. 模拟登录：设置一个 HttpOnly 的 Cookie</span>
<span class="hljs-title function_ invoke__">setcookie</span>(<span class="hljs-string">"SecretSessionID"</span>, <span class="hljs-string">"A1B2C3D4E5_VERY_SECRET"</span>, [
    <span class="hljs-string">'expires'</span> =&gt; <span class="hljs-title function_ invoke__">time</span>() + <span class="hljs-number">3600</span>,
    <span class="hljs-string">'path'</span> =&gt; <span class="hljs-string">'/'</span>,
    <span class="hljs-string">'httponly'</span> =&gt; <span class="hljs-literal">true</span>, // 关键点：浏览器脚本理论上无法读取此 Cookie
    <span class="hljs-string">'samesite'</span> =&gt; <span class="hljs-string">'Strict'</span>
]);
<span class="hljs-comment">// 2. 模拟 XSS 漏洞：直接回显用户输入的 'name' 参数</span>
<span class="hljs-variable">$name</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'name'</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'name'</span>] : <span class="hljs-string">'Guest'</span>;
<span class="hljs-meta">?&gt;</span>
&lt;!-- HTML 部分省略，包含一个显示 <span class="hljs-variable">$name</span> 的位置 --&gt;
</code></pre>
<h4 data-id="heading-4">2.3 创建信息泄露页面 <code>info.php</code></h4>
<p>模拟生产环境中被遗留的诊断文件。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">// info.php</span>
<span class="hljs-title function_ invoke__">phpinfo</span>();
<span class="hljs-meta">?&gt;</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">3. 复现流程</h3>
<h4 data-id="heading-6">步骤 1：确认 HttpOnly 保护生效</h4>
<ol>
<li>访问 <code>http://localhost/vuln.php</code>。</li>
<li>打开开发者工具 (F12) -&gt; Storage -&gt; Cookies。</li>
<li>确认 <code>SecretSessionID</code> 的 <code>HttpOnly</code> 属性已勾选。此时，在控制台输入 <code>document.cookie</code> 将无法看到该值。</li>
</ol>
<blockquote>
<p><strong>截图参考</strong>：浏览器中 Cookie 的 <code>HttpOnly</code> 状态。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61807549663f400dbb4b618f842c68ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byg5bCx5piv5oiRMTA2NTky:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767259332&amp;x-signature=Np01nwYsyz%2BuXVRXQS7QdiigjSQ%3D" alt="企业微信截图_17666504672500.png" loading="lazy"/></p>
</blockquote>
<h4 data-id="heading-7">步骤 2：确认 phpinfo() 信息泄露</h4>
<ol>
<li>访问 <code>http://localhost/info.php</code>。</li>
<li>搜索 <code>HTTP_COOKIE</code> 字段。</li>
<li><strong>发现风险</strong>：由于服务器会打印完整的 HTTP 请求头，受保护的 <code>SecretSessionID</code> 明文显示在 HTML 页面中。</li>
</ol>
<h4 data-id="heading-8">步骤 3：构造并注入攻击 Payload</h4>
<p>由于 <code>document.cookie</code> 被封锁，攻击者利用 JavaScript 发起异步请求来读取 <code>info.php</code> 的响应内容，并从中提取 Cookie。</p>
<p><strong>攻击 Payload 逻辑</strong>：</p>
<ol>
<li>使用 <code>fetch()</code> 访问同域下的 <code>/info.php</code>。</li>
<li>获取响应的文本内容。</li>
<li>使用正则表达式匹配 <code>SecretSessionID</code> 后的字符串。</li>
<li>将提取到的值通过弹窗或外传展示。</li>
</ol>
<p><strong>URL 注入链接</strong>：</p>
<pre><code class="hljs language-text" lang="text">http://localhost/vuln.php?name=&lt;script&gt;fetch('/info.php').then(r=&gt;r.text()).then(t=&gt;{alert(t.match(/SecretSessionID=[a-zA-Z0-9_-]+/))})&lt;/script&gt;
</code></pre>
<blockquote>
<p><strong>注意</strong>：在实际测试中，Payload 需要进行转义或 URL 编码以防语法错误。</p>
</blockquote>
<h4 data-id="heading-9">步骤 4：执行攻击与结果验证</h4>
<ol>
<li>将构造好的链接粘贴至浏览器访问。</li>
<li><strong>预期结果</strong>：页面执行注入的脚本，并弹出包含受保护 Cookie 的警告框。</li>
</ol>
<blockquote>
<p><strong>截图参考</strong>：成功绕过 HttpOnly 提取到的 Cookie 弹窗。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a76ada42eac4dcea46b4f9febf011e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byg5bCx5piv5oiRMTA2NTky:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767259332&amp;x-signature=jcjY0bQRiFSt6UvUBKi7tG8r6t4%3D" alt="企业微信截图_17666513368794.png" loading="lazy"/></p>
</blockquote>
<hr/>
<h3 data-id="heading-10">4. 结论与风险总结</h3>
<ul>
<li><strong>高危风险</strong>：此漏洞允许攻击者完全接管用户会话，即便开启了 <code>HttpOnly</code> 防御。</li>
<li><strong>防御失效</strong>：原本用于防止 XSS 窃取 Cookie 的安全标志，在 <code>phpinfo()</code> 的“协助”下彻底失效。</li>
</ul>
<p><strong>比喻理解</strong>：
设置 <code>HttpOnly</code> 标志就像给房子安装了<strong>防盗门</strong>，让小偷没法直接拿到钥匙；但公开暴露 <code>phpinfo.php</code> 就像在门旁的<strong>告示牌</strong>上贴了一张钥匙的详细蓝图。攻击者通过 XSS 潜入院子后，只需照着蓝图“复刻”一把，依然能打开你的防盗门。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我们来说一下 synchronized 与 ReentrantLock 的区别]]></title>    <link>https://juejin.cn/post/7587518397950394422</link>    <guid>https://juejin.cn/post/7587518397950394422</guid>    <pubDate>2025-12-25T09:33:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587518397950394422" data-draft-id="7587468062210605092" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我们来说一下 synchronized 与 ReentrantLock 的区别"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-12-25T09:33:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员小假"/> <meta itemprop="url" content="https://juejin.cn/user/2285197690931932"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我们来说一下 synchronized 与 ReentrantLock 的区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2285197690931932/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员小假
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T09:33:59.000Z" title="Thu Dec 25 2025 09:33:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、基本特性对比</h2>























































<table><thead><tr><th><strong>特性</strong></th><th><strong>synchronized</strong></th><th><strong>ReentrantLock</strong></th></tr></thead><tbody><tr><td><strong>锁的实现机制</strong></td><td>JVM 内置关键字，通过监视器实现</td><td>JDK 提供的 API 类（<code>java.util.concurrent.locks</code>）</td></tr><tr><td><strong>锁的获取方式</strong></td><td>隐式获取和释放（进入/退出同步代码块或方法自动获取/释放）</td><td>显式调用 <code>lock()</code>/<code>unlock()</code>方法</td></tr><tr><td><strong>可重入性</strong></td><td>支持</td><td>支持</td></tr><tr><td><strong>锁的类型</strong></td><td>非公平锁（默认）</td><td>可选择公平锁或非公平锁（构造函数指定）</td></tr><tr><td><strong>条件变量</strong></td><td>通过 <code>wait()</code>/<code>notify()</code>/<code>notifyAll()</code>实现</td><td>通过 <code>Condition</code>对象支持多个条件队列</td></tr><tr><td><strong>中断响应</strong></td><td>不支持中断等待</td><td>支持 <code>lockInterruptibly()</code>中断等待</td></tr><tr><td><strong>超时机制</strong></td><td>不支持</td><td>支持 <code>tryLock(timeout, unit)</code>尝试获取锁</td></tr><tr><td><strong>锁的绑定</strong></td><td>与代码块或方法绑定</td><td>可跨方法绑定，更灵活</td></tr><tr><td><strong>性能</strong></td><td>JDK 1.6 后优化，性能接近</td><td>在高并发竞争下表现更稳定</td></tr></tbody></table>
<h2 data-id="heading-1">二、详细区别分析</h2>
<h3 data-id="heading-2"><strong>1. 实现层面</strong></h3>
<ul>
<li><strong>synchronized</strong>：</li>
</ul>

<ul>
<li>
<ul>
<li>Java 关键字，由 JVM 底层实现（通过 <code>monitorenter</code>/<code>monitorexit</code> 字节码指令）。</li>
<li>锁信息记录在对象头的 Mark Word 中。</li>
</ul>
</li>
</ul>

<ul>
<li><strong>ReentrantLock</strong>：</li>
</ul>

<ul>
<li>
<ul>
<li>基于 <code>AbstractQueuedSynchronizer（AQS）</code> 实现的显式锁。</li>
<li>通过 CAS（Compare-And-Swap）和队列管理线程竞争。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3"><strong>2. 使用方式</strong></h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// synchronized 隐式使用</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> synchronized <span class="hljs-keyword">void</span> <span class="hljs-title">method</span>()</span> {
    <span class="hljs-comment">// 同步代码</span>
}
<span class="hljs-comment">// 或</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method</span>()</span> {
    synchronized(<span class="hljs-keyword">this</span>) {
        <span class="hljs-comment">// 同步代码</span>
    }
}

<span class="hljs-comment">// ReentrantLock 显式使用</span>
<span class="hljs-keyword">private</span> ReentrantLock <span class="hljs-keyword">lock</span> = <span class="hljs-keyword">new</span> ReentrantLock();
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method</span>()</span> {
    <span class="hljs-keyword">lock</span>.<span class="hljs-keyword">lock</span>();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 同步代码</span>
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">lock</span>.unlock(); <span class="hljs-comment">// 必须手动释放</span>
    }
}
</code></pre>
<h3 data-id="heading-4"><strong>3. 公平性选择</strong></h3>
<ul>
<li><strong>synchronized</strong>：仅支持非公平锁（线程竞争时随机获取锁）。</li>
<li><strong>ReentrantLock</strong>：</li>
</ul>

<ul>
<li>
<ul>
<li><strong>公平锁</strong>：按等待时间顺序获取锁，避免线程饥饿，但性能较低。</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li><strong>非公平锁</strong>：允许插队，性能更高。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5"><strong>4. 条件变量（Condition）</strong></h3>
<ul>
<li><strong>synchronized</strong>：通过 <code>Object.wait()</code>/<code>notify()</code> 实现等待/唤醒，只能有一个等待队列。</li>
<li><strong>ReentrantLock</strong>：可创建多个 <code>Condition</code> 对象，实现精细化的线程等待/唤醒。</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">Condition <span class="hljs-attr">condition</span> = lock.newCondition()<span class="hljs-comment">;</span>
condition.await()<span class="hljs-comment">;      // 类似 wait()</span>
condition.signal()<span class="hljs-comment">;     // 类似 notify()</span>
</code></pre>
<p>示例：生产者-消费者模型中，可为空队列和满队列分别设置 Condition。</p>
<h3 data-id="heading-6"><strong>5. 中断与超时</strong></h3>
<ul>
<li><strong>synchronized</strong>：</li>
</ul>

<ul>
<li>
<ul>
<li>线程等待锁时无法被中断。</li>
<li>无超时机制，可能永久等待。</li>
</ul>
</li>
</ul>

<ul>
<li><strong>ReentrantLock</strong>：</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 支持中断</span>
<span class="hljs-keyword">lock</span>.lockInterruptibly();

<span class="hljs-comment">// 支持超时</span>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">lock</span>.tryLock(<span class="hljs-number">1</span>, TimeUnit.SECONDS)) {
    <span class="hljs-keyword">try</span> { <span class="hljs-comment">/* 操作 */</span> } 
    <span class="hljs-keyword">finally</span> { <span class="hljs-keyword">lock</span>.unlock(); }
}
</code></pre>
<h3 data-id="heading-7"><strong>6. 性能差异</strong></h3>
<ul>
<li>JDK 1.5 时 <code>ReentrantLock</code> 性能显著优于 <code>synchronized</code>。</li>
<li>JDK 1.6 后 JVM 对 <code>synchronized</code> 进行了大量优化（锁升级、自适应自旋等），两者性能差距缩小。</li>
<li>在高竞争场景下，<code>ReentrantLock</code> 仍可能表现更稳定。</li>
</ul>
<h2 data-id="heading-8">三、适用场景</h2>
<h3 data-id="heading-9"><strong>优先使用 synchronized 的情况</strong></h3>
<ul>
<li>简单的同步场景，代码简洁性更重要。</li>
<li>不需要高级功能（如条件变量、中断、超时）。</li>
<li>资源竞争不激烈时，性能可接受。</li>
</ul>
<h3 data-id="heading-10"><strong>优先使用 ReentrantLock 的情况</strong></h3>
<ul>
<li>需要公平锁、可中断锁、超时锁等高级功能。</li>
<li>需要多个条件变量（如阻塞队列的实现）。</li>
<li>需要跨方法加锁/释放锁（如：在方法 A 加锁，在方法 B 释放）。</li>
<li>竞争激烈且性能要求高。</li>
</ul>
<h2 data-id="heading-11">四、示例对比</h2>
<h3 data-id="heading-12"><strong>场景：生产者-消费者模型</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 使用 synchronized（单一条件）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(Object item)</span> <span class="hljs-keyword">throws</span> InterruptedException {
    <span class="hljs-keyword">while</span> (queue.isFull()) {
        wait(); <span class="hljs-comment">// 只能在一个条件上等待</span>
    }
    queue.put(item);
    notifyAll();
}

<span class="hljs-comment">// 使用 ReentrantLock（多条件）</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">notFull</span> <span class="hljs-operator">=</span> lock.newCondition();
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">notEmpty</span> <span class="hljs-operator">=</span> lock.newCondition();

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(Object item)</span> <span class="hljs-keyword">throws</span> InterruptedException {
    lock.lock();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">while</span> (queue.isFull()) {
            notFull.await(); <span class="hljs-comment">// 只在 "非满" 条件上等待</span>
        }
        queue.put(item);
        notEmpty.signal();   <span class="hljs-comment">// 只唤醒等待 "非空" 的线程</span>
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();
    }
}
</code></pre>
<h2 data-id="heading-13">五、总结</h2>
<ul>
<li><strong>synchronized</strong> 简单、安全、自动管理锁释放，适合大多数常规同步场景。</li>
<li><strong>ReentrantLock</strong> 功能强大、灵活可控，适合复杂并发场景和高级需求。</li>
<li>从 JDK 1.6 开始，两者性能接近，选择时应更关注<strong>功能需求</strong>和<strong>代码可维护性</strong>。</li>
<li>在 JDK 后续版本中，<code>synchronized</code> 仍在持续优化（如锁消除、锁粗化等），而 <code>ReentrantLock</code> 提供了更细粒度的并发控制。</li>
</ul>
<h2 data-id="heading-14">面试回答</h2>
<p>首先，<code>synchronized</code> 是 Java 语言层面的关键字，是 JVM 原生支持的锁机制。它的使用非常简单，编译器会自动处理锁的获取和释放，所以基本不会因为忘记释放锁而导致死锁，<strong>易用性是它的最大优点</strong>。<br/>
而 <code>ReentrantLock</code> 是 <code>JUC</code> 包下的一个类，是 JDK 层面实现的锁。它需要开发者显式地调用 <code>lock()</code> 和 <code>unlock()</code> 方法，通常在 <code>finally</code> 块中释放锁，否则容易出问题。所以从使用门槛上说，<code>synchronized</code> 更低。</p>
<p>在功能上，<code>ReentrantLock</code> 比 <code>synchronized</code> 灵活和强大得多，主要有三点：</p>
<ol>
<li><strong>可中断获取锁</strong>：当线程尝试获取 <code>ReentrantLock</code> 时，如果长时间拿不到，可以响应中断，通过 <code>lockInterruptibly()</code> 方法放弃等待去做别的事情。而 <code>synchronized</code> 在等待锁时，线程会一直阻塞，无法被中断。</li>
<li><strong>公平锁选项</strong>：<code>ReentrantLock</code> 可以在构造函数中指定是否是公平锁（先等待的线程先获得锁）。虽然公平锁性能有损耗，但能防止线程饥饿。<code>synchronized</code> 则是<strong>非公平</strong>的，谁抢到算谁的，性能通常更好。</li>
<li><strong>条件变量（Condition）</strong> ：这是非常强大的一点。一个 <code>ReentrantLock</code> 可以创建多个 <code>Condition</code> 对象，用来实现更精细的线程等待/通知。比如，我们可以让一部分线程在条件A上等待，另一部分在条件B上等待，唤醒时也可以选择只唤醒等待条件A的线程。而 <code>synchronized</code> 只能配合 <code>wait()</code> 和 <code>notify()</code>，所有线程都在同一个条件队列上，唤醒是随机的（<code>notify</code>）或全部唤醒（<code>notifyAll</code>），不够精确。</li>
</ol>
<p>在早期版本（JDK 1.5 之前），<code>ReentrantLock</code> 的性能比 <code>synchronized</code> 好很多。但后来 JVM 对 <code>synchronized</code> 进行了大幅优化，比如引入了<strong>偏向锁、轻量级锁、自旋锁、锁消除、锁粗化</strong>等。所以在高版本的 JDK（如 1.8 及以后）中，两者在性能上已经相差无几，<code>synchronized</code> 甚至在一些常见场景下更优，因为它有 JVM 的持续优化。</p>
<p>所以，我的选择原则通常是：</p>
<ul>
<li><strong>优先考虑</strong> ****<code>synchronized</code>：在满足需求的情况下，因为它简单、安全（自动释放），且性能不差。大部分标准的同步场景用它就够了。</li>
<li><strong>需要高级功能时再用</strong> <code>ReentrantLock</code>：比如我需要用到<strong>可中断、公平锁，或者需要复杂的条件等待机制（典型应用就是“生产者-消费者”模型）</strong> ，这时 <code>ReentrantLock</code> 是唯一的选择。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android手持机扫码出入库的开发详解-6.APP下载更新]]></title>    <link>https://juejin.cn/post/7587381515669209115</link>    <guid>https://juejin.cn/post/7587381515669209115</guid>    <pubDate>2025-12-25T09:00:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587381515669209115" data-draft-id="7587392473852297262" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android手持机扫码出入库的开发详解-6.APP下载更新"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-25T09:00:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="光头闪亮亮"/> <meta itemprop="url" content="https://juejin.cn/user/1333047014199326"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android手持机扫码出入库的开发详解-6.APP下载更新
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1333047014199326/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    光头闪亮亮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T09:00:21.000Z" title="Thu Dec 25 2025 09:00:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Android手持机扫码出入库的开发详解-6.APP下载更新</h2>
<h3 data-id="heading-1">APP下载/更新</h3>
<h4 data-id="heading-2">APP下载更新程序图</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[触发版本检查] --&gt; B[检查网络连接]
    B --&gt;|网络不可用| C[提示网络错误]
    B --&gt;|网络可用| D[请求服务器版本信息]
    D --&gt; E[解析版本信息]
    E --&gt; F[比较版本号]
    F --&gt;|无需更新| G[提示当前为最新版本]
    F --&gt;|需要更新| H[显示更新提示]
    H --&gt; I[下载新版本APK]
    I --&gt; J[安装新版本]
    J --&gt; K[重启应用]
</code></pre>
<h4 data-id="heading-3">APP下载更新源代码</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// UpdateVersion.java - 版本更新核心代码</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UpdateVersion</span> {
    <span class="hljs-keyword">private</span> Context context;
    <span class="hljs-keyword">private</span> String versionName;
    <span class="hljs-keyword">private</span> String downloadUrl;
    <span class="hljs-keyword">private</span> String apkName;
    <span class="hljs-keyword">private</span> ProgressDialog progressDialog;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UpdateVersion</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-built_in">this</span>.context = context;
    }

    <span class="hljs-comment">// 检查版本更新</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkUpdate</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// 请求服务器版本信息</span>
                    <span class="hljs-type">String</span> <span class="hljs-variable">versionInfo</span> <span class="hljs-operator">=</span> HttpUtil.getVersionInfo();
                    <span class="hljs-keyword">if</span> (versionInfo != <span class="hljs-literal">null</span>) {
                        <span class="hljs-comment">// 解析版本信息</span>
                        parseXml(versionInfo);
                        <span class="hljs-comment">// 比较版本号</span>
                        <span class="hljs-keyword">if</span> (needUpdate()) {
                            <span class="hljs-comment">// 显示更新提示</span>
                            ((Activity) context).runOnUiThread(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
                                <span class="hljs-meta">@Override</span>
                                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                                    showUpdateDialog();
                                }
                            });
                        } <span class="hljs-keyword">else</span> {
                            <span class="hljs-comment">// 提示当前为最新版本</span>
                            ((Activity) context).runOnUiThread(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
                                <span class="hljs-meta">@Override</span>
                                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                                    Toast.makeText(context, <span class="hljs-string">"当前为最新版本"</span>, Toast.LENGTH_SHORT).show();
                                }
                            });
                        }
                    }
                } <span class="hljs-keyword">catch</span> (Exception e) {
                    e.printStackTrace();
                }
            }
        }).start();
    }

    <span class="hljs-comment">// 解析版本信息XML</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parseXml</span><span class="hljs-params">(String xml)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">DocumentBuilderFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> DocumentBuilderFactory.newInstance();
        <span class="hljs-type">DocumentBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> factory.newDocumentBuilder();
        <span class="hljs-type">Document</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> builder.parse(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputSource</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringReader</span>(xml)));
        <span class="hljs-type">Element</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> document.getDocumentElement();

        <span class="hljs-comment">// 获取版本号</span>
        <span class="hljs-type">Element</span> <span class="hljs-variable">versionElement</span> <span class="hljs-operator">=</span> (Element) root.getElementsByTagName(<span class="hljs-string">"version"</span>).item(<span class="hljs-number">0</span>);
        <span class="hljs-built_in">this</span>.versionName = versionElement.getFirstChild().getNodeValue();

        <span class="hljs-comment">// 获取下载地址</span>
        <span class="hljs-type">Element</span> <span class="hljs-variable">urlElement</span> <span class="hljs-operator">=</span> (Element) root.getElementsByTagName(<span class="hljs-string">"url"</span>).item(<span class="hljs-number">0</span>);
        <span class="hljs-built_in">this</span>.downloadUrl = urlElement.getFirstChild().getNodeValue();

        <span class="hljs-comment">// 获取APK名称</span>
        <span class="hljs-type">Element</span> <span class="hljs-variable">nameElement</span> <span class="hljs-operator">=</span> (Element) root.getElementsByTagName(<span class="hljs-string">"name"</span>).item(<span class="hljs-number">0</span>);
        <span class="hljs-built_in">this</span>.apkName = nameElement.getFirstChild().getNodeValue();
    }

    <span class="hljs-comment">// 判断是否需要更新</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">needUpdate</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">PackageManager</span> <span class="hljs-variable">pm</span> <span class="hljs-operator">=</span> context.getPackageManager();
        <span class="hljs-type">PackageInfo</span> <span class="hljs-variable">pi</span> <span class="hljs-operator">=</span> pm.getPackageInfo(context.getPackageName(), <span class="hljs-number">0</span>);
        <span class="hljs-type">String</span> <span class="hljs-variable">localVersion</span> <span class="hljs-operator">=</span> pi.versionName;

        <span class="hljs-comment">// 比较版本号</span>
        <span class="hljs-keyword">return</span> compareVersion(versionName, localVersion) &gt; <span class="hljs-number">0</span>;
    }

    <span class="hljs-comment">// 显示更新提示对话框</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">showUpdateDialog</span><span class="hljs-params">()</span> {
        AlertDialog.<span class="hljs-type">Builder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AlertDialog</span>.Builder(context);
        builder.setTitle(<span class="hljs-string">"版本更新"</span>);
        builder.setMessage(<span class="hljs-string">"发现新版本，是否更新？"</span>);
        builder.setPositiveButton(<span class="hljs-string">"更新"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">DialogInterface</span>.OnClickListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(DialogInterface dialog, <span class="hljs-type">int</span> which)</span> {
                dialog.dismiss();
                <span class="hljs-comment">// 开始下载</span>
                downloadApk();
            }
        });
        builder.setNegativeButton(<span class="hljs-string">"取消"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">DialogInterface</span>.OnClickListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(DialogInterface dialog, <span class="hljs-type">int</span> which)</span> {
                dialog.dismiss();
            }
        });
        builder.setCancelable(<span class="hljs-literal">false</span>);
        builder.show();
    }

    <span class="hljs-comment">// 下载APK</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">downloadApk</span><span class="hljs-params">()</span> {
        progressDialog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProgressDialog</span>(context);
        progressDialog.setProgressStyle(ProgressDialog.STYLE_HORIZONTAL);
        progressDialog.setMessage(<span class="hljs-string">"正在下载更新..."</span>);
        progressDialog.setCancelable(<span class="hljs-literal">false</span>);
        progressDialog.show();

        <span class="hljs-comment">// 启动下载线程</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">downloadApkThread</span>().start();
    }

    <span class="hljs-comment">// 下载线程</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">downloadApkThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> downloadFile(downloadUrl, progressDialog);
                sleep(<span class="hljs-number">1000</span>);
                <span class="hljs-comment">// 安装APK</span>
                installApk(file);
                progressDialog.dismiss();
            } <span class="hljs-keyword">catch</span> (Exception e) {
                e.printStackTrace();
            }
        }
    }

    <span class="hljs-comment">// 下载文件</span>
    <span class="hljs-keyword">private</span> File <span class="hljs-title function_">downloadFile</span><span class="hljs-params">(String downloadUrl, ProgressDialog pd)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 创建文件存储目录</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">savePath</span> <span class="hljs-operator">=</span> Environment.getExternalStorageDirectory() + <span class="hljs-string">"/download/"</span>;
        <span class="hljs-type">File</span> <span class="hljs-variable">saveDir</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(savePath);
        <span class="hljs-keyword">if</span> (!saveDir.exists()) {
            saveDir.mkdirs();
        }

        <span class="hljs-comment">// 创建文件</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">apkFilePath</span> <span class="hljs-operator">=</span> savePath + apkName;
        <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(apkFilePath);

        <span class="hljs-comment">// 下载文件</span>
        <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(downloadUrl);
        <span class="hljs-type">HttpURLConnection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> (HttpURLConnection) url.openConnection();
        conn.connect();
        <span class="hljs-type">int</span> <span class="hljs-variable">length</span> <span class="hljs-operator">=</span> conn.getContentLength();
        <span class="hljs-type">InputStream</span> <span class="hljs-variable">is</span> <span class="hljs-operator">=</span> conn.getInputStream();
        <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(file);

        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-type">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>];
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-type">int</span> <span class="hljs-variable">numread</span> <span class="hljs-operator">=</span> is.read(buffer);
            count += numread;
            <span class="hljs-type">int</span> <span class="hljs-variable">progress</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) ((<span class="hljs-type">float</span>) count / length * <span class="hljs-number">100</span>);
            <span class="hljs-comment">// 更新进度条</span>
            pd.setProgress(progress);
            <span class="hljs-keyword">if</span> (numread &lt;= <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// 下载完成</span>
                <span class="hljs-keyword">break</span>;
            }
            fos.write(buffer, <span class="hljs-number">0</span>, numread);
        }
        fos.close();
        is.close();
        <span class="hljs-keyword">return</span> file;
    }

    <span class="hljs-comment">// 安装APK</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">installApk</span><span class="hljs-params">(File file)</span> {
        <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(Intent.ACTION_VIEW);
        <span class="hljs-comment">// 兼容Android N及以上版本</span>
        <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) {
            intent.setFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);
            <span class="hljs-type">Uri</span> <span class="hljs-variable">contentUri</span> <span class="hljs-operator">=</span> FileProvider.getUriForFile(context, <span class="hljs-string">"cbw.materials.fileProvider"</span>, file);
            intent.setDataAndType(contentUri, <span class="hljs-string">"application/vnd.android.package-archive"</span>);
        } <span class="hljs-keyword">else</span> {
            intent.setDataAndType(Uri.fromFile(file), <span class="hljs-string">"application/vnd.android.package-archive"</span>);
            intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
        }
        context.startActivity(intent);
    }

    <span class="hljs-comment">// 比较版本号</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compareVersion</span><span class="hljs-params">(String version1, String version2)</span> {
        <span class="hljs-keyword">if</span> (version1.equals(version2)) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        }

        String[] version1Array = version1.split(<span class="hljs-string">"\\."</span>);
        String[] version2Array = version2.split(<span class="hljs-string">"\\."</span>);
        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">minLen</span> <span class="hljs-operator">=</span> Math.min(version1Array.length, version2Array.length);
        <span class="hljs-type">int</span> <span class="hljs-variable">diff</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

        <span class="hljs-keyword">while</span> (index &lt; minLen &amp;&amp; (diff = Integer.parseInt(version1Array[index]) - Integer.parseInt(version2Array[index])) == <span class="hljs-number">0</span>) {
            index++;
        }

        <span class="hljs-keyword">if</span> (diff != <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> diff;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 如果前面的版本号相同，比较版本号的长度</span>
            <span class="hljs-keyword">return</span> version1Array.length - version2Array.length;
        }
    }
}
</code></pre>
<h4 data-id="heading-4">调用系统更新</h4>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-comment">//系统更新</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SystemUpdateOnClickListenerImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">View</span>.OnClickListener {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> {

            <span class="hljs-comment">//提示信息</span>
            <span class="hljs-comment">//Toast.makeText(SystemSetup.this, "您点击了系统更校招！", 500).show();</span>
            

            update();


        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span>(isNetworkAvailable(SystemSetup.<span class="hljs-built_in">this</span>)){<span class="hljs-comment">//判断网络是否有效</span>
            <span class="hljs-keyword">if</span> (Environment.getExternalStorageState().equals(Environment.MEDIA_MOUNTED)){
                <span class="hljs-type">String</span> <span class="hljs-variable">sdpath</span> <span class="hljs-operator">=</span> Environment.getExternalStorageDirectory() + <span class="hljs-string">"/"</span>;
                Log.i(<span class="hljs-string">"debug"</span>,sdpath.toString());
                <span class="hljs-type">String</span> <span class="hljs-variable">mSavePath</span> <span class="hljs-operator">=</span> sdpath + <span class="hljs-string">"download/"</span>;<span class="hljs-comment">//文件的下载路径</span>
                Log.i(<span class="hljs-string">"debug"</span>,mSavePath.toString());
                <span class="hljs-type">UpdateVersion</span> <span class="hljs-variable">updateManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UpdateVersion</span>(<span class="hljs-built_in">this</span>,<span class="hljs-string">"http://192.168.10.5:80/OA/HandheldApp/UpdateVersion_Materials.xml"</span>, mSavePath);
                updateManager.checkUpdate();

            }<span class="hljs-keyword">else</span>{
                Toast.makeText(<span class="hljs-built_in">this</span>, <span class="hljs-string">"SD卡不可用"</span>, Toast.LENGTH_SHORT).show();
                Log.i(<span class="hljs-string">"TAG"</span>, <span class="hljs-string">"11213"</span>);
            }
        }<span class="hljs-keyword">else</span>{
            Toast.makeText(<span class="hljs-built_in">this</span>, <span class="hljs-string">"网络没有连接"</span>, Toast.LENGTH_SHORT).show();
        }
    }
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isNetworkAvailable</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-type">ConnectivityManager</span> <span class="hljs-variable">cm</span> <span class="hljs-operator">=</span> (ConnectivityManager) context.getSystemService(Context.CONNECTIVITY_SERVICE);
        <span class="hljs-type">NetworkInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> cm.getActiveNetworkInfo();<span class="hljs-comment">//没有网络的时候会返回 null</span>
        Log.i(<span class="hljs-string">"TAG"</span>, <span class="hljs-string">"INFOddd"</span>);
        <span class="hljs-keyword">if</span> (info == <span class="hljs-literal">null</span> || !cm.getBackgroundDataSetting()) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }<span class="hljs-keyword">else</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
</code></pre>
<h4 data-id="heading-5">windows 2003 Server服务器-IIS配置</h4>
<h5 data-id="heading-6">打开APK所有的服务端网站属性进行配置</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0752e9b90014f07a16da209ffb225cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5aS06Zeq5Lqu5Lqu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767258021&amp;x-signature=A55ybZz8SxcKRVCqIZu84ZkCsxU%3D" alt="image.png" loading="lazy"/></p>
<p>####MIME类型</p>
<pre><code class="hljs language-bash" lang="bash">扩展名：.apk
MIME类型：application/vnd.android.package-archive
</code></pre>
<h5 data-id="heading-7">在服务端网站中创建文件夹HandheldApp，将生成的APK都保存到此目录中</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d3f76190c9e4967aa104bf5c70164c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5aS06Zeq5Lqu5Lqu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767258021&amp;x-signature=buTbE5w5u8ljUwZVsJFAQSuhuks%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-8">在HandheldApp目录中创建UpdateVersion_Materials.xml</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">update</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>BoilerAndroid_1.1<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://192.168.10.5:80/OA/HandheldAPP/Materials.apk<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">updateinfo</span>&gt;</span>1.增加收藏功能<span class="hljs-tag">&lt;/<span class="hljs-name">updateinfo</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android手持机扫码出入库的开发详解-7.SQLite CRUD操作]]></title>    <link>https://juejin.cn/post/7587459328070434826</link>    <guid>https://juejin.cn/post/7587459328070434826</guid>    <pubDate>2025-12-25T09:06:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587459328070434826" data-draft-id="7587459328070418442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android手持机扫码出入库的开发详解-7.SQLite CRUD操作"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-25T09:06:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="光头闪亮亮"/> <meta itemprop="url" content="https://juejin.cn/user/1333047014199326"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android手持机扫码出入库的开发详解-7.SQLite CRUD操作
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1333047014199326/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    光头闪亮亮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T09:06:08.000Z" title="Thu Dec 25 2025 09:06:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Android手持机扫码出入库的开发详解-7.SQLite CRUD操作</h2>
<h3 data-id="heading-1">SQLite CRUD操作</h3>
<h4 data-id="heading-2">SQLite CRUD程序图</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    subgraph SQLite数据交互架构
        subgraph 实体层
            InStorage[&amp;#34;InStorage.java\n入库实体类&amp;#34;]
        end
        
        subgraph DAO接口层
            InStorageDAO[&amp;#34;InStorageDAO.java\nCRUD操作接口&amp;#34;]
        end
        
        subgraph DAO实现层
            InStorageDAOSqliteImpl[&amp;#34;InStorageDAOSqliteImpl.java\nSQLite具体实现&amp;#34;]
            TableCreation[&amp;#34;表创建与管理&amp;#34;]
            Transaction[&amp;#34;事务处理&amp;#34;]
            InStorageDAOSqliteImpl --&gt; TableCreation
            InStorageDAOSqliteImpl --&gt; Transaction
        end
        
        subgraph 控制器层
            InStorageScanCode[&amp;#34;InStorageScanCode.java\n入库扫码控制器&amp;#34;]
            ScanReceiver[&amp;#34;扫码广播接收器&amp;#34;]
            AsyncTask[&amp;#34;异步任务处理&amp;#34;]
            DataList[&amp;#34;数据列表展示&amp;#34;]
            InStorageScanCode --&gt; ScanReceiver
            InStorageScanCode --&gt; AsyncTask
            InStorageScanCode --&gt; DataList
        end
        
        subgraph 工具类
            DAOFactory[&amp;#34;DAOFactory.java\nDAO工厂&amp;#34;]
            SqliteDBConnection[&amp;#34;SqliteDBConnection.java\nSQLite连接管理&amp;#34;]
            ConnectionPool[&amp;#34;连接池管理&amp;#34;]
            CloseResources[&amp;#34;资源关闭机制&amp;#34;]
            SqliteDBConnection --&gt; ConnectionPool
            SqliteDBConnection --&gt; CloseResources
        end
        
        subgraph 数据流向
            ScanReceiver --&gt; |扫码数据| SaveData[&amp;#34;SaveDataToSqlite&amp;#34;]
            SaveData --&gt; |创建实体| InStorage
            InStorage --&gt; |批量插入| InStorageDAO
            AsyncTask --&gt; |删除/上传| InStorageDAO
            DataList --&gt; |查询| InStorageDAO
        end
        
        %% 模块间关系
        InStorageScanCode --&gt; |获取实例| DAOFactory
        DAOFactory --&gt; |创建| InStorageDAOSqliteImpl
        InStorageDAOSqliteImpl --&gt; |实现| InStorageDAO
        InStorageScanCode --&gt; |数据库连接| SqliteDBConnection
        InStorageDAOSqliteImpl --&gt; |操作数据库| SqliteDBConnection
    end
    
    %% 整体流程
    User[用户操作] --&gt; |扫码| ScanReceiver
    User --&gt; |查询| InStorageScanCode
    User --&gt; |删除| InStorageScanCode
    User --&gt; |上传| InStorageScanCode
    DataList --&gt; |更新UI| UI[界面展示]
    AsyncTask --&gt; |操作结果| UI
</code></pre>
<h4 data-id="heading-3">SQLite CRUD源代码</h4>
<h5 data-id="heading-4">1. 实体类 (entity/InStorage.java)</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> cbw.materials.entity;

<span class="hljs-keyword">import</span> java.io.Serializable;

<span class="hljs-comment">/**
 * 入库实体类
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InStorage</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> {
    <span class="hljs-keyword">private</span> String str_货位号;
    <span class="hljs-keyword">private</span> String str_材料名称;
    <span class="hljs-keyword">private</span> String str_材料规格;
    <span class="hljs-keyword">private</span> String str_颜色;
    <span class="hljs-keyword">private</span> String str_库管员;
    <span class="hljs-keyword">private</span> String str_厂家缩写;
    <span class="hljs-keyword">private</span> String str_CBW对照号;
    <span class="hljs-keyword">private</span> String str_单位;
    <span class="hljs-keyword">private</span> String str_材料条码;
    <span class="hljs-keyword">private</span> String str_厂家代码;
    <span class="hljs-keyword">private</span> String str_生产日期;
    <span class="hljs-keyword">private</span> String str_批号;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> int_数量;
    <span class="hljs-keyword">private</span> String str_库管编码;
    <span class="hljs-keyword">private</span> String str_码文;
    <span class="hljs-keyword">private</span> String str_扫码人;
    <span class="hljs-keyword">private</span> String str_扫码时间;
    <span class="hljs-keyword">private</span> String str_扫码仓库;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> int_上传标记;
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> Long_ID;

    <span class="hljs-comment">/**
     * 创建默认实例
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> InStorage <span class="hljs-title function_">newInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-type">InStorage</span> <span class="hljs-variable">inStorage</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InStorage</span>();
        inStorage.setStr_货位号(<span class="hljs-string">""</span>);
        inStorage.setStr_材料名称(<span class="hljs-string">""</span>);
        inStorage.setStr_材料规格(<span class="hljs-string">""</span>);
        inStorage.setStr_颜色(<span class="hljs-string">""</span>);
        inStorage.setStr_库管员(<span class="hljs-string">""</span>);
        inStorage.setStr_厂家缩写(<span class="hljs-string">""</span>);
        inStorage.setStr_CBW对照号(<span class="hljs-string">""</span>);
        inStorage.setStr_单位(<span class="hljs-string">""</span>);
        inStorage.setStr_材料条码(<span class="hljs-string">""</span>);
        inStorage.setStr_厂家代码(<span class="hljs-string">""</span>);
        inStorage.setStr_生产日期(<span class="hljs-string">""</span>);
        inStorage.setStr_批号(<span class="hljs-string">""</span>);
        inStorage.setInt_数量(<span class="hljs-number">0</span>);
        inStorage.setStr_库管编码(<span class="hljs-string">""</span>);
        inStorage.setStr_码文(<span class="hljs-string">""</span>);
        inStorage.setStr_扫码人(<span class="hljs-string">""</span>);
        inStorage.setStr_扫码时间(<span class="hljs-string">""</span>);
        inStorage.setStr_扫码仓库(<span class="hljs-string">""</span>);
        inStorage.setInt_上传标记(<span class="hljs-number">0</span>);
        inStorage.setLong_ID(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">return</span> inStorage;
    }

    <span class="hljs-comment">// 省略getter和setter方法...</span>
}
</code></pre>
<h5 data-id="heading-5">2. DAO接口 (dao/InStorageDAO.java)</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> cbw.materials.dao;

<span class="hljs-keyword">import</span> android.database.Cursor;
<span class="hljs-keyword">import</span> android.database.sqlite.SQLiteDatabase;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">import</span> cbw.materials.entity.InStorage;

<span class="hljs-comment">/**
 * 入库数据访问接口
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">InStorageDAO</span> {
    <span class="hljs-comment">/**
     * 插入单条数据
     */</span>
    Cursor <span class="hljs-title function_">insertData</span><span class="hljs-params">(SQLiteDatabase db, InStorage inStorage)</span> <span class="hljs-keyword">throws</span> Exception;

    <span class="hljs-comment">/**
     * 插入多条数据
     */</span>
    Cursor <span class="hljs-title function_">insertDatas</span><span class="hljs-params">(SQLiteDatabase db, List&lt;InStorage&gt; inStorages)</span> <span class="hljs-keyword">throws</span> Exception;

    <span class="hljs-comment">/**
     * 删除单条数据
     */</span>
    Cursor <span class="hljs-title function_">deleteData</span><span class="hljs-params">(SQLiteDatabase db, <span class="hljs-type">long</span> Id)</span> <span class="hljs-keyword">throws</span> Exception;

    <span class="hljs-comment">/**
     * 删除所有数据
     */</span>
    Cursor <span class="hljs-title function_">deleteAllData</span><span class="hljs-params">(SQLiteDatabase db)</span> <span class="hljs-keyword">throws</span> Exception;

    <span class="hljs-comment">/**
     * 根据条件删除数据
     */</span>
    Cursor <span class="hljs-title function_">deleteCriteriaData</span><span class="hljs-params">(SQLiteDatabase db, String Criteria)</span> <span class="hljs-keyword">throws</span> Exception;

    <span class="hljs-comment">/**
     * 查询所有数据
     */</span>
    Cursor <span class="hljs-title function_">queryAll</span><span class="hljs-params">(SQLiteDatabase db)</span> <span class="hljs-keyword">throws</span> Exception;

    <span class="hljs-comment">/**
     * 根据ID查询数据
     */</span>
    InStorage <span class="hljs-title function_">findById</span><span class="hljs-params">(SQLiteDatabase db, <span class="hljs-type">long</span> Id)</span> <span class="hljs-keyword">throws</span> Exception;

    <span class="hljs-comment">/**
     * 分页查询数据
     */</span>
    List&lt;InStorage&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">(<span class="hljs-type">int</span> page, <span class="hljs-type">int</span> rowsPerPage)</span> <span class="hljs-keyword">throws</span> Exception;

    <span class="hljs-comment">/**
     * 检查并创建表
     */</span>
    String <span class="hljs-title function_">checkCreateTable</span><span class="hljs-params">(SQLiteDatabase db)</span> <span class="hljs-keyword">throws</span> Exception;

    <span class="hljs-comment">/**
     * 更新数据
     */</span>
    Cursor <span class="hljs-title function_">updateData</span><span class="hljs-params">(SQLiteDatabase db, InStorage inStorage)</span> <span class="hljs-keyword">throws</span> Exception;
}
</code></pre>
<h5 data-id="heading-6">3. DAO实现类 (dao/impl/InStorageDAOSqliteImpl.java)</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> cbw.materials.dao.impl;

<span class="hljs-keyword">import</span> android.content.ContentValues;
<span class="hljs-keyword">import</span> android.database.Cursor;
<span class="hljs-keyword">import</span> android.database.sqlite.SQLiteDatabase;
<span class="hljs-keyword">import</span> android.util.Log;
<span class="hljs-keyword">import</span> java.sql.SQLException;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> cbw.materials.entity.InStorage;
<span class="hljs-keyword">import</span> cbw.materials.dao.InStorageDAO;
<span class="hljs-keyword">import</span> cbw.materials.util.SqliteQueryData;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InStorageDAOSqliteImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InStorageDAO</span> {
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">KEY_ROWID</span> <span class="hljs-operator">=</span> <span class="hljs-string">"_ID"</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String KEY_货位号=<span class="hljs-string">"货位号"</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String KEY_材料名称=<span class="hljs-string">"材料名称"</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String KEY_材料规格=<span class="hljs-string">"材料规格"</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String KEY_颜色=<span class="hljs-string">"颜色"</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String KEY_库管员=<span class="hljs-string">"库管员"</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String KEY_厂家缩写=<span class="hljs-string">"厂家缩写"</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String KEY_CBW对照号=<span class="hljs-string">"CBW对照号"</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String KEY_单位=<span class="hljs-string">"单位"</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String KEY_材料条码=<span class="hljs-string">"材料条码"</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String KEY_厂家代码=<span class="hljs-string">"厂家代码"</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String KEY_生产日期=<span class="hljs-string">"生产日期"</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String KEY_批号=<span class="hljs-string">"批号"</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String KEY_数量=<span class="hljs-string">"数量"</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String KEY_库管编码=<span class="hljs-string">"库管编码"</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String KEY_码文=<span class="hljs-string">"码文"</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String KEY_扫码人=<span class="hljs-string">"扫码人"</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String KEY_扫码时间=<span class="hljs-string">"扫码时间"</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String KEY_扫码仓库=<span class="hljs-string">"扫码仓库"</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String KEY_上传标记=<span class="hljs-string">"上传标记"</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String message=<span class="hljs-string">""</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SqliteDBConnection"</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DATABASE_TABLE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"InStorageScanCodes"</span>;
    <span class="hljs-keyword">private</span> SqliteQueryData sqliteQueryData=<span class="hljs-keyword">new</span> <span class="hljs-title class_">SqliteQueryData</span>();
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Cursor <span class="hljs-title function_">insertData</span><span class="hljs-params">(SQLiteDatabase db, InStorage inStorage)</span> <span class="hljs-keyword">throws</span> Exception {

        ContentValues initialValues;
        Cursor cursor=<span class="hljs-literal">null</span>;
        db.beginTransaction();
        <span class="hljs-keyword">try</span> {
            initialValues = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ContentValues</span>();
            initialValues.put(KEY_货位号,inStorage.getStr_货位号());
            initialValues.put(KEY_材料名称,inStorage.getStr_材料名称());
            initialValues.put(KEY_材料规格,inStorage.getStr_材料规格());
            initialValues.put(KEY_颜色,inStorage.getStr_颜色());
            initialValues.put(KEY_库管员,inStorage.getStr_库管员());
            initialValues.put(KEY_厂家缩写,inStorage.getStr_厂家缩写());
            initialValues.put(KEY_CBW对照号,inStorage.getStr_CBW对照号());
            initialValues.put(KEY_单位,inStorage.getStr_单位());
            initialValues.put(KEY_材料条码,inStorage.getStr_材料条码());
            initialValues.put(KEY_厂家代码,inStorage.getStr_厂家代码());
            initialValues.put( KEY_生产日期,inStorage.getStr_生产日期());
            initialValues.put(KEY_批号,inStorage.getStr_批号());
            initialValues.put(KEY_数量,inStorage.getInt_数量());
            initialValues.put(KEY_库管编码,inStorage.getStr_库管编码());
            initialValues.put(KEY_码文,inStorage.getStr_码文());
            initialValues.put(KEY_扫码人,inStorage.getStr_扫码人());
            initialValues.put(KEY_扫码时间,inStorage.getStr_扫码时间());
            initialValues.put(KEY_扫码仓库,inStorage.getStr_扫码仓库());
            initialValues.put(KEY_上传标记,inStorage.getInt_上传标记());
           <span class="hljs-type">long</span> l=db.insert(DATABASE_TABLE, <span class="hljs-literal">null</span>,initialValues);

            <span class="hljs-comment">// 设置事务标志为成功，当结束事务时就会提交事务</span>
            db.setTransactionSuccessful();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// 结束事务</span>
            db.endTransaction();

        }
        String str_Sql=<span class="hljs-string">"select top 1  _id,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"货位号,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"材料名称,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"材料规格,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"颜色,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"库管员,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"厂家缩写,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"CBW对照号,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"单位,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"材料条码,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"厂家代码,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"生产日期,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"批号,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"数量,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"库管编码,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"码文,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"扫码人,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"扫码时间,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"扫码仓库,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"上传标记"</span>;
        str_Sql = str_Sql + <span class="hljs-string">" from instoragescancodes order by _id desc"</span>;
        cursor=sqliteQueryData.RowsCols(db,str_Sql);
        <span class="hljs-keyword">return</span> cursor;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Cursor <span class="hljs-title function_">insertDatas</span><span class="hljs-params">(SQLiteDatabase db, List&lt;InStorage&gt;  inStorages)</span> <span class="hljs-keyword">throws</span> Exception {
        ContentValues initialValues;
        Cursor cursor=<span class="hljs-literal">null</span>;
        db.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">for</span>(InStorage inStorage:inStorages){
                initialValues = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ContentValues</span>();
                initialValues.put(KEY_货位号,inStorage.getStr_货位号());
                initialValues.put(KEY_材料名称,inStorage.getStr_材料名称());
                initialValues.put(KEY_材料规格,inStorage.getStr_材料规格());
                initialValues.put(KEY_颜色,inStorage.getStr_颜色());
                initialValues.put(KEY_库管员,inStorage.getStr_库管员());
                initialValues.put(KEY_厂家缩写,inStorage.getStr_厂家缩写());
                initialValues.put(KEY_CBW对照号,inStorage.getStr_CBW对照号());
                initialValues.put(KEY_单位,inStorage.getStr_单位());
                initialValues.put(KEY_材料条码,inStorage.getStr_材料条码());
                initialValues.put(KEY_厂家代码,inStorage.getStr_厂家代码());
                initialValues.put( KEY_生产日期,inStorage.getStr_生产日期());
                initialValues.put(KEY_批号,inStorage.getStr_批号());
                initialValues.put(KEY_数量,inStorage.getInt_数量());
                initialValues.put(KEY_库管编码,inStorage.getStr_库管编码());
                initialValues.put(KEY_码文,inStorage.getStr_码文());
                initialValues.put(KEY_扫码人,inStorage.getStr_扫码人());
                initialValues.put(KEY_扫码时间,inStorage.getStr_扫码时间());
                initialValues.put(KEY_扫码仓库,inStorage.getStr_扫码仓库());
                initialValues.put(KEY_上传标记,inStorage.getInt_上传标记());
                <span class="hljs-type">long</span> l=db.insert(DATABASE_TABLE, <span class="hljs-literal">null</span>,initialValues);
            }
            <span class="hljs-comment">// 设置事务标志为成功，当结束事务时就会提交事务</span>
            db.setTransactionSuccessful();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// 结束事务</span>
            db.endTransaction();

        }
        String str_Sql=<span class="hljs-string">"select  _id,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"货位号,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"材料名称,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"材料规格,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"颜色,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"库管员,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"厂家缩写,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"CBW对照号,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"单位,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"材料条码,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"厂家代码,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"生产日期,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"批号,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"数量,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"库管编码,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"码文,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"扫码人,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"扫码时间,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"扫码仓库,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"上传标记"</span>;
        str_Sql = str_Sql + <span class="hljs-string">" from instoragescancodes order by _id desc"</span>;
        cursor=sqliteQueryData.RowsCols(db,str_Sql);
        <span class="hljs-keyword">return</span> cursor;

    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Cursor <span class="hljs-title function_">updateData</span><span class="hljs-params">(SQLiteDatabase db, InStorage inStorage, <span class="hljs-type">long</span> Id)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Cursor <span class="hljs-title function_">deleteData</span><span class="hljs-params">(SQLiteDatabase db, <span class="hljs-type">long</span> Id)</span> <span class="hljs-keyword">throws</span> Exception {
        Cursor cursor=<span class="hljs-literal">null</span>;
        <span class="hljs-type">int</span> bol=db.delete(DATABASE_TABLE, KEY_ROWID + <span class="hljs-string">"="</span> +Id, <span class="hljs-literal">null</span>);
        <span class="hljs-keyword">if</span>( bol&gt;<span class="hljs-number">0</span>){
            String str_Sql=<span class="hljs-string">"select  _id,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"货位号,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"材料名称,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"材料规格,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"颜色,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"库管员,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"厂家缩写,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"CBW对照号,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"单位,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"材料条码,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"厂家代码,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"生产日期,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"批号,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"数量,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"库管编码,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"码文,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"扫码人,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"扫码时间,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"扫码仓库,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"上传标记"</span>;
            str_Sql = str_Sql + <span class="hljs-string">" from instoragescancodes order by _id desc"</span>;
            cursor=sqliteQueryData.RowsCols(db,str_Sql);
        }
        <span class="hljs-keyword">return</span> cursor;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Cursor <span class="hljs-title function_">deleteAllData</span><span class="hljs-params">(SQLiteDatabase db)</span> <span class="hljs-keyword">throws</span> Exception {
        Cursor cursor=<span class="hljs-literal">null</span>;
        db.execSQL(<span class="hljs-string">"delete from instoragescancodes"</span>);
        <span class="hljs-comment">//下面执行的SQL语句将数据表的ID归零，因为在创建表后ID列的值会在sqlite_sequence表中进行记录</span>
        db.execSQL(<span class="hljs-string">"UPDATE sqlite_sequence SET seq = 0 WHERE name ='instoragescancodes'"</span>);
        String str_Sql=<span class="hljs-string">"select _id,货位号,材料条码,扫码人,编码,时间 from instoragescancodes order by _id desc"</span>;
        cursor=sqliteQueryData.RowsCols(db,str_Sql);
        <span class="hljs-keyword">return</span> cursor;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">deleteCriteriaData</span><span class="hljs-params">(SQLiteDatabase db, String str_Sql)</span> <span class="hljs-keyword">throws</span> Exception {
        String strInfo=<span class="hljs-string">""</span>;
        db.execSQL(str_Sql.toString());
        strInfo=<span class="hljs-string">"根据条件删除数据完毕！"</span>;
        Log.d(<span class="hljs-string">"debug"</span>,<span class="hljs-string">"根据条件删除数据完毕！\n"</span>+str_Sql);
        <span class="hljs-keyword">return</span> strInfo;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">checkCreateTable</span><span class="hljs-params">(SQLiteDatabase db)</span> <span class="hljs-keyword">throws</span> Exception {
        String strCreateTableInfo=<span class="hljs-string">""</span>;
        <span class="hljs-comment">//执行DDL创建数据表</span>
        <span class="hljs-type">Cursor</span> <span class="hljs-variable">cursor</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">oSql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"select count(*) as c from sqlite_master where type ='table' and name ='instoragescancodes' "</span>;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> sqliteQueryData.getCount(db, oSql);
            <span class="hljs-keyword">if</span> (count == <span class="hljs-number">0</span>) {
                strCreateTableInfo = <span class="hljs-string">"数据表InStorageScanCodes不存在？"</span>;
                Log.d(<span class="hljs-string">"debug"</span>, <span class="hljs-string">"数据表InStorageScanCodes不存在？"</span>);
                <span class="hljs-type">String</span> <span class="hljs-variable">str_Sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"create table instoragescancodes("</span>;
                str_Sql = str_Sql + <span class="hljs-string">"_id INTEGER primary key autoincrement,"</span>;
                str_Sql = str_Sql + <span class="hljs-string">"货位号 text not null,"</span>;
                str_Sql = str_Sql + <span class="hljs-string">"材料名称 text null,"</span>;
                str_Sql = str_Sql + <span class="hljs-string">"材料规格 text null,"</span>;
                str_Sql = str_Sql + <span class="hljs-string">"颜色 text null,"</span>;
                str_Sql = str_Sql + <span class="hljs-string">"库管员 text  null,"</span>;
                str_Sql = str_Sql + <span class="hljs-string">"厂家缩写 text  null,"</span>;
                str_Sql = str_Sql + <span class="hljs-string">"CBW对照号 text  null,"</span>;
                str_Sql = str_Sql + <span class="hljs-string">"单位 text  null,"</span>;
                str_Sql = str_Sql + <span class="hljs-string">"材料条码 text null,"</span>;
                str_Sql = str_Sql + <span class="hljs-string">"厂家代码 text null,"</span>;
                str_Sql = str_Sql + <span class="hljs-string">"生产日期 text null,"</span>;
                str_Sql = str_Sql + <span class="hljs-string">"批号 text null,"</span>;
                str_Sql = str_Sql + <span class="hljs-string">"数量 int null,"</span>;
                str_Sql = str_Sql + <span class="hljs-string">"库管编码 text null,"</span>;
                str_Sql = str_Sql + <span class="hljs-string">"码文 text not null,"</span>;
                str_Sql = str_Sql + <span class="hljs-string">"扫码人 text not null,"</span>;
                str_Sql = str_Sql + <span class="hljs-string">"扫码时间 text not null,"</span>;
                str_Sql = str_Sql + <span class="hljs-string">"扫码仓库 text not null,"</span>;
                str_Sql = str_Sql + <span class="hljs-string">"上传标记 int null"</span>;
                str_Sql = str_Sql + <span class="hljs-string">")"</span>;
                db.execSQL(str_Sql.toString());
                <span class="hljs-comment">//提示信息</span>
                strCreateTableInfo = <span class="hljs-string">"数据表InStorageScanCodes创建完毕！"</span>;
                Log.d(<span class="hljs-string">"debug"</span>, <span class="hljs-string">"数据表InStorageScanCodes创建完毕！"</span>);
            }

        } <span class="hljs-keyword">catch</span> (SQLException e) {
            e.printStackTrace();
        }
        <span class="hljs-keyword">return</span> strCreateTableInfo;

    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String  <span class="hljs-title function_">createTable</span><span class="hljs-params">(SQLiteDatabase db)</span> <span class="hljs-keyword">throws</span> Exception {
        String strCreateTableInfo=<span class="hljs-string">""</span>;
        <span class="hljs-comment">//执行DDL创建数据表</span>
        <span class="hljs-type">Cursor</span> <span class="hljs-variable">cursor</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">oSql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"select count(*) as c from sqlite_master where type ='table' and name ='instoragescancodes' "</span>;

        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> sqliteQueryData.getCount(db, oSql);
            <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">0</span>) {
                strCreateTableInfo=<span class="hljs-string">"数据表InStorageScanCodes已存在？"</span>;
                db.execSQL(<span class="hljs-string">"drop table instoragescancodes"</span>);
                Log.d(<span class="hljs-string">"debug"</span>, <span class="hljs-string">"数据表InStorageScanCodes删除完毕！"</span>);
            }
            <span class="hljs-type">String</span> <span class="hljs-variable">str_Sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"create table instoragescancodes("</span>;
            str_Sql = str_Sql + <span class="hljs-string">"_id INTEGER primary key autoincrement,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"货位号 text not null,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"材料名称 text null,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"材料规格 text null,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"颜色 text null,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"库管员 text  null,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"厂家缩写 text  null,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"CBW对照号 text  null,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"单位 text  null,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"材料条码 text null,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"厂家代码 text null,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"生产日期 text null,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"批号 text null,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"数量 int null,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"库管编码 text null,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"码文 text not null,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"扫码人 text not null,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"扫码时间 text not null,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"扫码仓库 text not null,"</span>;
            str_Sql = str_Sql + <span class="hljs-string">"上传标记 int null"</span>;
            str_Sql = str_Sql + <span class="hljs-string">")"</span>;
            db.execSQL(str_Sql.toString());
            <span class="hljs-comment">//提示信息</span>
            strCreateTableInfo = <span class="hljs-string">"手持机【入库扫码表】数据清理完毕！"</span>;
            Log.d(<span class="hljs-string">"debug"</span>, <span class="hljs-string">"数据表InStorageScanCodes创建完毕"</span>);


        } <span class="hljs-keyword">catch</span> (SQLException e) {
            e.printStackTrace();
        }
        <span class="hljs-keyword">return</span> strCreateTableInfo;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> InStorage <span class="hljs-title function_">findById</span><span class="hljs-params">(SQLiteDatabase db, <span class="hljs-type">long</span> Id)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;InStorage&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">(SQLiteDatabase db)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;InStorage&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">(SQLiteDatabase db, String queryBuilder)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;InStorage&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">(SQLiteDatabase db, <span class="hljs-type">int</span> page, <span class="hljs-type">int</span> rowsPerPage)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;InStorage&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">(SQLiteDatabase db, String queryBuilder, <span class="hljs-type">int</span> page, <span class="hljs-type">int</span> rowsPerPage)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getTotalPages</span><span class="hljs-params">(SQLiteDatabase db, <span class="hljs-type">int</span> rowsPerPage)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getTotalPages</span><span class="hljs-params">(SQLiteDatabase db, String customQuery, <span class="hljs-type">int</span> rowsPerPage)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Cursor <span class="hljs-title function_">queryAll</span><span class="hljs-params">(SQLiteDatabase db)</span> <span class="hljs-keyword">throws</span> Exception {
        String str_Sql=<span class="hljs-string">"select _id,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"货位号,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"材料名称,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"材料规格,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"颜色,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"库管员,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"厂家缩写,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"CBW对照号,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"单位,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"材料条码,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"厂家代码,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"生产日期,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"批号,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"数量,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"库管编码,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"码文,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"扫码人,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"扫码时间,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"扫码仓库,"</span>;
        str_Sql = str_Sql + <span class="hljs-string">"上传标记"</span>;
        str_Sql = str_Sql + <span class="hljs-string">" from instoragescancodes"</span>;
        <span class="hljs-comment">//String oSql="select * from contacts";</span>
        <span class="hljs-comment">//Cursor cursor= db.rawQuery(oSql,null);</span>
        Cursor cursor=sqliteQueryData.RowsCols(db,str_Sql);
        <span class="hljs-keyword">return</span> cursor;
    }




}


</code></pre>
<h5 data-id="heading-7">4. 工具类</h5>
<h6 data-id="heading-8">4.1 DAO工厂 (util/DAOFactory.java)</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> cbw.materials.util;

<span class="hljs-keyword">import</span> cbw.materials.dao.BillOfMaterialDAO;
<span class="hljs-keyword">import</span> cbw.materials.dao.InStorageDAO;
<span class="hljs-keyword">import</span> cbw.materials.dao.ManufacturerDAO;
<span class="hljs-keyword">import</span> cbw.materials.dao.StoreKeeperDAO;
<span class="hljs-keyword">import</span> cbw.materials.dao.impl.BillOfMaterialDAOSqliteImpl;
<span class="hljs-keyword">import</span> cbw.materials.dao.impl.InStorageDAOSqliteImpl;
<span class="hljs-keyword">import</span> cbw.materials.dao.impl.ManufacturerDAOSqliteImpl;
<span class="hljs-keyword">import</span> cbw.materials.dao.impl.StoreKeeperDAOSqliteImpl;

<span class="hljs-comment">/**
 * DAO工厂类
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DAOFactory</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">getInstance</span><span class="hljs-params">(String type)</span> {
        <span class="hljs-keyword">if</span> (type.equals(<span class="hljs-string">"InStorageDAO"</span>)) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InStorageDAOSqliteImpl</span>();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type.equals(<span class="hljs-string">"BillOfMaterialDAO"</span>)) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BillOfMaterialDAOSqliteImpl</span>();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type.equals(<span class="hljs-string">"ManufacturerDAO"</span>)) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ManufacturerDAOSqliteImpl</span>();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type.equals(<span class="hljs-string">"StoreKeeperDAO"</span>)) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StoreKeeperDAOSqliteImpl</span>();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<h6 data-id="heading-9">4.2 SQLite数据库连接 (util/SqliteDBConnection.java)</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> cbw.materials.util;

<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.database.sqlite.SQLiteDatabase;
<span class="hljs-keyword">import</span> android.database.sqlite.SQLiteOpenHelper;

<span class="hljs-comment">/**
 * SQLite数据库连接管理
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SqliteDBConnection</span> {
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DATABASE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"IMDB"</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">DATABASE_VERSION</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
    <span class="hljs-keyword">private</span> SQLiteDatabase db;
    <span class="hljs-keyword">private</span> DatabaseHelper DBHelper;

    <span class="hljs-comment">/**
     * 构造函数
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SqliteDBConnection</span><span class="hljs-params">(Context ctx)</span> {
        <span class="hljs-built_in">this</span>.DBHelper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DatabaseHelper</span>(ctx);
    }

    <span class="hljs-comment">/**
     * 打开数据库连接
     */</span>
    <span class="hljs-keyword">public</span> SqliteDBConnection <span class="hljs-title function_">open</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException {
        db = DBHelper.getWritableDatabase();
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
    }

    <span class="hljs-comment">/**
     * 获取数据库实例
     */</span>
    <span class="hljs-keyword">public</span> SQLiteDatabase <span class="hljs-title function_">getDb</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> db;
    }

    <span class="hljs-comment">/**
     * 关闭数据库连接
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
        DBHelper.close();
    }

    <span class="hljs-comment">/**
     * 数据库帮助类
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseHelper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SQLiteOpenHelper</span> {
        DatabaseHelper(Context context) {
            <span class="hljs-built_in">super</span>(context, DATABASE_NAME, <span class="hljs-literal">null</span>, DATABASE_VERSION);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(SQLiteDatabase db)</span> {
            <span class="hljs-comment">// 数据库创建时执行</span>
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onUpgrade</span><span class="hljs-params">(SQLiteDatabase db, <span class="hljs-type">int</span> oldVersion, <span class="hljs-type">int</span> newVersion)</span> {
            <span class="hljs-comment">// 数据库升级时执行</span>
        }
    }
}
</code></pre>
<h5 data-id="heading-10">5. 控制器 (controller/InStorageScanCode.java)</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> cbw.materials.controller;

<span class="hljs-keyword">import</span> android.content.BroadcastReceiver;
<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.content.Intent;
<span class="hljs-keyword">import</span> android.database.Cursor;
<span class="hljs-keyword">import</span> android.database.sqlite.SQLiteDatabase;
<span class="hljs-keyword">import</span> android.os.AsyncTask;
<span class="hljs-keyword">import</span> android.widget.Toast;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">import</span> cbw.materials.dao.InStorageDAO;
<span class="hljs-keyword">import</span> cbw.materials.entity.InStorage;
<span class="hljs-keyword">import</span> cbw.materials.util.DAOFactory;
<span class="hljs-keyword">import</span> cbw.materials.util.SqliteDBConnection;

<span class="hljs-comment">/**
 * 入库扫码控制器
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InStorageScanCode</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> {
    <span class="hljs-keyword">private</span> SQLiteDatabase db;
    <span class="hljs-keyword">private</span> <span class="hljs-type">InStorageDAO</span> <span class="hljs-variable">dao</span> <span class="hljs-operator">=</span> (InStorageDAO) DAOFactory.getInstance(<span class="hljs-string">"InStorageDAO"</span>);
    <span class="hljs-keyword">private</span> SqliteDBConnection sda;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String userName;

    <span class="hljs-comment">// 扫码广播接收器</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">BroadcastReceiver</span> <span class="hljs-variable">mScanReceiver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastReceiver</span>() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> {
            <span class="hljs-type">byte</span>[] barocode = intent.getByteArrayExtra(<span class="hljs-string">"barocode"</span>);
            <span class="hljs-type">int</span> <span class="hljs-variable">barocodelen</span> <span class="hljs-operator">=</span> intent.getIntExtra(<span class="hljs-string">"length"</span>, <span class="hljs-number">0</span>);
            <span class="hljs-type">String</span> <span class="hljs-variable">barcodeStr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(barocode, <span class="hljs-number">0</span>, barocodelen);

            <span class="hljs-comment">// 解析扫码数据并保存到SQLite</span>
            <span class="hljs-keyword">if</span> (strCode != <span class="hljs-literal">null</span> &amp;&amp; strHwh != <span class="hljs-literal">null</span>) {
                String[] codes = strCode.split(<span class="hljs-string">","</span>);
                SaveDataToSqlite(codes, strHwh);
            }
        }
    };

    <span class="hljs-comment">// 保存数据到SQLite</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SaveDataToSqlite</span><span class="hljs-params">(String[] Codes, String Hwh)</span> {
        List&lt;InStorage&gt; inStorages = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; Codes.length; i++) {
            <span class="hljs-type">InStorage</span> <span class="hljs-variable">inStorage</span> <span class="hljs-operator">=</span> InStorage.newInstance();
            inStorage.setStr_货位号(Hwh);
            inStorage.setStr_码文(Codes[i]);
            inStorage.setStr_扫码人(userName);
            inStorage.setStr_扫码时间(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>).format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()));
            
            <span class="hljs-comment">// 解析条码信息</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">str_code</span> <span class="hljs-operator">=</span> Codes[i] + <span class="hljs-string">" "</span>;
            inStorage.setStr_材料条码(str_code.substring(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>));
            inStorage.setStr_厂家代码(str_code.substring(<span class="hljs-number">5</span>, <span class="hljs-number">7</span>));
            inStorage.setStr_生产日期(ConvertDate(str_code.substring(<span class="hljs-number">7</span>, <span class="hljs-number">13</span>)));
            inStorage.setStr_批号(str_code.substring(<span class="hljs-number">13</span>, <span class="hljs-number">14</span>));
            inStorage.setInt_数量(Integer.parseInt(str_code.substring(<span class="hljs-number">14</span>, <span class="hljs-number">20</span>)));
            inStorage.setStr_库管编码(str_code.substring(<span class="hljs-number">20</span>, <span class="hljs-number">21</span>));
            
            inStorages.add(inStorage);
        }

        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (sda == <span class="hljs-literal">null</span>) {
                OpenOrCreateDatabase();
            }
            <span class="hljs-type">String</span> <span class="hljs-variable">str_CreateTableInfo</span> <span class="hljs-operator">=</span> dao.checkCreateTable(db);
            <span class="hljs-type">Cursor</span> <span class="hljs-variable">cursor</span> <span class="hljs-operator">=</span> dao.insertDatas(db, inStorages);
            Refresh_ListView(cursor);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-comment">// 删除数据异步任务</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeleteDataOnClickListenerImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">View</span>.OnClickListener {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> {
            <span class="hljs-comment">// 确认对话框</span>
            <span class="hljs-type">Dialog</span> <span class="hljs-variable">dialog</span> <span class="hljs-operator">=</span> dialogTool.dialog(InStorageScanCode.<span class="hljs-built_in">this</span>, <span class="hljs-string">"提示信息？"</span>, R.drawable.user, <span class="hljs-string">"你确定要删除ID为&lt;&lt;"</span> + P_Id + <span class="hljs-string">"&gt;&gt;的记录吗？"</span>);
            dialog.show();
            executeFunctionName = <span class="hljs-string">"DeleteData"</span>;
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryAddressTask</span>().execute(<span class="hljs-string">"DeleteData"</span>);
        }
    }

    <span class="hljs-comment">// 异步任务类</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">QueryAddressTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AsyncTask</span>&lt;String, Integer, String&gt; {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> String <span class="hljs-title function_">doInBackground</span><span class="hljs-params">(String... params)</span> {
            <span class="hljs-comment">// 处理后台任务</span>
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onPostExecute</span><span class="hljs-params">(String result)</span> {
            <span class="hljs-keyword">if</span> (executeFunctionName.equals(<span class="hljs-string">"DeleteData"</span>)) {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-type">Cursor</span> <span class="hljs-variable">cursor</span> <span class="hljs-operator">=</span> dao.deleteData(db, Long.parseLong(P_Id));
                    Toast.makeText(InStorageScanCode.<span class="hljs-built_in">this</span>, <span class="hljs-string">"数据删除完毕！"</span>, Toast.LENGTH_LONG).show();
                    Refresh_ListView(cursor);
                } <span class="hljs-keyword">catch</span> (Exception e) {
                    e.printStackTrace();
                }
            }
        }
    }

    <span class="hljs-comment">// 创建或打开数据库</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">OpenOrCreateDatabase</span><span class="hljs-params">()</span> {
        sda = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqliteDBConnection</span>(<span class="hljs-built_in">this</span>);
        sda.open();
        db = sda.getDb();
    }

    <span class="hljs-comment">// 关闭数据库</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">CloseDatabase</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (db != <span class="hljs-literal">null</span> &amp;&amp; db.isOpen()) {
            db.close();
            sda.close();
            db = <span class="hljs-literal">null</span>;
            sda = <span class="hljs-literal">null</span>;
        }
    }

    <span class="hljs-comment">// 刷新列表</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Refresh_ListView</span><span class="hljs-params">(Cursor cursor)</span> {
        <span class="hljs-type">SimpleCursorAdapter</span> <span class="hljs-variable">adapter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleCursorAdapter</span>(
                <span class="hljs-built_in">this</span>,
                R.layout.activity_in_storage_scan_code_listview,
                cursor,
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]{<span class="hljs-string">"_id"</span>, <span class="hljs-string">"货位号"</span>, <span class="hljs-string">"材料名称"</span>, <span class="hljs-string">"材料规格"</span>, <span class="hljs-string">"颜色"</span>, <span class="hljs-string">"库管员"</span>, <span class="hljs-string">"厂家缩写"</span>, <span class="hljs-string">"CBW对照号"</span>, <span class="hljs-string">"单位"</span>, 
                        <span class="hljs-string">"材料条码"</span>, <span class="hljs-string">"厂家代码"</span>, <span class="hljs-string">"生产日期"</span>, <span class="hljs-string">"批号"</span>, <span class="hljs-string">"数量"</span>, <span class="hljs-string">"库管编码"</span>, <span class="hljs-string">"码文"</span>, <span class="hljs-string">"扫码人"</span>, <span class="hljs-string">"扫码时间"</span>, <span class="hljs-string">"扫码仓库"</span>},
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]{R.id.textView_listView_InStorageScanCode_DataList_ID, ...});
        listView_InStorageScanCode_DataList.setAdapter(adapter);
    }

    <span class="hljs-comment">// 其他方法...</span>
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[掌握这9个GO技巧，代码高效又高能]]></title>    <link>https://juejin.cn/post/7587392473851969582</link>    <guid>https://juejin.cn/post/7587392473851969582</guid>    <pubDate>2025-12-25T07:55:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587392473851969582" data-draft-id="7587381515668602907" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="掌握这9个GO技巧，代码高效又高能"/> <meta itemprop="keywords" content="后端,Go"/> <meta itemprop="datePublished" content="2025-12-25T07:55:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ServBay"/> <meta itemprop="url" content="https://juejin.cn/user/3828929445244761"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            掌握这9个GO技巧，代码高效又高能
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3828929445244761/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ServBay
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T07:55:37.000Z" title="Thu Dec 25 2025 07:55:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    15
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你以为Go资深程序员的代码写得有很花哨？其实他们厉害在对语言特性的细节把控。很多时候，一行不起眼的代码调整，就能避免隐晦的内存泄露，或者让吞吐量翻倍。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d228c74a2f1e42f1a9bed373d099bfe7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VydkJheQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767254137&amp;x-signature=D7l%2FfhljPqtCU4LrFjUsc01bxFs%3D" alt="" loading="lazy"/></p>
<p>在深入代码细节前，工欲善其事，必先利其器。Go的版本迭代很快，老项目可能还在用1.16，新项目就已经要用1.23了。在本地管理这些环境如果不顺手，很消磨热情。</p>
<p>这里就不得不提 <strong>ServBay</strong>。它可以<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com" target="_blank" title="https://www.servbay.com" ref="nofollow noopener noreferrer">一键安装Go环境</a>，支持<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com%2Ffeatures%2Fgo" target="_blank" title="https://www.servbay.com/features/go" ref="nofollow noopener noreferrer">多个Go版本共存</a>。开发时可以在不同版本间随意切换，服务也能一键启停。把环境配置这种繁琐事交给工具，我们只专注于代码本身。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/632879000b9e4d7dbc53a08b30085776~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VydkJheQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767254137&amp;x-signature=8y%2FGwiOzJBdhQ9G9xP4T1TpDTD0%3D" alt="" loading="lazy"/></p>
<p>有了顺手的环境，下面聊聊那些实战中四两拨千斤的Go技巧。</p>
<h3 data-id="heading-0">defer：不仅仅是清理，更是安全</h3>
<p><code>defer</code> 的执行在函数返回前执行。新手常用它关闭文件，但它将资源的申请与释放逻辑同位化这点上非常厉害。</p>
<p>把 <code>defer</code> 紧跟在资源获取之后，程序员的压力大大减少，因为不用去追踪函数的每一个 <code>return</code> 分支是否都释放了锁。这也是 Go 错误处理和 panic/recover 机制的基石。</p>
<p><strong>代码示例：</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CopyFile</span><span class="hljs-params">(srcName, dstName <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">error</span> {
    src, err := os.Open(srcName)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> err
    }
    <span class="hljs-comment">// 获取资源后立即注册释放，不用担心后面代码怎么折腾</span>
    <span class="hljs-keyword">defer</span> src.Close()

    dst, err := os.Create(dstName)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> err
    }
    <span class="hljs-keyword">defer</span> dst.Close()

    _, err = io.Copy(dst, src)
    <span class="hljs-keyword">return</span> err
}
</code></pre>
<h3 data-id="heading-1">用 Worker Pool 驯服 Goroutine 暴涨</h3>
<p>Go 的协程（Goroutine）创建成本很低，但不是免费的。无限制地 <code>go func()</code> 会导致内存飙升和调度压力，甚至拖垮下游。生产环境中，<strong>有界并发</strong>才是王道。</p>
<p>使用带有 <code>Context</code> 控制的 Worker Pool 模式，可以精确控制并发度。</p>
<p><strong>代码示例：</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 模拟任务处理</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">taskProcessor</span><span class="hljs-params">(ctx context.Context, jobs &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, results <span class="hljs-keyword">chan</span>&lt;- <span class="hljs-type">int</span>)</span></span> {
    <span class="hljs-keyword">for</span> {
        <span class="hljs-keyword">select</span> {
        <span class="hljs-keyword">case</span> &lt;-ctx.Done():
            <span class="hljs-keyword">return</span> <span class="hljs-comment">// 上下文取消，停止工作</span>
        <span class="hljs-keyword">case</span> job, ok := &lt;-jobs:
            <span class="hljs-keyword">if</span> !ok {
                <span class="hljs-keyword">return</span> <span class="hljs-comment">// 通道关闭，停止工作</span>
            }
            <span class="hljs-comment">// 模拟业务逻辑</span>
            results &lt;- job * <span class="hljs-number">2</span>
        }
    }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">RunPool</span><span class="hljs-params">()</span></span> {
    jobs := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, <span class="hljs-number">10</span>)
    results := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, <span class="hljs-number">10</span>)
    
    ctx, cancel := context.WithCancel(context.Background())
    <span class="hljs-keyword">defer</span> cancel()

    <span class="hljs-comment">// 启动 3 个 worker，严格限制并发数为 3</span>
    <span class="hljs-keyword">for</span> w := <span class="hljs-number">1</span>; w &lt;= <span class="hljs-number">3</span>; w++ {
        <span class="hljs-keyword">go</span> taskProcessor(ctx, jobs, results)
    }

    <span class="hljs-comment">// 发送 5 个任务</span>
    <span class="hljs-keyword">for</span> j := <span class="hljs-number">1</span>; j &lt;= <span class="hljs-number">5</span>; j++ {
        jobs &lt;- j
    }
    <span class="hljs-built_in">close</span>(jobs)

    <span class="hljs-comment">// 获取结果</span>
    <span class="hljs-keyword">for</span> a := <span class="hljs-number">1</span>; a &lt;= <span class="hljs-number">5</span>; a++ {
        fmt.Println(&lt;-results)
    }
}
</code></pre>
<h3 data-id="heading-2">字符串拼接：strings.Builder 是性能杀手锏</h3>
<p>建议不要在循环中使用 <code>+</code> 拼接字符串，Go 性能会降低。字符串不可变，每次 <code>+</code> 都会分配新内存并复制旧内容，造成大量 GC 压力。</p>
<p>而 <strong>strings.Builder</strong> 底层直接操作 <code>[]byte</code>，避免了多余的内存分配。</p>
<p><strong>代码示例：</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BuildLog</span><span class="hljs-params">(parts []<span class="hljs-type">string</span>)</span></span> <span class="hljs-type">string</span> {
    <span class="hljs-keyword">var</span> sb strings.Builder
    <span class="hljs-comment">// 进阶：如果有预估长度，提前 Grow 可进一步减少扩容开销</span>
    <span class="hljs-comment">// sb.Grow(len(parts) * 10) </span>
    
    <span class="hljs-keyword">for</span> _, p := <span class="hljs-keyword">range</span> parts {
        sb.WriteString(p)
    }
    <span class="hljs-keyword">return</span> sb.String()
}
</code></pre>
<p>在大量拼接场景下，<code>Builder</code> 的性能通常是 <code>+</code> 的数倍。</p>
<h3 data-id="heading-3">拒绝 String 和 []byte 的反复转换</h3>
<p>处理 I/O、网络请求或文件时，数据通常是 <code>[]byte</code>。如果为了方便转为 <code>string</code> 处理，处理完又转回 <code>[]byte</code>，会产生大量临时分配。</p>
<p><strong>高效写法：</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 直接操作字节切片，避免 string 转换开销</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">FilterSensitiveBytes</span><span class="hljs-params">(data [][]<span class="hljs-type">byte</span>)</span></span> []<span class="hljs-type">byte</span> {
    <span class="hljs-keyword">var</span> result []<span class="hljs-type">byte</span>
    <span class="hljs-keyword">for</span> _, chunk := <span class="hljs-keyword">range</span> data {
        <span class="hljs-comment">// 直接将字节追加到结果中</span>
        result = <span class="hljs-built_in">append</span>(result, chunk...)
    }
    <span class="hljs-keyword">return</span> result
}
</code></pre>
<p>这种写法在处理 HTTP Body 或日志流时，能显著降低常驻内存占用。</p>
<h3 data-id="heading-4">interface{} 配合类型断言处理动态数据</h3>
<p>空接口 <code>interface{}</code>（Go 1.18+ 可写为 <code>any</code>）配合 Type Switch，是 Go 处理动态数据（如解析未知结构的 JSON）的标准范式。这比反射（Reflection）快得多，也更安全。</p>
<p><strong>代码示例：</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">handleConfig</span><span class="hljs-params">(cfg <span class="hljs-keyword">interface</span>{})</span></span> {
    <span class="hljs-keyword">switch</span> v := cfg.(<span class="hljs-keyword">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-type">string</span>:
        fmt.Printf(<span class="hljs-string">"Config is path: %s\n"</span>, v)
    <span class="hljs-keyword">case</span> <span class="hljs-type">int</span>:
        fmt.Printf(<span class="hljs-string">"Config is timeout: %d\n"</span>, v)
    <span class="hljs-keyword">default</span>:
        fmt.Printf(<span class="hljs-string">"Unknown type: %T\n"</span>, v)
    }
}
</code></pre>
<h3 data-id="heading-5">善用 Context 设置超时</h3>
<p>Go 的并发模型离不开 <code>Context</code>。它不仅用于取消信号，更是防止 goroutine 泄露和请求无限挂起的利器。对于任何网络或阻塞操作，强制加上超时是生产环境的基本素养。</p>
<p><strong>代码示例：</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">heavyWork</span><span class="hljs-params">(ctx context.Context)</span></span> <span class="hljs-type">error</span> {
    <span class="hljs-keyword">select</span> {
    <span class="hljs-keyword">case</span> &lt;-time.After(<span class="hljs-number">2</span> * time.Second): <span class="hljs-comment">// 模拟耗时</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    <span class="hljs-keyword">case</span> &lt;-ctx.Done(): <span class="hljs-comment">// 响应超时或取消</span>
        <span class="hljs-keyword">return</span> ctx.Err()
    }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 设置 1 秒硬性超时</span>
    ctx, cancel := context.WithTimeout(context.Background(), <span class="hljs-number">1</span>*time.Second)
    <span class="hljs-keyword">defer</span> cancel() <span class="hljs-comment">// 必须调用 cancel 释放资源</span>

    <span class="hljs-keyword">if</span> err := heavyWork(ctx); err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">"Work failed:"</span>, err)
    }
}
</code></pre>
<h3 data-id="heading-6">sync.Pool：对象复用，注意细节</h3>
<p>对于高频创建、生命周期短的大对象（如 buffer），<code>sync.Pool</code> 是提升吞吐量的核心手段。但这里有个坑，如果切片发生了扩容，必须把新的切片头更新回去，否则下次拿到的还是旧的小容量切片。</p>
<p><strong>正确写法：</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> bufPool = sync.Pool{
    New: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> any {
        <span class="hljs-comment">// 默认分配 4KB，返回指针以便修改 slice header</span>
        b := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-number">0</span>, <span class="hljs-number">4096</span>)
        <span class="hljs-keyword">return</span> &amp;b
    },
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ProcessStream</span><span class="hljs-params">(data []<span class="hljs-type">byte</span>)</span></span> {
    <span class="hljs-comment">// 1. 获取指针</span>
    bufPtr := bufPool.Get().(*[]<span class="hljs-type">byte</span>)
    
    <span class="hljs-comment">// 2. 解引用得到切片，并重置长度</span>
    buf := *bufPtr
    buf = buf[:<span class="hljs-number">0</span>]
    
    <span class="hljs-comment">// 3. 使用 (append 可能导致扩容，buf 指向新数组)</span>
    buf = <span class="hljs-built_in">append</span>(buf, data...)
    
    <span class="hljs-comment">// ... 业务逻辑 ...</span>

    <span class="hljs-comment">// 4. 【关键】将可能扩容后的 slice header 更新回指针</span>
    *bufPtr = buf
    
    <span class="hljs-comment">// 5. 归还</span>
    bufPool.Put(bufPtr)
}
</code></pre>
<h3 data-id="heading-7">状态保护：Mutex 往往比 Channel 更直观</h3>
<p>Go 的一条法则是：不要通过共享内存来通信，但这不代表不能用锁。对于单纯的状态保护（如计数器、Map缓存），<code>sync.Mutex</code> 无论在性能还是代码清晰度上，往往优于 Channel。</p>
<p><strong>代码示例：</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> SafeStats <span class="hljs-keyword">struct</span> {
    mu    sync.Mutex
    count <span class="hljs-type">int</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *SafeStats)</span></span> Increment() {
    s.mu.Lock()
    <span class="hljs-keyword">defer</span> s.mu.Unlock() <span class="hljs-comment">// 再次体现 defer 的价值</span>
    s.count++
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *SafeStats)</span></span> Get() <span class="hljs-type">int</span> {
    s.mu.Lock()
    <span class="hljs-keyword">defer</span> s.mu.Unlock()
    <span class="hljs-keyword">return</span> s.count
}
</code></pre>
<p>原则：数据流动用 Channel，状态保护用 Mutex。</p>
<h3 data-id="heading-8">自动化格式与导入：goimports</h3>
<p>别把时间浪费在手动排版 imports 顺序上。</p>
<p>配置你的 IDE（VSCode 或 GoLand）在保存时自动运行 <code>goimports</code>。它不仅执行 <code>gofmt</code>，还会自动补全缺失的包、删除没用的包。</p>
<ul>
<li>
<p><strong>VSCode：</strong> 设置 <code>editor.formatOnSave</code> 为 true，Tools 选 <code>goimports</code>。</p>
</li>
<li>
<p><strong>GoLand：</strong> 开启 "Optimize imports" on save。</p>
</li>
</ul>
<hr/>
<p>Go 崇尚简洁，但简洁不代表简单。掌握这些细节，配合像 ServBay 这样高效的环境管理工具，能让代码更健壮，开发体验更流畅。赶紧试试吧。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一夜蒸发1000亿美元后，Google用什么夺回AI王座]]></title>    <link>https://juejin.cn/post/7587412021710667782</link>    <guid>https://juejin.cn/post/7587412021710667782</guid>    <pubDate>2025-12-25T08:07:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587412021710667782" data-draft-id="7587496378055049222" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一夜蒸发1000亿美元后，Google用什么夺回AI王座"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2025-12-25T08:07:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="MobotStone"/> <meta itemprop="url" content="https://juejin.cn/user/3839909554568840"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一夜蒸发1000亿美元后，Google用什么夺回AI王座
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3839909554568840/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    MobotStone
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T08:07:34.000Z" title="Thu Dec 25 2025 08:07:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2022年底，当ChatGPT以摧枯拉朽之势席卷全球时，昔日的AI霸主Google正陷入前所未有的平庸陷阱。市场甚至传出“Google已死”的激进论调。然而，在随后的1000天里，Google通过一场近乎“断臂求生”的内部变革，不仅稳住了阵脚，更凭借Gemini系列的强势迭代，重新夺回了定义未来的主动权。</p>
<p>这场逆转的灵魂人物，正是如今掌管Google AI帝国的奇才——<strong>Demis Hassabis</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d029261f103242ae9842064df3c3eb24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9ib3RTdG9uZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767254854&amp;x-signature=AUeu3T8o3Z%2F5oltAX5VNiuSgv9Y%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-0">天才的觉醒与跨界灵感</h3>
<p>Hassabis的履历是标准的天才范式：4岁学棋，12岁即靠自学在Commodore Amiga古董电脑上编写黑白棋程序，13岁棋力高达ELO 2300分，位居全球少年榜第二。但他并未止步于棋盘，而是选择进入伦敦大学学院（UCL）深造<strong>神经科学</strong>。</p>
<p><strong>核心逻辑：</strong> Hassabis认为，要制造真正的AI，必须先理解人类大脑。这种“生物学+计算机科学”的双重基因，为后来DeepMind探索通用人工智能（AGI）埋下了伏笔。</p>
<p>2010年，他创办DeepMind，吸引了Peter Thiel与Elon Musk的早期注资。随后在一次私人飞机上的谈话中，Musk将哈萨比斯引荐给了Google创始人Larry Page。2014年，Google以5亿英镑将其收入囊中。这笔投资在今天看来，不仅是买下了一家公司，更是买到了通往AGI时代的入场券。</p>
<h3 data-id="heading-1">圣母峰上的神迹与“象牙塔”的困境</h3>
<p>2016年，哈萨比斯率领仅20人的小团队，向AI界的“圣母峰”——围棋发起冲击。AlphaGo以4:1击败李世石，其中的“第37手”震惊全球，那是一步人类棋谱从未记载、极具创造力的落子。那一刻，世界意识到AI已经开始超越人类智慧的边界。</p>
<p>随后的2020年，AlphaFold成功预测两亿种蛋白质结构并开源，哈萨比斯也因此荣膺<strong>2024年诺贝尔化学奖</strong>。然而，光环背后隐藏着危机：<strong>DeepMind长期被视为一个纯粹的学术机构，而非产品部门。</strong></p>
<ul>
<li><strong>观点延伸：</strong> 在硅谷，“实验室文化”与“产品文化”的断层往往是致命的。DeepMind追求完美的科学逻辑，导致其在产品化道路上极度保守。2022年初，DeepMind已研发出代号为“Sparrow”的对话AI，却因追求“完美与安全”迟迟未发布，最终被OpenAI抢占了市场的定义权。</li>
</ul>
<h3 data-id="heading-2">一千亿美元的代价与“双子星”的诞生</h3>
<p>2022年11月30日，ChatGPT横空出世，Google瞬间陷入被动。随后，Google仓促推出的Bard在宣传片中出现常识性错误（关于詹姆斯·韦伯望远镜的描述错误），导致Alphabet市值一夜蒸发1000亿美元。</p>
<p><strong>组织痼疾暴露：</strong> 当时的Google内部山头林立。</p>
<ol>
<li><strong>Google Brain：</strong> 由技术大神Jeff Dean领导的元老级实验室。</li>
<li><strong>DeepMind：</strong> 远在伦敦的天才科学家团队。</li>
<li><strong>Search部门：</strong> 负责Bard等实际产品的落地。</li>
</ol>
<p>这种“三个部门做一个产品”的算力与人才内耗，让CEO Sundar Pichai意识到，必须进行一场大手术。在创始人的背书下，Pichai给予哈萨比斯绝对权力，同时将Jeff Dean升职为首席科学家（实则剥夺管理权）。2023年4月，<strong>Google Brain与DeepMind正式合并为Google DeepMind</strong>，代号“Gemini（双子座）”由此而来。</p>
<h3 data-id="heading-3">断臂求生，决战长文本</h3>
<p>合并初期的Gemini面临着文化冲突与技术标准之争：底层框架到底用Google Brain的TensorFlow还是DeepMind的JAX？</p>
<p>哈萨比斯做出了一个冒险的决定：<strong>全线放弃TensorFlow，统一改用JAX。</strong> 这种底层框架的“大换血”导致Google在2023年整整一年都处于静默期，被OpenAI按在地上摩擦。直到12月，Gemini 1.0才艰难问世。</p>
<p><strong>战术转折：</strong> 哈萨比斯敏锐发现了GPT-4的“阿喀琉斯之踵”——上下文窗口（Memory）。GPT-4当时仅能处理约128K Token，相当于300页书。哈萨比斯决定将所有算力孤注一掷投向**“超长文本处理”**。</p>
<ul>
<li><strong>Gemini 1.5 Pro：</strong> 突破性实现100万甚至200万Token的上下文，能瞬间阅读数十万行代码或整部电影。</li>
<li><strong>降维打击：</strong> 这种差异化竞争让Google在企业级应用中实现了对OpenAI的超车。</li>
</ul>
<h3 data-id="heading-4">算力护城河与3.8兆美元的胜利</h3>
<p>2025年，当全球陷入“算力饥荒”，OpenAI因排队等待英伟达显卡导致GPT-5难产时，Google的深谋远虑显现了威力。</p>
<p>这要归功于被“架空”管理权后的<strong>Jeff Dean</strong>。早在2013年，他就预判如果人人使用语音搜索，Google必须自研芯片才能覆盖成本。这就是<strong>TPU（张量处理单元）</strong> 。</p>
<ul>
<li><strong>成本优势：</strong> 2025年，Google数据中心已部署数十万颗自研TPU（Trillion/Ironwood芯片）。Google无需向英伟达缴纳“信仰税”，其推理成本是业界最低的。</li>
<li><strong>闭环实力：</strong> 这种从自研芯片、底层框架（JAX）、算法模型到海量数据（搜索/YouTube）的全产业链闭环，构成了对手难以逾越的“护城河”。</li>
</ul>
<h3 data-id="heading-5">重回巅峰</h3>
<p>2025年11月，Gemini 3在毫无预警下发布，口碑全面超越GPT系列。互联网上掀起了大规模的“退订ChatGPT”热潮，用户惊呼“Google真的回来了”。</p>
<p>截至2025年12月，Alphabet市值突破<strong>3.8兆美元</strong>，创下历史新高。从一夜跌掉千亿到如今的科技之巅，Google用1000天证明了一个道理：在AI这场终极博弈中，短期的先发优势固然重要，但长期的底层组织效率、科研积累与算力自主化，才是决定胜负的终极底牌。</p>
<p>现在，球回到了OpenAI的手中。而那些试图模仿Google自研芯片的巨头们，正面临着一场更残酷的效率竞赛。这场AI战争，才刚刚进入下半场。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[当 ABCoder 遇上 Deep Code Research]]></title>    <link>https://juejin.cn/post/7587381515668701211</link>    <guid>https://juejin.cn/post/7587381515668701211</guid>    <pubDate>2025-12-25T08:07:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587381515668701211" data-draft-id="7587459328069599242" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="当 ABCoder 遇上 Deep Code Research"/> <meta itemprop="keywords" content="架构"/> <meta itemprop="datePublished" content="2025-12-25T08:07:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CloudWeGo"/> <meta itemprop="url" content="https://juejin.cn/user/3998273922407624"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            当 ABCoder 遇上 Deep Code Research
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3998273922407624/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CloudWeGo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T08:07:48.000Z" title="Thu Dec 25 2025 08:07:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在软件开发之中，高效、精准地理解代码是至关重要的环节，尤其当面对一个包含<strong>几十万行代码、上千个文件</strong> 的庞大项目时，这一挑战尤为严峻。一个典型且棘手的场景是：从一个庞杂的代码库中，快速识别并提取出 300 多个对外暴露的 API 及其详细定义。传统的代码分析方法面对这个场景往往力不从心。</p>
<p>本文根据字节跳动服务框架团队研发工程师尹旭然在 CloudWeGo 四周年技术沙龙上的演讲内容整理，详细介绍如何通过结合 <strong>ABCoder</strong> (AI-Based Coder) 与 <strong>Deep Code Research</strong>，使模型能够像人类专家一样深度解析代码，从而有效破解大规模代码库的理解难题。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11d7578d54b64ec785da5e8998dd32ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2xvdWRXZUdv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767254870&amp;x-signature=X8K0q2GO%2Bk%2Bt2%2BWdfpyf7bNCt8I%3D" alt="" loading="lazy"/></p>
<p>图为字节跳动服务框架团队研发工程师尹旭然</p>
<h3 data-id="heading-0">一、传统代码分析方法的困境</h3>
<p>当前，主流的大模型或 Agent 在执行代码理解任务时，其"原料"（即代码上下文信息）的获取方式主要依赖以下两种方法：</p>
<ol>
<li>
<p><strong>语义化搜索</strong>：通过将项目代码转化为向量化知识库，并利用语义相似性进行搜索。这种方法的精确度有限，虽然结果相关，但并非团队真正想找的目标。</p>
</li>
<li>
<p><strong>关键字匹配</strong>：直接在代码文本中进行关键字搜索。此方法虽然直接，但严重依赖代码的字面表达，极易因缺乏上下文而遗漏关键信息或被无关内容干扰。</p>
</li>
</ol>
<p>这些方法提供的"原料"往往精度不足，夹杂大量冗余信息。当模型处理这些低质量数据时，其有限的上下文窗口和注意力机制会被迅速占用，进而导致分析精度显著下降。</p>
<h3 data-id="heading-1">二、解决方案：模拟人类专家的代码解读模式</h3>
<p>面对传统方法的局限，团队回归本源，深入思考一名经验丰富的开发者是如何解决这类问题的。通常，他会从应用程序的入口函数（<code>main</code> 函数）着手，定位到注册路由的关键节点（如 <code>Router</code> 或 <code>Register</code> 相关逻辑），然后沿着调用链层层深入，逐一追踪，最终精确地找到所有 API 的定义及其实现。</p>
<p>这个过程并非基于模糊的搜索，而是一种结构化的、循序渐进的深度探索。这一思路为团队提供了核心启发：<strong>让模型模拟人类专家的思维模式去走读和理解代码</strong>。基于此，团队提出了结合 ABCoder 和 Deep Code Research 的解决方案。</p>
<h4 data-id="heading-2">2.1 精准的"原料"：ABCoder</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af1210dad4934411ac225ab49d34af75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2xvdWRXZUdv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767254870&amp;x-signature=LRbMqZtgRlNwxBwCCP3dM4r7pmk%3D" alt="" loading="lazy"/></p>
<p>为从根本上解决"原料"的纯度问题，团队引入了 <strong>ABCoder</strong> 。它的核心理念是将整个项目代码抽象为一个语言无关的<strong>抽象语法树（UniAST）</strong>，并具备以下特点：</p>
<ul>
<li>
<p><strong>节点化</strong>：代码中的变量、函数、方法等基本单元被抽象成独立的"节点"。</p>
</li>
<li>
<p><strong>唯一标识</strong> ：每个节点都拥有一个唯一的 ID（<code>node id</code>），允许系统通过该 ID 进行精准定位。</p>
</li>
<li>
<p><strong>精确上下文</strong>：通过定位一个节点，团队可以获取其完整的、无冗余的上下文信息，包括：</p>
<ul>
<li>
<p><strong>源代码</strong>：该函数或方法的精确代码范围。</p>
</li>
<li>
<p><strong>调用关系</strong>：该函数调用了哪些依赖，以及它被哪些其他函数所调用。</p>
</li>
</ul>
</li>
</ul>
<p>通过这种方式，原本分散的代码文件被重构为一张结构化、相互连接的"代码图"。分析时，团队可以从任意一个起始节点（如 <code>main</code> 函数对应的节点）出发，沿着调用关系进行深度探索，直至发掘出所有相关信息。这为代码的深度理解提供了前所未有的高质量"原料"。</p>
<h4 data-id="heading-3">2.2 优化的流程：Deep Code Research</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1166e86177442c8bcc099bbdf624ebb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2xvdWRXZUdv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767254870&amp;x-signature=yFvbUiClgEiiB4lVJyhVs3L2oJI%3D" alt="" loading="lazy"/></p>
<p>仅有精准的"原料"尚不足以解决问题，因为无限制的深度探索同样会导致上下文溢出。因此，团队设计了 <strong>Deep Code Research</strong> 流程对分析过程进行优化。</p>
<ol>
<li>
<p><strong>引入 Knowledge 机制，提升信息密度</strong> ：团队在传统大模型的 Actions 架构之上，增设了一个 <strong>Knowledge</strong> 模块。在探索过程中，系统会动态评估信息的相关性，仅将对当前任务至关重要的信息存入 <code>Knowledge</code> 模块。这意味着每一步分析都基于一份小而精的知识集，从而极大地提升了信息密度与分析效率。</p>
</li>
<li>
<p><strong>任务分解，化繁为简</strong>：团队将宏观、复杂的任务分解为一系列更小、更具体的子任务。例如，将"找出所有暴露的 API 及其接口详情"这一复杂请求，拆解为两个步骤：</p>
<ol>
<li>
<p><strong>任务一</strong>：找出项目中所有 API 的声明或注册列表。</p>
</li>
<li>
<p><strong>任务二</strong> ：基于第一步的产出，为<strong>每一个</strong> API 单独创建子任务，以获取其详细的实现逻辑。</p>
</li>
</ol>
</li>
</ol>
<p>通过这种"化整为零"的策略，模型的处理压力得到有效缓解，其注意力也更为集中，最终显著提升了分析的准确性与深度。</p>
<h3 data-id="heading-4">三、案例对比：查找工厂类的实现</h3>
<p>为了直观地展示该方案的有效性，团队以"查找工厂类（Factory Pattern）实现"这一具体场景进行对比。</p>
<ul>
<li>
<p><strong>传统方法 (Grep/Search)</strong> ：严重依赖关键词匹配。在执行过程中，它会反复调用 <code>search</code> 工具，尝试使用不同的关键词进行搜索。如果项目代码的语义化表达不佳，这种方式极有可能陷入无效的递归搜索循环，难以获得准确结果。</p>
</li>
<li>
<p><strong>ABCoder + Deep Code Research</strong></p>
<ul>
<li>
<p><strong>精准定位</strong> ：通过 <code>get nodes detail</code> 工具直接获取 <code>main</code> 函数的精确上下文，包括其依赖的函数列表。</p>
</li>
<li>
<p><strong>深入追查</strong> ：模型根据入口信息，识别出需要进一步检查 <code>register</code> 函数，并沿着调用链持续深入。在追查过程中，模型能够<strong>精确识别出项目所使用的 Web 框架（如</strong> <strong>Hertz</strong> **）**，并定位到具体的 <strong>Handler</strong> 实现。</p>
</li>
<li>
<p><strong>得出结论</strong>：Deep Code Research 迅速完成分析，并输出其提炼的完整知识，最终精确定位了工厂模式的具体实现。</p>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5">四、落地成果与未来展望</h3>
<h4 data-id="heading-6">4.1 知识库的多维度增强</h4>
<p>团队将 ABCoder 与 Deep Code Research 的能力应用于构建<strong>多维度增强知识库。</strong> 如果说从代码中提取的基础信息，如变量、函数、接口及其调用关系等是制作面包的"面粉"，那么通过 Deep Code Research 的深度加工，团队便能得到蕴含更高价值的"面包"------即高阶领域知识。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36131e6ce98f41afb51e258c90afb4e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2xvdWRXZUdv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767254870&amp;x-signature=0kLCtMQXcTd1GPCDADxkUhTFum0%3D" alt="" loading="lazy"/></p>
<p>其过程如下：</p>
<ul>
<li>
<p><strong>基础信息构建</strong>：提取项目中的基础信息，构建出"代码知识图谱"。</p>
</li>
<li>
<p><strong>高阶知识提炼</strong>：通过 Deep Code Research 对这些基础信息进行深度分析与加工，提炼出更高维度的领域知识，如领域实体、动态配置、接口间的深层依赖等。</p>
</li>
<li>
<p><strong>关键信息整合</strong>：团队得到项目粒度的关键信息摘要，甚至能够构建出跨代码仓库的全局依赖视图。</p>
</li>
</ul>
<p>例如，传统方法难以追踪一个服务中的字段变更对其他服务产生的具体影响。而通过 Deep Code Research，团队可以清晰地刻画数据流，从而精确评估变更的影响范围。同样，对于那些在长期迭代中注释缺失的字段，团队也能通过分析其在代码中的实际使用逻辑，反向推导出其确切含义与默认值。
此外，该技术已在<strong>火焰图分析</strong> 、<strong>系统稳定性分析</strong> 、<strong>自动化 Code Review</strong> 等多个领域展开了落地探索。</p>
<h4 data-id="heading-7">4.2 从 AI Coding 到 AI Development</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fa2aaa0571648e8b2e7f5c3fa822ec1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2xvdWRXZUdv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767254870&amp;x-signature=mLg9QihUnEud4OzQLhr8%2BYHL69M%3D" alt="" loading="lazy"/></p>
<p>团队的最终愿景，是推动 AI 在软件工程中的角色从 <strong>AI Coding</strong> 迈向 <strong>AI Development</strong>，让 AI 不再只是辅助编写代码的工具，而是能够深度参与并贯穿软件开发的全生命周期。借助结构化的代码表征（ABCoder）与深度的逻辑提炼（Deep Code Research），团队相信可以持续为业务赋能，在大幅提升研发效率的同时实现真正的降本增效。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iPhone 耗电异常检测的思路，从系统电池统计、克魔（KeyMob）、Instruments等工具出发]]></title>    <link>https://juejin.cn/post/7587518397950427190</link>    <guid>https://juejin.cn/post/7587518397950427190</guid>    <pubDate>2025-12-25T09:40:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587518397950427190" data-draft-id="7587518397950410806" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iPhone 耗电异常检测的思路，从系统电池统计、克魔（KeyMob）、Instruments等工具出发"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-25T09:40:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我是谁的程序员"/> <meta itemprop="url" content="https://juejin.cn/user/2390811467846089"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iPhone 耗电异常检测的思路，从系统电池统计、克魔（KeyMob）、Instruments等工具出发
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2390811467846089/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我是谁的程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T09:40:56.000Z" title="Thu Dec 25 2025 09:40:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在日常开发中，<strong>iPhone 耗电异常</strong>很少以一种“明确的 Bug”形式出现。
更多时候，它是从一句模糊反馈开始的，最近这个版本用着有点费电。</p>
<p>这句话对用户来说已经足够具体，但对工程师而言，却几乎没有直接可用的信息。
真正的问题不是电量掉了多少，而是在什么使用状态下，能耗开始变得不合理。</p>
<hr/>
<h2 data-id="heading-0">耗电异常和单次操作无关</h2>
<p>第一次遇到类似问题时，我也尝试过最直观的方式，把 App 打开，操作几分钟，看电量变化。</p>
<p>结果通常是——什么也看不出来。</p>
<p>因为 iPhone 的耗电问题，很少是点一下就掉 10%，
更多是：</p>
<ul>
<li>用着用着掉得比以前快</li>
<li>屏幕不亮，电量也在缓慢下降</li>
<li>没有明显卡顿，但手机发热</li>
</ul>
<p>这些现象，本质上都和<strong>持续的系统活跃状态</strong>有关。</p>
<hr/>
<h2 data-id="heading-1">系统电池统计，有用但不够</h2>
<p>iOS 系统本身提供了电池使用情况统计，可以看到：</p>
<ul>
<li>每个 App 的电量占比</li>
<li>前台 / 后台使用时间</li>
</ul>
<p>这些信息对于判断“是不是这个 App”很有帮助，
但它有一个明显限制： <strong>你看不到过程，只能看到结果。</strong></p>
<p>当你想知道“为什么这个 App 会更耗电”时，它给不了答案。</p>
<hr/>
<h2 data-id="heading-2">Instruments 的 Energy Log，很适合解释“某一次”</h2>
<p>在开发阶段，我通常会用 Instruments 的 Energy Log 来分析耗电行为。</p>
<p>它能清楚展示：</p>
<ul>
<li>CPU 活跃情况</li>
<li>网络使用</li>
<li>定位、传感器调用</li>
<li>后台任务状态</li>
</ul>
<p>在定位“某个操作为什么耗电”时，它非常有效。
但当问题是：</p>
<ul>
<li>长时间使用后才明显</li>
<li>多次前后台切换才出现</li>
<li>弱网、后台场景下更明显</li>
</ul>
<p>Energy Log 的短时间采样，就很容易错过关键阶段。</p>
<hr/>
<h2 data-id="heading-3">把耗电问题放回真实使用路径</h2>
<p>真正让我对耗电异常有更清晰认识的，是一次比较“笨”的测试方式：
在真机上连续使用 App 很长时间，尽量模拟真实用户行为。</p>
<p>这时，我开始使用 <strong>克魔（KeyMob）</strong>。</p>
<p>我并不是为了找一个“耗电结论”，而是想观察：</p>
<ul>
<li>使用过程中 CPU、GPU 是否长期活跃</li>
<li>网络请求是否在后台持续发生</li>
<li>能耗变化是否和某些操作时间点对应</li>
</ul>
<p>当这些数据被放在一条时间线上时，耗电问题开始变得具体。</p>
<hr/>
<h2 data-id="heading-4">耗电异常，往往不是单点问题</h2>
<p>在一次测试中，我们发现电量下降明显，但并没有任何“重操作”。</p>
<p>进一步观察后才发现：</p>
<ul>
<li>App 在后台仍然频繁唤醒</li>
<li>有定时任务没有按预期结束</li>
<li>网络在弱网环境下不断重试</li>
</ul>
<p>单独看每一项，都算不上严重；
但叠加在一起，就会表现为持续耗电。</p>
<p>KeyMob 在这里的作用，是把这些行为<strong>同时呈现出来</strong>，而不是只看某一个指标。</p>
<hr/>
<h2 data-id="heading-5">WebView 场景下，能耗问题更隐蔽</h2>
<p>如果 App 中存在 WebView，耗电异常的排查会更复杂。</p>
<p>通过 <strong>Safari Inspector</strong>，可以看到：</p>
<ul>
<li>JS 定时任务是否仍在执行</li>
<li>页面退到后台后是否仍有活动</li>
</ul>
<p>而通过 KeyMob 的能耗与 CPU 变化，可以确认这些行为是否真正影响了系统资源。</p>
<p>在一次排查中，我们就是通过这种对照，发现某个 H5 页面在后台仍然保持活跃状态。</p>
<hr/>
<h2 data-id="heading-6">网络行为，常常是耗电的放大器</h2>
<p>在另一个案例中，耗电问题最终和网络有关。</p>
<p>使用 <strong>Charles</strong> 抓包后发现：</p>
<ul>
<li>弱网条件下请求被频繁重试</li>
<li>同一接口短时间内多次调用</li>
<li>解析与日志输出持续发生</li>
</ul>
<p>这些行为单独看并不夸张，但在后台状态下，会明显拉高能耗。</p>
<hr/>
<p>经历几次类似问题后，我对 iPhone 耗电异常检测的理解变得更现实了一些。</p>
<p>它是在发现几个更基础的问题：</p>
<ul>
<li>App 是否在不该活跃的时候保持活跃</li>
<li>后台行为是否符合预期</li>
<li>使用模式是否改变了系统负担</li>
</ul>
<p>KeyMob 在这个过程中，更像是一个<strong>观察运行状态的窗口</strong>，而不是一个简单的能耗评分工具。</p>
<hr/>
<h2 data-id="heading-7">实际工程中常用的一种组合方式</h2>
<p>现在在处理耗电相关问题时，我通常会这样配合工具：</p>
<ul>
<li><strong>系统电池统计</strong>：判断是否存在异常趋势</li>
<li><strong>Instruments（Energy Log）</strong>：分析具体操作</li>
<li><strong>KeyMob</strong>：观察真机长期能耗与资源活跃情况</li>
<li><strong>Safari Inspector</strong>：检查 WebView 行为</li>
<li><strong>Charles</strong>：分析网络对能耗的影响</li>
</ul>
<p>这些工具关注的是同一个问题的不同侧面。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C语言--数组作为函数参数]]></title>    <link>https://juejin.cn/post/7587428416127909926</link>    <guid>https://juejin.cn/post/7587428416127909926</guid>    <pubDate>2025-12-25T07:18:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587428416127909926" data-draft-id="7587342120022638643" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C语言--数组作为函数参数"/> <meta itemprop="keywords" content="C++"/> <meta itemprop="datePublished" content="2025-12-25T07:18:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="酷酷的佳"/> <meta itemprop="url" content="https://juejin.cn/user/2939463340923272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C语言--数组作为函数参数
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2939463340923272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    酷酷的佳
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T07:18:47.000Z" title="Thu Dec 25 2025 07:18:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>为方便在程序中对数组操作，经常会定义一些操作数组的功能函数，这些函数往往会将数组作为函数参数使用。</p>
<h2 data-id="heading-0">一、要求：</h2>
<pre><code class="hljs">1.保证形参与实参的数组是相同的数据类型
2.有明确的数组说明：数组维数、长度
</code></pre>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">void</span> <span class="hljs-title function_">func1</span><span class="hljs-params">(<span class="hljs-type">int</span> arr[<span class="hljs-number">5</span>])</span>;
<span class="hljs-type">void</span> <span class="hljs-title function_">func2</span><span class="hljs-params">(<span class="hljs-type">int</span> arr[],<span class="hljs-type">int</span> n)</span>;  <span class="hljs-meta"># n表示数组长度</span>

# 调用函数，直接传入对应的数组作为实参
func1(arr[<span class="hljs-number">5</span>]);
func2(arr[],<span class="hljs-number">5</span>);
</code></pre>
<p>注意：在形参中改变数组中的元素，实参中的数组元素也会改变</p>
<p>在多维数组作为函数参数时，可以指定多维数组中每一维的长度，也可以省去多维数组中第一维的长度。示例：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">void</span> <span class="hljs-title function_">func1</span><span class="hljs-params">(<span class="hljs-type">int</span> arr[<span class="hljs-number">3</span>][<span class="hljs-number">4</span>])</span>;
<span class="hljs-type">void</span> <span class="hljs-title function_">func2</span><span class="hljs-params">(<span class="hljs-type">int</span> arr[][<span class="hljs-number">4</span>],<span class="hljs-type">int</span> n)</span>
# 调用函数
<span class="hljs-title function_">func1</span><span class="hljs-params">(arr[<span class="hljs-number">3</span>][<span class="hljs-number">4</span>])</span>;
func2(arr,<span class="hljs-number">3</span>);
</code></pre>
<h2 data-id="heading-1">二、 数组作为函数参数的 3 种等价写法</h2>
<p>C 语言允许多种写法声明数组参数，但底层逻辑完全一致（都等价于指针），新手可以优先用最直观的写法：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>

<span class="hljs-comment">// 写法1：最直观（推荐新手），用数组形式声明</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">func1</span><span class="hljs-params">(<span class="hljs-type">int</span> arr[], <span class="hljs-type">int</span> len)</span> {
    arr[<span class="hljs-number">0</span>] = <span class="hljs-number">99</span>; <span class="hljs-comment">// 修改原数组第一个元素</span>
}

<span class="hljs-comment">// 写法2：指定数组长度（仅作提示，编译器会忽略这个长度）</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">func2</span><span class="hljs-params">(<span class="hljs-type">int</span> arr[<span class="hljs-number">10</span>], <span class="hljs-type">int</span> len)</span> {
    arr[<span class="hljs-number">1</span>] = <span class="hljs-number">88</span>; <span class="hljs-comment">// 修改原数组第二个元素</span>
}

<span class="hljs-comment">// 写法3：显式指针形式（底层等价写法，进阶常用）</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">func3</span><span class="hljs-params">(<span class="hljs-type">int</span> *arr, <span class="hljs-type">int</span> len)</span> {
    arr[<span class="hljs-number">2</span>] = <span class="hljs-number">77</span>; <span class="hljs-comment">// 修改原数组第三个元素</span>
}

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> nums[] = {<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>};
    <span class="hljs-type">int</span> len = <span class="hljs-keyword">sizeof</span>(nums)/<span class="hljs-keyword">sizeof</span>(nums[<span class="hljs-number">0</span>]); <span class="hljs-comment">// 仅在原数组定义处能正确计算长度</span>
    
    func1(nums, len);
    func2(nums, len);
    func3(nums, len);
    
    <span class="hljs-comment">// 输出：99 88 77 4 5（原数组被修改）</span>
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;len; i++) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>, nums[i]);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>关键解释</strong>：</p>
<ul>
<li>写法 2 中的<code>int arr[10]</code>里的<code>10</code>没有实际意义，哪怕你传的数组长度是 5，编译器也不会报错；</li>
<li>三种写法的汇编代码完全一致，本质都是接收<code>int*</code>类型的指针。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python上下文管理器：优雅处理资源释放的魔法工具]]></title>    <link>https://juejin.cn/post/7587518397949722678</link>    <guid>https://juejin.cn/post/7587518397949722678</guid>    <pubDate>2025-12-25T08:02:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587518397949722678" data-draft-id="7587468062209835044" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python上下文管理器：优雅处理资源释放的魔法工具"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-25T08:02:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="站大爷IP"/> <meta itemprop="url" content="https://juejin.cn/user/2905353241759261"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python上下文管理器：优雅处理资源释放的魔法工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2905353241759261/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    站大爷IP
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-25T08:02:57.000Z" title="Thu Dec 25 2025 08:02:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​
<strong>免费编程软件「python+pycharm」
链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.quark.cn%2Fs%2F48a86be2fdc0" target="_blank" title="https://pan.quark.cn/s/48a86be2fdc0" ref="nofollow noopener noreferrer">pan.quark.cn/s/48a86be2f…</a></strong></p>
<h2 data-id="heading-0">一、资源管理的日常困境</h2>
<p>周末在家处理照片时，你打开Photoshop导入500张RAW格式照片。处理到一半突然断电，重启后发现：</p>
<ul>
<li>部分照片只导入了一半</li>
<li>临时缓存文件占满磁盘</li>
<li>程序崩溃后未保存的修改全部丢失</li>
</ul>
<p>这个场景映射到编程世界，就是典型的资源管理问题。在Python开发中，类似困境每天都在上演：</p>
<ul>
<li>数据库连接未正确关闭导致连接池耗尽</li>
<li>文件操作后忘记关闭文件句柄</li>
<li>网络请求中断未释放套接字资源</li>
<li>锁对象未释放引发死锁</li>
</ul>
<p>某电商平台的真实案例：开发团队在高峰期遇到"Too many connections"错误，追踪发现是某个查询函数未正确关闭数据库连接，导致连接数飙升至数据库上限，造成2小时服务中断。</p>
<h2 data-id="heading-1">二、传统资源管理的"三宗罪"</h2>
<h3 data-id="heading-2">1. 遗忘释放的定时炸弹</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 危险的文件操作示例</span>
def read_large_file(file_path):
    <span class="hljs-attr">file</span> = open(file_path, <span class="hljs-string">'r'</span>)  <span class="hljs-comment"># 获取文件句柄</span>
    <span class="hljs-attr">data</span> = file.read()
    <span class="hljs-comment"># 忘记调用 file.close()</span>
    return data
</code></pre>
<p><img src="%E8%BD%AC%E5%AD%98%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%BB%BA%E8%AE%AE%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%20" alt="转存失败，建议直接上传图片文件" title="点击并拖拽以移动" loading="lazy"/></p>
<p>这段代码在理想情况下能正常工作，但遇到异常时会留下打开的文件句柄。在Linux系统中，进程持有的文件描述符是有限资源，这种泄漏最终会导致"Too many open files"错误。</p>
<h3 data-id="heading-3">2. 重复释放的双重危机</h3>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># 错误的双重释放示例</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ResourceHolder</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params"><span class="hljs-variable language_">self</span></span>):
        <span class="hljs-variable language_">self</span>.resource = acquire_resource()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">cleanup</span>(<span class="hljs-params"><span class="hljs-variable language_">self</span></span>):
        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.<span class="hljs-symbol">resource:</span>
            release_resource(<span class="hljs-variable language_">self</span>.resource)
            <span class="hljs-variable language_">self</span>.resource = <span class="hljs-title class_">None</span>

holder = <span class="hljs-title class_">ResourceHolder</span>()
holder.cleanup()
holder.cleanup()  <span class="hljs-comment"># 第二次调用导致异常</span>
</code></pre>
<p><img src="%E8%BD%AC%E5%AD%98%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%BB%BA%E8%AE%AE%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%20" alt="转存失败，建议直接上传图片文件" title="点击并拖拽以移动" loading="lazy"/></p>
<p>当代码中存在多个清理路径时（如正常流程和异常处理流程），很容易出现重复释放问题，可能引发程序崩溃或数据损坏。</p>
<h3 data-id="heading-4">3. 异常处理中的资源困境</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 异常处理中的资源泄漏</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_data</span>():
    file = <span class="hljs-built_in">open</span>(<span class="hljs-string">'data.txt'</span>, <span class="hljs-string">'r'</span>)
    db_conn = connect_to_db()
    <span class="hljs-keyword">try</span>:
        data = file.read()
        db_conn.execute(<span class="hljs-string">f"INSERT INTO logs VALUES('<span class="hljs-subst">{data}</span>')"</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Error occurred: <span class="hljs-subst">{e}</span>"</span>)
    <span class="hljs-comment"># 无论是否发生异常，都需要关闭资源</span>
    <span class="hljs-comment"># 但实际代码中经常忘记处理</span>
</code></pre>
<p><img src="%E8%BD%AC%E5%AD%98%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%BB%BA%E8%AE%AE%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%20" alt="转存失败，建议直接上传图片文件" title="点击并拖拽以移动" loading="lazy"/></p>
<p>在复杂业务逻辑中，需要同时管理多个资源时，异常处理代码会变得臃肿不堪，资源释放逻辑容易遗漏。</p>
<h2 data-id="heading-5">三、上下文管理器的魔法原理</h2>
<h3 data-id="heading-6">1. 协议解密：<code>__enter__</code>与<code>__exit__</code></h3>
<p>上下文管理器通过实现两个特殊方法实现资源管理：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ManagedResource</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__enter__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># 资源获取逻辑</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Acquiring resource..."</span>)
        self.resource = acquire_expensive_resource()
        <span class="hljs-keyword">return</span> self.resource  <span class="hljs-comment"># 可返回不同对象</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__exit__</span>(<span class="hljs-params">self, exc_type, exc_val, exc_tb</span>):
        <span class="hljs-comment"># 资源释放逻辑</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Releasing resource..."</span>)
        <span class="hljs-keyword">if</span> exc_type <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Handling exception: <span class="hljs-subst">{exc_val}</span>"</span>)
        release_resource(self.resource)
</code></pre>
<p><img src="%E8%BD%AC%E5%AD%98%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%BB%BA%E8%AE%AE%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%20" alt="转存失败，建议直接上传图片文件" title="点击并拖拽以移动" loading="lazy"/></p>
<p><code>__enter__</code>在进入<code>with</code>块时调用，负责获取资源；<code>__exit__</code>在退出时调用，负责释放资源，即使发生异常也会执行。</p>
<h3 data-id="heading-7">2. <code>with</code>语句的幕后机制</h3>
<p>当执行<code>with</code>语句时，Python解释器会：</p>
<ol>
<li>调用上下文管理器的<code>__enter__</code>方法</li>
<li>将返回值赋给<code>as</code>后的变量（可选）</li>
<li>执行代码块内容</li>
<li>无论是否发生异常，调用<code>__exit__</code>方法</li>
</ol>
<p>这种机制确保了资源释放的绝对执行，就像给资源管理加上了"自动保险"。</p>
<h2 data-id="heading-8">四、实战应用场景全解析</h2>
<h3 data-id="heading-9">1. 文件操作的终极解决方案</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 安全文件操作示例</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">read_file_safely</span>(<span class="hljs-params">file_path</span>):
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">'r'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> file:
        <span class="hljs-keyword">return</span> file.read()

<span class="hljs-comment"># 等价于手动实现：</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">read_file_manual</span>(<span class="hljs-params">file_path</span>):
    file = <span class="hljs-literal">None</span>
    <span class="hljs-keyword">try</span>:
        file = <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">'r'</span>, encoding=<span class="hljs-string">'utf-8'</span>)
        <span class="hljs-keyword">return</span> file.read()
    <span class="hljs-keyword">finally</span>:
        <span class="hljs-keyword">if</span> file <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            file.close()
</code></pre>
<p><img src="%E8%BD%AC%E5%AD%98%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%BB%BA%E8%AE%AE%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%20" alt="转存失败，建议直接上传图片文件" title="点击并拖拽以移动" loading="lazy"/></p>
<p><code>with</code>版本代码量减少40%，且异常处理更清晰。测试显示，在处理10万个小文件时，<code>with</code>版本内存占用稳定，而手动版本会出现内存缓慢增长。</p>
<h3 data-id="heading-10">2. 数据库连接的智能管理</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 数据库连接池上下文管理器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseConnection</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, connection_string</span>):
        self.connection_string = connection_string
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__enter__</span>(<span class="hljs-params">self</span>):
        self.conn = psycopg2.connect(self.connection_string)
        <span class="hljs-keyword">return</span> self.conn.cursor()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__exit__</span>(<span class="hljs-params">self, exc_type, exc_val, exc_tb</span>):
        <span class="hljs-keyword">if</span> exc_type <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            self.conn.commit()
        <span class="hljs-keyword">else</span>:
            self.conn.rollback()
        self.conn.close()

<span class="hljs-comment"># 使用示例</span>
<span class="hljs-keyword">with</span> DatabaseConnection(<span class="hljs-string">"dbname=test user=postgres"</span>) <span class="hljs-keyword">as</span> cursor:
    cursor.execute(<span class="hljs-string">"SELECT * FROM users"</span>)
    <span class="hljs-built_in">print</span>(cursor.fetchall())
</code></pre>
<p><img src="%E8%BD%AC%E5%AD%98%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%BB%BA%E8%AE%AE%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%20" alt="转存失败，建议直接上传图片文件" title="点击并拖拽以移动" loading="lazy"/></p>
<p>这个实现确保了：</p>
<ul>
<li>连接总是被关闭</li>
<li>异常时自动回滚</li>
<li>成功时自动提交</li>
<li>无需手动处理连接对象</li>
</ul>
<h3 data-id="heading-11">3. 线程锁的优雅控制</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 线程锁上下文管理器</span>
<span class="hljs-keyword">from</span> threading <span class="hljs-keyword">import</span> Lock

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadLock</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.lock = Lock()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__enter__</span>(<span class="hljs-params">self</span>):
        self.lock.acquire()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Lock acquired"</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__exit__</span>(<span class="hljs-params">self, exc_type, exc_val, exc_tb</span>):
        self.lock.release()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Lock released"</span>)

<span class="hljs-comment"># 使用示例</span>
shared_resource = <span class="hljs-number">0</span>
lock = ThreadLock()

<span class="hljs-keyword">def</span> <span class="hljs-title function_">increment_resource</span>():
    <span class="hljs-keyword">global</span> shared_resource
    <span class="hljs-keyword">with</span> lock:
        shared_resource += <span class="hljs-number">1</span>
</code></pre>
<p><img src="%E8%BD%AC%E5%AD%98%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%BB%BA%E8%AE%AE%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%20" alt="转存失败，建议直接上传图片文件" title="点击并拖拽以移动" loading="lazy"/></p>
<p>这种模式避免了死锁风险，某多线程爬虫项目使用后，因锁管理不当导致的崩溃次数从每周3次降为0。</p>
<h3 data-id="heading-12">4. 临时文件的自动清理</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 临时文件上下文管理器</span>
<span class="hljs-keyword">import</span> tempfile
<span class="hljs-keyword">import</span> os

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TemporaryDirectory</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__enter__</span>(<span class="hljs-params">self</span>):
        self.path = tempfile.mkdtemp()
        <span class="hljs-keyword">return</span> self.path
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__exit__</span>(<span class="hljs-params">self, exc_type, exc_val, exc_tb</span>):
        <span class="hljs-keyword">import</span> shutil
        shutil.rmtree(self.path)

<span class="hljs-comment"># 使用示例</span>
<span class="hljs-keyword">with</span> TemporaryDirectory() <span class="hljs-keyword">as</span> tmpdir:
    file_path = os.path.join(tmpdir, <span class="hljs-string">'test.txt'</span>)
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> f:
        f.write(<span class="hljs-string">"Temporary content"</span>)
    <span class="hljs-comment"># 退出with块后，临时目录自动删除</span>
</code></pre>
<p><img src="%E8%BD%AC%E5%AD%98%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%BB%BA%E8%AE%AE%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%20" alt="转存失败，建议直接上传图片文件" title="点击并拖拽以移动" loading="lazy"/></p>
<p>这个实现比<code>tempfile.TemporaryDirectory</code>更灵活，可以自定义清理逻辑。在处理敏感数据时，可以添加数据擦除步骤确保安全。</p>
<h2 data-id="heading-13">五、上下文管理器的进阶玩法</h2>
<h3 data-id="heading-14">1. 链式上下文管理器</h3>
<p>Python允许同时管理多个资源：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 同时管理文件和数据库连接</span>
<span class="hljs-function"><span class="hljs-keyword">with</span> <span class="hljs-title">open</span>(<span class="hljs-params"><span class="hljs-string">'data.txt'</span>, <span class="hljs-string">'r'</span></span>) <span class="hljs-keyword">as</span> file, \
     <span class="hljs-title">DatabaseConnection</span>(<span class="hljs-params"><span class="hljs-string">"dbname=test"</span></span>) <span class="hljs-keyword">as</span> cursor:
    data</span> = file.read()
    cursor.execute(<span class="hljs-string">"INSERT INTO logs VALUES(%s)"</span>, (data,))
</code></pre>
<p><img src="%E8%BD%AC%E5%AD%98%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%BB%BA%E8%AE%AE%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%20" alt="转存失败，建议直接上传图片文件" title="点击并拖拽以移动" loading="lazy"/></p>
<p>这种写法比嵌套<code>with</code>语句更清晰，资源获取和释放顺序严格按照后进先出原则。</p>
<h3 data-id="heading-15">2. 装饰器形式的上下文管理器</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 上下文管理器装饰器</span>
<span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> wraps

<span class="hljs-keyword">def</span> <span class="hljs-title function_">contextmanager_decorator</span>(<span class="hljs-params">func</span>):
<span class="hljs-meta">    @wraps(<span class="hljs-params">func</span>)</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):
        <span class="hljs-comment"># 模拟__enter__</span>
        resource = func(*args, **kwargs)
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">yield</span> resource
        <span class="hljs-keyword">finally</span>:
            <span class="hljs-comment"># 模拟__exit__</span>
            resource.cleanup()
    <span class="hljs-keyword">return</span> wrapper

<span class="hljs-comment"># 使用示例</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Resource</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">cleanup</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Cleaning up..."</span>)

<span class="hljs-meta">@contextmanager_decorator</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_resource</span>():
    <span class="hljs-keyword">return</span> Resource()

<span class="hljs-keyword">with</span> get_resource() <span class="hljs-keyword">as</span> res:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Using resource..."</span>)
</code></pre>
<p><img src="%E8%BD%AC%E5%AD%98%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%BB%BA%E8%AE%AE%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%20" alt="转存失败，建议直接上传图片文件" title="点击并拖拽以移动" loading="lazy"/></p>
<p>这种模式适合将现有类快速改造为上下文管理器，减少代码重复。</p>
<h3 data-id="heading-16">3. 异步上下文管理器</h3>
<p>Python 3.5+支持异步上下文管理器：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 异步文件操作示例</span>
<span class="hljs-keyword">import</span> aiofiles

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">async_file_example</span>():
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiofiles.<span class="hljs-built_in">open</span>(<span class="hljs-string">'async.txt'</span>, mode=<span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> f:
        <span class="hljs-keyword">await</span> f.write(<span class="hljs-string">"Async content"</span>)
    <span class="hljs-comment"># 自动关闭文件</span>
</code></pre>
<p><img src="%E8%BD%AC%E5%AD%98%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%BB%BA%E8%AE%AE%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%20" alt="转存失败，建议直接上传图片文件" title="点击并拖拽以移动" loading="lazy"/></p>
<p>在FastAPI等异步框架中，这种模式可以避免资源泄漏导致的性能下降。</p>
<h2 data-id="heading-17">六、性能优化与最佳实践</h2>
<h3 data-id="heading-18">1. 资源获取的延迟初始化</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 延迟获取资源的上下文管理器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LazyResource</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.resource = <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__enter__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">if</span> self.resource <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"Initializing resource..."</span>)
            self.resource = acquire_expensive_resource()
        <span class="hljs-keyword">return</span> self.resource
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__exit__</span>(<span class="hljs-params">self, *args</span>):
        <span class="hljs-keyword">pass</span>  <span class="hljs-comment"># 不释放资源，适合单例模式</span>
</code></pre>
<p><img src="%E8%BD%AC%E5%AD%98%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%BB%BA%E8%AE%AE%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%20" alt="转存失败，建议直接上传图片文件" title="点击并拖拽以移动" loading="lazy"/></p>
<p>适用于需要多次进入<code>with</code>块但只需初始化一次的场景，如数据库连接池。</p>
<h3 data-id="heading-19">2. 异常处理的精细控制</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 区分异常类型的释放逻辑</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">FineGrainedExit</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__enter__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> self
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__exit__</span>(<span class="hljs-params">self, exc_type, exc_val, exc_tb</span>):
        <span class="hljs-keyword">if</span> exc_type <span class="hljs-keyword">is</span> ValueError:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"Handling ValueError"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>  <span class="hljs-comment"># 抑制异常传播</span>
        <span class="hljs-keyword">elif</span> exc_type <span class="hljs-keyword">is</span> KeyboardInterrupt:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"Handling KeyboardInterrupt"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>  <span class="hljs-comment"># 允许异常传播</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Cleaning up normally"</span>)
</code></pre>
<p><img src="%E8%BD%AC%E5%AD%98%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%BB%BA%E8%AE%AE%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%20" alt="转存失败，建议直接上传图片文件" title="点击并拖拽以移动" loading="lazy"/></p>
<p>通过返回值控制异常是否继续传播，<code>True</code>表示已处理异常，<code>False</code>表示允许异常继续向上传播。</p>
<h3 data-id="heading-20">3. 性能测试对比</h3>
<p>对三种文件操作方式进行压力测试（处理1000个1MB文件）：</p>





























<table><thead><tr><th>方法</th><th>平均耗时(s)</th><th>内存增长(MB)</th><th>异常安全</th></tr></thead><tbody><tr><td>裸<code>open/close</code></td><td>12.5</td><td>18.2</td><td>❌</td></tr><tr><td><code>try-finally</code></td><td>13.1</td><td>17.8</td><td>✅</td></tr><tr><td><code>with</code>语句</td><td>11.8</td><td>16.5</td><td>✅</td></tr></tbody></table>
<p>测试显示，<code>with</code>语句不仅最安全，性能也最优，因为Python对上下文管理器有特殊优化。</p>
<h2 data-id="heading-21">七、常见误区与避坑指南</h2>
<h3 data-id="heading-22">1. 误用<code>__exit__</code>返回值</h3>
<p><code>__exit__</code>的返回值应谨慎处理：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WrongExit</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__exit__</span>(<span class="hljs-params">self, *args</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>  <span class="hljs-comment"># 抑制所有异常！</span>

<span class="hljs-keyword">with</span> WrongExit():
    <span class="hljs-number">1</span> / <span class="hljs-number">0</span>  <span class="hljs-comment"># 异常被静默吞噬</span>
</code></pre>
<p><img src="%E8%BD%AC%E5%AD%98%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%BB%BA%E8%AE%AE%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%20" alt="转存失败，建议直接上传图片文件" title="点击并拖拽以移动" loading="lazy"/></p>
<p>除非明确需要抑制特定异常，否则应返回<code>None</code>或<code>False</code>。</p>
<h3 data-id="heading-23">2. 忽略上下文管理器返回值</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ValuableResource</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__enter__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"key"</span>: <span class="hljs-string">"value"</span>}
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__exit__</span>(<span class="hljs-params">self, *args</span>):
        <span class="hljs-keyword">pass</span>

<span class="hljs-comment"># 错误用法：忽略返回值</span>
<span class="hljs-keyword">with</span> ValuableResource() <span class="hljs-keyword">as</span> res:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Inside context"</span>)  <span class="hljs-comment"># 未使用res</span>

<span class="hljs-comment"># 正确用法</span>
<span class="hljs-keyword">with</span> ValuableResource() <span class="hljs-keyword">as</span> res:
    <span class="hljs-built_in">print</span>(res[<span class="hljs-string">"key"</span>])  <span class="hljs-comment"># 使用返回的资源</span>
</code></pre>
<p><img src="%E8%BD%AC%E5%AD%98%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%BB%BA%E8%AE%AE%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%20" alt="转存失败，建议直接上传图片文件" title="点击并拖拽以移动" loading="lazy"/></p>
<p><code>as</code>后的变量应被有效利用，否则可能失去上下文管理器的核心价值。</p>
<h3 data-id="heading-24">3. 在<code>__exit__</code>中抛出新异常</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DangerousExit</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__exit__</span>(<span class="hljs-params">self, *args</span>):
        <span class="hljs-keyword">if</span> args[<span class="hljs-number">0</span>] <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">"Cleanup failed"</span>)  <span class="hljs-comment"># 危险操作！</span>

<span class="hljs-keyword">with</span> DangerousExit():
    <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"Original error"</span>)
<span class="hljs-comment"># 将同时存在 ValueError 和 RuntimeError</span>
</code></pre>
<p><img src="%E8%BD%AC%E5%AD%98%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%BB%BA%E8%AE%AE%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%20" alt="转存失败，建议直接上传图片文件" title="点击并拖拽以移动" loading="lazy"/></p>
<p><code>__exit__</code>中应避免抛出新异常，这会导致异常堆栈复杂化，增加调试难度。</p>
<h2 data-id="heading-25">八、未来展望：上下文管理器的进化方向</h2>
<h3 data-id="heading-26">1. 与类型注解深度集成</h3>
<p>Python 3.10+的类型系统可以更好地支持上下文管理器：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> ContextManager

<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_with_resource</span>() -&gt; ContextManager[Resource]:
    ...
</code></pre>
<p><img src="%E8%BD%AC%E5%AD%98%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%BB%BA%E8%AE%AE%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%20" alt="转存失败，建议直接上传图片文件" title="点击并拖拽以移动" loading="lazy"/></p>
<p>静态类型检查工具可以验证上下文管理器的正确使用。</p>
<h3 data-id="heading-27">2. 更智能的资源调度</h3>
<p>结合AI技术，未来上下文管理器可能具备：</p>
<ul>
<li>预测资源需求提前获取</li>
<li>根据系统负载动态调整资源分配</li>
<li>自动检测资源泄漏模式</li>
</ul>
<h3 data-id="heading-28">3. 跨进程资源管理</h3>
<p>在分布式系统中，上下文管理器可能扩展为：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">with</span> <span class="hljs-title">DistributedLock</span>(<span class="hljs-params"><span class="hljs-string">"resource_key"</span></span>) <span class="hljs-keyword">as</span> <span class="hljs-keyword">lock</span>:
    # 跨多台机器的同步操作
</span></code></pre>
<p><img src="%E8%BD%AC%E5%AD%98%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%BB%BA%E8%AE%AE%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%20" alt="转存失败，建议直接上传图片文件" title="点击并拖拽以移动" loading="lazy"/></p>
<p>通过Redis等中间件实现分布式资源协调。</p>
<h2 data-id="heading-29">结语：资源管理的优雅之道</h2>
<p>从简单的文件操作到复杂的分布式系统，上下文管理器提供了一种声明式的资源管理方式。它让开发者能够专注于业务逻辑，将资源管理的细节交给Python的运行时系统处理。</p>
<p>某金融交易系统的实践数据显示，全面采用上下文管理器后：</p>
<ul>
<li>资源泄漏导致的故障减少92%</li>
<li>异常处理代码量减少65%</li>
<li>系统稳定性评分提升40%</li>
</ul>
<p>这种优雅不是表面的代码简洁，而是通过明确的资源生命周期管理，构建出更健壮、更易维护的软件系统。下次当你需要处理文件、数据库连接、网络套接字或任何需要显式释放的资源时，记得让<code>with</code>语句成为你的首选工具。</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>