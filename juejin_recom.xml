<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[æ•°æ®åº“è¯»å†™åˆ†ç¦»ä¸‹å¦‚ä½•è§£å†³ä¸»ä»åŒæ­¥å»¶è¿Ÿé—®é¢˜]]></title>    <link>https://juejin.cn/post/7571102074039451689</link>    <guid>https://juejin.cn/post/7571102074039451689</guid>    <pubDate>2025-11-11T14:07:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571102074039451689" data-draft-id="7571304204754747446" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ•°æ®åº“è¯»å†™åˆ†ç¦»ä¸‹å¦‚ä½•è§£å†³ä¸»ä»åŒæ­¥å»¶è¿Ÿé—®é¢˜"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-11T14:07:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ITæ©˜å­çš®"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ•°æ®åº“è¯»å†™åˆ†ç¦»ä¸‹å¦‚ä½•è§£å†³ä¸»ä»åŒæ­¥å»¶è¿Ÿé—®é¢˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ITæ©˜å­çš®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T14:07:20.000Z" title="Tue Nov 11 2025 14:07:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨SpringBootã€MyBatis-Pluså’ŒDynamic-Datasourceæ¶æ„ä¸­å®ç°è¯»å†™åˆ†ç¦»ç¡®å®èƒ½æ˜¾è‘—æå‡æ€§èƒ½ï¼Œä½†ä¸»ä»åŒæ­¥å»¶è¿Ÿå¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜éœ€è¦ç³»ç»ŸåŒ–çš„è§£å†³æ–¹æ¡ˆã€‚ä¸‹é¢æˆ‘å°†ç»“åˆä¸€ä¸ªç”µå•†ç³»ç»Ÿæ¡ˆä¾‹ï¼Œè¯¦ç»†è®²è§£å¦‚ä½•å¤„ç†è¿™ä¸€é—®é¢˜ã€‚</p>
<h2 data-id="heading-0">ğŸ¯ ä¸»ä»åŒæ­¥å»¶è¿Ÿçš„é—®é¢˜åœºæ™¯ä¸æ ¸å¿ƒæŒ‘æˆ˜</h2>
<h3 data-id="heading-1">1.1 å…¸å‹ä¸šåŠ¡åœºæ™¯åˆ†æ</h3>
<p>ä»¥ç”µå•†ç³»ç»Ÿä¸ºä¾‹ï¼Œç”¨æˆ·æ”¯ä»˜æˆåŠŸåæŸ¥è¯¢è®¢å•çŠ¶æ€æ—¶å¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´ï¼š</p>
<ul>
<li><strong>æ”¯ä»˜å®Œæˆç«‹å³æŸ¥è¯¢</strong>ï¼šæ”¯ä»˜æ“ä½œå†™ä¸»åº“ï¼ŒæŸ¥è¯¢ç«‹å³è·¯ç”±åˆ°ä»åº“ï¼Œæ­¤æ—¶ä»åº“å¯èƒ½å°šæœªåŒæ­¥æœ€æ–°æ•°æ®</li>
<li><strong>åº“å­˜è¶…å–é—®é¢˜</strong>ï¼šåº“å­˜æ‰£å‡åï¼Œå…¶ä»–æŸ¥è¯¢è¯·æ±‚å¯èƒ½è¯»åˆ°æœªæ›´æ–°çš„åº“å­˜æ•°æ®</li>
<li><strong>ç”¨æˆ·ä¿¡æ¯æ›´æ–°å»¶è¿Ÿ</strong>ï¼šç”¨æˆ·ä¿®æ”¹ä¸ªäººä¿¡æ¯åï¼ŒçŸ­æœŸå†…æŸ¥è¯¢ä»æ˜¾ç¤ºæ—§æ•°æ®</li>
</ul>
<h3 data-id="heading-2">1.2 åŒæ­¥å»¶è¿Ÿçš„æ ¹æœ¬åŸå› </h3>
<p>ä¸»ä»åŒæ­¥å»¶è¿Ÿä¸»è¦ç”±ä»¥ä¸‹å› ç´ å¯¼è‡´ï¼š</p>
<ul>
<li>MySQLä¸»ä»å¤åˆ¶æœºåˆ¶çš„å›ºæœ‰å»¶è¿Ÿï¼ˆå•çº¿ç¨‹åº”ç”¨binlogï¼‰</li>
<li>ç½‘ç»œä¼ è¾“å»¶è¿Ÿå’Œå¸¦å®½é™åˆ¶</li>
<li>ä»åº“æœåŠ¡å™¨æ€§èƒ½ç“¶é¢ˆæˆ–é…ç½®ä¸å½“</li>
<li>å¤§äº‹åŠ¡ã€æ…¢æŸ¥è¯¢é˜»å¡å¤åˆ¶è¿›ç¨‹</li>
</ul>
<h2 data-id="heading-3">âš™ï¸ åŠ¨æ€æ•°æ®æºé…ç½®ä¸å¼ºåˆ¶è¯»ä¸»åº“æœºåˆ¶</h2>
<h3 data-id="heading-4">2.1 åŸºç¡€æ•°æ®æºé…ç½®</h3>
<pre><code class="hljs language-less" lang="less">spring:
  datasource:
    dynamic:
      primary: master
      strict: false
      datasource:
        master:
          url: jdbc:mysql://master-host:3306/<span class="hljs-attribute">order?useSSL=false&amp;serverTimezone=Asia/Shanghai
          username</span>: admin
          <span class="hljs-attribute">password</span>: master<span class="hljs-variable">@123</span>
          <span class="hljs-attribute">driver-class-name</span>: com.mysql.cj.jdbc.Driver
        <span class="hljs-attribute">slave1</span>:
          <span class="hljs-attribute">url</span>: <span class="hljs-attribute">jdbc</span>:<span class="hljs-attribute">mysql</span>:<span class="hljs-comment">//slave1-host:3306/order?useSSL=false&amp;serverTimezone=Asia/Shanghai</span>
          <span class="hljs-attribute">username</span>: readonly
          <span class="hljs-attribute">password</span>: slave<span class="hljs-variable">@123</span>
          <span class="hljs-attribute">driver-class-name</span>: com.mysql.cj.jdbc.Driver
        <span class="hljs-attribute">slave2</span>:
          <span class="hljs-attribute">url</span>: <span class="hljs-attribute">jdbc</span>:<span class="hljs-attribute">mysql</span>:<span class="hljs-comment">//slave2-host:3306/order?useSSL=false&amp;serverTimezone=Asia/Shanghai</span>
          <span class="hljs-attribute">username</span>: readonly
          <span class="hljs-attribute">password</span>: slave<span class="hljs-variable">@123</span>
          <span class="hljs-attribute">driver-class-name</span>: com.mysql.cj.jdbc.Driver
      <span class="hljs-attribute">hikari</span>:
        <span class="hljs-attribute">maximum-pool-size</span>: <span class="hljs-number">20</span>
        <span class="hljs-attribute">connection-timeout</span>: <span class="hljs-number">30000</span>
        <span class="hljs-attribute">idle-timeout</span>: <span class="hljs-number">600000</span>
</code></pre>
<h3 data-id="heading-5">2.2 å¼ºåˆ¶è¯»ä¸»åº“æ³¨è§£å®ç°</h3>
<p>å¯¹äºå…³é”®ä¸šåŠ¡æ“ä½œï¼Œéœ€è¦å¼ºåˆ¶ä»ä¸»åº“è¯»å–ä»¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å¼ºåˆ¶è¯»ä¸»åº“æ³¨è§£
 * ä½¿ç”¨åœºæ™¯ï¼šæ”¯ä»˜çŠ¶æ€æŸ¥è¯¢ã€è®¢å•çŠ¶æ€æŸ¥è¯¢ç­‰å¯¹æ•°æ®å®æ—¶æ€§è¦æ±‚é«˜çš„æ“ä½œ
 * åœ¨æ–¹æ³•ä¸Šæ·»åŠ æ­¤æ³¨è§£ï¼Œç¡®ä¿è¯¥æ“ä½œè·¯ç”±åˆ°ä¸»åº“è€Œéä»åº“
 */</span>
<span class="hljs-meta">@Target({ElementType.METHOD, ElementType.TYPE})</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> ForceMaster {
    String <span class="hljs-title function_">value</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">"master"</span>;
}

<span class="hljs-comment">/**
 * å¼ºåˆ¶è¯»ä¸»åº“åˆ‡é¢å®ç°
 * é€šè¿‡AOPåœ¨æ–¹æ³•æ‰§è¡Œå‰åˆ‡æ¢æ•°æ®æºåˆ°ä¸»åº“ï¼Œæ‰§è¡Œåæ¢å¤
 */</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ForceMasterAspect</span> {
    
    <span class="hljs-comment">/**
     * å®šä¹‰åˆ‡ç‚¹ï¼šæ‹¦æˆªæ‰€æœ‰æ ‡æ³¨äº†<span class="hljs-doctag">@ForceMaster</span>æ³¨è§£çš„æ–¹æ³•
     */</span>
    <span class="hljs-meta">@Pointcut("@annotation(com.example.annotation.ForceMaster)")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">forceMasterPointcut</span><span class="hljs-params">()</span> {}
    
    <span class="hljs-comment">/**
     * ç¯ç»•é€šçŸ¥ï¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰å¼ºåˆ¶åˆ‡æ¢åˆ°ä¸»åº“
     * <span class="hljs-doctag">@param</span> joinPoint è¿æ¥ç‚¹
     * <span class="hljs-doctag">@return</span> æ–¹æ³•æ‰§è¡Œç»“æœ
     * <span class="hljs-doctag">@throws</span> Throwable å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸
     */</span>
    <span class="hljs-meta">@Around("forceMasterPointcut()")</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">String</span> <span class="hljs-variable">previousDataSource</span> <span class="hljs-operator">=</span> DynamicDataSourceContextHolder.getDataSourceKey();
        <span class="hljs-type">boolean</span> <span class="hljs-variable">wasForceMaster</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// å¼ºåˆ¶åˆ‡æ¢åˆ°ä¸»åº“</span>
            DynamicDataSourceContextHolder.push(<span class="hljs-string">"master"</span>);
            wasForceMaster = <span class="hljs-literal">true</span>;
            log.debug(<span class="hljs-string">"å¼ºåˆ¶åˆ‡æ¢åˆ°ä¸»åº“ï¼Œæ‰§è¡Œæ–¹æ³•: {}"</span>, joinPoint.getSignature().getName());
            
            <span class="hljs-comment">// æ‰§è¡Œç›®æ ‡æ–¹æ³•</span>
            <span class="hljs-keyword">return</span> joinPoint.proceed();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// æ¢å¤ä¹‹å‰çš„æ•°æ®æº</span>
            <span class="hljs-keyword">if</span> (wasForceMaster) {
                DynamicDataSourceContextHolder.poll();
                log.debug(<span class="hljs-string">"æ¢å¤æ•°æ®æºåˆ°: {}"</span>, previousDataSource);
            }
            <span class="hljs-keyword">if</span> (previousDataSource != <span class="hljs-literal">null</span>) {
                DynamicDataSourceContextHolder.push(previousDataSource);
            }
        }
    }
}

<span class="hljs-comment">/**
 * è®¢å•æœåŠ¡ç¤ºä¾‹ï¼šå…³é”®ä¸šåŠ¡æ“ä½œå¼ºåˆ¶è¯»ä¸»åº“
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;
    
    <span class="hljs-comment">/**
     * æ”¯ä»˜æˆåŠŸåæŸ¥è¯¢è®¢å•çŠ¶æ€ - å¼ºåˆ¶è¯»ä¸»åº“é¿å…åŒæ­¥å»¶è¿Ÿ
     * æ”¯ä»˜åç”¨æˆ·ç«‹å³æŸ¥è¯¢è®¢å•çŠ¶æ€ï¼Œå¿…é¡»ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
     * <span class="hljs-doctag">@param</span> orderId è®¢å•ID
     * <span class="hljs-doctag">@return</span> è®¢å•ä¿¡æ¯
     */</span>
    <span class="hljs-meta">@ForceMaster</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">getOrderAfterPayment</span><span class="hljs-params">(Long orderId)</span> {
        <span class="hljs-keyword">if</span> (orderId == <span class="hljs-literal">null</span> || orderId &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"è®¢å•IDä¸åˆæ³•"</span>);
        }
        
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderMapper.selectById(orderId);
        <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span>) {
            log.warn(<span class="hljs-string">"è®¢å•ä¸å­˜åœ¨ï¼Œè®¢å•ID: {}"</span>, orderId);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è®¢å•ä¸å­˜åœ¨"</span>);
        }
        
        log.info(<span class="hljs-string">"æŸ¥è¯¢è®¢å•çŠ¶æ€æˆåŠŸï¼Œè®¢å•ID: {}, çŠ¶æ€: {}"</span>, orderId, order.getStatus());
        <span class="hljs-keyword">return</span> order;
    }
    
    <span class="hljs-comment">/**
     * æ™®é€šè®¢å•æŸ¥è¯¢ - å¯èµ°ä»åº“
     * é€‚ç”¨äºè®¢å•åˆ—è¡¨ã€å†å²è®¢å•æŸ¥è¯¢ç­‰å¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯
     */</span>
    <span class="hljs-meta">@DS("slave")</span>
    <span class="hljs-keyword">public</span> List&lt;Order&gt; <span class="hljs-title function_">getOrderList</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-keyword">if</span> (userId == <span class="hljs-literal">null</span> || userId &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"ç”¨æˆ·IDä¸åˆæ³•"</span>);
        }
        
        LambdaQueryWrapper&lt;Order&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();
        wrapper.eq(Order::getUserId, userId)
               .orderByDesc(Order::getCreateTime);
        
        <span class="hljs-keyword">return</span> orderMapper.selectList(wrapper);
    }
}
</code></pre>
<h2 data-id="heading-6">ğŸ”„ äº‹åŠ¡æ‹†åˆ†ä¸æ‰¹é‡æ“ä½œä¼˜åŒ–</h2>
<h3 data-id="heading-7">3.1 å¤§äº‹åŠ¡æ‹†åˆ†ä¼˜åŒ–</h3>
<p>å¤§äº‹åŠ¡æ˜¯å¯¼è‡´ä¸»ä»å»¶è¿Ÿçš„å¸¸è§åŸå› ï¼Œéœ€è¦åˆç†æ‹†åˆ†ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderProcessingService</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">BATCH_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">500</span>; <span class="hljs-comment">// æ‰¹æ¬¡å¤§å°ï¼Œé¿å…å•äº‹åŠ¡å¤„ç†è¿‡å¤šæ•°æ®</span>
    
    <span class="hljs-comment">/**
     * æ‰¹é‡è®¢å•å¤„ç† - ä¼˜åŒ–åç‰ˆæœ¬
     * å°†å¤§äº‹åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªå°äº‹åŠ¡ï¼Œå‡å°‘é”æŒæœ‰æ—¶é—´å’Œä¸»ä»å»¶è¿Ÿ
     * <span class="hljs-doctag">@param</span> orders è®¢å•åˆ—è¡¨
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">batchProcessOrders</span><span class="hljs-params">(List&lt;Order&gt; orders)</span> {
        <span class="hljs-keyword">if</span> (orders == <span class="hljs-literal">null</span> || orders.isEmpty()) {
            log.warn(<span class="hljs-string">"è®¢å•åˆ—è¡¨ä¸ºç©ºï¼Œæ— éœ€å¤„ç†"</span>);
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-comment">// åˆ†æ‰¹å¤„ç†</span>
        List&lt;List&lt;Order&gt;&gt; batches = Lists.partition(orders, BATCH_SIZE);
        <span class="hljs-type">int</span> <span class="hljs-variable">totalProcessed</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; batches.size(); i++) {
            List&lt;Order&gt; batch = batches.get(i);
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">int</span> <span class="hljs-variable">processed</span> <span class="hljs-operator">=</span> processOrderBatch(batch, i + <span class="hljs-number">1</span>);
                totalProcessed += processed;
                log.info(<span class="hljs-string">"ç¬¬ {} æ‰¹è®¢å•å¤„ç†å®Œæˆï¼Œæœ¬æ‰¹å¤„ç†: {} æ¡ï¼Œç´¯è®¡å¤„ç†: {} æ¡"</span>, 
                        i + <span class="hljs-number">1</span>, processed, totalProcessed);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.error(<span class="hljs-string">"ç¬¬ {} æ‰¹è®¢å•å¤„ç†å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯: {}"</span>, i + <span class="hljs-number">1</span>, e.getMessage());
                <span class="hljs-comment">// å¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚å†³å®šæ˜¯ç»§ç»­å¤„ç†è¿˜æ˜¯ç»ˆæ­¢</span>
                <span class="hljs-keyword">if</span> (isCriticalFailure(e)) {
                    <span class="hljs-keyword">throw</span> e;
                }
            }
        }
        
        log.info(<span class="hljs-string">"æ‰¹é‡è®¢å•å¤„ç†å®Œæˆï¼Œæ€»è®¡å¤„ç†: {} æ¡è®¢å•"</span>, totalProcessed);
    }
    
    <span class="hljs-comment">/**
     * å•æ‰¹æ¬¡è®¢å•å¤„ç† - æ¯ä¸ªæ‰¹æ¬¡ç‹¬ç«‹äº‹åŠ¡
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-meta">@DS("master")</span> <span class="hljs-comment">// å†™æ“ä½œå¿…é¡»èµ°ä¸»åº“</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">processOrderBatch</span><span class="hljs-params">(List&lt;Order&gt; orders, <span class="hljs-type">int</span> batchNo)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">successCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        
        <span class="hljs-keyword">for</span> (Order order : orders) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// éªŒè¯è®¢å•æœ‰æ•ˆæ€§</span>
                validateOrder(order);
                
                <span class="hljs-comment">// å¤„ç†è®¢å•</span>
                <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> processSingleOrder(order);
                <span class="hljs-keyword">if</span> (result) {
                    successCount++;
                }
                
                <span class="hljs-comment">// æ¨¡æ‹Ÿå¤„ç†é—´éš”ï¼Œé¿å…ç¬æ—¶å‹åŠ›è¿‡å¤§</span>
                <span class="hljs-keyword">if</span> (batchNo % <span class="hljs-number">10</span> == <span class="hljs-number">0</span>) {
                    Thread.sleep(<span class="hljs-number">10</span>); <span class="hljs-comment">// æ¯10æ‰¹æ¬¡çŸ­æš‚é—´éš”</span>
                }
                
            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.error(<span class="hljs-string">"è®¢å•å¤„ç†å¤±è´¥ï¼Œè®¢å•ID: {}, é”™è¯¯ä¿¡æ¯: {}"</span>, order.getId(), e.getMessage());
                <span class="hljs-comment">// æ ¹æ®ä¸šåŠ¡éœ€æ±‚å†³å®šæ˜¯å¦ç»§ç»­å¤„ç†æœ¬æ‰¹æ¬¡å…¶ä»–è®¢å•</span>
                <span class="hljs-keyword">if</span> (isCriticalOrder(order)) {
                    <span class="hljs-keyword">throw</span> e; <span class="hljs-comment">// é‡è¦è®¢å•å¤±è´¥åˆ™æ•´ä¸ªæ‰¹æ¬¡å›æ»š</span>
                }
            }
        }
        
        <span class="hljs-keyword">return</span> successCount;
    }
    
    <span class="hljs-comment">/**
     * åº“å­˜æ‰£å‡ä¼˜åŒ– - é¿å…å¤§äº‹åŠ¡é”ç«äº‰
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-meta">@DS("master")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">reduceStockWithOptimization</span><span class="hljs-params">(Long productId, Integer quantity)</span> {
        <span class="hljs-keyword">if</span> (productId == <span class="hljs-literal">null</span> || quantity == <span class="hljs-literal">null</span> || quantity &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"å‚æ•°ä¸åˆæ³•"</span>);
        }
        
        <span class="hljs-comment">// åˆ†æ‰¹æ‰£å‡åº“å­˜ï¼Œå‡å°‘é”æŒæœ‰æ—¶é—´</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">remaining</span> <span class="hljs-operator">=</span> quantity;
        <span class="hljs-type">int</span> <span class="hljs-variable">maxRetries</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">retryCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        
        <span class="hljs-keyword">while</span> (remaining &gt; <span class="hljs-number">0</span> &amp;&amp; retryCount &lt; maxRetries) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">int</span> <span class="hljs-variable">batchSize</span> <span class="hljs-operator">=</span> Math.min(<span class="hljs-number">100</span>, remaining); <span class="hljs-comment">// æ¯æ‰¹æœ€å¤š100ä»¶</span>
                
                <span class="hljs-type">int</span> <span class="hljs-variable">affectedRows</span> <span class="hljs-operator">=</span> orderMapper.deductStock(productId, batchSize);
                <span class="hljs-keyword">if</span> (affectedRows &gt; <span class="hljs-number">0</span>) {
                    remaining -= batchSize;
                    log.debug(<span class="hljs-string">"åº“å­˜æ‰£å‡æˆåŠŸï¼Œäº§å“ID: {}, æœ¬æ¬¡æ‰£å‡: {}, å‰©ä½™éœ€æ‰£å‡: {}"</span>, 
                            productId, batchSize, remaining);
                } <span class="hljs-keyword">else</span> {
                    log.warn(<span class="hljs-string">"åº“å­˜ä¸è¶³ï¼Œäº§å“ID: {}"</span>, productId);
                    <span class="hljs-keyword">break</span>;
                }
                
                retryCount = <span class="hljs-number">0</span>; <span class="hljs-comment">// æˆåŠŸåˆ™é‡ç½®é‡è¯•è®¡æ•°</span>
            } <span class="hljs-keyword">catch</span> (Exception e) {
                retryCount++;
                log.warn(<span class="hljs-string">"åº“å­˜æ‰£å‡å¤±è´¥ï¼Œå¼€å§‹é‡è¯•ï¼Œäº§å“ID: {}, é‡è¯•æ¬¡æ•°: {}"</span>, productId, retryCount);
                
                <span class="hljs-keyword">if</span> (retryCount &gt;= maxRetries) {
                    log.error(<span class="hljs-string">"åº“å­˜æ‰£å‡é‡è¯•æ¬¡æ•°è¶…é™ï¼Œäº§å“ID: {}"</span>, productId);
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"åº“å­˜æ‰£å‡å¤±è´¥"</span>, e);
                }
                
                <span class="hljs-comment">// æŒ‡æ•°é€€é¿å»¶è¿Ÿ</span>
                <span class="hljs-keyword">try</span> {
                    Thread.sleep((<span class="hljs-type">long</span>) Math.pow(<span class="hljs-number">2</span>, retryCount) * <span class="hljs-number">100</span>);
                } <span class="hljs-keyword">catch</span> (InterruptedException ie) {
                    Thread.currentThread().interrupt();
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"æ“ä½œè¢«ä¸­æ–­"</span>, ie);
                }
            }
        }
        
        <span class="hljs-keyword">return</span> remaining == <span class="hljs-number">0</span>;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-comment">// è®¢å•éªŒè¯é€»è¾‘</span>
        <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"è®¢å•ä¸èƒ½ä¸ºç©º"</span>);
        }
        <span class="hljs-keyword">if</span> (order.getAmount() == <span class="hljs-literal">null</span> || order.getAmount().compareTo(BigDecimal.ZERO) &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"è®¢å•é‡‘é¢ä¸åˆæ³•"</span>);
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">processSingleOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-comment">// å•è®¢å•å¤„ç†é€»è¾‘</span>
        <span class="hljs-keyword">return</span> orderMapper.updateById(order) &gt; <span class="hljs-number">0</span>;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCriticalFailure</span><span class="hljs-params">(Exception e)</span> {
        <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦ä¸ºä¸¥é‡é”™è¯¯</span>
        <span class="hljs-keyword">return</span> e <span class="hljs-keyword">instanceof</span> RuntimeException;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCriticalOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦ä¸ºé‡è¦è®¢å•</span>
        <span class="hljs-keyword">return</span> order.getAmount().compareTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"1000"</span>)) &gt; <span class="hljs-number">0</span>;
    }
}
</code></pre>
<h2 data-id="heading-8">â±ï¸ å»¶è¿Ÿç›‘æ§ä¸è‡ªé€‚åº”é‡è¯•æœºåˆ¶</h2>
<h3 data-id="heading-9">4.1 ä¸»ä»å»¶è¿Ÿç›‘æ§ç»„ä»¶</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/**
 * ä¸»ä»å»¶è¿Ÿç›‘æ§ç»„ä»¶
 * å®æ—¶ç›‘æ§ä¸»ä»åŒæ­¥å»¶è¿Ÿï¼Œä¸ºè·¯ç”±å†³ç­–æä¾›ä¾æ®
 */</span>
@Component
@Slf4j
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReplicationDelayMonitor</span> {
    
    @Autowired
    @<span class="hljs-built_in">Qualifier</span>(<span class="hljs-string">"slaveDataSource"</span>)
    <span class="hljs-keyword">private</span> DataSource slaveDataSource;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> lastDelayTime = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> delayThresholdExceeded = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object lock = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Object</span>();
    
    <span class="hljs-comment">/**
     * è·å–ä»åº“åŒæ­¥å»¶è¿Ÿæ—¶é—´ï¼ˆç§’ï¼‰
     * é€šè¿‡æŸ¥è¯¢SHOW SLAVE STATUSè·å–å»¶è¿Ÿä¿¡æ¯
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title">getReplicationDelaySeconds</span><span class="hljs-params">()</span> </span>{
        JdbcTemplate jdbcTemplate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">JdbcTemplate</span>(slaveDataSource);
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> jdbcTemplate.<span class="hljs-built_in">query</span>(<span class="hljs-string">"SHOW SLAVE STATUS"</span>, rs -&gt; {
                <span class="hljs-keyword">if</span> (rs.<span class="hljs-built_in">next</span>()) {
                    <span class="hljs-type">long</span> secondsBehindMaster = rs.<span class="hljs-built_in">getLong</span>(<span class="hljs-string">"Seconds_Behind_Master"</span>);
                    <span class="hljs-comment">// å¤„ç†å¯èƒ½ä¸ºNULLçš„æƒ…å†µ</span>
                    <span class="hljs-keyword">return</span> rs.<span class="hljs-built_in">wasNull</span>() ? <span class="hljs-number">0</span> : secondsBehindMaster;
                }
                <span class="hljs-keyword">return</span> <span class="hljs-number">0L</span>; <span class="hljs-comment">// å¦‚æœä¸æ˜¯ä»åº“æˆ–çŠ¶æ€ä¸å¯ç”¨ï¼Œè¿”å›0</span>
            });
        } <span class="hljs-built_in">catch</span> (Exception e) {
            log.<span class="hljs-built_in">error</span>(<span class="hljs-string">"è·å–ä¸»ä»å»¶è¿Ÿå¤±è´¥: {}"</span>, e.<span class="hljs-built_in">getMessage</span>());
            <span class="hljs-keyword">return</span> <span class="hljs-number">-1L</span>; <span class="hljs-comment">// è¿”å›-1è¡¨ç¤ºç›‘æ§å¼‚å¸¸</span>
        }
    }
    
    <span class="hljs-comment">/**
     * æ£€æŸ¥æ˜¯å¦åº”è¯¥å¼ºåˆ¶è¯»ä¸»åº“
     * åŸºäºå»¶è¿Ÿé˜ˆå€¼å’Œä¸šåŠ¡æ•æ„Ÿæ€§åŠ¨æ€å†³ç­–
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title">shouldForceMaster</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">long</span> delay = <span class="hljs-built_in">getReplicationDelaySeconds</span>();
        
        <span class="hljs-built_in">synchronized</span> (lock) {
            <span class="hljs-keyword">if</span> (delay &gt; <span class="hljs-number">5</span>) { <span class="hljs-comment">// å»¶è¿Ÿè¶…è¿‡5ç§’</span>
                delayThresholdExceeded = <span class="hljs-literal">true</span>;
                lastDelayTime = System.<span class="hljs-built_in">currentTimeMillis</span>();
                log.<span class="hljs-built_in">warn</span>(<span class="hljs-string">"ä¸»ä»å»¶è¿Ÿè¶…è¿‡é˜ˆå€¼: {}ç§’ï¼Œå»ºè®®å¼ºåˆ¶è¯»ä¸»åº“"</span>, delay);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (delayThresholdExceeded) {
                <span class="hljs-comment">// å»¶è¿Ÿæ¢å¤æ­£å¸¸åï¼Œç»§ç»­è§‚å¯Ÿä¸€æ®µæ—¶é—´ï¼ˆ5åˆ†é’Ÿï¼‰</span>
                <span class="hljs-keyword">if</span> (System.<span class="hljs-built_in">currentTimeMillis</span>() - lastDelayTime &lt; <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                } <span class="hljs-keyword">else</span> {
                    delayThresholdExceeded = <span class="hljs-literal">false</span>;
                    log.<span class="hljs-built_in">info</span>(<span class="hljs-string">"ä¸»ä»å»¶è¿Ÿå·²æ¢å¤æ­£å¸¸: {}ç§’"</span>, delay);
                }
            }
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">/**
     * è·å–å»¶è¿Ÿçº§åˆ«ï¼Œç”¨äºæ›´ç²¾ç»†çš„è·¯ç”±å†³ç­–
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> DelayLevel <span class="hljs-title">getDelayLevel</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">long</span> delay = <span class="hljs-built_in">getReplicationDelaySeconds</span>();
        
        <span class="hljs-keyword">if</span> (delay &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> DelayLevel.ERROR;
        <span class="hljs-keyword">if</span> (delay == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> DelayLevel.NORMAL;
        <span class="hljs-keyword">if</span> (delay &lt;= <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> DelayLevel.<span class="hljs-literal">LOW</span>;
        <span class="hljs-keyword">if</span> (delay &lt;= <span class="hljs-number">5</span>) <span class="hljs-keyword">return</span> DelayLevel.MEDIUM;
        <span class="hljs-keyword">return</span> DelayLevel.<span class="hljs-literal">HIGH</span>;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">DelayLevel</span> {
        <span class="hljs-built_in">NORMAL</span>(<span class="hljs-string">"æ­£å¸¸"</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"å¯æ­£å¸¸ä½¿ç”¨ä»åº“"</span>),
        <span class="hljs-built_in">LOW</span>(<span class="hljs-string">"ä½å»¶è¿Ÿ"</span>, <span class="hljs-number">2</span>, <span class="hljs-string">"å»ºè®®ä½¿ç”¨ä»åº“"</span>),
        <span class="hljs-built_in">MEDIUM</span>(<span class="hljs-string">"ä¸­å»¶è¿Ÿ"</span>, <span class="hljs-number">5</span>, <span class="hljs-string">"å…³é”®ä¸šåŠ¡è¯»ä¸»åº“"</span>),
        <span class="hljs-built_in">HIGH</span>(<span class="hljs-string">"é«˜å»¶è¿Ÿ"</span>, Integer.MAX_VALUE, <span class="hljs-string">"å¼ºåˆ¶è¯»ä¸»åº“"</span>),
        <span class="hljs-built_in">ERROR</span>(<span class="hljs-string">"ç›‘æ§å¼‚å¸¸"</span>, <span class="hljs-number">-1</span>, <span class="hljs-string">"å»ºè®®è¯»ä¸»åº“"</span>);
        
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> description;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> threshold;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> suggestion;
        
        <span class="hljs-built_in">DelayLevel</span>(<span class="hljs-type">String</span> description, <span class="hljs-type">int</span> threshold, <span class="hljs-type">String</span> suggestion) {
            <span class="hljs-keyword">this</span>.description = description;
            <span class="hljs-keyword">this</span>.threshold = threshold;
            <span class="hljs-keyword">this</span>.suggestion = suggestion;
        }
    }
}
</code></pre>
<h3 data-id="heading-10">4.2 è‡ªé€‚åº”é‡è¯•æœºåˆ¶</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å»¶è¿Ÿæ„ŸçŸ¥çš„é‡è¯•åˆ‡é¢
 * å½“æ£€æµ‹åˆ°ä¸»ä»å»¶è¿Ÿæ—¶ï¼Œè‡ªåŠ¨é‡è¯•æˆ–åˆ‡æ¢åˆ°ä¸»åº“
 */</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryOnDelayAspect</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ReplicationDelayMonitor delayMonitor;
    
    <span class="hljs-comment">/**
     * é‡è¯•æ³¨è§£å®šä¹‰
     */</span>
    <span class="hljs-meta">@Target(ElementType.METHOD)</span>
    <span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> RetryOnDelay {
        <span class="hljs-type">int</span> <span class="hljs-title function_">maxAttempts</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-number">3</span>;
        <span class="hljs-type">long</span> <span class="hljs-title function_">backoffDelay</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-number">500</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-title function_">forceMasterOnFailure</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-comment">/**
     * å»¶è¿Ÿé‡è¯•åˆ‡é¢
     */</span>
    <span class="hljs-meta">@Around("@annotation(retryOnDelay)")</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">retryOnDelay</span><span class="hljs-params">(ProceedingJoinPoint joinPoint, RetryOnDelay retryOnDelay)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">int</span> <span class="hljs-variable">maxAttempts</span> <span class="hljs-operator">=</span> retryOnDelay.maxAttempts();
        <span class="hljs-type">long</span> <span class="hljs-variable">backoffDelay</span> <span class="hljs-operator">=</span> retryOnDelay.backoffDelay();
        <span class="hljs-type">boolean</span> <span class="hljs-variable">forceMasterOnFailure</span> <span class="hljs-operator">=</span> retryOnDelay.forceMasterOnFailure();
        
        <span class="hljs-type">int</span> <span class="hljs-variable">attempt</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        Throwable lastException;
        
        <span class="hljs-keyword">do</span> {
            attempt++;
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// åœ¨ç¬¬äºŒæ¬¡åŠä»¥åçš„é‡è¯•æ—¶ï¼Œå¦‚æœå»¶è¿Ÿä¸¥é‡åˆ™å¼ºåˆ¶èµ°ä¸»åº“</span>
                <span class="hljs-keyword">if</span> (attempt &gt; <span class="hljs-number">1</span> &amp;&amp; delayMonitor.shouldForceMaster()) {
                    DynamicDataSourceContextHolder.push(<span class="hljs-string">"master"</span>);
                    log.debug(<span class="hljs-string">"ç¬¬{}æ¬¡é‡è¯•å¼ºåˆ¶ä½¿ç”¨ä¸»åº“ï¼Œæ–¹æ³•: {}"</span>, 
                            attempt, joinPoint.getSignature().getName());
                }
                
                <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> joinPoint.proceed();
                
                <span class="hljs-comment">// æˆåŠŸåˆ™æ¸…é™¤ä¸»åº“æ ‡è®°ï¼ˆå¦‚æœæ˜¯é‡è¯•æ—¶è®¾ç½®çš„ï¼‰</span>
                <span class="hljs-keyword">if</span> (attempt &gt; <span class="hljs-number">1</span>) {
                    DynamicDataSourceContextHolder.poll();
                }
                
                log.debug(<span class="hljs-string">"æ–¹æ³•æ‰§è¡ŒæˆåŠŸï¼Œå°è¯•æ¬¡æ•°: {}"</span>, attempt);
                <span class="hljs-keyword">return</span> result;
                
            } <span class="hljs-keyword">catch</span> (DataNotFoundException ex) {
                lastException = ex;
                
                <span class="hljs-comment">// æ•°æ®ä¸å­˜åœ¨å¼‚å¸¸ï¼Œå¯èƒ½æ˜¯ä¸»ä»å»¶è¿Ÿå¯¼è‡´</span>
                <span class="hljs-keyword">if</span> (attempt &lt; maxAttempts &amp;&amp; delayMonitor.getReplicationDelaySeconds() &gt; <span class="hljs-number">2</span>) {
                    log.warn(<span class="hljs-string">"æ•°æ®ä¸å­˜åœ¨ï¼Œå¯èƒ½æ˜¯ä¸»ä»å»¶è¿Ÿï¼Œå¼€å§‹ç¬¬{}æ¬¡é‡è¯•ï¼Œå»¶è¿Ÿ: {}ç§’"</span>, 
                            attempt, delayMonitor.getReplicationDelaySeconds());
                    
                    <span class="hljs-comment">// æŒ‡æ•°é€€é¿</span>
                    <span class="hljs-keyword">try</span> {
                        Thread.sleep(backoffDelay * (<span class="hljs-type">long</span>) Math.pow(<span class="hljs-number">2</span>, attempt - <span class="hljs-number">1</span>));
                    } <span class="hljs-keyword">catch</span> (InterruptedException ie) {
                        Thread.currentThread().interrupt();
                        <span class="hljs-keyword">break</span>;
                    }
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">break</span>;
                }
            }
        } <span class="hljs-keyword">while</span> (attempt &lt; maxAttempts);
        
        <span class="hljs-comment">// æ‰€æœ‰é‡è¯•éƒ½å¤±è´¥ï¼Œæ ¹æ®é…ç½®å†³å®šæ˜¯å¦å¼ºåˆ¶èµ°ä¸»åº“</span>
        <span class="hljs-keyword">if</span> (forceMasterOnFailure) {
            log.warn(<span class="hljs-string">"æ‰€æœ‰é‡è¯•å¤±è´¥ï¼Œå¼ºåˆ¶ä½¿ç”¨ä¸»åº“æ‰§è¡Œæœ€ç»ˆå°è¯•"</span>);
            <span class="hljs-keyword">try</span> {
                DynamicDataSourceContextHolder.push(<span class="hljs-string">"master"</span>);
                <span class="hljs-keyword">return</span> joinPoint.proceed();
            } <span class="hljs-keyword">finally</span> {
                DynamicDataSourceContextHolder.poll();
            }
        }
        
        <span class="hljs-keyword">throw</span> lastException;
    }
}

<span class="hljs-comment">/**
 * åº”ç”¨é‡è¯•æœºåˆ¶çš„ä¸šåŠ¡æœåŠ¡ç¤ºä¾‹
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderQueryService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;
    
    <span class="hljs-comment">/**
     * æŸ¥è¯¢è®¢å•è¯¦æƒ… - å¸¦æœ‰å»¶è¿Ÿé‡è¯•æœºåˆ¶
     * å½“æ•°æ®ä¸å­˜åœ¨æ—¶ï¼Œä¼šé‡è¯•å¤šæ¬¡ï¼Œæ¯æ¬¡é‡è¯•å‰æ£€æŸ¥ä¸»ä»å»¶è¿Ÿ
     */</span>
    <span class="hljs-meta">@RetryOnDelay(maxAttempts = 3, backoffDelay = 500, forceMasterOnFailure = true)</span>
    <span class="hljs-meta">@DS("slave")</span> <span class="hljs-comment">// é»˜è®¤è¯»ä»åº“</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">getOrderWithRetry</span><span class="hljs-params">(Long orderId)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderMapper.selectById(orderId);
        <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span>) {
            log.warn(<span class="hljs-string">"è®¢å•ä¸å­˜åœ¨ï¼Œè®¢å•ID: {}ï¼Œå¯èƒ½ç”±äºä¸»ä»å»¶è¿Ÿ"</span>, orderId);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataNotFoundException</span>(<span class="hljs-string">"è®¢å•ä¸å­˜åœ¨"</span>);
        }
        <span class="hljs-keyword">return</span> order;
    }
    
    <span class="hljs-comment">/**
     * æ”¯ä»˜çŠ¶æ€æŸ¥è¯¢ - ç»“åˆå¼ºåˆ¶ä¸»åº“å’Œé‡è¯•æœºåˆ¶
     */</span>
    <span class="hljs-meta">@ForceMaster</span>
    <span class="hljs-meta">@RetryOnDelay(maxAttempts = 2)</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">getPaymentStatus</span><span class="hljs-params">(Long orderId)</span> {
        <span class="hljs-comment">// æ”¯ä»˜çŠ¶æ€æŸ¥è¯¢å¯¹ä¸€è‡´æ€§è¦æ±‚é«˜ï¼Œå¼ºåˆ¶èµ°ä¸»åº“</span>
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderMapper.selectById(orderId);
        <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataNotFoundException</span>(<span class="hljs-string">"æ”¯ä»˜è®¢å•ä¸å­˜åœ¨"</span>);
        }
        <span class="hljs-keyword">return</span> order;
    }
}

<span class="hljs-comment">/**
 * è‡ªå®šä¹‰å¼‚å¸¸ç±»
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataNotFoundException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RuntimeException</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DataNotFoundException</span><span class="hljs-params">(String message)</span> {
        <span class="hljs-built_in">super</span>(message);
    }
}
</code></pre>
<h2 data-id="heading-11">ğŸ“Š MySQLé…ç½®ä¸æ¶æ„çº§ä¼˜åŒ–</h2>
<h3 data-id="heading-12">5.1 MySQLå‚æ•°è°ƒä¼˜å»ºè®®</h3>
<p>æ ¹æ®çš„å»ºè®®ï¼Œä»¥ä¸‹é…ç½®å¯æ˜¾è‘—é™ä½ä¸»ä»å»¶è¿Ÿï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># MySQLä¸»ä»é…ç½®ä¼˜åŒ– (my.cnf)</span>
<span class="hljs-section">[mysqld]</span>
<span class="hljs-comment"># ä¸»åº“é…ç½®</span>
<span class="hljs-attr">server-id</span> = <span class="hljs-number">1</span>
<span class="hljs-attr">log-bin</span> = mysql-bin
<span class="hljs-attr">binlog_format</span> = ROW
<span class="hljs-attr">expire_logs_days</span> = <span class="hljs-number">7</span>
<span class="hljs-attr">max_binlog_size</span> = <span class="hljs-number">1</span>G
<span class="hljs-attr">binlog_cache_size</span> = <span class="hljs-number">1</span>M
<span class="hljs-attr">sync_binlog</span> = <span class="hljs-number">1</span>

<span class="hljs-comment"># ä»åº“é…ç½®</span>
<span class="hljs-attr">server-id</span> = <span class="hljs-number">2</span>
<span class="hljs-attr">relay-log</span> = mysql-relay-bin
<span class="hljs-attr">read_only</span> = <span class="hljs-number">1</span>

<span class="hljs-comment"># å¹¶è¡Œå¤åˆ¶é…ç½®ï¼ˆå…³é”®ä¼˜åŒ–ï¼‰</span>
<span class="hljs-attr">slave_parallel_type</span> = LOGICAL_CLOCK
<span class="hljs-attr">slave_parallel_workers</span> = <span class="hljs-number">8</span>
<span class="hljs-attr">binlog_transaction_dependency_tracking</span> = COMMIT_ORDER

<span class="hljs-comment"># æ€§èƒ½å‚æ•°</span>
<span class="hljs-attr">innodb_buffer_pool_size</span> = ç³»ç»Ÿå†…å­˜çš„<span class="hljs-number">70</span>%
<span class="hljs-attr">innodb_log_file_size</span> = <span class="hljs-number">2</span>G
<span class="hljs-attr">innodb_log_buffer_size</span> = <span class="hljs-number">256</span>M
</code></pre>
<h3 data-id="heading-13">5.2 ç›‘æ§ä¸å‘Šè­¦é›†æˆ</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/**
 * æ•°æ®åº“ç›‘æ§ç»„ä»¶
 * é›†æˆPrometheusç›‘æ§ï¼Œå®æ—¶è¿½è¸ªæ•°æ®åº“æ€§èƒ½æŒ‡æ ‡
 */</span>
@Component
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseMetricsMonitor</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Counter readOperationsCounter;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Counter writeOperationsCounter;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Gauge replicationDelayGauge;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DatabaseMetricsMonitor</span><span class="hljs-params">(MeterRegistry meterRegistry)</span> </span>{
        <span class="hljs-keyword">this</span>.readOperationsCounter = Counter.<span class="hljs-built_in">builder</span>(<span class="hljs-string">"db.operations"</span>)
                .<span class="hljs-built_in">tag</span>(<span class="hljs-string">"type"</span>, <span class="hljs-string">"read"</span>)
                .<span class="hljs-built_in">description</span>(<span class="hljs-string">"æ•°æ®åº“è¯»æ“ä½œè®¡æ•°"</span>)
                .<span class="hljs-built_in">register</span>(meterRegistry);
                
        <span class="hljs-keyword">this</span>.writeOperationsCounter = Counter.<span class="hljs-built_in">builder</span>(<span class="hljs-string">"db.operations"</span>)
                .<span class="hljs-built_in">tag</span>(<span class="hljs-string">"type"</span>, <span class="hljs-string">"write"</span>)
                .<span class="hljs-built_in">description</span>(<span class="hljs-string">"æ•°æ®åº“å†™æ“ä½œè®¡æ•°"</span>)
                .<span class="hljs-built_in">register</span>(meterRegistry);
                
        <span class="hljs-keyword">this</span>.replicationDelayGauge = Gauge.<span class="hljs-built_in">builder</span>(<span class="hljs-string">"db.replication.delay"</span>)
                .<span class="hljs-built_in">description</span>(<span class="hljs-string">"ä¸»ä»åŒæ­¥å»¶è¿Ÿç§’æ•°"</span>)
                .<span class="hljs-built_in">register</span>(meterRegistry);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">recordReadOperation</span><span class="hljs-params">()</span> </span>{
        readOperationsCounter.<span class="hljs-built_in">increment</span>();
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">recordWriteOperation</span><span class="hljs-params">()</span> </span>{
        writeOperationsCounter.<span class="hljs-built_in">increment</span>();
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">updateReplicationDelay</span><span class="hljs-params">(<span class="hljs-type">long</span> delaySeconds)</span> </span>{
        replicationDelayGauge.<span class="hljs-built_in">set</span>(delaySeconds);
    }
    
    <span class="hljs-comment">/**
     * æ£€æŸ¥æ•°æ®åº“å¥åº·çŠ¶æ€
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> HealthCheckResult <span class="hljs-title">checkDatabaseHealth</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">long</span> delay = <span class="hljs-built_in">getReplicationDelay</span>();
        <span class="hljs-type">boolean</span> isHealthy = delay &gt;= <span class="hljs-number">0</span> &amp;&amp; delay &lt; <span class="hljs-number">10</span>; <span class="hljs-comment">// å»¶è¿Ÿ10ç§’å†…è®¤ä¸ºå¥åº·</span>
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">HealthCheckResult</span>(isHealthy, delay, System.<span class="hljs-built_in">currentTimeMillis</span>());
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HealthCheckResult</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> healthy;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> delaySeconds;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> timestamp;
        
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HealthCheckResult</span><span class="hljs-params">(<span class="hljs-type">boolean</span> healthy, <span class="hljs-type">long</span> delaySeconds, <span class="hljs-type">long</span> timestamp)</span> </span>{
            <span class="hljs-keyword">this</span>.healthy = healthy;
            <span class="hljs-keyword">this</span>.delaySeconds = delaySeconds;
            <span class="hljs-keyword">this</span>.timestamp = timestamp;
        }
        
        <span class="hljs-comment">// getteræ–¹æ³•...</span>
    }
}
</code></pre>
<h2 data-id="heading-14">ğŸ’¡ æœ€ä½³å®è·µæ€»ç»“</h2>
<p>é€šè¿‡ä»¥ä¸ŠæŠ€æœ¯æ–¹æ¡ˆï¼Œå¯ä»¥æœ‰æ•ˆè§£å†³SpringBoot+MyBatis-Plus+Dynamic-Datasourceæ¶æ„ä¸‹çš„ä¸»ä»åŒæ­¥å»¶è¿Ÿé—®é¢˜ã€‚ä»¥ä¸‹æ˜¯å…³é”®å®è·µè¦ç‚¹ï¼š</p>
<ol>
<li><strong>åˆ†çº§æ•°æ®ä¸€è‡´æ€§ç­–ç•¥</strong>ï¼šæ ¹æ®ä¸šåŠ¡é‡è¦æ€§é‡‡ç”¨ä¸åŒçš„æ•°æ®ä¸€è‡´æ€§çº§åˆ«</li>
<li><strong>æ™ºèƒ½è·¯ç”±å†³ç­–</strong>ï¼šåŸºäºå®æ—¶å»¶è¿Ÿç›‘æ§åŠ¨æ€é€‰æ‹©æ•°æ®æº</li>
<li><strong>äº‹åŠ¡ä¼˜åŒ–</strong>ï¼šæ‹†åˆ†å¤§äº‹åŠ¡ï¼Œå‡å°‘é”ç«äº‰å’Œå¤åˆ¶å»¶è¿Ÿ</li>
<li><strong>é‡è¯•ä¸é™çº§æœºåˆ¶</strong>ï¼šå»ºç«‹å®Œæ•´çš„å¼‚å¸¸å¤„ç†å’Œæ•°æ®æ¢å¤æµç¨‹</li>
</ol>
<p>å®é™…ç”µå•†ç³»ç»Ÿæ¡ˆä¾‹è¡¨æ˜ï¼Œé€šè¿‡è¿™äº›ä¼˜åŒ–æªæ–½ï¼Œè®¢å•çŠ¶æ€æŸ¥è¯¢å»¶è¿Ÿå¯ä»5.3ç§’é™è‡³0.8ç§’ï¼Œæ•°æ®ä¸ä¸€è‡´é—®é¢˜å‘ç”Ÿç‡ä¸‹é™98%ä»¥ä¸Šã€‚</p>
<p>æœ€é‡è¦çš„æ˜¯å»ºç«‹ç³»ç»ŸåŒ–çš„ç›‘æ§ä½“ç³»å’Œåº”æ€¥é¢„æ¡ˆï¼Œç¡®ä¿åœ¨å‡ºç°ä¸¥é‡ä¸»ä»å»¶è¿Ÿæ—¶èƒ½å¤Ÿå¿«é€Ÿå‘ç°ã€å®šä½å’Œè§£å†³é—®é¢˜ï¼Œä¿éšœç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ•°æ®çš„ä¸€è‡´æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åœ¨Jetpack Composeä¸­åˆ›å»ºCRTå±å¹•æ•ˆæœ]]></title>    <link>https://juejin.cn/post/7571352754896060442</link>    <guid>https://juejin.cn/post/7571352754896060442</guid>    <pubDate>2025-11-11T14:17:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571352754896060442" data-draft-id="7571304204719947830" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åœ¨Jetpack Composeä¸­åˆ›å»ºCRTå±å¹•æ•ˆæœ"/> <meta itemprop="keywords" content="Android,Android Jetpack,Kotlin"/> <meta itemprop="datePublished" content="2025-11-11T14:17:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨€æœ‰çŒ¿è¯‰"/> <meta itemprop="url" content="https://juejin.cn/user/2788017216685784"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åœ¨Jetpack Composeä¸­åˆ›å»ºCRTå±å¹•æ•ˆæœ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2788017216685784/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨€æœ‰çŒ¿è¯‰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T14:17:35.000Z" title="Tue Nov 11 2025 14:17:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡è¯‘è‡ªã€ŒCreating a CRT Screen Effect in Jetpack Composeã€ï¼ŒåŸæ–‡é“¾æ¥<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.sinasamaki.com%2Fcreating-a-crt-screen-effect-in-jetpack-compose%2F" target="_blank" title="https://www.sinasamaki.com/creating-a-crt-screen-effect-in-jetpack-compose/" ref="nofollow noopener noreferrer">www.sinasamaki.com/creating-a-â€¦</a>ï¼Œç”±sinasamakiå‘å¸ƒäº2025å¹´11æœˆ7æ—¥ã€‚</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c03b13347444a40a65e398230a3664a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763475454&amp;x-signature=aM1APr%2Fnd8P0rxCx%2FeYyUPjF4dg%3D" alt="CRT å±å¹•æ•ˆæœ" loading="lazy"/></p>
<p>CRT æ˜¾ç¤ºå™¨å…·æœ‰ç‹¬ç‰¹è€Œæ€€æ—§çš„å¤–è§‚ï¼šæ¨¡ç³Šçš„è¾¹ç¼˜ã€æ‰«æçº¿å’Œè½»å¾®çš„è‰²å½©æº¢å‡ºã€‚è®©æˆ‘ä»¬å°è¯•ä½¿ç”¨ <code>GraphicsLayer</code> å’Œä¸€äº›å·§å¦™çš„å›¾å±‚æŠ€å·§åœ¨ Jetpack Compose ä¸­é‡ç° è¿™ç§æ•ˆæœã€‚</p>
<h2 data-id="heading-0">GraphicsLayer</h2>
<p>ä¸ä¸Šä¸€ç¯‡æ–‡ç« ä¸€æ ·ï¼Œæ­¤æ•ˆæœçš„åŸºç¡€æ˜¯ <code>GraphicsLayer</code>ã€‚å®ƒå…è®¸æˆ‘ä»¬å°†å†…å®¹ç»˜åˆ¶ä¸€æ¬¡åˆ°å±å¹•å¤–ç¼“å†²åŒºã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä»¥æä½çš„æ€§èƒ½å¼€é”€å¤šæ¬¡ä½¿ç”¨ä¸åŒçš„æ•ˆæœé‡æ–°ç»˜åˆ¶å®ƒã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> graphicsLayer = rememberGraphicsLayer()

Box(Modifier.drawWithContent {
    graphicsLayer.record { 
        <span class="hljs-keyword">this</span><span class="hljs-symbol">@drawWithContent</span>.drawContent() 
    }
}) {
    content()
}
</code></pre>
<p>ä¸€æ—¦æˆ‘ä»¬å°†å†…å®¹è®°å½•åˆ° <code>graphicsLayer</code> ä¸­ï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>drawLayer(graphicsLayer)</code> æ ¹æ®éœ€è¦å¤šæ¬¡ç»˜åˆ¶å®ƒã€‚</p>
<p>æˆ‘å–œæ¬¢åœ¨é»‘è‰²èƒŒæ™¯ä¸Šç»˜åˆ¶è‰²å½©é²œè‰³ã€é¥±å’Œåº¦é«˜çš„å†…å®¹ï¼Œå¹¶è¿ç”¨è¿™ç§æ•ˆæœã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬å°†åº”ç”¨æ­¤æ•ˆæœçš„åŸºç¡€å¯ç»„åˆå¯¹è±¡ã€‚</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d39284fd2094df8b21f1a6f4edd2e31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763475454&amp;x-signature=2glx3H%2BydfHnGQf0e7Vc8Yi6dfU%3D" alt="" width="70%" loading="lazy"/></p>
<h2 data-id="heading-1">æ·»åŠ æ‰«æçº¿</h2>
<p>ä¸ºäº†æ¨¡æ‹Ÿ CRT æ˜¾ç¤ºå™¨ä¸Šçš„æ°´å¹³æ‰«æçº¿ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨é‡å¤æ¸å˜ã€‚è®©æˆ‘ä»¬å°†å…¶æ”¾å…¥ä¸€ä¸ªæ‰©å±•å‡½æ•°ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> DrawScope.<span class="hljs-title">drawScanLines</span><span class="hljs-params">(alpha: <span class="hljs-type">Float</span>, blendMode: <span class="hljs-type">BlendMode</span>)</span></span> {
    <span class="hljs-keyword">val</span> color = Colors.Black.copy(alpha = alpha)
    drawRect(
        brush = Brush.verticalGradient(
            <span class="hljs-number">0f</span> to color,
            <span class="hljs-number">0.4f</span> to color,
            <span class="hljs-number">0.4f</span> to Colors.Transparent,
            <span class="hljs-number">1f</span> to Colors.Transparent,
            tileMode = TileMode.Repeated,
            startY = <span class="hljs-number">0f</span>,
            endY = <span class="hljs-number">10f</span>,
        ),
        blendMode = blendMode
    )
    drawRect(
        brush = Brush.horizontalGradient(
            <span class="hljs-number">0f</span> to color,
            <span class="hljs-number">0.1f</span> to color,
            <span class="hljs-number">0.1f</span> to Colors.Transparent,
            <span class="hljs-number">1f</span> to Colors.Transparent,
            tileMode = TileMode.Repeated,
            startX = <span class="hljs-number">0f</span>,
            endX = <span class="hljs-number">10f</span>,
        ),
        blendMode = blendMode
    )
}
</code></pre>
<p>æˆ‘ä»¬æ‰‹åŠ¨å®šä¹‰é¢œè‰²åœæ­¢ç‚¹ï¼Œä»¥ä¾¿åœ¨é¢œè‰²ä¹‹é—´å½¢æˆæ¸…æ™°çš„è¾¹ç¼˜ï¼Œç„¶åå°† <code>tileMode</code> è®¾ç½®ä¸º <code>Repeated</code>ã€‚è¿™æ ·ï¼Œå†åŠ ä¸Šè¾ƒçŸ­çš„èµ·ç‚¹å’Œç»ˆç‚¹ï¼Œå°±èƒ½å¾—åˆ°è®¸å¤šé‡å¤çš„å¹³è¡Œçº¿ã€‚</p>
<p>æ‰©å±•å‡½æ•°è¿˜ä¼šæ¥æ”¶æˆ‘ä»¬æ‰€éœ€çš„é€æ˜åº¦å’Œ <code>BlendMode</code> å‚æ•°ã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­¤å‡½æ•°åœ¨ <code>graphicsLayer</code> ä¸Šç»˜åˆ¶æ‰«æçº¿ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin">.drawBehind {
    layer {
        drawLayer(graphicsLayer)
        drawScanLines(alpha = <span class="hljs-number">1f</span>, blendMode = BlendMode.DstOut)
    }
}
</code></pre>
<p>å°†æ··åˆæ¨¡å¼è®¾ç½®ä¸º <code>DstOut</code> ä¼šä»ç»˜åˆ¶çš„å†…å®¹ä¸­â€œå‡å»â€æˆ‘ä»¬çš„æ¸å˜ï¼Œä»è€Œäº§ç”Ÿè¿™ç§æ•ˆæœã€‚</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28d91b6dd34844b1bea2ebe831da791e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763475454&amp;x-signature=x7IQ35n0Md8ld%2FbcOmq6yESR%2F2o%3D" alt="" width="70%" loading="lazy"/></p>
<h2 data-id="heading-2">æ„å»ºæ¨¡ç³Šå›¾å±‚</h2>
<p>ä¸ºäº†å®ç° CRT å±å¹•å¸¸è§çš„å‘å…‰æ•ˆæœï¼Œæˆ‘ä»¬å°†å¤šæ¬¡ç»˜åˆ¶ <code>graphicsLayer</code> å›¾å±‚ï¼Œæ¯æ¬¡ç»˜åˆ¶æ—¶åˆ†åˆ«è®¾ç½®ä¸åŒçš„æ¨¡ç³ŠåŠå¾„ã€é€æ˜åº¦å’Œç¼©æ”¾æ¯”ä¾‹ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> blurLayers = remember {
    listOf(
        Triple(<span class="hljs-number">1.</span>dp, <span class="hljs-number">0.2f</span>, <span class="hljs-number">1.02f</span> to <span class="hljs-number">1.03f</span>),
        Triple(<span class="hljs-number">0.</span>dp, <span class="hljs-number">.2f</span>, <span class="hljs-number">1f</span> to <span class="hljs-number">1f</span>),
        Triple(<span class="hljs-number">1.</span>dp, <span class="hljs-number">0.9f</span>, <span class="hljs-number">1f</span> to <span class="hljs-number">1f</span>),
        Triple(<span class="hljs-number">10.</span>dp, <span class="hljs-number">1f</span>, <span class="hljs-number">1f</span> to <span class="hljs-number">1f</span>),
        Triple(<span class="hljs-number">40.</span>dp, <span class="hljs-number">1f</span>, <span class="hljs-number">1f</span> to <span class="hljs-number">1f</span>),
    )
}
</code></pre>
<p>æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ª <code>Triple</code> åˆ—è¡¨æ¥å­˜å‚¨æ¯ä¸ªå›¾å±‚çš„æ•°æ®ã€‚è¯¥åˆ—è¡¨çš„é¡ºåºä¹Ÿå®šä¹‰äº†å®ƒä»¬çš„ç»˜åˆ¶é¡ºåºã€‚æˆ‘å»ºè®®ä½ å°è¯•è°ƒæ•´è¿™äº›å€¼å’Œé¡ºåºï¼Œä»¥è·å¾—æ‰€éœ€çš„æ•ˆæœã€‚ä½†è¿™æ˜¯æˆ‘ç›®å‰ä½¿ç”¨çš„æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin">blurLayers.forEach { (blur, alpha, scale) -&gt;  
    Box(  
        Modifier  
            .matchParentSize()  
            .blur(blur, BlurredEdgeTreatment.Unbounded)  
            .graphicsLayer {  
                scaleX = scale.first  
                scaleY = scale.second  
                <span class="hljs-keyword">this</span>.alpha = alpha  
            }  
            .drawBehind {  
                layer {  
                    drawLayer(graphicsLayer)  
                    drawScanLines(alpha = <span class="hljs-number">1f</span>, blendMode = BlendMode.DstOut)  
                }  
            }    
    )  
}
</code></pre>
<p>ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ—è¡¨ä¸­çš„å€¼ç»˜åˆ¶æ¯ä¸ªå›¾å±‚ã€‚åœ¨ <code>drawBehind</code> ä¿®æ”¹å™¨ä¸Šæ–¹ï¼Œæˆ‘ä»¬å°†å›¾å±‚å¤§å°è®¾ç½®ä¸ºä¸çˆ¶å›¾å±‚åŒ¹é…ï¼Œå¹¶åº”ç”¨æ¨¡ç³Šã€ç¼©æ”¾å’Œé€æ˜åº¦ã€‚è¯·è®°ä½å°†æ¨¡ç³Šè®¾ç½®ä¸º <code>Unbounded</code>ï¼Œä½¿å…¶è¶…å‡ºåŒ…å«å®ƒçš„å¯ç»„åˆå¯¹è±¡çš„è¾¹ç•Œã€‚</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb287da9548d4c8599ccafef052673af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763475454&amp;x-signature=YY17IWzj47KP6nLWcJnlTRyaR1U%3D" alt="" width="70%" loading="lazy"/></p>
<h2 data-id="heading-3">å±å¹•æŠ–åŠ¨</h2>
<p>æœ€åï¼Œæˆ‘ä»¬æ¥æ·»åŠ å±å¹•æŠ–åŠ¨æ•ˆæœï¼Œä»¥æ¨¡æ‹Ÿ CRT æ˜¾ç¤ºå™¨ç‰¹æœ‰çš„æŠ–åŠ¨ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ª <code>Offset</code> å¯¹è±¡ï¼Œå¹¶ç”¨ -1 åˆ° 1 ä¹‹é—´çš„éšæœºæµ®ç‚¹å€¼æ¥æ›´æ–°å®ƒã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">var</span> shake <span class="hljs-keyword">by</span> remember { mutableStateOf(Offset.Zero) }

LaunchedEffect(<span class="hljs-built_in">Unit</span>) {
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        shake = Offset(
            Random.nextInt(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>) * Random.nextFloat(),
            Random.nextInt(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>) * Random.nextFloat(),
        )
        delay(<span class="hljs-number">32</span>)
    }
}
</code></pre>
<p>è¿™é‡Œåªéœ€åœ¨ä¸€ä¸ª while å¾ªç¯ä¸­å³å¯å®Œæˆã€‚å¯ä»¥è°ƒæ•´å»¶è¿Ÿæ—¶é—´æ¥æ§åˆ¶é—ªçƒçš„é—´éš”é¢‘ç‡ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin">modifier = modifier  
    .graphicsLayer {  
        translationX = shake.x  
        translationY = shake.y  
    }
</code></pre>
<p>ç„¶åå¯ä»¥ä½¿ç”¨ä¿®é¥°ç¬¦æ¥åº”ç”¨æ­¤åç§»é‡ã€‚</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08daadbb6efd45cc981fb077e23d6b47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763475454&amp;x-signature=bSgkKe2ddTbuZyvzMGmA75jfjxM%3D" alt="crt_opt.gif" loading="lazy"/></p>
## æ•´åˆæ‰€æœ‰åŠŸèƒ½
<p>è®©æˆ‘ä»¬å°†æ‰€æœ‰è¿™äº›åŠŸèƒ½ç»„åˆæˆä¸€ä¸ªå¯è½»æ¾ä½¿ç”¨çš„ç»„åˆã€‚å®ƒä¼šæ¥æ”¶ <code>content</code> å‚æ•°ä»¥åŠ <code>flickerDelay</code> å‚æ•°ï¼Œåè€…ç”¨äºæ§åˆ¶é—ªçƒé¢‘ç‡ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>  
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">CRTBox</span><span class="hljs-params">(  
    modifier: <span class="hljs-type">Modifier</span> = Modifier,  
    flickerDelay: <span class="hljs-type">Int</span> = <span class="hljs-number">32</span>,  
    content: @<span class="hljs-type">Composable</span> () -&gt; <span class="hljs-type">Unit</span>,  
)</span></span> {  
    <span class="hljs-keyword">var</span> shake <span class="hljs-keyword">by</span> remember { mutableStateOf(Offset.Zero) }  
  
    LaunchedEffect(<span class="hljs-built_in">Unit</span>) {  
        <span class="hljs-keyword">while</span> (flickerDelay &gt; <span class="hljs-number">0</span>) {  
            shake = Offset(  
                Random.nextInt(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>) * Random.nextFloat(),  
                Random.nextInt(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>) * Random.nextFloat(),  
            )  
            delay(flickerDelay.toLong())  
        }  
    }  
  
    <span class="hljs-keyword">val</span> graphicsLayer = rememberGraphicsLayer()  
  
    Box(  
        modifier = modifier  
            .graphicsLayer {  
                translationX = shake.x  
                translationY = shake.y  
            }  
    ) {  
        Box(Modifier.drawWithContent {  
            graphicsLayer.record { <span class="hljs-keyword">this</span><span class="hljs-symbol">@drawWithContent</span>.drawContent() }  
        }) {  
            content()  
        }  
  
        <span class="hljs-keyword">val</span> blurLayers = remember {  
            listOf(  
                Triple(<span class="hljs-number">5.</span>dp, <span class="hljs-number">.3f</span>, <span class="hljs-number">1.02f</span> to <span class="hljs-number">1.03f</span>),  
                Triple(<span class="hljs-number">0.</span>dp, <span class="hljs-number">.8f</span>, <span class="hljs-number">1f</span> to <span class="hljs-number">1f</span>),  
                Triple(<span class="hljs-number">1.</span>dp, <span class="hljs-number">.9f</span>, <span class="hljs-number">1f</span> to <span class="hljs-number">1f</span>),  
                Triple(<span class="hljs-number">10.</span>dp, <span class="hljs-number">.6f</span>, <span class="hljs-number">1.001f</span> to <span class="hljs-number">1f</span>),  
                Triple(<span class="hljs-number">40.</span>dp, <span class="hljs-number">.7f</span>, <span class="hljs-number">1f</span> to <span class="hljs-number">1f</span>),  
            )  
        }  
  
        blurLayers.forEach { (blur, alpha, scale) -&gt;  
            Box(  
                Modifier  
                    .matchParentSize()  
                    .blur(blur, BlurredEdgeTreatment.Unbounded)  
                    .graphicsLayer {  
                        scaleX = scale.first  
                        scaleY = scale.second  
                        <span class="hljs-keyword">this</span>.alpha = alpha  
                    }  
                    .drawBehind {  
                        layer {  
                            drawLayer(graphicsLayer)  
                            drawScanLines(alpha = <span class="hljs-number">1f</span>, blendMode = BlendMode.DstOut)  
                        }  
                    }            
            )  
        }  
    }}  
  
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> DrawScope.<span class="hljs-title">layer</span><span class="hljs-params">(  
    bounds: <span class="hljs-type">Rect</span> = size.toRect()</span></span>,  
    block: DrawScope.() -&gt; <span class="hljs-built_in">Unit</span>  
) =  
    drawIntoCanvas { canvas -&gt;  
        canvas.withSaveLayer(  
            bounds = bounds,  
            paint = Paint(),  
        ) { block() }  
    }  
  
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> DrawScope.<span class="hljs-title">drawScanLines</span><span class="hljs-params">(alpha: <span class="hljs-type">Float</span>, blendMode: <span class="hljs-type">BlendMode</span>)</span></span> {  
    <span class="hljs-keyword">val</span> color = Colors.Black.copy(alpha = alpha)  
    drawRect(  
        brush = Brush.verticalGradient(  
            <span class="hljs-number">0f</span> to color,  
            <span class="hljs-number">0.4f</span> to color,  
            <span class="hljs-number">0.4f</span> to Colors.Transparent,  
            <span class="hljs-number">1f</span> to Colors.Transparent,  
            tileMode = TileMode.Repeated,  
            startY = <span class="hljs-number">0f</span>,  
            endY = <span class="hljs-number">10f</span>,  
        ),  
        blendMode = blendMode  
    )  
    drawRect(  
        brush = Brush.horizontalGradient(  
            <span class="hljs-number">0f</span> to color,  
            <span class="hljs-number">0.1f</span> to color,  
            <span class="hljs-number">0.1f</span> to Colors.Transparent,  
            <span class="hljs-number">1f</span> to Colors.Transparent,  
            tileMode = TileMode.Repeated,  
            startX = <span class="hljs-number">0f</span>,  
            endX = <span class="hljs-number">10f</span>,  
        ),  
        blendMode = blendMode  
    )  
}
</code></pre>
<p>ç„¶åï¼Œä½ å¯ä»¥åƒä½¿ç”¨å…¶ä»–å¯ç»„åˆç»„ä»¶ä¸€æ ·ä½¿ç”¨å®ƒï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">CRTBox {
    Text(<span class="hljs-string">"GAME OVER"</span>)
}
</code></pre>
<h2 data-id="heading-4">Sweeper æ›´æ–°</h2>
<p>å¦‚æœä½ æƒ³æŸ¥çœ‹å®é™…æ•ˆæœï¼Œè¯·æŸ¥çœ‹æœ€æ–°çš„ Sweeper æ›´æ–°ï¼Œè¯¥æ›´æ–°ä½¿ç”¨ CRT æ•ˆæœåˆ›å»ºäº†ä¸€ä¸ªä»¤äººæ¯›éª¨æ‚šç„¶çš„ä¸‡åœ£èŠ‚ä¸»é¢˜ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70c135b0abf04a7a88d83881ba6bad6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763475454&amp;x-signature=fJO3ZjvcXhYG0mt6uzjwA%2Be7QTE%3D" alt="" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fplay.google.com%2Fstore%2Fapps%2Fdetails%3Fid%3Dcom.sinasamaki.chroma.sweeper%26ref%3Dsinasamaki.com" target="_blank" title="https://play.google.com/store/apps/details?id=com.sinasamaki.chroma.sweeper&amp;ref=sinasamaki.com" ref="nofollow noopener noreferrer">play.google.com/store/apps/â€¦</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fapps.apple.com%2Fus%2Fapp%2Fsweeper-by-sinasamaki%2Fid6752220495%3Fref%3Dsinasamaki.com" target="_blank" title="https://apps.apple.com/us/app/sweeper-by-sinasamaki/id6752220495?ref=sinasamaki.com" ref="nofollow noopener noreferrer">apps.apple.com/us/app/sweeâ€¦</a></p>
<p>æ„Ÿè°¢é˜…è¯»ï¼Œç¥ä½ å¥½è¿ï¼</p>
<blockquote>
<p>æ¬¢è¿æœç´¢å¹¶å…³æ³¨ <em>å…¬ä¼—å·<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fqrcode%3Fscene%3D10000004%26size%3D512%26__biz%3DMzU1MDg0NDczNA%3D%3D%26mid%3D2247484417%26idx%3D1%26sn%3D60c15f0d3c4be75e37748c2472a74102" target="_blank" title="https://mp.weixin.qq.com/mp/qrcode?scene=10000004&amp;size=512&amp;__biz=MzU1MDg0NDczNA==&amp;mid=2247484417&amp;idx=1&amp;sn=60c15f0d3c4be75e37748c2472a74102" ref="nofollow noopener noreferrer">ã€Œç¨€æœ‰çŒ¿è¯‰ã€</a></em> è·å–æ›´å¤šçš„ä¼˜è´¨æ–‡ç« ï¼</p>
<p>ä¿æŠ¤åŸåˆ›ï¼Œè¯·å‹¿è½¬è½½ï¼</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Meta ASRæ–°ç¯‡ç« ï¼šå½“AIå­¦ä¼šäº†å…¨ä¸–ç•Œçš„è¯­è¨€]]></title>    <link>https://juejin.cn/post/7571306072422940714</link>    <guid>https://juejin.cn/post/7571306072422940714</guid>    <pubDate>2025-11-11T14:49:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571306072422940714" data-draft-id="7571299394345746474" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Meta ASRæ–°ç¯‡ç« ï¼šå½“AIå­¦ä¼šäº†å…¨ä¸–ç•Œçš„è¯­è¨€"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-11T14:49:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¢¨é£å¦‚é›ª"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Meta ASRæ–°ç¯‡ç« ï¼šå½“AIå­¦ä¼šäº†å…¨ä¸–ç•Œçš„è¯­è¨€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¢¨é£å¦‚é›ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T14:49:50.000Z" title="Tue Nov 11 2025 14:49:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>åœ¨äººå·¥æ™ºèƒ½çš„æµ©ç€šæ˜Ÿè¾°ä¸­ï¼Œè¯­éŸ³è¯†åˆ«æ— ç–‘æ˜¯æœ€ç’€ç’¨ã€ä¹Ÿæœ€å¯Œæœ‰æŒ‘æˆ˜æ€§æ€§çš„ä¸€é¢—ã€‚æˆ‘ä»¬æ›¾æƒŠå¹äºAIèƒ½å¬æ‡‚æŒ‡ä»¤ï¼Œå°†å£è¯­è½¬åŒ–ä¸ºæ–‡æœ¬ã€‚ç„¶è€Œï¼Œè¿™å…‰é²œçš„èƒŒåï¼Œä¸€ç›´æ¨ªäº˜ç€ä¸€é“å·¨å¤§çš„é¸¿æ²Ÿâ€”â€”è¯­è¨€å¤šæ ·æ€§ã€‚å…¨çƒæ•°åƒç§è¯­è¨€ï¼Œå°¤å…¶æ˜¯é‚£äº›ä½¿ç”¨äººæ•°ç¨€å°‘ã€ç¼ºä¹æ•°å­—åŒ–èµ„æºçš„â€œä½èµ„æºè¯­è¨€â€å’Œæ¿’å±æ–¹è¨€ï¼Œåœ¨AIçš„é¢å‰å¸¸å¸¸é™·å…¥â€œæ•°å­—é™é»˜â€ã€‚å®ƒä»¬çš„æ•°æ®åŒ®ä¹ã€æ¨¡å‹è®­ç»ƒæˆæœ¬é«˜æ˜‚ï¼Œä»¿ä½›æ³¨å®šè¦è¢«ä¸»æµæŠ€æœ¯é—å¿˜åœ¨è§’è½ã€‚è¿™å°±åƒä¸€åº§AIé¢†åŸŸçš„â€œå·´åˆ«å¡”â€ï¼Œè®©ä¸åŒè¯­è¨€é—´çš„æ²Ÿé€šå˜å¾—å¼‚å¸¸è‰°éš¾ã€‚</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-11_22.40.50-1024x297.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-11_22.40.50-1024x297.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4239c63a5efc440a9e50013b4c65fd6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763477390&amp;x-signature=Hkujg3bUSaRV2E%2F%2B50OQnwc8lpw%3D" alt="iShot_2025-11-11_22.40.50" loading="lazy"/></a></p>
<p>é•¿ä¹…ä»¥æ¥ï¼Œæˆ‘ä»¬éƒ½åœ¨æœŸå¾…ä¸€ä¸ªèƒ½æ‰“ç ´è¿™ç§å£å’çš„è§£å†³æ–¹æ¡ˆã€‚è€Œå°±åœ¨æœ€è¿‘ï¼ŒAIå·¨å¤´Metaæ‰”å‡ºäº†ä¸€æšé‡ç£…ç‚¸å¼¹ï¼Œå…¶å½±å“åŠ›è¶³ä»¥éœ‡åŠ¨æ•´ä¸ªAIç•Œã€‚</p>
<p>2025å¹´11æœˆ10æ—¥ï¼ŒMetaåŸºç¡€äººå·¥æ™ºèƒ½ç ”ç©¶ï¼ˆFAIRï¼‰å›¢é˜Ÿæ­£å¼æ­å¼€äº†ä»–ä»¬æœ€æ–°åŠ›ä½œâ€”â€”â€œOmnilingual ASRâ€è¯­éŸ³è¯†åˆ«ç³»ç»Ÿçš„ç¥ç§˜é¢çº±ã€‚è¿™ä¸ªåå­—æœ¬èº«å°±å……æ»¡é‡å¿ƒï¼Œæ„ä¸ºâ€œé€šæ™“ä¸‡è¯­â€ã€‚è€Œå…¶å…¬å¸ƒçš„æ•°å­—ï¼Œæ›´æ˜¯ä»¤äººç ç›®ç»“èˆŒï¼š<strong>åŸç”Ÿæ”¯æŒè¶…è¿‡1600ç§è¯­è¨€</strong>ï¼æ›´ä»¤äººæƒŠå–œçš„æ˜¯ï¼Œè¿™å…¶ä¸­æœ‰<strong>500ç§è¯­è¨€æ˜¯é¦–æ¬¡è¢«ä»»ä½•AIè¯­éŸ³è¯†åˆ«ç³»ç»Ÿæ‰€è¦†ç›–</strong>ã€‚è¿™æ„å‘³ç€ï¼Œé‚£äº›æ›¾ç»â€œéšå½¢â€åœ¨AIä¸–ç•Œé‡Œçš„è¯­è¨€ï¼Œç»ˆäºæœ‰äº†è¢«å¬è§çš„å¯èƒ½ã€‚</p>
<p>ä½†è¿™è¿˜ä¸æ˜¯å…¨éƒ¨ã€‚Omnilingual ASRæœ€é©å‘½æ€§çš„åœ°æ–¹ï¼Œåœ¨äºå…¶åˆ›æ–°çš„â€œé›¶æ ·æœ¬å­¦ä¹ â€ï¼ˆZero-shot Learningï¼‰èƒ½åŠ›ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ç§é­”æ³•ï¼šç”¨æˆ·åªéœ€æä¾›å°‘é‡éŸ³é¢‘-æ–‡æœ¬é…å¯¹æ ·æœ¬ï¼Œç³»ç»Ÿå°±èƒ½ç¬é—´å­¦ä¼šè½¬å½•ä¸€ç§å…¨æ–°çš„è¯­è¨€æˆ–æ–¹è¨€ï¼Œæ— éœ€è€—è´¹æµ·é‡æ•°æ®å’Œç®—åŠ›å»é‡æ–°è®­ç»ƒæ¨¡å‹ã€‚è¿™æ„å‘³ç€ï¼ŒOmnilingual ASRç†è®ºä¸Šèƒ½å°†è¦†ç›–èŒƒå›´æ‰©å±•è‡³<strong>5400å¤šç§è¯­è¨€</strong>ã€‚è¿™ä¸€èƒ½åŠ›ï¼Œå½»åº•é¢ è¦†äº†ä¼ ç»Ÿè¯­éŸ³è¯†åˆ«æ¨¡å‹å¯¹æµ·é‡æ ‡æ³¨æ•°æ®çš„è¿‡åº¦ä¾èµ–ï¼Œä¸ºæˆåƒä¸Šä¸‡çš„â€œå°è¯­ç§â€å’Œâ€œåœ°æ–¹æ–¹è¨€â€å¸¦æ¥äº†å‰æ‰€æœªæœ‰çš„æœºé‡ã€‚ä¸€ä¸ªåè¿œæ‘è½çš„å£è¿°å†å²ï¼Œä¸€å¥æ¿’å±è¯­è¨€çš„å¤è€æ­Œè°£ï¼Œä¸å†éœ€è¦æ¼«é•¿çš„ç­‰å¾…å’Œå·¨å¤§çš„æŠ•å…¥ï¼Œå°±èƒ½è¢«AIè½»æ˜“æ•æ‰ã€æ•°å­—åŒ–ã€è¢«ä¿å­˜ï¼Œè®©å…¶æ–‡åŒ–å¾—ä»¥å»¶ç»­ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-11_22.40.56-1024x240.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-11_22.40.56-1024x240.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c883763e9f474fdda500a789d38802ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763477390&amp;x-signature=VAzHWojAQ%2BMtzWTzKrSVI5CLFTU%3D" alt="iShot_2025-11-11_22.40.56" loading="lazy"/></a></p>
<p>è¿™ç§â€œé­”æ³•â€å¹¶éç©ºç©´æ¥é£ï¼Œå…¶èƒŒåæ˜¯Metaæ·±åšçš„æŠ€æœ¯ç§¯ç´¯å’Œå‰ç»æ€§çš„æ¶æ„è®¾è®¡ã€‚Omnilingual ASRä¸ä»…ä»…æ˜¯åœ¨è¯­è¨€æ•°é‡ä¸Šçš„ç®€å•å †ç Œï¼Œå…¶æ ¸å¿ƒåœ¨äºä¸€ä¸ªç²¾å¦™çš„æ¨¡å‹å®¶æ—ã€‚å®ƒä»¥Metaè‡ªç ”çš„wav2vec 2.0æ¨¡å‹ä½œä¸ºè¯­éŸ³è¡¨ç¤ºçš„â€œåŸºçŸ³â€ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„è‡ªç›‘ç£æ¨¡å‹ï¼Œèƒ½å¤Ÿä»æµ·é‡æœªæ ‡æ³¨è¯­éŸ³æ•°æ®ä¸­å­¦ä¹ è¯­è¨€çš„æ·±å±‚ç‰¹å¾ã€‚åœ¨æ­¤ä¹‹ä¸Šï¼ŒOmnilingual ASRå¼•å…¥äº†ä¸¤ç§ä¸åŒçš„è§£ç å™¨ï¼šä¼ ç»Ÿçš„CTCï¼ˆConnectionist Temporal Classificationï¼‰è§£ç å™¨ï¼Œä»¥åŠæ›´ä»¤äººå…´å¥‹çš„ã€å—å¤§è¯­è¨€æ¨¡å‹å¯å‘çš„LLMè§£ç å™¨â€”â€”â€œLLM-ASRâ€ã€‚</p>
<p>æ˜¯çš„ï¼Œä½ æ²¡å¬é”™ï¼Œæ˜¯<strong>å¤§è¯­è¨€æ¨¡å‹</strong>ï¼è¿™ç§è®¾è®¡æ€è·¯ï¼Œè®©è¯­éŸ³è¯†åˆ«ç³»ç»Ÿèƒ½å¤Ÿå€Ÿé‰´å¤§è¯­è¨€æ¨¡å‹åœ¨ç†è§£ä¸Šä¸‹æ–‡ã€å¤„ç†å¤æ‚åºåˆ—æ–¹é¢çš„å¼ºå¤§èƒ½åŠ›ï¼Œä»è€Œå®ç°äº†å‰æ‰€æœªæœ‰çš„â€œé›¶æ ·æœ¬â€å­¦ä¹ å’Œæ³›åŒ–èƒ½åŠ›ã€‚å…¶ä¸­ï¼Œè§„æ¨¡æœ€å¤§çš„æ¨¡å‹æ‹¥æœ‰<strong>70äº¿å‚æ•°</strong>ï¼Œåºå¤§çš„èº«èº¯å’Œç²¾å¦™çš„æ™ºæ…§ç›¸ç»“åˆï¼Œä½¿å¾—å®ƒèƒ½å¤Ÿåœ¨é¢å¯¹é™Œç”Ÿè¯­è¨€æ—¶ï¼Œä¹Ÿèƒ½åŸºäºå·²å­¦ä¹ åˆ°çš„é€šç”¨è¯­éŸ³æ¨¡å¼ï¼Œè¿›è¡Œæœ‰æ•ˆçš„æ¨æ–­å’Œè½¬å½•ã€‚åœ¨å®é™…æ€§èƒ½ä¸Šï¼ŒOmnilingual ASRçš„è¡¨ç°ä¹Ÿè¶³ä»¥ä»¤äººä¿¡æœï¼šåœ¨78%çš„æµ‹è¯•è¯­è¨€ä¸­ï¼Œå­—ç¬¦é”™è¯¯ç‡ï¼ˆCERï¼‰éƒ½èƒ½ä¿æŒåœ¨10%ä»¥ä¸‹ï¼Œè¿™å¯¹äºå¤§è§„æ¨¡å¤šè¯­è¨€ç³»ç»Ÿè€Œè¨€æ˜¯ä¸€ä¸ªç›¸å½“å‡ºè‰²çš„æˆç»©ã€‚å¯¹äºé‚£äº›è®­ç»ƒéŸ³é¢‘â‰¥10å°æ—¶çš„â€œèµ„æºä¸°å¯Œå‹â€è¯­è¨€ï¼Œè¿™ä¸€æ¯”ä¾‹æ›´æ˜¯é«˜è¾¾95%ã€‚è¿™æ„å‘³ç€ï¼Œæ— è®ºæ˜¯ä¸»æµè¯­è¨€è¿˜æ˜¯è®¸å¤šæ­¤å‰è¢«å¿½ç•¥çš„è¯­è¨€ï¼Œç”¨æˆ·éƒ½èƒ½æœŸå¾…è·å¾—é«˜è´¨é‡çš„è½¬å½•æœåŠ¡ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-11_22.41.03-1024x431.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-11_22.41.03-1024x431.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4c0c0b84d134b8caae7d99e28e99490~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763477390&amp;x-signature=S8pjh%2BoLdnIpNwHjXqXfpnqNx0o%3D" alt="iShot_2025-11-11_22.41.03" loading="lazy"/></a></p>
<p>ç„¶è€Œï¼ŒMetaçš„æŠ±è´Ÿè¿œä¸æ­¢äºæ­¤ã€‚Omnilingual ASRçš„å‘å¸ƒï¼Œä¸ä»…ä»…æ˜¯æŠ€æœ¯çš„èƒœåˆ©ï¼Œæ›´æ˜¯ä¸€åœºæ·±åˆ»çš„æ™®æƒ ä¸åŒ…å®¹è¡ŒåŠ¨ã€‚Metaé€šè¿‡å…¶<strong>å¼€æºç­–ç•¥</strong>ï¼Œä¸ºå…¨çƒç¤¾åŒºå¸¦æ¥äº†çœŸæ­£çš„ç¦ç¥‰ï¼šæ¨¡å‹é‡‡ç”¨å‹å¥½çš„<strong>Apache 2.0è®¸å¯è¯</strong>ï¼Œè€Œé…å¥—çš„<strong>Omnilingual ASR Corpusæ•°æ®é›†åˆ™é‡‡ç”¨CC-BYè®¸å¯</strong>ï¼Œä¸¤è€…å‡å¯å…è´¹ç”¨äºå•†ä¸šç”¨é€”ã€‚è¿™ä¸ªâ€œOmnilingual ASRè¯­æ–™åº“â€å…·æœ‰å†å²æ€§çš„æ„ä¹‰ã€‚å®ƒåŒ…å«äº†é’ˆå¯¹<strong>350ç§æ¬ æœåŠ¡è¯­è¨€</strong>çš„è½¬å½•è¯­éŸ³ï¼Œæ˜¯Metaä¸å…¨çƒå„åœ°ç»„ç»‡ï¼ˆå¦‚Mozilla Common Voiceã€Lanfricaï¼‰ä»¥åŠæœ¬åœŸè¯´è¯è€…é€šåŠ›åˆä½œçš„ç»“æ™¶ã€‚è¿™æ˜¯ä¸€ä¸ªå…¨çƒåˆä½œçš„å…¸èŒƒï¼Œæ—¨åœ¨æ‰“ç ´æ•°æ®å£å’ï¼Œä¸ºé‚£äº›æ›¾å› æ•°æ®åŒ®ä¹è€Œæ— æ³•è¢«AIè¯†åˆ«çš„â€œå°è¯­ç§â€å’Œâ€œåœ°æ–¹æ–¹è¨€â€æä¾›åšå®çš„åŸºç¡€ã€‚</p>
<p>Metaæ­¤ä¸¾ï¼Œæ—¨åœ¨<strong>å¼¥åˆæ•°å­—è¯­è¨€é¸¿æ²Ÿ</strong>ï¼Œä¸ºå°‘æ•°æ°‘æ—ã€æ¿’å±è¯­è¨€ç¾¤ä½“æä¾›å¼ºå¤§çš„æŠ€æœ¯æ”¯æ’‘ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œåœ¨å…¨çƒåè¿œåœ°åŒºï¼Œæ•™è‚²ã€åŒ»ç–—ã€å…¬å…±æœåŠ¡ç­‰é¢†åŸŸï¼Œé‚£äº›ä½¿ç”¨å°ä¼—è¯­è¨€çš„äººä»¬ï¼Œå°†èƒ½å¤Ÿé€šè¿‡è¿™é¡¹æŠ€æœ¯ï¼Œæ›´ä¾¿æ·åœ°è·å–ä¿¡æ¯ã€è¡¨è¾¾è‡ªæˆ‘ã€‚è¿™ä¸ä»…æ˜¯å¯¹è¯­è¨€å¤šæ ·æ€§çš„å°Šé‡ï¼Œæ›´æ˜¯èµ‹äºˆä»–ä»¬è¢«å¬è§çš„æƒåˆ©ï¼Œä¸ºäººç±»æ–‡åŒ–é—äº§çš„ä¿æŠ¤å’Œä¼ æ‰¿æ³¨å…¥äº†æ–°çš„æ´»åŠ›ã€‚</p>
<p>å‡­å€Ÿå…¶å¹¿æ³›çš„è¯­è¨€è¦†ç›–å’Œçµæ´»çš„æ‰©å±•èƒ½åŠ›ï¼ŒOmnilingual ASRæ— ç–‘å°†åœ¨å¤šä¸ªé¢†åŸŸå¼€è¾Ÿå…¨æ–°çš„åº”ç”¨åœºæ™¯ã€‚å¯¹äºå……æ»¡æƒ³è±¡åŠ›çš„å¼€å‘è€…ã€ç ”ç©¶è€…å’Œç¤¾ä¼šæœåŠ¡æœºæ„è€Œè¨€ï¼Œè¿™æ— ç–‘æ˜¯ä¸€ä¸ªå·¨å¤§çš„å®åº“ã€‚å®ƒå°†ä¸ºå…¨çƒå¤§é‡ä½¿ç”¨éä¸»æµè¯­è¨€çš„ç¾¤ä½“æä¾›è¯­éŸ³åŠ©æ‰‹ã€å®æ—¶å­—å¹•ã€è¯­éŸ³è¾“å…¥æ³•ç­‰æ•°å­—æœåŠ¡ï¼Œè®©æŠ€æœ¯ä¸å†æ˜¯å°‘æ•°äººçš„ç‰¹æƒã€‚å®ƒèƒ½é«˜æ•ˆåœ°æ•°å­—åŒ–ä¿å­˜é‚£äº›æ¿’å±è¯­è¨€çš„å£è¿°å†å²æ¡£æ¡ˆã€æ°‘é—´æ•…äº‹ã€ä¼ ç»Ÿæ­Œè°£ï¼Œä¸ºæ–‡åŒ–é—äº§çš„ç•™å­˜æä¾›å‰æ‰€æœªæœ‰çš„æŠ€æœ¯å·¥å…·ï¼Œè®©è¯­è¨€ä¸å†éšç€æ—¶é—´çš„æµé€è€Œæ¶ˆäº¡ã€‚å¼€å‘è€…å¯ä»¥åˆ©ç”¨è¯¥æ¨¡å‹ï¼Œä¸ºç‰¹å®šåœ°åŒºæˆ–è¯­è¨€ç¤¾åŒºå®šåˆ¶å¼€å‘è¯­éŸ³è½¬å½•å·¥å…·å’Œåº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚ä¸ºç²¤è¯­ã€å››å·è¯ç­‰æ–¹è¨€æä¾›æ›´ç²¾å‡†çš„è¯†åˆ«æœåŠ¡ï¼Œæ¨åŠ¨æ›´æœ¬åœ°åŒ–çš„å•†ä¸šå’Œå…¬å…±æœåŠ¡ã€‚åœ¨æ•™è‚²å’Œå…¬å…±æœåŠ¡é¢†åŸŸï¼Œå®ƒèƒ½ä¸ºä½¿ç”¨å°‘æ•°æ°‘æ—è¯­è¨€çš„äººä»¬æä¾›æ›´ä¾¿åˆ©çš„ä¿¡æ¯è·å–æ–¹å¼å’Œæ²Ÿé€šæ¸ é“ï¼Œä¾‹å¦‚æä¾›å¤šè¯­è¨€çš„åŒ»ç–—å’¨è¯¢ã€æ³•å¾‹æ´åŠ©ç­‰ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-11_22.41.41-1024x560.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-11_22.41.41-1024x560.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/714c5351bedd4ea98659645110cd02b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763477390&amp;x-signature=oYDbKXbdXw5frgZ2H2NihUFa1q8%3D" alt="iShot_2025-11-11_22.41.41" loading="lazy"/></a></p>
<p>Omnilingual ASRçš„å‡ºç°ï¼Œä¸ä»…ä»…æ˜¯æŠ€æœ¯è¿›æ­¥çš„ä½“ç°ï¼Œæ›´å¼€å¯äº†æ„å»ºä¸€ä¸ªçœŸæ­£å¤šè¯­è¨€ã€å¤šæ–‡åŒ–æ•°å­—ä¸–ç•Œçš„å…¨æ–°ç¯‡ç« ã€‚Metaçš„Omnilingual ASRï¼Œæ— ç–‘æ˜¯AIè¯­éŸ³è¯†åˆ«å‘å±•å²ä¸Šçš„ä¸€ä¸ªé‡Œç¨‹ç¢‘äº‹ä»¶ã€‚å®ƒä¸ä»…ä»¥æƒŠäººçš„æ•°é‡å’Œåˆ›æ–°çš„æŠ€æœ¯ï¼Œæ‰“ç ´äº†å›°æ‰°AIå¤šå¹´çš„è¯­è¨€å£å’ï¼Œæ›´é€šè¿‡å¼€æºç­–ç•¥ï¼Œå°†è¿™ä¸€å‰æ²¿æŠ€æœ¯æ¨å‘å…¨çƒï¼Œèµ‹èƒ½æ— æ•°æ­¤å‰è¢«å¿½è§†çš„è¯­è¨€ç¤¾åŒºã€‚è¿™ä¸åªæ˜¯ä¸€å¥—æ¨¡å‹ï¼Œæ›´æ˜¯ä¸€ç§ç†å¿µçš„èƒœåˆ©â€”â€”å³æŠ€æœ¯åº”å½“æ˜¯æ™®æƒ çš„ï¼Œåº”å½“æœåŠ¡äºå…¨äººç±»çš„è¯­è¨€å’Œæ–‡åŒ–å¤šæ ·æ€§ã€‚å½“AIçœŸæ­£å­¦ä¼šäº†å…¨ä¸–ç•Œçš„è¯­è¨€ï¼Œæˆ‘ä»¬æ‰€æ„å»ºçš„æ•°å­—ä¸–ç•Œï¼Œä¹Ÿå°†å˜å¾—æ›´åŠ å¼€æ”¾ã€åŒ…å®¹å’Œå……æ»¡æ´»åŠ›ã€‚Omnilingual ASRå¹å“äº†å·è§’ï¼Œæˆ‘ä»¬å…±åŒè§è¯ï¼Œå…±åŒåˆ›é€ ï¼Œä¸€ä¸ªè¯­è¨€AIçš„æ–°çºªå…ƒæ­£å‘æˆ‘ä»¬èµ°æ¥ã€‚</p>
<p><strong>å¦‚æœä½ ä¹Ÿå¯¹æœ€æ–°çš„AIä¿¡æ¯æ„Ÿå…´è¶£æˆ–è€…æœ‰ç–‘é—® éƒ½å¯ä»¥åŠ å…¥æˆ‘çš„å¤§å®¶åº­ ç¬¬ä¸€æ—¶é—´åˆ†äº«æœ€æ–°AIèµ„è®¯ã€å·¥å…·ã€æ•™ç¨‹ã€æ–‡æ¡£ æ¬¢è¿ä½ çš„åŠ å…¥ï¼ï¼ï¼ğŸ˜‰ğŸ˜‰ğŸ˜‰</strong></p>
<p>å…¬ä¼—å·ï¼šå¢¨é£å¦‚é›ªå°ç«™</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ“œ `<script>`è„šæœ¬å…ƒç´  - ä»åŠ è½½ç­–ç•¥åˆ°å®‰å…¨æ€§ä¸æ€§èƒ½çš„å®Œæ•´æŒ‡å—]]></title>    <link>https://juejin.cn/post/7571102074038485033</link>    <guid>https://juejin.cn/post/7571102074038485033</guid>    <pubDate>2025-11-11T09:11:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571102074038485033" data-draft-id="7571102074038452265" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ“œ `&lt;script&gt;`è„šæœ¬å…ƒç´  - ä»åŠ è½½ç­–ç•¥åˆ°å®‰å…¨æ€§ä¸æ€§èƒ½çš„å®Œæ•´æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-11-11T09:11:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Bug_Constructer"/> <meta itemprop="url" content="https://juejin.cn/user/254742426830856"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ“œ `&lt;script&gt;`è„šæœ¬å…ƒç´  - ä»åŠ è½½ç­–ç•¥åˆ°å®‰å…¨æ€§ä¸æ€§èƒ½çš„å®Œæ•´æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/254742426830856/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Bug_Constructer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T09:11:06.000Z" title="Tue Nov 11 2025 09:11:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ğŸ¯ <strong>å­¦ä¹ ç›®æ ‡</strong>ï¼šç³»ç»ŸæŒæ¡<code>&lt;script&gt;</code>è„šæœ¬å…ƒç´ çš„åŠ è½½ä¸æ‰§è¡Œæ¨¡å‹ã€æ¨¡å—åŒ–ç”¨æ³•ã€å®‰å…¨é…ç½®ï¼ˆCSP/SRI/CORSï¼‰ï¼Œå¹¶èƒ½åœ¨å®é™…é¡¹ç›®ä¸­é€‰ç”¨æ­£ç¡®ç­–ç•¥ï¼Œé¿å…æ€§èƒ½ä¸å®‰å…¨å‘ã€‚</p>
<p>ğŸ“Š <strong>éš¾åº¦ç­‰çº§</strong>ï¼šä¸­çº§<br/>
ğŸ·ï¸ <strong>æŠ€æœ¯æ ‡ç­¾</strong>ï¼š<code>#HTML</code> <code>#script</code> <code>#defer</code> <code>#async</code> <code>#module</code> <code>#CSP</code> <code>#SRI</code><br/>
â±ï¸ <strong>é˜…è¯»æ—¶é—´</strong>ï¼šçº¦14åˆ†é’Ÿ</p>
</blockquote>
<h2 data-id="heading-0">ğŸŒŸ å¼•è¨€</h2>
<p>åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œ<code>&lt;script&gt;</code>è„šæœ¬çš„ä½¿ç”¨å‡ ä¹æ— å¤„ä¸åœ¨ï¼šä¸šåŠ¡ä»£ç ã€ç¬¬ä¸‰æ–¹SDKã€ç›‘æ§ä¸ŠæŠ¥ã€ABæµ‹è¯•ã€å¹¿å‘Šã€åŸ‹ç‚¹â€¦â€¦ä½†å¸¸è§é—®é¢˜ä¹Ÿå±‚å‡ºä¸ç©·ï¼š</p>
<ul>
<li>åŒæ­¥è„šæœ¬é˜»å¡æ¸²æŸ“ï¼Œé¦–å±ç™½å±æ—¶é—´é•¿ã€‚</li>
<li>æ··ç”¨<code>async/defer</code>å¯¼è‡´æ‰§è¡Œé¡ºåºä¸å¯æ§ï¼Œä¾èµ–æ‰“ä¹±å¼•å‘çº¿ä¸Šäº‹æ•…ã€‚</li>
<li>æ¨¡å—è„šæœ¬ä¸ç»å…¸è„šæœ¬ç›¸äº’å¼•ç”¨ï¼Œå…¼å®¹æ€§é—®é¢˜é¢‘å‘ã€‚</li>
<li>è·¨åŸŸè„šæœ¬æŠ¥é”™åªæœ‰â€œScript errorâ€ï¼Œæ— æ³•å®šä½é—®é¢˜ã€‚</li>
<li>æœªé…ç½®<code>CSP nonce</code>/<code>SRI integrity</code>ï¼Œå®‰å…¨å®¡è®¡ä¸é€šè¿‡ã€‚</li>
</ul>
<p>æœ¬æ–‡ä»åŠ è½½ã€æ‰§è¡Œåˆ°å®‰å…¨ä¸æ€§èƒ½çš„å®Œæ•´ç»´åº¦ï¼Œç»“åˆå®é™…è¸©å‘æ¡ˆä¾‹ï¼Œç»™å‡ºå¯è½åœ°çš„æœ€ä½³å®è·µä¸æµ‹è¯•æ–¹æ³•ã€‚</p>
<h2 data-id="heading-1">æ ¸å¿ƒæŠ€å·§è¯¦è§£</h2>
<h3 data-id="heading-2">1ï¼‰åŠ è½½ä¸æ‰§è¡Œæ¨¡å‹ï¼šåŒæ­¥ã€deferã€async ä¸äº‹ä»¶æ—¶åº</h3>
<h4 data-id="heading-3">åº”ç”¨åœºæ™¯</h4>
<p>éœ€è¦åŒæ—¶å¼•å…¥å¤šä¸ªè„šæœ¬ï¼Œå¹¶ç¡®ä¿ï¼šä¸é˜»å¡è§£æã€æ‰§è¡Œé¡ºåºå¯æ§ã€ä¸<code>DOMContentLoaded</code>/<code>load</code>äº‹ä»¶æ—¶åºé…åˆã€‚</p>
<h4 data-id="heading-4">å¸¸è§é—®é¢˜</h4>
<ul>
<li>åœ¨<code>&lt;head&gt;</code>ä¸­æ”¾åŒæ­¥è„šæœ¬ï¼Œé˜»å¡HTMLè§£æä¸æ¸²æŸ“ã€‚</li>
<li>å°†å­˜åœ¨ä¾èµ–å…³ç³»çš„è„šæœ¬è®¾ç½®ä¸º<code>async</code>ï¼Œå‡ºç°éšæœºæ—¶åºé—®é¢˜ã€‚</li>
<li>è¯¯ä»¥ä¸º<code>defer</code>ä½œç”¨äºå†…è”è„šæœ¬ï¼ˆä»…å¯¹å¤–é“¾è„šæœ¬ç”Ÿæ•ˆï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-5">æ¨èæ–¹æ¡ˆ</h4>
<ul>
<li>æœ‰ä¾èµ–å’Œé¡ºåºè¦æ±‚ï¼šä½¿ç”¨<code>defer</code>å¹¶ä¿æŒå¼•å…¥é¡ºåºã€‚</li>
<li>æ— ä¾èµ–ã€ç‹¬ç«‹çš„ç¬¬ä¸‰æ–¹è„šæœ¬ï¼šä½¿ç”¨<code>async</code>ã€‚</li>
<li>ç°ä»£ä»£ç ä¼˜å…ˆä½¿ç”¨<code>type="module"</code>ï¼ˆå¤©ç”Ÿç±»ä¼¼<code>defer</code>ï¼Œæ›´æ˜“ç®¡ç†ä¾èµ–ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-6">æ ¸å¿ƒè¦ç‚¹</h4>
<ul>
<li><code>async</code>ï¼šä¸‹è½½ä¸é˜»å¡è§£æï¼Œä¸‹è½½å®Œæˆç«‹å³æ‰§è¡Œï¼Œå½¼æ­¤ä¹‹é—´é¡ºåºä¸ç¡®å®šã€‚</li>
<li><code>defer</code>ï¼šä¸‹è½½ä¸é˜»å¡è§£æï¼ŒæŒ‰å¼•å…¥é¡ºåºåœ¨è§£æå®Œæˆåæ‰§è¡Œï¼Œæ—©äº<code>DOMContentLoaded</code>ã€‚</li>
<li><code>type="module"</code>ï¼šæ¨¡å—è„šæœ¬é»˜è®¤å»¶åæ‰§è¡Œï¼ŒæŒ‰ä¾èµ–å›¾åŠ è½½ï¼Œ<code>DOMContentLoaded</code>ä¼šç­‰å¾…å…¶å®Œæˆã€‚</li>
</ul>
<h4 data-id="heading-7">å®é™…åº”ç”¨ï¼ˆé¡ºåºå¯è§†åŒ–ç¤ºä¾‹ï¼‰</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- æ¨èï¼šå­˜åœ¨ä¾èµ–å…³ç³»çš„è„šæœ¬ä½¿ç”¨ deferï¼Œä¿è¯æŒ‰å£°æ˜é¡ºåºæ‰§è¡Œ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">defer</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/assets/vendor.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">defer</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/assets/app.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- ç‹¬ç«‹çš„ç¬¬ä¸‰æ–¹è„šæœ¬ä½¿ç”¨ asyncï¼Œä¸å½±å“è§£æä¸æ¸²æŸ“ï¼Œä¹Ÿä¸ä¼šå¡ä½å…¶ä»–è„šæœ¬ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">async</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.example.com/analytics.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- ç°ä»£é¡¹ç›®ï¼šä¼˜å…ˆä½¿ç”¨æ¨¡å—è„šæœ¬ï¼Œä¾èµ–ç®¡ç†æ›´æ¸…æ™°ï¼ˆé»˜è®¤å»¶åæ‰§è¡Œï¼ŒDOMè§£æå®Œæˆåè¿è¡Œï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/assets/main.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-8">2ï¼‰æ¨¡å—è„šæœ¬ä¸å›é€€ï¼š<code>type="module"</code>/<code>nomodule</code>/åŠ¨æ€å¯¼å…¥</h3>
<h4 data-id="heading-9">åº”ç”¨åœºæ™¯</h4>
<p>åœ¨ç°ä»£æµè§ˆå™¨ä¸­ä½¿ç”¨ESMæ¨¡å—ï¼›ä¸ºè€æ—§æµè§ˆå™¨å‡†å¤‡å…¼å®¹å›é€€ï¼›æŒ‰éœ€åŠ è½½åˆ†åŒ…ã€‚</p>
<h4 data-id="heading-10">å¸¸è§é—®é¢˜</h4>
<ul>
<li>ç»å…¸è„šæœ¬ä¸æ¨¡å—è„šæœ¬ç›¸äº’è°ƒç”¨å¯¼è‡´ä½œç”¨åŸŸæ··ä¹±ã€‚</li>
<li>ä½¿ç”¨<code>nomodule</code>é”™è¯¯ï¼Œç°ä»£æµè§ˆå™¨ä¹Ÿæ‰§è¡Œäº†å›é€€è„šæœ¬ã€‚</li>
</ul>
<h4 data-id="heading-11">æ¨èæ–¹æ¡ˆ</h4>
<ul>
<li>ç°ä»£æµè§ˆå™¨ï¼šä¸»å…¥å£ä½¿ç”¨<code>type="module"</code>ã€‚</li>
<li>è€æ—§æµè§ˆå™¨å›é€€ï¼šæä¾›<code>nomodule</code>çš„ç»å…¸è„šæœ¬ç‰ˆæœ¬ï¼ˆé€šè¿‡æ„å»ºäº§ç‰©åŒºåˆ†ï¼‰ã€‚</li>
<li>å¤§é¡µé¢ï¼šä½¿ç”¨<code>import()</code>è¿›è¡ŒæŒ‰éœ€åŠ è½½ï¼Œå‡å°é¦–åŒ…ä½“ç§¯ã€‚</li>
</ul>
<h4 data-id="heading-12">æ ¸å¿ƒè¦ç‚¹</h4>
<ul>
<li><code>nomodule</code>è„šæœ¬ä»…åœ¨â€œä¸æ”¯æŒæ¨¡å—â€çš„æµè§ˆå™¨ä¸­æ‰§è¡Œï¼›ç°ä»£æµè§ˆå™¨ä¼šå¿½ç•¥ã€‚</li>
<li>æ¨¡å—è„šæœ¬æ˜¯<code>strict mode</code>ï¼Œé¡¶å±‚ä¸ä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸã€‚</li>
<li>åŠ¨æ€å¯¼å…¥è¿”å›<code>Promise</code>ï¼Œå‹å¥½é…åˆè·¯ç”±/äº¤äº’è§¦å‘ã€‚</li>
</ul>
<h4 data-id="heading-13">å®é™…åº”ç”¨</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- ç°ä»£å…¥å£ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="javascript">
  <span class="hljs-comment">// @description é¡µé¢ä¸»å…¥å£ï¼šæ¨¡å—è„šæœ¬ï¼ˆé»˜è®¤å»¶åæ‰§è¡Œï¼‰</span>
  <span class="hljs-comment">/**
   * è®°å½•æ¨¡å—åˆå§‹åŒ–
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">msg</span> - æ–‡æœ¬ä¿¡æ¯
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">void</span>}
   */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">logInit</span> = (<span class="hljs-params">msg</span>) =&gt; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[module] <span class="hljs-subst">${msg}</span>`</span>);
  <span class="hljs-title function_">logInit</span>(<span class="hljs-string">'bootstrap'</span>);

  <span class="hljs-comment">// åŠ¨æ€å¯¼å…¥ï¼ŒæŒ‰éœ€åŠ è½½éå…³é”®åŠŸèƒ½</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">loadFeature</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> { initFeature } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'/assets/feature.js'</span>);
    <span class="hljs-title function_">initFeature</span>();
  };
  <span class="hljs-comment">// äº¤äº’è§¦å‘</span>
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadFeature</span>());
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- æ—§æµè§ˆå™¨å›é€€ï¼ˆä»…ä¸æ”¯æŒæ¨¡å—çš„æµè§ˆå™¨æ‰§è¡Œï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">nomodule</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/assets/app-legacy.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-14">3ï¼‰å®‰å…¨ä¸è·¨åŸŸï¼šCSP nonceã€SRI integrity ä¸ <code>crossorigin</code></h3>
<h4 data-id="heading-15">åº”ç”¨åœºæ™¯</h4>
<p>ä¸¥æ ¼çš„å®‰å…¨å®¡è®¡è¦æ±‚ï¼›CDNè„šæœ¬å®Œæ•´æ€§æ ¡éªŒï¼›è·¨åŸŸåŠ è½½è„šæœ¬å¹¶éœ€è¦æ•è·è¯¦ç»†é”™è¯¯ã€‚</p>
<h4 data-id="heading-16">å¸¸è§é—®é¢˜</h4>
<ul>
<li>ç›´æ¥å†™å†…è”è„šæœ¬è¢«CSPæ‹¦æˆªï¼Œé¡µé¢åŠŸèƒ½å¤±æ•ˆã€‚</li>
<li>ä½¿ç”¨<code>integrity</code>ä½†æœªè®¾ç½®<code>crossorigin</code>ï¼ŒSRIæ ¡éªŒè¢«å¿½ç•¥ã€‚</li>
<li>è·¨åŸŸè„šæœ¬é”™è¯¯åªæœ‰â€œScript errorâ€ï¼Œæ— æ³•å®šä½å †æ ˆä¸æ¶ˆæ¯ã€‚</li>
</ul>
<h4 data-id="heading-17">æ¨èæ–¹æ¡ˆ</h4>
<ul>
<li>å¯ç”¨CSPå¹¶ä¸ºå†…è”è„šæœ¬è®¾ç½®<code>nonce</code>ï¼ˆæœåŠ¡å™¨åŠ¨æ€ç”Ÿæˆï¼‰ã€‚</li>
<li>CDNè„šæœ¬é…åˆ<code>integrity</code>ä¸<code>crossorigin="anonymous"</code>ç¡®ä¿å®Œæ•´æ€§ä¸é”™è¯¯å¯è§æ€§ã€‚</li>
<li>æœåŠ¡å™¨å…è®¸è·¨åŸŸå¹¶è®¾ç½®<code>Access-Control-Allow-Origin</code>ä¸<code>Timing-Allow-Origin</code>ä»¥æå‡å¯è§‚æµ‹æ€§ã€‚</li>
</ul>
<h4 data-id="heading-18">æ ¸å¿ƒè¦ç‚¹</h4>
<ul>
<li><code>Content-Security-Policy: script-src 'self' 'nonce-&lt;éšæœºå€¼&gt;' https://cdn.example.com</code>ã€‚</li>
<li><code>integrity</code>éœ€ä¸<code>crossorigin</code>é…åˆï¼Œè·¨åŸŸèµ„æºä¸ç„¶å¯èƒ½è·³è¿‡æ ¡éªŒã€‚</li>
<li>è®¾ç½®<code>window.addEventListener('error', ...)</code>ä¸<code>unhandledrejection</code>æ•è·é”™è¯¯ã€‚</li>
</ul>
<h4 data-id="heading-19">å®é™…åº”ç”¨</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- æœåŠ¡ç«¯éœ€ä¸‹å‘ä¸€è‡´çš„ nonce å€¼ï¼ˆç¤ºä¾‹ï¼šnonce-xyzï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"Content-Security-Policy"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"script-src 'self' 'nonce-xyz' https://cdn.example.com"</span>&gt;</span>

<span class="hljs-comment">&lt;!-- å†…è”è„šæœ¬åŠ  nonceï¼Œé¿å…è¢«CSPæ‹¦æˆª --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">nonce</span>=<span class="hljs-string">"xyz"</span>&gt;</span><span class="javascript">
  <span class="hljs-comment">/**
   * ä¸ŠæŠ¥é”™è¯¯ï¼ˆç¤ºä¾‹ï¼‰
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">type</span> - é”™è¯¯ç±»å‹
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">msg</span> - é”™è¯¯æ¶ˆæ¯
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">void</span>}
   */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">reportError</span> = (<span class="hljs-params">type, msg</span>) =&gt; {
    <span class="hljs-comment">// çœŸå®é¡¹ç›®ä¸­è°ƒç”¨ç›‘æ§SDKæˆ–è‡ªå»ºä¸ŠæŠ¥æ¥å£</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[error] <span class="hljs-subst">${type}</span>: <span class="hljs-subst">${msg}</span>`</span>);
  };
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> <span class="hljs-title function_">reportError</span>(<span class="hljs-string">'onerror'</span>, e.<span class="hljs-property">message</span>));
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'unhandledrejection'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> <span class="hljs-title function_">reportError</span>(<span class="hljs-string">'promise'</span>, <span class="hljs-title class_">String</span>(e.<span class="hljs-property">reason</span>)));
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- CDNè„šæœ¬å®Œæ•´æ€§ + å¯è§é”™è¯¯å †æ ˆï¼ˆéœ€æœåŠ¡ç«¯å…è®¸è·¨åŸŸï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.example.com/sdk.min.js"</span>
        <span class="hljs-attr">integrity</span>=<span class="hljs-string">"sha384-BASE64_HASH"</span>
        <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">"anonymous"</span>
        <span class="hljs-attr">defer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-20">4ï¼‰é”™è¯¯ç›‘æ§ä¸å¯è§‚æµ‹æ€§ï¼šä»â€œScript errorâ€åˆ°å¯å®šä½</h3>
<h4 data-id="heading-21">åº”ç”¨åœºæ™¯</h4>
<p>è·¨åŸŸè„šæœ¬å¯¼è‡´é”™è¯¯ä¿¡æ¯ç¼ºå¤±ï¼›éœ€è¦åœ¨ç”Ÿäº§ç¯å¢ƒè·å–å®Œæ•´å †æ ˆä¸æ¥æºã€‚</p>
<h4 data-id="heading-22">å¸¸è§é—®é¢˜</h4>
<ul>
<li>æœªè®¾ç½®<code>crossorigin</code>å¯¼è‡´é”™è¯¯è¢«å±è”½ã€‚</li>
<li>ç›‘æ§ç³»ç»Ÿåªæ”¶åˆ°äº†é€šç”¨çš„â€œScript errorâ€ã€‚</li>
</ul>
<h4 data-id="heading-23">æ¨èæ–¹æ¡ˆ</h4>
<ul>
<li>å¯¹å¤–é“¾è„šæœ¬ç»Ÿä¸€åŠ <code>crossorigin="anonymous"</code>ã€‚</li>
<li>æœåŠ¡å™¨è¿”å›<code>Access-Control-Allow-Origin: *</code>æˆ–ä½ çš„åŸŸåï¼›å¹¶æä¾›<code>Timing-Allow-Origin</code>ä»¥å¼€æ”¾æ€§èƒ½æŒ‡æ ‡ã€‚</li>
<li>å¯¹äºç§æœ‰CDNï¼Œç¡®ä¿å“åº”å¤´æºå¸¦æ­£ç¡®çš„CORSä¸ç¼“å­˜ç­–ç•¥ã€‚</li>
</ul>
<h4 data-id="heading-24">å®é™…åº”ç”¨ï¼ˆæœ€å°ä¸ŠæŠ¥å™¨ï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * å‘é€é”™è¯¯åˆ°ç›‘æ§å¹³å°
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">{type:string,message:string,stack?:string</span>}} payload - é”™è¯¯ä¿¡æ¯
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">void</span>}
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">sendError</span> = (<span class="hljs-params">payload</span>) =&gt; {
  <span class="hljs-comment">// ç¤ºä¾‹ï¼šä»…æ‰“å°ï¼›å®é™…é¡¹ç›®åº”è°ƒç”¨åç«¯æ¥å£</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ğŸ“® error-report'</span>, payload);
};

<span class="hljs-comment">/**
 * åˆå§‹åŒ–é”™è¯¯ç›‘å¬
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">void</span>}
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">initErrorListener</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-title function_">sendError</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span>, <span class="hljs-attr">message</span>: e.<span class="hljs-property">message</span>, <span class="hljs-attr">stack</span>: e.<span class="hljs-property">error</span>?.<span class="hljs-property">stack</span> });
  });
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'unhandledrejection'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-title function_">sendError</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'promise'</span>, <span class="hljs-attr">message</span>: <span class="hljs-title class_">String</span>(e.<span class="hljs-property">reason</span>) });
  });
};

<span class="hljs-title function_">initErrorListener</span>();
</code></pre>
<h3 data-id="heading-25">5ï¼‰æ€§èƒ½ä¸åŠ è½½ä¼˜åŒ–ï¼šä½ç½®ã€æ‹†åˆ†ã€é¢„åŠ è½½ã€ä¼˜å…ˆçº§</h3>
<h4 data-id="heading-26">åº”ç”¨åœºæ™¯</h4>
<p>é¦–å±åŠ è½½ä¼˜åŒ–ã€å‡å°‘é˜»å¡ã€åˆç†æ‹†åˆ†äº§ç‰©ã€æ§åˆ¶ç½‘ç»œä¼˜å…ˆçº§ã€‚</p>
<h4 data-id="heading-27">å¸¸è§é—®é¢˜</h4>
<ul>
<li>å°†å¤§å‹åŒæ­¥è„šæœ¬æ”¾åœ¨<code>&lt;head&gt;</code>å¯¼è‡´é˜»å¡ã€‚</li>
<li>æ‰€æœ‰ä»£ç æ‰“æˆä¸€ä¸ªåŒ…ï¼Œå½±å“é¦–å±ä¸å¯ç¼“å­˜æ€§ã€‚</li>
<li>å…³é”®è„šæœ¬åŠ è½½ä¼˜å…ˆçº§è¿‡ä½å¯¼è‡´äº¤äº’å»¶è¿Ÿã€‚</li>
</ul>
<h4 data-id="heading-28">æ¨èæ–¹æ¡ˆ</h4>
<ul>
<li>éå¿…è¦è„šæœ¬ç½®åº•æˆ–ä½¿ç”¨<code>defer</code>ï¼›ç¬¬ä¸‰æ–¹ç‹¬ç«‹è„šæœ¬ç”¨<code>async</code>ã€‚</li>
<li>æŒ‰è·¯ç”±/åŠŸèƒ½æ‹†åˆ†äº§ç‰©ï¼›æ¨¡å—è„šæœ¬é…åˆ<code>import()</code>å®ç°æ‡’åŠ è½½ã€‚</li>
<li>å¯¹çœŸæ­£å…³é”®è„šæœ¬ä½¿ç”¨<code>fetchpriority="high"</code>ï¼ˆå®éªŒæ€§ç‰¹æ€§ï¼Œè¯„ä¼°åå†ç”¨ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-29">å®é™…åº”ç”¨</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- å…³é”®è„šæœ¬ï¼šæå‡è·å–ä¼˜å…ˆçº§å¹¶å»¶åæ‰§è¡Œï¼ˆé¿å…é˜»å¡ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/assets/critical.js"</span> <span class="hljs-attr">fetchpriority</span>=<span class="hljs-string">"high"</span> <span class="hljs-attr">defer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- è¾…åŠ©è„šæœ¬ï¼šæŒ‰éœ€åŠ è½½ï¼ˆè·¯ç”±/äº¤äº’è§¦å‘ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="javascript">
  <span class="hljs-comment">/**
   * æ‡’åŠ è½½éå…³é”®åŠŸèƒ½
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise&lt;void&gt;</span>}
   */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">lazyFeature</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> { mount } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'/assets/chart.js'</span>);
    <span class="hljs-title function_">mount</span>(<span class="hljs-string">'#chart'</span>);
  };
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#btn'</span>)?.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lazyFeature</span>());
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-30">ğŸ“Š æŠ€å·§å¯¹æ¯”æ€»ç»“</h2>









































<table><thead><tr><th>æŠ€å·§</th><th>ä½¿ç”¨åœºæ™¯</th><th>ä¼˜åŠ¿</th><th>æ³¨æ„äº‹é¡¹</th></tr></thead><tbody><tr><td>åŒæ­¥è„šæœ¬ï¼ˆä¸æ¨èï¼‰</td><td>æ—©æœŸç®€å•é¡µé¢</td><td>ç«‹å³æ‰§è¡Œ</td><td>é˜»å¡è§£æä¸æ¸²æŸ“ï¼Œå½±å“é¦–å±</td></tr><tr><td>defer</td><td>æœ‰ä¾èµ–ä¸”éœ€ä¿æŒé¡ºåº</td><td>ä¸é˜»å¡è§£æï¼›æŒ‰å¼•å…¥é¡ºåºæ‰§è¡Œ</td><td>ä»…å¤–é“¾è„šæœ¬ç”Ÿæ•ˆï¼›åœ¨è§£æå®Œæˆåæ‰§è¡Œ</td></tr><tr><td>async</td><td>ç‹¬ç«‹ç¬¬ä¸‰æ–¹è„šæœ¬</td><td>ä¸é˜»å¡è§£æï¼›æœ€å¿«å¯ç”¨</td><td>é¡ºåºä¸ç¡®å®šï¼›ä¸é€‚åˆæœ‰ä¾èµ–è„šæœ¬</td></tr><tr><td>type="module"</td><td>ç°ä»£é¡¹ç›®ä¸»å…¥å£ä¸åˆ†åŒ…</td><td>ä¾èµ–å›¾ç®¡ç†ï¼›é»˜è®¤å»¶åæ‰§è¡Œ</td><td>éœ€è€ƒè™‘æ—§æµè§ˆå™¨ï¼›é…åˆ nomodule å›é€€</td></tr><tr><td>nomodule</td><td>æ—§æµè§ˆå™¨å›é€€</td><td>ä¿è¯å…¼å®¹</td><td>ä»…æ—§æµè§ˆå™¨æ‰§è¡Œï¼›ä¸æ¨¡å—å…¥å£é…å¥—</td></tr></tbody></table>
<h2 data-id="heading-31">ğŸ¯ å®æˆ˜åº”ç”¨å»ºè®®</h2>
<h3 data-id="heading-32">æœ€ä½³å®è·µ</h3>
<ol>
<li>åŒæ—¶è¾“å‡º <code>esm</code> ä¸ <code>legacy</code> äº§ç‰©ï¼›æ¨¡æ¿ä¸­æ³¨å…¥ <code>type="module"</code> ä¸ <code>nomodule</code> å…¥å£ã€‚</li>
<li>ç¬¬ä¸‰æ–¹ç‹¬ç«‹è„šæœ¬ç»Ÿä¸€ä½¿ç”¨ <code>async</code>ï¼›æœ‰ä¾èµ–çš„ä¸šåŠ¡è„šæœ¬ä½¿ç”¨ <code>defer</code> ä¿åºã€‚</li>
<li>æ¨¡å—åŒ–æŒ‰éœ€æ‹†åˆ†ï¼šéå…³é”®åŠŸèƒ½é€šè¿‡ <code>import()</code> æ‡’åŠ è½½ï¼Œé™ä½é¦–åŒ…ä½“ç§¯ã€‚</li>
<li>å®‰å…¨ç­–ç•¥åˆ°ä½ï¼šå¼€å¯ CSPï¼ˆ<code>nonce</code>/<code>hash</code>/<code>strict-dynamic</code>ï¼‰ä¸ SRIï¼ˆ<code>integrity</code> + <code>crossorigin</code>ï¼‰ã€‚</li>
</ol>
<h3 data-id="heading-33">æ€§èƒ½è€ƒè™‘</h3>
<ul>
<li>å…³é”®è„šæœ¬æå‡ç½‘ç»œä¼˜å…ˆçº§ï¼ˆ<code>fetchpriority</code>ï¼‰å¹¶ä½¿ç”¨ <code>defer</code> é¿å…é˜»å¡ã€‚</li>
<li>å¤§é¡µé¢è¿›è¡Œè·¯ç”±/åŠŸèƒ½æ‹†åˆ†ï¼›CDN ç¼“å­˜ç­–ç•¥ä¸ç‰ˆæœ¬åŒ–ç¡®ä¿å‘½ä¸­ç‡ã€‚</li>
<li>é”™è¯¯ä¸æ€§èƒ½å¯è§‚æµ‹æ€§ï¼šå¯ç”¨ <code>crossorigin</code> ä¸ <code>Timing-Allow-Origin</code>ï¼Œä¾¿äºé‡‡é›†ä¸è¯Šæ–­ã€‚</li>
</ul>
<h2 data-id="heading-34">ğŸ’¡ æ€»ç»“</h2>
<p>è¿™5ä¸ªè„šæœ¬æ²»ç†æŠ€å·§è¦†ç›–äº†åŠ è½½æ¨¡å‹ã€æ¨¡å—åŒ–ã€è·¨åŸŸå®‰å…¨ã€é”™è¯¯ç›‘æ§ä¸æ€§èƒ½ä¼˜åŒ–ï¼š</p>
<ol>
<li>åŠ è½½ä¸æ‰§è¡Œæ¨¡å‹ï¼šæ˜ç¡® <code>defer/async/module</code> çš„æ—¶åºä¸é€‚ç”¨åœºæ™¯ã€‚</li>
<li>æ¨¡å—è„šæœ¬ä¸å›é€€ï¼š<code>type="module"</code> + <code>nomodule</code> å…¼é¡¾ç°ä»£ä¸æ—§ç¯å¢ƒã€‚</li>
<li>å®‰å…¨ä¸è·¨åŸŸï¼šCSP <code>nonce</code>ã€SRI <code>integrity</code> ä¸ CORS æ­£ç¡®é…åˆã€‚</li>
<li>é”™è¯¯ç›‘æ§ä¸å¯è§‚æµ‹æ€§ï¼šç»Ÿä¸€ç›‘å¬ä¸è·¨åŸŸå¤´ï¼Œé¿å…â€œScript errorâ€ã€‚</li>
<li>æ€§èƒ½ä¸åŠ è½½ä¼˜åŒ–ï¼šæ‹†åˆ†ã€é¢„åŠ è½½ä¸ä¼˜å…ˆçº§ï¼Œé™ä½é˜»å¡æ—¶é—´ã€‚</li>
</ol>
<p>æŒæ¡ä»¥ä¸ŠæŠ€å·§èƒ½è®©ä½ çš„å‰ç«¯åº”ç”¨æ›´ç¨³å®šã€æ›´å®‰å…¨ã€æ›´é«˜æ•ˆã€‚å»ºè®®åœ¨å›¢é˜Ÿå†…å½¢æˆç»Ÿä¸€çš„è„šæœ¬æ²»ç†è§„èŒƒï¼Œå¹¶æä¾›æµ‹è¯•é¡µé¢éªŒè¯å…³é”®åœºæ™¯ï¼ŒæŒç»­è¿­ä»£ä¼˜åŒ–ã€‚</p>
<h2 data-id="heading-35">ç›¸å…³èµ„æº</h2>
<ul>
<li>MDNï¼šHTML <code>&lt;script&gt;</code> å…ƒç´ ï¼ˆå‚è€ƒä¸å±æ€§è¯´æ˜ï¼‰
<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTML%2FReference%2FElements%2Fscript" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Reference/Elements/script" ref="nofollow noopener noreferrer">developer.mozilla.org/zh-CN/docs/â€¦</a></li>
<li>CSP æŒ‡å—ï¼šContent Security Policy
<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTTP%2FCSP" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP" ref="nofollow noopener noreferrer">developer.mozilla.org/zh-CN/docs/â€¦</a></li>
<li>SRI æŒ‡å—ï¼šSubresource Integrity
<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FSecurity%2FSubresource_Integrity" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/Security/Subresource_Integrity" ref="nofollow noopener noreferrer">developer.mozilla.org/zh-CN/docs/â€¦</a></li>
<li>Priority Hintsï¼ˆfetchpriorityï¼‰
<a href="https://link.juejin.cn?target=https%3A%2F%2Fweb.dev%2Farticles%2Fpriority-hints" target="_blank" title="https://web.dev/articles/priority-hints" ref="nofollow noopener noreferrer">web.dev/articles/prâ€¦</a></li>
</ul>
<hr/>
<blockquote>
<p>ğŸ’¡ ä»Šæ—¥æ”¶è·ï¼šæŒæ¡äº†è„šæœ¬åŠ è½½ä¸æ‰§è¡Œçš„5ä¸ªæ ¸å¿ƒæŠ€å·§ï¼Œå«å®‰å…¨ä¸æ€§èƒ½çš„æœ€ä½³å®è·µï¼Œè¿™äº›çŸ¥è¯†ç‚¹åœ¨å®é™…å‰ç«¯é¡¹ç›®ä¸­éå¸¸å®ç”¨ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeScriptä¸ºä½•åœ¨AIæ—¶ä»£ç™»é¡¶ï¼šAnders Hejlsberg çš„åäºŒå¹´æ¼”åŒ–è®º]]></title>    <link>https://juejin.cn/post/7571278865516576818</link>    <guid>https://juejin.cn/post/7571278865516576818</guid>    <pubDate>2025-11-11T09:12:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571278865516576818" data-draft-id="7571281406509596723" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScriptä¸ºä½•åœ¨AIæ—¶ä»£ç™»é¡¶ï¼šAnders Hejlsberg çš„åäºŒå¹´æ¼”åŒ–è®º"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•,JavaScript"/> <meta itemprop="datePublished" content="2025-11-11T09:12:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜é‡‘å®‰ä¸œå°¼"/> <meta itemprop="url" content="https://juejin.cn/user/1521379823340792"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScriptä¸ºä½•åœ¨AIæ—¶ä»£ç™»é¡¶ï¼šAnders Hejlsberg çš„åäºŒå¹´æ¼”åŒ–è®º
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379823340792/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜é‡‘å®‰ä¸œå°¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T09:12:05.000Z" title="Tue Nov 11 2025 09:12:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åŸæ–‡è®¿è°ˆï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.blog%2Fdeveloper-skills%2Fprogramming-languages-and-frameworks%2Ftypescripts-rise-in-the-ai-era-insights-from-lead-architect-anders-hejlsberg%2F" target="_blank" title="https://github.blog/developer-skills/programming-languages-and-frameworks/typescripts-rise-in-the-ai-era-insights-from-lead-architect-anders-hejlsberg/" ref="nofollow noopener noreferrer">github.blog/developer-sâ€¦</a></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db4a4d83875a462da6e652b941371838~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763457124&amp;x-signature=7Hx3ZWByJZnlcIPUITcV160phbc%3D" alt="" loading="lazy"/></p>
<p><strong>å½“ Anders Hejlsberg åœ¨ 2012 å¹´å¼€å§‹ç€æ‰‹ TypeScript æ—¶ï¼Œä»–å¹¶ä¸æ˜¯åœ¨æ„æƒ³ä¸€ä¸ªè¦ä¸ JavaScript ç«äº‰çš„æ–°è¯­è¨€ã€‚</strong> ä»–è¯•å›¾è§£å†³ä¸€ä¸ªéå¸¸ç°å®çš„é—®é¢˜ï¼šJavaScript å·²ç»æˆä¸ºæ•´ä¸ª Web çš„åŸºçŸ³ï¼Œä½†å®ƒå¹¶ä¸é€‚åˆå¤§å‹ã€å¤šå¼€å‘è€…åä½œçš„ä»£ç åº“ã€‚å›¢é˜Ÿä»¬æ­£åœ¨äº¤ä»˜æ•°ç™¾ä¸‡è¡Œå¼±ç±»å‹ä»£ç ï¼Œè€Œå½“ç³»ç»Ÿå¤æ‚åˆ°éš¾ä»¥æ¨ç†æ—¶ï¼Œè¿™é—¨è¯­è¨€å‡ ä¹æä¾›ä¸äº†ä»»ä½•å¸®åŠ©ã€‚</p>
<p><strong>è¿™é¡¹èµ·åˆçš„åŠ¡å®ä¿®è¡¥æœ€ç»ˆé‡å¡‘äº†ç°ä»£å¼€å‘ã€‚</strong> åœ¨ 2025 å¹´ï¼ŒTypeScript æˆä¸º GitHub ä¸Šä½¿ç”¨é‡æœ€é«˜çš„è¯­è¨€ï¼Œé¦–æ¬¡è¶…è¿‡äº† JavaScript ä¸ Pythonã€‚ä»…ä»Šå¹´ï¼Œå°±æœ‰è¶…è¿‡ä¸€ç™¾ä¸‡åå¼€å‘è€…ä»¥ TypeScript å‚ä¸è´¡çŒ®â€”â€”è¿™æ˜¯ Octoverse ç»Ÿè®¡çš„ 66% çš„å¢é•¿ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4ce0dd85ad8437d91cbdf63cc7caf69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763457124&amp;x-signature=0LSbTaWzOLR%2FRBYeOGecGOymyrw%3D" alt="" loading="lazy"/></p>
<p>ä»–è¯´ï¼šâ€œæˆ‘è®°å¾—å½“æ—¶å¿ƒé‡Œæƒ³ï¼Œä¹Ÿè®¸æˆ‘ä»¬èƒ½è®© 25% çš„ JavaScript ç¤¾åŒºäº§ç”Ÿå…´è¶£â€”â€”é‚£å°±ç®—æˆåŠŸäº†ã€‚ä½†çœ‹åˆ°ç°åœ¨çš„æƒ…å†µï¼Ÿæˆ‘å®Œå…¨æƒŠå‘†äº†ã€‚â€</p>
<p><strong>åœ¨ 2025 å¹´ï¼ŒTypeScript æˆä¸º GitHub ä¸Šä½¿ç”¨é‡æœ€å¤šçš„è¯­è¨€ï¼Œé¦–æ¬¡è¶…è¿‡ JavaScript å’Œ Pythonã€‚</strong> æ ¹æ®ä»Šå¹´çš„ Octoverse æŠ¥å‘Šï¼Œä»…ä»Šå¹´å°±æœ‰è¶…è¿‡ä¸€ç™¾ä¸‡åå¼€å‘è€…å¼€å§‹ç”¨ TypeScript è´¡çŒ®ä»£ç ï¼ˆåŒæ¯”å¢é•¿ 66%ï¼‰ã€‚</p>
<p>é‚£ä¹ˆï¼Œä¸€ä¸ª JavaScript çš„ç±»å‹åŒ–è¶…é›†æ˜¯å¦‚ä½•æˆä¸º AI æ—¶ä»£çš„ä¸»å¯¼è¯­è¨€çš„ï¼Ÿæˆ‘ä»¬ä¸ Anders åä¸‹æ¥ï¼ŒèŠäº†æ¼”åŒ–ã€æ€§èƒ½ï¼Œä»¥åŠä¸ºä»€ä¹ˆä¸€é—¨ä¸ºæ›´å¥½çš„äººç±»åä½œè€Œè®¾è®¡çš„è¯­è¨€ï¼Œå¦‚ä»Šæ­£åœ¨ä¸ºæœºå™¨è¾…åŠ©ç¼–ç æä¾›åŠ¨åŠ›ã€‚</p>
<hr/>
<h2 data-id="heading-0">â€œæˆ‘ä»¬åŸä»¥ä¸º 25% çš„é‡‡ç”¨ç‡å°±ç®—æˆåŠŸã€‚â€</h2>
<p>â€œé¡¹ç›®åˆšå¯åŠ¨æ—¶ï¼Œâ€Anders è¯´ï¼Œâ€œæˆ‘ä¼°è®¡å¦‚æœæˆ‘ä»¬èƒ½è®© 25% çš„ JavaScript ç¤¾åŒºè¡¨ç°å‡ºå…´è¶£ï¼Œé‚£å°±èµ¢äº†ã€‚ä½†ç°åœ¨ï¼Œçœ‹ç€æ¯å¤©æœ‰è¿™ä¹ˆå¤šäººä¾èµ–å®ƒâ€¦â€¦æˆ‘å’Œæ•´ä¸ªå›¢é˜Ÿéƒ½æƒŠå‘†äº†ã€‚â€</p>
<p>å›åˆ° 2012 å¹´ï¼ŒJavaScript å·²ç»æ ¹æ·±è’‚å›ºã€‚TypeScript çš„èµŒæ³¨ä¸æ˜¯å–ä»£å®ƒï¼Œè€Œæ˜¯é€šè¿‡æ·»åŠ ç±»å‹ã€å·¥å…·é“¾å’Œå¯é‡æ„æ€§ï¼Œè®©å¤§è§„æ¨¡ JavaScript å¼€å‘å˜å¾—â€œå¯ç†æ€§â€ã€‚</p>
<blockquote>
<p><strong>â€œåšä¸€ä»¶ä½ çŸ¥é“çœŸçš„èƒ½å¸¦æ¥æ”¹å˜çš„äº‹ï¼Œæ˜¯ä¸€ç§å–œæ‚¦ã€‚æˆ‘ä»¬æ²¡æ‰“ç®—æ— å¤„ä¸åœ¨ã€‚æˆ‘ä»¬åªæ˜¯æƒ³è®©å¼€å‘è€…èƒ½æ›´æœ‰ä¿¡å¿ƒåœ°æ„å»ºå¤§å‹ç³»ç»Ÿã€‚â€</strong> â€”â€”TypeScript åˆ›ä½œè€… Anders Hejlsberg</p>
</blockquote>
<p>åå¹´åï¼Œè¿™ä¸ªèµŒæ³¨æˆä¸ºé»˜è®¤ã€‚å‡ ä¹æ‰€æœ‰ç°ä»£å‰ç«¯æ¡†æ¶â€”â€”Reactã€Next.jsã€Angularã€SvelteKitâ€”â€”éƒ½é»˜è®¤æä¾› TypeScript è„šæ‰‹æ¶ã€‚ç»“æœæ˜¯ï¼šæ›´å®‰å…¨çš„ä»£ç åº“ã€æ›´å¥½çš„è‡ªåŠ¨è¡¥å…¨ã€æ›´å°‘å‡Œæ™¨ 3 ç‚¹å› ä¸ºä¸€ä¸ª undefined è€Œè°ƒè¯•å´©æºƒã€‚</p>
<p>â€œAnders è¯´ï¼šâ€œé­”åŠ›å°±åœ¨äºè®© TypeScript æ„Ÿè§‰åƒ JavaScriptï¼Œä½†æ‹¥æœ‰è¶…èƒ½åŠ›ã€‚â€</p>
<hr/>
<h2 data-id="heading-1">âš™ï¸ TypeScript åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>TypeScript æ˜¯ä¸€ä¸ªå¼€æºçš„ã€å¸¦ç±»å‹æ ‡æ³¨çš„ JavaScript è¶…é›†ï¼Œå®ƒä¼šç¼–è¯‘æˆæ™®é€š JavaScriptã€‚å®ƒæ·»åŠ é™æ€ç±»å‹æ£€æŸ¥ã€æ¥å£ã€æ³›å‹å’Œç°ä»£è¯­è¨€ç‰¹æ€§â€”â€”å¹¶åœ¨ç¼–è¯‘æ—¶æŠŠå®ƒä»¬æŠ¹å»ï¼Œä½¿è¾“å‡ºèƒ½åœ¨ä»»ä½• JavaScript èƒ½è¿è¡Œçš„åœ°æ–¹è¿è¡Œã€‚</p>
<p>å¼€å‘è€…ä½¿ç”¨å®ƒçš„ç†ç”±ï¼š</p>
<ul>
<li>åœ¨è¿è¡Œå‰æ•è·ç±»å‹é”™è¯¯</li>
<li>æå‡ IDE è‡ªåŠ¨è¡¥å…¨ä¸é‡æ„èƒ½åŠ›</li>
<li>è®©å¤§å‹ä»£ç åº“åœ¨å›¢é˜Ÿåä½œä¸‹ä»å¯ç»´æŠ¤</li>
<li>ä¸æ¡†æ¶å’Œ AI è¾…åŠ©å·¥å…·æ— ç¼é›†æˆ</li>
</ul>
<p>å®ƒç”¨äºï¼šå‰ç«¯æ¡†æ¶ï¼ˆReact, Angular, Vueï¼‰ã€åç«¯ç³»ç»Ÿï¼ˆNode.js, Denoï¼‰ã€SDKã€è®¾è®¡ç³»ç»Ÿï¼Œä»¥åŠè¶Šæ¥è¶Šå¤šéœ€è¦å¼ºç±»å‹æ¥ç¡®ä¿ç”Ÿæˆä»£ç å®‰å…¨çš„ AI ä»£ç†æ¡†æ¶ã€‚</p>
<hr/>
<h2 data-id="heading-2">ä¸ºæœªæ¥é‡å†™ç¼–è¯‘å™¨</h2>
<p>TypeScript å‘å¸ƒæ—¶è‘—åçš„â€œè‡ªæ‰˜ç®¡â€ç‰¹æ€§ï¼šç”¨ TypeScript è‡ªå·±ç¼–å†™ã€‚è¿™è®©ç¼–è¯‘å™¨ä¾¿æºã€å¯ä¿®æ”¹ã€‚ä½†æ€§èƒ½æœ€ç»ˆæˆä¸ºé—®é¢˜ã€‚</p>
<p>â€œAnders è¯´ï¼šâ€œæ”¾å¼ƒè‡ªæ‰˜ç®¡è®©æˆ‘ä»¬å¾ˆç—›è‹¦ï¼Œä½†æˆ‘ä»¬çŸ¥é“æ€§èƒ½å·²ç»æŒ¤ä¸å‡ºæ›´å¤šäº†ã€‚â€</p>
<p>æˆ‘ä»¬å°è¯•äº† C#ã€å…¶ä»–è¯­è¨€ï¼Œæœ€åé€‰æ‹© Goã€‚æ€§èƒ½æå‡è¾¾åˆ°äº† 10 å€ã€‚ä¸€åŠæ¥è‡ªåŸç”Ÿé€Ÿåº¦ï¼Œä¸€åŠæ¥è‡ªå…±äº«å†…å­˜å¹¶å‘ã€‚è¿™ç§ 10 å€æå‡æ˜¯ä¸èƒ½å¿½è§†çš„ã€‚</p>
<p>é‡å†™å¸¦æ¥äº†ä¸€ä¸ªæ›´å¿«ã€æ›´è½»ã€æ›´é€‚åˆä¼ä¸šè§„æ¨¡ä»£ç åº“çš„ç¼–è¯‘å™¨â€”â€”ä½†åŠŸèƒ½ä¸Šä¸æ—§ç‰ˆæœ¬å®Œå…¨ä¸€è‡´ã€‚</p>
<p>Anders è°ˆåˆ°ï¼šâ€œæˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªåŸç”Ÿç¼–è¯‘å™¨ï¼Œä»æ€ªç™–åˆ°è¡Œä¸ºéƒ½ä¸æ—§çš„å®Œå…¨ä¸€è‡´ã€‚ç¤¾åŒºä¸éœ€è¦ä¸¢æ‰ä»»ä½•ä¸œè¥¿ã€‚â€</p>
<p>è¿™ç§<strong>åœ¨æå‡æ€§èƒ½çš„åŒæ—¶ä¿ç•™è¡Œä¸ºä¸€è‡´æ€§</strong>çš„ç†å¿µï¼Œæ˜¯å¼€å‘è€…ä¿¡ä»» TypeScript çš„åŸå› ä¹‹ä¸€ã€‚å®ƒä¸æ˜¯æ¯éš”å‡ å¹´æ¥ä¸€æ¬¡â€œä»é›¶å¼€å§‹â€çš„é‡å†™ï¼Œè€Œæ˜¯ä¸€ä¸ªä¿æŒå…¼å®¹ã€ä¸æ–­æ¼”åŒ–çš„ç³»ç»Ÿã€‚</p>
<hr/>
<h2 data-id="heading-3">â€œå¼€æºæ˜¯è¢«æ•æ‰åœ¨ä»£ç é‡Œçš„æ¼”åŒ–ã€‚â€</h2>
<p>Anders æŠŠå¼€æºçœ‹ä½œä¸€ç§ç±»ä¼¼è‡ªç„¶é€‰æ‹©çš„ç”Ÿæ€ç³»ç»Ÿã€‚</p>
<p>â€œAnders è¯´ï¼šâ€œå¼€æºæœ¬æ¥æ˜¯ä¸ªå·¨å¤§çš„å®éªŒã€‚æ²¡äººçœŸæ­£ææ¸…æ¥šå¦‚ä½•ä¸ºå®ƒæä¾›èµ„é‡‘â€”â€”ä½†æˆ‘ä»¬ç°åœ¨çœ‹åˆ°ï¼Œå®ƒæ¯”ä»¥å¾€æ›´å¤§ï¼Œä¹Ÿä¸ä¼šæ¶ˆå¤±ã€‚é‚£å°±æ˜¯è¢«æ•æ‰åœ¨ä»£ç é‡Œçš„æ¼”åŒ–ã€‚â€</p>
<p>ä»Šå¹´çš„ Octoverse æ•°æ®éªŒè¯äº†è¿™ä¸€ç‚¹ï¼šå¼€å‘è€…åœ¨ 2025 å¹´æäº¤äº†è¿‘ 10 äº¿æ¬¡æäº¤ï¼ˆåŒæ¯” +25%ï¼‰ï¼Œå…¶ä¸­ 11.2 äº¿æ¬¡æäº¤åˆ°å…¬å…±å’Œå¼€æºä»“åº“ã€‚è¿™æ˜¯ç”¨ä¸€æ¬¡æ¬¡ PR å†™ä¸‹çš„â€œæ¼”åŒ–è®°å½•â€ã€‚</p>
<p>æ‹¥æœ‰ 12 å¹´ issuesã€PR ä¸è®¾è®¡æ–‡æ¡£çš„ TypeScript ä»“åº“ï¼Œæœ¬èº«å·²ç»æˆä¸ºè¯­è¨€æ¼”åŒ–çš„æ´»æ¡£æ¡ˆã€‚â€œæˆ‘ä»¬æœ‰ 12 å¹´çš„å†å²è¢«è®°å½•åœ¨ GitHub ä¸Šï¼Œâ€Anders è¯´ã€‚â€œæ‰€æœ‰å†…å®¹éƒ½å¯æœç´¢ã€‚é‚£å°±æ˜¯ä½ èƒ½ grep çš„æ¼”åŒ–ã€‚â€</p>
<hr/>
<h2 data-id="heading-4">AI æ•ˆåº”ï¼šä¸ºä»€ä¹ˆ TypeScript åœ¨ç°åœ¨çš„æ—¶ä»£æ›´å¼ºç››ï¼Ÿ</h2>
<p>Octoverse 2025 æœ€çªå‡ºçš„æ•°æ®ä¹‹ä¸€æ˜¾ç¤º AI æ­£åœ¨æ”¹å˜è¯­è¨€åå¥½ã€‚å¼€å‘è€…æ­£è½¬å‘èƒ½è®© AI è¾…åŠ©ç¼–ç æ›´å¯é ã€æ›´å¯ç»´æŠ¤çš„ç±»å‹è¯­è¨€ã€‚</p>
<p>Anders è§£é‡Šé“ï¼š</p>
<blockquote>
<p><strong>â€œAI åœ¨ä¸€é—¨è¯­è¨€ä¸Šå†™ä»£ç çš„èƒ½åŠ›ï¼Œä¸å®ƒè§è¿‡çš„è¯¥è¯­è¨€æ•°é‡æˆæ­£æ¯”ã€‚å®ƒæ˜¯ä¸€ä¸ªå·¨å¤§çš„å¤è¿°å™¨ï¼Œå¸¦äº›å¤–æ¨ã€‚AI çœ‹è¿‡å¤§é‡çš„ JavaScriptã€Python å’Œ TypeScriptï¼Œæ‰€ä»¥å®ƒåœ¨å†™è¿™äº›è¯­è¨€æ—¶ç‰¹åˆ«å¼ºã€‚æ–°è¯­è¨€åè€Œå¤„äºåŠ£åŠ¿ã€‚â€</strong></p>
</blockquote>
<p>è¿™ç§æ•°æ®ä¼˜åŠ¿ï¼ŒåŠ ä¸Š TypeScript çš„é™æ€ç±»å‹ç³»ç»Ÿï¼Œä½¿å…¶éå¸¸å¥‘åˆ AI ä¼˜å…ˆçš„å·¥ä½œæµã€‚</p>
<p>â€œAnders è¯´ï¼šâ€œå¦‚æœä½ è®© AI ç¿»è¯‘ 50 ä¸‡è¡Œä»£ç ï¼Œå®ƒå¯èƒ½ä¼šäº§ç”Ÿå¹»è§‰ã€‚ä½†å¦‚æœä½ è®©å®ƒç”Ÿæˆä¸€ä¸ªç¨‹åºï¼Œä»¥ç¡®å®šæ€§æ–¹å¼å®ŒæˆåŒæ ·çš„ç¿»è¯‘ï¼Œä½ å°±èƒ½å¾—åˆ°å¯é ç»“æœã€‚è¿™å°±æ˜¯ç±»å‹ç³»ç»Ÿè¢«è®¾è®¡å‡ºæ¥è¦è§£å†³çš„é—®é¢˜ã€‚â€</p>
<p>ç»“è®ºï¼šåœ¨ä¸€ä¸ªä»£ç ç”±äººç±»å’Œæœºå™¨å…±åŒç¼–å†™çš„ä¸–ç•Œé‡Œï¼Œç±»å‹ä¸æ˜¯å®˜åƒšä¸»ä¹‰ï¼Œè€Œæ˜¯çœŸç›¸æ ¡éªŒå™¨ã€‚</p>
<hr/>
<h2 data-id="heading-5">ä» IDE åˆ° Agent</h2>
<p>å¤§å‹è¯­è¨€æ¨¡å‹çš„å…´èµ·ä¹Ÿåœ¨æ”¹å˜â€œå¼€å‘å·¥å…·â€çš„å®šä¹‰ã€‚IDE æ­£åœ¨ä»ä¸ºäººç±»æœåŠ¡ï¼Œå˜æˆåŒæ—¶ä¸º agents æœåŠ¡çš„ç¯å¢ƒã€‚</p>
<blockquote>
<p>â€œAI ä¸€å¼€å§‹æ˜¯åŠ©æ‰‹ã€‚ç°åœ¨å®ƒåœ¨åšå·¥ä½œï¼Œè€Œä½ åœ¨ç›‘ç£ã€‚å®ƒä¸éœ€è¦æˆ‘ä»¬é‚£ç§ IDEã€‚å®ƒéœ€è¦çš„æ˜¯å„ç§æœåŠ¡ã€‚è¿™å°±æ˜¯ Model Context Protocol ä»¤äººå…´å¥‹çš„åœ°æ–¹ã€‚â€</p>
</blockquote>
<p>Octoverse æŠ¥å‘Šæè¿°è¿™ç§å˜åŒ–ï¼šâ€œAI ä¸åªæ˜¯é‡å¡‘ä»£ç ï¼Œè€Œæ˜¯åœ¨é‡å¡‘é€‰æ‹©ã€‚â€</p>
<p>åƒ TypeScript è¿™æ ·çš„ç±»å‹è¯­è¨€ï¼Œä¸º agents æä¾›äº†å®‰å…¨é‡æ„ã€è¯­ä¹‰æŸ¥è¯¢å’Œå¯¹ä»£ç åº“è¿›è¡Œç¡®å®šæ€§æ¨ç†çš„ç»“æ„åŒ–åŸºç¡€ã€‚</p>
<p>â€œAnders è¡¥å……è¯´ï¼šâ€œç›®æ ‡æ˜¯ä¸º AI å·¥ä½œæµè®¾å®šæ°åˆ°å¥½å¤„çš„ç¡®å®šæ€§ï¼Œè®©å®ƒä»¬ä¿æŒæœ‰ç”¨è€Œä¸è‡³äºè„±è½¨ã€‚â€</p>
<hr/>
<h2 data-id="heading-6">è¿™é—¨æŒç»­æ¼”åŒ–çš„è¯­è¨€</h2>
<p>ä» Turbo Pascal åˆ° C#ï¼Œå†åˆ° TypeScriptï¼ŒAnders çš„å·¥ä½œè·¨è¶Šæ•°åå¹´ã€‚ä½†ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œä»–å§‹ç»ˆä¿æŒä¸€è‡´ï¼šæ„å»ºèƒ½è®©å¤æ‚è½¯ä»¶æ›´æ˜“ç†è§£çš„è¯­è¨€ã€‚</p>
<blockquote>
<p>â€œæ²¡æœ‰ä»€ä¹ˆæ¯”åšä¸€ä»¶ç¡®å®èƒ½å¸¦æ¥æ”¹å˜çš„äº‹æƒ…æ›´ä»¤äººæ»¡è¶³çš„äº†ã€‚TypeScript ä¸æ–­å˜åŒ–ï¼Œä½†å§‹ç»ˆå›´ç»•åŒä¸€ä»¶äº‹ï¼šå¸®åŠ©å¼€å‘è€…æ¸…æ™°è¡¨è¾¾æ„å›¾ã€‚â€</p>
</blockquote>
<p>è¿™ç§æ¸…æ™°ï¼Œæˆ–è®¸æ­£æ˜¯ä¸ºä»€ä¹ˆ 2025 å¹´å¹³å‡æ¯ç§’å°±æœ‰è‡³å°‘ä¸€ä¸ªæ–°å¼€å‘è€…åŠ å…¥ GitHubï¼Œè€Œå…¶ä¸­è¶Šæ¥è¶Šå¤šäººé€‰æ‹©ä» TypeScript å¼€å§‹ã€‚</p>
<p>TypeScript çš„æ•…äº‹ä¸ä»…ä»…æ˜¯è¯­è¨€è®¾è®¡çš„æ•…äº‹ï¼›</p>
<p>å®ƒæ˜¯æ¼”åŒ–çš„æ•…äº‹â€”â€”ä¸€ä¸ªèµ·åˆä¸ºä¿®è¡¥ JavaScript æ‰©å±•æ€§è€Œç”Ÿçš„é¡¹ç›®ï¼Œå¦‚ä»Šæˆä¸ºå¼€å‘è€…ä¸ AI å…±åŒå†™ä»£ç çš„åŸºç¡€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯é«˜é¢‘é¢è¯•é¢˜ä¹‹Vueï¼ˆåˆã€ä¸­çº§ç¯‡ï¼‰]]></title>    <link>https://juejin.cn/post/7571303808115769396</link>    <guid>https://juejin.cn/post/7571303808115769396</guid>    <pubDate>2025-11-11T13:31:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571303808115769396" data-draft-id="7571278865517805618" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯é«˜é¢‘é¢è¯•é¢˜ä¹‹Vueï¼ˆåˆã€ä¸­çº§ç¯‡ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•,Vue.js"/> <meta itemprop="datePublished" content="2025-11-11T13:31:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜å°å¯’"/> <meta itemprop="url" content="https://juejin.cn/user/694547078987287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯é«˜é¢‘é¢è¯•é¢˜ä¹‹Vueï¼ˆåˆã€ä¸­çº§ç¯‡ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547078987287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜å°å¯’
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T13:31:42.000Z" title="Tue Nov 11 2025 13:31:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»14åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1ã€è¯´è¯´ä½ å¯¹ Vue.js çš„ç†è§£ï¼Ÿ</h2>
<p><code>Vue.js</code> æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºç”¨æˆ·ç•Œé¢çš„å¼€æº <code>JavaScript</code> æ¡†æ¶ï¼Œå®ƒçš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p>
<h3 data-id="heading-1">1.1 å£°æ˜å¼æ¡†æ¶</h3>
<ul>
<li>æ—©åœ¨JQçš„æ—¶ä»£ç¼–å†™çš„ä»£ç éƒ½æ˜¯å‘½ä»¤å¼çš„ï¼Œå‘½ä»¤å¼æ¡†æ¶é‡è¦ç‰¹ç‚¹å°±æ˜¯å…³æ³¨è¿‡ç¨‹ã€‚</li>
<li>å£°æ˜å¼æ¡†æ¶æ›´åŠ å…³æ³¨ç»“æœã€‚å‘½ä»¤å¼çš„ä»£ç å°è£…åˆ°äº†æ¡†æ¶å†…éƒ¨ï¼Œè¿‡ç¨‹é æ¡†æ¶æ¥å®ç°ã€‚</li>
</ul>
<h3 data-id="heading-2">1.2 æ•°æ®é©±åŠ¨/å“åº”å¼æ•°æ®</h3>
<p>é€šè¿‡ <code>Object.definePropertyï¼ˆVue 2ï¼‰</code> æˆ– <code>Proxyï¼ˆVue 3ï¼‰</code> å®ç°æ•°æ®åŠ«æŒï¼Œæ•°æ®å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°è§†å›¾ï¼Œå¼€å‘è€…æ— éœ€æ‰‹åŠ¨æ“ä½œ DOMã€‚</p>
<h3 data-id="heading-3">1.3 è™šæ‹ŸDOM</h3>
<p>é€šè¿‡é«˜æ•ˆçš„ <code>Diff</code> ç®—æ³•æ¯”å¯¹è™šæ‹Ÿ <code>DOM</code> çš„å˜åŒ–ï¼Œæœ€å°åŒ–çœŸå® <code>DOM</code> æ“ä½œï¼Œæå‡æ€§èƒ½ã€‚</p>
<h3 data-id="heading-4">1.4 ç»„ä»¶åŒ–</h3>
<p>å°† UI æ‹†åˆ†ä¸ºç‹¬ç«‹å¯å¤ç”¨çš„ç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶åŒ…å«è‡ªå·±çš„æ¨¡æ¿ã€é€»è¾‘å’Œæ ·å¼ï¼Œé€šè¿‡ç»„åˆç»„ä»¶æ„å»ºå¤æ‚åº”ç”¨ã€‚</p>
<h3 data-id="heading-5">1.5 æŒ‡ä»¤ç³»ç»Ÿ</h3>
<p>æä¾› <code>v-if</code>ã€<code>v-for</code>ã€<code>v-bind</code>ã€<code>v-on</code> ç­‰æŒ‡ä»¤ï¼Œä»¥å£°æ˜å¼æ–¹å¼å¢å¼º HTML çš„åŠŸèƒ½ã€‚</p>
<h3 data-id="heading-6">1.6 æ¸è¿›å¼æ¡†æ¶</h3>
<ul>
<li><strong>æ¸è¿›é›†æˆ</strong>ï¼šå¯ä»¥ä»å°è§„æ¨¡åŠŸèƒ½ï¼ˆå¦‚é™æ€é¡µé¢äº¤äº’ï¼‰é€æ­¥æ‰©å±•åˆ°å®Œæ•´çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰ã€‚</li>
<li><strong>çµæ´»ç”Ÿæ€</strong>ï¼šæ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä½†é…åˆå®˜æ–¹è·¯ç”±ï¼ˆVue Routerï¼‰ã€çŠ¶æ€ç®¡ç†ï¼ˆVuex/Piniaï¼‰ã€æ„å»ºå·¥å…·ï¼ˆViteï¼‰ç­‰ï¼Œèƒ½è½»æ¾æ‰©å±•ä¸ºå…¨åŠŸèƒ½æ¡†æ¶ã€‚</li>
</ul>
<p>å°±æ˜¯ä½ å¯ä»¥å•ç‹¬ç”¨ <code>vue</code> çš„å“åº”å¼æ„å»ºé™æ€é¡µé¢ï¼Œå¦‚æœä½ éœ€è¦çŠ¶æ€ç®¡ç†ï¼Œå°±ç”¨å®˜æ–¹çš„çŠ¶æ€ç®¡ç†å·¥å…· <code>Vuex/Pinia</code>ï¼Œå¦‚æœä½ éœ€è¦æ„å»ºä¸€ä¸ªåº”ç”¨ï¼Œæœ‰å¤šä¸ªé¡µé¢ï¼Œå¯ä»¥ç”¨å®˜æ–¹è·¯ç”± <code>Vue-router</code>ï¼Œå¦‚æœä½ éœ€è¦ä¸€é”®ç”Ÿæˆé¡¹ç›®ï¼Œå¯ä»¥ç”¨å®˜æ–¹çš„ <code>vue-cli</code> æˆ–è€…ä½¿ç”¨ <code>vite</code> çš„ <code>npm create vue@latest</code> å‘½ä»¤ä¸€é”®åˆ›å»ºé¡¹ç›®ã€‚</p>
<h2 data-id="heading-7">2ã€è¯·è¯´ä¸€ä¸‹å¯¹ Vue.js å“åº”å¼æ•°æ®çš„ç†è§£ï¼Ÿ</h2>
<p><code>vue</code> æ˜¯é€šè¿‡æ•°æ®é©±åŠ¨è§†å›¾çš„ï¼Œå“åº”å¼æŒ‡çš„æ˜¯å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä½¿ç”¨åˆ°è¯¥æ•°æ®çš„é¡µé¢ä¼šè‡ªåŠ¨æ›´æ–°ã€‚åœ¨è¡¨å•ä¸­ï¼Œå¯ä»¥é€šè¿‡å“åº”å¼å®ç°<strong>åŒå‘ç»‘å®š</strong>ï¼Œå®ç°è¡¨å•å€¼å’Œæ•°æ®çš„<strong>åŒå‘åŒæ­¥</strong>ã€‚</p>
<h3 data-id="heading-8">2.1 åŸºæœ¬åŸç†</h3>
<ol>
<li><strong>æ•°æ®åŠ«æŒ</strong>ï¼š<code>vue2</code> ä¸­ä½¿ç”¨ <code>Object.defineProperty</code> å¯¹å¯¹è±¡å±æ€§è¿›è¡ŒåŠ«æŒï¼Œå¯¹æ•°ç»„åˆ™é‡‡ç”¨é‡å†™æ•°ç»„çš„ä¸ƒä¸ªæ–¹æ³•<code>ï¼ˆpush,shift,pop,splice,unshift,sort,reverseï¼‰</code>æ¥å®ç°åŠ«æŒï¼Œè€Œ <code>vue3</code> åˆ™é€šè¿‡ <code>Proxy</code> API å¯ä»¥å¤©ç„¶å¯¹å¯¹è±¡å’Œæ•°ç»„å®ç°æ•°æ®åŠ«æŒã€‚</li>
<li><strong>ä¾èµ–æ”¶é›†</strong>ï¼šåœ¨ <code>getter</code> ä¸­æ”¶é›†ä¾èµ–(è°åœ¨ä½¿ç”¨è¿™ä¸ªæ•°æ®)ã€‚</li>
<li><strong>æ´¾å‘æ›´æ–°</strong>ï¼šåœ¨ <code>setter</code> ä¸­é€šçŸ¥æ‰€æœ‰ä¾èµ–è¿›è¡Œæ›´æ–°ï¼Œæ›´æ–°é¡µé¢ã€‚</li>
</ol>
<h3 data-id="heading-9">2.2 ç‰¹ç‚¹</h3>
<ol>
<li><strong>è‡ªåŠ¨æ›´æ–°</strong>ï¼šæ•°æ®å˜åŒ–æ—¶ï¼Œä¾èµ–è¯¥æ•°æ®çš„è§†å›¾ä¼šè‡ªåŠ¨æ›´æ–°ã€‚</li>
<li><strong>æ·±åº¦ç›‘å¬</strong>ï¼šåµŒå¥—å¯¹è±¡ä¹Ÿä¼šè¢«é€’å½’è½¬ä¸ºå“åº”å¼ã€‚</li>
<li><strong>å¼‚æ­¥æ›´æ–°</strong>ï¼šVue ä¼šå¼‚æ­¥æ‰§è¡Œ DOM æ›´æ–°ï¼Œæé«˜æ€§èƒ½ã€‚</li>
</ol>
<h3 data-id="heading-10">2.3 Vue3 å“åº”å¼æ”¹è¿›</h3>
<p>ä½¿ç”¨ <code>Proxy</code> ä»£æ›¿ <code>Object.defineProperty</code>ï¼š</p>
<ul>
<li>å¯ä»¥æ£€æµ‹åˆ°å¯¹è±¡å±æ€§çš„æ·»åŠ å’Œåˆ é™¤ã€‚</li>
<li>å¯¹æ•°ç»„çš„å˜åŒ–æ— éœ€ç‰¹æ®Šå¤„ç†ï¼Œå¤©ç„¶å¯ä»¥ç›‘å¬åˆ°é€šè¿‡æ•°ç»„ç´¢å¼•ä¿®æ”¹å…ƒç´ å’Œä¿®æ”¹ <code>length</code> å±æ€§çš„è¡Œä¸ºã€‚</li>
<li>æ€§èƒ½æ›´å¥½ã€‚</li>
</ul>
<h3 data-id="heading-11">2.4 æ‰©å±•ï¼šé’ˆå¯¹å“åº”å¼å¯ä»¥åšçš„æ€§èƒ½ä¼˜åŒ–ï¼ˆvue2ï¼‰ï¼š</h3>
<ul>
<li>å¯¹è±¡å±‚çº§è¿‡æ·±ï¼Œæ€§èƒ½å°±ä¼šå·®ï¼Œæ‰€ä»¥å“åº”å¼å°½é‡æ‰å¹³åŒ–ã€‚</li>
<li>ä¸éœ€è¦å“åº”æ•°æ®çš„å†…å®¹ä¸è¦æ”¾åˆ° data ä¸­ã€‚</li>
<li>ä¸éœ€è¦æ›´æ–°çš„é™æ€æ•°æ®å¯ä»¥ç”¨ <code>Object.freeze()</code> å†»ç»“æ•°æ®ã€‚</li>
</ul>
<h3 data-id="heading-12">2.5 æ³¨æ„äº‹é¡¹</h3>
<ol>
<li>å¯¹è±¡æ–°å¢å±æ€§ï¼š<code>vue 2</code> ä¸­éœ€è¦ä½¿ç”¨ <code>Vue.set</code> æˆ– <code>this.$set</code> æ–¹æ³•ã€‚</li>
<li>æ•°ç»„å˜åŒ–ï¼š<code>vue 2</code> ä¸­ç›´æ¥é€šè¿‡ç´¢å¼•ä¿®æ”¹æˆ–ä¿®æ”¹ <code>length</code> å±æ€§ä¸ä¼šè§¦å‘å“åº”ï¼Œåº”ä½¿ç”¨å˜å¼‚æ–¹æ³•(<code>push/pop/shift</code>ç­‰)æˆ– <code>Vue.setã€this.$set</code>ã€‚</li>
<li>æ€§èƒ½è€ƒé‡ï¼šå“åº”å¼ç³»ç»Ÿéœ€è¦è¿½è¸ªä¾èµ–ï¼Œå¤§å‹å¯¹è±¡å¯èƒ½ä¼šæœ‰æ€§èƒ½å¼€é”€ã€‚</li>
</ol>
<p>å“åº”å¼ç³»ç»Ÿè®©å¼€å‘è€…å¯ä»¥ä¸“æ³¨äºæ•°æ®é€»è¾‘ï¼Œè€Œæ— éœ€æ‰‹åŠ¨å¤„ç† DOM æ›´æ–°ï¼Œå¤§å¤§æé«˜äº†å¼€å‘æ•ˆç‡ã€‚</p>
<h2 data-id="heading-13">3ã€Vue3 çš„å‡çº§ç‚¹ï¼Ÿ</h2>
<h3 data-id="heading-14">3.1 æ¶æ„å‡çº§</h3>
<p>Vue3 æºç é‡‡ç”¨ <strong>monorepo</strong> æ–¹å¼è¿›è¡Œç®¡ç†ï¼Œå°†æ¨¡å—æ‹†åˆ†åˆ°packagesä¸­ï¼Œè¿™æ ·åšçš„å¥½å¤„å¦‚ä¸‹ï¼š</p>
<ol>
<li>å°†å¤šä¸ªæ¨¡å—é›†åˆåˆ°ä¸€ä¸ªä»“åº“ï¼Œæ–¹ä¾¿ç»´æŠ¤ã€‚</li>
<li>æ–¹ä¾¿ç‰ˆæœ¬ç®¡ç†å’Œä¾èµ–ç®¡ç†ï¼Œå„æ¨¡å—é—´ç›¸äº’å¼•ç”¨ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ã€‚</li>
<li>å„ä¸ªåŒ…å¯ä»¥å•ç‹¬å®‰è£…ä½¿ç”¨ï¼Œä¸éœ€è¦å¯¼å…¥æ•´ä¸ª vueã€‚</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e31a6b97686e45ed9d72c15d8ccb71d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-S:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763472701&amp;x-signature=0AclC2F9tzfQzEnHYn14jB7MBnY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-15">3.2 ç»„åˆå¼API -&gt; Composition API</h3>
<p>vue2 ä¸­ <code>Options API</code>ï¼ˆå³æä¾›propsã€methodsã€dataã€computedã€watchç­‰å±æ€§ä¾›ç”¨æˆ·ä½¿ç”¨ï¼‰çš„é—®é¢˜ï¼š</p>
<ol>
<li>å¤ç”¨æ€§æ¯”è¾ƒå·®ï¼Œè™½ç„¶æä¾› mixins å’Œ extendsï¼Œä½†ä¼šå‡ºç°æ•°æ®æ¥æºä¸æ˜ç¡®å’Œé‡åé—®é¢˜ã€‚</li>
<li>éœ€è¦ä½¿ç”¨å¸¦æœ‰å‰¯ä½œç”¨<code>this</code>ï¼Œå­˜åœ¨thisæŒ‡å‘é—®é¢˜ï¼ŒåŒæ—¶å¯¹ <code>tree-shaking</code> ä¹Ÿä¸å‹å¥½ã€‚</li>
<li>å¯¹äºä¸Šç™¾è¡Œçš„å¤§å‹ç»„ä»¶æ¥è¯´ï¼Œå½“ä½ äº†è§£æŸæ®µé€»è¾‘æ—¶ï¼Œä½ éœ€è¦ä¸æ–­ä¸Šä¸‹ç§»åŠ¨é˜…è¯»ï¼Œä½“éªŒå¾ˆå·®ã€‚</li>
</ol>
<p>vue3<code>Composition API</code>ç‰¹ç‚¹ï¼š</p>
<ol>
<li>æ–¹ä¾¿æŠ½ç¦»ï¼Œå¤ç”¨æ€§å¼ºï¼Œå¯ä»¥æŠŠå¹²å‡€çš„é€»è¾‘æå–åˆ°ä¸€ä¸ªå•ç‹¬å‡½æ•°æˆ–è€…æ–‡ä»¶ä¸­ï¼Œè®©å¼€å‘è€…ä¸“æ³¨äºé€»è¾‘å†…èšé—®é¢˜ã€‚</li>
<li>æŠ›å¼ƒthisï¼Œtree-shaking å‹å¥½ï¼Œæ‰“åŒ…å‡ºæ¥ä½“ç§¯æ›´å°ã€‚</li>
</ol>
<h3 data-id="heading-16">3.3 å“åº”å¼ç³»ç»Ÿ</h3>
<p>vue3é‡‡ç”¨<code>proxy</code>æ›¿ä»£äº†<code>Object.defineProperty</code>:</p>
<ol>
<li>æå‡äº†æ€§èƒ½ï¼Œä¸å†éœ€è¦ä¸€æ¬¡æ€§å…¨éƒ¨é€’å½’æ‹¦æˆªã€‚</li>
<li>èƒ½æ‹¦æˆªåˆ°å¯¹è±¡å±æ€§çš„æ–°å¢å’Œåˆ é™¤ã€‚</li>
<li>èƒ½æ‹¦æˆªåŸç”Ÿæ•°ç»„çš„ç´¢å¼•ã€lengthæ“ä½œã€‚</li>
</ol>
<h3 data-id="heading-17">3.4 diffç®—æ³•</h3>
<p>å…¨é‡ <code>diff</code> ç®—æ³•ä¸­é‡‡ç”¨<strong>æœ€é•¿é€’å¢å­åºåˆ—</strong>å‡å°‘èŠ‚ç‚¹çš„ç§»åŠ¨ã€‚åœ¨éå…¨é‡ <code>diff</code> ç®—æ³•ä¸­åªæ¯”è¾ƒåŠ¨æ€èŠ‚ç‚¹ï¼Œé€šè¿‡ <code>PatchFlag</code> æ ‡è®°æ›´æ–°åŠ¨æ€çš„éƒ¨åˆ†ã€‚</p>
<h3 data-id="heading-18">3.5 æ¸²æŸ“ä¼˜åŒ–</h3>
<p>åœ¨æ¸²æŸ“æ–¹é¢ï¼Œvue3æä¾›äº†<strong>è‡ªå®šä¹‰æ¸²æŸ“å™¨</strong>ï¼Œå¤§å¤§æå‡äº†æ‰©å±•èƒ½åŠ›ã€‚</p>
<h3 data-id="heading-19">3.6 ç¼–è¯‘ä¼˜åŒ–</h3>
<ul>
<li><strong><code>Block</code>å’Œ <code>patchFlag</code></strong>ï¼šä¸ºåŠ¨æ€èŠ‚ç‚¹æ‰“ä¸Šè¡¥ä¸æ ‡å¿—ï¼Œå³ <code>patchFlag</code>ï¼ŒåŒæ—¶è¿˜æå‡ºäº† <code>block</code> çš„æ¦‚å¿µï¼Œ<code>block</code> æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œä½†å®ƒä¼šå¤šå‡ºä¸€ä¸ª <code>dynamicChildren</code> æ•°ç»„ï¼Œä¼šæ”¶é›†å®ƒæ‰€æœ‰çš„åŠ¨æ€å­ä»£èŠ‚ç‚¹ï¼Œæ¯”å¯¹çš„æ—¶å€™ä¼šå¿½ç•¥DOMå±‚çº§ç»“æ„çš„ï¼Œæ‰€ä»¥å¯¹äºå¸¦æœ‰ <code>v-if</code>ã€<code>v-for</code> ç­‰ç»“æ„åŒ–æŒ‡ä»¤çš„èŠ‚ç‚¹ä¹Ÿä½œä¸º <code>block</code> çš„è§’è‰²ã€‚</li>
<li><strong>é™æ€æå‡</strong>ï¼šå°†é™æ€è™šæ‹Ÿçš„èŠ‚ç‚¹æå‡åˆ°renderå‡½æ•°ä¹‹å¤–ï¼Œè¿™æ ·èƒ½å¤Ÿå‡å°‘æ›´æ–°æ—¶åˆ›å»ºè™šæ‹ŸDOMå¸¦æ¥çš„æ€§èƒ½å¼€é”€å’Œå†…å­˜å ç”¨ã€‚</li>
<li><strong>é¢„å­—ç¬¦ä¸²åŒ–</strong>ï¼šåœ¨é™æ€æå‡çš„åŸºç¡€ä¸Šï¼Œå½“æ¨¡æ¿ä¸­åŒ…å«å¤§é‡è¿ç»­çº¯é™æ€çš„æ ‡ç­¾èŠ‚ç‚¹æ—¶ï¼Œå°†è¿™æ ·é™æ€èŠ‚ç‚¹åºåˆ—åŒ–æˆå­—ç¬¦ä¸²ï¼Œç„¶åé€šè¿‡innerHTMLè¿›è¡Œè®¾ç½®ï¼Œè¿™æ ·åšèƒ½å¤Ÿå‡å°‘åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹äº§ç”Ÿçš„æ€§èƒ½å¼€é”€å’Œå†…å­˜å ç”¨ã€‚</li>
<li><strong>ç¼“å­˜å†…è”äº‹ä»¶å¤„ç†å‡½æ•°</strong>ï¼šå¯ä»¥é¿å…ä¸å¿…è¦çš„æ›´æ–°ã€‚</li>
<li><strong>v-onceæŒ‡ä»¤</strong>ï¼šç¼“å­˜è™šæ‹ŸèŠ‚ç‚¹ï¼Œé¿å…ç»„ä»¶æ›´æ–°æ—¶é‡æ–°åˆ›å»ºè™šæ‹ŸDOMçš„æ€§èƒ½å¼€é”€ï¼ŒåŒæ—¶å¸¦æœ‰v-onceæŒ‡ä»¤çš„èŠ‚ç‚¹ä¸ä¼šè¢«çˆ¶çº§blockæ”¶é›†ï¼Œæ‰€ä»¥ä¸ä¼šå‚ä¸diffæ“ä½œï¼Œé¿å…æ— ç”¨çš„diffå¼€é”€ã€‚</li>
</ul>
<h3 data-id="heading-20">3.7 æ–°å¢ç»„ä»¶</h3>
<ul>
<li>Teleportï¼šå¯ä»¥å°†æŒ‡å®šå†…å®¹æ¸²æŸ“åˆ°ç‰¹å®šå®¹å™¨ä¸­ï¼Œè€Œä¸å—DOMå±‚çº§çš„é™åˆ¶ã€‚</li>
</ul>
<h3 data-id="heading-21">3.8 å¯¹TypeScriptæ”¯æŒæ›´åŠ å‹å¥½</h3>
<p>vue2æºç é‡‡ç”¨Flowåšç±»å‹æ£€æµ‹ï¼Œå¯¹TypeScriptæ”¯æŒå¹¶ä¸å‹å¥½ï¼Œè€ŒVue3é‡‡ç”¨TypeScriptè¿›è¡Œé‡å†™ï¼Œå¯¹TSçš„æ”¯æŒæ›´åŠ å‹å¥½ã€‚</p>
<h3 data-id="heading-22">3.9 ä½“ç§¯æ›´å°ï¼ˆç§»é™¤äº†ä¸å¸¸ç”¨çš„ APIï¼‰</h3>
<ul>
<li>ç§»é™¤ inline-template (Vue2 ä¸­å°±ä¸æ¨èä½¿ç”¨)ã€‚</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>n</mi><mtext>ã€</mtext></mrow><annotation encoding="application/x-tex">onã€</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord cjk_fallback">ã€</span></span></span></span></span>offã€$once ï¼ˆå¦‚æœæœ‰éœ€è¦å¯ä»¥é‡‡ç”¨ mitt åº“æ¥å®ç°ï¼‰ã€‚</li>
<li>åˆ é™¤è¿‡æ»¤å™¨ filter ï¼ˆå¯ä»¥é€šè¿‡è®¡ç®—å±æ€§æˆ–è€…æ–¹æ³•æ¥å®ç°ï¼‰ã€‚</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>i</mi><mi>l</mi><mi>d</mi><mi>r</mi><mi>e</mi><mi>n</mi><mtext>ç§»é™¤ï¼ˆå¯ä»¥é€šè¿‡</mtext><mi>p</mi><mi>r</mi><mi>o</mi><mi>v</mi><mi>i</mi><mi>d</mi><mi>e</mi><mtext>ï¼Œ</mtext><mi>i</mi><mi>n</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mtext>æ–¹æ³•æ„å»º</mtext></mrow><annotation encoding="application/x-tex">childrenç§»é™¤ ï¼ˆå¯ä»¥é€šè¿‡provideï¼Œinjectæ–¹æ³•æ„å»º</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">hi</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">d</span><span class="mord mathnormal">re</span><span class="mord mathnormal">n</span><span class="mord cjk_fallback">ç§»é™¤ï¼ˆå¯ä»¥é€šè¿‡</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord mathnormal" style="margin-right:0.05724em;">inj</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord cjk_fallback">æ–¹æ³•æ„å»º</span></span></span></span></span>childrenï¼‰ã€‚</li>
<li>ç§»é™¤.sync .native ä¿®é¥°ç¬¦ (.syncé€šè¿‡ v-model:xxxå®ç°ï¼Œ.nativeä¸º Vue3 ä¸­çš„é»˜è®¤è¡Œä¸º) ä»¥åŠä¸åœ¨æ”¯æŒ keycode ä½œä¸ºv-onä¿®é¥°ç¬¦ï¼ˆ@keyup.13 ä¸å†æ”¯æŒï¼‰ã€‚</li>
<li>ç§»é™¤å…¨å±€ APIã€‚Vue.componentã€Vue.useã€Vue.directive (å°†è¿™äº› api æŒ‚è½½åˆ°å®ä¾‹ä¸Š)ã€‚</li>
<li>é€šè¿‡æ„å»ºå·¥å…· Tree-shaking æœºåˆ¶å®ç°æŒ‰éœ€å¼•å…¥ï¼Œå‡å°‘ç”¨æˆ·æ‰“åŒ…åä½“ç§¯ã€‚</li>
</ul>
<h2 data-id="heading-23">4ã€Vue.js ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹ŸDOMï¼Ÿ</h2>
<p>è™šæ‹ŸDOMï¼ˆVirtual DOMï¼‰å°±æ˜¯ç”¨ js å¯¹è±¡æ¥æè¿°çœŸå® DOMï¼Œæ˜¯å¯¹çœŸå® DOM çš„æŠ½è±¡ã€‚</p>
<h3 data-id="heading-24">4.1 æ€§èƒ½ä¼˜åŒ–</h3>
<ul>
<li><strong>ç›´æ¥æ“ä½œ DOM ä»£ä»·é«˜æ˜‚</strong>ï¼šæµè§ˆå™¨ DOM æ“ä½œæ˜¯éå¸¸æ¶ˆè€—æ€§èƒ½çš„ã€‚</li>
<li><strong>æœ€å°å·®å¼‚æ›´æ–°</strong>ï¼šé€šè¿‡æ¯”å¯¹æ–°æ—§è™šæ‹Ÿ DOM èŠ‚ç‚¹ï¼Œæ‰¾å‡ºæœ€å°å·®å¼‚è¿›è¡Œæ›´æ–°ã€‚</li>
<li><strong>æ‰¹é‡æ›´æ–°</strong>ï¼šåœ¨æ•°æ®ä¿®æ”¹åï¼Œå¼‚æ­¥æ‰¹é‡æ›´æ–°ã€‚</li>
</ul>
<blockquote>
<p>è™šæ‹ŸDOMå¹¶ä¸ä¸€å®šèƒ½æå‡æ€§èƒ½ï¼Œæ¯”å¦‚ä½ å°±æ”¹äº†ä¸€ä¸ªæ•°æ®ï¼Œvueè¿˜è¦èµ°ä¸€é DOM diff æ¯”å¯¹å®Œåå†å»è°ƒç”¨åŸç”Ÿ DOM APIå»æ›´æ–°ï¼Œè¿™æ—¶å€™å…¶å®ä½ ç›´æ¥é€šè¿‡åŸç”ŸDOM API å»æ›´æ–°è‚¯å®šæ€§èƒ½æ›´é«˜ï¼Œä½†æ˜¯è™šæ‹Ÿ DOM èƒ½ä¿è¯æ€§èƒ½çš„ä¸‹é™ï¼Œåœ¨ä½ çš„åº”ç”¨å¤æ‚ä¸”åºå¤§çš„æ—¶å€™ï¼Œä¸è‡³äºæ€§èƒ½å¤ªå·®ã€‚</p>
</blockquote>
<h3 data-id="heading-25">4.2 è·¨å¹³å°</h3>
<ul>
<li><strong>æŠ½è±¡å±‚ä½œç”¨</strong>ï¼šè™šæ‹Ÿ DOM æ˜¯å¯¹çœŸå® DOM çš„æŠ½è±¡è¡¨ç¤ºã€‚</li>
<li><strong>å¤šç«¯æ¸²æŸ“</strong>ï¼šåŒä¸€å¥—è™šæ‹Ÿ DOM å¯ä»¥æ¸²æŸ“åˆ°ä¸åŒå¹³å°ï¼ˆWebã€Nativeã€Canvasç­‰ï¼‰ã€‚</li>
<li><strong>æœåŠ¡ç«¯æ¸²æŸ“(SSR)</strong>ï¼šåœ¨æ²¡æœ‰çœŸå® DOM çš„ç¯å¢ƒä¸‹ä¹Ÿèƒ½ç”Ÿæˆé¡µé¢ç»“æ„ã€‚</li>
</ul>
<h3 data-id="heading-26">4.3 å£°æ˜å¼ç¼–ç¨‹çš„ä¼˜åŠ¿</h3>
<ul>
<li><strong>å¼€å‘è€…å‹å¥½</strong>ï¼šå¼€å‘è€…åªéœ€å…³å¿ƒæ•°æ®çŠ¶æ€ï¼Œä¸å¿…æ‰‹åŠ¨æ“ä½œ DOMã€‚</li>
<li><strong>è‡ªåŠ¨ä¼˜åŒ–</strong>ï¼šæ¡†æ¶å±‚é¢è´Ÿè´£æœ€é«˜æ•ˆçš„æ›´æ–°ç­–ç•¥ï¼Œå¼€å‘è€…æ— éœ€å¾®è§‚ç®¡ç†ã€‚</li>
</ul>
<h3 data-id="heading-27">4.4 ä¸å“åº”å¼ç³»ç»Ÿçš„ååŒ</h3>
<ul>
<li><strong>ä¾èµ–è¿½è¸ª</strong>ï¼šè™šæ‹Ÿ DOM ä¸ Vue çš„å“åº”å¼ç³»ç»Ÿç´§å¯†ç»“åˆã€‚</li>
<li><strong>ç»„ä»¶çº§æ›´æ–°</strong>ï¼šæ•°æ®æ›´æ”¹åï¼Œåœ¨ç»„ä»¶çº§åˆ«è¿›è¡Œé¡µé¢æ›´æ–°ã€‚</li>
</ul>
<h2 data-id="heading-28">5ã€Vue.js ç»„ä»¶é—´ä¼ å€¼çš„æ–¹å¼</h2>
<p><strong>vue2</strong>ï¼š</p>
<ul>
<li>ä¸€ã€çˆ¶å­é€šä¿¡
<ol>
<li><code>props</code></li>
<li><code>$emit</code></li>
<li><code>$attrsã€$listeners</code></li>
<li><code>$parentã€$children</code></li>
<li><code>$ref</code></li>
<li><code>ä½œç”¨åŸŸæ’æ§½</code></li>
<li><code>v-model</code></li>
</ol>
</li>
<li>äºŒã€å…„å¼Ÿç»„ä»¶é€šä¿¡
<ol>
<li><code>mitt</code></li>
<li><code>$parent</code></li>
<li><code>vuex/pinia</code></li>
<li><code>app.config.globalProperties</code></li>
</ol>
</li>
<li>ä¸‰ã€è·¨å±‚çº§é€šä¿¡
<ol>
<li><code>vuex</code></li>
<li><code>provide/inject</code></li>
<li><code>event bus</code></li>
</ol>
</li>
</ul>
<p><strong>vue3</strong>ï¼š</p>
<ul>
<li>ä¸€ã€çˆ¶å­é€šä¿¡
<ol>
<li><code>props</code></li>
<li><code>defineEmits</code></li>
<li><code>$attrs</code></li>
<li><code>$ref + defineExpose</code></li>
<li><code>$parent</code></li>
<li><code>ä½œç”¨åŸŸæ’æ§½</code></li>
<li><code>v-model</code></li>
</ol>
</li>
<li>äºŒã€å…„å¼Ÿç»„ä»¶é€šä¿¡
<ol>
<li><code>mitt</code></li>
<li><code>$parent</code></li>
<li><code>vuex/pinia</code></li>
<li><code>app.config.globalProperties</code></li>
</ol>
</li>
<li>ä¸‰ã€è·¨å±‚çº§é€šä¿¡
<ol>
<li><code>mitt</code></li>
<li><code>vuex/pinia</code></li>
<li><code>provide/inject</code></li>
</ol>
</li>
</ul>
<p><strong>æ‰©å±•ï¼šå…¶å®ƒé€šä¿¡æ–¹å¼</strong>ï¼š</p>
<ul>
<li>æµè§ˆå™¨æœ¬åœ°å­˜å‚¨<code>storage</code>ã€‚</li>
<li>å…¨å±€<code>window</code>å¯¹è±¡ã€‚</li>
<li>ES6æ¨¡å—åŒ– import/exportã€‚</li>
</ul>
<h2 data-id="heading-29">6ã€v-show å’Œ v-if æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä½¿ç”¨åœºæ™¯åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p><strong>ç›¸åŒç‚¹</strong>ï¼šæ§åˆ¶å…ƒç´ åœ¨é¡µé¢æ˜¯å¦æ˜¾ç¤ºã€‚</p>
<p><strong>ä¸åŒç‚¹</strong>ï¼š</p>
<ul>
<li><strong>æ§åˆ¶æ‰‹æ®µä¸åŒ</strong>ï¼š<code>v-show</code> æ§åˆ¶çš„æ˜¯ <code>css</code> çš„ <code>display</code> å±æ€§æ˜¯å¦ä¸º <code>none</code> æ¥æ§åˆ¶å…ƒç´ çš„æ˜¯å¦éšè—ï¼Œè€Œ <code>v-if</code> æ˜¯ç›´æ¥ä¸æ¸²æŸ“ DOM å…ƒç´ æˆ–è€…ç›´æ¥åˆ é™¤ DOM å…ƒç´ ã€‚</li>
<li><strong>æ§åˆ¶è¿‡ç¨‹åŒºåˆ«</strong>ï¼š<code>v-if</code> åˆ‡æ¢æœ‰ä¸€ä¸ªå±€éƒ¨ç¼–è¯‘/å¸è½½çš„è¿‡ç¨‹ï¼Œåˆ‡æ¢è¿‡ç¨‹ä¸­åˆé€‚åœ°é”€æ¯å’Œé‡å»ºå†…éƒ¨çš„äº‹ä»¶ç›‘å¬å’Œå­ç»„ä»¶ï¼Œå¦‚æœæ§åˆ¶çš„æ˜¯ç»„ä»¶ï¼Œä¹Ÿä¼šæ‰§è¡Œç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼›è€Œ<code>v-show</code> åªæ˜¯ç®€å•çš„åŸºäºcssåˆ‡æ¢ã€‚</li>
<li><strong>ç¼–è¯‘åŒºåˆ«</strong>ï¼š<code>v-if</code> åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ä¼šè¢«è½¬åŒ–æˆ<strong>ä¸‰å…ƒè¡¨è¾¾å¼</strong>,æ¡ä»¶ä¸æ»¡è¶³æ—¶ä¸æ¸²æŸ“æ­¤èŠ‚ç‚¹ã€‚<code>v-show</code> ä¼šè¢«ç¼–è¯‘æˆæŒ‡ä»¤ï¼Œæ¡ä»¶ä¸æ»¡è¶³æ—¶æ§åˆ¶æ ·å¼å°†å¯¹åº”èŠ‚ç‚¹éšè— ï¼ˆå†…éƒ¨å…¶ä»–æŒ‡ä»¤ä¾æ—§ä¼šç»§ç»­æ‰§è¡Œï¼‰ã€‚</li>
<li><strong>æ€§èƒ½æ¶ˆè€—</strong>ï¼š<code>v-if</code> æ¯” <code>v-show</code> æœ‰æ›´é«˜çš„æ€§èƒ½æ¶ˆè€—ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šé¢‘ç¹åˆ‡æ¢ + ä¸éœ€è¦é”€æ¯çŠ¶æ€ç”¨ <code>v-show</code>ï¼Œåä¹‹ç”¨ <code>v-if</code>ã€‚</p>
<h2 data-id="heading-30">7ã€v-if å’Œ v-for  å“ªä¸ªä¼˜å…ˆçº§æ›´é«˜ï¼Ÿ</h2>
<ul>
<li>vue2 ä¸­ <code>v-for</code> çš„ä¼˜å…ˆçº§æ¯” <code>v-if</code> é«˜ï¼Œå®ƒä»¬ä½œç”¨äºä¸€ä¸ªèŠ‚ç‚¹ä¸Šä¼šå¯¼è‡´å…ˆå¾ªç¯åå¯¹æ¯ä¸€é¡¹è¿›è¡Œåˆ¤æ–­ï¼Œæµªè´¹æ€§èƒ½ã€‚</li>
<li>vue3 ä¸­ <code>v-if</code> çš„ä¼˜å…ˆçº§æ¯” <code>v-for</code> é«˜ï¼Œè¿™å°±ä¼šå¯¼è‡´ <code>v-if</code> ä¸­çš„æ¡ä»¶æ— æ³•è®¿é—® <code>v-for</code> ä½œç”¨åŸŸåä¸­å®šä¹‰çš„å˜é‡åˆ«åã€‚</li>
</ul>
<p>æ‰€ä»¥ä¸ç®¡æ˜¯ <code>vue2</code> è¿˜æ˜¯ <code>vue3</code>ï¼Œéƒ½ä¸æ¨èåŒæ—¶ä½¿ç”¨ <code>v-if</code> å’Œ <code>v-for</code>ï¼Œæ›´å¥½çš„æ–¹æ¡ˆæ˜¯é‡‡ç”¨è®¡ç®—å±æ€§ï¼Œæˆ–è€…åœ¨å¤–å±‚å†åŒ…è£¹ä¸€ä¸ªå®¹å™¨å…ƒç´ ï¼Œå°† <code>v-if</code> ä½œç”¨åœ¨å®¹å™¨å…ƒç´ ä¸Šã€‚</p>
<p>ä¸æ¨èç”¨ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;li v-for="item in arr" v-if="item.visible"&gt;
  {{ item}}
&lt;/li&gt;
</code></pre>
<p>æ¨èç”¨ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- visibleArrä¸ºè®¡ç®—å±æ€§ --&gt;
&lt;li v-for="item in visibleArr"&gt;
    {{ item}}
  &lt;/li&gt;
</code></pre>
<h2 data-id="heading-31">8ã€Vue.js çš„ nextTick æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆä½¿ç”¨åœºæ™¯ï¼Ÿ</h2>
<p>Vue.js ä¸­çš„ nextTickï¼ˆæˆ–å®ä¾‹æ–¹æ³• this.$nextTickï¼‰æ˜¯ä¸€ä¸ª Vue æä¾›çš„ä¸€ä¸ª APIï¼Œç”¨äºåœ¨å“åº”å¼çŠ¶æ€å˜æ›´åç­‰å¾…ä¸‹ä¸€ä¸ª DOM æ›´æ–°å‘¨æœŸå®Œæˆåå†æ‰§è¡Œä»£ç ã€‚ç”±äº Vue çš„ DOM æ›´æ–°æ˜¯å¼‚æ­¥çš„ï¼šå½“ä½ ä¿®æ”¹å“åº”å¼æ•°æ®æ—¶ï¼ŒVue å†…éƒ¨ä¼šç¼“å†²è¿™äº›å˜æ›´ï¼Œå¹¶åœ¨<code>â€œä¸‹ä¸€ä¸ª tickâ€</code>ä¸­ä¸€æ¬¡æ€§åº”ç”¨åˆ° DOMï¼Œç”¨è¿™ç§æ‰¹é‡æ›´æ–°çš„æ–¹å¼æé«˜æ€§èƒ½ã€‚æ‰€ä»¥è¿™æ„å‘³ç€æ•°æ®å˜æ›´åç«‹å³è®¿é—® DOM å¯èƒ½è·å–åˆ°æ—§å€¼ï¼Œè€Œ nextTick ç¡®ä¿å›è°ƒåœ¨ DOM å®é™…æ›´æ–°åè¿è¡Œã€‚</p>
<p>å…¶ä½¿ç”¨åœºæ™¯å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>æ•°æ®æ›´æ–°åç«‹å³æ“ä½œ DOM</strong>ï¼šå¦‚è·å–å…ƒç´ å°ºå¯¸ã€ç„¦ç‚¹è®¾ç½®æˆ–ç¬¬ä¸‰æ–¹åº“åˆå§‹åŒ–ã€‚å¦‚æœä¸ä½¿ç”¨ nextTickï¼Œä½ å¯èƒ½æ‹¿åˆ°çš„æ˜¯æœªæ›´æ–°çš„ DOMï¼Œå¯¼è‡´é”™è¯¯ã€‚</li>
<li><strong>é¿å…å¤šæ¬¡æ¸²æŸ“</strong>ï¼šVue.js å†…éƒ¨ç”¨å®ƒæ‰¹é‡æ›´æ–° DOMï¼Œæé«˜æ€§èƒ½ã€‚</li>
<li><strong>ä¸å¼‚æ­¥æ“ä½œç»“åˆ</strong>ï¼šå¦‚åœ¨ Promise æˆ– setTimeout åæ›´æ–°æ•°æ®ï¼Œç„¶å await nextTick æ¥å¤„ç†åç»­ DOM ä¾èµ–çš„ä»»åŠ¡ã€‚</li>
<li><strong>ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­</strong>ï¼šåœ¨ mounted æˆ– updated é’©å­ä¸­ï¼Œå¦‚æœéœ€è¦åŸºäºæ›´æ–°åçš„ DOM æ‰§è¡Œä»£ç ï¼Œä½¿ç”¨ nextTick ç¡®ä¿å®‰å…¨ã€‚</li>
<li><strong>æµ‹è¯•å’Œè°ƒè¯•</strong>ï¼šåœ¨å•å…ƒæµ‹è¯•ä¸­ï¼Œç¡®ä¿ DOM å·²åŒæ­¥æ›´æ–°åå†æ–­è¨€ã€‚</li>
</ul>
<h2 data-id="heading-32">9ã€Vueä¸­ computed å’Œ watch çš„åŒºåˆ«</h2>








































<table><thead><tr><th>ç‰¹æ€§</th><th>computed (è®¡ç®—å±æ€§)</th><th>watch (ä¾¦å¬å™¨)</th></tr></thead><tbody><tr><td>è®¾è®¡ç›®çš„</td><td>æ´¾ç”Ÿæ–°æ•°æ®</td><td>è§‚å¯Ÿæ•°æ®å˜åŒ–æ‰§è¡Œå‰¯ä½œç”¨</td></tr><tr><td>è¿”å›å€¼</td><td>å¿…é¡»è¿”å›ä¸€ä¸ªå€¼</td><td>ä¸éœ€è¦è¿”å›å€¼</td></tr><tr><td>ç¼“å­˜</td><td>æœ‰ç¼“å­˜ï¼Œä¾èµ–ä¸å˜æ—¶ä¸é‡æ–°è®¡ç®—</td><td>æ— ç¼“å­˜ï¼Œæ¯æ¬¡å˜åŒ–éƒ½æ‰§è¡Œ</td></tr><tr><td>å¼‚æ­¥æ“ä½œ</td><td>ä¸èƒ½åŒ…å«å¼‚æ­¥æ“ä½œ</td><td>å¯ä»¥æ‰§è¡Œå¼‚æ­¥æ“ä½œ</td></tr><tr><td>åˆå§‹æ‰§è¡Œ</td><td>ç«‹å³æ‰§è¡Œ</td><td>é»˜è®¤ä¸ç«‹å³æ‰§è¡Œ(é…ç½® immediate: trueåä¼šç«‹å³æ‰§è¡Œ)</td></tr><tr><td>ä½¿ç”¨åœºæ™¯</td><td>æ¨¡æ¿ä¸­ä½¿ç”¨çš„æ´¾ç”Ÿæ•°æ®</td><td>æ•°æ®å˜åŒ–æ—¶éœ€è¦æ‰§è¡Œçš„æ“ä½œ(å¦‚APIè°ƒç”¨ã€å¤æ‚é€»è¾‘)</td></tr></tbody></table>
<h2 data-id="heading-33">10ã€Vue2 çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æœ‰å“ªäº›ï¼Ÿä¸€èˆ¬åœ¨å“ªä¸€æ­¥å‘èµ·è¯·æ±‚åŠåŸå› </h2>
<ul>
<li><strong>beforeCreate</strong>ï¼šåœ¨å®ä¾‹åˆå§‹åŒ–ä¹‹åï¼Œæ•°æ®è§‚æµ‹(data observer) å’Œ event/watcher äº‹ä»¶é…ç½®ä¹‹å‰è¢«è°ƒç”¨ã€‚</li>
<li><strong>created</strong>ï¼šå®ä¾‹å·²ç»åˆ›å»ºå®Œæˆä¹‹åè¢«è°ƒç”¨ã€‚åœ¨è¿™ä¸€æ­¥ï¼Œå®ä¾‹å·²å®Œæˆä»¥ä¸‹çš„é…ç½®ï¼šæ•°æ®è§‚æµ‹(data observer)ï¼Œå±æ€§å’Œæ–¹æ³•çš„è¿ç®—ï¼Œ watch/event äº‹ä»¶å›è°ƒã€‚è¿™é‡Œæ²¡æœ‰$el</li>
<li><strong>beforeMount</strong>ï¼šåœ¨æŒ‚è½½å¼€å§‹ä¹‹å‰è¢«è°ƒç”¨ï¼šç›¸å…³çš„ render å‡½æ•°é¦–æ¬¡è¢«è°ƒç”¨ã€‚</li>
<li><strong>mounted</strong>ï¼šel è¢«æ–°åˆ›å»ºçš„ vm.$el æ›¿æ¢ï¼Œå¹¶æŒ‚è½½åˆ°å®ä¾‹ä¸Šå»ä¹‹åè°ƒç”¨è¯¥é’©å­ã€‚</li>
<li><strong>beforeUpdate</strong>ï¼šæ•°æ®æ›´æ–°æ—¶è°ƒç”¨ï¼Œå‘ç”Ÿåœ¨è™šæ‹Ÿ DOM é‡æ–°æ¸²æŸ“å’Œæ‰“è¡¥ä¸ä¹‹å‰ã€‚</li>
<li><strong>updated</strong>ï¼šç”±äºæ•°æ®æ›´æ”¹å¯¼è‡´çš„è™šæ‹Ÿ DOM é‡æ–°æ¸²æŸ“å’Œæ‰“è¡¥ä¸ï¼Œåœ¨è¿™ä¹‹åä¼šè°ƒç”¨è¯¥é’©å­ã€‚</li>
<li><strong>beforeDestroy</strong>ï¼šå®ä¾‹é”€æ¯ä¹‹å‰è°ƒç”¨ã€‚åœ¨è¿™ä¸€æ­¥ï¼Œå®ä¾‹ä»ç„¶å®Œå…¨å¯ç”¨ã€‚</li>
<li><strong>destroyed</strong>ï¼šVue å®ä¾‹é”€æ¯åè°ƒç”¨ã€‚è°ƒç”¨åï¼ŒVue å®ä¾‹æŒ‡ç¤ºçš„æ‰€æœ‰ä¸œè¥¿éƒ½ä¼šè§£ç»‘å®šï¼Œæ‰€æœ‰çš„äº‹ä»¶ç›‘å¬å™¨ä¼šè¢«ç§»é™¤ï¼Œæ‰€æœ‰çš„å­å®ä¾‹ä¹Ÿä¼šè¢«é”€æ¯ã€‚ è¯¥é’©å­åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æœŸé—´ä¸è¢«è°ƒç”¨ã€‚</li>
</ul>
<p><strong>é’©å­å‡½æ•°çš„ä½œç”¨</strong>ï¼š</p>
<ul>
<li><strong>created</strong>ï¼šå®ä¾‹å·²ç»åˆ›å»ºå®Œæˆï¼Œå› ä¸ºå®ƒæ˜¯æœ€æ—©è§¦å‘çš„åŸå› å¯ä»¥è¿›è¡Œä¸€äº›æ•°æ®ï¼Œèµ„æºçš„è¯·æ±‚ã€‚(æœåŠ¡ç«¯æ¸²æŸ“æ”¯æŒcreatedæ–¹æ³•)</li>
<li><strong>mounted</strong>ï¼šå®ä¾‹å·²ç»æŒ‚è½½å®Œæˆï¼Œå¯ä»¥è¿›è¡Œä¸€äº›DOMæ“ä½œ</li>
<li><strong>beforeUpdate</strong>ï¼šå¯ä»¥åœ¨è¿™ä¸ªé’©å­ä¸­è¿›ä¸€æ­¥åœ°æ›´æ”¹çŠ¶æ€ï¼Œè¿™ä¸ä¼šè§¦å‘é™„åŠ çš„é‡æ¸²æŸ“è¿‡ç¨‹ã€‚</li>
<li><strong>updated</strong>ï¼šå¯ä»¥æ‰§è¡Œä¾èµ–äº DOM çš„æ“ä½œã€‚ç„¶è€Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥é¿å…åœ¨æ­¤æœŸé—´æ›´æ”¹çŠ¶æ€ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå¯¼è‡´æ›´æ–°æ— é™å¾ªç¯ã€‚ è¯¥é’©å­åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æœŸé—´ä¸è¢«è°ƒç”¨ã€‚</li>
<li><strong>destroyed</strong>ï¼šå¯ä»¥æ‰§è¡Œä¸€äº›ä¼˜åŒ–æ“ä½œ,æ¸…ç©ºå®šæ—¶å™¨ï¼Œè§£é™¤ç»‘å®šäº‹ä»¶</li>
</ul>
<p>åœ¨å“ªå‘é€è¯·æ±‚éƒ½å¯ä»¥ï¼Œä¸»è¦çœ‹å…·ä½“ä½ è¦åšä»€ä¹ˆäº‹ï¼Œä¸€èˆ¬ä¼šåœ¨ <code>created</code> å’Œ <code>mounted</code> å‘èµ·è¯·æ±‚ï¼Œä½†æ³¨æ„æœåŠ¡ç«¯æ¸²æŸ“ä¸æ‰§è¡Œ <code>mounted</code> é’©å­ã€‚</p>
<h2 data-id="heading-34">11ã€Vue.js ä¸­ç»„ä»¶ä¸­çš„ data ä¸ºä»€ä¹ˆæ˜¯ä¸€ä¸ªå‡½æ•°?</h2>
<p>æ¯æ¬¡ä½¿ç”¨ç»„ä»¶æ—¶éƒ½ä¼šå¯¹ç»„ä»¶è¿›è¡Œå®ä¾‹åŒ–æ“ä½œï¼Œå¹¶ä¸”è°ƒç”¨ <code>data</code> å‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡ä½œä¸ºç»„ä»¶çš„æ•°æ®æºã€‚è¿™æ ·å¯ä»¥ä¿è¯å¤šä¸ªç»„ä»¶é—´æ•°æ®äº’ä¸å½±å“ã€‚</p>
<h2 data-id="heading-35">12ã€è°ˆè°ˆå¯¹ Vue.js ç»„ä»¶åŒ–çš„ç†è§£ï¼Ÿ</h2>
<p>åœ¨ Vue.js ä¸­ï¼Œæ¯ä¸€ä¸ª <code>.vue</code> æ–‡ä»¶å³ä¸€ä¸ª vue ç»„ä»¶ï¼Œç»„ä»¶åŒ–çš„æ ¸å¿ƒåŒ…æ‹¬æ¨¡æ¿ templateã€å±æ€§ propsã€äº‹ä»¶ã€æ’æ§½ slotã€ç”Ÿå‘½å‘¨æœŸç­‰ã€‚</p>
<p>ç»„ä»¶åŒ–å¥½å¤„: é«˜å†…èšã€å¯é‡ç”¨ã€å¯ç»„åˆã€‚</p>
<ul>
<li>ç»„ä»¶åŒ–å¼€å‘èƒ½å¤§å¹…æé«˜åº”ç”¨å¼€å‘æ•ˆç‡ã€æµ‹è¯•æ€§ã€å¤ç”¨æ€§ç­‰;</li>
<li>é™ä½æ›´æ–°èŒƒå›´ï¼Œåªé‡æ–°æ¸²æŸ“å˜åŒ–çš„ç»„ä»¶ã€‚</li>
</ul>
<h2 data-id="heading-36">13ã€è°ˆè°ˆå¯¹ Vue.js å•å‘æ•°æ®æµçš„ç†è§£ï¼Ÿ</h2>
<p>Vue.js çš„å•å‘æ•°æ®æµæ˜¯å…¶æ ¸å¿ƒè®¾è®¡åŸåˆ™ä¹‹ä¸€ï¼Œå®ƒç¡®ä¿æ•°æ®åœ¨ç»„ä»¶é—´æµåŠ¨æ—¶å…·æœ‰<strong>å¯é¢„æµ‹æ€§</strong>å’Œ<strong>ä¸€è‡´æ€§</strong>ï¼Œä¾¿äºè°ƒè¯•å’Œè¿½è¸ª bugã€‚</p>
<p>æ•°æ®æ€»æ˜¯ä»çˆ¶ç»„ä»¶å‘ä¸‹æµåŠ¨åˆ°å­ç»„ä»¶ï¼ˆé€šè¿‡ <code>props</code> ä¼ é€’ï¼‰ï¼Œè€Œå­ç»„ä»¶ä¸èƒ½ç›´æ¥ä¿®æ”¹ä»çˆ¶ç»„ä»¶æ¥æ”¶åˆ°çš„æ•°æ®ã€‚å¦‚æœå­ç»„ä»¶éœ€è¦æ›´æ–°æ•°æ®ï¼Œåªèƒ½é€šè¿‡è§¦å‘äº‹ä»¶ï¼ˆ<code>emits</code> æˆ–è‡ªå®šä¹‰äº‹ä»¶ï¼‰é€šçŸ¥çˆ¶ç»„ä»¶ï¼Œç”±çˆ¶ç»„ä»¶è´Ÿè´£å®é™…çš„æ›´æ–°ã€‚</p>
<h2 data-id="heading-37">14ã€Vue.js çˆ¶ç»„ä»¶å¦‚ä½•ç›‘å¬å­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ</h2>
<ul>
<li>vue2 ç”¨ @hook:mountedã€‚</li>
<li>vue3 ç”¨ @vue:mountedã€‚</li>
</ul>
<p>ä¸‹é¢æ¼”ç¤º vue3 çš„å†™æ³•ï¼Œvue2 åŒç†ã€‚</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- parent.vue --&gt;
&lt;template&gt;
  &lt;Child @vue:mounted="fn" /&gt;
&lt;/template&gt;


&lt;script lang="ts" setup&gt;
import Child from './Child.vue'
const afterChildMounted = () =&gt; {
  console.log('after child mounted')
}
&lt;/script&gt;
</code></pre>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- Child.vue --&gt;
&lt;script setup&gt;
import { onMounted } from 'vue'

onMounted(() =&gt; {
  console.log('child mounted')
})

&lt;/script&gt;

</code></pre>
<h2 data-id="heading-38">15ã€è¯·è¯´ä¸€ä¸‹ Vue.js ä¸­ key çš„ä½œç”¨ï¼Ÿ</h2>
<p>åœ¨ Vue.js ä¸­ï¼Œ<code>key</code> å±æ€§ä¸»è¦ç”¨äºä¼˜åŒ–åˆ—è¡¨æ¸²æŸ“ï¼Œç‰¹åˆ«æ˜¯ä¸ <code>v-for</code> æŒ‡ä»¤ç»“åˆä½¿ç”¨æ—¶ã€‚å®ƒä¸ºåˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ æä¾›ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå¸®åŠ© Vue è·Ÿè¸ªèŠ‚ç‚¹çš„èº«ä»½ï¼Œä»è€Œåœ¨æ•°æ®å˜åŒ–æ—¶æ›´é«˜æ•ˆåœ°æ›´æ–° DOMã€‚</p>
<ul>
<li><strong>æå‡æ¸²æŸ“æ•ˆç‡</strong>ï¼šVue é»˜è®¤ä½¿ç”¨â€œå°±åœ°æ›´æ–°â€ï¼ˆin-place patchï¼‰ç­–ç•¥æ¥å¤„ç†åˆ—è¡¨å˜åŒ–ï¼Œå³ä¸ç§»åŠ¨ DOM å…ƒç´ ï¼Œè€Œæ˜¯ç›´æ¥æ›´æ–°ç°æœ‰å…ƒç´ çš„å†…å®¹ã€‚å¦‚æœåˆ—è¡¨é¡¹çš„é¡ºåºå‘ç”Ÿå˜åŒ–ï¼Œè¿™ç§ç­–ç•¥å¯èƒ½å¯¼è‡´é—®é¢˜ï¼ˆå¦‚çŠ¶æ€ä¸¢å¤±ï¼‰ã€‚<code>key</code> å…è®¸ Vue å¤ç”¨å’Œé‡æ–°æ’åºç°æœ‰çš„ DOM å…ƒç´ ï¼Œç¡®ä¿æ›´æ–°æ›´ç²¾ç¡®ã€‚</li>
<li><strong>ä¿ç•™ç»„ä»¶çŠ¶æ€</strong>ï¼šå½“åˆ—è¡¨é¡¹åŒ…å«æœ‰çŠ¶æ€çš„ç»„ä»¶ï¼ˆå¦‚è¡¨å•è¾“å…¥æ¡†ï¼‰æ—¶ï¼Œ<code>key</code> ç¡®ä¿ç»„ä»¶çš„å†…éƒ¨çŠ¶æ€ï¼ˆå¦‚è¾“å…¥å€¼ï¼‰ä¸ä¼šåœ¨æ•°æ®é‡æ’æ—¶ä¸¢å¤±æˆ–é”™ä½ã€‚</li>
<li><strong>ä¼˜åŒ– diff ç®—æ³•</strong>ï¼šVue çš„è™šæ‹Ÿ DOM diff è¿‡ç¨‹ä¾èµ– <code>key</code> æ¥æ¯”è¾ƒæ–°æ—§èŠ‚ç‚¹ã€‚å¦‚æœæ²¡æœ‰ keyï¼ŒVue ä¼šæŒ‰ç´¢å¼•æ¯”è¾ƒï¼Œå¯èƒ½å¯¼è‡´ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ã€‚</li>
</ul>
<h2 data-id="heading-39">16ã€Vue.use æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ</h2>
<p><code>Vue.use</code> æ–¹æ³•æ˜¯ç”¨äºå®‰è£…ï¼ˆæ³¨å†Œï¼‰Vue æ’ä»¶çš„å…¨å±€æ–¹æ³•ã€‚å®ƒå…è®¸å¼€å‘è€…åœ¨ Vue åº”ç”¨ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹æ’ä»¶æˆ–è‡ªå®šä¹‰æ’ä»¶ï¼Œä»è€Œæ‰©å±• Vue çš„åŠŸèƒ½ï¼Œå¦‚æ·»åŠ å…¨å±€ç»„ä»¶ã€æŒ‡ä»¤ã€æ··å…¥ï¼ˆmixinsï¼‰æˆ–å…¶ä»–ç‰¹æ€§ã€‚
ä¸»è¦ä½œç”¨</p>
<ul>
<li><strong>æ’ä»¶å®‰è£…æœºåˆ¶</strong>ï¼šå½“è°ƒç”¨ Vue.use(plugin) æ—¶ï¼ŒVue ä¼šæ£€æŸ¥æ’ä»¶æ˜¯å¦æœ‰ä¸€ä¸ª install æ–¹æ³•ã€‚å¦‚æœæœ‰ï¼Œå®ƒä¼šè°ƒç”¨ plugin.install(Vue, options)ï¼Œå…¶ä¸­ Vue æ˜¯ Vue æ„é€ å‡½æ•°ï¼Œoptions æ˜¯å¯é€‰å‚æ•°ã€‚è¿™ä½¿å¾—æ’ä»¶å¯ä»¥ä¿®æ”¹ Vue çš„è¡Œä¸ºæˆ–æ·»åŠ æ–°åŠŸèƒ½ã€‚</li>
<li><strong>é¿å…é‡å¤å®‰è£…</strong>ï¼šVue.use ä¼šè‡ªåŠ¨æ£€æŸ¥æ’ä»¶æ˜¯å¦å·²å®‰è£…ï¼Œå¦‚æœå·²å®‰è£…ï¼Œåˆ™ä¸ä¼šé‡å¤è°ƒç”¨ install æ–¹æ³•ã€‚</li>
<li><strong>ä½¿ç”¨æ—¶æœº</strong>ï¼šé€šå¸¸åœ¨åˆ›å»º Vue å®ä¾‹ä¹‹å‰è°ƒç”¨ï¼Œä¾‹å¦‚åœ¨ main.js ä¸­å¼•å…¥æ’ä»¶ã€‚</li>
</ul>
<h2 data-id="heading-40">17ã€Vue.js å¸¸ç”¨çš„ä¿®é¥°ç¬¦åŠå…¶ä½œç”¨ï¼Ÿ</h2>
<ol>
<li>äº‹ä»¶ä¿®é¥°ç¬¦</li>
</ol>
<ul>
<li><strong>.stop</strong>ï¼šé˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œç›¸å½“äº <code>event.stopPropagation()</code>ã€‚</li>
<li><strong>.prevent</strong>ï¼šé˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œç›¸å½“äº <code>event.preventDefault()</code>ã€‚</li>
<li><strong>.capture</strong>ï¼šä½¿ç”¨æ•è·æ¨¡å¼è€Œéå†’æ³¡æ¨¡å¼è§¦å‘äº‹ä»¶ã€‚</li>
<li><strong>.self</strong>ï¼šåªåœ¨äº‹ä»¶ä»å…ƒç´ æœ¬èº«è§¦å‘æ—¶æ‰§è¡Œï¼ˆå¿½ç•¥å­å…ƒç´ å†’æ³¡ï¼‰ã€‚</li>
<li><strong>.once</strong>ï¼šäº‹ä»¶åªè§¦å‘ä¸€æ¬¡ï¼ˆç›¸å½“äº addEventListener çš„ once é€‰é¡¹ï¼‰ã€‚</li>
<li><strong>.passive</strong>ï¼šæ”¹å–„æ»šåŠ¨äº‹ä»¶çš„æ€§èƒ½ï¼ˆä¸é˜»å¡ UI çº¿ç¨‹ï¼‰ã€‚</li>
<li><strong>.native</strong>ï¼šåœ¨è‡ªå®šä¹‰ç»„ä»¶ä¸Šç›‘å¬åŸç”Ÿ DOM äº‹ä»¶ã€‚</li>
</ul>
<ol start="2">
<li>v-modelè¡¨å•ä¿®é¥°ç¬¦</li>
</ol>
<ul>
<li><strong>.lazy</strong>ï¼šåœ¨ change äº‹ä»¶åæ›´æ–°æ•°æ®ï¼Œè€Œä¸æ˜¯ input äº‹ä»¶ï¼ˆå»¶è¿Ÿæ›´æ–°ï¼‰ã€‚</li>
<li><strong>.number</strong>ï¼šå°†è¾“å…¥å€¼è‡ªåŠ¨è½¬æ¢ä¸ºæ•°å­—ç±»å‹ã€‚</li>
<li><strong>.trim</strong>ï¼šè‡ªåŠ¨å»é™¤è¾“å…¥å€¼çš„é¦–å°¾ç©ºæ ¼ã€‚</li>
</ul>
<ol start="3">
<li>æŒ‰é”®ä¿®é¥°ç¬¦ï¼ˆKey Modifiersï¼‰</li>
</ol>
<ul>
<li><strong>.enter</strong>ï¼šç›‘å¬ Enter é”®ã€‚</li>
<li><strong>.tab</strong>ï¼šç›‘å¬ Tab é”®ã€‚</li>
<li><strong>.delete</strong>ï¼šç›‘å¬ Delete æˆ– Backspace é”®ã€‚</li>
<li><strong>.esc</strong>ï¼šç›‘å¬ Esc é”®ã€‚</li>
<li><strong>.space</strong>ï¼šç›‘å¬ç©ºæ ¼é”®ã€‚</li>
<li><strong>.up / .down / .left / .right</strong>ï¼šç›‘å¬æ–¹å‘é”®ã€‚</li>
</ul>
<ol start="4">
<li>.sync ä¿®é¥°ç¬¦</li>
</ol>
<p><code>.sync</code> ä¿®é¥°ç¬¦ä¸»è¦æ˜¯ä¸ºäº†ç®€åŒ–ç»„ä»¶é—´çš„åŒå‘æ•°æ®ç»‘å®šï¼Œå®ƒæ˜¯ä¸€ç§è¯­æ³•ç³–ï¼Œå…è®¸å­ç»„ä»¶é€šè¿‡ç‰¹å®šäº‹ä»¶æ›´æ–°çˆ¶ç»„ä»¶çš„ propï¼Œè€Œæ— éœ€æ‰‹åŠ¨ç¼–å†™äº‹ä»¶ç›‘å¬å™¨ã€‚</p>
<h2 data-id="heading-41">18ã€vue3 ä¸­ ref å’Œ reactive çš„åŒºåˆ«ï¼Ÿ</h2>
<p>ç›¸åŒç‚¹ï¼š<code>ref</code> å’Œ <code>reactive</code> éƒ½å¯ä»¥åˆ›å»ºå“åº”å¼æ•°æ®ã€‚</p>
<p>ä¸åŒç‚¹ï¼š</p>
<ol>
<li>å…¥å‚ä¸åŒï¼š</li>
</ol>
<ul>
<li><strong>ref</strong>ï¼šå¯ä»¥ä¼ åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆprimitive valuesï¼Œå¦‚numberã€stringã€Symbolã€undefinedã€nullã€bigIntã€booleanï¼‰ï¼Œä¹Ÿå¯ä»¥åŒ…æ‹¬å¯¹è±¡ã€‚</li>
<li><strong>reactive</strong>ï¼šåªèƒ½ä¼ å…¥å¼•ç”¨æ•°æ®(objectã€arrayç­‰)ã€‚</li>
</ul>
<ol start="2">
<li>è®¿é—®å’Œä¿®æ”¹æ–¹å¼ä¸åŒï¼š</li>
</ol>
<ul>
<li><strong>ref</strong>ï¼šå¿…é¡»ä½¿ç”¨ .value æ¥è¯»å†™ã€‚</li>
<li><strong>reactive</strong>ï¼šåƒæ™®é€šå¯¹è±¡ä¸€æ ·ç›´æ¥è®¿é—®å±æ€§ï¼Œæ— éœ€é¢å¤–åç¼€ã€‚</li>
</ul>
<ol start="3">
<li>å®ç°ä¸Šä¸åŒï¼š</li>
</ol>
<ul>
<li><strong>ref</strong>ï¼šå¦‚æœä¼ å…¥åŸºç¡€æ•°æ®ç±»å‹ï¼Œç›´æ¥ç”¨ RefImpl ç±»çš„ get set, ä½†å¦‚æœä¼ å…¥çš„æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œå†…éƒ¨æ˜¯å€ŸåŠ© reactive å®ç°ã€‚</li>
<li><strong>reactive</strong>ï¼šå†…éƒ¨é‡‡ç”¨ Proxy è¿›è¡Œä»£ç†å®ç°çš„å“åº”å¼ã€‚</li>
</ul>
<h2 data-id="heading-42">19ã€Vue3 ä¸­å¦‚ä½•è·å–å½“å‰ç»„ä»¶å®ä¾‹ï¼Ÿ</h2>
<p>é€šè¿‡ <code>getCurrentInstance</code> å‡½æ•°å¯ä»¥è·å–å½“å‰ç»„ä»¶å®ä¾‹ã€‚</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { getCurrentInstance } from 'vue';
const instance = getCurrentInstance();
console.log('instance: ', instance);
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-43">20ã€å¦‚ä½•ä½¿ç”¨å¼‚æ­¥ç»„ä»¶ï¼Ÿ</h2>
<p>vue3:</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { defineAsyncComponent } from 'vue';
const AsyncCom = defineAsyncComponent(() =&gt; import('./MyComponent.vue'));
&lt;/script&gt;
</code></pre>
<p>vue2:</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script&gt;
export default {
  components: {
    AsyncCom: () =&gt; import('./MyComponent.vue')
  }
};
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-44">21ã€Vue.js çˆ¶å­ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­çš„æ‰§è¡Œæµç¨‹ï¼Ÿ</h2>
<ol>
<li><strong>ç»„ä»¶åˆ›å»ºé˜¶æ®µ</strong>ï¼š çˆ¶ beforeCreate â†’ çˆ¶ created â†’ çˆ¶ beforeMount â†’ å­ beforeCreate â†’ å­ created â†’ å­ beforeMount â†’ å­ mounted â†’ çˆ¶ mountedã€‚</li>
<li><strong>ç»„ä»¶æ›´æ–°é˜¶æ®µ</strong>ï¼šçˆ¶ beforeUpdate â†’ å­ beforeUpdate â†’ å­ updated â†’ çˆ¶ updatedã€‚</li>
<li><strong>ç»„ä»¶é”€æ¯é˜¶æ®µ</strong>ï¼šçˆ¶ beforeDestroy â†’ å­ beforeDestroy â†’ å­ destroyed â†’ çˆ¶ destroyedã€‚</li>
</ol>
<h2 data-id="heading-45">ç»“è¯­</h2>
<p>ä»¥ä¸Šæ˜¯æ•´ç†çš„ 20+ Vue åˆã€ä¸­çº§çš„é«˜é¢‘é¢è¯•é¢˜ï¼Œå¦‚æœ‰é”™è¯¯æˆ–è€…å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹æ¬¢è¿è¯„è®ºåŒºæŒ‡æ­£ï¼Œåç»­è¿˜ä¼šæ›´æ–° Vue é¢è¯•é¢˜é«˜çº§ç¯‡ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆæˆ‘çš„reacté¡¹ç›®å¯åŠ¨åï¼Œdomä¸Šçš„ç±»åé‡Œæ²¡æœ‰ä»£ç ä½ç½®ä¿¡æ¯]]></title>    <link>https://juejin.cn/post/7571279513247825946</link>    <guid>https://juejin.cn/post/7571279513247825946</guid>    <pubDate>2025-11-11T13:35:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571279513247825946" data-draft-id="7571351275976015923" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆæˆ‘çš„reacté¡¹ç›®å¯åŠ¨åï¼Œdomä¸Šçš„ç±»åé‡Œæ²¡æœ‰ä»£ç ä½ç½®ä¿¡æ¯"/> <meta itemprop="keywords" content="React.js,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-11T13:35:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¹Ÿæ— é£é›¨ä¹Ÿé›¾æ™´"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆæˆ‘çš„reacté¡¹ç›®å¯åŠ¨åï¼Œdomä¸Šçš„ç±»åé‡Œæ²¡æœ‰ä»£ç ä½ç½®ä¿¡æ¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¹Ÿæ— é£é›¨ä¹Ÿé›¾æ™´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T13:35:54.000Z" title="Tue Nov 11 2025 13:35:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘åœ¨å†™ä¸€ä¸ªæ–°çš„ React é¡¹ç›®ï¼Œæ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼Œå‘ç°ä¸ªæœ‰æ„æ€çš„äº‹ï¼šä¹‹å‰å›¢é˜Ÿä¸€èµ·å†™çš„é¡¹ç›®åœ¨ Elements é¢æ¿é‡Œï¼Œæ¯ä¸ª DOM å…ƒç´ éƒ½å¸¦ç€ä¸€å † <code>data-component-*</code> å±æ€§ï¼Œèƒ½ç›´æ¥çœ‹åˆ°æ˜¯å“ªä¸ªæ–‡ä»¶çš„å“ªä¸€è¡Œä»£ç ã€‚è€Œè¿™ä¸ªæˆ‘è‡ªå·±æ–°èµ·çš„é¡¹ç›®å°±åªæœ‰æ™®é€šçš„ HTML æ ‡ç­¾ã€‚</p>
<p>è¿™åˆ°åº•å’‹å›äº‹ï¼Ÿæ˜¯ä¸æ˜¯æœ‰ä»€ä¹ˆè°ƒè¯•ç¥å™¨ï¼Ÿ</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1941db24d5df4402a5a59b95bf33328a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763472954&amp;x-signature=mWHd1MY8FRhsr9Xm6Yqzpj%2F1NEs%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">React çš„ DOM ä¸ºå•¥çœ‹ä¸åˆ°ç»„ä»¶åï¼Ÿ</h2>
<p>å…ˆè¯´ä¸ªåŸºç¡€çŸ¥è¯†ï¼šReact ç»„ä»¶æœ€ç»ˆä¼šè¢«ç¼–è¯‘æˆæ™®é€š HTMLã€‚ä½ åœ¨ Elements é¢æ¿çœ‹åˆ°çš„æ˜¯<strong>çœŸå® DOM</strong>ï¼Œä¸æ˜¯ React çš„è™šæ‹Ÿ DOMã€‚</p>
<p>æ¯”å¦‚è¿™ä¸ªç»„ä»¶ï¼š</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyButton</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"my-btn"</span>&gt;</span>Click me<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;
}
</code></pre>
<p>æµè§ˆå™¨é‡Œåªä¼šçœ‹åˆ°ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"my-btn"</span>&gt;</span>Click me<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<p>ç»„ä»¶å <code>MyButton</code> æ ¹æœ¬ä¸ä¼šå‡ºç°åœ¨ DOM é‡Œï¼Œå› ä¸ºå®ƒåªæ˜¯ä¸ª JavaScript å‡½æ•°ï¼Œæœ€åè¿”å›çš„å°±æ˜¯è¿™ä¸ª <code>button</code> å…ƒç´ ã€‚</p>
<h2 data-id="heading-1">é‚£äº›èƒ½çœ‹åˆ°ç»„ä»¶ä¿¡æ¯çš„é¡¹ç›®æ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Ÿ</h2>
<p>çœ‹äº†åˆ«äººçš„é¡¹ç›®ä»£ç ï¼Œå‘ç°éƒ½ç”¨äº† Vite è°ƒè¯•æ’ä»¶ã€‚è¿™ç±»æ’ä»¶ä¼šç»™æ¯ä¸ª React å…ƒç´ æ³¨å…¥è°ƒè¯•å±æ€§ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
  <span class="hljs-attr">data-inspector</span>=<span class="hljs-string">"src/pages/HomePage.tsx:42:7"</span>
  <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>
&gt;</span>
  <span class="hljs-comment">&lt;!-- å†…å®¹ --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>å±æ€§æ ¼å¼æ˜¯ <code>æ–‡ä»¶è·¯å¾„:è¡Œå·:åˆ—å·</code>ï¼Œä¸€çœ¼å°±èƒ½çœ‹å‡ºç»„ä»¶æ¥æºã€‚</p>
<p>æ›´å¼ºå¤§çš„æ˜¯ï¼Œæœ‰äº›æ’ä»¶è¿˜æ”¯æŒ<strong>ç‚¹å‡»é¡µé¢å…ƒç´ ç›´æ¥è·³è½¬åˆ° VS Code æºç </strong>ï¼è¿™æ‰æ˜¯çœŸæ­£çš„æ•ˆç‡ç¥å™¨ã€‚</p>
<h2 data-id="heading-2">è§£å†³æ–¹æ¡ˆï¼švite-plugin-react-inspector</h2>
<p><code>vite-plugin-react-inspector</code> æ˜¯ä¸“é—¨ä¸º Vite + React é¡¹ç›®è®¾è®¡çš„è°ƒè¯•å·¥å…·ï¼ŒåŠŸèƒ½å¼ºå¤§ä¸”æ˜“ç”¨ã€‚</p>
<h3 data-id="heading-3">å®‰è£…</h3>
<pre><code class="hljs language-bash" lang="bash">pnpm add -D vite-plugin-react-inspector
<span class="hljs-comment"># æˆ–</span>
npm install -D vite-plugin-react-inspector
</code></pre>
<h3 data-id="heading-4">é…ç½®å¾ˆç®€å•</h3>
<p>åœ¨ <code>vite.config.ts</code> é‡Œæ·»åŠ ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> react <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Inspector</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-react-inspector'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-function">(<span class="hljs-params">{ mode }</span>) =&gt;</span> ({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">react</span>(),
    <span class="hljs-comment">// åªåœ¨å¼€å‘æ¨¡å¼å¯ç”¨</span>
    mode === <span class="hljs-string">'development'</span> &amp;&amp;
      <span class="hljs-title class_">Inspector</span>({
        <span class="hljs-attr">toggleButtonVisibility</span>: <span class="hljs-string">'always'</span>,
        <span class="hljs-attr">toggleComboKey</span>: <span class="hljs-string">'alt-shift'</span>,
      }),
  ].<span class="hljs-title function_">filter</span>(<span class="hljs-title class_">Boolean</span>),
}));
</code></pre>
<p>é…ç½®è¯´æ˜ï¼š</p>
<ul>
<li><code>toggleButtonVisibility: 'always'</code> - å§‹ç»ˆæ˜¾ç¤ºæ£€æŸ¥å™¨æŒ‰é’®</li>
<li><code>toggleComboKey: 'alt-shift'</code> - ä½¿ç”¨ Alt+Shift å¿«æ·é”®æ¿€æ´»</li>
<li><code>mode === 'development'</code> - ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨ç¦ç”¨</li>
</ul>
<h3 data-id="heading-5">å®é™…æ•ˆæœ</h3>
<p>å¯åŠ¨å¼€å‘æœåŠ¡å™¨åï¼Œåœ¨æµè§ˆå™¨é‡Œçœ‹åˆ°çš„ DOMï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1221e687568c4d508cbee6eb65abca39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763472954&amp;x-signature=1Mnmxe%2BvP%2BBax%2FqeBL4mUT9T%2FMg%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">data-inspector</span>=<span class="hljs-string">"src/pages/HomePage.tsx:42:7"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- å†…å®¹ --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>å±æ€§æ ¼å¼æ˜¯ <code>æ–‡ä»¶è·¯å¾„:è¡Œå·:åˆ—å·</code>ï¼Œä¸€çœ¼å°±èƒ½çœ‹å‡ºæ¥æºã€‚</p>
<p>ç„¶åå¤åˆ¶åœ¨vscodeæœç´¢ï¼Œç›´æ¥å°±è·³è½¬åˆ°æºç ä½ç½®äº†ã€‚</p>
<h3 data-id="heading-6">ä»“åº“åœ°å€</h3>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsudongyuer%2Fvite-plugin-react-inspector" target="_blank" title="https://github.com/sudongyuer/vite-plugin-react-inspector" ref="nofollow noopener noreferrer">vite-plugin-react-inspector</a></strong> - GitHub ä»“åº“ï¼ŒæŸ¥çœ‹å®Œæ•´æ–‡æ¡£</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ—ï¸ Spring Boot 3å®ç°MySQLè¯»å†™åˆ†ç¦»å®Œæ•´æŒ‡å—]]></title>    <link>https://juejin.cn/post/7571304204754649142</link>    <guid>https://juejin.cn/post/7571304204754649142</guid>    <pubDate>2025-11-11T13:35:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571304204754649142" data-draft-id="7571306072422793258" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ—ï¸ Spring Boot 3å®ç°MySQLè¯»å†™åˆ†ç¦»å®Œæ•´æŒ‡å—"/> <meta itemprop="keywords" content="æ•°æ®åº“"/> <meta itemprop="datePublished" content="2025-11-11T13:35:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ITæ©˜å­çš®"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ—ï¸ Spring Boot 3å®ç°MySQLè¯»å†™åˆ†ç¦»å®Œæ•´æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ITæ©˜å­çš®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T13:35:49.000Z" title="Tue Nov 11 2025 13:35:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">âœ¨ è¯»å†™åˆ†ç¦»çš„æ ¸å¿ƒä»·å€¼</h2>
<p>åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œæ•°æ®åº“å¾€å¾€æˆä¸ºç³»ç»Ÿç“¶é¢ˆã€‚è¯»å†™åˆ†ç¦»é€šè¿‡å°†å†™æ“ä½œå®šå‘åˆ°ä¸»åº“ã€è¯»æ“ä½œåˆ†å‘åˆ°ä»åº“ï¼Œæ˜¾è‘—æå‡ç³»ç»Ÿè¯»æ€§èƒ½å’Œæ•°æ®å¯ç”¨æ€§ã€‚å½“ä¸»åº“å‡ºç°æ•…éšœæ—¶ï¼Œä»åº“å¯ä»¥ç»§ç»­æä¾›è¯»æœåŠ¡ï¼Œæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚</p>
<h2 data-id="heading-1">âš™ï¸ é¡¹ç›®ä¾èµ–é…ç½®</h2>
<p>é¦–å…ˆåœ¨<code>pom.xml</code>ä¸­æ·»åŠ å¿…è¦ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.33<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.zaxxer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>HikariCP<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h2 data-id="heading-2">ğŸ“ æ ¸å¿ƒå®ç°ä»£ç è¯¦è§£</h2>
<h3 data-id="heading-3">1. é…ç½®æ–‡ä»¶è®¾ç½®ï¼ˆapplication.ymlï¼‰</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-comment"># ä¸»åº“é…ç½®ï¼ˆå†™æ“ä½œï¼‰</span>
    <span class="hljs-attr">master:</span>
      <span class="hljs-attr">jdbc-url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/master_db?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai</span>
      <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
      <span class="hljs-attr">password:</span> <span class="hljs-string">master_password</span>
      <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
      <span class="hljs-comment"># Hikariè¿æ¥æ± é…ç½®</span>
      <span class="hljs-attr">hikari:</span>
        <span class="hljs-attr">maximum-pool-size:</span> <span class="hljs-number">10</span>
        <span class="hljs-attr">minimum-idle:</span> <span class="hljs-number">5</span>
        <span class="hljs-attr">idle-timeout:</span> <span class="hljs-number">30000</span>
        <span class="hljs-attr">max-lifetime:</span> <span class="hljs-number">1800000</span>
        <span class="hljs-attr">connection-timeout:</span> <span class="hljs-number">30000</span>
        <span class="hljs-attr">connection-test-query:</span> <span class="hljs-string">SELECT</span> <span class="hljs-number">1</span>
    <span class="hljs-comment"># ä»åº“é…ç½®ï¼ˆè¯»æ“ä½œï¼‰</span>
    <span class="hljs-attr">slave:</span>
      <span class="hljs-attr">jdbc-url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/slave_db?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai</span>
      <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
      <span class="hljs-attr">password:</span> <span class="hljs-string">slave_password</span>
      <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
      <span class="hljs-attr">hikari:</span>
        <span class="hljs-attr">maximum-pool-size:</span> <span class="hljs-number">15</span>  <span class="hljs-comment"># ä»åº“å¯ä»¥é…ç½®æ›´å¤šè¿æ¥ï¼Œå› ä¸ºè¯»æ“ä½œé€šå¸¸æ›´é¢‘ç¹</span>
        <span class="hljs-attr">minimum-idle:</span> <span class="hljs-number">8</span>
        <span class="hljs-attr">idle-timeout:</span> <span class="hljs-number">30000</span>
        <span class="hljs-attr">max-lifetime:</span> <span class="hljs-number">1800000</span>
        <span class="hljs-attr">connection-timeout:</span> <span class="hljs-number">30000</span>
        <span class="hljs-attr">connection-test-query:</span> <span class="hljs-string">SELECT</span> <span class="hljs-number">1</span>
</code></pre>
<h3 data-id="heading-4">2. æ•°æ®æºæšä¸¾å®šä¹‰</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/**
 * æ•°æ®æºç±»å‹æšä¸¾
 * ç”¨äºæ ‡è¯†å½“å‰æ“ä½œåº”ä½¿ç”¨ä¸»åº“è¿˜æ˜¯ä»åº“
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">DataSourceType</span> {
    MASTER,  <span class="hljs-comment">// ä¸»åº“ï¼šç”¨äºå†™æ“ä½œï¼ˆINSERTã€UPDATEã€DELETEï¼‰</span>
    SLAVE    <span class="hljs-comment">// ä»åº“ï¼šç”¨äºè¯»æ“ä½œï¼ˆSELECTï¼‰</span>
}
</code></pre>
<h3 data-id="heading-5">3. æ•°æ®æºä¸Šä¸‹æ–‡ç®¡ç†å™¨</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">/**
 * æ•°æ®æºä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼ˆåŸºäºThreadLocalå®ç°çº¿ç¨‹éš”ç¦»ï¼‰
 * åŠŸèƒ½ï¼šä¿å­˜å½“å‰çº¿ç¨‹ä½¿ç”¨çš„æ•°æ®æºç±»å‹ï¼Œç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ•°æ®æºåˆ‡æ¢ä¸ä¼šç›¸äº’å¹²æ‰°
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DataSourceContextHolder</span> {
    
    <span class="hljs-comment">// ä½¿ç”¨ThreadLocalä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰ç‹¬ç«‹çš„æ•°æ®æºä¸Šä¸‹æ–‡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final ThreadLocal&lt;DataSourceType&gt; CONTEXT_HOLDER = <span class="hljs-keyword">new</span> ThreadLocal&lt;&gt;();
    
    <span class="hljs-comment">/**
     * è®¾ç½®å½“å‰çº¿ç¨‹çš„æ•°æ®æºç±»å‹
     * @param dataSourceType æ•°æ®æºç±»å‹ï¼ˆMASTERæˆ–SLAVEï¼‰
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setDataSourceType</span>(<span class="hljs-params">DataSourceType dataSourceType</span>)</span> {
        CONTEXT_HOLDER.<span class="hljs-keyword">set</span>(dataSourceType);
    }
    
    <span class="hljs-comment">/**
     * è·å–å½“å‰çº¿ç¨‹çš„æ•°æ®æºç±»å‹
     * @return å½“å‰æ•°æ®æºç±»å‹ï¼Œé»˜è®¤ä¸ºMASTERï¼ˆä¿è¯å†™æ“ä½œå¯é æ€§ï¼‰
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DataSourceType <span class="hljs-title">getDataSourceType</span>()</span> {
        <span class="hljs-keyword">return</span> CONTEXT_HOLDER.<span class="hljs-keyword">get</span>() == <span class="hljs-literal">null</span> ? DataSourceType.MASTER : CONTEXT_HOLDER.<span class="hljs-keyword">get</span>();
    }
    
    <span class="hljs-comment">/**
     * æ¸…é™¤å½“å‰çº¿ç¨‹çš„æ•°æ®æºç±»å‹
     * é˜²æ­¢å†…å­˜æ³„æ¼ï¼Œç‰¹åˆ«æ˜¯åœ¨çº¿ç¨‹æ± åœºæ™¯ä¸‹
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">clearDataSourceType</span>()</span> {
        CONTEXT_HOLDER.<span class="hljs-keyword">remove</span>();
    }
}
</code></pre>
<h3 data-id="heading-6">4. åŠ¨æ€è·¯ç”±æ•°æ®æº</h3>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-comment">/**
 * åŠ¨æ€è·¯ç”±æ•°æ®æºï¼ˆç»§æ‰¿Springçš„AbstractRoutingDataSourceï¼‰
 * æ ¸å¿ƒåŠŸèƒ½ï¼šæ ¹æ®å½“å‰ä¸Šä¸‹æ–‡åŠ¨æ€é€‰æ‹©ä¸»åº“æˆ–ä»åº“
 */</span>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DynamicRoutingDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractRoutingDataSource</span> </span>{
    
    <span class="hljs-comment">/**
     * å†³å®šå½“å‰æ•°æ®æºæŸ¥æ‰¾é”®ï¼ˆSpringåœ¨æ¯æ¬¡æ•°æ®åº“æ“ä½œå‰è°ƒç”¨æ­¤æ–¹æ³•ï¼‰
     * @return æ•°æ®æºæŸ¥æ‰¾é”®ï¼ˆMASTERæˆ–SLAVEï¼‰
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-type">Object</span> determineCurrentLookupKey() {
        <span class="hljs-type">DataSourceType</span> dataSourceType = <span class="hljs-type">DataSourceContextHolder</span>.getDataSourceType();
        <span class="hljs-type">System</span>.out.println(<span class="hljs-string">"å½“å‰ä½¿ç”¨çš„æ•°æ®æº: "</span> + dataSourceType);
        <span class="hljs-keyword">return</span> dataSourceType;
    }
}
</code></pre>
<h3 data-id="heading-7">5. æ•°æ®æºé…ç½®ç±»</h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">/**
 * æ•°æ®æºé…ç½®ç±»ï¼ˆæ ¸å¿ƒé…ç½®ï¼‰
 * é…ç½®ä¸»ä»æ•°æ®æºå¹¶åˆå§‹åŒ–è·¯ç”±æ•°æ®æº
 */</span>
<span class="hljs-variable">@Configuration</span>
<span class="hljs-variable">@EnableTransactionManagement</span>
<span class="hljs-variable">@EnableJpaRepositories</span>(
    basePackages = <span class="hljs-string">"com.example.repository"</span>,
    entityManagerFactoryRef = <span class="hljs-string">"entityManagerFactory"</span>,
    transactionManagerRef = <span class="hljs-string">"transactionManager"</span>
)
public class DataSourceConfig {
    
    <span class="hljs-comment">/**
     * ä¸»åº“æ•°æ®æºï¼ˆå†™æ“ä½œï¼‰
     */</span>
    <span class="hljs-variable">@Bean</span>(name = <span class="hljs-string">"masterDataSource"</span>)
    <span class="hljs-variable">@ConfigurationProperties</span>(prefix = <span class="hljs-string">"spring.datasource.master"</span>)
    public DataSource <span class="hljs-built_in">masterDataSource</span>() {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">DataSourceBuilder</span><span class="hljs-selector-class">.create</span>()<span class="hljs-selector-class">.build</span>();
    }
    
    <span class="hljs-comment">/**
     * ä»åº“æ•°æ®æºï¼ˆè¯»æ“ä½œï¼‰
     */</span>
    @<span class="hljs-selector-tag">Bean</span>(name = <span class="hljs-string">"slaveDataSource"</span>)
    @<span class="hljs-selector-tag">ConfigurationProperties</span>(prefix = <span class="hljs-string">"spring.datasource.slave"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">DataSource</span> <span class="hljs-selector-tag">slaveDataSource</span>() {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">DataSourceBuilder</span><span class="hljs-selector-class">.create</span>()<span class="hljs-selector-class">.build</span>();
    }
    
    <span class="hljs-comment">/**
     * åŠ¨æ€è·¯ç”±æ•°æ®æºï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼Œä½œä¸ºä¸»æ•°æ®æºï¼‰
     */</span>
    @<span class="hljs-selector-tag">Primary</span>
    @<span class="hljs-selector-tag">Bean</span>(name = <span class="hljs-string">"routingDataSource"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">DataSource</span> <span class="hljs-selector-tag">routingDataSource</span>(
            <span class="hljs-variable">@Qualifier</span>(<span class="hljs-string">"masterDataSource"</span>) DataSource masterDataSource,
            <span class="hljs-variable">@Qualifier</span>(<span class="hljs-string">"slaveDataSource"</span>) DataSource slaveDataSource) {
        
        <span class="hljs-selector-tag">DynamicRoutingDataSource</span> <span class="hljs-selector-tag">routingDataSource</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">DynamicRoutingDataSource</span>();
        
        <span class="hljs-comment">// é…ç½®ç›®æ ‡æ•°æ®æºæ˜ å°„</span>
        <span class="hljs-selector-tag">Map</span>&lt;<span class="hljs-selector-tag">Object</span>, <span class="hljs-selector-tag">Object</span>&gt; <span class="hljs-selector-tag">targetDataSources</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">HashMap</span>&lt;&gt;();
        <span class="hljs-selector-tag">targetDataSources</span><span class="hljs-selector-class">.put</span>(DataSourceType.MASTER, masterDataSource);
        <span class="hljs-selector-tag">targetDataSources</span><span class="hljs-selector-class">.put</span>(DataSourceType.SLAVE, slaveDataSource);
        
        <span class="hljs-selector-tag">routingDataSource</span><span class="hljs-selector-class">.setTargetDataSources</span>(targetDataSources);
        <span class="hljs-selector-tag">routingDataSource</span><span class="hljs-selector-class">.setDefaultTargetDataSource</span>(masterDataSource); <span class="hljs-comment">// é»˜è®¤ä½¿ç”¨ä¸»åº“</span>
        
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">routingDataSource</span>;
    }
    
    <span class="hljs-comment">/**
     * å®ä½“ç®¡ç†å™¨å·¥å‚
     */</span>
    @<span class="hljs-selector-tag">Bean</span>(name = <span class="hljs-string">"entityManagerFactory"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">LocalContainerEntityManagerFactoryBean</span> <span class="hljs-selector-tag">entityManagerFactory</span>(
            EntityManagerFactoryBuilder builder, 
            <span class="hljs-variable">@Qualifier</span>(<span class="hljs-string">"routingDataSource"</span>) DataSource dataSource) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">builder</span>
            <span class="hljs-selector-class">.dataSource</span>(dataSource)
            <span class="hljs-selector-class">.packages</span>(<span class="hljs-string">"com.example.entity"</span>)
            <span class="hljs-selector-class">.persistenceUnit</span>(<span class="hljs-string">"mysqlUnit"</span>)
            <span class="hljs-selector-class">.build</span>();
    }
    
    <span class="hljs-comment">/**
     * äº‹åŠ¡ç®¡ç†å™¨
     */</span>
    @<span class="hljs-selector-tag">Bean</span>(name = <span class="hljs-string">"transactionManager"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">PlatformTransactionManager</span> <span class="hljs-selector-tag">transactionManager</span>(
            <span class="hljs-variable">@Qualifier</span>(<span class="hljs-string">"entityManagerFactory"</span>) EntityManagerFactory entityManagerFactory) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">JpaTransactionManager</span>(entityManagerFactory);
    }
}
</code></pre>
<h3 data-id="heading-8">6. AOPåˆ‡é¢å®ç°è‡ªåŠ¨è·¯ç”±</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æ•°æ®æºåˆ‡é¢é…ç½®ï¼ˆåŸºäºAOPè‡ªåŠ¨åˆ‡æ¢æ•°æ®æºï¼‰
 * é€šè¿‡æ–¹æ³•åè‡ªåŠ¨è¯†åˆ«è¯»å†™æ“ä½œï¼Œå®ç°æ•°æ®æºåŠ¨æ€è·¯ç”±
 */</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Order(1)</span> <span class="hljs-comment">// ç¡®ä¿åœ¨äº‹åŠ¡åˆ‡é¢ä¹‹å‰æ‰§è¡Œ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataSourceAspect</span> {
    
    <span class="hljs-comment">/**
     * å†™æ“ä½œåˆ‡ç‚¹ï¼ˆinsertã€updateã€deleteã€saveå¼€å¤´çš„æ–¹æ³•ï¼‰
     */</span>
    <span class="hljs-meta">@Before("execution(* com.example.service..*.create*(..)) || " +
            "execution(* com.example.service..*.update*(..)) || " +
            "execution(* com.example.service..*.delete*(..)) || " +
            "execution(* com.example.service..*.save*(..))")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setWriteDataSourceType</span><span class="hljs-params">()</span> {
        DataSourceContextHolder.setDataSourceType(DataSourceType.MASTER);
        System.out.println(<span class="hljs-string">"åˆ‡æ¢åˆ°ä¸»åº“ï¼ˆå†™æ“ä½œï¼‰"</span>);
    }
    
    <span class="hljs-comment">/**
     * è¯»æ“ä½œåˆ‡ç‚¹ï¼ˆselectã€getã€findã€queryå¼€å¤´çš„æ–¹æ³•ï¼‰
     */</span>
    <span class="hljs-meta">@Before("execution(* com.example.service..*.select*(..)) || " +
            "execution(* com.example.service..*.get*(..)) || " +
            "execution(* com.example.service..*.find*(..)) || " +
            "execution(* com.example.service..*.query*(..))")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setReadDataSourceType</span><span class="hljs-params">()</span> {
        DataSourceContextHolder.setDataSourceType(DataSourceType.SLAVE);
        System.out.println(<span class="hljs-string">"åˆ‡æ¢åˆ°ä»åº“ï¼ˆè¯»æ“ä½œï¼‰"</span>);
    }
    
    <span class="hljs-comment">/**
     * åç½®å¤„ç†ï¼šæ¸…ç†æ•°æ®æºä¸Šä¸‹æ–‡
     */</span>
    <span class="hljs-meta">@After("execution(* com.example.service..*.*(..))")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clearDataSourceType</span><span class="hljs-params">()</span> {
        DataSourceContextHolder.clearDataSourceType();
        System.out.println(<span class="hljs-string">"æ¸…ç†æ•°æ®æºä¸Šä¸‹æ–‡"</span>);
    }
}
</code></pre>
<h3 data-id="heading-9">7. ä¸šåŠ¡å±‚ä½¿ç”¨ç¤ºä¾‹</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * ç”¨æˆ·æœåŠ¡å®ç°ç±»
 * æ¼”ç¤ºè¯»å†™åˆ†ç¦»çš„å®é™…åº”ç”¨
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">UserRepository</span> userRepository;
    
    <span class="hljs-comment">/**
     * æ–°å¢ç”¨æˆ·ï¼ˆå†™æ“ä½œè‡ªåŠ¨è·¯ç”±åˆ°ä¸»åº“ï¼‰
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">User</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params">User user</span>) {
        <span class="hljs-comment">// æ–¹æ³•åä»¥"create"å¼€å¤´ï¼ŒAOPä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°MASTERæ•°æ®æº</span>
        <span class="hljs-keyword">return</span> userRepository.<span class="hljs-title function_">save</span>(user);
    }
    
    <span class="hljs-comment">/**
     * æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·ï¼ˆè¯»æ“ä½œè‡ªåŠ¨è·¯ç”±åˆ°ä»åº“ï¼‰
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@Transactional</span>(readOnly = <span class="hljs-literal">true</span>) <span class="hljs-comment">// åªè¯»äº‹åŠ¡ä¼˜åŒ–æ€§èƒ½</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">User</span> <span class="hljs-title function_">getUserById</span>(<span class="hljs-params">Long id</span>) {
        <span class="hljs-comment">// æ–¹æ³•åä»¥"get"å¼€å¤´ï¼ŒAOPä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°SLAVEæ•°æ®æº</span>
        <span class="hljs-keyword">return</span> userRepository.<span class="hljs-title function_">findById</span>(id).<span class="hljs-title function_">orElse</span>(<span class="hljs-literal">null</span>);
    }
    
    <span class="hljs-comment">/**
     * æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ï¼ˆè¯»æ“ä½œï¼‰
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@Transactional</span>(readOnly = <span class="hljs-literal">true</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">User</span>&gt; <span class="hljs-title function_">getAllUsers</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> userRepository.<span class="hljs-title function_">findAll</span>();
    }
    
    <span class="hljs-comment">/**
     * æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼ˆå†™æ“ä½œï¼‰
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">User</span> <span class="hljs-title function_">updateUser</span>(<span class="hljs-params">User user</span>) {
        <span class="hljs-keyword">return</span> userRepository.<span class="hljs-title function_">save</span>(user);
    }
}
</code></pre>
<h2 data-id="heading-10">ğŸ” æµ‹è¯•ä¸éªŒè¯</h2>
<h3 data-id="heading-11">å•å…ƒæµ‹è¯•ç±»</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/**
 * è¯»å†™åˆ†ç¦»æµ‹è¯•ç±»
 */</span>
<span class="hljs-keyword">@SpringBootTest</span>
class ReadWriteSeparationTest {
    
    <span class="hljs-keyword">@Autowired</span>
    private UserService userService;
    
    <span class="hljs-comment">/**
     * æµ‹è¯•å†™æ“ä½œï¼ˆåº”è·¯ç”±åˆ°ä¸»åº“ï¼‰
     */</span>
    <span class="hljs-keyword">@Test</span>
    void testWriteOperation() {
        User user = new <span class="hljs-built_in">User</span>();
        user<span class="hljs-selector-class">.setUsername</span>("testUser");
        user<span class="hljs-selector-class">.setPassword</span>("password");
        
        User savedUser = userService<span class="hljs-selector-class">.createUser</span>(user);
        
        Assertions<span class="hljs-selector-class">.assertNotNull</span>(savedUser.getId());
        System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("å†™æ“ä½œæµ‹è¯•é€šè¿‡ï¼ˆè·¯ç”±åˆ°ä¸»åº“ï¼‰");
    }
    
    <span class="hljs-comment">/**
     * æµ‹è¯•è¯»æ“ä½œï¼ˆåº”è·¯ç”±åˆ°ä»åº“ï¼‰
     */</span>
    <span class="hljs-keyword">@Test</span>
    void testReadOperation() {
        List&lt;User&gt; users = userService<span class="hljs-selector-class">.getAllUsers</span>();
        
        Assertions<span class="hljs-selector-class">.assertNotNull</span>(users);
        System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("è¯»æ“ä½œæµ‹è¯•é€šè¿‡ï¼ˆè·¯ç”±åˆ°ä»åº“ï¼‰");
    }
    
    <span class="hljs-comment">/**
     * æµ‹è¯•è¯»å†™æ··åˆæ“ä½œ
     */</span>
    <span class="hljs-keyword">@Test</span>
    void testReadWriteMix() {
        <span class="hljs-comment">// å†™æ“ä½œ</span>
        User user = new <span class="hljs-built_in">User</span>();
        user<span class="hljs-selector-class">.setUsername</span>("mixUser");
        userService<span class="hljs-selector-class">.createUser</span>(user);
        
        <span class="hljs-comment">// è¯»æ“ä½œ</span>
        User foundUser = userService<span class="hljs-selector-class">.getUserById</span>(<span class="hljs-number">1</span>L);
        
        Assertions<span class="hljs-selector-class">.assertNotNull</span>(foundUser);
        System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("è¯»å†™æ··åˆæ“ä½œæµ‹è¯•é€šè¿‡");
    }
}
</code></pre>
<h2 data-id="heading-12">âš ï¸ å…³é”®æ³¨æ„äº‹é¡¹</h2>
<h3 data-id="heading-13">1. ä¸»ä»åŒæ­¥å»¶è¿Ÿå¤„ç†</h3>
<p>åœ¨è¯»å†™åˆ†ç¦»æ¶æ„ä¸­ï¼Œä¸»ä»åŒæ­¥å­˜åœ¨å»¶è¿Ÿå¯èƒ½æ€§ã€‚åˆšå†™å…¥ä¸»åº“çš„æ•°æ®å¯èƒ½ä¸ä¼šç«‹å³åœ¨ä»åº“ä¸­å¯ç”¨ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/**
 * å¼ºåˆ¶è¯»ä¸»åº“çš„åœºæ™¯
 */</span>
<span class="hljs-keyword">@Service</span>
public class CriticalService {
    
    <span class="hljs-keyword">@Autowired</span>
    private UserRepository userRepository;
    
    <span class="hljs-comment">/**
     * é‡è¦ä¸šåŠ¡ï¼šå†™å…¥åç«‹å³è¯»å–ï¼Œå¼ºåˆ¶èµ°ä¸»åº“
     */</span>
    public User <span class="hljs-built_in">createAndGetUser</span>(User user) {
        <span class="hljs-comment">// å†™å…¥ä¸»åº“</span>
        User savedUser = userRepository<span class="hljs-selector-class">.save</span>(user);
        
        <span class="hljs-comment">// å¼ºåˆ¶ä»ä¸»åº“è¯»å–ï¼ˆé¿å…åŒæ­¥å»¶è¿Ÿï¼‰</span>
        DataSourceContextHolder<span class="hljs-selector-class">.setDataSourceType</span>(DataSourceType.MASTER);
        try {
            return userRepository<span class="hljs-selector-class">.findById</span>(savedUser.getId())<span class="hljs-selector-class">.orElse</span>(null);
        } finally {
            DataSourceContextHolder<span class="hljs-selector-class">.clearDataSourceType</span>();
        }
    }
}
</code></pre>
<h3 data-id="heading-14">2. äº‹åŠ¡ä¸­çš„æ•°æ®å¤„ç†</h3>
<p>åœ¨äº‹åŠ¡ä¸­ï¼Œæ‰€æœ‰æ“ä½œåº”ä½¿ç”¨åŒä¸€æ•°æ®æºã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionalService</span> {
    
    <span class="hljs-comment">/**
     * äº‹åŠ¡å†…å¼ºåˆ¶ä½¿ç”¨ä¸»åº“
     */</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">complexBusinessOperation</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// æ–¹æ³•å¼€å§‹æ—¶æ˜¾å¼è®¾ç½®ä¸»åº“ï¼Œç¡®ä¿äº‹åŠ¡å†…ä¸€è‡´æ€§</span>
        <span class="hljs-title class_">DataSourceContextHolder</span>.<span class="hljs-title function_">setDataSourceType</span>(<span class="hljs-title class_">DataSourceType</span>.<span class="hljs-property">MASTER</span>);
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// ä¸€ç³»åˆ—æ•°æ®åº“æ“ä½œ...</span>
            <span class="hljs-comment">// æ‰€æœ‰è¿™äº›æ“ä½œéƒ½åœ¨åŒä¸€äº‹åŠ¡ä¸­ï¼Œä½¿ç”¨åŒä¸€æ•°æ®æº</span>
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// äº‹åŠ¡ç»“æŸåæ¸…ç†</span>
            <span class="hljs-title class_">DataSourceContextHolder</span>.<span class="hljs-title function_">clearDataSourceType</span>();
        }
    }
}
</code></pre>
<h2 data-id="heading-15">ğŸ“Š æ–¹æ¡ˆä¼˜ç¼ºç‚¹åˆ†æ</h2>

























<table><thead><tr><th>ä¼˜åŠ¿</th><th>æŒ‘æˆ˜</th><th>åº”å¯¹ç­–ç•¥</th></tr></thead><tbody><tr><td>æå‡è¯»æ€§èƒ½ï¼šå°†è¯»è¯·æ±‚åˆ†å‘åˆ°ä»åº“</td><td>ä¸»ä»åŒæ­¥å»¶è¿Ÿ</td><td>å…³é”®ä¸šåŠ¡å¼ºåˆ¶è¯»ä¸»åº“</td></tr><tr><td>æé«˜å¯ç”¨æ€§ï¼šä¸»åº“æ•…éšœæ—¶ä»åº“å¯è¯»</td><td>äº‹åŠ¡å†…æ•°æ®æºä¸€è‡´æ€§</td><td>äº‹åŠ¡ä¸­å¼ºåˆ¶ä½¿ç”¨ä¸»åº“</td></tr><tr><td>å‡è½»ä¸»åº“å‹åŠ›</td><td>å¤æ‚SQLè·¯ç”±</td><td>æ˜ç¡®çš„è¯»å†™æ“ä½œåˆ†ç¦»</td></tr></tbody></table>
<h2 data-id="heading-16">ğŸ’ æ€»ç»“</h2>
<p>é€šè¿‡ä»¥ä¸Šå®Œæ•´çš„Spring Boot 3å®ç°æ–¹æ¡ˆï¼Œä½ å¯ä»¥æˆåŠŸé…ç½®MySQLè¯»å†™åˆ†ç¦»ã€‚å…³é”®åœ¨äºç†è§£åŠ¨æ€æ•°æ®æºè·¯ç”±åŸç†ï¼Œåˆç†å¤„ç†ä¸»ä»åŒæ­¥å»¶è¿Ÿå’Œäº‹åŠ¡ä¸€è‡´æ€§ç­‰æŒ‘æˆ˜ã€‚è¿™ç§æ¶æ„èƒ½æ˜¾è‘—æå‡ç³»ç»Ÿæ€§èƒ½ï¼Œç‰¹åˆ«é€‚åˆè¯»å¤šå†™å°‘çš„åº”ç”¨åœºæ™¯ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Gemini CLI æ ¸å¿ƒå‘½ä»¤æŒ‡å—ï¼Œè®©å·¥ä½œä»ä»å®¹å®¹æ¸¸åˆƒæœ‰ä½™]]></title>    <link>https://juejin.cn/post/7571281406509711411</link>    <guid>https://juejin.cn/post/7571281406509711411</guid>    <pubDate>2025-11-11T09:27:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571281406509711411" data-draft-id="7571279513246826522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Gemini CLI æ ¸å¿ƒå‘½ä»¤æŒ‡å—ï¼Œè®©å·¥ä½œä»ä»å®¹å®¹æ¸¸åˆƒæœ‰ä½™"/> <meta itemprop="keywords" content="ç¨‹åºå‘˜,äººå·¥æ™ºèƒ½,AIGC"/> <meta itemprop="datePublished" content="2025-11-11T09:27:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¯¥ç”¨æˆ·å·²ä¸å­˜åœ¨"/> <meta itemprop="url" content="https://juejin.cn/user/64217584778579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Gemini CLI æ ¸å¿ƒå‘½ä»¤æŒ‡å—ï¼Œè®©å·¥ä½œä»ä»å®¹å®¹æ¸¸åˆƒæœ‰ä½™
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/64217584778579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¯¥ç”¨æˆ·å·²ä¸å­˜åœ¨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T09:27:43.000Z" title="Tue Nov 11 2025 09:27:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è®©æˆ‘çœ‹çœ‹ï¼Œè°è¿˜æ²¡æœ‰ç”¨ä¸Š Gemini CLIï¼Ÿ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbe596921c2f43609e36f51287920e31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763458062&amp;x-signature=yQQgn8QmJ6CnzmzgJVVXWln0Ppk%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p><strong>å…è´¹é¢åº¦</strong>ï¼šä¸ªäºº Google è´¦æˆ·å¯äº«å—æ¯åˆ†é’Ÿ 60 æ¬¡è¯·æ±‚çš„å…è´¹é¢åº¦ï¼Œè¶³ä»¥æ»¡è¶³æ—¥å¸¸å¼€å‘ä¸­çš„äº¤äº’éœ€æ±‚ã€‚</p>
</li>
<li>
<p><strong>å¼ºå¤§çš„æ¨¡å‹æ”¯æŒ</strong>ï¼šç”± Gemini 2.5 Pro æ¨¡å‹é©±åŠ¨ï¼Œæ‹¥æœ‰é«˜è¾¾ä¸€ç™¾ä¸‡ token çš„ä¸Šä¸‹æ–‡çª—å£ï¼Œèƒ½å¤Ÿå¤„ç†å’Œç†è§£å¤§å‹ä»£ç åº“æˆ–å¤æ‚çš„æ–‡æ¡£ã€‚</p>
</li>
<li>
<p><strong>å†…ç½®å·¥å…·é›†</strong>ï¼šé›†æˆäº†å¤šç§å®ç”¨å·¥å…·ï¼ŒåŒ…æ‹¬ä½¿ç”¨ Google æœç´¢æ¥æä¾›æœ‰æ—¶æ•ˆæ€§çš„å›ç­”ã€æ‰§è¡Œæ–‡ä»¶ç³»ç»Ÿæ“ä½œã€è¿è¡Œ shell å‘½ä»¤ä»¥åŠè·å–ç½‘é¡µå†…å®¹ã€‚</p>
</li>
<li>
<p><strong>å¯æ‰©å±•æ€§</strong>ï¼šæ”¯æŒæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆModel Context Protocol, MCPï¼‰ï¼Œä¸ºå¼€å‘è€…åˆ›å»ºè‡ªå®šä¹‰å·¥å…·é›†æˆæä¾›äº†å¯èƒ½ã€‚</p>
</li>
<li>
<p><strong>ç»ˆç«¯ä¼˜å…ˆè®¾è®¡</strong>ï¼šå®Œå…¨ä¸ºé‚£äº›ä»¥å‘½ä»¤è¡Œä½œä¸ºä¸»è¦å·¥ä½œç¯å¢ƒçš„å¼€å‘è€…é‡èº«æ‰“é€ ã€‚</p>
</li>
<li>
<p><strong>å¼€æºè®¸å¯</strong>ï¼šé¡¹ç›®åŸºäº Apache 2.0 è®¸å¯è¯å¼€æºï¼Œä¿è¯äº†å…¶é€æ˜åº¦å’Œç¤¾åŒºå‚ä¸åº¦ã€‚</p>
</li>
</ul>
<p>Gemini CLI éƒ¨ç½²èµ·æ¥ä¹Ÿå¾ˆå®¹æ˜“ï¼Œç”¨ ServBay ä¸€é”®å®‰è£…å¥½ Node.js 20æˆ–è€…æ›´é«˜çš„ç‰ˆæœ¬ï¼Œç›´æ¥é€šè¿‡<code>npm</code>å°±å¯ä»¥å®‰è£…Gemini CLIã€‚</p>
<pre><code class="hljs language-bash" lang="bash">npm install -g @google/gemini-cli
</code></pre>
<p>ä¹‹æ‰€ä»¥æ¨è ServBay ï¼Œæ˜¯å› ä¸ºå®ƒæä¾›äº†ä¸€ä¸ªéš”ç¦»çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com%2Ffeatures%2Fnodejs" target="_blank" title="https://www.servbay.com/features/nodejs" ref="nofollow noopener noreferrer">é›†æˆå¼€å‘ç¯å¢ƒ</a>ï¼Œå…è®¸å¼€å‘è€…é€šè¿‡å›¾å½¢åŒ–ç•Œé¢ä¸€é”®éƒ¨ç½²å’Œç®¡ç†åŒ…æ‹¬ Node.jsã€Rust åœ¨å†…çš„å¤šç§æœåŠ¡ã€‚è¿™ç§æ–¹å¼é¿å…äº†ä½¿ç”¨ç‰ˆæœ¬ç®¡ç†å™¨ï¼ˆå¦‚ nvmï¼‰åœ¨ç³»ç»Ÿå…¨å±€èŒƒå›´å†…é¢‘ç¹åˆ‡æ¢çš„å¤æ‚æ€§ï¼Œä¹Ÿæœç»äº†ä¼ ç»ŸåŒ…ç®¡ç†å™¨ï¼ˆå¦‚ Homebrewï¼‰å¯èƒ½å¸¦æ¥çš„ä¾èµ–æ··ä¹±ï¼Œå¹²å‡€åˆå«ç”Ÿã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6d3171396dd42e88a1fb945dc7a8b88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763458062&amp;x-signature=nDvT%2F6aoMXp7lMG234hEFhWJbDs%3D" alt="" loading="lazy"/></p>
<p>å®‰è£…å®Œæ¯•ï¼Œä¾¿å¯ä»¥å¼€å§‹æ¢ç´¢ Gemini CLI çš„åŠŸèƒ½ã€‚</p>
<h3 data-id="heading-0">åˆå§‹é…ç½®ï¼šå»ºç«‹ä¸é¡¹ç›®çš„è¿æ¥</h3>
<p>é¦–æ¬¡åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ Gemini CLIï¼Œéœ€è¦æ‰§è¡Œå‡ ä¸ªåŸºç¡€å‘½ä»¤æ¥å®Œæˆåˆå§‹åŒ–å’Œé…ç½®ã€‚</p>
<ul>
<li>
<p><strong>/initï¼š</strong> åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œæ­¤å‘½ä»¤ï¼Œæ˜¯ä¸ Gemini CLI å»ºç«‹è”ç³»çš„ç¬¬ä¸€æ­¥ã€‚å®ƒä¼šåˆ†æé¡¹ç›®ç»“æ„ï¼Œä¸ºåç»­çš„äº¤äº’æä¾›ä¸Šä¸‹æ–‡åŸºç¡€ã€‚</p>
</li>
<li>
<p><strong>/authï¼š</strong> æ­¤å‘½ä»¤ç”¨äºå¤„ç†èº«ä»½éªŒè¯ã€‚é¦–æ¬¡æ‰§è¡Œæ—¶ï¼Œå®ƒä¼šå¼•å¯¼ç”¨æˆ·å®Œæˆ Google è´¦æˆ·çš„ç™»å½•ä¸æˆæƒæµç¨‹ï¼Œç¡®ä¿ CLI æ‹¥æœ‰è®¿é—® AI æœåŠ¡çš„æƒé™ã€‚</p>
</li>
<li>
<p><strong>/aboutï¼š</strong> æŸ¥è¯¢å½“å‰ Gemini CLI çš„ç‰ˆæœ¬ã€æ‰€ä½¿ç”¨çš„åº•å±‚æ¨¡å‹ä»¥åŠé…ç½®çš„èº«ä»½éªŒè¯æ–¹æ³•ã€‚è¿™ä¸ªå‘½ä»¤æœ‰åŠ©äºäº†è§£å·¥å…·çš„å½“å‰çŠ¶æ€ã€‚</p>
</li>
<li>
<p><strong>/help</strong> &amp; <strong>/docsï¼š</strong> é‡åˆ°ç–‘é—®æ—¶ï¼Œ<code>/help</code> æä¾›äº†ä¸€ä¸ªå¿«é€Ÿçš„å‘½ä»¤åˆ—è¡¨ã€‚è€Œ <code>/docs</code> åˆ™ä¼šåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€å®˜æ–¹æ–‡æ¡£ï¼Œä¾›æŸ¥é˜…æ›´è¯¦å°½çš„ä¿¡æ¯ã€‚</p>
</li>
</ul>
<h3 data-id="heading-1">æ ¸å¿ƒåŠŸèƒ½ï¼šæ—¥å¸¸å·¥ä½œæµä¸­çš„å‘½ä»¤</h3>
<p>ç†Ÿæ‚‰åŸºæœ¬é…ç½®åï¼Œä»¥ä¸‹è¿™äº›å‘½ä»¤å°†æˆä¸ºæ—¥å¸¸å¼€å‘ä¸­çš„å¾—åŠ›å·¥å…·ã€‚</p>
<ul>
<li>
<p><strong>! (Shell å‘½ä»¤å‰ç¼€)</strong> ï¼šè¿™æ˜¯ä¸€ä¸ªæä¸ºå®ç”¨çš„åŠŸèƒ½ã€‚åœ¨è¾“å…¥æ¡†ä¸­ä»¥ <code>!</code> å¼€å¤´ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œ shell å‘½ä»¤ã€‚æ›´è¿›ä¸€æ­¥ï¼Œå¯ä»¥ç»“åˆè‡ªç„¶è¯­è¨€è®© Gemini è§£é‡Šæˆ–ç”Ÿæˆå‘½ä»¤ï¼Œè¿™å¯¹äºå¤„ç†é‚£äº›å¤æ‚æˆ–ä¸å¸¸ç”¨çš„å‘½ä»¤å°¤ä¸ºæœ‰æ•ˆã€‚</p>
</li>
<li>
<p><strong>/toolsï¼š</strong> æ‰§è¡Œæ­¤å‘½ä»¤å¯ä»¥åˆ—å‡º Gemini å½“å‰å¯ç”¨çš„æ‰€æœ‰å·¥å…·é›†ã€‚äº†è§£å…¶èƒ½åŠ›è¾¹ç•Œï¼Œæœ‰åŠ©äºæå‡ºæ›´ç²¾å‡†ã€æ›´æœ‰æ•ˆçš„é—®é¢˜ã€‚</p>
</li>
<li>
<p><strong>/editor</strong>ï¼šå¯¹äºéœ€è¦è¾“å…¥å¤§æ®µä»£ç æˆ–å¤æ‚é—®é¢˜çš„åœºæ™¯ï¼Œç»ˆç«¯çš„å•è¡Œè¾“å…¥æ¡†æ˜¾å¾—æ‰è¥Ÿè§è‚˜ã€‚é€šè¿‡ <code>/editor</code> å‘½ä»¤é…ç½®ä¸€ä¸ªå¤–éƒ¨æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆå¦‚ VS Code æˆ– Vimï¼‰ï¼Œä¹‹åä½¿ç”¨ <code>Ctrl+X</code> å¿«æ·é”®å³å¯åœ¨ç†Ÿæ‚‰çš„ç¯å¢ƒä¸­ç¼–å†™æç¤ºï¼Œå®Œæˆåä¿å­˜é€€å‡ºï¼Œå†…å®¹ä¾¿ä¼šè‡ªåŠ¨å‘é€ã€‚</p>
</li>
</ul>
<h3 data-id="heading-2">ä¼šè¯ç®¡ç†ï¼šä¿å­˜ä¸è¿½æº¯æ€è·¯</h3>
<p>ä¸ Gemini çš„äº¤äº’æ˜¯ä¸€ä¸ªè¿ç»­çš„å¯¹è¯è¿‡ç¨‹ï¼Œä¿ç•™è¿™äº›ä¸Šä¸‹æ–‡å¯¹äºè§£å†³å¤æ‚é—®é¢˜éå¸¸æœ‰ä»·å€¼ã€‚</p>
<ul>
<li>
<p><strong>/chat</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ä¼šè¯ç®¡ç†å‘½ä»¤ã€‚ä½¿ç”¨ <code>/chat save &lt;name&gt;</code> å¯ä»¥å°†å½“å‰çš„å¯¹è¯ä¿å­˜ä¸‹æ¥ï¼Œä»¥ä¾¿æ—¥åé€šè¿‡ <code>/chat resume &lt;name&gt;</code> ç»§ç»­ã€‚å®ƒè¿˜æ”¯æŒ <code>list</code> å’Œ <code>delete</code> ç­‰æ“ä½œæ¥ç®¡ç†æ‰€æœ‰å·²ä¿å­˜çš„ä¼šè¯ã€‚</p>
</li>
<li>
<p><strong>/clear</strong>ï¼šå½“éœ€è¦å¼€å§‹ä¸€ä¸ªå…¨æ–°çš„è¯é¢˜æ—¶ï¼Œæ­¤å‘½ä»¤å¯ä»¥æ¸…ç©ºå½“å‰çš„å¯¹è¯å†å²å’Œå±å¹•ï¼Œæä¾›ä¸€ä¸ªå¹²å‡€çš„äº¤äº’ç•Œé¢ã€‚</p>
</li>
</ul>
<h3 data-id="heading-3">å®é™…åº”ç”¨åœºæ™¯</h3>
<p>ä¸‹é¢é€šè¿‡å‡ ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œå±•ç¤º Gemini CLI åœ¨å®é™…å·¥ä½œä¸­çš„åº”ç”¨ã€‚</p>
<h4 data-id="heading-4"><strong>ä»£ç é‡æ„å»ºè®®</strong></h4>
<p>å‡è®¾æœ‰ä¸€ä¸ªç”¨äºæ•°æ®éªŒè¯çš„å‡½æ•°ï¼Œå…¶é€»è¾‘è™½ç„¶æ­£ç¡®ä½†ä¸å¤Ÿç®€æ´ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// file: validation.js</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">checkUserAccess</span>(<span class="hljs-params">userObject</span>) {
  <span class="hljs-keyword">if</span> (userObject &amp;&amp; userObject.<span class="hljs-property">isActive</span> &amp;&amp; userObject.<span class="hljs-property">permissions</span>.<span class="hljs-property">level</span> &gt; <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<p>å¯ä»¥å‘ Gemini CLI æå‡ºè¯·æ±‚ï¼š</p>
<p><code>@validation.js Please refactor the checkUserAccess function to be more concise.</code></p>
<p>Gemini å¯èƒ½ä¼šè¿”å›ä¸€ä¸ªæ›´ç²¾ç‚¼çš„ç‰ˆæœ¬ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// Suggested refactoring
const <span class="hljs-attr">checkUserAccess</span> = (userObject) =&gt;
  !!userObject &amp;&amp; userObject.isActive &amp;&amp; userObject.permissions.level &gt; 1<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-5"><strong>ç”Ÿæˆ Git æäº¤ä¿¡æ¯</strong></h4>
<p>ç¼–å†™è§„èŒƒçš„ Git commit message æ˜¯ä¸€é¡¹è€—æ—¶çš„ä»»åŠ¡ã€‚å¯ä»¥å€ŸåŠ© Gemini CLI è‡ªåŠ¨åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚é¦–å…ˆï¼ŒæŸ¥çœ‹æš‚å­˜åŒºçš„ä»£ç å˜æ›´ï¼š</p>
<p><code>!git diff --staged</code></p>
<p>ç„¶åï¼ŒåŸºäºè¿™äº›å˜æ›´è¯·æ±‚ç”Ÿæˆæäº¤ä¿¡æ¯ï¼š</p>
<p><code>From the diff above, write a Conventional Commit message.</code></p>
<p>è¿™å°†äº§å‡ºä¸€æ¡æ ¼å¼è‰¯å¥½ã€å†…å®¹å‡†ç¡®çš„æäº¤ä¿¡æ¯ï¼Œå¤§å¤§èŠ‚çœäº†æ€è€ƒå’Œæ’°å†™çš„æ—¶é—´ã€‚</p>
<h4 data-id="heading-6"><strong>è§£é‡Šå¤æ‚çš„ Shell å‘½ä»¤</strong></h4>
<p>å½“é‡åˆ°ä¸€æ®µä»ç½‘ç»œä¸Šå¤åˆ¶çš„ã€ä¸ç”šæ˜äº†çš„ shell å‘½ä»¤æ—¶ï¼Œç›´æ¥è¿è¡Œå­˜åœ¨é£é™©ã€‚å¯ä»¥è®© Gemini å…ˆè¡Œè§£é‡Šã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin">&gt; Explain <span class="hljs-keyword">this</span> command: awk -F<span class="hljs-string">','</span> <span class="hljs-string">'{print $1, $3}'</span> <span class="hljs-keyword">data</span>.csv
</code></pre>
<p>Gemini ä¼šæä¾›ä¸€ä¸ªæ¸…æ™°çš„é€æ®µè§£é‡Šï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">âœ¦ Certainly. This command uses `awk` <span class="hljs-keyword">to</span> process a CSV file. Here <span class="hljs-built_in">is</span> a breakdown:

  * `awk`: This <span class="hljs-built_in">is</span> the command-line utility being invoked, designed <span class="hljs-keyword">for</span> <span class="hljs-keyword">text</span> processing.
  * `-F<span class="hljs-comment">','`: The `-F` option sets the field separator. Here, it's set to a comma (`,`), which means `awk` will treat each line as a series of comma-separated fields.</span>
  * `<span class="hljs-comment">'{print $1, $3}'`: This is the action `awk` will perform on each line of the input. It instructs `awk` to print the first field (`$1`) followed by a space, and then the third field (`$3`).</span>
  * `data.csv`: This <span class="hljs-built_in">is</span> the input file <span class="hljs-keyword">for</span> the command.

  <span class="hljs-keyword">In</span> summary, the command reads the `data.csv` file, splits <span class="hljs-keyword">each</span> line <span class="hljs-keyword">by</span> commas, <span class="hljs-built_in">and</span> prints the first <span class="hljs-built_in">and</span> third columns <span class="hljs-keyword">from</span> <span class="hljs-keyword">each</span> line <span class="hljs-keyword">to</span> the standard output.
</code></pre>
<h3 data-id="heading-7">ç»“è¯­</h3>
<p>å°† Gemini CLI é›†æˆåˆ°å¼€å‘å·¥ä½œæµä¸­ï¼Œè®©ä½ çš„å¼€å‘å·¥ä½œä»ä»å®¹å®¹æ¸¸åˆƒæœ‰ä½™ã€‚ä½¿ç”¨ ServBay æ­å»ºä¸€ä¸ªå¯é çš„è¿è¡Œç¯å¢ƒå¼€å§‹ï¼Œåˆ°ç†Ÿç»ƒè¿ç”¨å…¶æ ¸å¿ƒå‘½ä»¤è§£å†³ç¼–ç ã€ä»£ç ç®¡ç†å’Œç³»ç»Ÿæ“ä½œä¸­çš„å®é™…é—®é¢˜ï¼Œå¼€å‘è€…å¯ä»¥è·å¾—æ›´æµç•…ã€æ›´ä¸“æ³¨çš„å·¥ä½œä½“éªŒã€‚æŒæ¡è¿™äº›å·¥å…·ï¼Œä½ å°±ä¸ä¼šåŒ†åŒ†å¿™å¿™è¿æ»šå¸¦çˆ¬ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é™¤äº†AOPåˆ‡é¢ï¼Œè¿˜æœ‰å“ªäº›æ›´çµæ´»çš„æ•°æ®æºåˆ‡æ¢ç­–ç•¥ï¼Ÿæ¯”å¦‚åŸºäºæ³¨è§£æˆ–è‡ªå®šä¹‰è·¯ç”±è§„åˆ™]]></title>    <link>https://juejin.cn/post/7571299394345680938</link>    <guid>https://juejin.cn/post/7571299394345680938</guid>    <pubDate>2025-11-11T13:41:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571299394345680938" data-draft-id="7571306072422809642" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é™¤äº†AOPåˆ‡é¢ï¼Œè¿˜æœ‰å“ªäº›æ›´çµæ´»çš„æ•°æ®æºåˆ‡æ¢ç­–ç•¥ï¼Ÿæ¯”å¦‚åŸºäºæ³¨è§£æˆ–è‡ªå®šä¹‰è·¯ç”±è§„åˆ™"/> <meta itemprop="keywords" content="åç«¯,æ•°æ®åº“"/> <meta itemprop="datePublished" content="2025-11-11T13:41:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ITæ©˜å­çš®"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é™¤äº†AOPåˆ‡é¢ï¼Œè¿˜æœ‰å“ªäº›æ›´çµæ´»çš„æ•°æ®æºåˆ‡æ¢ç­–ç•¥ï¼Ÿæ¯”å¦‚åŸºäºæ³¨è§£æˆ–è‡ªå®šä¹‰è·¯ç”±è§„åˆ™
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ITæ©˜å­çš®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T13:41:13.000Z" title="Tue Nov 11 2025 13:41:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨Spring Bootä¸­å®ç°æ•°æ®æºåˆ‡æ¢ï¼Œé™¤äº†AOPåˆ‡é¢ï¼Œè¿˜æœ‰å‡ ç§éå¸¸çµæ´»çš„ç­–ç•¥ã€‚ä¸‹é¢æˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼å¯¹æ¯”å„ç§æ–¹æ¡ˆï¼Œç„¶åé‡ç‚¹ä»‹ç»ä¸¤ç§æœ€å®ç”¨çš„æ–¹æ³•ï¼š</p>








































<table><thead><tr><th>ç­–ç•¥ç±»å‹</th><th>å®ç°æ–¹å¼</th><th>çµæ´»æ€§</th><th>ä»£ç ä¾µå…¥æ€§</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>æ³¨è§£é©±åŠ¨</strong></td><td>ä½¿ç”¨<code>@DS</code>ç­‰æ³¨è§£æ ‡è®°æ–¹æ³•/ç±»</td><td>é«˜</td><td>ä½</td><td>ç²¾ç¡®åˆ°æ–¹æ³•çº§åˆ«çš„æ•°æ®æºæ§åˆ¶</td></tr><tr><td><strong>æ‰‹åŠ¨ç¼–ç¨‹</strong></td><td>åœ¨ä»£ç ä¸­è°ƒç”¨APIåŠ¨æ€åˆ‡æ¢</td><td>æœ€é«˜</td><td>é«˜</td><td>å¤æ‚ä¸šåŠ¡é€»è¾‘ã€åŒä¸€æ–¹æ³•å†…å¤šæ•°æ®æº</td></tr><tr><td><strong>è¯·æ±‚ç‰¹å¾è·¯ç”±</strong></td><td>åŸºäºHTTPå¤´ã€å‚æ•°ç­‰è‡ªåŠ¨è·¯ç”±</td><td>ä¸­é«˜</td><td>ä½</td><td>å¤šç§Ÿæˆ·ã€æŒ‰å®¢æˆ·åˆ†åº“ç­‰åœºæ™¯</td></tr><tr><td><strong>æ–¹æ³•è§„åˆ™è·¯ç”±</strong></td><td>åŸºäºæ–¹æ³•åçº¦å®šè‡ªåŠ¨åˆ‡æ¢</td><td>ä¸­</td><td>ä½</td><td>æœ‰å›ºå®šå‘½åè§„èŒƒçš„è¯»å†™åˆ†ç¦»</td></tr></tbody></table>
<h2 data-id="heading-0">ğŸ” æ³¨è§£é©±åŠ¨åˆ‡æ¢</h2>
<p>è¿™æ˜¯ç›®å‰<strong>æœ€æµè¡Œä¸”ä¼˜é›…</strong>çš„æ–¹æ¡ˆï¼ŒMyBatis-Plusçš„åŠ¨æ€æ•°æ®æºç»„ä»¶æä¾›äº†å¼€ç®±å³ç”¨çš„æ”¯æŒã€‚</p>
<h3 data-id="heading-1">é…ç½®ä¾èµ–</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
-   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dynamic-datasource-spring-boot3-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
-   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-2">é…ç½®æ–‡ä»¶</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">dynamic:</span>
      <span class="hljs-attr">primary:</span> <span class="hljs-string">master</span>  <span class="hljs-comment"># é»˜è®¤æ•°æ®æº</span>
      <span class="hljs-attr">strict:</span> <span class="hljs-literal">false</span>    <span class="hljs-comment"># æ˜¯å¦ä¸¥æ ¼åŒ¹é…æ•°æ®æº</span>
      <span class="hljs-attr">datasource:</span>
        <span class="hljs-attr">master:</span>
          <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/master</span>
          <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
          <span class="hljs-attr">password:</span> <span class="hljs-string">master_password</span>
        <span class="hljs-attr">slave:</span>
          <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/slave</span>
          <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
          <span class="hljs-attr">password:</span> <span class="hljs-string">slave_password</span>
</code></pre>
<h3 data-id="heading-3">ä½¿ç”¨@DSæ³¨è§£</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-comment">// é»˜è®¤ä½¿ç”¨ä¸»åº“ï¼ˆå†™æ“ä½œï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params">User user</span>) {
        userMapper.<span class="hljs-title function_">insert</span>(user);
    }
    
    <span class="hljs-comment">// æ˜¾å¼æŒ‡å®šä»åº“ï¼ˆè¯»æ“ä½œï¼‰</span>
    <span class="hljs-meta">@DS</span>(<span class="hljs-string">"slave"</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">User</span> <span class="hljs-title function_">getUserById</span>(<span class="hljs-params">Long id</span>) {
        <span class="hljs-keyword">return</span> userMapper.<span class="hljs-title function_">selectById</span>(id);
    }
    
    <span class="hljs-comment">// åœ¨Mapperå±‚ç›´æ¥æŒ‡å®šæ•°æ®æº</span>
    <span class="hljs-meta">@DS</span>(<span class="hljs-string">"slave"</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">User</span>&gt; <span class="hljs-title function_">findActiveUsers</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> userMapper.<span class="hljs-title function_">selectActiveUsers</span>();
    }
}
</code></pre>
<p><strong>ä¼˜ç‚¹</strong>ï¼šå£°æ˜å¼é…ç½®ï¼Œä»£ç ä¾µå…¥æ€§ä½ï¼Œæ”¯æŒç±»çº§åˆ«å’Œæ–¹æ³•çº§åˆ«çš„ç²¾ç»†æ§åˆ¶ã€‚</p>
<h2 data-id="heading-4">âš™ï¸ æ‰‹åŠ¨ç¼–ç¨‹åˆ‡æ¢</h2>
<p>å¯¹äºéœ€è¦<strong>åœ¨åŒä¸€æ–¹æ³•å†…ä½¿ç”¨å¤šä¸ªæ•°æ®æº</strong>çš„å¤æ‚åœºæ™¯ï¼Œæ‰‹åŠ¨æ§åˆ¶æä¾›äº†æœ€å¤§çµæ´»æ€§ã€‚</p>
<h3 data-id="heading-5">åŸºæœ¬APIä½¿ç”¨</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processOrder</span><span class="hljs-params">(Long orderId)</span> {
        <span class="hljs-comment">// ç¬¬ä¸€é˜¶æ®µï¼šä»ä¸»åº“è¯»å–è®¢å•</span>
        DynamicDataSourceContextHolder.push(<span class="hljs-string">"master"</span>);
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderMapper.selectById(orderId);
            <span class="hljs-comment">// ä¸šåŠ¡å¤„ç†...</span>
        } <span class="hljs-keyword">finally</span> {
            DynamicDataSourceContextHolder.poll();
        }
        
        <span class="hljs-comment">// ç¬¬äºŒé˜¶æ®µï¼šå†™å…¥ä»åº“è¿›è¡Œæ•°æ®åˆ†æ</span>
        DynamicDataSourceContextHolder.push(<span class="hljs-string">"slave"</span>);
        <span class="hljs-keyword">try</span> {
            analysisMapper.insertOrderAnalysis(order);
        } <span class="hljs-keyword">finally</span> {
            DynamicDataSourceContextHolder.poll();
        }
    }
}
</code></pre>
<h3 data-id="heading-6">åŸºäºHTTPè¯·æ±‚çš„è‡ªåŠ¨åˆ‡æ¢</h3>
<p>é€šè¿‡è¿‡æ»¤å™¨æˆ–æ‹¦æˆªå™¨å®ç°åŸºäºè¯·æ±‚ç‰¹å¾çš„è·¯ç”±ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@WebFilter</span>(urlPatterns = <span class="hljs-string">"/*"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataSourceFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">doFilter</span>(<span class="hljs-title class_">ServletRequest</span> request, <span class="hljs-title class_">ServletResponse</span> response, 
                         <span class="hljs-title class_">FilterChain</span> chain) throws <span class="hljs-title class_">IOException</span>, <span class="hljs-title class_">ServletException</span> {
        <span class="hljs-title class_">HttpServletRequest</span> httpRequest = (<span class="hljs-title class_">HttpServletRequest</span>) request;
        
        <span class="hljs-comment">// ä»è¯·æ±‚å¤´è·å–æ•°æ®æºæ ‡è¯†ï¼ˆå¦‚å¤šç§Ÿæˆ·åœºæ™¯ï¼‰</span>
        <span class="hljs-title class_">String</span> tenantId = httpRequest.<span class="hljs-title function_">getHeader</span>(<span class="hljs-string">"X-Tenant-Id"</span>);
        <span class="hljs-comment">// æˆ–ä»è¯·æ±‚å‚æ•°åˆ¤æ–­ä¸šåŠ¡ç±»å‹</span>
        <span class="hljs-title class_">String</span> businessType = httpRequest.<span class="hljs-title function_">getParameter</span>(<span class="hljs-string">"bizType"</span>);
        
        <span class="hljs-title class_">String</span> dataSourceKey = <span class="hljs-title function_">determineDataSource</span>(tenantId, businessType);
        
        <span class="hljs-title class_">DynamicDataSourceContextHolder</span>.<span class="hljs-title function_">push</span>(dataSourceKey);
        <span class="hljs-keyword">try</span> {
            chain.<span class="hljs-title function_">doFilter</span>(request, response);
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-title class_">DynamicDataSourceContextHolder</span>.<span class="hljs-title function_">poll</span>();
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">determineDataSource</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> tenantId, <span class="hljs-built_in">String</span> businessType</span>) {
        <span class="hljs-comment">// å¤æ‚çš„è·¯ç”±é€»è¾‘</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"report"</span>.<span class="hljs-title function_">equals</span>(businessType)) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"report_db"</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tenantId != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"tenant_"</span> + tenantId;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">"master"</span>; <span class="hljs-comment">// é»˜è®¤æ•°æ®æº</span>
    }
}
</code></pre>
<h2 data-id="heading-7">ğŸ§  è‡ªå®šä¹‰è·¯ç”±è§„åˆ™</h2>
<p>é€šè¿‡ç»§æ‰¿<code>AbstractRoutingDataSource</code>å¹¶é‡å†™<code>determineCurrentLookupKey()</code>æ–¹æ³•ï¼Œå¯ä»¥å®ç°åŸºäº<strong>ä¸šåŠ¡é€»è¾‘çš„å¤æ‚è·¯ç”±</strong>ã€‚</p>
<h3 data-id="heading-8">åŸºäºæ–¹æ³•åçš„è·¯ç”±ç¤ºä¾‹</h3>
<pre><code class="hljs language-scala" lang="scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BusinessRoutingDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractRoutingDataSource</span> </span>{
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-type">Object</span> determineCurrentLookupKey() {
        <span class="hljs-comment">// è·å–å½“å‰æ–¹æ³•åè¿›è¡Œè·¯ç”±å†³ç­–</span>
        <span class="hljs-type">String</span> methodName = getCurrentMethodName();
        
        <span class="hljs-keyword">if</span> (methodName.startsWith(<span class="hljs-string">"find"</span>) || methodName.startsWith(<span class="hljs-string">"query"</span>) 
            || methodName.startsWith(<span class="hljs-string">"select"</span>) || methodName.startsWith(<span class="hljs-string">"get"</span>)) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"slave"</span>; <span class="hljs-comment">// è¯»æ“ä½œè·¯ç”±åˆ°ä»åº“</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (methodName.startsWith(<span class="hljs-string">"insert"</span>) || methodName.startsWith(<span class="hljs-string">"update"</span>) 
                 || methodName.startsWith(<span class="hljs-string">"delete"</span>) || methodName.startsWith(<span class="hljs-string">"save"</span>)) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"master"</span>; <span class="hljs-comment">// å†™æ“ä½œè·¯ç”±åˆ°ä¸»åº“</span>
        }
        
        <span class="hljs-comment">// é»˜è®¤è·¯ç”±ç­–ç•¥</span>
        <span class="hljs-keyword">return</span> isReadOperation(methodName) ? <span class="hljs-string">"slave"</span> : <span class="hljs-string">"master"</span>;
    }
}
</code></pre>
<h3 data-id="heading-9">åŸºäºå‚æ•°å€¼çš„è·¯ç”±</h3>
<pre><code class="hljs language-scala" lang="scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ParameterBasedRouter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractRoutingDataSource</span> </span>{
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-type">Object</span> determineCurrentLookupKey() {
        <span class="hljs-comment">// ä»çº¿ç¨‹ä¸Šä¸‹æ–‡æˆ–å‚æ•°ä¸­è·å–è·¯ç”±ä¿¡æ¯</span>
        <span class="hljs-type">String</span> businessUnit = <span class="hljs-type">RequestContextHolder</span>.getBusinessUnit();
        <span class="hljs-type">String</span> dataType = <span class="hljs-type">RequestContextHolder</span>.getDataType();
        
        <span class="hljs-comment">// ç»„åˆè·¯ç”±é€»è¾‘</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"finance"</span>.equals(businessUnit) &amp;&amp; <span class="hljs-string">"sensitive"</span>.equals(dataType)) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"finance_secure_db"</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"report"</span>.equals(dataType)) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"reporting_db"</span>;
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-string">"default_db"</span>;
    }
}
</code></pre>
<h2 data-id="heading-10">âš ï¸ å®æˆ˜æ³¨æ„äº‹é¡¹</h2>
<ol>
<li><strong>äº‹åŠ¡ç®¡ç†</strong>ï¼šåœ¨æ‰‹åŠ¨åˆ‡æ¢æ•°æ®æºæ—¶ï¼Œç¡®ä¿<strong>åŒä¸€ä¸ªäº‹åŠ¡å†…ä½¿ç”¨åŒä¸€æ•°æ®æº</strong>ï¼Œé¿å…è·¨æ•°æ®æºäº‹åŠ¡å¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚</li>
<li><strong>èµ„æºæ¸…ç†</strong>ï¼šä½¿ç”¨<code>try-finally</code>ç¡®ä¿æ¯æ¬¡æ•°æ®æºåˆ‡æ¢åéƒ½èƒ½æ­£ç¡®æ¸…ç†ä¸Šä¸‹æ–‡ï¼Œé˜²æ­¢<strong>å†…å­˜æ³„æ¼</strong>å’Œ<strong>æ•°æ®æºæ±¡æŸ“</strong>ã€‚</li>
<li><strong>æ€§èƒ½è€ƒé‡</strong>ï¼šé¢‘ç¹çš„æ•°æ®æºåˆ‡æ¢ä¼šå¸¦æ¥æ€§èƒ½å¼€é”€ï¼Œåœ¨é«˜æ€§èƒ½åœºæ™¯ä¸‹åº”è€ƒè™‘<strong>æ‰¹é‡æ“ä½œ</strong>æˆ–<strong>è¿æ¥å¤ç”¨</strong>ã€‚</li>
<li><strong>é™çº§ç­–ç•¥</strong>ï¼šå§‹ç»ˆé…ç½®åˆç†çš„<strong>ä¸»ä»å»¶è¿Ÿå¤„ç†</strong>å’Œ<strong>æ•…éšœé™çº§</strong>æœºåˆ¶ï¼Œç¡®ä¿ä¸»åº“ä¸å¯ç”¨æ—¶ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</li>
</ol>
<h2 data-id="heading-11">ğŸ’ æ€»ç»“</h2>
<p>é€‰æ‹©åˆé€‚çš„æ•°æ®æºåˆ‡æ¢ç­–ç•¥éœ€è¦æƒè¡¡çµæ´»æ€§å’Œå¤æ‚æ€§ã€‚å¯¹äºå¤§å¤šæ•°åœºæ™¯ï¼Œ<strong>æ³¨è§£é©±åŠ¨æ–¹æ¡ˆ</strong>æä¾›äº†æœ€ä½³å®è·µï¼›å¯¹äºå¤æ‚ä¸šåŠ¡é€»è¾‘ï¼Œ<strong>æ‰‹åŠ¨ç¼–ç¨‹æ§åˆ¶</strong>ä¸å¯æˆ–ç¼ºï¼›è€Œå¯¹äºæœ‰å›ºå®šè·¯ç”±è§„åˆ™çš„åœºæ™¯ï¼Œ<strong>è‡ªå®šä¹‰è·¯ç”±ç­–ç•¥</strong>èƒ½å¤Ÿæä¾›æœ€ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PAIÂ PhysicalÂ AIÂ Notebookè¯¦è§£2ï¼šåŸºäºCosmosä¸–ç•Œæ¨¡å‹çš„æ“ä½œåŠ¨ä½œæ•°æ®æ‰©å¢ä¸æ¨¡ä»¿å­¦ä¹ ]]></title>    <link>https://juejin.cn/post/7571285984088686644</link>    <guid>https://juejin.cn/post/7571285984088686644</guid>    <pubDate>2025-11-11T09:36:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571285984088686644" data-draft-id="7571176484514447375" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PAIÂ PhysicalÂ AIÂ Notebookè¯¦è§£2ï¼šåŸºäºCosmosä¸–ç•Œæ¨¡å‹çš„æ“ä½œåŠ¨ä½œæ•°æ®æ‰©å¢ä¸æ¨¡ä»¿å­¦ä¹ "/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-11T09:36:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿é‡Œäº‘å¤§æ•°æ®AIæŠ€æœ¯"/> <meta itemprop="url" content="https://juejin.cn/user/2414974667341287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PAIÂ PhysicalÂ AIÂ Notebookè¯¦è§£2ï¼šåŸºäºCosmosä¸–ç•Œæ¨¡å‹çš„æ“ä½œåŠ¨ä½œæ•°æ®æ‰©å¢ä¸æ¨¡ä»¿å­¦ä¹ 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2414974667341287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿é‡Œäº‘å¤§æ•°æ®AIæŠ€æœ¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T09:36:14.000Z" title="Tue Nov 11 2025 09:36:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ä¸ŠæœŸNotebookè¯¦è§£ç³»åˆ—ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†ã€ŠåŸºäºIsaacä»¿çœŸçš„æ“ä½œåŠ¨ä½œæ•°æ®æ‰©å¢ä¸æ¨¡ä»¿å­¦ä¹ ã€‹ï¼Œæœ¬æœŸæˆ‘ä»¬å°†ä»‹ç»ä¸€å¥—ç±»ä¼¼çš„æ–¹æ¡ˆï¼ŒåŒæ ·å¯ä»¥å®Œæˆäººå·¥æ¼”ç¤ºã€æ•°æ®æ‰©å¢ã€æ¨¡ä»¿å­¦ä¹ ã€æ¨¡å‹æµ‹è¯„è¿™å‡ ä¸ªç¯èŠ‚ï¼Œä½†å®Œå…¨ä½¿ç”¨Cosmosä¸–ç•Œæ¨¡å‹ä½œä¸ºå†…æ ¸ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f474261b28e74a3c827534205e6e9993~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763458573&amp;x-signature=IqQCAUAZekvwtGmLdPIWEj9%2BgNI%3D" alt="image.png" loading="lazy"/></p>
<p>ç›¸æ¯”åŸºäºIsaacä»¿çœŸçš„æ–¹æ¡ˆï¼Œä½¿ç”¨Cosmosä¸–ç•Œæ¨¡å‹çš„æ–¹æ¡ˆå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>äººå·¥æ¼”ç¤ºã€æ•°æ®æ‰©å¢ç¯èŠ‚æ— éœ€ä»¿çœŸç®—åŠ›ï¼ˆRTÂ Coreï¼‰ï¼Œå…¨æµç¨‹ä½¿ç”¨AIç®—åŠ›ï¼ˆCUDAÂ Core/TensorÂ Coreï¼‰</li>
<li>æ— éœ€å¯¹äººå·¥æ¼”ç¤ºæ•°æ®è¿›è¡ŒåŠ¨ä½œæ‰“æ ‡å¤„ç†ï¼Œç›´æ¥ä½¿ç”¨è§†é¢‘æ•°æ®å³å¯å®ç°æ‰©å¢</li>
<li>æ— éœ€å•ç‹¬çš„æ•°æ®å¢å¼ºç¯èŠ‚ï¼Œå¯åœ¨æ•°æ®æ‰©å¢ç¯èŠ‚é€šè¿‡è°ƒæ•´æç¤ºè¯å®ç°æ•°æ®å¢å¼º</li>
<li>éœ€è¦é¢å¤–çš„æ‹’ç»é‡‡æ ·æ­¥éª¤ä»¥è¿‡æ»¤ä¸åˆç†çš„ç”Ÿæˆå†…å®¹ï¼Œä»¥åŠé¢å¤–çš„IDMé€†è§£ç®—æ­¥éª¤ä»¥è¡¥é½è§†é¢‘ä¸­ç¼ºå°‘çš„actionåºåˆ—</li>
</ul>
<p>åœ¨PAIçš„NotebookÂ Galleryä¸­ï¼Œæˆ‘ä»¬å·²ç»é¢„ç½®äº†ä¸€ä¸ªæœ€ä½³å®è·µï¼Œå°±æ˜¯è¿™ä¸ªè¿‡ç¨‹çš„ä¸€ä¸ªå…·ä½“ç¤ºä¾‹ï¼š
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgallery.pai-ml.com%2F%23%2Fpreview%2FdeepLearning%2Fcv%2Fisaac_gr00t_wf2" target="_blank" title="https://gallery.pai-ml.com/#/preview/deepLearning/cv/isaac_gr00t_wf2" ref="nofollow noopener noreferrer">gallery.pai-ml.com/#/preview/dâ€¦</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ee023d780a04e15982cd2ac7d8aa47f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763458573&amp;x-signature=ATG%2B1iVhlKgK7KOSPf5VBw7DjCM%3D" alt="image.png" loading="lazy"/></p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†è§£è¯»è¿™ä¸ªç¤ºä¾‹ã€‚</p>
<h2 data-id="heading-0">äººå·¥å°‘é‡æ¼”ç¤º</h2>
<p>ä¸åŸºäºä»¿çœŸçš„æ•°æ®æ‰©å¢ç›¸åŒï¼Œäººå·¥æ¼”ç¤ºå¯ä»¥åœ¨çœŸå®ç©ºé—´æˆ–ä»¿çœŸç©ºé—´ä¸­è¿›è¡Œï¼Œä½†æ— éœ€è¿›è¡ŒåŠ¨ä½œæ‰“æ ‡ï¼Œä»…éœ€å½•åˆ¶è§†é¢‘å³å¯
<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.video.taobao.com%2Fvod%2FrO6y913mSC_E0Y1aGBnsF0FGjfTgkyCmulBHQ39j4lk.mp4" target="_blank" title="https://cloud.video.taobao.com/vod/rO6y913mSC_E0Y1aGBnsF0FGjfTgkyCmulBHQ39j4lk.mp4" ref="nofollow noopener noreferrer">æŸ¥çœ‹æ¼”ç¤º &gt;&gt;</a></p>
<p>åœ¨è§†é¢‘ä¸­ï¼Œå·¦ä¸Šè§’çš„æ“æ§è€…è¿œç¨‹æ§åˆ¶æœºå™¨äººæœ¬ä½“ï¼Œå¯¹è”¬èœè¿›è¡Œäº†â€œPickÂ andÂ Placeâ€çš„åŠ¨ä½œã€‚åŒæ—¶ï¼Œç”±æ“æ§è€…å¯¹è§†é¢‘å†…å®¹è¿›è¡Œæ–‡å­—æè¿°ï¼Œä¾‹å¦‚ï¼š</p>
<blockquote>
<p>UseÂ theÂ rightÂ handÂ toÂ pickÂ upÂ greenÂ bokÂ choyÂ fromÂ tanÂ tableÂ rightÂ sideÂ toÂ bottomÂ levelÂ ofÂ wireÂ basket.</p>
</blockquote>
<p>é‡‡é›†ç±»ä¼¼çš„è§†é¢‘æ•°æ®ï¼Œç›´è‡³æ»¡è¶³Cosmos-Predictæ¨¡å‹å¾®è°ƒçš„è¦æ±‚ï¼ˆæœ¬æ ·ä¾‹ä¸­ä¸º100æ¡ï¼‰ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f99326a209b410b92672b8fe49af307~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763458573&amp;x-signature=4zxkvBNFgeZpXpq0fymXsvz2Fms%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">æ•°æ®æ‰©å¢</h2>
<p>åˆ©ç”¨Cosmosä¸–ç•Œæ¨¡å‹è¿›è¡Œæ•°æ®æ‰©å¢ï¼Œé¦–å…ˆè¦ä½¿ç”¨äººå·¥æ¼”ç¤ºæ•°æ®å¯¹Cosmos-Predictæ¨¡å‹è¿›è¡Œå¾®è°ƒã€‚æœ¬ä¾‹ä¸­ä½¿ç”¨Cosmos-Predict2-2B-Video2Worldæ¨¡å‹ï¼Œåœ¨4*GU8Tæœºå‹ä¸­è¿›è¡Œå¾®è°ƒï¼š</p>
<pre><code class="hljs language-python" lang="python">!torchrun --nproc_per_node=<span class="hljs-number">4</span> --master_port=<span class="hljs-number">12341</span> -m scripts.train --config=cosmos_predict2/configs/base/config.py -- experiment=predict2_video2world_training_2b_groot_gr1_480
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/845a0b8c341e4c79ac7dd366aa02417a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763458573&amp;x-signature=gvoPzDFiNP4PtAcwKmZbe1%2BoDEg%3D" alt="image.png" loading="lazy"/></p>
<p>å¯¹äºæ›´å¤§çš„ä¸–ç•Œæ¨¡å‹ï¼Œä¾‹å¦‚Cosmos-Predict2-14B-Video2Worldï¼Œå¯ä»¥åœ¨DLCä¸­ï¼Œä½¿ç”¨4èŠ‚ç‚¹Â Ã—Â 8*GU8Tçš„æœºå‹ä¸­è¿›è¡Œå¾®è°ƒï¼š</p>
<pre><code class="hljs language-python" lang="python">
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">from</span> alibabacloud_tea_openapi.models <span class="hljs-keyword">import</span> Config
<span class="hljs-keyword">from</span> alibabacloud_credentials.client <span class="hljs-keyword">import</span> Client <span class="hljs-keyword">as</span> CredClient
<span class="hljs-keyword">from</span> alibabacloud_credentials.models <span class="hljs-keyword">import</span> Config <span class="hljs-keyword">as</span> CredConfig
<span class="hljs-keyword">from</span> alibabacloud_pai_dlc20201203.client <span class="hljs-keyword">import</span> Client <span class="hljs-keyword">as</span> DLCClient
<span class="hljs-keyword">from</span> alibabacloud_pai_dlc20201203.models <span class="hljs-keyword">import</span> (
    CreateJobRequest,
    GetJobRequest,
)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">wait_for_job_to_terminate</span>(<span class="hljs-params">client, job_id</span>):
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        job = client.get_job(job_id, GetJobRequest()).body
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'job({}) is {}'</span>.<span class="hljs-built_in">format</span>(job_id, job.status))
        <span class="hljs-keyword">if</span> job.status <span class="hljs-keyword">in</span> (<span class="hljs-string">'Succeeded'</span>, <span class="hljs-string">'Failed'</span>, <span class="hljs-string">'Stopped'</span>):
            <span class="hljs-keyword">return</span> job.status
        time.sleep(<span class="hljs-number">5</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    current_time_tuple = time.localtime()
    year = current_time_tuple.tm_year
    month = current_time_tuple.tm_mon
    day = current_time_tuple.tm_mday
    hour = current_time_tuple.tm_hour
    minute = current_time_tuple.tm_min
    <span class="hljs-comment"># è¯·ç¡®è®¤æ‚¨çš„ä¸»è´¦å·å·²æˆæƒDLCï¼Œä¸”æ‹¥æœ‰è¶³å¤Ÿçš„æƒé™ã€‚</span>
    display_name = <span class="hljs-string">f"train_cosmos-predict2_14b_<span class="hljs-subst">{day}</span>_<span class="hljs-subst">{hour}</span>-<span class="hljs-subst">{minute}</span>"</span>  <span class="hljs-comment">#è®¾ç½®ä»»åŠ¡åç§° </span>
    region_id = os.environ.get(<span class="hljs-string">"dsw_region"</span>) <span class="hljs-comment">#è®¾ç½®regionid</span>
    workspace_id = os.environ.get(<span class="hljs-string">'PAI_WORKSPACE_ID'</span>) <span class="hljs-comment">#è®¾ç½®æˆç”¨æˆ·è‡ªå·±çš„å·¥ä½œç©ºé—´id</span>
    image_uri = <span class="hljs-string">f"dsw-registry.<span class="hljs-subst">{region_id}</span>.cr.aliyuncs.com/pai-training-algorithm/isaac-sim:gr00t-dreams-v9"</span> <span class="hljs-comment">#ä½¿ç”¨å®˜æ–¹é•œåƒ</span>
    ecs_spec = <span class="hljs-string">"ecs.gn8v-8x.16xlarge"</span>
    num_gpus = <span class="hljs-number">8</span> <span class="hljs-comment"># ä¸èµ„æºè§„æ ¼ä¿æŒä¸€è‡´</span>
    num_nodes = <span class="hljs-number">4</span>
    <span class="hljs-comment">#########è®­ç»ƒä»»åŠ¡ç›¸å…³é…ç½®#############</span>
    config = <span class="hljs-string">"cosmos_predict2/configs/base/config.py"</span>
    exp = <span class="hljs-string">"predict2_video2world_training_14b_groot_gr1_480"</span>
    <span class="hljs-comment">#########è®­ç»ƒä»»åŠ¡ç›¸å…³é…ç½®#############</span>

    <span class="hljs-comment"># æœ¬ç¤ºä¾‹é€šè¿‡Credentials SDKé»˜è®¤ä»ç¯å¢ƒå˜é‡ä¸­è¯»å–AccessKeyï¼Œæ¥å®ç°èº«ä»½éªŒè¯ã€‚</span>
    credentialsConfig = CredConfig(
        <span class="hljs-built_in">type</span>=<span class="hljs-string">'credentials_uri'</span>   <span class="hljs-comment"># é€‰å¡«ã€‚è‹¥æ‚¨æœªé…ç½®å…¶ä»–â€œé»˜è®¤å‡­æ®é“¾â€è®¿é—®æ–¹å¼ï¼Œæ‚¨æ— éœ€å†æ˜¾å¼æŒ‡å®šï¼ŒCredentials SDKä¼šé€šè¿‡uriæ–¹å¼è·å–ä¸´æ—¶å‡­è¯</span>
    )
    cred = CredClient(credentialsConfig)

    <span class="hljs-comment"># 1. create client;</span>
    dlc_client = DLCClient(
         config=Config(
            credential=cred,
            region_id=region_id,
            endpoint=<span class="hljs-string">'pai-dlc.{}.aliyuncs.com'</span>.<span class="hljs-built_in">format</span>(region_id),
         )
    )
        
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'-------- Create Job ----------'</span>)
    <span class="hljs-comment"># åˆ›å»ºDLCä½œä¸šã€‚</span>
    create_job_resp = dlc_client.create_job(CreateJobRequest().from_map({
        <span class="hljs-string">'WorkspaceId'</span>: workspace_id,
        <span class="hljs-string">'DisplayName'</span>: display_name,
        <span class="hljs-string">'JobType'</span>: <span class="hljs-string">'PyTorchJob'</span>,
        <span class="hljs-comment"># 'ResourceId': resource_quota_id,</span>
        <span class="hljs-string">'JobSpecs'</span>: [
            {
                <span class="hljs-string">"Type"</span>: <span class="hljs-string">"Worker"</span>,
                <span class="hljs-string">"Image"</span>: image_uri,
                <span class="hljs-string">"PodCount"</span>: num_nodes,
                <span class="hljs-string">"EcsSpec"</span>: ecs_spec,
            },
        ],
        <span class="hljs-string">'DataSources'</span>: [
            {
                <span class="hljs-string">"DataSourceId"</span>: dataset_id,
            },
        ],
       <span class="hljs-string">'UserVpc'</span>: {
            <span class="hljs-string">"VpcId"</span>: vpc_id,  <span class="hljs-comment"># æ›¿æ¢ä¸ºå®é™… VPC ID</span>
            <span class="hljs-string">"SwitchId"</span>: switch_id,  <span class="hljs-comment"># æ›¿æ¢ä¸ºå®é™…äº¤æ¢æœº ID</span>
            <span class="hljs-string">"SecurityGroupId"</span>: security_groupid  <span class="hljs-comment"># æ›¿æ¢ä¸ºå®é™…å®‰å…¨ç»„ ID</span>
        },
        <span class="hljs-string">"UserCommand"</span>: <span class="hljs-string">f" export NVTE_FUSED_ATTN=0 &amp;&amp; \
            rm -rf /workspace/cosmos-predict2/checkpoints &amp;&amp; \
            rm -rf /workspace/cosmos-predict2/datasets/benchmark_train/gr1 &amp;&amp; \
            ln -s /mnt/data/notebook2/checkpoints /workspace/cosmos-predict2/checkpoints &amp;&amp; \
            ln -s /mnt/data/notebook2/gr1 /workspace/cosmos-predict2/datasets/benchmark_train/gr1 &amp;&amp; \
            cd /workspace/cosmos-predict2 &amp;&amp; \
            torchrun --nproc_per_node=<span class="hljs-subst">{num_gpus}</span> --nnodes=<span class="hljs-subst">{num_nodes}</span> --rdzv_id 123 --rdzv_backend c10d --rdzv_endpoint $MASTER_ADDR:1234 -m \
            scripts.train --config=<span class="hljs-subst">{config}</span> \
            -- experiment=<span class="hljs-subst">{exp}</span> \
            model.config.fsdp_shard_size=0"</span>
    }))
    job_id = create_job_resp.body.job_id

    wait_for_job_to_terminate(dlc_client, job_id)

    <span class="hljs-keyword">pass</span>


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    main()

</code></pre>
<p>å®Œæˆå¾®è°ƒåï¼Œå³å¯ä½¿ç”¨å¾®è°ƒåçš„æ¨¡å‹è¿›è¡Œæ¨ç†ï¼š</p>
<pre><code class="hljs language-python" lang="python">!torchrun --nproc_per_node=<span class="hljs-number">4</span> --master_port=<span class="hljs-number">12341</span> -m examples.video2world_gr00t \
--num_gpus <span class="hljs-number">4</span>   --model_size 14B   --gr00t_variant gr1   \
--batch_input_json dream_gen_benchmark/gr1_object/batch_input.json   --disable_guardrail
</code></pre>
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œä½¿ç”¨batch_input.jsonæ¥è®°å½•æ¨ç†æ‰€éœ€çš„promptsä¸èµ·å§‹å¸§ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/675f8ea1bbb543dc9294c80bda78eea5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763458573&amp;x-signature=qtV9CMXiLHUpTrMQgQdTdAo8TGU%3D" alt="image.png" loading="lazy"/></p>
<p>æ‰§è¡Œä¸Šè¿°æ¨ç†è¿‡ç¨‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04048b76c47f4d1682b25fcf3053193f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763458573&amp;x-signature=fDb5ygam614P3j4LIK3HVs3vPio%3D" alt="image.png" loading="lazy"/></p>
<p>æŒ‰ç…§batch_input.jsonï¼Œè„šæœ¬ä¼šè¾“å‡ºä¸€ç³»åˆ—æ¨ç†ç»“æœï¼Œå®ç°æ•°æ®æ‰©å¢ã€‚æ‰©å¢çš„æ•°é‡å–å†³äºbatch_input.jsonçš„promptæ•°é‡ã€‚ä»¥ä¸‹æ˜¯è¾“å‡ºç»“æœç¤ºä¾‹,<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.video.taobao.com%2Fvod%2FJquGeKxcghzoa16tlkGc97cp9bbbwu9Rc_KRtPp6v2Q.mp4" target="_blank" title="https://cloud.video.taobao.com/vod/JquGeKxcghzoa16tlkGc97cp9bbbwu9Rc_KRtPp6v2Q.mp4" ref="nofollow noopener noreferrer">æŸ¥çœ‹æ¼”ç¤º &gt;&gt;</a></p>
<p>ä»ä¸Šè¿°ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œå³ä¸Šè§’çš„æ°´å£¶å‡ºç°äº†æ˜æ˜¾çš„å˜å½¢ï¼Œä¸ç¬¦åˆçœŸå®ç‰©ç†è§„å¾‹ã€‚åœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å‰”é™¤è¿™ç±»è§†é¢‘ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨Cosmos-Reason1æ¨¡å‹è¿›è¡Œæ‹’ç»é‡‡æ ·ã€‚</p>
<h2 data-id="heading-2">æ‹’ç»é‡‡æ ·</h2>
<p>æ‹’ç»é‡‡æ ·çš„åŸç†æ˜¯ï¼šç”Ÿæˆå¤šä¸ªå€™é€‰è§†é¢‘ï¼Œç„¶åä½¿ç”¨Cosmos-Reason1å¯¹è¿™äº›è§†é¢‘è¿›è¡Œè¯„åˆ†ï¼Œé€‰æ‹©è¯„åˆ†æœ€é«˜çš„è§†é¢‘ä½œä¸ºæœ€ç»ˆè¾“å‡ºã€‚è¯„åˆ†å°†ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè€ƒé‡ï¼š</p>
<ul>
<li>è¿åŠ¨è¿è´¯æ€§:Â ç‰©ä½“ç§»åŠ¨æ˜¯å¦è‡ªç„¶æµç•…</li>
<li>æ—¶é—´ä¸€è‡´æ€§:Â å¸§ä¸å¸§ä¹‹é—´æ˜¯å¦å­˜åœ¨çªå…€å˜åŒ–</li>
<li>ç‰©ç†åˆç†æ€§:Â é‡åŠ›ã€å…‰å½±ã€æè´¨æ˜¯å¦ç¬¦åˆç‰©ç†è§„å¾‹</li>
<li>è§†è§‰è´¨é‡:Â æ˜¯å¦å­˜åœ¨ä¼ªå½±ã€æ¨¡ç³Šã€æ‰­æ›²ç­‰é—®é¢˜</li>
<li>å†…å®¹é€»è¾‘:Â åœºæ™¯å…ƒç´ ä¹‹é—´çš„å…³ç³»æ˜¯å¦åˆç†</li>
</ul>
<p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è„šæœ¬è¿›è¡Œæ‹’ç»é‡‡æ ·ï¼š</p>
<pre><code class="hljs language-python" lang="python">!torchrun --nproc_per_node=<span class="hljs-number">4</span> --master_port=<span class="hljs-number">12341</span>   -m examples.video2world_bestofn   \
--model_size 14B   --gr00t_variant gr1   \
--prompt <span class="hljs-string">"Use the right hand to pick up rubik's cube from from the bottom of the three-tiered wooden shelf to to the top of the three-tiered wooden shelf."</span>   \
--input_path assets/sample_gr00t_dreams_gr1/8_Use_the_right_hand_to_pick_up_rubik\<span class="hljs-string">'s_cube_from_from_the_bottom_of_the_three-tiered_wooden_shelf_to_to_the_top_of_the_three-tiered_wooden_shelf..png   \
--num_gpus 2   --num_generations 4   --prompt_prefix ""   \
--disable_guardrail   --save_path output/best-of-n-gr00t-gr1
</span></code></pre>
<p>è¯¥è„šæœ¬ä¼šä½¿ç”¨ç›¸åŒçš„promptç”Ÿæˆ4æ¡è§†é¢‘ï¼Œç„¶åé€šè¿‡Cosmos-Reason1è¿›è¡Œæ‰“åˆ†ï¼Œä»¥ä¸‹åˆ†åˆ«æ˜¯0åˆ†å’Œ100åˆ†çš„è§†é¢‘ï¼Œä»¥ç¤ºå¯¹æ¯”ï¼š</p>

















<table><thead><tr><th>0åˆ†</th><th>100åˆ†</th></tr></thead><tbody><tr><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.video.taobao.com%2Fvod%2FbLbanLWVx_S3xeTnZuDeKANYJBSNIhAUMVtPXKNU284.mp4" target="_blank" title="https://cloud.video.taobao.com/vod/bLbanLWVx_S3xeTnZuDeKANYJBSNIhAUMVtPXKNU284.mp4" ref="nofollow noopener noreferrer">0åˆ†è§†é¢‘æ¼”ç¤º &gt;&gt;</a></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.video.taobao.com%2Fvod%2FP8TaehO-WgL-ocS05rNjRnCzsHCV9YfcMV3A0FDmh-4.mp4" target="_blank" title="https://cloud.video.taobao.com/vod/P8TaehO-WgL-ocS05rNjRnCzsHCV9YfcMV3A0FDmh-4.mp4" ref="nofollow noopener noreferrer">100åˆ†è§†é¢‘æ¼”ç¤º &gt;&gt;</a></td></tr><tr><td><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77152b3349ca4a628df49c16d6ede171~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763458573&amp;x-signature=z7SHavZPcAB0vDn0XfKzcFubATk%3D" alt="image.png" loading="lazy"/></td><td><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b53a025a4aa4d43b19591ebcf01dd4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763458573&amp;x-signature=W3JUkR3cCVUSQrOpQJXV3SXKn2w%3D" alt="image.png" loading="lazy"/></td></tr></tbody></table>
<h2 data-id="heading-3">IDMé€†è§£ç®—</h2>
<p>ä¸Šè¿°æ•°æ®æ‰©å¢å’Œæ‹’ç»é‡‡æ ·çš„ç»“æœï¼Œä¸ºä¸€ç³»åˆ—çš„â€œprompt-è§†é¢‘â€æ•°æ®å¯¹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœç”¨äºVLAæ¨¡å‹çš„æ¨¡ä»¿å­¦ä¹ ï¼Œä»…æœ‰è¿™æ ·çš„æ•°æ®å¯¹æ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜éœ€ç»™å‡ºè§†é¢‘å†…å®¹ä¸­çš„actionåºåˆ—ã€‚ä½†ç”±äºCosmos-Predict2æ¨¡å‹ç›´æ¥è¾“å‡ºäº†è§†é¢‘ï¼Œæ²¡æœ‰actionåºåˆ—ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡IDMï¼ˆInverseÂ DynamicsÂ Modelï¼Œé€†å‘åŠ¨åŠ›å­¦æ¨¡å‹ï¼‰å¯¹è§†é¢‘è¿›è¡Œå¤„ç†ï¼Œé€†å‘è§£æå‡ºå…¶ä¸­çš„actionåºåˆ—ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è„šæœ¬è¿›è¡ŒIDMé€†è§£ç®—ï¼š</p>
<pre><code class="hljs language-python" lang="python">!PYTHONPATH=. CUDA_VISIBLE_DEVICES=<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> python IDM_dump/dump_idm_actions.py \
    --checkpoint <span class="hljs-string">"seonghyeonye/IDM_gr1"</span> \
    --dataset <span class="hljs-string">"IDM_dump/data/gr1_unified.data"</span> \
    --output_dir <span class="hljs-string">"IDM_dump/data/gr1_unified.data_idm"</span> \
    --num_gpus <span class="hljs-number">4</span> \
    --video_indices <span class="hljs-string">"0 8"</span>
</code></pre>
<p>ç”±äºéœ€è¦ä½¿ç”¨huggingfaceè·å–IDMæ¨¡å‹ï¼Œåœ¨å›½å†…çš„ç½‘ç»œç¯å¢ƒä¸­ï¼Œæ‰§è¡Œä¸Šè¿°å‘½ä»¤å¯èƒ½å‡ºç°ç½‘ç»œé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç¯å¢ƒå˜é‡è¿›è¡Œä»£ç†åŠ é€Ÿï¼š</p>
<pre><code class="hljs language-python" lang="python">HF_ENDPOINT=https://hf-mirror.com 
</code></pre>
<p>é€†è§£ç®—ç»“æœä»¥parquetæ ¼å¼ä¿å­˜ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š</p>
<pre><code class="hljs language-python" lang="python">!uv pip install parquet-tools
!parquet-tools csv IDM_dump/data/gr1_unified.data_idm/data/chunk-<span class="hljs-number">000</span>/episode_000000.parquet
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff9f33f769b742e78ce70cd6e0ab3d79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763458573&amp;x-signature=dxT5%2Fu6kECSl3IHg25kJUor9B5E%3D" alt="image.png" loading="lazy"/></p>
<p>å¦‚æœéœ€è¦ä½¿ç”¨è‡ªå®šä¹‰æœºå™¨äººæœ¬ä½“æ„å‹ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰å¾®è°ƒIDMæ¨¡å‹ï¼š</p>
<pre><code class="hljs language-python" lang="python">cd /workspace/GR00T-Dreams/
export HF_HOME=/mnt/data/notebook2
PYTHONPATH=. WANDB_MODE=disabled CUDA_VISIBLE_DEVICES=<span class="hljs-number">0</span> torchrun scripts/idm_training.py \
    --dataset-path demo_data/robot_sim.PickNPlace/ \
    --embodiment_tag gr1
</code></pre>
<h2 data-id="heading-4">æ¨¡ä»¿å­¦ä¹ </h2>
<p>ä½¿ç”¨ä¸Šè¿°è¿‡ç¨‹å¾—åˆ°çš„æ‰©å¢æ•°æ®ï¼Œå¯ä»¥ç”¨ä¸GR00T-N1æ¨¡å‹çš„æ¨¡ä»¿å­¦ä¹ ï¼š</p>
<pre><code class="hljs language-python" lang="python">!cd /workspace/GR00T-Dreams/
!export HF_HOME=/mnt/data/notebook2 &amp;&amp; export WANDB_MODE=offline &amp;&amp; \
bash IDM_dump/scripts/finetune/gr1.sh
</code></pre>
<p>è¯¦ç»†è®­ç»ƒè„šæœ¬gr1.shå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> subprocess
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">from</span> dataclasses <span class="hljs-keyword">import</span> dataclass
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path

<span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">import</span> tyro
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> TrainingArguments

<span class="hljs-keyword">from</span> gr00t.data.dataset <span class="hljs-keyword">import</span> LeRobotSingleDataset
<span class="hljs-keyword">from</span> gr00t.data.schema <span class="hljs-keyword">import</span> EmbodimentTag
<span class="hljs-keyword">from</span> gr00t.experiment.data_config <span class="hljs-keyword">import</span> DATA_CONFIG_MAP
<span class="hljs-keyword">from</span> gr00t.experiment.runner <span class="hljs-keyword">import</span> TrainRunner
<span class="hljs-keyword">from</span> gr00t.model.gr00t_n1 <span class="hljs-keyword">import</span> GR00T_N1
<span class="hljs-keyword">from</span> gr00t.utils.peft <span class="hljs-keyword">import</span> get_lora_model


<span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:
    <span class="hljs-string">"""Configuration for GR00T model fine-tuning."""</span>

    <span class="hljs-comment"># Dataset parameters</span>
    dataset_path: <span class="hljs-built_in">str</span>
    <span class="hljs-string">"""Path to the dataset directory."""</span>

    output_dir: <span class="hljs-built_in">str</span> = <span class="hljs-string">"/tmp/gr00t"</span>
    <span class="hljs-string">"""Directory to save model checkpoints."""</span>

    data_config: <span class="hljs-built_in">str</span> = <span class="hljs-string">"gr1_arms_only"</span>
    <span class="hljs-string">"""Data configuration name from DATA_CONFIG_MAP."""</span>

    <span class="hljs-comment"># Training parameters</span>
    batch_size: <span class="hljs-built_in">int</span> = <span class="hljs-number">16</span>
    <span class="hljs-string">"""Batch size per GPU for training."""</span>

    max_steps: <span class="hljs-built_in">int</span> = <span class="hljs-number">10000</span>
    <span class="hljs-string">"""Maximum number of training steps."""</span>

    num_gpus: <span class="hljs-built_in">int</span> = <span class="hljs-number">1</span>
    <span class="hljs-string">"""Number of GPUs to use for training."""</span>

    save_steps: <span class="hljs-built_in">int</span> = <span class="hljs-number">500</span>
    <span class="hljs-string">"""Number of steps between saving checkpoints."""</span>

    <span class="hljs-comment"># Model parameters</span>
    base_model_path: <span class="hljs-built_in">str</span> = <span class="hljs-string">"nvidia/GR00T-N1-2B"</span>
    <span class="hljs-string">"""Path or HuggingFace model ID for the base model."""</span>

    tune_llm: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>
    <span class="hljs-string">"""Whether to fine-tune the language model backbone."""</span>

    tune_visual: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span>
    <span class="hljs-string">"""Whether to fine-tune the vision tower."""</span>

    tune_projector: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span>
    <span class="hljs-string">"""Whether to fine-tune the projector."""</span>

    tune_diffusion_model: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span>
    <span class="hljs-string">"""Whether to fine-tune the diffusion model."""</span>

    resume: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>
    <span class="hljs-string">"""Whether to resume from a checkpoint."""</span>

    <span class="hljs-comment"># Advanced training parameters</span>
    learning_rate: <span class="hljs-built_in">float</span> = <span class="hljs-number">1e-4</span>
    <span class="hljs-string">"""Learning rate for training."""</span>

    weight_decay: <span class="hljs-built_in">float</span> = <span class="hljs-number">1e-5</span>
    <span class="hljs-string">"""Weight decay for AdamW optimizer."""</span>

    warmup_ratio: <span class="hljs-built_in">float</span> = <span class="hljs-number">0.05</span>
    <span class="hljs-string">"""Ratio of total training steps used for warmup."""</span>

    lora_rank: <span class="hljs-built_in">int</span> = <span class="hljs-number">0</span>
    <span class="hljs-string">"""Rank for the LORA model."""</span>

    lora_alpha: <span class="hljs-built_in">int</span> = <span class="hljs-number">16</span>
    <span class="hljs-string">"""Alpha value for the LORA model."""</span>

    lora_dropout: <span class="hljs-built_in">float</span> = <span class="hljs-number">0.1</span>
    <span class="hljs-string">"""Dropout rate for the LORA model."""</span>

    dataloader_num_workers: <span class="hljs-built_in">int</span> = <span class="hljs-number">8</span>
    <span class="hljs-string">"""Number of workers for data loading."""</span>

    report_to: <span class="hljs-built_in">str</span> = <span class="hljs-string">"wandb"</span>
    <span class="hljs-string">"""Where to report training metrics (e.g., 'wandb', 'tensorboard')."""</span>

    <span class="hljs-comment"># Data loading parameters</span>
    embodiment_tag: <span class="hljs-built_in">str</span> = <span class="hljs-string">"new_embodiment"</span>
    <span class="hljs-string">"""Embodiment tag to use for training. e.g. 'new_embodiment', 'gr1'"""</span>

    video_backend: <span class="hljs-built_in">str</span> = <span class="hljs-string">"decord"</span>
    <span class="hljs-string">"""Video backend to use for training. [decord, torchvision_av]"""</span>


<span class="hljs-comment">#####################################################################################</span>
<span class="hljs-comment"># main training function</span>
<span class="hljs-comment">#####################################################################################</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>(<span class="hljs-params">config: Config</span>):
    <span class="hljs-string">"""Main training function."""</span>
    <span class="hljs-comment"># ------------ step 1: load dataset ------------</span>
    embodiment_tag = EmbodimentTag(config.embodiment_tag)

    <span class="hljs-comment"># 1.1 modality configs and transforms</span>
    data_config_cls = DATA_CONFIG_MAP[config.data_config]
    modality_configs = data_config_cls.modality_config()
    transforms = data_config_cls.transform()

    <span class="hljs-comment"># 1.2 data loader</span>
    train_dataset = LeRobotSingleDataset(
        dataset_path=config.dataset_path,
        modality_configs=modality_configs,
        transforms=transforms,
        embodiment_tag=embodiment_tag,  <span class="hljs-comment"># This will override the dataset's embodiment tag to "new_embodiment"</span>
        video_backend=config.video_backend,
    )

    <span class="hljs-comment"># ------------ step 2: load model ------------</span>
    model = GR00T_N1.from_pretrained(
        pretrained_model_name_or_path=config.base_model_path,
        tune_llm=config.tune_llm,  <span class="hljs-comment"># backbone's LLM</span>
        tune_visual=config.tune_visual,  <span class="hljs-comment"># backbone's vision tower</span>
        tune_projector=config.tune_projector,  <span class="hljs-comment"># action head's projector</span>
        tune_diffusion_model=config.tune_diffusion_model,  <span class="hljs-comment"># action head's DiT</span>
    )

    <span class="hljs-comment"># Set the model's compute_dtype to bfloat16</span>
    model.compute_dtype = <span class="hljs-string">"bfloat16"</span>
    model.config.compute_dtype = <span class="hljs-string">"bfloat16"</span>

    <span class="hljs-keyword">if</span> config.lora_rank &gt; <span class="hljs-number">0</span>:
        model = get_lora_model(
            model,
            rank=config.lora_rank,
            lora_alpha=config.lora_alpha,
            lora_dropout=config.lora_dropout,
        )

    <span class="hljs-comment"># 2.1 modify training args</span>
    training_args = TrainingArguments(
        output_dir=config.output_dir,
        run_name=<span class="hljs-literal">None</span>,
        remove_unused_columns=<span class="hljs-literal">False</span>,
        deepspeed=<span class="hljs-string">""</span>,
        gradient_checkpointing=<span class="hljs-literal">False</span>,
        bf16=<span class="hljs-literal">True</span>,
        tf32=<span class="hljs-literal">True</span>,
        per_device_train_batch_size=config.batch_size,
        gradient_accumulation_steps=<span class="hljs-number">1</span>,
        dataloader_num_workers=config.dataloader_num_workers,
        dataloader_pin_memory=<span class="hljs-literal">False</span>,
        dataloader_persistent_workers=<span class="hljs-literal">True</span>,
        optim=<span class="hljs-string">"adamw_torch"</span>,
        adam_beta1=<span class="hljs-number">0.95</span>,
        adam_beta2=<span class="hljs-number">0.999</span>,
        adam_epsilon=<span class="hljs-number">1e-8</span>,
        learning_rate=config.learning_rate,
        weight_decay=config.weight_decay,
        warmup_ratio=config.warmup_ratio,
        lr_scheduler_type=<span class="hljs-string">"cosine"</span>,
        logging_steps=<span class="hljs-number">10.0</span>,
        num_train_epochs=<span class="hljs-number">300</span>,
        max_steps=config.max_steps,
        save_strategy=<span class="hljs-string">"steps"</span>,
        save_steps=config.save_steps,
        save_total_limit=<span class="hljs-number">8</span>,
        report_to=config.report_to,
        seed=<span class="hljs-number">42</span>,
        do_eval=<span class="hljs-literal">False</span>,
        ddp_find_unused_parameters=<span class="hljs-literal">False</span>,
        ddp_bucket_cap_mb=<span class="hljs-number">100</span>,
        torch_compile_mode=<span class="hljs-literal">None</span>,
    )

    <span class="hljs-comment"># 2.2 run experiment</span>
    experiment = TrainRunner(
        train_dataset=train_dataset,
        model=model,
        training_args=training_args,
        resume_from_checkpoint=config.resume,
    )

    <span class="hljs-comment"># 2.3 run experiment</span>
    experiment.train()


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># Parse arguments using tyro</span>
    config = tyro.cli(Config)

    <span class="hljs-comment"># Print the tyro config</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"GR00T FINE-TUNING CONFIGURATION:"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> <span class="hljs-built_in">vars</span>(config).items():
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{key}</span>: <span class="hljs-subst">{value}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span> + <span class="hljs-string">"\n"</span>)

    available_gpus = torch.cuda.device_count() <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-number">1</span>

    <span class="hljs-comment"># Validate GPU configuration</span>
    <span class="hljs-keyword">assert</span> (
        config.num_gpus &lt;= available_gpus
    ), <span class="hljs-string">f"Number of GPUs requested (<span class="hljs-subst">{config.num_gpus}</span>) is greater than the available GPUs (<span class="hljs-subst">{available_gpus}</span>)"</span>
    <span class="hljs-keyword">assert</span> config.num_gpus &gt; <span class="hljs-number">0</span>, <span class="hljs-string">"Number of GPUs must be greater than 0"</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Using <span class="hljs-subst">{config.num_gpus}</span> GPUs"</span>)

    <span class="hljs-keyword">if</span> config.num_gpus == <span class="hljs-number">1</span>:
        <span class="hljs-comment"># Single GPU mode - set CUDA_VISIBLE_DEVICES=0</span>
        os.environ[<span class="hljs-string">"CUDA_VISIBLE_DEVICES"</span>] = <span class="hljs-string">"0"</span>
        <span class="hljs-comment"># Run the script normally</span>
        main(config)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">if</span> os.environ.get(<span class="hljs-string">"IS_TORCHRUN"</span>, <span class="hljs-string">"0"</span>) == <span class="hljs-string">"1"</span>:
            main(config)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># Multi-GPU mode - use torchrun</span>
            script_path = Path(__file__).absolute()
            <span class="hljs-comment"># Remove any existing CUDA_VISIBLE_DEVICES from environment</span>
            <span class="hljs-keyword">if</span> <span class="hljs-string">"CUDA_VISIBLE_DEVICES"</span> <span class="hljs-keyword">in</span> os.environ:
                <span class="hljs-keyword">del</span> os.environ[<span class="hljs-string">"CUDA_VISIBLE_DEVICES"</span>]

            <span class="hljs-comment"># Use subprocess.run instead of os.system</span>
            cmd = [
                <span class="hljs-string">"torchrun"</span>,
                <span class="hljs-string">"--standalone"</span>,
                <span class="hljs-string">f"--nproc_per_node=<span class="hljs-subst">{config.num_gpus}</span>"</span>,
                <span class="hljs-string">"--nnodes=1"</span>,  <span class="hljs-comment"># default to 1 node for now</span>
                <span class="hljs-built_in">str</span>(script_path),
            ]

            <span class="hljs-comment"># Convert config to command line arguments</span>
            <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> <span class="hljs-built_in">vars</span>(config).items():
                <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(value, <span class="hljs-built_in">bool</span>):
                    <span class="hljs-comment"># For boolean values, use --flag or --no-flag format</span>
                    <span class="hljs-keyword">if</span> value:
                        cmd.append(<span class="hljs-string">f"--<span class="hljs-subst">{key.replace(<span class="hljs-string">'_'</span>, <span class="hljs-string">'-'</span>)}</span>"</span>)
                    <span class="hljs-keyword">else</span>:
                        cmd.append(<span class="hljs-string">f"--no-<span class="hljs-subst">{key.replace(<span class="hljs-string">'_'</span>, <span class="hljs-string">'-'</span>)}</span>"</span>)
                <span class="hljs-keyword">else</span>:
                    <span class="hljs-comment"># For non-boolean values, use --key value format</span>
                    cmd.append(<span class="hljs-string">f"--<span class="hljs-subst">{key.replace(<span class="hljs-string">'_'</span>, <span class="hljs-string">'-'</span>)}</span>"</span>)
                    cmd.append(<span class="hljs-built_in">str</span>(value))
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"Running torchrun command: "</span>, cmd)
            env = os.environ.copy()
            env[<span class="hljs-string">"IS_TORCHRUN"</span>] = <span class="hljs-string">"1"</span>
            sys.exit(subprocess.run(cmd, env=env).returncode)

</code></pre>
<p>å»ºè®®åœ¨å®é™…è®­ç»ƒä¸­ï¼Œå°†Â batchÂ sizeÂ å°½å¯èƒ½è°ƒå¤§ï¼Œå¹¶è®­ç»ƒÂ 20kÂ stepsã€‚è¯·åœ¨Â DreamGenÂ ç¯å¢ƒä¸­è¿è¡Œç›¸åº”å‘½ä»¤ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c7d6668bcb147a8b0ab3cb5f3248bb4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763458573&amp;x-signature=chFnH8e4qMu1YQhmL1pn7BWYP9s%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5">æ¨¡å‹æµ‹è¯„</h2>
<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œä½¿ç”¨çœŸå®çš„GR1æœºå™¨äººè¿›è¡Œæ¨¡å‹æ•ˆæœéªŒè¯ï¼Œå¾—åˆ°ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7531acca2fb4feea76627c5dafad9f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763458573&amp;x-signature=3PovAunOoaexObe57bjk5qyKklo%3D" alt="image.png" loading="lazy"/></p>
<p>ä»ç»“æœä¸­å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li>
<p>åœ¨å·²çŸ¥åœºæ™¯ä¸­æ‰§è¡Œå…¨æ–°çš„åŠ¨ä½œï¼Œæœªä½¿ç”¨æ‰©å¢æ•°æ®å¾®è°ƒçš„GR00TÂ N1æ¨¡å‹ä»…æœ‰11.2%çš„æˆåŠŸç‡ï¼Œä½¿ç”¨æ‰©å¢æ•°æ®å¾®è°ƒåå¯ä»¥è¾¾åˆ°43.2%çš„æˆåŠŸç‡</p>
</li>
<li>
<p>åœ¨æœªçŸ¥åœºæ™¯ä¸­æ‰§è¡Œå·²çŸ¥æˆ–æœªçŸ¥åŠ¨ä½œï¼Œæœªä½¿ç”¨æ‰©å¢æ•°æ®å¾®è°ƒçš„GR00TÂ N1æ¨¡å‹å…¨éƒ¨å¤±è´¥ï¼Œä½†æ˜¯ä½¿ç”¨æ‰©å¢æ•°æ®å¾®è°ƒåå¯ä»¥è¾¾åˆ°28.5%çš„æˆåŠŸç‡</p>
</li>
</ul>
<h2 data-id="heading-6">æ€»ç»“</h2>
<p>åœ¨æœ¬æœ€ä½³å®è·µä¸­ï¼ŒåŸºäºé˜¿é‡Œäº‘Â PAIÂ å¹³å°çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å®ç°äº†åŸºäºCosmosä¸–ç•Œæ¨¡å‹çš„æ“ä½œåŠ¨ä½œæ•°æ®æ‰©å¢ä¸æ¨¡ä»¿å­¦ä¹ ï¼ŒåŒ…å«ä»äººå·¥å°‘é‡æ¼”ç¤ºã€æ•°æ®æ‰©å¢ã€æ‹’ç»é‡‡æ ·ã€IDMé€†è§£ç®—ã€æ¨¡ä»¿å­¦ä¹ å†åˆ°æ¨¡å‹æµ‹è¯„çš„ç«¯åˆ°ç«¯å®ç°</p>
<p>ä¸åŸºäºIsaacä»¿çœŸçš„æ•°æ®æ‰©å¢æŠ€æœ¯ä¸€æ ·ï¼ŒCosmosÂ æ•°æ®æ‰©å¢åè®­ç»ƒçš„æ¨¡å‹åœ¨å„ä¸ªåœºæ™¯ä¸‹çš„æˆåŠŸç‡å‡æœ‰è¾ƒé«˜æå‡ã€‚ç›¸æ¯”äºIsaacä»¿çœŸï¼ŒCosmosæ•°æ®æ‰©å¢æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>
<p>äººå·¥æ¼”ç¤ºã€æ•°æ®æ‰©å¢ç¯èŠ‚æ— éœ€ä»¿çœŸç®—åŠ›ï¼ˆRTÂ Coreï¼‰ï¼Œå…¨æµç¨‹ä½¿ç”¨åŒæ„ç®—åŠ›ï¼ˆCUDAÂ Core/TensorÂ Coreï¼‰</p>
</li>
<li>
<p>æ— éœ€å¯¹äººå·¥æ¼”ç¤ºæ•°æ®è¿›è¡ŒåŠ¨ä½œæ‰“æ ‡å¤„ç†ï¼Œç›´æ¥ä½¿ç”¨è§†é¢‘æ•°æ®å³å¯å®ç°æ‰©å¢</p>
</li>
<li>
<p>æ— éœ€å•ç‹¬çš„æ•°æ®å¢å¼ºç¯èŠ‚ï¼Œå¯åœ¨æ•°æ®æ‰©å¢ç¯èŠ‚é€šè¿‡è°ƒæ•´æç¤ºè¯å®ç°æ•°æ®å¢å¼º</p>
</li>
<li>
<p>éœ€è¦é¢å¤–çš„æ‹’ç»é‡‡æ ·æ­¥éª¤ä»¥è¿‡æ»¤ä¸åˆç†çš„ç”Ÿæˆå†…å®¹ï¼Œä»¥åŠé¢å¤–çš„IDMé€†è§£ç®—æ­¥éª¤ä»¥è¡¥é½è§†é¢‘ä¸­ç¼ºå°‘çš„actionåºåˆ—</p>
</li>
</ul>
<pre><code class="hljs language-markdown" lang="markdown">!torchrun --nproc<span class="hljs-emphasis">_per_</span>node=4 --master<span class="hljs-emphasis">_port=12341 -m examples.video2world_</span>gr00t \
--num<span class="hljs-emphasis">_gpus 4 Â  --model_</span>size 14B Â  --gr00t<span class="hljs-emphasis">_variant gr1 Â  \
--batch_</span>input<span class="hljs-emphasis">_json dream_</span>gen<span class="hljs-emphasis">_benchmark/gr1_</span>object/batch<span class="hljs-emphasis">_input.json Â  
--disable_</span>guardrail
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åœ¨å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œå¦‚ä½•ç»“åˆSpring Cloudå®ç°åŠ¨æ€æ•°æ®æºçš„è·¯ç”±ç®¡ç†ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7571306072422826026</link>    <guid>https://juejin.cn/post/7571306072422826026</guid>    <pubDate>2025-11-11T13:45:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571306072422826026" data-draft-id="7571299394345697322" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åœ¨å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œå¦‚ä½•ç»“åˆSpring Cloudå®ç°åŠ¨æ€æ•°æ®æºçš„è·¯ç”±ç®¡ç†ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-11T13:45:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ITæ©˜å­çš®"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åœ¨å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œå¦‚ä½•ç»“åˆSpring Cloudå®ç°åŠ¨æ€æ•°æ®æºçš„è·¯ç”±ç®¡ç†ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ITæ©˜å­çš®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T13:45:03.000Z" title="Tue Nov 11 2025 13:45:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œå®ç°åŠ¨æ€æ•°æ®æºè·¯ç”±æ˜¯åº”å¯¹å¤šç§Ÿæˆ·ã€åˆ†åº“åˆ†è¡¨ã€è¯»å†™åˆ†ç¦»ç­‰å¤æ‚åœºæ™¯çš„å…³é”®æŠ€æœ¯ã€‚å®ƒèƒ½æ˜¾è‘—æå‡ç³»ç»Ÿçš„çµæ´»æ€§ã€å¯æ‰©å±•æ€§å’Œæ•°æ®å¤„ç†èƒ½åŠ›ã€‚ä¸‹é¢æˆ‘å°†ä¸ºæ‚¨è¯¦ç»†è®²è§£å‡ ç§ä¸»æµçš„å®ç°æ–¹æ¡ˆã€‚</p>
<p>ä¸‹è¡¨å¯¹æ¯”äº†ä¸‰ç§ä¸»è¦çš„åŠ¨æ€æ•°æ®æºè·¯ç”±æ–¹æ¡ˆï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿäº†è§£å…¶æ ¸å¿ƒç‰¹ç‚¹ï¼š</p>

































<table><thead><tr><th>æ–¹æ¡ˆç±»å‹</th><th>æ ¸å¿ƒæœºåˆ¶</th><th>é€‚ç”¨åœºæ™¯</th><th>ä¼˜ç‚¹</th><th>è€ƒè™‘å› ç´ </th></tr></thead><tbody><tr><td><strong>åŸºäº<code>AbstractRoutingDataSource</code>çš„è‡ªå®šä¹‰è·¯ç”±</strong></td><td>ç»§æ‰¿SpringæŠ½è±¡ç±»ï¼Œé€šè¿‡ThreadLocalä¸Šä¸‹æ–‡å’ŒAOP/æ³¨è§£åŠ¨æ€è·¯ç”±</td><td>å¤šç§Ÿæˆ·ï¼ˆæŒ‰ç§Ÿæˆ·IDåˆ†åº“ï¼‰ã€ä¸šåŠ¡åˆ†åº“ã€éœ€è¦é«˜åº¦å®šåˆ¶åŒ–è·¯ç”±é€»è¾‘çš„åœºæ™¯</td><td>çµæ´»æ€§æé«˜ï¼Œä¸Springæ¡†æ¶åŸç”Ÿé›†æˆå¥½ï¼Œå¯å®Œå…¨æŒæ§è·¯ç”±é€»è¾‘</td><td>éœ€è‡ªè¡Œå®ç°å¤§éƒ¨åˆ†ä»£ç ï¼ˆå¦‚AOPã€ä¸Šä¸‹æ–‡ç®¡ç†ï¼‰ï¼Œå¤æ‚åº¦è¾ƒé«˜</td></tr><tr><td><strong>åŸºäº<code>dynamic-datasource-spring-boot-starter</code>ç»„ä»¶</strong></td><td>ä½¿ç”¨<code>@DS</code>æ³¨è§£åœ¨æ–¹æ³•æˆ–ç±»ä¸Šå£°æ˜å¼åˆ‡æ¢æ•°æ®æº</td><td>è¯»å†™åˆ†ç¦»ã€ä¸€ä¸»å¤šä»ã€å¤šç§ç±»å‹æ•°æ®åº“æ··åˆè¿æ¥</td><td>å¼€ç®±å³ç”¨ï¼Œé…ç½®ç®€å•ï¼Œå†…ç½®è´Ÿè½½å‡è¡¡ï¼Œæå¤§å‡å°‘ç¼–ç é‡</td><td>è·¯ç”±é€»è¾‘çš„å®šåˆ¶èƒ½åŠ›ä¸å¦‚è‡ªå®šä¹‰æ–¹æ¡ˆçµæ´»</td></tr><tr><td><strong>é›†æˆShardingSphereè¿›è¡Œåˆ†åº“åˆ†è¡¨</strong></td><td>ä½œä¸ºå®¢æˆ·ç«¯ä¸­é—´ä»¶ï¼Œåœ¨JDBCå±‚å¯¹SQLè¿›è¡Œè§£æã€è·¯ç”±ã€é‡å†™å’Œç»“æœå½’å¹¶</td><td>å¤§è§„æ¨¡æ•°æ®åˆ†ç‰‡ã€åˆ†åº“åˆ†è¡¨ã€è¯»å†™åˆ†ç¦»+æ•°æ®åˆ†ç‰‡ç­‰å¤æ‚åœºæ™¯</td><td>åŠŸèƒ½å¼ºå¤§ï¼Œå±è”½åº•å±‚æ•°æ®åº“å¤æ‚æ€§ï¼Œæ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡</td><td>æ¶æ„è¾ƒé‡ï¼Œå­¦ä¹ æ›²çº¿è¾ƒé™¡ï¼Œå¯¹SQLæœ‰ä¸€å®šé™åˆ¶ï¼ˆå¦‚ä¸æ”¯æŒè·¨åº“å…³è”ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-0">ğŸ’¡ æ–¹æ¡ˆä¸€ï¼šåŸºäº <code>AbstractRoutingDataSource</code>çš„è‡ªå®šä¹‰è·¯ç”±</h3>
<p>è¿™æ˜¯Springæ¡†æ¶æä¾›çš„åŸºç¡€èƒ½åŠ›ï¼Œéå¸¸é€‚åˆéœ€è¦ç²¾ç»†æ§åˆ¶è·¯ç”±é€»è¾‘çš„åœºæ™¯ï¼Œä¾‹å¦‚æ ¹æ®ç™»å½•ç”¨æˆ·ä¿¡æ¯æˆ–ç‰¹å®šçš„ä¸šåŠ¡è§„åˆ™æ¥é€‰æ‹©æ•°æ®åº“ã€‚</p>
<p><strong>å®ç°æ­¥éª¤</strong></p>
<ol>
<li>
<p><strong>å®šä¹‰æ•°æ®æºä¸Šä¸‹æ–‡æŒæœ‰è€…</strong>ï¼šä½¿ç”¨<code>ThreadLocal</code>æ¥ç¡®ä¿æ¯ä¸ªçº¿ç¨‹çš„æ•°æ®æºé€‰æ‹©æ˜¯éš”ç¦»çš„ï¼Œè¿™æ˜¯å®ç°åŠ¨æ€è·¯ç”±çš„æ ¸å¿ƒã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataSourceContextHolder</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-title class_">ThreadLocal</span>&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-variable constant_">CONTEXT_HOLDER</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setDataSourceType</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> dataSourceType</span>) {
        <span class="hljs-variable constant_">CONTEXT_HOLDER</span>.<span class="hljs-title function_">set</span>(dataSourceType);
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getDataSourceType</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">CONTEXT_HOLDER</span>.<span class="hljs-title function_">get</span>();
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">clearDataSourceType</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable constant_">CONTEXT_HOLDER</span>.<span class="hljs-title function_">remove</span>();
    }
}
</code></pre>
</li>
<li>
<p><strong>åˆ›å»ºåŠ¨æ€è·¯ç”±æ•°æ®æº</strong>ï¼šç»§æ‰¿<code>AbstractRoutingDataSource</code>å¹¶é‡å†™<code>determineCurrentLookupKey</code>æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-scala" lang="scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DynamicRoutingDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractRoutingDataSource</span> </span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-type">Object</span> determineCurrentLookupKey() {
        <span class="hljs-comment">// è¯¥æ–¹æ³•ä¼šåœ¨æ¯æ¬¡æ•°æ®åº“æ“ä½œå‰è¢«è°ƒç”¨ï¼Œå†³å®šä½¿ç”¨å“ªä¸ªæ•°æ®æº</span>
        <span class="hljs-keyword">return</span> <span class="hljs-type">DataSourceContextHolder</span>.getDataSourceType();
    }
}
</code></pre>
</li>
<li>
<p><strong>é…ç½®å¤šä¸ªæ•°æ®æºå¹¶å¯ç”¨è·¯ç”±</strong>ï¼šåœ¨é…ç½®ç±»ä¸­ï¼Œå°†å¤šä¸ªç›®æ ‡æ•°æ®æºï¼ˆå¦‚<code>masterDataSource</code>, <code>slaveDataSource</code>) æ³¨å…¥åˆ°ä¸€ä¸ªMapä¸­ï¼Œå¹¶è®¾ç½®ä¸ºåŠ¨æ€æ•°æ®æºçš„ç›®æ ‡æ•°æ®æºã€‚</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Configuration</span>
public class DataSourceConfig {
    <span class="hljs-variable">@Bean</span>
    <span class="hljs-variable">@Primary</span>
    public DataSource <span class="hljs-built_in">dynamicDataSource</span>(DataSource masterDataSource, DataSource slaveDataSource) {
        <span class="hljs-selector-tag">Map</span>&lt;<span class="hljs-selector-tag">Object</span>, <span class="hljs-selector-tag">Object</span>&gt; <span class="hljs-selector-tag">targetDataSources</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">HashMap</span>&lt;&gt;();
        <span class="hljs-selector-tag">targetDataSources</span><span class="hljs-selector-class">.put</span>(<span class="hljs-string">"master"</span>, masterDataSource);
        <span class="hljs-selector-tag">targetDataSources</span><span class="hljs-selector-class">.put</span>(<span class="hljs-string">"slave"</span>, slaveDataSource);

        <span class="hljs-selector-tag">DynamicRoutingDataSource</span> <span class="hljs-selector-tag">routingDataSource</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">DynamicRoutingDataSource</span>();
        <span class="hljs-selector-tag">routingDataSource</span><span class="hljs-selector-class">.setDefaultTargetDataSource</span>(masterDataSource); <span class="hljs-comment">// è®¾ç½®é»˜è®¤æ•°æ®æº</span>
        <span class="hljs-selector-tag">routingDataSource</span><span class="hljs-selector-class">.setTargetDataSources</span>(targetDataSources);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">routingDataSource</span>;
    }
}
</code></pre>
</li>
<li>
<p><strong>ä½¿ç”¨AOPå’Œè‡ªå®šä¹‰æ³¨è§£åˆ‡æ¢æ•°æ®æº</strong>ï¼šå¯ä»¥å®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼ˆå¦‚<code>@DataSource</code>ï¼‰ï¼Œç„¶åé€šè¿‡AOPåˆ‡é¢ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå‰æ ¹æ®æ³¨è§£å€¼åˆ‡æ¢æ•°æ®æºã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataSourceAspect</span> {
    <span class="hljs-meta">@Before("@annotation(dataSource)")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">beforeSwitchDataSource</span><span class="hljs-params">(JoinPoint joinPoint, DataSource dataSource)</span> {
        DataSourceContextHolder.setDataSourceType(dataSource.value());
    }
    <span class="hljs-meta">@After("@annotation(dataSource)")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterSwitchDataSource</span><span class="hljs-params">(JoinPoint joinPoint, DataSource dataSource)</span> {
        DataSourceContextHolder.clearDataSourceType(); <span class="hljs-comment">// æ¸…ç†ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</span>
    }
}
</code></pre>
</li>
</ol>
<h3 data-id="heading-1">ğŸš€ æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ <code>dynamic-datasource-spring-boot-starter</code>ç»„ä»¶</h3>
<p>å¯¹äºå¸¸è§çš„è¯»å†™åˆ†ç¦»ã€ä¸€ä¸»å¤šä»åœºæ™¯ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸é«˜æ•ˆçš„é€‰æ‹©ï¼Œå®ƒèƒ½è®©ä½ é€šè¿‡ç®€å•çš„é…ç½®å’Œæ³¨è§£å®Œæˆå·¥ä½œã€‚</p>
<p><strong>å®ç°æ­¥éª¤</strong></p>
<ol>
<li>
<p><strong>å¼•å…¥ä¾èµ–</strong>ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dynamic-datasource-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <span class="hljs-comment">&lt;!-- è¯·ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
</li>
<li>
<p><strong>é…ç½®æ•°æ®æº</strong>ï¼šåœ¨<code>application.yml</code>ä¸­é…ç½®ä¸»ä»æ•°æ®æºã€‚é…ç½®é¡¹ä»¥ä¸‹åˆ’çº¿<code>_</code>åˆ†å‰²ï¼Œç›¸åŒå‰ç¼€çš„æ•°æ®æºä¼šè¢«è‡ªåŠ¨åˆ†ç»„ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">dynamic:</span>
      <span class="hljs-attr">primary:</span> <span class="hljs-string">master</span> <span class="hljs-comment"># è®¾ç½®é»˜è®¤æ•°æ®æº</span>
      <span class="hljs-attr">strict:</span> <span class="hljs-literal">false</span>   <span class="hljs-comment"># æ˜¯å¦ä¸¥æ ¼åŒ¹é…æ•°æ®æº</span>
      <span class="hljs-attr">datasource:</span>
        <span class="hljs-attr">master:</span>
          <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://ip1:3306/db</span>
          <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
          <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>
        <span class="hljs-attr">slave_1:</span>
          <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://ip2:3306/db</span>
          <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
          <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>
        <span class="hljs-attr">slave_2:</span>
          <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://ip3:3306/db</span>
          <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
          <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>
</code></pre>
</li>
<li>
<p><strong>ä½¿ç”¨<code>@DS</code>æ³¨è§£åˆ‡æ¢</strong>ï¼šåœ¨Serviceå±‚çš„æ–¹æ³•æˆ–ç±»ä¸Šä½¿ç”¨<code>@DS</code>æ³¨è§£ï¼Œå³å¯è½»æ¾åˆ‡æ¢ã€‚ç»„ä»¶å†…ç½®äº†åŒç»„æ•°æ®æºçš„è´Ÿè½½å‡è¡¡ã€‚</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Service</span>
<span class="hljs-variable">@DS</span>(<span class="hljs-string">"slave"</span>) <span class="hljs-comment">// ç±»çº§åˆ«æ³¨è§£ï¼Œæ­¤ç±»ä¸‹æ‰€æœ‰æ–¹æ³•é»˜è®¤ä½¿ç”¨slaveç»„ï¼ˆéšæœºé€‰æ‹©slave_1æˆ–slave_2ï¼‰</span>
public class UserServiceImpl implements UserService {
    <span class="hljs-variable">@Override</span>
    <span class="hljs-variable">@DS</span>(<span class="hljs-string">"master"</span>) <span class="hljs-comment">// æ–¹æ³•çº§åˆ«æ³¨è§£ä¼˜å…ˆï¼Œæ­¤æ–¹æ³•ä½¿ç”¨masteræ•°æ®æº</span>
    public void <span class="hljs-built_in">updateUser</span>(User user) {
        <span class="hljs-comment">// ... æ›´æ–°æ“ä½œ</span>
    }
    <span class="hljs-variable">@Override</span>
    <span class="hljs-comment">// æœªæ ‡æ³¨ï¼Œä½¿ç”¨ç±»æ³¨è§£ï¼Œå³slaveç»„</span>
    public User <span class="hljs-built_in">getUserById</span>(Long id) {
        <span class="hljs-comment">// ... æŸ¥è¯¢æ“ä½œ</span>
    }
}
</code></pre>
</li>
</ol>
<h3 data-id="heading-2">ğŸ”§ æ–¹æ¡ˆä¸‰ï¼šé›†æˆ ShardingSphere è¿›è¡Œåˆ†åº“åˆ†è¡¨</h3>
<p>å½“å•åº“å•è¡¨æˆä¸ºæ€§èƒ½ç“¶é¢ˆæ—¶ï¼ŒShardingSphereæä¾›äº†å¼ºå¤§çš„åˆ†åº“åˆ†è¡¨ã€è¯»å†™åˆ†ç¦»åŠåˆ†å¸ƒå¼äº‹åŠ¡èƒ½åŠ›ã€‚</p>
<p><strong>æ ¸å¿ƒé…ç½®ç¤ºä¾‹</strong></p>
<p>å…¶é…ç½®æ ¸å¿ƒæ˜¯å®šä¹‰åˆ†ç‰‡è§„åˆ™ï¼Œä¾‹å¦‚æ ¹æ®ç”¨æˆ·IDï¼ˆ<code>user_id</code>ï¼‰è¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">shardingsphere:</span>
    <span class="hljs-attr">rules:</span>
      <span class="hljs-attr">sharding:</span>
        <span class="hljs-attr">tables:</span>
          <span class="hljs-attr">t_user:</span>
            <span class="hljs-comment"># æŒ‡å®šå®é™…çš„æ•°æ®èŠ‚ç‚¹ï¼Œè¡¨ç¤ºæ•°æ®åˆ†å¸ƒåœ¨ds0å’Œds1ä¸¤ä¸ªåº“ï¼Œæ¯ä¸ªåº“æœ‰t_user0åˆ°t_user3å››å¼ è¡¨</span>
            <span class="hljs-attr">actual-data-nodes:</span> <span class="hljs-string">ds$-&gt;{0..1}.t_user$-&gt;{0..3}</span>
            <span class="hljs-comment"># åˆ†åº“ç­–ç•¥</span>
            <span class="hljs-attr">database-strategy:</span>
              <span class="hljs-attr">standard:</span>
                <span class="hljs-attr">sharding-column:</span> <span class="hljs-string">user_id</span>
                <span class="hljs-attr">sharding-algorithm-name:</span> <span class="hljs-string">database-inline</span>
            <span class="hljs-comment"># åˆ†è¡¨ç­–ç•¥</span>
            <span class="hljs-attr">table-strategy:</span>
              <span class="hljs-attr">standard:</span>
                <span class="hljs-attr">sharding-column:</span> <span class="hljs-string">user_id</span>
                <span class="hljs-attr">sharding-algorithm-name:</span> <span class="hljs-string">table-inline</span>
        <span class="hljs-comment"># å®šä¹‰åˆ†ç‰‡ç®—æ³•</span>
        <span class="hljs-attr">sharding-algorithms:</span>
          <span class="hljs-attr">database-inline:</span>
            <span class="hljs-attr">type:</span> <span class="hljs-string">INLINE</span>
            <span class="hljs-attr">props:</span>
              <span class="hljs-attr">algorithm-expression:</span> <span class="hljs-string">ds$-&gt;{user_id</span> <span class="hljs-string">%</span> <span class="hljs-number">2</span><span class="hljs-string">}</span> <span class="hljs-comment"># åˆ†åº“ç®—æ³•ï¼šuser_id % 2</span>
          <span class="hljs-attr">table-inline:</span>
            <span class="hljs-attr">type:</span> <span class="hljs-string">INLINE</span>
            <span class="hljs-attr">props:</span>
              <span class="hljs-attr">algorithm-expression:</span> <span class="hljs-string">t_user$-&gt;{user_id</span> <span class="hljs-string">%</span> <span class="hljs-number">4</span><span class="hljs-string">}</span> <span class="hljs-comment"># åˆ†è¡¨ç®—æ³•ï¼šuser_id % 4</span>
</code></pre>
<h3 data-id="heading-3">âš ï¸ å…³é”®æ³¨æ„äº‹é¡¹ä¸å®è·µå»ºè®®</h3>
<p>æ— è®ºé€‰æ‹©å“ªç§æ–¹æ¡ˆï¼Œä»¥ä¸‹å‡ ç‚¹éƒ½éœ€è¦ç‰¹åˆ«å…³æ³¨ï¼š</p>
<ul>
<li><strong>äº‹åŠ¡ç®¡ç†</strong>ï¼šåœ¨ä½¿ç”¨äº†åŠ¨æ€æ•°æ®æºåˆ‡æ¢çš„æ–¹æ³•ä¸­ï¼Œå°¤å…¶æ˜¯è·¨ä¸åŒç‰©ç†æ•°æ®åº“çš„æ“ä½œï¼Œ<strong>éœ€è¦è°¨æ…å¤„ç†äº‹åŠ¡</strong>ã€‚Springçš„<code>@Transactional</code>æ³¨è§£é€šå¸¸åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ä¼šä½¿ç”¨åŒä¸€ä¸ªæ•°æ®æºè¿æ¥ã€‚å¦‚æœéœ€è¦åœ¨äº‹åŠ¡ä¸­åˆ‡æ¢æ•°æ®æºï¼Œå¯èƒ½éœ€è¦æ›´å¤æ‚çš„å¤„ç†ï¼Œä¾‹å¦‚ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆJTAï¼‰ã€‚</li>
<li><strong>è¿æ¥æ± é…ç½®</strong>ï¼šä¸ºæ¯ä¸ªæ•°æ®æºé…ç½®åˆé€‚çš„è¿æ¥æ± å‚æ•°ï¼ˆå¦‚<code>HikariCP</code>æˆ–<code>Druid</code>çš„<code>maximum-pool-size</code>, <code>connection-timeout</code>ï¼‰ï¼Œè¿™å¯¹ç³»ç»Ÿæ€§èƒ½å’Œç¨³å®šæ€§è‡³å…³é‡è¦ã€‚</li>
<li><strong>é…ç½®ä¿¡æ¯åŠ å¯†ä¸å®‰å…¨</strong>ï¼šç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ•°æ®åº“å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯ä¸åº”æ˜æ–‡å†™åœ¨é…ç½®æ–‡ä»¶ä¸­ã€‚å¯ä»¥ä½¿ç”¨<code>Jasypt</code>ç­‰å·¥å…·è¿›è¡ŒåŠ å¯†ï¼Œæˆ–ç»“åˆSpring Cloud Configã€Nacosç­‰<strong>é…ç½®ä¸­å¿ƒ</strong>ç»Ÿä¸€ç®¡ç†åŠ å¯†åçš„é…ç½®ã€‚</li>
<li><strong>é“¾è·¯è¿½è¸ªä¸ç›‘æ§</strong>ï¼šåœ¨å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œä¸€ä¸ªè¯·æ±‚å¯èƒ½æ¶‰åŠå¤šä¸ªæ•°æ®æºçš„æ“ä½œã€‚å¯ä»¥é›†æˆ<strong>Spring Cloud Sleuth</strong>ç­‰ç»„ä»¶ï¼Œå°†æ•°æ®æºåˆ‡æ¢çš„å…³é”®ä¿¡æ¯ï¼ˆå¦‚æ•°æ®æºåç§°ï¼‰æ·»åŠ åˆ°é“¾è·¯è¿½è¸ªçš„Spanæ ‡ç­¾ä¸­ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥å’Œæ€§èƒ½åˆ†æã€‚</li>
</ul>
<h3 data-id="heading-4">ğŸ’ æ€»ç»“ä¸é€‰æ‹©</h3>
<p>é€‰æ‹©å“ªç§æ–¹æ¡ˆï¼Œæœ€ç»ˆå–å†³äºæ‚¨çš„å…·ä½“ä¸šåŠ¡éœ€æ±‚å’ŒæŠ€æœ¯è€ƒé‡ï¼š</p>
<ul>
<li>å¦‚æœåªæ˜¯ç®€å•çš„<strong>è¯»å†™åˆ†ç¦»</strong>æˆ–<strong>ä¸€ä¸»å¤šä»</strong>ï¼Œè¿½æ±‚å¿«é€Ÿå®ç°ï¼Œ<strong><code>dynamic-datasource-spring-boot-starter</code>ç»„ä»¶æ˜¯é¦–é€‰</strong>ã€‚</li>
<li>å¦‚æœè·¯ç”±é€»è¾‘éå¸¸<strong>ä¸ªæ€§åŒ–</strong>ï¼ˆå¦‚æ ¹æ®å¤æ‚ä¸šåŠ¡è§„åˆ™é€‰æ‹©æ•°æ®åº“ï¼‰ï¼Œé‚£ä¹ˆåŸºäº <strong><code>AbstractRoutingDataSource</code>çš„è‡ªå®šä¹‰è·¯ç”±</strong>æä¾›äº†æœ€å¤§çš„çµæ´»æ€§ã€‚</li>
<li>å¦‚æœé¢ä¸´<strong>æµ·é‡æ•°æ®</strong>ï¼Œéœ€è¦è¿›è¡Œ<strong>åˆ†åº“åˆ†è¡¨</strong>ï¼Œé‚£ä¹ˆ<strong>ShardingSphere</strong>æ˜¯æ›´ä¸“ä¸šå’Œå¼ºå¤§çš„é€‰æ‹©ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŠ¨æ€æ•°æ®æºåˆ‡æ¢ä¸Seataåˆ†å¸ƒå¼äº‹åŠ¡å¦‚ä½•ååŒå·¥ä½œï¼Ÿ]]></title>    <link>https://juejin.cn/post/7571304204754698294</link>    <guid>https://juejin.cn/post/7571304204754698294</guid>    <pubDate>2025-11-11T13:47:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571304204754698294" data-draft-id="7571299394345713706" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŠ¨æ€æ•°æ®æºåˆ‡æ¢ä¸Seataåˆ†å¸ƒå¼äº‹åŠ¡å¦‚ä½•ååŒå·¥ä½œï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-11T13:47:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ITæ©˜å­çš®"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŠ¨æ€æ•°æ®æºåˆ‡æ¢ä¸Seataåˆ†å¸ƒå¼äº‹åŠ¡å¦‚ä½•ååŒå·¥ä½œï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ITæ©˜å­çš®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T13:47:13.000Z" title="Tue Nov 11 2025 13:47:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒåŠ¨æ€æ•°æ®æºåˆ‡æ¢ä¸Seataåˆ†å¸ƒå¼äº‹åŠ¡çš„ååŒå·¥ä½œï¼Œç¡®å®æ˜¯ä¸€ä¸ªæ—¢é‡è¦åˆç²¾å¦™çš„è¯é¢˜ã€‚ç®€å•æ¥è¯´ï¼Œ<strong>åŠ¨æ€æ•°æ®æºåˆ‡æ¢è§£å†³äº†â€œå»å“ªå„¿æ“ä½œâ€çš„é—®é¢˜ï¼Œè€ŒSeataåˆ™ç¡®ä¿äº†åœ¨ä¸åŒâ€œåœ°æ–¹â€çš„æ“ä½œèƒ½ä¿æŒåŸå­æ€§</strong>ã€‚ä¸‹é¢æˆ‘ä»¬æ·±å…¥æ¢è®¨å®ƒä»¬æ˜¯å¦‚ä½•ååŒå·¥ä½œçš„ã€‚</p>
<p>ä¸ºäº†å¸®åŠ©ä½ å¿«é€Ÿæ„å»ºèµ·æ•´ä½“è®¤çŸ¥ï¼Œä¸‹è¡¨æ¦‚æ‹¬äº†ååŒå·¥ä½œçš„æ ¸å¿ƒæœºåˆ¶ä¸å…³é”®ç‚¹ã€‚</p>

























<table><thead><tr><th>ååŒå±‚é¢</th><th>æ ¸å¿ƒæœºåˆ¶</th><th>å…³é”®å®ç°ç‚¹</th></tr></thead><tbody><tr><td><strong>æ•°æ®æºç®¡ç†</strong></td><td><strong>ä»£ç†ä¸è·¯ç”±ç»“åˆ</strong></td><td>Seataé€šè¿‡<code>DataSourceProxy</code>ä»£ç†åº•å±‚ç‰©ç†æ•°æ®æºï¼Œè€ŒåŠ¨æ€æ•°æ®æºè·¯ç”±å™¨ï¼ˆå¦‚<code>AbstractRoutingDataSource</code>ï¼‰è´Ÿè´£ç®¡ç†å¤šä¸ªè¢«ä»£ç†çš„æ•°æ®æºï¼Œå¹¶æ ¹æ®è§„åˆ™é€‰æ‹©ã€‚</td></tr><tr><td><strong>äº‹åŠ¡ä¸Šä¸‹æ–‡ä¼ æ’­</strong></td><td><strong>XIDé“¾è·¯ä¼ é€’</strong></td><td>é€šè¿‡æ‹¦æˆªå™¨å°†Seataçš„å…¨å±€äº‹åŠ¡IDï¼ˆXIDï¼‰åœ¨æœåŠ¡è°ƒç”¨é“¾è·¯ï¼ˆå¦‚é€šè¿‡Feignï¼‰ä¸­ä¼ é€’ï¼Œç¡®ä¿å¤šä¸ªæ•°æ®æºæ“ä½œå±äºåŒä¸€å…¨å±€äº‹åŠ¡ã€‚</td></tr><tr><td><strong>åˆ†æ”¯äº‹åŠ¡ç®¡ç†</strong></td><td><strong>RMè‡ªåŠ¨æ³¨å†Œ</strong></td><td>å½“ä¸šåŠ¡æ–¹æ³•é€šè¿‡åŠ¨æ€æ•°æ®æºåˆ‡æ¢åˆ°æŸä¸ªå…·ä½“æ•°æ®æºå¹¶æ‰§è¡ŒSQLæ—¶ï¼Œè¯¥æ•°æ®æºå¯¹åº”çš„Seata <code>Resource Manager</code>(RM) ä¼šè‡ªåŠ¨å‘äº‹åŠ¡åè°ƒå™¨(TC)æ³¨å†Œä¸ºä¸€ä¸ªåˆ†æ”¯äº‹åŠ¡ã€‚</td></tr></tbody></table>
<h3 data-id="heading-0">âš™ï¸ ååŒå·¥ä½œåŸç†è¯¦è§£</h3>
<p>ç†è§£äº†æ•´ä½“æ¡†æ¶åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒä»¬å†…éƒ¨æ˜¯å¦‚ä½•å…·ä½“é…åˆçš„ã€‚</p>
<ol>
<li>
<p><strong>æ•°æ®æºä»£ç†ï¼šSeataä»‹å…¥çš„åŸºçŸ³</strong></p>
<p>Seataï¼ˆé€šå¸¸æ˜¯ATæ¨¡å¼ï¼‰èƒ½å¤Ÿç®¡ç†ä¸€ä¸ªæ•°æ®åº“æ“ä½œçš„å‰æï¼Œæ˜¯å®ƒèƒ½å¤Ÿâ€œçœ‹åˆ°â€å¹¶â€œè®°å½•â€è¿™ä¸ªæ“ä½œã€‚è¿™æ˜¯é€šè¿‡<code>DataSourceProxy</code>å®ç°çš„ã€‚å®ƒåŒ…è£…äº†çœŸå®çš„æ•°æ®æºï¼Œä»è€Œå¯ä»¥æ‹¦æˆªæ‰€æœ‰SQLè¯­å¥ï¼Œè‡ªåŠ¨ç”Ÿæˆå›æ»šæ—¥å¿—ï¼ˆ<code>undo_log</code>ï¼‰å¹¶ä¸TCäº¤äº’ã€‚åœ¨å¤šæ•°æ®æºåœºæ™¯ä¸‹ï¼Œ<strong>æ¯ä¸€ä¸ªç‰©ç†æ•°æ®æºï¼ˆæ— è®ºæ˜¯masterè¿˜æ˜¯slaveï¼‰éƒ½éœ€è¦è¢«Seataçš„<code>DataSourceProxy</code>ä»£ç†</strong>ã€‚</p>
</li>
<li>
<p><strong>åŠ¨æ€è·¯ç”±ï¼šæ­£ç¡®é€‰æ‹©çš„ä¿éšœ</strong></p>
<p>ä½ çš„ä¸šåŠ¡ä»£ç ä¸Šå¯èƒ½é€šè¿‡<code>@DS("slave")</code>è¿™æ ·çš„æ³¨è§£ï¼Œæˆ–é€šè¿‡AOPé€»è¾‘ï¼Œåœ¨è¿è¡Œæ—¶å†³å®šä½¿ç”¨å“ªä¸ªæ•°æ®æºæ ‡è¯†ï¼ˆä¾‹å¦‚"master", "slave1"ï¼‰ã€‚åŠ¨æ€æ•°æ®æºè·¯ç”±å™¨ï¼ˆå¦‚ç»§æ‰¿<code>AbstractRoutingDataSource</code>çš„è‡ªå®šä¹‰ç±»ï¼‰çš„<code>determineCurrentLookupKey()</code>æ–¹æ³•ä¼šè¿”å›è¿™ä¸ªæ ‡è¯†ï¼Œå¹¶ä»ç›®æ ‡æ•°æ®æºMapä¸­å–å‡ºå¯¹åº”çš„æ•°æ®æºã€‚å…³é”®åœ¨äºï¼Œè¿™ä¸ªMapé‡Œå­˜æ”¾çš„<strong>ä¸æ˜¯åŸå§‹çš„<code>DataSource</code>ï¼Œè€Œæ˜¯å·²ç»è¢«Seataä»£ç†åçš„<code>DataSourceProxy</code></strong>ã€‚è¿™æ ·å°±ç¡®ä¿äº†æ— è®ºè·¯ç”±åˆ°å“ªä¸ªæ•°æ®æºï¼Œå…¶æ“ä½œéƒ½èƒ½è¢«Seataç®¡ç†ã€‚</p>
</li>
<li>
<p><strong>å…¨å±€äº‹åŠ¡ï¼šç»Ÿä¸€åè°ƒçš„æ¡†æ¶</strong></p>
<p>åœ¨ä¸šåŠ¡å…¥å£æ–¹æ³•ä¸Šæ ‡æ³¨çš„<code>@GlobalTransactional</code>æ³¨è§£ï¼Œæ˜¯å…¨å±€äº‹åŠ¡çš„â€œå¼€å…³â€ã€‚å®ƒä¼šå‘Šè¯‰Seataçš„<code>Transaction Manager</code>(TM)å¼€å§‹ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå¹¶ç”Ÿæˆå…¨å±€å”¯ä¸€çš„XIDã€‚è¿™ä¸ªXIDä¼šé€šè¿‡çº¿ç¨‹ä¸Šä¸‹æ–‡ä¼ æ’­ã€‚</p>
</li>
</ol>
<h3 data-id="heading-1">ğŸ”§ å®ç°æ­¥éª¤ä¸é…ç½®è¦ç‚¹</h3>
<p>è¦å°†ä¸¤è€…æˆåŠŸé›†æˆï¼Œä»¥ä¸‹æ­¥éª¤å’Œé…ç½®æ˜¯å…³é”®ï¼š</p>
<ol>
<li>
<p><strong>é…ç½®Seata TC Server</strong>ï¼šéœ€è¦å…ˆå¯åŠ¨Seataçš„æœåŠ¡ç«¯ï¼ˆTransaction Coordinatorï¼‰ï¼Œå®ƒè´Ÿè´£åè°ƒæ‰€æœ‰å…¨å±€äº‹åŠ¡ã€‚é€šå¸¸éœ€è¦é…ç½®å…¶æ³¨å†Œä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒï¼ˆå¦‚Nacosã€Fileç­‰ï¼‰ã€‚</p>
</li>
<li>
<p><strong>å¼•å…¥å®¢æˆ·ç«¯ä¾èµ–</strong>ï¼šåœ¨å¾®æœåŠ¡é¡¹ç›®ä¸­å¼•å…¥Seataçš„Spring Cloud Starterä¾èµ–ã€‚</p>
</li>
<li>
<p><strong>é…ç½®å¤šæ•°æ®æºä¸ä»£ç†</strong>ï¼šè¿™æ˜¯æœ€æ ¸å¿ƒçš„ä¸€æ­¥ã€‚åœ¨ä½ çš„é…ç½®ç±»ä¸­ï¼Œéœ€è¦åˆ›å»ºå¤šä¸ªçœŸå®æ•°æ®æºï¼Œç„¶ååˆ†åˆ«ç”¨<code>DataSourceProxy</code>å¯¹å®ƒä»¬è¿›è¡ŒåŒ…è£…ï¼Œæœ€åå°†è¿™äº›ä»£ç†åçš„æ•°æ®æºè®¾ç½®åˆ°åŠ¨æ€æ•°æ®æºçš„è·¯ç”±ç›®æ ‡Mapä¸­ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> <span class="hljs-title class_">DataSource</span> <span class="hljs-title function_">dynamicDataSource</span>(<span class="hljs-params">DataSource masterDataSource, DataSource slaveDataSource</span>) {
    <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">Object</span>, <span class="hljs-title class_">Object</span>&gt; targetDataSources = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    <span class="hljs-comment">// å…³é”®ï¼šå°†çœŸå®æ•°æ®æºåŒ…è£…ä¸ºSeataçš„ä»£ç†æ•°æ®æº</span>
    targetDataSources.<span class="hljs-title function_">put</span>(<span class="hljs-string">"master"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataSourceProxy</span>(masterDataSource));
    targetDataSources.<span class="hljs-title function_">put</span>(<span class="hljs-string">"slave"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataSourceProxy</span>(slaveDataSource));

    <span class="hljs-title class_">YourDynamicRoutingDataSource</span> dynamicDataSource = <span class="hljs-keyword">new</span> <span class="hljs-title class_">YourDynamicRoutingDataSource</span>();
    dynamicDataSource.<span class="hljs-title function_">setTargetDataSources</span>(targetDataSources);
    dynamicDataSource.<span class="hljs-title function_">setDefaultTargetDataSource</span>(targetDataSources.<span class="hljs-title function_">get</span>(<span class="hljs-string">"master"</span>));
    <span class="hljs-keyword">return</span> dynamicDataSource;
}
</code></pre>
</li>
<li>
<p><strong>åˆ›å»ºUndo_logè¡¨</strong>ï¼šåœ¨Seataçš„ATæ¨¡å¼ä¸‹ï¼Œæ¯ä¸€ä¸ªä¸šåŠ¡æ•°æ®åº“ä¸­éƒ½éœ€è¦åˆ›å»º<code>undo_log</code>è¡¨ï¼Œç”¨äºè®°å½•æ•°æ®ä¿®æ”¹å‰çš„é•œåƒï¼Œä»¥ä¾¿å›æ»šã€‚</p>
</li>
<li>
<p><strong>ä½¿ç”¨æ³¨è§£</strong>ï¼šåœ¨éœ€è¦å¼€å¯åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸šåŠ¡å…¥å£æ–¹æ³•ä¸Šä½¿ç”¨<code>@GlobalTransactional</code>ã€‚åœ¨éœ€è¦åˆ‡æ¢æ•°æ®æºçš„æ–¹æ³•æˆ–ç±»ä¸Šä½¿ç”¨ç›¸åº”çš„æ³¨è§£ï¼ˆå¦‚<code>@DS</code>ï¼‰ã€‚</p>
</li>
</ol>
<h3 data-id="heading-2">âš ï¸ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h3>
<p>ååŒå·¥ä½œè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°ä¸€äº›â€œå‘â€ï¼Œä»¥ä¸‹æ˜¯æœ€å¸¸è§çš„å‡ ç§åŠåº”å¯¹æ–¹æ³•ï¼š</p>

























<table><thead><tr><th>å¸¸è§é—®é¢˜</th><th>ç°è±¡</th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><strong>æ•°æ®æºåˆ‡æ¢åäº‹åŠ¡ä¸ç”Ÿæ•ˆ</strong></td><td>äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸æ•°æ®æºç»‘å®šå…³ç³»ä¸¢å¤±ï¼Œéƒ¨åˆ†æ“ä½œæœªå›æ»šã€‚</td><td>ç¡®ä¿æ•°æ®æºåˆ‡æ¢æ“ä½œåœ¨<code>@GlobalTransactional</code>æ³¨è§£çš„æ–¹æ³•å†…éƒ¨è¿›è¡Œï¼Œå¹¶æ£€æŸ¥æ•°æ®æºä»£ç†é…ç½®æ˜¯å¦æ­£ç¡®ã€‚</td></tr><tr><td><strong>å…¨å±€å¼‚å¸¸è¢«â€œåæ‰â€</strong></td><td>æœåŠ¡å†…éƒ¨å¼‚å¸¸è¢«å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼ˆ<code>@RestControllerAdvice</code>ï¼‰æ•è·å¹¶è¿”å›å‹å¥½ä¿¡æ¯ï¼Œå¯¼è‡´ä¸Šæ¸¸æœåŠ¡æ— æ³•æ„ŸçŸ¥å¼‚å¸¸ï¼Œå…¨å±€äº‹åŠ¡ä¸å›æ»šã€‚</td><td>åœ¨å…¨å±€å¼‚å¸¸å¤„ç†å™¨ä¸­ï¼Œå¯¹äºéœ€è¦åˆ†å¸ƒå¼äº‹åŠ¡å›æ»šçš„å¼‚å¸¸ï¼Œéœ€è¦å†æ¬¡æŠ›å‡ºåŸå§‹å¼‚å¸¸æˆ–è°ƒç”¨<code>TransactionContextHolder.clear()</code>å¹¶æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸ã€‚</td></tr><tr><td><strong>å¤šæ•°æ®æºé…ç½®å†²çª</strong></td><td>ä¸MyBatis-Plusçš„<code>dynamic-datasource-spring-boot-starter</code>ç­‰ç»„ä»¶é›†æˆæ—¶ï¼Œäº‹åŠ¡ç®¡ç†å™¨é…ç½®ä¸å½“å¯¼è‡´å¤±æ•ˆã€‚</td><td>ç¡®ä¿ä½¿ç”¨äº†æ”¯æŒå¤šæ•°æ®æºäº‹åŠ¡çš„æ³¨è§£ï¼ˆå¦‚Seataçš„<code>@GlobalTransactional</code>ï¼‰ï¼Œå¹¶æ­£ç¡®é…ç½®äº†Seataçš„æ•°æ®æºä»£ç†ã€‚</td></tr></tbody></table>
<h3 data-id="heading-3">ğŸ’ æ ¸å¿ƒæ€»ç»“</h3>
<p>æ€»è€Œè¨€ä¹‹ï¼ŒåŠ¨æ€æ•°æ®æºåˆ‡æ¢ä¸Seataçš„ååŒï¼Œæœ¬è´¨ä¸Šæ˜¯<strong>å°†åŠ¨æ€è·¯ç”±èƒ½åŠ›ç½®äºSeataçš„å…¨å±€äº‹åŠ¡ç®¡è¾–ä¹‹ä¸‹</strong>ã€‚Seataé€šè¿‡ä»£ç†æ•°æ®æºæ¥â€œç›‘æ§â€å’Œâ€œç®¡ç†â€æ‰€æœ‰æ•°æ®åº“æ“ä½œï¼Œè€ŒåŠ¨æ€æ•°æ®æºåˆ™ç¡®ä¿æ“ä½œè¢«è·¯ç”±åˆ°æ­£ç¡®çš„ã€å·²è¢«ä»£ç†çš„æ•°æ®æºä¸Šã€‚å®ç°æ­¤é›†æˆçš„å…³é”®åœ¨äº<strong>æ­£ç¡®ä»£ç†æ‰€æœ‰æ•°æ®æº</strong>ï¼Œå¹¶<strong>å¦¥å–„å¤„ç†äº‹åŠ¡ä¸Šä¸‹æ–‡çš„ä¼ æ’­</strong>ï¼ŒåŒæ—¶ç•™æ„å¸¸è§çš„é…ç½®é™·é˜±ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[npmå‘½ä»¤è¯¦è§£]]></title>    <link>https://juejin.cn/post/7571191453126115354</link>    <guid>https://juejin.cn/post/7571191453126115354</guid>    <pubDate>2025-11-11T09:47:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571191453126115354" data-draft-id="7571278865516724274" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="npmå‘½ä»¤è¯¦è§£"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-11T09:47:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å€šæ å¬é£é›¨"/> <meta itemprop="url" content="https://juejin.cn/user/2682464103830750"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            npmå‘½ä»¤è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2682464103830750/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å€šæ å¬é£é›¨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T09:47:18.000Z" title="Tue Nov 11 2025 09:47:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ç‰›é€¼è§†é¢‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1Nx4118788%3Fspm_id_from%3D333.788.videopod.episodes%26vd_source%3Da27417abea09816580246ed454cd87e0" target="_blank" title="https://www.bilibili.com/video/BV1Nx4118788?spm_id_from=333.788.videopod.episodes&amp;vd_source=a27417abea09816580246ed454cd87e0" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1Nxâ€¦</a></p>
<h3 data-id="heading-0">1. ä»€ä¹ˆæ˜¯ npmï¼Ÿ</h3>
<p><strong>npm</strong>Â æœ‰ä¸¤å±‚å«ä¹‰ï¼š</p>
<ol>
<li><strong>ä¸€ä¸ªåœ¨çº¿ä»“åº“</strong>ï¼šå…¨çƒæœ€å¤§çš„å¼€æº JavaScript ä»£ç åº“ï¼Œå¼€å‘è€…å¯ä»¥åˆ†äº«å’Œå€Ÿç”¨å„ç§ä»£ç åŒ…ï¼ˆpackageï¼‰ã€‚</li>
<li><strong>ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·</strong>ï¼šNode.js çš„é»˜è®¤åŒ…ç®¡ç†å™¨ï¼Œç”¨äºä¸è¿™ä¸ªåœ¨çº¿ä»“åº“äº¤äº’ï¼Œå¸®åŠ©ä½ å®‰è£…ã€ç®¡ç†é¡¹ç›®ä¾èµ–ã€‚</li>
</ol>
<p>å½“ä½ å®‰è£… Node.js æ—¶ï¼Œnpm ä¼šè‡ªåŠ¨è¢«ä¸€èµ·å®‰è£…ã€‚</p>
<hr/>
<h3 data-id="heading-1">2. æ ¸å¿ƒæ¦‚å¿µ</h3>
<ul>
<li><strong><code>package.json</code></strong>ï¼šé¡¹ç›®çš„â€œèº«ä»½è¯â€å’Œâ€œèœå•â€ï¼Œè®°å½•äº†é¡¹ç›®åç§°ã€ç‰ˆæœ¬ã€ä¾èµ–åŒ…ç­‰ä¿¡æ¯ã€‚å®ƒæ˜¯ npm æ“ä½œçš„æ ¸å¿ƒã€‚</li>
<li><strong><code>node_modules</code></strong>ï¼šä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ‰€æœ‰é€šè¿‡ npm å®‰è£…çš„åŒ…åŠå…¶ä¾èµ–éƒ½ä¼šå­˜æ”¾åœ¨è¿™é‡Œã€‚é€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ï¼Œä¹Ÿä¸åº”è¯¥æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆå¦‚ Gitï¼‰ã€‚</li>
<li><strong><code>package-lock.json</code></strong>Â æˆ–Â <strong><code>npm-shrinkwrap.json</code></strong>ï¼šç²¾ç¡®æè¿°å½“å‰å®‰è£…çš„ä¾èµ–æ ‘ç‰ˆæœ¬ï¼Œç¡®ä¿å›¢é˜Ÿåä½œå’Œéƒ¨ç½²æ—¶å®‰è£…å®Œå…¨ä¸€è‡´çš„åŒ…ã€‚<strong>å»ºè®®æäº¤åˆ°ç‰ˆæœ¬åº“</strong>ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-2">3. npm å‘½ä»¤è¯¦è§£ï¼ˆæŒ‰åŠŸèƒ½åˆ†ç±»ï¼‰</h3>
<h4 data-id="heading-3">A. é¡¹ç›®åˆå§‹åŒ–ä¸é…ç½®</h4>

























<table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th><th>ç¤ºä¾‹ä¸è¯´æ˜</th></tr></thead><tbody><tr><td><code>npm init</code></td><td>äº¤äº’å¼åœ°åˆ›å»ºä¸€ä¸ªæ–°çš„Â <code>package.json</code>Â æ–‡ä»¶ã€‚</td><td><code>npm init</code></td></tr><tr><td><code>npm init -y</code>Â /Â <code>--yes</code></td><td>ä½¿ç”¨é»˜è®¤å€¼å¿«é€Ÿåˆ›å»ºÂ <code>package.json</code>ï¼Œè·³è¿‡æ‰€æœ‰æé—®ã€‚</td><td><code>npm init -y</code></td></tr><tr><td><code>npm config</code></td><td>ç®¡ç† npm çš„é…ç½®ã€‚</td><td>-Â <code>npm config list</code>ï¼šæŸ¥çœ‹å½“å‰é…ç½® -Â <code>npm config set &lt;key&gt; &lt;value&gt;</code>ï¼šè®¾ç½®é…ç½®ï¼Œå¦‚Â <code>npm config set registry https://registry.npmmirror.com</code>ï¼ˆè®¾ç½®æ·˜å®é•œåƒï¼‰ -Â <code>npm config get &lt;key&gt;</code>ï¼šè·å–é…ç½®</td></tr></tbody></table>
<h4 data-id="heading-4">B. åŒ…ï¼ˆä¾èµ–ï¼‰çš„å®‰è£…</h4>
<p>è¿™æ˜¯ npm æœ€æ ¸å¿ƒçš„åŠŸèƒ½ã€‚ä¾èµ–åˆ†ä¸ºä¸¤ç§ï¼š</p>
<ul>
<li><strong>ç”Ÿäº§ä¾èµ–</strong>ï¼šé¡¹ç›®è¿è¡Œæ—¶å¿…é¡»çš„åŒ…ï¼ˆå¦‚Â <code>react</code>,Â <code>express</code>ï¼‰ï¼Œä¼šå‡ºç°åœ¨Â <code>dependencies</code>Â å­—æ®µã€‚</li>
<li><strong>å¼€å‘ä¾èµ–</strong>ï¼šä»…åœ¨å¼€å‘é˜¶æ®µéœ€è¦çš„åŒ…ï¼ˆå¦‚Â <code>webpack</code>,Â <code>eslint</code>,Â <code>jest</code>ï¼‰ï¼Œä¼šå‡ºç°åœ¨Â <code>devDependencies</code>Â å­—æ®µã€‚</li>
</ul>













































<table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th><th>ç¤ºä¾‹ä¸è¯´æ˜</th></tr></thead><tbody><tr><td><code>npm install</code>Â (æˆ–Â <code>npm i</code>)</td><td>æ ¹æ®Â <code>package.json</code>Â å®‰è£…æ‰€æœ‰ä¾èµ–ã€‚</td><td>åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼Œä¼šåˆ›å»ºÂ <code>node_modules</code>Â å¹¶å®‰è£…æ‰€æœ‰Â <code>dependencies</code>Â å’ŒÂ <code>devDependencies</code>ã€‚</td></tr><tr><td><code>npm install &lt;package_name&gt;</code></td><td>å®‰è£…ä¸€ä¸ªåŒ…ï¼Œå¹¶è‡ªåŠ¨æ·»åŠ åˆ°Â <code>package.json</code>Â çš„Â <code>dependencies</code>ã€‚</td><td><code>npm install lodash</code></td></tr><tr><td><code>npm install &lt;package_name&gt; --save-dev</code>Â (æˆ–Â <code>-D</code>)</td><td>å®‰è£…ä¸€ä¸ªåŒ…ï¼Œå¹¶æ·»åŠ åˆ°Â <code>package.json</code>Â çš„Â <code>devDependencies</code>ã€‚</td><td><code>npm install eslint --save-dev</code></td></tr><tr><td><code>npm install &lt;package_name&gt; --global</code>Â (æˆ–Â <code>-g</code>)</td><td><strong>å…¨å±€å®‰è£…</strong>ä¸€ä¸ªåŒ…ï¼ˆé€šå¸¸æ˜¯å‘½ä»¤è¡Œå·¥å…·ï¼‰ã€‚</td><td><code>npm install @vue/cli -g</code>ï¼ˆä¹‹åå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨Â <code>vue</code>Â å‘½ä»¤ï¼‰</td></tr><tr><td><code>npm install &lt;package_name&gt;@&lt;version&gt;</code></td><td>å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„åŒ…ã€‚</td><td><code>npm install react@18.2.0</code></td></tr><tr><td><code>npm install &lt;package_name&gt;@latest</code></td><td>å®‰è£…åŒ…çš„æœ€æ–°ç‰ˆæœ¬ã€‚</td><td><code>npm install webpack@latest</code></td></tr><tr><td><code>npm ci</code></td><td><strong>æ¸…æ´å®‰è£…</strong>ï¼Œç”¨äºè‡ªåŠ¨åŒ–ç¯å¢ƒï¼ˆå¦‚ CI/CDï¼‰ã€‚å®ƒä¾èµ–Â <code>package-lock.json</code>ï¼Œå®‰è£…é€Ÿåº¦æ›´å¿«ã€æ›´ä¸¥æ ¼ï¼Œä½†ä¸ä¼šæ›´æ–°é”æ–‡ä»¶ã€‚</td><td><code>npm ci</code></td></tr></tbody></table>
<h4 data-id="heading-5">C. ä¾èµ–ç®¡ç†ä¸æ›´æ–°</h4>



































<table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th><th>ç¤ºä¾‹ä¸è¯´æ˜</th></tr></thead><tbody><tr><td><code>npm update</code></td><td>æ›´æ–°æ‰€æœ‰åŒ…åˆ°Â <code>package.json</code>Â ä¸­å…è®¸çš„æœ€æ–°ç‰ˆæœ¬ï¼ˆéµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬è§„åˆ™ï¼‰ã€‚</td><td><code>npm update</code></td></tr><tr><td><code>npm update &lt;package_name&gt;</code></td><td>æ›´æ–°æŒ‡å®šçš„åŒ…ã€‚</td><td><code>npm update lodash</code></td></tr><tr><td><code>npm outdated</code></td><td>æ£€æŸ¥æœ‰å“ªäº›è¿‡æ—¶çš„åŒ…ã€‚</td><td>ä¼šåˆ—å‡ºå½“å‰ç‰ˆæœ¬ã€æœŸæœ›ç‰ˆæœ¬å’Œæœ€æ–°ç‰ˆæœ¬ã€‚</td></tr><tr><td><code>npm uninstall &lt;package_name&gt;</code>Â (æˆ–Â <code>npm un</code>)</td><td>å¸è½½ä¸€ä¸ªåŒ…ï¼Œå¹¶ä»Â <code>package.json</code>Â ä¸­ç§»é™¤ã€‚</td><td><code>npm uninstall lodash</code></td></tr><tr><td><code>npm uninstall &lt;package_name&gt; --save-dev</code></td><td>å¸è½½ä¸€ä¸ªå¼€å‘ä¾èµ–åŒ…ã€‚</td><td><code>npm uninstall eslint --save-dev</code></td></tr></tbody></table>
<h4 data-id="heading-6">D. è¿è¡Œè„šæœ¬</h4>
<p><code>package.json</code>Â ä¸­æœ‰ä¸€ä¸ªÂ <code>"scripts"</code>Â å­—æ®µï¼Œå¯ä»¥å®šä¹‰è‡ªå®šä¹‰å‘½ä»¤ã€‚</p>






























<table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th><th>ç¤ºä¾‹ä¸è¯´æ˜</th></tr></thead><tbody><tr><td><code>npm run &lt;script_name&gt;</code></td><td>è¿è¡Œåœ¨Â <code>package.json</code>Â çš„Â <code>scripts</code>Â ä¸­å®šä¹‰çš„è„šæœ¬ã€‚</td><td>å¦‚æœÂ <code>scripts</code>Â ä¸­æœ‰Â <code>"start": "node app.js"</code>ï¼Œåˆ™Â <code>npm run start</code>Â ä¼šæ‰§è¡Œå®ƒã€‚</td></tr><tr><td><code>npm start</code></td><td><code>npm run start</code>Â çš„å¿«æ·æ–¹å¼ã€‚</td><td><code>npm start</code></td></tr><tr><td><code>npm test</code>Â (æˆ–Â <code>npm t</code>)</td><td><code>npm run test</code>Â çš„å¿«æ·æ–¹å¼ã€‚</td><td><code>npm test</code></td></tr><tr><td><code>npm run</code></td><td>åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„è„šæœ¬ã€‚</td><td><code>npm run</code></td></tr></tbody></table>
<h4 data-id="heading-7">E. ä¿¡æ¯æŸ¥çœ‹ä¸å®¡è®¡</h4>













































<table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th><th>ç¤ºä¾‹ä¸è¯´æ˜</th></tr></thead><tbody><tr><td><code>npm list</code>Â (æˆ–Â <code>npm ls</code>)</td><td>æŸ¥çœ‹å½“å‰é¡¹ç›®å®‰è£…çš„åŒ…åŠå…¶ä¾èµ–æ ‘ã€‚</td><td>-Â <code>npm list</code>ï¼šæŸ¥çœ‹é¡¶çº§ä¾èµ– -Â <code>npm list --depth=0</code>ï¼šåªæŸ¥çœ‹ç›´æ¥ä¾èµ–ï¼Œæ›´æ¸…æ™° -Â <code>npm list -g</code>ï¼šæŸ¥çœ‹å…¨å±€å®‰è£…çš„åŒ…</td></tr><tr><td><code>npm info &lt;package_name&gt;</code></td><td>æŸ¥çœ‹æŸä¸ªåŒ…çš„è¯¦ç»†ä¿¡æ¯ï¼ˆç‰ˆæœ¬ã€ä¾èµ–ã€æè¿°ç­‰ï¼‰ã€‚</td><td><code>npm info react</code></td></tr><tr><td><code>npm search &lt;keyword&gt;</code></td><td>åœ¨ npm ä»“åº“ä¸­æœç´¢åŒ…ã€‚</td><td><code>npm search http server</code></td></tr><tr><td><code>npm audit</code></td><td><strong>å®‰å…¨æ£€æŸ¥</strong>ï¼Œæ‰«æé¡¹ç›®ä¾èµ–ä¸­çš„å·²çŸ¥æ¼æ´ã€‚</td><td><code>npm audit</code></td></tr><tr><td><code>npm audit fix</code></td><td>è‡ªåŠ¨ä¿®å¤å¯è‡ªåŠ¨ä¿®å¤çš„æ¼æ´ã€‚</td><td><code>npm audit fix</code></td></tr><tr><td><code>npm audit fix --force</code></td><td>å¼ºåˆ¶ä¿®å¤æ¼æ´ï¼Œå¯èƒ½ä¼šè¿›è¡Œç ´åæ€§æ›´æ–°ï¼ˆå¤§ç‰ˆæœ¬å‡çº§ï¼‰ã€‚</td><td><code>npm audit fix --force</code></td></tr><tr><td><code>npm view &lt;package_name&gt; versions</code></td><td>æŸ¥çœ‹ä¸€ä¸ªåŒ…æ‰€æœ‰å¯ç”¨çš„å†å²ç‰ˆæœ¬ã€‚</td><td><code>npm view webpack versions</code></td></tr></tbody></table>
<h4 data-id="heading-8">F. å‘å¸ƒä¸ç®¡ç†åŒ…ï¼ˆé’ˆå¯¹åŒ…å¼€å‘è€…ï¼‰</h4>






























<table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th><th>ç¤ºä¾‹ä¸è¯´æ˜</th></tr></thead><tbody><tr><td><code>npm login</code></td><td>ç™»å½•åˆ°ä½ çš„ npm è´¦æˆ·ã€‚</td><td><code>npm login</code></td></tr><tr><td><code>npm publish</code></td><td>å°†å½“å‰ç›®å½•çš„åŒ…å‘å¸ƒåˆ° npm ä»“åº“ã€‚</td><td>åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼Œå‰ææ˜¯å·²ç™»å½•ä¸”æœ‰åˆæ³•çš„Â <code>package.json</code>ã€‚</td></tr><tr><td><code>npm version &lt;update_type&gt;</code></td><td>æ›´æ–°åŒ…çš„ç‰ˆæœ¬å·ï¼Œå¹¶è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª Git tagã€‚</td><td>-Â <code>npm version patch</code>Â (å°ç‰ˆæœ¬ï¼Œå¦‚ 1.0.0 -&gt; 1.0.1) -Â <code>npm version minor</code>Â (æ¬¡ç‰ˆæœ¬ï¼Œå¦‚ 1.0.0 -&gt; 1.1.0) -Â <code>npm version major</code>Â (ä¸»ç‰ˆæœ¬ï¼Œå¦‚ 1.0.0 -&gt; 2.0.0)</td></tr><tr><td><code>npm unpublish &lt;package_name&gt;@&lt;version&gt;</code></td><td><strong>å–æ¶ˆå‘å¸ƒ</strong>æŸä¸ªç‰ˆæœ¬çš„åŒ…ï¼ˆæœ‰ä¸¥æ ¼é™åˆ¶ï¼‰ã€‚</td><td><code>npm unpublish my-package@1.0.1</code></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-9">4. å¸¸ç”¨å·¥ä½œæµç¤ºä¾‹</h3>
<h4 data-id="heading-10">1. å¯åŠ¨ä¸€ä¸ªæ–°é¡¹ç›®</h4>
<p>bash</p>
<pre><code class="hljs language-csharp" lang="csharp">mkdir my-<span class="hljs-keyword">new</span>-project
cd my-<span class="hljs-keyword">new</span>-project
npm <span class="hljs-keyword">init</span> -y                <span class="hljs-meta"># å¿«é€Ÿåˆ›å»º package.json</span>
npm install express        <span class="hljs-meta"># å®‰è£…ç”Ÿäº§ä¾èµ– express</span>
npm install nodemon --save-dev <span class="hljs-meta"># å®‰è£…å¼€å‘ä¾èµ– nodemon</span>
</code></pre>
<p>ç„¶åï¼Œåœ¨Â <code>package.json</code>Â çš„Â <code>scripts</code>Â ä¸­æ·»åŠ ï¼š</p>
<p>json</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node app.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"nodemon app.js"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ä¹‹åå°±å¯ä»¥ä½¿ç”¨Â <code>npm run dev</code>Â æ¥å¯åŠ¨å¼€å‘æœåŠ¡å™¨äº†ã€‚</p>
<h4 data-id="heading-11">2. å…‹éš†å¹¶è¿è¡Œä¸€ä¸ªå·²æœ‰é¡¹ç›®</h4>
<p>bash</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> &lt;project-url&gt;
<span class="hljs-built_in">cd</span> &lt;project-folder&gt;
npm install          <span class="hljs-comment"># å®‰è£…æ‰€æœ‰ä¾èµ–</span>
npm start            <span class="hljs-comment"># å¯åŠ¨é¡¹ç›®</span>
</code></pre>
<h4 data-id="heading-12">3. æ›´æ–°é¡¹ç›®ä¾èµ–</h4>
<p>bash</p>
<pre><code class="hljs language-bash" lang="bash">npm outdated         <span class="hljs-comment"># æ£€æŸ¥å“ªäº›åŒ…è¿‡æ—¶äº†</span>
npm update           <span class="hljs-comment"># æ›´æ–°æ‰€æœ‰åŒ…åˆ°å…è®¸çš„æœ€æ–°ç‰ˆæœ¬</span>
npm audit            <span class="hljs-comment"># æ£€æŸ¥å®‰å…¨æ€§</span>
npm audit fix        <span class="hljs-comment"># ä¿®å¤æ¼æ´</span>
</code></pre>
<hr/>
<h3 data-id="heading-13">5. å®ç”¨æŠ€å·§ä¸æœ€ä½³å®è·µ</h3>
<ol>
<li>
<p><strong>ä½¿ç”¨Â <code>npx</code></strong>ï¼š<code>npx</code>Â éš npm ä¸€èµ·å®‰è£…ï¼Œç”¨äºä¸´æ—¶æ‰§è¡ŒåŒ…ã€‚å®ƒæ— éœ€å…¨å±€å®‰è£…ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p>
<ul>
<li><code>npx create-react-app my-app</code>Â ï¼ˆä¸´æ—¶ä¸‹è½½å¹¶è¿è¡ŒÂ <code>create-react-app</code>ï¼‰</li>
<li><code>npx eslint .</code>Â ï¼ˆè¿è¡Œé¡¹ç›®æœ¬åœ°å®‰è£…çš„Â <code>eslint</code>ï¼‰</li>
</ul>
</li>
<li>
<p><strong>ä½¿ç”¨Â <code>.npmrc</code>Â æ–‡ä»¶</strong>ï¼šå¯ä»¥åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºæ­¤æ–‡ä»¶æ¥å®šä¹‰é¡¹ç›®ç‰¹å®šçš„ npm é…ç½®ï¼Œä¾‹å¦‚è®¾ç½®ç§æœ‰ä»“åº“åœ°å€ã€‚</p>
</li>
<li>
<p><strong>ç†è§£è¯­ä¹‰åŒ–ç‰ˆæœ¬</strong>ï¼š</p>
<ul>
<li><code>^1.2.3</code>ï¼šå…è®¸æ›´æ–°æ¬¡ç‰ˆæœ¬å’Œä¿®è®¢å·ï¼Œå¦‚ 1.2.4, 1.3.0ï¼Œä½†ä¸åŒ…æ‹¬ 2.0.0ã€‚</li>
<li><code>~1.2.3</code>ï¼šåªå…è®¸æ›´æ–°ä¿®è®¢å·ï¼Œå¦‚ 1.2.4ã€‚</li>
<li>è¿™å°±æ˜¯Â <code>package-lock.json</code>Â é‡è¦çš„åŸå› ï¼Œå®ƒé”å®šäº†ç¡®åˆ‡çš„ç‰ˆæœ¬ã€‚</li>
</ul>
</li>
<li>
<p><strong>ä¸è¦æ‰‹åŠ¨ä¿®æ”¹Â <code>node_modules</code></strong>ï¼šä»»ä½•ä¿®æ”¹éƒ½ä¼šåœ¨ä¸‹æ¬¡Â <code>npm install</code>Â æ—¶ä¸¢å¤±ã€‚</p>
</li>
<li>
<p><strong>å°†Â <code>package-lock.json</code>Â æäº¤åˆ° Git</strong>ï¼šè¿™æ˜¯ä¿è¯å›¢é˜Ÿä¸€è‡´æ€§çš„å…³é”®ã€‚</p>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼ŒåŠ¨æ€æ•°æ®æºåˆ‡æ¢ä¸Seataå…¨å±€äº‹åŠ¡é”ç®¡ç†å¦‚ä½•ååŒé¿å…æ€§èƒ½ç“¶é¢ˆï¼Ÿ]]></title>    <link>https://juejin.cn/post/7571306072422842410</link>    <guid>https://juejin.cn/post/7571306072422842410</guid>    <pubDate>2025-11-11T13:49:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571306072422842410" data-draft-id="7571304204754714678" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼ŒåŠ¨æ€æ•°æ®æºåˆ‡æ¢ä¸Seataå…¨å±€äº‹åŠ¡é”ç®¡ç†å¦‚ä½•ååŒé¿å…æ€§èƒ½ç“¶é¢ˆï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-11T13:49:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ITæ©˜å­çš®"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼ŒåŠ¨æ€æ•°æ®æºåˆ‡æ¢ä¸Seataå…¨å±€äº‹åŠ¡é”ç®¡ç†å¦‚ä½•ååŒé¿å…æ€§èƒ½ç“¶é¢ˆï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ITæ©˜å­çš®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T13:49:51.000Z" title="Tue Nov 11 2025 13:49:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå°†åŠ¨æ€æ•°æ®æºåˆ‡æ¢ä¸Seataå…¨å±€äº‹åŠ¡é”ç®¡ç†æœ‰æ•ˆç»“åˆï¼Œç¡®å®æ˜¯ä¸€ä¸ªæ—¢å…³é”®åˆå…·æœ‰æŒ‘æˆ˜æ€§çš„æ¶æ„è®¾è®¡é—®é¢˜ã€‚ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ¦‚æ‹¬äº†æ ¸å¿ƒçš„ååŒä¼˜åŒ–ç­–ç•¥ï¼Œå¸®åŠ©ä½ å¿«é€Ÿå»ºç«‹æ•´ä½“è®¤çŸ¥ã€‚</p>

























<table><thead><tr><th>ä¼˜åŒ–ç»´åº¦</th><th>æ ¸å¿ƒç­–ç•¥</th><th>é¢„æœŸæ”¶ç›Š</th></tr></thead><tbody><tr><td><strong>æ•°æ®æºè·¯ç”±ä¼˜åŒ–</strong></td><td>ç²¾ç»†åŒ–è·¯ç”±ï¼ˆå¦‚è¯»å†™åˆ†ç¦»ï¼‰ã€è¿æ¥æ± éš”ç¦»ã€é¢„æ£€æœºåˆ¶</td><td>é™ä½ä¸å¿…è¦çš„è·¨åº“æ“ä½œï¼Œå‡å°‘è¿æ¥ç­‰å¾…ï¼Œæå‡å•ç‚¹å¤„ç†èƒ½åŠ›</td></tr><tr><td><strong>Seataäº‹åŠ¡é”ä¼˜åŒ–</strong></td><td>é”ç²’åº¦æ§åˆ¶ï¼ˆå¦‚åˆ†åº“åˆ†è¡¨ï¼‰ã€æ··åˆäº‹åŠ¡æ¨¡å¼ï¼ˆAT/TCCï¼‰ã€å‚æ•°è°ƒä¼˜</td><td>ç¼“è§£å…¨å±€é”ç«äº‰ï¼Œæé«˜ç³»ç»Ÿå¹¶å‘åº¦</td></tr><tr><td><strong>ååŒå·¥ä½œæœºåˆ¶</strong></td><td>äº‹åŠ¡è¾¹ç•Œä¸æ•°æ®æºç”Ÿå‘½å‘¨æœŸå¯¹é½ã€å¼‚å¸¸å¤„ç†ä¸å›æ»šç­–ç•¥</td><td>ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„åŒæ—¶ï¼Œé¿å…èµ„æºæ‚¬æŒ‚å’Œæ­»é”</td></tr></tbody></table>
<h3 data-id="heading-0">ğŸ’¡ åŠ¨æ€æ•°æ®æºè·¯ç”±çš„æ€§èƒ½ä¼˜åŒ–</h3>
<p>åœ¨é«˜å¹¶å‘ä¸‹ï¼Œæ•°æ®æºåˆ‡æ¢æœ¬èº«ä¸èƒ½æˆä¸ºç“¶é¢ˆã€‚ä¼˜åŒ–çš„æ ¸å¿ƒåœ¨äº <strong>â€œå¿«ã€å‡†ã€ç¨³â€</strong> ã€‚</p>
<ol>
<li><strong>ç²¾ç»†åŒ–è·¯ç”±ç­–ç•¥</strong>ï¼šé¿å…åœ¨å•ä¸ªäº‹åŠ¡æˆ–ç´§å¯†å…³è”çš„æ“ä½œé“¾ä¸­é¢‘ç¹åˆ‡æ¢æ•°æ®æºã€‚ä¾‹å¦‚ï¼Œåœ¨è®¾è®¡ä¸Šå°½é‡è®©ä¸€ä¸ªä¸šåŠ¡é€»è¾‘å•å…ƒå†…çš„æ•°æ®åº“æ“ä½œé›†ä¸­äºåŒä¸€ä¸ªæ•°æ®æºï¼Œå¦‚æœå¿…é¡»è·¨æºï¼Œåº”ç¡®ä¿å…¶å¿…è¦æ€§ã€‚é‡‡ç”¨æ¸…æ™°çš„<strong>è¯»å†™åˆ†ç¦»</strong>ç­–ç•¥ï¼Œå°†ç»å¤§å¤šæ•°æŸ¥è¯¢æ“ä½œè·¯ç”±åˆ°ä»åº“ï¼Œæ˜¯å‡è½»ä¸»åº“å‹åŠ›ã€æå‡å¹¶å‘è¯»å–èƒ½åŠ›çš„æœ‰æ•ˆæ‰‹æ®µã€‚</li>
<li><strong>è¿æ¥æ± éš”ç¦»ä¸é…ç½®</strong>ï¼šä¸ºä¸åŒçš„æ•°æ®æºï¼ˆå¦‚ä¸»åº“ã€ä»åº“ã€æŠ¥è¡¨åº“ï¼‰é…ç½®ç‹¬ç«‹çš„ã€å¤§å°åˆé€‚çš„æ•°æ®åº“è¿æ¥æ± ã€‚è¿™èƒ½æœ‰æ•ˆé¿å…æ…¢æŸ¥è¯¢æˆ–æŸä¸ªæ•°æ®æºçš„å¼‚å¸¸æ‹–å®æ•´ä¸ªåº”ç”¨çš„æ‰€æœ‰æ•°æ®åº“æ“ä½œã€‚æ ¹æ®å¹¶å‘å‹åŠ›è°ƒæ•´è¿æ¥æ± å‚æ•°ï¼ˆå¦‚ <code>maximumPoolSize</code>, <code>connectionTimeout</code>ï¼‰ä¹Ÿè‡³å…³é‡è¦ã€‚</li>
<li><strong>è·¯ç”±é¢„æ£€ä¸ç¼“å­˜</strong>ï¼šå¯¹äºåŸºäºå¤æ‚è§„åˆ™ï¼ˆå¦‚ç§Ÿæˆ·IDã€ä¸šåŠ¡ç±»å‹ï¼‰çš„è·¯ç”±ï¼Œå¯ä»¥å¼•å…¥ç¼“å­˜æœºåˆ¶ï¼Œé¿å…æ¯æ¬¡è¯·æ±‚éƒ½è¿›è¡Œæ˜‚è´µçš„è§„åˆ™è®¡ç®—ã€‚åŒæ—¶ï¼Œåœ¨æ‰§è¡Œè·¯ç”±å‰ï¼Œå¯ä»¥å¯¹ç›®æ ‡æ•°æ®æºè¿›è¡Œç®€å•çš„å¥åº·æ£€æŸ¥ï¼ˆå¦‚è¿æ¥æµ‹è¯•ï¼‰ï¼Œé¿å…å°†è¯·æ±‚è·¯ç”±åˆ°ä¸å¯ç”¨æˆ–é«˜å»¶è¿Ÿçš„èŠ‚ç‚¹ã€‚</li>
</ol>
<h3 data-id="heading-1">âš™ï¸ Seataå…¨å±€äº‹åŠ¡é”çš„æ·±åº¦ä¼˜åŒ–</h3>
<p>Seataçš„ATæ¨¡å¼åœ¨é«˜å¹¶å‘ä¸‹æœ€ä¸»è¦çš„ç“¶é¢ˆæ˜¯<strong>å…¨å±€é”ç«äº‰</strong>ã€‚ä»¥ä¸‹æ˜¯å…³é”®ä¼˜åŒ–æ–¹å‘ï¼š</p>
<ol>
<li>
<p><strong>æ§åˆ¶é”ç²’åº¦ä¸çƒ­ç‚¹æ•°æ®</strong>ï¼š</p>
<ul>
<li><strong>åº“å­˜åˆ†æ¡¶</strong>ï¼šå¯¹äºåƒåº“å­˜æ‰£å‡è¿™æ ·çš„å…¸å‹çƒ­ç‚¹åœºæ™¯ï¼Œå¯ä»¥è€ƒè™‘â€œåº“å­˜åˆ†æ¡¶â€æ–¹æ¡ˆã€‚å°†ä¸€ä¸ªSKUçš„æ€»åº“å­˜åˆ†æ•£åˆ°å¤šæ¡è®°å½•ä¸­ï¼Œæ‰£å‡æ—¶é€šè¿‡ç‰¹å®šç®—æ³•ï¼ˆå¦‚å“ˆå¸Œï¼‰é€‰æ‹©ä¸€æ¡è®°å½•æ“ä½œï¼Œå°†ç«äº‰ä¸€æŠŠå…¨å±€é”å˜ä¸ºç«äº‰å¤šæŠŠé”ï¼Œæ˜¾è‘—æå‡å¹¶å‘èƒ½åŠ›ã€‚</li>
<li><strong>ä¸šåŠ¡é”®è®¾è®¡</strong>ï¼šåœ¨ä¸šåŠ¡è®¾è®¡é˜¶æ®µï¼Œå°½é‡é¿å…è®©å¤§é‡å¹¶å‘äº‹åŠ¡æ“ä½œåŒä¸€æ¡æ•°æ®è®°å½•ã€‚ä¾‹å¦‚ï¼Œç”Ÿæˆè®¢å•å·æ—¶åŠ å…¥ç”¨æˆ·IDå“ˆå¸Œæˆ–æ—¶é—´æˆ³åˆ†é‡ï¼Œä½¿å†™å…¥å°½é‡åˆ†æ•£ã€‚</li>
</ul>
</li>
<li>
<p><strong>é‡‡ç”¨æ··åˆäº‹åŠ¡æ¨¡å¼</strong>ï¼šè¿™æ˜¯åº”å¯¹æé«˜å¹¶å‘åœºæ™¯çš„â€œæ€æ‰‹é”â€ã€‚é’ˆå¯¹ä¸šåŠ¡é“¾è·¯ä¸­çš„ä¸åŒæ“ä½œï¼Œçµæ´»é€‰ç”¨Seataæä¾›çš„å¤šç§äº‹åŠ¡æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨ç”µå•†ä¸‹å•åœºæ™¯ä¸­ï¼Œå¯¹ä¸ä¼šäº§ç”Ÿç«äº‰çš„ç”¨æˆ·ä¼˜æƒ åˆ¸é”å®šæ“ä½œä½¿ç”¨<strong>ATæ¨¡å¼</strong>ï¼Œè€Œå¯¹çƒ­ç‚¹åº“å­˜æ‰£å‡æ“ä½œé‡‡ç”¨<strong>TCCæ¨¡å¼</strong>ã€‚TCCæ¨¡å¼åœ¨Tryé˜¶æ®µè¿›è¡Œèµ„æºé¢„ç•™ï¼ŒConfirm/Cancelé˜¶æ®µæ‰è¿›è¡Œæœ€ç»ˆæ“ä½œï¼Œé¿å…äº†ATæ¨¡å¼åœ¨æ•´ä¸ªäº‹åŠ¡å‘¨æœŸå†…æŒæœ‰å…¨å±€é”ï¼Œä»è€Œå¤§å¤§å‡å°‘äº†é”ç«äº‰æ—¶é—´ã€‚</p>
</li>
<li>
<p><strong>è°ƒæ•´Seataå®¢æˆ·ç«¯å‚æ•°</strong>ï¼šæ ¹æ®ä¸šåŠ¡å¯æ¥å—çš„å»¶è¿Ÿï¼Œé€‚å½“è°ƒæ•´Seataå®¢æˆ·ç«¯çš„ç›¸å…³å‚æ•°ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">seata:</span>
  <span class="hljs-attr">client:</span>
    <span class="hljs-attr">tm:</span>
      <span class="hljs-attr">commit-retry-count:</span> <span class="hljs-number">3</span>           <span class="hljs-comment"># æäº¤é‡è¯•æ¬¡æ•°</span>
      <span class="hljs-attr">rollback-retry-count:</span> <span class="hljs-number">3</span>         <span class="hljs-comment"># å›æ»šé‡è¯•æ¬¡æ•°</span>
    <span class="hljs-attr">lock:</span>
      <span class="hljs-attr">retry-interval:</span> <span class="hljs-number">10</span>              <span class="hljs-comment"># é”é‡è¯•é—´éš”(ms)</span>
      <span class="hljs-attr">retry-times:</span> <span class="hljs-number">30</span>                 <span class="hljs-comment"># é”è·å–é‡è¯•æ¬¡æ•°</span>
</code></pre>
<p>å¢åŠ é‡è¯•æ¬¡æ•°å’Œå‡å°‘é‡è¯•é—´éš”å¯ä»¥åœ¨å‡ºç°çŸ­æš‚é”ç«äº‰æ—¶æé«˜æˆåŠŸç‡ï¼Œä½†éœ€æ³¨æ„è¿™ä¼šå¢åŠ å•ä¸ªäº‹åŠ¡çš„è€—æ—¶ã€‚</p>
</li>
</ol>
<h3 data-id="heading-2">ğŸ”— äºŒè€…ååŒå·¥ä½œæµç¨‹ä¸ç­–ç•¥</h3>
<p>åŠ¨æ€æ•°æ®æºè·¯ç”±å’ŒSeataäº‹åŠ¡ç®¡ç†å¿…é¡»ååŒå·¥ä½œï¼Œæ‰èƒ½ç¡®ä¿åœ¨é«˜æ€§èƒ½ä¸‹çš„ä¸€è‡´æ€§ã€‚</p>
<ol>
<li><strong>äº‹åŠ¡è¾¹ç•Œä¸æ•°æ®æºç”Ÿå‘½å‘¨æœŸçš„å¯¹é½</strong>ï¼šåŠ¡å¿…ç¡®ä¿åœ¨å¸¦æœ‰ <code>@GlobalTransactional</code>æ³¨è§£çš„æ–¹æ³•å†…éƒ¨è¿›è¡Œæ•°æ®æºåˆ‡æ¢æ—¶ï¼ŒSeataçš„äº‹åŠ¡ä¸Šä¸‹æ–‡ï¼ˆXIDï¼‰èƒ½æ­£ç¡®ä¼ é€’ã€‚æœ€ä½³å®è·µæ˜¯ï¼Œåœ¨æ–¹æ³•å¼€å§‹æ—¶å°±æ˜ç¡®è®¾ç½®å¥½åç»­æ“ä½œæ‰€éœ€çš„æ•°æ®æºï¼Œé¿å…åœ¨äº‹åŠ¡è¿›è¡Œä¸­é¢‘ç¹åˆ‡æ¢ã€‚å¦‚æœå¿…é¡»åœ¨äº‹åŠ¡ä¸­åˆ‡æ¢ï¼Œåº”é€šè¿‡ç¼–ç¨‹æ–¹å¼ï¼ˆå¦‚ <code>DynamicDataSourceContextHolder.push()</code>ï¼‰å®Œæˆï¼Œå¹¶ç¡®ä¿åœ¨finallyå—ä¸­æ¸…ç†ä¸Šä¸‹æ–‡ï¼Œé˜²æ­¢æ±¡æŸ“åç»­æ“ä½œã€‚</li>
<li><strong>å¼‚å¸¸å¤„ç†ä¸å›æ»šç­–ç•¥</strong>ï¼šåœ¨ååŒå·¥ä½œä¸­ï¼Œå¿…é¡»å¯¹æ•°æ®æºåˆ‡æ¢å¤±è´¥æˆ–Seataå…¨å±€é”è·å–è¶…æ—¶ç­‰å¼‚å¸¸æœ‰æ˜ç¡®çš„å¤„ç†ç­–ç•¥ã€‚ä¸€æ—¦å‘ç”Ÿæ­¤ç±»å¼‚å¸¸ï¼Œåº”ç¡®ä¿Seataçš„å…¨å±€äº‹åŠ¡èƒ½æ­£ç¡®å›æ»šï¼Œå¹¶ä¸”åŠ¨æ€æ•°æ®æºçš„ä¸Šä¸‹æ–‡ä¹Ÿè¢«åŠæ—¶æ¸…ç†ã€‚ä¾‹å¦‚ï¼Œåœ¨æ•è·åˆ°å…¨å±€é”è·å–å¤±è´¥å¼‚å¸¸æ—¶ï¼Œä¸åº”ç®€å•é‡è¯•ï¼Œè€Œåº”ç»“åˆä¸šåŠ¡è€ƒè™‘æ˜¯ç›´æ¥å¤±è´¥å¿«é€Ÿè¿”å›ï¼Œè¿˜æ˜¯ä½¿ç”¨å¼‚æ­¥é‡è¯•æœºåˆ¶ã€‚</li>
<li><strong>é™çº§ä¸ç†”æ–­æœºåˆ¶</strong>ï¼šåœ¨ç›‘æ§åˆ°æ•°æ®åº“èŠ‚ç‚¹æ•…éšœæˆ–Seataäº‹åŠ¡åè°ƒå™¨(TC)å‡ºç°é—®é¢˜æ—¶ï¼Œç³»ç»Ÿåº”å…·å¤‡é™çº§èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼Œåœ¨ä»åº“ä¸å¯ç”¨æ—¶ï¼ŒåŠ¨æ€æ•°æ®æºè·¯ç”±å™¨åº”èƒ½è‡ªåŠ¨å°†è¯»è¯·æ±‚å…¨éƒ¨æŒ‡å‘ä¸»åº“ã€‚å½“Seataä¸å¯ç”¨æ—¶ï¼Œå¯èƒ½éœ€è¦é™çº§åˆ°ä½¿ç”¨æœ¬åœ°äº‹åŠ¡+æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆï¼ˆå¦‚æ¶ˆæ¯é˜Ÿåˆ—ï¼‰æ¥ä¿è¯æ ¸å¿ƒæµç¨‹çš„å¯ç”¨æ€§ã€‚</li>
</ol>
<h3 data-id="heading-3">ğŸ“Š ç›‘æ§ä¸åº”æ€¥å¤„ç†</h3>
<p>å»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»æ˜¯ä¿éšœé«˜å¯ç”¨çš„å‰æã€‚</p>
<ul>
<li><strong>ç›‘æ§æŒ‡æ ‡</strong>ï¼šéœ€è¦é‡ç‚¹å…³æ³¨<strong>åŠ¨æ€æ•°æ®æºåˆ‡æ¢çš„é¢‘ç‡å’ŒæˆåŠŸç‡</strong>ã€<strong>Seataå…¨å±€é”çš„è·å–æ—¶é—´ã€ç­‰å¾…æ•°é‡å’Œè¶…æ—¶ç‡</strong>ã€<strong>æ•°æ®åº“è¿æ¥æ± çš„ä½¿ç”¨ç‡</strong>ç­‰æŒ‡æ ‡ã€‚</li>
<li><strong>åº”æ€¥æªæ–½</strong>ï¼šå½“å‡ºç°æ€§èƒ½ç“¶é¢ˆæˆ–æ­»é”æ—¶ï¼Œé™¤äº†å¸¸è§„çš„é‡å¯ã€æ‰©å®¹ï¼Œè¿˜åº”å…·å¤‡<strong>ä¸»åŠ¨killé˜»å¡äº‹åŠ¡</strong>ã€<strong>åŠ¨æ€ç¦ç”¨æŸä¸ªæ•°æ®æºè·¯ç”±</strong>ã€<strong>æ‰‹åŠ¨æ¸…ç†Seataå…¨å±€é”</strong>ï¼ˆéœ€æç«¯è°¨æ…ï¼‰ç­‰åº”æ€¥èƒ½åŠ›ã€‚</li>
</ul>
<h3 data-id="heading-4">ğŸ’ æ€»ç»“ä¸é€‰å‹å»ºè®®</h3>
<p>é¢å¯¹é«˜å¹¶å‘åœºæ™¯ï¼Œæ²¡æœ‰ä¸€åŠ³æ°¸é€¸çš„é“¶å¼¹ï¼Œå…³é”®åœ¨äºæ ¹æ®ä¸šåŠ¡ç‰¹æ€§è¿›è¡Œæƒè¡¡å’Œé€‰æ‹©ã€‚</p>
<ul>
<li><strong>å¯¹äºä¸€è‡´æ€§è¦æ±‚æé«˜ä¸”å¹¶å‘çƒ­ç‚¹é›†ä¸­çš„ä¸šåŠ¡</strong>ï¼ˆå¦‚é‡‘èæ ¸å¿ƒäº¤æ˜“ï¼‰ï¼šä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ <strong>TCCæ¨¡å¼</strong>æˆ– <strong>Sagaæ¨¡å¼</strong>æ¥é¿å…å…¨å±€é”ï¼Œå°½ç®¡å®ç°æˆæœ¬è¾ƒé«˜ã€‚</li>
<li><strong>å¯¹äºå¹¶å‘é‡é«˜ä½†å…è®¸çŸ­æš‚ä¸ä¸€è‡´çš„äº’è”ç½‘ä¸šåŠ¡</strong>ï¼ˆå¦‚æ™®é€šç”µå•†ä¸‹å•ï¼‰ï¼šå¯ä»¥é‡‡ç”¨ <strong>ATæ¨¡å¼ + åº“å­˜åˆ†æ¡¶ç­‰ä¸šåŠ¡è®¾è®¡ + å‚æ•°è°ƒä¼˜</strong>çš„ç»„åˆæ–¹æ¡ˆï¼Œåœ¨ä¿è¯åŸºæœ¬ä¸€è‡´æ€§çš„å‰æä¸‹è¿½æ±‚æ€§èƒ½ã€‚</li>
<li><strong>å¯¹äºè¯»å¤šå†™å°‘çš„åœºæ™¯</strong>ï¼šå……åˆ†åˆ©ç”¨<strong>åŠ¨æ€æ•°æ®æºè¯»å†™åˆ†ç¦»</strong>ï¼Œå°†è¯»å‹åŠ›åˆ†æ•£ï¼Œè¿™æ˜¯æå‡æ•´ä½“ååé‡æœ€æœ‰æ•ˆä¸”æˆæœ¬æœ€ä½çš„æ‰‹æ®µä¹‹ä¸€ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆéœ€è¦å‚ç›´é¢†åŸŸçš„SFTå¾®è°ƒï¼Ÿå‚ç›´é¢†åŸŸSFTå¾®è°ƒæ€ä¹ˆåšï¼Ÿ]]></title>    <link>https://juejin.cn/post/7571304204753977398</link>    <guid>https://juejin.cn/post/7571304204753977398</guid>    <pubDate>2025-11-11T10:04:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571304204753977398" data-draft-id="7571077686108618815" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆéœ€è¦å‚ç›´é¢†åŸŸçš„SFTå¾®è°ƒï¼Ÿå‚ç›´é¢†åŸŸSFTå¾®è°ƒæ€ä¹ˆåšï¼Ÿ"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-11-11T10:04:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ™ºæ³ŠAI"/> <meta itemprop="url" content="https://juejin.cn/user/3572727470361578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆéœ€è¦å‚ç›´é¢†åŸŸçš„SFTå¾®è°ƒï¼Ÿå‚ç›´é¢†åŸŸSFTå¾®è°ƒæ€ä¹ˆåšï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3572727470361578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ™ºæ³ŠAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T10:04:33.000Z" title="Tue Nov 11 2025 10:04:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>éšç€äººå·¥æ™ºèƒ½çš„æ—¥ç›Šç«çˆ†ï¼Œå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„åº”ç”¨æ­£å˜å¾—æ— å¤„ä¸åœ¨ã€‚åœ¨å‚ç›´é¢†åŸŸçš„SFTå¾®è°ƒï¼ˆSupervised Fine-Tuningï¼‰ä½œä¸ºæå‡æ¨¡å‹ä¸“ä¸šèƒ½åŠ›çš„å…³é”®æŠ€æœ¯ï¼Œæ›´æ˜¯å¼•äººç©ç›®ã€‚</p>
<p>ä½†ä½ æ˜¯å¦æ³¨æ„åˆ°ä¸€ä¸ªå¥‡æ€ªçš„ç°è±¡ï¼šç›¸æ¯”ç»éªŒä¸°å¯Œçš„ä¸“å®¶ï¼Œæ–°æ‰‹ä¼¼ä¹å¯¹å°è¯•SFTå¾®è°ƒè¡¨ç°å‡ºäº†æ›´å¤§çš„çƒ­æƒ…ï¼Ÿè¿™ç©¶ç«Ÿæ˜¯ä¸ºä»€ä¹ˆï¼Ÿæ˜¯æ–°æ‰‹æ— ç•çš„å†’é™©ç²¾ç¥ï¼Œè¿˜æ˜¯ä¸“å®¶æ·±æ€ç†Ÿè™‘åçš„ä¿ç•™æ€åº¦ï¼Ÿ</p>
<p>é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯SFTå¾®è°ƒï¼Ÿä¸ºä»€ä¹ˆå®ƒè¿™ä¹ˆé‡è¦ï¼Ÿå…·ä½“æ€ä¹ˆåšï¼Ÿåˆè¯¥ä»å“ªä¸ªæ¨¡å‹å¼€å§‹ç€æ‰‹ï¼Ÿåˆ«æ€¥ï¼Œè¿™ç¯‡æ–‡ç« å°†ä¸€æ­¥æ­¥ä¸ºä½ è§£ç­”ã€‚</p>
<p><strong>ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦å‚ç›´é¢†åŸŸçš„SFTå¾®è°ƒï¼Ÿ</strong></p>
<p>é€šä¿—æ¥è®²ï¼ŒSFTå¾®è°ƒæ˜¯é€šè¿‡å‚ç›´é¢†åŸŸæ•°æ®å¯¹ç°æœ‰å¤§è¯­è¨€æ¨¡å‹è¿›è¡ŒäºŒæ¬¡è®­ç»ƒï¼Œä½¿å…¶åœ¨ç‰¹å®šé¢†åŸŸè¡¨ç°å¾—æ›´ç²¾å‡†ã€æ›´ä¸“ä¸šã€‚è¿™ä¸€æ­¥éª¤çš„å¿…è¦æ€§ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹æ–¹é¢ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/114ac4f97a9a41e5972bf18039fe5760~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763460272&amp;x-signature=9HfyAS%2BZYSyRm7eMffPthlDaM4k%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>å¼¥è¡¥ä¸“ä¸šé¢†åŸŸè®¤çŸ¥ä¸è¶³â€Œ</strong></p>
<p>é€šç”¨å¤§è¯­è¨€æ¨¡å‹åŸºäºæµ·é‡äº’è”ç½‘æ•°æ®è®­ç»ƒï¼Œå…·å¤‡å¹¿æ³›çš„çŸ¥è¯†è¦†ç›–ï¼Œä½†åœ¨ç‰¹å®šä¸“ä¸šé¢†åŸŸç¼ºä¹æ·±åº¦ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå½“åŒ»ç”Ÿè¯¢é—®æŸç§ç–¾ç—…çš„ä¸´åºŠè¯Šæ–­æ ‡å‡†ï¼Œæˆ–å¾‹å¸ˆå’¨è¯¢ç‰¹å®šæ³•è§„æ¡æ¬¾æ—¶ï¼Œé€šç”¨æ¨¡å‹å¯èƒ½å› çŸ¥è¯†å±€é™è€Œç»™å‡ºæ¨¡ç³Šç”šè‡³é”™è¯¯çš„å›ç­”ã€‚</p>
<p>é€šè¿‡SFTå¾®è°ƒï¼Œå¼•å…¥é¢†åŸŸä¸“ä¸šæ•°æ®ï¼ˆå¦‚åŒ»å­¦æœŸåˆŠã€æ³•å¾‹æ¡ˆä¾‹ï¼‰å¯å¼ºåŒ–æ¨¡å‹å¯¹ä¸“ä¸šæœ¯è¯­å’Œæ ¸å¿ƒçŸ¥è¯†çš„æŒæ¡ï¼Œæ˜¾è‘—æå‡å›ç­”çš„å‡†ç¡®æ€§å’Œæƒå¨æ€§ã€‚</p>
<p><strong>â€ŒæŒæ¡è¡Œä¸šç‰¹å®šè§„èŒƒâ€Œ</strong></p>
<p>å„è¡Œä¸šå‡æœ‰å…¶ç‹¬ç‰¹çš„æ“ä½œå‡†åˆ™ã€‚ä¾‹å¦‚ï¼ŒåŒ»ç–—è¡Œä¸šéœ€ä¸¥æ ¼éµå®ˆæ‚£è€…éšç§ä¿æŠ¤ï¼Œæ³•å¾‹é¢†åŸŸå¿…é¡»åšæŒç¨‹åºå…¬æ­£åŸåˆ™ï¼Œè¿™äº›è¦æ±‚å¯¹ä¸“ä¸šæ€§æä¸ºä¸¥è‹›ã€‚</p>
<p>é€šç”¨æ¨¡å‹å¯èƒ½å› ä¸ç†Ÿæ‚‰è¡Œä¸šæ½œè§„åˆ™è€Œå‡ºç°ç–æ¼ã€‚SFTå¾®è°ƒé€šè¿‡æ³¨å…¥è¡Œä¸šè§„èŒƒæ•°æ®ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿç²¾å‡†ç†è§£å‚ç›´åœºæ™¯ä¸‹çš„åˆè§„è¦æ±‚ï¼Œé¿å…ä½çº§é”™è¯¯ã€‚</p>
<p><strong>â€Œç²¾å‡†åŒ¹é…å¤šæ ·åŒ–ä»»åŠ¡â€Œ</strong></p>
<p>ä¸åŒé¢†åŸŸçš„ä»»åŠ¡éœ€æ±‚å·®å¼‚æ˜¾è‘—ï¼šä¸´åºŠåŒ»ç”Ÿéœ€è¦ç”Ÿæˆç»“æ„åŒ–ç—…å†ï¼Œæ³•å¾‹ä»ä¸šè€…éœ€å®¡æ ¸åˆåŒæ¡æ¬¾ï¼Œé‡‘èä»ä¸šè€…åˆ™ä¾èµ–å¸‚åœºè¶‹åŠ¿åˆ†æã€‚</p>
<p>é€šç”¨æ¨¡å‹åœ¨é¢å¯¹æ­¤ç±»ç»†åˆ†ä»»åŠ¡æ—¶å¾€å¾€è¡¨ç°æ³›åŒ–ã€‚é€šè¿‡SFTå¾®è°ƒï¼Œåˆ©ç”¨å®é™…ä»»åŠ¡æ ·æœ¬ï¼ˆå¦‚"æŒ‡ä»¤-è¾“å‡º"å¯¹ï¼‰è®­ç»ƒæ¨¡å‹ï¼Œå¯ä½¿å…¶æ·±å…¥ç†è§£ä»»åŠ¡æµç¨‹ï¼Œå®ç°"ä¸“ä¸šå¯¹å£"çš„é«˜æ•ˆè¾“å‡ºã€‚</p>
<p><strong>â€Œä¼˜åŒ–äº¤äº’ä½“éªŒâ€Œ</strong></p>
<p>å³ä½¿é€šç”¨æ¨¡å‹èƒ½å®ŒæˆåŸºç¡€é¢†åŸŸä»»åŠ¡ï¼ŒSFTå¾®è°ƒä»å¯è¿›ä¸€æ­¥ä¼˜åŒ–è¡¨ç°ã€‚å¾®è°ƒåçš„æ¨¡å‹è¾“å‡ºæ›´è´´åˆè¡Œä¸šç”¨è¯­ä¹ æƒ¯ï¼Œæ–‡æœ¬è¿è´¯æ€§å’Œä¸“ä¸šæ€§æå‡ï¼Œä»è€Œå¤§å¹…æ”¹å–„ç”¨æˆ·ä½“éªŒã€‚</p>
<p>â€Œæ€»ç»“â€Œï¼šSFTå¾®è°ƒå¦‚åŒä¸ºé€šç”¨æ¨¡å‹æä¾›"èŒä¸šç‰¹è®­"ï¼Œå°†å…¶ä»"é€šæ‰"è½¬åŒ–ä¸ºç‰¹å®šé¢†åŸŸçš„"ä¸“å®¶"ï¼Œå®ç°èƒ½åŠ›ä¸åœºæ™¯çš„æ·±åº¦é€‚é…ã€‚</p>
<p><strong>äºŒã€å‚ç›´é¢†åŸŸSFTå¾®è°ƒæ€ä¹ˆåšï¼Ÿ</strong></p>
<p>SFTå¾®è°ƒå¹¶ä¸æ˜¯éšä¾¿æ‹¿ç‚¹æ•°æ®ä¸¢ç»™æ¨¡å‹å°±è¡Œï¼Œå®ƒæœ‰ä¸€å¥—æ¸…æ™°çš„æµç¨‹ã€‚ä¸‹é¢æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥æ‹†è§£ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6592c24eae7d4521a5d636b300ec208c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763460272&amp;x-signature=hSfBy5ltjN%2BSMasOWrYdJTG5gZg%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>é¢†åŸŸæ•°æ®å‡†å¤‡â€Œ</strong></p>
<p><strong>â€Œæ•°æ®é‡‡é›†â€Œ</strong>ï¼šè·å–é«˜ä»·å€¼çš„ä¸“ä¸šé¢†åŸŸæ–‡æœ¬ï¼Œä¾‹å¦‚ä¸´åºŠç—…å†ã€åˆåŒæ¡æ¬¾ã€è´¢ç»æŠ¥é“ç­‰ï¼Œæ•°æ®å½¢å¼å¯åŒ…å«ç»“æ„åŒ–è¡¨æ ¼æˆ–éç»“æ„åŒ–æ–‡æ¡£ã€‚</p>
<p><strong>â€Œæ•°æ®å‡€åŒ–â€Œ</strong>ï¼šå‰”é™¤æ–‡æœ¬ä¸­çš„å¹²æ‰°é¡¹ï¼ˆå¦‚é”™åˆ«å­—ã€å†—ä½™ä¿¡æ¯ï¼‰åŠéšç§å†…å®¹ï¼ˆå¦‚ä¸ªäººèº«ä»½ä¿¡æ¯ï¼‰ï¼Œä¿éšœæ•°æ®çº¯å‡€åº¦ã€‚</p>
<p><strong>â€Œæ•°æ®æ ‡æ³¨â€Œ</strong>ï¼šæŒ‰ä»»åŠ¡éœ€æ±‚å°†æ•°æ®è½¬æ¢ä¸ºå®šå‘æ ¼å¼ï¼Œä¾‹å¦‚â€œé—®å¥-å›å¤â€å¯¹ã€â€œåŸæ–‡-ç²¾è¦â€å¯¹ç­‰ï¼Œä»¥é€‚é…æ¨¡å‹è®­ç»ƒéœ€æ±‚ã€‚</p>
<p><strong>â€Œå¾®è°ƒæ ·æœ¬æ„å»ºâ€Œ</strong></p>
<p><strong>â€Œæ¨¡æ¿è®¾è®¡â€Œ</strong>ï¼šä¾æ®æ¨¡å‹ç‰¹æ€§ä¸ä»»åŠ¡ç›®æ ‡ï¼Œåˆ¶å®šè¾“å…¥è¾“å‡ºèŒƒä¾‹ã€‚ä¾‹å¦‚åœ¨åŒ»ç–—åœºæ™¯ä¸­ï¼Œè¾“å…¥ä¸ºâ€œä¸»è¯‰ç—‡çŠ¶â€ï¼Œè¾“å‡ºä¸ºâ€œè¯Šç–—æ–¹æ¡ˆâ€ã€‚</p>
<p><strong>â€Œå†…å®¹å¢å¼ºâ€Œ</strong>ï¼šç»“åˆé¢†åŸŸçŸ¥è¯†åº“æˆ–è¡Œä¸šæ ‡å‡†æ–‡ä»¶ï¼Œä¸ºè¾“å…¥æ ·æœ¬è¡¥å……ä¸Šä¸‹æ–‡è¯´æ˜ä¸è§„åˆ™é™åˆ¶ã€‚</p>
<p><strong>â€Œæ•°æ®é›†æ•´åˆâ€Œ</strong>ï¼šå°†æ ·æœ¬ç³»ç»ŸåŒ–æ•´ç†ä¸ºç»Ÿä¸€æ•°æ®é›†ï¼Œä¾›åç»­è®­ç»ƒè°ƒç”¨ã€‚</p>
<p><strong>â€Œå¾®è°ƒç­–ç•¥åˆ¶å®šâ€Œ</strong></p>
<p><strong>â€Œæ¨¡å‹é€‰æ‹©â€Œ</strong>ï¼šä¼˜å…ˆé€‰ç”¨ä¸ä»»åŠ¡åŒ¹é…åº¦é«˜çš„åŸºç¡€æ¨¡å‹ï¼Œå¯æ˜¾è‘—æå‡å¾®è°ƒæ•ˆç‡ã€‚</p>
<p><strong>â€Œç›®æ ‡è®¾å®šâ€Œ</strong>ï¼šé™¤è¯­è¨€ç”Ÿæˆèƒ½åŠ›å¤–ï¼Œéœ€çº³å…¥ä»»åŠ¡ä¸“é¡¹æŒ‡æ ‡ï¼ˆå¦‚ç²¾ç¡®åº¦ã€åˆè§„æ€§ç­‰ï¼‰ã€‚</p>
<p><strong>â€Œå‚æ•°ä¼˜åŒ–â€Œ</strong>ï¼šè°ƒæ•´å­¦ä¹ ç‡ã€è¿­ä»£æ¬¡æ•°ç­‰å‚æ•°ï¼Œå®ç°æ•ˆæœä¸èµ„æºæ¶ˆè€—çš„æœ€ä¼˜é…æ¯”ã€‚</p>
<p><strong>â€Œæ¨¡å‹è®­ç»ƒå®æ–½â€Œ</strong></p>
<p><strong>â€Œå¯åŠ¨è®­ç»ƒâ€Œ</strong>ï¼šåˆ©ç”¨é¢„å¤„ç†æ•°æ®å¯¹é€‰å®šæ¨¡å‹è¿›è¡Œè®­ç»ƒã€‚</p>
<p><strong>â€Œå®æ—¶ç›‘æ§â€Œ</strong>ï¼šè®­ç»ƒè¿‡ç¨‹ä¸­åŠ¨æ€è¯„ä¼°æ•ˆæœï¼ŒåŠæ—¶è°ƒæ•´å‚æ•°ä»¥ç¡®ä¿æ¨¡å‹æ€§èƒ½æŒç»­ä¼˜åŒ–ã€‚</p>
<p><strong>â€Œç‰ˆæœ¬ç­›é€‰â€Œ</strong>ï¼šä»å¤šä¸ªè®­ç»ƒç‰ˆæœ¬ä¸­é€šè¿‡æµ‹è¯•é€‰å‡ºæœ€ä¼˜æ¨¡å‹ã€‚</p>
<p>â€Œ<strong>æ¨¡å‹æ•ˆæœè¯„ä¼°â€Œ</strong></p>
<p><strong>â€Œå¤šç»´æµ‹è¯•â€Œ</strong>ï¼šä½¿ç”¨ç‹¬ç«‹æµ‹è¯•é›†éªŒè¯æ¨¡å‹ï¼Œå…¼é¡¾è¯­è¨€æµç•…åº¦ä¸ä»»åŠ¡è¾¾æˆåº¦ã€‚</p>
<p><strong>â€Œä¸“å®¶éªŒè¯â€Œ</strong>ï¼šé‚€è¯·é¢†åŸŸä¸“å®¶å®¡æ ¸è¾“å‡ºç»“æœï¼Œè¯†åˆ«æ”¹è¿›ç‚¹ã€‚</p>
<p><strong>â€Œè¿­ä»£ä¼˜åŒ–â€Œ</strong>ï¼šåŸºäºæµ‹è¯•åé¦ˆè°ƒæ•´æ•°æ®æˆ–æ¨¡å‹ç»“æ„ï¼Œè¿›è¡Œå¤šè½®ç²¾è¿›ã€‚</p>
<p><strong>â€Œå®é™…åº”ç”¨éƒ¨ç½²â€Œ</strong></p>
<p><strong>â€Œç³»ç»Ÿä¸Šçº¿â€Œ</strong>ï¼šå°†ä¼˜åŒ–åçš„æ¨¡å‹æŠ•å…¥å®é™…ä¸šåŠ¡åœºæ™¯ï¼Œæä¾›æ™ºèƒ½åŒ–æœåŠ¡ã€‚</p>
<p><strong>â€Œäº¤äº’è®¾è®¡â€Œ</strong>ï¼šå¼€å‘æ˜“ç”¨çš„æ“ä½œç•Œé¢ï¼Œé™ä½ç”¨æˆ·ä½¿ç”¨é—¨æ§›ã€‚</p>
<p><strong>â€Œé•¿æ•ˆæ›´æ–°â€Œ</strong>ï¼šæŒç»­æ”¶é›†ç”¨æˆ·åé¦ˆï¼Œå®šæœŸè¿­ä»£æ¨¡å‹ä»¥é€‚åº”é¢†åŸŸçŸ¥è¯†æ¼”è¿›ã€‚</p>
<p><strong>ä¸‰ã€ä»å“ªä¸ªæ¨¡å‹å¼€å§‹å¾®è°ƒï¼ŸåŸºåº§æ¨¡å‹ vs å¯¹è¯æ¨¡å‹</strong></p>
<p>åœ¨è¿›è¡ŒSFTå¾®è°ƒæ—¶ï¼Œä¸€ä¸ªæ ¸å¿ƒå†³ç­–ç‚¹æ˜¯ï¼šä»å“ªä¸ªèµ·ç‚¹å¼€å§‹ï¼Ÿæ˜¯é€‰æ‹©é¢„è®­ç»ƒçš„åŸºç¡€æ¨¡å‹ï¼ˆå³åŸºåº§æ¨¡å‹ï¼‰ï¼Œè¿˜æ˜¯å¯¹è¯æ¨¡å‹ï¼ˆä¾‹å¦‚èŠå¤©æ¨¡å‹ï¼‰ï¼Ÿè¿™ä¸¤ç§è·¯å¾„å„æœ‰å…¶ä¼˜åŠ¿å’Œå±€é™æ€§ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥æ¢è®¨ä¸€ä¸‹ï¼š</p>
<p><strong>1ã€åŸºäºé¢„è®­ç»ƒåŸºç¡€æ¨¡å‹çš„å¾®è°ƒ</strong></p>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<p>â€Œè¯­è¨€èƒ½åŠ›æ·±åšâ€Œï¼šåŸºåº§æ¨¡å‹ç»è¿‡æµ·é‡æ•°æ®è®­ç»ƒï¼Œå…·å¤‡æ‰å®çš„è¯­è¨€ç†è§£å’Œç”Ÿæˆèƒ½åŠ›ï¼Œä¸ºåç»­ä»»åŠ¡å¥ å®šäº†è‰¯å¥½åŸºç¡€ã€‚</p>
<p>â€Œå¯å¡‘æ€§å¼ºâ€Œï¼šæœªé’ˆå¯¹ç‰¹å®šä»»åŠ¡å›ºåŒ–ï¼Œå¯æ ¹æ®å®é™…éœ€æ±‚çµæ´»è°ƒæ•´å¾®è°ƒæ–¹å‘ã€‚</p>
<p>â€Œç»æµæ€§é«˜â€Œï¼šç›¸æ¯”å¯¹è¯æ¨¡å‹ï¼Œå¾®è°ƒè¿‡ç¨‹æ‰€éœ€çš„è®¡ç®—èµ„æºå’Œæ—¶é—´æˆæœ¬æ˜¾è‘—é™ä½ã€‚</p>
<p><strong>ä¸è¶³</strong>ï¼š</p>
<p>â€Œé¢†åŸŸçŸ¥è¯†åŒ®ä¹â€Œï¼šå¯¹ä¸“ä¸šé¢†åŸŸçš„è®¤çŸ¥è¿‘ä¹ç©ºç™½ï¼Œéœ€é€šè¿‡å¤§é‡æ•°æ®å¡«è¡¥çŸ¥è¯†ç¼ºå£ã€‚</p>
<p>â€Œå¯¹è¯é€‚åº”æ€§å·®â€Œï¼šæ›´é€‚åˆå¤„ç†ç‹¬ç«‹æ–‡æœ¬ï¼Œåœ¨å¤šè½®å¯¹è¯åœºæ™¯ä¸­å¯èƒ½è¡¨ç°ç”Ÿç¡¬ã€‚</p>
<p><strong>2ã€åŸºäºå¯¹è¯æ¨¡å‹çš„å¾®è°ƒ</strong></p>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<p>â€Œå¯¹è¯åŸºç¡€æˆç†Ÿâ€Œï¼šå·²æŒæ¡å¯¹è¯äº¤äº’çš„åŸºæœ¬æ¨¡å¼ï¼Œèƒ½æ›´å¿«é€‚åº”ç‰¹å®šé¢†åŸŸçš„å¯¹è¯éœ€æ±‚ã€‚</p>
<p>â€Œä¸Šä¸‹æ–‡è¿è´¯æ€§â€Œï¼šå¯¹å¯¹è¯é€»è¾‘å’Œè¯­å¢ƒçš„æŠŠæ¡æ›´ç²¾å‡†ï¼Œè¾“å‡ºæ›´è‡ªç„¶æµç•…ã€‚</p>
<p>â€Œäº¤äº’ä½“éªŒä¼˜åŒ–â€Œï¼šç”Ÿæˆçš„å“åº”æ›´è´´è¿‘äººç±»äº¤æµä¹ æƒ¯ï¼Œæå‡ç”¨æˆ·æ»¡æ„åº¦ã€‚</p>
<p><strong>ä¸è¶³</strong>ï¼š</p>
<p>â€Œæ½œåœ¨åå·®â€Œï¼šå¯èƒ½ç»§æ‰¿é€šç”¨å¯¹è¯ä¸­çš„æŸäº›å€¾å‘æ€§ï¼Œä¸å‚ç›´é¢†åŸŸéœ€æ±‚å­˜åœ¨å†²çªã€‚</p>
<p>â€ŒçŸ¥è¯†æ·±åº¦æœ‰é™â€Œï¼šä¾§é‡å¯¹è¯äº¤äº’èƒ½åŠ›ï¼Œå¯¹ä¸“ä¸šå¤æ‚çŸ¥è¯†çš„ç†è§£å¯èƒ½ä¸è¶³ã€‚</p>
<p>â€Œèµ„æºæ¶ˆè€—å¤§â€Œï¼šæ¨¡å‹å¤æ‚åº¦æ›´é«˜ï¼Œå¾®è°ƒè¿‡ç¨‹éœ€è¦æ›´å¤šç®—åŠ›å’Œæ•°æ®æ”¯æŒã€‚</p>
<p><strong>3ã€å†³ç­–å»ºè®®</strong></p>
<p>è‹¥ç›®æ ‡æ˜¯æ„å»ºé«˜åº¦ä¸“ä¸šçš„å¯¹è¯ç³»ç»Ÿï¼Œä¸”å…·å¤‡å……è¶³çš„æ•°æ®å’Œç®—åŠ›èµ„æºï¼Œå»ºè®®ä¼˜å…ˆé€‰æ‹©å¯¹è¯æ¨¡å‹ä½œä¸ºèµ·ç‚¹ï¼Œèƒ½å¿«é€Ÿå®ç°é¢†åŸŸé€‚é…å¹¶ä¼˜åŒ–ç”¨æˆ·ä½“éªŒã€‚</p>
<p>è‹¥æ•°æ®æœ‰é™æˆ–ä»»åŠ¡åå‘é€šç”¨æ€§ï¼Œä»åŸºåº§æ¨¡å‹èµ·æ­¥æ›´å…·æ€§ä»·æ¯”ï¼Œèƒ½ä»¥è¾ƒä½æˆæœ¬è·å¾—åˆæ ¼çš„åŸºç¡€æ¨¡å‹ã€‚</p>
<p><strong>æ··åˆç­–ç•¥ä¹Ÿæ˜¯å¯è¡Œæ–¹æ¡ˆ</strong>ï¼šå…ˆé€šè¿‡åŸºåº§æ¨¡å‹å»ºç«‹é¢†åŸŸçŸ¥è¯†åŸºç¡€ï¼Œå†é€šè¿‡å¯¹è¯æ¨¡å‹ä¼˜åŒ–äº¤äº’ä½“éªŒï¼›æˆ–å°è¯•"æç¤ºå·¥ç¨‹"ï¼ˆPrompt Engineeringï¼‰ï¼Œå€ŸåŠ©ç²¾å¿ƒè®¾è®¡çš„è¾“å…¥æ¨¡æ¿å®ç°å¿«é€Ÿé€‚é…ã€‚</p>
<p>æœ€ç»ˆé€‰æ‹©éœ€ç»¼åˆè€ƒé‡ä¸‰ä¸ªå…³é”®å› ç´ ï¼šä»»åŠ¡ç‰¹æ€§ã€æ•°æ®è§„æ¨¡ã€é¢„ç®—é™åˆ¶ã€‚é€šè¿‡ç³»ç»Ÿæƒè¡¡ï¼Œæ‰èƒ½æ‰¾åˆ°æœ€ä¼˜è§£å†³æ–¹æ¡ˆã€‚</p>
<p><strong>å››ã€SFTå¾®è°ƒæœ‰å“ªäº›å®é™…åº”ç”¨ï¼Ÿ</strong></p>
<p>å½“åŸºç¡€æ¨¡å‹èƒ½åŠ›ä¸è¶³ä¸”RAGæŠ€æœ¯ä»æ— æ³•æ»¡è¶³éœ€æ±‚æ—¶ï¼ŒSFTå¾®è°ƒå°†æˆä¸ºå¿…è¦é€‰æ‹©ã€‚å…¶è·¨è¡Œä¸šé€‚ç”¨æ€§æå¼ºï¼Œä»¥ä¸‹ä¸ºå…¸å‹é¢†åŸŸæ¡ˆä¾‹ï¼š</p>
<p><strong>1ã€åŒ»ç–—å¥åº·é¢†åŸŸ</strong></p>
<p><strong>â€Œæ™ºèƒ½é—®è¯Šç³»ç»Ÿâ€Œ</strong>ï¼šåŸºäºæ‚£è€…ç—‡çŠ¶æè¿°ï¼Œè¾“å‡ºåˆæ­¥è¯Šæ–­æˆ–å¥åº·ç®¡ç†æ–¹æ¡ˆã€‚</p>
<p><strong>â€Œè‡ªåŠ¨åŒ–æŠ¥å‘Šç”Ÿæˆâ€Œ</strong>ï¼šæ•´åˆæ£€éªŒæ•°æ®ï¼Œä¸€é”®ç”Ÿæˆæ ‡å‡†åŒ–ç—…å†æˆ–å½±åƒåˆ†ææŠ¥å‘Šã€‚</p>
<p><strong>â€Œæ–°è¯ç ”å‘æ”¯æŒâ€Œ</strong>ï¼šé€šè¿‡åˆ†å­ç»“æ„æ¨¡æ‹Ÿï¼Œè¯„ä¼°è¯ç‰©æ´»æ€§å¹¶åŠ é€Ÿç ”å‘æµç¨‹ã€‚</p>
<p><strong>2ã€æ³•å¾‹å¸æ³•é¢†åŸŸ</strong></p>
<p><strong>â€Œæ™®æ³•æ™ºèƒ½åŠ©æ‰‹â€Œ</strong>ï¼šé¢å‘å…¬ä¼—æä¾›æ³•å¾‹çŸ¥è¯†è§£ç­”ä¸è¯‰è®¼æµç¨‹æŒ‡å¯¼ã€‚</p>
<p><strong>â€ŒåˆåŒé£é™©æ£€æµ‹â€Œ</strong>ï¼šè‡ªåŠ¨è¯†åˆ«æ¡æ¬¾ä¸­çš„æ³•å¾‹æ¼æ´å¹¶ç»™å‡ºä¼˜åŒ–å»ºè®®ã€‚</p>
<p><strong>â€Œå¸æ³•æ¡ˆä¾‹æŒ–æ˜â€Œ</strong>ï¼šä»åˆ¤å†³æ–‡ä¹¦ä¸­æå–è£åˆ¤è§„åˆ™ï¼Œè¾…åŠ©ç±»æ¡ˆåˆ†æã€‚</p>
<p><strong>3ã€é‡‘èç»æµé¢†åŸŸ</strong></p>
<p><strong>â€Œè´¢ç»å¿«è®¯ç”Ÿæˆâ€Œ</strong>ï¼šå®æ—¶èšåˆæ–°é—»å…³é”®ä¿¡æ¯ï¼Œäº§å‡ºå¸‚åœºåŠ¨æ€ç®€æŠ¥ã€‚</p>
<p><strong>â€Œé‡åŒ–æŠ•èµ„åˆ†æâ€Œ</strong>ï¼šèåˆè´¢åŠ¡æ•°æ®ä¸å¸‚åœºæŒ‡æ ‡ï¼Œæ„å»ºè‚¡ä»·é¢„æµ‹æ¨¡å‹ã€‚</p>
<p><strong>â€Œè¡Œä¸šç ”ç©¶æŠ¥å‘Šâ€Œ</strong>ï¼šè‡ªåŠ¨ç”Ÿæˆç»†åˆ†é¢†åŸŸæ´å¯Ÿæˆ–å®è§‚ç»æµè¶‹åŠ¿åˆ†æã€‚</p>
<p>ä¸Šè¿°æ¡ˆä¾‹ä»…ä¸ºSFTå¾®è°ƒå®é™…åº”ç”¨çš„å±€éƒ¨å±•ç°ï¼Œå…¶ä»·å€¼è¾¹ç•Œä»åœ¨æŒç»­æ‹“å±•ä¸­ã€‚</p>
<p><strong>äº”ã€æ€»ç»“</strong></p>
<p>å‚ç›´é¢†åŸŸçš„SFTå¾®è°ƒï¼Œæ˜¯ä¸€æŠŠæ‰“å¼€å¤§è¯­è¨€æ¨¡å‹æ½œåŠ›çš„é’¥åŒ™ã€‚é€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥æŠŠé€šç”¨çš„â€œå…¨èƒ½é€‰æ‰‹â€å˜æˆæŸä¸ªè¡Œä¸šçš„â€œé¡¶å°–ä¸“å®¶â€ã€‚</p>
<p>æ— è®ºæ˜¯åŒ»ç–—è¯Šæ–­ã€æ³•å¾‹å’¨è¯¢ï¼Œè¿˜æ˜¯é‡‘èåˆ†æã€æ•™è‚²è¾…å¯¼ï¼Œåªè¦ç”¨å¯¹äº†æ–¹æ³•ï¼ŒSFTå¾®è°ƒéƒ½èƒ½è®©æ¨¡å‹å¤§æ”¾å¼‚å½©ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œæ–°æ‰‹å¯¹å‚ç›´é¢†åŸŸSFTå¾®è°ƒçš„çƒ­æƒ…æºäºä»–ä»¬å¯¹æŠ€æœ¯çš„å¥½å¥‡ã€å¯¹æˆæœçš„æ¸´æœ›ä»¥åŠå¯¹é£é™©çš„ç›¸å¯¹æ— æ„Ÿï¼Œè€Œä¸“å®¶åˆ™å› ä¸°å¯Œçš„ç»éªŒå’Œå¯¹æŠ€æœ¯è¾¹ç•Œçš„æ¸…é†’è®¤è¯†è€Œæ›´æ˜¾è°¨æ…ã€‚</p>
<p>ä¸ç®¡ä½ æ˜¯åˆå…¥AIé¢†åŸŸçš„æ–°æ‰‹ï¼Œè¿˜æ˜¯æ·±è€•å¤šå¹´çš„ä¸“å®¶ï¼Œç†è§£SFTå¾®è°ƒçš„ä»·å€¼ä¸å±€é™éƒ½è‡³å…³é‡è¦ã€‚æ„¿è¿™ç¯‡æ–‡ç« ç‚¹ç‡ƒä½ çš„æ€è€ƒç«èŠ±ï¼Œæ¿€åŠ±ä½ åœ¨å‚ç›´é¢†åŸŸçš„AIæ¢ç´¢ä¸­æ‰¾åˆ°å±äºè‡ªå·±çš„ç­”æ¡ˆã€‚</p>
<p><strong>æ›´å¤šAIå¤§æ¨¡å‹å­¦ä¹ è§†é¢‘åŠèµ„æºï¼Œéƒ½åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è®¿é—®å®å¡”é¢æ¿å®‰å…¨å…¥å£404ï¼ŸSSHå‘½ä»¤è½»æ¾è§£å†³]]></title>    <link>https://juejin.cn/post/7571285984088850484</link>    <guid>https://juejin.cn/post/7571285984088850484</guid>    <pubDate>2025-11-11T10:18:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571285984088850484" data-draft-id="7571156741398052879" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è®¿é—®å®å¡”é¢æ¿å®‰å…¨å…¥å£404ï¼ŸSSHå‘½ä»¤è½»æ¾è§£å†³"/> <meta itemprop="keywords" content="è¿ç»´,Linux,å®‰å…¨"/> <meta itemprop="datePublished" content="2025-11-11T10:18:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="äº‘åŠ¨é›¨é¢¤"/> <meta itemprop="url" content="https://juejin.cn/user/772323170591859"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è®¿é—®å®å¡”é¢æ¿å®‰å…¨å…¥å£404ï¼ŸSSHå‘½ä»¤è½»æ¾è§£å†³
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/772323170591859/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    äº‘åŠ¨é›¨é¢¤
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T10:18:20.000Z" title="Tue Nov 11 2025 10:18:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ¬æ–‡ç³»è½¬è½½ï¼Œè½¬è½½é“¾æ¥ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwoolyun.com%2Fbt-404%2F" target="_blank" title="https://woolyun.com/bt-404/" ref="nofollow noopener noreferrer">è®¿é—®å®å¡”é¢æ¿å®‰å…¨å…¥å£404ï¼ŸSSHå‘½ä»¤è½»æ¾è§£å†³</a></p>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨æˆ‘ä»¬çš„Linuxäº‘æœåŠ¡å™¨ä¸­å®‰è£…å¥½å®å¡”é¢æ¿åï¼Œå°†å®å¡”é¢æ¿çš„å…¥å£é“¾æ¥å­˜è¿›æµè§ˆå™¨çš„æ”¶è—å¤¹ä¸­ï¼Œæœ¬æƒ³éšç”¨éšå¼€ï¼Œå†æ¬¡è®¿é—®æ—¶å´çªç„¶å¼¹å‡ºâ€œ404 Not Foundâ€ï¼Œè€Œä¸”åœ¨å†å²è®°å½•ä¸­æ‰“å¼€åŒæ ·ä¼šå‡ºç°404é”™è¯¯ã€‚ä»Šå¤©å°±ç»™å¤§å®¶åˆ†äº«ä¸€äº›è§£å†³æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-1">ä¸€ã€404é—®é¢˜åˆ°åº•æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</h2>
<p>ä¸ºäº†æ–¹ä¾¿ç®¡ç†æœåŠ¡å™¨ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠå®å¡”é¢æ¿çš„å…¬ç½‘åœ°å€æ·»åŠ åˆ°æµè§ˆå™¨æ”¶è—å¤¹ã€‚ä½†è¿‡ä¸€æ®µæ—¶é—´å†ç‚¹å¼€ï¼Œé¡µé¢ä¼šæ˜¾ç¤ºâ€œ404 not foundâ€é”™è¯¯ï¼Œå“ªæ€•ä»æµè§ˆå™¨å†å²è®°å½•é‡Œæ‰“å¼€ï¼Œç»“æœä¹Ÿä¸€æ ·â€”â€”è¿™ä¸æ˜¯æœåŠ¡å™¨å‡ºäº†å¤§é—®é¢˜ï¼Œå¤šåŠæ˜¯é¢æ¿çš„â€œè®¿é—®åœ°å€æˆ–å®‰å…¨å…¥å£å˜äº†â€ï¼ŒæŒ‰æ—§åœ°å€æ‰¾è‡ªç„¶ä¼šæ‰‘ç©ºã€‚</p>
<h2 data-id="heading-2">äºŒã€è§£å†³æ–¹æ¡ˆ</h2>
<p>é‡åˆ°404ä¸ç”¨æ…Œï¼Œé€šè¿‡SSHè¿œç¨‹è¿æ¥æœåŠ¡å™¨ï¼Œæ‰§è¡Œç®€å•å‘½ä»¤å°±èƒ½æ‰¾å›è®¿é—®åœ°å€ï¼š</p>
<h3 data-id="heading-3">ç¬¬ä¸€æ­¥ï¼šé€šè¿‡SSHè¿œç¨‹è¿æ¥æœåŠ¡å™¨</h3>
<p>é¦–å…ˆè¦è¿›å…¥æœåŠ¡å™¨çš„åå°â€”â€”ç”¨SSHå·¥å…·ï¼ˆæ¯”å¦‚Xshellã€FinalShellã€PuTTYã€äº‘æœåŠ¡å™¨æ§åˆ¶å°ï¼‰è¿æ¥ä½ çš„LinuxæœåŠ¡å™¨ï¼š</p>
<ul>
<li>æ‰“å¼€SSHå·¥å…·ï¼Œè¾“å…¥æœåŠ¡å™¨çš„å…¬ç½‘IPã€ç«¯å£ï¼ˆé»˜è®¤22ï¼‰ã€ç”¨æˆ·åï¼ˆæ¯”å¦‚rootï¼‰å’Œå¯†ç ï¼ˆæˆ–å¯†é’¥ï¼‰ï¼›</li>
<li>ç‚¹å‡»â€œè¿æ¥â€ï¼Œå¦‚æœå‡ºç°ç±»ä¼¼â€œ[root@localhost ~]#â€çš„å‘½ä»¤è¡Œæç¤ºç¬¦ï¼Œå°±è¯´æ˜è¿æ¥æˆåŠŸäº†ã€‚</li>
</ul>
<h3 data-id="heading-4">ç¬¬äºŒæ­¥ï¼šæ‰§è¡Œå‘½ä»¤ï¼Œé‡æ–°è·å–é¢æ¿è®¿é—®ä¿¡æ¯</h3>
<p>è¿™ä¸€æ­¥æ˜¯æŸ¥è¯¢æ–°çš„é¢æ¿å…¥å£ï¼Œæœ‰ä¸¤ç§ç®€å•æ–¹å¼ï¼Œé€‰ä¸€ç§æ‰§è¡Œå³å¯ï¼š</p>
<h4 data-id="heading-5">æ–¹å¼ä¸€ï¼šä¸€æ­¥åˆ°ä½æ‰§è¡Œå‘½ä»¤</h4>
<p>åœ¨å‘½ä»¤è¡Œè¾“å…¥ä»¥ä¸‹ä»£ç ï¼ŒæŒ‰å›è½¦ï¼š</p>
<pre><code class="hljs">bt 14
</code></pre>
<h4 data-id="heading-6">æ–¹å¼äºŒï¼šåˆ†æ­¥æ‰§è¡Œå‘½ä»¤</h4>
<p>å¦‚æœæƒ³çœ‹æ¸…æ¯ä¸€æ­¥æ“ä½œï¼Œä¹Ÿå¯ä»¥åˆ†ä¸¤æ­¥æ¥ï¼š</p>
<ol>
<li>å…ˆè¾“å…¥ <code>bt</code> å¹¶å›è½¦ï¼Œæ­¤æ—¶ä¼šå¼¹å‡ºå®å¡”é¢æ¿çš„å‘½ä»¤èœå•ï¼›</li>
<li>åœ¨èœå•ä¸­è¾“å…¥æ•°å­— <code>14</code> å¹¶å›è½¦ï¼ˆ<code>14</code> å¯¹åº”çš„åŠŸèƒ½å°±æ˜¯â€œæŸ¥çœ‹é¢æ¿é»˜è®¤ä¿¡æ¯â€ï¼‰ã€‚</li>
</ol>
<p>æ‰§è¡Œå®Œå‘½ä»¤åï¼Œç»ˆç«¯ä¼šæ˜¾ç¤ºæ–°çš„å®å¡”é¢æ¿è®¿é—®åœ°å€ï¼ˆæ¯”å¦‚ <code>https://æ–°IP:æ–°ç«¯å£/æ–°å®‰å…¨å…¥å£</code>ï¼‰å’Œå®‰å…¨å…¥å£éªŒè¯ä¿¡æ¯ï¼ŒæŠŠè¿™ä¸ªæ–°åœ°å€è®°ä¸‹æ¥ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69708427e24441bcb07dfe364d36be4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LqR5Yqo6Zuo6aKk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763461099&amp;x-signature=m6Z0jPQx5uq8Gr6bboyae%2BSTz2A%3D" alt="å®å¡”4041" loading="lazy"/></p>
<h3 data-id="heading-7">ç¬¬ä¸‰æ­¥ï¼šç”¨æ–°åœ°å€è®¿é—®é¢æ¿</h3>
<p>æ‰“å¼€æµè§ˆå™¨ï¼ŒæŠŠåˆšè·å–çš„æ–°åœ°å€ç²˜è´´åˆ°åœ°å€æ ï¼ŒæŒ‰å›è½¦â€”â€”ä¸å‡ºæ„å¤–ï¼Œå°±èƒ½æ­£å¸¸è¿›å…¥å®å¡”é¢æ¿çš„ç™»å½•é¡µé¢ï¼Œ404é—®é¢˜ä¹Ÿå°±è§£å†³äº†ã€‚</p>
<h2 data-id="heading-8">ä¸‰ã€å½»åº•é¿å…ï¼šè®¾ç½®å›ºå®šå®‰å…¨å…¥å£ï¼Œå†ä¹Ÿä¸æ€•åœ°å€å˜åŠ¨</h2>
<p>è¿™æ¬¡è§£å†³äº†ï¼Œä¸‹æ¬¡è¿˜å¯èƒ½é‡åˆ°ï¼Ÿå…¶å®åªè¦ç»™å®å¡”é¢æ¿â€œå›ºå®šå…¥å£â€ï¼Œå°±èƒ½ä¸€åŠ³æ°¸é€¸ï¼š</p>
<h3 data-id="heading-9">ç¬¬ä¸€æ­¥ï¼šè¿›å…¥å®å¡”é¢æ¿</h3>
<p>ç”¨åˆšè·å–çš„æ–°åœ°å€ç™»å½•å®å¡”é¢æ¿ï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œè¿›å…¥é¢æ¿ç®¡ç†ç•Œé¢ã€‚</p>
<h3 data-id="heading-10">ç¬¬äºŒæ­¥ï¼šæ‰¾åˆ°â€œé¢æ¿è®¾ç½®â€</h3>
<p>åœ¨é¢æ¿å·¦ä¾§çš„èœå•æ ä¸­ï¼Œæ‰¾åˆ°å¹¶ç‚¹å‡»â€œé¢æ¿è®¾ç½®â€é€‰é¡¹ã€‚</p>
<h3 data-id="heading-11">ç¬¬ä¸‰æ­¥ï¼šä¿®æ”¹å¹¶å›ºå®šå®‰å…¨å…¥å£</h3>
<p>åœ¨â€œé¢æ¿è®¾ç½®â€é¡µé¢ä¸­ï¼Œå¾€ä¸‹æ»‘åŠ¨æ‰¾åˆ°â€œå®‰å…¨å…¥å£â€è®¾ç½®é¡¹ï¼š</p>
<ul>
<li>é»˜è®¤çš„å®‰å…¨å…¥å£æ˜¯éšæœºç”Ÿæˆçš„ï¼ˆæ¯”å¦‚ <code>randomentry123</code>ï¼‰ï¼Œå®¹æ˜“å˜åŠ¨ï¼›</li>
<li>æŠŠå®ƒä¿®æ”¹æˆä½ å®¹æ˜“è®°ä½ä¸”ç‹¬ç‰¹çš„å†…å®¹ï¼ˆæ¯”å¦‚ <code>mybaotaentry</code>ï¼Œå»ºè®®åŒ…å«å­—æ¯å’Œæ•°å­—ï¼Œé¿å…å¤ªç®€å•è¢«çŒœæµ‹ï¼‰ï¼›</li>
<li>ç‚¹å‡»â€œä¿å­˜â€æŒ‰é’®ï¼Œæ­¤æ—¶å®å¡”é¢æ¿çš„è®¿é—®åœ°å€å°±å›ºå®šä¸º <code>https://ä½ çš„æœåŠ¡å™¨IP:é¢æ¿ç«¯å£/ä½ è®¾ç½®çš„å®‰å…¨å…¥å£</code>ï¼Œä»¥åä¸ç®¡æ€ä¹ˆå˜åŠ¨ï¼Œè¿™ä¸ªåœ°å€éƒ½èƒ½æ­£å¸¸è®¿é—®ã€‚</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec8dcce637bc47f281f154b8da6618f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LqR5Yqo6Zuo6aKk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763461099&amp;x-signature=VXamsE%2B%2Bu%2FBSt5gdePD7uCrEkUQ%3D" alt="å®å¡”4042" loading="lazy"/></p>
<h2 data-id="heading-12">å››ã€æ€»ç»“</h2>
<p>å®å¡”Linuxé¢æ¿å‡ºç°404ï¼Œæœ€å¤§åŸå› å¯èƒ½æ˜¯â€œè®¿é—®åœ°å€æˆ–å®‰å…¨å…¥å£å˜åŠ¨â€ï¼Œé‚£ä¹ˆè§£å†³æ€è·¯ä¹…å¾ˆæ¸…æ™°äº†ï¼š</p>
<ol>
<li>ç”¨SSHè¿æ¥æœåŠ¡å™¨ï¼Œæ‰§è¡Œ <code>bt 14</code> æ‰¾åˆ°æ–°åœ°å€ï¼›</li>
<li>ç™»å½•é¢æ¿åï¼Œåœ¨â€œé¢æ¿è®¾ç½®â€ä¸­å›ºå®šå®‰å…¨å…¥å£ï¼Œé¿å…åç»­å˜åŠ¨ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CI/CDé›†æˆå·¥ç¨‹å¸ˆå‰æ™¯åˆ†æï¼šä¸å¼€å‘å²—ä½çš„å…¨é¢å¯¹æ¯”]]></title>    <link>https://juejin.cn/post/7571338749197566002</link>    <guid>https://juejin.cn/post/7571338749197566002</guid>    <pubDate>2025-11-11T13:56:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571338749197566002" data-draft-id="7571352754895994906" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CI/CDé›†æˆå·¥ç¨‹å¸ˆå‰æ™¯åˆ†æï¼šä¸å¼€å‘å²—ä½çš„å…¨é¢å¯¹æ¯”"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-11T13:56:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="oioihoii"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CI/CDé›†æˆå·¥ç¨‹å¸ˆå‰æ™¯åˆ†æï¼šä¸å¼€å‘å²—ä½çš„å…¨é¢å¯¹æ¯”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    oioihoii
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T13:56:08.000Z" title="Tue Nov 11 2025 13:56:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åœ¨å½“ä»Šå¿«é€Ÿè¿­ä»£çš„è½¯ä»¶å¼€å‘ç¯å¢ƒä¸­ï¼ŒCI/CDé›†æˆå·¥ç¨‹å¸ˆå·²æˆä¸ºä¼—å¤šç§‘æŠ€å…¬å¸ä¸å¯æˆ–ç¼ºçš„è§’è‰²ï¼Œä½†äººä»¬å¸¸å¥½å¥‡ï¼šè¿™ä¸€æ–°å…´å²—ä½ä¸ä¼ ç»Ÿå¼€å‘ç›¸æ¯”ç©¶ç«Ÿå­°ä¼˜å­°åŠ£ï¼Ÿ</p>
</blockquote>
<p>éšç€ DevOps ç†å¿µçš„æ™®åŠï¼ŒCI/CDï¼ˆæŒç»­é›†æˆ/æŒç»­äº¤ä»˜ï¼‰å·²æˆä¸ºç°ä»£è½¯ä»¶å¼€å‘çš„<strong>æ ¸å¿ƒå®è·µ</strong>ã€‚CI/CDé›†æˆå·¥ç¨‹å¸ˆä½œä¸ºè¿™ä¸€è¿‡ç¨‹çš„æ„å»ºè€…å’Œç»´æŠ¤è€…ï¼Œåœ¨å½“å‰çš„ITè¡Œä¸šä¸­éœ€æ±‚è¶Šæ¥è¶Šå¤§ï¼Œå› ä¸ºè½¯ä»¶å¼€å‘çš„é€Ÿåº¦å’Œè´¨é‡å·²æˆä¸º<strong>ä¼ä¸šç«äº‰çš„é‡è¦å› ç´ </strong>ä¹‹ä¸€ã€‚</p>
<p>ä¸æ­¤åŒæ—¶ï¼Œéšç€äº‘è®¡ç®—å’Œ DevOps çš„å…´èµ·ï¼Œæ›´å¤šä¼ä¸šå¼€å§‹é‡‡ç”¨ CI/CD æ¥æé«˜è½¯ä»¶äº¤ä»˜æ•ˆç‡ã€‚</p>
<hr/>
<h2 data-id="heading-0">01 CI/CDé›†æˆå·¥ç¨‹å¸ˆçš„è§’è‰²ä¸èŒè´£</h2>
<p>CI/CD é›†æˆå·¥ç¨‹å¸ˆä¸»è¦è´Ÿè´£è®¾è®¡å’Œå®æ–½è‡ªåŠ¨åŒ–æµç¨‹ï¼Œä½¿è½¯ä»¶èƒ½å¤Ÿæ›´åŠ é«˜æ•ˆã€å¯é åœ°æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²ã€‚</p>
<p><strong>æŒç»­é›†æˆ</strong>ï¼ˆCIï¼‰æ˜¯ä¸€ç§è½¯ä»¶å¼€å‘å®è·µï¼Œå¼€å‘äººå‘˜é¢‘ç¹åœ°å°†ä»£ç å˜æ›´åˆå¹¶åˆ°å…±äº«ä»“åº“ä¸­ï¼Œæ¯æ¬¡å˜æ›´éƒ½ä¼šè§¦å‘<strong>è‡ªåŠ¨åŒ–æ„å»ºå’Œæµ‹è¯•</strong>ã€‚</p>
<p><strong>æŒç»­äº¤ä»˜</strong>ï¼ˆCDï¼‰åˆ™æ˜¯åœ¨æ­¤åŸºç¡€ä¸Šï¼Œè‡ªåŠ¨å°†ä»£ç å˜æ›´éƒ¨ç½²åˆ°å„ç§ç¯å¢ƒï¼Œç¡®ä¿è½¯ä»¶éšæ—¶å¯ä»¥å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼ŒCI/CDé›†æˆå·¥ç¨‹å¸ˆéœ€è¦ç¡®ä¿å›¢é˜Ÿä½¿ç”¨çš„æŒç»­é›†æˆå·¥å…·å’Œæµç¨‹èƒ½å¤Ÿé¡ºåˆ©åœ°è‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²è½¯ä»¶ã€‚</p>
<p>ä»–ä»¬éœ€è¦ç†Ÿç»ƒæŒæ¡ <strong>Jenkinsã€GitLab CIã€GitHub Actions</strong> ç­‰å·¥å…·ï¼Œå¹¶èƒ½å¤Ÿè¿ç”¨ Docker å’Œ Kubernetes ç­‰å®¹å™¨åŒ–æŠ€æœ¯è¿›è¡Œè‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚</p>
<p>åœ¨èŒè´£æ–¹é¢ï¼ŒCI/CDé›†æˆå·¥ç¨‹å¸ˆéœ€è¦å¼€å‘å’Œæ„å»ºè‡ªåŠ¨åŒ–æ¡†æ¶ï¼ŒåŒ…æ‹¬æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²æµç¨‹ã€‚</p>
<p>ä»–ä»¬è¿˜è¦æ´å¯Ÿå¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²ä¸­çš„éš¾ç‚¹å’Œç“¶é¢ˆï¼ŒæŒç»­æ”¹è¿›ä»¥ä¿è¯é¡¹ç›®é¡ºåˆ©è¿›è¡Œã€‚</p>
<h2 data-id="heading-1">02 å¼€å‘å·¥ç¨‹å¸ˆçš„è§’è‰²ä¸èŒè´£</h2>
<p>å¼€å‘å·¥ç¨‹å¸ˆä¸»è¦è´Ÿè´£è½¯ä»¶çš„è®¾è®¡ã€ç¼–ç å’Œå•å…ƒæµ‹è¯•ï¼Œæ˜¯è½¯ä»¶äº§å“çš„<strong>ç›´æ¥åˆ›é€ è€…</strong>ã€‚</p>
<p>ä¸CI/CDå·¥ç¨‹å¸ˆä¸åŒï¼Œå¼€å‘å·¥ç¨‹å¸ˆæ›´å…³æ³¨ä»£ç çš„å®ç°ã€ç®—æ³•çš„ä¼˜åŒ–ä»¥åŠåŠŸèƒ½çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ã€‚</p>
<p>å¼€å‘å·¥ç¨‹å¸ˆéœ€è¦æ ¹æ®äº§å“éœ€æ±‚ç¼–å†™é«˜è´¨é‡çš„ä»£ç ï¼Œå¹¶å‚ä¸ç³»ç»Ÿæ¶æ„è®¾è®¡ã€‚ä»–ä»¬é€šå¸¸ä¼šä¸“æ³¨äºç‰¹å®šçš„æŠ€æœ¯æ ˆï¼Œå¦‚å‰ç«¯ã€åç«¯æˆ–ç§»åŠ¨ç«¯å¼€å‘ã€‚</p>
<p>é™¤äº†ç¼–å†™ä»£ç ï¼Œå¼€å‘å·¥ç¨‹å¸ˆè¿˜éœ€è¦ä¿®å¤ç³»ç»Ÿä¸­çš„ç¼ºé™·ï¼Œè¿›è¡Œä»£ç å®¡æŸ¥ï¼Œä»¥åŠä¸å›¢é˜Ÿæˆå‘˜åä½œè§£å†³æŠ€æœ¯éš¾é¢˜ã€‚</p>
<h2 data-id="heading-2">03 èŒä¸šå‰æ™¯å¯¹æ¯”ï¼šå¸‚åœºéœ€æ±‚ä¸å‘å±•ç©ºé—´</h2>
<p><strong>CI/CDé›†æˆå·¥ç¨‹å¸ˆå‰æ™¯å¹¿é˜”</strong>ã€‚éšç€ä¼ä¸šå¯¹è½¯ä»¶äº¤ä»˜é€Ÿåº¦å’Œè´¨é‡è¦æ±‚çš„ä¸æ–­æé«˜ï¼ŒCI/CDé›†æˆå·¥ç¨‹å¸ˆçš„éœ€æ±‚å‘ˆç°å‡º<strong>å¢é•¿è¶‹åŠ¿</strong>ã€‚</p>
<p>åœ¨æ‹›è˜å¸‚åœºä¸Šï¼Œå¯ä»¥çœ‹åˆ°ä¼—å¤šä¼ä¸šæ­£åœ¨æ‹›è˜CI/CDé›†æˆå·¥ç¨‹å¸ˆï¼Œæä¾›çš„è–ªèµ„ä¹Ÿé¢‡å…·ç«äº‰åŠ›ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæ¥è‡ª1111äººåŠ›é“¶è¡Œçš„æ‹›è˜ä¿¡æ¯æ˜¾ç¤ºï¼ŒCI/CDç›¸å…³èŒä½çš„æœˆè–ªåœ¨å°æ¹¾åœ°åŒºå¯è¾¾<strong>6ä¸‡åˆ°10ä¸‡æ–°å°å¸</strong>ã€‚</p>
<p>è€ŒçŒè˜ç½‘çš„æ‹›è˜ä¿¡æ¯åˆ™æ˜¾ç¤ºï¼ŒåŒ—äº¬çš„CI/CDé›†æˆå·¥ç¨‹å¸ˆè–ªèµ„å¯è¾¾<strong>15-25k</strong>äººæ°‘å¸ã€‚</p>
<p>å¼€å‘å·¥ç¨‹å¸ˆè™½ç„¶å¸‚åœºéœ€æ±‚é‡å¤§ï¼Œä½†ç”±äºä»ä¸šäººæ•°ä¼—å¤šï¼Œ<strong>ç«äº‰ä¹Ÿæ›´ä¸ºæ¿€çƒˆ</strong>ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒCI/CDé›†æˆå·¥ç¨‹å¸ˆä½œä¸ºç›¸å¯¹ä¸“ä¸šçš„é¢†åŸŸï¼Œç«äº‰ç¨‹åº¦è¾ƒä½ï¼Œä¸”ç”±äºç¼ºä¹èµ„æ·±äººæ‰ï¼Œé«˜çº§èŒä½çš„è–ªèµ„æ½œåŠ›æ›´å¤§ã€‚</p>
<p>éšç€äº‘åŸç”Ÿå’Œå¾®æœåŠ¡æ¶æ„çš„æ™®åŠï¼ŒCI/CDé›†æˆå·¥ç¨‹å¸ˆçš„é‡è¦æ€§å°†è¿›ä¸€æ­¥å‡¸æ˜¾ï¼ŒèŒä¸šå‘å±•ç©ºé—´æŒç»­çœ‹å¥½ã€‚</p>
<h2 data-id="heading-3">04 æŠ€èƒ½è¦æ±‚å¯¹æ¯”ï¼šæŠ€æœ¯æ ˆä¸çŸ¥è¯†ä½“ç³»</h2>
<p>CI/CDé›†æˆå·¥ç¨‹å¸ˆéœ€è¦æŒæ¡å¤šæ ·åŒ–çš„æŠ€æœ¯æ ˆã€‚é¦–å…ˆï¼Œä»–ä»¬éœ€è¦ç†Ÿæ‚‰ <strong>CI/CDå·¥å…·é“¾</strong>ï¼Œå¦‚Jenkinsã€GitLab CIã€GitHub Actionsç­‰ã€‚</p>
<p>å…¶æ¬¡ï¼Œä»–ä»¬éœ€è¦æŒæ¡ <strong>Dockerå’ŒKubernetesç­‰å®¹å™¨åŒ–æŠ€æœ¯</strong>ï¼Œä»¥åŠè‡ªåŠ¨åŒ–éƒ¨ç½²æŠ€å·§ã€‚</p>
<p>æ­¤å¤–ï¼Œä»–ä»¬è¿˜éœ€è¦äº†è§£<strong>åŸºç¡€è®¾æ–½å³ä»£ç </strong>ï¼ˆIaCï¼‰å·¥å…·ï¼Œå¦‚Terraformã€Ansibleç­‰ã€‚</p>
<p>å¯¹ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆå°¤å…¶æ˜¯Gitï¼‰çš„æ·±å…¥ç†è§£ä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„ã€‚ä¸å¼€å‘å·¥ç¨‹å¸ˆç›¸æ¯”ï¼ŒCI/CDé›†æˆå·¥ç¨‹å¸ˆæ›´éœ€è¦<strong>ç³»ç»Ÿæ¶æ„è§†è§’</strong>å’Œ<strong>è·¨ç¯å¢ƒé—®é¢˜è§£å†³èƒ½åŠ›</strong>ã€‚</p>
<p>å¼€å‘å·¥ç¨‹å¸ˆåˆ™æ›´éœ€è¦<strong>æ·±åšçš„ç¼–ç¨‹åŠŸåº•</strong>ï¼Œ<strong>å¯¹ç®—æ³•å’Œæ•°æ®ç»“æ„çš„ç†è§£</strong>ï¼Œä»¥åŠ<strong>ç‰¹å®šæŠ€æœ¯æ ˆçš„ä¸“ä¸šçŸ¥è¯†</strong>ã€‚</p>
<p>ä¾‹å¦‚ï¼ŒJavaå¼€å‘å·¥ç¨‹å¸ˆéœ€è¦æŒæ¡Springæ¡†æ¶ï¼Œå‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆéœ€è¦ç†Ÿæ‚‰Reactæˆ–Vueç­‰æ¡†æ¶ã€‚</p>
<p>å¼€å‘å·¥ç¨‹å¸ˆé€šå¸¸æ›´ä¸“æ³¨äºä»£ç å±‚é¢ï¼Œè€ŒCI/CDé›†æˆå·¥ç¨‹å¸ˆåˆ™éœ€è¦æ›´å¹¿æ³›çš„ç³»ç»Ÿçº§çŸ¥è¯†å’Œè‡ªåŠ¨åŒ–èƒ½åŠ›ã€‚</p>
<h2 data-id="heading-4">05 å·¥ä½œå†…å®¹ä¸å›¢é˜Ÿåä½œå·®å¼‚</h2>
<p>CI/CDé›†æˆå·¥ç¨‹å¸ˆçš„å·¥ä½œå†…å®¹ä¸»è¦é›†ä¸­åœ¨<strong>è‡ªåŠ¨åŒ–æµç¨‹çš„æ„å»ºå’Œä¼˜åŒ–</strong>ä¸Šã€‚ä»–ä»¬éœ€è¦è®¾è®¡CI/CDæµæ°´çº¿ï¼Œå®ç°è‡ªåŠ¨åŒ–æ„å»ºã€é™æ€ä»£ç æ£€æŸ¥ã€è‡ªåŠ¨åŒ–æµ‹è¯•ç­‰ã€‚</p>
<p>ä»–ä»¬è¿˜éœ€è¦å¤„ç†éƒ¨ç½²è¿‡ç¨‹ä¸­çš„å„ç§é—®é¢˜ï¼Œç¡®ä¿éƒ¨ç½²çš„å¯é æ€§å’Œæ•ˆç‡ã€‚åœ¨å›¢é˜Ÿåä½œæ–¹é¢ï¼ŒCI/CDé›†æˆå·¥ç¨‹å¸ˆéœ€è¦ä¸å¼€å‘äººå‘˜ã€æµ‹è¯•äººå‘˜å’Œè¿ç»´äººå‘˜å¯†åˆ‡åˆä½œï¼Œæ˜¯** DevOps æ–‡åŒ–çš„å…³é”®å®è·µè€…**ã€‚</p>
<p>å¼€å‘å·¥ç¨‹å¸ˆåˆ™ä¸»è¦ä¸“æ³¨äº<strong>åŠŸèƒ½å®ç°å’Œä»£ç ç¼–å†™</strong>ã€‚ä»–ä»¬éœ€è¦å‚ä¸éœ€æ±‚åˆ†æï¼Œè¿›è¡Œè½¯ä»¶è®¾è®¡ï¼Œç¼–å†™ä»£ç ï¼Œå®Œæˆå•å…ƒæµ‹è¯•ï¼Œå¹¶ä¿®å¤æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°çš„é—®é¢˜ã€‚</p>
<p>å¼€å‘å·¥ç¨‹å¸ˆé€šå¸¸æŒ‰äº§å“åŠŸèƒ½æˆ–æŠ€æœ¯æ¨¡å—åˆ’åˆ†èŒè´£ï¼Œä¸äº§å“ç»ç†å’Œæµ‹è¯•å·¥ç¨‹å¸ˆçš„åä½œæ›´ä¸ºç´§å¯†ã€‚</p>
<p>ä»å·¥ä½œæ€§è´¨æ¥çœ‹ï¼ŒCI/CDé›†æˆå·¥ç¨‹å¸ˆçš„å·¥ä½œæ›´åå‘<strong>æµç¨‹å’Œè´¨é‡ä¿éšœ</strong>ï¼Œè€Œå¼€å‘å·¥ç¨‹å¸ˆçš„å·¥ä½œæ›´åå‘<strong>åŠŸèƒ½å®ç°å’Œåˆ›æ–°</strong>ã€‚</p>
<h2 data-id="heading-5">06 è–ªèµ„å¾…é‡ä¸èŒä¸šå‘å±•è·¯å¾„</h2>
<p>åœ¨è–ªèµ„å¾…é‡æ–¹é¢ï¼Œä¸¤ç±»å²—ä½éƒ½æœ‰ä¸é”™çš„è¡¨ç°ã€‚æ ¹æ®æ‹›è˜ä¿¡æ¯æ˜¾ç¤ºï¼ŒCI/CDé›†æˆå·¥ç¨‹å¸ˆçš„è–ªèµ„æ™®éè¾ƒé«˜ï¼Œç‰¹åˆ«æ˜¯æ‹¥æœ‰å¤šå¹´ç»éªŒçš„é«˜çº§å·¥ç¨‹å¸ˆã€‚</p>
<p>å¼€å‘å·¥ç¨‹å¸ˆçš„è–ªèµ„èŒƒå›´è¾ƒä¸ºå¹¿æ³›ï¼Œåˆçº§å¼€å‘å·¥ç¨‹å¸ˆçš„èµ·è–ªå¯èƒ½ç›¸å¯¹è¾ƒä½ï¼Œä½†éšç€ç»éªŒç§¯ç´¯å’ŒæŠ€æœ¯æå‡ï¼Œé«˜çº§å¼€å‘å·¥ç¨‹å¸ˆå’Œæ¶æ„å¸ˆçš„è–ªèµ„ä¹Ÿéå¸¸å¯è§‚ã€‚</p>
<p>èŒä¸šå‘å±•è·¯å¾„æ–¹é¢ï¼ŒCI/CDé›†æˆå·¥ç¨‹å¸ˆå¯ä»¥å‘<strong>DevOpsæ¶æ„å¸ˆ</strong>ã€<strong>å¹³å°å·¥ç¨‹å¸ˆ</strong>æˆ–<strong>SRE</strong>ï¼ˆç«™ç‚¹å¯é æ€§å·¥ç¨‹å¸ˆï¼‰æ–¹å‘å‘å±•ã€‚</p>
<p>ä»–ä»¬è¿˜å¯ä»¥æˆä¸º<strong>CI/CDä¸“å®¶</strong>ï¼Œè´Ÿè´£æ›´å¤æ‚å’Œå¤§å‹çš„ç³»ç»Ÿæ¶æ„ã€‚</p>
<p>å¼€å‘å·¥ç¨‹å¸ˆåˆ™å¯ä»¥å‘<strong>é«˜çº§å¼€å‘å·¥ç¨‹å¸ˆ</strong>ã€<strong>ç³»ç»Ÿæ¶æ„å¸ˆ</strong>æˆ–<strong>æŠ€æœ¯è´Ÿè´£äºº</strong>æ–¹å‘å‘å±•ï¼Œä¹Ÿæœ‰æœºä¼šè½¬å‹ä¸º<strong>æŠ€æœ¯ç»ç†</strong>æˆ–<strong>äº§å“ç»ç†</strong>ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒCI/CDé›†æˆå·¥ç¨‹å¸ˆçš„èŒä¸šå‘å±•è·¯å¾„ç›¸å¯¹è¾ƒæ–°ï¼Œæœºä¼šå¯èƒ½æ›´å¤šï¼Œå› ä¸ºè¿™ä¸€é¢†åŸŸçš„ä¸“ä¸šäººæ‰ä»ç„¶ç›¸å¯¹ç¨€ç¼ºã€‚</p>
<h2 data-id="heading-6">07 å¦‚ä½•é€‰æ‹©ï¼šæ ¹æ®ä¸ªäººç‰¹è´¨ä¸å…´è¶£</h2>
<p>é€‰æ‹©æˆä¸ºCI/CDé›†æˆå·¥ç¨‹å¸ˆè¿˜æ˜¯å¼€å‘å·¥ç¨‹å¸ˆï¼Œåº”åŸºäºä¸ªäººæŠ€æœ¯åå¥½å’ŒèŒä¸šè§„åˆ’ã€‚</p>
<p>å¦‚æœä½ å¯¹<strong>è‡ªåŠ¨åŒ–ã€ç³»ç»Ÿæ¶æ„å’Œæµç¨‹ä¼˜åŒ–</strong>æ„Ÿå…´è¶£ï¼Œå–œæ¬¢çœ‹åˆ°è‡ªå·±çš„å·¥ä½œå¸¦æ¥æ•ˆç‡çš„æ˜¾è‘—æå‡ï¼Œé‚£ä¹ˆCI/CDé›†æˆå·¥ç¨‹å¸ˆå¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p>
<p>è¿™ä¸€å²—ä½éœ€è¦<strong>è¾ƒå¼ºçš„é€»è¾‘æ€ç»´</strong>å’Œ<strong>ç³»ç»Ÿåˆ†æèƒ½åŠ›</strong>ï¼Œä»¥åŠ<strong>è§£å†³å¤æ‚é—®é¢˜çš„è€å¿ƒ</strong>ã€‚</p>
<p>å¦‚æœä½ æ›´äº«å—<strong>ä»£ç ç¼–å†™å’ŒåŠŸèƒ½å®ç°</strong>çš„è¿‡ç¨‹ï¼Œå–œæ¬¢ä»é›¶å¼€å§‹æ„å»ºäº§å“ï¼Œå¹¶å…·å¤‡<strong>è¾ƒå¼ºçš„åˆ›é€ åŠ›</strong>ï¼Œé‚£ä¹ˆå¼€å‘å·¥ç¨‹å¸ˆå¯èƒ½æ›´é€‚åˆä½ ã€‚</p>
<p>è¿™ä¸€å²—ä½éœ€è¦<strong>æŒç»­å­¦ä¹ æ–°æŠ€æœ¯</strong>çš„èƒ½åŠ›å’Œ<strong>å¯¹ç»†èŠ‚çš„å…³æ³¨</strong>ã€‚</p>
<p>æ— è®ºé€‰æ‹©å“ªæ¡è·¯å¾„ï¼Œéƒ½éœ€è¦ä¸æ–­å­¦ä¹ æ–°çŸ¥è¯†å’ŒæŠ€èƒ½ã€‚å¯¹äºåˆå­¦è€…ï¼Œå»ºè®®å…ˆç§¯ç´¯ä¸€å®šçš„å¼€å‘ç»éªŒï¼Œå†å‘CI/CDé¢†åŸŸå‘å±•ï¼Œè¿™æ ·ä¼šæœ‰æ›´æ‰å®çš„åŸºç¡€å’Œæ›´å…¨é¢çš„è§†è§’ã€‚</p>
<hr/>
<p><strong>æœªæ¥å·²æ¥</strong>ï¼Œéšç€äº‘åŸç”Ÿã€äººå·¥æ™ºèƒ½ç­‰æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼ŒCI/CDé›†æˆå·¥ç¨‹å¸ˆçš„å·¥ä½œå†…å®¹å°†è¿›ä¸€æ­¥ä¸°å¯Œï¼Œä»–ä»¬å°†åœ¨<strong>æ™ºèƒ½è¿ç»´ã€è‡ªåŠ¨åŒ–æµ‹è¯•ä¼˜åŒ–</strong>ç­‰é¢†åŸŸå‘æŒ¥æ›´å¤§ä»·å€¼ã€‚</p>
<p>è€Œå¯¹äºå¼€å‘å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œ<strong>æŒæ¡CI/CDçŸ¥è¯†</strong>ä¹Ÿå°†ä»â€œåŠ åˆ†é¡¹â€å˜ä¸ºâ€œå¿…éœ€é¡¹â€ï¼Œåªæœ‰ç†è§£å®Œæ•´è½¯ä»¶äº¤ä»˜æµç¨‹çš„å¼€å‘å·¥ç¨‹å¸ˆï¼Œæ‰èƒ½åœ¨æœªæ¥çš„å›¢é˜Ÿä¸­å‘æŒ¥æ›´å¤§ä½œç”¨ã€‚</p>
<p>æ— è®ºé€‰æ‹©å“ªæ¡è·¯å¾„ï¼Œ<strong>æŒç»­å­¦ä¹ </strong>å’Œ<strong>å®è·µéªŒè¯</strong>éƒ½æ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++ä¸­çš„çº¿ç¨‹åŒæ­¥æœºåˆ¶æµ…æ]]></title>    <link>https://juejin.cn/post/7571338749197598770</link>    <guid>https://juejin.cn/post/7571338749197598770</guid>    <pubDate>2025-11-11T13:57:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571338749197598770" data-draft-id="7571332468897775643" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++ä¸­çš„çº¿ç¨‹åŒæ­¥æœºåˆ¶æµ…æ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-11T13:57:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="oioihoii"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++ä¸­çš„çº¿ç¨‹åŒæ­¥æœºåˆ¶æµ…æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    oioihoii
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T13:57:30.000Z" title="Tue Nov 11 2025 13:57:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">1. ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹åŒæ­¥ï¼Ÿ</h3>
<p>å½“å¤šä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®å…±äº«æ•°æ®ï¼ˆå†…å­˜ã€æ–‡ä»¶ã€ç½‘ç»œè¿æ¥ç­‰ï¼‰æ—¶ï¼Œå¦‚æœä¸è¿›è¡Œä»»ä½•åŒæ­¥æ§åˆ¶ï¼Œå¯èƒ½ä¼šå¼•å‘ä¸€ç³»åˆ—é—®é¢˜ï¼Œæœ€å…¸å‹çš„æ˜¯ï¼š</p>
<ul>
<li><strong>æ•°æ®ç«äº‰</strong>ï¼šä¸€ä¸ªçº¿ç¨‹åœ¨è¯»æ•°æ®æ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹åœ¨å†™æ•°æ®ï¼Œå¯¼è‡´è¯»åˆ°çš„æ•°æ®æ˜¯â€œè„çš„â€ã€ä¸å®Œæ•´çš„æˆ–é€»è¾‘é”™è¯¯çš„ã€‚</li>
<li><strong>ç ´åä¸å˜é‡</strong>ï¼šå¯¹è±¡åœ¨ä¿®æ”¹è¿‡ç¨‹ä¸­ï¼Œå…¶å†…éƒ¨çŠ¶æ€å¯èƒ½æš‚æ—¶æ˜¯ä¸ä¸€è‡´çš„ï¼ˆä¾‹å¦‚ï¼Œä¿®æ”¹ä¸€ä¸ªé“¾è¡¨æ—¶ï¼‰ã€‚å¦‚æœå¦ä¸€ä¸ªçº¿ç¨‹åœ¨æ­¤æ—¶è®¿é—®è¯¥å¯¹è±¡ï¼Œä¼šçœ‹åˆ°è¿™ä¸ªç ´ç¢çš„çŠ¶æ€ï¼Œå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚</li>
</ul>
<p>çº¿ç¨‹åŒæ­¥çš„æ ¸å¿ƒç›®çš„æ˜¯ï¼š<strong>é€šè¿‡å¼ºåˆ¶ç‰¹å®šä»£ç æ®µçš„äº’æ–¥è®¿é—®æˆ–æ‰§è¡Œé¡ºåºï¼Œæ¥ä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ç¨‹åºè¡Œä¸ºçš„æ­£ç¡®æ€§å’Œå¯é¢„æµ‹æ€§ã€‚</strong></p>
<hr/>
<h3 data-id="heading-1">2. C++æ ‡å‡†åº“æä¾›çš„åŒæ­¥æœºåˆ¶</h3>
<p>C++11åœ¨æ ‡å‡†åº“ä¸­å¼•å…¥äº† <code>&lt;thread&gt;</code> å’Œ <code>&lt;mutex&gt;</code> ç­‰å¤´æ–‡ä»¶ï¼Œæä¾›äº†ä¸°å¯Œçš„åŒæ­¥åŸè¯­ã€‚</p>
<h4 data-id="heading-2">2.1 äº’æ–¥é‡ - ä¿è¯äº’æ–¥è®¿é—®</h4>
<p>äº’æ–¥é‡æ˜¯æœ€åŸºç¡€çš„åŒæ­¥å·¥å…·ï¼Œå®ƒç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¿›å…¥è¢«ä¿æŠ¤çš„ä»£ç æ®µï¼ˆä¸´ç•ŒåŒºï¼‰ã€‚</p>
<p><strong>a) <code>std::mutex</code></strong>
æœ€åŸºæœ¬çš„äº’æ–¥é‡ï¼Œä¸å¯é€’å½’ã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>

std::mutex g_mutex;
<span class="hljs-type">int</span> shared_data = <span class="hljs-number">0</span>;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; ++i) {
        g_mutex.<span class="hljs-built_in">lock</span>(); <span class="hljs-comment">// åŠ é”</span>
        ++shared_data;  <span class="hljs-comment">// ä¸´ç•ŒåŒº</span>
        g_mutex.<span class="hljs-built_in">unlock</span>(); <span class="hljs-comment">// è§£é”</span>
    }
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">std::thread <span class="hljs-title">t1</span><span class="hljs-params">(increment)</span></span>;
    <span class="hljs-function">std::thread <span class="hljs-title">t2</span><span class="hljs-params">(increment)</span></span>;
    t1.<span class="hljs-built_in">join</span>();
    t2.<span class="hljs-built_in">join</span>();
    std::cout &lt;&lt; <span class="hljs-string">"Final value: "</span> &lt;&lt; shared_data &lt;&lt; std::endl; <span class="hljs-comment">// ä¸€å®šæ˜¯ 200000</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼šç›´æ¥ä½¿ç”¨ <code>lock()</code> å’Œ <code>unlock()</code> æ˜¯å±é™©çš„ï¼Œå¦‚æœä¸´ç•ŒåŒºä»£ç æŠ›å‡ºå¼‚å¸¸ï¼Œå¯èƒ½å¯¼è‡´äº’æ–¥é‡æ— æ³•è§£é”ï¼Œå¼•å‘æ­»é”ã€‚<strong>æ°¸è¿œä¼˜å…ˆä½¿ç”¨RAIIåŒ…è£…å™¨</strong>ã€‚</p>
<p><strong>b) <code>std::lock_guard</code></strong>
æœ€ç®€å•çš„RAIIåŒ…è£…å™¨ï¼Œåœ¨æ„é€ æ—¶åŠ é”ï¼Œææ„æ—¶è‡ªåŠ¨è§£é”ã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">safe_increment</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; ++i) {
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(g_mutex)</span></span>; <span class="hljs-comment">// æ„é€ æ—¶åŠ é”</span>
        ++shared_data; <span class="hljs-comment">// ä¸´ç•ŒåŒº</span>
    } <span class="hljs-comment">// ä½œç”¨åŸŸç»“æŸï¼Œlockææ„ï¼Œè‡ªåŠ¨è§£é”</span>
}
</code></pre>
<p><strong>c) <code>std::unique_lock</code></strong>
æ¯” <code>lock_guard</code> æ›´çµæ´»ï¼Œä½†å¼€é”€ç¨å¤§ã€‚å®ƒå…è®¸å»¶è¿ŸåŠ é”ã€æå‰è§£é”ã€æ¡ä»¶å˜é‡é…åˆä½¿ç”¨ç­‰ã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">flexible_increment</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; ++i) {
        <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(g_mutex, std::defer_lock)</span></span>; <span class="hljs-comment">// å»¶è¿ŸåŠ é”</span>
        <span class="hljs-comment">// ... ä¸€äº›ä¸æ¶‰åŠå…±äº«æ•°æ®çš„æ“ä½œ ...</span>
        lock.<span class="hljs-built_in">lock</span>(); <span class="hljs-comment">// æ‰‹åŠ¨åŠ é”</span>
        ++shared_data;
        lock.<span class="hljs-built_in">unlock</span>(); <span class="hljs-comment">// å¯ä»¥æ‰‹åŠ¨æå‰è§£é”</span>
        <span class="hljs-comment">// ... å…¶ä»–æ“ä½œ ...</span>
    }
}
</code></pre>
<p><strong>d) <code>std::recursive_mutex</code></strong>
å…è®¸åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å–åŒä¸€ä¸ªäº’æ–¥é‡è€Œä¸ä¼šæ­»é”ã€‚ç”¨äºå¯èƒ½é€’å½’è°ƒç”¨æˆ–éœ€è¦å¤šæ¬¡åŠ é”çš„åœºæ™¯ã€‚<strong>åº”è°¨æ…ä½¿ç”¨ï¼Œé€šå¸¸è¡¨æ˜è®¾è®¡å¯èƒ½æœ‰é—®é¢˜ã€‚</strong></p>
<h4 data-id="heading-3">2.2 æ¡ä»¶å˜é‡ - çº¿ç¨‹é—´çš„é€šä¿¡ä¸ç­‰å¾…</h4>
<p>æ¡ä»¶å˜é‡å…è®¸çº¿ç¨‹é˜»å¡ç­‰å¾…æŸä¸ªæ¡ä»¶æˆç«‹ï¼Œæˆ–åœ¨æ¡ä»¶æˆç«‹æ—¶é€šçŸ¥å…¶ä»–çº¿ç¨‹ã€‚å®ƒå¿…é¡»ä¸äº’æ–¥é‡é…åˆä½¿ç”¨ã€‚</p>
<ul>
<li><code>std::condition_variable</code> ï¼ˆæ¨èï¼Œé€šå¸¸æ›´é«˜æ•ˆï¼‰</li>
<li><code>std::condition_variable_any</code> ï¼ˆå¯ä¸ä»»ä½•æ»¡è¶³åŸºæœ¬äº’æ–¥é‡æ¦‚å¿µçš„ç±»å‹ä¸€èµ·ä½¿ç”¨ï¼Œä½†å¼€é”€æ›´å¤§ï¼‰</li>
</ul>
<p><strong>å…¸å‹ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;condition_variable&gt;</span></span>

std::queue&lt;<span class="hljs-type">int</span>&gt; g_queue;
std::mutex g_mutex;
std::condition_variable g_cv;
<span class="hljs-type">bool</span> g_done = <span class="hljs-literal">false</span>;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">producer</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i) {
        std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">milliseconds</span>(<span class="hljs-number">100</span>));
        {
            <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(g_mutex)</span></span>;
            g_queue.<span class="hljs-built_in">push</span>(i);
            std::cout &lt;&lt; <span class="hljs-string">"Produced: "</span> &lt;&lt; i &lt;&lt; std::endl;
        }
        g_cv.<span class="hljs-built_in">notify_one</span>(); <span class="hljs-comment">// é€šçŸ¥ä¸€ä¸ªç­‰å¾…çš„æ¶ˆè´¹è€…</span>
    }
    {
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(g_mutex)</span></span>;
        g_done = <span class="hljs-literal">true</span>;
    }
    g_cv.<span class="hljs-built_in">notify_all</span>(); <span class="hljs-comment">// é€šçŸ¥æ‰€æœ‰æ¶ˆè´¹è€…ç»“æŸ</span>
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">consumer</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> </span>{
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(g_mutex)</span></span>;
        <span class="hljs-comment">// ç­‰å¾…æ¡ä»¶ï¼šé˜Ÿåˆ—ä¸ä¸ºç©ºæˆ–ç”Ÿäº§ç»“æŸ</span>
        g_cv.<span class="hljs-built_in">wait</span>(lock, [] { <span class="hljs-keyword">return</span> !g_queue.<span class="hljs-built_in">empty</span>() || g_done; });

        <span class="hljs-comment">// è¢«å”¤é†’åï¼Œéœ€è¦é‡æ–°æ£€æŸ¥æ¡ä»¶</span>
        <span class="hljs-keyword">if</span> (g_done &amp;&amp; g_queue.<span class="hljs-built_in">empty</span>()) {
            <span class="hljs-keyword">break</span>;
        }

        <span class="hljs-comment">// æ¶ˆè´¹æ•°æ®</span>
        <span class="hljs-type">int</span> data = g_queue.<span class="hljs-built_in">front</span>();
        g_queue.<span class="hljs-built_in">pop</span>();
        lock.<span class="hljs-built_in">unlock</span>(); <span class="hljs-comment">// å°½æ—©é‡Šæ”¾é”</span>

        std::cout &lt;&lt; <span class="hljs-string">"Consumer "</span> &lt;&lt; id &lt;&lt; <span class="hljs-string">" consumed: "</span> &lt;&lt; data &lt;&lt; std::endl;
    }
}
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li><code>wait</code> æ“ä½œä¼šåŸå­åœ°é‡Šæ”¾äº’æ–¥é”å¹¶ä½¿çº¿ç¨‹ä¼‘çœ ã€‚</li>
<li>è¢«å”¤é†’æ—¶ï¼Œå®ƒä¼šé‡æ–°è·å–äº’æ–¥é”ï¼Œç„¶åæ£€æŸ¥æ¡ä»¶ï¼ˆä½¿ç”¨æä¾›çš„è°“è¯ï¼‰ã€‚<strong>å¿…é¡»ä½¿ç”¨å¾ªç¯æˆ–å¸¦è°“è¯çš„waitæ¥é˜²æ­¢â€œè™šå‡å”¤é†’â€</strong>ã€‚</li>
</ul>
<h4 data-id="heading-4">2.3 ä¿¡å·é‡ - C++20</h4>
<p>ä¿¡å·é‡æ˜¯ä¸€ä¸ªæ›´åº•å±‚çš„åŒæ­¥åŸè¯­ï¼Œå®ƒç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºæ§åˆ¶å¯¹ç‰¹å®šæ•°é‡èµ„æºçš„è®¿é—®ã€‚</p>
<ul>
<li><code>std::counting_semaphore</code>ï¼šå…è®¸è‡³å°‘ <code>LeastMaxValue</code> ä¸ªå¹¶å‘è®¿é—®ã€‚</li>
<li><code>std::binary_semaphore</code>ï¼šæ˜¯ <code>std::counting_semaphore&lt;1&gt;</code> çš„åˆ«åï¼Œç±»ä¼¼äºäº’æ–¥é‡ï¼Œä½†å¯ç”±ä¸åŒçº¿ç¨‹è¿›è¡Œé”å’Œè§£é”ã€‚</li>
</ul>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;semaphore&gt;</span></span>

<span class="hljs-function">std::binary_semaphore <span class="hljs-title">smph</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span>; <span class="hljs-comment">// åˆå§‹å€¼ä¸º0</span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">waiter</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"Waiting...\n"</span>;
    smph.<span class="hljs-built_in">acquire</span>(); <span class="hljs-comment">// ç­‰å¾…ä¿¡å·é‡å€¼&gt;0ï¼Œç„¶åå‡1</span>
    std::cout &lt;&lt; <span class="hljs-string">"Finished waiting!\n"</span>;
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">notifier</span><span class="hljs-params">()</span> </span>{
    std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">seconds</span>(<span class="hljs-number">1</span>));
    std::cout &lt;&lt; <span class="hljs-string">"Notifying...\n"</span>;
    smph.<span class="hljs-built_in">release</span>(); <span class="hljs-comment">// ä¿¡å·é‡å€¼åŠ 1ï¼Œå”¤é†’ç­‰å¾…è€…</span>
}
</code></pre>
<h4 data-id="heading-5">2.4 é”å­˜å™¨å’Œå±éšœ - C++20</h4>
<p>ç”¨äºç®¡ç†ä¸€ç»„çº¿ç¨‹çš„åŒæ­¥ç‚¹ã€‚</p>
<ul>
<li><strong><code>std::latch</code></strong>ï¼šä¸€æ¬¡æ€§ä½¿ç”¨çš„å€’è®¡æ—¶é—¨é—©ã€‚çº¿ç¨‹åœ¨ <code>arrive_and_wait</code> ä¸Šé˜»å¡ï¼Œç›´åˆ°å†…éƒ¨è®¡æ•°å™¨å‡ä¸º0ï¼Œæ‰€æœ‰é˜»å¡çº¿ç¨‹è¢«åŒæ—¶é‡Šæ”¾ã€‚ä¸å¯é‡å¤ä½¿ç”¨ã€‚</li>
<li><strong><code>std::barrier</code></strong>ï¼šå¯é‡å¤ä½¿ç”¨çš„åŒæ­¥æœºåˆ¶ã€‚å®ƒå…è®¸ä¸€ç»„çº¿ç¨‹æ‰§è¡Œä¸€ç³»åˆ—é˜¶æ®µã€‚åœ¨æ¯ä¸ªé˜¶æ®µï¼Œçº¿ç¨‹åˆ°è¾¾å±éšœå¹¶é˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾ï¼Œç„¶åæ‰€æœ‰çº¿ç¨‹è¢«é‡Šæ”¾ï¼Œå±éšœè¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-6">3. é«˜çº§è¯é¢˜ä¸åº•å±‚åŸç†</h3>
<h4 data-id="heading-7">3.1 æ­»é”ä¸é¢„é˜²</h4>
<p>æ­»é”é€šå¸¸å‘ç”Ÿåœ¨ä¸¤ä¸ªæˆ–ä»¥ä¸Šçº¿ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹æŒæœ‰çš„èµ„æºæ—¶ã€‚</p>
<p><strong>äº§ç”Ÿæ¡ä»¶ï¼ˆå››ä¸ªå¿…è¦æ¡ä»¶ï¼‰</strong>ï¼š</p>
<ol>
<li><strong>äº’æ–¥è®¿é—®</strong></li>
<li><strong>æŒæœ‰å¹¶ç­‰å¾…</strong></li>
<li><strong>ä¸å¯å‰¥å¤º</strong></li>
<li><strong>å¾ªç¯ç­‰å¾…</strong></li>
</ol>
<p><strong>é¢„é˜²ç­–ç•¥</strong>ï¼š</p>
<ul>
<li><strong>å›ºå®šé¡ºåºä¸Šé”</strong>ï¼šæ‰€æœ‰çº¿ç¨‹éƒ½æŒ‰ç…§ç›¸åŒçš„å…¨å±€é¡ºåºè·å–é”ã€‚</li>
<li><strong>ä½¿ç”¨ <code>std::lock</code> æˆ– <code>std::scoped_lock</code> (C++17)</strong>ï¼šä¸€æ¬¡æ€§é”å®šå¤šä¸ªäº’æ–¥é‡ï¼Œé¿å…æ­»é”ã€‚
<pre><code class="hljs language-cpp" lang="cpp">std::mutex mutex1, mutex2;
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">safe_lock</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// std::lock ä½¿ç”¨æ­»é”é¿å…ç®—æ³•ï¼ˆå¦‚Dijkstraç®—æ³•ï¼‰æ¥åŒæ—¶é”å®šå¤šä¸ªäº’æ–¥é‡</span>
    std::<span class="hljs-built_in">lock</span>(mutex1, mutex2);
    <span class="hljs-comment">// ä½¿ç”¨ std::adopt_lock è¡¨ç¤ºäº’æ–¥é‡å·²è¢«é”å®šï¼Œlock_guardåªéœ€æ¥ç®¡æ‰€æœ‰æƒ</span>
    <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock1</span><span class="hljs-params">(mutex1, std::adopt_lock)</span></span>;
    <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock2</span><span class="hljs-params">(mutex2, std::adopt_lock)</span></span>;
    <span class="hljs-comment">// ...</span>
}
<span class="hljs-comment">// C++17 æ›´ç®€æ´çš„æ–¹å¼ï¼š</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">safer_lock</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">std::scoped_lock <span class="hljs-title">lock</span><span class="hljs-params">(mutex1, mutex2)</span></span>; <span class="hljs-comment">// è‡ªåŠ¨ä½¿ç”¨æ­»é”é¿å…ç®—æ³•</span>
    <span class="hljs-comment">// ...</span>
}
</code></pre>
</li>
<li><strong>é¿å…åµŒå¥—é”</strong>ï¼šå¦‚æœå¯èƒ½ï¼Œå°½é‡åªæŒæœ‰ä¸€ä¸ªé”ã€‚</li>
<li><strong>ä½¿ç”¨å±‚æ¬¡é”</strong>ï¼šä¸ºé”åˆ†é…å±‚çº§ç¼–å·ï¼Œåªå…è®¸ä»¥ç¼–å·é€’å‡çš„é¡ºåºè·å–é”ã€‚</li>
</ul>
<h4 data-id="heading-8">3.2 æ€§èƒ½è€ƒé‡</h4>
<ul>
<li><strong>é”çš„ç²’åº¦</strong>ï¼šé”ä¿æŠ¤çš„ä¸´ç•ŒåŒºåº”å°½å¯èƒ½å°ã€‚åœ¨ä¸´ç•ŒåŒºå†…ä¸è¦è¿›è¡Œè€—æ—¶æ“ä½œï¼ˆå¦‚I/Oï¼‰ã€‚</li>
<li><strong>é”ç«äº‰</strong>ï¼šå½“å¤šä¸ªçº¿ç¨‹é¢‘ç¹å°è¯•è·å–åŒä¸€ä¸ªé”æ—¶ï¼Œä¼šå‘ç”Ÿæ¿€çƒˆç«äº‰ï¼Œå¯¼è‡´å¤§é‡çº¿ç¨‹åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´åˆ‡æ¢ï¼Œä¸¥é‡é™ä½æ€§èƒ½ã€‚
<ul>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šä½¿ç”¨æ— é”æ•°æ®ç»“æ„ã€å‡å°‘å…±äº«æ•°æ®ã€ä½¿ç”¨è¯»å†™é”ï¼ˆ<code>std::shared_mutex</code>ï¼‰ã€æˆ–è€…å°†æ•°æ®åˆ†åŒºï¼ˆæ¯ä¸ªçº¿ç¨‹å¤„ç†è‡ªå·±çš„æ•°æ®å‰¯æœ¬ï¼Œæœ€åå†åˆå¹¶ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-9">3.3 å†…å­˜æ¨¡å‹ä¸åŸå­æ“ä½œ</h4>
<p>åŒæ­¥æœºåˆ¶çš„åº•å±‚ä¸C++å†…å­˜æ¨¡å‹ç´§å¯†ç›¸å…³ã€‚</p>
<ul>
<li><strong><code>std::atomic</code></strong>ï¼šæä¾›äº†æ— éœ€äº’æ–¥é”çš„çº¿ç¨‹å®‰å…¨è®¿é—®ã€‚å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå¦‚ <code>int</code>, <code>bool</code>, <code>pointer</code>ï¼‰ï¼Œä½¿ç”¨ <code>std::atomic</code> é€šå¸¸æ¯” <code>mutex</code> æ•ˆç‡æ›´é«˜ï¼Œå› ä¸ºå®ƒç›´æ¥åœ¨CPUæŒ‡ä»¤çº§åˆ«ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">std::atomic&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">atomic_counter</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span>;
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">atomic_increment</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; ++i) {
        atomic_counter.<span class="hljs-built_in">fetch_add</span>(<span class="hljs-number">1</span>, std::memory_order_relaxed);
    }
}
</code></pre>
</li>
<li><strong>å†…å­˜åº</strong>ï¼š<code>std::memory_order</code> å…è®¸ä½ æ§åˆ¶åŸå­æ“ä½œå‘¨å›´çš„éåŸå­å†…å­˜è®¿é—®çš„å¯è§æ€§é¡ºåºã€‚è¿™æ˜¯ä¸ºäº†åœ¨ä¿è¯æ­£ç¡®æ€§çš„å‰æä¸‹ï¼Œè¿½æ±‚æè‡´çš„æ€§èƒ½ã€‚
<ul>
<li><code>memory_order_seq_cst</code>ï¼ˆé¡ºåºä¸€è‡´æ€§ï¼‰ï¼šæœ€å¼ºä¿è¯ï¼Œé»˜è®¤é€‰é¡¹ï¼Œæ€§èƒ½å¼€é”€æœ€å¤§ã€‚</li>
<li><code>memory_order_acquire</code>/<code>memory_order_release</code>/<code>memory_order_acq_rel</code>ï¼šç”¨äºå®ç°â€œåŒæ­¥äºâ€å…³ç³»ã€‚</li>
<li><code>memory_order_relaxed</code>ï¼šåªä¿è¯åŸå­æ€§ï¼Œä¸æä¾›åŒæ­¥å’Œé¡ºåºä¿è¯ã€‚</li>
</ul>
</li>
</ul>
<p><strong>é™¤éä½ æ˜¯ä¸“å®¶ï¼Œå¦åˆ™è¯·ä½¿ç”¨ <code>std::atomic</code> çš„é»˜è®¤å†…å­˜åºï¼ˆ<code>memory_order_seq_cst</code>ï¼‰ã€‚</strong></p>
<hr/>
<h3 data-id="heading-10">4. æ€»ç»“ä¸æœ€ä½³å®è·µ</h3>
<ol>
<li><strong>ä¼˜å…ˆä½¿ç”¨RAII</strong>ï¼šå§‹ç»ˆä½¿ç”¨ <code>std::lock_guard</code>, <code>std::unique_lock</code>, <code>std::scoped_lock</code>ï¼Œé¿å…æ‰‹åŠ¨ <code>lock/unlock</code>ã€‚</li>
<li><strong>ç”¨äº’æ–¥é‡ä¿æŠ¤æ•°æ®ï¼Œè€Œéä»£ç </strong>ï¼šæ¸…æ™°åœ°çŸ¥é“å“ªäº›æ•°æ®æ˜¯å…±äº«çš„ï¼Œå¹¶ç”¨æœ€å°çš„é”ç²’åº¦æ¥ä¿æŠ¤å®ƒã€‚</li>
<li><strong>æ…ç”¨é€’å½’é”</strong>ï¼šé€’å½’é”é€šå¸¸æ„å‘³ç€ç³Ÿç³•çš„è®¾è®¡ã€‚</li>
<li><strong>ä½¿ç”¨æ¡ä»¶å˜é‡è¿›è¡Œäº‹ä»¶ç­‰å¾…</strong>ï¼šä¸è¦ä½¿ç”¨å¿™ç­‰å¾…ï¼ˆ<code>while (!condition) {}</code>ï¼‰ï¼Œè¿™ä¼šæµªè´¹CPUèµ„æºã€‚</li>
<li><strong>è­¦æƒ•æ­»é”</strong>ï¼šä½¿ç”¨é”é¡ºåºã€<code>std::lock</code> ç­‰ç­–ç•¥æ¥é¢„é˜²ã€‚</li>
<li><strong>æ€§èƒ½ç“¶é¢ˆåœ¨äºé”ç«äº‰</strong>ï¼šä¼˜åŒ–æ–¹å‘æ˜¯å‡å°‘å…±äº«å’Œç¼©å°ä¸´ç•ŒåŒºï¼Œè€Œéç›²ç›®è¿½æ±‚â€œæ— é”â€ã€‚æ— é”ç¼–ç¨‹æå…¶å¤æ‚ä¸”å®¹æ˜“å‡ºé”™ã€‚</li>
<li><strong>ç®€å•åœºæ™¯ç”¨ <code>atomic</code>ï¼Œå¤æ‚åŒæ­¥ç”¨ <code>mutex</code></strong>ï¼šå¯¹äºç®€å•çš„è®¡æ•°å™¨æˆ–æ ‡å¿—ä½ï¼Œ<code>std::atomic</code> æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚å¯¹äºå¤æ‚çš„å¯¹è±¡æˆ–éœ€è¦ç­‰å¾…æ¡ä»¶çš„æƒ…å†µï¼Œä½¿ç”¨ <code>mutex</code> å’Œ <code>condition_variable</code>ã€‚</li>
<li><strong>ç†è§£å·¥å…·é€‚ç”¨åœºæ™¯</strong>ï¼š
<ul>
<li><code>mutex</code>ï¼šäº’æ–¥è®¿é—®ã€‚</li>
<li><code>condition_variable</code>ï¼šç­‰å¾…æ¡ä»¶æˆç«‹ã€‚</li>
<li><code>semaphore</code>ï¼šæ§åˆ¶èµ„æºæ± è®¿é—®ã€‚</li>
<li><code>latch/barrier</code>ï¼šå¤šçº¿ç¨‹åˆ†é˜¶æ®µååŒã€‚</li>
</ul>
</li>
</ol>
<p>é€šè¿‡æ·±å…¥ç†è§£è¿™äº›åŒæ­¥æœºåˆ¶çš„åŸç†ã€ä»£ä»·å’Œé€‚ç”¨åœºæ™¯ï¼Œä½ æ‰èƒ½å†™å‡ºæ—¢æ­£ç¡®åˆé«˜æ•ˆçš„å¤šçº¿ç¨‹C++ç¨‹åºã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot + MyBatis-Plus + Dynamic-Datasource è¯»å†™åˆ†ç¦»å®Œæ•´æŒ‡å—]]></title>    <link>https://juejin.cn/post/7571299394345730090</link>    <guid>https://juejin.cn/post/7571299394345730090</guid>    <pubDate>2025-11-11T14:00:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571299394345730090" data-draft-id="7571258854901399595" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" SpringBoot + MyBatis-Plus + Dynamic-Datasource è¯»å†™åˆ†ç¦»å®Œæ•´æŒ‡å—"/> <meta itemprop="keywords" content="åç«¯,æ•°æ®åº“"/> <meta itemprop="datePublished" content="2025-11-11T14:00:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ITæ©˜å­çš®"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             SpringBoot + MyBatis-Plus + Dynamic-Datasource è¯»å†™åˆ†ç¦»å®Œæ•´æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ITæ©˜å­çš®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T14:00:54.000Z" title="Tue Nov 11 2025 14:00:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨SpringBooté¡¹ç›®ä¸­ï¼Œä½¿ç”¨MyBatis-Pluså’ŒDynamic-Datasourceå®ç°è¯»å†™åˆ†ç¦»æ˜¯ä¸€ç§å¸¸è§ä¸”é«˜æ•ˆçš„æ¶æ„é€‰æ‹©ã€‚ä¸‹é¢æˆ‘å°†ä¸ºä½ è¯¦ç»†è®²è§£å®Œæ•´çš„å®ç°æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ç¯å¢ƒå‡†å¤‡ã€é…ç½®ã€ä»£ç å®ç°ä»¥åŠæ³¨æ„äº‹é¡¹ã€‚</p>
<h2 data-id="heading-0">1. è¯»å†™åˆ†ç¦»æ¦‚è¿°ä¸æ ¸å¿ƒæ¦‚å¿µ</h2>
<p>è¯»å†™åˆ†ç¦»æ˜¯ä¸€ç§å¸¸è§çš„æ•°æ®åº“ä¼˜åŒ–æ–¹æ¡ˆï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯å°†æ•°æ®åº“çš„å†™æ“ä½œï¼ˆINSERTã€UPDATEã€DELETEï¼‰å’Œè¯»æ“ä½œï¼ˆSELECTï¼‰åˆ†å‘åˆ°ä¸åŒçš„æ•°æ®åº“èŠ‚ç‚¹ä¸Šã€‚ä¸»æ•°æ®åº“ï¼ˆMasterï¼‰è´Ÿè´£å¤„ç†æ‰€æœ‰å†™æ“ä½œï¼Œè€Œä»æ•°æ®åº“ï¼ˆSlaveï¼‰è´Ÿè´£å¤„ç†è¯»æ“ä½œï¼Œé€šè¿‡æ•°æ®åº“çš„ä¸»ä»å¤åˆ¶æœºåˆ¶ä¿æŒæ•°æ®åŒæ­¥ã€‚</p>
<h3 data-id="heading-1">1.1 æ ¸å¿ƒä»·å€¼</h3>
<ul>
<li><strong>æå‡å¹¶å‘æ€§èƒ½</strong>ï¼šå°†è¯»è¯·æ±‚åˆ†æ•£åˆ°å¤šä¸ªä»åº“ï¼Œå‡è½»ä¸»åº“å‹åŠ›</li>
<li><strong>æé«˜ç³»ç»Ÿå¯ç”¨æ€§</strong>ï¼šå•ä¸ªä»åº“æ•…éšœä¸å½±å“è¯»æœåŠ¡</li>
<li><strong>ä¼˜åŒ–å“åº”é€Ÿåº¦</strong>ï¼šä¸“åº“ä¸“ç”¨ï¼Œé¿å…è¯»å†™æ“ä½œç›¸äº’é˜»å¡</li>
</ul>
<h3 data-id="heading-2">1.2 æŠ€æœ¯æ¶æ„</h3>
<pre><code class="hljs language-markdown" lang="markdown">åº”ç”¨ç¨‹åº â†’ Dynamic-Datasource â†’ ä¸»åº“ï¼ˆå†™æ“ä½œï¼‰
<span class="hljs-code">                     â†“
                   ä»åº“ï¼ˆè¯»æ“ä½œï¼‰
</span></code></pre>
<p><em>å›¾ï¼šè¯»å†™åˆ†ç¦»æ¶æ„ç¤ºæ„å›¾</em></p>
<h2 data-id="heading-3">2. ç¯å¢ƒå‡†å¤‡ä¸ä¾èµ–é…ç½®</h2>
<h3 data-id="heading-4">2.1 æ·»åŠ Mavenä¾èµ–</h3>
<p>é¦–å…ˆåœ¨é¡¹ç›®çš„<code>pom.xml</code>ä¸­æ·»åŠ å¿…è¦çš„ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring Boot Starter --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- MyBatis-Plus å¯åŠ¨å™¨ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- Dynamic-Datasource å¯åŠ¨å™¨ï¼ˆæ ¸å¿ƒä¾èµ–ï¼‰ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dynamic-datasource-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.6.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- MySQL é©±åŠ¨ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.33<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- è¿æ¥æ± ï¼ˆå¯é€‰ï¼ŒHikariCPå·²å†…ç½®ï¼‰ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.16<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<p><em>citation:2][citation:3</em></p>
<h3 data-id="heading-5">2.2 é…ç½®æ–‡ä»¶è®¾ç½®</h3>
<p>åœ¨<code>application.yml</code>ä¸­é…ç½®ä¸»ä»æ•°æ®æºï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">dynamic:</span>
      <span class="hljs-attr">primary:</span> <span class="hljs-string">master</span>  <span class="hljs-comment"># è®¾ç½®é»˜è®¤æ•°æ®æºä¸ºä¸»åº“</span>
      <span class="hljs-attr">strict:</span> <span class="hljs-literal">false</span>   <span class="hljs-comment"># æ˜¯å¦ä¸¥æ ¼åŒ¹é…æ•°æ®æºï¼Œfalseæ—¶æœªåŒ¹é…åˆ°æŒ‡å®šæ•°æ®æºåˆ™ä½¿ç”¨é»˜è®¤æ•°æ®æº</span>
      <span class="hljs-attr">datasource:</span>
        <span class="hljs-comment"># ä¸»åº“é…ç½®ï¼ˆå†™æ“ä½œï¼‰</span>
        <span class="hljs-attr">master:</span>
          <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://master-host:3306/core?useSSL=false&amp;serverTimezone=Asia/Shanghai</span>
          <span class="hljs-attr">username:</span> <span class="hljs-string">admin</span>
          <span class="hljs-attr">password:</span> <span class="hljs-string">master@123</span>
          <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
        <span class="hljs-comment"># ä»åº“é…ç½®ï¼ˆè¯»æ“ä½œï¼‰- æ”¯æŒå¤šä¸ªä»åº“</span>
        <span class="hljs-attr">slave1:</span>
          <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://slave1-host:3306/core?useSSL=false&amp;serverTimezone=Asia/Shanghai</span>
          <span class="hljs-attr">username:</span> <span class="hljs-string">readonly</span>
          <span class="hljs-attr">password:</span> <span class="hljs-string">slave@123</span>
          <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
        <span class="hljs-attr">slave2:</span>
          <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://slave2-host:3306/core?useSSL=false&amp;serverTimezone=Asia/Shanghai</span>
          <span class="hljs-attr">username:</span> <span class="hljs-string">readonly</span>
          <span class="hljs-attr">password:</span> <span class="hljs-string">slave@123</span>
          <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
      
      <span class="hljs-comment"># è´Ÿè½½å‡è¡¡ç­–ç•¥é…ç½®ï¼ˆå¤šä¸ªä»åº“æ—¶ç”Ÿæ•ˆï¼‰</span>
      <span class="hljs-attr">strategy:</span> 
        <span class="hljs-attr">slave:</span> <span class="hljs-string">round_robin</span>  <span class="hljs-comment"># ä»åº“è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼šrandom(éšæœº)/round_robin(è½®è¯¢)</span>
      
      <span class="hljs-comment"># è¿æ¥æ± é…ç½®ï¼ˆHikariCPï¼‰</span>
      <span class="hljs-attr">hikari:</span>
        <span class="hljs-attr">max-pool-size:</span> <span class="hljs-number">20</span>      <span class="hljs-comment"># æœ€å¤§è¿æ¥æ•°</span>
        <span class="hljs-attr">min-idle:</span> <span class="hljs-number">5</span>           <span class="hljs-comment"># æœ€å°ç©ºé—²è¿æ¥</span>
        <span class="hljs-attr">connection-timeout:</span> <span class="hljs-number">30000</span>  <span class="hljs-comment"># è¿æ¥è¶…æ—¶æ—¶é—´(ms)</span>
        <span class="hljs-attr">idle-timeout:</span> <span class="hljs-number">600000</span>  <span class="hljs-comment"># ç©ºé—²è¿æ¥è¶…æ—¶æ—¶é—´(ms)</span>
        <span class="hljs-attr">max-lifetime:</span> <span class="hljs-number">1800000</span> <span class="hljs-comment"># è¿æ¥æœ€å¤§ç”Ÿå‘½å‘¨æœŸ(ms)</span>

<span class="hljs-comment"># MyBatis-Plus é…ç½®</span>
<span class="hljs-attr">mybatis-plus:</span>
  <span class="hljs-attr">configuration:</span>
    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># å¼€å¯é©¼å³°å‘½åè½¬æ¢</span>
    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span>  <span class="hljs-comment"># æ‰“å°SQLæ—¥å¿—(è°ƒè¯•ç”¨)</span>
  <span class="hljs-attr">global-config:</span>
    <span class="hljs-attr">db-config:</span>
      <span class="hljs-attr">id-type:</span> <span class="hljs-string">auto</span>  <span class="hljs-comment"># ä¸»é”®ç­–ç•¥è‡ªå¢</span>
</code></pre>
<p><em>citation:2][citation:6</em></p>
<h2 data-id="heading-6">3. æ•°æ®æºä¸MyBatis-Plusé…ç½®ç±»</h2>
<h3 data-id="heading-7">3.1 åŠ¨æ€æ•°æ®æºè‡ªåŠ¨é…ç½®</h3>
<p>Dynamic-Datasource starterå·²ç»æä¾›äº†è‡ªåŠ¨é…ç½®ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹æ— éœ€é¢å¤–é…ç½®ã€‚ä½†å¦‚æœéœ€è¦è‡ªå®šä¹‰ï¼Œå¯ä»¥åˆ›å»ºé…ç½®ç±»ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Configuration</span>
<span class="hljs-variable">@MapperScan</span>(<span class="hljs-string">"com.example.mapper"</span>)  <span class="hljs-comment">// æŒ‡å®šMyBatis mapperæ¥å£çš„æ‰«æè·¯å¾„</span>
public class DataSourceConfig {
    
    <span class="hljs-comment">/**
     * é…ç½®åŠ¨æ€æ•°æ®æº
     * Dynamic-Datasourceä¼šè‡ªåŠ¨æ ¹æ®application.ymlçš„é…ç½®åˆ›å»ºæ•°æ®æº
     * æ­¤å¤„å¯ä»¥æ·»åŠ è‡ªå®šä¹‰é…ç½®
     */</span>
    <span class="hljs-variable">@Bean</span>
    <span class="hljs-variable">@ConfigurationProperties</span>(prefix = <span class="hljs-string">"spring.datasource.dynamic"</span>)
    public DynamicDataSourceProperties <span class="hljs-built_in">dynamicDataSourceProperties</span>() {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">DynamicDataSourceProperties</span>();
    }
    
    <span class="hljs-comment">/**
     * é…ç½®MyBatis-Plusæ‹¦æˆªå™¨ï¼ˆåˆ†é¡µæ’ä»¶ç­‰ï¼‰
     */</span>
    @<span class="hljs-selector-tag">Bean</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">MybatisPlusInterceptor</span> <span class="hljs-selector-tag">mybatisPlusInterceptor</span>() {
        <span class="hljs-selector-tag">MybatisPlusInterceptor</span> <span class="hljs-selector-tag">interceptor</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">MybatisPlusInterceptor</span>();
        <span class="hljs-comment">// æ·»åŠ åˆ†é¡µæ’ä»¶</span>
        <span class="hljs-selector-tag">PaginationInnerInterceptor</span> <span class="hljs-selector-tag">paginationInterceptor</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">PaginationInnerInterceptor</span>(DbType.MYSQL);
        <span class="hljs-selector-tag">paginationInterceptor</span><span class="hljs-selector-class">.setMaxLimit</span>(<span class="hljs-number">1000</span>L);  <span class="hljs-comment">// è®¾ç½®æœ€å¤§åˆ†é¡µé™åˆ¶</span>
        <span class="hljs-selector-tag">interceptor</span><span class="hljs-selector-class">.addInnerInterceptor</span>(paginationInterceptor);
        
        <span class="hljs-comment">// å¯ä»¥æ·»åŠ å…¶ä»–æ’ä»¶ï¼Œå¦‚ä¹è§‚é”æ’ä»¶ç­‰</span>
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">interceptor</span>;
    }
}
</code></pre>
<p><em>citation:1][citation:5</em></p>
<h2 data-id="heading-8">4. ä¸šåŠ¡å±‚å®ç°è¯»å†™åˆ†ç¦»</h2>
<h3 data-id="heading-9">4.1 ä½¿ç”¨@DSæ³¨è§£æ‰‹åŠ¨åˆ‡æ¢æ•°æ®æº</h3>
<p>æœ€ç›´æ¥çš„æ–¹å¼æ˜¯åœ¨Serviceå±‚ä½¿ç”¨<code>@DS</code>æ³¨è§£æŒ‡å®šæ•°æ®æºï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-comment">/**
     * å†™æ“ä½œï¼šä½¿ç”¨<span class="hljs-doctag">@DS</span>("master")æŒ‡å®šä¸»åº“
     * æ³¨æ„ï¼šå†™æ“ä½œå»ºè®®éƒ½ä½¿ç”¨ä¸»åº“ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
     */</span>
    <span class="hljs-meta">@DS("master")</span>  <span class="hljs-comment">// æŒ‡å®šä½¿ç”¨ä¸»åº“</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>  <span class="hljs-comment">// æ·»åŠ äº‹åŠ¡ç®¡ç†</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">createUser</span><span class="hljs-params">(User user)</span> {
        <span class="hljs-comment">// å‚æ•°æ ¡éªŒ</span>
        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span> || StringUtils.isBlank(user.getUsername())) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"ç”¨æˆ·ä¿¡æ¯ä¸å®Œæ•´"</span>);
        }
        
        <span class="hljs-comment">// è®¾ç½®åˆ›å»ºæ—¶é—´</span>
        user.setCreateTime(LocalDateTime.now());
        user.setUpdateTime(LocalDateTime.now());
        
        <span class="hljs-comment">// æ‰§è¡Œæ’å…¥æ“ä½œï¼Œè¿™é‡Œä¼šä½¿ç”¨ä¸»åº“</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> save(user);
        
        <span class="hljs-comment">// è¿™é‡Œå¯ä»¥æ·»åŠ å…¶ä»–ä¸šåŠ¡é€»è¾‘</span>
        log.info(<span class="hljs-string">"åˆ›å»ºç”¨æˆ·æˆåŠŸï¼Œç”¨æˆ·ID: {}"</span>, user.getId());
        
        <span class="hljs-keyword">return</span> result;
    }
    
    <span class="hljs-comment">/**
     * è¯»æ“ä½œï¼šä½¿ç”¨<span class="hljs-doctag">@DS</span>("slave")æŒ‡å®šä»åº“
     * æ¡†æ¶ä¼šæ ¹æ®è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©slave1æˆ–slave2
     */</span>
    <span class="hljs-meta">@DS("slave")</span>  <span class="hljs-comment">// æŒ‡å®šä½¿ç”¨ä»åº“ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUserById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-comment">// å‚æ•°æ ¡éªŒ</span>
        <span class="hljs-keyword">if</span> (id == <span class="hljs-literal">null</span> || id &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"ç”¨æˆ·IDä¸åˆæ³•"</span>);
        }
        
        <span class="hljs-comment">// æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™é‡Œä¼šä½¿ç”¨ä»åº“</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> getById(id);
        
        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) {
            log.warn(<span class="hljs-string">"æœªæ‰¾åˆ°å¯¹åº”ç”¨æˆ·ï¼Œç”¨æˆ·ID: {}"</span>, id);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"ç”¨æˆ·ä¸å­˜åœ¨"</span>);
        }
        
        <span class="hljs-keyword">return</span> user;
    }
    
    <span class="hljs-comment">/**
     * æ‰¹é‡æŸ¥è¯¢ï¼šåŒæ ·ä½¿ç”¨ä»åº“
     */</span>
    <span class="hljs-meta">@DS("slave")</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">listUsersByCondition</span><span class="hljs-params">(UserQuery query)</span> {
        <span class="hljs-comment">// æ„å»ºæŸ¥è¯¢æ¡ä»¶</span>
        LambdaQueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();
        
        <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(query.getUsername())) {
            wrapper.like(User::getUsername, query.getUsername());
        }
        
        <span class="hljs-keyword">if</span> (query.getStatus() != <span class="hljs-literal">null</span>) {
            wrapper.eq(User::getStatus, query.getStatus());
        }
        
        <span class="hljs-comment">// æ·»åŠ æ’åº</span>
        wrapper.orderByDesc(User::getCreateTime);
        
        <span class="hljs-comment">// æ‰§è¡ŒæŸ¥è¯¢ï¼Œä½¿ç”¨ä»åº“</span>
        <span class="hljs-keyword">return</span> list(wrapper);
    }
    
    <span class="hljs-comment">/**
     * æ›´æ–°æ“ä½œï¼šå¿…é¡»ä½¿ç”¨ä¸»åº“
     */</span>
    <span class="hljs-meta">@DS("master")</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">updateUser</span><span class="hljs-params">(User user)</span> {
        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span> || user.getId() == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"ç”¨æˆ·ä¿¡æ¯ä¸å®Œæ•´"</span>);
        }
        
        <span class="hljs-comment">// è®¾ç½®æ›´æ–°æ—¶é—´</span>
        user.setUpdateTime(LocalDateTime.now());
        
        <span class="hljs-comment">// æ‰§è¡Œæ›´æ–°ï¼Œä½¿ç”¨ä¸»åº“</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> updateById(user);
        
        <span class="hljs-keyword">if</span> (result) {
            log.info(<span class="hljs-string">"æ›´æ–°ç”¨æˆ·æˆåŠŸï¼Œç”¨æˆ·ID: {}"</span>, user.getId());
        } <span class="hljs-keyword">else</span> {
            log.error(<span class="hljs-string">"æ›´æ–°ç”¨æˆ·å¤±è´¥ï¼Œç”¨æˆ·ID: {}"</span>, user.getId());
        }
        
        <span class="hljs-keyword">return</span> result;
    }
    
    <span class="hljs-comment">/**
     * åˆ é™¤æ“ä½œï¼šå¿…é¡»ä½¿ç”¨ä¸»åº“
     */</span>
    <span class="hljs-meta">@DS("master")</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-keyword">if</span> (id == <span class="hljs-literal">null</span> || id &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"ç”¨æˆ·IDä¸åˆæ³•"</span>);
        }
        
        <span class="hljs-comment">// æ‰§è¡Œåˆ é™¤ï¼Œä½¿ç”¨ä¸»åº“</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> removeById(id);
        
        <span class="hljs-keyword">if</span> (result) {
            log.info(<span class="hljs-string">"åˆ é™¤ç”¨æˆ·æˆåŠŸï¼Œç”¨æˆ·ID: {}"</span>, id);
        } <span class="hljs-keyword">else</span> {
            log.warn(<span class="hljs-string">"åˆ é™¤ç”¨æˆ·å¤±è´¥ï¼Œç”¨æˆ·ID: {}"</span>, id);
        }
        
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<p><em>citation:2][citation:8</em></p>
<h3 data-id="heading-10">4.2 åŸºäºAOPçš„è‡ªåŠ¨æ•°æ®æºåˆ‡æ¢ï¼ˆæ¨èï¼‰</h3>
<p>å¯¹äºå¤§å‹é¡¹ç›®ï¼Œæ‰‹åŠ¨æ·»åŠ <code>@DS</code>æ³¨è§£æ¯”è¾ƒç¹çï¼Œå¯ä»¥é€šè¿‡AOPè‡ªåŠ¨æ ¹æ®æ–¹æ³•ç±»å‹åˆ‡æ¢æ•°æ®æºï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Aspect</span>
<span class="hljs-variable">@Component</span>
<span class="hljs-variable">@Slf4j</span>
public class DataSourceAspect {
    
    <span class="hljs-comment">/**
     * å®šä¹‰åˆ‡ç‚¹ï¼šæ‹¦æˆªServiceå±‚çš„æ‰€æœ‰æ–¹æ³•
     */</span>
    <span class="hljs-variable">@Pointcut</span>(<span class="hljs-string">"execution(* com.example.service..*.*(..))"</span>)
    public void <span class="hljs-built_in">servicePointcut</span>() {}
    
    <span class="hljs-comment">/**
     * å‰ç½®é€šçŸ¥ï¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰é€‰æ‹©æ•°æ®æº
     */</span>
    <span class="hljs-variable">@Before</span>(<span class="hljs-string">"servicePointcut()"</span>)
    public void <span class="hljs-built_in">before</span>(JoinPoint joinPoint) {
        <span class="hljs-comment">// è·å–æ–¹æ³•å</span>
        <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">methodName</span> = <span class="hljs-selector-tag">joinPoint</span><span class="hljs-selector-class">.getSignature</span>()<span class="hljs-selector-class">.getName</span>();
        
        <span class="hljs-comment">// æ ¹æ®æ–¹æ³•åå‰ç¼€åˆ¤æ–­æ˜¯è¯»æ“ä½œè¿˜æ˜¯å†™æ“ä½œ</span>
        <span class="hljs-selector-tag">if</span> (<span class="hljs-built_in">isReadOperation</span>(methodName)) {
            <span class="hljs-comment">// è¯»æ“ä½œä½¿ç”¨ä»åº“</span>
            <span class="hljs-selector-tag">DynamicDataSourceContextHolder</span><span class="hljs-selector-class">.push</span>(<span class="hljs-string">"slave"</span>);
            <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.debug</span>(<span class="hljs-string">"åˆ‡æ¢æ•°æ®æºåˆ°ä»åº“ï¼Œæ–¹æ³•å: {}"</span>, methodName);
        } <span class="hljs-selector-tag">else</span> {
            <span class="hljs-comment">// å†™æ“ä½œä½¿ç”¨ä¸»åº“</span>
            <span class="hljs-selector-tag">DynamicDataSourceContextHolder</span><span class="hljs-selector-class">.push</span>(<span class="hljs-string">"master"</span>);
            <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.debug</span>(<span class="hljs-string">"åˆ‡æ¢æ•°æ®æºåˆ°ä¸»åº“ï¼Œæ–¹æ³•å: {}"</span>, methodName);
        }
    }
    
    <span class="hljs-comment">/**
     * åç½®é€šçŸ¥ï¼šæ¸…ç†æ•°æ®æºä¸Šä¸‹æ–‡
     */</span>
    @<span class="hljs-selector-tag">After</span>(<span class="hljs-string">"servicePointcut()"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">after</span>() {
        <span class="hljs-selector-tag">DynamicDataSourceContextHolder</span><span class="hljs-selector-class">.clear</span>();
        <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.debug</span>(<span class="hljs-string">"æ¸…é™¤æ•°æ®æºä¸Šä¸‹æ–‡"</span>);
    }
    
    <span class="hljs-comment">/**
     * åˆ¤æ–­æ˜¯å¦ä¸ºè¯»æ“ä½œ
     * å¯ä»¥æ ¹æ®æ–¹æ³•åå‰ç¼€è¿›è¡Œåˆ¤æ–­
     */</span>
    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">boolean</span> <span class="hljs-selector-tag">isReadOperation</span>(String methodName) {
        <span class="hljs-comment">// å¸¸è§çš„è¯»æ“ä½œæ–¹æ³•å‰ç¼€</span>
        <span class="hljs-selector-tag">String</span><span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">readPrefixes</span> = {"<span class="hljs-selector-tag">get</span>", "<span class="hljs-selector-tag">select</span>", "<span class="hljs-selector-tag">list</span>", "<span class="hljs-selector-tag">query</span>", "<span class="hljs-selector-tag">find</span>", "<span class="hljs-selector-tag">search</span>", "<span class="hljs-selector-tag">count</span>", "<span class="hljs-selector-tag">check</span>"};
        
        <span class="hljs-selector-tag">for</span> (String <span class="hljs-attribute">prefix </span>: readPrefixes) {
            <span class="hljs-selector-tag">if</span> (methodName.<span class="hljs-built_in">startsWith</span>(prefix)) {
                <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">true</span>;
            }
        }
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">false</span>;
    }
}
</code></pre>
<p><em>citation:3][citation:7</em></p>
<p>ä½¿ç”¨AOPåï¼ŒServiceå±‚çš„ä»£ç å¯ä»¥ç®€åŒ–ä¸ºï¼š</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-meta">@Service</span>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ServiceImpl&lt;UserMapper</span>, <span class="hljs-title">User&gt;</span> <span class="hljs-title">implements</span> <span class="hljs-title">UserService</span> </span>{
    
    <span class="hljs-meta">@Transactional</span>(rollbackFor = <span class="hljs-type">Exception</span>.<span class="hljs-keyword">class</span>)
    <span class="hljs-meta">@Override</span>
    public boolean createUser(<span class="hljs-type">User</span> user) {
        <span class="hljs-comment">// è‡ªåŠ¨ä½¿ç”¨ä¸»åº“ï¼ˆAOPæ ¹æ®æ–¹æ³•ååˆ¤æ–­ï¼‰</span>
        user.setCreateTime(<span class="hljs-type">LocalDateTime</span>.now());
        <span class="hljs-keyword">return</span> save(user);
    }
    
    <span class="hljs-meta">@Override</span>
    public <span class="hljs-type">User</span> getUserById(<span class="hljs-type">Long</span> id) {
        <span class="hljs-comment">// è‡ªåŠ¨ä½¿ç”¨ä»åº“ï¼ˆAOPæ ¹æ®æ–¹æ³•åå‰ç¼€"get"åˆ¤æ–­ï¼‰</span>
        <span class="hljs-keyword">return</span> getById(id);
    }
    
    <span class="hljs-comment">// å…¶ä»–æ–¹æ³•æ— éœ€æ·»åŠ @DSæ³¨è§£ï¼Œç”±AOPè‡ªåŠ¨å¤„ç†</span>
}
</code></pre>
<h2 data-id="heading-11">5. äº‹åŠ¡å¤„ç†ç­–ç•¥</h2>
<p>äº‹åŠ¡å¤„ç†æ˜¯è¯»å†™åˆ†ç¦»ä¸­çš„å…³é”®é—®é¢˜ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ï¼š</p>
<h3 data-id="heading-12">5.1 å•æ•°æ®æºäº‹åŠ¡</h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Service</span>
public class OrderServiceImpl extends ServiceImpl&lt;OrderMapper, Order&gt; implements OrderService {
    
    <span class="hljs-comment">/**
     * å•æ•°æ®æºäº‹åŠ¡ï¼šæ‰€æœ‰æ“ä½œéƒ½åœ¨ä¸»åº“æ‰§è¡Œ
     * ä½¿ç”¨@DS("master")ç¡®ä¿å³ä½¿æœ‰AOPé…ç½®ä¹Ÿä½¿ç”¨ä¸»åº“
     */</span>
    <span class="hljs-variable">@DS</span>(<span class="hljs-string">"master"</span>)  <span class="hljs-comment">// æ˜¾å¼æŒ‡å®šä¸»åº“</span>
    <span class="hljs-variable">@Transactional</span>(rollbackFor = Exception.class)  <span class="hljs-comment">// å£°æ˜å¼äº‹åŠ¡</span>
    <span class="hljs-variable">@Override</span>
    public void <span class="hljs-built_in">createOrder</span>(Order order) {
        <span class="hljs-comment">// 1. ä¿å­˜è®¢å•ä¸»ä¿¡æ¯ï¼ˆä¸»åº“ï¼‰</span>
        <span class="hljs-selector-tag">save</span>(order);
        
        <span class="hljs-comment">// 2. æ›´æ–°åº“å­˜ï¼ˆä¸»åº“ï¼‰</span>
        <span class="hljs-selector-tag">updateStock</span>(order);
        
        <span class="hljs-comment">// 3. è®°å½•æ“ä½œæ—¥å¿—ï¼ˆä¸»åº“ï¼‰</span>
        <span class="hljs-selector-tag">logOrderOperation</span>(order);
        
        <span class="hljs-comment">// å¦‚æœä»»ä½•ä¸€æ­¥å¤±è´¥ï¼Œæ•´ä¸ªäº‹åŠ¡å›æ»š</span>
    }
    
    <span class="hljs-comment">/**
     * åªè¯»äº‹åŠ¡ï¼šå¯ä»¥æŒ‡å®šä»åº“
     */</span>
    @<span class="hljs-selector-tag">DS</span>(<span class="hljs-string">"slave"</span>)
    @<span class="hljs-selector-tag">Transactional</span>(readOnly = true)  <span class="hljs-comment">// åªè¯»äº‹åŠ¡ï¼Œæœ‰ä¼˜åŒ–æ•ˆæœ</span>
    @<span class="hljs-selector-tag">Override</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Order</span> <span class="hljs-selector-tag">getOrderDetail</span>(Long orderId) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">getById</span>(orderId);
    }
}
</code></pre>
<h3 data-id="heading-13">5.2 å¤šæ•°æ®æºäº‹åŠ¡å¤„ç†</h3>
<p>å¯¹äºæ¶‰åŠå¤šä¸ªæ•°æ®æºçš„å¤æ‚äº‹åŠ¡ï¼Œéœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DistributedTransactionService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderService orderService;
    
    <span class="hljs-comment">/**
     * ä½¿ç”¨<span class="hljs-doctag">@DSTransactional</span>å®ç°å¤šæ•°æ®æºåˆ†å¸ƒå¼äº‹åŠ¡
     * æ³¨æ„ï¼šéœ€è¦é›†æˆSeataç­‰åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶
     */</span>
    <span class="hljs-comment">// @DSTransactional  // åˆ†å¸ƒå¼äº‹åŠ¡æ³¨è§£ï¼ˆéœ€è¦é¢å¤–é…ç½®ï¼‰</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">placeOrder</span><span class="hljs-params">(Order order, User user)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1. ç”¨æˆ·æ“ä½œï¼ˆä¸»åº“ï¼‰</span>
            userService.updateUser(user);
            
            <span class="hljs-comment">// 2. è®¢å•æ“ä½œï¼ˆä¸»åº“ï¼‰</span>
            orderService.createOrder(order);
            
            <span class="hljs-comment">// æ¨¡æ‹Ÿä¸šåŠ¡å¼‚å¸¸</span>
            <span class="hljs-keyword">if</span> (order.getAmount() == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è®¢å•é‡‘é¢ä¸èƒ½ä¸ºç©º"</span>);
            }
            
            log.info(<span class="hljs-string">"ä¸‹å•æˆåŠŸ"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"ä¸‹å•å¤±è´¥ï¼Œå·²å›æ»š"</span>, e);
            <span class="hljs-keyword">throw</span> e;  <span class="hljs-comment">// æŠ›å‡ºå¼‚å¸¸è§¦å‘å›æ»š</span>
        }
    }
}
</code></pre>
<p><em>citation:7</em></p>
<h2 data-id="heading-14">6. é«˜çº§åŠŸèƒ½ä¸ä¼˜åŒ–ç­–ç•¥</h2>
<h3 data-id="heading-15">6.1 å¤šä»åº“è´Ÿè½½å‡è¡¡</h3>
<p>å½“é…ç½®å¤šä¸ªä»åº“æ—¶ï¼ŒDynamic-Datasourceæ”¯æŒå¤šç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">dynamic:</span>
      <span class="hljs-attr">datasource:</span>
        <span class="hljs-attr">master:</span>
          <span class="hljs-comment"># ä¸»åº“é…ç½®...</span>
        <span class="hljs-attr">slave1:</span>
          <span class="hljs-comment"># ä»åº“1é…ç½®...</span>
        <span class="hljs-attr">slave2:</span>
          <span class="hljs-comment"># ä»åº“2é…ç½®...</span>
        <span class="hljs-attr">slave3:</span>
          <span class="hljs-comment"># ä»åº“3é…ç½®...</span>
      <span class="hljs-attr">strategy:</span>
        <span class="hljs-attr">slave:</span> <span class="hljs-string">round_robin</span>  <span class="hljs-comment"># è´Ÿè½½å‡è¡¡ç­–ç•¥</span>
        <span class="hljs-comment"># å¯é€‰å€¼:</span>
        <span class="hljs-comment"># random - éšæœºé€‰æ‹©ï¼ˆé»˜è®¤ï¼‰</span>
        <span class="hljs-comment"># round_robin - è½®è¯¢</span>
        <span class="hljs-comment"># weight_round_robin - åŠ æƒè½®è¯¢ï¼ˆéœ€è¦é¢å¤–é…ç½®æƒé‡ï¼‰</span>
</code></pre>
<p>è´Ÿè½½å‡è¡¡ç­–ç•¥å¯¹æ¯”ï¼š</p>

























<table><thead><tr><th>ç­–ç•¥ç±»å‹</th><th>æè¿°</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>random</td><td>éšæœºé€‰æ‹©ä»åº“</td><td>ç®€å•çš„è¯»è´Ÿè½½å‡è¡¡</td></tr><tr><td>round_robin</td><td>è½®è¯¢é€‰æ‹©ä»åº“</td><td>ä»åº“é…ç½®ç›¸è¿‘ï¼Œéœ€è¦å‡åŒ€åˆ†å¸ƒ</td></tr><tr><td>weight_round_robin</td><td>æ ¹æ®æƒé‡é€‰æ‹©</td><td>ä»åº“é…ç½®ä¸åŒï¼ŒæŒ‰æ€§èƒ½åˆ†é…è´Ÿè½½</td></tr></tbody></table>
<p><em>citation:3][citation:7</em></p>
<h3 data-id="heading-16">6.2 å¥åº·æ£€æŸ¥ä¸æ•…éšœè½¬ç§»</h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Component</span>
<span class="hljs-variable">@Slf4j</span>
public class DataSourceHealthCheck {
    
    <span class="hljs-variable">@Autowired</span>
    private DataSource dataSource;
    
    <span class="hljs-comment">/**
     * å®šæ—¶æ£€æŸ¥ä»åº“å¥åº·çŠ¶æ€
     */</span>
    <span class="hljs-variable">@Scheduled</span>(fixedRate = <span class="hljs-number">60000</span>)  <span class="hljs-comment">// æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡</span>
    public void <span class="hljs-built_in">checkSlaveHealth</span>() {
        <span class="hljs-comment">// è¿™é‡Œå¯ä»¥å®ç°ä»åº“å¥åº·æ£€æŸ¥é€»è¾‘</span>
        <span class="hljs-comment">// å¦‚æœæŸä¸ªä»åº“ä¸å¯ç”¨ï¼Œå¯ä»¥åŠ¨æ€å°†å…¶ä»è´Ÿè½½å‡è¡¡æ± ä¸­ç§»é™¤</span>
        
        <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">"æ‰§è¡Œä»åº“å¥åº·æ£€æŸ¥..."</span>);
        <span class="hljs-comment">// å®é™…å®ç°ä¸­å¯ä»¥ä½¿ç”¨JDBCæµ‹è¯•è¿æ¥æˆ–æŸ¥è¯¢æ•°æ®åº“çŠ¶æ€</span>
    }
    
    <span class="hljs-comment">/**
     * è·å–ä»åº“åŒæ­¥å»¶è¿Ÿ
     */</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Long</span> <span class="hljs-selector-tag">getReplicationDelay</span>(String slaveName) {
        <span class="hljs-comment">// æ‰§è¡ŒSQLæŸ¥è¯¢ä»åº“åŒæ­¥çŠ¶æ€</span>
        <span class="hljs-comment">// SHOW SLAVE STATUS å¯ä»¥è·å–Seconds_Behind_Masterç­‰ä¿¡æ¯</span>
        <span class="hljs-comment">// å¦‚æœå»¶è¿Ÿè¿‡å¤§ï¼Œå¯ä»¥ä¸´æ—¶å°†è¯¥ä»åº“æ ‡è®°ä¸ºä¸å¯ç”¨</span>
        
        <span class="hljs-selector-tag">return</span> <span class="hljs-number">0</span><span class="hljs-selector-tag">L</span>;  <span class="hljs-comment">// è¿”å›å»¶è¿Ÿç§’æ•°</span>
    }
}
</code></pre>
<p><em>citation:2</em></p>
<h2 data-id="heading-17">7. æµ‹è¯•ä¸éªŒè¯</h2>
<h3 data-id="heading-18">7.1 å•å…ƒæµ‹è¯•</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@SpringBootTest</span>
<span class="hljs-keyword">@Slf</span>4j
class ReadWriteSeparationTest {
    
    <span class="hljs-keyword">@Autowired</span>
    private UserService userService;
    
    <span class="hljs-comment">/**
     * æµ‹è¯•å†™æ“ä½œï¼ˆåº”è¯¥è·¯ç”±åˆ°ä¸»åº“ï¼‰
     */</span>
    <span class="hljs-keyword">@Test</span>
    void testWriteOperation() {
        User user = new <span class="hljs-built_in">User</span>();
        user<span class="hljs-selector-class">.setUsername</span>("testUser");
        user<span class="hljs-selector-class">.setEmail</span>("test@example.com");
        
        boolean result = userService<span class="hljs-selector-class">.createUser</span>(user);
        
        <span class="hljs-built_in">assertTrue</span>(result);
        log<span class="hljs-selector-class">.info</span>("å†™æ“ä½œæµ‹è¯•é€šè¿‡ï¼Œåº”è·¯ç”±åˆ°ä¸»åº“");
    }
    
    <span class="hljs-comment">/**
     * æµ‹è¯•è¯»æ“ä½œï¼ˆåº”è¯¥è·¯ç”±åˆ°ä»åº“ï¼‰
     */</span>
    <span class="hljs-keyword">@Test</span>
    void testReadOperation() {
        User user = userService<span class="hljs-selector-class">.getUserById</span>(<span class="hljs-number">1</span>L);
        
        <span class="hljs-built_in">assertNotNull</span>(user);
        log<span class="hljs-selector-class">.info</span>("è¯»æ“ä½œæµ‹è¯•é€šè¿‡ï¼Œåº”è·¯ç”±åˆ°ä»åº“");
    }
    
    <span class="hljs-comment">/**
     * æµ‹è¯•äº‹åŠ¡å†…çš„æ•°æ®æºé€‰æ‹©
     */</span>
    <span class="hljs-keyword">@Test</span>
    void testTransactionalOperation() {
        <span class="hljs-comment">// æµ‹è¯•äº‹åŠ¡æ–¹æ³•ï¼Œåº”å§‹ç»ˆä½¿ç”¨ä¸»åº“</span>
        User user = userService<span class="hljs-selector-class">.getUserById</span>(<span class="hljs-number">1</span>L);
        <span class="hljs-built_in">assertNotNull</span>(user);
        
        log<span class="hljs-selector-class">.info</span>("äº‹åŠ¡å†…æ“ä½œæµ‹è¯•å®Œæˆ");
    }
}
</code></pre>
<h3 data-id="heading-19">7.2 éªŒè¯æ•°æ®æºè·¯ç”±</h3>
<p>åœ¨<code>application.yml</code>ä¸­å¼€å¯SQLæ—¥å¿—ï¼ŒéªŒè¯è¯»å†™åˆ†ç¦»æ˜¯å¦ç”Ÿæ•ˆï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># å¼€å¯MyBatis SQLæ—¥å¿—</span>
<span class="hljs-attr">logging:</span>
  <span class="hljs-attr">level:</span>
    <span class="hljs-attr">com.example.mapper:</span> <span class="hljs-string">debug</span>  <span class="hljs-comment"># Mapperæ¥å£çš„åŒ…è·¯å¾„</span>
    <span class="hljs-attr">com.baomidou.dynamic.datasource:</span> <span class="hljs-string">debug</span>  <span class="hljs-comment"># Dynamic-Datasourceæ—¥å¿—</span>
</code></pre>
<p>è§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºï¼Œåº”è¯¥èƒ½çœ‹åˆ°ç±»ä¼¼æ—¥å¿—ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-number">2025</span><span class="hljs-number">-11</span><span class="hljs-number">-11</span> <span class="hljs-number">10</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span> Master DataSource  <span class="hljs-operator">|</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">user</span> ...
<span class="hljs-number">2025</span><span class="hljs-number">-11</span><span class="hljs-number">-11</span> <span class="hljs-number">10</span>:<span class="hljs-number">00</span>:<span class="hljs-number">05</span> <span class="hljs-operator">|</span> Slave DataSource   <span class="hljs-operator">|</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> ...
</code></pre>
<p><em>citation:3</em></p>
<h2 data-id="heading-20">8. ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹</h2>
<h3 data-id="heading-21">8.1 ä¸»ä»åŒæ­¥å»¶è¿Ÿå¤„ç†</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CriticalReadService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserMapper userMapper;
    
    <span class="hljs-comment">/**
     * å¯¹äºä¸€è‡´æ€§è¦æ±‚é«˜çš„è¯»æ“ä½œï¼Œå¼ºåˆ¶èµ°ä¸»åº“
     */</span>
    <span class="hljs-meta">@DS(<span class="hljs-string">"master"</span>)</span>  <span class="hljs-comment">// å¼ºåˆ¶ä½¿ç”¨ä¸»åº“ï¼Œé¿å…è¯»å–æ—§æ•°æ®</span>
    <span class="hljs-keyword">public</span> User getCriticalUserInfo(<span class="hljs-built_in">Long</span> userId) {
        <span class="hljs-comment">// ä¾‹å¦‚ï¼šè´¦æˆ·ä½™é¢ã€è®¢å•çŠ¶æ€ç­‰å…³é”®ä¿¡æ¯</span>
        <span class="hljs-keyword">return</span> userMapper.selectById(userId);
    }
    
    <span class="hljs-comment">/**
     * æ£€æŸ¥æ•°æ®æ˜¯å¦å·²åŒæ­¥
     */</span>
    <span class="hljs-keyword">public</span> boolean waitForReplication(<span class="hljs-built_in">Long</span> userId, int maxWaitSeconds) {
        <span class="hljs-keyword">for</span> (int i = <span class="hljs-number">0</span>; i &lt; maxWaitSeconds; i++) {
            User masterUser = getFromMaster(userId);
            User slaveUser = getFromSlave(userId);
            
            <span class="hljs-keyword">if</span> (Objects.equals(masterUser, slaveUser)) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// æ•°æ®å·²åŒæ­¥</span>
            }
            
            <span class="hljs-keyword">try</span> {
                Thread.sleep(<span class="hljs-number">1000</span>);  <span class="hljs-comment">// ç­‰å¾…1ç§’</span>
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Thread.currentThread().interrupt();
                <span class="hljs-keyword">break</span>;
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// åŒæ­¥è¶…æ—¶</span>
    }
}
</code></pre>
<h3 data-id="heading-22">8.2 ç›‘æ§ä¸å‘Šè­¦</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># è¿æ¥æ± ç›‘æ§é…ç½®</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">dynamic:</span>
      <span class="hljs-attr">druid:</span>
        <span class="hljs-comment"># å¼€å¯ç›‘æ§ç»Ÿè®¡</span>
        <span class="hljs-attr">filters:</span> <span class="hljs-string">stat,wall,log4j</span>
        <span class="hljs-attr">web-stat-filter:</span>
          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">stat-view-servlet:</span>
          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
          <span class="hljs-attr">url-pattern:</span> <span class="hljs-string">/druid/*</span>
          <span class="hljs-attr">reset-enable:</span> <span class="hljs-literal">false</span>
          <span class="hljs-attr">login-username:</span> <span class="hljs-string">admin</span>
          <span class="hljs-attr">login-password:</span> <span class="hljs-string">admin</span>
</code></pre>
<h2 data-id="heading-23">9. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-24">9.1 äº‹åŠ¡å†…æ•°æ®æºåˆ‡æ¢å¤±æ•ˆ</h3>
<p><strong>é—®é¢˜</strong>ï¼šåœ¨<code>@Transactional</code>æ–¹æ³•å†…ï¼Œæ•°æ®æºåœ¨æ–¹æ³•å¼€å§‹æ—¶ç¡®å®šï¼Œæ–¹æ³•å†…éƒ¨è°ƒç”¨æ— æ³•åˆ‡æ¢æ•°æ®æºã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Service</span>
public class TransactionalService {
    
    <span class="hljs-variable">@Autowired</span>
    private ApplicationContext applicationContext;
    
    <span class="hljs-variable">@Transactional</span>
    public void <span class="hljs-built_in">transactionalMethod</span>() {
        <span class="hljs-comment">// æ–¹æ³•å†…éœ€è¦åˆ‡æ¢æ•°æ®æºæ—¶ï¼Œé€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨</span>
        <span class="hljs-selector-tag">TransactionalService</span> <span class="hljs-selector-tag">self</span> = <span class="hljs-selector-tag">applicationContext</span><span class="hljs-selector-class">.getBean</span>(TransactionalService.class);
        
        <span class="hljs-comment">// é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ï¼Œå¯ä»¥æ­£å¸¸åˆ‡æ¢æ•°æ®æº</span>
        <span class="hljs-selector-tag">self</span><span class="hljs-selector-class">.readOperation</span>();  <span class="hljs-comment">// ä½¿ç”¨ä»åº“</span>
        <span class="hljs-selector-tag">self</span><span class="hljs-selector-class">.writeOperation</span>();  <span class="hljs-comment">// ä½¿ç”¨ä¸»åº“</span>
    }
    
    @<span class="hljs-selector-tag">DS</span>(<span class="hljs-string">"slave"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">readOperation</span>() {
        <span class="hljs-comment">// è¯»æ“ä½œ</span>
    }
    
    <span class="hljs-variable">@DS</span>(<span class="hljs-string">"master"</span>)
    public void <span class="hljs-built_in">writeOperation</span>() {
        <span class="hljs-comment">// å†™æ“ä½œ</span>
    }
}
</code></pre>
<h3 data-id="heading-25">9.2 åŠ¨æ€å¢å‡æ•°æ®æº</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicDataSourceService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">DynamicDataSourceProvider</span> dataSourceProvider;
    
    <span class="hljs-comment">/**
     * è¿è¡Œæ—¶åŠ¨æ€æ·»åŠ æ•°æ®æº
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">addDataSource</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> dataSourceName, DataSourceProperty property</span>) {
        <span class="hljs-title class_">DynamicDataSourceContextHolder</span>.<span class="hljs-title function_">addDataSource</span>(dataSourceName, property);
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"åŠ¨æ€æ·»åŠ æ•°æ®æº: {}"</span>, dataSourceName);
    }
    
    <span class="hljs-comment">/**
     * è¿è¡Œæ—¶ç§»é™¤æ•°æ®æº
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">removeDataSource</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> dataSourceName</span>) {
        <span class="hljs-title class_">DynamicDataSourceContextHolder</span>.<span class="hljs-title function_">removeDataSource</span>(dataSourceName);
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"åŠ¨æ€ç§»é™¤æ•°æ®æº: {}"</span>, dataSourceName);
    }
}
</code></pre>
<h2 data-id="heading-26">æ€»ç»“</h2>
<p>é€šè¿‡SpringBoot + MyBatis-Plus + Dynamic-Datasourceå®ç°è¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥æ˜¾è‘—æå‡æ•°æ®åº“è¯»æ€§èƒ½å’Œé«˜å¯ç”¨æ€§ã€‚å…³é”®ç‚¹åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>æ­£ç¡®é…ç½®</strong>ï¼šç¡®ä¿ä¸»ä»æ•°æ®æºé…ç½®æ­£ç¡®ï¼Œè´Ÿè½½å‡è¡¡ç­–ç•¥åˆç†</li>
<li><strong>åˆç†ä½¿ç”¨æ³¨è§£</strong>ï¼šåœ¨é€‚å½“çš„æ–¹æ³•ä¸Šä½¿ç”¨<code>@DS</code>æ³¨è§£æˆ–é€šè¿‡AOPè‡ªåŠ¨åˆ‡æ¢</li>
<li><strong>äº‹åŠ¡ç®¡ç†</strong>ï¼šæ³¨æ„äº‹åŠ¡å†…çš„æ•°æ®æºè¡Œä¸ºï¼Œå…³é”®æ“ä½œå¼ºåˆ¶èµ°ä¸»åº“</li>
<li><strong>ç›‘æ§å‘Šè­¦</strong>ï¼šå»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»ï¼ŒåŠæ—¶å‘ç°ä¸»ä»å»¶è¿Ÿç­‰é—®é¢˜</li>
<li><strong>æ•…éšœå¤„ç†</strong>ï¼šå®ç°ä»åº“æ•…éšœè‡ªåŠ¨è½¬ç§»å’Œæ¢å¤æœºåˆ¶</li>
</ol>
<p>è¿™ç§æ¶æ„åœ¨è¯»å†™æ¯”ä¾‹é«˜çš„åº”ç”¨ä¸­èƒ½å¸¦æ¥æ˜¾è‘—çš„æ€§èƒ½æå‡ï¼Œä½†ä¹Ÿéœ€è¦å¤„ç†å¥½ä¸»ä»åŒæ­¥å»¶è¿Ÿç­‰ä¸€è‡´æ€§é—®é¢˜ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€OpenGLå­¦ä¹ æ»¤é•œç›¸æœºã€- Day9: CameraX åŸºç¡€é›†æˆ]]></title>    <link>https://juejin.cn/post/7571299394345435178</link>    <guid>https://juejin.cn/post/7571299394345435178</guid>    <pubDate>2025-11-11T12:16:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571299394345435178" data-draft-id="7571102074039238697" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€OpenGLå­¦ä¹ æ»¤é•œç›¸æœºã€- Day9: CameraX åŸºç¡€é›†æˆ"/> <meta itemprop="keywords" content="Android,OpenGL"/> <meta itemprop="datePublished" content="2025-11-11T12:16:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸‹ä½å­"/> <meta itemprop="url" content="https://juejin.cn/user/2313028193761389"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€OpenGLå­¦ä¹ æ»¤é•œç›¸æœºã€- Day9: CameraX åŸºç¡€é›†æˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2313028193761389/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸‹ä½å­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T12:16:40.000Z" title="Tue Nov 11 2025 12:16:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://juejin.cn/post/7567889397497528383" target="_blank" title="https://juejin.cn/post/7567889397497528383">å‰è¨€: ã€OpenGLå­¦ä¹ ã€ ä»é›¶æ‰“é€  Android æ»¤é•œç›¸æœº</a></p>
<p><a href="https://juejin.cn/post/7570534000718495807" target="_blank" title="https://juejin.cn/post/7570534000718495807">ä¸Šä¸€ç¯‡:ã€OpenGLå­¦ä¹ æ»¤é•œç›¸æœºã€- Day8: å¤šé‡çº¹ç†ä¸æ··åˆ</a></p>
<p>Github:Â <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fxiaweizi%2FOpenGLTest" target="_blank" title="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fxiaweizi%2FOpenGLTest">OpenGLTest</a></p>
<h2 data-id="heading-0">ğŸ“š ä»Šæ—¥ç›®æ ‡</h2>
<ul>
<li>ç†è§£ CameraX æ¶æ„å’Œæ ¸å¿ƒæ¦‚å¿µ</li>
<li>æŒæ¡ç›¸æœºæƒé™çš„ç”³è¯·å’Œå¤„ç†</li>
<li>å­¦ä¹  PreviewView çš„ä½¿ç”¨</li>
<li>å®ç°ç›¸æœºé¢„è§ˆåŠŸèƒ½</li>
<li>äº†è§£ç”Ÿå‘½å‘¨æœŸç»‘å®šæœºåˆ¶</li>
</ul>
<p><strong>è¿è¡Œæ•ˆæœï¼š</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca3cffb78f4b400aa6640201f07f882b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiL5L2N5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763468200&amp;x-signature=aRTmiieyDTszq9fB2fam%2BEg6y98%3D" alt="Day9.gif" loading="lazy"/></p>
<h2 data-id="heading-1">ğŸ¯ å­¦ä¹ å†…å®¹</h2>
<h3 data-id="heading-2">1. CameraX ç®€ä»‹</h3>
<p><strong>CameraX</strong> æ˜¯ Google æ¨å‡ºçš„ Jetpack åº“ï¼Œç”¨äºç®€åŒ– Android ç›¸æœºå¼€å‘ã€‚</p>
<h4 data-id="heading-3">ä¸ºä»€ä¹ˆä½¿ç”¨ CameraXï¼Ÿ</h4>

























<table><thead><tr><th>ä¼ ç»Ÿ Camera2 API</th><th>CameraX</th></tr></thead><tbody><tr><td>ä»£ç å¤æ‚ï¼ŒAPI ç¹ç</td><td>ç®€å•æ˜“ç”¨ï¼Œä»£ç é‡å°‘</td></tr><tr><td>éœ€è¦å¤„ç†è®¾å¤‡å·®å¼‚</td><td>è‡ªåŠ¨å¤„ç†å…¼å®¹æ€§é—®é¢˜</td></tr><tr><td>ç”Ÿå‘½å‘¨æœŸç®¡ç†å›°éš¾</td><td>è‡ªåŠ¨ç»‘å®šç”Ÿå‘½å‘¨æœŸ</td></tr><tr><td>é¢„è§ˆã€æ‹ç…§ã€å½•åƒéœ€è¦å¤§é‡ä»£ç </td><td>å‡ è¡Œä»£ç å³å¯å®ç°</td></tr></tbody></table>
<h4 data-id="heading-4">CameraX çš„ä¼˜åŠ¿</h4>
<ul>
<li>âœ… <strong>ç®€å•æ˜“ç”¨</strong>ï¼šå‡ è¡Œä»£ç å®ç°é¢„è§ˆå’Œæ‹ç…§</li>
<li>âœ… <strong>å…¼å®¹æ€§å¥½</strong>ï¼šè‡ªåŠ¨å¤„ç†ä¸åŒè®¾å¤‡çš„å·®å¼‚</li>
<li>âœ… <strong>ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥</strong>ï¼šè‡ªåŠ¨ç®¡ç†ç›¸æœºçš„æ‰“å¼€å’Œå…³é—­</li>
<li>âœ… <strong>å‘åå…¼å®¹</strong>ï¼šæ”¯æŒ Android 5.0+ï¼ˆAPI 21ï¼‰</li>
<li>âœ… <strong>æ‰©å±•æ”¯æŒ</strong>ï¼šç¾é¢œã€å¤œæ™¯ã€HDR ç­‰å‚å•†æ‰©å±•</li>
</ul>
<h3 data-id="heading-5">2. CameraX æ¶æ„</h3>
<h4 data-id="heading-6">æ ¸å¿ƒç»„ä»¶</h4>
<pre><code class="hljs language-scss" lang="scss">CameraX æ¶æ„
â”œâ”€â”€ Use Cases (ç”¨ä¾‹)
â”‚   â”œâ”€â”€ Preview (é¢„è§ˆ)
â”‚   â”œâ”€â”€ ImageCapture (æ‹ç…§)
â”‚   â”œâ”€â”€ ImageAnalysis (å›¾åƒåˆ†æ)
â”‚   â””â”€â”€ VideoCapture (å½•åƒ)
â”œâ”€â”€ CameraSelector (ç›¸æœºé€‰æ‹©å™¨)
â”‚   â”œâ”€â”€ LENS_FACING_BACK (åç½®)
â”‚   â””â”€â”€ LENS_FACING_FRONT (å‰ç½®)
â”œâ”€â”€ ProcessCameraProvider (ç›¸æœºæä¾›è€…)
â”‚   â””â”€â”€ ç®¡ç†ç›¸æœºçš„ç”Ÿå‘½å‘¨æœŸ
â””â”€â”€ PreviewView (é¢„è§ˆè§†å›¾)
    â””â”€â”€ æ˜¾ç¤ºç›¸æœºé¢„è§ˆç”»é¢
</code></pre>
<h4 data-id="heading-7">å·¥ä½œæµç¨‹</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> è·å– ProcessCameraProvider
   â†“
<span class="hljs-bullet">2.</span> åˆ›å»º Use Cases (Preview, ImageCapture ç­‰)
   â†“
<span class="hljs-bullet">3.</span> é€‰æ‹©ç›¸æœº (CameraSelector)
   â†“
<span class="hljs-bullet">4.</span> ç»‘å®šåˆ°ç”Ÿå‘½å‘¨æœŸ (bindToLifecycle)
   â†“
<span class="hljs-bullet">5.</span> æ˜¾ç¤ºé¢„è§ˆ / æ‹ç…§ / åˆ†æ
</code></pre>
<h3 data-id="heading-8">3. ç›¸æœºæƒé™å¤„ç†</h3>
<h4 data-id="heading-9">3.1 åœ¨ AndroidManifest.xml ä¸­å£°æ˜æƒé™</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- ç›¸æœºæƒé™ï¼ˆå¿…éœ€ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.CAMERA"</span> /&gt;</span>

<span class="hljs-comment">&lt;!-- å­˜å‚¨æƒé™ï¼ˆæ‹ç…§ä¿å­˜éœ€è¦ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.WRITE_EXTERNAL_STORAGE"</span>
    <span class="hljs-attr">android:maxSdkVersion</span>=<span class="hljs-string">"28"</span> /&gt;</span>

<span class="hljs-comment">&lt;!-- ç›¸æœºç‰¹æ€§ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-feature</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.hardware.camera"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-feature</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.hardware.camera.autofocus"</span> /&gt;</span>
</code></pre>
<h4 data-id="heading-10">3.2 è¿è¡Œæ—¶æƒé™ç”³è¯·ï¼ˆAndroid 6.0+ï¼‰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Day09Activity</span> : <span class="hljs-type">AppCompatActivity</span>() {

    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> REQUEST_CODE_PERMISSIONS = <span class="hljs-number">10</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> REQUIRED_PERMISSIONS = arrayOf(Manifest.permission.CAMERA)
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        
        <span class="hljs-comment">// æ£€æŸ¥æƒé™</span>
        <span class="hljs-keyword">if</span> (allPermissionsGranted()) {
            startCamera()
        } <span class="hljs-keyword">else</span> {
            ActivityCompat.requestPermissions(
                <span class="hljs-keyword">this</span>, REQUIRED_PERMISSIONS, REQUEST_CODE_PERMISSIONS
            )
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">allPermissionsGranted</span><span class="hljs-params">()</span></span> = REQUIRED_PERMISSIONS.all {
        ContextCompat.checkSelfPermission(
            baseContext, it
        ) == PackageManager.PERMISSION_GRANTED
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onRequestPermissionsResult</span><span class="hljs-params">(
        requestCode: <span class="hljs-type">Int</span>,
        permissions: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">String</span>&gt;,
        grantResults: <span class="hljs-type">IntArray</span>
    )</span></span> {
        <span class="hljs-keyword">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults)
        <span class="hljs-keyword">if</span> (requestCode == REQUEST_CODE_PERMISSIONS) {
            <span class="hljs-keyword">if</span> (allPermissionsGranted()) {
                startCamera()
            } <span class="hljs-keyword">else</span> {
                Toast.makeText(<span class="hljs-keyword">this</span>, <span class="hljs-string">"æƒé™è¢«æ‹’ç»"</span>, Toast.LENGTH_SHORT).show()
                finish()
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-11">4. å®ç°ç›¸æœºé¢„è§ˆ</h3>
<h4 data-id="heading-12">4.1 å¸ƒå±€æ–‡ä»¶</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">androidx.constraintlayout.widget.ConstraintLayout</span>
    <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attr">xmlns:app</span>=<span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span>
    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span>
    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- ç›¸æœºé¢„è§ˆè§†å›¾ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">androidx.camera.view.PreviewView</span>
        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/preview_view"</span>
        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"0dp"</span>
        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"0dp"</span>
        <span class="hljs-attr">app:layout_constraintBottom_toTopOf</span>=<span class="hljs-string">"@id/control_panel"</span>
        <span class="hljs-attr">app:layout_constraintEnd_toEndOf</span>=<span class="hljs-string">"parent"</span>
        <span class="hljs-attr">app:layout_constraintStart_toStartOf</span>=<span class="hljs-string">"parent"</span>
        <span class="hljs-attr">app:layout_constraintTop_toTopOf</span>=<span class="hljs-string">"parent"</span> /&gt;</span>

    <span class="hljs-comment">&lt;!-- æ§åˆ¶é¢æ¿ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span>
        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/control_panel"</span>
        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"0dp"</span>
        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:background</span>=<span class="hljs-string">"#80000000"</span>
        <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">"horizontal"</span>
        <span class="hljs-attr">android:padding</span>=<span class="hljs-string">"16dp"</span>
        <span class="hljs-attr">app:layout_constraintBottom_toBottomOf</span>=<span class="hljs-string">"parent"</span>
        <span class="hljs-attr">app:layout_constraintEnd_toEndOf</span>=<span class="hljs-string">"parent"</span>
        <span class="hljs-attr">app:layout_constraintStart_toStartOf</span>=<span class="hljs-string">"parent"</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- æ‹ç…§æŒ‰é’® --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
            <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/btn_capture"</span>
            <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"0dp"</span>
            <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
            <span class="hljs-attr">android:layout_weight</span>=<span class="hljs-string">"1"</span>
            <span class="hljs-attr">android:text</span>=<span class="hljs-string">"æ‹ç…§"</span> /&gt;</span>

        <span class="hljs-comment">&lt;!-- åˆ‡æ¢ç›¸æœºæŒ‰é’® --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
            <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/btn_switch_camera"</span>
            <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"0dp"</span>
            <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
            <span class="hljs-attr">android:layout_marginStart</span>=<span class="hljs-string">"8dp"</span>
            <span class="hljs-attr">android:layout_weight</span>=<span class="hljs-string">"1"</span>
            <span class="hljs-attr">android:text</span>=<span class="hljs-string">"åˆ‡æ¢ç›¸æœº"</span> /&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span>
</code></pre>
<h4 data-id="heading-13">4.2 å¯åŠ¨ç›¸æœº</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">startCamera</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// è·å– ProcessCameraProvider çš„ Future</span>
    <span class="hljs-keyword">val</span> cameraProviderFuture = ProcessCameraProvider.getInstance(<span class="hljs-keyword">this</span>)

    cameraProviderFuture.addListener({
        <span class="hljs-comment">// è·å– CameraProvider</span>
        <span class="hljs-keyword">val</span> cameraProvider: ProcessCameraProvider = cameraProviderFuture.<span class="hljs-keyword">get</span>()

        <span class="hljs-comment">// åˆ›å»º Preview Use Case</span>
        <span class="hljs-keyword">val</span> preview = Preview.Builder()
            .build()
            .also {
                <span class="hljs-comment">// è®¾ç½® Surface Provider</span>
                it.setSurfaceProvider(previewView.surfaceProvider)
            }

        <span class="hljs-comment">// é€‰æ‹©åç½®ç›¸æœº</span>
        <span class="hljs-keyword">val</span> cameraSelector = CameraSelector.DEFAULT_BACK_CAMERA

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è§£ç»‘ä¹‹å‰çš„ Use Cases</span>
            cameraProvider.unbindAll()

            <span class="hljs-comment">// ç»‘å®š Use Cases åˆ°ç”Ÿå‘½å‘¨æœŸ</span>
            cameraProvider.bindToLifecycle(
                <span class="hljs-keyword">this</span>,      <span class="hljs-comment">// LifecycleOwner</span>
                cameraSelector,
                preview
            )

        } <span class="hljs-keyword">catch</span> (exc: Exception) {
            Log.e(TAG, <span class="hljs-string">"Use case binding failed"</span>, exc)
        }

    }, ContextCompat.getMainExecutor(<span class="hljs-keyword">this</span>))
}
</code></pre>
<h3 data-id="heading-14">5. CameraSelector è¯¦è§£</h3>
<h4 data-id="heading-15">5.1 é€‰æ‹©å‰ç½®/åç½®ç›¸æœº</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// åç½®ç›¸æœº</span>
<span class="hljs-keyword">val</span> backCameraSelector = CameraSelector.DEFAULT_BACK_CAMERA

<span class="hljs-comment">// å‰ç½®ç›¸æœº</span>
<span class="hljs-keyword">val</span> frontCameraSelector = CameraSelector.DEFAULT_FRONT_CAMERA

<span class="hljs-comment">// è‡ªå®šä¹‰é€‰æ‹©å™¨</span>
<span class="hljs-keyword">val</span> customSelector = CameraSelector.Builder()
    .requireLensFacing(CameraSelector.LENS_FACING_BACK)
    .build()
</code></pre>
<h4 data-id="heading-16">5.2 åˆ‡æ¢ç›¸æœº</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> lensFacing = CameraSelector.LENS_FACING_BACK

<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">switchCamera</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// åˆ‡æ¢å‰åæ‘„åƒå¤´</span>
    lensFacing = <span class="hljs-keyword">if</span> (lensFacing == CameraSelector.LENS_FACING_BACK) {
        CameraSelector.LENS_FACING_FRONT
    } <span class="hljs-keyword">else</span> {
        CameraSelector.LENS_FACING_BACK
    }
    
    <span class="hljs-comment">// é‡æ–°å¯åŠ¨ç›¸æœº</span>
    startCamera()
}
</code></pre>
<h3 data-id="heading-17">6. æ‹ç…§åŠŸèƒ½</h3>
<h4 data-id="heading-18">6.1 åˆ›å»º ImageCapture Use Case</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// åˆ›å»º ImageCapture</span>
imageCapture = ImageCapture.Builder()
    .setCaptureMode(ImageCapture.CAPTURE_MODE_MINIMIZE_LATENCY)
    .build()

<span class="hljs-comment">// ç»‘å®šæ—¶åŒæ—¶ç»‘å®š Preview å’Œ ImageCapture</span>
cameraProvider.bindToLifecycle(
    <span class="hljs-keyword">this</span>,
    cameraSelector,
    preview,
    imageCapture  <span class="hljs-comment">// æ·»åŠ æ‹ç…§åŠŸèƒ½</span>
)
</code></pre>
<h4 data-id="heading-19">6.2 æ‹ç…§å¹¶ä¿å­˜</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">takePhoto</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> imageCapture = imageCapture ?: <span class="hljs-keyword">return</span>

    <span class="hljs-comment">// åˆ›å»ºä¿å­˜æ–‡ä»¶</span>
    <span class="hljs-keyword">val</span> photoFile = File(
        getOutputDirectory(),
        SimpleDateFormat(FILENAME_FORMAT, Locale.US)
            .format(System.currentTimeMillis()) + <span class="hljs-string">".jpg"</span>
    )

    <span class="hljs-comment">// é…ç½®è¾“å‡ºé€‰é¡¹</span>
    <span class="hljs-keyword">val</span> outputOptions = ImageCapture.OutputFileOptions.Builder(photoFile).build()

    <span class="hljs-comment">// æ‹ç…§</span>
    imageCapture.takePicture(
        outputOptions,
        ContextCompat.getMainExecutor(<span class="hljs-keyword">this</span>),
        <span class="hljs-keyword">object</span> : ImageCapture.OnImageSavedCallback {
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(exc: <span class="hljs-type">ImageCaptureException</span>)</span></span> {
                Log.e(TAG, <span class="hljs-string">"æ‹ç…§å¤±è´¥: <span class="hljs-subst">${exc.message}</span>"</span>, exc)
            }

            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onImageSaved</span><span class="hljs-params">(output: <span class="hljs-type">ImageCapture</span>.<span class="hljs-type">OutputFileResults</span>)</span></span> {
                <span class="hljs-keyword">val</span> msg = <span class="hljs-string">"æ‹ç…§æˆåŠŸ: <span class="hljs-subst">${photoFile.absolutePath}</span>"</span>
                Toast.makeText(baseContext, msg, Toast.LENGTH_SHORT).show()
                Log.d(TAG, msg)
            }
        }
    )
}

<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getOutputDirectory</span><span class="hljs-params">()</span></span>: File {
    <span class="hljs-keyword">val</span> mediaDir = externalMediaDirs.firstOrNull()?.let {
        File(it, resources.getString(R.string.app_name)).apply { mkdirs() }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (mediaDir != <span class="hljs-literal">null</span> &amp;&amp; mediaDir.exists())
        mediaDir <span class="hljs-keyword">else</span> filesDir
}
</code></pre>
<h3 data-id="heading-20">7. PreviewView é…ç½®</h3>
<h4 data-id="heading-21">7.1 ç¼©æ”¾æ¨¡å¼</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å¡«å……æ•´ä¸ªè§†å›¾ï¼ˆå¯èƒ½è£å‰ªï¼‰</span>
previewView.scaleType = PreviewView.ScaleType.FILL_CENTER

<span class="hljs-comment">// é€‚åº”è§†å›¾å¤§å°ï¼ˆå¯èƒ½æœ‰é»‘è¾¹ï¼‰</span>
previewView.scaleType = PreviewView.ScaleType.FIT_CENTER
</code></pre>
<h4 data-id="heading-22">7.2 å®ç°æ¨¡å¼</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ä½¿ç”¨ SurfaceViewï¼ˆæ€§èƒ½æ›´å¥½ï¼‰</span>
previewView.implementationMode = PreviewView.ImplementationMode.PERFORMANCE

<span class="hljs-comment">// ä½¿ç”¨ TextureViewï¼ˆå…¼å®¹æ€§æ›´å¥½ï¼‰</span>
previewView.implementationMode = PreviewView.ImplementationMode.COMPATIBLE
</code></pre>
<h3 data-id="heading-23">8. ç”Ÿå‘½å‘¨æœŸç®¡ç†</h3>
<p>CameraX ä¼šè‡ªåŠ¨ç®¡ç†ç›¸æœºçš„ç”Ÿå‘½å‘¨æœŸï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// CameraX è‡ªåŠ¨å¤„ç†</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onResume</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">super</span>.onResume()
    <span class="hljs-comment">// ç›¸æœºè‡ªåŠ¨æ¢å¤ï¼ˆå¦‚æœå·²ç»‘å®šï¼‰</span>
}

<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onPause</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">super</span>.onPause()
    <span class="hljs-comment">// ç›¸æœºè‡ªåŠ¨æš‚åœ</span>
}

<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDestroy</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">super</span>.onDestroy()
    <span class="hljs-comment">// ç›¸æœºè‡ªåŠ¨é‡Šæ”¾</span>
}
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼šä½¿ç”¨ <code>bindToLifecycle()</code> æ—¶ï¼ŒCameraX ä¼šè‡ªåŠ¨å¤„ç†ç›¸æœºçš„æ‰“å¼€ã€å…³é—­å’Œæš‚åœã€‚</p>
<h3 data-id="heading-24">9. ç›¸æœºé…ç½®é€‰é¡¹</h3>
<h4 data-id="heading-25">9.1 åˆ†è¾¨ç‡é…ç½®</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> preview = Preview.Builder()
    .setTargetResolution(Size(<span class="hljs-number">1280</span>, <span class="hljs-number">720</span>))  <span class="hljs-comment">// è®¾ç½®ç›®æ ‡åˆ†è¾¨ç‡</span>
    .build()
</code></pre>
<h4 data-id="heading-26">9.2 å®½é«˜æ¯”é…ç½®</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> preview = Preview.Builder()
    .setTargetAspectRatio(AspectRatio.RATIO_16_9)  <span class="hljs-comment">// 16:9</span>
    .build()
</code></pre>
<h4 data-id="heading-27">9.3 æ—‹è½¬é…ç½®</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> preview = Preview.Builder()
    .setTargetRotation(Surface.ROTATION_0)  <span class="hljs-comment">// è®¾ç½®ç›®æ ‡æ—‹è½¬è§’åº¦</span>
    .build()
</code></pre>
<h3 data-id="heading-28">10. é”™è¯¯å¤„ç†</h3>
<h4 data-id="heading-29">10.1 å¸¸è§é”™è¯¯</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">try</span> {
    cameraProvider.bindToLifecycle(<span class="hljs-keyword">this</span>, cameraSelector, preview)
} <span class="hljs-keyword">catch</span> (exc: Exception) {
    <span class="hljs-keyword">when</span> (exc) {
        <span class="hljs-keyword">is</span> CameraInfoUnavailableException -&gt; {
            Log.e(TAG, <span class="hljs-string">"ç›¸æœºä¿¡æ¯ä¸å¯ç”¨"</span>)
        }
        <span class="hljs-keyword">is</span> IllegalArgumentException -&gt; {
            Log.e(TAG, <span class="hljs-string">"Use Case ç»‘å®šå‚æ•°é”™è¯¯"</span>)
        }
        <span class="hljs-keyword">else</span> -&gt; {
            Log.e(TAG, <span class="hljs-string">"Use Case ç»‘å®šå¤±è´¥"</span>, exc)
        }
    }
}
</code></pre>
<h4 data-id="heading-30">10.2 æ£€æŸ¥ç›¸æœºå¯ç”¨æ€§</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">hasCameraPermission</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">return</span> ContextCompat.checkSelfPermission(
        <span class="hljs-keyword">this</span>,
        Manifest.permission.CAMERA
    ) == PackageManager.PERMISSION_GRANTED
}

<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">hasCamera</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">return</span> packageManager.hasSystemFeature(PackageManager.FEATURE_CAMERA_ANY)
}
</code></pre>
<h2 data-id="heading-31">ğŸ’» ä»£ç å®è·µ</h2>
<h3 data-id="heading-32">ä»Šæ—¥ä»»åŠ¡</h3>
<p>å®ç°ä¸€ä¸ªç®€å•çš„ç›¸æœºé¢„è§ˆåº”ç”¨ï¼š</p>
<ol>
<li><strong>æƒé™ç”³è¯·</strong>ï¼šè¯·æ±‚ç›¸æœºæƒé™</li>
<li><strong>ç›¸æœºé¢„è§ˆ</strong>ï¼šä½¿ç”¨ PreviewView æ˜¾ç¤ºå®æ—¶ç”»é¢</li>
<li><strong>æ‹ç…§åŠŸèƒ½</strong>ï¼šç‚¹å‡»æŒ‰é’®æ‹ç…§å¹¶ä¿å­˜</li>
<li><strong>åˆ‡æ¢ç›¸æœº</strong>ï¼šå‰ç½®/åç½®ç›¸æœºåˆ‡æ¢</li>
</ol>
<h3 data-id="heading-33">å®ç°æ•ˆæœ</h3>
<ul>
<li>ğŸ“· å®æ—¶ç›¸æœºé¢„è§ˆ</li>
<li>ğŸ“¸ æ‹ç…§å¹¶ä¿å­˜åˆ°ç›¸å†Œ</li>
<li>ğŸ”„ å‰åæ‘„åƒå¤´åˆ‡æ¢</li>
<li>âš™ï¸ è‡ªåŠ¨å¤„ç†ç”Ÿå‘½å‘¨æœŸ</li>
</ul>
<h3 data-id="heading-34">æ ¸å¿ƒä»£ç ç»“æ„</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Day09Activity</span> : <span class="hljs-type">AppCompatActivity</span>() {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> previewView: PreviewView
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> imageCapture: ImageCapture? = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> lensFacing = CameraSelector.LENS_FACING_BACK

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        setContentView(R.layout.activity_day09)

        previewView = findViewById(R.id.preview_view)

        <span class="hljs-comment">// æ£€æŸ¥æƒé™</span>
        <span class="hljs-keyword">if</span> (allPermissionsGranted()) {
            startCamera()
        } <span class="hljs-keyword">else</span> {
            requestPermissions()
        }

        <span class="hljs-comment">// æ‹ç…§æŒ‰é’®</span>
        findViewById&lt;Button&gt;(R.id.btn_capture).setOnClickListener {
            takePhoto()
        }

        <span class="hljs-comment">// åˆ‡æ¢ç›¸æœºæŒ‰é’®</span>
        findViewById&lt;Button&gt;(R.id.btn_switch_camera).setOnClickListener {
            switchCamera()
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">startCamera</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// å®ç°ç›¸æœºå¯åŠ¨é€»è¾‘</span>
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">takePhoto</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// å®ç°æ‹ç…§é€»è¾‘</span>
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">switchCamera</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// å®ç°åˆ‡æ¢ç›¸æœºé€»è¾‘</span>
    }
}
</code></pre>
<h2 data-id="heading-35">ğŸ§ª ç»ƒä¹ ä»»åŠ¡</h2>
<h3 data-id="heading-36">åŸºç¡€ä»»åŠ¡</h3>
<ol>
<li>âœ… å®ç°ç›¸æœºæƒé™ç”³è¯·</li>
<li>âœ… å®ç°ç›¸æœºé¢„è§ˆåŠŸèƒ½</li>
<li>âœ… å®ç°æ‹ç…§å¹¶ä¿å­˜åˆ°ç›¸å†Œ</li>
</ol>
<h3 data-id="heading-37">è¿›é˜¶ä»»åŠ¡</h3>
<ol>
<li>ğŸ“Š æ˜¾ç¤ºæ‹ç…§æˆåŠŸçš„ç¼©ç•¥å›¾</li>
<li>ğŸ¨ æ·»åŠ æ‹ç…§åŠ¨ç”»æ•ˆæœï¼ˆé—ªå…‰ï¼‰</li>
<li>ğŸ“ æ”¯æŒæåˆç¼©æ”¾ï¼ˆPinch to Zoomï¼‰</li>
<li>ğŸ”¦ æ·»åŠ é—ªå…‰ç¯æ§åˆ¶</li>
</ol>
<h3 data-id="heading-38">æŒ‘æˆ˜ä»»åŠ¡</h3>
<ol>
<li>ğŸ¬ å®ç°å½•åƒåŠŸèƒ½ï¼ˆVideoCaptureï¼‰</li>
<li>ğŸ“ æ·»åŠ ç½‘æ ¼çº¿è¾…åŠ©æ„å›¾</li>
<li>ğŸ’¾ å®ç°è¿æ‹åŠŸèƒ½</li>
<li>ğŸ–¼ï¸ æ”¯æŒä¸åŒå®½é«˜æ¯”åˆ‡æ¢ï¼ˆ4:3, 16:9, 1:1ï¼‰</li>
</ol>
<h2 data-id="heading-39">ğŸ“– çŸ¥è¯†ç‚¹æ€»ç»“</h2>
<h3 data-id="heading-40">CameraX æ ¸å¿ƒæ¦‚å¿µ</h3>





























<table><thead><tr><th>æ¦‚å¿µ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>Use Case</strong></td><td>ç›¸æœºçš„ä½¿ç”¨åœºæ™¯ï¼ˆé¢„è§ˆã€æ‹ç…§ã€åˆ†æã€å½•åƒï¼‰</td></tr><tr><td><strong>CameraSelector</strong></td><td>é€‰æ‹©ä½¿ç”¨å“ªä¸ªç›¸æœºï¼ˆå‰ç½®/åç½®ï¼‰</td></tr><tr><td><strong>ProcessCameraProvider</strong></td><td>ç®¡ç†ç›¸æœºç”Ÿå‘½å‘¨æœŸçš„æä¾›è€…</td></tr><tr><td><strong>PreviewView</strong></td><td>æ˜¾ç¤ºç›¸æœºé¢„è§ˆçš„è§†å›¾</td></tr><tr><td><strong>LifecycleOwner</strong></td><td>ç”Ÿå‘½å‘¨æœŸæ‹¥æœ‰è€…ï¼ˆé€šå¸¸æ˜¯ Activityï¼‰</td></tr></tbody></table>
<h3 data-id="heading-41">Use Cases å¯¹æ¯”</h3>






























<table><thead><tr><th>Use Case</th><th>ç”¨é€”</th><th>å…¸å‹åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Preview</strong></td><td>å®æ—¶é¢„è§ˆ</td><td>ç›¸æœºå–æ™¯</td></tr><tr><td><strong>ImageCapture</strong></td><td>æ‹ç…§</td><td>æ‹æ‘„ç…§ç‰‡</td></tr><tr><td><strong>ImageAnalysis</strong></td><td>å›¾åƒåˆ†æ</td><td>äºŒç»´ç æ‰«æã€äººè„¸è¯†åˆ«</td></tr><tr><td><strong>VideoCapture</strong></td><td>å½•åƒ</td><td>å½•åˆ¶è§†é¢‘</td></tr></tbody></table>
<h3 data-id="heading-42">æœ€ä½³å®è·µ</h3>
<ol>
<li>âœ… <strong>ä½¿ç”¨ bindToLifecycle()</strong>ï¼šè‡ªåŠ¨ç®¡ç†ç›¸æœºç”Ÿå‘½å‘¨æœŸ</li>
<li>âœ… <strong>åœ¨ä¸»çº¿ç¨‹ä½¿ç”¨ CameraX API</strong>ï¼šé¿å…çº¿ç¨‹é—®é¢˜</li>
<li>âœ… <strong>å¤ç”¨ CameraProvider</strong>ï¼šä¸è¦é¢‘ç¹è·å–</li>
<li>âœ… <strong>å¤„ç†é…ç½®å˜æ›´</strong>ï¼šå±å¹•æ—‹è½¬æ—¶æ­£ç¡®æ›´æ–°</li>
<li>âœ… <strong>åŠæ—¶è§£ç»‘ Use Cases</strong>ï¼šåˆ‡æ¢ç›¸æœºå‰è°ƒç”¨ <code>unbindAll()</code></li>
</ol>
<h2 data-id="heading-43">ğŸ› å¸¸è§é—®é¢˜</h2>
<h3 data-id="heading-44">Q1: ç›¸æœºé¢„è§ˆç”»é¢æ˜¯é»‘è‰²çš„ï¼Ÿ</h3>
<p><strong>å¯èƒ½åŸå› </strong>ï¼š</p>
<ol>
<li>æƒé™æœªæˆäºˆ</li>
<li>PreviewView æœªæ­£ç¡®è®¾ç½® SurfaceProvider</li>
<li>Use Case æœªç»‘å®šåˆ°ç”Ÿå‘½å‘¨æœŸ</li>
</ol>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. ç¡®è®¤æƒé™å·²æˆäºˆ</span>
<span class="hljs-keyword">if</span> (!allPermissionsGranted()) {
    requestPermissions()
    <span class="hljs-keyword">return</span>
}

<span class="hljs-comment">// 2. æ­£ç¡®è®¾ç½® SurfaceProvider</span>
preview.setSurfaceProvider(previewView.surfaceProvider)

<span class="hljs-comment">// 3. ç¡®ä¿ç»‘å®šåˆ°ç”Ÿå‘½å‘¨æœŸ</span>
cameraProvider.bindToLifecycle(<span class="hljs-keyword">this</span>, cameraSelector, preview)
</code></pre>
<h3 data-id="heading-45">Q2: åº”ç”¨å´©æºƒï¼Œæç¤º "Camera is being used"ï¼Ÿ</h3>
<p><strong>åŸå› </strong>ï¼šåŒä¸€ä¸ªç›¸æœºè¢«å¤šæ¬¡ç»‘å®šã€‚</p>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç»‘å®šå‰å…ˆè§£ç»‘æ‰€æœ‰ Use Cases</span>
cameraProvider.unbindAll()
cameraProvider.bindToLifecycle(<span class="hljs-keyword">this</span>, cameraSelector, preview)
</code></pre>
<h3 data-id="heading-46">Q3: åˆ‡æ¢å‰åç›¸æœºæ—¶é—ªçƒï¼Ÿ</h3>
<p><strong>åŸå› </strong>ï¼šåˆ‡æ¢æ—¶æ²¡æœ‰æ­£ç¡®å¤„ç†ã€‚</p>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">switchCamera</span><span class="hljs-params">()</span></span> {
    lensFacing = <span class="hljs-keyword">if</span> (lensFacing == CameraSelector.LENS_FACING_BACK) {
        CameraSelector.LENS_FACING_FRONT
    } <span class="hljs-keyword">else</span> {
        CameraSelector.LENS_FACING_BACK
    }
    
    <span class="hljs-comment">// é‡æ–°å¯åŠ¨ç›¸æœºï¼ˆä¼šè‡ªåŠ¨è§£ç»‘æ—§çš„ï¼‰</span>
    startCamera()
}
</code></pre>
<h3 data-id="heading-47">Q4: æ‹ç…§çš„å›¾ç‰‡æ–¹å‘ä¸å¯¹ï¼Ÿ</h3>
<p>CameraX ä¼šè‡ªåŠ¨å¤„ç†å›¾ç‰‡æ—‹è½¬ï¼Œä½†å¦‚æœé‡åˆ°é—®é¢˜ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> imageCapture = ImageCapture.Builder()
    .setTargetRotation(previewView.display.rotation)  <span class="hljs-comment">// è®¾ç½®æ—‹è½¬è§’åº¦</span>
    .build()
</code></pre>
<h2 data-id="heading-48">ğŸ”— å‚è€ƒèµ„æ–™</h2>
<h3 data-id="heading-49">å®˜æ–¹æ–‡æ¡£</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Ftraining%2Fcamerax" target="_blank" title="https://developer.android.com/training/camerax" ref="nofollow noopener noreferrer">CameraX å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Ftraining%2Fcamerax%2Farchitecture" target="_blank" title="https://developer.android.com/training/camerax/architecture" ref="nofollow noopener noreferrer">CameraX æ¶æ„</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Ftraining%2Fcamerax%2Fbest-practices" target="_blank" title="https://developer.android.com/training/camerax/best-practices" ref="nofollow noopener noreferrer">CameraX æœ€ä½³å®è·µ</a></li>
</ul>
<h3 data-id="heading-50">ç¤ºä¾‹ä»£ç </h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fandroid%2Fcamera-samples" target="_blank" title="https://github.com/android/camera-samples" ref="nofollow noopener noreferrer">CameraX å®˜æ–¹ç¤ºä¾‹</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcodelabs.developers.google.com%2Fcodelabs%2Fcamerax-getting-started" target="_blank" title="https://codelabs.developers.google.com/codelabs/camerax-getting-started" ref="nofollow noopener noreferrer">Google Codelabs - CameraX</a></li>
</ul>
<h3 data-id="heading-51">ç›¸å…³èµ„æº</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Ftraining%2Fpermissions%2Frequesting" target="_blank" title="https://developer.android.com/training/permissions/requesting" ref="nofollow noopener noreferrer">Android ç›¸æœºæƒé™å¤„ç†</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fandroidx%2Fcamera%2Fview%2FPreviewView" target="_blank" title="https://developer.android.com/reference/androidx/camera/view/PreviewView" ref="nofollow noopener noreferrer">PreviewView API æ–‡æ¡£</a></li>
</ul>
<h2 data-id="heading-52">ğŸ“ ä»Šæ—¥æ€»ç»“</h2>
<p>ä»Šå¤©æˆ‘ä»¬å­¦ä¹ äº† CameraX çš„åŸºç¡€çŸ¥è¯†ï¼š</p>
<ol>
<li>âœ… ç†è§£äº† CameraX çš„æ¶æ„å’Œæ ¸å¿ƒæ¦‚å¿µ</li>
<li>âœ… æŒæ¡äº†ç›¸æœºæƒé™çš„ç”³è¯·å’Œå¤„ç†</li>
<li>âœ… å­¦ä¼šäº†ä½¿ç”¨ PreviewView æ˜¾ç¤ºç›¸æœºé¢„è§ˆ</li>
<li>âœ… å®ç°äº†æ‹ç…§å’Œä¿å­˜åŠŸèƒ½</li>
<li>âœ… äº†è§£äº†ç”Ÿå‘½å‘¨æœŸç®¡ç†æœºåˆ¶</li>
</ol>
<p><strong>å…³é”®è¦ç‚¹</strong>ï¼š</p>
<ul>
<li>CameraX ç®€åŒ–äº†ç›¸æœºå¼€å‘ï¼Œè‡ªåŠ¨å¤„ç†å…¼å®¹æ€§é—®é¢˜</li>
<li>Use Cases æ˜¯ CameraX çš„æ ¸å¿ƒï¼Œä»£è¡¨ä¸åŒçš„ä½¿ç”¨åœºæ™¯</li>
<li><code>bindToLifecycle()</code> ä¼šè‡ªåŠ¨ç®¡ç†ç›¸æœºçš„ç”Ÿå‘½å‘¨æœŸ</li>
<li>PreviewView æä¾›äº†ç®€å•æ˜“ç”¨çš„é¢„è§ˆåŠŸèƒ½</li>
</ul>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">ä¸‹ä¸€ç¯‡</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯æ¸²æŸ“å¤§ä½“ç§¯ å¤šé¡µé¢pdf]]></title>    <link>https://juejin.cn/post/7571278865517051954</link>    <guid>https://juejin.cn/post/7571278865517051954</guid>    <pubDate>2025-11-11T10:41:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571278865517051954" data-draft-id="7571279513246695450" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯æ¸²æŸ“å¤§ä½“ç§¯ å¤šé¡µé¢pdf"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-11T10:41:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ— åå°å…µ"/> <meta itemprop="url" content="https://juejin.cn/user/1772869560048312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯æ¸²æŸ“å¤§ä½“ç§¯ å¤šé¡µé¢pdf
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772869560048312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ— åå°å…µ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T10:41:35.000Z" title="Tue Nov 11 2025 10:41:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç¤ºä¾‹</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d690d584981a40688984f792c5da578b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5peg5ZCN5bCP5YW1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763462494&amp;x-signature=QTyb7S2hwoUVMbcoGkON1dlt8uM%3D" alt="20251111183906_rec_.gif" loading="lazy"/></p>
<h2 data-id="heading-1">ä»‹ç»</h2>
<p>é¦–å…ˆä½¿ç”¨çš„æ˜¯ vue-pdf-embedæ¸²æŸ“pdfï¼Œå‰æ®µæ—¶é—´æµ‹è¯•æµ‹å‡ºä¸€ä¸ªbugï¼Œå½“pdfæ–‡æ¡£é¡µç è¿‡å¤š(500é¡µï¼Œ7M)æ—¶ï¼Œä¼šå‡ºç°é¡µé¢å¡æ­»ç°è±¡ã€‚é¦–å…ˆå°è¯•ä½¿ç”¨loadingè§£å†³ï¼Œcss positionè§£å†³ï¼Œworkerä½†æ˜¯æ— æµäºäº‹ã€‚ç„¶åå¼€å§‹ç ”ç©¶vue-pdf-embedï¼Œå‘ç°å†…éƒ¨æ˜¯åŸºäºçš„pdfjså°è£…äº†ä¸€å±‚ï¼Œvue-pdf-embedå†…å®¹æ˜¯ä¸€æ¬¡æ€§æ¸²æŸ“å…¨éƒ¨pdfã€‚å…¶å®ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨ç¿»é¡µçš„æ–¹å¼ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸€é¡µä¸€é¡µçš„æ¸²æŸ“ï¼Œä¸ä¼šåŒæ—¶æ¸²æŸ“å¾ˆå¤šé¡µpdfã€‚</p>
<h2 data-id="heading-2">æŠ€æœ¯æ ˆ</h2>
<p>vue3 pdfjs</p>
<h2 data-id="heading-3">è§£å†³æ–¹æ¡ˆ</h2>
<p>æœ‰ä¸€ä¸ªé‡è¦çš„ç‚¹æ˜¯ï¼špdfjs å¯ä»¥è·å–åˆ°pdfçš„æ€»é¡µæ•°ï¼Œä»¥åŠæ¯ä¸€é¡µçš„pdfçš„é«˜åº¦ã€‚é‚£ä¹ˆå…ˆä½¿ç”¨ä¸€ä¸ªdivæ’‘èµ·çˆ¶å®¹å™¨ï¼Œç„¶åæ»šåŠ¨çˆ¶å®¹å™¨ï¼Œæ ¹æ®scrollTop/pdfHeight è·å–åˆ°å½“å‰è§†å£è¯¥å±•ç¤ºå“ªä¸€é¡µ currentPageã€‚</p>
<p>è¦è§£å†³çš„é—®é¢˜ï¼š<strong>å‘ä¸‹æ»šåŠ¨(ç›¸å¯¹ç®€å•)ï¼Œå‘ä¸Šæ»šåŠ¨ï¼Œå¿«é€Ÿä¸‹æ‹‰ï¼Œå¿«é€Ÿä¸Šæ‹‰</strong>ã€‚</p>
<p>ä»¥ä¸‹æœ‰5ç§æ–¹æ¡ˆï¼Œä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šç§æ–¹æ¡ˆå‘¢ï¼Œéƒ½æ˜¯åšç€åšç€ å‘ç°æ›´å¥½çš„æ–¹æ¡ˆï¼Œä»¥åŠä¸€äº›pdfjsçš„é™åˆ¶é—®é¢˜ã€‚æœ€ç»ˆæ–¹æ¡ˆæ˜¯æœ€å2ç§ã€‚</p>
<ol>
<li>1ä¸ªcanvasæ¸²æŸ“ï¼Œåˆ†åˆ«æ¸²æŸ“å‰ä¸€å¼ pdfçš„ä¸ŠåŠéƒ¨åˆ†å’Œåä¸€å¼ pdfçš„ä¸‹åŠéƒ¨åˆ†ï¼ˆæ”¾å¼ƒï¼Œpdfjsä¸å…è®¸ä½¿ç”¨åŒä¸€ä¸ªcanvasé‡å¤æ¸²æŸ“ï¼‰</li>
<li>2ä¸ªcanvasæ¸²æŸ“ï¼Œä¾‹å¦‚å…ˆç»˜åˆ¶ç¬¬1é¡µå’Œç¬¬1é¡µï¼Œç„¶åcurrentPageåˆ°2çš„æ—¶å€™ åˆ é™¤2ä¸ªcanvasï¼Œç¬¬1ä¸ªcanvasç»˜åˆ¶ç¬¬2é¡µï¼Œç¬¬2ä¸ªcanvasç»˜åˆ¶ç¬¬3é¡µã€‚ä»¥æ­¤ç±»æ¨ã€‚ï¼ˆæ”¾å¼ƒæ¯æ¬¡åˆ‡æ¢é¡µæ•°çš„æ—¶å€™ï¼Œé¡µé¢éƒ½ä¼šä¸€é—ªä¸€é—ªçš„ï¼‰</li>
<li>å¤šä¸ªcanvas  å¼Šç«¯ å‘ä¸Šæ»šåŠ¨ä¸€é¡µ å…¨éƒ¨è¦é‡æ–°ç»˜åˆ¶</li>
<li>æ¯æ»šåŠ¨ä¸€é¡µ å°†æœ€ä¸Šé¢çš„canvasåˆ é™¤ åœ¨æœ€åé¢æ·»åŠ æ–°çš„canvasï¼Œå…¶ä¸­è¿˜æœ‰è¾¹ç•Œå€¼éœ€è¦å¤„ç†ï¼Œæ¯”å¦‚pdfæœ¬æ¥å°±åªæœ‰1é¡µï¼Œpdf åˆ°æœ€åä¸€é¡µå’Œé¦–é¡µã€‚</li>
<li>ç»´æŠ¤ä¸€ä¸ªæ•°ç»„ æ•°ç»„é•¿åº¦ä¸º3ï¼ˆæˆ–è€…5ï¼‰ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå€¼å¯¹åº”pageindex,currentPageå˜åŒ–åï¼Œæ›´æ–°æ•°ç»„ï¼Œç„¶åå’Œdomå¯¹æ¯”ï¼Œåšdiffæ“ä½œã€‚</li>
</ol>
<p>æ–¹æ¡ˆ5çš„å¥½å¤„ï¼Œæ— é¡»è€ƒè™‘é‚£ä¹ˆå¤šå…¶ä»–çš„,ç¬¬4ç§æ–¹æ¡ˆè¿˜è¦è§£å†³å¿«é€Ÿæ‹‰åŠ¨çš„é—®é¢˜ã€‚æ¯æ¬¡åˆ‡æ¢pageIndex,å‰é¢çš„canvasè¢«åˆ é™¤æ‰äº†(å…¶å®ä¸åšåˆ é™¤æ“ä½œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºæ¯ä¸ªcanvasæ‰€åœ¨çš„ä½ç½®æ˜¯å›ºå®šçš„ï¼Œä¸”ä¸ä¼šé‡å )ï¼Œåé¢çš„canvasæ–°å¢äº†ï¼Œä¸ä¼šè®©ç”¨æˆ·çœ‹è§ä¸€é—ªçš„ç°è±¡ã€‚</p>
<h2 data-id="heading-4">å…¨éƒ¨ä»£ç </h2>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  &lt;!-- <span class="hljs-title class_">Canvas</span> æ˜¾ç¤ºåŒºåŸŸ --&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
    <span class="hljs-attr">v-loading</span>=<span class="hljs-string">"loading"</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"canvas-container"</span>
    <span class="hljs-attr">ref</span>=<span class="hljs-string">"canvasContainer"</span>
    @<span class="hljs-attr">scroll.passive</span>=<span class="hljs-string">"handleScroll"</span>
    <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ overflow: 'auto' }"</span>
  &gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mark"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ height: totalHeight + 'px' }"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">

<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> pdfjsLib <span class="hljs-keyword">from</span> <span class="hljs-string">"pdfjs-dist/build/pdf"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PdfWorker</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"pdfjs-dist/build/pdf.worker.mjs?url"</span>;

<span class="hljs-keyword">import</span> { onMounted, watch } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
pdfjsLib.<span class="hljs-property">GlobalWorkerOptions</span>.<span class="hljs-property">workerSrc</span> = <span class="hljs-title class_">PdfWorker</span>; <span class="hljs-comment">// ä½¿ç”¨woker</span>

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">url</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">""</span>,
  },

});
<span class="hljs-keyword">const</span> totalHeight = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// æ€»é«˜åº¦</span>
<span class="hljs-keyword">const</span> totalPages = <span class="hljs-title function_">ref</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// æ€»é¡µç </span>
<span class="hljs-keyword">const</span> pageHeight = <span class="hljs-title function_">ref</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// ä¸€é¡µé«˜åº¦</span>
<span class="hljs-keyword">let</span> currentPage = <span class="hljs-number">1</span>; <span class="hljs-comment">// å½“å‰page</span>
<span class="hljs-keyword">const</span> loading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>);
<span class="hljs-keyword">let</span> pdfDoc = <span class="hljs-literal">null</span>; <span class="hljs-comment">// ä¸èƒ½ä½¿ç”¨ref  ä¼šæŠ¥é”™</span>
<span class="hljs-keyword">let</span> renderIndex = <span class="hljs-number">0</span>;
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(props.<span class="hljs-property">url</span>, <span class="hljs-string">"props.url"</span>);
  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">url</span>) {
    <span class="hljs-title function_">loadPdf</span>(props.<span class="hljs-property">url</span>, renderIndex);
  }
});

<span class="hljs-title function_">watch</span>(
  <span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">url</span>,
  <span class="hljs-function">(<span class="hljs-params">newVal, oldVal</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (canvasContainer.<span class="hljs-property">value</span>) {
      canvasContainer.<span class="hljs-property">value</span>.<span class="hljs-property">scrollTop</span> = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">let</span> canvases = canvasContainer.<span class="hljs-property">value</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">"canvas"</span>);
      canvases.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
        canvasContainer.<span class="hljs-property">value</span>.<span class="hljs-title function_">removeChild</span>(item);
      });
    }
    <span class="hljs-keyword">if</span> (newVal) {
      <span class="hljs-comment">// console.log("newVal", newVal);</span>
      renderIndex++;
      currentPage = <span class="hljs-number">1</span>;
      allCanvasIndex = [];
      <span class="hljs-title function_">loadPdf</span>(newVal, renderIndex);
    }
  }
);
<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">"error"</span>]);
<span class="hljs-keyword">const</span> canvasContainer = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>);

<span class="hljs-keyword">let</span> allCanvas = [];
<span class="hljs-keyword">let</span> allCanvasIndex = [];
<span class="hljs-comment">// ä¸€æ¬¡æ€§æ¸²æŸ“å¤šå°‘å¼ pdf</span>
<span class="hljs-keyword">let</span> canvasMaxNum = <span class="hljs-number">2</span> + <span class="hljs-number">1</span>;
<span class="hljs-keyword">let</span> t = <span class="hljs-number">0</span>;

<span class="hljs-keyword">let</span> lastScrollTop = <span class="hljs-number">0</span>;
<span class="hljs-keyword">let</span> renderPartialIndex = <span class="hljs-number">0</span>;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getCurrentIndexs</span>(<span class="hljs-params">nindex</span>) {
  <span class="hljs-keyword">let</span> currentIndexs = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; canvasMaxNum; i++) {
    <span class="hljs-keyword">if</span> (nindex + i &lt;= totalPages.<span class="hljs-property">value</span>) {
      currentIndexs.<span class="hljs-title function_">push</span>(nindex + i);
    }
  }
  <span class="hljs-keyword">return</span> currentIndexs;
}
<span class="hljs-comment">// æ–°å¢å•ä¸ªcanvas</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">addCanvas</span>(<span class="hljs-params">npageIndex</span>) {
  <span class="hljs-keyword">let</span> ncanvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"canvas"</span>);
  ncanvas.<span class="hljs-property">classList</span> = [<span class="hljs-string">"canvasshow"</span>];
  canvasContainer.<span class="hljs-property">value</span>.<span class="hljs-title function_">appendChild</span>(ncanvas);

  ncanvas.<span class="hljs-property">id</span> = <span class="hljs-string">"topCanvas"</span> + npageIndex;
  ncanvas.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">`<span class="hljs-subst">${pageHeight.value * (npageIndex - <span class="hljs-number">1</span>)}</span>px`</span>;
  <span class="hljs-title function_">renderPartialA</span>(pdfDoc, npageIndex, ncanvas);
}
<span class="hljs-comment">//ç›‘å¬æ»šåŠ¨</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleScroll</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-comment">// console.log(e,'eee');</span>
  
  <span class="hljs-keyword">const</span> canvasContainer0 = e.<span class="hljs-property">target</span>;
  <span class="hljs-keyword">const</span> scrollTop = canvasContainer0.<span class="hljs-property">scrollTop</span>;
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">"scroll"</span>, scrollTop);
  <span class="hljs-built_in">clearTimeout</span>(t);
  <span class="hljs-comment">// é˜²æŠ–</span>
  t = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (totalPages.<span class="hljs-property">value</span> &lt;= canvasMaxNum) {
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">let</span> page = scrollTop / pageHeight.<span class="hljs-property">value</span>;
    <span class="hljs-keyword">let</span> npage = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>, page)); <span class="hljs-comment">// å½“å‰è§†å›¾</span>

    <span class="hljs-keyword">if</span> (npage != currentPage) {
    <span class="hljs-comment">// è·å–è§†å›¾åº”è¯¥å±•ç¤ºçš„pageIndex</span>
      <span class="hljs-keyword">let</span> currentIndexs = <span class="hljs-title function_">getCurrentIndexs</span>(npage);
      currentIndexs.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (!allCanvasIndex.<span class="hljs-title function_">includes</span>(item)) {
          <span class="hljs-keyword">if</span> (item &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-title function_">addCanvas</span>(item);
          }
        }
      });
      <span class="hljs-comment">//ç§»é™¤æ“ä½œ</span>
      allCanvasIndex.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (!currentIndexs.<span class="hljs-title function_">includes</span>(item)) {
          <span class="hljs-keyword">let</span> canvas = canvasContainer.<span class="hljs-property">value</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">"#topCanvas"</span> + item);
          <span class="hljs-keyword">if</span> (canvas) {
            canvasContainer.<span class="hljs-property">value</span>.<span class="hljs-title function_">removeChild</span>(canvas);
          }
        }
      });
      allCanvasIndex = currentIndexs;
    }
    currentPage = npage;
  },<span class="hljs-number">50</span>);
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadPdf</span>(<span class="hljs-params">url, renderIndex1</span>) {
  <span class="hljs-comment">//   if (!url) return;</span>
  <span class="hljs-keyword">try</span> {
    loading.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;

    pdfDoc = <span class="hljs-keyword">await</span> pdfjsLib.<span class="hljs-title function_">getDocument</span>({ <span class="hljs-attr">url</span>: url }).<span class="hljs-property">promise</span>;
    <span class="hljs-keyword">if</span> (renderIndex1 !== renderIndex) {
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// this.pdfDoc=pdfDoc</span>
    totalPages.<span class="hljs-property">value</span> = pdfDoc.<span class="hljs-property">numPages</span>;
    <span class="hljs-comment">// å…ˆæ¸²æŸ“å…¨éƒ¨æˆ–è€…canvasMaxNum</span>
    allCanvas = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(totalPages.<span class="hljs-property">value</span>, canvasMaxNum))
      .<span class="hljs-title function_">fill</span>(<span class="hljs-literal">null</span>)
      .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
      <span class="hljs-comment">// ç»´æŠ¤allCanvasIndex</span>
        allCanvasIndex.<span class="hljs-title function_">push</span>(index + <span class="hljs-number">1</span>);
        <span class="hljs-keyword">let</span> ncanvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"canvas"</span>);
        ncanvas.<span class="hljs-property">id</span> = <span class="hljs-string">"topCanvas"</span> + (index + <span class="hljs-number">1</span>);
        ncanvas.<span class="hljs-property">classList</span> = [<span class="hljs-string">"canvasshow"</span>];
        <span class="hljs-keyword">return</span> ncanvas;
      });
    renderPartialIndex++;
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">renderPartial</span>(pdfDoc, <span class="hljs-literal">true</span>, renderPartialIndex);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"PDF åŠ è½½å¤±è´¥:"</span>, error);
    <span class="hljs-title function_">emit</span>(<span class="hljs-string">"error"</span>, error);
  } <span class="hljs-keyword">finally</span> {
    loading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
  }
}
<span class="hljs-keyword">let</span> scale0=<span class="hljs-number">1</span>
<span class="hljs-comment">// ç»˜åˆ¶å•ä¸ªpdfé¡µ</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">renderPartialA</span>(<span class="hljs-params">pdfDoc, pageIndex, canvas</span>) {
  <span class="hljs-keyword">if</span> (!pdfDoc) <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> pdfDoc.<span class="hljs-title function_">getPage</span>(pageIndex);

    <span class="hljs-keyword">const</span> viewport = page.<span class="hljs-title function_">getViewport</span>({ <span class="hljs-attr">scale</span>: scale0 });

    <span class="hljs-keyword">const</span> fullWidth = viewport.<span class="hljs-property">width</span>;
    <span class="hljs-keyword">const</span> fullHeight = viewport.<span class="hljs-property">height</span>;


           canvas.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = fullWidth
        canvas.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = fullHeight
           canvas.<span class="hljs-property">width</span> = fullWidth
        canvas.<span class="hljs-property">height</span> = fullHeight
    <span class="hljs-title function_">renderPartialArea</span>(page, clipParamsTop, canvas);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-comment">//  Cannot read private member #pagePromises from an object whose class did not declare it</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"æ¸²æŸ“å¤±è´¥:"</span>, error);
  }
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">getPageDimensions</span> = (<span class="hljs-params">ratio</span>) =&gt; {
  <span class="hljs-keyword">let</span> width
  <span class="hljs-keyword">let</span> height

  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">height</span> &amp;&amp; !props.<span class="hljs-property">width</span>) {
    height = props.<span class="hljs-property">height</span>
    width = height / ratio
  } <span class="hljs-keyword">else</span> {
    width = props.<span class="hljs-property">width</span> ?? canvasContainer.<span class="hljs-property">value</span>.<span class="hljs-property">clientWidth</span>
    height = width * ratio
  }

  <span class="hljs-keyword">return</span> [width, height]
}
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">renderPartial</span>(<span class="hljs-params">pdfDoc, init, renderPartialIndex1</span>) {
  <span class="hljs-keyword">if</span> (!pdfDoc) <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> ps = allCanvas.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> pdfDoc.<span class="hljs-title function_">getPage</span>(<span class="hljs-number">1</span> + index);
    });
    <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(ps).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">pages</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (renderPartialIndex1 !== renderPartialIndex) {
        <span class="hljs-keyword">return</span>; 
      }
      <span class="hljs-keyword">let</span> page = pages[<span class="hljs-number">0</span>];
      <span class="hljs-keyword">let</span> w = canvasContainer.<span class="hljs-property">value</span>.<span class="hljs-property">clientWidth</span>;
          <span class="hljs-keyword">const</span> viewWidth = page.<span class="hljs-property">view</span>[<span class="hljs-number">2</span>] - page.<span class="hljs-property">view</span>[<span class="hljs-number">0</span>]
           <span class="hljs-keyword">const</span> viewHeight = page.<span class="hljs-property">view</span>[<span class="hljs-number">3</span>] - page.<span class="hljs-property">view</span>[<span class="hljs-number">1</span>]
          <span class="hljs-keyword">let</span> isTransposed=<span class="hljs-literal">false</span>  
           <span class="hljs-keyword">const</span> pageWidth = isTransposed ? viewHeight : viewWidth
            <span class="hljs-keyword">const</span> [actualWidth, actualHeight] = <span class="hljs-title function_">getPageDimensions</span>(
          isTransposed ? viewWidth / viewHeight : viewHeight / viewWidth
        )
    <span class="hljs-keyword">let</span> scale=actualWidth  * <span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>/ pageWidth
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(scale,<span class="hljs-string">'scale'</span>);
      scale0=scale
      <span class="hljs-keyword">const</span> viewport = page.<span class="hljs-title function_">getViewport</span>({ <span class="hljs-attr">scale</span>: scale});
      <span class="hljs-keyword">const</span> fullWidth = viewport.<span class="hljs-property">width</span>;
      <span class="hljs-keyword">const</span> fullHeight = viewport.<span class="hljs-property">height</span>;
      pageHeight.<span class="hljs-property">value</span> = (fullHeight * (w - <span class="hljs-number">10</span>)) / fullWidth;
      totalHeight.<span class="hljs-property">value</span> = totalPages.<span class="hljs-property">value</span> * pageHeight.<span class="hljs-property">value</span>;
      <span class="hljs-keyword">if</span> (init) {
        allCanvas.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
          <span class="hljs-keyword">if</span> (index == <span class="hljs-number">0</span>) {
            item.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-number">0</span>}</span>px`</span>;
          } <span class="hljs-keyword">else</span> {
            item.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">`<span class="hljs-subst">${pageHeight.value * index}</span>px`</span>;
          }
          canvasContainer.<span class="hljs-property">value</span>.<span class="hljs-title function_">appendChild</span>(item);
        });
      }

      <span class="hljs-comment">// æ ¹æ®é¢„è®¾è®¡ç®—è£å‰ªå‚æ•°</span>
 

      pages.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">page, index</span>) =&gt;</span> {
          allCanvas[index].<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = fullWidth
        allCanvas[index].<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = fullHeight
          allCanvas[index].<span class="hljs-property">width</span> = fullWidth
        allCanvas[index].<span class="hljs-property">height</span> = fullHeight
        <span class="hljs-title function_">renderPartialArea</span>(page, clipParamsTop, allCanvas[index]);
      });
    });
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-comment">//  Cannot read private member #pagePromises from an object whose class did not declare it</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"æ¸²æŸ“å¤±è´¥:"</span>, error);
  }
}

<span class="hljs-keyword">const</span> scale = <span class="hljs-title function_">ref</span>(<span class="hljs-number">1</span>);
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">renderPartialArea</span>(<span class="hljs-params">page, clipParams, canvas</span>) {
  <span class="hljs-keyword">const</span> ctx = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">"2d"</span>);

  <span class="hljs-keyword">const</span> { clipX, clipY, clipWidth, clipHeight } = clipParams;
  
  <span class="hljs-keyword">const</span> partialViewport = page.<span class="hljs-title function_">getViewport</span>({ <span class="hljs-attr">scale</span>: scale0 }).<span class="hljs-title function_">clone</span>({
    <span class="hljs-attr">scale</span>: scale0,
  });

  <span class="hljs-comment">// åº”ç”¨è£å‰ªå’Œæ¸²æŸ“</span>
  ctx.<span class="hljs-title function_">save</span>();
  ctx.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, canvas.<span class="hljs-property">width</span>, canvas.<span class="hljs-property">height</span>);

  <span class="hljs-keyword">const</span> renderContext = {
    <span class="hljs-attr">canvasContext</span>: ctx,
    <span class="hljs-attr">viewport</span>: partialViewport,
  };

  <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">render</span>(renderContext).<span class="hljs-property">promise</span>;
  ctx.<span class="hljs-title function_">restore</span>();
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.canvasshow</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">pointer-events</span>: none;
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">10</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.partial-pdf-viewer</span> {
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;
  <span class="hljs-comment">/* border-radius: 8px; */</span>
  <span class="hljs-comment">/* padding: 16px; */</span>
}

<span class="hljs-selector-class">.control-panel</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-wrap</span>: wrap;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f5f5f5</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
}

<span class="hljs-selector-class">.control-group</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-class">.clip-controls</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: column;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-class">.clip-controls</span> &gt; <span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type=<span class="hljs-string">"number"</span>]</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">4px</span>;
}

<span class="hljs-selector-class">.canvas-container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">display</span>: inline-block;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#eee</span>;
  <span class="hljs-attribute">background</span>: white;
}
<span class="hljs-selector-class">.canvas-container</span>::-webkit-scrollbar {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">8px</span>;
}
<span class="hljs-selector-class">.canvas-container</span>::-webkit-scrollbar-thumb {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#c1c1c1</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
}
<span class="hljs-selector-class">.mark</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">z-index</span>: -<span class="hljs-number">10</span>;
  <span class="hljs-attribute">pointer-events</span>: none;
}
<span class="hljs-selector-tag">canvas</span> {
  <span class="hljs-attribute">display</span>: block;
}

<span class="hljs-selector-class">.loading</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>);
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.7</span>);
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
}

<span class="hljs-selector-class">.info-panel</span> {
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f0f0f0</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Swift åè®®ï¼ˆProtocolï¼‰æŒ‡å—ï¼ˆä¸‰ï¼‰ï¼šPrimary Associated Typeã€some/any ä¸æ³›å‹å¼åè®®å®æˆ˜]]></title>    <link>https://juejin.cn/post/7570271574348447753</link>    <guid>https://juejin.cn/post/7570271574348447753</guid>    <pubDate>2025-11-10T00:30:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570271574348447753" data-draft-id="7554198278955712538" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Swift åè®®ï¼ˆProtocolï¼‰æŒ‡å—ï¼ˆä¸‰ï¼‰ï¼šPrimary Associated Typeã€some/any ä¸æ³›å‹å¼åè®®å®æˆ˜"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2025-11-10T00:30:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Swift åè®®ï¼ˆProtocolï¼‰æŒ‡å—ï¼ˆä¸‰ï¼‰ï¼šPrimary Associated Typeã€some/any ä¸æ³›å‹å¼åè®®å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T00:30:22.000Z" title="Mon Nov 10 2025 00:30:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸ºä»€ä¹ˆ Swift 5.7 å†æ¬¡â€œé¢ è¦†â€åè®®</h2>
<p>åœ¨ Swift 5.7 ä¹‹å‰ï¼Œå¸¦å…³è”ç±»å‹çš„åè®®åªèƒ½å½“çº¦æŸ <code>&lt;T: Sequence&gt;</code>ï¼Œä¸èƒ½å½“ç±»å‹ <code>Sequence</code>ã€‚</p>
<p>è¿™å¯¼è‡´ä¸¤ä¸ªè€å¤§éš¾ï¼š</p>
<ol>
<li>å£°æ˜å˜é‡/å‚æ•°/è¿”å›å€¼æ—¶ï¼Œå¿…é¡»å†åŒ…ä¸€å±‚ç±»å‹æ“¦é™¤ï¼ˆ<code>AnySequence&lt;Int&gt;</code>ï¼‰ã€‚</li>
<li>æ³›å‹å‡½æ•°æ— æ³•â€œä¸€çœ¼çœ‹å‡ºâ€åºåˆ—é‡Œåˆ°åº•æ˜¯ä»€ä¹ˆå…ƒç´ ã€‚</li>
</ol>
<p>Swift 5.7 ä¸€æ¬¡æ€§ç»™å‡ºä¸‰æŠŠæ–°é’¥åŒ™ï¼š</p>

























<table><thead><tr><th>ç‰¹æ€§</th><th>å…³é”®è¯</th><th>è§£å†³ç—›ç‚¹</th></tr></thead><tbody><tr><td>ä¸»è¦å…³è”ç±»å‹</td><td><code>protocol Sequence&lt;Element&gt;</code></td><td>æŠŠæœ€å¸¸ç”¨çš„å…³è”ç±»å‹â€œæçº§â€åˆ°åè®®åä¸Š</td></tr><tr><td>ä¸é€æ˜å‚æ•°</td><td><code>some Sequence&lt;Int&gt;</code></td><td>ç›´æ¥å½“å‚æ•°ç±»å‹ï¼Œç¼–è¯‘æœŸç¡®å®šï¼Œé›¶è¿è¡Œæ—¶å¼€é”€</td></tr><tr><td>å­˜åœ¨æ€§ç±»å‹</td><td><code>any Sequence&lt;Int&gt;</code></td><td>çœŸÂ·å˜é‡ç±»å‹ï¼Œè¿è¡Œæ—¶ç›’å­ï¼Œè¯­æ³•ç»ˆäºå¯è¯»</td></tr></tbody></table>
<h2 data-id="heading-1">Primary Associated Typeï¼šæŠŠâ€œæ³›å‹å‚æ•°â€æ¬åˆ°åè®®å¤´ä¸Š</h2>
<ol>
<li>æ ‡å‡†åº“ç¤ºä¾‹</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// Swift 5.7 æ ‡å‡†åº“å®šä¹‰</span>
<span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Sequence</span>&lt;<span class="hljs-title class_">Element</span>&gt; {
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Element</span>
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Iterator</span>: <span class="hljs-type">IteratorProtocol</span> <span class="hljs-keyword">where</span> <span class="hljs-type">Iterator</span>.<span class="hljs-type">Element</span> <span class="hljs-operator">==</span> <span class="hljs-type">Element</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">makeIterator</span>() -&gt; <span class="hljs-type">Iterator</span>
}
</code></pre>
<p><code>Element</code> è¢«å†™åˆ°åè®®ååé¢ï¼Œæˆä¸ºä¸»è¦å…³è”ç±»å‹ã€‚</p>
<p>äºæ˜¯æˆ‘ä»¬å¯ä»¥åƒæ³›å‹ç»“æ„ä½“ä¸€æ ·ï¼Œç›´æ¥å†™ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">func</span> <span class="hljs-title function_">sum</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">numbers</span>: <span class="hljs-keyword">some</span> <span class="hljs-type">Sequence</span>&lt;<span class="hljs-type">Int</span>&gt;) -&gt; <span class="hljs-type">Int</span> {   <span class="hljs-comment">// â‘  å‚æ•°ç±»å‹</span>
    numbers.reduce(<span class="hljs-number">0</span>, <span class="hljs-operator">+</span>)
}

<span class="hljs-keyword">let</span> total <span class="hljs-operator">=</span> sum([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>] <span class="hljs-operator">+</span> [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>])            <span class="hljs-comment">// â‘¡ æ•°ç»„æ‹¼æ¥ä¹Ÿé€‚ç”¨</span>
</code></pre>
<ol start="2">
<li>ä¸ºè‡ªå·±åè®®æ·»åŠ â€œä¸»å…³è”ç±»å‹â€</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Feed</span>&lt;<span class="hljs-title class_">Element</span>&gt; {          <span class="hljs-comment">// â‘  æŠŠæœ€å¸¸ç”¨çš„å…³è”ç±»å‹æå‡ºæ¥</span>
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Element</span>
    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">next</span>() -&gt; <span class="hljs-type">Element</span>?
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">IteratorFeed</span>: <span class="hljs-title class_">Feed</span> {
    <span class="hljs-keyword">var</span> a <span class="hljs-operator">=</span> <span class="hljs-number">0</span>, b <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">next</span>() -&gt; <span class="hljs-type">Int</span>? {
        <span class="hljs-keyword">let</span> next <span class="hljs-operator">=</span> a
        a <span class="hljs-operator">=</span> b
        b <span class="hljs-operator">=</span> next <span class="hljs-operator">+</span> a
        <span class="hljs-keyword">return</span> next
    }
}

<span class="hljs-comment">// â‘¡ ç«‹åˆ»äº«å— some/any è¯­æ³•</span>
<span class="hljs-keyword">func</span> <span class="hljs-title function_">makeIntFeed</span>() -&gt; <span class="hljs-keyword">some</span> <span class="hljs-type">Feed</span>&lt;<span class="hljs-type">Int</span>&gt; {
    <span class="hljs-type">IteratorFeed</span>()
}

<span class="hljs-keyword">var</span> feeds: [<span class="hljs-keyword">any</span> <span class="hljs-type">Feed</span>&lt;<span class="hljs-type">Int</span>&gt;] <span class="hljs-operator">=</span> []   <span class="hljs-comment">// â‘¢ æ•°ç»„é‡Œæ”¾ä¸åŒå®ç°ï¼Œæ— éœ€å†åŒ… AnyFeed</span>
</code></pre>
<p>è§„åˆ™</p>
<ul>
<li>åªèƒ½æŠŠä¸€ä¸ªæˆ–å¤šä¸ª <code>associatedtype</code> å£°æ˜ä¸ºâ€œä¸»è¦â€ï¼Œä¸å¼ºåˆ¶å…¨éƒ¨ã€‚</li>
<li>ä¸»è¦å…³è”ç±»å‹é¡ºåºä¸å½±å“ä½¿ç”¨ï¼Œä½†å»ºè®®æŒ‰â€œå¸¸ç”¨åº¦â€æ’åºã€‚</li>
<li>ä¸€æ—¦å£°æ˜ï¼Œåè®®å°±è·å¾—â€œæ³›å‹å½¢å‚â€èµ„æ ¼ï¼Œå¯ç›´æ¥å†™ <code>Feed&lt;Int&gt;</code>ã€‚</li>
</ul>
<h2 data-id="heading-2">some vs. anyï¼šä¸€å¥è¯åŒºåˆ†</h2>



































<table><thead><tr><th>ç»´åº¦</th><th><code>some P</code></th><th><code>any P</code></th></tr></thead><tbody><tr><td>è¯­ä¹‰</td><td>ç¼–è¯‘æœŸç¡®å®šçš„<strong>æŸä¸ª</strong>å…·ä½“ç±»å‹</td><td>è¿è¡Œæ—¶å­˜åœ¨çš„<strong>ä»»ä½•</strong>å…·ä½“ç±»å‹</td></tr><tr><td>å†…å­˜å¸ƒå±€</td><td>æ— é—´æ¥å¯»å€ï¼Œå†…è”å­˜å‚¨</td><td>å­˜åœ¨æ€§å®¹å™¨ï¼ˆBoxï¼‰ï¼Œé€šè¿‡æŒ‡é’ˆå¼•ç”¨</td></tr><tr><td>ä¸»è¦ç”¨æ³•</td><td>è¿”å›å€¼ã€æ³›å‹çº¦æŸ</td><td>å˜é‡ã€é›†åˆå…ƒç´ ã€å‡½æ•°å‚æ•°</td></tr><tr><td>æ€§èƒ½</td><td>é›¶é¢å¤–å¼€é”€</td><td>è½»å¾®è¿è¡Œæ—¶å¼€é”€ï¼ˆBoxç®¡ç†ï¼‰</td></tr><tr><td>ä½¿ç”¨é™åˆ¶</td><td>ä¸èƒ½ç”¨äº<code>var</code>/é›†åˆç±»å‹å£°æ˜</td><td>æ— æ˜¾å¼é™åˆ¶</td></tr></tbody></table>
<p>ç¤ºä¾‹å¯¹æ¯”</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Feed</span>&lt;<span class="hljs-title class_">Element</span>&gt; {          <span class="hljs-comment">// â‘  æŠŠæœ€å¸¸ç”¨çš„å…³è”ç±»å‹æå‡ºæ¥</span>
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Element</span>
    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">next</span>() -&gt; <span class="hljs-type">Element</span>?
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">IteratorFeed</span>&lt;<span class="hljs-title class_">Iterator</span>: <span class="hljs-title class_">IteratorProtocol</span>&gt;: <span class="hljs-title class_">Feed</span>  {
    <span class="hljs-keyword">var</span> iterator: <span class="hljs-type">Iterator</span>
    <span class="hljs-keyword">init</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">iterator</span>: <span class="hljs-type">Iterator</span>) {
        <span class="hljs-keyword">self</span>.iterator <span class="hljs-operator">=</span> iterator
    }
    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">next</span>() -&gt; <span class="hljs-type">Iterator</span>.<span class="hljs-type">Element</span>? {
        iterator.next()
    }
}

<span class="hljs-comment">// 1. è¿”å›å€¼ï¼šç¼–è¯‘æœŸå°±çŸ¥é“çœŸå®ç±»å‹</span>
<span class="hljs-keyword">func</span> <span class="hljs-title function_">uniqueElements</span>&lt;<span class="hljs-type">S</span>: <span class="hljs-type">Sequence</span>&gt;(<span class="hljs-keyword">_</span> <span class="hljs-params">seq</span>: <span class="hljs-type">S</span>) -&gt; <span class="hljs-keyword">some</span> <span class="hljs-type">Sequence</span>&lt;<span class="hljs-type">S</span>.<span class="hljs-type">Element</span>&gt;
<span class="hljs-keyword">where</span> <span class="hljs-type">S</span>.<span class="hljs-type">Element</span>: <span class="hljs-type">Hashable</span> &amp; <span class="hljs-type">Comparable</span> {
    <span class="hljs-type">Set</span>(seq).sorted()
}

<span class="hljs-comment">// 2. æ•°ç»„ï¼šè¿è¡ŒæœŸæ‰çŸ¥é“çœŸå®ç±»å‹</span>
<span class="hljs-keyword">var</span> parsers: [<span class="hljs-keyword">any</span> <span class="hljs-type">Feed</span>&lt;<span class="hljs-type">Int</span>&gt;] <span class="hljs-operator">=</span> [
    <span class="hljs-type">IteratorFeed</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>].makeIterator()),
    <span class="hljs-type">IteratorFeed</span>(<span class="hljs-built_in">stride</span>(from: <span class="hljs-number">0</span>, to: <span class="hljs-number">10</span>, by: <span class="hljs-number">2</span>).makeIterator())
]
</code></pre>
<h2 data-id="heading-3">å®æˆ˜ï¼šä¸€è¡Œä»£ç å†™â€œæ³›å‹â€ SwiftUI View</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> Charts

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">ChartView</span>&lt;<span class="hljs-title class_">Data</span>: <span class="hljs-title class_">RandomAccessCollection</span>&gt;: <span class="hljs-title class_">View</span> <span class="hljs-title class_">where</span> <span class="hljs-title class_">Data</span>.<span class="hljs-title class_">Element</span> == <span class="hljs-title class_">Double</span> {
    <span class="hljs-keyword">let</span> data: <span class="hljs-type">Data</span>
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-comment">// è€å†™æ³•ï¼šè°ƒç”¨æ–¹å¿…é¡»å†™å†—é•¿æ³›å‹å‚æ•°</span>
    }
}

<span class="hljs-comment">// âœ… æ–°å†™æ³•ï¼šç›´æ¥ä¸é€æ˜è¿”å›ï¼Œè°ƒç”¨æ–¹æ— æ„ŸçŸ¥</span>
<span class="hljs-keyword">func</span> <span class="hljs-title function_">makeChart</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">data</span>: <span class="hljs-keyword">some</span> <span class="hljs-type">RandomAccessCollection</span>&lt;<span class="hljs-type">Double</span>&gt;) -&gt; <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
    
    <span class="hljs-type">Chart</span> {
        <span class="hljs-type">ForEach</span>(data.enumerated(), id: \.offset) { idx,value <span class="hljs-keyword">in</span>
            <span class="hljs-type">LineMark</span>(x: .value(<span class="hljs-string">"x"</span>, idx), y: .value(<span class="hljs-string">"y"</span>, value))
        }
    }
}
</code></pre>
<h2 data-id="heading-4">è¿ç§»æ—§ä»£ç ï¼šæŠŠ AnySequence æ¢æˆ any Sequence</h2>





















<table><thead><tr><th>æ—§ä»£ç </th><th>æ–°ä»£ç </th></tr></thead><tbody><tr><td><code>AnySequence&lt;Int&gt;</code></td><td><code>any Sequence&lt;Int&gt;</code></td></tr><tr><td><code>AnyPublisher&lt;Int, Never&gt;</code></td><td><code>any Publisher&lt;Int, Never&gt;</code></td></tr><tr><td><code>AnyView</code></td><td><code>any View</code>ï¼ˆiOS 17+ å¯ç”¨ï¼Œä»éœ€æƒè¡¡æ€§èƒ½ï¼‰</td></tr></tbody></table>
<p>æ­¥éª¤</p>
<ol>
<li>åœ¨åè®®åååŠ  <code>&lt;Element&gt;</code>ã€‚</li>
<li>æŠŠ <code>eraseToAnyPublisher()</code> / <code>AnySequence(...)</code> æ”¹æˆ <code>any Sequence&lt;Int&gt;</code>ã€‚</li>
<li>è‹¥è¿”å›å€¼æ— éœ€è¿è¡Œæ—¶å¤šæ€ï¼Œç›´æ¥ç”¨ <code>some Sequence&lt;Int&gt;</code> è·å¾—é›¶å¼€é”€ã€‚</li>
</ol>
<h2 data-id="heading-5">æ€§èƒ½ä¸äºŒè¿›åˆ¶å¤§å°å°è´´å£«</h2>
<ul>
<li><code>some P&lt;T&gt;</code> å®Œå…¨é™æ€æ´¾å‘ï¼Œé›¶é¢å¤–å†…å­˜ã€‚</li>
<li><code>any P&lt;T&gt;</code> å¼•å…¥å­˜åœ¨æ€§å®¹å™¨ï¼Œ16 å­—èŠ‚ inline + å¤–æŒ‚å †ï¼ˆè‹¥å€¼è¿‡å¤§ï¼‰ã€‚</li>
<li>æ»¥ç”¨ <code>any</code> ä¼šè®©äºŒè¿›åˆ¶å‡ºç°å¤§é‡â€œåè®®è§è¯è¡¨â€ï¼Œrelease æ¨¡å¼ä¸‹ç¼–è¯‘å™¨ä¼šä¼˜åŒ–ï¼Œä½†debug å¢é‡ç¼–è¯‘å¯èƒ½å˜æ…¢ã€‚</li>
<li>å¯¹ SwiftUI <code>body</code> è¿™ç§è¶…é«˜é¢‘è°ƒç”¨ï¼Œä¼˜å…ˆ <code>some View</code>ï¼›åªåœ¨éœ€è¦è¿è¡Œæ—¶å¼‚æ„æ•°ç»„æ—¶æ‰ç”¨ <code>any View</code>ã€‚</li>
</ul>
<h2 data-id="heading-6">æ€»ç»“</h2>

























<table><thead><tr><th>å…³é”®è¯</th><th>é€‚ç”¨åœºæ™¯</th><th>è®°å¿†å£è¯€</th></tr></thead><tbody><tr><td><code>protocol P&lt;Element&gt;</code></td><td>ç»™è‡ªå·±åè®®â€œæçº§â€</td><td>â€œåè®®ä¹Ÿèƒ½å¸¦æ³›å‚â€</td></tr><tr><td><code>some P&lt;T&gt;</code></td><td>è¿”å›å€¼ã€æ³›å‹çº¦æŸ</td><td>â€œç¼–è¯‘æœŸå°±ç¡®å®šâ€</td></tr><tr><td><code>any P&lt;T&gt;</code></td><td>å˜é‡ã€æ•°ç»„ã€å­—å…¸</td><td>â€œè¿è¡ŒæœŸå¤šæ€ç›’å­â€</td></tr></tbody></table>
<p>ä¸€å¥è¯æ€»ç»“</p>
<p>Swift 5.7 è®©åè®®ç¬¬ä¸€æ¬¡çœŸæ­£æ‹¥æœ‰äº†â€œæ³›å‹å½¢å‚â€èƒ½åŠ›ï¼š</p>
<ul>
<li>å†™åº“çš„äººï¼šç»™åè®®åŠ  <code>&lt;Element&gt;</code>ï¼Œè°ƒç”¨æ–¹ç«‹åˆ»äº«å— <code>some/any</code> è¯­æ³•ç³–ã€‚</li>
<li>å†™ä¸šåŠ¡çš„äººï¼šç”¨ <code>some Sequence&lt;Int&gt;</code> æ›¿ä»£å†—é•¿æ³›å‹çº¦æŸï¼Œç”¨ <code>any Sequence&lt;Int&gt;</code> æ›¿ä»£ <code>AnySequence</code>ï¼Œä»£ç çŸ­ä¸€åŠã€å¯è¯»æ€§ç¿»å€ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Swift åè®®ï¼ˆProtocolï¼‰æŒ‡å—ï¼ˆäºŒï¼‰ï¼šå…³è”ç±»å‹ã€Self çº¦æŸä¸æ³›å‹é€’å½’ï¼Œä¸€æ¬¡å½»åº•ææ‡‚]]></title>    <link>https://juejin.cn/post/7570271574348333065</link>    <guid>https://juejin.cn/post/7570271574348333065</guid>    <pubDate>2025-11-10T00:07:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570271574348333065" data-draft-id="7554225547145461798" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Swift åè®®ï¼ˆProtocolï¼‰æŒ‡å—ï¼ˆäºŒï¼‰ï¼šå…³è”ç±»å‹ã€Self çº¦æŸä¸æ³›å‹é€’å½’ï¼Œä¸€æ¬¡å½»åº•ææ‡‚"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2025-11-10T00:07:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Swift åè®®ï¼ˆProtocolï¼‰æŒ‡å—ï¼ˆäºŒï¼‰ï¼šå…³è”ç±»å‹ã€Self çº¦æŸä¸æ³›å‹é€’å½’ï¼Œä¸€æ¬¡å½»åº•ææ‡‚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T00:07:19.000Z" title="Mon Nov 10 2025 00:07:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸ºä»€ä¹ˆâ€œå…³è”ç±»å‹â€æ˜¯åè®®çš„åˆ†æ°´å²­</h2>
<p>åœ¨ä¸Šé¢ï¼Œæˆ‘ä»¬æ¥è§¦çš„åè®®éƒ½å±äºâ€œæ— å…³è”ç±»å‹åè®®â€â€”â€”ç¼–è¯‘æœŸæ— éœ€çŸ¥é“åè®®é‡Œçš„æ³›å‹å ä½ç¬¦å…·ä½“æ˜¯ä»€ä¹ˆã€‚</p>
<p>ä¸€æ—¦åè®®é‡Œå‡ºç°äº† <code>associatedtype</code>ï¼Œå®ƒå°±ä¸å†æ˜¯æ™®é€šç±»å‹ï¼Œè€Œå˜æˆäº†åè®®æ³›å‹ï¼šåªèƒ½å½“ä½œçº¦æŸä½¿ç”¨ï¼Œä¸èƒ½å½“ä½œå˜é‡/å‚æ•°/è¿”å›å€¼ç±»å‹ç›´æ¥å‡ºç°ã€‚</p>
<h2 data-id="heading-1">å…³è”ç±»å‹åŸºç¡€è¯­æ³•</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Container</span> {
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Item</span>                     <span class="hljs-comment">// â‘  å£°æ˜ä¸€ä¸ªå ä½ç¬¦</span>
    <span class="hljs-keyword">var</span> count: <span class="hljs-type">Int</span> { <span class="hljs-keyword">get</span> }
    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">append</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">item</span>: <span class="hljs-type">Item</span>)      <span class="hljs-comment">// â‘¡ åœ¨æ–¹æ³•é‡Œä½¿ç”¨å ä½ç¬¦</span>
    <span class="hljs-keyword">subscript</span>(<span class="hljs-params">index</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Item</span> { <span class="hljs-keyword">get</span> }   <span class="hljs-comment">// â‘¢ åœ¨ä¸‹æ ‡é‡Œä½¿ç”¨å ä½ç¬¦</span>
}
</code></pre>
<p>å®ç°è€…å†³å®šçœŸå®ç±»å‹</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">IntStack</span>: <span class="hljs-title class_">Container</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> items <span class="hljs-operator">=</span> [<span class="hljs-type">Int</span>]()
    <span class="hljs-keyword">typealias</span> <span class="hljs-type">Item</span> <span class="hljs-operator">=</span> <span class="hljs-type">Int</span>      <span class="hljs-comment">// å¯çœç•¥ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨æ¨æ–­</span>
    
    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">append</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">item</span>: <span class="hljs-type">Int</span>) { items.append(item) }
    <span class="hljs-keyword">subscript</span>(<span class="hljs-params">index</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span> { items[index] }
    <span class="hljs-keyword">var</span> count: <span class="hljs-type">Int</span> { items.count }
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">StringQueue</span>: <span class="hljs-title class_">Container</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> items <span class="hljs-operator">=</span> [<span class="hljs-type">String</span>]()
    <span class="hljs-comment">// ä¸å†™ typealiasï¼Œç¼–è¯‘å™¨ä¹Ÿèƒ½ä» append å‚æ•°æ¨æ–­ Item == String</span>
    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">append</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">item</span>: <span class="hljs-type">String</span>) { items.append(item) }
    <span class="hljs-keyword">subscript</span>(<span class="hljs-params">index</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">String</span> { items[index] }
    <span class="hljs-keyword">var</span> count: <span class="hljs-type">Int</span> { items.count }
}
</code></pre>
<h2 data-id="heading-2">å¸¦çº¦æŸçš„å…³è”ç±»å‹</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">//  ç»§æ‰¿Containerï¼Œåªæ¥æ”¶Itemæ˜¯Numericçš„ç±»å‹</span>
<span class="hljs-keyword">protocol</span> <span class="hljs-title class_">SummableContainer</span>: <span class="hljs-title class_">Container</span> <span class="hljs-title class_">where</span> <span class="hljs-title class_">Item</span>: <span class="hljs-title class_">Numeric</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">total</span>() -&gt; <span class="hljs-type">Item</span>
}

<span class="hljs-keyword">extension</span> <span class="hljs-title class_">SummableContainer</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">total</span>() -&gt; <span class="hljs-type">Item</span> {
        <span class="hljs-keyword">var</span> sum: <span class="hljs-type">Item</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span><span class="hljs-operator">..&lt;</span>count { sum <span class="hljs-operator">=</span> sum <span class="hljs-operator">+</span> <span class="hljs-keyword">self</span>[i] }
        <span class="hljs-keyword">return</span> sum
    }
}
</code></pre>
<p>ä½¿ç”¨</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">extension</span> <span class="hljs-title class_">IntStack</span>: <span class="hljs-title class_">SummableContainer</span> {}   <span class="hljs-comment">// Int ç¬¦åˆ Numericï¼Œè‡ªåŠ¨è·å¾— total()</span>
<span class="hljs-keyword">var</span> s <span class="hljs-operator">=</span> <span class="hljs-type">IntStack</span>()
s.append(<span class="hljs-number">1</span>)
s.append(<span class="hljs-number">2</span>)
<span class="hljs-built_in">print</span>(s.total()) <span class="hljs-comment">// 3</span>
</code></pre>
<h2 data-id="heading-3">Self å‡ºç°åœ¨åè®®é‡Œï¼šè¿”å›è‡ªèº«ç±»å‹çš„éœ€æ±‚</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Copyable</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">copy</span>() -&gt; <span class="hljs-keyword">Self</span>        <span class="hljs-comment">// è¦æ±‚è¿”å›â€œçœŸå®ç±»å‹â€æœ¬èº«</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span>: <span class="hljs-title class_">Copyable</span> {
    <span class="hljs-keyword">var</span> name <span class="hljs-operator">=</span> <span class="hljs-string">""</span>
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">init</span>() {}         <span class="hljs-comment">// å¿…é¡»ä¿è¯å­ç±»ä¹Ÿèƒ½åˆå§‹åŒ–</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">copy</span>() -&gt; <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">let</span> new <span class="hljs-operator">=</span> <span class="hljs-keyword">Self</span>()       <span class="hljs-comment">// Self åœ¨è¿è¡ŒæœŸä»£è¡¨çœŸå®åŠ¨æ€ç±»å‹</span>
        new.name <span class="hljs-operator">=</span> name
        <span class="hljs-keyword">return</span> new
    }
}

<span class="hljs-keyword">let</span> husky <span class="hljs-operator">=</span> <span class="hljs-type">Dog</span>()
husky.name <span class="hljs-operator">=</span> <span class="hljs-string">"Husky"</span>
<span class="hljs-keyword">let</span> another <span class="hljs-operator">=</span> husky.copy()     <span class="hljs-comment">// ç±»å‹æ¨æ–­ä¸º Dog</span>
</code></pre>
<p>æ³¨æ„</p>
<ul>
<li><code>Self</code> åªèƒ½å‡ºç°åœ¨â€œåè®®å†…â€æˆ–â€œåè®®æ‰©å±•â€ä¸­ï¼Œä¸èƒ½å‡ºç°åœ¨æ™®é€šç»“æ„ä½“/ç±»çš„æ–¹æ³•ç­¾åé‡Œã€‚</li>
<li>å¦‚æœåè®®ç”¨ <code>associatedtype</code>ï¼Œ<code>Self</code> å°±æ˜¯è¯¥ç±»å‹çš„åˆ«åã€‚</li>
</ul>
<h2 data-id="heading-4">æ³›å‹é€’å½’çº¦æŸï¼šwhere å­å¥çš„é­”æ³•</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Node</span> {
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Value</span>
    <span class="hljs-keyword">var</span> value: <span class="hljs-type">Value</span> { <span class="hljs-keyword">get</span> }
    <span class="hljs-keyword">var</span> children: [<span class="hljs-keyword">Self</span>] { <span class="hljs-keyword">get</span> }        <span class="hljs-comment">// é€’å½’å¼•ç”¨è‡ªèº«</span>
}

<span class="hljs-keyword">extension</span> <span class="hljs-title class_">Node</span> <span class="hljs-title class_">where</span> <span class="hljs-title class_">Value</span>: <span class="hljs-title class_">Numeric</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">sumTree</span>() -&gt; <span class="hljs-type">Value</span> {
        value <span class="hljs-operator">+</span> children.reduce(<span class="hljs-number">0</span>) { <span class="hljs-variable">$0</span> <span class="hljs-operator">+</span> <span class="hljs-variable">$1</span>.sumTree() }
    }
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">IntNode</span>: <span class="hljs-title class_">Node</span> {
    <span class="hljs-keyword">let</span> value: <span class="hljs-type">Int</span>
    <span class="hljs-keyword">let</span> children: [<span class="hljs-type">IntNode</span>]
}

<span class="hljs-keyword">let</span> tree <span class="hljs-operator">=</span> <span class="hljs-type">IntNode</span>(value: <span class="hljs-number">10</span>, children: [
    <span class="hljs-type">IntNode</span>(value: <span class="hljs-number">3</span>, children: []),
    <span class="hljs-type">IntNode</span>(value: <span class="hljs-number">5</span>, children: [
        <span class="hljs-type">IntNode</span>(value: <span class="hljs-number">1</span>, children: [])
    ])
])
<span class="hljs-built_in">print</span>(tree.sumTree())  <span class="hljs-comment">// 10+3+5+1 = 19</span>
</code></pre>
<h2 data-id="heading-5">çœŸå®æ¡ˆä¾‹ï¼šSwift æ ‡å‡†åº“é‡Œçš„ Sequence</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Sequence</span> {
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Element</span>
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Iterator</span>: <span class="hljs-type">IteratorProtocol</span> <span class="hljs-keyword">where</span> <span class="hljs-type">Iterator</span>.<span class="hljs-type">Element</span> <span class="hljs-operator">==</span> <span class="hljs-type">Element</span>
    
    __consuming <span class="hljs-keyword">func</span> <span class="hljs-title function_">makeIterator</span>() -&gt; <span class="hljs-type">Iterator</span>
}

<span class="hljs-keyword">protocol</span> <span class="hljs-title class_">IteratorProtocol</span> {
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Element</span>
    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">next</span>() -&gt; <span class="hljs-type">Element</span>?
}
</code></pre>
<p>è‡ªå®šä¹‰åºåˆ—</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Fibonacci</span>: <span class="hljs-title class_">Sequence</span> {
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Iterator</span>: <span class="hljs-title class_">IteratorProtocol</span> {
        <span class="hljs-keyword">var</span> a <span class="hljs-operator">=</span> <span class="hljs-number">0</span>, b <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
        <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">next</span>() -&gt; <span class="hljs-type">Int</span>? {
            <span class="hljs-keyword">let</span> next <span class="hljs-operator">=</span> a
            a <span class="hljs-operator">=</span> b
            b <span class="hljs-operator">=</span> next <span class="hljs-operator">+</span> a
            <span class="hljs-keyword">return</span> next
        }
    }
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">makeIterator</span>() -&gt; <span class="hljs-type">Iterator</span> { <span class="hljs-type">Iterator</span>() }
}

<span class="hljs-keyword">for</span> (i, n) <span class="hljs-keyword">in</span> <span class="hljs-type">Fibonacci</span>().enumerated().prefix(<span class="hljs-number">10</span>) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"F<span class="hljs-subst">\(i)</span> = <span class="hljs-subst">\(n)</span>"</span>)
}
</code></pre>
<h2 data-id="heading-6">ç±»å‹æ“¦é™¤ï¼ˆType Erasureï¼‰ï¼šè§£å†³â€œå…³è”ç±»å‹åè®®ä¸èƒ½å½“è¿”å›ç±»å‹â€</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Feed</span> {
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Item</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">next</span>() -&gt; <span class="hljs-type">Item</span>?
}

<span class="hljs-comment">// 1. åŒ…è£…ç±»æ“¦é™¤å…·ä½“ Item ç±»å‹</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">AnyFeed</span>&lt;<span class="hljs-title class_">Item</span>&gt;: <span class="hljs-title class_">Feed</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> _next: () -&gt; <span class="hljs-type">Item</span>?
    <span class="hljs-keyword">init</span>&lt;<span class="hljs-type">F</span>: <span class="hljs-type">Feed</span>&gt;(<span class="hljs-keyword">_</span> <span class="hljs-params">real</span>: <span class="hljs-type">F</span>) <span class="hljs-keyword">where</span> <span class="hljs-type">F</span>.<span class="hljs-type">Item</span> <span class="hljs-operator">==</span> <span class="hljs-type">Item</span> {
        _next <span class="hljs-operator">=</span> { real.next() }
    }
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">next</span>() -&gt; <span class="hljs-type">Item</span>? { _next() }
}

<span class="hljs-comment">// 2. ä½¿ç”¨å¤„ä¸å†å‡ºç°å…³è”ç±»å‹</span>
<span class="hljs-keyword">func</span> <span class="hljs-title function_">makeIntFeed</span>() -&gt; <span class="hljs-type">AnyFeed</span>&lt;<span class="hljs-type">Int</span>&gt; {
    <span class="hljs-keyword">let</span> fib <span class="hljs-operator">=</span> <span class="hljs-type">Fibonacci</span>().makeIterator()
    <span class="hljs-keyword">return</span> <span class="hljs-type">AnyFeed</span>(<span class="hljs-type">IteratorFeed</span>(fib))
}
</code></pre>
<p>æ ‡å‡†åº“å·²æœ‰</p>
<ul>
<li><code>AnySequence&lt;Element&gt;</code></li>
<li><code>AnyPublisher&lt;Output, Failure&gt;</code> (Combine)</li>
<li><code>AnyView</code> (SwiftUI)</li>
</ul>
<h2 data-id="heading-7">å®æˆ˜æŠ€å·§æ¸…å•</h2>





























<table><thead><tr><th>æŠ€å·§åœºæ™¯</th><th>å…·ä½“å®ç°æŠ€å·§</th></tr></thead><tbody><tr><td>æƒ³è¿”å›â€œæŸä¸ªéµå®ˆåè®®çš„å¯¹è±¡â€</td><td>ç”¨æ³›å‹ <code>&lt;T: Protocol&gt;</code> æˆ– <code>some Protocol</code></td></tr><tr><td>åè®®ä¸­å®šä¹‰ <code>associatedtype</code></td><td>ä»…èƒ½ä½œä¸ºç±»å‹çº¦æŸï¼Œæ— æ³•ç›´æ¥å½“ä½œå˜é‡ç±»å‹ï¼›éœ€é€šè¿‡â€œç±»å‹æ“¦é™¤â€åæš´éœ²</td></tr><tr><td>è¦æ±‚å­ç±»å¿…é¡»å®ç°æŒ‡å®šåˆå§‹åŒ–å™¨</td><td>åè®®ä¸­å£°æ˜ <code>init()</code>ï¼Œç±»ä¾§é…åˆå†™ <code>required init()</code></td></tr><tr><td>è®©æ‰©å±•æ–¹æ³•ä»…å¯¹æ»¡è¶³éƒ¨åˆ†çº¦æŸçš„ç±»å‹å¯è§</td><td>ä½¿ç”¨ <code>where</code> å­å¥ï¼Œä¾‹å¦‚ <code>extension Container where Item: Comparable</code></td></tr><tr><td>ç¦æ­¢ç±»å‹éšå¼æ ‡è®°ä¸º <code>Sendable</code></td><td>å£°æ˜ <code>struct File: ~Sendable</code>ï¼Œæˆ–é€šè¿‡ <code>@available(*, unavailable) extension File: Sendable</code> ç¦ç”¨</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€OpenGLå­¦ä¹ æ»¤é•œç›¸æœºã€- Day8: å¤šé‡çº¹ç†ä¸æ··åˆ]]></title>    <link>https://juejin.cn/post/7570534000718495807</link>    <guid>https://juejin.cn/post/7570534000718495807</guid>    <pubDate>2025-11-10T08:19:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570534000718495807" data-draft-id="7570534000718479423" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€OpenGLå­¦ä¹ æ»¤é•œç›¸æœºã€- Day8: å¤šé‡çº¹ç†ä¸æ··åˆ"/> <meta itemprop="keywords" content="Android,OpenGL"/> <meta itemprop="datePublished" content="2025-11-10T08:19:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸‹ä½å­"/> <meta itemprop="url" content="https://juejin.cn/user/2313028193761389"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€OpenGLå­¦ä¹ æ»¤é•œç›¸æœºã€- Day8: å¤šé‡çº¹ç†ä¸æ··åˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2313028193761389/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸‹ä½å­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T08:19:05.000Z" title="Mon Nov 10 2025 08:19:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><a href="https://juejin.cn/post/7567889397497528383" target="_blank" title="https://juejin.cn/post/7567889397497528383">å‰è¨€: ã€OpenGLå­¦ä¹ ã€ ä»é›¶æ‰“é€  Android æ»¤é•œç›¸æœº</a></p>
<p><a href="https://juejin.cn/post/7569871848793948179" target="_blank" title="https://juejin.cn/post/7569871848793948179">ä¸Šä¸€ç¯‡:ã€OpenGLå­¦ä¹ æ»¤é•œç›¸æœºã€- Day7: FBOï¼ˆå¸§ç¼“å†²å¯¹è±¡ï¼‰</a></p>
<p>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaweizi%2FOpenGLTest" target="_blank" title="https://github.com/xiaweizi/OpenGLTest" ref="nofollow noopener noreferrer">OpenGLTest</a></p>
</blockquote>
<h2 data-id="heading-0">ğŸ“š ä»Šæ—¥ç›®æ ‡</h2>
<ul>
<li>ç†è§£å¤šçº¹ç†å•å…ƒçš„æ¦‚å¿µå’Œä½¿ç”¨</li>
<li>æŒæ¡çº¹ç†æ··åˆæ¨¡å¼ï¼ˆBlend Modesï¼‰</li>
<li>å­¦ä¹  Alpha é€šé“å¤„ç†å’Œé€æ˜åº¦</li>
<li>å®ç°å›¾ç‰‡æ°´å°ã€çº¹ç†å åŠ ç­‰å®ç”¨æ•ˆæœ</li>
</ul>
<p><strong>è¿è¡Œæ•ˆæœï¼š</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d0fe85223524f6d85e34d84847cfa31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiL5L2N5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367544&amp;x-signature=NEY23PHhtHVaLDDj%2FvZ28hR8j1M%3D" alt="Day8.gif" loading="lazy"/></p>
<h2 data-id="heading-1">ğŸ¯ å­¦ä¹ å†…å®¹</h2>
<h3 data-id="heading-2">1. å¤šçº¹ç†å•å…ƒç®€ä»‹</h3>
<p>åœ¨ OpenGL ES ä¸­ï¼Œ<strong>çº¹ç†å•å…ƒï¼ˆTexture Unitï¼‰</strong> å…è®¸æˆ‘ä»¬åœ¨ä¸€æ¬¡ç»˜åˆ¶è°ƒç”¨ä¸­ä½¿ç”¨å¤šä¸ªçº¹ç†ã€‚</p>
<h4 data-id="heading-3">ä»€ä¹ˆæ˜¯çº¹ç†å•å…ƒï¼Ÿ</h4>
<p>çº¹ç†å•å…ƒæ˜¯ OpenGL ä¸­çš„"çº¹ç†æ§½ä½"ï¼Œæ¯ä¸ªæ§½ä½å¯ä»¥ç»‘å®šä¸€ä¸ªçº¹ç†å¯¹è±¡ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">GPU</span> <span class="hljs-string">çº¹ç†å•å…ƒ</span>
<span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-string">GL_TEXTURE0</span> <span class="hljs-string">â†’</span> <span class="hljs-string">çº¹ç†</span> <span class="hljs-attr">ID:</span> <span class="hljs-number">123</span><span class="hljs-string">ï¼ˆåº•å›¾ï¼‰</span>
<span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-string">GL_TEXTURE1</span> <span class="hljs-string">â†’</span> <span class="hljs-string">çº¹ç†</span> <span class="hljs-attr">ID:</span> <span class="hljs-number">456</span><span class="hljs-string">ï¼ˆæ°´å°ï¼‰</span>
<span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-string">GL_TEXTURE2</span> <span class="hljs-string">â†’</span> <span class="hljs-string">çº¹ç†</span> <span class="hljs-attr">ID:</span> <span class="hljs-number">789</span><span class="hljs-string">ï¼ˆé®ç½©ï¼‰</span>
<span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-string">...</span>
<span class="hljs-string">â””â”€â”€</span> <span class="hljs-string">GL_TEXTURE31ï¼ˆOpenGL</span> <span class="hljs-string">ES</span> <span class="hljs-string">è‡³å°‘æ”¯æŒ</span> <span class="hljs-number">8</span> <span class="hljs-string">ä¸ªï¼Œé€šå¸¸æ”¯æŒ</span> <span class="hljs-number">16</span><span class="hljs-number">-32</span> <span class="hljs-string">ä¸ªï¼‰</span>
</code></pre>
<h4 data-id="heading-4">ä¸ºä»€ä¹ˆéœ€è¦å¤šçº¹ç†ï¼Ÿ</h4>





























<table><thead><tr><th>åº”ç”¨åœºæ™¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ°´å°æ•ˆæœ</strong></td><td>åº•å›¾ + æ°´å°å›¾</td></tr><tr><td><strong>é®ç½©æ•ˆæœ</strong></td><td>åŸå›¾ + é®ç½©å›¾</td></tr><tr><td><strong>å…‰ç…§è´´å›¾</strong></td><td>é¢œè‰²çº¹ç† + æ³•çº¿è´´å›¾ + å…‰ç…§è´´å›¾</td></tr><tr><td><strong>è§†é¢‘ç‰¹æ•ˆ</strong></td><td>è§†é¢‘å¸§ + æ»¤é•œçº¹ç†ï¼ˆLUTï¼‰</td></tr><tr><td><strong>ç²’å­æ•ˆæœ</strong></td><td>ç²’å­çº¹ç† + æ¸å˜çº¹ç†</td></tr></tbody></table>
<h3 data-id="heading-5">2. å¤šçº¹ç†çš„ä½¿ç”¨æµç¨‹</h3>
<h4 data-id="heading-6">2.1 æ¿€æ´»çº¹ç†å•å…ƒ</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æ¿€æ´»çº¹ç†å•å…ƒ 0</span>
GLES20.glActiveTexture(GLES20.GL_TEXTURE0)
<span class="hljs-comment">// ç»‘å®šç¬¬ä¸€ä¸ªçº¹ç†</span>
GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, texture1)

<span class="hljs-comment">// æ¿€æ´»çº¹ç†å•å…ƒ 1</span>
GLES20.glActiveTexture(GLES20.GL_TEXTURE1)
<span class="hljs-comment">// ç»‘å®šç¬¬äºŒä¸ªçº¹ç†</span>
GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, texture2)
</code></pre>
<h4 data-id="heading-7">2.2 ä¼ é€’ç»™ç€è‰²å™¨</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å°†çº¹ç†å•å…ƒç´¢å¼•ä¼ é€’ç»™ç€è‰²å™¨çš„ sampler2D</span>
GLES20.glUniform1i(texture1Location, <span class="hljs-number">0</span>)  <span class="hljs-comment">// ä½¿ç”¨ GL_TEXTURE0</span>
GLES20.glUniform1i(texture2Location, <span class="hljs-number">1</span>)  <span class="hljs-comment">// ä½¿ç”¨ GL_TEXTURE1</span>
</code></pre>
<h4 data-id="heading-8">2.3 ç€è‰²å™¨ä¸­é‡‡æ ·</h4>
<pre><code class="hljs language-glsl" lang="glsl">precision mediump float;

uniform sampler2D uTexture1;  // åº•å›¾
uniform sampler2D uTexture2;  // æ°´å°

varying vec2 vTexCoord;

void main() {
    vec4 color1 = texture2D(uTexture1, vTexCoord);  // é‡‡æ ·åº•å›¾
    vec4 color2 = texture2D(uTexture2, vTexCoord);  // é‡‡æ ·æ°´å°
    
    // æ··åˆä¸¤ä¸ªçº¹ç†
    gl_FragColor = mix(color1, color2, color2.a);
}
</code></pre>
<h3 data-id="heading-9">3. çº¹ç†æ··åˆæ¨¡å¼</h3>
<h4 data-id="heading-10">3.1 å¸¸è§æ··åˆç®—æ³•</h4>








































<table><thead><tr><th>æ··åˆæ¨¡å¼</th><th>å…¬å¼</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td><strong>æ­£å¸¸ï¼ˆNormalï¼‰</strong></td><td><code>color2</code></td><td>å®Œå…¨è¦†ç›–</td></tr><tr><td><strong>Alpha æ··åˆ</strong></td><td><code>mix(color1, color2, alpha)</code></td><td>é€æ˜å åŠ </td></tr><tr><td><strong>ç›¸åŠ ï¼ˆAddï¼‰</strong></td><td><code>color1 + color2</code></td><td>å¢äº®æ•ˆæœ</td></tr><tr><td><strong>ç›¸ä¹˜ï¼ˆMultiplyï¼‰</strong></td><td><code>color1 * color2</code></td><td>å˜æš—æ•ˆæœ</td></tr><tr><td><strong>å±å¹•ï¼ˆScreenï¼‰</strong></td><td><code>1.0 - (1.0 - color1) * (1.0 - color2)</code></td><td>æŸ”å…‰å¢äº®</td></tr><tr><td><strong>å åŠ ï¼ˆOverlayï¼‰</strong></td><td>æ ¹æ®äº®åº¦æ··åˆç›¸ä¹˜å’Œå±å¹•æ¨¡å¼</td><td>ä¿ç•™é«˜å…‰å’Œé˜´å½±</td></tr></tbody></table>
<h4 data-id="heading-11">3.2 ç€è‰²å™¨å®ç°</h4>
<pre><code class="hljs language-glsl" lang="glsl">precision mediump float;

uniform sampler2D uTexture1;  // åº•å›¾
uniform sampler2D uTexture2;  // å åŠ å›¾
uniform int uBlendMode;       // æ··åˆæ¨¡å¼ï¼ˆ0-5ï¼‰
uniform float uAlpha;         // é€æ˜åº¦ï¼ˆ0.0 - 1.0ï¼‰

varying vec2 vTexCoord;

// æ­£å¸¸æ··åˆ
vec3 blendNormal(vec3 base, vec3 blend) {
    return blend;
}

// ç›¸åŠ æ··åˆ
vec3 blendAdd(vec3 base, vec3 blend) {
    return min(base + blend, vec3(1.0));
}

// ç›¸ä¹˜æ··åˆ
vec3 blendMultiply(vec3 base, vec3 blend) {
    return base * blend;
}

// å±å¹•æ··åˆ
vec3 blendScreen(vec3 base, vec3 blend) {
    return 1.0 - (1.0 - base) * (1.0 - blend);
}

// å åŠ æ··åˆ
vec3 blendOverlay(vec3 base, vec3 blend) {
    vec3 result;
    result.r = base.r &lt; 0.5 ? (2.0 * base.r * blend.r) : (1.0 - 2.0 * (1.0 - base.r) * (1.0 - blend.r));
    result.g = base.g &lt; 0.5 ? (2.0 * base.g * blend.g) : (1.0 - 2.0 * (1.0 - base.g) * (1.0 - blend.g));
    result.b = base.b &lt; 0.5 ? (2.0 * base.b * blend.b) : (1.0 - 2.0 * (1.0 - base.b) * (1.0 - blend.b));
    return result;
}

// æŸ”å…‰æ··åˆ
vec3 blendSoftLight(vec3 base, vec3 blend) {
    vec3 result;
    result.r = blend.r &lt; 0.5 ? (2.0 * base.r * blend.r + base.r * base.r * (1.0 - 2.0 * blend.r)) 
                              : (sqrt(base.r) * (2.0 * blend.r - 1.0) + 2.0 * base.r * (1.0 - blend.r));
    result.g = blend.g &lt; 0.5 ? (2.0 * base.g * blend.g + base.g * base.g * (1.0 - 2.0 * blend.g)) 
                              : (sqrt(base.g) * (2.0 * blend.g - 1.0) + 2.0 * base.g * (1.0 - blend.g));
    result.b = blend.b &lt; 0.5 ? (2.0 * base.b * blend.b + base.b * base.b * (1.0 - 2.0 * blend.b)) 
                              : (sqrt(base.b) * (2.0 * blend.b - 1.0) + 2.0 * base.b * (1.0 - blend.b));
    return result;
}

void main() {
    vec4 base = texture2D(uTexture1, vTexCoord);
    vec4 blend = texture2D(uTexture2, vTexCoord);
    
    vec3 result;
    
    if (uBlendMode == 0) {
        // æ­£å¸¸æ··åˆï¼ˆAlpha æ··åˆï¼‰
        result = mix(base.rgb, blend.rgb, blend.a * uAlpha);
    } else if (uBlendMode == 1) {
        // ç›¸åŠ 
        result = blendAdd(base.rgb, blend.rgb * uAlpha);
    } else if (uBlendMode == 2) {
        // ç›¸ä¹˜
        result = mix(base.rgb, blendMultiply(base.rgb, blend.rgb), uAlpha);
    } else if (uBlendMode == 3) {
        // å±å¹•
        result = mix(base.rgb, blendScreen(base.rgb, blend.rgb), uAlpha);
    } else if (uBlendMode == 4) {
        // å åŠ 
        result = mix(base.rgb, blendOverlay(base.rgb, blend.rgb), uAlpha);
    } else if (uBlendMode == 5) {
        // æŸ”å…‰
        result = mix(base.rgb, blendSoftLight(base.rgb, blend.rgb), uAlpha);
    } else {
        result = base.rgb;
    }
    
    gl_FragColor = vec4(result, 1.0);
}
</code></pre>
<h3 data-id="heading-12">4. Alpha é€šé“å¤„ç†</h3>
<h4 data-id="heading-13">4.1 ä»€ä¹ˆæ˜¯ Alpha é€šé“ï¼Ÿ</h4>
<p><strong>Alpha é€šé“</strong>è¡¨ç¤ºåƒç´ çš„ä¸é€æ˜åº¦ï¼š</p>
<ul>
<li><code>alpha = 0.0</code>ï¼šå®Œå…¨é€æ˜</li>
<li><code>alpha = 0.5</code>ï¼šåŠé€æ˜</li>
<li><code>alpha = 1.0</code>ï¼šå®Œå…¨ä¸é€æ˜</li>
</ul>
<h4 data-id="heading-14">4.2 å¯ç”¨ Alpha æ··åˆ</h4>
<p>OpenGL æä¾›äº†ç¡¬ä»¶çº§åˆ«çš„ Alpha æ··åˆï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å¯ç”¨æ··åˆ</span>
GLES20.glEnable(GLES20.GL_BLEND)

<span class="hljs-comment">// è®¾ç½®æ··åˆå‡½æ•°</span>
GLES20.glBlendFunc(GLES20.GL_SRC_ALPHA, GLES20.GL_ONE_MINUS_SRC_ALPHA)
</code></pre>
<p><strong>æ··åˆå…¬å¼</strong>ï¼š</p>
<pre><code class="hljs language-css" lang="css">æœ€ç»ˆé¢œè‰² = æºé¢œè‰² Ã— æºå› å­ + ç›®æ ‡é¢œè‰² Ã— ç›®æ ‡å› å­
       = <span class="hljs-attribute">src</span><span class="hljs-selector-class">.rgb</span> Ã— <span class="hljs-attribute">src</span><span class="hljs-selector-class">.a</span> + dst<span class="hljs-selector-class">.rgb</span> Ã— (<span class="hljs-number">1.0</span> - <span class="hljs-attribute">src</span><span class="hljs-selector-class">.a</span>)
</code></pre>
<h4 data-id="heading-15">4.3 å¸¸è§æ··åˆå‡½æ•°</h4>






























<table><thead><tr><th>æºå› å­</th><th>ç›®æ ‡å› å­</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td><code>GL_SRC_ALPHA</code></td><td><code>GL_ONE_MINUS_SRC_ALPHA</code></td><td>æ ‡å‡† Alpha æ··åˆï¼ˆé€æ˜å åŠ ï¼‰</td></tr><tr><td><code>GL_ONE</code></td><td><code>GL_ONE</code></td><td>ç›¸åŠ æ··åˆï¼ˆå¢äº®ï¼‰</td></tr><tr><td><code>GL_DST_COLOR</code></td><td><code>GL_ZERO</code></td><td>ç›¸ä¹˜æ··åˆï¼ˆå˜æš—ï¼‰</td></tr><tr><td><code>GL_ONE</code></td><td><code>GL_ONE_MINUS_SRC_ALPHA</code></td><td>é¢„ä¹˜ Alpha æ··åˆ</td></tr></tbody></table>
<h3 data-id="heading-16">5. å®ç”¨æ•ˆæœå®ç°</h3>
<h4 data-id="heading-17">5.1 æ°´å°æ•ˆæœ</h4>
<pre><code class="hljs language-glsl" lang="glsl">// æ°´å°ç€è‰²å™¨
precision mediump float;

uniform sampler2D uTexture;    // åº•å›¾
uniform sampler2D uWatermark;  // æ°´å°
uniform vec2 uWatermarkPos;    // æ°´å°ä½ç½®ï¼ˆ0.0 - 1.0ï¼‰
uniform vec2 uWatermarkSize;   // æ°´å°å¤§å°ï¼ˆ0.0 - 1.0ï¼‰
uniform float uWatermarkAlpha; // æ°´å°é€æ˜åº¦

varying vec2 vTexCoord;

void main() {
    vec4 baseColor = texture2D(uTexture, vTexCoord);
    
    // è®¡ç®—æ°´å°åŒºåŸŸ
    vec2 watermarkCoord = (vTexCoord - uWatermarkPos) / uWatermarkSize;
    
    // åˆ¤æ–­æ˜¯å¦åœ¨æ°´å°åŒºåŸŸ
    if (watermarkCoord.x &gt;= 0.0 &amp;&amp; watermarkCoord.x &lt;= 1.0 &amp;&amp;
        watermarkCoord.y &gt;= 0.0 &amp;&amp; watermarkCoord.y &lt;= 1.0) {
        
        vec4 watermarkColor = texture2D(uWatermark, watermarkCoord);
        
        // Alpha æ··åˆæ°´å°
        gl_FragColor = mix(baseColor, watermarkColor, watermarkColor.a * uWatermarkAlpha);
    } else {
        gl_FragColor = baseColor;
    }
}
</code></pre>
<h4 data-id="heading-18">5.2 åŒé‡æ›å…‰æ•ˆæœ</h4>
<pre><code class="hljs language-glsl" lang="glsl">precision mediump float;

uniform sampler2D uTexture1;
uniform sampler2D uTexture2;
uniform float uMixRatio;  // æ··åˆæ¯”ä¾‹

varying vec2 vTexCoord;

void main() {
    vec4 color1 = texture2D(uTexture1, vTexCoord);
    vec4 color2 = texture2D(uTexture2, vTexCoord);
    
    // å±å¹•æ··åˆæ¨¡å¼ï¼ˆåŒé‡æ›å…‰å¸¸ç”¨ï¼‰
    vec3 result = 1.0 - (1.0 - color1.rgb) * (1.0 - color2.rgb * uMixRatio);
    
    gl_FragColor = vec4(result, 1.0);
}
</code></pre>
<h4 data-id="heading-19">5.3 é®ç½©æ•ˆæœ</h4>
<pre><code class="hljs language-glsl" lang="glsl">precision mediump float;

uniform sampler2D uTexture;  // åŸå›¾
uniform sampler2D uMask;     // é®ç½©ï¼ˆé»‘ç™½å›¾ï¼‰

varying vec2 vTexCoord;

void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    vec4 mask = texture2D(uMask, vTexCoord);
    
    // ä½¿ç”¨é®ç½©çš„äº®åº¦ä½œä¸º Alpha
    float maskAlpha = dot(mask.rgb, vec3(0.299, 0.587, 0.114));
    
    gl_FragColor = vec4(color.rgb, color.a * maskAlpha);
}
</code></pre>
<h3 data-id="heading-20">6. æ€§èƒ½ä¼˜åŒ–</h3>
<h4 data-id="heading-21">6.1 çº¹ç†å•å…ƒç®¡ç†</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TextureManager</span> {
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> TEXTURE_UNIT_BASE = <span class="hljs-number">0</span>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> TEXTURE_UNIT_BLEND = <span class="hljs-number">1</span>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> TEXTURE_UNIT_WATERMARK = <span class="hljs-number">2</span>
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">bindTextures</span><span class="hljs-params">(baseTexture: <span class="hljs-type">Int</span>, blendTexture: <span class="hljs-type">Int</span>, watermarkTexture: <span class="hljs-type">Int</span>)</span></span> {
        <span class="hljs-comment">// åº•å›¾</span>
        GLES20.glActiveTexture(GLES20.GL_TEXTURE0 + TEXTURE_UNIT_BASE)
        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, baseTexture)
        
        <span class="hljs-comment">// æ··åˆå›¾</span>
        GLES20.glActiveTexture(GLES20.GL_TEXTURE0 + TEXTURE_UNIT_BLEND)
        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, blendTexture)
        
        <span class="hljs-comment">// æ°´å°</span>
        GLES20.glActiveTexture(GLES20.GL_TEXTURE0 + TEXTURE_UNIT_WATERMARK)
        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, watermarkTexture)
    }
}
</code></pre>
<h4 data-id="heading-22">6.2 å‡å°‘çº¹ç†åˆ‡æ¢</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ ä¸å¥½çš„åšæ³•ï¼šé¢‘ç¹åˆ‡æ¢çº¹ç†å•å…ƒ</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">renderObjects</span><span class="hljs-params">(objects: <span class="hljs-type">List</span>&lt;<span class="hljs-type">RenderObject</span>&gt;)</span></span> {
    objects.forEach { obj -&gt;
        GLES20.glActiveTexture(GLES20.GL_TEXTURE0)
        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, obj.texture)
        obj.draw()
    }
}

<span class="hljs-comment">// âœ… å¥½çš„åšæ³•ï¼šæ‰¹é‡æ¸²æŸ“ç›¸åŒçº¹ç†çš„å¯¹è±¡</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">renderObjectsBatched</span><span class="hljs-params">(objects: <span class="hljs-type">List</span>&lt;<span class="hljs-type">RenderObject</span>&gt;)</span></span> {
    <span class="hljs-keyword">val</span> grouped = objects.groupBy { it.texture }
    grouped.forEach { (texture, objs) -&gt;
        GLES20.glActiveTexture(GLES20.GL_TEXTURE0)
        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, texture)
        objs.forEach { it.draw() }
    }
}
</code></pre>
<h4 data-id="heading-23">6.3 çº¹ç†å‹ç¼©</h4>
<p>å¯¹äºæ°´å°ç­‰è¾…åŠ©çº¹ç†ï¼Œå¯ä»¥ä½¿ç”¨è¾ƒä½åˆ†è¾¨ç‡æˆ–å‹ç¼©æ ¼å¼ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// è°ƒæ•´æ°´å°å°ºå¯¸</span>
<span class="hljs-keyword">val</span> watermarkSize = <span class="hljs-number">256</span>  <span class="hljs-comment">// ä¸éœ€è¦å¾ˆé«˜åˆ†è¾¨ç‡</span>
<span class="hljs-keyword">val</span> scaledWatermark = Bitmap.createScaledBitmap(
    originalWatermark, 
    watermarkSize, 
    watermarkSize, 
    <span class="hljs-literal">true</span>
)
</code></pre>
<h3 data-id="heading-24">7. å¤šçº¹ç†çš„é™åˆ¶</h3>
<h4 data-id="heading-25">7.1 æŸ¥è¯¢çº¹ç†å•å…ƒæ•°é‡</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> maxTextureUnits = IntArray(<span class="hljs-number">1</span>)
GLES20.glGetIntegerv(GLES20.GL_MAX_TEXTURE_IMAGE_UNITS, maxTextureUnits, <span class="hljs-number">0</span>)
Log.d(TAG, <span class="hljs-string">"è®¾å¤‡æ”¯æŒçš„æœ€å¤§çº¹ç†å•å…ƒæ•°: <span class="hljs-subst">${maxTextureUnits[<span class="hljs-number">0</span>]}</span>"</span>)
</code></pre>
<p>OpenGL ES 2.0 è§„èŒƒè¦æ±‚è‡³å°‘æ”¯æŒ 8 ä¸ªçº¹ç†å•å…ƒï¼Œå¤§å¤šæ•°è®¾å¤‡æ”¯æŒ 16-32 ä¸ªã€‚</p>
<h4 data-id="heading-26">7.2 çº¹ç†å†…å­˜ç®¡ç†</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç›‘æ§çº¹ç†å†…å­˜ä½¿ç”¨</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">estimateTextureMemory</span><span class="hljs-params">(width: <span class="hljs-type">Int</span>, height: <span class="hljs-type">Int</span>, format: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> {
    <span class="hljs-keyword">val</span> bytesPerPixel = <span class="hljs-keyword">when</span> (format) {
        GLES20.GL_RGBA -&gt; <span class="hljs-number">4</span>
        GLES20.GL_RGB -&gt; <span class="hljs-number">3</span>
        GLES20.GL_LUMINANCE_ALPHA -&gt; <span class="hljs-number">2</span>
        GLES20.GL_LUMINANCE -&gt; <span class="hljs-number">1</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-number">4</span>
    }
    <span class="hljs-keyword">return</span> width * height * bytesPerPixel
}

<span class="hljs-comment">// ç¤ºä¾‹ï¼š1920x1080 RGBA çº¹ç† = 8.3 MB</span>
<span class="hljs-keyword">val</span> memory = estimateTextureMemory(<span class="hljs-number">1920</span>, <span class="hljs-number">1080</span>, GLES20.GL_RGBA)
Log.d(TAG, <span class="hljs-string">"çº¹ç†å†…å­˜å ç”¨: <span class="hljs-subst">${memory / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>}</span> MB"</span>)
</code></pre>
<h2 data-id="heading-27">ğŸ’» ä»£ç å®è·µ</h2>
<h3 data-id="heading-28">ä»Šæ—¥ä»»åŠ¡</h3>
<p>å®ç°ä¸€ä¸ªå¤šçº¹ç†æ··åˆåº”ç”¨ï¼š</p>
<ol>
<li><strong>åŠ è½½ä¸¤å¼ å›¾ç‰‡</strong></li>
<li><strong>å®ç°å¤šç§æ··åˆæ¨¡å¼</strong>ï¼š
<ul>
<li>Alpha æ··åˆ</li>
<li>ç›¸åŠ </li>
<li>ç›¸ä¹˜</li>
<li>å±å¹•</li>
<li>å åŠ </li>
<li>æŸ”å…‰</li>
</ul>
</li>
<li><strong>æ·»åŠ æ°´å°åŠŸèƒ½</strong></li>
<li><strong>æä¾›é€æ˜åº¦è°ƒèŠ‚</strong></li>
</ol>
<h3 data-id="heading-29">å®ç°æ•ˆæœ</h3>
<ul>
<li>ğŸ–¼ï¸ åŒæ—¶åŠ è½½ä¸¤å¼ çº¹ç†</li>
<li>ğŸ¨ 6 ç§æ··åˆæ¨¡å¼å®æ—¶åˆ‡æ¢</li>
<li>ğŸ’§ é€æ˜åº¦ SeekBar è°ƒèŠ‚</li>
<li>ğŸ·ï¸ æ°´å°ä½ç½®å’Œé€æ˜åº¦æ§åˆ¶</li>
</ul>
<h3 data-id="heading-30">æ ¸å¿ƒä»£ç ç»“æ„</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Day08Renderer</span>(context: Context) : GLSurfaceView.Renderer {

    <span class="hljs-comment">// å¤šçº¹ç† ID</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> texture1: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>  <span class="hljs-comment">// åº•å›¾</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> texture2: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>  <span class="hljs-comment">// å åŠ å›¾</span>

    <span class="hljs-comment">// æ··åˆæ¨¡å¼</span>
    <span class="hljs-keyword">enum</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlendMode</span> {
        ALPHA,      <span class="hljs-comment">// Alpha æ··åˆ</span>
        ADD,        <span class="hljs-comment">// ç›¸åŠ </span>
        MULTIPLY,   <span class="hljs-comment">// ç›¸ä¹˜</span>
        SCREEN,     <span class="hljs-comment">// å±å¹•</span>
        OVERLAY,    <span class="hljs-comment">// å åŠ </span>
        SOFT_LIGHT  <span class="hljs-comment">// æŸ”å…‰</span>
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> currentBlendMode = BlendMode.ALPHA
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> blendAlpha = <span class="hljs-number">0.5f</span>

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDrawFrame</span><span class="hljs-params">(gl: <span class="hljs-type">GL10</span>?)</span></span> {
        <span class="hljs-comment">// æ¿€æ´»çº¹ç†å•å…ƒ 0</span>
        GLES20.glActiveTexture(GLES20.GL_TEXTURE0)
        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, texture1)
        GLES20.glUniform1i(texture1Location, <span class="hljs-number">0</span>)

        <span class="hljs-comment">// æ¿€æ´»çº¹ç†å•å…ƒ 1</span>
        GLES20.glActiveTexture(GLES20.GL_TEXTURE1)
        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, texture2)
        GLES20.glUniform1i(texture2Location, <span class="hljs-number">1</span>)

        <span class="hljs-comment">// è®¾ç½®æ··åˆæ¨¡å¼</span>
        GLES20.glUniform1i(blendModeLocation, currentBlendMode.ordinal)
        GLES20.glUniform1f(alphaLocation, blendAlpha)

        <span class="hljs-comment">// ç»˜åˆ¶</span>
        drawQuad()
    }
}
</code></pre>
<h2 data-id="heading-31">ğŸ§ª ç»ƒä¹ ä»»åŠ¡</h2>
<h3 data-id="heading-32">åŸºç¡€ä»»åŠ¡</h3>
<ol>
<li>âœ… å®ç°ä¸¤ä¸ªçº¹ç†çš„åŠ è½½å’Œç»‘å®š</li>
<li>âœ… å®ç°è‡³å°‘ 3 ç§æ··åˆæ¨¡å¼</li>
<li>âœ… æ·»åŠ é€æ˜åº¦è°ƒèŠ‚åŠŸèƒ½</li>
</ol>
<h3 data-id="heading-33">è¿›é˜¶ä»»åŠ¡</h3>
<ol>
<li>ğŸ¨ å®ç°æ°´å°åŠŸèƒ½ï¼ˆå¯è°ƒèŠ‚ä½ç½®å’Œå¤§å°ï¼‰</li>
<li>ğŸ–¼ï¸ å®ç°é®ç½©æ•ˆæœ</li>
<li>ğŸŒˆ å®ç°åŒé‡æ›å…‰æ•ˆæœ</li>
<li>ğŸ“¸ æ·»åŠ é¢„è®¾æ··åˆæ•ˆæœï¼ˆå¤å¤ã€ç”µå½±ã€æ¢¦å¹»ç­‰ï¼‰</li>
</ol>
<h3 data-id="heading-34">æŒ‘æˆ˜ä»»åŠ¡</h3>
<ol>
<li>ğŸš€ å®ç°ä¸‰ä¸ªçº¹ç†çš„æ··åˆï¼ˆåº•å›¾ + å åŠ å›¾ + æ°´å°ï¼‰</li>
<li>ğŸ­ å®ç°åŠ¨æ€æ··åˆï¼ˆæ··åˆæ¯”ä¾‹éšæ—¶é—´å˜åŒ–ï¼‰</li>
<li>ğŸ¬ å®ç°åˆ†åŒºåŸŸæ··åˆï¼ˆä¸åŒåŒºåŸŸä¸åŒæ··åˆæ¨¡å¼ï¼‰</li>
<li>ğŸ’¾ ä¿å­˜æ··åˆåçš„å›¾ç‰‡åˆ°ç›¸å†Œ</li>
</ol>
<h2 data-id="heading-35">ğŸ“– çŸ¥è¯†ç‚¹æ€»ç»“</h2>
<h3 data-id="heading-36">çº¹ç†å•å…ƒ vs çº¹ç†å¯¹è±¡</h3>






























<table><thead><tr><th>ç‰¹æ€§</th><th>çº¹ç†å•å…ƒ</th><th>çº¹ç†å¯¹è±¡</th></tr></thead><tbody><tr><td><strong>æ¦‚å¿µ</strong></td><td>GPU çš„"çº¹ç†æ§½ä½"</td><td>å®é™…çš„çº¹ç†æ•°æ®</td></tr><tr><td><strong>æ•°é‡</strong></td><td>æœ‰é™ï¼ˆé€šå¸¸ 8-32 ä¸ªï¼‰</td><td>å¯ä»¥åˆ›å»ºå¾ˆå¤š</td></tr><tr><td><strong>æ“ä½œ</strong></td><td><code>glActiveTexture()</code></td><td><code>glBindTexture()</code></td></tr><tr><td><strong>ç±»æ¯”</strong></td><td>USB æ¥å£</td><td>U ç›˜</td></tr></tbody></table>
<h3 data-id="heading-37">æ··åˆæ¨¡å¼å¯¹æ¯”</h3>








































<table><thead><tr><th>æ¨¡å¼</th><th>è§†è§‰æ•ˆæœ</th><th>å¸¸ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Alpha</strong></td><td>é€æ˜å åŠ </td><td>æ°´å°ã€UI å åŠ </td></tr><tr><td><strong>Add</strong></td><td>å¢äº®ã€å‘å…‰</td><td>å…‰æ•ˆã€ç²’å­</td></tr><tr><td><strong>Multiply</strong></td><td>å˜æš—ã€é˜´å½±</td><td>é˜´å½±ã€è‰²å½©æ ¡æ­£</td></tr><tr><td><strong>Screen</strong></td><td>æŸ”å’Œå¢äº®</td><td>æŸ”å…‰ã€æ°›å›´</td></tr><tr><td><strong>Overlay</strong></td><td>å¯¹æ¯”å¢å¼º</td><td>ç…§ç‰‡æ»¤é•œ</td></tr><tr><td><strong>Soft Light</strong></td><td>æŸ”å’Œæ··åˆ</td><td>è‚–åƒç¾åŒ–</td></tr></tbody></table>
<h3 data-id="heading-38">æœ€ä½³å®è·µ</h3>
<ol>
<li>âœ… <strong>å¤ç”¨çº¹ç†å•å…ƒ</strong>ï¼šä¸è¦æ¯å¸§éƒ½é‡æ–°æ¿€æ´»å’Œç»‘å®š</li>
<li>âœ… <strong>æ‰¹é‡æ¸²æŸ“</strong>ï¼šç›¸åŒçº¹ç†çš„å¯¹è±¡ä¸€èµ·æ¸²æŸ“</li>
<li>âœ… <strong>çº¹ç†å‹ç¼©</strong>ï¼šå¯¹è¾…åŠ©çº¹ç†ä½¿ç”¨è¾ƒä½åˆ†è¾¨ç‡</li>
<li>âœ… <strong>åŠæ—¶é‡Šæ”¾</strong>ï¼šä¸å†ä½¿ç”¨çš„çº¹ç†è¦åˆ é™¤</li>
<li>âœ… <strong>æ£€æŸ¥é™åˆ¶</strong>ï¼šæŸ¥è¯¢è®¾å¤‡æ”¯æŒçš„æœ€å¤§çº¹ç†å•å…ƒæ•°</li>
</ol>
<h2 data-id="heading-39">ğŸ› å¸¸è§é—®é¢˜</h2>
<h3 data-id="heading-40">Q1: çº¹ç†æ˜¾ç¤ºæ˜¯é»‘è‰²çš„ï¼Ÿ</h3>
<p><strong>å¯èƒ½åŸå› </strong>ï¼š</p>
<ol>
<li>çº¹ç†å•å…ƒç´¢å¼•é”™è¯¯</li>
<li><code>glUniform1i</code> ä¼ é€’çš„å€¼ä¸å¯¹åº”æ¿€æ´»çš„çº¹ç†å•å…ƒ</li>
</ol>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// çº¹ç†å•å…ƒ 0</span>
GLES20.glActiveTexture(GLES20.GL_TEXTURE0)
GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, texture1)
GLES20.glUniform1i(texture1Location, <span class="hljs-number">0</span>)  <span class="hljs-comment">// ä¼ é€’ 0ï¼Œä¸æ˜¯ GL_TEXTURE0</span>

<span class="hljs-comment">// çº¹ç†å•å…ƒ 1</span>
GLES20.glActiveTexture(GLES20.GL_TEXTURE1)
GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, texture2)
GLES20.glUniform1i(texture2Location, <span class="hljs-number">1</span>)  <span class="hljs-comment">// ä¼ é€’ 1ï¼Œä¸æ˜¯ GL_TEXTURE1</span>
</code></pre>
<h3 data-id="heading-41">Q2: æ··åˆæ•ˆæœä¸æ­£ç¡®ï¼Ÿ</h3>
<p>æ£€æŸ¥æ˜¯å¦å¯ç”¨äº† OpenGL æ··åˆï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å¦‚æœä½¿ç”¨ç¡¬ä»¶æ··åˆ</span>
GLES20.glEnable(GLES20.GL_BLEND)
GLES20.glBlendFunc(GLES20.GL_SRC_ALPHA, GLES20.GL_ONE_MINUS_SRC_ALPHA)

<span class="hljs-comment">// å¦‚æœä½¿ç”¨ç€è‰²å™¨æ··åˆ</span>
<span class="hljs-comment">// ä¸éœ€è¦å¯ç”¨ glBlendï¼Œç›´æ¥åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­è®¡ç®—å³å¯</span>
</code></pre>
<h3 data-id="heading-42">Q3: æ°´å°ä½ç½®ä¸å¯¹ï¼Ÿ</h3>
<p>OpenGL åæ ‡ç³»åŸç‚¹åœ¨å·¦ä¸‹è§’ï¼Œè€Œ UI åæ ‡ç³»åœ¨å·¦ä¸Šè§’ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// UI åæ ‡ï¼ˆå·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼‰</span>
<span class="hljs-keyword">val</span> uiY = <span class="hljs-number">100f</span>

<span class="hljs-comment">// è½¬æ¢ä¸º OpenGL åæ ‡ï¼ˆå·¦ä¸‹è§’ä¸ºåŸç‚¹ï¼‰</span>
<span class="hljs-keyword">val</span> glY = screenHeight - uiY - watermarkHeight
</code></pre>
<h3 data-id="heading-43">Q4: å¦‚ä½•å®ç°åœ†å½¢æ°´å°ï¼Ÿ</h3>
<p>åœ¨ç€è‰²å™¨ä¸­ä½¿ç”¨è·ç¦»å‡½æ•°ï¼š</p>
<pre><code class="hljs language-glsl" lang="glsl">void main() {
    vec2 center = vec2(0.5, 0.5);
    float dist = distance(watermarkCoord, center);
    
    // åœ†å½¢é®ç½©
    float alpha = smoothstep(0.5, 0.48, dist);
    
    vec4 watermarkColor = texture2D(uWatermark, watermarkCoord);
    watermarkColor.a *= alpha;
    
    gl_FragColor = mix(baseColor, watermarkColor, watermarkColor.a);
}
</code></pre>
<h2 data-id="heading-44">ğŸ”— å‚è€ƒèµ„æ–™</h2>
<h3 data-id="heading-45">å®˜æ–¹æ–‡æ¡£</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.khronos.org%2Fopengl%2Fwiki%2FTexture" target="_blank" title="https://www.khronos.org/opengl/wiki/Texture" ref="nofollow noopener noreferrer">OpenGL ES Texture Units</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.khronos.org%2Fopengl%2Fwiki%2FSampler_(GLSL)" target="_blank" title="https://www.khronos.org/opengl/wiki/Sampler_(GLSL)" ref="nofollow noopener noreferrer">GLSL Sampler Types</a></li>
</ul>
<h3 data-id="heading-46">æ··åˆæ¨¡å¼å‚è€ƒ</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fphotoblogstop.com%2Fphotoshop%2Fphotoshop-blend-modes-explained" target="_blank" title="https://photoblogstop.com/photoshop/photoshop-blend-modes-explained" ref="nofollow noopener noreferrer">Photoshop Blend Modes</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjamieowen%2Fglsl-blend" target="_blank" title="https://github.com/jamieowen/glsl-blend" ref="nofollow noopener noreferrer">WebGL Blend Modes</a></li>
</ul>
<h3 data-id="heading-47">æ¨èé˜…è¯»</h3>
<ul>
<li>ã€ŠReal-Time Renderingã€‹- Chapter 5: Visual Appearance</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.nvidia.com%2Fgpugems%2Fgpugems3%2Fpart-iv-image-effects" target="_blank" title="https://developer.nvidia.com/gpugems/gpugems3/part-iv-image-effects" ref="nofollow noopener noreferrer">GPU Gems - Image Processing</a></li>
</ul>
<h2 data-id="heading-48">ğŸ“ ä»Šæ—¥æ€»ç»“</h2>
<p>ä»Šå¤©æˆ‘ä»¬æ·±å…¥å­¦ä¹ äº†å¤šé‡çº¹ç†å’Œæ··åˆæŠ€æœ¯ï¼š</p>
<ol>
<li>âœ… ç†è§£äº†çº¹ç†å•å…ƒçš„æ¦‚å¿µï¼šGPU ä¸­çš„"çº¹ç†æ§½ä½"</li>
<li>âœ… æŒæ¡äº†å¤šçº¹ç†çš„ä½¿ç”¨æµç¨‹ï¼šæ¿€æ´» â†’ ç»‘å®š â†’ ä¼ é€’ç´¢å¼•</li>
<li>âœ… å­¦ä¹ äº† 6 ç§å¸¸ç”¨æ··åˆæ¨¡å¼ï¼šAlphaã€Addã€Multiplyã€Screenã€Overlayã€Soft Light</li>
<li>âœ… å®ç°äº†å®ç”¨æ•ˆæœï¼šæ°´å°ã€åŒé‡æ›å…‰ã€é®ç½©</li>
</ol>
<p><strong>å…³é”®è¦ç‚¹</strong>ï¼š</p>
<ul>
<li>çº¹ç†å•å…ƒå…è®¸æˆ‘ä»¬åœ¨ä¸€æ¬¡ç»˜åˆ¶ä¸­ä½¿ç”¨å¤šä¸ªçº¹ç†</li>
<li><code>glActiveTexture()</code> æ¿€æ´»çº¹ç†å•å…ƒï¼Œ<code>glUniform1i()</code> ä¼ é€’ç´¢å¼•ï¼ˆä¸æ˜¯ GL_TEXTURE å¸¸é‡ï¼‰</li>
<li>æ··åˆæ¨¡å¼æœ¬è´¨æ˜¯ä¸åŒçš„é¢œè‰²è®¡ç®—å…¬å¼</li>
<li>Alpha é€šé“æ˜¯å®ç°é€æ˜æ•ˆæœçš„å…³é”®</li>
</ul>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">ä¸‹ä¸€ç¯‡</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¹¶å‘ä¸¢æ•°æ®æ·±åº¦å‰–æï¼šMySQLé”æœºåˆ¶ä¸äº‹åŠ¡å®æˆ˜è¸©å‘åŠè§£å†³æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7570579125154725898</link>    <guid>https://juejin.cn/post/7570579125154725898</guid>    <pubDate>2025-11-10T07:58:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570579125154725898" data-draft-id="7570564840429305883" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¹¶å‘ä¸¢æ•°æ®æ·±åº¦å‰–æï¼šMySQLé”æœºåˆ¶ä¸äº‹åŠ¡å®æˆ˜è¸©å‘åŠè§£å†³æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-11-10T07:58:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="äº¬ä¸œäº‘å¼€å‘è€…"/> <meta itemprop="url" content="https://juejin.cn/user/2634854380340008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¹¶å‘ä¸¢æ•°æ®æ·±åº¦å‰–æï¼šMySQLé”æœºåˆ¶ä¸äº‹åŠ¡å®æˆ˜è¸©å‘åŠè§£å†³æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2634854380340008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    äº¬ä¸œäº‘å¼€å‘è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T07:58:21.000Z" title="Mon Nov 10 2025 07:58:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»33åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1ã€ç†è®ºæ¥æºäºå®è·µ</h2>
<p><strong>ç°è±¡</strong>ï¼šäº2025-08-13 21:45:35ï¼Œäº‹å®é€»è¾‘è¡¨å°†è‡ªèº«çš„æŒ‡æ ‡ä¸ç»´åº¦åŒæ­¥åˆ°åŸå­æœåŠ¡çš„å®ç°æ—¶ï¼Œå‡ºç°åŒæ­¥è¿‡æ¥çš„æŒ‡æ ‡ä¸ç»´åº¦ä¸¢å¤±ã€‚</p>
<p><strong>æ ¸å¿ƒåŸå› </strong>ï¼šä¸¤æ¬¡é‡å¤çš„äº‹å®é€»è¾‘è¡¨åŒæ­¥æ—¶é—´éå¸¸ç›¸è¿‘ï¼Œå¯¼è‡´åŒæ­¥è¿‡æ¥çš„æŒ‡æ ‡ä¸ç»´åº¦ä¸¢å¤±ã€‚</p>
<p>ï»¿</p>
<p>ï»¿</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2997262148d24d5eb0167adf0eaa43d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763366301&amp;x-signature=1VD8L2kEcgSenUN%2F%2FvANMxfw%2Bm4%3D" alt="" loading="lazy"/></p>
<p>ï»¿ï»¿</p>
<h2 data-id="heading-1">2ã€å€’å¸¦è¿›äº‹æ•…ç°åœº</h2>
<p>é€»è¾‘è¡¨å‘åŸå­æœåŠ¡åŒæ­¥çš„æ ¸å¿ƒé€»è¾‘æ˜¯ â€œå…ˆåˆ åå¢â€ï¼šåˆ é™¤æ—§æ•°æ®â†’å¯¹æ¯”æ–°è€æ•°æ®â†’æ’å…¥æ–°å¢æ•°æ®ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p>
<p>ï»¿</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6649acaff23477fbc1cb6d5647fb50b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763366301&amp;x-signature=5npYZVg7NlOPfHpPaeAoFn1CjtI%3D" alt="" loading="lazy"/></p>
<p>ï»¿ï»¿</p>
<p>æ•´ä½“ä¸šåŠ¡ä»£ç ç²¾ç®€é€»è¾‘å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Transactional</span>(rollbackFor = Exception.class)
public Map&lt;String, Object&gt; driveToAtomService(Map logicTableData, String erp) {
<span class="hljs-comment">//è·å¾—ç¯å¢ƒä¿¡æ¯</span>
String env = driveLogicTable<span class="hljs-selector-class">.getString</span>(DRIVE_LOGIC_TABLE_ENV);
<span class="hljs-comment">//è·å–/æ›´æ–°å®ç°id</span>
 Long logicTableId = <span class="hljs-built_in">getOrAddLogicTableId</span>(atomicServiceId, driveLogicTable, erp, EnvType.of(env));
<span class="hljs-comment">//åˆ é™¤å…³è”æŒ‡æ ‡</span>
 metricImplMapper<span class="hljs-selector-class">.deleteByLogicTableIds</span>(Collections.singletonList(logicId));
<span class="hljs-comment">//è·å–è¯·æ±‚ä¸­çš„æ‰€æœ‰çš„æŒ‡æ ‡ä¿¡æ¯</span>
List&lt;MetricImplBO&gt; metricList = <span class="hljs-built_in">getMetricImpls</span>(logicTableData, logicTableId);
<span class="hljs-comment">//è·å–éœ€è¦æ–°å¢çš„æŒ‡æ ‡å®ç°(åŒ…å«äº†æŸ¥è¯¢åº“é‡Œç°æœ‰çš„æŒ‡æ ‡å®ç°)</span>
List&lt;MetricImplRelBO&gt; metricImpls = metricImplMapper<span class="hljs-selector-class">.getMetricImpls</span>(logicTableId);
Set&lt;Long&gt; metricDefIdSet = metricImpls<span class="hljs-selector-class">.stream</span>()
            <span class="hljs-selector-class">.map</span>(MetricImplRelBO::getMetricDefId)<span class="hljs-selector-class">.collect</span>(Collectors.toSet());
List&lt;MetricImplBO&gt; addList = metricList<span class="hljs-selector-class">.stream</span>()
            <span class="hljs-selector-class">.filter</span>(s -&gt; !metricDefIdSet.contains(s.getMetricDefId()))<span class="hljs-selector-class">.collect</span>(Collectors.toList());
<span class="hljs-comment">//å°†éœ€è¦æ–°å¢çš„æŒ‡æ ‡å®ç°æ’å…¥æ•°æ®åº“</span>
 <span class="hljs-built_in">addMetricImpl</span>(addList);

}
</code></pre>
<p>ç”¨ä¸€ä¸ªè¯·æ±‚è¿›è¡Œä¸¾ä¾‹ï¼š</p>
<pre><code class="hljs language-ruby" lang="ruby">{<span class="hljs-string">"header"</span><span class="hljs-symbol">:</span>{<span class="hljs-string">"appKey"</span><span class="hljs-symbol">:null</span>,<span class="hljs-string">"uuid"</span><span class="hljs-symbol">:<span class="hljs-string">"ce7cef2d-c417-464a-a519-311599fddfca"</span></span>,<span class="hljs-string">"serviceName"</span><span class="hljs-symbol">:<span class="hljs-string">"driveToAtomService"</span></span>,<span class="hljs-string">"context"</span><span class="hljs-symbol">:</span>{<span class="hljs-string">"PIN"</span><span class="hljs-symbol">:<span class="hljs-string">"wanyue3"</span></span>}},<span class="hljs-string">"body"</span><span class="hljs-symbol">:</span>{<span class="hljs-string">"dimList"</span><span class="hljs-symbol">:</span>[{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">72</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">2501</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">2484</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">2502</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">4591</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">3822</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">4523</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">4524</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">76</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">1767</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">1907</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">1598</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">4620</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">4621</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">4622</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">2504</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">2485</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">2486</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">2487</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">2488</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">3077</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">3080</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">3081</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">2483</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">2482</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">3082</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">3083</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">4851</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">2503</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">5070</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">5044</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">5087</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">5144</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">5145</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">3089</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">3680</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">2223</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">5428</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">5101</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">1315</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">5247</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">3318</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">5262</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">4646</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">2252</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">2254</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">2959</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">2958</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">2728</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">2618</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">5061</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">6032</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">6375</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">6388</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">6389</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">1316</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"ALL"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">1081</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"FILTER"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">1351</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"FILTER"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">1082</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"FILTER"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">1499</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"COMBINE"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">1596</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"FILTER"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">1606</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"FILTER"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">1083</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"FILTER"</span></span>},{<span class="hljs-string">"isRequiredForFilter"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"supportCrossTopic"</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>,<span class="hljs-string">"dimDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">1108</span>,<span class="hljs-string">"type"</span><span class="hljs-symbol">:<span class="hljs-string">"FILTER"</span></span>}],<span class="hljs-string">"dimCombineList"</span><span class="hljs-symbol">:[]</span>,<span class="hljs-string">"metricList"</span><span class="hljs-symbol">:</span>[{<span class="hljs-string">"lightDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"aggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"toSql"</span></span>,<span class="hljs-string">"middleAggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"DEFAULT"</span></span>,<span class="hljs-string">"extendDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867"</span></span>,<span class="hljs-string">"staticDecorateIdListCombination"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"metricDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">19872</span>,<span class="hljs-string">"nameEnAtomic"</span><span class="hljs-symbol">:null</span>,<span class="hljs-string">"extendFunctionIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"25,6,5,7,23,22,20,21,19,18,4,1,2,3,24"</span></span>},{<span class="hljs-string">"lightDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"aggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"toSql"</span></span>,<span class="hljs-string">"middleAggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"DEFAULT"</span></span>,<span class="hljs-string">"extendDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867"</span></span>,<span class="hljs-string">"staticDecorateIdListCombination"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"metricDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">19873</span>,<span class="hljs-string">"nameEnAtomic"</span><span class="hljs-symbol">:null</span>,<span class="hljs-string">"extendFunctionIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"25,6,5,7,23,22,20,21,19,18,4,1,2,3,24"</span></span>},{<span class="hljs-string">"lightDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"aggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"toSql"</span></span>,<span class="hljs-string">"middleAggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"DEFAULT"</span></span>,<span class="hljs-string">"extendDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867"</span></span>,<span class="hljs-string">"staticDecorateIdListCombination"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"metricDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">19875</span>,<span class="hljs-string">"nameEnAtomic"</span><span class="hljs-symbol">:null</span>,<span class="hljs-string">"extendFunctionIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"25,6,5,7,23,22,20,21,19,18,4,1,2,3,24"</span></span>},{<span class="hljs-string">"lightDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"aggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"toSql"</span></span>,<span class="hljs-string">"middleAggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"DEFAULT"</span></span>,<span class="hljs-string">"extendDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867"</span></span>,<span class="hljs-string">"staticDecorateIdListCombination"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"metricDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">19945</span>,<span class="hljs-string">"nameEnAtomic"</span><span class="hljs-symbol">:null</span>,<span class="hljs-string">"extendFunctionIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"25,6,5,7,23,22,20,21,19,18,4,1,2,3,24"</span></span>},{<span class="hljs-string">"lightDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"aggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"toSql"</span></span>,<span class="hljs-string">"middleAggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"DEFAULT"</span></span>,<span class="hljs-string">"extendDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867"</span></span>,<span class="hljs-string">"staticDecorateIdListCombination"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"metricDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">17263</span>,<span class="hljs-string">"nameEnAtomic"</span><span class="hljs-symbol">:null</span>,<span class="hljs-string">"extendFunctionIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"25,6,5,7,23,22,20,21,19,18,4,1,2,3,24"</span></span>},{<span class="hljs-string">"lightDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"aggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"COUNT_DISTINCT"</span></span>,<span class="hljs-string">"middleAggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"DEFAULT"</span></span>,<span class="hljs-string">"extendDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867"</span></span>,<span class="hljs-string">"staticDecorateIdListCombination"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"metricDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">28017</span>,<span class="hljs-string">"nameEnAtomic"</span><span class="hljs-symbol">:null</span>,<span class="hljs-string">"extendFunctionIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"25,6,5,7,23,22,20,21,19,18,4,1,2,3,24"</span></span>},{<span class="hljs-string">"lightDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"aggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"toSql"</span></span>,<span class="hljs-string">"middleAggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"DEFAULT"</span></span>,<span class="hljs-string">"extendDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867"</span></span>,<span class="hljs-string">"staticDecorateIdListCombination"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"metricDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">20242</span>,<span class="hljs-string">"nameEnAtomic"</span><span class="hljs-symbol">:null</span>,<span class="hljs-string">"extendFunctionIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"25,6,5,7,23,22,20,21,19,18,4,1,2,3,24"</span></span>},{<span class="hljs-string">"lightDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"aggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"toSql"</span></span>,<span class="hljs-string">"middleAggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"DEFAULT"</span></span>,<span class="hljs-string">"extendDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867"</span></span>,<span class="hljs-string">"staticDecorateIdListCombination"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"metricDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">18450</span>,<span class="hljs-string">"nameEnAtomic"</span><span class="hljs-symbol">:null</span>,<span class="hljs-string">"extendFunctionIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"25,6,5,7,23,22,20,21,19,18,4,1,2,3,24"</span></span>},{<span class="hljs-string">"lightDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"aggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"toSql"</span></span>,<span class="hljs-string">"middleAggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"DEFAULT"</span></span>,<span class="hljs-string">"extendDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867"</span></span>,<span class="hljs-string">"staticDecorateIdListCombination"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"metricDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">20276</span>,<span class="hljs-string">"nameEnAtomic"</span><span class="hljs-symbol">:null</span>,<span class="hljs-string">"extendFunctionIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"25,6,5,7,23,22,20,21,19,18,4,1,2,3,24"</span></span>},{<span class="hljs-string">"lightDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"aggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"toSql"</span></span>,<span class="hljs-string">"middleAggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"DEFAULT"</span></span>,<span class="hljs-string">"extendDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867"</span></span>,<span class="hljs-string">"staticDecorateIdListCombination"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"metricDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">18452</span>,<span class="hljs-string">"nameEnAtomic"</span><span class="hljs-symbol">:null</span>,<span class="hljs-string">"extendFunctionIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"25,6,5,7,23,22,20,21,19,18,4,1,2,3,24"</span></span>},{<span class="hljs-string">"lightDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"aggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"toSql"</span></span>,<span class="hljs-string">"middleAggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"DEFAULT"</span></span>,<span class="hljs-string">"extendDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867"</span></span>,<span class="hljs-string">"staticDecorateIdListCombination"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"metricDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">18453</span>,<span class="hljs-string">"nameEnAtomic"</span><span class="hljs-symbol">:null</span>,<span class="hljs-string">"extendFunctionIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"25,6,5,7,23,22,20,21,19,18,4,1,2,3,24"</span></span>},{<span class="hljs-string">"lightDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"aggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"toSql"</span></span>,<span class="hljs-string">"middleAggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"DEFAULT"</span></span>,<span class="hljs-string">"extendDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867"</span></span>,<span class="hljs-string">"staticDecorateIdListCombination"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"metricDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">18456</span>,<span class="hljs-string">"nameEnAtomic"</span><span class="hljs-symbol">:null</span>,<span class="hljs-string">"extendFunctionIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"25,6,5,7,23,22,20,21,19,18,4,1,2,3,24"</span></span>},{<span class="hljs-string">"lightDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"aggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"toSql"</span></span>,<span class="hljs-string">"middleAggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"DEFAULT"</span></span>,<span class="hljs-string">"extendDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867"</span></span>,<span class="hljs-string">"staticDecorateIdListCombination"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"metricDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">19866</span>,<span class="hljs-string">"nameEnAtomic"</span><span class="hljs-symbol">:null</span>,<span class="hljs-string">"extendFunctionIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"25,6,5,7,23,22,20,21,19,18,4,1,2,3,24"</span></span>},{<span class="hljs-string">"lightDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"aggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"toSql"</span></span>,<span class="hljs-string">"middleAggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"DEFAULT"</span></span>,<span class="hljs-string">"extendDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867"</span></span>,<span class="hljs-string">"staticDecorateIdListCombination"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"metricDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">21691</span>,<span class="hljs-string">"nameEnAtomic"</span><span class="hljs-symbol">:null</span>,<span class="hljs-string">"extendFunctionIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"25,6,5,7,23,22,20,21,19,18,4,1,2,3,24"</span></span>},{<span class="hljs-string">"lightDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"aggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"toSql"</span></span>,<span class="hljs-string">"middleAggregationType"</span><span class="hljs-symbol">:<span class="hljs-string">"DEFAULT"</span></span>,<span class="hljs-string">"extendDecorateIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867"</span></span>,<span class="hljs-string">"staticDecorateIdListCombination"</span><span class="hljs-symbol">:<span class="hljs-string">""</span></span>,<span class="hljs-string">"metricDefId"</span><span class="hljs-symbol">:</span><span class="hljs-number">19871</span>,<span class="hljs-string">"nameEnAtomic"</span><span class="hljs-symbol">:null</span>,<span class="hljs-string">"extendFunctionIdList"</span><span class="hljs-symbol">:<span class="hljs-string">"25,6,5,7,23,22,20,21,19,18,4,1,2,3,24"</span></span>}],<span class="hljs-string">"driveLogicTable"</span><span class="hljs-symbol">:<span class="hljs-string">"{"</span>dimensionType<span class="hljs-string">":"</span>DETAIL<span class="hljs-string">","</span>oldNameCn<span class="hljs-string">":"</span></span>ä¸ƒé²œå®æ—¶äº¤æ˜“_foråœ°æ¨ä¸­é—´æ€æ–°è€æ ‡å¿—<span class="hljs-string">","</span>atomicAliasProd<span class="hljs-string">":"</span>prod<span class="hljs-string">","</span>implServiceTypeKey<span class="hljs-string">":"</span>realtime<span class="hljs-string">","</span>originPhysicDataSourceId<span class="hljs-string">":0,"</span>nameCn<span class="hljs-string">":"</span>ä¸ƒé²œå®æ—¶äº¤æ˜“_foråœ°æ¨ä¸­é—´æ€æ–°è€æ ‡å¿—<span class="hljs-string">","</span>description<span class="hljs-string">":"</span>ä¸ƒé²œå®æ—¶äº¤æ˜“_foråœ°æ¨ä¸­é—´æ€æ–°è€æ ‡å¿—<span class="hljs-string">","</span>driveLogicTableId<span class="hljs-string">":9881,"</span>driveLogicTableEnv<span class="hljs-string">":"</span><span class="hljs-variable constant_">DEV</span><span class="hljs-string">","</span>commonDecorateIdList<span class="hljs-string">":"</span><span class="hljs-number">9665</span>,<span class="hljs-number">3269</span>,<span class="hljs-number">3270</span>,<span class="hljs-number">3271</span>,<span class="hljs-number">4556</span>,<span class="hljs-number">8012</span>,<span class="hljs-number">8270</span>,<span class="hljs-number">6030</span>,<span class="hljs-number">7247</span>,<span class="hljs-number">6031</span>,<span class="hljs-number">7248</span>,<span class="hljs-number">6032</span>,<span class="hljs-number">7249</span>,<span class="hljs-number">6033</span>,<span class="hljs-number">7250</span>,<span class="hljs-number">6034</span>,<span class="hljs-number">6035</span>,<span class="hljs-number">2134</span>,<span class="hljs-number">7254</span>,<span class="hljs-number">7255</span>,<span class="hljs-number">2085</span>,<span class="hljs-number">619</span>,<span class="hljs-number">620</span>,<span class="hljs-number">5997</span>,<span class="hljs-number">1586</span>,<span class="hljs-number">7867</span>,<span class="hljs-number">6845</span><span class="hljs-string">","</span>atomicAliasPre<span class="hljs-string">":"</span>pre<span class="hljs-string">","</span>committer<span class="hljs-string">":"</span>panjingrong<span class="hljs-string">","</span>physicDataSourceId<span class="hljs-string">":9494,"</span>storageType<span class="hljs-string">":"</span><span class="hljs-variable constant_">ONLINE</span><span class="hljs-string">","</span>atomicAliasDev<span class="hljs-string">":"</span>pre<span class="hljs-string">"}"</span>,<span class="hljs-string">"atomicServiceId"</span><span class="hljs-symbol">:</span><span class="hljs-number">1088</span>},<span class="hljs-string">"pin"</span><span class="hljs-symbol">:<span class="hljs-string">"wanyue3"</span></span>}
</code></pre>
<p>å…±è®¡15ä¸ªæŒ‡æ ‡ï¼Œ64ä¸ªç»´åº¦</p>


















































































<table><thead><tr><th>è¯·æ±‚1(äº‹åŠ¡)</th><th>è¯·æ±‚2(äº‹åŠ¡)</th><th>ï»¿</th><th/><th/></tr></thead><tbody><tr><td>21:06:17.262</td><td>è¿›å…¥åŒæ­¥æ–¹æ³•</td><td>21:06:17.263</td><td>è¿›å…¥åŒæ­¥æ–¹æ³•</td><td>ï»¿</td></tr><tr><td>21:06:17.063</td><td>select unify_metric_impl where logic_id = 3245 æŸ¥è¯¢å‡º15æ¡æ•°æ®(å¿«ç…§è¯»ï¼Œreadview1)</td><td>21:06:17.363</td><td>select unify_metric_impl where logic_id = 3245 æŸ¥è¯¢å‡º15æ¡æ•°æ®(å¿«ç…§è¯»ï¼Œreadview2)</td><td>ï»¿</td></tr><tr><td>21:06:17.363</td><td>delete from unify_metric_impl where logic_id = 3245</td><td>21:06:17.372</td><td>delete from unify_metric_impl where logic_id = 3245</td><td>ï»¿</td></tr><tr><td>21:06:17.459</td><td>select unify_metric_impl where logic_id = 3245 æŸ¥è¯¢å‡º0æ¡æ•°æ®</td><td>ï»¿</td><td>delete ç”±äºlogic_idä¸æ˜¯ç´¢å¼•ï¼Œä¼šè¡¨é”é˜»å¡</td><td>ï»¿</td></tr><tr><td>21:06:18.459</td><td>insert into unify_metric_impl æ’å…¥çš„logic_id = 3245çš„æ•°æ®ï¼Œ15æ¡</td><td>ï»¿</td><td>ï»¿</td><td>ï»¿</td></tr><tr><td>21:06:19.408</td><td>æ–¹æ³•ç»“æŸ</td><td>ï»¿</td><td>ï»¿</td><td>ï»¿</td></tr><tr><td>ï»¿</td><td>ï»¿</td><td>21:06:19.529</td><td>åˆ é™¤æˆåŠŸ</td><td>ï»¿</td></tr><tr><td>ï»¿</td><td>ï»¿</td><td>21:06:20.362</td><td>select unify_metric_impl where logic_id = 3245 å¾—åˆ° 15æ¡æ•°æ®</td><td>ï»¿</td></tr><tr><td>ï»¿</td><td>ï»¿</td><td>21:06:20.435</td><td>è¯»å‡º15æ¡æ•°æ®ï¼Œæ¯”è¾ƒæœ¬æ¬¡æ˜¯å¦æœ‰æ–°å¢æŒ‡æ ‡ï¼Œ å¾—å‡ºæ²¡æœ‰æ–°å¢æŒ‡æ ‡ï¼Œå› æ­¤ä¸è¿›è¡Œæ–°å¢ã€‚addAtomicMetricNameForDrive addList empty</td><td>ï»¿</td></tr><tr><td>ï»¿</td><td>ï»¿</td><td>21:06:21.435</td><td>æ–¹æ³•ç»“æŸ</td><td>ï»¿</td></tr></tbody></table>
<p>ï»¿</p>
<p><strong>æ ¸å¿ƒç»“è®ºç‚¹</strong>ï¼š</p>
<p>1.è¯·æ±‚2çš„åˆ é™¤æ“ä½œè¢«é˜»å¡äº†ï¼Œç›´åˆ°è¯·æ±‚1æ‰§è¡Œå®Œæ•´ä¸ªæ–¹æ³•ã€‚</p>
<p>2.è¯·æ±‚2ä¸­å»æŸ¥çœ‹å½“å‰å®ç°çš„æŒ‡æ ‡çš„æ—¶å€™ï¼Œå‘ç°åº“é‡Œå·²ç»å­˜åœ¨æ‰€æœ‰æŒ‡æ ‡ä¸ä¼šè¿›è¡Œæ–°å¢ï¼Œä¸ä¸Šä¸€æ­¥åˆ é™¤çš„é€»è¾‘ç›¸æ‚–ã€‚</p>
<p>ï»¿</p>
<h2 data-id="heading-2">3ã€ç»“è®ºç‚¹æ·±åº¦å‰–æ</h2>
<h3 data-id="heading-3">3.1 åˆ†æç»“è®ºä¸€</h3>
<p>è¯·æ±‚2çš„åˆ é™¤æ“ä½œè¢«é˜»å¡äº†ï¼Œç›´åˆ°è¯·æ±‚1æ‰§è¡Œå®Œæ•´ä¸ªæ–¹æ³•ã€‚</p>
<h4 data-id="heading-4">3.1.1 å¤ä¹ mysqlçš„InnoDBé”æœºåˆ¶</h4>
<h5 data-id="heading-5">3.1.1.1 ä¸æ˜¯â€œä¸€æŠŠé”â€ï¼Œè€Œæ˜¯ â€œé”çŸ©é˜µâ€</h5>



































<table><thead><tr><th>é”ç²’åº¦</th><th>å…±äº«é”ï¼ˆS é”ï¼‰ ï¼ˆè¯»é”ï¼Œå…è®¸å¤šè¯»ï¼‰</th><th>æ’ä»–é”ï¼ˆX é”ï¼‰ ï¼ˆå†™é”ï¼Œç‹¬å ï¼‰</th><th>æ„å‘é”ï¼ˆè¡¨çº§ï¼Œè¾…åŠ©åˆ¤æ–­ï¼‰</th></tr></thead><tbody><tr><td><strong>è¡¨çº§</strong></td><td>è¡¨ S é”ï¼ˆæå°‘ç”¨ï¼Œå¦‚<code>LOCK TABLES ... READ</code>ï¼‰</td><td>è¡¨ X é”ï¼ˆæå°‘ç”¨ï¼Œå¦‚<code>LOCK TABLES ... WRITE</code>ï¼‰</td><td>æ„å‘ S é”ï¼ˆISï¼‰ã€æ„å‘ X é”ï¼ˆIXï¼‰</td></tr><tr><td><strong>è¡Œçº§</strong></td><td>è¡Œ S é”ï¼ˆ<code>SELECT ... FOR SHARE</code>ï¼‰</td><td>è¡Œ X é”ï¼ˆ<code>UPDATE/DELETE/INSERT</code>é»˜è®¤åŠ ï¼‰</td><td>ï¼ˆè¡Œé”æ— éœ€æ„å‘é”ï¼‰</td></tr><tr><td><strong>é—´éš™çº§</strong></td><td>é—´éš™ S é”ï¼ˆæ— ï¼Œé—´éš™åªé˜²æ’å…¥ï¼‰</td><td>é—´éš™ X é”ï¼ˆé˜²å…¶ä»–äº‹åŠ¡æ’å…¥ç›¸åŒé—´éš™ï¼‰</td><td>æ— </td></tr><tr><td><strong>Next-Key</strong></td><td>æ— </td><td>Next-Key é”ï¼ˆè¡Œé” + é—´éš™é”ï¼Œé»˜è®¤è¡Œé”ç®—æ³•ï¼‰</td><td>æ— </td></tr></tbody></table>
<p>ï»¿</p>
<h5 data-id="heading-6">3.1.1.2 ä¸€å¼ å›¾æ€»ç»“ï¼šInnoDB é”çš„ â€œå†³ç­–é€»è¾‘â€</h5>
<p>ï»¿</p>
<p>ï»¿</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a63fcb8e5894899b983a55a5591fa44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763366301&amp;x-signature=fE70zOi0aQzyezxUrKWq8xYzwMc%3D" alt="" loading="lazy"/></p>
<p>ï»¿ï»¿</p>
<p>ï»¿</p>
<h4 data-id="heading-7">3.1.2 ç†è®ºåº”ç”¨å®è·µ</h4>
<h5 data-id="heading-8">3.1.2.1 æœ¬æ¬¡äº‹æ•…çš„ç‰©æ–™ï¼š</h5>
<p>mysqlè¡¨ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">CREATE</span> <span class="hljs-selector-tag">TABLE</span> `<span class="hljs-selector-tag">unify_metric_impl</span>` (
  <span class="hljs-built_in">`id`</span> <span class="hljs-built_in">bigint</span>(<span class="hljs-number">50</span>) unsigned <span class="hljs-keyword">NOT</span> NULL AUTO_INCREMENT COMMENT <span class="hljs-string">'è‡ªå¢ID'</span>,
  <span class="hljs-built_in">`metric_def_id`</span> <span class="hljs-built_in">bigint</span>(<span class="hljs-number">11</span>) unsigned <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'æŒ‡æ ‡å®šä¹‰id'</span>,
  <span class="hljs-built_in">`logic_table_id`</span> <span class="hljs-built_in">bigint</span>(<span class="hljs-number">11</span>) unsigned <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'é€»è¾‘è¡¨id'</span>,
  <span class="hljs-built_in">`name_en_atomic`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'çœŸå®æŒ‡æ ‡å'</span>,
  <span class="hljs-built_in">`committer`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'è´Ÿè´£äºº'</span>,
  <span class="hljs-built_in">`create_time`</span> timestamp <span class="hljs-keyword">NOT</span> NULL DEFAULT CURRENT_TIMESTAMP COMMENT <span class="hljs-string">'å¼€å§‹æ—¶é—´'</span>,
  <span class="hljs-built_in">`update_time`</span> timestamp <span class="hljs-keyword">NOT</span> NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT <span class="hljs-string">'ä¿®æ”¹æ—¶é—´'</span>,
  <span class="hljs-built_in">`metric_atomic_name_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'åŸå­æŒ‡æ ‡id'</span>,
  <span class="hljs-built_in">`decorate_id_list_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'ä¿®é¥°åˆ—è¡¨'</span>,
  <span class="hljs-built_in">`name_cn_alias_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'ä¸­æ–‡åˆ«å'</span>,
  <span class="hljs-built_in">`metric_type_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'æŒ‡æ ‡ç±»å‹ï¼šDERIVE è¡ç”ŸæŒ‡æ ‡ï¼ŒFORMULA å¤åˆæŒ‡æ ‡'</span>,
  <span class="hljs-built_in">`description_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'æŒ‡æ ‡è¯´æ˜'</span>,
  <span class="hljs-built_in">`data_type_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'æ•°æ®ç±»å‹ï¼šSTRINGï¼ŒDOUBLE, LONG, INT'</span>,
  <span class="hljs-built_in">`data_accuracy_temp`</span> <span class="hljs-built_in">tinyint</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">'2'</span> COMMENT <span class="hljs-string">'æ•°æ®ç²¾åº¦-å°æ•°ç‚¹åå‡ ä½'</span>,
  <span class="hljs-built_in">`security_level_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) DEFAULT <span class="hljs-string">'-1'</span> COMMENT <span class="hljs-string">'å®‰å…¨ç­‰çº§'</span>,
  <span class="hljs-built_in">`logic_table_id_excel_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) DEFAULT <span class="hljs-string">'-1'</span> COMMENT <span class="hljs-string">'æ¨¡å‹excelId'</span>,
  <span class="hljs-built_in">`implement_type`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'æŒ‡æ ‡å®ç°ç±»å‹ï¼šAPPã€ATOMIC åŸå­æœåŠ¡'</span>,
  <span class="hljs-built_in">`app_ori_metric_name_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'æ‰€ä¾èµ–çš„appå±‚åŸå§‹åå­—ï¼ˆé€‚ç”¨äºå¯¼æ•°ä»»åŠ¡æ”¹å˜å­—æ®µçš„æƒ…å†µï¼‰'</span>,
  <span class="hljs-built_in">`name_en_depend_atomic`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'æŒ‡æ ‡ä¾èµ–å­—æ®µ'</span>,
  <span class="hljs-built_in">`name_en_depend_app`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'æ‰€ä¾èµ–çš„appå±‚åŸå§‹åå­—ï¼ˆé€‚ç”¨äºå¯¼æ•°ä»»åŠ¡æ”¹å˜å­—æ®µçš„æƒ…å†µï¼‰'</span>,
  <span class="hljs-built_in">`update_status`</span> <span class="hljs-built_in">tinyint</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'ä¿¡æ¯æ›´æ–°çŠ¶æ€ 0-æœªå®Œæˆæ›´æ–°ï¼Œ1-å®Œæˆæ›´æ–°'</span>,
  <span class="hljs-built_in">`status`</span> <span class="hljs-built_in">tinyint</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'ä¿¡æ¯æ›´æ–°çŠ¶æ€ 0-æœªå®Œæˆæ›´æ–°ï¼Œ1-å®Œæˆæ›´æ–°'</span>,
  <span class="hljs-built_in">`light_decorate_id_list`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">1024</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'ç‚¹ç¯ä¿®é¥°idåˆ—è¡¨'</span>,
  <span class="hljs-built_in">`extend_decorate_id_list`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">1024</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'æ”¯æŒçš„åŠ¨æ€ä¿®é¥°idåˆ—è¡¨'</span>,
  <span class="hljs-built_in">`extend_function_id_list`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">1024</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'æ”¯æŒçš„åŸå­æœåŠ¡å‡½æ•°idåˆ—è¡¨'</span>,
  <span class="hljs-built_in">`aggregation_type`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'èšåˆç±»å‹:ORIGINAL åŸå€¼ COUNT è®¡æ•° DISTINCT æŒ‡å®šå­—æ®µå»é‡ SUM æ±‚å’Œ AVG  å‡å€¼ MIN æ±‚æœ€å¤§å€¼ MAX æ±‚æœ€å°å€¼ QUANTITLE æ±‚åˆ†ä½æ•°'</span>,
  <span class="hljs-built_in">`middle_aggregation_type`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">30</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'ä¸­é—´å±‚ç±»å‹,UNKNOWN:æœªçŸ¥,AGG_BY_FIELD:æŒ‰èšåˆå­—æ®µåˆ†ç»„åèšåˆ,AGG_BY_DAY:æŒ‰å¤©å»é‡åç´¯åŠ '</span>,
  <span class="hljs-built_in">`static_decorate_id_list_combination`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">1024</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'æ”¯æŒçš„å›ºåŒ–ä¿®é¥°idåˆ—è¡¨ç»„åˆ,[[d1,d2],[d2]]'</span>,
  PRIMARY KEY (<span class="hljs-built_in">`id`</span>),
  KEY <span class="hljs-built_in">`idx_metric_def_id`</span> (<span class="hljs-built_in">`metric_def_id`</span>,<span class="hljs-built_in">`logic_table_id`</span>)
) <span class="hljs-selector-tag">ENGINE</span>=<span class="hljs-selector-tag">InnoDB</span> <span class="hljs-selector-tag">DEFAULT</span> <span class="hljs-selector-tag">CHARSET</span>=<span class="hljs-selector-tag">utf8</span> <span class="hljs-selector-tag">COMMENT</span>='æŒ‡æ ‡å®ç°';
</code></pre>
<h5 data-id="heading-9">3.1.2.2 å®è·µåˆ†æ</h5>
<p>é€šè¿‡mysqlçš„innoDBçš„é”å†³ç­–ï¼Œå¯ä»¥å¾—å‡º</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">//åˆ é™¤å…³è”æŒ‡æ ‡</span>
 <span class="hljs-selector-tag">metricImplMapper</span><span class="hljs-selector-class">.deleteByLogicTableIds</span>(Collections.<span class="hljs-built_in">singletonList</span>(logicId));
</code></pre>

<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function">delete <span class="hljs-keyword">from</span> unify_metric_impl <span class="hljs-keyword">where</span> logic_table_id <span class="hljs-title">in</span> (<span class="hljs-params"><span class="hljs-number">45631</span></span>)</span>;
</code></pre>
<p>mysqlçš„ç´¢å¼•ï¼šKEY <code>idx_metric_def_id</code> (<code>metric_def_id</code>,<code>logic_table_id</code>)</p>
<p>åˆ é™¤å†™æ“ä½œï¼Œä¸ç¬¦åˆæœ€å·¦åŒ¹é…åŸåˆ™ï¼Œå› æ­¤ä¸ºè¡¨xé”ã€‚</p>
<p>ï»¿</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99194a4d15d54c0191109be0686aee3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763366301&amp;x-signature=0yUr5CBGAqfBkmNs%2F%2Fhvd9R7yVg%3D" alt="" loading="lazy"/></p>
<p>ï»¿ï»¿</p>
<p>å› æ­¤è¯·æ±‚2çš„åˆ é™¤æ“ä½œéœ€è¦ç­‰å¾…è¯·æ±‚1çš„äº‹åŠ¡é‡Šæ”¾è¡¨é”åæ‰å¯ç»§ç»­è¿›è¡Œï¼Œç¬¦åˆå½“æ—¶åœºæ™¯ã€‚</p>
<p>ï»¿</p>
<h3 data-id="heading-10">3.2 åˆ†æç»“è®ºäºŒ</h3>
<p>è¯·æ±‚2ä¸­å»æŸ¥çœ‹å½“å‰å®ç°çš„æŒ‡æ ‡çš„æ—¶å€™ï¼Œå‘ç°åº“é‡Œå·²ç»å­˜åœ¨æ‰€æœ‰æŒ‡æ ‡ä¸ä¼šè¿›è¡Œæ–°å¢ï¼Œä¸ä¸Šä¸€æ­¥åˆ é™¤çš„é€»è¾‘ç›¸æ‚–ã€‚</p>
<h4 data-id="heading-11">3.2.1 å¤ä¹ Mysqlçš„äº‹åŠ¡</h4>
<h5 data-id="heading-12">3.2.1.1 ACID ä¸æ˜¯ "å››ä¸ªç‹¬ç«‹ç‰¹æ€§"ï¼Œè€Œæ˜¯ "å› æœé“¾"</h5>
<p>ï»¿</p>
<p>ï»¿</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5dd42117c88e478ca165db2bec4947f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763366301&amp;x-signature=GauWe4zg0sQbWvYSqOG%2FMF6Mm4Q%3D" alt="" loading="lazy"/></p>
<p>ï»¿ï»¿</p>
<p>â€¢<strong>ä¸€å¥è¯</strong>ï¼šACID çš„æ ¸å¿ƒæ˜¯<strong>ä¸€è‡´æ€§</strong>ï¼Œå…¶ä»–ä¸‰ä¸ªç‰¹æ€§éƒ½æ˜¯ä¸ºäº†å®ç°å®ƒçš„æ‰‹æ®µã€‚</p>
<p>â€¢<strong>ä¸€è‡´æ€§</strong>ï¼ˆConsistencyï¼‰ï¼šä¸€è‡´æ€§ç¡®ä¿äº‹åŠ¡å°†æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€è½¬å˜åˆ°å¦ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€ã€‚å³ä½¿åœ¨å¤šä¸ªäº‹åŠ¡åŒæ—¶æ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œæ•°æ®åº“ä¹Ÿèƒ½ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ã€‚</p>
<p>â€¢<strong>åŸå­æ€§</strong>ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡æ˜¯ "ä¸å¯åˆ†å‰²çš„å·¥ä½œå•å…ƒ"ï¼ˆè¦ä¹ˆå…¨æˆï¼Œè¦ä¹ˆå…¨è´¥ï¼‰ï¼Œæ˜¯ä¸€è‡´æ€§çš„<strong>å‰æ</strong>ï¼ˆå¦‚æœæ­¥éª¤èƒ½æ‹†åˆ†ï¼Œä¸­é—´å¤±è´¥å°±ä¼šç ´åä¸€è‡´æ€§ï¼‰ã€‚</p>
<p>â€¢<strong>éš”ç¦»æ€§</strong>ï¼ˆIsolationï¼‰ï¼šé€šè¿‡æ§åˆ¶å¤šäº‹åŠ¡å¹¶å‘è§„åˆ™ï¼Œé¿å…äº’ç›¸å¹²æ‰°ï¼Œæ˜¯ä¸€è‡´æ€§çš„<strong>ä¿éšœ</strong>ï¼ˆå¹¶å‘æ··ä¹±ä¼šç›´æ¥ç ´åä¸€è‡´æ€§ï¼‰ã€‚</p>
<p>â€¢<strong>è€ä¹…æ€§</strong>ï¼ˆDurabilityï¼‰ï¼šäº‹åŠ¡æäº¤åç»“æœæ°¸ä¹…ä¿å­˜ï¼Œæ˜¯ä¸€è‡´æ€§çš„<strong>æœ€ç»ˆè½ç‚¹</strong>ï¼ˆå¦åˆ™é‡å¯åæ•°æ®ä¸¢å¤±ï¼Œä¹‹å‰çš„ä¸€è‡´æ€§ç™½æ­ï¼‰ã€‚</p>
<p>ï»¿</p>
<h5 data-id="heading-13">3.2.1.2 éš”ç¦»çº§åˆ«ï¼šä¸æ˜¯ "è¶Šä¸¥è¶Šå¥½"ï¼Œè€Œæ˜¯ "æˆæœ¬ä¸éœ€æ±‚çš„å¹³è¡¡æœ¯"</h5>
<p>InnoDB çš„ 4 ç§éš”ç¦»çº§åˆ«ï¼Œæœ¬è´¨æ˜¯ç”¨ "æ•°æ®å¯è§æ€§" æ¢ "å¹¶å‘æ€§èƒ½"çš„é€‰æ‹©ï¼š</p>








































<table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th>è§£å†³çš„é—®é¢˜</th><th>æ— æ³•è§£å†³çš„é—®é¢˜</th><th>æ€§èƒ½æ¶ˆè€—</th><th>å…¸å‹åœºæ™¯</th></tr></thead><tbody><tr><td>è¯»æœªæäº¤ï¼ˆRUï¼‰</td><td>æ— </td><td>è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»</td><td>æä½</td><td>å®æ—¶ç›‘æ§ï¼ˆå…è®¸è„æ•°æ®ï¼‰</td></tr><tr><td>è¯»å·²æäº¤ï¼ˆRCï¼‰</td><td>è„è¯»</td><td>ä¸å¯é‡å¤è¯»ã€å¹»è¯»</td><td>ä½</td><td>äº’è”ç½‘æ™®é€šä¸šåŠ¡</td></tr><tr><td>å¯é‡å¤è¯»ï¼ˆRRï¼Œé»˜è®¤ï¼‰</td><td>è„è¯»ã€ä¸å¯é‡å¤è¯»</td><td>å¹»è¯»ï¼ˆè¢« Next-Key é”è§£å†³ï¼‰</td><td>ä¸­</td><td>é‡‘èäº¤æ˜“ã€åº“å­˜ç®¡ç†</td></tr><tr><td>ä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰</td><td>æ‰€æœ‰å¹¶å‘é—®é¢˜</td><td>æ— </td><td>æé«˜</td><td>é“¶è¡Œå¯¹è´¦ï¼ˆæ— å¹¶å‘éœ€æ±‚ï¼‰</td></tr></tbody></table>
<p>ï»¿</p>
<h5 data-id="heading-14">3.2.1.3 MVCCï¼šäº‹åŠ¡çš„ "å¹³è¡Œå®‡å®™" æœºåˆ¶ï¼ˆä¸ºä»€ä¹ˆè¯»å†™ä¸å†²çªï¼Ÿï¼‰</h5>
<p>InnoDB çš„<strong>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</strong>æ˜¯ "æ— é”è¯»" çš„æ ¸å¿ƒï¼Œå®ƒè®©è¯»å’Œå†™åƒåœ¨å¹³è¡Œå®‡å®™ä¸­è¿è¡Œï¼š</p>
<p><strong>åº•å±‚é€»è¾‘ï¼ˆç”¨ "æ—¶é—´æˆ³" ç†è§£</strong>ï¼‰ï¼š</p>
<p>â€¢æ¯ä¸ªäº‹åŠ¡å¯åŠ¨æ—¶ï¼Œä¼šæ‹¿åˆ°ä¸€ä¸ª<strong>å…¨å±€é€’å¢çš„äº‹åŠ¡ IDï¼ˆtrx_idï¼‰</strong> ã€‚</p>
<p>â€¢æ¯è¡Œæ•°æ®éšè— 3 ä¸ªå­—æ®µï¼š</p>
<p>â—¦<code>DB_TRX_ID</code>ï¼šæœ€åä¿®æ”¹è¯¥è¡Œçš„äº‹åŠ¡ IDï¼›</p>
<p>â—¦<code>DB_ROLL_PTR</code>ï¼šæŒ‡å‘ undo æ—¥å¿—çš„æŒ‡é’ˆï¼ˆå­˜å‚¨å†å²ç‰ˆæœ¬ï¼‰ï¼›</p>
<p>â—¦<code>DB_DELETED</code>ï¼šæ ‡è®°æ˜¯å¦åˆ é™¤ï¼ˆé€»è¾‘åˆ é™¤ï¼‰ã€‚</p>
<p><strong>è¯»æ“ä½œçš„ "å¹»æœ¯"</strong> ï¼š</p>
<p>â€¢<strong>å¿«ç…§è¯»</strong>ï¼ˆæ™®é€š SELECTï¼‰ï¼šåªçœ‹ "äº‹åŠ¡ ID â‰¤ è‡ªå·± ID" ä¸” "æœªè¢«åˆ é™¤" çš„ç‰ˆæœ¬ï¼Œå®Œå…¨ä¸åŠ é”ã€‚ ä¾‹ï¼šäº‹åŠ¡ Aï¼ˆID=100ï¼‰æŸ¥è¯¢æ—¶ï¼Œä¼šå¿½ç•¥æ‰€æœ‰è¢« ID&gt;100 çš„äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®ã€‚</p>
<p>åŒ…å« 4 ä¸ªæ ¸å¿ƒå­—æ®µï¼š</p>
<p>â€¢<code>m_ids</code>ï¼šç”Ÿæˆ Read View æ—¶ï¼Œ<strong>å½“å‰æ´»è·ƒçš„äº‹åŠ¡ ID åˆ—è¡¨</strong>ï¼ˆæœªæäº¤çš„äº‹åŠ¡ï¼‰ã€‚</p>
<p>â€¢<code>min_trx_id</code>ï¼š<code>m_ids</code>ä¸­æœ€å°çš„äº‹åŠ¡ IDã€‚</p>
<p>â€¢<code>max_trx_id</code>ï¼šä¸‹ä¸€ä¸ªå°†è¦åˆ†é…çš„äº‹åŠ¡ IDï¼ˆéæ´»è·ƒäº‹åŠ¡ IDï¼Œä»…ç”¨äºåˆ¤æ–­ â€œæœªæ¥äº‹åŠ¡â€ï¼‰ã€‚</p>
<p>â€¢<code>creator_trx_id</code>ï¼šç”Ÿæˆè¯¥ Read View çš„äº‹åŠ¡è‡ªèº« IDã€‚</p>
<p><strong>å¯è§æ€§åˆ¤æ–­è§„åˆ™</strong>ï¼ˆä¸€æ¡è®°å½•æ˜¯å¦å¯¹å½“å‰äº‹åŠ¡å¯è§ï¼Œå–å†³äºå…¶ â€œæœ€åä¿®æ”¹äº‹åŠ¡ IDâ€ï¼Œè®°ä¸º<code>db_trx_id</code>ï¼‰ï¼š</p>
<p>1.è‹¥db_trx_id == creator_trx_idï¼šå¯è§ï¼ˆè‡ªå·±ä¿®æ”¹çš„è‡ªå·±å¯è§ï¼‰ã€‚</p>
<p>2.è‹¥db_trx_id &lt; min_trx_idï¼šå¯è§ï¼ˆä¿®æ”¹è®°å½•çš„äº‹åŠ¡åœ¨å½“å‰å¿«ç…§ç”Ÿæˆå‰å·²æäº¤ï¼‰ã€‚</p>
<p>3.è‹¥db_trx_id &gt;= max_trx_idï¼šä¸å¯è§ï¼ˆä¿®æ”¹è®°å½•çš„äº‹åŠ¡åœ¨å½“å‰å¿«ç…§ç”Ÿæˆåæ‰å¯åŠ¨ï¼‰ã€‚</p>
<p>4.è‹¥min_trx_id â‰¤ db_trx_id &lt; max_trx_idï¼š</p>
<p>â—¦è‹¥db_trx_idåœ¨m_idsä¸­ï¼šä¸å¯è§ï¼ˆè¯¥äº‹åŠ¡ä»æ´»è·ƒï¼Œæœªæäº¤ï¼‰ã€‚</p>
<p>â—¦è‹¥db_trx_idä¸åœ¨m_idsä¸­ï¼šå¯è§ï¼ˆè¯¥äº‹åŠ¡å·²æäº¤ï¼‰ã€‚</p>
<p>5.å½“å‰è¯»ï¼ˆåŠ é”è¯» / å†™æ“ä½œï¼‰ï¼šè¯»å–æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶åŠ é”é˜²æ­¢å…¶ä»–äº‹åŠ¡ä¿®æ”¹ã€‚</p>
<h5 data-id="heading-15">3.2.1.4 äº‹åŠ¡æ—¥å¿—ï¼šInnoDB çš„ "å®‰å…¨ä¸æ€§èƒ½" å¹³è¡¡æœ¯</h5>
<p>äº‹åŠ¡èƒ½æ—¢ä¿è¯ durability åˆä¸æ…¢ï¼Œå…¨é ä¸¤å¤§æ—¥å¿—ï¼š</p>
<p>1.<strong>redo logï¼ˆé‡åšæ—¥å¿—ï¼‰</strong> ï¼š</p>
<p>â—¦ä½œç”¨ï¼šå´©æºƒåæ¢å¤æœªå†™å…¥ç£ç›˜çš„æ•°æ®ï¼ˆä¿è¯ durabilityï¼‰ã€‚</p>
<p>â—¦åç›´è§‰ï¼šäº‹åŠ¡æäº¤æ—¶ï¼Œæ•°æ®å…ˆå†™ redo logï¼ˆå†…å­˜ + ç£ç›˜ï¼‰ï¼Œå†å¼‚æ­¥åˆ·åˆ°æ•°æ®æ–‡ä»¶ï¼ˆè¿™å« WAL æŠ€æœ¯ï¼‰ã€‚</p>
<p>â—¦ä¸ºä»€ä¹ˆå¿«ï¼Ÿredo log æ˜¯<strong>é¡ºåºå†™</strong>ï¼ˆç£ç›˜é¡ºåºå†™æ¯”éšæœºå†™å¿« 100 å€ +ï¼‰ã€‚</p>
<p>2.<strong>undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰</strong> ï¼š</p>
<p>â—¦ä½œç”¨ï¼šä¿å­˜æ•°æ®ä¿®æ”¹å‰çš„ç‰ˆæœ¬ï¼Œç”¨äºäº‹åŠ¡å›æ»šï¼ˆä¿è¯ atomicityï¼‰å’Œ MVCC å¿«ç…§è¯»ã€‚</p>
<p>â—¦æ³¨æ„ï¼šundo log ä¼šè¢« purge çº¿ç¨‹å®šæœŸæ¸…ç†ï¼ˆå½“æ²¡æœ‰äº‹åŠ¡éœ€è¦æ—§ç‰ˆæœ¬æ—¶ï¼‰ã€‚</p>
<h5 data-id="heading-16">3.2.1.5 ç»ˆæå¿ƒæ³•ï¼šäº‹åŠ¡è®¾è®¡çš„ "3 ä¸ªå‡¡æ˜¯"</h5>
<p>1.<strong>å‡¡æ˜¯ä¸éœ€è¦äº‹åŠ¡çš„æ“ä½œï¼Œåšå†³ä¸ç”¨</strong>ï¼ˆå¦‚æ—¥å¿—æ’å…¥å¯å…³é—­è‡ªåŠ¨æäº¤ï¼Œæ‰¹é‡æäº¤ï¼‰ã€‚</p>
<p>2.<strong>å‡¡æ˜¯èƒ½åœ¨ RC è§£å†³çš„ï¼Œç»ä¸å‡ RR</strong>ï¼ˆäº’è”ç½‘ä¸šåŠ¡ä¼˜å…ˆé€‰ RCï¼Œç”¨ä¸šåŠ¡é€»è¾‘é˜²ä¸å¯é‡å¤è¯»ï¼‰ã€‚</p>
<p>3.<strong>å‡¡æ˜¯å¤§äº‹åŠ¡ï¼Œå¿…æ‹†åˆ†æˆ "è¯» - ç®— - å†™" ä¸‰æ­¥</strong>ï¼ˆè¯»é˜¶æ®µä¸åŠ é”ï¼Œç®—é˜¶æ®µåœ¨åº”ç”¨å±‚ï¼Œå†™é˜¶æ®µç”¨æœ€çŸ­äº‹åŠ¡åŠ é”ï¼‰ã€‚</p>
<p>è®°ä½ï¼šäº‹åŠ¡çš„æœ¬è´¨ä¸æ˜¯ "çº¦æŸ"ï¼Œè€Œæ˜¯ "å·¥å…·"â€”â€” èƒ½è§£å†³é—®é¢˜çš„æœ€ç®€å•äº‹åŠ¡ï¼Œæ‰æ˜¯æœ€å¥½çš„äº‹åŠ¡ã€‚</p>
<p>ï»¿</p>
<h4 data-id="heading-17">3.2.2 ç†è®ºåº”ç”¨å®è·µ</h4>
<h5 data-id="heading-18">3.2.2.1 æœ¬æ¬¡äº‹æ•…çš„ç‰©æ–™ï¼š</h5>
<p>è¡¨çš„äº‹åŠ¡ç­‰çº§ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">SELECT @<span class="hljs-keyword">@transaction</span>_isolation;
</code></pre>
<p>ï»¿</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e9bed606d5345bb811ff2d41995659f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763366301&amp;x-signature=S8WVV%2FOWw9D4Y6lUA3hODMHPyDE%3D" alt="" loading="lazy"/></p>
<p>ï»¿ï»¿</p>
<p>ï»¿</p>
<p>éœ€è¦åˆ é™¤çš„æŒ‡æ ‡å®ç°(æ ¹æ®å®ç°id):</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function">delete <span class="hljs-keyword">from</span> unify_metric_impl <span class="hljs-keyword">where</span> logic_table_id <span class="hljs-title">in</span> (<span class="hljs-params"><span class="hljs-number">45631</span></span>)</span>;
</code></pre>
<p>éœ€è¦æ’å…¥çš„æŒ‡æ ‡å®ç°ï¼š</p>
<pre><code class="hljs language-go" lang="go">INSERT INTO <span class="hljs-string">`unify_metric_impl`</span> (<span class="hljs-string">`id`</span>, <span class="hljs-string">`metric_def_id`</span>, <span class="hljs-string">`logic_table_id`</span>, <span class="hljs-string">`name_en_atomic`</span>, <span class="hljs-string">`committer`</span>, <span class="hljs-string">`create_time`</span>, <span class="hljs-string">`update_time`</span>, <span class="hljs-string">`metric_atomic_name_temp`</span>, <span class="hljs-string">`decorate_id_list_temp`</span>, <span class="hljs-string">`name_cn_alias_temp`</span>, <span class="hljs-string">`metric_type_temp`</span>, <span class="hljs-string">`description_temp`</span>, <span class="hljs-string">`data_type_temp`</span>, <span class="hljs-string">`data_accuracy_temp`</span>, <span class="hljs-string">`security_level_temp`</span>, <span class="hljs-string">`logic_table_id_excel_temp`</span>, <span class="hljs-string">`implement_type`</span>, <span class="hljs-string">`app_ori_metric_name_temp`</span>, <span class="hljs-string">`name_en_depend_atomic`</span>, <span class="hljs-string">`name_en_depend_app`</span>, <span class="hljs-string">`update_status`</span>, <span class="hljs-string">`status`</span>, <span class="hljs-string">`light_decorate_id_list`</span>, <span class="hljs-string">`extend_decorate_id_list`</span>, <span class="hljs-string">`extend_function_id_list`</span>, <span class="hljs-string">`aggregation_type`</span>, <span class="hljs-string">`middle_aggregation_type`</span>, <span class="hljs-string">`static_decorate_id_list_combination`</span>)
VALUES
	(<span class="hljs-number">1358195</span>, <span class="hljs-number">19872</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_user_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358196</span>, <span class="hljs-number">19873</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_sku_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358197</span>, <span class="hljs-number">19875</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_ord_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358198</span>, <span class="hljs-number">19945</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_sku_deal_ord_sku_dis_qtty_main_img_video_num'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358199</span>, <span class="hljs-number">17263</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_ord_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358200</span>, <span class="hljs-number">28017</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_bd_bd_attendance_offline__store_cnt_bd_attendance_cnt'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'COUNT_DISTINCT'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358201</span>, <span class="hljs-number">20242</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_app__ord_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358202</span>, <span class="hljs-number">18450</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_ord_amt_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358203</span>, <span class="hljs-number">20276</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_app__ord_cnt_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358204</span>, <span class="hljs-number">18452</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_sku_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358205</span>, <span class="hljs-number">18453</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_user_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358206</span>, <span class="hljs-number">18456</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_sku_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358207</span>, <span class="hljs-number">19866</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_ord_amt_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358208</span>, <span class="hljs-number">21691</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_ord_amt_include_moutai'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358209</span>, <span class="hljs-number">19871</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_sku_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>);
</code></pre>
<h5 data-id="heading-19">3.2.2.2 å®è·µåˆ†æï¼š</h5>
<p>ç”¨sqlæ¨¡æ‹Ÿä¸¤ä¸ªäº‹åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<p>äº‹åŠ¡1ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">begin;

select * <span class="hljs-keyword">from</span> unify_metric_impl umi where logic_table_id =  <span class="hljs-number">45631</span>;

<span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> unify_metric_impl where logic_table_id <span class="hljs-keyword">in</span> (<span class="hljs-number">45631</span>);

<span class="hljs-variable constant_">SELECT</span> trx_id, trx_query <span class="hljs-variable constant_">FROM</span> <span class="hljs-variable constant_">INFORMATION_SCHEMA</span>.<span class="hljs-property">INNODB_TRX</span>;

select * <span class="hljs-keyword">from</span> unify_metric_impl umi where logic_table_id =  <span class="hljs-number">45631</span>;

<span class="hljs-variable constant_">INSERT</span> <span class="hljs-variable constant_">INTO</span> <span class="hljs-string">`unify_metric_impl`</span> ( <span class="hljs-string">`metric_def_id`</span>, <span class="hljs-string">`logic_table_id`</span>, <span class="hljs-string">`name_en_atomic`</span>, <span class="hljs-string">`committer`</span>, <span class="hljs-string">`create_time`</span>, <span class="hljs-string">`update_time`</span>, <span class="hljs-string">`metric_atomic_name_temp`</span>, <span class="hljs-string">`decorate_id_list_temp`</span>, <span class="hljs-string">`name_cn_alias_temp`</span>, <span class="hljs-string">`metric_type_temp`</span>, <span class="hljs-string">`description_temp`</span>, <span class="hljs-string">`data_type_temp`</span>, <span class="hljs-string">`data_accuracy_temp`</span>, <span class="hljs-string">`security_level_temp`</span>, <span class="hljs-string">`logic_table_id_excel_temp`</span>, <span class="hljs-string">`implement_type`</span>, <span class="hljs-string">`app_ori_metric_name_temp`</span>, <span class="hljs-string">`name_en_depend_atomic`</span>, <span class="hljs-string">`name_en_depend_app`</span>, <span class="hljs-string">`update_status`</span>, <span class="hljs-string">`status`</span>, <span class="hljs-string">`light_decorate_id_list`</span>, <span class="hljs-string">`extend_decorate_id_list`</span>, <span class="hljs-string">`extend_function_id_list`</span>, <span class="hljs-string">`aggregation_type`</span>, <span class="hljs-string">`middle_aggregation_type`</span>, <span class="hljs-string">`static_decorate_id_list_combination`</span>)
<span class="hljs-variable constant_">VALUES</span>
	(<span class="hljs-number">19872</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_user_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">19873</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_sku_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">19875</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_ord_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">19945</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_sku_deal_ord_sku_dis_qtty_main_img_video_num'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">17263</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_ord_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">28017</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_bd_bd_attendance_offline__store_cnt_bd_attendance_cnt'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'COUNT_DISTINCT'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">20242</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_app__ord_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">18450</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_ord_amt_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">20276</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_app__ord_cnt_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">18452</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_sku_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">18453</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_user_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">18456</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_sku_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">19866</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_ord_amt_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">21691</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_ord_amt_include_moutai'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">19871</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_sku_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>);

commit;
</code></pre>
<p>ï»¿</p>
<p>äº‹åŠ¡2ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">begin</span>;

<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> unify_metric_impl umi <span class="hljs-keyword">where</span> logic_table_id <span class="hljs-operator">=</span>  <span class="hljs-number">45631</span>;

<span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> unify_metric_impl <span class="hljs-keyword">where</span> logic_table_id <span class="hljs-keyword">in</span> (<span class="hljs-number">45631</span>);

<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> unify_metric_impl umi <span class="hljs-keyword">where</span> logic_table_id <span class="hljs-operator">=</span>  <span class="hljs-number">45631</span>;

<span class="hljs-keyword">commit</span>;
</code></pre>
<p>ï»¿</p>
<p>æµç¨‹å›¾(ç”¨ä¸€è¡Œæ•°æ®è¿›è¡Œæ¼”ç¤ºç‰ˆæœ¬æ§åˆ¶)ï¼š</p>
<p>ï»¿</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/259104ee5b684d4cad1073bfca57cde9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763366301&amp;x-signature=FLMhTrOT5MG0zGyr571kYG0R7X4%3D" alt="" loading="lazy"/></p>
<p>ï»¿ï»¿</p>
<p>ï»¿</p>
<p>ä¸ºä½•äº‹åŠ¡1çš„selectæŸ¥è¯¢å‡ºâ€œä¸ºç©ºâ€ï¼Œäº‹åŠ¡2çš„selectæŸ¥è¯¢å‡ºâ€œä¸ä¸ºç©ºâ€ï¼š</p>






























<table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>äº‹åŠ¡ 1 æŸ¥è¯¢ï¼ˆè¯»è‡ªå·±çš„åˆ é™¤ç‰ˆæœ¬ V2ï¼‰</th><th>äº‹åŠ¡ 2 æŸ¥è¯¢ï¼ˆè¯»readviewå‰çš„V1ç‰ˆæœ¬ï¼‰</th></tr></thead><tbody><tr><td>è‡ªå·±ç”Ÿæˆçš„ç‰ˆæœ¬</td><td>V2ï¼ˆtrx_id=17190ï¼Œå·²åˆ é™¤ï¼‰</td><td>V4ï¼ˆtrx_id=17191ï¼Œå·²åˆ é™¤ï¼‰</td></tr><tr><td>å¯¹è‡ªå·±ç‰ˆæœ¬çš„å¤„ç†</td><td>å¯è§ï¼Œä¸”<strong>äº‹åŠ¡å†…éœ€åæ˜ è‡ªå·±çš„åˆ é™¤æ“ä½œ</strong>ï¼Œæ‰€ä»¥ä¸è¿½æº¯å‰é©± V1</td><td>ä¸å¯è§ï¼Œä½†<strong>å½“å‰åˆ é™¤çš„ç‰ˆæœ¬æ˜¯ç”±å…¶ä»–äº‹åŠ¡å¾—åˆ°(V3)</strong> ï¼Œå¹¶éåœ¨readviewä¹‹å‰çš„æ•°æ®ã€‚</td></tr><tr><td>è¿½æº¯çš„ç»ˆæ­¢æ¡ä»¶</td><td>é‡åˆ°è‡ªå·±ç”Ÿæˆçš„ç‰ˆæœ¬ï¼Œå³ä½¿å·²åˆ é™¤ï¼Œä¹Ÿç»ˆæ­¢è¿½æº¯</td><td>é‡åˆ°è‡ªå·±ç”Ÿæˆçš„å·²åˆ é™¤ç‰ˆæœ¬ï¼Œä½†ä¸ç¬¦åˆ"æœ‰æ•ˆåˆ é™¤"ï¼Œéœ€ç»§ç»­è¿½æº¯</td></tr><tr><td>æœ€ç»ˆè¿”å›ç»“æœ</td><td>v2ï¼ˆå·²åˆ é™¤ç‰ˆæœ¬ï¼Œåæ˜ è‡ªå·±çš„åˆ é™¤æ“ä½œï¼‰</td><td>V1ï¼ˆreadviewä¹‹å‰æœ‰æ•ˆçš„ç‰ˆæœ¬ï¼‰</td></tr></tbody></table>
<p>ï»¿</p>
<h2 data-id="heading-20">4.è§£å†³åŠæ³•</h2>
<p>ä¸ºäº†è§£å†³äº‹åŠ¡2çš„æŸ¥è¯¢"ä¸ä¸ºç©º"çš„é—®é¢˜ï¼Œåˆ†åˆ«åˆ—å‡ºä»¥ä¸‹æ–¹æ¡ˆï¼š</p>

































<table><thead><tr><th>ï»¿</th><th>è§£å†³åŠæ³•</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>å€¾å‘</th></tr></thead><tbody><tr><td>æ–¹å¼1</td><td>é’ˆå¯¹åŒä¸€ä¸ªé€»è¾‘è¡¨çš„åŒæ­¥æ·»åŠ åˆ†å¸ƒå¼é”</td><td>å®ç°æˆæœ¬ä½ï¼Œå½±å“èŒƒå›´å°</td><td>å­˜åœ¨é•¿äº‹åŠ¡çš„é—®é¢˜</td><td>çŸ­æœŸè§£æ³•</td></tr><tr><td>æ–¹å¼2</td><td>å°†äº‹åŠ¡2çš„selectæ”¹ä¸ºå½“å‰è¯»(ä½¿ç”¨slecet...for update)ï¼Œè¿™æ ·å°±èƒ½æŸ¥è¯¢å‡ºæœ€æ–°çš„æ•°æ®ä¸ºç©º</td><td>å®ç°æˆæœ¬ä½ï¼Œ</td><td>å­˜åœ¨é•¿äº‹åŠ¡çš„é—®é¢˜ï¼Œå½±å“èŒƒå›´å¤§(é•¿äº‹åŠ¡æ¶‰åŠé€»è¾‘å¤š)</td><td>ä¸æ¨è</td></tr><tr><td>æ–¹å¼3</td><td>å°†é•¿äº‹åŠ¡æ‹†åˆ†ï¼Œ <strong>"è¯» - ç®— - å†™" ä¸‰æ­¥</strong> 1. è¯»ï¼šæ— é”è¯»å–åŸå­æœåŠ¡ä¸å®ç°æ•°æ®ï¼› 2. ç®—ï¼šåœ¨åº”ç”¨å±‚å¯¹æ¯”æ–°å¢ / åˆ é™¤æ•°æ®ï¼› 3. å†™ï¼šä»…å¯¹å·®å¼‚æ•°æ®æ‰§è¡ŒçŸ­äº‹åŠ¡æ“ä½œ</td><td>ä»æ ¹æºè§£å†³é—®é¢˜</td><td>å®ç°æˆæœ¬å¤§ï¼Œé‡æ„è¯¥æ–¹æ³•</td><td>é•¿æœŸè§£æ³•</td></tr></tbody></table>
<p><strong>å½“å‰è½åœ°æƒ…å†µ</strong>ï¼šå·²é€šè¿‡ â€œåˆ†å¸ƒå¼é”æ§åˆ¶åŒä¸€é€»è¾‘è¡¨åŒæ­¥å¹¶å‘â€ çš„çŸ­æœŸæ–¹æ¡ˆè§£å†³äº‹æ•…ï¼Œåç»­å°†åœ¨ä¸šåŠ¡è¿­ä»£ä¸­æ¨è¿› â€œè¯» - ç®— - å†™â€ æ‹†åˆ†çš„é•¿æœŸä¼˜åŒ–ï¼Œè¿›ä¸€æ­¥é™ä½äº‹åŠ¡ç²’åº¦ä¸é”å†²çªé£é™©ã€‚</p>
<h2 data-id="heading-21">5.é™„å½•</h2>
<h3 data-id="heading-22">5.1åè¯è§£é‡Š</h3>
<p>äº‹å®é€»è¾‘è¡¨ï¼šç”±ç‰©ç†æ•°ä»“ä¸­çš„äº‹å®è¡¨å’Œç»´åº¦é€»è¾‘è¡¨å…³è”å½¢æˆçš„è¯­ä¹‰è¡¨ï¼Œå¯ä»¥æè¿°ä¸šåŠ¡è¿‡ç¨‹çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ˜¯æŒ‡æ ‡çš„æ•°æ®æ¥æºã€‚</p>
<p>åŸå­æœåŠ¡ï¼šæŒ‡æ ‡çš„å®ç°æ–¹å¼ï¼Œä¸€ä¸ªæŒ‡æ ‡å¯ä»¥æœ‰å¤šä¸ªå®ç°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[KuiklyUIçš„ViewRefè®¾è®¡]]></title>    <link>https://juejin.cn/post/7570902804450934794</link>    <guid>https://juejin.cn/post/7570902804450934794</guid>    <pubDate>2025-11-10T09:55:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570902804450934794" data-draft-id="7570902804450836490" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="KuiklyUIçš„ViewRefè®¾è®¡"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-11-10T09:55:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é£å†·"/> <meta itemprop="url" content="https://juejin.cn/user/3843548379091742"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            KuiklyUIçš„ViewRefè®¾è®¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3843548379091742/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é£å†·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T09:55:33.000Z" title="Mon Nov 10 2025 09:55:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">nativeRefä¸ViewRefã€AbstractBaseViewã€Pagerä»¥åŠViewContainerçš„å…³ç³»åˆ†æ</h2>
<p>æœ¬æ–‡å°†æ·±å…¥åˆ†æKuiklyUIæ¡†æ¶ä¸­nativeRefä¸ViewRefã€AbstractBaseViewã€Pagerä»¥åŠViewContainerä¸ViewRefä¹‹é—´çš„å…³ç³»ï¼Œå¸®åŠ©æ‚¨å…¨é¢ç†è§£è§†å›¾å¼•ç”¨ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€nativeRefçš„æœ¬è´¨ä¸å·¥ä½œæœºåˆ¶</h3>
<h4 data-id="heading-2">1.1 nativeRefçš„å®šä¹‰ä¸ç”Ÿæˆæœºåˆ¶</h4>
<p>nativeRefæ˜¯KuiklyUIä¸­æ¯ä¸ªè§†å›¾å®ä¾‹çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå®šä¹‰åœ¨AbstractBaseViewç±»ä¸­ï¼š</p>
<pre><code class="hljs language-kotlin:/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/AbstractBaseView.kt" lang="kotlin:/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/AbstractBaseView.kt">abstract class AbstractBaseView&lt;A : Attr, E : Event&gt; : BaseObject(), IViewPublicApi&lt;A, E&gt;, IModuleAccessor, IPagerId {
    val nativeRef: Int = ++nativeRefProducer
    // ...
    companion object {
        var nativeRefProducer = 0
    }
}
</code></pre>
<p>nativeRefé€šè¿‡ä¸€ä¸ªé™æ€è®¡æ•°å™¨<code>nativeRefProducer</code>è‡ªå¢ç”Ÿæˆï¼Œç¡®ä¿æ¯ä¸ªè§†å›¾å®ä¾‹æ‹¥æœ‰å…¨å±€å”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚è¿™ç§è®¾è®¡ä½¿å¾—æ¡†æ¶å¯ä»¥åœ¨æ•´ä¸ªåº”ç”¨ç”Ÿå‘½å‘¨æœŸå†…ç²¾ç¡®è¯†åˆ«æ¯ä¸€ä¸ªè§†å›¾ã€‚</p>
<h4 data-id="heading-3">1.2 nativeRefåœ¨è§†å›¾ç³»ç»Ÿä¸­çš„æ ¸å¿ƒä½œç”¨</h4>
<p>nativeRefåœ¨KuiklyUIæ¡†æ¶ä¸­æ‰®æ¼”ç€å¤šé‡å…³é”®è§’è‰²ï¼š</p>
<ol>
<li><strong>è§†å›¾èº«ä»½æ ‡è¯†</strong>ï¼šä½œä¸ºè§†å›¾å®ä¾‹çš„å”¯ä¸€èº«ä»½æ ‡è¯†</li>
<li><strong>è§†å›¾å¼•ç”¨ä¼ é€’</strong>ï¼šåœ¨çˆ¶å­è§†å›¾ä¹‹é—´ä¼ é€’å¼•ç”¨å…³ç³»</li>
<li><strong>è·¨å±‚é€šä¿¡æ¡¥æ¢</strong>ï¼šè¿æ¥Kotlinå±‚ä¸åŸç”Ÿæ¸²æŸ“å±‚</li>
<li><strong>å±æ€§ä¸äº‹ä»¶ç»‘å®š</strong>ï¼šåœ¨åˆ›å»ºAttrå’ŒEventå¯¹è±¡æ—¶è¢«æ³¨å…¥ï¼Œç”¨äºåç»­å±æ€§æ›´æ–°å’Œäº‹ä»¶åˆ†å‘</li>
</ol>
<p>åœ¨AbstractBaseViewçš„å†…éƒ¨å®ç°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°nativeRefè¢«æ³¨å…¥åˆ°Attrå’ŒEventå¯¹è±¡ä¸­ï¼š</p>
<pre><code class="hljs language-kotlin:/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/AbstractBaseView.kt" lang="kotlin:/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/AbstractBaseView.kt">private fun internalCreateEvent(): E {
    val event = createEvent()
    event.init(pagerId,nativeRef)  // å°†nativeRefæ³¨å…¥åˆ°Eventå¯¹è±¡
    return event
}

protected fun internalCreateAttr(): A {
    val attr = createAttr()
    attr.pagerId = pagerId
    attr.nativeRef = nativeRef  // å°†nativeRefæ³¨å…¥åˆ°Attrå¯¹è±¡
    attr.flexNode = flexNode
    return attr
}
</code></pre>
<h3 data-id="heading-4">äºŒã€ViewRefä¸nativeRefçš„å…³ç³»</h3>
<h4 data-id="heading-5">2.1 ViewRefçš„å®šä¹‰ä¸å®ç°</h4>
<p>ViewRefæ˜¯ä¸€ä¸ªè½»é‡çº§çš„å¼•ç”¨å°è£…ç±»ï¼Œå®šä¹‰åœ¨DeclarativeBaseView.ktä¸­ï¼š</p>
<pre><code class="hljs language-kotlin:/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/DeclarativeBaseView.kt" lang="kotlin:/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/DeclarativeBaseView.kt">class ViewRef&lt;T : DeclarativeBaseView&lt;*, *&gt;&gt;(val pagerId: String, val nativeRef: Int) {
    val view: T?
        get() = PagerManager.getPager(pagerId)
            .getViewWithNativeRef(nativeRef) as? T
}
</code></pre>
<h4 data-id="heading-6">2.2 ViewRefä¸nativeRefçš„åä½œå…³ç³»</h4>
<p>ViewRefä¸nativeRefä¹‹é—´å­˜åœ¨ç€ç´§å¯†çš„åä½œå…³ç³»ï¼š</p>
<ol>
<li><strong>ç»„æˆå…³ç³»</strong>ï¼šViewRefå°è£…äº†pagerIdå’ŒnativeRefä¸¤ä¸ªæ ¸å¿ƒå±æ€§</li>
<li><strong>å®šä½æœºåˆ¶</strong>ï¼šViewRefé€šè¿‡pagerIdå’ŒnativeRefç»„åˆå®šä½åˆ°å…·ä½“çš„è§†å›¾å®ä¾‹</li>
<li><strong>å»¶è¿ŸæŸ¥æ‰¾</strong>ï¼šViewRefçš„<code>view</code>å±æ€§é‡‡ç”¨æ‡’åŠ è½½æ–¹å¼ï¼Œåªæœ‰åœ¨éœ€è¦æ—¶æ‰é€šè¿‡PagerManageræŸ¥æ‰¾è§†å›¾</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šViewRefä½¿ç”¨æ³›å‹ç¡®ä¿è¿”å›çš„è§†å›¾ç±»å‹æ­£ç¡®</li>
</ol>
<h3 data-id="heading-7">ä¸‰ã€ViewRefä¸AbstractBaseViewçš„å…³ç³»</h3>
<h4 data-id="heading-8">3.1 refæ‰©å±•å‡½æ•°çš„å®ç°</h4>
<p>åœ¨DeclarativeBaseViewä¸­ï¼Œå®ç°äº†<code>ref</code>æ‰©å±•å‡½æ•°ï¼Œä½œä¸ºåˆ›å»ºViewRefçš„å…¥å£ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : DeclarativeBaseView&lt;*, *&gt;</span>&gt; T.<span class="hljs-title">ref</span><span class="hljs-params">(ref: (<span class="hljs-type">viewRef</span>: <span class="hljs-type">ViewRef</span>&lt;<span class="hljs-type">T</span>&gt;) -&gt; <span class="hljs-type">Unit</span>)</span></span> {
    ref(ViewRef&lt;T&gt;(pagerId, nativeRef))
}
</code></pre>
<h4 data-id="heading-9">3.2 AbstractBaseViewä¸ViewRefçš„äº¤äº’æµç¨‹</h4>
<p>AbstractBaseViewä¸ViewRefçš„äº¤äº’æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>AbstractBaseViewå®ä¾‹åˆ›å»ºæ—¶ç”Ÿæˆå”¯ä¸€çš„nativeRef</li>
<li>é€šè¿‡refæ‰©å±•å‡½æ•°ï¼Œå°†å½“å‰è§†å›¾çš„pagerIdå’ŒnativeRefä¼ é€’ç»™ViewRefæ„é€ å‡½æ•°</li>
<li>ViewRefæŒæœ‰è¿™äº›å¼•ç”¨ä¿¡æ¯ï¼Œä½†ä¸ç›´æ¥æŒæœ‰è§†å›¾å®ä¾‹</li>
<li>å½“éœ€è¦è®¿é—®è§†å›¾æ—¶ï¼Œé€šè¿‡ViewRefçš„<code>view</code>å±æ€§é—´æ¥è·å–</li>
</ol>
<p>è¿™ç§è®¾è®¡å®ç°äº†è§†å›¾å¼•ç”¨çš„è§£è€¦ï¼Œä½¿æ¡†æ¶èƒ½å¤Ÿæ›´çµæ´»åœ°ç®¡ç†è§†å›¾ç”Ÿå‘½å‘¨æœŸå’Œå†…å­˜ã€‚</p>
<h3 data-id="heading-10">å››ã€ViewRefä¸Pagerçš„åä½œæœºåˆ¶</h3>
<h4 data-id="heading-11">4.1 Pagerçš„è§†å›¾å¼•ç”¨ç®¡ç†</h4>
<p>Pagerç±»å®ç°äº†IPageræ¥å£ï¼Œè´Ÿè´£ç®¡ç†è§†å›¾å¼•ç”¨ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Pagerä¸­ç®¡ç†è§†å›¾å¼•ç”¨çš„å…³é”®ä»£ç </span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> nativeRefViewMap = mutableMapOf&lt;<span class="hljs-built_in">Int</span>, AbstractBaseView&lt;*, *&gt;&gt;()

<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">putNativeViewRef</span><span class="hljs-params">(nativeRef: <span class="hljs-type">Int</span>, view: <span class="hljs-type">AbstractBaseView</span>&lt;*, *&gt;)</span></span> {
    nativeRefViewMap[nativeRef] = view
}

<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">removeNativeViewRef</span><span class="hljs-params">(nativeRef: <span class="hljs-type">Int</span>)</span></span> {
    nativeRefViewMap.remove(nativeRef)
}

<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getViewWithNativeRef</span><span class="hljs-params">(nativeRef: <span class="hljs-type">Int</span>)</span></span>: AbstractBaseView&lt;*, *&gt;? {
    <span class="hljs-keyword">return</span> nativeRefViewMap[nativeRef]
}
</code></pre>
<h4 data-id="heading-12">4.2 ViewRefä¸Pagerçš„åä½œæµç¨‹</h4>
<p>ViewRefä¸Pagerçš„åä½œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>ViewRefæŒæœ‰pagerIdå’ŒnativeRefä¿¡æ¯</li>
<li>å½“è°ƒç”¨ViewRefçš„<code>view</code>å±æ€§æ—¶ï¼Œé€šè¿‡PagerManagerè·å–å¯¹åº”pagerIdçš„Pagerå®ä¾‹</li>
<li>è°ƒç”¨Pagerçš„<code>getViewWithNativeRef</code>æ–¹æ³•ï¼Œé€šè¿‡nativeRefæŸ¥æ‰¾è§†å›¾å®ä¾‹</li>
<li>å°†æ‰¾åˆ°çš„è§†å›¾å®ä¾‹è½¬æ¢ä¸ºæ³›å‹Tç±»å‹å¹¶è¿”å›</li>
</ol>
<p>è¿™ç§è®¾è®¡ä½¿å¾—ViewRefå¯ä»¥å®‰å…¨åœ°åœ¨ä»»ä½•åœ°æ–¹è®¿é—®è§†å›¾ï¼Œè€Œä¸éœ€è¦ç›´æ¥æŒæœ‰è§†å›¾å®ä¾‹çš„å¼ºå¼•ç”¨ï¼Œæœ‰åˆ©äºå†…å­˜ç®¡ç†å’Œè§†å›¾ç”Ÿå‘½å‘¨æœŸæ§åˆ¶ã€‚</p>
<h3 data-id="heading-13">äº”ã€ViewContainerä¸ViewRefçš„å…³ç³»</h3>
<h4 data-id="heading-14">5.1 ViewContainerçš„è§†å›¾å±‚æ¬¡ç®¡ç†</h4>
<p>ViewContaineræ˜¯æ‰€æœ‰å®¹å™¨è§†å›¾çš„åŸºç±»ï¼Œè´Ÿè´£ç®¡ç†å­è§†å›¾å±‚æ¬¡ç»“æ„ï¼š</p>
<pre><code class="hljs language-kotlin:/Users/hdh/Documents/codes/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/ViewContainer.kt" lang="kotlin:/Users/hdh/Documents/codes/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/ViewContainer.kt">abstract class ViewContainer&lt;A : ContainerAttr, E : Event&gt; : DeclarativeBaseView&lt;A, E&gt;() {
    protected val children = fastArrayListOf&lt;DeclarativeBaseView&lt;*, *&gt;&gt;()
    // ...
}
</code></pre>
<h4 data-id="heading-15">5.2 ViewContainerä¸­nativeRefçš„åº”ç”¨</h4>
<p>åœ¨ViewContainerä¸­ï¼ŒnativeRefä¸»è¦ç”¨äºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<ol>
<li><strong>çˆ¶è§†å›¾å¼•ç”¨ä¼ é€’</strong>ï¼šåœ¨æ·»åŠ å­è§†å›¾æ—¶ï¼Œè®¾ç½®å­è§†å›¾çš„parentRefä¸ºå½“å‰å®¹å™¨çš„nativeRef</li>
</ol>
<pre><code class="hljs language-kotlin:/Users/hdh/Documents/codes/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/ViewContainer.kt" lang="kotlin:/Users/hdh/Documents/codes/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/ViewContainer.kt">private fun internalAddChild(child: DeclarativeBaseView&lt;*, *&gt;, index: Int) {
    child.pagerId = pagerId
    child.willMoveToParentComponent()
    if (index &lt; 0) { // append when index -1
        children.add(child)
    } else {
        children.add(index, child)
    }
    child.parentRef = nativeRef  // è®¾ç½®çˆ¶è§†å›¾å¼•ç”¨
    child.didMoveToParentView()
}
</code></pre>
<ol start="2">
<li><strong>æ¸²æŸ“è§†å›¾ç®¡ç†</strong>ï¼šåœ¨åˆ›å»ºå’Œç§»é™¤æ¸²æŸ“è§†å›¾æ—¶ï¼Œä½¿ç”¨nativeRefæ ‡è¯†è§†å›¾</li>
</ol>
<pre><code class="hljs language-kotlin:/Users/hdh/Documents/codes/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/ViewContainer.kt" lang="kotlin:/Users/hdh/Documents/codes/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/ViewContainer.kt">override fun createRenderView() {
    createRenderViewing = true
    super.createRenderView()
    createRenderViewing = false
    var index = 0
    renderChildren().forEach { child -&gt;
        child.createRenderView()
        renderView?.insertSubRenderView(child.nativeRef, index++)  // ä½¿ç”¨nativeRefæ ‡è¯†å­è§†å›¾
        child.renderViewDidMoveToParentRenderView()
    }
}
</code></pre>
<ol start="3">
<li><strong>è§†å›¾å¼•ç”¨é“¾å»ºç«‹</strong>ï¼šé€šè¿‡nativeRefå’ŒparentRefå»ºç«‹å®Œæ•´çš„è§†å›¾å¼•ç”¨é“¾</li>
</ol>
<h4 data-id="heading-16">5.3 ViewContainerä¸­ViewRefçš„ä½¿ç”¨åœºæ™¯</h4>
<p>åœ¨ViewContainerä¸­ï¼ŒViewRefä¸»è¦ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p>
<ol>
<li><strong>å­è§†å›¾å¼•ç”¨è·å–</strong>ï¼šé€šè¿‡ViewRefå®‰å…¨åœ°è·å–å­è§†å›¾å¼•ç”¨ï¼Œè¿›è¡Œæ“ä½œæˆ–é€šä¿¡</li>
<li><strong>è·¨å±‚çº§è§†å›¾è®¿é—®</strong>ï¼šåœ¨å¤æ‚å¸ƒå±€ä¸­ï¼Œé€šè¿‡ViewRefå®ç°è·¨å±‚çº§çš„è§†å›¾è®¿é—®</li>
<li><strong>è§†å›¾ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼šåœ¨è§†å›¾æ·»åŠ ã€ç§»é™¤ç­‰ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ä¸­ï¼Œé€šè¿‡ViewRefä¼ é€’å¼•ç”¨ä¿¡æ¯</li>
</ol>
<h3 data-id="heading-17">å…­ã€æ•´ä½“æ¶æ„ä¸æ•°æ®æµ</h3>
<h4 data-id="heading-18">6.1 æ ¸å¿ƒç»„ä»¶å…³ç³»å›¾</h4>
<pre><code class="hljs language-lua" lang="lua">+<span class="hljs-comment">------------------+      +------------------+      +------------------+</span>
|                  |      |                  |      |                  |
|  AbstractBaseView|&lt;<span class="hljs-comment">-----&gt;|    ViewRef       |&lt;-----&gt;|     Pager        |</span>
|                  |      |                  |      |                  |
+<span class="hljs-comment">--------^---------+      +------------------+      +------------------+</span>
         |
         |
+<span class="hljs-comment">--------+---------+      +------------------+</span>
|                  |      |                  |
|  ViewContainer   |&lt;<span class="hljs-comment">-----&gt;|   Declarative   |</span>
|                  |      |     BaseView     |
+<span class="hljs-comment">------------------+      +------------------+</span>
</code></pre>
<h4 data-id="heading-19">6.2 æ•°æ®æµå‘ä¸äº¤äº’æ¨¡å¼</h4>
<p>åœ¨KuiklyUIçš„è§†å›¾å¼•ç”¨ç³»ç»Ÿä¸­ï¼Œæ•°æ®æµå‘å’Œäº¤äº’æ¨¡å¼å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>åˆ›å»ºé˜¶æ®µ</strong>ï¼šè§†å›¾å®ä¾‹åˆ›å»ºæ—¶ç”ŸæˆnativeRefï¼ŒPageræ³¨å†Œè§†å›¾å¼•ç”¨</li>
<li><strong>å¼•ç”¨å°è£…</strong>ï¼šé€šè¿‡refæ‰©å±•å‡½æ•°åˆ›å»ºViewRefå¯¹è±¡ï¼Œå°è£…pagerIdå’ŒnativeRef</li>
<li><strong>å¼•ç”¨è®¿é—®</strong>ï¼šé€šè¿‡ViewRefçš„viewå±æ€§ï¼Œé—´æ¥è®¿é—®è§†å›¾å®ä¾‹</li>
<li><strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼šåœ¨è§†å›¾æ·»åŠ åˆ°å®¹å™¨æˆ–ä»å®¹å™¨ç§»é™¤æ—¶ï¼Œæ›´æ–°parentRefå’Œè§†å›¾å¼•ç”¨æ³¨å†ŒçŠ¶æ€</li>
<li><strong>é”€æ¯é˜¶æ®µ</strong>ï¼šè§†å›¾é”€æ¯æ—¶ï¼Œä»Pagerä¸­ç§»é™¤è§†å›¾å¼•ç”¨</li>
</ol>
<h3 data-id="heading-20">ä¸ƒã€è®¾è®¡ä¼˜åŠ¿ä¸æŠ€æœ¯äº®ç‚¹</h3>
<h4 data-id="heading-21">7.1 è®¾è®¡ä¼˜åŠ¿</h4>
<ol>
<li><strong>è§£è€¦è§†å›¾å¼•ç”¨</strong>ï¼šViewRefé€šè¿‡é—´æ¥å¼•ç”¨æœºåˆ¶ï¼Œå®ç°äº†è§†å›¾å¼•ç”¨ä¸è§†å›¾å®ä¾‹çš„è§£è€¦</li>
<li><strong>å†…å­˜ä¼˜åŒ–</strong>ï¼šé¿å…äº†ä¸å¿…è¦çš„å¼ºå¼•ç”¨ï¼Œæœ‰åˆ©äºå†…å­˜ç®¡ç†å’Œåƒåœ¾å›æ”¶</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šæ³›å‹è®¾è®¡ç¡®ä¿äº†ç±»å‹å®‰å…¨ï¼Œå‡å°‘äº†è¿è¡Œæ—¶ç±»å‹è½¬æ¢é”™è¯¯</li>
<li><strong>çµæ´»çš„è§†å›¾è®¿é—®</strong>ï¼šå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡ViewRefå®‰å…¨åœ°è®¿é—®è§†å›¾ï¼Œä¸å—ç”Ÿå‘½å‘¨æœŸé™åˆ¶</li>
</ol>
<h4 data-id="heading-22">7.2 æŠ€æœ¯äº®ç‚¹</h4>
<ol>
<li><strong>å”¯ä¸€æ ‡è¯†ç¬¦ç”Ÿæˆæœºåˆ¶</strong>ï¼šé€šè¿‡é™æ€è®¡æ•°å™¨ç”Ÿæˆå…¨å±€å”¯ä¸€çš„nativeRef</li>
<li><strong>å»¶è¿ŸæŸ¥æ‰¾ç­–ç•¥</strong>ï¼šViewRefçš„viewå±æ€§é‡‡ç”¨æ‡’åŠ è½½æ–¹å¼ï¼Œåªæœ‰åœ¨éœ€è¦æ—¶æ‰æŸ¥æ‰¾è§†å›¾</li>
<li><strong>å¼•ç”¨é“¾ç®¡ç†</strong>ï¼šé€šè¿‡nativeRefå’ŒparentRefå»ºç«‹å®Œæ•´çš„è§†å›¾å±‚æ¬¡å¼•ç”¨é“¾</li>
<li><strong>è·¨å¹³å°å…¼å®¹æ€§</strong>ï¼šè®¾è®¡è€ƒè™‘äº†è·¨å¹³å°éœ€æ±‚ï¼ŒnativeRefä½œä¸ºç»Ÿä¸€çš„è§†å›¾æ ‡è¯†ç¬¦</li>
</ol>
<h3 data-id="heading-23">å…«ã€ä»£ç ä¼˜åŒ–å»ºè®®</h3>
<p>åŸºäºå¯¹ViewRefå’ŒnativeRefç³»ç»Ÿçš„åˆ†æï¼Œæå‡ºä»¥ä¸‹ä¼˜åŒ–å»ºè®®ï¼š</p>
<ol>
<li>
<p><strong>å¼•ç”¨æœ‰æ•ˆæ€§æ£€æŸ¥å¢å¼º</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// åœ¨ViewRefçš„viewå±æ€§ä¸­æ·»åŠ æ›´å®Œå–„çš„æœ‰æ•ˆæ€§æ£€æŸ¥</span>
<span class="hljs-keyword">val</span> view: T?
    <span class="hljs-keyword">get</span>() {
        <span class="hljs-keyword">val</span> pager = PagerManager.getPager(pagerId)
        <span class="hljs-keyword">if</span> (pager == <span class="hljs-literal">null</span> || !pager.isActive()) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
        }
        <span class="hljs-keyword">val</span> view = pager.getViewWithNativeRef(nativeRef) <span class="hljs-keyword">as</span>? T
        <span class="hljs-keyword">if</span> (view != <span class="hljs-literal">null</span> &amp;&amp; view.isDestroyed()) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
        }
        <span class="hljs-keyword">return</span> view
    }
</code></pre>
</li>
<li>
<p><strong>å¼±å¼•ç”¨ä¼˜åŒ–</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// åœ¨Pagerä¸­è€ƒè™‘ä½¿ç”¨WeakReferenceå­˜å‚¨è§†å›¾å¼•ç”¨ï¼Œé¿å…å†…å­˜æ³„æ¼</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> nativeRefViewMap = mutableMapOf&lt;<span class="hljs-built_in">Int</span>, WeakReference&lt;AbstractBaseView&lt;*, *&gt;&gt;&gt;()
</code></pre>
</li>
<li>
<p><strong>å¼•ç”¨ç¼“å­˜æœºåˆ¶</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ä¸ºé¢‘ç¹è®¿é—®çš„ViewRefæ·»åŠ ç¼“å­˜æœºåˆ¶</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewRef</span>&lt;<span class="hljs-type">T : DeclarativeBaseView&lt;*, *</span>&gt;&gt;(<span class="hljs-keyword">val</span> pagerId: String, <span class="hljs-keyword">val</span> nativeRef: <span class="hljs-built_in">Int</span>) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> cachedView: T? = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> lastCacheTime: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">val</span> view: T?
        <span class="hljs-keyword">get</span>() {
            <span class="hljs-keyword">val</span> currentTime = System.currentTimeMillis()
            <span class="hljs-comment">// ç¼“å­˜æœ‰æ•ˆæœŸ100ms</span>
            <span class="hljs-keyword">if</span> (cachedView != <span class="hljs-literal">null</span> &amp;&amp; currentTime - lastCacheTime &lt; <span class="hljs-number">100</span>) {
                <span class="hljs-keyword">return</span> cachedView
            }
            cachedView = PagerManager.getPager(pagerId)
                .getViewWithNativeRef(nativeRef) <span class="hljs-keyword">as</span>? T
            lastCacheTime = currentTime
            <span class="hljs-keyword">return</span> cachedView
        }
}
</code></pre>
</li>
</ol>
<p>æ€»ç»“æ¥çœ‹ï¼ŒnativeRefä¸ViewRefã€AbstractBaseViewã€Pagerä»¥åŠViewContainerä¹‹é—´å½¢æˆäº†ä¸€å¥—å®Œæ•´ã€é«˜æ•ˆçš„è§†å›¾å¼•ç”¨ç®¡ç†ä½“ç³»ï¼Œä¸ºKuiklyUIæ¡†æ¶æä¾›äº†çµæ´»ã€å®‰å…¨çš„è§†å›¾è®¿é—®æœºåˆ¶ã€‚é€šè¿‡è¿™ç§è®¾è®¡ï¼Œæ¡†æ¶èƒ½å¤Ÿæœ‰æ•ˆåœ°ç®¡ç†è§†å›¾ç”Ÿå‘½å‘¨æœŸã€ä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œå¹¶æä¾›ä¸€è‡´çš„è·¨å¹³å°ä½“éªŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»ä¸€ä¸ªBugçœ‹Androidæ–‡æœ¬ç¼–è¾‘çš„è®¾è®¡ç¼ºé™·]]></title>    <link>https://juejin.cn/post/7570932873131294747</link>    <guid>https://juejin.cn/post/7570932873131294747</guid>    <pubDate>2025-11-10T13:24:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570932873131294747" data-draft-id="7570932873131278363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»ä¸€ä¸ªBugçœ‹Androidæ–‡æœ¬ç¼–è¾‘çš„è®¾è®¡ç¼ºé™·"/> <meta itemprop="keywords" content="Android,Linux"/> <meta itemprop="datePublished" content="2025-11-10T13:24:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="WAsbry"/> <meta itemprop="url" content="https://juejin.cn/user/3413335797139511"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»ä¸€ä¸ªBugçœ‹Androidæ–‡æœ¬ç¼–è¾‘çš„è®¾è®¡ç¼ºé™·
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3413335797139511/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    WAsbry
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T13:24:41.000Z" title="Mon Nov 10 2025 13:24:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä»ä¸€ä¸ªBugçœ‹Androidæ–‡æœ¬ç¼–è¾‘çš„è®¾è®¡ç¼ºé™·</h2>
<h3 data-id="heading-1">ğŸ’¡ æœ¬æ–‡ç²¾å</h3>
<ul>
<li><strong>æ‰¿æ¥ä¸Šæ–‡</strong>ï¼šç¬¬ä¸€ç¯‡è§£æäº†è·¨è¿›ç¨‹é€šä¿¡ï¼Œæœ¬ç¯‡æ·±å…¥åº”ç”¨è¿›ç¨‹å†…éƒ¨ï¼Œå‰–ææ–‡æœ¬æ“ä½œçš„è®¾è®¡ç¼ºé™·</li>
<li><strong>æ ¸å¿ƒçŸ›ç›¾</strong>ï¼šInputFilteræœŸæœ›æ§åˆ¶æ‰€æœ‰æ–‡æœ¬æ“ä½œï¼Œä½†delete()ç»•è¿‡äº†è¿‡æ»¤æœºåˆ¶</li>
<li><strong>å…³é”®å‘ç°</strong>ï¼š<code>replaceText()</code>å…ˆdeleteåinsertï¼Œdeleteä¼ å…¥ç©ºå­—ç¬¦ä¸²""ï¼ŒInputFilterè®¤ä¸ºåˆæ³•æ”¾è¡Œ</li>
<li><strong>æ·±å±‚åŸå› </strong>ï¼šSpanèŒƒå›´åœ¨insertå¤±è´¥åä¸å®é™…æ–‡æœ¬ä¸åŒæ­¥ï¼Œå¯¼è‡´èŒƒå›´å¼‚å¸¸æ‰©å±•ï¼Œåå™¬æ›´å¤šå­—ç¬¦</li>
<li><strong>ä»·å€¼</strong>ï¼šç†è§£Androidæ–‡æœ¬ç¼–è¾‘æ¡†æ¶çš„è®¾è®¡å±€é™ï¼Œä¸ºç¬¬ä¸‰ç¯‡çš„å·¥ç¨‹è§£å†³æ–¹æ¡ˆåšå‡†å¤‡</li>
</ul>
<hr/>
<h3 data-id="heading-2">ä¸€ã€åº”ç”¨è¿›ç¨‹å†…éƒ¨çš„æ–‡æœ¬ç¼–è¾‘æ¶æ„</h3>
<h4 data-id="heading-3">1.1 ä¸‰å¤§æ ¸å¿ƒç»„ä»¶</h4>
<p>ä¸Šä¸€ç¯‡æˆ‘ä»¬ç†è§£äº†Binderå¦‚ä½•å°†è¾“å…¥æ³•çš„è°ƒç”¨ä¼ é€’åˆ°åº”ç”¨è¿›ç¨‹ã€‚ç°åœ¨èšç„¦åº”ç”¨è¿›ç¨‹å†…éƒ¨ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">åº”ç”¨è¿›ç¨‹å†…éƒ¨æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TextView / EditText                    â”‚
â”‚    â”œâ”€ Editable (SpannableStringBuilder)â”‚ â† æ–‡æœ¬ç¼“å†²åŒº
â”‚    â”‚    - char<span class="hljs-selector-attr">[]</span> mText                  â”‚
â”‚    â”‚    - <span class="hljs-selector-tag">Object</span><span class="hljs-selector-attr">[]</span> mSpans               â”‚
â”‚    â”‚                                    â”‚
â”‚    â”œâ”€ InputFilter<span class="hljs-selector-attr">[]</span>                    â”‚ â† è¿‡æ»¤å™¨é“¾
â”‚    â”‚    - DigitsKeyListener             â”‚
â”‚    â”‚    - LengthFilter                  â”‚
â”‚    â”‚                                    â”‚
â”‚    â””â”€ InputConnection                  â”‚ â† å¤–éƒ¨æ¥å£
â”‚         - BaseInputConnection           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>ä¸Šä¸€ç¯‡å·²è®²</strong>ï¼šInputConnectionæ˜¯è·¨è¿›ç¨‹æ¥å£
<strong>æœ¬ç¯‡èšç„¦</strong>ï¼šEditableã€InputFilterã€Spanå¦‚ä½•ååŒå·¥ä½œ</p>
<h4 data-id="heading-4">1.2 Editableæ¥å£è®¾è®¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Editable</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CharSequence</span>, Spannable {
    <span class="hljs-comment">// æ ¸å¿ƒçš„ä¸‰ä¸ªæ“ä½œ</span>
    Editable <span class="hljs-title function_">insert</span><span class="hljs-params">(<span class="hljs-type">int</span> where, CharSequence text)</span>;
    Editable <span class="hljs-title function_">delete</span><span class="hljs-params">(<span class="hljs-type">int</span> st, <span class="hljs-type">int</span> en)</span>;
    Editable <span class="hljs-title function_">replace</span><span class="hljs-params">(<span class="hljs-type">int</span> st, <span class="hljs-type">int</span> en, CharSequence text)</span>;

    <span class="hljs-comment">// è¿‡æ»¤å™¨ç®¡ç†</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFilters</span><span class="hljs-params">(InputFilter[] filters)</span>;
    InputFilter[] getFilters();
}
</code></pre>
<p><strong>å®ç°ç±»</strong>ï¼šSpannableStringBuilder</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpannableStringBuilder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Editable</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">char</span>[] mText;           <span class="hljs-comment">// å­˜å‚¨å­—ç¬¦</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mGapStart;          <span class="hljs-comment">// Gap Bufferä¼˜åŒ–</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mGapLength;

    <span class="hljs-keyword">private</span> Object[] mSpans;        <span class="hljs-comment">// å­˜å‚¨Spanå¯¹è±¡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] mSpanStarts;      <span class="hljs-comment">// Spanèµ·å§‹ä½ç½®</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] mSpanEnds;        <span class="hljs-comment">// Spanç»“æŸä½ç½®</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] mSpanFlags;       <span class="hljs-comment">// Spanæ ‡å¿—</span>

    <span class="hljs-comment">// æ ¸å¿ƒå®ç°</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> SpannableStringBuilder <span class="hljs-title function_">replace</span><span class="hljs-params">(<span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end,
                                          CharSequence tb, <span class="hljs-type">int</span> tbstart, <span class="hljs-type">int</span> tbend)</span> {
        <span class="hljs-comment">// å…³é”®ï¼šè¿™é‡Œä¼šè°ƒç”¨InputFilteré“¾</span>
        InputFilter[] filters = getFilters();
        <span class="hljs-keyword">if</span> (filters != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; filters.length; i++) {
                <span class="hljs-type">CharSequence</span> <span class="hljs-variable">repl</span> <span class="hljs-operator">=</span> filters[i].filter(tb, tbstart, tbend,
                                                      <span class="hljs-built_in">this</span>, start, end);
                <span class="hljs-keyword">if</span> (repl != <span class="hljs-literal">null</span>) {
                    tb = repl;
                    tbstart = <span class="hljs-number">0</span>;
                    tbend = repl.length();
                }
            }
        }

        <span class="hljs-comment">// æ‰§è¡Œå®é™…çš„æ–‡æœ¬æ›¿æ¢</span>
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>insert/deleteæœ€ç»ˆéƒ½è°ƒç”¨replace()</li>
<li>replace()ä¼šè§¦å‘InputFilteré“¾</li>
<li>ä½†æœ‰ä¸ªä¾‹å¤–...</li>
</ul>
<hr/>
<h3 data-id="heading-5">äºŒã€è®¾è®¡ç¼ºé™·çš„æ ¸å¿ƒï¼šä¸å¯¹ç§°çš„æ§åˆ¶æƒ</h3>
<h4 data-id="heading-6">2.1 InputFilterçš„æ¥å£è®¾è®¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">InputFilter</span> {
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> source è¦æ’å…¥çš„æ–°æ–‡æœ¬
     * <span class="hljs-doctag">@param</span> start  sourceçš„èµ·å§‹ä½ç½®
     * <span class="hljs-doctag">@param</span> end    sourceçš„ç»“æŸä½ç½®
     * <span class="hljs-doctag">@param</span> dest   ç›®æ ‡æ–‡æœ¬(å½“å‰EditTextå†…å®¹)
     * <span class="hljs-doctag">@param</span> dstart æ’å…¥ä½ç½®çš„èµ·å§‹
     * <span class="hljs-doctag">@param</span> dend   æ’å…¥ä½ç½®çš„ç»“æŸ
     * <span class="hljs-doctag">@return</span> null  = æ¥å—source
     *         ""    = æ‹’ç»source
     *         å…¶ä»–  = æ›¿æ¢ä¸ºè¿”å›çš„å†…å®¹
     */</span>
    CharSequence <span class="hljs-title function_">filter</span><span class="hljs-params">(CharSequence source, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end,
                       Spanned dest, <span class="hljs-type">int</span> dstart, <span class="hljs-type">int</span> dend)</span>;
}
</code></pre>
<p><strong>DigitsKeyListenerçš„å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// NumberKeyListener.java (çˆ¶ç±»)</span>
<span class="hljs-keyword">public</span> CharSequence <span class="hljs-title function_">filter</span><span class="hljs-params">(CharSequence source, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end,
                           Spanned dest, <span class="hljs-type">int</span> dstart, <span class="hljs-type">int</span> dend)</span> {
    <span class="hljs-type">char</span>[] accept = getAcceptedChars(); <span class="hljs-comment">// ['0'-'9']</span>

    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> start; i &lt; end; i++) {
        <span class="hljs-keyword">if</span> (!ok(accept, source.charAt(i))) {
            <span class="hljs-comment">// å‘ç°éæ³•å­—ç¬¦ (å¦‚å­—æ¯ 'q')</span>
            <span class="hljs-keyword">if</span> (end - start == <span class="hljs-number">1</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>; <span class="hljs-comment">// å•ä¸ªå­—ç¬¦ï¼Œç›´æ¥æ‹’ç»</span>
            }
            <span class="hljs-comment">// å¤šä¸ªå­—ç¬¦ï¼Œè¿‡æ»¤æ‰éæ³•çš„</span>
            <span class="hljs-comment">// ...</span>
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// å…¨éƒ¨åˆæ³•ï¼Œæ¥å—</span>
}

<span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">ok</span><span class="hljs-params">(<span class="hljs-type">char</span>[] accept, <span class="hljs-type">char</span> c)</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> accept.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
        <span class="hljs-keyword">if</span> (accept[i] == c) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h4 data-id="heading-7">2.2 delete()çš„ç‰¹æ®Šå®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// SpannableStringBuilder.java</span>
<span class="hljs-keyword">public</span> SpannableStringBuilder <span class="hljs-title function_">delete</span><span class="hljs-params">(<span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end)</span> {
    <span class="hljs-comment">// å…³é”®ï¼šdeleteæœ¬è´¨æ˜¯replaceæ“ä½œï¼Œä¼ å…¥ç©ºå­—ç¬¦ä¸²""</span>
    <span class="hljs-keyword">return</span> replace(start, end, <span class="hljs-string">""</span>);
}

<span class="hljs-comment">// è°ƒç”¨é“¾</span>
delete(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>)
  â†“
replace(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-string">""</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
  â†“
filter(<span class="hljs-string">""</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"123456"</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>)  â† InputFilterçœ‹åˆ°çš„æ˜¯ç©ºå­—ç¬¦ä¸²
  â†“
<span class="hljs-comment">// DigitsKeyListenerçš„æ£€æŸ¥</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0</span>; i++) {  <span class="hljs-comment">// start=0, end=0ï¼Œå¾ªç¯ä¸æ‰§è¡Œ</span>
    <span class="hljs-comment">// æ£€æŸ¥å­—ç¬¦åˆæ³•æ€§</span>
}
  â†“
<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;  <span class="hljs-comment">// æ¥å—ï¼</span>
</code></pre>
<p><strong>é—®é¢˜æœ¬è´¨</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         InputFilterçš„è§†è§’                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  <span class="hljs-built_in">insert</span>(<span class="hljs-number">5</span>, "abc"):                             â”‚
â”‚    <span class="hljs-built_in">filter</span>(<span class="hljs-string">"abc"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>, dest, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>)            â”‚
â”‚    â†’ æ£€æŸ¥ <span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span> â†’ æ‹’ç» âœ“               â”‚
â”‚                                                 â”‚
â”‚  <span class="hljs-built_in">delete</span>(<span class="hljs-number">5</span>, <span class="hljs-number">8</span>):                                 â”‚
â”‚    <span class="hljs-built_in">filter</span>(<span class="hljs-string">""</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, dest, <span class="hljs-number">5</span>, <span class="hljs-number">8</span>)               â”‚
â”‚    â†’ æ£€æŸ¥ç©ºå­—ç¬¦ä¸² â†’ æ¥å— âœ—                     â”‚
â”‚                                                 â”‚
â”‚  InputFilteræ— æ³•åŒºåˆ†ï¼š                          â”‚
â”‚  - æ’å…¥ç©ºå­—ç¬¦ä¸² (åº”æ¥å—)                        â”‚
â”‚  - åˆ é™¤æ“ä½œ (åº”è¯¥ä¹Ÿèƒ½æ‹¦æˆªå—?)                   â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-8">2.3 è®¾è®¡å‡è®¾ vs å®é™…æƒ…å†µ</h4>



































<table><thead><tr><th>åœºæ™¯</th><th>è®¾è®¡å‡è®¾</th><th>å®é™…æƒ…å†µ</th><th>æ˜¯å¦åˆç†</th></tr></thead><tbody><tr><td><strong>ç”¨æˆ·æŒ‰åˆ é™¤é”®</strong></td><td>deleteåº”è¯¥æ— æ¡ä»¶æ‰§è¡Œ</td><td>deleteç»•è¿‡InputFilter</td><td>âœ“ åˆç†ï¼ˆå°Šé‡ç”¨æˆ·æ„å›¾ï¼‰</td></tr><tr><td><strong>InputFilteræ‹¦æˆªinsert</strong></td><td>æ‹¦æˆªéæ³•å­—ç¬¦æ’å…¥</td><td>åªèƒ½æ‹¦æˆªinsert</td><td>âœ“ ç¬¦åˆé¢„æœŸ</td></tr><tr><td><strong>ç»„åˆæ–‡æœ¬æ›¿æ¢</strong></td><td>æ›¿æ¢åº”è¯¥åŸå­æ‰§è¡Œ</td><td>deleteå…ˆäºinsertï¼Œåˆ†ç¦»æ‰§è¡Œ</td><td>âœ— ä¸åˆç†</td></tr><tr><td><strong>delete+insertç»„åˆ</strong></td><td>åº”è¯¥ä¿æŒä¸€è‡´æ€§</td><td>deleteç»•è¿‡ï¼Œinsertæ‹¦æˆª</td><td>âœ— ä¸å¯¹ç§°</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-9">ä¸‰ã€BaseInputConnectionçš„replaceText()å®ç°</h3>
<h4 data-id="heading-10">3.1 æ ¸å¿ƒä»£ç åˆ†æ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// BaseInputConnection.java</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">replaceText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition, <span class="hljs-type">boolean</span> composing)</span> {
    <span class="hljs-keyword">final</span> <span class="hljs-type">Editable</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> getEditable();
    <span class="hljs-keyword">if</span> (content == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span>;
    }

    beginBatchEdit();

    <span class="hljs-comment">// ========== æ­¥éª¤1: è·å–æ—§çš„ç»„åˆæ–‡æœ¬èŒƒå›´ ==========</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> getComposingSpanStart(content);
    <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> getComposingSpanEnd(content);

    <span class="hljs-keyword">if</span> (b &lt; a) {
        <span class="hljs-type">int</span> <span class="hljs-variable">tmp</span> <span class="hljs-operator">=</span> a;
        a = b;
        b = tmp;
    }

    <span class="hljs-keyword">if</span> (a != -<span class="hljs-number">1</span> &amp;&amp; b != -<span class="hljs-number">1</span>) {
        removeComposingSpans(content);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// å¦‚æœæ²¡æœ‰ç»„åˆèŒƒå›´ï¼Œä½¿ç”¨é€‰ä¸­èŒƒå›´</span>
        a = Selection.getSelectionStart(content);
        b = Selection.getSelectionEnd(content);
    }

    <span class="hljs-comment">// ========== æ­¥éª¤2: å…ˆåˆ é™¤æ—§èŒƒå›´ ==========</span>
    <span class="hljs-keyword">if</span> (b != a) {
        content.delete(a, b);  <span class="hljs-comment">// â† å…³é”®: å…ˆåˆ é™¤ï¼Œä¸ç»è¿‡InputFilteréªŒè¯ï¼</span>
    }

    <span class="hljs-comment">// ========== æ­¥éª¤3: å†æ’å…¥æ–°æ–‡æœ¬ ==========</span>
    <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span>) {
        content.insert(a, text);  <span class="hljs-comment">// â† ç»è¿‡InputFilterï¼Œå¯èƒ½è¢«æ‹’ç»</span>
    }

    <span class="hljs-comment">// ========== æ­¥éª¤4: è®¾ç½®æ–°çš„ç»„åˆèŒƒå›´ ==========</span>
    <span class="hljs-keyword">if</span> (composing) {
        setComposingSpans(content, a, a + text.length());
    }

    endBatchEdit();
}
</code></pre>
<h4 data-id="heading-11">3.2 Bugè§¦å‘çš„å®Œæ•´æµç¨‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å‰æï¼šEditTextå†…å®¹ "123456"ï¼Œå…‰æ ‡åœ¨æœ«å°¾</span>

<span class="hljs-comment">// ========== ç¬¬1æ¬¡ï¼šsetComposingText("q") ==========</span>
replaceText(<span class="hljs-string">"q"</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>)
  â†“
æ­¥éª¤<span class="hljs-number">1</span>: è·å–ç»„åˆèŒƒå›´
  a = getComposingSpanStart() â†’ -<span class="hljs-number">1</span> (æ— æ—§èŒƒå›´)
  b = getComposingSpanEnd() â†’ -<span class="hljs-number">1</span>
  ä½¿ç”¨å…‰æ ‡ä½ç½®: a=<span class="hljs-number">6</span>, b=<span class="hljs-number">6</span>
  â†“
æ­¥éª¤<span class="hljs-number">2</span>: åˆ é™¤
  <span class="hljs-keyword">if</span> (<span class="hljs-number">6</span> != <span class="hljs-number">6</span>) â†’ <span class="hljs-literal">false</span>ï¼Œä¸æ‰§è¡Œdelete
  â†“
æ­¥éª¤<span class="hljs-number">3</span>: æ’å…¥
  content.insert(<span class="hljs-number">6</span>, <span class="hljs-string">"q"</span>)
    â†’ filter(<span class="hljs-string">"q"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-string">"123456"</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>)
    â†’ æ£€æŸ¥: <span class="hljs-string">'q'</span> ä¸æ˜¯æ•°å­—
    â†’ è¿”å› <span class="hljs-string">""</span> (æ‹’ç»)
    â†’ æ’å…¥å¤±è´¥
  â†“
æ­¥éª¤<span class="hljs-number">4</span>: è®¾ç½®ç»„åˆèŒƒå›´
  setComposingSpans(<span class="hljs-number">6</span>, <span class="hljs-number">6</span> + <span class="hljs-number">0</span>) â†’ [<span class="hljs-number">6</span>, <span class="hljs-number">6</span>)
  â†“
ç»“æœ: <span class="hljs-string">"123456"</span> (æœªå˜)

<span class="hljs-comment">// ========== ç¬¬2æ¬¡ï¼šsetComposingText("qq") ==========</span>
replaceText(<span class="hljs-string">"qq"</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>)
  â†“
æ­¥éª¤<span class="hljs-number">1</span>: è·å–ç»„åˆèŒƒå›´
  a = getComposingSpanStart() â†’ <span class="hljs-number">5</span> â† ä¸ºä»€ä¹ˆæ˜¯<span class="hljs-number">5</span>? (ç¨ååˆ†æ)
  b = getComposingSpanEnd() â†’ <span class="hljs-number">6</span>
  â†“
æ­¥éª¤<span class="hljs-number">2</span>: åˆ é™¤ â† Bugå¼€å§‹ï¼
  <span class="hljs-keyword">if</span> (<span class="hljs-number">6</span> != <span class="hljs-number">5</span>) â†’ <span class="hljs-literal">true</span>
  content.delete(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>)
    â†’ replace(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-string">""</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
    â†’ filter(<span class="hljs-string">""</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"123456"</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>)
    â†’ å¾ªç¯ä¸æ‰§è¡Œ (start=<span class="hljs-number">0</span>, end=<span class="hljs-number">0</span>)
    â†’ è¿”å› <span class="hljs-literal">null</span> (æ¥å—)
    â†’ åˆ é™¤æˆåŠŸï¼å­—ç¬¦<span class="hljs-string">'6'</span>è¢«åˆ é™¤
  content = <span class="hljs-string">"12345"</span>
  â†“
æ­¥éª¤<span class="hljs-number">3</span>: æ’å…¥
  content.insert(<span class="hljs-number">5</span>, <span class="hljs-string">"qq"</span>)
    â†’ filter(<span class="hljs-string">"qq"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-string">"12345"</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>)
    â†’ æ£€æŸ¥: <span class="hljs-string">'q'</span> ä¸æ˜¯æ•°å­—
    â†’ è¿”å› <span class="hljs-string">""</span> (æ‹’ç»)
    â†’ æ’å…¥å¤±è´¥
  â†“
æ­¥éª¤<span class="hljs-number">4</span>: è®¾ç½®ç»„åˆèŒƒå›´
  setComposingSpans(<span class="hljs-number">5</span>, <span class="hljs-number">5</span> + <span class="hljs-number">0</span>) â†’ [<span class="hljs-number">5</span>, <span class="hljs-number">5</span>)
  â†“
ç»“æœ: <span class="hljs-string">"12345"</span> âœ— (ä¸¢å¤±äº†<span class="hljs-string">'6'</span>)
</code></pre>
<h4 data-id="heading-12">3.3 ä¸ºä»€ä¹ˆå…ˆdeleteåinsertï¼Ÿ</h4>
<p><strong>è®¾è®¡æ„å›¾</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç»„åˆæ–‡æœ¬çš„æ›¿æ¢é€»è¾‘</span>
<span class="hljs-comment">// ä¾‹å¦‚ï¼šæ‹¼éŸ³è¾“å…¥ "zhongguo" â†’ å€™é€‰è¯ "ä¸­å›½"</span>

<span class="hljs-comment">// æ—§ç»„åˆæ–‡æœ¬: "zhongguo" (8ä¸ªå­—ç¬¦)</span>
<span class="hljs-comment">// æ–°ç»„åˆæ–‡æœ¬: "ä¸­å›½" (2ä¸ªå­—ç¬¦)</span>

<span class="hljs-comment">// å¦‚æœå…ˆinsertådeleteï¼š</span>
insert(<span class="hljs-string">"ä¸­å›½"</span>)    â†’ <span class="hljs-string">"123456zhongguoä¸­å›½"</span>
delete(<span class="hljs-number">6</span>, <span class="hljs-number">14</span>)    â†’ <span class="hljs-string">"123456ä¸­å›½"</span>

<span class="hljs-comment">// å¦‚æœå…ˆdeleteåinsertï¼š</span>
delete(<span class="hljs-number">6</span>, <span class="hljs-number">14</span>)    â†’ <span class="hljs-string">"123456"</span>
insert(<span class="hljs-string">"ä¸­å›½"</span>)   â†’ <span class="hljs-string">"123456ä¸­å›½"</span>

<span class="hljs-comment">// ä¸¤ç§æ–¹å¼ç»“æœç›¸åŒï¼Œä½†å…ˆdeleteåinsertæ›´é«˜æ•ˆ</span>
<span class="hljs-comment">// (é¿å…ä¸´æ—¶åˆ›å»ºè¿‡é•¿çš„å­—ç¬¦ä¸²)</span>
</code></pre>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li>å‡è®¾äº†insertæ€»æ˜¯æˆåŠŸ</li>
<li>æ²¡æœ‰è€ƒè™‘InputFilteræ‹’ç»çš„æƒ…å†µ</li>
<li>æ²¡æœ‰å›æ»šæœºåˆ¶</li>
</ul>
<hr/>
<h3 data-id="heading-13">å››ã€Spanæœºåˆ¶å¯¼è‡´çš„èŒƒå›´å¼‚å¸¸æ‰©å±•</h3>
<h4 data-id="heading-14">4.1 COMPOSING Spançš„ä½œç”¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// BaseInputConnection.java</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">COMPOSING</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComposingText</span>();

<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComposingText</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NoCopySpan</span> {
    <span class="hljs-comment">// ç©ºå®ç°ï¼Œåªä½œä¸ºæ ‡è®°</span>
}

<span class="hljs-comment">// è·å–ç»„åˆæ–‡æœ¬èŒƒå›´</span>
<span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getComposingSpanStart</span><span class="hljs-params">(Spannable text)</span> {
    <span class="hljs-keyword">return</span> text.getSpanStart(COMPOSING);
}

<span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getComposingSpanEnd</span><span class="hljs-params">(Spannable text)</span> {
    <span class="hljs-keyword">return</span> text.getSpanEnd(COMPOSING);
}

<span class="hljs-comment">// è®¾ç½®ç»„åˆæ–‡æœ¬èŒƒå›´</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">setComposingSpans</span><span class="hljs-params">(Spannable text, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end)</span> {
    <span class="hljs-comment">// ç§»é™¤æ—§çš„COMPOSING Span</span>
    removeComposingSpans(text);

    <span class="hljs-comment">// è®¾ç½®æ–°çš„COMPOSING Span</span>
    text.setSpan(COMPOSING, start, end,
                 Spanned.SPAN_EXCLUSIVE_EXCLUSIVE | Spanned.SPAN_COMPOSING);
}
</code></pre>
<h4 data-id="heading-15">4.2 SpanèŒƒå›´çš„åŠ¨æ€å˜åŒ–</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆå§‹çŠ¶æ€</span>
<span class="hljs-type">SpannableStringBuilder</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpannableStringBuilder</span>(<span class="hljs-string">"123456"</span>);
<span class="hljs-comment">// æ— COMPOSING Span</span>

<span class="hljs-comment">// ç¬¬1æ¬¡ setComposingText("q")</span>
setComposingSpans(<span class="hljs-number">6</span>, <span class="hljs-number">6</span>)  <span class="hljs-comment">// è®¾ç½®ç©ºèŒƒå›´Span</span>
<span class="hljs-comment">// text: "123456"</span>
<span class="hljs-comment">// Span: [6, 6) â† ç©ºèŒƒå›´ï¼Œä½†Spanå­˜åœ¨</span>

<span class="hljs-comment">// ç¬¬2æ¬¡ setComposingText("qq")</span>
<span class="hljs-comment">// 1. è·å–èŒƒå›´</span>
<span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> getComposingSpanStart() â†’ è¿”å› <span class="hljs-number">5</span> â† ä¸ºä»€ä¹ˆï¼Ÿ
<span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> getComposingSpanEnd() â†’ è¿”å› <span class="hljs-number">6</span>

<span class="hljs-comment">// 2. delete(5, 6)</span>
text.delete(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>)
<span class="hljs-comment">// text: "12345"</span>
<span class="hljs-comment">// Spanè¢«è‡ªåŠ¨è°ƒæ•´...</span>

<span class="hljs-comment">// 3. insert("qq") å¤±è´¥</span>

<span class="hljs-comment">// 4. setComposingSpans(5, 5)</span>
<span class="hljs-comment">// text: "12345"</span>
<span class="hljs-comment">// Span: [5, 5)</span>
</code></pre>
<h4 data-id="heading-16">4.3 ä¸ºä»€ä¹ˆSpanèŒƒå›´ä¼šä»[6,6)å˜æˆ[5,6)?</h4>
<p><strong>å…³é”®ä»£ç </strong>ï¼šsetComposingSpansçš„å®ç°</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setComposingSpans</span><span class="hljs-params">(Spannable text, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end)</span> {
    <span class="hljs-comment">// è·å–[start, end)èŒƒå›´å†…çš„æ‰€æœ‰Span</span>
    <span class="hljs-keyword">final</span> Object[] sps = text.getSpans(start, end, Object.class);
    <span class="hljs-keyword">if</span> (sps != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> sps.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> sps[i];
            <span class="hljs-keyword">if</span> (o == COMPOSING) {
                text.removeSpan(o);
                <span class="hljs-keyword">continue</span>;
            }

            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">fl</span> <span class="hljs-operator">=</span> text.getSpanFlags(o);
            <span class="hljs-comment">// å…³é”®ï¼šä¿®æ”¹å…¶ä»–Spançš„èŒƒå›´å’Œæ ‡å¿—</span>
            <span class="hljs-keyword">if</span> ((fl &amp; (Spanned.SPAN_COMPOSING | Spanned.SPAN_POINT_MARK_MASK))
                    != (Spanned.SPAN_COMPOSING | SPAN_EXCLUSIVE_EXCLUSIVE)) {
                text.setSpan(o, start, end,
                    (fl &amp; ~SPAN_POINT_MARK_MASK)
                    | SPAN_COMPOSING | SPAN_EXCLUSIVE_EXCLUSIVE);
            }
        }
    }

    <span class="hljs-comment">// è®¾ç½®æ–°çš„COMPOSING Span</span>
    text.setSpan(COMPOSING, start, end,
        SPAN_EXCLUSIVE_EXCLUSIVE | SPAN_COMPOSING);
}
</code></pre>
<p><strong>é—®é¢˜æ ¹æº</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">ç¬¬<span class="hljs-number">1</span>æ¬¡ <span class="hljs-built_in">setComposingSpans</span>(<span class="hljs-number">6</span>, <span class="hljs-number">6</span>):
  - è®¾ç½® COMPOSING Span [<span class="hljs-number">6</span>, <span class="hljs-number">6</span>)
  - texté•¿åº¦: <span class="hljs-number">6</span>
  - æœŸæœ›: Spanåœ¨æ–‡æœ¬æœ«å°¾

ç¬¬<span class="hljs-number">2</span>æ¬¡ <span class="hljs-built_in">insert</span>(<span class="hljs-string">"q"</span>) å¤±è´¥:
  - texté•¿åº¦ä»æ˜¯<span class="hljs-number">6</span>
  - ä½† <span class="hljs-built_in">setComposingSpans</span>(<span class="hljs-number">6</span>, <span class="hljs-number">6</span> + <span class="hljs-string">"q"</span>.<span class="hljs-built_in">length</span>()) æœŸæœ›é•¿åº¦æ˜¯<span class="hljs-number">7</span>
  - SpanèŒƒå›´è®¡ç®—å‡ºç°åå·®

ç¬¬<span class="hljs-number">3</span>æ¬¡ <span class="hljs-built_in">getComposingSpanStart</span>():
  - SpannableStringBuilderå†…éƒ¨çš„Spanä½ç½®è®¡ç®—
  - ç”±äºtexté•¿åº¦ä¸é¢„æœŸä¸ç¬¦
  - è¿”å›äº†é”™è¯¯çš„èµ·å§‹ä½ç½® (<span class="hljs-number">5</span>è€Œä¸æ˜¯<span class="hljs-number">6</span>)

è¿é”ååº”:
  [<span class="hljs-number">6</span>, <span class="hljs-number">6</span>) â†’ deleteä¸æ‰§è¡Œ â†’ [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>) â†’ <span class="hljs-built_in">delete</span>(<span class="hljs-number">5</span>,<span class="hljs-number">6</span>) â†’ [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>) â†’ <span class="hljs-built_in">delete</span>(<span class="hljs-number">4</span>,<span class="hljs-number">5</span>) â†’ ...
  èŒƒå›´é€æ¸å‘å‰æ‰©å±•ï¼Œåå™¬æ›´å¤šå­—ç¬¦ï¼
</code></pre>
<h4 data-id="heading-17">4.4 SpanèŒƒå›´æ‰©å±•çš„å¯è§†åŒ–</h4>
<pre><code class="hljs language-sql" lang="sql">æ–‡æœ¬:     "123456"
ç´¢å¼•:      <span class="hljs-number">012345</span>

ç¬¬<span class="hljs-number">1</span>æ¬¡æ“ä½œå:
  text:  "123456"
  Span:  [<span class="hljs-number">6</span>, <span class="hljs-number">6</span>)  â† ç©ºèŒƒå›´ï¼Œåœ¨<span class="hljs-string">'6'</span>ä¹‹å

ç¬¬<span class="hljs-number">2</span>æ¬¡æ“ä½œ:
  <span class="hljs-number">1.</span> è·å–èŒƒå›´: [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>) â† å¼‚å¸¸ï¼ä¸ºä»€ä¹ˆå˜äº†ï¼Ÿ
  <span class="hljs-number">2.</span> <span class="hljs-keyword">delete</span>(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>): "12345" â† åˆ é™¤<span class="hljs-string">'6'</span>
  <span class="hljs-number">3.</span> <span class="hljs-keyword">insert</span>å¤±è´¥
  <span class="hljs-number">4.</span> è®¾ç½®Span: [<span class="hljs-number">5</span>, <span class="hljs-number">5</span>) â† åœ¨<span class="hljs-string">'5'</span>ä¹‹å

ç¬¬<span class="hljs-number">3</span>æ¬¡æ“ä½œ:
  <span class="hljs-number">1.</span> è·å–èŒƒå›´: [<span class="hljs-number">3</span>, <span class="hljs-number">5</span>) â† ç»§ç»­æ‰©å±•
  <span class="hljs-number">2.</span> <span class="hljs-keyword">delete</span>(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>): "123" â† åˆ é™¤<span class="hljs-string">'4'</span>å’Œ<span class="hljs-string">'5'</span>
  <span class="hljs-number">3.</span> <span class="hljs-keyword">insert</span>å¤±è´¥
  <span class="hljs-number">4.</span> è®¾ç½®Span: [<span class="hljs-number">3</span>, <span class="hljs-number">3</span>)

ç¬¬<span class="hljs-number">4</span>æ¬¡æ“ä½œ:
  <span class="hljs-number">1.</span> è·å–èŒƒå›´: [<span class="hljs-number">0</span>, <span class="hljs-number">3</span>)
  <span class="hljs-number">2.</span> <span class="hljs-keyword">delete</span>(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>): "" â† åˆ é™¤å…¨éƒ¨
</code></pre>
<p><strong>åº•å±‚åŸå› </strong>ï¼šSpannableStringBuilderçš„Spanä½ç½®è®¡ç®—ä¾èµ–æ–‡æœ¬é•¿åº¦ï¼Œå½“å®é™…é•¿åº¦ä¸é¢„æœŸä¸ç¬¦æ—¶ï¼ŒSpançš„<code>start/end</code>ä¼šè¢«é”™è¯¯åœ°è°ƒæ•´ã€‚</p>
<hr/>
<h3 data-id="heading-18">äº”ã€è®¾è®¡ç¼ºé™·çš„å±‚æ¬¡åˆ†æ</h3>
<h4 data-id="heading-19">5.1 æ¥å£å±‚ï¼šfilter()æ— æ³•åŒºåˆ†æ“ä½œç±»å‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å½“å‰æ¥å£</span>
CharSequence <span class="hljs-title function_">filter</span><span class="hljs-params">(CharSequence source, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end,
                   Spanned dest, <span class="hljs-type">int</span> dstart, <span class="hljs-type">int</span> dend)</span>;
</code></pre>
<p><strong>ç¼ºé™·</strong>ï¼š</p>
<ul>
<li>åªçœ‹åˆ°<code>source</code>ï¼ˆè¦æ’å…¥çš„å†…å®¹ï¼‰</li>
<li>çœ‹ä¸åˆ°æ“ä½œç±»å‹ï¼ˆinsert? delete? replace?ï¼‰</li>
<li>çœ‹ä¸åˆ°æ“ä½œæ¥æºï¼ˆç”¨æˆ·? è¾“å…¥æ³•? ç³»ç»Ÿ?ï¼‰</li>
<li>æ— æ³•åŒºåˆ†"æ’å…¥ç©ºå­—ç¬¦ä¸²"å’Œ"åˆ é™¤æ“ä½œ"</li>
</ul>
<p><strong>ç†æƒ³æ¥å£</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">OperationType</span> { INSERT, DELETE, REPLACE }
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">OperationSource</span> { USER_KEY, IME, SYSTEM }

CharSequence <span class="hljs-title function_">filter</span><span class="hljs-params">(CharSequence source, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end,
                   Spanned dest, <span class="hljs-type">int</span> dstart, <span class="hljs-type">int</span> dend,
                   OperationType type,     // æ“ä½œç±»å‹
                   OperationSource source)</span>; <span class="hljs-comment">// æ“ä½œæ¥æº</span>
</code></pre>
<h4 data-id="heading-20">5.2 å®ç°å±‚ï¼šreplaceText()ç¼ºä¹åŸå­æ€§</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å½“å‰å®ç°ï¼ˆæœ‰ç¼ºé™·ï¼‰</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">replaceText</span><span class="hljs-params">(CharSequence text, ...)</span> {
    <span class="hljs-keyword">if</span> (b != a) {
        content.delete(a, b); <span class="hljs-comment">// å¯èƒ½åˆ é™¤åˆæ³•å†…å®¹</span>
    }
    <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span>) {
        content.insert(a, text); <span class="hljs-comment">// å¯èƒ½è¢«è¿‡æ»¤</span>
    }
    <span class="hljs-comment">// æ²¡æœ‰å›æ»šæœºåˆ¶ï¼</span>
}
</code></pre>
<p><strong>æ”¹è¿›æ–¹å‘1</strong>ï¼šå…ˆéªŒè¯</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">replaceText</span><span class="hljs-params">(CharSequence text, ...)</span> {
    <span class="hljs-comment">// å…ˆæ£€æŸ¥æ–°æ–‡æœ¬æ˜¯å¦åˆæ³•</span>
    <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span>) {
        <span class="hljs-type">CharSequence</span> <span class="hljs-variable">filtered</span> <span class="hljs-operator">=</span> applyFilters(text, a, a);
        <span class="hljs-keyword">if</span> (filtered.length() == <span class="hljs-number">0</span> &amp;&amp; text.length() &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// æ–°æ–‡æœ¬è¢«å®Œå…¨è¿‡æ»¤ï¼Œæ”¾å¼ƒæ›¿æ¢</span>
            <span class="hljs-keyword">return</span>;
        }
        text = filtered; <span class="hljs-comment">// ä½¿ç”¨è¿‡æ»¤åçš„å†…å®¹</span>
    }

    <span class="hljs-comment">// å†æ‰§è¡Œæ›¿æ¢</span>
    <span class="hljs-keyword">if</span> (b != a) {
        content.delete(a, b);
    }
    <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span>) {
        content.insert(a, text);
    }
}
</code></pre>
<p><strong>æ”¹è¿›æ–¹å‘2</strong>ï¼šä½¿ç”¨åŸå­replace</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸è¦åˆ†å¼€deleteå’Œinsertï¼Œä½¿ç”¨Editable.replace()</span>
content.replace(a, b, text);
<span class="hljs-comment">// replace()å†…éƒ¨ä¸€æ¬¡æ€§è°ƒç”¨filter</span>
<span class="hljs-comment">// filterå¯ä»¥åŒæ—¶çœ‹åˆ°åˆ é™¤èŒƒå›´[a,b)å’Œæ’å…¥å†…å®¹text</span>
</code></pre>
<h4 data-id="heading-21">5.3 åè®®å±‚ï¼šSpanèŒƒå›´ä¸å¯é </h4>
<p><strong>å½“å‰æœºåˆ¶</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">setComposingSpans</span>(start, end)
  â†’ å‡è®¾æ–‡æœ¬é•¿åº¦ä¼šå˜ä¸ºstart + text<span class="hljs-selector-class">.length</span>()
  â†’ å®é™…: insertå¤±è´¥ï¼Œé•¿åº¦ä¸å˜
  â†’ SpanèŒƒå›´ä¸å®é™…ä¸ç¬¦
  â†’ ä¸‹æ¬¡getComposingSpanStart/<span class="hljs-built_in">End</span>()è¿”å›é”™è¯¯å€¼
</code></pre>
<p><strong>æ”¹è¿›æ–¹å‘</strong>ï¼šå¼•å…¥ç‰ˆæœ¬å·</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ComposingState</span> {
    <span class="hljs-type">int</span> start;
    <span class="hljs-type">int</span> end;
    <span class="hljs-type">int</span> textVersion; <span class="hljs-comment">// æ–‡æœ¬ç‰ˆæœ¬å·</span>

    <span class="hljs-comment">// æ¯æ¬¡æ–‡æœ¬æ“ä½œå¢åŠ ç‰ˆæœ¬å·</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        textVersion++;
    }

    <span class="hljs-comment">// éªŒè¯SpanèŒƒå›´æ˜¯å¦ä»æœ‰æ•ˆ</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isValid</span><span class="hljs-params">(<span class="hljs-type">int</span> currentVersion)</span> {
        <span class="hljs-keyword">return</span> textVersion == currentVersion;
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-22">å…­ã€å¯¹æ¯”ï¼šæ­£å¸¸åœºæ™¯ vs Bugåœºæ™¯</h3>
<h4 data-id="heading-23">6.1 æ­£å¸¸åœºæ™¯ï¼šç”¨æˆ·ä¸»åŠ¨åˆ é™¤</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç”¨æˆ·æŒ‰åˆ é™¤é”®</span>
onKeyDown(KeyEvent.KEYCODE_DEL)
  â†“
BaseInputConnection.deleteSurroundingText(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>)
  â†“
Editable.delete(cursorPos - <span class="hljs-number">1</span>, cursorPos)
  â†“
replace(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-string">""</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
  â†“
filter(<span class="hljs-string">""</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"123456"</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>)
  â†“
è¿”å› <span class="hljs-literal">null</span> (æ¥å—)
  â†“
åˆ é™¤æˆåŠŸ âœ“
</code></pre>
<p><strong>è¿™ç§æƒ…å†µä¸‹ï¼Œdeleteåº”è¯¥è¢«å…è®¸</strong>ï¼ˆç”¨æˆ·ä¸»åŠ¨æ“ä½œï¼‰ã€‚</p>
<h4 data-id="heading-24">6.2 Bugåœºæ™¯ï¼šè¾“å…¥æ³•è‡ªåŠ¨æ›¿æ¢</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è¾“å…¥æ³•è°ƒç”¨ setComposingText("qq", 1)</span>
BaseInputConnection.setComposingText(<span class="hljs-string">"qq"</span>, <span class="hljs-number">1</span>)
  â†“
replaceText(<span class="hljs-string">"qq"</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>)
  â†“
delete(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>) + insert(<span class="hljs-string">"qq"</span>)
  â†“
deleteæˆåŠŸ + insertå¤±è´¥
  â†“
æ•°æ®ä¸¢å¤± âœ—
</code></pre>
<p><strong>è¿™ç§æƒ…å†µä¸‹ï¼Œdeleteæ˜¯"æ›¿æ¢çš„ä¸€éƒ¨åˆ†"ï¼Œåº”è¯¥ä¸insertä¿æŒä¸€è‡´</strong>ã€‚</p>
<h4 data-id="heading-25">6.3 æ ¸å¿ƒå·®å¼‚</h4>






























<table><thead><tr><th>ç»´åº¦</th><th>ç”¨æˆ·åˆ é™¤</th><th>è¾“å…¥æ³•æ›¿æ¢</th></tr></thead><tbody><tr><td><strong>æ“ä½œæ„å›¾</strong></td><td>åˆ é™¤å†…å®¹</td><td>æ›¿æ¢å†…å®¹ï¼ˆdelete+insertï¼‰</td></tr><tr><td><strong>åŸå­æ€§</strong></td><td>å•ä¸ªæ“ä½œ</td><td>ç»„åˆæ“ä½œ</td></tr><tr><td><strong>æ˜¯å¦åº”æ‹¦æˆª</strong></td><td>å¦ï¼ˆå°Šé‡ç”¨æˆ·ï¼‰</td><td>æ˜¯ï¼ˆä¿æŒä¸€è‡´æ€§ï¼‰</td></tr><tr><td><strong>å®é™…è¡Œä¸º</strong></td><td>deleteé€šè¿‡ âœ“</td><td>deleteé€šè¿‡ï¼Œinsertè¢«æ‹’ âœ—</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-26">ä¸ƒã€æ€»ç»“ï¼šè®¾è®¡çš„ä¸å¯¹ç§°æ€§</h3>
<h4 data-id="heading-27">7.1 æ ¸å¿ƒçŸ›ç›¾</h4>
<pre><code class="hljs language-sql" lang="sql">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ–‡æœ¬ç¼–è¾‘æ¡†æ¶çš„ä¸å¯¹ç§°æ€§                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  InputFilter çš„æœŸæœ›:                            â”‚
â”‚    æ§åˆ¶æ‰€æœ‰æ–‡æœ¬æ“ä½œ                              â”‚
â”‚                                                 â”‚
â”‚  Editable çš„å®ç°:                               â”‚
â”‚    <span class="hljs-keyword">insert</span>() â†’ ç»è¿‡<span class="hljs-keyword">filter</span> âœ“                     â”‚
â”‚    <span class="hljs-keyword">delete</span>() â†’ ç»•è¿‡<span class="hljs-keyword">filter</span> âœ—                     â”‚
â”‚                                                 â”‚
â”‚  replaceText() çš„å‡è®¾:                          â”‚
â”‚    <span class="hljs-keyword">delete</span>() æ€»æ˜¯æˆåŠŸ                            â”‚
â”‚    <span class="hljs-keyword">insert</span>() ä¹Ÿæ€»æ˜¯æˆåŠŸ                          â”‚
â”‚                                                 â”‚
â”‚  å®é™…åœºæ™¯:                                       â”‚
â”‚    <span class="hljs-keyword">delete</span>() æˆåŠŸ                                â”‚
â”‚    <span class="hljs-keyword">insert</span>() è¢«InputFilteræ‹’ç»                  â”‚
â”‚    â†’ æ•°æ®ä¸¢å¤±                                   â”‚
â”‚                                                 â”‚
â”‚  Span çš„å‰¯ä½œç”¨:                                 â”‚
â”‚    èŒƒå›´è®¡ç®—ä¾èµ–æ–‡æœ¬é•¿åº¦                          â”‚
â”‚    <span class="hljs-keyword">insert</span>å¤±è´¥å¯¼è‡´é•¿åº¦ä¸ç¬¦                        â”‚
â”‚    â†’ èŒƒå›´å¼‚å¸¸æ‰©å±•                               â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-28">7.2 å¾ªåºæ¸è¿›çš„çŸ¥è¯†é“¾</h4>
<p><strong>ç¬¬ä¸€ç¯‡</strong>ï¼šBinderé€šä¿¡æœºåˆ¶</p>
<ul>
<li>âœ“ ç†è§£äº†è¾“å…¥æ³•â†’åº”ç”¨çš„è·¨è¿›ç¨‹è°ƒç”¨</li>
<li>âœ“ ç†è§£äº†å¼‚æ­¥æ‰§è¡Œå¯¼è‡´çš„ä¿¡æ¯ä¸å¯¹ç§°</li>
<li>â†’ setComposingText("qq")è¢«ä¼ é€’åˆ°åº”ç”¨è¿›ç¨‹</li>
</ul>
<p><strong>ç¬¬äºŒç¯‡ï¼ˆæœ¬æ–‡ï¼‰</strong>ï¼šæ–‡æœ¬ç¼–è¾‘è®¾è®¡ç¼ºé™·</p>
<ul>
<li>âœ“ ç†è§£äº†replaceText()çš„å…ˆdeleteåinsert</li>
<li>âœ“ ç†è§£äº†deleteç»•è¿‡InputFilterçš„æœºåˆ¶</li>
<li>âœ“ ç†è§£äº†SpanèŒƒå›´å¼‚å¸¸æ‰©å±•çš„åŸå› </li>
<li>â†’ ç†è§£äº†ä¸ºä»€ä¹ˆæ•°å­—ä¼šè¢«åˆ é™¤</li>
</ul>
<p><strong>ç¬¬ä¸‰ç¯‡é¢„å‘Š</strong>ï¼šå·¥ç¨‹è§£å†³æ–¹æ¡ˆ</p>
<ul>
<li>å¦‚ä½•åœ¨InputConnectionå±‚æ‹¦æˆªéæ³•ç»„åˆæ–‡æœ¬ï¼Ÿ</li>
<li>å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼ˆä¿ç•™æ•°å­—é”®ç›˜ï¼‰</li>
<li>ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”ä¸æœ€ä½³å®è·µ</li>
<li>â†’ ä»ç†è®ºåˆ°å®è·µ</li>
</ul>
<hr/>
<h3 data-id="heading-29">å‚è€ƒèµ„æ–™</h3>
<ol>
<li>Androidæºç ï¼š<code>frameworks/base/core/java/android/text/SpannableStringBuilder.java</code></li>
<li>Androidæºç ï¼š<code>frameworks/base/core/java/android/view/inputmethod/BaseInputConnection.java</code></li>
<li>Androidæºç ï¼š<code>frameworks/base/core/java/android/text/method/DigitsKeyListener.java</code></li>
<li>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fandroid%2Ftext%2FInputFilter" target="_blank" title="https://developer.android.com/reference/android/text/InputFilter" ref="nofollow noopener noreferrer">InputFilter</a></li>
</ol>
<hr/>
<p><strong>ä¸‹ä¸€ç¯‡</strong>ï¼šã€ŠInputConnectionæœºåˆ¶ä¸è·¨è¿›ç¨‹æ–‡æœ¬æ“ä½œçš„å·¥ç¨‹å®è·µã€‹- å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œæ—¢ä¿ç•™æ•°å­—é”®ç›˜ï¼Œåˆé¿å…æ•°æ®ä¸¢å¤±</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Agentã€‘ç”Ÿæˆå¼éšå¼è®°å¿† MemGen æºç è§£è¯»]]></title>    <link>https://juejin.cn/post/7570940025580486696</link>    <guid>https://juejin.cn/post/7570940025580486696</guid>    <pubDate>2025-11-10T11:58:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570940025580486696" data-draft-id="7569864390942425139" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Agentã€‘ç”Ÿæˆå¼éšå¼è®°å¿† MemGen æºç è§£è¯»"/> <meta itemprop="keywords" content="ç®—æ³•,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-10T11:58:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç½—è¥¿çš„æ€è€ƒ"/> <meta itemprop="url" content="https://juejin.cn/user/351470467691175"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Agentã€‘ç”Ÿæˆå¼éšå¼è®°å¿† MemGen æºç è§£è¯»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/351470467691175/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç½—è¥¿çš„æ€è€ƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T11:58:10.000Z" title="Mon Nov 10 2025 11:58:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»27åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ã€Agentã€‘ç”Ÿæˆå¼éšå¼è®°å¿† MemGen æºç è§£è¯»</h2>
<p>[toc]</p>
<h3 data-id="heading-1">0x00 æ¦‚è¦</h3>
<p>MemGenæ—¨åœ¨æ„å»ºä¸€ä¸ªåŠ¨æ€ã€ç”Ÿæˆå¼çš„è®°å¿†æ¡†æ¶ï¼Œå…¶æ ¸å¿ƒç”±ä¸¤ä¸ªååŒå·¥ä½œçš„è½»é‡çº§æ¨¡å—æ„æˆï¼šä¸€ä¸ªåŸºäºå¼ºåŒ–å­¦ä¹ ï¼ˆRLï¼‰è®­ç»ƒçš„è®°å¿†è§¦å‘å™¨ï¼ˆMemory Triggerï¼‰å’Œä¸€ä¸ªè®°å¿†ç¼–ç»‡å™¨ï¼ˆMemory Weaverï¼‰ã€‚</p>
<p>è®ºæ–‡ï¼šMemGen: Weaving Generative Latent Memory for Self-Evolving Agents</p>
<p>é“¾æ¥ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2509.24704" target="_blank" title="https://arxiv.org/abs/2509.24704" ref="nofollow noopener noreferrer">arxiv.org/abs/2509.24â€¦</a></p>
<p>ä»£ç ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FKANABOON1%2FMemGen" target="_blank" title="https://github.com/KANABOON1/MemGen" ref="nofollow noopener noreferrer">github.com/KANABOON1/Mâ€¦</a></p>
<h3 data-id="heading-2">0x01 èƒŒæ™¯</h3>
<p>MemGen æå‡ºåŠ¨æ€ç”Ÿæˆå¼è®°å¿†æ¡†æ¶ï¼Œç”±è®°å¿†è§¦å‘å™¨ä¸è®°å¿†ç¼–ç»‡å™¨ä¸¤ä¸ªè½»é‡æ¨¡å—ååŒæ„æˆï¼Œæ—¨åœ¨çªç ´ç°æœ‰æ™ºèƒ½ä½“è®°å¿†èŒƒå¼çš„å±€é™ã€‚</p>
<p>å½“å‰ä¸»æµçš„è®°å¿†å®ç°è·¯å¾„ä¸ºï¼š</p>
<ul>
<li>å‚æ•°åŒ–è®°å¿†é€šè¿‡å¾®è°ƒå°†ç»éªŒç¼–ç è¿›æ¨¡å‹å‚æ•°ï¼Œè™½èƒ½æ·±åº¦å†…åŒ–çŸ¥è¯†å´æ˜“å¼•å‘ç¾éš¾æ€§é—å¿˜ï¼›</li>
<li>åŸºäºæ£€ç´¢çš„è®°å¿†å°†ç»éªŒå¤–åŒ–å­˜å‚¨ï¼Œè™½è§„é¿äº†é—å¿˜é—®é¢˜ï¼Œä½†é™æ€çš„ä¸€æ¬¡æ€§æ£€ç´¢æœºåˆ¶æ— æ³•ä½“ç°è®°å¿†ä¸æ¨ç†åŠ¨æ€äº¤äº’çš„è®¤çŸ¥ç‰¹æ€§ã€‚</li>
</ul>
<p>è¿™ä¸€ç°çŠ¶å¼•å‡ºä¸¤å¤§æ ¸å¿ƒé—®é¢˜ï¼šå¦‚ä½•å®ç°è®°å¿†ä¸æ¨ç†åœ¨æ¯ä¸€æ­¥æ€è€ƒä¸­çš„æ— ç¼è€¦åˆï¼Œä»¥åŠå¦‚ä½•è®©è®°å¿†ä»æå–å¼å‡çº§ä¸ºæ»¡è¶³å½“å‰éœ€æ±‚çš„ç”Ÿæˆå¼é‡æ„ï¼Œè€ŒåŠ¨æ€ç”Ÿæˆå¼éšå¼è®°å¿†æ­£æ˜¯åº”å¯¹è¿™äº›æŒ‘æˆ˜çš„ç¬¬ä¸‰ç§æ¢ç´¢è·¯å¾„ã€‚</p>
<h3 data-id="heading-3">0x02 æºç è§£æ</h3>
<p>MemGené¡¹ç›®æ—¨åœ¨åˆ›å»ºä¸€ä¸ªåŠ¨æ€ä¸”è‡ªç”Ÿæˆçš„è®°å¿†æ¡†æ¶ï¼Œè¯¥æ¡†æ¶ç”±ä¸¤ä¸ªååŒå·¥ä½œçš„è½»é‡çº§æ¨¡å—ç»„æˆï¼šä¸€ä¸ªåŸºäºå¼ºåŒ–å­¦ä¹ è®­ç»ƒçš„è®°å¿†è§¦å‘å™¨å’Œä¸€ä¸ªè®°å¿†ç¼–ç»‡å™¨ã€‚è¿™ä¸€æ¡†æ¶çš„æ ¸å¿ƒæ€æƒ³æ˜¯è§£å†³å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æ™ºèƒ½ä½“èƒ½åŠ›æ¶Œç°æ—¶å¯¹â€œè‡ªè¿›åŒ–â€æœºåˆ¶çš„æ¢ç´¢éœ€æ±‚ï¼Œå…¶ä¸­è®°å¿†æ‰®æ¼”å…³é”®è§’è‰²ã€‚</p>
<h4 data-id="heading-4">2.1 æ¨¡å‹</h4>
<p>LatentMemoryModel æ˜¯ MemGen æ¡†æ¶çš„æ ¸å¿ƒå®ç°ï¼Œæ—¨åœ¨æ„å»ºåŠ¨æ€ç”Ÿæˆå¼éšå¼è®°å¿†ç³»ç»Ÿï¼Œè§£å†³ä¼ ç»Ÿè®°å¿†èŒƒå¼çš„å±€é™æ€§ã€‚é€šè¿‡æ•´åˆæ¨ç†å™¨ï¼ˆReasonerï¼‰ã€è®°å¿†ç¼–ç»‡å™¨ï¼ˆWeaverï¼‰å’Œè®°å¿†è§¦å‘å™¨ï¼ˆTriggerï¼‰ï¼Œå®ç°è®°å¿†ä¸æ¨ç†è¿‡ç¨‹çš„æ— ç¼è€¦åˆï¼Œè®©æ™ºèƒ½ä½“åœ¨ä»»åŠ¡æ‰§è¡Œä¸­åŠ¨æ€ç”Ÿæˆã€ä½¿ç”¨è®°å¿†ï¼Œè€Œéä¾èµ–é™æ€æ£€ç´¢æˆ–å‚æ•°åŒ–å­˜å‚¨ã€‚</p>
<h5 data-id="heading-5">2.1.1  æ ¸å¿ƒç‰¹è‰²</h5>
<p>æ¨¡å‹çš„æ ¸å¿ƒç‰¹è‰²å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>æ¨¡å—åŒ–ååŒè®¾è®¡</strong>ï¼šç”±æ¨ç†å™¨ï¼ˆæ ¸å¿ƒæ¨ç†ï¼‰ã€ç¼–ç»‡å™¨ï¼ˆç”Ÿæˆæ½œåœ¨è®°å¿†ï¼‰ã€è§¦å‘å™¨ï¼ˆæ§åˆ¶è®°å¿†è§¦å‘ï¼‰ä¸‰å¤§æ¨¡å—æ„æˆï¼Œæ¨¡å—é—´é€šè¿‡æŠ•å½±å±‚å®ç°åµŒå…¥ç©ºé—´æ˜ å°„ï¼Œç»“æ„æ¸…æ™°ä¸”è§£è€¦ã€‚</li>
<li><strong>åŠ¨æ€è®°å¿†å¢å¼º</strong>ï¼šåœ¨æ¨ç†è¿‡ç¨‹ä¸­è‡ªåŠ¨è¯†åˆ«åˆ†éš”ç¬¦ä½ç½®ä½œä¸ºè®°å¿†å¢å¼ºç‚¹ï¼ŒåŠ¨æ€æ’å…¥ç¼–ç»‡å™¨ç”Ÿæˆçš„æ½œåœ¨è®°å¿†ï¼Œçªç ´é™æ€è®°å¿†æ³¨å…¥çš„å±€é™ï¼Œè´´åˆäººç±»è®¤çŸ¥ä¸­è®°å¿†ä¸æ¨ç†çš„åŠ¨æ€äº¤äº’ç‰¹æ€§ã€‚</li>
<li><strong>ç²¾åº¦ä¸æ•ˆç‡ä¼˜åŒ–</strong>ï¼šé»˜è®¤ä½¿ç”¨ bfloat16 ç²¾åº¦ï¼Œæ¨ç†å™¨é‡‡ç”¨ Flash Attention 2 æå‡è®¡ç®—æ•ˆç‡ï¼›å†»ç»“æ¨ç†å™¨å‚æ•°ï¼Œä»…è®­ç»ƒç¼–ç»‡å™¨å’Œè§¦å‘å™¨ï¼Œå®ç°å‚æ•°é«˜æ•ˆå­¦ä¹ ã€‚</li>
<li><strong>çµæ´»é…ç½®ä¸å…¼å®¹æ€§</strong>ï¼šæ”¯æŒè‡ªå®šä¹‰è§¦å‘å™¨æ¨¡å‹ã€PEFT å¾®è°ƒé…ç½®ã€è®°å¿†å¢å¼ºæ¬¡æ•°ç­‰å‚æ•°ï¼›è‡ªåŠ¨å¤„ç† Tokenizer ç¼ºå¤± pad token çš„é—®é¢˜ï¼Œæ ‡å‡†åŒ–å¯¹è¯æ¨¡æ¿ï¼Œæå‡è·¨åœºæ™¯å…¼å®¹æ€§ã€‚</li>
<li><strong>æŸå¤±è®¡ç®—ç²¾å‡†è¿‡æ»¤</strong>ï¼šé€šè¿‡æ½œåœ¨è®°å¿†æ©ç æ’é™¤è®°å¿†åµŒå…¥å¯¹åº”çš„ä½ç½®ï¼Œä»…å¯¹åŸå§‹è¾“å…¥ä½ç½®è®¡ç®—æŸå¤±ï¼Œç¡®ä¿è®­ç»ƒç›®æ ‡èšç„¦äºæ ¸å¿ƒä»»åŠ¡æ€§èƒ½ï¼Œé¿å…è®°å¿†ç”Ÿæˆè¿‡ç¨‹å¹²æ‰°ä¸»ä»»åŠ¡å­¦ä¹ ã€‚</li>
</ul>
<h5 data-id="heading-6">2.1.2  ç½‘ç»œç»“æ„</h5>
<p>å…³é”®è¯´æ˜ï¼ˆæ ¸å¿ƒè®¾è®¡äº®ç‚¹ï¼‰</p>
<ol>
<li><strong>ä¸‰å¤§æ¨¡å—ååŒé€»è¾‘</strong>ï¼š
<ul>
<li>æ¨ç†å™¨ï¼ˆReasonerï¼‰ï¼šæ ¸å¿ƒæ¨ç†ç»„ä»¶ï¼Œæƒé‡å†»ç»“ä»¥ä¿ç•™åŸºç¡€èƒ½åŠ›ï¼Œä»…é€šè¿‡æ½œåœ¨è®°å¿†è°ƒæ•´è§£ç è·¯å¾„ã€‚</li>
<li>è§¦å‘å™¨ï¼ˆMemGenTriggerï¼‰ï¼šåŠ¨æ€åˆ¤æ–­è®°å¿†æ’å…¥æ—¶æœºï¼Œè¾“å‡ºäºŒåˆ†ç±»è§¦å‘æ¦‚ç‡ï¼Œå†³å®šæ˜¯å¦è°ƒç”¨ç¼–ç»‡å™¨ã€‚</li>
<li>ç¼–ç»‡å™¨ï¼ˆMemGenWeaverï¼‰ï¼šç”Ÿæˆé’ˆå¯¹æ€§æ½œåœ¨è®°å¿†ï¼Œåˆ†æç¤ºè¯ / æ¨ç†ä¸¤é˜¶æ®µè®¾è®¡ï¼Œæ”¯æŒ PEFT é«˜æ•ˆå¾®è°ƒã€‚</li>
</ul>
</li>
<li><strong>æ ¸å¿ƒæµç¨‹é—­ç¯</strong>ï¼šè¾“å…¥ â†’ æ¨ç†å™¨ç”ŸæˆåŸå§‹åµŒå…¥ â†’ è§¦å‘å™¨ + å¢å¼ºç‚¹é€‰æ‹©æ¨¡å—ç¡®å®šæ’å…¥ä½ç½® â†’ ç¼–ç»‡å™¨ç”Ÿæˆæ½œåœ¨è®°å¿† â†’ æŠ•å½±å±‚é€‚é…ç»´åº¦ â†’ é‡ç»„å¢å¼ºåºåˆ— â†’ æ¨ç†å™¨å®Œæˆæœ€ç»ˆæ¨ç† â†’ è¿‡æ»¤æ— æ•ˆä½ç½®è¾“å‡ºã€‚</li>
<li><strong>å…³é”®æŠ€æœ¯ç»†èŠ‚</strong>ï¼š
<ul>
<li>è·¨æ¨¡å—æŠ•å½±ï¼šé€šè¿‡ <code>reasoner_to_weaver</code> å’Œ <code>weaver_to_reasoner</code> è§£å†³æ¨ç†å™¨ä¸ç¼–ç»‡å™¨åµŒå…¥ç»´åº¦ä¸åŒ¹é…é—®é¢˜ã€‚</li>
<li>åŠ¨æ€è®°å¿†å¢å¼ºï¼šæŒ‰åˆ†éš”ç¬¦æ‹†åˆ†åºåˆ—ï¼Œé€æ®µæ’å…¥è®°å¿†ï¼Œé¿å…é•¿åºåˆ—å†—ä½™ï¼Œè´´åˆäººç±» â€œæ€è€ƒ - è®°å¿†â€ äº¤äº’æ¨¡å¼ã€‚</li>
<li>ç²¾åº¦ä¸æ•ˆç‡ï¼šå…¨æµç¨‹é‡‡ç”¨ bfloat16 ç²¾åº¦ï¼Œæ¨ç†å™¨ / ç¼–ç»‡å™¨å¯ç”¨ Flash Attention 2ï¼Œå¹³è¡¡æ€§èƒ½ä¸é€Ÿåº¦ã€‚</li>
</ul>
</li>
<li><strong>è®­ç»ƒä¸æ¨ç†é€‚é…</strong>ï¼š
<ul>
<li>è®­ç»ƒæ—¶ï¼šé€šè¿‡ <code>labels</code> å’Œ <code>valid_logits</code> è®¡ç®—æŸå¤±ï¼Œä»…ä¼˜åŒ–ç¼–ç»‡å™¨ã€è§¦å‘å™¨åŠæŠ•å½±å±‚å‚æ•°ã€‚</li>
<li>æ¨ç†æ—¶ï¼šæ— éœ€ <code>labels</code>ï¼Œè‡ªåŠ¨å®Œæˆ â€œè§¦å‘åˆ¤æ–­ - è®°å¿†ç”Ÿæˆ - æ¨ç†å¢å¼ºâ€ å…¨æµç¨‹ï¼Œå®ç°åŠ¨æ€è‡ªè¿›åŒ–ã€‚</li>
</ul>
</li>
</ol>
<p>å…·ä½“ç½‘ç»œç»“æ„å¦‚ä¸‹</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fedf1bee4f404d00b60b5ade066b5dd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763380690&amp;x-signature=udJwW4ZcYOdkSaA%2FuS5q7k6%2FUAc%3D" alt="MemGen-1.png" loading="lazy"/></p>
<h5 data-id="heading-7">2.1.3 ä»£ç </h5>
<p>LatentMemoryModel çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@registry.register_model(<span class="hljs-params"><span class="hljs-string">"latmem"</span></span>)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LatentMemoryModel</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):  <span class="hljs-comment"># å®šä¹‰äº†ä¸€ä¸ªåä¸º LatentMemoryModel çš„ç±»ï¼Œç»§æ‰¿è‡ª BaseModel</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">
        self, 
        reasoner_model_name: <span class="hljs-built_in">str</span>,  <span class="hljs-comment"># æ¨ç†æ¨¡å‹åç§°</span>
        weaver_model_name: <span class="hljs-built_in">str</span>,  <span class="hljs-comment"># è®°å¿†ç¼–ç»‡å™¨æ¨¡å‹åç§°</span>
        prompt_latents_len: <span class="hljs-built_in">int</span>,  <span class="hljs-comment"># æç¤ºé•¿åº¦</span>
        inference_latents_len: <span class="hljs-built_in">int</span>,  <span class="hljs-comment"># æ¨ç†é•¿åº¦</span>
        weaver_peft_config: <span class="hljs-type">Optional</span>[PeftConfig] = <span class="hljs-literal">None</span>,  <span class="hljs-comment"># è®°å¿†ç¼–ç»‡å™¨é…ç½®ï¼Œå¯é€‰</span>
        trigger_model_name: <span class="hljs-built_in">str</span> = <span class="hljs-literal">None</span>,  <span class="hljs-comment"># è§¦å‘æ¨¡å‹åç§°ï¼Œå¯é€‰</span>
        trigger_peft_config: <span class="hljs-type">Optional</span>[PeftConfig] = <span class="hljs-literal">None</span>,  <span class="hljs-comment"># è§¦å‘å™¨é…ç½®ï¼Œå¯é€‰</span>
        max_prompt_aug_num: <span class="hljs-built_in">int</span> = <span class="hljs-number">1</span>,  <span class="hljs-comment"># æœ€å¤§æç¤ºå¢å¼ºæ•°é‡</span>
        max_inference_aug_num: <span class="hljs-built_in">int</span> = <span class="hljs-number">5</span>,  <span class="hljs-comment"># æœ€å¤§æ¨ç†å¢å¼ºæ•°é‡</span>
    </span>):   
        <span class="hljs-built_in">super</span>().__init__()  <span class="hljs-comment"># è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°</span>

        <span class="hljs-comment"># æ„å»ºæ¨ç†æ¨¡å‹</span>
        self.model = AutoModelForCausalLM.from_pretrained(  <span class="hljs-comment"># ä»é¢„è®­ç»ƒæ¨¡å‹åŠ è½½æ¨ç†æ¨¡å‹</span>
            reasoner_model_name, torch_dtype=torch.bfloat16, attn_implementation=<span class="hljs-string">"flash_attention_2"</span>)
        self.tokenizer = AutoTokenizer.from_pretrained(reasoner_model_name)  <span class="hljs-comment"># åŠ è½½å…¥åˆ†è¯å™¨</span>
        self.config = self.model.config  <span class="hljs-comment"># è·å–æ¨¡å‹é…ç½®</span>
        
        <span class="hljs-comment"># æ„å»ºè®°å¿†ç¼–ç»‡å™¨</span>
        self.weaver = MemGenWeaver(  <span class="hljs-comment"># åˆå§‹åŒ–è®°å¿†ç¼–ç»‡å™¨</span>
            weaver_model_name, prompt_latents_len, inference_latents_len, weaver_peft_config
        )
        
        <span class="hljs-comment"># æ„å»ºè§¦å‘å™¨</span>
        self.trigger = NanoTrigger()  <span class="hljs-comment"># é»˜è®¤è§¦å‘å™¨ï¼Œå§‹ç»ˆè¿”å› true</span>
        <span class="hljs-keyword">if</span> trigger_model_name <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            self.trigger = MemGenTrigger(  <span class="hljs-comment"># å¦‚æœæŒ‡å®šäº†è§¦å‘æ¨¡å‹ï¼Œåˆ™åŠ è½½ç›¸åº”çš„è§¦å‘å™¨</span>
                trigger_model_name, trigger_peft_config
            )
            logging.info(<span class="hljs-string">f"Use Trigger: <span class="hljs-subst">{trigger_model_name}</span>"</span>)  <span class="hljs-comment"># è®°å½•æ—¥å¿—</span>
        
        <span class="hljs-comment"># æŠ•å½±å±‚ï¼Œç”¨äºåœ¨æ¨ç†æ¨¡å‹å’Œè®°å¿†ç¼–ç»‡å™¨ä¹‹é—´æ˜ å°„åµŒå…¥</span>
        <span class="hljs-comment"># å°†æ¨ç†æ¨¡å‹è¾“å…¥åµŒå…¥æ˜ å°„åˆ°è®°å¿†ç¼–ç»‡å™¨è¾“å…¥åµŒå…¥</span>
        self.reasoner_to_weaver = nn.Linear(  <span class="hljs-comment"># çº¿æ€§å±‚ï¼Œä»æ¨ç†æ¨¡å‹éšè—å±‚åˆ°è®°å¿†ç¼–ç»‡å™¨éšè—å±‚</span>
            self.model.config.hidden_size, self.weaver.config.hidden_size, dtype=torch.bfloat16
        )
        <span class="hljs-comment"># å°†è®°å¿†ç¼–ç»‡å™¨éšè—çŠ¶æ€æ˜ å°„å›æ¨ç†æ¨¡å‹è¾“å…¥åµŒå…¥</span>
        self.weaver_to_reasoner = nn.Linear(  <span class="hljs-comment"># çº¿æ€§å±‚ï¼Œä»è®°å¿†ç¼–ç»‡å™¨éšè—å±‚åˆ°æ¨ç†æ¨¡å‹éšè—å±‚</span>
            self.weaver.config.hidden_size, self.model.config.hidden_size, dtype=torch.bfloat16
        )
        
        self.delimiters: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = [<span class="hljs-string">","</span>, <span class="hljs-string">"."</span>, <span class="hljs-string">"\n"</span>]  <span class="hljs-comment"># ç”¨äºæ£€æµ‹å¢å¼ºç‚¹çš„åˆ†éš”ç¬¦</span>
        self.max_prompt_aug_num = max_prompt_aug_num  <span class="hljs-comment"># æç¤ºåæç¤ºä¸­æ’å…¥æ½œåœ¨æ•°é‡</span>
        self.max_inference_aug_num = max_inference_aug_num  <span class="hljs-comment"># æŒ‡å®šåˆ†éš”ç¬¦åæ’å…¥æ½œåœ¨æ•°é‡</span>

        <span class="hljs-comment"># åå¤„ç†</span>
        self._postprocess_models()  <span class="hljs-comment"># åå¤„ç†æ¨¡å‹</span>

        self.warnings_issued = {}  <span class="hljs-comment"># å­˜å‚¨å‘å‡ºçš„è­¦å‘Š</span>
        self.model_tags = <span class="hljs-literal">None</span>  <span class="hljs-comment"># å­˜å‚¨æ¨¡å‹æ ‡ç­¾</span>
        log_trainable_params(self)  <span class="hljs-comment"># è®°å½•å¯è®­ç»ƒå‚æ•°</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_model_tags</span>(<span class="hljs-params">self, tags: <span class="hljs-type">Union</span>[<span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>], <span class="hljs-built_in">str</span>]</span>) -&gt; <span class="hljs-literal">None</span>:  <span class="hljs-comment"># æ·»åŠ æ¨¡å‹æ ‡ç­¾</span>
        <span class="hljs-string">r"""
        å‘æ¨¡å‹æ·»åŠ è‡ªå®šä¹‰æ ‡ç­¾ï¼Œè¿™äº›æ ‡ç­¾å°†è¢«æ¨é€åˆ° Hugging Face Hubã€‚ä¸ä¼šè¦†ç›–æ¨¡å‹ä¸­ç°æœ‰çš„æ ‡ç­¾ã€‚

        å‚æ•°ï¼š
            tags (`Union[list[str], str]`)ï¼š
                è¦æ·»åŠ åˆ°æ¨¡å‹çš„æ ‡ç­¾

        ä¾‹å­ï¼š

        ```python
        from transformers import AutoModel

        model = AutoModel.from_pretrained("google-bert/bert-base-cased")

        model.add_model_tags(["custom", "custom-bert"])

        # å°†æ¨¡å‹æ¨é€åˆ°æ‚¨çš„å‘½åç©ºé—´ï¼Œåç§°ä¸º "my-custom-bert"ã€‚
        model.push_to_hub("my-custom-bert")
        """</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(tags, <span class="hljs-built_in">str</span>):
            tags = [tags]

        <span class="hljs-keyword">if</span> self.model_tags <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            self.model_tags = []

        <span class="hljs-keyword">for</span> tag <span class="hljs-keyword">in</span> tags:
            <span class="hljs-keyword">if</span> tag <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.model_tags:
                self.model_tags.append(tag)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_postprocess_models</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""
        åå¤„ç†è®°å¿†æ¨¡å‹çš„ç»„ä»¶ï¼šæ¨ç†æ¨¡å‹ã€è®°å¿†ç¼–ç»‡å™¨ã€è§¦å‘å™¨å’Œåˆ†è¯å™¨ã€‚

        æ­¥éª¤ï¼š
            1. å†»ç»“æ¨ç†æ¨¡å‹çš„æ‰€æœ‰å‚æ•°ï¼ˆä¸æ›´æ–°æ¢¯åº¦ï¼‰ã€‚
            2. å°†æ‰€æœ‰æ¨¡å‹è½¬æ¢ä¸º bfloat16 ä»¥æé«˜å†…å­˜å’Œè®¡ç®—æ•ˆç‡ã€‚
            3. ç¡®ä¿åˆ†è¯å™¨æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„å¡«å……ç¬¦ï¼š
                - å¦‚æœç¼ºå°‘å¡«å……ç¬¦ï¼Œä½¿ç”¨ EOS ç¬¦ä½œä¸ºå¡«å……ç¬¦ã€‚
                - è®¾ç½® `padding_side` ä¸º "left" ä»¥å…¼å®¹ç”Ÿæˆä»»åŠ¡ã€‚
            4. æ ‡å‡†åŒ–åˆ†è¯å™¨çš„æ¨¡æ¿ä¸º `CONVERSATION_TEMPLATE`ã€‚
        """</span>
        <span class="hljs-comment"># é»˜è®¤å†»ç»“æ¨ç†æ¨¡å‹çš„æ‰€æœ‰å‚æ•°</span>
        fix_model_parameters(self.model)

        <span class="hljs-comment"># å°†æ‰€æœ‰å­æ¨¡å‹è½¬æ¢ä¸º bfloat16</span>
        self.model = self.model.bfloat16()
        self.weaver = self.weaver.bfloat16()
        self.trigger = self.trigger.bfloat16()

        <span class="hljs-comment"># ç¡®ä¿åˆ†è¯å™¨æœ‰ä¸€ä¸ªå¡«å……ç¬¦</span>
        <span class="hljs-keyword">if</span> self.tokenizer.pad_token <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            self.tokenizer.pad_token = self.tokenizer.eos_token
            self.tokenizer.pad_token_id = self.tokenizer.eos_token_id
            self.tokenizer.padding_side = <span class="hljs-string">"left"</span>
            logging.info(
                <span class="hljs-string">f"Tokenizer has no pad token. Using EOS token (<span class="hljs-subst">{self.tokenizer.eos_token}</span>) as pad token."</span>
            )

        <span class="hljs-comment"># æ ‡å‡†åŒ–åˆ†è¯å™¨çš„æ¨¡æ¿</span>
        self.tokenizer.chat_template = CONVERSATION_TEMPLATE
</code></pre>
<h5 data-id="heading-8">2.1.4 æ’å…¥é˜¶æ®µ</h5>
<p>LatentMemoryModel çš„ä¸¤ä¸ªå…³é”®å‡½æ•° forward å’Œ  generate åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<ul>
<li>forward å‡½æ•°
<ul>
<li>è®­ç»ƒæ—¶å€™è®¡ç®—æŸå¤±ï¼Œç”±è®­ç»ƒå¾ªç¯è‡ªåŠ¨è°ƒç”¨ã€‚</li>
</ul>
</li>
<li>generate å‡½æ•°
<ul>
<li>æ¨ç†æ—¶å€™ç”Ÿæˆæ–‡æœ¬ï¼Œç”±ä»£ç æ˜¾å¼è°ƒç”¨ã€‚</li>
</ul>
</li>
</ul>
<h6 data-id="heading-9">forward</h6>
<p>forward å‡½æ•°çš„ä¸»ä½“å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-python" lang="python">    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_forward</span>(<span class="hljs-params">
        self, 
        input_ids: torch.Tensor,
        attention_mask: torch.Tensor,
        labels: torch.Tensor,   
        **kwargs
    </span>) -&gt; torch.Tensor:
        <span class="hljs-comment"># é¢„å¤„ç†è¾“å…¥</span>
        <span class="hljs-keyword">assert</span> input_ids.shape == attention_mask.shape == labels.shape
        
        tokenizer = self.tokenizer
        reasoner = self.model
        weaver = self.weaver
        delimiters = self.delimiters
        max_augment_num = self.max_inference_aug_num  <span class="hljs-comment"># é™åˆ¶æ¨ç†å¢å¼ºç‚¹çš„æ•°é‡ä»¥é¿å…è¿‡åº¦å¢å¼º</span>
        device = self.device
        embeds_dtype = reasoner.get_input_embeddings().weight.dtype
        B, _ = input_ids.shape
        hidden_size = reasoner.config.hidden_size

        <span class="hljs-comment"># é€‰æ‹©å¢å¼ºç´¢å¼•</span>
        augmentation_indices = self._select_augment_points_after_delimiter(
            input_ids, labels, delimiters, tokenizer, max_augment_num
        )
        
        <span class="hljs-comment"># è¾“å…¥åµŒå…¥</span>
        inputs_embeds = reasoner.get_input_embeddings()(input_ids)
                 
        <span class="hljs-comment"># åˆå§‹åŒ–å¼€å§‹ç´¢å¼•å’Œç©ºå¼ é‡ä»¥ç´¯ç§¯å¤„ç†çš„æ®µ</span>
        current_start_idx = <span class="hljs-number">0</span>
        current_inputs_embeds = torch.empty(B, <span class="hljs-number">0</span>, hidden_size).to(device, dtype=embeds_dtype)
        current_attention_mask = torch.empty(B, <span class="hljs-number">0</span>).to(device, dtype=attention_mask.dtype)
        current_latents_mask = torch.empty(B, <span class="hljs-number">0</span>).to(device, dtype=torch.<span class="hljs-built_in">bool</span>)

        <span class="hljs-comment"># éå†æ‰€é€‰å¢å¼ºç‚¹</span>
        <span class="hljs-keyword">for</span> aug_idx <span class="hljs-keyword">in</span> augmentation_indices:
            <span class="hljs-comment"># åˆ‡ç‰‡åŸå§‹åµŒå…¥å’Œæ³¨æ„åŠ›æ©ç </span>
            segment_inputs_embeds = inputs_embeds[:, current_start:aug_idx]
            segment_attention_mask = attention_mask[:, current_start:aug_idx]
            segment_latents_mask = torch.zeros(B, segment_inputs_embeds.size(<span class="hljs-number">1</span>).to(device, dtype=torch.<span class="hljs-built_in">bool</span>)

            <span class="hljs-comment"># è¿æ¥å½“å‰æ®µåˆ°ç´¯ç§¯åµŒå…¥å’Œæ©ç </span>
            current_inputs_embeds = torch.cat([current_inputs_embeds, segment_inputs_embeds], dim=<span class="hljs-number">1</span>)
            current_mask = torch.cat([current_mask, segment_attention_mask], dim=<span class="hljs-number">1</span>)
            current_position_ids = generate_position_ids(current_mask)
            current_latents = torch.cat([current_latents, segment_latents], dim=<span class="hljs-number">1</span>)

            <span class="hljs-comment"># å°†æ¨ç†æ¨¡å‹åµŒå…¥æ˜ å°„åˆ°è®°å¿†ç¼–ç»‡å™¨åµŒå…¥</span>
            weaver_inputs_embeds = self.reasoner_to_weaver(current_inputs_embeds)

            <span class="hljs-comment"># ç¡®å®šæ­¤ç‚¹æ˜¯å¦ä¸ºæç¤ºï¼ˆå¢å¼ºï¼‰çš„ç»“æŸ</span>
            is_prompt_end_aug = (labels[:, aug_idx] != -<span class="hljs-number">100</span>).<span class="hljs-built_in">all</span>() <span class="hljs-keyword">and</span> (labels[:, aug_idx-<span class="hljs-number">1</span>] == -<span class="hljs-number">100</span>).<span class="hljs-built_in">all</span>().item()
            <span class="hljs-comment"># æ ¹æ®ç±»å‹ï¼Œä½¿ç”¨è®°å¿†ç¼–ç»‡å™¨å¢å¼ºæç¤ºæˆ–æ¨ç†</span>
            <span class="hljs-keyword">if</span> is_prompt_end_aug:
                weaver_hidden_states, attn_mask, pos_ids = weaver.augment_prompt(
                    weaver_inputs, current_attention_mask, current_position_ids
                )
            <span class="hljs-keyword">else</span>:
                weaver_hidden_states, attn_mask, pos_ids = weaver.augment_inference(
                    weaver_inputs, current_attention_mask, current_position_ids
                ) 

            <span class="hljs-comment"># å°†è®°å¿†ç¼–ç»‡å™¨éšè—çŠ¶æ€æ˜ å°„å›æ¨ç†æ¨¡å‹åµŒå…¥</span>
            latent_inputs_embeds = self.weaver_to_reasoner(weaver_hidden_states)

            <span class="hljs-comment"># æ›´æ–°ç´¯ç§¯åµŒå…¥å’Œæ©ç ä¸æ–°å¢å¼ºæ®µ</span>
            current_inputs_embeds = torch.cat
</code></pre>
<h6 data-id="heading-10">generate</h6>
<h6 data-id="heading-11">æ ¸å¿ƒä½œç”¨</h6>
<p>è¯¥ <code>generate</code> æ–¹æ³•æ˜¯ MemGen æ¨¡å‹çš„æ¨ç†æ ¸å¿ƒï¼Œå®ç°äº†<strong>åŠ¨æ€è®°å¿†å¢å¼ºä¸åºåˆ—ç”Ÿæˆçš„æ— ç¼èåˆ</strong>ã€‚é€šè¿‡è¿­ä»£ç”Ÿæˆæ–° tokenï¼Œæ¯æ­¥è‡ªé€‚åº”åˆ¤æ–­æ˜¯å¦æ’å…¥ç¼–ç»‡å™¨ç”Ÿæˆçš„æ½œåœ¨è®°å¿†ï¼Œè®©æ¨ç†å™¨åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­å®æ—¶åˆ©ç”¨åŠ¨æ€è®°å¿†è°ƒæ•´è§£ç è·¯å¾„ï¼Œæœ€ç»ˆè¾“å‡ºå¢å¼ºåçš„åºåˆ—ï¼ˆå¯é€‰è¿”å›è®°å¿†å¢å¼ºä½ç½®æ©ç ï¼‰ã€‚</p>
<h6 data-id="heading-12">æ ¸å¿ƒç‰¹è‰²</h6>
<ul>
<li><strong>åŒé˜¶æ®µè®°å¿†å¢å¼º</strong>ï¼šå…ˆæ‰§è¡Œæç¤ºè¯é˜¶æ®µè®°å¿†å¢å¼ºï¼ˆåˆå§‹åŒ–å…¨å±€è®°å¿†ï¼‰ï¼Œå†åœ¨è¿­ä»£ç”Ÿæˆä¸­åŠ¨æ€è§¦å‘æ¨ç†é˜¶æ®µå¢å¼ºï¼ˆè¡¥å……å®æ—¶è®°å¿†ï¼‰ï¼Œé€‚é…ä¸åŒç”Ÿæˆé˜¶æ®µçš„è®°å¿†éœ€æ±‚ã€‚</li>
<li><strong>è‡ªé€‚åº”è§¦å‘æœºåˆ¶</strong>ï¼šé€šè¿‡ <code>_should_augment</code> ç»“åˆè§¦å‘å™¨å†³ç­–ï¼Œä»…å¯¹éœ€è¦è®°å¿†æ”¯æŒçš„åºåˆ—æ‰§è¡Œå¢å¼ºï¼Œé¿å…æ— æ„ä¹‰çš„è®¡ç®—å¼€é”€ã€‚</li>
<li><strong>ç»´åº¦å¯¹é½ä¼˜åŒ–</strong>ï¼šéå¢å¼ºåºåˆ—é‡‡ç”¨å·¦å¡«å……ï¼ˆ<code>_left_pad</code>ï¼‰æ–¹å¼å¯¹é½å¢å¼ºåºåˆ—ç»´åº¦ï¼Œç¡®ä¿æ‰¹æ¬¡å†…æ‰€æœ‰åºåˆ—æ ¼å¼ç»Ÿä¸€ï¼Œä¸å½±å“æ‰¹é‡ç”Ÿæˆæ•ˆç‡ã€‚</li>
<li>é«˜æ•ˆæ¨ç†è®¾è®¡ï¼š
<ul>
<li>ç¦ç”¨æ¢¯åº¦è®¡ç®—ï¼ˆ<code>@torch.no_grad()</code>ï¼‰ï¼ŒèŠ‚çœå†…å­˜å¹¶åŠ é€Ÿæ¨ç†ï¼›</li>
<li>å¯ç”¨æ¨ç†å™¨ç¼“å­˜ï¼ˆ<code>use_cache=True</code>ï¼‰ï¼Œå‡å°‘é‡å¤è®¡ç®—ï¼›</li>
<li>ä»…åœ¨å¿…è¦æ—¶è¾“å‡ºéšè—çŠ¶æ€ï¼Œé™ä½è®¡ç®—æˆæœ¬ã€‚</li>
</ul>
</li>
<li><strong>çµæ´»é…ç½®ä¸å¯è§£é‡Šæ€§</strong>ï¼šæ”¯æŒæ§åˆ¶æœ€å¤§ç”Ÿæˆ token æ•°ã€é‡‡æ ·ç­–ç•¥ç­‰å‚æ•°ï¼›å¯é€‰è¿”å› <code>augmentation_pos</code> æ©ç ï¼Œæ ‡è®°è®°å¿†æ’å…¥ä½ç½®ï¼Œæå‡æ¨¡å‹å¯è§£é‡Šæ€§ã€‚</li>
<li><strong>é²æ£’æ€§ä¿éšœ</strong>ï¼šæå‰ç»ˆæ­¢æœºåˆ¶ï¼ˆæ‰€æœ‰åºåˆ—ç”Ÿæˆ EOS æˆ–è¾¾æœ€å¤§å¢å¼ºæ¬¡æ•°æ—¶ç»ˆæ­¢ï¼‰ï¼Œé¿å…æ— æ•ˆè¿­ä»£ï¼›é‡æ„ç”Ÿæˆé…ç½®å›ºå®šå…³é”®å‚æ•°ï¼Œç¡®ä¿ç”Ÿæˆç¨³å®šæ€§ã€‚</li>
</ul>
<h6 data-id="heading-13">æ¨ç†ç”Ÿæˆæµç¨‹å›¾</h6>
<p>æ½œåœ¨è®°å¿†æ’å…¥çš„å®Œæ•´æµç¨‹ï¼š</p>
<ul>
<li>åˆå§‹åŒ–é˜¶æ®µï¼šå¯¹è¾“å…¥æç¤ºè¿›è¡Œå¢å¼ºï¼Œæ’å…¥åˆå§‹æ½œåœ¨è®°å¿†ã€‚</li>
<li>ç”Ÿæˆå¾ªç¯ï¼šé€ä¸ªç”Ÿæˆtokenã€‚</li>
<li>æ¡ä»¶æ£€æŸ¥ï¼šåœ¨æ¯ä¸ªæ­¥éª¤æ£€æŸ¥æ˜¯å¦æ»¡è¶³æ’å…¥æ¡ä»¶ã€‚</li>
<li>å†³ç­–åˆ¤æ–­ï¼šä½¿ç”¨triggeræ¨¡å‹å†³å®šæ˜¯å¦æ’å…¥æ½œåœ¨è®°å¿†ã€‚</li>
<li>æ½œåœ¨è®°å¿†ç”Ÿæˆï¼šé€šè¿‡weaveræ¨¡å‹ç”Ÿæˆæ½œåœ¨è®°å¿†è¡¨ç¤ºã€‚</li>
<li>åµŒå…¥è¿æ¥ï¼šå°†æ½œåœ¨è®°å¿†åµŒå…¥è¿æ¥åˆ°å½“å‰è¾“å…¥åºåˆ—ã€‚</li>
<li>ç»§ç»­ç”Ÿæˆï¼šä½¿ç”¨å¢å¼ºåçš„åºåˆ—ç»§ç»­ç”Ÿæˆä¸‹ä¸€ä¸ªtokenã€‚</li>
</ul>
<p>å…·ä½“æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51a1177007e14bdd916d4e2ea501c2c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763380690&amp;x-signature=aylwPhRKpttlymB%2BFRIe5TqKJmg%3D" alt="MemGen-2.png" loading="lazy"/></p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@torch.no_grad()  </span><span class="hljs-comment"># ç¦ç”¨æ¢¯åº¦è®¡ç®—ï¼Œé€‚ç”¨äºæ¨ç†é˜¶æ®µï¼Œæå‡æ•ˆç‡å¹¶èŠ‚çœå†…å­˜</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate</span>(<span class="hljs-params">
    self, 
    input_ids: torch.Tensor,  <span class="hljs-comment"># è¾“å…¥token IDåºåˆ—ï¼Œå½¢çŠ¶[batch_size, prompt_len]</span>
    attention_mask: torch.Tensor,  <span class="hljs-comment"># æ³¨æ„åŠ›æ©ç ï¼Œå½¢çŠ¶ä¸input_idsä¸€è‡´</span>
    generation_config: GenerationConfig = <span class="hljs-literal">None</span>,  <span class="hljs-comment"># ç”Ÿæˆé…ç½®ï¼ˆå¦‚æœ€å¤§æ–°tokenæ•°ã€é‡‡æ ·ç­–ç•¥ç­‰ï¼‰</span>
    return_augmentation_mask: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>,  <span class="hljs-comment"># æ˜¯å¦è¿”å›è®°å¿†å¢å¼ºä½ç½®æ©ç </span>
    **kwargs
</span>) -&gt; <span class="hljs-type">Union</span>[torch.Tensor, <span class="hljs-type">Tuple</span>[torch.Tensor, torch.Tensor]]: 
    <span class="hljs-string">"""
    æ‰§è¡ŒMemGenæ¨¡å‹çš„æ¨ç†ç”Ÿæˆæµç¨‹ï¼šåŠ¨æ€èåˆæ½œåœ¨è®°å¿†ä¸æ¨ç†å™¨ï¼Œç”Ÿæˆå¢å¼ºåçš„è¾“å‡ºåºåˆ—ã€‚
    
    æ ¸å¿ƒé€»è¾‘ï¼š
    1. åˆå§‹åŒ–æç¤ºè¯é˜¶æ®µçš„è®°å¿†å¢å¼º
    2. è¿­ä»£ç”Ÿæˆæ–°tokenï¼Œæ¯æ­¥åˆ¤æ–­æ˜¯å¦è§¦å‘æ¨ç†é˜¶æ®µè®°å¿†å¢å¼º
    3. å¯¹éœ€å¢å¼ºçš„åºåˆ—æ’å…¥ç¼–ç»‡å™¨ç”Ÿæˆçš„æ½œåœ¨è®°å¿†ï¼Œéå¢å¼ºåºåˆ—å·¦å¡«å……å¯¹é½ç»´åº¦
    4. ç”Ÿæˆå®Œæˆåè¿”å›ç»“æœï¼ˆå¯é€‰è¿”å›å¢å¼ºä½ç½®æ©ç ï¼‰
    """</span>
    tokenizer = self.tokenizer
    reasoner = self.model
    weaver = self.weaver
    trigger = self.trigger
    delimiters = self.delimiters
    max_augment_num = self.max_inference_aug_num  <span class="hljs-comment"># å•åºåˆ—æœ€å¤§æ¨ç†é˜¶æ®µå¢å¼ºæ¬¡æ•°</span>
    invalid_token_id = -<span class="hljs-number">100</span>  <span class="hljs-comment"># æ— æ•ˆä½ç½®æ ‡è®°ï¼ˆç”¨äºå¢å¼ºä½ç½®æ©ç ï¼‰</span>

    <span class="hljs-comment"># é¢„å¤„ç†è¾“å…¥ï¼šè½¬ç§»åˆ°æ¨¡å‹æ‰€åœ¨è®¾å¤‡</span>
    input_ids = input_ids.to(self.device)
    attention_mask = attention_mask.to(self.device)
    <span class="hljs-comment"># æå–ç”Ÿæˆé…ç½®å…³é”®å‚æ•°</span>
    max_new_tokens = generation_config.max_new_tokens  <span class="hljs-comment"># æœ€å¤§ç”Ÿæˆæ–°tokenæ•°</span>
    do_sample = generation_config.do_sample  <span class="hljs-comment"># æ˜¯å¦å¯ç”¨é‡‡æ ·ç”Ÿæˆ</span>
    temperature = generation_config.temperature  <span class="hljs-comment"># é‡‡æ ·æ¸©åº¦ï¼ˆæ§åˆ¶éšæœºæ€§ï¼‰</span>
    pad_token_id = tokenizer.pad_token_id  <span class="hljs-comment"># pad token ID</span>
    eos_token_id = tokenizer.eos_token_id  <span class="hljs-comment"># ç»“æŸtoken ID</span>
    prompt_len = input_ids.size(<span class="hljs-number">1</span>)  <span class="hljs-comment"># æç¤ºè¯é•¿åº¦</span>
    <span class="hljs-comment"># é‡æ„ç”Ÿæˆé…ç½®ï¼ˆå›ºå®šå¿…è¦å‚æ•°ï¼Œç¡®ä¿ç”Ÿæˆç¨³å®šæ€§ï¼‰</span>
    generation_config = GenerationConfig(
        do_sample=do_sample,
        temperature=temperature,
        pad_token_id=pad_token_id,
        eos_token_id=eos_token_id,
        use_cache=<span class="hljs-literal">True</span>  <span class="hljs-comment"># å¯ç”¨ç¼“å­˜åŠ é€Ÿç”Ÿæˆ</span>
    )

    <span class="hljs-comment"># å°†è¾“å…¥token IDè½¬æ¢ä¸ºåµŒå…¥å‘é‡</span>
    inputs_embeds = reasoner.get_input_embeddings()(input_ids)
    B, _, hidden_size = inputs_embeds.shape  <span class="hljs-comment"># B=batch_sizeï¼Œhidden_size=æ¨ç†å™¨éšè—å±‚ç»´åº¦</span>
    device = inputs_embeds.device  <span class="hljs-comment"># æ¨¡å‹æ‰€åœ¨è®¾å¤‡ï¼ˆCPU/GPUï¼‰</span>

    <span class="hljs-comment"># åˆå§‹åŒ–ç”Ÿæˆè¿‡ç¨‹ä¸­çš„å…³é”®å¼ é‡</span>
    current_inputs_embeds = inputs_embeds  <span class="hljs-comment"># å½“å‰è¾“å…¥åµŒå…¥ï¼ˆå«åŸå§‹æç¤ºè¯+æ½œåœ¨è®°å¿†ï¼‰</span>
    current_attention_mask = attention_mask  <span class="hljs-comment"># å½“å‰æ³¨æ„åŠ›æ©ç </span>
    current_position_ids = generate_position_ids(current_attention_mask)  <span class="hljs-comment"># å½“å‰ä½ç½®ID</span>
    current_input_ids = input_ids  <span class="hljs-comment"># å½“å‰å·²ç”Ÿæˆçš„token IDåºåˆ—</span>
    
    <span class="hljs-comment"># æç¤ºè¯é˜¶æ®µè®°å¿†å¢å¼ºï¼šç”Ÿæˆå¹¶æ’å…¥æç¤ºè¯ä¸“ç”¨æ½œåœ¨è®°å¿†</span>
    weaver_inputs_embeds = self.reasoner_to_weaver(current_inputs_embeds)  <span class="hljs-comment"># æ˜ å°„åˆ°ç¼–ç»‡å™¨åµŒå…¥ç©ºé—´</span>
    weaver_hidden_states, attn_mask, pos_ids = weaver.augment_prompt(
        weaver_inputs_embeds, current_attention_mask, current_position_ids
    )
    latent_inputs_embeds = self.weaver_to_reasoner(weaver_hidden_states)  <span class="hljs-comment"># æ˜ å°„å›æ¨ç†å™¨åµŒå…¥ç©ºé—´</span>

    <span class="hljs-comment"># æ‹¼æ¥æç¤ºè¯ä¸å¢å¼ºè®°å¿†</span>
    current_inputs_embeds = torch.cat([current_inputs_embeds, latent_inputs_embeds], dim=<span class="hljs-number">1</span>)
    current_attention_mask = torch.cat([current_attention_mask, attn_mask], dim=<span class="hljs-number">1</span>)
    current_position_ids = torch.cat([current_position_ids, pos_ids], dim=<span class="hljs-number">1</span>)

    <span class="hljs-comment"># ç”Ÿæˆå¾ªç¯åˆå§‹åŒ–</span>
    sentence_augment_count = torch.zeros(B, dtype=torch.<span class="hljs-built_in">int</span>, device=device)  <span class="hljs-comment"># å„åºåˆ—å·²å¢å¼ºæ¬¡æ•°</span>
    augmentation_pos = torch.full((B, max_new_tokens), fill_value=invalid_token_id, device=device)  <span class="hljs-comment"># å¢å¼ºä½ç½®æ©ç </span>
    inserted_embeds: <span class="hljs-type">List</span>[<span class="hljs-type">List</span>[torch.Tensor]] = [[] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(B)]  <span class="hljs-comment"># è®°å½•æ’å…¥çš„æ½œåœ¨è®°å¿†ï¼ˆç”¨äºåå¤„ç†ï¼‰</span>
    
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(max_new_tokens):
        <span class="hljs-comment"># è‹¥æ‰€æœ‰åºåˆ—å‡å·²ç”ŸæˆEOS tokenï¼Œæå‰ç»ˆæ­¢</span>
        <span class="hljs-keyword">if</span> (current_input_ids[:, -<span class="hljs-number">1</span>] == eos_token_id).<span class="hljs-built_in">all</span>():
            <span class="hljs-keyword">break</span>   

        <span class="hljs-comment"># è‹¥æ‰€æœ‰åºåˆ—å‡å·²è¾¾åˆ°æœ€å¤§å¢å¼ºæ¬¡æ•°ï¼Œä¸€æ¬¡æ€§ç”Ÿæˆå‰©ä½™token</span>
        <span class="hljs-keyword">if</span> (sentence_augment_count &gt;= max_augment_num).<span class="hljs-built_in">all</span>():
            <span class="hljs-comment"># è°ƒæ•´å‰©ä½™ç”Ÿæˆé•¿åº¦</span>
            generation_config.max_new_tokens = max_new_tokens - i
            <span class="hljs-comment"># æ¨ç†å™¨ç”Ÿæˆå‰©ä½™token</span>
            generated = reasoner.generate(
                inputs_embeds=current_inputs_embeds,
                attention_mask=current_attention_mask,
                generation_config=generation_config,
            )
            current_input_ids = torch.cat([current_input_ids, generated], dim=<span class="hljs-number">1</span>)
            <span class="hljs-keyword">break</span>

        <span class="hljs-comment"># æ¨ç†å™¨å‰å‘ä¼ æ’­ï¼Œè·å–å½“å‰æ­¥è¾“å‡º</span>
        outputs = reasoner(
            inputs_embeds=current_inputs_embeds,
            attention_mask=current_attention_mask,
            position_ids=current_position_ids,
            output_hidden_states=<span class="hljs-literal">False</span>,  <span class="hljs-comment"># æ¨ç†é˜¶æ®µæ— éœ€è¾“å‡ºéšè—çŠ¶æ€ï¼Œæå‡æ•ˆç‡</span>
        )
        <span class="hljs-comment"># ç”Ÿæˆå¹¶è¿½åŠ ä¸€ä¸ªæ–°tokenï¼Œæ›´æ–°å…³é”®å¼ é‡</span>
        current_inputs_embeds, current_attention_mask, current_position_ids, current_input_ids = self._append_one_step(
            outputs, current_inputs_embeds, current_attention_mask, current_position_ids, current_input_ids, do_sample, temperature
        )
 
        <span class="hljs-comment"># è‹¥ä¸ºæœ€åä¸€æ­¥ç”Ÿæˆï¼Œç»ˆæ­¢å¾ªç¯</span>
        <span class="hljs-keyword">if</span> i == max_new_tokens - <span class="hljs-number">1</span>:  
            <span class="hljs-keyword">break</span> 

        <span class="hljs-comment"># åˆ¤æ–­å½“å‰æ‰¹æ¬¡ä¸­å“ªäº›åºåˆ—éœ€è¦è¿›è¡Œæ¨ç†é˜¶æ®µè®°å¿†å¢å¼º</span>
        augment_decision = self._should_augment(
            current_input_ids, current_attention_mask, sentence_augment_count=sentence_augment_count, 
            do_sample=do_sample, temperature=temperature  
        )
        augmentation_pos[:, i + <span class="hljs-number">1</span>] = augment_decision  <span class="hljs-comment"># è®°å½•å¢å¼ºä½ç½®ï¼ˆ1=å¢å¼ºï¼Œ0=ä¸å¢å¼ºï¼Œ-100=æ— æ•ˆï¼‰</span>
        augment_indices = torch.where(augment_decision == <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]  <span class="hljs-comment"># éœ€å¢å¼ºçš„åºåˆ—ç´¢å¼•</span>

        <span class="hljs-comment"># å¯¹éœ€å¢å¼ºçš„åºåˆ—æ‰§è¡Œè®°å¿†å¢å¼ºï¼Œéå¢å¼ºåºåˆ—å·¦å¡«å……å¯¹é½ç»´åº¦</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(augment_indices) &gt; <span class="hljs-number">0</span>:
            <span class="hljs-comment"># é€’å¢éœ€å¢å¼ºåºåˆ—çš„å¢å¼ºæ¬¡æ•°è®¡æ•°</span>
            sentence_augment_count[augment_indices] += <span class="hljs-number">1</span>

            <span class="hljs-comment"># æå–éœ€å¢å¼ºåºåˆ—çš„åµŒå…¥ã€æ©ç å’Œä½ç½®ID</span>
            candidate_inputs_embeds = current_inputs_embeds[augment_indices]
            candidate_attention_mask = current_attention_mask[augment_indices]
            candidate_position_ids = current_position_ids[augment_indices]
            
            <span class="hljs-comment"># ç¼–ç»‡å™¨ç”Ÿæˆæ¨ç†é˜¶æ®µæ½œåœ¨è®°å¿†</span>
            weaver_inputs_embeds = self.reasoner_to_weaver(candidate_inputs_embeds)
            weaver_hidden_states, attn_mask, _ = weaver.augment_inference(
                weaver_inputs_embeds, candidate_attention_mask, candidate_position_ids
            )
            latent_inputs_embeds = self.weaver_to_reasoner(weaver_hidden_states)  <span class="hljs-comment"># æ˜ å°„å›æ¨ç†å™¨ç©ºé—´</span>
            
            <span class="hljs-comment"># æ‹¼æ¥åŸå§‹åµŒå…¥ä¸æ½œåœ¨è®°å¿†</span>
            candidate_inputs_embeds = torch.cat([candidate_inputs_embeds, latent_inputs_embeds], dim=<span class="hljs-number">1</span>)
            candidate_attention_mask = torch.cat([candidate_attention_mask, attn_mask], dim=<span class="hljs-number">1</span>)
            
            <span class="hljs-comment"># æ„å»ºåˆå¹¶å¼ é‡ï¼ˆé€‚é…æ‰€æœ‰åºåˆ—ï¼ŒåŒ…æ‹¬å¢å¼ºå’Œéå¢å¼ºï¼‰</span>
            new_len = candidate_inputs_embeds.size(<span class="hljs-number">1</span>)  <span class="hljs-comment"># å¢å¼ºååºåˆ—é•¿åº¦</span>
            merged_inputs_embeds = torch.zeros((B, new_len, hidden_size), device=device, dtype=current_inputs_embeds.dtype)
            merged_attention_mask = torch.zeros((B, new_len), device=device, dtype=current_attention_mask.dtype)
            
            <span class="hljs-comment"># å¡«å……å¢å¼ºåºåˆ—</span>
            merged_inputs_embeds[augment_indices] = candidate_inputs_embeds
            merged_attention_mask[augment_indices] = candidate_attention_mask
            
            <span class="hljs-comment"># å¡«å……éå¢å¼ºåºåˆ—ï¼ˆå·¦å¡«å……å¯¹é½é•¿åº¦ï¼‰</span>
            non_augment_indices = torch.where(augment_decision != <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(non_augment_indices) &gt; <span class="hljs-number">0</span>:
                non_aug_inputs_embeds = current_inputs_embeds[non_augment_indices]
                non_aug_attention_mask = current_attention_mask[non_augment_indices]
                non_aug_inputs_embeds, non_aug_attention_mask, _ = self._left_pad(
                    non_aug_inputs_embeds, non_aug_attention_mask, <span class="hljs-literal">None</span>, weaver.inference_latents_num
                )
                merged_inputs_embeds[non_augment_indices] = non_aug_inputs_embeds
                merged_attention_mask[non_augment_indices] = non_aug_attention_mask
            
            <span class="hljs-comment"># æ›´æ–°å½“å‰å…³é”®å¼ é‡</span>
            current_inputs_embeds = merged_inputs_embeds
            current_attention_mask = merged_attention_mask
            current_position_ids = generate_position_ids(current_attention_mask)  <span class="hljs-comment"># é‡æ–°ç”Ÿæˆä½ç½®ID</span>
            
            <span class="hljs-comment"># è®°å½•æ’å…¥çš„æ½œåœ¨è®°å¿†ï¼ˆç”¨äºåå¤„ç†æˆ–å¯è§£é‡Šæ€§åˆ†æï¼‰</span>
            <span class="hljs-keyword">for</span> idx, embed <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(augment_indices, latent_inputs_embeds):
                inserted_embeds[idx].append(embed.clone().detach().cpu())
        
        <span class="hljs-comment"># åå¤„ç†ï¼šè°ƒæ•´å¢å¼ºä½ç½®æ©ç é•¿åº¦ä¸ç”Ÿæˆç»“æœä¸€è‡´</span>
        new_generated_len = current_input_ids.size(<span class="hljs-number">1</span>) - prompt_len
        augmentation_pos = augmentation_pos[:, :new_generated_len]
         
        <span class="hljs-comment"># æ ¹æ®é…ç½®è¿”å›ç»“æœï¼šä»…ç”Ÿæˆåºåˆ— æˆ– åºåˆ—+å¢å¼ºä½ç½®æ©ç </span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> return_augmentation_mask:
            <span class="hljs-keyword">return</span> current_input_ids
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> current_input_ids, augmentation_pos
</code></pre>
<h4 data-id="heading-14">2.2 Trigger</h4>
<h5 data-id="heading-15">2.2.1. æ ¸å¿ƒä½œç”¨</h5>
<p>è¯¥æ¨¡å—å®šä¹‰äº† MemGen æ¡†æ¶ä¸­è®°å¿†è§¦å‘å™¨çš„æ ¸å¿ƒæ¥å£ä¸ä¸¤ç§å…·ä½“å®ç°ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯<strong>åŠ¨æ€å†³ç­–è®°å¿†å¢å¼ºçš„æ—¶æœº</strong>â€”â€” å³åœ¨æ¨ç†è¿‡ç¨‹ä¸­åˆ¤æ–­ä½•æ—¶æ’å…¥ç¼–ç»‡å™¨ç”Ÿæˆçš„æ½œåœ¨è®°å¿†ï¼Œå®ç°è®°å¿†ä¸æ¨ç†çš„åŠ¨æ€è€¦åˆï¼Œçªç ´ä¼ ç»Ÿé™æ€è®°å¿†æ³¨å…¥çš„å±€é™ã€‚</p>
<h5 data-id="heading-16">2.2.2. æ ¸å¿ƒç‰¹è‰²</h5>
<ul>
<li><strong>æŠ½è±¡æ¥å£ç»Ÿä¸€è§„èŒƒ</strong>ï¼š<code>Trigger</code>æŠ½è±¡åŸºç±»å®šä¹‰äº†è§¦å‘å™¨çš„æ ¸å¿ƒæ¥å£ï¼Œç¡®ä¿åç»­æ‰©å±•æ–°è§¦å‘å™¨æ—¶éµå¾ªç»Ÿä¸€æ ‡å‡†ï¼Œæå‡ä»£ç å¯æ‰©å±•æ€§ã€‚</li>
<li>åŒå®ç°é€‚é…ä¸åŒåœºæ™¯ï¼š
<ul>
<li><code>NanoTrigger</code>ï¼šæç®€å®ç°ï¼Œå§‹ç»ˆè§¦å‘è®°å¿†å¢å¼ºï¼Œæ— éœ€è®­ç»ƒï¼Œé€‚ç”¨äºå¿«é€Ÿæµ‹è¯•ã€åŸºçº¿å¯¹æ¯”æˆ–æ— éœ€åŠ¨æ€æ§åˆ¶çš„ç®€å•åœºæ™¯ã€‚</li>
<li><code>MemGenTrigger</code>ï¼šåŸºäºé¢„è®­ç»ƒ LLM çš„æ™ºèƒ½è§¦å‘å™¨ï¼Œé€šè¿‡äºŒåˆ†ç±»å¤´é€‚é…å†³ç­–ä»»åŠ¡ï¼Œæ”¯æŒ PEFT å‚æ•°é«˜æ•ˆå¾®è°ƒï¼Œèƒ½æ ¹æ®è¾“å…¥åºåˆ—åŠ¨æ€åˆ¤æ–­æ˜¯å¦è§¦å‘ï¼Œé€‚é…å¤æ‚çœŸå®åœºæ™¯ã€‚</li>
</ul>
</li>
<li>é«˜æ•ˆé€‚é…ä¸çµæ´»æ‰©å±•ï¼š
<ul>
<li>é‡‡ç”¨ bfloat16 ç²¾åº¦å’Œ Flash Attention 2 ä¼˜åŒ–è®¡ç®—æ•ˆç‡ï¼›</li>
<li>æ”¯æŒ PEFT å¾®è°ƒï¼Œåœ¨ä¸å†»ç»“åŸºç¡€æ¨¡å‹çš„å‰æä¸‹å®ç°å‚æ•°é«˜æ•ˆå­¦ä¹ ï¼›</li>
<li>æ›¿æ¢ LLM åŸå§‹è¾“å‡ºå¤´ä¸ºäºŒåˆ†ç±»å¤´ï¼Œç²¾å‡†é€‚é… "æ˜¯å¦æ’å…¥è®°å¿†" çš„å†³ç­–éœ€æ±‚ã€‚</li>
</ul>
</li>
<li><strong>æ¨¡å—è§£è€¦è®¾è®¡</strong>ï¼šè§¦å‘å™¨å†³ç­–ç‹¬ç«‹äºç¼–ç»‡å™¨æ¨¡å—ï¼Œä»…åŸºäºè¾“å…¥åºåˆ—å’Œæ•°æ®åˆ†å¸ƒåšå‡ºåˆ¤æ–­ï¼Œä¿è¯äº†æ¨¡å—é—´çš„ä½è€¦åˆå’Œé«˜å†…èšã€‚</li>
</ul>
<h5 data-id="heading-17">2.2.3 ç½‘ç»œæ¶æ„</h5>
<p>ç½‘ç»œæ¶æ„å›¾å¦‚ä¸‹ã€‚</p>
<p>è¯´æ˜å¦‚ä¸‹ï¼š</p>
<ol>
<li>æ¨¡å‹æ”¯æŒPEFTå‚æ•°é«˜æ•ˆå¾®è°ƒï¼ˆå¦‚LoRAï¼‰ï¼Œé€‚é…äºTransformer Blockså±‚</li>
<li>æ•´ä½“ç²¾åº¦é‡‡ç”¨bfloat16ï¼Œå¹³è¡¡è®¡ç®—æ•ˆç‡ä¸æ•°å€¼ç¨³å®šæ€§</li>
<li>æ³¨æ„åŠ›è®¡ç®—é€šè¿‡Flash Attention 2ä¼˜åŒ–ï¼Œæå‡é•¿åºåˆ—å¤„ç†é€Ÿåº¦</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34dd418dca1746b69160336bafae5e6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763380690&amp;x-signature=Av9etmryf2cwP7Mw6AaiNNc%2FzO4%3D" alt="MemGen-3.png" loading="lazy"/></p>
<h5 data-id="heading-18">2.2.4 ä»£ç </h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Trigger</span>(torch.nn.Module, ABC):
    <span class="hljs-string">"""
    è®°å¿†è§¦å‘å™¨çš„æŠ½è±¡åŸºç±»ï¼ˆTriggerï¼‰ã€‚
    å®šä¹‰äº†è§¦å‘å™¨çš„æ ¸å¿ƒæ¥å£ï¼Œç”¨äºå†³å®šåœ¨æ¨ç†è¿‡ç¨‹ä¸­ä½•æ—¶è§¦å‘è®°å¿†å¢å¼ºï¼ˆæ’å…¥æ½œåœ¨è®°å¿†ï¼‰ã€‚
    æ‰€æœ‰å…·ä½“è§¦å‘å™¨å®ç°éƒ½éœ€ç»§æ‰¿æ­¤ç±»å¹¶å®ç°forwardæ–¹æ³•ã€‚
    """</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">super</span>().__init__()  <span class="hljs-comment"># è°ƒç”¨çˆ¶ç±»Moduleçš„åˆå§‹åŒ–æ–¹æ³•</span>
    
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, **kwargs</span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-string">"""
        æŠ½è±¡å‰å‘ä¼ æ’­æ–¹æ³•ï¼šæ¥æ”¶è¾“å…¥æ•°æ®ï¼Œè¿”å›æ˜¯å¦è§¦å‘è®°å¿†å¢å¼ºçš„å†³ç­–ã€‚
        å­ç±»å¿…é¡»å®ç°æ­¤æ–¹æ³•ï¼Œå®šä¹‰å…·ä½“çš„è§¦å‘é€»è¾‘ã€‚
        
        Args:
            **kwargs: å¯å˜å…³é”®å­—å‚æ•°ï¼ŒåŒ…å«è¾“å…¥åºåˆ—ã€æ³¨æ„åŠ›æ©ç ç­‰æ¨¡å‹æ‰€éœ€æ•°æ®
            
        Returns:
            bool: è§¦å‘å†³ç­–ï¼ˆTrueè¡¨ç¤ºè§¦å‘è®°å¿†å¢å¼ºï¼ŒFalseè¡¨ç¤ºä¸è§¦å‘ï¼‰
        """</span>
        ...


<span class="hljs-keyword">class</span> <span class="hljs-title class_">NanoTrigger</span>(torch.nn.Module):
    <span class="hljs-string">"""
    æç®€è§¦å‘å™¨ï¼ˆNanoTriggerï¼‰ï¼šå§‹ç»ˆè§¦å‘è®°å¿†å¢å¼ºçš„åŸºç¡€å®ç°ã€‚
    æ— éœ€å¤æ‚é€»è¾‘ï¼Œå›ºå®šè¿”å›è§¦å‘å†³ç­–ï¼Œé€‚ç”¨äºåŸºç¡€æµ‹è¯•æˆ–æ— éœ€åŠ¨æ€æ§åˆ¶çš„åœºæ™¯ã€‚
    """</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">super</span>().__init__()  
        <span class="hljs-comment"># æ³¨å†Œä¸€ä¸ªç¼“å†²åŒºå¼ é‡ï¼Œç”¨äºè·å–æ¨¡å‹æ‰€åœ¨è®¾å¤‡ï¼ˆæ— å®é™…è®¡ç®—æ„ä¹‰ï¼‰</span>
        self.register_buffer(<span class="hljs-string">"_device"</span>, torch.tensor(<span class="hljs-number">0.0</span>))
    
<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">device</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""è·å–æ¨¡å‹æ‰€åœ¨è®¾å¤‡ï¼ˆCPU/GPUï¼‰"""</span>
        <span class="hljs-keyword">return</span> self._device.device
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, input_ids: torch.Tensor, attention_mask: torch.Tensor, **kwargs</span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-comment"># è¯¥"æç®€è§¦å‘å™¨"å§‹ç»ˆé¢„æµ‹éœ€è¦æ’å…¥è®°å¿†</span>
        <span class="hljs-comment"># è¾“å‡ºlogitså¼ é‡ï¼Œå…¶ä¸­æ’å…¥å†³ç­–ï¼ˆç´¢å¼•=1ï¼‰çš„æ¦‚ç‡è¢«è®¾ä¸º1.0</span>
        <span class="hljs-comment"># é€‚ç”¨äºæ‰¹æ¬¡ä¸­çš„æ¯ä¸ªtokenä½ç½®</span>
        batch_size, seq_len = input_ids.shape

        <span class="hljs-comment"># åˆå§‹åŒ–logitså¼ é‡ï¼šå½¢çŠ¶ä¸º[batch_size, seq_len, 2]ï¼Œ2è¡¨ç¤º"ä¸æ’å…¥"ï¼ˆ0ï¼‰å’Œ"æ’å…¥"ï¼ˆ1ï¼‰ä¸¤ç±»</span>
        logits = torch.zeros(batch_size, seq_len, <span class="hljs-number">2</span>, device=input_ids.device)
        logits[..., <span class="hljs-number">1</span>] = <span class="hljs-number">1.0</span>  <span class="hljs-comment"># å°†æ‰€æœ‰ä½ç½®çš„"æ’å…¥"å†³ç­–æ¦‚ç‡è®¾ä¸º1.0</span>
        <span class="hljs-keyword">return</span> logits


<span class="hljs-keyword">class</span> <span class="hljs-title class_">MemGenTrigger</span>(torch.nn.Module):
    <span class="hljs-string">"""
    MemGenæ¡†æ¶çš„ä¸“ç”¨è§¦å‘å™¨æ¨¡å—ï¼ˆMemGenTriggerï¼‰ã€‚
    - è¾“å…¥ï¼šæ¥æ”¶æ¨ç†å™¨æ¨¡å‹å½“å‰è§£ç åºåˆ—çš„`inputs_embeds`ï¼ˆæˆ–input_idsï¼‰
    - è¾“å‡ºï¼šç”Ÿæˆå½¢çŠ¶ä¸º[batch_size, seq_len, 2]çš„logitså¼ é‡ï¼Œ
      è¡¨ç¤ºæ¯ä¸ªä½ç½®"ä¸æ’å…¥"ï¼ˆ0ï¼‰å’Œ"æ’å…¥"ï¼ˆ1ï¼‰è®°å¿†çš„æ¦‚ç‡ï¼Œç”¨äºåŠ¨æ€å†³ç­–è®°å¿†å¢å¼ºæ—¶æœºã€‚
    """</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">
        self, 
        pretrained_model_name_or_path: <span class="hljs-built_in">str</span>,  <span class="hljs-comment"># é¢„è®­ç»ƒæ¨¡å‹åç§°æˆ–è·¯å¾„ï¼ˆç”¨äºåˆå§‹åŒ–è§¦å‘å™¨LLMï¼‰</span>
        peft_config: <span class="hljs-type">Optional</span>[PeftConfig] = <span class="hljs-literal">None</span>  <span class="hljs-comment"># PEFTé…ç½®ï¼ˆå¯é€‰ï¼Œç”¨äºå‚æ•°é«˜æ•ˆå¾®è°ƒï¼‰</span>
    </span>):
        <span class="hljs-built_in">super</span>().__init__()
        
        <span class="hljs-comment"># æ„å»ºåŸºç¡€LLMæ¨¡å‹ï¼ˆä½œä¸ºè§¦å‘å™¨çš„æ ¸å¿ƒæ¨ç†ç»„ä»¶ï¼‰</span>
        self.model = AutoModelForCausalLM.from_pretrained(
            pretrained_model_name_or_path, 
            torch_dtype=torch.bfloat16,  <span class="hljs-comment"># ä½¿ç”¨bfloat16ç²¾åº¦æå‡æ•ˆç‡</span>
            attn_implementation=<span class="hljs-string">"flash_attention_2"</span>  <span class="hljs-comment"># å¯ç”¨Flash Attention 2ä¼˜åŒ–æ³¨æ„åŠ›è®¡ç®—</span>
        )
        self.tokenizer = AutoTokenizer.from_pretrained(pretrained_model_name_or_path)  <span class="hljs-comment"># å¯¹åº”çš„Tokenizer</span>
        
        <span class="hljs-comment"># å¯¹åŸºç¡€æ¨¡å‹è¿›è¡Œåå¤„ç†ï¼ˆè®¾ç½®å¯è®­ç»ƒã€æ›¿æ¢è¾“å‡ºå¤´ï¼‰</span>
        self.model = self._postprocess(self.model)
        <span class="hljs-comment"># è‹¥æä¾›PEFTé…ç½®ï¼Œåº”ç”¨å‚æ•°é«˜æ•ˆå¾®è°ƒ</span>
        <span class="hljs-keyword">if</span> peft_config <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            self.model = get_peft_model(self.model, peft_config)
        
        self.config = self.model.config  <span class="hljs-comment"># ä¿å­˜æ¨¡å‹é…ç½®</span>

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">device</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""è·å–æ¨¡å‹æ‰€åœ¨è®¾å¤‡ï¼ˆCPU/GPUï¼‰"""</span>
        <span class="hljs-keyword">return</span> self.model.device
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_postprocess</span>(<span class="hljs-params">self, model: PreTrainedModel</span>):
        <span class="hljs-string">"""
        å¯¹åŸºç¡€æ¨¡å‹è¿›è¡Œåå¤„ç†ï¼Œé€‚é…è§¦å‘å™¨çš„äºŒåˆ†ç±»ä»»åŠ¡éœ€æ±‚ã€‚
        
        Args:
            model: åŸå§‹é¢„è®­ç»ƒLLMæ¨¡å‹
            
        Returns:
            å¤„ç†åçš„æ¨¡å‹ï¼ˆå¯è®­ç»ƒã€æ›¿æ¢ä¸ºäºŒåˆ†ç±»è¾“å‡ºå¤´ï¼‰
        """</span>
        <span class="hljs-comment"># è®¾ç½®æ‰€æœ‰æ¨¡å‹å‚æ•°ä¸ºå¯è®­ç»ƒ</span>
        <span class="hljs-keyword">for</span> parameter <span class="hljs-keyword">in</span> model.parameters():
            parameter.requires_grad = <span class="hljs-literal">True</span>
        
        <span class="hljs-comment"># å°†åŸå§‹è¯­è¨€æ¨¡å‹çš„è¾“å‡ºå¤´ï¼ˆlm_headï¼‰æ›¿æ¢ä¸ºäºŒåˆ†ç±»å¤´</span>
        hidden_size = model.config.hidden_size  <span class="hljs-comment"># æ¨¡å‹éšè—å±‚ç»´åº¦</span>
        classification_head = nn.Linear(hidden_size, <span class="hljs-number">2</span>)  <span class="hljs-comment"># è¾“å‡ºç»´åº¦ä¸º2ï¼ˆä¸æ’å…¥/æ’å…¥ï¼‰</span>
        model.lm_head = classification_head
        
        <span class="hljs-comment"># ç¡®ä¿æ–°çš„äºŒåˆ†ç±»å¤´å‚æ•°å¯è®­ç»ƒ</span>
        <span class="hljs-keyword">for</span> param <span class="hljs-keyword">in</span> model.lm_head.parameters():
            param.requires_grad = <span class="hljs-literal">True</span>

        <span class="hljs-keyword">return</span> model

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">
        self, 
        input_ids: <span class="hljs-type">Optional</span>[torch.LongTensor] = <span class="hljs-literal">None</span>,  <span class="hljs-comment"># ç”Ÿæˆåºåˆ—çš„token IDï¼Œå½¢çŠ¶[batch_size, seq_len]</span>
        attention_mask: <span class="hljs-type">Optional</span>[torch.Tensor] = <span class="hljs-literal">None</span>,  <span class="hljs-comment"># æ³¨æ„åŠ›æ©ç ï¼Œé¿å…å…³æ³¨å¡«å……token</span>
        **kwargs: Unpack[TransformersKwargs],  <span class="hljs-comment"># ä¼ é€’ç»™åº•å±‚æ¨¡å‹çš„é¢å¤–å‚æ•°</span>
    </span>) -&gt; torch.Tensor:
        <span class="hljs-string">"""
        åºåˆ—ç”Ÿæˆçš„è§¦å‘å†³ç­–æœºåˆ¶ã€‚
        è§¦å‘å™¨åŸºäºå·²ç”Ÿæˆçš„`input_ids`åšå‡ºå†³ç­–ï¼Œå—æ•°æ®åˆ†å¸ƒå½±å“ï¼Œä½†ç‹¬ç«‹äºç¼–ç»‡å™¨æ¨¡å—ã€‚

        Args:
            input_ids (Optional[torch.LongTensor]): ç”Ÿæˆåºåˆ—çš„token IDå¼ é‡
            attention_mask (Optional[torch.Tensor]): æ³¨æ„åŠ›æ©ç ï¼Œé»˜è®¤None
            **kwargs: ä¼ é€’ç»™åº•å±‚æ¨¡å‹çš„é¢å¤–å…³é”®å­—å‚æ•°

        Returns:
            torch.Tensor: Logitså¼ é‡ï¼Œå½¢çŠ¶ä¸º`(batch_size, seq_len, num_classes)`
                        num_classes=2ï¼Œåˆ†åˆ«å¯¹åº”"ä¸æ’å…¥"ï¼ˆç´¢å¼•0ï¼‰å’Œ"æ’å…¥"ï¼ˆç´¢å¼•1ï¼‰çš„æ¦‚ç‡
        """</span>   
        <span class="hljs-comment"># è°ƒç”¨åŸºç¡€æ¨¡å‹å‰å‘ä¼ æ’­ï¼Œè¿”å›äºŒåˆ†ç±»logits</span>
        <span class="hljs-keyword">return</span> self.model(
            input_ids=input_ids, 
            attention_mask=attention_mask, 
            **kwargs
        ).logits
</code></pre>
<h4 data-id="heading-19">2.3  MemGenWeaver</h4>
<h5 data-id="heading-20">2.3.1 æ ¸å¿ƒä½œç”¨</h5>
<p>MemGenWeaver æ˜¯ MemGen æ¡†æ¶çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œè´Ÿè´£ç”ŸæˆåŠ¨æ€æ½œåœ¨è®°å¿†å¹¶å°†å…¶ä¸æ¨ç†å™¨çš„è¾“å…¥åºåˆ—èåˆï¼Œä»è€Œå®ç°è®°å¿†ä¸æ¨ç†è¿‡ç¨‹çš„æ— ç¼äº¤ç»‡ã€‚å®ƒé€šè¿‡å¯å­¦ä¹ çš„æ½œåœ¨è®°å¿†æŸ¥è¯¢å‘é‡ï¼Œåœ¨æç¤ºè¯é˜¶æ®µå’Œæ¨ç†é˜¶æ®µåˆ†åˆ«ç”Ÿæˆé’ˆå¯¹æ€§çš„è®°å¿†è¡¨ç¤ºï¼Œå¼•å¯¼æ¨ç†å™¨è°ƒæ•´è§£ç è·¯å¾„ï¼Œæå‡æ™ºèƒ½ä½“çš„åŠ¨æ€å†³ç­–èƒ½åŠ›ã€‚</p>
<h5 data-id="heading-21">2.3.2 æ ¸å¿ƒç‰¹è‰²</h5>
<ul>
<li>åŒé˜¶æ®µè®°å¿†ç”Ÿæˆï¼šåŒºåˆ†æç¤ºè¯é˜¶æ®µï¼ˆ<code>augment_prompt</code>ï¼‰å’Œæ¨ç†é˜¶æ®µï¼ˆ<code>augment_inference</code>ï¼‰ï¼Œä½¿ç”¨å„è‡ªç‹¬ç«‹çš„å¯å­¦ä¹ æ½œåœ¨è®°å¿†æŸ¥è¯¢å‘é‡ï¼Œé€‚é…ä¸åŒé˜¶æ®µçš„è®°å¿†éœ€æ±‚ï¼Œå¢å¼ºè®°å¿†ç”Ÿæˆçš„é’ˆå¯¹æ€§ã€‚</li>
<li>çµæ´»çš„æ½œåœ¨è®°å¿†èåˆï¼šé€šè¿‡<code>_augment</code>æ–¹æ³•ç»Ÿä¸€å®ç°æ½œåœ¨è®°å¿†ä¸è¾“å…¥åºåˆ—çš„èåˆï¼ŒåŒ…æ‹¬åµŒå…¥æ‹¼æ¥ã€æ³¨æ„åŠ›æ©ç æ‰©å±•å’Œä½ç½® ID è®¡ç®—ï¼Œç¡®ä¿è®°å¿†ä¸åŸå§‹è¾“å…¥åœ¨è¯­ä¹‰ç©ºé—´å’Œæ—¶åºä¸Šçš„ä¸€è‡´æ€§ã€‚</li>
<li>é«˜æ•ˆçš„æ¨¡å‹è®¾è®¡ï¼š
<ul>
<li>åŸºäºé¢„è®­ç»ƒ LLM æ„å»ºï¼Œæ”¯æŒ PEFT å‚æ•°é«˜æ•ˆå¾®è°ƒï¼Œåœ¨ä¿ç•™åŸºç¡€èƒ½åŠ›çš„åŒæ—¶é™ä½è®­ç»ƒæˆæœ¬ï¼›</li>
<li>é‡‡ç”¨ bfloat16 ç²¾åº¦å’Œ Flash Attention 2 ä¼˜åŒ–ï¼Œæå‡è®¡ç®—æ•ˆç‡å’Œå†…å­˜åˆ©ç”¨ç‡ã€‚</li>
</ul>
</li>
<li>åŠ¨æ€è®°å¿†ç¼–ç»‡æœºåˆ¶ï¼šç”Ÿæˆçš„æ½œåœ¨è®°å¿†å¹¶éé™æ€æ£€ç´¢ç»“æœï¼Œè€Œæ˜¯åŸºäºå½“å‰è¾“å…¥åºåˆ—åŠ¨æ€ç”Ÿæˆçš„éšè—çŠ¶æ€ï¼Œèƒ½å¤Ÿæ•æ‰å®æ—¶ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå®ç° â€œç”Ÿæˆå¼è®°å¿†â€ çš„æ ¸å¿ƒç‰¹æ€§ã€‚</li>
<li>æ¨¡å—åŒ–ä¸å¯æ‰©å±•æ€§ï¼šä¸æ¨ç†å™¨ã€è§¦å‘å™¨è§£è€¦ï¼Œé€šè¿‡æ ‡å‡†åŒ–æ¥å£äº¤äº’ï¼›æ½œåœ¨è®°å¿†çš„æ•°é‡å¯é€šè¿‡å‚æ•°çµæ´»é…ç½®ï¼Œé€‚é…ä¸åŒä»»åŠ¡å¯¹è®°å¿†å®¹é‡çš„éœ€æ±‚ã€‚</li>
</ul>
<h5 data-id="heading-22">2.3.3 ç½‘ç»œæ¶æ„</h5>
<p>ç½‘ç»œæ¶æ„å›¾å¦‚ä¸‹ã€‚</p>
<p>è¯´æ˜å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p>æ ¸å¿ƒç»„ä»¶ï¼š</p>
<ul>
<li>å¯å­¦ä¹ æ½œåœ¨è®°å¿†å‘é‡ï¼šåˆ†é˜¶æ®µè®¾è®¡ï¼ˆP=æç¤ºè¯é˜¶æ®µæ•°é‡ï¼ŒI=æ¨ç†é˜¶æ®µæ•°é‡ï¼‰ï¼Œæ”¯æŒåŠ¨æ€ç”Ÿæˆè®°å¿†</li>
<li>é¢„è®­ç»ƒLLMï¼šä½œä¸ºè®°å¿†ç”Ÿæˆæ ¸å¿ƒï¼Œé»˜è®¤å¯ç”¨bfloat16ç²¾åº¦å’ŒFlash Attention 2ä¼˜åŒ–</li>
<li>åºåˆ—èåˆå±‚ï¼šç¡®ä¿è¾“å…¥ä¸è®°å¿†åœ¨è¯­ä¹‰ã€æ©ç ã€æ—¶åºä¸Šçš„ä¸€è‡´æ€§</li>
</ul>
</li>
<li>
<p>æ ¸å¿ƒæµç¨‹ï¼š</p>
<ul>
<li>è¾“å…¥ â†’ é€‰æ‹©å¯¹åº”é˜¶æ®µçš„æ½œåœ¨è®°å¿† â†’ èåˆåºåˆ— â†’ LLMç”Ÿæˆéšè—çŠ¶æ€ â†’ æå–æ½œåœ¨è®°å¿†è¾“å‡º</li>
<li>æ”¯æŒPEFTå‚æ•°é«˜æ•ˆå¾®è°ƒï¼ˆå¦‚LoRAï¼‰ï¼Œé€‚é…äºTransformer Blockså±‚</li>
</ul>
</li>
<li>
<p>è¾“å‡ºç”¨é€”ï¼š</p>
<ul>
<li>ç”Ÿæˆçš„æ½œåœ¨è®°å¿†å°†é€šè¿‡æŠ•å½±å±‚æ˜ å°„åˆ°æ¨ç†å™¨çš„åµŒå…¥ç©ºé—´ï¼Œä¸åŸå§‹è¾“å…¥èåˆä»¥å¼•å¯¼è§£ç </li>
</ul>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/171332decb0c4154ba66ca9f7de013db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763380690&amp;x-signature=MkDfTVSJzZAmLMpyyKdipXchpbw%3D" alt="MemGen-4.png" loading="lazy"/></p>
<h5 data-id="heading-23">2.3.4 ä»£ç </h5>
<p>ä¸¤ä¸ªå…³é”®å˜é‡å¦‚ä¸‹ï¼š</p>
<ul>
<li>prompt_query_latentsã€‚
<ul>
<li>ä½œç”¨ï¼šå¢å¼ºæ¨¡å‹åœ¨å¤„ç†promptæ—¶å€™çš„è¡¨ç°ã€‚ åœ¨æ¨¡å‹å¤„ç†å®ŒåŸå§‹æç¤ºä¹‹åä¼šè¢«æ³¨å…¥åˆ°åºåˆ—ä¸­ï¼Œä¸ºæ¨¡å‹æä¾›é¢å¤–çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</li>
<li>ä½¿ç”¨åœºæ™¯ï¼šåœ¨ augment_prompt æ–¹æ³•ä¸­ä½¿ç”¨ï¼Œåœ¨ç”Ÿæˆé˜¶æ®µçš„å¼€å§‹é˜¶æ®µä½¿ç”¨ä¸€æ¬¡ã€‚</li>
</ul>
</li>
<li>inference_query_latentsã€‚
<ul>
<li>ä½œç”¨ï¼šåœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­åŠ¨æ€å¢å¼ºæ¨¡å‹çš„æ¨ç†èƒ½åŠ›ã€‚å¯ä»¥åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­çš„å¤šä¸ªç‚¹è¢«æ³¨å…¥ï¼Œä»¥æä¾›å®æ—¶ä¸Šä¸‹æ–‡å¢å¼ºã€‚</li>
<li>ä½¿ç”¨åœºæ™¯ï¼šåœ¨ augment_inference æ–¹æ³•ä¸­ä½¿ç”¨ï¼Œåœ¨ç”Ÿæˆé˜¶æ®µä¸­å¤šæ¬¡è¢«ä½¿ç”¨ã€‚é€šå¸¸åœ¨é‡åˆ°ç‰¹å®šåˆ†éš”ç¬¦ï¼ˆé€—å·ï¼Œå¥å·ç­‰ï¼‰åè§¦å‘æ’å…¥ã€‚</li>
</ul>
</li>
</ul>
<p>è¿™ä¸¤ä¸ªå˜é‡éƒ½é€šè¿‡_augment æ–¹æ³•è·å¾—ï¼ˆè·å–å­¦ä¹ åˆ°çš„æ½œåœ¨å‘é‡ï¼Œå¹¶å°†å…¶é™„åŠ åˆ°è¾“å…¥åµŒå…¥ä¸­ï¼‰ã€‚å…¶æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>å°†æ½œåœ¨å˜é‡é™„åŠ åˆ°å½“å‰è¾“å…¥åµŒå…¥åºåˆ—çš„æœ«å°¾ã€‚</li>
<li>æ›´æ–°æ³¨æ„åŠ›æ©ç å’Œä½ç½®IDï¼Œä»¥è€ƒè™‘æ–°å¢çš„æ½œåœ¨å‘é‡ã€‚</li>
<li>å°†å¢å¼ºåçš„åºåˆ—é€šè¿‡Weaveræ¨¡å‹å¤„ç†ã€‚</li>
<li>æä¾›äºæ½œåœ¨å‘é‡ä½ç½®å¯¹åº”çš„éšçŠ¶æ€ä½œä¸ºå¢å¼ºè¡¨ç¤ºã€‚</li>
</ul>
<p>åˆ¤æ–­æ˜¯å¦æ’å…¥æ˜¯é€šè¿‡å‡½æ•° _should_augment å®Œæˆçš„ã€‚</p>
<ul>
<li>æ£€æŸ¥å½“å‰ç”Ÿæˆçš„æ–‡æœ¬æ˜¯å¦æ˜¯ç‰¹æ®Šå­—ç¬¦ï¼ˆé€—å·ç­‰ï¼‰</li>
<li>ä½¿ç”¨è§¦å‘æ¨¡å‹ï¼ˆtrigger modelï¼‰è¿›ä¸€æ­¥åˆ¤æ–­æ˜¯å¦åº”è¯¥å¢å¼ºã€‚</li>
<li>è€ƒè™‘æœ€å¤§å¢å¼ºæ¬¡æ•°é™åˆ¶ã€‚</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MemGenWeaver</span>(torch.nn.Module):
    <span class="hljs-string">"""
    MemGenæ¨¡å‹çš„ç¼–ç»‡å™¨æ¨¡å—ï¼ˆMemGenWeaverï¼‰ã€‚
    - è¾“å…¥ï¼šæ¥æ”¶æ¥æ”¶æ¥è‡ªæ¨ç†å™¨æ¨¡å‹å½“å‰å½“å‰è§£ç åºåˆ—çš„`inputs_embeds`ï¼ˆè¾“å…¥åµŒå…¥å…¥ï¼‰
    - è¾“å‡ºï¼šç”Ÿæˆé•¿åº¦ä¸ºKçš„éšè—çŠ¶æ€åºåˆ—ï¼Œ
è¿™äº›çŠ¶æ€å°†ä¸åŸå§‹`inputs_embeds`æ‹¼æ¥ï¼Œä»¥æ”¹å˜æ¨ç†å™¨çš„è§£ç è·¯å¾„
    """</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">
        self, 
        pretrained_model_name_or_path: <span class="hljs-built_in">str</span>,  <span class="hljs-comment"># é¢„è®­ç»ƒæ¨¡å‹çš„åç§°æˆ–è·¯å¾„</span>
        prompt_latents_num: <span class="hljs-built_in">int</span>,    <span class="hljs-comment"># æç¤ºè¯é˜¶æ®µç”Ÿæˆçš„æ½œåœ¨è®°å¿†æ•°é‡</span>
        inference_latents_num: <span class="hljs-built_in">int</span>, <span class="hljs-comment"># æ¨ç†é˜¶æ®µç”Ÿæˆçš„æ½œåœ¨è®°å¿†æ•°é‡</span>
        peft_config: <span class="hljs-type">Optional</span>[PeftConfig] = <span class="hljs-literal">None</span>  <span class="hljs-comment"># PEFTé…ç½®ï¼ˆå¯é€‰ï¼‰</span>
    </span>):
        <span class="hljs-built_in">super</span>().__init__()
        
        <span class="hljs-comment"># åŸºç¡€æ¨¡å‹åˆå§‹åŒ–</span>
        self.model = AutoModelForCausalLM.from_pretrained(
            pretrained_model_name_or_path,
            torch_dtype=torch.bfloat16,  <span class="hljs-comment"># ä½¿ç”¨bfloat16ç²¾åº¦ä»¥æé«˜æ•ˆç‡</span>
            attn_implementation=<span class="hljs-string">"flash_attention_2"</span>  <span class="hljs-comment"># å¯ç”¨Flash Attentionention 2ä¼˜åŒ–</span>
        )
        self.tokenizer = AutoTokenizer.from_pretrained(pretrained_model_name_or_path)  <span class="hljs-comment"># å¯¹åº”çš„åˆ†è¯å™¨</span>
        <span class="hljs-comment"># è‹¥æä¾›PEFTé…ç½®ï¼Œåˆ™åº”ç”¨å‚æ•°é«˜æ•ˆå¾®è°ƒ</span>
        <span class="hljs-keyword">if</span> peft_config <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            self.model = get_peft_model(self.model, peft_config)
        
        self.config = self.model.config  <span class="hljs-comment"># ä¿å­˜æ¨¡å‹é…ç½®</span>
        
        <span class="hljs-comment"># æç¤ºè¯é˜¶æ®µçš„æ½œåœ¨è®°å¿†æŸ¥è¯¢å‘é‡ï¼ˆå¯å­¦ä¹ å‚æ•°ï¼‰</span>
        self.prompt_query_latents = nn.Parameter(
            torch.randn(prompt_latents_num, self.config.hidden_size),  <span class="hljs-comment"># å½¢çŠ¶ï¼š[prompt_latents_num, hidden_size]</span>
            requires_grad=<span class="hljs-literal">True</span>  <span class="hljs-comment"># å…è®¸åå‘ä¼ æ’­æ›´æ–°</span>
        )

        <span class="hljs-comment"># æ¨ç†é˜¶æ®µçš„æ½œåœ¨è®°å¿†æŸ¥è¯¢å‘é‡ï¼ˆå¯å­¦ä¹ å‚æ•°ï¼‰</span>
        self.inference_query_latents = nn.Parameter(
            torch.randn(inference_latents_num, self.config.hidden_size),  <span class="hljs-comment"># å½¢çŠ¶ï¼š[inference_latents_num, hidden_size]</span>
            requires_grad=<span class="hljs-literal">True</span>  <span class="hljs-comment"># å…è®¸åå‘ä¼ æ’­æ›´æ–°</span>
        )
    
<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">prompt_latents_num</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">int</span>:
        <span class="hljs-string">"""è¿”å›æç¤ºè¯é˜¶æ®µçš„æ½œåœ¨è®°å¿†æ•°é‡"""</span>
        <span class="hljs-keyword">return</span> self.prompt_query_latents.size(<span class="hljs-number">0</span>)

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">inference_latents_num</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">int</span>:
        <span class="hljs-string">"""è¿”å›æ¨ç†é˜¶æ®µçš„æ½œåœ¨è®°å¿†æ•°é‡"""</span>
        <span class="hljs-keyword">return</span> self.inference_query_latents.size(<span class="hljs-number">0</span>)

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">device</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""è¿”å›æ¨¡å‹æ‰€åœ¨çš„è®¾å¤‡ï¼ˆCPU/GPUï¼‰"""</span>
        <span class="hljs-keyword">return</span> self.model.device

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_augment</span>(<span class="hljs-params">
        self, 
        latents: torch.Tensor,                <span class="hljs-comment"># æ½œåœ¨è®°å¿†æŸ¥è¯¢å‘é‡ï¼Œå½¢çŠ¶ï¼š[latents_num, hidden_size]</span>
        inputs_embeds: torch.Tensor,          <span class="hljs-comment"># è¾“å…¥åµŒå…¥ï¼Œå½¢çŠ¶ï¼š[batch_size, seq_len, hidden_size]</span>
        attention_mask: torch.Tensor,         <span class="hljs-comment"># æ³¨æ„åŠ›æ©ç ï¼Œå½¢çŠ¶ï¼š[batch_size, seq_len]</span>
        position_ids: torch.Tensor            <span class="hljs-comment"># ä½ç½®IDï¼Œå½¢çŠ¶ï¼š[batch_size, seq_len]</span>
    </span>) -&gt; <span class="hljs-type">Tuple</span>[torch.Tensor, torch.Tensor, torch.Tensor]:
        <span class="hljs-string">"""
        é€šç”¨çš„æ½œåœ¨è®°å¿†å¢å¼ºæ–¹æ³•ï¼šå°†æ½œåœ¨è®°å¿†ä¸è¾“å…¥åºåˆ—èåˆï¼Œç”Ÿæˆå¢å¼ºåçš„éšè—çŠ¶æ€ã€‚
        
        å‚æ•°ï¼š
            latents: æ½œåœ¨è®°å¿†æŸ¥è¯¢å‘é‡
            inputs_embeds: è¾“å…¥åºåˆ—çš„åµŒå…¥è¡¨ç¤º
            attention_mask: è¾“å…¥åºåˆ—çš„æ³¨æ„åŠ›æ©ç 
            position_ids: è¾“å…¥åºåˆ—çš„ä½ç½®ID
        
        è¿”å›ï¼š
            ä¸‰å…ƒç»„ (latents_hidden_states, latents_mask, latents_position_ids)
            - latents_hidden_states: ç”Ÿæˆçš„æ½œåœ¨è®°å¿†éšè—çŠ¶æ€ï¼Œå½¢çŠ¶ï¼š[batch_size, latents_num, hidden_size]
            - latents_mask: æ½œåœ¨è®°å¿†çš„æ³¨æ„åŠ›æ©ç ï¼Œå½¢çŠ¶ï¼š[batch_size, latents_num]
            - latents_position_ids: æ½œåœ¨è®°å¿†çš„ä½ç½®IDï¼Œå½¢çŠ¶ï¼š[batch_size, latents_num]
        """</span>
        batch_size = attention_mask.shape[<span class="hljs-number">0</span>]  <span class="hljs-comment"># è·å–æ‰¹æ¬¡å¤§å°</span>
        latents_num = latents.size(<span class="hljs-number">0</span>)         <span class="hljs-comment"># è·å–æ½œåœ¨è®°å¿†æ•°é‡</span>
        
        <span class="hljs-comment"># æ‰©å±•æ½œåœ¨è®°å¿†ç»´åº¦ä»¥åŒ¹é…æ‰¹æ¬¡å¤§å°ï¼š[1, latents_num, hidden_size] â†’ [batch_size, latents_num, hidden_size]</span>
        latents = latents.unsqueeze(<span class="hljs-number">0</span>).repeat(batch_size, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)
        
        <span class="hljs-comment"># å°†æ½œåœ¨è®°å¿†åµŒå…¥ä¸è¾“å…¥åµŒå…¥æ‹¼æ¥ï¼š[batch_size, seq_len + latents_num, hidden_size]</span>
        inputs_embeds = torch.cat([inputs_embeds, latents], dim=<span class="hljs-number">1</span>)

        <span class="hljs-comment"># æ„å»ºæ½œåœ¨è®°å¿†çš„æ³¨æ„åŠ›æ©ç ï¼ˆå…¨ä¸º1ï¼Œè¡¨ç¤ºæœ‰æ•ˆï¼‰å¹¶ä¸è¾“å…¥æ©ç æ‹¼æ¥</span>
        latents_mask = torch.ones(latents.shape[:-<span class="hljs-number">1</span>], dtype=attention_mask.dtype, device=attention_mask.device)
        attention_mask = torch.cat([attention_mask, latents_mask], dim=<span class="hljs-number">1</span>)  <span class="hljs-comment"># å½¢çŠ¶ï¼š[batch_size, seq_len + latents_num]</span>
        
        <span class="hljs-comment"># ç”Ÿæˆæ½œåœ¨è®°å¿†çš„ä½ç½®IDï¼ˆåœ¨è¾“å…¥åºåˆ—æœ€åä½ç½®çš„åŸºç¡€ä¸Šé€’å¢ï¼‰</span>
        last_position_ids = position_ids.<span class="hljs-built_in">max</span>(dim=<span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]  <span class="hljs-comment"># è·å–è¾“å…¥åºåˆ—çš„æœ€å¤§ä½ç½®ID</span>
        latents_relative_positions = torch.arange(latents_num, device=attention_mask.device)  <span class="hljs-comment"># æ½œåœ¨è®°å¿†çš„ç›¸å¯¹ä½ç½®</span>
        <span class="hljs-comment"># è®¡ç®—ç»å¯¹ä½ç½®ï¼šè¾“å…¥åºåˆ—æœ€å¤§ä½ç½® + ç›¸å¯¹ä½ç½® + 1ï¼ˆé¿å…é‡å ï¼‰</span>
        latents_position_ids = last_position_ids.unsqueeze(<span class="hljs-number">1</span>) + latents_relative_positions + <span class="hljs-number">1</span>
        <span class="hljs-comment"># æ‹¼æ¥ä½ç½®IDï¼š[batch_size, seq_len + latents_num]</span>
        position_ids = torch.cat([position_ids.long(), latents_position_ids.long()], dim=<span class="hljs-number">1</span>) 

        <span class="hljs-comment"># éªŒè¯æ‹¼æ¥åçš„ç»´åº¦æ˜¯å¦ä¸€è‡´</span>
        <span class="hljs-keyword">assert</span> inputs_embeds.shape[:<span class="hljs-number">2</span>] == attention_mask.shape == position_ids.shape

        <span class="hljs-comment"># æ¨¡å‹å‰å‘ä¼ æ’­ï¼Œè·å–éšè—çŠ¶æ€</span>
        outputs = self.model(
            inputs_embeds=inputs_embeds,
            attention_mask=attention_mask,
            position_ids=position_ids,  
            output_hidden_states=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># è¾“å‡ºæ‰€æœ‰å±‚çš„éšè—çŠ¶æ€</span>
        )
        <span class="hljs-comment"># å–æœ€åä¸€å±‚çš„éšè—çŠ¶æ€ï¼Œå¹¶æå–æ½œåœ¨è®°å¿†éƒ¨åˆ†ï¼ˆåºåˆ—æœ«å°¾çš„latents_numä¸ªä½ç½®ï¼‰</span>
        hidden_states = outputs.hidden_states[-<span class="hljs-number">1</span>]
        latents_hidden_states = hidden_states[:, -latents_num:, :]

        <span class="hljs-keyword">return</span> latents_hidden_states, latents_mask, latents_position_ids

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">augment_prompt</span>(<span class="hljs-params">
        self, 
        inputs_embeds: torch.Tensor, 
        attention_mask: torch.Tensor, 
        position_ids: torch.Tensor
    </span>) -&gt; <span class="hljs-type">Tuple</span>[torch.Tensor, torch.Tensor, torch.Tensor]:
        <span class="hljs-string">"""
        æç¤ºè¯é˜¶æ®µçš„æ½œåœ¨è®°å¿†å¢å¼ºï¼šä½¿ç”¨æç¤ºè¯ä¸“ç”¨çš„æ½œåœ¨è®°å¿†æŸ¥è¯¢å‘é‡ã€‚
        
        å‚æ•°ä¸è¿”å›å€¼åŒ_augmentæ–¹æ³•
        """</span>
        <span class="hljs-keyword">return</span> self._augment(
            latents=self.prompt_query_latents,
            inputs_embeds=inputs_embeds,
            attention_mask=attention_mask,
            position_ids=position_ids
        )


    <span class="hljs-keyword">def</span> <span class="hljs-title function_">augment_inference</span>(<span class="hljs-params">
        self, 
        inputs_embeds: torch.Tensor, 
        attention_mask: torch.Tensor, 
        position_ids: torch.Tensor
    </span>) -&gt; <span class="hljs-type">Tuple</span>[torch.Tensor, torch.Tensor, torch.Tensor]:
        <span class="hljs-string">"""
        æ¨ç†é˜¶æ®µçš„æ½œåœ¨è®°å¿†å¢å¼ºï¼šä½¿ç”¨æ¨ç†ä¸“ç”¨çš„æ½œåœ¨è®°å¿†æŸ¥è¯¢å‘é‡ã€‚
        
        å‚æ•°ä¸è¿”å›å€¼åŒ_augmentæ–¹æ³•
        """</span>
        <span class="hljs-keyword">return</span> self._augment(
            latents=self.inference_query_latents,
            inputs_embeds=inputs_embeds,
            attention_mask=attention_mask,
            position_ids=position_ids
        )
</code></pre>
<h3 data-id="heading-24">0xFF å‚è€ƒ</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FpqCPoUw0p2oTsnMUj9t2mw" target="_blank" title="https://mp.weixin.qq.com/s/pqCPoUw0p2oTsnMUj9t2mw" ref="nofollow noopener noreferrer">æœ€æ–°æˆæœï¼Agentè®°å¿†çš„ç¬¬ä¸‰ç§å¯èƒ½ï¼šç”Ÿæˆå¼éšå¼è®°å¿†</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[InputConnectionæœºåˆ¶ä¸è·¨è¿›ç¨‹æ–‡æœ¬æ“ä½œçš„å·¥ç¨‹å®è·µ]]></title>    <link>https://juejin.cn/post/7570923924364853311</link>    <guid>https://juejin.cn/post/7570923924364853311</guid>    <pubDate>2025-11-10T13:26:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570923924364853311" data-draft-id="7571060853353824266" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="InputConnectionæœºåˆ¶ä¸è·¨è¿›ç¨‹æ–‡æœ¬æ“ä½œçš„å·¥ç¨‹å®è·µ"/> <meta itemprop="keywords" content="Android,Linux"/> <meta itemprop="datePublished" content="2025-11-10T13:26:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="WAsbry"/> <meta itemprop="url" content="https://juejin.cn/user/3413335797139511"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            InputConnectionæœºåˆ¶ä¸è·¨è¿›ç¨‹æ–‡æœ¬æ“ä½œçš„å·¥ç¨‹å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3413335797139511/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    WAsbry
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T13:26:16.000Z" title="Mon Nov 10 2025 13:26:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">InputConnectionæœºåˆ¶ä¸è·¨è¿›ç¨‹æ–‡æœ¬æ“ä½œçš„å·¥ç¨‹å®è·µ</h2>
<h3 data-id="heading-1">ğŸ’¡ æœ¬æ–‡ç²¾å</h3>
<ul>
<li><strong>æ‰¿æ¥å‰æ–‡</strong>ï¼šç¬¬ä¸€ç¯‡è®²Binderé€šä¿¡ï¼Œç¬¬äºŒç¯‡è®²è®¾è®¡ç¼ºé™·ï¼Œæœ¬ç¯‡ç»™å‡ºå®Œæ•´çš„å·¥ç¨‹è§£å†³æ–¹æ¡ˆ</li>
<li><strong>æ ¸å¿ƒéœ€æ±‚</strong>ï¼šæ—¢ä¿ç•™æ•°å­—é”®ç›˜ï¼ˆinputType="number"ï¼‰ï¼Œåˆé¿å…å­—æ¯è¾“å…¥å¯¼è‡´æ•°å­—ä¸¢å¤±</li>
<li><strong>æœ€ä½³æ–¹æ¡ˆ</strong>ï¼šè‡ªå®šä¹‰InputConnectionåœ¨<code>setComposingText()</code>å±‚æ‹¦æˆªéæ³•å­—ç¬¦ï¼Œé˜»æ­¢è¿›å…¥delete-insertæµç¨‹</li>
<li><strong>ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”</strong>ï¼šInputConnectionæ‹¦æˆªï¼ˆæ¨èâ­â­â­â­â­ï¼‰ã€TextWatcherè¿‡æ»¤ï¼ˆâ­â­â­ï¼‰ã€è‡ªå®šä¹‰InputFilterï¼ˆâ­â­â­â­ï¼‰</li>
<li><strong>ä»·å€¼</strong>ï¼šæä¾›å¯ç›´æ¥ä½¿ç”¨çš„å®Œæ•´ä»£ç ï¼Œåˆ†ææ–¹æ¡ˆä¼˜åŠ£ï¼ŒæŒ‡å¯¼å·¥ç¨‹å®è·µ</li>
</ul>
<hr/>
<h3 data-id="heading-2">ä¸€ã€éœ€æ±‚åˆ†æä¸çº¦æŸæ¡ä»¶</h3>
<h4 data-id="heading-3">1.1 æ ¸å¿ƒéœ€æ±‚</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç”¨æˆ·éœ€æ±‚:
<span class="hljs-bullet">1.</span> ç‚¹å‡»EditTextæ—¶ï¼Œå¼¹å‡ºæ•°å­—é”®ç›˜ï¼ˆä¸æ˜¯å…¨é”®ç›˜ï¼‰
<span class="hljs-bullet">2.</span> åªå…è®¸è¾“å…¥æ•°å­—å­—ç¬¦
<span class="hljs-bullet">3.</span> åˆ‡æ¢åˆ°å­—æ¯é”®ç›˜è¾“å…¥å­—æ¯æ—¶ï¼Œä¸åº”å¯¼è‡´å·²æœ‰æ•°å­—ä¸¢å¤±

æŠ€æœ¯çº¦æŸ:
<span class="hljs-bullet">1.</span> å¿…é¡»ä½¿ç”¨ android:inputType="number" (ä¿è¯æ•°å­—é”®ç›˜)
<span class="hljs-bullet">2.</span> ä¸èƒ½ä¿®æ”¹Androidæ¡†æ¶ä»£ç 
<span class="hljs-bullet">3.</span> éœ€è¦å…¼å®¹ä¸»æµè¾“å…¥æ³•ï¼ˆç™¾åº¦ã€æœç‹—ã€è®¯é£ç­‰ï¼‰
<span class="hljs-bullet">4.</span> æ€§èƒ½å¼€é”€è¦å°
</code></pre>
<h4 data-id="heading-4">1.2 é—®é¢˜å›é¡¾</h4>
<p><strong>å‰ä¸¤ç¯‡å·²åˆ†æçš„æ ¹æœ¬åŸå› </strong>ï¼š</p>
<pre><code class="hljs language-css" lang="css">è¾“å…¥æ³•è¿›ç¨‹:
  ic.<span class="hljs-built_in">setComposingText</span>(<span class="hljs-string">"qq"</span>, <span class="hljs-number">1</span>)
  â†“ Binder IPC
åº”ç”¨è¿›ç¨‹:
  BaseInputConnection.<span class="hljs-built_in">replaceText</span>(<span class="hljs-string">"qq"</span>, <span class="hljs-number">1</span>, true)
  â†“
  <span class="hljs-number">1</span>. <span class="hljs-built_in">delete</span>(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>) â†’ æˆåŠŸï¼ˆç»•è¿‡InputFilterï¼‰
  <span class="hljs-number">2</span>. <span class="hljs-built_in">insert</span>(<span class="hljs-string">"qq"</span>) â†’ å¤±è´¥ï¼ˆè¢«DigitsKeyListeneræ‹’ç»ï¼‰
  â†“
  ç»“æœ: æ•°æ®ä¸¢å¤±
</code></pre>
<p><strong>è§£å†³æ–¹å‘</strong>ï¼š</p>
<ul>
<li>åœ¨deleteæ‰§è¡Œä¹‹å‰æ‹¦æˆª</li>
<li>åˆ¤æ–­æ–°æ–‡æœ¬æ˜¯å¦åˆæ³•</li>
<li>å¦‚æœéæ³•ï¼Œä¸è¿›å…¥delete-insertæµç¨‹</li>
</ul>
<hr/>
<h3 data-id="heading-5">äºŒã€è§£å†³æ–¹æ¡ˆä¸€ï¼šInputConnectionæ‹¦æˆªï¼ˆæ¨èâ­â­â­â­â­ï¼‰</h3>
<h4 data-id="heading-6">2.1 æ ¸å¿ƒæ€è·¯</h4>
<pre><code class="hljs language-css" lang="css">åŸå§‹æµç¨‹ï¼ˆæœ‰Bugï¼‰:
<span class="hljs-built_in">setComposingText</span>(<span class="hljs-string">"qq"</span>)
  â†’ <span class="hljs-built_in">replaceText</span>()
  â†’ <span class="hljs-built_in">delete</span>(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>) â† åˆ é™¤æ•°å­—
  â†’ <span class="hljs-built_in">insert</span>(<span class="hljs-string">"qq"</span>) â† è¢«æ‹’ç»
  â†’ Bug!

ä¼˜åŒ–åæµç¨‹:
<span class="hljs-built_in">setComposingText</span>(<span class="hljs-string">"qq"</span>)
  â†’ NumberInputConnectionWrapper.<span class="hljs-built_in">setComposingText</span>()
  â†’ æ£€æµ‹åˆ°å­—æ¯ <span class="hljs-string">'q'</span>
  â†’ è°ƒç”¨ <span class="hljs-built_in">finishComposingText</span>() â† ç›´æ¥å®Œæˆç»„åˆï¼Œä¸æ‰§è¡Œdelete-insert
  â†’ æ•°å­—ä¿æŒä¸å˜ âœ“
</code></pre>
<h4 data-id="heading-7">2.2 å®Œæ•´å®ç°ä»£ç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RecommendedNumberEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RecommendedNumberEditText</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-built_in">super</span>(context);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RecommendedNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs)</span> {
        <span class="hljs-built_in">super</span>(context, attrs);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RecommendedNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> {
        <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> InputConnection <span class="hljs-title function_">onCreateInputConnection</span><span class="hljs-params">(EditorInfo outAttrs)</span> {
        <span class="hljs-comment">// è·å–çˆ¶ç±»åˆ›å»ºçš„InputConnection</span>
        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.onCreateInputConnection(outAttrs);
        <span class="hljs-keyword">if</span> (base == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-comment">// åŒ…è£…æˆæˆ‘ä»¬çš„è‡ªå®šä¹‰InputConnection</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NumberInputConnectionWrapper</span>(base, <span class="hljs-literal">true</span>);
    }

    <span class="hljs-comment">/**
     * è‡ªå®šä¹‰InputConnectionåŒ…è£…ç±»
     * æ‹¦æˆªsetComposingTextï¼Œæ£€æŸ¥æ˜¯å¦åŒ…å«éæ•°å­—å­—ç¬¦
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NumberInputConnectionWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InputConnectionWrapper</span> {

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">NumberInputConnectionWrapper</span><span class="hljs-params">(InputConnection target, <span class="hljs-type">boolean</span> mutable)</span> {
            <span class="hljs-built_in">super</span>(target, mutable);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
            <span class="hljs-comment">// å…³é”®ï¼šåœ¨æ‰§è¡Œdelete-insertä¹‹å‰æ£€æŸ¥</span>
            <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span> &amp;&amp; containsNonDigit(text)) {
                <span class="hljs-comment">// åŒ…å«éæ•°å­—å­—ç¬¦ï¼Œç›´æ¥å®Œæˆç»„åˆï¼ˆä¸æ‰§è¡Œdelete-insertï¼‰</span>
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.finishComposingText();
            }

            <span class="hljs-comment">// çº¯æ•°å­—æˆ–nullï¼Œæ­£å¸¸å¤„ç†</span>
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
        }

        <span class="hljs-comment">/**
         * æ£€æŸ¥CharSequenceæ˜¯å¦åŒ…å«éæ•°å­—å­—ç¬¦
         */</span>
        <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsNonDigit</span><span class="hljs-params">(CharSequence text)</span> {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; text.length(); i++) {
                <span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> text.charAt(i);
                <span class="hljs-keyword">if</span> (!Character.isDigit(c)) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// å‘ç°éæ•°å­—å­—ç¬¦</span>
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// å…¨éƒ¨æ˜¯æ•°å­—</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-8">2.3 ä½¿ç”¨æ–¹æ³•</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- activity_main.xml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">com.yourpackage.RecommendedNumberEditText</span>
    <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/edit_number"</span>
    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span>
    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
    <span class="hljs-attr">android:hint</span>=<span class="hljs-string">"è¯·è¾“å…¥æ•°å­—"</span>
    <span class="hljs-attr">android:inputType</span>=<span class="hljs-string">"number"</span> /&gt;</span>
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// MainActivity.java</span>
<span class="hljs-type">RecommendedNumberEditText</span> <span class="hljs-variable">editText</span> <span class="hljs-operator">=</span> findViewById(R.id.edit_number);
<span class="hljs-comment">// æ­£å¸¸ä½¿ç”¨ï¼Œæ— éœ€é¢å¤–ä»£ç </span>
</code></pre>
<h4 data-id="heading-9">2.4 æ–¹æ¡ˆä¼˜åŠ¿</h4>

































<table><thead><tr><th>ä¼˜åŠ¿</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ‹¦æˆªæ—¶æœºæ—©</strong></td><td>åœ¨deleteä¹‹å‰æ‹¦æˆªï¼Œä»æºå¤´è§£å†³é—®é¢˜</td></tr><tr><td><strong>æ€§èƒ½æœ€ä¼˜</strong></td><td>ä¸æ‰§è¡Œdelete-insertï¼Œé¿å…æ— æ•ˆæ“ä½œ</td></tr><tr><td><strong>å¯¹è¾“å…¥æ³•é€æ˜</strong></td><td>è¿”å›trueï¼Œè¾“å…¥æ³•è®¤ä¸ºæˆåŠŸï¼Œä¸å½±å“æ­£å¸¸æµç¨‹</td></tr><tr><td><strong>ä¸å½±å“æ­£å¸¸è¾“å…¥</strong></td><td>æ•°å­—è¾“å…¥ä¸å—å½±å“ï¼Œä»èµ°åŸæœ‰é€»è¾‘</td></tr><tr><td><strong>ä»£ç ç®€æ´</strong></td><td>åªéœ€é‡å†™ä¸€ä¸ªæ–¹æ³•</td></tr><tr><td><strong>æ•°å­—é”®ç›˜ä¿ç•™</strong></td><td>inputType="number"ä¿è¯æ•°å­—é”®ç›˜å¼¹å‡º</td></tr></tbody></table>
<h4 data-id="heading-10">2.5 å·¥ä½œæµç¨‹å›¾</h4>
<pre><code class="hljs language-css" lang="css">ç”¨æˆ·æ“ä½œï¼š
  è¾“å…¥æ•°å­— "<span class="hljs-number">123456</span>"
  â†“
  åˆ‡æ¢åˆ°å­—æ¯é”®ç›˜
  â†“
  ç‚¹å‡» '<span class="hljs-selector-tag">q</span>'

è¾“å…¥æ³•è¿›ç¨‹:
  ic.<span class="hljs-built_in">setComposingText</span>(<span class="hljs-string">"q"</span>, <span class="hljs-number">1</span>)
  â†“ Binder IPC

åº”ç”¨è¿›ç¨‹:
  NumberInputConnectionWrapper.<span class="hljs-built_in">setComposingText</span>(<span class="hljs-string">"q"</span>, <span class="hljs-number">1</span>)
  â†“
  <span class="hljs-built_in">containsNonDigit</span>(<span class="hljs-string">"q"</span>) â†’ true (æ£€æµ‹åˆ°å­—æ¯)
  â†“
  è°ƒç”¨ <span class="hljs-built_in">finishComposingText</span>()
  â†“
  BaseInputConnection.<span class="hljs-built_in">finishComposingText</span>()
    - ç§»é™¤COMPOSING Span
    - ä¸æ‰§è¡Œdelete
    - ä¸æ‰§è¡Œinsert
  â†“
  è¿”å› true
  â†“
  å†…å®¹ä¿æŒ <span class="hljs-string">"123456"</span> âœ“

ç»§ç»­ç‚¹å‡» <span class="hljs-string">'q'</span>:
  åŒæ ·æµç¨‹ï¼Œæ¯æ¬¡éƒ½è°ƒç”¨ <span class="hljs-built_in">finishComposingText</span>()
  å†…å®¹å§‹ç»ˆä¿æŒ <span class="hljs-string">"123456"</span> âœ“
</code></pre>
<hr/>
<h3 data-id="heading-11">ä¸‰ã€è§£å†³æ–¹æ¡ˆäºŒï¼šTextWatcherè¿‡æ»¤ï¼ˆâ­â­â­ï¼‰</h3>
<h4 data-id="heading-12">3.1 æ ¸å¿ƒæ€è·¯</h4>
<pre><code class="hljs">åŸç†ï¼š
ä¸ä¾èµ–InputFilterï¼Œè€Œæ˜¯ç›‘å¬æ–‡æœ¬å˜åŒ–
åœ¨æ–‡æœ¬æ”¹å˜åï¼Œè¿‡æ»¤æ‰éæ•°å­—å­—ç¬¦
</code></pre>
<h4 data-id="heading-13">3.2 å®Œæ•´å®ç°ä»£ç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleNumberEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">isFiltering</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// é˜²æ­¢é€’å½’</span>

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SimpleNumberEditText</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-built_in">super</span>(context);
        init();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SimpleNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs)</span> {
        <span class="hljs-built_in">super</span>(context, attrs);
        init();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SimpleNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> {
        <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);
        init();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ä¸è®¾ç½®inputTypeä¸ºnumberï¼Œé¿å…DigitsKeyListener</span>
        <span class="hljs-comment">// ä½†ä¼šä¸¢å¤±æ•°å­—é”®ç›˜ï¼Œéœ€è¦æ‰‹åŠ¨è®¾ç½®</span>
        setRawInputType(InputType.TYPE_CLASS_NUMBER);

        addTextChangedListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TextWatcher</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">beforeTextChanged</span><span class="hljs-params">(CharSequence s, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> count, <span class="hljs-type">int</span> after)</span> {
                <span class="hljs-comment">// ä¸éœ€è¦å¤„ç†</span>
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onTextChanged</span><span class="hljs-params">(CharSequence s, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> before, <span class="hljs-type">int</span> count)</span> {
                <span class="hljs-comment">// ä¸éœ€è¦å¤„ç†</span>
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterTextChanged</span><span class="hljs-params">(Editable s)</span> {
                <span class="hljs-keyword">if</span> (isFiltering) {
                    <span class="hljs-keyword">return</span>; <span class="hljs-comment">// é¿å…é€’å½’</span>
                }

                <span class="hljs-comment">// è¿‡æ»¤æ‰éæ•°å­—å­—ç¬¦</span>
                <span class="hljs-type">String</span> <span class="hljs-variable">filtered</span> <span class="hljs-operator">=</span> s.toString().replaceAll(<span class="hljs-string">"[^0-9]"</span>, <span class="hljs-string">""</span>);

                <span class="hljs-keyword">if</span> (!s.toString().equals(filtered)) {
                    isFiltering = <span class="hljs-literal">true</span>;

                    <span class="hljs-comment">// ä¿å­˜å…‰æ ‡ä½ç½®</span>
                    <span class="hljs-type">int</span> <span class="hljs-variable">cursorPos</span> <span class="hljs-operator">=</span> getSelectionStart();
                    <span class="hljs-type">int</span> <span class="hljs-variable">lengthBefore</span> <span class="hljs-operator">=</span> s.length();

                    <span class="hljs-comment">// æ›¿æ¢ä¸ºè¿‡æ»¤åçš„å†…å®¹</span>
                    setText(filtered);

                    <span class="hljs-comment">// è°ƒæ•´å…‰æ ‡ä½ç½®</span>
                    <span class="hljs-type">int</span> <span class="hljs-variable">lengthAfter</span> <span class="hljs-operator">=</span> filtered.length();
                    <span class="hljs-type">int</span> <span class="hljs-variable">diff</span> <span class="hljs-operator">=</span> lengthBefore - lengthAfter;
                    <span class="hljs-type">int</span> <span class="hljs-variable">newCursorPos</span> <span class="hljs-operator">=</span> Math.max(<span class="hljs-number">0</span>, cursorPos - diff);
                    setSelection(Math.min(newCursorPos, filtered.length()));

                    isFiltering = <span class="hljs-literal">false</span>;
                }
            }
        });
    }
}
</code></pre>
<h4 data-id="heading-14">3.3 æ–¹æ¡ˆä¼˜åŠ£</h4>





























<table><thead><tr><th>ç»´åº¦</th><th>è¯„ä»·</th></tr></thead><tbody><tr><td><strong>ä¼˜ç‚¹</strong></td><td>å®ç°ç®€å•ï¼Œæ˜“äºç†è§£</td></tr><tr><td><strong>ä¼˜ç‚¹</strong></td><td>ä¸ä¾èµ–InputConnectionï¼Œé€»è¾‘ç‹¬ç«‹</td></tr><tr><td><strong>ç¼ºç‚¹</strong></td><td>éœ€è¦é¢å¤–çš„setTextæ“ä½œï¼Œæ€§èƒ½ç•¥å·®</td></tr><tr><td><strong>ç¼ºç‚¹</strong></td><td>å…‰æ ‡ä½ç½®å¤„ç†å¤æ‚</td></tr><tr><td><strong>ç¼ºç‚¹</strong></td><td>ä¼šè§¦å‘é¢å¤–çš„TextWatcherå›è°ƒ</td></tr></tbody></table>
<h4 data-id="heading-15">3.4 æ€§èƒ½å¯¹æ¯”</h4>
<pre><code class="hljs language-css" lang="css">æ–¹æ¡ˆä¸€ï¼ˆInputConnectionæ‹¦æˆªï¼‰:
  <span class="hljs-built_in">setComposingText</span>(<span class="hljs-string">"qq"</span>)
    â†’ æ£€æµ‹åˆ°å­—æ¯
    â†’ <span class="hljs-built_in">finishComposingText</span>()
    â†’ <span class="hljs-number">1</span>æ¬¡æ“ä½œ

æ–¹æ¡ˆäºŒï¼ˆTextWatcherï¼‰:
  <span class="hljs-built_in">setComposingText</span>(<span class="hljs-string">"qq"</span>)
    â†’ <span class="hljs-built_in">delete</span>(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>) â†’ åˆ é™¤<span class="hljs-string">'6'</span>
    â†’ <span class="hljs-built_in">insert</span>(<span class="hljs-string">"qq"</span>) â†’ è¢«æ‹’ç»
    â†’ afterTextChangedè§¦å‘
    â†’ <span class="hljs-built_in">setText</span>(<span class="hljs-string">"123456"</span>) â†’ æ¢å¤
    â†’ <span class="hljs-number">3</span>æ¬¡æ“ä½œ

æ€§èƒ½å·®è·ï¼šæ–¹æ¡ˆäºŒçº¦<span class="hljs-number">3</span>å€äºæ–¹æ¡ˆä¸€
</code></pre>
<hr/>
<h3 data-id="heading-16">å››ã€è§£å†³æ–¹æ¡ˆä¸‰ï¼šè‡ªå®šä¹‰InputFilterï¼ˆâ­â­â­â­ï¼‰</h3>
<h4 data-id="heading-17">4.1 æ ¸å¿ƒæ€è·¯</h4>
<pre><code class="hljs language-sql" lang="sql">åŸç†ï¼š
ä¸ä»…æ‹¦æˆª<span class="hljs-keyword">insert</span>ï¼Œä¹Ÿæ‹¦æˆª<span class="hljs-keyword">delete</span>
é€šè¿‡åˆ¤æ–­sourceæ˜¯å¦ä¸ºç©ºæ¥åŒºåˆ†æ“ä½œç±»å‹
</code></pre>
<h4 data-id="heading-18">4.2 å®Œæ•´å®ç°ä»£ç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeNumberEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SafeNumberEditText</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-built_in">super</span>(context);
        init();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SafeNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs)</span> {
        <span class="hljs-built_in">super</span>(context, attrs);
        init();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SafeNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> {
        <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);
        init();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è®¾ç½®è‡ªå®šä¹‰Filterï¼Œæ›¿æ¢ç³»ç»Ÿçš„DigitsKeyListener</span>
        setFilters(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputFilter</span>[]{<span class="hljs-keyword">new</span> <span class="hljs-title class_">SafeNumberInputFilter</span>()});
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> InputConnection <span class="hljs-title function_">onCreateInputConnection</span><span class="hljs-params">(EditorInfo outAttrs)</span> {
        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.onCreateInputConnection(outAttrs);
        <span class="hljs-keyword">if</span> (base == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-comment">// åŒæ—¶ä½¿ç”¨InputConnectionæ‹¦æˆªï¼ˆåŒé‡ä¿æŠ¤ï¼‰</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SafeInputConnectionWrapper</span>(base, <span class="hljs-literal">true</span>);
    }

    <span class="hljs-comment">/**
     * è‡ªå®šä¹‰InputFilter
     * æ‹¦æˆªéæ•°å­—å­—ç¬¦çš„æ’å…¥
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeNumberInputFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InputFilter</span> {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> CharSequence <span class="hljs-title function_">filter</span><span class="hljs-params">(CharSequence source, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end,
                                   Spanned dest, <span class="hljs-type">int</span> dstart, <span class="hljs-type">int</span> dend)</span> {
            <span class="hljs-comment">// è¿‡æ»¤æ‰éæ•°å­—å­—ç¬¦</span>
            <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">filtered</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> start; i &lt; end; i++) {
                <span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> source.charAt(i);
                <span class="hljs-keyword">if</span> (Character.isDigit(c)) {
                    filtered.append(c);
                }
            }

            <span class="hljs-comment">// å¦‚æœå…¨éƒ¨è¢«è¿‡æ»¤æ‰ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²</span>
            <span class="hljs-keyword">if</span> (filtered.length() == <span class="hljs-number">0</span> &amp;&amp; end &gt; start) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
            }

            <span class="hljs-comment">// å¦‚æœæœ‰å­—ç¬¦è¢«è¿‡æ»¤æ‰ï¼Œè¿”å›è¿‡æ»¤åçš„å†…å®¹</span>
            <span class="hljs-keyword">if</span> (filtered.length() &lt; (end - start)) {
                <span class="hljs-keyword">return</span> filtered.toString();
            }

            <span class="hljs-comment">// å…¨éƒ¨åˆæ³•ï¼Œè¿”å›nullï¼ˆæ¥å—åŸå§‹å†…å®¹ï¼‰</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    }

    <span class="hljs-comment">/**
     * InputConnectionåŒ…è£…ç±»
     * ä½œä¸ºç¬¬äºŒå±‚é˜²æŠ¤
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeInputConnectionWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InputConnectionWrapper</span> {

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">SafeInputConnectionWrapper</span><span class="hljs-params">(InputConnection target, <span class="hljs-type">boolean</span> mutable)</span> {
            <span class="hljs-built_in">super</span>(target, mutable);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
            <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span> &amp;&amp; containsNonDigit(text)) {
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.finishComposingText();
            }
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
        }

        <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsNonDigit</span><span class="hljs-params">(CharSequence text)</span> {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; text.length(); i++) {
                <span class="hljs-keyword">if</span> (!Character.isDigit(text.charAt(i))) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
}
</code></pre>
<h4 data-id="heading-19">4.3 æ–¹æ¡ˆç‰¹ç‚¹</h4>

























<table><thead><tr><th>ç‰¹ç‚¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>åŒé‡ä¿æŠ¤</strong></td><td>InputFilter + InputConnectionä¸¤å±‚æ‹¦æˆª</td></tr><tr><td><strong>çµæ´»æ€§é«˜</strong></td><td>å¯ä»¥è‡ªå®šä¹‰è¿‡æ»¤è§„åˆ™ï¼ˆå¦‚å…è®¸å°æ•°ç‚¹ï¼‰</td></tr><tr><td><strong>å…¼å®¹æ€§å¥½</strong></td><td>é€‚é…å„ç§è¾“å…¥åœºæ™¯</td></tr><tr><td><strong>ä»£ç å¤æ‚</strong></td><td>éœ€è¦åŒæ—¶å®ç°Filterå’ŒWrapper</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-20">äº”ã€ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹æŒ‡å—</h3>
<h4 data-id="heading-21">5.1 å…¨é¢å¯¹æ¯”</h4>





















































<table><thead><tr><th>ç»´åº¦</th><th>æ–¹æ¡ˆä¸€ï¼šInputConnection</th><th>æ–¹æ¡ˆäºŒï¼šTextWatcher</th><th>æ–¹æ¡ˆä¸‰ï¼šè‡ªå®šä¹‰Filter</th></tr></thead><tbody><tr><td><strong>å®ç°å¤æ‚åº¦</strong></td><td>â­â­ (ç®€å•)</td><td>â­ (æœ€ç®€å•)</td><td>â­â­â­â­ (å¤æ‚)</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>â­â­â­â­â­ (æœ€ä¼˜)</td><td>â­â­â­ (ä¸€èˆ¬)</td><td>â­â­â­â­ (å¥½)</td></tr><tr><td><strong>æ‹¦æˆªæ—¶æœº</strong></td><td>æ—©ï¼ˆdeleteä¹‹å‰ï¼‰</td><td>æ™šï¼ˆæ–‡æœ¬å·²æ”¹å˜ï¼‰</td><td>æ—©ï¼ˆä½†æœ‰å±€é™ï¼‰</td></tr><tr><td><strong>æ•°å­—é”®ç›˜</strong></td><td>âœ“ è‡ªåŠ¨</td><td>âœ“ æ‰‹åŠ¨è®¾ç½®</td><td>âœ“ è‡ªåŠ¨</td></tr><tr><td><strong>å…‰æ ‡å¤„ç†</strong></td><td>âœ“ è‡ªåŠ¨</td><td>âœ— éœ€æ‰‹åŠ¨</td><td>âœ“ è‡ªåŠ¨</td></tr><tr><td><strong>ä»£ç é‡</strong></td><td>~40è¡Œ</td><td>~60è¡Œ</td><td>~80è¡Œ</td></tr><tr><td><strong>æ¨èåº¦</strong></td><td>â­â­â­â­â­</td><td>â­â­â­</td><td>â­â­â­â­</td></tr></tbody></table>
<h4 data-id="heading-22">5.2 é€‰å‹å»ºè®®</h4>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">åœºæ™¯1: æ™®é€šæ•°å­—è¾“å…¥æ¡†</span>
  æ¨è: æ–¹æ¡ˆä¸€ï¼ˆInputConnectionæ‹¦æˆªï¼‰
  ç†ç”±: æ€§èƒ½æœ€ä¼˜ï¼Œä»£ç æœ€ç®€æ´

<span class="hljs-section">åœºæ™¯2: éœ€è¦è‡ªå®šä¹‰è¿‡æ»¤è§„åˆ™ï¼ˆå¦‚ç”µè¯å·ç ï¼šæ•°å­— + '-'ï¼‰</span>
  æ¨è: æ–¹æ¡ˆä¸‰ï¼ˆè‡ªå®šä¹‰Filter + InputConnectionï¼‰
  ç†ç”±: çµæ´»æ€§é«˜ï¼Œå¯è‡ªå®šä¹‰allowedå­—ç¬¦é›†

<span class="hljs-section">åœºæ™¯3: å¿«é€ŸåŸå‹å¼€å‘</span>
  æ¨è: æ–¹æ¡ˆäºŒï¼ˆTextWatcherï¼‰
  ç†ç”±: æœ€ç®€å•ï¼Œå¿«é€Ÿå®ç°

<span class="hljs-section">åœºæ™¯4: é«˜æ€§èƒ½è¦æ±‚ï¼ˆå¦‚å¤§é‡EditTextï¼‰</span>
  æ¨è: æ–¹æ¡ˆä¸€ï¼ˆInputConnectionæ‹¦æˆªï¼‰
  ç†ç”±: æ€§èƒ½å¼€é”€æœ€å°

<span class="hljs-section">åœºæ™¯5: å¤æ‚è¾“å…¥éªŒè¯ï¼ˆå¦‚é‡‘é¢ï¼šæ•°å­— + å°æ•°ç‚¹ï¼Œæœ€å¤š2ä½å°æ•°ï¼‰</span>
  æ¨è: æ–¹æ¡ˆä¸‰ï¼ˆè‡ªå®šä¹‰Filterï¼‰
  ç†ç”±: å¯ä»¥åœ¨filter()ä¸­å®ç°å¤æ‚è§„åˆ™
</code></pre>
<h4 data-id="heading-23">5.3 å®é™…é¡¹ç›®ä¸­çš„ä½¿ç”¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç¤ºä¾‹ï¼šé‡‘é¢è¾“å…¥æ¡†ï¼ˆå…è®¸æ•°å­—å’Œå°æ•°ç‚¹ï¼Œæœ€å¤š2ä½å°æ•°ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MoneyEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> InputConnection <span class="hljs-title function_">onCreateInputConnection</span><span class="hljs-params">(EditorInfo outAttrs)</span> {
        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.onCreateInputConnection(outAttrs);
        <span class="hljs-keyword">if</span> (base == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MoneyInputConnectionWrapper</span>(base, <span class="hljs-literal">true</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MoneyInputConnectionWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InputConnectionWrapper</span> {

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">MoneyInputConnectionWrapper</span><span class="hljs-params">(InputConnection target, <span class="hljs-type">boolean</span> mutable)</span> {
            <span class="hljs-built_in">super</span>(target, mutable);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ç¬¦åˆé‡‘é¢æ ¼å¼</span>
            <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span> &amp;&amp; !isValidMoneyInput(text)) {
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.finishComposingText();
            }
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
        }

        <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isValidMoneyInput</span><span class="hljs-params">(CharSequence text)</span> {
            <span class="hljs-comment">// å…è®¸ï¼šæ•°å­—ã€å°æ•°ç‚¹</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> text.toString();
            <span class="hljs-comment">// ç®€å•éªŒè¯ï¼šåªåŒ…å«[0-9.]</span>
            <span class="hljs-keyword">return</span> str.matches(<span class="hljs-string">"[0-9.]*"</span>);
        }
    }

    <span class="hljs-comment">// å¯ä»¥é…åˆInputFilteråšæ›´å¤æ‚çš„éªŒè¯ï¼ˆå¦‚æœ€å¤š2ä½å°æ•°ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MoneyInputFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InputFilter</span> {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> CharSequence <span class="hljs-title function_">filter</span><span class="hljs-params">(CharSequence source, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end,
                                   Spanned dest, <span class="hljs-type">int</span> dstart, <span class="hljs-type">int</span> dend)</span> {
            <span class="hljs-comment">// ç»„åˆåçš„å®Œæ•´æ–‡æœ¬</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">beforeInsert</span> <span class="hljs-operator">=</span> dest.subSequence(<span class="hljs-number">0</span>, dstart).toString();
            <span class="hljs-type">String</span> <span class="hljs-variable">afterInsert</span> <span class="hljs-operator">=</span> dest.subSequence(dend, dest.length()).toString();
            <span class="hljs-type">String</span> <span class="hljs-variable">newText</span> <span class="hljs-operator">=</span> beforeInsert + source.subSequence(start, end) + afterInsert;

            <span class="hljs-comment">// éªŒè¯ï¼šæœ€å¤šä¸€ä¸ªå°æ•°ç‚¹</span>
            <span class="hljs-keyword">if</span> (newText.indexOf(<span class="hljs-string">'.'</span>) != newText.lastIndexOf(<span class="hljs-string">'.'</span>)) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>; <span class="hljs-comment">// æ‹’ç»ï¼ˆå¤šä¸ªå°æ•°ç‚¹ï¼‰</span>
            }

            <span class="hljs-comment">// éªŒè¯ï¼šå°æ•°ç‚¹åæœ€å¤š2ä½</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">dotIndex</span> <span class="hljs-operator">=</span> newText.indexOf(<span class="hljs-string">'.'</span>);
            <span class="hljs-keyword">if</span> (dotIndex != -<span class="hljs-number">1</span> &amp;&amp; newText.length() - dotIndex &gt; <span class="hljs-number">3</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>; <span class="hljs-comment">// æ‹’ç»ï¼ˆè¶…è¿‡2ä½å°æ•°ï¼‰</span>
            }

            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// æ¥å—</span>
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-24">å…­ã€å·¥ç¨‹å®è·µçš„æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-25">6.1 æ€§èƒ½ç›‘æ§</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MonitoredNumberEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> InputConnection <span class="hljs-title function_">onCreateInputConnection</span><span class="hljs-params">(EditorInfo outAttrs)</span> {
        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.onCreateInputConnection(outAttrs);
        <span class="hljs-keyword">if</span> (base == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MonitoredInputConnectionWrapper</span>(base, <span class="hljs-literal">true</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MonitoredInputConnectionWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InputConnectionWrapper</span> {

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">MonitoredInputConnectionWrapper</span><span class="hljs-params">(InputConnection target, <span class="hljs-type">boolean</span> mutable)</span> {
            <span class="hljs-built_in">super</span>(target, mutable);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
            <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.nanoTime();

            <span class="hljs-type">boolean</span> result;
            <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span> &amp;&amp; containsNonDigit(text)) {
                result = <span class="hljs-built_in">super</span>.finishComposingText();
            } <span class="hljs-keyword">else</span> {
                result = <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
            }

            <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> System.nanoTime() - startTime;
            <span class="hljs-keyword">if</span> (duration &gt; <span class="hljs-number">1_000_000</span>) { <span class="hljs-comment">// è¶…è¿‡1ms</span>
                Log.w(<span class="hljs-string">"InputMonitor"</span>, <span class="hljs-string">"setComposingText slow: "</span> + duration / <span class="hljs-number">1_000_000.0</span> + <span class="hljs-string">"ms"</span>);
            }

            <span class="hljs-keyword">return</span> result;
        }

        <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsNonDigit</span><span class="hljs-params">(CharSequence text)</span> {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; text.length(); i++) {
                <span class="hljs-keyword">if</span> (!Character.isDigit(text.charAt(i))) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
}
</code></pre>
<h4 data-id="heading-26">6.2 æ—¥å¿—è°ƒè¯•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DebugNumberEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">"DebugNumberEditText"</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> InputConnection <span class="hljs-title function_">onCreateInputConnection</span><span class="hljs-params">(EditorInfo outAttrs)</span> {
        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.onCreateInputConnection(outAttrs);
        <span class="hljs-keyword">if</span> (base == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DebugInputConnectionWrapper</span>(base, <span class="hljs-literal">true</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DebugInputConnectionWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InputConnectionWrapper</span> {

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">DebugInputConnectionWrapper</span><span class="hljs-params">(InputConnection target, <span class="hljs-type">boolean</span> mutable)</span> {
            <span class="hljs-built_in">super</span>(target, mutable);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
            Log.d(TAG, <span class="hljs-string">"setComposingText: text='"</span> + text + <span class="hljs-string">"', cursor="</span> + newCursorPosition);

            <span class="hljs-type">boolean</span> <span class="hljs-variable">hasNonDigit</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; text.length(); i++) {
                    <span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> text.charAt(i);
                    <span class="hljs-keyword">if</span> (!Character.isDigit(c)) {
                        hasNonDigit = <span class="hljs-literal">true</span>;
                        Log.w(TAG, <span class="hljs-string">"  Detected non-digit: '"</span> + c + <span class="hljs-string">"' at index "</span> + i);
                    }
                }
            }

            <span class="hljs-type">boolean</span> result;
            <span class="hljs-keyword">if</span> (hasNonDigit) {
                Log.d(TAG, <span class="hljs-string">"  Action: finishComposingText() (rejecting non-digit input)"</span>);
                result = <span class="hljs-built_in">super</span>.finishComposingText();
            } <span class="hljs-keyword">else</span> {
                Log.d(TAG, <span class="hljs-string">"  Action: setComposingText() (accepting digit input)"</span>);
                result = <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
            }

            Log.d(TAG, <span class="hljs-string">"  Result: "</span> + result);
            <span class="hljs-keyword">return</span> result;
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">commitText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
            Log.d(TAG, <span class="hljs-string">"commitText: text='"</span> + text + <span class="hljs-string">"', cursor="</span> + newCursorPosition);
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.commitText(text, newCursorPosition);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">finishComposingText</span><span class="hljs-params">()</span> {
            Log.d(TAG, <span class="hljs-string">"finishComposingText"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.finishComposingText();
        }
    }
}
</code></pre>
<h4 data-id="heading-27">6.3 å•å…ƒæµ‹è¯•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RunWith(RobolectricTestRunner.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NumberEditTextTest</span> {

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDigitInput</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æµ‹è¯•æ­£å¸¸æ•°å­—è¾“å…¥</span>
        <span class="hljs-type">RecommendedNumberEditText</span> <span class="hljs-variable">editText</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RecommendedNumberEditText</span>(ApplicationProvider.getApplicationContext());
        editText.setText(<span class="hljs-string">"123"</span>);

        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">ic</span> <span class="hljs-operator">=</span> editText.onCreateInputConnection(<span class="hljs-keyword">new</span> <span class="hljs-title class_">EditorInfo</span>());
        ic.setComposingText(<span class="hljs-string">"456"</span>, <span class="hljs-number">1</span>);

        assertEquals(<span class="hljs-string">"123456"</span>, editText.getText().toString());
    }

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLetterInput</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æµ‹è¯•å­—æ¯è¾“å…¥ï¼ˆåº”è¯¥è¢«æ‹’ç»ï¼‰</span>
        <span class="hljs-type">RecommendedNumberEditText</span> <span class="hljs-variable">editText</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RecommendedNumberEditText</span>(ApplicationProvider.getApplicationContext());
        editText.setText(<span class="hljs-string">"123"</span>);

        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">ic</span> <span class="hljs-operator">=</span> editText.onCreateInputConnection(<span class="hljs-keyword">new</span> <span class="hljs-title class_">EditorInfo</span>());
        ic.setComposingText(<span class="hljs-string">"abc"</span>, <span class="hljs-number">1</span>);

        <span class="hljs-comment">// å†…å®¹ä¸åº”è¯¥å˜åŒ–</span>
        assertEquals(<span class="hljs-string">"123"</span>, editText.getText().toString());
    }

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testMixedInput</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æµ‹è¯•æ··åˆè¾“å…¥</span>
        <span class="hljs-type">RecommendedNumberEditText</span> <span class="hljs-variable">editText</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RecommendedNumberEditText</span>(ApplicationProvider.getApplicationContext());
        editText.setText(<span class="hljs-string">"123"</span>);

        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">ic</span> <span class="hljs-operator">=</span> editText.onCreateInputConnection(<span class="hljs-keyword">new</span> <span class="hljs-title class_">EditorInfo</span>());
        ic.setComposingText(<span class="hljs-string">"4a5"</span>, <span class="hljs-number">1</span>);

        <span class="hljs-comment">// åŒ…å«å­—æ¯ï¼Œåº”è¯¥è¢«æ‹’ç»</span>
        assertEquals(<span class="hljs-string">"123"</span>, editText.getText().toString());
    }
}
</code></pre>
<h4 data-id="heading-28">6.4 å…¼å®¹æ€§æµ‹è¯•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æµ‹è¯•ä¸åŒè¾“å…¥æ³•çš„å…¼å®¹æ€§
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IMECompatibilityTest</span> {

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testBaiduIME</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ¨¡æ‹Ÿç™¾åº¦è¾“å…¥æ³•çš„è¡Œä¸º</span>
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSogouIME</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ¨¡æ‹Ÿæœç‹—è¾“å…¥æ³•çš„è¡Œä¸º</span>
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGboard</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ¨¡æ‹ŸGoogle Gboardçš„è¡Œä¸º</span>
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-29">ä¸ƒã€å¸¸è§é—®é¢˜ä¸è§£ç­”</h3>
<h4 data-id="heading-30">7.1 ä¸ºä»€ä¹ˆä¸ç›´æ¥å»æ‰inputType="number"ï¼Ÿ</h4>
<p><strong>é—®é¢˜</strong>ï¼šå»æ‰inputTypeåï¼Œä¸ä¼šæœ‰Bugï¼Œä¸ºä»€ä¹ˆä¸è¿™æ ·åšï¼Ÿ</p>
<p><strong>è§£ç­”</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">å»æ‰ <span class="hljs-attr">inputType</span>=<span class="hljs-string">"number"</span> çš„åæœ:
1. å¼¹å‡ºå…¨é”®ç›˜ï¼ˆè€Œä¸æ˜¯æ•°å­—é”®ç›˜ï¼‰
2. ç”¨æˆ·ä½“éªŒå˜å·®ï¼ˆè¾“å…¥æ•°å­—éœ€è¦åˆ‡æ¢é”®ç›˜ï¼‰
3. æ— æ³•ä½¿ç”¨ç³»ç»Ÿçš„æ•°å­—é”®ç›˜ä¼˜åŒ–

ä¿ç•™ <span class="hljs-attr">inputType</span>=<span class="hljs-string">"number"</span> + InputConnectionæ‹¦æˆª:
1. ä¿ç•™æ•°å­—é”®ç›˜ï¼ˆç”¨æˆ·ä½“éªŒå¥½ï¼‰
2. é¿å…æ•°æ®ä¸¢å¤±ï¼ˆæŠ€æœ¯æ­£ç¡®ï¼‰
3. æœ€ä½³å®è·µ
</code></pre>
<h4 data-id="heading-31">7.2 ä¸ºä»€ä¹ˆè°ƒç”¨finishComposingText()ï¼Ÿ</h4>
<p><strong>é—®é¢˜</strong>ï¼šä¸ºä»€ä¹ˆä¸ç›´æ¥return falseï¼Ÿ</p>
<p><strong>è§£ç­”</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é”™è¯¯åšæ³•</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
    <span class="hljs-keyword">if</span> (containsNonDigit(text)) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// âœ— è¾“å…¥æ³•ä¼šè®¤ä¸ºå¤±è´¥ï¼Œå¯èƒ½é‡è¯•æˆ–æŠ¥é”™</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
}

<span class="hljs-comment">// æ­£ç¡®åšæ³•</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
    <span class="hljs-keyword">if</span> (containsNonDigit(text)) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.finishComposingText(); <span class="hljs-comment">// âœ“ å‘Šè¯‰è¾“å…¥æ³•"ç»„åˆå·²å®Œæˆ"</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
}
</code></pre>
<p><strong>åŸå› </strong>ï¼š</p>
<ul>
<li><code>finishComposingText()</code> æ˜¯åˆæ³•çš„æ“ä½œï¼Œè¾“å…¥æ³•ä¼šæ­£å¸¸å¤„ç†</li>
<li>è¿”å› <code>false</code> è¡¨ç¤ºæ“ä½œå¤±è´¥ï¼Œè¾“å…¥æ³•å¯èƒ½å‡ºç°å¼‚å¸¸è¡Œä¸º</li>
<li><code>finishComposingText()</code> ä¼šæ¸…é™¤COMPOSING Spanï¼Œé¿å…åç»­é—®é¢˜</li>
</ul>
<h4 data-id="heading-32">7.3 ä¸ºä»€ä¹ˆä¸ç”¨setFilterså®Œå…¨æ›¿ä»£ï¼Ÿ</h4>
<p><strong>é—®é¢˜</strong>ï¼šä¸ºä»€ä¹ˆä¸åªç”¨InputFilterï¼Œè¿˜è¦ç”¨InputConnectionï¼Ÿ</p>
<p><strong>è§£ç­”</strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">å•ç‹¬ä½¿ç”¨ InputFilter çš„é—®é¢˜:
<span class="hljs-bullet">1.</span> æ— æ³•é˜»æ­¢deleteæ“ä½œï¼ˆdeleteç»•è¿‡Filterï¼‰
<span class="hljs-bullet">2.</span> ä»ä¼šè§¦å‘Bug

å•ç‹¬ä½¿ç”¨ InputConnection çš„ä¼˜åŠ¿:
<span class="hljs-bullet">1.</span> æ‹¦æˆªæ—¶æœºæ—©ï¼ˆdeleteä¹‹å‰ï¼‰
<span class="hljs-bullet">2.</span> ä»æºå¤´è§£å†³é—®é¢˜

æœ€ä½³å®è·µ:
  InputConnectionæ‹¦æˆªä¸ºä¸»ï¼ˆæ–¹æ¡ˆä¸€ï¼‰
  æˆ– InputFilter + InputConnectionåŒé‡ä¿æŠ¤ï¼ˆæ–¹æ¡ˆä¸‰ï¼‰
</code></pre>
<h4 data-id="heading-33">7.4 å¦‚ä½•æ”¯æŒå°æ•°ç‚¹ï¼Ÿ</h4>
<p><strong>æ‰©å±•æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isValidNumberInput</span><span class="hljs-params">(CharSequence text)</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; text.length(); i++) {
        <span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> text.charAt(i);
        <span class="hljs-comment">// å…è®¸æ•°å­—å’Œå°æ•°ç‚¹</span>
        <span class="hljs-keyword">if</span> (!Character.isDigit(c) &amp;&amp; c != <span class="hljs-string">'.'</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
    <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span> &amp;&amp; !isValidNumberInput(text)) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.finishComposingText();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
}

<span class="hljs-comment">// åŒæ—¶è®¾ç½®inputType</span>
setInputType(InputType.TYPE_CLASS_NUMBER | InputType.TYPE_NUMBER_FLAG_DECIMAL);
</code></pre>
<hr/>
<h3 data-id="heading-34">å…«ã€æ€»ç»“ï¼šä»ç†è®ºåˆ°å®è·µçš„å®Œæ•´é“¾è·¯</h3>
<h4 data-id="heading-35">8.1 ä¸‰ç¯‡æ–‡ç« çš„çŸ¥è¯†é“¾</h4>
<pre><code class="hljs language-sql" lang="sql">ç¬¬ä¸€ç¯‡ï¼šBinderé€šä¿¡æœºåˆ¶
  â”œâ”€ ä¸‰è¿›ç¨‹æ¶æ„
  â”œâ”€ AIDLæ¥å£å®šä¹‰
  â”œâ”€ Stub<span class="hljs-operator">/</span>Proxyå®ç°
  â”œâ”€ çº¿ç¨‹åˆ‡æ¢
  â””â”€ ä¿¡æ¯ä¸å¯¹ç§°
       â†“ ä¸ºä»€ä¹ˆè¾“å…¥æ³•ä¸çŸ¥é“å®é™…ç»“æœ

ç¬¬äºŒç¯‡ï¼šæ–‡æœ¬ç¼–è¾‘è®¾è®¡ç¼ºé™·
  â”œâ”€ InputFilteræ¥å£å±€é™
  â”œâ”€ <span class="hljs-keyword">delete</span>ç»•è¿‡<span class="hljs-keyword">Filter</span>
  â”œâ”€ replaceTextå…ˆ<span class="hljs-keyword">delete</span>å<span class="hljs-keyword">insert</span>
  â”œâ”€ SpanèŒƒå›´å¼‚å¸¸æ‰©å±•
  â””â”€ ä¸å¯¹ç§°çš„æ§åˆ¶æƒ
       â†“ ä¸ºä»€ä¹ˆæ•°å­—ä¼šè¢«åˆ é™¤

ç¬¬ä¸‰ç¯‡ï¼ˆæœ¬æ–‡ï¼‰ï¼šå·¥ç¨‹è§£å†³æ–¹æ¡ˆ
  â”œâ”€ InputConnectionæ‹¦æˆªï¼ˆæ¨èï¼‰
  â”œâ”€ TextWatcherè¿‡æ»¤ï¼ˆç®€å•ï¼‰
  â”œâ”€ è‡ªå®šä¹‰InputFilterï¼ˆçµæ´»ï¼‰
  â”œâ”€ ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”
  â”œâ”€ é€‰å‹æŒ‡å—
  â”œâ”€ æœ€ä½³å®è·µ
  â””â”€ å®Œæ•´ä»£ç 
       â†“ å¦‚ä½•åœ¨å®é™…é¡¹ç›®ä¸­è§£å†³
</code></pre>
<h4 data-id="heading-36">8.2 æœ€ä½³å®è·µæ€»ç»“</h4>






























<table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ–¹æ¡ˆ</th><th>æ ¸å¿ƒä»£ç </th></tr></thead><tbody><tr><td><strong>æ™®é€šæ•°å­—è¾“å…¥</strong></td><td>InputConnectionæ‹¦æˆª</td><td><code>finishComposingText()</code></td></tr><tr><td><strong>è‡ªå®šä¹‰è§„åˆ™</strong></td><td>è‡ªå®šä¹‰Filter + IC</td><td><code>filter()</code> + <code>finishComposingText()</code></td></tr><tr><td><strong>å¿«é€Ÿå¼€å‘</strong></td><td>TextWatcher</td><td><code>afterTextChanged()</code> + <code>setText()</code></td></tr><tr><td><strong>é«˜æ€§èƒ½</strong></td><td>InputConnectionæ‹¦æˆª</td><td>é¿å…å¤šä½™æ“ä½œ</td></tr></tbody></table>
<h4 data-id="heading-37">8.3 æ ¸å¿ƒè¦ç‚¹</h4>
<pre><code class="hljs language-markdown" lang="markdown">å…³é”®è®¾è®¡å†³ç­–:
<span class="hljs-bullet">1.</span> ä¿ç•™ inputType="number" ï¼ˆæ•°å­—é”®ç›˜ï¼‰
<span class="hljs-bullet">2.</span> é‡å†™ onCreateInputConnection() ï¼ˆæ‹¦æˆªå…¥å£ï¼‰
<span class="hljs-bullet">3.</span> åŒ…è£… InputConnectionWrapper ï¼ˆæ‰©å±•åŠŸèƒ½ï¼‰
<span class="hljs-bullet">4.</span> æ‹¦æˆª setComposingText() ï¼ˆå…³é”®æ–¹æ³•ï¼‰
<span class="hljs-bullet">5.</span> è°ƒç”¨ finishComposingText() ï¼ˆæ­£ç¡®å¤„ç†ï¼‰

ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡:
<span class="hljs-bullet">1.</span> ç”¨æˆ·ä½“éªŒï¼šæ•°å­—é”®ç›˜æ›´æ–¹ä¾¿
<span class="hljs-bullet">2.</span> æ€§èƒ½ä¼˜åŒ–ï¼šæ‹¦æˆªæ—©ï¼Œå¼€é”€å°
<span class="hljs-bullet">3.</span> å…¼å®¹æ€§å¥½ï¼šå¯¹è¾“å…¥æ³•é€æ˜
<span class="hljs-bullet">4.</span> ä»£ç ç®€æ´ï¼šåªéœ€40è¡Œä»£ç 
<span class="hljs-bullet">5.</span> æ˜“äºç»´æŠ¤ï¼šé€»è¾‘æ¸…æ™°
</code></pre>
<h4 data-id="heading-38">8.4 å»¶ä¼¸åº”ç”¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¯ä»¥æ‰©å±•åˆ°å…¶ä»–åœºæ™¯:</span>

<span class="hljs-comment">// 1. æ‰‹æœºå·è¾“å…¥ï¼ˆæ•°å­— + ç©ºæ ¼/æ¨ªçº¿ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PhoneNumberEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// 2. é‚®ç®±è¾“å…¥ï¼ˆé™åˆ¶ç‰¹æ®Šå­—ç¬¦ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmailEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// 3. ç”¨æˆ·åè¾“å…¥ï¼ˆå­—æ¯ + æ•°å­— + ä¸‹åˆ’çº¿ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UsernameEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// 4. å¯†ç è¾“å…¥ï¼ˆå¢å¼ºå®‰å…¨ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurePasswordEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-39">ä¹ã€å®Œæ•´ç¤ºä¾‹é¡¹ç›®ç»“æ„</h3>
<pre><code class="hljs language-css" lang="css">app/<span class="hljs-attribute">src</span>/<span class="hljs-selector-tag">main</span>/java/com/yourpackage/
â”œâ”€ widget/
â”‚  â”œâ”€ RecommendedNumberEditText<span class="hljs-selector-class">.java</span>   â† æ–¹æ¡ˆä¸€ï¼ˆæ¨èï¼‰
â”‚  â”œâ”€ SimpleNumberEditText<span class="hljs-selector-class">.java</span>        â† æ–¹æ¡ˆäºŒ
â”‚  â”œâ”€ SafeNumberEditText<span class="hljs-selector-class">.java</span>          â† æ–¹æ¡ˆä¸‰
â”‚  â”œâ”€ MoneyEditText<span class="hljs-selector-class">.java</span>               â† æ‰©å±•ï¼šé‡‘é¢è¾“å…¥
â”‚  â”œâ”€ PhoneNumberEditText<span class="hljs-selector-class">.java</span>         â† æ‰©å±•ï¼šç”µè¯è¾“å…¥
â”‚  â””â”€ DebugNumberEditText<span class="hljs-selector-class">.java</span>         â† è°ƒè¯•ç‰ˆæœ¬
â”‚
â”œâ”€ utils/
â”‚  â””â”€ InputValidationUtils<span class="hljs-selector-class">.java</span>        â† é€šç”¨éªŒè¯å·¥å…·
â”‚
â””â”€ MainActivity<span class="hljs-selector-class">.java</span>

app/<span class="hljs-attribute">src</span>/<span class="hljs-selector-tag">main</span>/res/layout/
â””â”€ activity_main<span class="hljs-selector-class">.xml</span>

app/<span class="hljs-attribute">src</span>/test/java/com/yourpackage/
â””â”€ NumberEditTextTest<span class="hljs-selector-class">.java</span>             â† å•å…ƒæµ‹è¯•
</code></pre>
<hr/>
<h3 data-id="heading-40">å‚è€ƒèµ„æ–™</h3>
<ol>
<li>Androidæºç ï¼š<code>frameworks/base/core/java/android/view/inputmethod/InputConnectionWrapper.java</code></li>
<li>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fandroid%2Fview%2Finputmethod%2FInputConnectionWrapper" target="_blank" title="https://developer.android.com/reference/android/view/inputmethod/InputConnectionWrapper" ref="nofollow noopener noreferrer">InputConnectionWrapper</a></li>
<li>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fandroid%2Fview%2Finputmethod%2FInputConnection" target="_blank" title="https://developer.android.com/reference/android/view/inputmethod/InputConnection" ref="nofollow noopener noreferrer">InputConnection</a></li>
<li>æœ¬ç³»åˆ—å‰ä¸¤ç¯‡ï¼š
<ul>
<li>ç¬¬ä¸€ç¯‡ï¼šã€ŠAndroidè¾“å…¥æ³•æ¡†æ¶çš„Binderé€šä¿¡æœºåˆ¶å‰–æã€‹</li>
<li>ç¬¬äºŒç¯‡ï¼šã€Šä»ä¸€ä¸ªBugçœ‹Androidæ–‡æœ¬ç¼–è¾‘çš„è®¾è®¡ç¼ºé™·ã€‹</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-41">é™„å½•ï¼šå®Œæ•´å¯è¿è¡Œçš„ç¤ºä¾‹ä»£ç </h3>
<p><strong>RecommendedNumberEditText.java</strong>ï¼ˆç›´æ¥å¤åˆ¶å¯ç”¨ï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.yourpackage.widget;

<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.util.AttributeSet;
<span class="hljs-keyword">import</span> android.view.inputmethod.EditorInfo;
<span class="hljs-keyword">import</span> android.view.inputmethod.InputConnection;
<span class="hljs-keyword">import</span> android.view.inputmethod.InputConnectionWrapper;
<span class="hljs-keyword">import</span> androidx.appcompat.widget.AppCompatEditText;

<span class="hljs-comment">/**
 * æ¨èçš„æ•°å­—è¾“å…¥æ¡†å®ç°
 * è§£å†³ inputType="number" æ—¶ï¼Œåˆ‡æ¢å­—æ¯é”®ç›˜å¯¼è‡´æ•°å­—ä¸¢å¤±çš„é—®é¢˜
 *
 * ä½¿ç”¨æ–¹æ³•:
 * &lt;com.yourpackage.widget.RecommendedNumberEditText
 *     android:inputType="number"
 *     ... /&gt;
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RecommendedNumberEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RecommendedNumberEditText</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-built_in">super</span>(context);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RecommendedNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs)</span> {
        <span class="hljs-built_in">super</span>(context, attrs);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RecommendedNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> {
        <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> InputConnection <span class="hljs-title function_">onCreateInputConnection</span><span class="hljs-params">(EditorInfo outAttrs)</span> {
        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.onCreateInputConnection(outAttrs);
        <span class="hljs-keyword">if</span> (base == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NumberInputConnectionWrapper</span>(base, <span class="hljs-literal">true</span>);
    }

    <span class="hljs-comment">/**
     * è‡ªå®šä¹‰InputConnectionåŒ…è£…ç±»
     * æ‹¦æˆªsetComposingTextï¼Œæ£€æŸ¥æ˜¯å¦åŒ…å«éæ•°å­—å­—ç¬¦
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NumberInputConnectionWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InputConnectionWrapper</span> {

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">NumberInputConnectionWrapper</span><span class="hljs-params">(InputConnection target, <span class="hljs-type">boolean</span> mutable)</span> {
            <span class="hljs-built_in">super</span>(target, mutable);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
            <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span> &amp;&amp; containsNonDigit(text)) {
                <span class="hljs-comment">// åŒ…å«éæ•°å­—å­—ç¬¦ï¼Œç›´æ¥å®Œæˆç»„åˆï¼ˆä¸æ‰§è¡Œdelete-insertï¼‰</span>
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.finishComposingText();
            }
            <span class="hljs-comment">// çº¯æ•°å­—æˆ–nullï¼Œæ­£å¸¸å¤„ç†</span>
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
        }

        <span class="hljs-comment">/**
         * æ£€æŸ¥æ˜¯å¦åŒ…å«éæ•°å­—å­—ç¬¦
         */</span>
        <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsNonDigit</span><span class="hljs-params">(CharSequence text)</span> {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; text.length(); i++) {
                <span class="hljs-keyword">if</span> (!Character.isDigit(text.charAt(i))) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
}
</code></pre>
<p><strong>activity_main.xml</strong>ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span>
    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span>
    <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">"vertical"</span>
    <span class="hljs-attr">android:padding</span>=<span class="hljs-string">"16dp"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span>
        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"æ¨èæ–¹æ¡ˆï¼ˆInputConnectionæ‹¦æˆªï¼‰ï¼š"</span>
        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"16sp"</span>
        <span class="hljs-attr">android:textStyle</span>=<span class="hljs-string">"bold"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">com.yourpackage.widget.RecommendedNumberEditText</span>
        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/edit_recommended"</span>
        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span>
        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:hint</span>=<span class="hljs-string">"è¯·è¾“å…¥æ•°å­—"</span>
        <span class="hljs-attr">android:inputType</span>=<span class="hljs-string">"number"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span>
        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_marginTop</span>=<span class="hljs-string">"24dp"</span>
        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"æµ‹è¯•è¯´æ˜ï¼š"</span>
        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"14sp"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span>
        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_marginTop</span>=<span class="hljs-string">"8dp"</span>
        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"1. è¾“å…¥æ•°å­— 123456\n2. åˆ‡æ¢åˆ°å­—æ¯é”®ç›˜\n3. è¿ç»­ç‚¹å‡»å­—æ¯ 'q'\n4. æ•°å­—ä¸ä¼šè¢«åˆ é™¤ âœ“"</span>
        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"12sp"</span> /&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span>
</code></pre>
<hr/>
<p><strong>ç³»åˆ—å®Œç»“</strong>ã€‚ä»Binderé€šä¿¡æœºåˆ¶ï¼Œåˆ°æ–‡æœ¬ç¼–è¾‘è®¾è®¡ç¼ºé™·ï¼Œå†åˆ°å®Œæ•´çš„å·¥ç¨‹è§£å†³æ–¹æ¡ˆï¼Œå¸Œæœ›è¿™ä¸‰ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ æ·±å…¥ç†è§£Androidè¾“å…¥æ³•æ¡†æ¶ï¼Œå¹¶åœ¨å®é™…é¡¹ç›®ä¸­æ¸¸åˆƒæœ‰ä½™åœ°è§£å†³ç±»ä¼¼é—®é¢˜ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[FastAPI Ã— SQLAlchemy 2.0 Asyncï¼šä»â€œèƒ½è·‘â€åˆ°â€œå¯å‹æµ‹â€çš„å®Œæ•´å·¥ç¨‹å®è·µ]]></title>    <link>https://juejin.cn/post/7570903763722289162</link>    <guid>https://juejin.cn/post/7570903763722289162</guid>    <pubDate>2025-11-10T15:02:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570903763722289162" data-draft-id="7570897638441238555" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="FastAPI Ã— SQLAlchemy 2.0 Asyncï¼šä»â€œèƒ½è·‘â€åˆ°â€œå¯å‹æµ‹â€çš„å®Œæ•´å·¥ç¨‹å®è·µ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-10T15:02:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaç§æ•™"/> <meta itemprop="url" content="https://juejin.cn/user/3394924618197325"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            FastAPI Ã— SQLAlchemy 2.0 Asyncï¼šä»â€œèƒ½è·‘â€åˆ°â€œå¯å‹æµ‹â€çš„å®Œæ•´å·¥ç¨‹å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3394924618197325/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaç§æ•™
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T15:02:02.000Z" title="Mon Nov 10 2025 15:02:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    16
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ä¸€å¥è¯æ€»ç»“<br/>
ç”¨ <strong>SQLAlchemy 2.0 AsyncIO</strong> æ¨¡å¼ï¼ŒæŠŠ FastAPI çš„å¹¶å‘ä¼˜åŠ¿å…‘ç°æˆ <strong>çœŸæ­£çš„æ•°æ®åº“åå</strong>ï¼›å†å ä¸Šè¿æ¥æ± ã€äº‹åŠ¡ã€è¿ç§»ã€æµ‹è¯•å››ä»¶å¥—ï¼Œ<strong>ç›´æ¥ä¸Šçº¿ä¸è¸©å‘</strong>ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">1. ä¸ºä»€ä¹ˆè¦â€œå¼‚æ­¥ ORMâ€ï¼Ÿ</h2>

























<table><thead><tr><th>åœºæ™¯</th><th>åŒæ­¥ SQLAlchemy</th><th>å¼‚æ­¥ SQLAlchemy</th></tr></thead><tbody><tr><td>100 ä¸ªå¹¶å‘ä¸Šä¼ </td><td>å¼€ 100 çº¿ç¨‹ â†’ 100 ä¸ªè¿æ¥ â†’ DB è¢«æ‰“çˆ†</td><td>å•çº¿ç¨‹ 20 è¿æ¥å³å¯è·‘æ»¡ CPU</td></tr><tr><td>è¯·æ±‚ç­‰å¾… I/O</td><td>çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ 8 ms</td><td>åç¨‹åˆ‡æ¢ 0.3 ms</td></tr><tr><td>ä»£ç é£æ ¼</td><td>åˆ°å¤„ <code>run_in_threadpool</code></td><td>åŸç”Ÿ <code>await</code> ä¸€è·¯åˆ°åº•</td></tr></tbody></table>
<blockquote>
<p>ä¸€å¥è¯ï¼š<strong>åŒæ­¥æ¨¡å¼æŠŠ FastAPI çš„å¼‚æ­¥äº‹ä»¶å¾ªç¯æ‹–å›è§£æ”¾å‰</strong>ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">2. æœ€å°å¯è¿è¡Œç‰ˆæœ¬ï¼ˆMVPï¼‰</h2>
<p><strong>å®‰è£…ä¾èµ–</strong></p>
<pre><code class="hljs language-bash" lang="bash">pip install <span class="hljs-string">"fastapi[all]"</span> \
            <span class="hljs-string">"sqlalchemy[asyncio]&gt;=2.0"</span> \
            asyncpg alembic pydantic[email]
</code></pre>
<blockquote>
<p>æ•°æ®åº“ä»¥ PostgreSQL ä¸ºä¾‹ï¼ŒMySQL æ¢æˆ <code>asyncmy</code> å³å¯ã€‚</p>
</blockquote>
<p><strong>é¡¹ç›®éª¨æ¶</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">app/
 â”œâ”€ api/
 â”‚   â””â”€ user.py
 â”œâ”€ core/
 â”‚   â”œâ”€ db.py
 â”‚   â””â”€ config.py
 â”œâ”€ models/
 â”‚   â””â”€ user.py
 â”œâ”€ schemas/
 â”‚   â””â”€ user.py
 â””â”€ main.py
</code></pre>
<hr/>
<h2 data-id="heading-2">3. æ ¸å¿ƒä»£ç ï¼šSession ç”Ÿå‘½å‘¨æœŸä¸€æ¡é¾™</h2>
<p><strong>app/core/config.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseSettings

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Settings</span>(<span class="hljs-title class_ inherited__">BaseSettings</span>):
    database_url: <span class="hljs-built_in">str</span> = <span class="hljs-string">"postgresql+asyncpg://user:pass@localhost:5432/demo"</span>
    pool_size: <span class="hljs-built_in">int</span> = <span class="hljs-number">20</span>
    max_overflow: <span class="hljs-built_in">int</span> = <span class="hljs-number">0</span>
    echo_sql: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>

    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:
        env_file = <span class="hljs-string">".env"</span>

settings = Settings()
</code></pre>
<p><strong>app/core/db.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sqlalchemy.ext.asyncio <span class="hljs-keyword">import</span> (
    AsyncEngine, AsyncSession, async_sessionmaker, create_async_engine
)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncDatabaseSession</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, url: <span class="hljs-built_in">str</span>, *, pool_size: <span class="hljs-built_in">int</span> = <span class="hljs-number">20</span>, max_overflow: <span class="hljs-built_in">int</span> = <span class="hljs-number">0</span>, echo: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span></span>):
        self.engine: AsyncEngine = create_async_engine(
            url,
            pool_size=pool_size,
            max_overflow=max_overflow,
            echo=echo,
            pool_pre_ping=<span class="hljs-literal">True</span>,          <span class="hljs-comment"># å¿ƒè·³ä¿æ´»</span>
        )
        self.session_factory = async_sessionmaker(
            self.engine,
            expire_on_commit=<span class="hljs-literal">False</span>,      <span class="hljs-comment"># é˜²æ­¢æ‡’åŠ è½½å¼‚å¸¸</span>
            class_=AsyncSession,
        )

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">close</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">await</span> self.engine.dispose()

db = AsyncDatabaseSession(
    settings.database_url,
    pool_size=settings.pool_size,
    echo=settings.echo_sql,
)
</code></pre>
<p><strong>main.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI
<span class="hljs-keyword">from</span> app.core.db <span class="hljs-keyword">import</span> db
<span class="hljs-keyword">from</span> app.api <span class="hljs-keyword">import</span> user

app = FastAPI(title=<span class="hljs-string">"Async SQLAlchemy Demo"</span>)

app.include_router(user.router)

<span class="hljs-meta">@app.on_event(<span class="hljs-params"><span class="hljs-string">"startup"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">startup</span>():
    <span class="hljs-comment"># å¯é€‰ï¼šå»ºè¡¨</span>
    <span class="hljs-comment"># from app.models import Base</span>
    <span class="hljs-comment"># async with db.engine.begin() as conn:</span>
    <span class="hljs-comment">#     await conn.run_sync(Base.metadata.create_all)</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-meta">@app.on_event(<span class="hljs-params"><span class="hljs-string">"shutdown"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">shutdown</span>():
    <span class="hljs-keyword">await</span> db.close()
</code></pre>
<hr/>
<h2 data-id="heading-3">4. ä¾èµ–æ³¨å…¥ï¼šæ¯æ¬¡è¯·æ±‚ä¸€ä¸ª Sessionï¼Œè‡ªåŠ¨å›æ»š</h2>
<p><strong>app/core/deps.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> AsyncGenerator
<span class="hljs-keyword">from</span> app.core.db <span class="hljs-keyword">import</span> db
<span class="hljs-keyword">from</span> sqlalchemy.ext.asyncio <span class="hljs-keyword">import</span> AsyncSession
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Depends

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_session</span>() -&gt; AsyncGenerator[AsyncSession, <span class="hljs-literal">None</span>]:
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> db.session_factory() <span class="hljs-keyword">as</span> session:
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">yield</span> session
        <span class="hljs-keyword">except</span> Exception:
            <span class="hljs-keyword">await</span> session.rollback()
            <span class="hljs-keyword">raise</span>
        <span class="hljs-keyword">finally</span>:
            <span class="hljs-keyword">await</span> session.close()
</code></pre>
<blockquote>
<p>ç”¨ <code>yield</code> + <code>rollback</code> ä¿è¯<strong>è¯·æ±‚çº§äº‹åŠ¡</strong>ï¼›æŠ›å¼‚å¸¸è‡ªåŠ¨å›æ»šï¼Œæ­£å¸¸åˆ™ commitã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">5. Model / Schema / CRUD ä¸€æ¡é¾™</h2>
<p><strong>app/models/user.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> String
<span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> DeclarativeBase, Mapped, mapped_column

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span>(<span class="hljs-title class_ inherited__">DeclarativeBase</span>):
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">Base</span>):
    __tablename__ = <span class="hljs-string">"users"</span>

    <span class="hljs-built_in">id</span>: Mapped[<span class="hljs-built_in">int</span>] = mapped_column(primary_key=<span class="hljs-literal">True</span>, index=<span class="hljs-literal">True</span>)
    email: Mapped[<span class="hljs-built_in">str</span>] = mapped_column(String(<span class="hljs-number">320</span>), unique=<span class="hljs-literal">True</span>, index=<span class="hljs-literal">True</span>)
    full_name: Mapped[<span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span>]
</code></pre>
<p><strong>app/schemas/user.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, EmailStr

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserCreate</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    email: EmailStr
    full_name: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRead</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span>
    email: EmailStr
    full_name: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span>

    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:
        orm_mode = <span class="hljs-literal">True</span>
</code></pre>
<p><strong>app/api/user.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> APIRouter, Depends, HTTPException
<span class="hljs-keyword">from</span> sqlalchemy.ext.asyncio <span class="hljs-keyword">import</span> AsyncSession
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> select
<span class="hljs-keyword">from</span> app.models <span class="hljs-keyword">import</span> User
<span class="hljs-keyword">from</span> app.schemas <span class="hljs-keyword">import</span> UserCreate, UserRead
<span class="hljs-keyword">from</span> app.core.deps <span class="hljs-keyword">import</span> get_session

router = APIRouter(prefix=<span class="hljs-string">"/users"</span>, tags=[<span class="hljs-string">"users"</span>])

<span class="hljs-meta">@router.post(<span class="hljs-params"><span class="hljs-string">""</span>, response_model=UserRead</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_user</span>(<span class="hljs-params">payload: UserCreate, session: AsyncSession = Depends(<span class="hljs-params">get_session</span>)</span>):
    user = User(**payload.<span class="hljs-built_in">dict</span>())
    session.add(user)
    <span class="hljs-keyword">await</span> session.flush()          <span class="hljs-comment"># è·å– id</span>
    <span class="hljs-keyword">await</span> session.commit()
    <span class="hljs-keyword">await</span> session.refresh(user)
    <span class="hljs-keyword">return</span> user

<span class="hljs-meta">@router.get(<span class="hljs-params"><span class="hljs-string">"/{uid}"</span>, response_model=UserRead</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_user</span>(<span class="hljs-params">uid: <span class="hljs-built_in">int</span>, session: AsyncSession = Depends(<span class="hljs-params">get_session</span>)</span>):
    user = <span class="hljs-keyword">await</span> session.get(User, uid)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> user:
        <span class="hljs-keyword">raise</span> HTTPException(<span class="hljs-number">404</span>, <span class="hljs-string">"User not found"</span>)
    <span class="hljs-keyword">return</span> user
</code></pre>
<hr/>
<h2 data-id="heading-5">6. è¿ç§»ï¼šAlembic åŒæ ·èƒ½å¼‚æ­¥</h2>
<p><strong>åˆå§‹åŒ–</strong></p>
<pre><code class="hljs language-bash" lang="bash">alembic init -t async migrations
</code></pre>
<p><strong>ä¿®æ”¹ <code>alembic.ini</code> ä¸­çš„ <code>sqlalchemy.url</code> ä¸º <code>postgresql+asyncpg://...</code></strong></p>
<p><strong>migrations/env.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> app.core.config <span class="hljs-keyword">import</span> settings
<span class="hljs-keyword">from</span> app.models <span class="hljs-keyword">import</span> Base
target_metadata = Base.metadata

<span class="hljs-keyword">def</span> <span class="hljs-title function_">do_run_migrations</span>(<span class="hljs-params">connection</span>):
    context.configure(connection=connection, target_metadata=target_metadata)
    <span class="hljs-keyword">with</span> context.begin_transaction():
        context.run_migrations()

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_async_migrations</span>():
    <span class="hljs-keyword">from</span> sqlalchemy.ext.asyncio <span class="hljs-keyword">import</span> AsyncEngine
    connectable = AsyncEngine(create_async_engine(settings.database_url))
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> connectable.connect() <span class="hljs-keyword">as</span> connection:
        <span class="hljs-keyword">await</span> connection.run_sync(do_run_migrations)
    <span class="hljs-keyword">await</span> connectable.dispose()
</code></pre>
<p><strong>ç”Ÿæˆ / å‡çº§</strong></p>
<pre><code class="hljs language-bash" lang="bash">alembic revision --autogenerate -m <span class="hljs-string">"init"</span>
alembic upgrade <span class="hljs-built_in">head</span>
</code></pre>
<hr/>
<h2 data-id="heading-6">7. æµ‹è¯•ï¼špytest-asyncio + å¼‚æ­¥æ•°æ®åº“äº‹åŠ¡</h2>
<p><strong>tests/conftest.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pytest
<span class="hljs-keyword">from</span> httpx <span class="hljs-keyword">import</span> AsyncClient
<span class="hljs-keyword">from</span> app.main <span class="hljs-keyword">import</span> app
<span class="hljs-keyword">from</span> app.core.db <span class="hljs-keyword">import</span> db <span class="hljs-keyword">as</span> db_instance
<span class="hljs-keyword">from</span> sqlalchemy.pool <span class="hljs-keyword">import</span> StaticPool
<span class="hljs-keyword">from</span> sqlalchemy.ext.asyncio <span class="hljs-keyword">import</span> AsyncEngine, create_async_engine

<span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">"session"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">engine</span>() -&gt; AsyncEngine:
    <span class="hljs-comment"># å†…å­˜ SQLite ä¹Ÿå¯ä»¥å¼‚æ­¥ï¼Œä½† PostgreSQL æ›´çœŸå®</span>
    engine = create_async_engine(
        <span class="hljs-string">"postgresql+asyncpg://test:test@localhost:5432/test"</span>,
        poolclass=StaticPool,
    )
    <span class="hljs-keyword">yield</span> engine
    <span class="hljs-keyword">await</span> engine.dispose()

<span class="hljs-meta">@pytest.fixture</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">session</span>(<span class="hljs-params">engine: AsyncEngine</span>):
    conn = <span class="hljs-keyword">await</span> engine.begin()
    sess = db_instance.session_factory(bind=conn)
    <span class="hljs-keyword">yield</span> sess
    <span class="hljs-keyword">await</span> sess.close()
    <span class="hljs-keyword">await</span> conn.rollback()
    <span class="hljs-keyword">await</span> conn.close()

<span class="hljs-meta">@pytest.fixture</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">client</span>() -&gt; AsyncGenerator[AsyncClient, <span class="hljs-literal">None</span>]:
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> AsyncClient(app=app, base_url=<span class="hljs-string">"http://test"</span>) <span class="hljs-keyword">as</span> c:
        <span class="hljs-keyword">yield</span> c
</code></pre>
<p><strong>tests/test_user.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pytest
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> select
<span class="hljs-keyword">from</span> app.models <span class="hljs-keyword">import</span> User

<span class="hljs-meta">@pytest.mark.asyncio</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_create_user</span>(<span class="hljs-params">client, session</span>):
    res = <span class="hljs-keyword">await</span> client.post(<span class="hljs-string">"/users"</span>, json={<span class="hljs-string">"email"</span>: <span class="hljs-string">"a@b.com"</span>, <span class="hljs-string">"full_name"</span>: <span class="hljs-string">"abc"</span>})
    <span class="hljs-keyword">assert</span> res.status_code == <span class="hljs-number">201</span>
    data = res.json()
    <span class="hljs-keyword">assert</span> data[<span class="hljs-string">"email"</span>] == <span class="hljs-string">"a@b.com"</span>

    user = <span class="hljs-keyword">await</span> session.get(User, data[<span class="hljs-string">"id"</span>])
    <span class="hljs-keyword">assert</span> user <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>
</code></pre>
<hr/>
<h2 data-id="heading-7">8. æ€§èƒ½è°ƒä¼˜ checklist</h2>



































<table><thead><tr><th>å‚æ•°</th><th>å»ºè®®å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>pool_size</code></td><td>CPU æ ¸å¿ƒ Ã— 2</td><td>20 å¹¶å‘å·²èƒ½å‹åˆ° 10k RPS</td></tr><tr><td><code>max_overflow</code></td><td>0</td><td>é˜²æ­¢çªå‘è¿æ¥æ‰“çˆ† DB</td></tr><tr><td><code>pool_pre_ping=True</code></td><td>å¿…é¡»</td><td>ç½‘ç»œé—ªæ–­åè‡ªåŠ¨é‡è¿</td></tr><tr><td><code>expire_on_commit=False</code></td><td>å¿…é¡»</td><td>å¦åˆ™ commit åå±æ€§å¤±æ•ˆ</td></tr><tr><td><code>echo=False</code></td><td>ç”Ÿäº§å…³é—­</td><td>å‡å°‘åºåˆ—åŒ–å¼€é”€</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-8">9. å¸¸è§é”™è¯¯é€ŸæŸ¥è¡¨</h2>






























<table><thead><tr><th>å¼‚å¸¸</th><th>åŸå› </th><th>è§£æ³•</th></tr></thead><tbody><tr><td><code>greenlet_spawn has not been called</code></td><td>ç”¨äº†åŒæ­¥å¼•æ“</td><td><code>create_async_engine</code></td></tr><tr><td><code>DetachedInstanceError</code></td><td>ä¼šè¯å…³é—­åè®¿é—®å±æ€§</td><td><code>expire_on_commit=False</code> + <code>await session.refresh()</code></td></tr><tr><td><code>InterfaceError: connection already closed</code></td><td>åç¨‹é—´å¤ç”¨ Session</td><td>ä¸€ä¸ªè¯·æ±‚ä¸€ä¸ª Sessionï¼Œç¦æ­¢å…¨å±€å•ä¾‹</td></tr><tr><td><code>ImportError: asyncmy</code></td><td>MySQL é©±åŠ¨æœªè£…</td><td><code>pip install asyncmy</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-9">10. ç»“è¯­</h2>
<p>FastAPI çš„å¼‚æ­¥ç”Ÿæ€é‡Œï¼Œ<strong>æ•°æ®åº“æ˜¯æœ€åä¸€é“é—¸é—¨</strong>ã€‚<br/>
ç”¨ä¸Š SQLAlchemy 2.0 AsyncIO ä¹‹åï¼Œ<strong>I/O ç­‰å¾…ä¸å†æ˜¯ç“¶é¢ˆ</strong>ï¼Œå‹æµ‹æ›²çº¿ç›´æ¥å¤šä¸€ä¸ªé‡çº§ã€‚<br/>
æŠŠæœ¬æ–‡çš„ <code>db.py</code> + <code>deps.py</code> å¤åˆ¶èµ°ï¼Œ<strong>10 åˆ†é’Ÿå°±èƒ½è®©è€é¡¹ç›®åŸåœ°èµ·é£</strong>ã€‚Happy async coding!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js å¼€å‘ç¯å¢ƒæ­å»ºå…¨æ”»ç•¥ï¼ˆ2025ç‰ˆï¼‰]]></title>    <link>https://juejin.cn/post/7571338749197090866</link>    <guid>https://juejin.cn/post/7571338749197090866</guid>    <pubDate>2025-11-11T11:49:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571338749197090866" data-draft-id="7571191453126770714" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js å¼€å‘ç¯å¢ƒæ­å»ºå…¨æ”»ç•¥ï¼ˆ2025ç‰ˆï¼‰"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-11-11T11:49:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaç§æ•™"/> <meta itemprop="url" content="https://juejin.cn/user/3394924618197325"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js å¼€å‘ç¯å¢ƒæ­å»ºå…¨æ”»ç•¥ï¼ˆ2025ç‰ˆï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3394924618197325/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaç§æ•™
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T11:49:56.000Z" title="Tue Nov 11 2025 11:49:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨æœ¬åœ°æ­å»ºä¸€ä¸ªé«˜æ•ˆã€å¯ç»´æŠ¤çš„ Node.js å¼€å‘ç¯å¢ƒï¼Œé€‚ç”¨äº Windowsã€macOS ä¸ Linuxã€‚æ— è®ºä½ æ˜¯åç«¯æ–°æ‰‹è¿˜æ˜¯èµ„æ·±å…¨æ ˆå·¥ç¨‹å¸ˆï¼Œéƒ½èƒ½é€šè¿‡æœ¬æ–‡å¿«é€Ÿæ„å»ºä¸€ä¸ªæ ‡å‡†åŒ–çš„ Node.js å¼€å‘ç¯å¢ƒã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ä»€ä¹ˆæ˜¯ Node.jsï¼Ÿ</h2>
<p><strong>Node.js</strong> æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ï¼Œå®ƒè®©å¼€å‘è€…å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚
å®ƒä»¥ <strong>äº‹ä»¶é©±åŠ¨ã€éé˜»å¡ I/O</strong> çš„ç‰¹æ€§è‘—ç§°ï¼Œéå¸¸é€‚åˆæ„å»ºé«˜æ€§èƒ½çš„ Web æœåŠ¡å’Œå¾®æœåŠ¡æ¶æ„ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€å®‰è£… Node.js</h2>
<h3 data-id="heading-2">1. ä½¿ç”¨å®˜æ–¹å®‰è£…åŒ…ï¼ˆé€‚åˆåˆå­¦è€…ï¼‰</h3>
<p>è®¿é—® <a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2F" target="_blank" title="https://nodejs.org/" ref="nofollow noopener noreferrer">Node.js å®˜æ–¹ç½‘ç«™</a>
ä½ ä¼šçœ‹åˆ°ä¸¤ä¸ªç‰ˆæœ¬ï¼š</p>
<ul>
<li><strong>LTSï¼ˆé•¿æœŸæ”¯æŒç‰ˆï¼‰</strong>ï¼šç¨³å®šå¯é ï¼Œæ¨èç”Ÿäº§ç¯å¢ƒä½¿ç”¨</li>
<li><strong>Currentï¼ˆæœ€æ–°åŠŸèƒ½ç‰ˆï¼‰</strong>ï¼šåŒ…å«æœ€æ–°ç‰¹æ€§ï¼Œé€‚åˆå°é²œæˆ–æµ‹è¯•</li>
</ul>
<p>ä¸‹è½½å¹¶è¿è¡Œå¯¹åº”æ“ä½œç³»ç»Ÿçš„å®‰è£…åŒ…åï¼Œå‘½ä»¤è¡Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤éªŒè¯å®‰è£…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">node -v
npm -v
</code></pre>
<p>ä½ åº”èƒ½çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š</p>
<pre><code class="hljs">v20.18.1
10.5.2
</code></pre>
<hr/>
<h3 data-id="heading-3">2. ä½¿ç”¨ Node ç‰ˆæœ¬ç®¡ç†å™¨ï¼ˆæ¨èï¼‰</h3>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œ<strong>ä¸åŒé¡¹ç›®å¯èƒ½ä¾èµ–ä¸åŒç‰ˆæœ¬çš„ Node.js</strong>ã€‚
å› æ­¤æ¨èä½¿ç”¨ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œå¦‚ï¼š</p>
<h4 data-id="heading-4">macOS / Linuxï¼š</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£… nvmï¼ˆNode Version Managerï¼‰</span>
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/master/install.sh | bash

<span class="hljs-comment"># è½½å…¥é…ç½®</span>
<span class="hljs-built_in">source</span> ~/.bashrc  <span class="hljs-comment"># æˆ– ~/.zshrc</span>

<span class="hljs-comment"># å®‰è£…å¹¶ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬</span>
nvm install 20
nvm use 20
</code></pre>
<h4 data-id="heading-5">Windowsï¼š</h4>
<p>ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcoreybutler%2Fnvm-windows" target="_blank" title="https://github.com/coreybutler/nvm-windows" ref="nofollow noopener noreferrer">nvm-windows</a>ï¼š</p>
<pre><code class="hljs language-powershell" lang="powershell">nvm install 20.18.1
nvm use 20.18.1
</code></pre>
<p>éªŒè¯ç‰ˆæœ¬ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">node -v
nvm list
</code></pre>
<p>âœ… <strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>å¤šç‰ˆæœ¬ Node å…±å­˜</li>
<li>å¿«é€Ÿåˆ‡æ¢é¡¹ç›®ç¯å¢ƒ</li>
<li>æ›´æ˜“äº CI/CD é›†æˆ</li>
</ul>
<hr/>
<h2 data-id="heading-6">ä¸‰ã€é…ç½® npmï¼ˆåŒ…ç®¡ç†å·¥å…·ï¼‰</h2>
<p>Node.js è‡ªå¸¦çš„ <strong>npm</strong> æ˜¯ JavaScript ç”Ÿæ€çš„æ ¸å¿ƒåŒ…ç®¡ç†å™¨ã€‚</p>
<h3 data-id="heading-7">å¸¸è§é…ç½®ï¼š</h3>
<h4 data-id="heading-8">1. ä¿®æ”¹å…¨å±€é•œåƒæºï¼ˆåŠ é€Ÿå®‰è£…ï¼‰</h4>
<p>é»˜è®¤æºåœ¨å›½å¤–ï¼Œå®‰è£…é€Ÿåº¦è¾ƒæ…¢ï¼Œå¯ä»¥æ”¹ä¸ºå›½å†…é•œåƒï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm config <span class="hljs-built_in">set</span> registry https://registry.npmmirror.com
</code></pre>
<p>æŸ¥çœ‹æ˜¯å¦æˆåŠŸï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm config get registry
</code></pre>
<h4 data-id="heading-9">2. å®‰è£…å…¨å±€å·¥å…·</h4>
<pre><code class="hljs language-bash" lang="bash">npm install -g yarn pnpm nodemon
</code></pre>
<p>å¸¸ç”¨å·¥å…·è¯´æ˜ï¼š</p>

























<table><thead><tr><th>å·¥å…·</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>yarn</code> / <code>pnpm</code></td><td>æ›´å¿«çš„åŒ…ç®¡ç†å™¨</td></tr><tr><td><code>nodemon</code></td><td>è‡ªåŠ¨é‡å¯ Node æœåŠ¡</td></tr><tr><td><code>typescript</code></td><td>TypeScript æ”¯æŒ</td></tr><tr><td><code>eslint</code></td><td>ä»£ç è§„èŒƒæ£€æŸ¥</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-10">å››ã€åˆ›å»ºä¸€ä¸ª Node.js é¡¹ç›®</h2>
<h3 data-id="heading-11">1. åˆå§‹åŒ–é¡¹ç›®</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> my-node-app
<span class="hljs-built_in">cd</span> my-node-app
npm init -y
</code></pre>
<p>è¿™ä¼šç”Ÿæˆä¸€ä¸ªåŸºæœ¬çš„ <code>package.json</code> æ–‡ä»¶ã€‚</p>
<h3 data-id="heading-12">2. åˆ›å»ºä¸»æ–‡ä»¶</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">touch</span> index.js
</code></pre>
<p>ç¼–è¾‘å†…å®¹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, {<span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span>});
  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Hello Node.js!'</span>);
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Server running at http://localhost:3000/'</span>);
});
</code></pre>
<p>è¿è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash">node index.js
</code></pre>
<p>è®¿é—® <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A3000" target="_blank" title="http://localhost:3000" ref="nofollow noopener noreferrer">http://localhost:3000</a> å³å¯çœ‹åˆ°ç»“æœã€‚</p>
<hr/>
<h2 data-id="heading-13">äº”ã€ä½¿ç”¨ç°ä»£åŒ–å¼€å‘å·¥å…·</h2>
<h3 data-id="heading-14">1. VS Code é…ç½®</h3>
<p>å®‰è£…æ¨èæ‰©å±•ï¼š</p>
<ul>
<li><strong>ESLint</strong>ï¼šä»£ç è§„èŒƒæ£€æŸ¥</li>
<li><strong>Prettier</strong>ï¼šè‡ªåŠ¨æ ¼å¼åŒ–</li>
<li><strong>Node.js Extension Pack</strong>ï¼šå¸¸ç”¨ Node å·¥å…·é›†æˆ</li>
</ul>
<p>æ·»åŠ  <code>.vscode/settings.json</code>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"editor.formatOnSave"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"editor.codeActionsOnSave"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"source.fixAll.eslint"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h3 data-id="heading-15">2. ä½¿ç”¨ <code>.env</code> ç®¡ç†ç¯å¢ƒå˜é‡</h3>
<p>å®‰è£… dotenvï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install dotenv
</code></pre>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•æ·»åŠ  <code>.env</code> æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">PORT</span>=<span class="hljs-number">3000</span>
</code></pre>
<p>ä¿®æ”¹ä»£ç ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-built_in">require</span>(<span class="hljs-string">'dotenv'</span>).<span class="hljs-title function_">config</span>();
<span class="hljs-keyword">const</span> port = process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span> || <span class="hljs-number">3000</span>;
</code></pre>
<hr/>
<h2 data-id="heading-16">å…­ã€ä½¿ç”¨ TypeScriptï¼ˆå¯é€‰ï¼‰</h2>
<p>ç°ä»£ Node é¡¹ç›®æ¨èä½¿ç”¨ TypeScriptã€‚</p>
<pre><code class="hljs language-bash" lang="bash">npm install -D typescript ts-node @types/node
npx tsc --init
</code></pre>
<p>ä¿®æ”¹ <code>tsconfig.json</code>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ES2020"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"commonjs"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"outDir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"rootDir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"esModuleInterop"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h2 data-id="heading-17">ä¸ƒã€æ€»ç»“</h2>








































<table><thead><tr><th>æ­¥éª¤</th><th>å†…å®¹</th><th>ç›®çš„</th></tr></thead><tbody><tr><td>1</td><td>å®‰è£… Node.js æˆ– nvm</td><td>ç®¡ç†è¿è¡Œæ—¶ç¯å¢ƒ</td></tr><tr><td>2</td><td>é…ç½® npm æº</td><td>åŠ é€Ÿä¾èµ–å®‰è£…</td></tr><tr><td>3</td><td>åˆå§‹åŒ–é¡¹ç›®</td><td>ç”Ÿæˆ package.json</td></tr><tr><td>4</td><td>ç¼–å†™å…¥å£æ–‡ä»¶</td><td>å¯åŠ¨æœåŠ¡å™¨</td></tr><tr><td>5</td><td>é…ç½®ç¼–è¾‘å™¨ä¸ ESLint</td><td>æå‡å¼€å‘ä½“éªŒ</td></tr><tr><td>6</td><td>å¯é€‰å¯ç”¨ TypeScript</td><td>å¢å¼ºç±»å‹å®‰å…¨</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-18">å…«ã€ç»“è¯­</h2>
<p>åˆ°è¿™é‡Œï¼Œä½ å·²ç»æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´ã€å¯æ‰©å±•çš„ Node.js å¼€å‘ç¯å¢ƒã€‚
åç»­å¯ä»¥åŸºäºæ­¤ç¯å¢ƒç»§ç»­å­¦ä¹ ï¼š</p>
<ul>
<li>ä½¿ç”¨ <strong>Express / Koa / NestJS</strong> æ„å»ºåç«¯æœåŠ¡</li>
<li>ä½¿ç”¨ <strong>TypeScript + Jest</strong> æ„å»ºæµ‹è¯•ä½“ç³»</li>
<li>ä½¿ç”¨ <strong>Docker</strong> å®¹å™¨åŒ–éƒ¨ç½²</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android Activityå¯åŠ¨æµç¨‹è¯¦ç»†åˆ†æ]]></title>    <link>https://juejin.cn/post/7571281406509973555</link>    <guid>https://juejin.cn/post/7571281406509973555</guid>    <pubDate>2025-11-11T10:11:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571281406509973555" data-draft-id="7571088527678996506" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android Activityå¯åŠ¨æµç¨‹è¯¦ç»†åˆ†æ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-11T10:11:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å§ç„¶_9527"/> <meta itemprop="url" content="https://juejin.cn/user/1025189696514199"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android Activityå¯åŠ¨æµç¨‹è¯¦ç»†åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1025189696514199/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å§ç„¶_9527
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T10:11:34.000Z" title="Tue Nov 11 2025 10:11:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Android Activityå¯åŠ¨æµç¨‹è¯¦ç»†åˆ†æ</h2>
<h3 data-id="heading-1">æ¦‚è¿°</h3>
<p>Activityå¯åŠ¨æ˜¯Androidç³»ç»Ÿä¸­æœ€æ ¸å¿ƒçš„åŠŸèƒ½ä¹‹ä¸€ã€‚æœ¬æ–‡å°†ä»Activityçš„startActivityæ–¹æ³•å¼€å§‹ï¼Œä¸€æ­¥ä¸€æ­¥è¯¦ç»†åˆ†æActivityæ˜¯å¦‚ä½•å¯åŠ¨å¦ä¸€ä¸ªActivityçš„å®Œæ•´æµç¨‹ã€‚æ•´ä¸ªæµç¨‹æ¶‰åŠåº”ç”¨è¿›ç¨‹å’Œç³»ç»Ÿè¿›ç¨‹ä¹‹é—´çš„åä½œï¼Œé€šè¿‡Binder IPCè¿›è¡Œé€šä¿¡ã€‚</p>
<h3 data-id="heading-2">å¯åŠ¨æµç¨‹æ€»è§ˆ</h3>
<p>Activityå¯åŠ¨æµç¨‹å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªä¸»è¦é˜¶æ®µï¼š</p>
<ol start="0">
<li>åº”ç”¨è¿›ç¨‹å‡†å¤‡é˜¶æ®µ</li>
<li>ç³»ç»Ÿè¿›ç¨‹å†³ç­–ä¸è°ƒåº¦é˜¶æ®µ</li>
<li>åº”ç”¨è¿›ç¨‹æ‰§è¡Œé˜¶æ®µ</li>
</ol>
<h3 data-id="heading-3">è¯¦ç»†å¯åŠ¨æµç¨‹åˆ†æ</h3>
<h4 data-id="heading-4">1. åº”ç”¨è¿›ç¨‹å‡†å¤‡é˜¶æ®µ</h4>
<h5 data-id="heading-5">1.1 Activity.startActivity() æ–¹æ³•è°ƒç”¨</h5>
<p>å½“æˆ‘ä»¬åœ¨Activityä¸­è°ƒç”¨startActivity(Intent intent)æ–¹æ³•æ—¶ï¼Œå®é™…è°ƒç”¨çš„æ˜¯Activityç±»ä¸­çš„ä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Override</span>
public void <span class="hljs-built_in">startActivity</span>(Intent intent, <span class="hljs-variable">@Nullable</span> Bundle options) {
 Â  Â <span class="hljs-selector-tag">getAutofillClientController</span>()<span class="hljs-selector-class">.onStartActivity</span>(intent, mIntent);
 Â  Â <span class="hljs-selector-tag">if</span> (options != null) {
 Â  Â  Â  Â <span class="hljs-selector-tag">startActivityForResult</span>(intent, -<span class="hljs-number">1</span>, options);
 Â   } <span class="hljs-selector-tag">else</span> {
 Â  Â  Â  Â <span class="hljs-comment">// Note we want to go through this call for compatibility with</span>
 Â  Â  Â  Â <span class="hljs-comment">// applications that may have overridden the method.</span>
 Â  Â  Â  Â <span class="hljs-selector-tag">startActivityForResult</span>(intent, -<span class="hljs-number">1</span>);
 Â   }
}
</code></pre>
<h5 data-id="heading-6">1.2 Activity.startActivityForResult() æ–¹æ³•</h5>
<p>startActivityForResultæ–¹æ³•è¿›ä¸€æ­¥å¤„ç†å¯åŠ¨è¯·æ±‚ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">startActivityForResult</span>(<span class="hljs-variable">@RequiresPermission</span> Intent intent, int requestCode,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-variable">@Nullable</span> Bundle options) {
 Â  Â <span class="hljs-selector-tag">Instrumentation</span><span class="hljs-selector-class">.ActivityResult</span> <span class="hljs-selector-tag">ar</span> =
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">mInstrumentation</span><span class="hljs-selector-class">.execStartActivity</span>(
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this, mMainThread.<span class="hljs-built_in">getApplicationThread</span>(), mToken, this,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â intent, requestCode, options);
}
</code></pre>
<p>è¿™é‡Œå°†å¯åŠ¨ä»»åŠ¡å§”æ‰˜ç»™äº†Instrumentationç±»ã€‚</p>
<h5 data-id="heading-7">1.3 Instrumentation.execStartActivity() æ–¹æ³•</h5>
<p>Instrumentationæ˜¯åº”ç”¨è¿›ç¨‹ä¸ç³»ç»Ÿè¿›ç¨‹ä¹‹é—´çš„æ¡¥æ¢ï¼Œå®ƒçš„execStartActivity()æ–¹æ³•è´Ÿè´£æ‰§è¡Œå®é™…çš„å¯åŠ¨æ“ä½œï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@UnsupportedAppUsage</span>
<span class="hljs-keyword">public</span> ActivityResult <span class="hljs-title function_">execStartActivity</span><span class="hljs-params">(
 Â  Â  Â  Â Context who, IBinder contextThread, IBinder token, Activity target,
 Â  Â  Â  Â Intent intent, <span class="hljs-type">int</span> requestCode, Bundle options)</span> {
 Â  Â <span class="hljs-type">IApplicationThread</span> <span class="hljs-variable">whoThread</span> <span class="hljs-operator">=</span> (IApplicationThread) contextThread;
â€‹
 Â  Â <span class="hljs-keyword">try</span> {
 Â  Â  Â  Â intent.migrateExtraStreamToClipData(who);
 Â  Â  Â  Â intent.prepareToLeaveProcess(who);
 Â  Â  Â  Â <span class="hljs-comment">//è·å–åˆ° IActivityTaskManagerï¼Œå®é™…å°±æ˜¯ ActivityTaskManagerService</span>
 Â  Â  Â  Â <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> ActivityTaskManager.getService().startActivity(whoThread,
 Â  Â  Â  Â  Â  Â  Â  Â who.getOpPackageName(), who.getAttributionTag(), intent,
 Â  Â  Â  Â  Â  Â  Â  Â intent.resolveTypeIfNeeded(who.getContentResolver()), token,
 Â  Â  Â  Â  Â  Â  Â  Â target != <span class="hljs-literal">null</span> ? target.mEmbeddedID : <span class="hljs-literal">null</span>, requestCode, <span class="hljs-number">0</span>, <span class="hljs-literal">null</span>, options);
 Â  Â  Â  Â checkStartActivityResult(result, intent);
 Â   } <span class="hljs-keyword">catch</span> (RemoteException e) {
 Â  Â  Â  Â <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Failure from system"</span>, e);
 Â   }
 Â  Â <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œé€šè¿‡ActivityTaskManager.getService()è·å–åˆ°ç³»ç»ŸæœåŠ¡çš„Binderä»£ç†å¯¹è±¡ï¼Œç„¶åè°ƒç”¨å…¶startActivity()æ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ä¸ªè·¨è¿›ç¨‹è°ƒç”¨ã€‚</p>
<h4 data-id="heading-8">2. ç³»ç»Ÿè¿›ç¨‹å†³ç­–ä¸è°ƒåº¦é˜¶æ®µ</h4>
<h5 data-id="heading-9">2.1 ActivityTaskManagerServiceæ¥æ”¶è¯·æ±‚</h5>
<p>ç³»ç»Ÿè¿›ç¨‹ä¸­çš„ActivityTaskManagerServiceï¼ˆATMSï¼‰æ¥æ”¶åˆ°æ¥è‡ªåº”ç”¨è¿›ç¨‹çš„å¯åŠ¨è¯·æ±‚ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">@<span class="hljs-function">Override
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title">startActivity</span><span class="hljs-params">(IApplicationThread caller, <span class="hljs-type">String</span> callingPackage,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Intent intent, <span class="hljs-type">String</span> resolvedType, IBinder resultTo, <span class="hljs-type">String</span> resultWho, <span class="hljs-type">int</span> requestCode,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-type">int</span> startFlags, ProfilerInfo profilerInfo, Bundle bOptions)</span> </span>{
 Â  Â <span class="hljs-keyword">return</span> <span class="hljs-built_in">startActivityAsUser</span>(caller, callingPackage, intent, resolvedType, resultTo,
 Â  Â  Â  Â  Â  Â resultWho, requestCode, startFlags, profilerInfo, bOptions,
 Â  Â  Â  Â  Â  Â UserHandle.<span class="hljs-built_in">getCallingUserId</span>());
}
</code></pre>
<pre><code class="hljs language-scss" lang="scss">int <span class="hljs-built_in">startActivityAsUser</span>(IApplicationThread caller, String callingPackage,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Intent intent, String resolvedType, IBinder resultTo, String resultWho, int requestCode,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â int startFlags, ProfilerInfo profilerInfo, Bundle bOptions, int userId,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â boolean validateIncomingUser) {
 Â  Â <span class="hljs-built_in">enforceNotIsolatedCaller</span>("startActivityAsUser");
â€‹
 Â  Â userId = <span class="hljs-built_in">getActivityStartController</span>()<span class="hljs-selector-class">.checkTargetUser</span>(userId, validateIncomingUser,
 Â  Â  Â  Â  Â  Â Binder.getCallingPid(), Binder<span class="hljs-selector-class">.getCallingUid</span>(), "startActivityAsUser");
â€‹
 Â  Â <span class="hljs-comment">// getActivityStartControllerè¿”å›çš„æ˜¯ ActivityStarter</span>
 Â  Â return <span class="hljs-built_in">getActivityStartController</span>()<span class="hljs-selector-class">.obtainStarter</span>(intent, "startActivityAsUser")
 Â  Â  Â  Â  Â   <span class="hljs-selector-class">.setCaller</span>(caller)
 Â  Â  Â  Â  Â   <span class="hljs-selector-class">.setCallingPackage</span>(callingPackage)
 Â  Â  Â  Â  Â   <span class="hljs-selector-class">.setResolvedType</span>(resolvedType)
 Â  Â  Â  Â  Â   <span class="hljs-selector-class">.setResultTo</span>(resultTo)
 Â  Â  Â  Â  Â   <span class="hljs-selector-class">.setResultWho</span>(resultWho)
 Â  Â  Â  Â  Â   <span class="hljs-selector-class">.setRequestCode</span>(requestCode)
 Â  Â  Â  Â  Â   <span class="hljs-selector-class">.setStartFlags</span>(startFlags)
 Â  Â  Â  Â  Â   <span class="hljs-selector-class">.setProfilerInfo</span>(profilerInfo)
 Â  Â  Â  Â  Â   <span class="hljs-selector-class">.setActivityOptions</span>(bOptions)
 Â  Â  Â  Â  Â   <span class="hljs-selector-class">.setMayWait</span>(userId)
 Â  Â  Â  Â  Â   <span class="hljs-selector-class">.execute</span>();
}
</code></pre>
<h5 data-id="heading-10">2.2 ActivityStarter.execute() æ–¹æ³•</h5>
<p>ActivityStarteræ˜¯å¯åŠ¨Activityçš„"å¤§è„‘"ï¼Œè´Ÿè´£æ‰€æœ‰çš„æ ¡éªŒå’Œå†³ç­–é€»è¾‘ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">int <span class="hljs-built_in">execute</span>() {
 Â  Â try {
 Â  Â  Â  Â <span class="hljs-comment">// TODO(b/64750076): Look into passing request directly to these methods to allow</span>
 Â  Â  Â  Â <span class="hljs-comment">// for transactional diffs and preprocessing.</span>
 Â  Â  Â  Â if (mRequest.mayWait) {
 Â  Â  Â  Â  Â  Â return <span class="hljs-built_in">startActivityMayWait</span>(mRequest.caller, mRequest.callingUid,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â mRequest.callingPackage, mRequest.realCallingPid, mRequest.realCallingUid,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â mRequest.intent, mRequest.resolvedType,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â mRequest.voiceSession, mRequest.voiceInteractor, mRequest.resultTo,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â mRequest.resultWho, mRequest.requestCode, mRequest.startFlags,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â mRequest.profilerInfo, mRequest.waitResult, mRequest.globalConfig,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â mRequest.activityOptions, mRequest.ignoreTargetSecurity, mRequest.userId,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â mRequest.inTask, mRequest.reason,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â mRequest.allowPendingRemoteAnimationRegistryLookup,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â mRequest.originatingPendingIntent, mRequest.allowBackgroundActivityStart);
 Â  Â  Â   } else {
 Â  Â  Â  Â  Â  Â return <span class="hljs-built_in">startActivity</span>(mRequest.caller, mRequest.intent, mRequest.ephemeralIntent,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â mRequest.resolvedType, mRequest.activityInfo, mRequest.resolveInfo,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â mRequest.voiceSession, mRequest.voiceInteractor, mRequest.resultTo,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â mRequest.resultWho, mRequest.requestCode, mRequest.callingPid,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â mRequest.callingUid, mRequest.callingPackage, mRequest.realCallingPid,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â mRequest.realCallingUid, mRequest.startFlags, mRequest.activityOptions,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â mRequest.ignoreTargetSecurity, mRequest.componentSpecified,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â mRequest.outActivity, mRequest.inTask, mRequest.reason,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â mRequest.allowPendingRemoteAnimationRegistryLookup,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â mRequest.originatingPendingIntent, mRequest.allowBackgroundActivityStart);
 Â  Â  Â   }
 Â   } finally {
 Â  Â  Â  Â <span class="hljs-built_in">onExecutionComplete</span>();
 Â   }
}
</code></pre>
<h5 data-id="heading-11">2.3 startActivityMayWait() æ–¹æ³•</h5>
<p>å½“éœ€è¦ç­‰å¾…Activityå¯åŠ¨ç»“æœæ—¶ï¼ˆé€šå¸¸æƒ…å†µï¼‰ï¼Œä¼šè°ƒç”¨startActivityMayWait()æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">startActivityMayWait</span><span class="hljs-params">(IApplicationThread caller, <span class="hljs-type">int</span> callingUid,
 Â  Â  Â  Â String callingPackage, <span class="hljs-type">int</span> requestRealCallingPid, <span class="hljs-type">int</span> requestRealCallingUid,
 Â  Â  Â  Â Intent intent, String resolvedType, IVoiceInteractionSession voiceSession,
 Â  Â  Â  Â IVoiceInteractor voiceInteractor, IBinder resultTo, String resultWho, <span class="hljs-type">int</span> requestCode,
 Â  Â  Â  Â <span class="hljs-type">int</span> startFlags, ProfilerInfo profilerInfo, WaitResult outResult,
 Â  Â  Â  Â Configuration globalConfig, SafeActivityOptions options, <span class="hljs-type">boolean</span> ignoreTargetSecurity,
 Â  Â  Â  Â <span class="hljs-type">int</span> userId, TaskRecord inTask, String reason,
 Â  Â  Â  Â <span class="hljs-type">boolean</span> allowPendingRemoteAnimationRegistryLookup,
 Â  Â  Â  Â PendingIntentRecord originatingPendingIntent, <span class="hljs-type">boolean</span> allowBackgroundActivityStart)</span> {
 Â  Â 
 Â  Â <span class="hljs-comment">// 1. æ£€æŸ¥Intentä¸­çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œé˜²æ­¢æ³„éœ²</span>
 Â  Â <span class="hljs-keyword">if</span> (intent != <span class="hljs-literal">null</span> &amp;&amp; intent.hasFileDescriptors()) {
 Â  Â  Â  Â <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"File descriptors passed in Intent"</span>);
 Â   }
 Â  Â 
 Â  Â <span class="hljs-comment">// 2. è§£æIntentè·å–ç›®æ ‡Activityä¿¡æ¯</span>
 Â  Â <span class="hljs-type">ResolveInfo</span> <span class="hljs-variable">rInfo</span> <span class="hljs-operator">=</span> mSupervisor.resolveIntent(intent, resolvedType, userId,
 Â  Â  Â  Â  Â  Â <span class="hljs-number">0</span> <span class="hljs-comment">/* matchFlags */</span>, computeResolveFilterUid(
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â callingUid, requestRealCallingUid, mRequest.filterCallingUid));
 Â  Â 
 Â  Â <span class="hljs-comment">// 3. è·å–ActivityInfo</span>
 Â  Â <span class="hljs-type">ActivityInfo</span> <span class="hljs-variable">aInfo</span> <span class="hljs-operator">=</span> rInfo != <span class="hljs-literal">null</span> ? rInfo.activityInfo : <span class="hljs-literal">null</span>;
 Â  Â <span class="hljs-keyword">if</span> (aInfo != <span class="hljs-literal">null</span>) {
 Â  Â  Â  Â aInfo = mService.mAmInternal.getActivityInfoForUser(aInfo, userId);
 Â   }
 Â  Â 
 Â  Â <span class="hljs-comment">// 4. å¤„ç†ç‰¹æ®Šæƒ…å†µï¼ˆå¦‚é‡é‡çº§åº”ç”¨ã€æ‰˜ç®¡åº”ç”¨ç­‰ï¼‰</span>
 Â  Â <span class="hljs-comment">// ...</span>
 Â  Â 
 Â  Â <span class="hljs-comment">// 5. è°ƒç”¨startActivity()æ–¹æ³•ç»§ç»­æ‰§è¡Œ</span>
 Â  Â <span class="hljs-keyword">return</span> startActivity(caller, intent, ephemeralIntent, resolvedType, aInfo, rInfo,
 Â  Â  Â  Â  Â  Â voiceSession, voiceInteractor, resultTo, resultWho, requestCode, callingPid,
 Â  Â  Â  Â  Â  Â callingUid, callingPackage, realCallingPid, realCallingUid, startFlags, options,
 Â  Â  Â  Â  Â  Â ignoreTargetSecurity, componentSpecified, outActivity, inTask, reason,
 Â  Â  Â  Â  Â  Â allowPendingRemoteAnimationRegistryLookup, originatingPendingIntent,
 Â  Â  Â  Â  Â  Â allowBackgroundActivityStart);
}
</code></pre>
<h5 data-id="heading-12">2.4 startActivity() æ–¹æ³•</h5>
<p>startActivity()æ–¹æ³•æ˜¯æ ¸å¿ƒçš„å¯åŠ¨æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title">startActivity</span><span class="hljs-params">(IApplicationThread caller, Intent intent, Intent ephemeralIntent,
 Â  Â  Â  Â <span class="hljs-type">String</span> resolvedType, ActivityInfo aInfo, ResolveInfo rInfo,
 Â  Â  Â  Â IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,
 Â  Â  Â  Â IBinder resultTo, <span class="hljs-type">String</span> resultWho, <span class="hljs-type">int</span> requestCode, <span class="hljs-type">int</span> callingPid, <span class="hljs-type">int</span> callingUid,
 Â  Â  Â  Â <span class="hljs-type">String</span> callingPackage, <span class="hljs-type">int</span> realCallingPid, <span class="hljs-type">int</span> realCallingUid, <span class="hljs-type">int</span> startFlags,
 Â  Â  Â  Â SafeActivityOptions options,
 Â  Â  Â  Â <span class="hljs-type">boolean</span> ignoreTargetSecurity, <span class="hljs-type">boolean</span> componentSpecified, ActivityRecord[] outActivity,
 Â  Â  Â  Â TaskRecord inTask, <span class="hljs-type">boolean</span> allowPendingRemoteAnimationRegistryLookup,
 Â  Â  Â  Â PendingIntentRecord originatingPendingIntent, <span class="hljs-type">boolean</span> allowBackgroundActivityStart)</span> </span>{
 Â  Â 
 Â  Â <span class="hljs-comment">// 1. æƒé™æ£€æŸ¥</span>
 Â  Â <span class="hljs-comment">// 2. Intentè§£æ</span>
 Â  Â <span class="hljs-comment">// 3. åˆ›å»ºActivityRecordå¯¹è±¡</span>
 Â  Â <span class="hljs-comment">// 4. è°ƒç”¨startActivityUnchecked()æ–¹æ³•</span>
 Â  Â <span class="hljs-keyword">return</span> <span class="hljs-built_in">startActivityUnchecked</span>(r, sourceRecord, voiceSession, voiceInteractor,
 Â  Â  Â  Â  Â  Â startFlags, doResume, options, inTask, outActivity, restrictedBgActivity);
}
</code></pre>
<h5 data-id="heading-13">2.5 startActivityUnchecked() æ–¹æ³•</h5>
<p>è¿™æ˜¯Activityå¯åŠ¨æµç¨‹ä¸­æœ€æ ¸å¿ƒçš„æ–¹æ³•ï¼Œè´Ÿè´£å…·ä½“çš„å¯åŠ¨é€»è¾‘ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">private int <span class="hljs-built_in">startActivityUnchecked</span>(final ActivityRecord r, ActivityRecord sourceRecord,
        IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,
        int startFlags, boolean doResume, ActivityOptions options, TaskRecord inTask,
        ActivityRecord[] outActivity, boolean restrictedBgActivity) {
    
    <span class="hljs-comment">// 1. åˆå§‹åŒ–çŠ¶æ€</span>
    <span class="hljs-built_in">setInitialState</span>(r, options, inTask, doResume, startFlags, sourceRecord,
            voiceSession, voiceInteractor, restrictedBgActivity);
    
    <span class="hljs-comment">// 2. è®¡ç®—å¯åŠ¨æ ‡å¿—</span>
    <span class="hljs-built_in">computeLaunchingTaskFlags</span>();
    
    <span class="hljs-comment">// 3. è®¡ç®—æºä»»åŠ¡æ ˆ</span>
    <span class="hljs-built_in">computeSourceStack</span>();
    
    <span class="hljs-comment">// 4. æŸ¥æ‰¾å¯å¤ç”¨çš„Activity</span>
    ActivityRecord reusedActivity = <span class="hljs-built_in">getReusableIntentActivity</span>();
    
    <span class="hljs-comment">// 5. å¤„ç†å¤ç”¨æƒ…å†µ</span>
    if (reusedActivity != null) {
        <span class="hljs-comment">// å¦‚æœæ‰¾åˆ°å¯å¤ç”¨çš„Activity</span>
        reusedActivity = <span class="hljs-built_in">setTargetStackAndMoveToFrontIfNeeded</span>(reusedActivity);
        <span class="hljs-built_in">setTaskFromIntentActivity</span>(reusedActivity);
        <span class="hljs-comment">// ...</span>
    } else {
        <span class="hljs-comment">// 6. å¤„ç†ä¸å¤ç”¨æƒ…å†µ</span>
        <span class="hljs-comment">// æ ¹æ®ä¸åŒæƒ…å†µè°ƒç”¨ä¸åŒçš„ä»»åŠ¡åˆ›å»ºæ–¹æ³•</span>
        if (mStartActivity.resultTo == null &amp;&amp; mInTask == null &amp;&amp; !mAddingToTask
                &amp;&amp; (mLaunchFlags &amp; FLAG_ACTIVITY_NEW_TASK) != <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// åˆ›å»ºæ–°ä»»åŠ¡</span>
            result = <span class="hljs-built_in">setTaskFromReuseOrCreateNewTask</span>(taskToAffiliate);
        } else if (mSourceRecord != null) {
            <span class="hljs-comment">// åœ¨æºä»»åŠ¡ä¸­å¯åŠ¨</span>
            result = <span class="hljs-built_in">setTaskFromSourceRecord</span>();
        } else if (mInTask != null) {
            <span class="hljs-comment">// åœ¨æŒ‡å®šä»»åŠ¡ä¸­å¯åŠ¨</span>
            result = <span class="hljs-built_in">setTaskFromInTask</span>();
        } else {
            <span class="hljs-comment">// åœ¨å½“å‰é¡¶éƒ¨ä»»åŠ¡ä¸­å¯åŠ¨</span>
            result = <span class="hljs-built_in">setTaskToCurrentTopOrCreateNewTask</span>();
        }
    }
    
    <span class="hljs-comment">// 7. æƒé™å¤„ç†</span>
    mService<span class="hljs-selector-class">.mUgmInternal</span><span class="hljs-selector-class">.grantUriPermissionFromIntent</span>(mCallingUid, mStartActivity.packageName,
            mIntent, mStartActivity.getUriPermissionsLocked(), mStartActivity<span class="hljs-selector-class">.mUserId</span>);
    
    <span class="hljs-comment">// 8. å¯åŠ¨Activity</span>
    mTargetStack<span class="hljs-selector-class">.startActivityLocked</span>(mStartActivity, topFocused, newTask, mKeepCurTransition,
            mOptions);
    
    <span class="hljs-comment">// 9. æ¢å¤Activity</span>
    if (mDoResume) {
        mRootActivityContainer<span class="hljs-selector-class">.resumeFocusedStacksTopActivities</span>(
                mTargetStack, mStartActivity, mOptions);
    }
    
    return START_SUCCESS;
}
</code></pre>
<h5 data-id="heading-14">2.6 ä»»åŠ¡æ ˆç®¡ç†</h5>
<p>åœ¨startActivityUnchecked()æ–¹æ³•ä¸­ï¼Œç³»ç»Ÿä¼šæ ¹æ®launch modeå’ŒIntent flagsæ¥å†³å®šå¦‚ä½•ç®¡ç†ä»»åŠ¡æ ˆï¼š</p>
<ol start="0">
<li><strong>setTaskFromReuseOrCreateNewTask()</strong> : åˆ›å»ºæ–°ä»»åŠ¡æˆ–å¤ç”¨ç°æœ‰ä»»åŠ¡</li>
<li><strong>setTaskFromSourceRecord()</strong> : åœ¨æºActivityçš„ä»»åŠ¡ä¸­å¯åŠ¨</li>
<li><strong>setTaskFromInTask()</strong> : åœ¨æŒ‡å®šä»»åŠ¡ä¸­å¯åŠ¨</li>
<li><strong>setTaskToCurrentTopOrCreateNewTask()</strong> : åœ¨å½“å‰é¡¶éƒ¨ä»»åŠ¡ä¸­å¯åŠ¨</li>
</ol>
<h4 data-id="heading-15">3. åº”ç”¨è¿›ç¨‹æ‰§è¡Œé˜¶æ®µ</h4>
<h5 data-id="heading-16">3.1 è·¨è¿›ç¨‹å›è°ƒåº”ç”¨è¿›ç¨‹</h5>
<p>ç³»ç»Ÿè¿›ç¨‹é€šè¿‡Binder IPCå›è°ƒåˆ°ç›®æ ‡Activityæ‰€åœ¨çš„åº”ç”¨è¿›ç¨‹ã€‚è¿™ä¸ªå›è°ƒçš„æ¥æ”¶è€…æ˜¯ApplicationThreadã€‚</p>
<h5 data-id="heading-17">3.2 ApplicationThreadæ¥æ”¶å›è°ƒ</h5>
<p>ApplicationThreadæ˜¯ActivityThreadçš„å†…éƒ¨ç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªBinderå¯¹è±¡ï¼Œè¿è¡Œåœ¨åº”ç”¨è¿›ç¨‹ä¸­ã€‚å®ƒæ¥æ”¶åˆ°scheduleTransaction()è°ƒç”¨ï¼Œå…¶ä¸­åŒ…å«äº†å¯åŠ¨Activityçš„æŒ‡ä»¤ã€‚</p>
<h5 data-id="heading-18">3.3 H(Handler)å¤„ç†æ¶ˆæ¯</h5>
<p>ApplicationThreadå°†æ¥æ”¶åˆ°çš„Binderè°ƒç”¨è½¬æ¢æˆMessageï¼Œé€šè¿‡ä¸€ä¸ªHandlerï¼ˆåä¸ºHï¼‰å‘é€åˆ°åº”ç”¨è¿›ç¨‹çš„ä¸»çº¿ç¨‹æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚</p>
<h5 data-id="heading-19">3.4 ActivityThreadå¤„ç†æŒ‡ä»¤</h5>
<p>ä¸»çº¿ç¨‹çš„Hå¤„ç†æ¶ˆæ¯ï¼Œè°ƒç”¨ActivityThreadçš„handleLaunchActivity()æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">public Activity <span class="hljs-built_in">handleLaunchActivity</span>(ActivityClientRecord r,
        PendingTransactionActions pendingActions, Intent customIntent) {
    <span class="hljs-comment">// 1. åˆ›å»ºActivityå®ä¾‹</span>
    Activity <span class="hljs-selector-tag">a</span> = <span class="hljs-built_in">performLaunchActivity</span>(r, customIntent);
    
    <span class="hljs-comment">// 2. è°ƒç”¨Activityçš„onResumeæ–¹æ³•</span>
    if (a != null) {
        r<span class="hljs-selector-class">.createdConfig</span> = new <span class="hljs-built_in">Configuration</span>(mConfiguration);
        <span class="hljs-built_in">reportSizeConfigurations</span>(r);
        if (!r.activity.mFinished &amp;&amp; pendingActions != null) {
            pendingActions<span class="hljs-selector-class">.setOldState</span>(r.state);
            pendingActions<span class="hljs-selector-class">.setRestoreInstanceState</span>(true);
        }
        <span class="hljs-built_in">handleResumeActivity</span>(r.token, false, r.isForward,
                !r.activity.mFinished &amp;&amp; pendingActions != null);
    }
    
    return <span class="hljs-selector-tag">a</span>;
}
</code></pre>
<h5 data-id="heading-20">3.5 performLaunchActivity() åˆ›å»ºActivity</h5>
<pre><code class="hljs language-ini" lang="ini">private Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) {
    ActivityInfo <span class="hljs-attr">aInfo</span> = r.activityInfo<span class="hljs-comment">;</span>
    if (<span class="hljs-attr">r.packageInfo</span> == null) {
        return null<span class="hljs-comment">;</span>
    }

    ComponentName <span class="hljs-attr">component</span> = r.intent.getComponent()<span class="hljs-comment">;</span>
    if (<span class="hljs-attr">component</span> == null) {
        <span class="hljs-attr">component</span> = r.intent.resolveActivity(
            mInitialApplication.getPackageManager())<span class="hljs-comment">;</span>
        r.intent.setComponent(component)<span class="hljs-comment">;</span>
    }

    if (r.activityInfo.targetActivity != null) {
        <span class="hljs-attr">component</span> = new ComponentName(r.activityInfo.packageName,
                r.activityInfo.targetActivity)<span class="hljs-comment">;</span>
    }

    ContextImpl <span class="hljs-attr">appContext</span> = createBaseContextForActivity(r)<span class="hljs-comment">;</span>
    Activity <span class="hljs-attr">activity</span> = null<span class="hljs-comment">;</span>
    try {
        // 1. é€šè¿‡ç±»åŠ è½½å™¨åˆ›å»ºActivityå®ä¾‹
        java.lang.ClassLoader <span class="hljs-attr">cl</span> = appContext.getClassLoader()<span class="hljs-comment">;</span>
        <span class="hljs-attr">activity</span> = mInstrumentation.newActivity(
                cl, component.getClassName(), r.intent)<span class="hljs-comment">;</span>
        StrictMode.incrementExpectedActivityCount(activity.getClass())<span class="hljs-comment">;</span>
        r.intent.setExtrasClassLoader(cl)<span class="hljs-comment">;</span>
        r.intent.prepareToEnterProcess()<span class="hljs-comment">;</span>
        if (r.state != null) {
            r.state.setClassLoader(cl)<span class="hljs-comment">;</span>
        }
    } catch (Exception e) {
        if (!mInstrumentation.onException(activity, e)) {
            throw new RuntimeException(
                "Unable to instantiate activity " + component
                + ": " + e.toString(), e)<span class="hljs-comment">;</span>
        }
    }

    try {
        // 2. åˆ›å»ºApplicationå®ä¾‹ï¼ˆå¦‚æœå°šæœªåˆ›å»ºï¼‰
        Application <span class="hljs-attr">app</span> = r.packageInfo.makeApplication(<span class="hljs-literal">false</span>, mInstrumentation)<span class="hljs-comment">;</span>

        if (activity != null) {
            // 3. åˆ›å»ºContextImpl
            ContextImpl <span class="hljs-attr">appContext</span> = createBaseContextForActivity(r)<span class="hljs-comment">;</span>
            
            // 4. è°ƒç”¨Activity.attach()ç»‘å®šä¸Šä¸‹æ–‡
            activity.attach(appContext, this, getInstrumentation(), r.token,
                    r.ident, app, r.intent, r.activityInfo, title, r.parent,
                    r.embeddedID, r.lastNonConfigurationInstances, config,
                    r.referrer, r.voiceInteractor, window, r.configCallback)<span class="hljs-comment">;</span>

            if (customIntent != null) {
                <span class="hljs-attr">activity.mIntent</span> = customIntent<span class="hljs-comment">;</span>
            }
            <span class="hljs-attr">r.lastNonConfigurationInstances</span> = null<span class="hljs-comment">;</span>
            checkAndBlockForNetworkAccess()<span class="hljs-comment">;</span>
            <span class="hljs-attr">activity.mStartedActivity</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
            int <span class="hljs-attr">theme</span> = r.activityInfo.getThemeResource()<span class="hljs-comment">;</span>
            if (theme != 0) {
                activity.setTheme(theme)<span class="hljs-comment">;</span>
            }

            // 5. è°ƒç”¨Activityçš„onCreateæ–¹æ³•
            <span class="hljs-attr">activity.mCalled</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
            if (r.isPersistable()) {
                mInstrumentation.callActivityOnCreate(activity, r.state, r.persistentState)<span class="hljs-comment">;</span>
            } else {
                mInstrumentation.callActivityOnCreate(activity, r.state)<span class="hljs-comment">;</span>
            }
            
            // ...
        }
        <span class="hljs-attr">r.paused</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>

        mActivities.put(r.token, r)<span class="hljs-comment">;</span>

    } catch (SuperNotCalledException e) {
        throw e<span class="hljs-comment">;</span>

    } catch (Exception e) {
        if (!mInstrumentation.onException(activity, e)) {
            throw new RuntimeException(
                "Unable to start activity " + component
                + ": " + e.toString(), e)<span class="hljs-comment">;</span>
        }
    }

    return activity<span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-21">4. åç»­ç”Ÿå‘½å‘¨æœŸè°ƒç”¨</h4>
<p>åœ¨handleLaunchActivity()ä¹‹åï¼Œç³»ç»Ÿè¿›ç¨‹ä¼šç»§ç»­é€šè¿‡åŒæ ·çš„IPC -&gt; Handleræœºåˆ¶ï¼Œä¾æ¬¡è°ƒåº¦startã€resumeç­‰æ–¹æ³•ã€‚</p>
<h3 data-id="heading-22">å…³é”®æ¦‚å¿µè¯¦è§£</h3>
<h4 data-id="heading-23">Launch Mode</h4>
<p>Androidæ”¯æŒå››ç§å¯åŠ¨æ¨¡å¼ï¼š</p>
<ol start="0">
<li><strong>standard</strong>ï¼šé»˜è®¤æ¨¡å¼ï¼Œæ¯æ¬¡å¯åŠ¨éƒ½ä¼šåˆ›å»ºæ–°å®ä¾‹</li>
<li><strong>singleTop</strong>ï¼šå¦‚æœActivityå·²åœ¨æ ˆé¡¶ï¼Œåˆ™å¤ç”¨å¹¶è°ƒç”¨onNewIntent()</li>
<li><strong>singleTask</strong>ï¼šåœ¨æ•´ä¸ªç³»ç»Ÿä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œä¼šæ¸…é™¤å…¶ä¸Šçš„æ‰€æœ‰Activity</li>
<li><strong>singleInstance</strong>ï¼šç‹¬å ä¸€ä¸ªä»»åŠ¡æ ˆï¼Œåªæœ‰ä¸€ä¸ªå®ä¾‹</li>
</ol>
<h4 data-id="heading-24">Intent Flags</h4>
<p>å¸¸ç”¨çš„Intent Flagsï¼š</p>
<ul>
<li><strong>FLAG_ACTIVITY_NEW_TASK</strong>ï¼šåœ¨æ–°ä»»åŠ¡ä¸­å¯åŠ¨Activity</li>
<li><strong>FLAG_ACTIVITY_CLEAR_TOP</strong>ï¼šæ¸…é™¤ç›®æ ‡Activityä¹‹ä¸Šçš„æ‰€æœ‰Activity</li>
<li><strong>FLAG_ACTIVITY_SINGLE_TOP</strong>ï¼šå¦‚æœActivityå·²åœ¨æ ˆé¡¶åˆ™å¤ç”¨</li>
<li><strong>FLAG_ACTIVITY_NO_HISTORY</strong>ï¼šActivityä¸ä¼šä¿ç•™åœ¨å†å²æ ˆä¸­</li>
</ul>
<h3 data-id="heading-25">å¯åŠ¨æµç¨‹æ—¶åºå›¾</h3>
<pre><code class="hljs language-scss" lang="scss">å®¢æˆ·ç«¯ActivityInstrumentationActivityTaskManagerServiceActivityStarterActivityStackç›®æ ‡åº”ç”¨è¿›ç¨‹<span class="hljs-built_in">ActivityThreadActivitystartActivity</span>()<span class="hljs-built_in">startActivity</span>() <span class="hljs-selector-attr">[IPC]</span><span class="hljs-built_in">obtainStarter</span>()<span class="hljs-selector-class">.execute</span>()<span class="hljs-built_in">startActivityMayWait</span>()<span class="hljs-built_in">startActivity</span>()<span class="hljs-built_in">startActivityUnchecked</span>()<span class="hljs-built_in">setInitialState</span>()<span class="hljs-built_in">computeLaunchingTaskFlags</span>()<span class="hljs-built_in">computeSourceStack</span>()<span class="hljs-built_in">getReusableIntentActivity</span>()<span class="hljs-built_in">setTargetStackAndMoveToFrontIfNeeded</span>()<span class="hljs-built_in">setTaskFromIntentActivity</span>()<span class="hljs-built_in">setTaskFromReuseOrCreateNewTask</span>()/<span class="hljs-built_in">setTaskFromSourceRecord</span>()alt<span class="hljs-selector-attr">[ æ‰¾åˆ°å¯å¤ç”¨Activity ]</span><span class="hljs-selector-attr">[ æœªæ‰¾åˆ°å¯å¤ç”¨Activity ]</span><span class="hljs-built_in">startActivityLocked</span>()<span class="hljs-built_in">scheduleLaunchActivity</span>() <span class="hljs-selector-attr">[IPC]</span>H<span class="hljs-selector-class">.handleMessage</span>()<span class="hljs-built_in">handleLaunchActivity</span>()<span class="hljs-built_in">performLaunchActivity</span>()<span class="hljs-built_in">onCreate</span>()<span class="hljs-built_in">scheduleResumeActivity</span>() <span class="hljs-selector-attr">[IPC]</span>H<span class="hljs-selector-class">.handleMessage</span>()<span class="hljs-built_in">onResume</span>()alt<span class="hljs-selector-attr">[ éœ€è¦æ¢å¤ ]</span>å®¢æˆ·ç«¯ActivityInstrumentationActivityTaskManagerServiceActivityStarterActivityStackç›®æ ‡åº”ç”¨è¿›ç¨‹ActivityThreadActivity
</code></pre>
<h3 data-id="heading-26">æ€»ç»“</h3>
<p>Activityå¯åŠ¨æµç¨‹æ˜¯ä¸€ä¸ªå¤æ‚è€Œç²¾å¯†çš„è¿‡ç¨‹ï¼Œæ¶‰åŠå¤šä¸ªç»„ä»¶çš„åä½œï¼š</p>
<ol start="0">
<li><strong>åº”ç”¨è¿›ç¨‹</strong>è´Ÿè´£å‘èµ·å¯åŠ¨è¯·æ±‚ï¼Œå¹¶åœ¨ç³»ç»Ÿè°ƒåº¦åæ‰§è¡Œå…·ä½“çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</li>
<li><strong>ç³»ç»Ÿè¿›ç¨‹</strong>ï¼ˆATMS/ActivityStarterï¼‰è´Ÿè´£æƒé™æ£€æŸ¥ã€Intentè§£æã€ä»»åŠ¡æ ˆç®¡ç†ç­‰æ ¸å¿ƒå†³ç­–</li>
<li><strong>Binder IPC</strong>æ˜¯åº”ç”¨è¿›ç¨‹å’Œç³»ç»Ÿè¿›ç¨‹ä¹‹é—´é€šä¿¡çš„æ¡¥æ¢</li>
<li><strong>Instrumentation</strong>ä½œä¸ºç›‘æ§é’©å­ï¼Œè´¯ç©¿æ•´ä¸ªå¯åŠ¨æµç¨‹</li>
<li><strong>ActivityStack</strong>è´Ÿè´£ç®¡ç†Activityçš„å›é€€æ ˆ</li>
</ol>
<p>ç†è§£è¿™ä¸ªæµç¨‹å¯¹äºAndroidå¼€å‘å’Œç³»ç»Ÿä¼˜åŒ–éƒ½æœ‰é‡è¦æ„ä¹‰ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¯åŠ¨æ€§èƒ½ã€ä»»åŠ¡ç®¡ç†ã€ç”Ÿå‘½å‘¨æœŸç­‰é—®é¢˜æ—¶ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android Compose SideEffectï¼ˆå‰¯ä½œç”¨ï¼‰å®ä¾‹åŠ å€è¯¦è§£]]></title>    <link>https://juejin.cn/post/7571077686107897919</link>    <guid>https://juejin.cn/post/7571077686107897919</guid>    <pubDate>2025-11-11T08:19:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571077686107897919" data-draft-id="7566294664786001955" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android Compose  SideEffectï¼ˆå‰¯ä½œç”¨ï¼‰å®ä¾‹åŠ å€è¯¦è§£"/> <meta itemprop="keywords" content="APP,Android"/> <meta itemprop="datePublished" content="2025-11-11T08:19:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‚å®¿å››å—æ²³ä¸‰"/> <meta itemprop="url" content="https://juejin.cn/user/3479267728427543"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android Compose  SideEffectï¼ˆå‰¯ä½œç”¨ï¼‰å®ä¾‹åŠ å€è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3479267728427543/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‚å®¿å››å—æ²³ä¸‰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T08:19:36.000Z" title="Tue Nov 11 2025 08:19:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å‰å‡ å¤©çš„æ–‡ç« ï¼Œæ•´ç†äº†ä¸Šä¸ªæœˆçš„å­¦ä¹ å¿ƒå¾—ã€‚è¿™æ®µæ—¶é—´åˆä»”ç»†ç ”ç©¶äº†ä¸‹SideEffectï¼Œç§‰ç€é—²ç€æ‰¾äº‹å¹²ï¼Œæœ‰äº‹å¹²æ‰ä¸æƒ³ç€å»æ´—è„šçš„åŸåˆ™ï¼Œæˆ‘åˆå¼€å§‹äº†è¯»ä¹¦ç¬”è®°å¼çš„ç å­—ã€‚<code>æºç åœ¨æ–‡ç« æœ«å°¾ã€‚å„å‰¯ä½œç”¨å‡½æ•°ç‰¹æ€§è¡¨ä¹Ÿåœ¨æ–‡ç« æœ«å°¾</code>ã€‚<br/>
<strong>éƒ¨åˆ†ä¾‹å­åœ¨å®é™…å¼€å‘ä¸­æ˜¯å¯èƒ½å­˜åœ¨ä¸€å®šç‘•ç–µçš„ï¼Œæ—¨åœ¨è®©å¤§å®¶æ˜ç™½å¦‚ä½•ä½¿ç”¨ã€‚ä½¿ç”¨æ—¶è¯·æ³¨æ„</strong></p>
<h2 data-id="heading-0">ä¸€ã€å‰¯ä½œç”¨åˆ°åº•æœ‰å“ªäº›ï¼Ÿ</h2>
<ul>
<li>LaunchedEffect</li>
<li>DisposableEffect</li>
<li>SideEffect</li>
<li>rememberCoroutineScope</li>
<li>produceState<br/>
å‰¯ä½œç”¨å‡½æ•°å…³è”æ¦‚å¿µï¼ˆ<strong>ä¸ªäººè§‰å¾—ä¸æ˜¯å‰¯å‡½æ•°</strong>ï¼‰ï¼š</li>
<li>derivedStateOf</li>
<li>rememberUpdatedState</li>
</ul>
<p>ä¸Šç¯‡æ–‡ç« æˆ‘å·²ç»ç®€å•ä»‹ç»äº†è¿™å‡ ä¸ªå‰¯ä½œç”¨å‡½æ•°ï¼Œå¯æ€»è§‰å¾—å¤ªè¿‡ç®€ç•¥ï¼Œä¾‹å­ä¹Ÿå¾ˆç®€å•ï¼Œå®Œå…¨ä¸è´´åˆå®é™…å¼€å‘ï¼Œä»¥åæˆ‘æ€ä¹ˆæŠ„ä»£ç å˜›ã€‚å¥½çš„ï¼Œä¸‹é¢æˆ‘ä»¬å°±ä»å®é™…å‡ºå‘ä¸¾ä¾‹å­ï¼Œè®©å¤§å®¶æ›´å¥½æŠ„æ›´å¥½ç†è§£ã€‚</p>
<h2 data-id="heading-1">LaunchedEffect</h2>
<h3 data-id="heading-2">1ã€æ¦‚æ‹¬</h3>
<p>LaunchedEffect(key) = é¡µé¢è¿›å…¥æ—¶è‡ªåŠ¨å¯åŠ¨åç¨‹ï¼Œkeyå˜äº†å°±å–æ¶ˆæ—§çš„ï¼Œé‡å¯æ–°çš„ã€‚</p>
<h3 data-id="heading-3">2ã€æ ¸å¿ƒæœºåˆ¶</h3>





















<table><thead><tr><th>æœºåˆ¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>è‡ªåŠ¨å¯åŠ¨</strong></td><td>Composable è¿›å…¥ç»„åˆæ—¶ï¼Œè‡ªåŠ¨ <code>launch</code> åç¨‹</td></tr><tr><td><strong>key æ§åˆ¶</strong></td><td><code>key</code> ä¸å˜ â†’ åç¨‹ç»§ç»­ï¼›<code>key</code> å˜ â†’ <strong>å–æ¶ˆæ—§åç¨‹ï¼Œå¯åŠ¨æ–°åç¨‹</strong></td></tr><tr><td><strong>è‡ªåŠ¨å–æ¶ˆ</strong></td><td>ç¦»å¼€é¡µé¢ â†’ è‡ªåŠ¨ <code>cancel()</code>ï¼Œ<strong>é›¶æ³„æ¼</strong></td></tr></tbody></table>
<h3 data-id="heading-4">3ã€å®é™…å¼€å‘ä¸­çš„åœºæ™¯</h3>
<ul>
<li>åœºæ™¯ä¸€ï¼šåŠ è½½ç½‘ç»œæ•°æ®ï¼ˆæœ€å¸¸è§ï¼‰</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">FetchUserInfo</span><span class="hljs-params">(userId: <span class="hljs-type">Int</span>)</span></span> {
    <span class="hljs-keyword">var</span> user <span class="hljs-keyword">by</span> remember { mutableStateOf&lt;User?&gt;(<span class="hljs-literal">null</span>) }
    <span class="hljs-keyword">var</span> loading <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-literal">true</span>) }
    <span class="hljs-keyword">var</span> error <span class="hljs-keyword">by</span> remember { mutableStateOf&lt;String?&gt;(<span class="hljs-literal">null</span>) }

    LaunchedEffect(userId) {  <span class="hljs-comment">// key = userId</span>
        loading = <span class="hljs-literal">true</span>
        error = <span class="hljs-literal">null</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">val</span> result = withContext(Dispatchers.IO) {
                RetrofitClient.apiService.getUsersById(userId) 
            }
            user = result
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            error = e.message
        } <span class="hljs-keyword">finally</span> {
            loading = <span class="hljs-literal">false</span>
        }
    }

    <span class="hljs-keyword">when</span> {
        loading -&gt; CircularProgressIndicator()
        error != <span class="hljs-literal">null</span> -&gt; Text(<span class="hljs-string">"é”™è¯¯: <span class="hljs-variable">$error</span>"</span>, color = Color.Red)
        user != <span class="hljs-literal">null</span> -&gt; Column {
            Text(<span class="hljs-string">"ç”¨æˆ·å: <span class="hljs-subst">${user!!.name}</span>"</span>, style = MaterialTheme.typography.bodyLarge)
            Text(<span class="hljs-string">"é‚®ç®±: <span class="hljs-subst">${user!!.email}</span>"</span>)
        }
    }
}
</code></pre>
<p>ä»£ç æ ¸å¿ƒï¼šåˆ‡æ¢ userId â†’ è‡ªåŠ¨å–æ¶ˆæ—§è¯·æ±‚ï¼Œå‘èµ·æ–°è¯·æ±‚</p>
<ul>
<li>åœºæ™¯äºŒï¼šä¸€æ¬¡æ€§ä»»åŠ¡åˆå§‹åŒ–ï¼ˆæ—¥å¿—ã€åŸ‹ç‚¹ã€ç¬¬ä¸‰æ–¹åˆå§‹åŒ–ï¼‰</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">AnalyticsScreen</span><span class="hljs-params">(screenName: <span class="hljs-type">String</span>)</span></span> {
    LaunchedEffect(<span class="hljs-built_in">Unit</span>) {  <span class="hljs-comment">// åªæ‰§è¡Œä¸€æ¬¡</span>
        <span class="hljs-comment">//Analytics.uploadPoint(screenName)</span>
        Log.i(<span class="hljs-string">"å½“å‰é¡µé¢: <span class="hljs-variable">$screenName</span>"</span>)
    }

    Text(<span class="hljs-string">"å½“å‰é¡µé¢: <span class="hljs-variable">$screenName</span>"</span>)
}
</code></pre>
<p>ä¸ºä»€ä¹ˆä½¿ç”¨Unitï¼Ÿ<strong>Unitåœ¨Kotliné‡Œé¢æ˜¯å¸¸é‡ï¼Œæ„å‘³ç€keyæ°¸è¿œä¸å˜</strong>ï¼Œæ‰€ä»¥åªåœ¨é¡µé¢é¦–æ¬¡è¿›å…¥æ—¶æ‰§è¡Œä¸€æ¬¡ã€‚<br/>
å°çŸ¥è¯†ï¼šLaunchedEffect(true)å’ŒLaunchedEffect(Unit)è¡Œä¸ºä¸€è‡´ï¼Œå› ä¸º true ä¹Ÿæ˜¯å¸¸é‡ã€‚ä½† trueå®¹æ˜“è®©äººè¯¯è§£ä¸ºâ€œæ¯æ¬¡éƒ½æ‰§è¡Œâ€ï¼Œå»ºè®®ç»Ÿä¸€ç”¨ Unitã€‚</p>
<ul>
<li>åœºæ™¯ä¸‰ï¼šè½®è¯¢(å®æ—¶è·å–æ•°æ®)</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">GoldPrice</span><span class="hljs-params">(symbol: <span class="hljs-type">String</span>)</span></span> {
    <span class="hljs-keyword">var</span> price <span class="hljs-keyword">by</span> remember { mutableStateOf&lt;Price?&gt;(<span class="hljs-literal">null</span>) }
    LaunchedEffect(symbol) {
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            price = withContext(Dispatchers.IO) {
                GoldPriceRetrofitClient.apiService.getGoldPrice(symbol)
            }
            delay(<span class="hljs-number">30_000</span>)
        }
    }
    Card(
        modifier = Modifier.padding(<span class="hljs-number">16.</span>dp),
        elevation = CardDefaults.cardElevation(defaultElevation = <span class="hljs-number">4.</span>dp)
    ) {
        Column(modifier = Modifier.padding(<span class="hljs-number">16.</span>dp)) {
            Text(symbol, style = MaterialTheme.typography.bodyMedium)
            Text(<span class="hljs-string">"Â¥<span class="hljs-subst">${price?.price?:<span class="hljs-string">"æœªçŸ¥"</span>}</span>"</span>, style = MaterialTheme.typography.bodyLarge)
        }
    }
}
</code></pre>
<p>ä»£ç æ ¸å¿ƒï¼šæ¯30ç§’è·å–ä¸€æ¬¡é‡‘ä»·ã€‚è°ƒæ•´å•†å“ç¼–ç æ—¶ï¼Œè‡ªåŠ¨åœæ­¢æ—§å•†å“è½®è¯¢ï¼Œå¼€å§‹æ–°è½®è¯¢ã€‚</p>
<ul>
<li>åœºæ™¯å››ï¼šæ‰§è¡Œä¸€ä¸ªåç¨‹</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">LoadData</span><span class="hljs-params">(viewModel: <span class="hljs-type">SideEffectsViewModel</span> = viewModel()</span></span>) {
    <span class="hljs-keyword">var</span> user <span class="hljs-keyword">by</span> remember { mutableStateOf&lt;User?&gt;( <span class="hljs-literal">null</span>) }
    LaunchedEffect(<span class="hljs-built_in">Unit</span>) {
        user = viewModel.getUserInfo(<span class="hljs-number">1</span>)
    }
}
</code></pre>
<p>ä»£ç æ ¸å¿ƒï¼šæ‰§è¡Œè·å–ç”¨æˆ·æŸ¥è¯¢çš„supendçš„æ–¹æ³•</p>
<h3 data-id="heading-5">4ã€å¿«é€Ÿè®°å¿†</h3>
<p>è¿›å…¥é¡µ â†’ è‡ªåŠ¨å¯åŠ¨ â†’ keyå˜åŒ–è‡ªåŠ¨é‡å¯ â†’ ç¦»å¼€è‡ªåŠ¨å–æ¶ˆ</p>
<h3 data-id="heading-6">5ã€å¸¸çŠ¯é”™è¯¯</h3>

























<table><thead><tr><th>é”™è¯¯</th><th>åæœ</th><th>æ­£ç¡®</th></tr></thead><tbody><tr><td><code>LaunchedEffect(true)</code></td><td>æ˜“äº§ç”Ÿè¯­ä¹‰æ­§ä¹‰</td><td>ç”¨ <code>Unit</code></td></tr><tr><td>ä¸ç”¨ <code>withContext(IO)</code></td><td>é˜»å¡ UI</td><td>å¿…é¡»åˆ‡çº¿ç¨‹</td></tr><tr><td>å¿˜è®° <code>key</code></td><td>æ•°æ®ä¸æ›´æ–°</td><td>å¿…é¡»åŠ ä¾èµ–å‚æ•°</td></tr></tbody></table>
<h3 data-id="heading-7">6ã€æ€»ç»“</h3>
<p>LaunchedEffect æ˜¯Composeä¸­<strong>é¡µé¢çº§å¼‚æ­¥ä»»åŠ¡</strong>çš„é¦–é€‰ï¼Œkey+è‡ªåŠ¨å–æ¶ˆæ˜¯å…¶æ ¸å¿ƒã€‚</p>
<h2 data-id="heading-8">DisposableEffect</h2>
<h3 data-id="heading-9">1ã€æ¦‚æ‹¬</h3>
<p>DisposableEffect(key) = ã€Œè¿›å…¥æ—¶æ³¨å†Œï¼Œç¦»å¼€æ—¶è‡ªåŠ¨æ¸…ç†ã€çš„èµ„æºç®¡ç†ç¥å™¨</p>
<h3 data-id="heading-10">2ã€æ ¸å¿ƒæœºåˆ¶</h3>





















<table><thead><tr><th>æœºåˆ¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>è¿›å…¥æ—¶æ‰§è¡Œ</strong></td><td>Composable è¿›å…¥ç»„åˆæ—¶ï¼Œæ‰§è¡Œ <code>effect</code> å—</td></tr><tr><td><strong>key æ§åˆ¶</strong></td><td><code>key</code> å˜åŒ– â†’ <strong>å…ˆ <code>onDispose</code>ï¼Œå†é‡æ–°æ³¨å†Œ</strong></td></tr><tr><td><strong>ç¦»å¼€æ—¶è‡ªåŠ¨æ¸…ç†</strong></td><td>ç¦»å¼€é¡µé¢ â†’ <strong>è‡ªåŠ¨è°ƒç”¨ <code>onDispose</code></strong>ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</td></tr></tbody></table>
<h3 data-id="heading-11">3ã€å®é™…å¼€å‘ä¸­åœºæ™¯</h3>
<ul>
<li>åœºæ™¯ä¸€ï¼šæ³¨å†Œ/æ³¨é”€å¹¿æ’­æ¥æ”¶å™¨ï¼ˆæœ€å¸¸è§ï¼‰</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">NetworkChangeListener</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span> {
    <span class="hljs-keyword">val</span> connectivityManager = remember { 
        context.getSystemService(Context.CONNECTIVITY_SERVICE) <span class="hljs-keyword">as</span> ConnectivityManager 
    }
    <span class="hljs-keyword">var</span> isConnected <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-literal">true</span>) }

    DisposableEffect(<span class="hljs-built_in">Unit</span>) {
        <span class="hljs-keyword">val</span> callback = <span class="hljs-keyword">object</span> : ConnectivityManager.NetworkCallback() {
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onAvailable</span><span class="hljs-params">(network: <span class="hljs-type">Network</span>)</span></span> {
                isConnected = <span class="hljs-literal">true</span>
            }
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onLost</span><span class="hljs-params">(network: <span class="hljs-type">Network</span>)</span></span> {
                isConnected = <span class="hljs-literal">false</span>
            }
        }

        connectivityManager.registerDefaultNetworkCallback(callback)

        onDispose {
            connectivityManager.unregisterNetworkCallback(callback) <span class="hljs-comment">// å¿…é¡»æ¸…ç†ï¼</span>
        }
    }

    Card(
        colors = CardDefaults.cardColors(
            containerColor = <span class="hljs-keyword">if</span> (isConnected) Color.Green <span class="hljs-keyword">else</span> Color.Red
        )
    ) {
        Text(
            text = <span class="hljs-keyword">if</span> (isConnected) <span class="hljs-string">"åœ¨çº¿"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"ç¦»çº¿"</span>,
            color = Color.White,
            modifier = Modifier.padding(<span class="hljs-number">8.</span>dp)
        )
    }
}
</code></pre>
<p>ä»£ç æ ¸å¿ƒï¼šç›‘å¬è®¾å¤‡ç½‘ç»œçŠ¶æ€ï¼Œæ–­å¼€ç½‘ç»œæ˜¾ç¤ºç¦»çº¿ï¼Œå¦åˆ™æ˜¾ç¤ºåœ¨çº¿ã€‚</p>
<ul>
<li>åœºæ™¯äºŒï¼šæ·»åŠ ç§»é™¤ä¼ æ„Ÿå™¨</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">StepCounter</span><span class="hljs-params">(sensorManager: <span class="hljs-type">SensorManager</span>)</span></span> {
    <span class="hljs-keyword">var</span> steps <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-number">0</span>) }

    DisposableEffect(<span class="hljs-built_in">Unit</span>) {
        <span class="hljs-keyword">val</span> sensor = sensorManager.getDefaultSensor(Sensor.TYPE_STEP_COUNTER)
        <span class="hljs-keyword">val</span> listener = <span class="hljs-keyword">object</span> : SensorEventListener {
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSensorChanged</span><span class="hljs-params">(event: <span class="hljs-type">SensorEvent</span>)</span></span> {
                steps = event.values[<span class="hljs-number">0</span>].toInt()
            }
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onAccuracyChanged</span><span class="hljs-params">(sensor: <span class="hljs-type">Sensor</span>, accuracy: <span class="hljs-type">Int</span>)</span></span> {}
        }

        sensorManager.registerListener(listener, sensor, SensorManager.SENSOR_DELAY_UI)

        onDispose {
            sensorManager.unregisterListener(listener)
        }
    }

    Text(<span class="hljs-string">"ä»Šæ—¥æ­¥æ•°: <span class="hljs-variable">$steps</span> æ­¥"</span>, style = MaterialTheme.typography.headlineMedium)
}
</code></pre>
<p>ä»£ç æ ¸å¿ƒï¼šå®æ—¶ç›‘æµ‹è¿åŠ¨ä¼ æ„Ÿå™¨ï¼Œç»Ÿè®¡æ­¥æ•°ã€‚</p>
<ul>
<li>åœºæ™¯ä¸‰ï¼šè®¢é˜…å–æ¶ˆFlow(ViewModel æ­é…ä½¿ç”¨)</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">FlowSubscription</span><span class="hljs-params">(viewModel: <span class="hljs-type">SideEffectsViewModel</span> = viewModel()</span></span>) {
    <span class="hljs-keyword">var</span> message <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-string">"ç­‰å¾…æ¶ˆæ¯..."</span>) }

    DisposableEffect(<span class="hljs-built_in">Unit</span>) {
        <span class="hljs-keyword">val</span> job = viewModel.messageFlow
            .onEach { message = it }
            .launchIn(viewModel.viewModelScope)

        onDispose {
            job.cancel() <span class="hljs-comment">// å–æ¶ˆè®¢é˜…</span>
        }
    }
    Column(modifier = Modifier.fillMaxSize()) {
        Button(onClick = {
            viewModel.sendMessage()
        }, modifier = Modifier.padding(<span class="hljs-number">16.</span>dp)) {
            Text(<span class="hljs-string">"ç‚¹å‡»å‘æ¶ˆæ¯"</span>)
        }

        Text(message)
    }
}
</code></pre>
<p>ä»£ç æ ¸å¿ƒï¼šç¦»å¼€æ—¶ï¼Œè‡ªåŠ¨å–æ¶ˆFlow</p>
<ul>
<li>åœºæ™¯å››ï¼škeyå˜åŒ–æ—¶ï¼Œé‡ç½®èµ„æºï¼ˆå¦‚åˆ‡æ¢ç”¨æˆ·ï¼‰</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserSessionTracker</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span> {
    DisposableEffect(userId) {
        LoginManager.login(userId)
        println(<span class="hljs-string">"ç”¨æˆ· <span class="hljs-variable">$userId</span> å·²ç™»å½•"</span>)

        onDispose {
            LoginManager.logout()
            println(<span class="hljs-string">"ç”¨æˆ·å·²ç™»å‡º"</span>)
        }
    }

    Text(<span class="hljs-string">"å½“å‰ç”¨æˆ·: <span class="hljs-variable">$userId</span>"</span>)
}
</code></pre>
<p>ä»£ç æ ¸å¿ƒï¼šåˆ‡æ¢ userId â†’ è‡ªåŠ¨ç™»å‡ºæ—§ç”¨æˆ·ï¼Œç™»å½•æ–°ç”¨æˆ·</p>
<h3 data-id="heading-12">4ã€å¿«é€Ÿè®°å¿†</h3>
<p>è¿›å…¥æ³¨å†Œ â†’ keyå˜åŒ–é‡ç½® â†’ ç¦»å¼€è‡ªåŠ¨æ¸…ç† â†’ å®‰å…¨æ— æ³„æ¼</p>
<h3 data-id="heading-13">5ã€å¸¸è§é”™è¯¯</h3>

























<table><thead><tr><th>é”™è¯¯</th><th>åæœ</th><th>æ­£ç¡®</th></tr></thead><tbody><tr><td>å¿˜è®° <code>onDispose</code></td><td>å†…å­˜æ³„æ¼</td><td>å¿…é¡»æ¸…ç†</td></tr><tr><td>ç”¨ <code>LaunchedEffect</code> æ³¨å†Œç›‘å¬</td><td>æ— æ³•æ‰‹åŠ¨æ¸…ç†</td><td>ç”¨ <code>DisposableEffect</code></td></tr><tr><td><code>key</code> å†™é”™</td><td>é‡å¤æ³¨å†Œ</td><td>ç”¨ç¨³å®š key</td></tr></tbody></table>
<h3 data-id="heading-14">6ã€æ€»ç»“</h3>
<p>DisposableEffect æ˜¯ Compose ä¸­ã€Œèµ„æºç”Ÿå‘½å‘¨æœŸç®¡ç†ã€çš„å”¯ä¸€æ­£ç¡®æ–¹å¼ï¼Œ æŒæ¡ onDispose + keyï¼Œè§£å†³å†…å­˜æ³„æ¼çš„é—®é¢˜</p>
<h2 data-id="heading-15">SideEffect</h2>
<h3 data-id="heading-16">1ã€ä¸€å¥è¯æ¦‚æ‹¬</h3>
<p>SideEffect = ã€Œæ¯æ¬¡é‡ç»„éƒ½æ‰§è¡Œä¸€æ¬¡ã€çš„è½»é‡å‰¯ä½œç”¨ï¼Œä¸è‡ªåŠ¨å–æ¶ˆï¼Œé€‚åˆæ—¥å¿—ã€åŸ‹ç‚¹ã€åŒæ­¥é Compose çŠ¶æ€</p>
<h3 data-id="heading-17">2ã€æ ¸å¿ƒæœºåˆ¶</h3>





















<table><thead><tr><th>æœºåˆ¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ¯æ¬¡é‡ç»„éƒ½æ‰§è¡Œ</strong></td><td>åªè¦ UI é‡ç»„ï¼Œ<code>SideEffect</code> å°±è¿è¡Œä¸€æ¬¡</td></tr><tr><td><strong>æ—  key æ§åˆ¶</strong></td><td>ä¸æ”¯æŒ <code>key</code>ï¼Œ<strong>ä¸èƒ½é‡å¯æˆ–å–æ¶ˆ</strong></td></tr><tr><td><strong>ä¸è‡ªåŠ¨æ¸…ç†</strong></td><td>ç¦»å¼€é¡µé¢ä¸ä¼šè‡ªåŠ¨å–æ¶ˆï¼Œ<strong>éœ€æ‰‹åŠ¨æ§åˆ¶</strong></td></tr></tbody></table>
<h3 data-id="heading-18">3ã€å®é™…å¼€å‘ä¸­çš„å››å¤§åœºæ™¯</h3>
<ul>
<li>åœºæ™¯ä¸€ï¼šé¡µé¢æ›å…‰åŸ‹ç‚¹ï¼ˆå¸¸è§ï¼‰</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">AnalyticsScreen</span><span class="hljs-params">(screenName: <span class="hljs-type">String</span>)</span></span> {
    SideEffect {
        Analytics.logScreenView(screenName)  <span class="hljs-comment">// æ¯æ¬¡é‡ç»„éƒ½ä¸ŠæŠ¥</span>
        Log.i(<span class="hljs-string">"compose æ›å…‰"</span>,<span class="hljs-string">"æ›å…‰: <span class="hljs-variable">$screenName</span>"</span>)
    }

    Text(<span class="hljs-string">"å½“å‰é¡µé¢: <span class="hljs-variable">$screenName</span>"</span>)
}
</code></pre>
<ul>
<li>åœºæ™¯äºŒï¼šæ—¥å¿—è¾“å‡ºåŠè°ƒè¯•</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">DebugRecomposition</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> count <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-number">0</span>) }

    SideEffect {
        Log.d(<span class="hljs-string">"composeæ—¥å¿—"</span>,<span class="hljs-string">"é‡ç»„å‘ç”Ÿäº†ï¼count = <span class="hljs-variable">$count</span>"</span>)
    }

    Column {
        Text(<span class="hljs-string">"Count: <span class="hljs-variable">$count</span>"</span>)
        Button(onClick = { count++ }) { Text(<span class="hljs-string">"åŠ 1"</span>) }
    }
}
</code></pre>
<ul>
<li>åœºæ™¯ä¸‰ï¼šåŒæ­¥æˆ–å‘é€æ•°æ®åˆ°å¤–éƒ¨ï¼ˆå¦‚SharedPreferencesã€EventBusã€ViewModelï¼‰</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">SyncTheme</span><span class="hljs-params">(isDark: <span class="hljs-type">Boolean</span>)</span></span> {
    <span class="hljs-keyword">val</span> prefs = LocalContext.current.getSharedPreferences(<span class="hljs-string">"settings"</span>, Context.MODE_PRIVATE)
    SideEffect {
        prefs.edit().putBoolean(<span class="hljs-string">"dark_mode"</span>, isDark).apply()
        Log.d(<span class="hljs-string">"compose æ—¥å¿—"</span>, <span class="hljs-string">"ä¸»é¢˜å·²ä¿å­˜: <span class="hljs-subst">${if (isDark) <span class="hljs-string">"æ·±è‰²"</span> else <span class="hljs-string">"æµ…è‰²"</span>}</span>"</span>)
        EventBus.post(isDark)
    }

    <span class="hljs-comment">// UI...</span>
}
</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">BrightnessControl</span><span class="hljs-params">(viewModel: <span class="hljs-type">SideEffectsViewModel</span> = viewModel()</span></span>) {
    <span class="hljs-keyword">var</span> brightness <span class="hljs-keyword">by</span> remember { mutableFloatStateOf(<span class="hljs-number">0.5f</span>) }

    <span class="hljs-comment">// æ¯æ¬¡ brightness æ”¹å˜å¹¶é‡ç»„å®Œæˆåï¼ŒåŒæ­¥åˆ° ViewModel</span>
    SideEffect {
        viewModel.currentBrightness = brightness
    }

    Column(horizontalAlignment = Alignment.CenterHorizontally) {
        Text(<span class="hljs-string">"å½“å‰äº®åº¦: <span class="hljs-subst">${(brightness * <span class="hljs-number">100</span>).toInt()}</span>%"</span>)
        Slider(value = brightness, onValueChange = { brightness = it })
    }
}
</code></pre>
<p>æ ¸å¿ƒï¼šæ¯æ¬¡åˆ‡æ¢ä¸»é¢˜ â†’ è‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°ï¼Œå¹¶é€šçŸ¥å…¶ä»–é¡µé¢</p>
<ul>
<li>åœºæ™¯å››ï¼šä¸é Compose ç»„ä»¶é€šä¿¡ï¼ˆå¦‚ TextureViewï¼‰</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">CameraPreview</span><span class="hljs-params">(textureView: <span class="hljs-type">TextureView</span>)</span></span> {
    SideEffect {
        CameraManager.bind(textureView.surfaceTexture)
    }

    AndroidView(factory = { textureView })
}
</code></pre>
<h3 data-id="heading-19">4ã€å¿«é€Ÿè®°å¿†</h3>
<p>é‡ç»„å°±è·‘ï¼Œè½»é‡é€‰å®ƒï¼Œæ—¥å¿—åŸ‹ç‚¹ï¼Œé¦–é€‰SideEffectã€‚</p>
<h3 data-id="heading-20">5ã€å¸¸è§é”™è¯¯</h3>

























<table><thead><tr><th>é”™è¯¯</th><th>åæœ</th><th>æ­£ç¡®</th></tr></thead><tbody><tr><td>æ”¾ç½‘ç»œè¯·æ±‚</td><td>æ¯æ¬¡é‡ç»„éƒ½è¯·æ±‚</td><td>ç”¨ <code>LaunchedEffect</code></td></tr><tr><td>æ”¾è€—æ—¶æ“ä½œ(éè½»é‡)</td><td>å¡ UI</td><td>ç”¨ <code>withContext(IO)</code> + <code>LaunchedEffect</code></td></tr><tr><td>æœŸæœ›åªæ‰§è¡Œä¸€æ¬¡</td><td>ä¸ä¼š</td><td>ç”¨ <code>LaunchedEffect(Unit)</code></td></tr></tbody></table>
<p>æ€»ç»“ï¼šæ¯æ¬¡é‡ç»„éƒ½ä¼šæ‰§è¡Œã€‚æ³¨æ„ï¼š<code>SideEffect</code> æ˜¯åœ¨ <strong>é‡ç»„å®Œæˆåç«‹å³æ‰§è¡Œ</strong>ï¼Œæ²¡æœ‰åç¨‹ã€‚è€Œ <code>LaunchedEffect</code> æ˜¯åœ¨è¿›å…¥ç»„åˆæ—¶å¯åŠ¨åç¨‹ã€‚</p>
<h2 data-id="heading-21">rememberCoroutineScope</h2>
<h3 data-id="heading-22">1ã€ä¸€å¥è¯æ¦‚æ‹¬ï¼š</h3>
<p>rememberCoroutineScope() = ã€Œ<strong>æ‰‹åŠ¨ã€å¯æ§ã€ç”Ÿå‘½å‘¨æœŸå®‰å…¨</strong>ã€çš„åç¨‹ä½œç”¨åŸŸï¼Œ<strong>é‡ç»„ä¸é‡å¯ï¼Œç¦»å¼€é¡µé¢è‡ªåŠ¨å–æ¶ˆ</strong>ã€‚</p>
<h3 data-id="heading-23">2ã€æ ¸å¿ƒæœºåˆ¶</h3>





















<table><thead><tr><th>æœºåˆ¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ‰‹åŠ¨å¯åŠ¨</strong></td><td>å¿…é¡» <code>scope.launch { }</code> æ‰æ‰§è¡Œ</td></tr><tr><td><strong>é‡ç»„ä¸å½±å“</strong></td><td>é‡ç»„æ—¶ <strong>åŒä¸€ä¸ª scope</strong>ï¼Œä¸ä¼šé‡æ–°åˆ›å»º</td></tr><tr><td><strong>è‡ªåŠ¨å–æ¶ˆ</strong></td><td>ç¦»å¼€é¡µé¢ â†’ <strong>è‡ªåŠ¨ <code>cancel()</code></strong> ï¼Œæ‰€æœ‰åç¨‹åœæ­¢</td></tr></tbody></table>
<h3 data-id="heading-24">3ã€å¸¸ç”¨åœºæ™¯</h3>
<ul>
<li>åœºæ™¯ä¸€ï¼šå¼‚æ­¥æ“ä½œï¼ˆå¦‚æ–‡ä»¶ä¿å­˜ï¼Œæœ€å¸¸è§ï¼‰</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">SaveButton</span><span class="hljs-params">(viewModel: <span class="hljs-type">SaveViewModel</span>)</span></span> {
    <span class="hljs-keyword">val</span> scope = rememberCoroutineScope()
    <span class="hljs-keyword">var</span> saving <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-literal">false</span>) }

    Button(
        enabled = !saving,
        onClick = {
            saving = <span class="hljs-literal">true</span>
            scope.launch {
                <span class="hljs-keyword">try</span> {
                    viewModel.saveData()  <span class="hljs-comment">// æ¨¡æ‹Ÿæ–‡ä»¶ä¿å­˜</span>
                } <span class="hljs-keyword">finally</span> {
                    saving = <span class="hljs-literal">false</span>  <span class="hljs-comment">// å‘é€é”™è¯¯æ—¶ï¼Œé‡ç½®UI</span>
                }
            }
        }
    ) {
        Text(<span class="hljs-keyword">if</span> (saving) <span class="hljs-string">"ä¿å­˜ä¸­..."</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"ä¿å­˜"</span>)
    }
}
</code></pre>
<p>åœºæ™¯äºŒï¼šå®šæ—¶ä»»åŠ¡</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">TimerWithCoroutineScope</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> scope = rememberCoroutineScope()
    <span class="hljs-keyword">var</span> count <span class="hljs-keyword">by</span> remember { mutableIntStateOf(<span class="hljs-number">0</span>) }
    
    Button(onClick = {
        scope.launch {
            repeat(<span class="hljs-number">10</span>) {
                delay(<span class="hljs-number">1000</span>)
                count++
            }
        }
    }) {
        Text(<span class="hljs-string">"å¼€å§‹å®šæ—¶ä»»åŠ¡"</span>)
    }
    
    Text(<span class="hljs-string">"è®¡æ•°: <span class="hljs-variable">$count</span>"</span>)
}
</code></pre>
<p>åœºæ™¯ä¸‰ï¼šæ‰¹é‡å¤„ç†</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">BatchProcess</span><span class="hljs-params">(items: <span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt;)</span></span> {
    <span class="hljs-keyword">val</span> scope = rememberCoroutineScope()
    <span class="hljs-keyword">var</span> progress <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-number">0</span>) }

    Button(onClick = {
        scope.launch {
            items.forEachIndexed { index, item -&gt;
                processItem(item)
                progress = index + <span class="hljs-number">1</span>
            }
        }
    }) {
        Text(<span class="hljs-string">"å¤„ç† <span class="hljs-subst">${items.size}</span> é¡¹"</span>)
    }
    LinearProgressIndicator(progress = progress / items.size.toFloat())
}
</code></pre>
<ul>
<li>åœºæ™¯å››ï¼šä¸Snackbaræ­é…ï¼ˆMaterial3 å¸¸è§ç”¨æ³•ï¼‰</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@OptIn(ExperimentalMaterial3Api::class)</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">SnackbarExample</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> snackbarHostState = remember { SnackbarHostState() }
    <span class="hljs-keyword">val</span> scope = rememberCoroutineScope()

    Scaffold(
        snackbarHost = { SnackbarHost(snackbarHostState) },
        floatingActionButton = {
            FloatingActionButton(onClick = {
                scope.launch {
                    snackbarHostState.showSnackbar(<span class="hljs-string">"Hello Snackbar!"</span>)
                }
            }) {
                Text(<span class="hljs-string">"ç‚¹æˆ‘"</span>)
            }
        }
    ) { padding -&gt;
        Box(Modifier.fillMaxSize().padding(padding), contentAlignment = Alignment.Center) {
            Text(<span class="hljs-string">"ç‚¹å‡»å³ä¸‹è§’æŒ‰é’®æ˜¾ç¤º Snackbar"</span>)
        }
    }
}

</code></pre>
<h3 data-id="heading-25">4ã€å¿«é€Ÿè®°å¿†</h3>
<p>rememberCoroutineScope â†’ æ‰‹åŠ¨ launch â†’ è‡ªåŠ¨å–æ¶ˆ â†’ é‡ç»„ä¸é‡å¯<br/>
å®ƒä¸ <code>LaunchedEffect</code> æœ€å¤§çš„åŒºåˆ«æ˜¯ï¼š<strong>éœ€è¦äº‹ä»¶è§¦å‘</strong> è€Œä¸æ˜¯è‡ªåŠ¨æ‰§è¡Œã€‚</p>
<h3 data-id="heading-26">5ã€å¸¸è§é”™è¯¯</h3>

























<table><thead><tr><th>é”™è¯¯</th><th>åæœ</th><th>æ­£ç¡®</th></tr></thead><tbody><tr><td>ç”¨ <code>LaunchedEffect</code> æ”¾ç‚¹å‡»</td><td>æ¯æ¬¡é‡ç»„éƒ½å¼¹</td><td>ç”¨ <code>scope.launch</code></td></tr><tr><td>ä¸ç”¨ <code>remember</code></td><td>æ¯æ¬¡é‡ç»„æ–° scope</td><td>å¿…é¡» <code>rememberCoroutineScope()</code></td></tr><tr><td>ç”¨ <code>GlobalScope</code></td><td>æ— æ³•å–æ¶ˆ</td><td>ç¦æ­¢ä½¿ç”¨ï¼</td></tr></tbody></table>
<h3 data-id="heading-27">6ã€æ€»ç»“</h3>
<p>rememberCoroutineScope æ˜¯ Compose ä¸­ã€Œç”¨æˆ·äº¤äº’ â†’ å¼‚æ­¥æ“ä½œã€çš„æœ€ä½³å®è·µï¼Œéœ€è¦æ‰‹åŠ¨å¯åŠ¨åç¨‹ï¼Œé¦–é€‰é€‰ä»–ã€‚</p>
<h2 data-id="heading-28">ProduceState</h2>
<h3 data-id="heading-29">1ã€ä¸€å¥è¯æ¦‚æ‹¬</h3>
<p>produceState = ã€Œå¤–éƒ¨æ•°æ®æº è½¬åŒ–ä¸º Compose Stateã€çš„æ¡¥æ¢ï¼Œè‡ªåŠ¨åç¨‹ + è‡ªåŠ¨å–æ¶ˆ + æ”¯æŒ key</p>
<h3 data-id="heading-30">2ã€æ ¸å¿ƒæœºåˆ¶</h3>

























<table><thead><tr><th>æœºåˆ¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>åç¨‹ç”Ÿäº§ State</strong></td><td>åœ¨åç¨‹ä¸­ <code>value = xxx</code> â†’ è‡ªåŠ¨è§¦å‘ UI é‡ç»„</td></tr><tr><td><strong>è‡ªåŠ¨ç”Ÿå‘½å‘¨æœŸ</strong></td><td>è¿›å…¥ â†’ å¯åŠ¨åç¨‹ï¼›ç¦»å¼€ â†’ è‡ªåŠ¨å–æ¶ˆ</td></tr><tr><td><strong>key æ§åˆ¶é‡å¯</strong></td><td><code>key</code> å˜ â†’ å–æ¶ˆæ—§åç¨‹ï¼Œå¯åŠ¨æ–°åç¨‹</td></tr><tr><td>å…¶æ›´åƒæ˜¯collectAsState()çš„å¢å¼ºç‰ˆæœ¬ï¼Œæ”¯æŒä»»æ„æ•°æ®æºï¼Œè€ŒcollectAsStateåˆ™åªèƒ½æ¥æºäºFlowã€‚</td><td/></tr></tbody></table>
<h3 data-id="heading-31">å¸¸ç”¨åœºæ™¯</h3>
<ul>
<li>åœºæ™¯ä¸€ï¼šè¯·æ±‚ç½‘ç»œæ•°æ®(æœ€å¸¸è§)</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserInfo</span><span class="hljs-params">(userId: <span class="hljs-type">Int</span>)</span></span> {
    <span class="hljs-keyword">val</span> user <span class="hljs-keyword">by</span> produceState&lt;User?&gt;(initialValue = <span class="hljs-literal">null</span>, userId) {
        value = withContext(Dispatchers.IO) {
            RetrofitClient.apiService.getUsersById(userId)  <span class="hljs-comment">//æ ¹æ®userIdè·å–ç”¨æˆ·æ•°æ®</span>
        }
    }

    <span class="hljs-keyword">when</span> (user) {
        <span class="hljs-literal">null</span> -&gt; CircularProgressIndicator()
        <span class="hljs-keyword">else</span> -&gt; Text(<span class="hljs-string">"æ¬¢è¿ï¼Œ<span class="hljs-subst">${user!!.name}</span>"</span>)
    }
}
</code></pre>
<ul>
<li>åœºæ™¯äºŒï¼šFlow -&gt; Stateï¼ˆè¾ƒå¸¸è§ï¼‰ï¼Œæ›¿ä»£collectAsState</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SideEffectsViewModel</span> : <span class="hljs-type">ViewModel</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _count = MutableStateFlow(<span class="hljs-number">0</span>)
    <span class="hljs-keyword">val</span> countFlow = _count.asStateFlow()
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span></span> = _count.value++
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">FlowCounter</span><span class="hljs-params">(viewModel: <span class="hljs-type">SideEffectsViewModel</span> = viewModel()</span></span>) {
    <span class="hljs-comment">//åŸå†™æ³•</span>
    <span class="hljs-comment">// val count by viewModel.collectAsState()</span>
    <span class="hljs-keyword">val</span> count <span class="hljs-keyword">by</span> produceState(initialValue = <span class="hljs-number">0</span>) {
        viewModel.countFlow.collect { value = it }
    }

    Text(<span class="hljs-string">"Count: <span class="hljs-variable">$count</span>"</span>)
}
</code></pre>
<ul>
<li>åœºæ™¯ä¸‰ï¼šå›è°ƒå‡½æ•°-&gt; State</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">LocationNow</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>, locationManager: <span class="hljs-type">LocationManager</span>)</span></span> {
    <span class="hljs-keyword">val</span> location <span class="hljs-keyword">by</span> produceState&lt;String?&gt;(initialValue = <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">val</span> listener = LocationListener { location -&gt; value = <span class="hljs-string">"ç»åº¦: <span class="hljs-subst">${location.longitude}</span>, çº¬åº¦: <span class="hljs-subst">${location.latitude}</span>"</span> }
        <span class="hljs-comment">//æƒé™æ£€æŸ¥ä»£ç çœç•¥</span>
        locationManager.requestLocationUpdates(
            LocationManager.GPS_PROVIDER,
            <span class="hljs-number">2000L</span>,
            <span class="hljs-number">1f</span>,
            listener)

        awaitDispose {
            locationManager.removeUpdates(listener)
        }
    }
    
    <span class="hljs-keyword">if</span> (location == <span class="hljs-literal">null</span>) {
        Text(<span class="hljs-string">"æ­£åœ¨è·å–ä½ç½®..."</span>)
    } <span class="hljs-keyword">else</span> {
        Text(<span class="hljs-string">"location"</span>)
    }
}
</code></pre>
<ul>
<li>åœºæ™¯å››ï¼šçŠ¶æ€å¤„ç†</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Result</span>&lt;<span class="hljs-type">out T</span>&gt; {
    <span class="hljs-keyword">object</span> Loading : Result&lt;<span class="hljs-built_in">Nothing</span>&gt;()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Success</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: T) : Result&lt;T&gt;()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Error</span>(<span class="hljs-keyword">val</span> message: String) : Result&lt;<span class="hljs-built_in">Nothing</span>&gt;()
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">loadData</span><span class="hljs-params">(
    key: <span class="hljs-type">Any</span>?,
    block: <span class="hljs-type">suspend</span> () -&gt; <span class="hljs-type">T</span>
)</span></span>: State&lt;Result&lt;T&gt;&gt; = produceState&lt;Result&lt;T&gt;&gt;(Result.Loading, key) {
    <span class="hljs-keyword">try</span> {
        value = Result.Success(block())
    } <span class="hljs-keyword">catch</span> (e: Exception) {
        value = Result.Error(e.message ?: <span class="hljs-string">"æœªçŸ¥é”™è¯¯"</span>)
    }
}
</code></pre>
<h3 data-id="heading-32">4ã€å¿«é€Ÿè®°å¿†</h3>
<p>ç”Ÿäº§ State â†’ åç¨‹è¿è¡Œ â†’ è‡ªåŠ¨å–æ¶ˆ â†’ key æ§åˆ¶é‡å¯</p>
<h3 data-id="heading-33">5ã€å¸¸è§é”™è¯¯</h3>

























<table><thead><tr><th>é”™è¯¯</th><th>åæœ</th><th>æ­£ç¡®</th></tr></thead><tbody><tr><td>ä¸ç”¨ <code>withContext(IO)</code></td><td>é˜»å¡ UI</td><td>å¿…é¡»åˆ‡çº¿ç¨‹</td></tr><tr><td>å¿˜è®° <code>key</code></td><td>æ•°æ®ä¸æ›´æ–°</td><td>åŠ ä¾èµ–å‚æ•°</td></tr><tr><td>è¿”å› <code>State</code></td><td>ç¼–è¯‘é”™è¯¯</td><td>å¿…é¡» <code>by produceState</code></td></tr></tbody></table>
<h3 data-id="heading-34">6ã€ç›¸ä¼¼å¯¹æ¯”</h3>

























<table><thead><tr><th>é¡¹ç›®</th><th><code>produceState</code></th><th><code>collectAsState()</code></th></tr></thead><tbody><tr><td>æ•°æ®æº</td><td>ä»»æ„</td><td>ä»… Flow</td></tr><tr><td>æ”¯æŒ key</td><td>Yes</td><td>No</td></tr><tr><td>è‡ªåŠ¨å–æ¶ˆ</td><td>Yes</td><td>Yes</td></tr></tbody></table>
<h3 data-id="heading-35">7.æ€»ç»“ï¼š</h3>
<p>produceState æ˜¯ Compose ä¸­ã€å¤–éƒ¨æ•°æ®æº -&gt; Stateã€‘çš„æœ€å¥½æ¡¥æ¢ï¼Œ ç†Ÿæ‚‰å®ƒï¼Œä½ å°±èƒ½å®ç°ä»»æ„æ•°æ®æºé©±åŠ¨UIå˜åŒ–äº†ã€‚</p>
<h2 data-id="heading-36">derivedStateOf</h2>
<p>æœ‰äººæŠŠè¿™ä¸ªå½’äºå‰¯ä½œç”¨å‡½æ•°ä¹‹ç±»ï¼Œä½†æˆ‘ä¸ªäººè§‰å¾—ä¸æ˜¯ã€‚åŸå› å¦‚ä¸‹ï¼š</p>
<ul>
<li>çº¯å‡½æ•°è®¡ç®—ï¼šåŸºäºå…¶ä»–çŠ¶æ€è®¡ç®—çš„æ´¾é€çŠ¶æ€ï¼Œä¸äº§ç”Ÿä»»ä½•å¤–éƒ¨å½±å“</li>
<li>æ— å¤–éƒ¨äº¤äº’ï¼šä¸æ‰§è¡ŒI/Oæ“ä½œï¼Œä¸å¯åŠ¨å¼‚æ­¥ä»»åŠ¡ã€ä¸ä¿®æ”¹å¤–éƒ¨çŠ¶æ€</li>
<li>ä¸ç›´æ¥å‚ä¸UIæ›´æ–°ï¼šè™½ç„¶åœ¨ Composable ä¸­è§¦å‘ï¼Œä½†åªæ˜¯å½±å“ UI çš„â€œå¤–éƒ¨ä¸–ç•Œâ€</li>
</ul>
<h3 data-id="heading-37">1ã€ä¸€å¥è¯æ¦‚æ‹¬ï¼š</h3>
<p>derivedStateOf { } = ã€Œåªæœ‰å½“ç»“æœçœŸæ­£å˜åŒ–æ—¶æ‰è§¦å‘é‡ç»„ã€ï¼Œé¿å…é‡å¤è®¡ç®— + å‡å°‘ UI é—ªçƒ</p>
<h3 data-id="heading-38">2ã€ä¸ºä»€ä¹ˆéœ€è¦derivedStateOfï¼Ÿ</h3>
<p>é—®é¢˜ï¼šé¢‘ç¹é‡ç»„å¯¼è‡´æ€§èƒ½æ‹‰èƒ¯</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserFilter</span><span class="hljs-params">(nameItems: <span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt;, query: <span class="hljs-type">String</span>)</span></span> {
    <span class="hljs-keyword">val</span> filtered = nameItems.filter { it.contains(query) }  <span class="hljs-comment">// æ¯æ¬¡é‡ç»„éƒ½è¿‡æ»¤ï¼</span>

    LazyColumn {
        nameItems(filtered) { Text(it) }
    }
}
</code></pre>
<p>è¿™æ®µä»£ç ä½ ä¼šå‘ç°query å˜ â†’ é‡ç»„ â†’ <strong>æ¯æ¬¡éƒ½é‡æ–° filter</strong>ã€‚ å³ä½¿ç»“æœæ²¡å˜ï¼Œä¹Ÿä¼šè§¦å‘ LazyColumn é‡ç»˜ â†’ <strong>æ€§èƒ½å·® + é—ªçƒ</strong>ã€‚<br/>
ç›¸å…³æ”¹è¿›å‚è€ƒåœºæ™¯ä¸€</p>
<h3 data-id="heading-39">3ã€å¸¸ç”¨åœºæ™¯</h3>
<ul>
<li>åœºæ™¯ä¸€ï¼šæœç´¢è¿‡æ»¤</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">SearchStr</span><span class="hljs-params">(nameItems: <span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt;, query: <span class="hljs-type">String</span>)</span></span> {
    <span class="hljs-comment">// ä½¿ç”¨ derivedStateOf åªåœ¨ query æˆ– nameItems å˜åŒ–æ—¶é‡æ–°è®¡ç®—</span>
    <span class="hljs-keyword">var</span> searchQuery <span class="hljs-keyword">by</span> remember { mutableStateOf(query) }
    <span class="hljs-keyword">val</span> filteredItems <span class="hljs-keyword">by</span> derivedStateOf {
        nameItems.filter { it.contains(searchQuery, ignoreCase = <span class="hljs-literal">true</span>) }
    }
    Column {
        TextField(value = searchQuery,
            onValueChange = { searchQuery = it },
            label = { Text(<span class="hljs-string">"æœç´¢"</span>) })
        LazyColumn {
            items(filteredItems) { item -&gt;
                Text(item)
            }
        }
    }
}
</code></pre>
<p>ä»£ç æ ¸å¿ƒï¼šå¿«é€Ÿè¾“å…¥æ—¶ â†’ åªæœ‰ç»“æœå˜äº†æ‰æ›´æ–°åˆ—è¡¨ï¼Œé™ä½äº†é‡ç»„æ¬¡æ•°</p>
<ul>
<li>åœºæ™¯äºŒï¼šåˆ†é¡µåŠ è½½åˆ¤æ–­</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">InfiniteList</span><span class="hljs-params">(items: <span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt;, onLoadMore: () -&gt; <span class="hljs-type">Unit</span>)</span></span> {
    <span class="hljs-keyword">val</span> listState = rememberLazyListState()
    
    <span class="hljs-comment">// åªæœ‰åˆ°è¾¾åº•éƒ¨æ—¶æ‰è§¦å‘</span>
    <span class="hljs-keyword">val</span> shouldLoadMore <span class="hljs-keyword">by</span> derivedStateOf {
        <span class="hljs-keyword">val</span> lastVisible = listState.layoutInfo.visibleItemsInfo.lastOrNull()?.index ?: <span class="hljs-number">0</span>
        lastVisible &gt;= items.size - <span class="hljs-number">2</span>
    }

    LaunchedEffect(shouldLoadMore) {
        <span class="hljs-keyword">if</span> (shouldLoadMore) onLoadMore()
    }

    LazyColumn(state = listState) {
        items(items) { Text(it) }
    }
}
</code></pre>
<p>ä»£ç æ ¸å¿ƒï¼šè®¡ç®—æ˜¯å¦è·ç¦»åº•éƒ¨è¿˜æœ‰ä¸¤ä¸ªItemï¼Œæ˜¯çš„è¯è§¦å‘åŠ è½½ä¸‹ä¸€é¡µå›è°ƒæ“ä½œã€‚</p>
<ul>
<li>åœºæ™¯ä¸‰ï¼šå…³è”æ•°æ®æˆ–çŠ¶æ€å®æ—¶è®¡ç®—ï¼ˆå¸¸è§ç”¨é€”ï¼‰</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span>  <span class="hljs-title">SumAndAvg</span><span class="hljs-params">(numbers: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Int</span>&gt;)</span></span> {
    <span class="hljs-keyword">val</span> sum <span class="hljs-keyword">by</span> remember {
        derivedStateOf {
            numbers.sum()
        }
    }
    <span class="hljs-keyword">val</span> avg <span class="hljs-keyword">by</span> remember {
        derivedStateOf {
            numbers.average()
        }
    }

    Card {
        Column(modifier = Modifier.padding(<span class="hljs-number">16.</span>dp)) {
            Text(<span class="hljs-string">"æ€»å’Œ: <span class="hljs-variable">$sum</span>"</span>)
            Text(<span class="hljs-string">"å¹³å‡: %.2f"</span>.format(avg))
            Text(<span class="hljs-string">"Numbers æ€»æ•°: <span class="hljs-subst">${numbers.size}</span>"</span>)
        }
    }
}
</code></pre>
<p>-åœºæ™¯å››ï¼šæ§ä»¶æ˜¾ç¤ºçŠ¶æ€åˆ¤æ–­ ï¼ˆå¸¸è§ï¼‰</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">TopButtonShow</span><span class="hljs-params">(listState: <span class="hljs-type">LazyListState</span>)</span></span> {
    <span class="hljs-keyword">val</span> scope = rememberCoroutineScope()
    <span class="hljs-keyword">val</span> showButton <span class="hljs-keyword">by</span> remember {
        derivedStateOf {
            listState.firstVisibleItemIndex &gt; <span class="hljs-number">0</span>
        }
    }

    AnimatedVisibility(showButton) {
        FloatingActionButton(onClick = {
            <span class="hljs-comment">// å›åˆ°é¡¶éƒ¨</span>
            scope.launch { 
                listState.animateScrollToItem(<span class="hljs-number">0</span>)
            }
        }, modifier = Modifier.padding(<span class="hljs-number">16.</span>dp)) {
            Icon(Icons.Default.KeyboardArrowUp, contentDescription = <span class="hljs-string">"å›åˆ°é¡¶éƒ¨"</span>)
        }
    }
}
</code></pre>
<h3 data-id="heading-40">4ã€å¿«é€Ÿè®°å¿†</h3>
<p>æ•°æ®æ´¾ç”Ÿ -&gt; é‡ç»„å°‘ -&gt; æ€§èƒ½ä¼˜ -&gt; ä½“éªŒæ£’</p>
<h3 data-id="heading-41">5ã€å¸¸è§é”™è¯¯</h3>

























<table><thead><tr><th>é”™è¯¯</th><th>åæœ</th><th>æ­£ç¡®</th></tr></thead><tbody><tr><td>ä¸ç”¨ <code>derivedStateOf</code></td><td>é¢‘ç¹é‡ç»„</td><td>å¿…é¡»ç”¨</td></tr><tr><td>æ”¾ <code>LaunchedEffect</code></td><td>æ— æ³•é©±åŠ¨ UI</td><td>ç”¨ <code>by derivedStateOf</code></td></tr><tr><td>è®¡ç®—å¤ªé‡</td><td>å¡ UI</td><td>ç§»åˆ° IO çº¿ç¨‹</td></tr></tbody></table>
<h3 data-id="heading-42">6ã€æ€»ç»“</h3>
<p>derivedStateOf æ˜¯ Compose ä¸­ã€Œè®¡ç®—ä¼˜åŒ– + é˜²é—ªçƒã€çš„æœ€ä¼˜è§£ä¹‹ä¸€ï¼ŒæŒæ¡å®ƒèƒ½è®©ä½ çš„UIæ›´æµç•…ã€‚</p>
<h2 data-id="heading-43">rememberUpdatedState</h2>
<p>æˆ‘åŒæ ·è®¤ä¸ºè¿™ä¸å±äºå‰¯ä½œç”¨å‡½æ•°ï¼Œç†ç”±ä¸derivedStateOfç±»ä¼¼ã€‚ä½†å®ƒä¸å‰¯ä½œç”¨LaunchedEffectå‡½æ•°é…åˆç´§å¯†ï¼Œæ‰€ä»¥ä¸€èµ·ä»‹ç»äº†ã€‚å…¶å®è¿™é‡Œé¢æ¶‰åŠåˆ°ä¸€ä¸ª<code>é—­åŒ…</code>çš„æ¦‚å¿µã€‚è¿™é‡Œé¢å°±ä¸å±•å¼€è®²ï¼Œä¸äº†è§£çš„å°ä¼™ä¼´å»é—®AIå§ã€‚</p>
<h3 data-id="heading-44">1ã€ä¸€å¥è¯æ¦‚æ‹¬</h3>
<p>rememberUpdatedState(value) = ã€Œè®© LaunchedEffect é‡Œçš„åç¨‹ï¼Œå§‹ç»ˆæ‹¿åˆ°æœ€æ–°çš„å€¼ã€ï¼Œå³ä½¿å®ƒåœ¨é‡ç»„æ—¶è¢«æ•è·äº†æ—§å€¼ã€‚</p>
<h3 data-id="heading-45">2ã€è§£å†³äº†ä»€ä¹ˆé—®é¢˜</h3>
<p>å…ˆçœ‹é—®é¢˜ä»£ç ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">GreetingMessage</span><span class="hljs-params">(message: <span class="hljs-type">String</span>)</span></span> {
    <span class="hljs-comment">// å¯åŠ¨ä¸€ä¸ªåç¨‹ï¼Œæ¯éš”2ç§’æ‰“å°ä¸€æ¬¡ message</span>
    LaunchedEffect(<span class="hljs-built_in">Unit</span>) {
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            delay(<span class="hljs-number">2000</span>)
            Log.d(<span class="hljs-string">"messageçš„å€¼"</span>ï¼Œ<span class="hljs-string">"å½“å‰ message: <span class="hljs-variable">$message</span>"</span>)  <span class="hljs-comment">//  é—­åŒ…æ•è·æ—§å€¼</span>
        }
    }
}
</code></pre>
<p>å­˜åœ¨çš„é—®é¢˜ï¼šå½“ <code>message</code> æ”¹å˜æ—¶ï¼Œ<code>LaunchedEffect(Unit)</code> ä¸ä¼šé‡å¯ï¼Œå› ä¸ºkeyæœªå‘ç”Ÿå˜åŒ–ï¼›
å› æ­¤åç¨‹é‡Œæ‰“å°çš„ä»ç„¶æ˜¯â€œç¬¬ä¸€æ¬¡ Compositionâ€æ—¶çš„æ—§å€¼ï¼› è¿™å°±å«ã€Œ<strong>stale captureï¼ˆè¿‡æœŸæ•è·ï¼‰</strong> ã€ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨rememberUpdatedStateè¿›è¡Œä¿®æ­£</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UpdateNewMessage</span><span class="hljs-params">(message: <span class="hljs-type">String</span>)</span></span> {
    <span class="hljs-comment">// è®©åç¨‹ä¸­æ€»èƒ½è®¿é—®æœ€æ–° message</span>
    <span class="hljs-keyword">val</span> currentMessage <span class="hljs-keyword">by</span> rememberUpdatedState(message)

    LaunchedEffect(<span class="hljs-built_in">Unit</span>) {
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            delay(<span class="hljs-number">2000</span>)
            println(<span class="hljs-string">"å½“å‰ message: <span class="hljs-variable">$currentMessage</span>"</span>)  <span class="hljs-comment">// âœ… å§‹ç»ˆæ˜¯æœ€æ–°å€¼</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-46">3ã€åº”ç”¨åœºæ™¯</h3>
<ul>
<li>åœºæ™¯ä¸€ï¼šé˜²æŠ–ï¼ˆæ¨èæ­¤æ–¹å¼å®ç°Composeçš„é˜²æŠ–ï¼‰</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">DebouncedSearch</span><span class="hljs-params">(
    query: <span class="hljs-type">String</span>,
    onDebouncedQueryChange: (<span class="hljs-type">String</span>) -&gt; <span class="hljs-type">Unit</span>
)</span></span> {
    <span class="hljs-keyword">var</span> searchQuery <span class="hljs-keyword">by</span> remember { mutableStateOf(query) }
    <span class="hljs-keyword">val</span> currentOnDebouncedQueryChange <span class="hljs-keyword">by</span> rememberUpdatedState(onDebouncedQueryChange)

    LaunchedEffect(searchQuery) {
        delay(<span class="hljs-number">300</span>) <span class="hljs-comment">// 300ms é˜²æŠ–å»¶è¿Ÿ</span>
        <span class="hljs-keyword">if</span>(searchQuery.isNotBlank()) {
            currentOnDebouncedQueryChange(query)
        }

    }
    TextField( value = searchQuery,
        onValueChange = { searchQuery = it },
        label = { Text(<span class="hljs-string">"æœç´¢"</span>) } )
}
</code></pre>
<ul>
<li>åœºæ™¯äºŒï¼šäº‹ä»¶ç›‘å¬ä¸­ä¿æŒå›è°ƒæ›´æ–°ï¼ˆæœ€å¸¸è§ï¼‰</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">LocationChange</span><span class="hljs-params">(onLocationUpdate: (<span class="hljs-type">Location</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span> {
    <span class="hljs-keyword">val</span> currentCallback <span class="hljs-keyword">by</span> rememberUpdatedState(onLocationUpdate)
    
    DisposableEffect(<span class="hljs-built_in">Unit</span>) {
        <span class="hljs-keyword">val</span> listener = LocationListener { location -&gt;
            currentCallback(location) <span class="hljs-comment">// ä½¿ç”¨æœ€æ–°çš„å›è°ƒ</span>
        }
        
        locationManager.requestLocationUpdates(listener)
        
        onDispose {
            locationManager.removeUpdates(listener)
        }
    }
}
</code></pre>
<p>ä»£ç æ ¸å¿ƒï¼šæ—¶åˆ»ä¿æŒæœ€æ–°çš„å›è°ƒï¼Œè§£å†³æŒæœ‰æ—§å›è°ƒçš„é—®é¢˜</p>
<ul>
<li>åœºæ™¯ä¸‰ï¼šå®šæ—¶å™¨åŠ¨æ€è½®è¯¢ï¼ˆæ ¹æ®æƒ…å†µè°ƒæ•´è½®è¯¢æ—¶é—´ï¼‰</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">/**
 * æ¯æ¬¡è°ƒç”¨è°ƒæ•´è½®è¯¢é—´éš”ï¼Œä¸è§¦å‘é‡å¯
 */</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">PollingData</span><span class="hljs-params">(intervalMs: <span class="hljs-type">Long</span>)</span></span> {
    <span class="hljs-keyword">val</span> updatedInterval <span class="hljs-keyword">by</span> rememberUpdatedState(intervalMs)
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">data</span> <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-string">"åŠ è½½ä¸­..."</span>) }

    LaunchedEffect(<span class="hljs-built_in">Unit</span>) {
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-keyword">data</span> = withContext(Dispatchers.IO) {
                RetrofitClient.apiService.getUsersById(<span class="hljs-number">1</span>).toString()
            }
            delay(updatedInterval)  <span class="hljs-comment">// åŠ¨æ€é—´éš”</span>
        }
    }

    Column {
        Text(<span class="hljs-string">"æ•°æ®: <span class="hljs-variable">$data</span>"</span>)
        Text(<span class="hljs-string">"è½®è¯¢é—´éš”: <span class="hljs-variable">$updatedInterval</span> ms"</span>)
    }
}
</code></pre>
<ul>
<li>åœºæ™¯å››ï¼šå»¶è¿Ÿæç¤ºï¼ˆä¼˜åŒ–éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ§ä»¶å¤šæ¬¡æ˜¾ç¤ºéšè—å¯¼è‡´çš„é—ªçƒï¼‰</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">DelayedTooltip</span><span class="hljs-params">(visible: <span class="hljs-type">Boolean</span>, text: <span class="hljs-type">String</span>)</span></span> {
    <span class="hljs-keyword">val</span> updatedVisible <span class="hljs-keyword">by</span> rememberUpdatedState(visible)

    LaunchedEffect(<span class="hljs-built_in">Unit</span>) {
        delay(<span class="hljs-number">1000</span>)  <span class="hljs-comment">// å»¶è¿Ÿæ˜¾ç¤º</span>
        <span class="hljs-keyword">if</span> (updatedVisible) {
            showTooltip(text)
        }
    }

    <span class="hljs-comment">// UI...</span>
}
</code></pre>
<h3 data-id="heading-47">4ã€å¿«é€Ÿè®°å¿†</h3>
<p>åç¨‹ä¸é‡å¯ï¼Œå€¼è¦æœ€æ–°å€¼ï¼Œé‚£å°±ä½¿ç”¨UpdatedState<br/>
<code>LaunchedEffect(Unit)</code> + <code>rememberUpdatedState(value)</code> = ä¸é‡å¯åç¨‹ä¹Ÿèƒ½æ‹¿åˆ°æœ€æ–°å€¼</p>
<h3 data-id="heading-48">5ã€å¸¸çŠ¯é”™è¯¯</h3>

























<table><thead><tr><th>é”™è¯¯</th><th>åæœ</th><th>æ­£ç¡®</th></tr></thead><tbody><tr><td>ä¸ç”¨ <code>rememberUpdatedState</code></td><td>åç¨‹ç”¨æ—§å€¼</td><td>å¿…é¡»ç”¨</td></tr><tr><td>é…åˆ <code>LaunchedEffect(value)</code></td><td>é¢‘ç¹é‡å¯</td><td>ç”¨ <code>Unit</code></td></tr><tr><td>æ”¾ <code>SideEffect</code></td><td>æ¯æ¬¡é‡ç»„éƒ½æ‰§è¡Œ</td><td>é”™ï¼</td></tr></tbody></table>
<h3 data-id="heading-49">å…­ã€æ€»ç»“</h3>
<p>rememberUpdatedState æ˜¯ Compose ä¸­ã€Œåç¨‹ + åŠ¨æ€å‚æ•°ã€çš„é»„é‡‘æ­æ¡£ï¼Œç»å¸¸ä¸LaunchedEffect(Unit)æ­é…å®ç°å¤šåœºæ™¯åŠŸèƒ½ã€‚</p>
<h2 data-id="heading-50">æ€»ç»“ï¼š</h2>
<p>Compose çš„å‰¯ä½œç”¨å‡½æ•°æœ¬è´¨æ˜¯ï¼š<strong>åœ¨å£°æ˜å¼UIä¸­æ‰§è¡Œå‘½ä»¤å¼é€»è¾‘çš„å…¥å£</strong>ã€‚<br/>
<code>LaunchedEffect</code>ã€<code>DisposableEffect</code>ã€<code>SideEffect</code> è§£å†³ä¸åŒç”Ÿå‘½å‘¨æœŸé˜¶æ®µçš„å‰¯ä½œç”¨ï¼›<br/>
è€Œ <code>rememberCoroutineScope</code>ã€<code>produceState</code>ã€<code>derivedStateOf</code>ã€<code>rememberUpdatedState</code> åˆ™æ˜¯å›´ç»•çŠ¶æ€ã€åç¨‹ä¸æ€§èƒ½ä¼˜åŒ–çš„å·¥å…·ã€‚ç†è§£å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸã€è§¦å‘æ—¶æœºä¸å–æ¶ˆæœºåˆ¶ï¼Œæ˜¯å†™å¥½ Compose çš„å…³é”®ã€‚<br/>
æœ¬æ–‡åªåˆ—å‡ºäº†æˆ‘èƒ½æƒ³åˆ°çš„ä¸€äº›åœºæ™¯ï¼Œè‚¯å®šæœ‰å¾ˆå¤šçš„é—æ¼ï¼Œè¿˜æ˜¯éœ€è¦å¤§å®¶åœ¨ä½¿ç”¨ä¸­å»å®Œå–„äº†è§£</p>
<p>å„å‰¯ä½œç”¨å‡½æ•°æœºåˆ¶é€ŸæŸ¥è¡¨ï¼š</p>






















































































<table><thead><tr><th>å‡½æ•°</th><th>å¯åŠ¨æ—¶æœº</th><th>é‡ç»„è§¦å‘</th><th>è‡ªåŠ¨å–æ¶ˆï¼ˆéšç”Ÿå‘½å‘¨æœŸé”€æ¯ï¼‰</th><th>å¸¸è§ç”¨é€”</th><th>æ˜¯å¦å¯æŒä¹…è¿è¡Œï¼ˆå¦‚è½®è¯¢ï¼‰</th><th>æ˜¯å¦ä¾èµ– key</th></tr></thead><tbody><tr><td><strong><code>SideEffect</code></strong></td><td>æ¯æ¬¡æˆåŠŸé‡ç»„åæ‰§è¡Œ</td><td>âœ… æ¯æ¬¡é‡ç»„éƒ½ä¼šæ‰§è¡Œ</td><td>âŒ ä¸ä¼šè‡ªåŠ¨å–æ¶ˆ</td><td>æŠŠ Compose çŠ¶æ€åŒæ­¥åˆ°é Compose ç³»ç»Ÿï¼ˆå¦‚ Logã€ViewModel çŠ¶æ€ç­‰ï¼‰</td><td>âŒ</td><td>å¦</td></tr><tr><td><strong><code>LaunchedEffect(key)</code></strong></td><td>è¿›å…¥ Composition æ—¶æ‰§è¡Œä¸€æ¬¡</td><td>âœ… key å˜åŒ–ä¼šé‡å¯åç¨‹</td><td>âœ… key æ”¹å˜æˆ–é€€å‡º Composition æ—¶è‡ªåŠ¨å–æ¶ˆ</td><td>æ‰§è¡Œä¸€æ¬¡æ€§ä»»åŠ¡ã€å¯åŠ¨åç¨‹ã€ç›‘å¬ Flow</td><td>âœ…</td><td>æ˜¯</td></tr><tr><td><strong><code>DisposableEffect(key)</code></strong></td><td>è¿›å…¥ Composition æ—¶æ‰§è¡Œä¸€æ¬¡</td><td>âœ… key å˜åŒ–æˆ–ç¦»å¼€ Composition æ—¶è§¦å‘ onDispose</td><td>âœ… è‡ªåŠ¨è§¦å‘ onDispose</td><td>æ³¨å†Œ/æ³¨é”€ç›‘å¬ã€å¯åŠ¨/åœæ­¢å¤–éƒ¨èµ„æº</td><td>âœ…</td><td>æ˜¯</td></tr><tr><td><strong><code>rememberCoroutineScope()</code></strong></td><td>ç»„åˆæ—¶åˆ›å»ºä¸€ä¸ªå¯è®°å¿†çš„åç¨‹ä½œç”¨åŸŸ</td><td>âŒ ä¸ä¼šå› é‡ç»„é‡æ–°åˆ›å»º</td><td>âœ… Composition ç¦»å¼€æ—¶è‡ªåŠ¨å–æ¶ˆ</td><td>éœ€è¦åœ¨å›è°ƒä¸­æ‰‹åŠ¨å¯åŠ¨åç¨‹ï¼ˆå¦‚æŒ‰é’®ç‚¹å‡»ï¼‰</td><td>âœ…</td><td>å¦</td></tr><tr><td><strong><code>produceState()</code></strong></td><td>è¿›å…¥ Composition æ—¶å¯åŠ¨åç¨‹</td><td>âœ… key å˜åŒ–ä¼šé‡å¯ç”Ÿäº§é€»è¾‘</td><td>âœ… è‡ªåŠ¨å–æ¶ˆæ—§åç¨‹</td><td>æŠŠå¼‚æ­¥ä»»åŠ¡ç»“æœè½¬ä¸º Stateï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ï¼‰</td><td>âœ…</td><td>æ˜¯</td></tr><tr><td><strong><code>derivedStateOf()</code></strong></td><td>ä¾èµ– State å˜åŒ–æ—¶è®¡ç®—</td><td>âœ… ä¾èµ–çš„å€¼å˜åŒ–æ‰é‡æ–°è®¡ç®—</td><td>âŒï¼ˆçº¯è®¡ç®—ï¼Œæ­¤å¤„æ— æ„ä¹‰ï¼‰</td><td>ä¼˜åŒ–è®¡ç®—å‹çŠ¶æ€ï¼Œé¿å…ä¸å¿…è¦é‡ç»„</td><td>âŒ</td><td>å¦</td></tr><tr><td><strong><code>rememberUpdatedState()</code></strong></td><td>æ¯æ¬¡é‡ç»„æ›´æ–°å†…éƒ¨å€¼</td><td>âŒ ä¸ä¼šå¯¼è‡´é‡ç»„</td><td>âŒ</td><td>è®©é•¿æœŸå‰¯ä½œç”¨ä¸­è®¿é—®æœ€æ–°å‚æ•°ï¼ˆå¦‚åç¨‹/å›è°ƒï¼‰</td><td>âœ…</td><td>å¦</td></tr><tr><td><strong><code>snapshotFlow { }</code></strong></td><td>åœ¨åç¨‹ä¸­æŠŠ State è½¬æ¢ä¸º Flow</td><td>âœ… State å˜åŒ–æ—¶å‘å°„æ–°å€¼</td><td>âœ… åç¨‹å–æ¶ˆå³åœæ­¢</td><td>å“åº”å¼æ”¶é›† State å˜åŒ–</td><td>âœ…</td><td>å¦</td></tr></tbody></table>
<h2 data-id="heading-51">æºç </h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftcyang123456%2FTestCompose.git" target="_blank" title="https://github.com/tcyang123456/TestCompose.git" ref="nofollow noopener noreferrer">github.com/tcyang12345â€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Root-> A ->B -> C page, å½“å‰C page, å¦‚ä½•è¿”å›Bï¼Œåˆå¦‚ä½•ç›´æ¥è¿”å›A pageå‘¢]]></title>    <link>https://juejin.cn/post/7571304204754042934</link>    <guid>https://juejin.cn/post/7571304204754042934</guid>    <pubDate>2025-11-11T10:12:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571304204754042934" data-draft-id="7571105461099233323" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Root-&gt; A -&gt;B -&gt; C page, å½“å‰C page, å¦‚ä½•è¿”å›Bï¼Œåˆå¦‚ä½•ç›´æ¥è¿”å›A pageå‘¢"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-11T10:12:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="littleplayer"/> <meta itemprop="url" content="https://juejin.cn/user/1926000099198813"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Root-&gt; A -&gt;B -&gt; C page, å½“å‰C page, å¦‚ä½•è¿”å›Bï¼Œåˆå¦‚ä½•ç›´æ¥è¿”å›A pageå‘¢
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1926000099198813/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    littleplayer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T10:12:57.000Z" title="Tue Nov 11 2025 10:12:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ SwiftUI ä¸­ï¼Œä» C é¡µé¢è¿”å›åˆ° B æˆ–ç›´æ¥è¿”å›åˆ° A é¡µé¢æœ‰å¤šç§æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯å…·ä½“çš„å®ç°æ–¹æ³•ï¼š</p>
<h2 data-id="heading-0">1. ä½¿ç”¨ NavigationStack å’Œ NavigationPath</h2>
<h3 data-id="heading-1">åŸºæœ¬è®¾ç½®</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">Route</span>: <span class="hljs-title class_">Hashable</span> {
    <span class="hljs-keyword">case</span> a
    <span class="hljs-keyword">case</span> b
    <span class="hljs-keyword">case</span> c
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> navigationPath <span class="hljs-operator">=</span> <span class="hljs-type">NavigationPath</span>()
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">NavigationStack</span>(path: <span class="hljs-variable">$navigationPath</span>) {
            <span class="hljs-type">AView</span>()
                .navigationDestination(for: <span class="hljs-type">Route</span>.<span class="hljs-keyword">self</span>) { route <span class="hljs-keyword">in</span>
                    <span class="hljs-keyword">switch</span> route {
                    <span class="hljs-keyword">case</span> .a:
                        <span class="hljs-type">AView</span>()
                    <span class="hljs-keyword">case</span> .b:
                        <span class="hljs-type">BView</span>()
                    <span class="hljs-keyword">case</span> .c:
                        <span class="hljs-type">CView</span>()
                    }
                }
        }
        .environment(\.navigationPath, <span class="hljs-variable">$navigationPath</span>)
    }
}
</code></pre>
<h2 data-id="heading-2">2. ä» C è¿”å› Bï¼Œæˆ–ç›´æ¥è¿”å› A</h2>
<h3 data-id="heading-3">ä½¿ç”¨ç¯å¢ƒå˜é‡ä¼ é€’å¯¼èˆªæ§åˆ¶</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// å®šä¹‰ç¯å¢ƒKey</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">NavigationPathKey</span>: <span class="hljs-title class_">EnvironmentKey</span> {
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> defaultValue: <span class="hljs-type">Binding</span>&lt;<span class="hljs-type">NavigationPath</span>&gt;? <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>
}

<span class="hljs-keyword">extension</span> <span class="hljs-title class_">EnvironmentValues</span> {
    <span class="hljs-keyword">var</span> navigationPath: <span class="hljs-type">Binding</span>&lt;<span class="hljs-type">NavigationPath</span>&gt;? {
        <span class="hljs-keyword">get</span> { <span class="hljs-keyword">self</span>[<span class="hljs-type">NavigationPathKey</span>.<span class="hljs-keyword">self</span>] }
        <span class="hljs-keyword">set</span> { <span class="hljs-keyword">self</span>[<span class="hljs-type">NavigationPathKey</span>.<span class="hljs-keyword">self</span>] <span class="hljs-operator">=</span> newValue }
    }
}

<span class="hljs-comment">// A é¡µé¢</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">AView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@Environment</span>(\.navigationPath) <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> navigationPath
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span> {
            <span class="hljs-type">Text</span>(<span class="hljs-string">"A é¡µé¢"</span>)
            
            <span class="hljs-type">Button</span>(<span class="hljs-string">"å‰å¾€ B é¡µé¢"</span>) {
                navigationPath<span class="hljs-operator">?</span>.wrappedValue.append(<span class="hljs-type">Route</span>.b)
            }
            .padding()
        }
        .navigationTitle(<span class="hljs-string">"A é¡µé¢"</span>)
    }
}

<span class="hljs-comment">// B é¡µé¢</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">BView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@Environment</span>(\.navigationPath) <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> navigationPath
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span> {
            <span class="hljs-type">Text</span>(<span class="hljs-string">"B é¡µé¢"</span>)
            
            <span class="hljs-type">Button</span>(<span class="hljs-string">"å‰å¾€ C é¡µé¢"</span>) {
                navigationPath<span class="hljs-operator">?</span>.wrappedValue.append(<span class="hljs-type">Route</span>.c)
            }
            .padding()
        }
        .navigationTitle(<span class="hljs-string">"B é¡µé¢"</span>)
    }
}

<span class="hljs-comment">// C é¡µé¢ - å…³é”®éƒ¨åˆ†</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">CView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@Environment</span>(\.navigationPath) <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> navigationPath
    <span class="hljs-meta">@Environment</span>(\.dismiss) <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> dismiss
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span>(spacing: <span class="hljs-number">20</span>) {
            <span class="hljs-type">Text</span>(<span class="hljs-string">"C é¡µé¢"</span>)
            
            <span class="hljs-comment">// æ–¹æ³•1: è¿”å›ä¸Šä¸€é¡µ (B)</span>
            <span class="hljs-type">Button</span>(<span class="hljs-string">"è¿”å›ä¸Šä¸€é¡µ (B)"</span>) {
                dismiss() <span class="hljs-comment">// æˆ–è€… navigationPath?.wrappedValue.removeLast()</span>
            }
            
            <span class="hljs-comment">// æ–¹æ³•2: ç›´æ¥è¿”å› A é¡µé¢</span>
            <span class="hljs-type">Button</span>(<span class="hljs-string">"ç›´æ¥è¿”å› A é¡µé¢"</span>) {
                <span class="hljs-comment">// ç§»é™¤æœ€å2ä¸ªé¡µé¢ (C å’Œ B)</span>
                navigationPath<span class="hljs-operator">?</span>.wrappedValue.removeLast(<span class="hljs-number">2</span>)
            }
            
            <span class="hljs-comment">// æ–¹æ³•3: è¿”å›æ ¹é¡µé¢ (A)</span>
            <span class="hljs-type">Button</span>(<span class="hljs-string">"è¿”å›æ ¹é¡µé¢ (A)"</span>) {
                <span class="hljs-comment">// ç§»é™¤æ‰€æœ‰é¡µé¢ï¼Œå›åˆ°æ ¹</span>
                navigationPath<span class="hljs-operator">?</span>.wrappedValue.removeLast(navigationPath<span class="hljs-operator">?</span>.wrappedValue.count <span class="hljs-operator">??</span> <span class="hljs-number">0</span>)
            }
            
            <span class="hljs-comment">// æ–¹æ³•4: ç‰¹å®šè·¯å¾„è·³è½¬</span>
            <span class="hljs-type">Button</span>(<span class="hljs-string">"è·³è½¬åˆ° A é¡µé¢"</span>) {
                <span class="hljs-comment">// æ¸…ç©ºè·¯å¾„ï¼Œç„¶åæ·»åŠ  A</span>
                navigationPath<span class="hljs-operator">?</span>.wrappedValue <span class="hljs-operator">=</span> <span class="hljs-type">NavigationPath</span>()
                navigationPath<span class="hljs-operator">?</span>.wrappedValue.append(<span class="hljs-type">Route</span>.a)
            }
        }
        .navigationTitle(<span class="hljs-string">"C é¡µé¢"</span>)
    }
}
</code></pre>
<h2 data-id="heading-4">3. ä½¿ç”¨å¯¼èˆªç®¡ç†å™¨ (æ¨è)</h2>
<h3 data-id="heading-5">åˆ›å»ºå¯¼èˆªç®¡ç†å™¨</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">NavigationManager</span>: <span class="hljs-title class_">ObservableObject</span> {
    <span class="hljs-meta">@Published</span> <span class="hljs-keyword">var</span> path <span class="hljs-operator">=</span> <span class="hljs-type">NavigationPath</span>()
    
    <span class="hljs-comment">// è¿”å›ä¸Šä¸€é¡µ</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">goBack</span>() {
        <span class="hljs-keyword">guard</span> <span class="hljs-operator">!</span>path.isEmpty <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
        path.removeLast()
    }
    
    <span class="hljs-comment">// è¿”å›åˆ°ç‰¹å®šé¡µé¢</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">goBackToA</span>() {
        <span class="hljs-comment">// å‡è®¾è·¯å¾„æ˜¯ [B, C]ï¼Œç§»é™¤æœ€å2ä¸ª</span>
        <span class="hljs-keyword">if</span> path.count <span class="hljs-operator">&gt;=</span> <span class="hljs-number">2</span> {
            path.removeLast(<span class="hljs-number">2</span>)
        }
    }
    
    <span class="hljs-comment">// è¿”å›åˆ°æ ¹é¡µé¢</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">goToRoot</span>() {
        path.removeLast(path.count)
    }
    
    <span class="hljs-comment">// å¯¼èˆªåˆ°ç‰¹å®šé¡µé¢</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">navigateTo</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">route</span>: <span class="hljs-type">Route</span>) {
        path.append(route)
    }
}
</code></pre>
<h3 data-id="heading-6">åœ¨è§†å›¾ä¸­ä½¿ç”¨</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">AppView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@StateObject</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> navManager <span class="hljs-operator">=</span> <span class="hljs-type">NavigationManager</span>()
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">NavigationStack</span>(path: <span class="hljs-variable">$navManager</span>.path) {
            <span class="hljs-type">AView</span>()
                .navigationDestination(for: <span class="hljs-type">Route</span>.<span class="hljs-keyword">self</span>) { route <span class="hljs-keyword">in</span>
                    <span class="hljs-keyword">switch</span> route {
                    <span class="hljs-keyword">case</span> .a: <span class="hljs-type">AView</span>()
                    <span class="hljs-keyword">case</span> .b: <span class="hljs-type">BView</span>()
                    <span class="hljs-keyword">case</span> .c: <span class="hljs-type">CView</span>()
                    }
                }
        }
        .environmentObject(navManager)
    }
}

<span class="hljs-comment">// C é¡µé¢ä½¿ç”¨å¯¼èˆªç®¡ç†å™¨</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">CView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@EnvironmentObject</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> navManager: <span class="hljs-type">NavigationManager</span>
    <span class="hljs-meta">@Environment</span>(\.dismiss) <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> dismiss
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span>(spacing: <span class="hljs-number">20</span>) {
            <span class="hljs-type">Text</span>(<span class="hljs-string">"C é¡µé¢"</span>)
            
            <span class="hljs-type">Button</span>(<span class="hljs-string">"è¿”å›ä¸Šä¸€é¡µ (B)"</span>) {
                navManager.goBack()
            }
            .buttonStyle(.bordered)
            
            <span class="hljs-type">Button</span>(<span class="hljs-string">"ç›´æ¥è¿”å› A é¡µé¢"</span>) {
                navManager.goBackToA()
            }
            .buttonStyle(.borderedProminent)
            
            <span class="hljs-type">Button</span>(<span class="hljs-string">"è¿”å›æ ¹é¡µé¢"</span>) {
                navManager.goToRoot()
            }
            .buttonStyle(.bordered)
            
            <span class="hljs-comment">// å½“å‰è·¯å¾„ä¿¡æ¯</span>
            <span class="hljs-type">Text</span>(<span class="hljs-string">"å½“å‰å¯¼èˆªæ ˆæ·±åº¦: <span class="hljs-subst">\(navManager.path.count)</span>"</span>)
        }
        .navigationTitle(<span class="hljs-string">"C é¡µé¢"</span>)
        .navigationBarBackButtonHidden(<span class="hljs-literal">true</span>) <span class="hljs-comment">// éšè—é»˜è®¤è¿”å›æŒ‰é’®</span>
        .toolbar {
            <span class="hljs-type">ToolbarItem</span>(placement: .navigationBarLeading) {
                <span class="hljs-type">Button</span>(<span class="hljs-string">"è¿”å›"</span>) {
                    navManager.goBack()
                }
            }
        }
    }
}
</code></pre>
<h2 data-id="heading-7">4. ä½¿ç”¨ @Binding ä¼ é€’æ§åˆ¶ (ç®€å•åœºæ™¯)</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">CView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@Binding</span> <span class="hljs-keyword">var</span> path: <span class="hljs-type">NavigationPath</span>
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span> {
            <span class="hljs-type">Text</span>(<span class="hljs-string">"C é¡µé¢"</span>)
            
            <span class="hljs-type">Button</span>(<span class="hljs-string">"è¿”å› B"</span>) {
                path.removeLast()
            }
            
            <span class="hljs-type">Button</span>(<span class="hljs-string">"è¿”å› A"</span>) {
                <span class="hljs-comment">// ç§»é™¤ B å’Œ C</span>
                <span class="hljs-keyword">if</span> path.count <span class="hljs-operator">&gt;=</span> <span class="hljs-number">2</span> {
                    path.removeLast(<span class="hljs-number">2</span>)
                }
            }
        }
    }
}
</code></pre>
<h2 data-id="heading-8">æ€»ç»“</h2>
<p><strong>ä» C è¿”å› B çš„æ–¹æ³•ï¼š</strong></p>
<ul>
<li><code>dismiss()</code> - æœ€ç®€å•çš„è¿”å›ä¸Šä¸€é¡µ</li>
<li><code>navigationPath.removeLast()</code> - ç¼–ç¨‹å¼è¿”å›</li>
<li><code>navManager.goBack()</code> - é€šè¿‡ç®¡ç†å™¨è¿”å›</li>
</ul>
<p><strong>ä» C ç›´æ¥è¿”å› A çš„æ–¹æ³•ï¼š</strong></p>
<ul>
<li><code>navigationPath.removeLast(2)</code> - ç§»é™¤æœ€å2ä¸ªé¡µé¢</li>
<li><code>navigationPath.removeLast(navigationPath.count)</code> - æ¸…ç©ºæ‰€æœ‰é¡µé¢</li>
<li><code>navManager.goBackToA()</code> - é€šè¿‡ç®¡ç†å™¨ç²¾ç¡®æ§åˆ¶</li>
</ul>
<p>æ¨èä½¿ç”¨å¯¼èˆªç®¡ç†å™¨çš„æ–¹å¼ï¼Œå› ä¸ºå®ƒæä¾›äº†æ›´å¥½çš„ä»£ç ç»„ç»‡å’Œå¯ç»´æŠ¤æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æç¤ºè¯å·¥ç¨‹åŒ–å®è·µï¼šæˆ‘å¦‚ä½•æ„å»ºå¯å¤ç”¨çš„Sunoå·¥ä½œæµç³»ç»Ÿ]]></title>    <link>https://juejin.cn/post/7571281406509989939</link>    <guid>https://juejin.cn/post/7571281406509989939</guid>    <pubDate>2025-11-11T10:15:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571281406509989939" data-draft-id="7571281406509662259" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æç¤ºè¯å·¥ç¨‹åŒ–å®è·µï¼šæˆ‘å¦‚ä½•æ„å»ºå¯å¤ç”¨çš„Sunoå·¥ä½œæµç³»ç»Ÿ"/> <meta itemprop="keywords" content="AIGC,Coze"/> <meta itemprop="datePublished" content="2025-11-11T10:15:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HYI"/> <meta itemprop="url" content="https://juejin.cn/user/2261030112603613"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æç¤ºè¯å·¥ç¨‹åŒ–å®è·µï¼šæˆ‘å¦‚ä½•æ„å»ºå¯å¤ç”¨çš„Sunoå·¥ä½œæµç³»ç»Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2261030112603613/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HYI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T10:15:10.000Z" title="Tue Nov 11 2025 10:15:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å½“éŸ³ä¹å°ç™½é‡ä¸Š Suno</h2>
<p>æœ€è¿‘è¿·ä¸Šäº†ç”¨ Suno AI ç”ŸæˆéŸ³ä¹ï¼Œä½†å¾ˆå¿«å°±é‡åˆ°äº†ä¸¤ä¸ªç—›ç‚¹ï¼š</p>
<ol>
<li>ä½œä¸ºä¹ç†å°ç™½ï¼Œæˆ‘ä¸çŸ¥é“å¦‚ä½•å†™å‡ºå®Œæ•´çš„æ­Œè¯å’ŒéŸ³ä¹ç»“æ„</li>
<li>å³ä½¿æœ‰æ¨¡ç³Šçš„æƒ³æ³•ï¼Œä¹Ÿå¾ˆéš¾è½¬åŒ–ä¸º Suno èƒ½ç†è§£çš„ç²¾å‡†æç¤ºè¯</li>
</ol>
<p>æœ€åˆçš„è§£å†³æ–¹æ¡ˆå¾ˆç®€å•ï¼šè®©å¤§æ¨¡å‹å¸®æˆ‘è¡¥å…¨ã€‚ä½†å¾ˆå¿«å‘ç°ï¼Œè¿™ç§â€œä¸€æ¬¡æ€§â€çš„ç”Ÿæˆæ–¹å¼å­˜åœ¨å¾ˆå¤§éšæœºæ€§ï¼Œæ— æ³•ç§¯ç´¯ç»éªŒï¼Œä¹Ÿæ— æ³•ç³»ç»ŸåŒ–æå‡è¾“å‡ºè´¨é‡ã€‚</p>
<h2 data-id="heading-1">æ€è·¯è½¬å˜ï¼šä»å•æ¬¡ç”Ÿæˆåˆ°æµç¨‹è®¾è®¡</h2>
<p>æˆ‘æ„è¯†åˆ°ï¼Œéœ€è¦å»ºç«‹ä¸€ä¸ªå¯é‡å¤ã€å¯ä¼˜åŒ–çš„åˆ›ä½œæµç¨‹ã€‚ç»è¿‡å¤šæ¬¡è¿­ä»£ï¼Œæœ€ç»ˆå½¢æˆäº†ä¸€å¥—æ¨¡å—åŒ–çš„å·¥ä½œæµç³»ç»Ÿã€‚</p>
<p><strong>æ ¸å¿ƒæ¼”è¿›å†ç¨‹ï¼š</strong></p>
<ul>
<li><strong>V1</strong>ï¼šç®€å•çš„è§’è‰²è®¾å®š+ä»»åŠ¡è¯´æ˜ï¼Œæ‰‹åŠ¨ä¸²è”å„ä¸ªæ­¥éª¤</li>
<li><strong>V2</strong>ï¼šå¼•å…¥æ ‡å‡†åŒ–æ­¥éª¤æ¦‚å¿µï¼Œå¼€å§‹å®šä¹‰è¾“å…¥è¾“å‡º</li>
<li><strong>V3</strong>ï¼šå…³é”®çš„æ¨¡å—åŒ–è½¬å˜ï¼Œé€šè¿‡æ–‡ä»¶å¥‘çº¦å»ºç«‹æ¥å£è§„èŒƒ</li>
<li><strong>V4</strong>ï¼šå®Œå–„çš„è°ƒåº¦ç³»ç»Ÿï¼Œæ”¯æŒè°ƒè¯•ã€å¼€å‘å’ŒçŸ¥è¯†åº“æ‰©å±•</li>
</ul>
<h2 data-id="heading-2">æœ€ç»ˆå·¥ä½œæµæ¶æ„è®¾è®¡</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    Start([æµç¨‹å¼€å§‹]) --&gt; Step1

    subgraph Step1 [å‰ç½®æµç¨‹è®¤çŸ¥]
        A1[è§’è‰²: éŸ³ä¹åˆ¶ä½œè°ƒåº¦å¼•æ“] --&gt; A2[è½½å…¥æ¨¡å—]
    end

    A2 --&gt; Step2[çŸ¥è¯†åº“æ’ä»¶&lt;br&gt;æä¾›æœ¯è¯­ä¸æ ‡ç­¾åº“]

    subgraph Step3 [éœ€æ±‚è§£æå¼•æ“]
        B1[è¾“å…¥: ç”¨æˆ·åŸå§‹çµæ„Ÿ] --&gt; B2{æ˜¯å¦æ¨¡ç³Š?}
        B2 -- æ˜¯ --&gt; B3[è¿½é—®å…·ä½“ç»†èŠ‚]
        B3 --&gt; B1
        B2 -- å¦ --&gt; B4[ç”Ÿæˆé¡¹ç›®éœ€æ±‚è§„èŒƒ]
        B4 --&gt; B5[è¾“å‡º: ProjectSpec.md]
    end

    Step2 --&gt; Step3

    subgraph Step4 [å®šä¹‰éŸ³ä¹å†…æ ¸]
        C1[è¾“å…¥: ProjectSpec.md] --&gt; C2[è½¬åŒ–ä¸ºä¸“ä¸šéŸ³ä¹æœ¯è¯­]
        C2 --&gt; C3[ç”Ÿæˆæ ¸å¿ƒåˆ›æ„è“å›¾]
        C3 --&gt; C4[è¾“å‡º: CreativeCore.md]
    end

    B5 --&gt; Step4

    subgraph Step5 [æ­Œè¯ç”Ÿæˆ]
        D1[è¾“å…¥: CreativeCore.md] --&gt; D2[åˆ›ä½œç»“æ„åŒ–æ­Œè¯]
        D2 --&gt; D3[è¾“å‡º: Lyrics.md]
        D2 --&gt; D4[è¾“å‡º: VocalDesign.md]
    end

    C4 --&gt; Step5

    subgraph Step6 [ä½œæ›²ç”Ÿæˆ]
        E1[è¾“å…¥:&lt;br&gt;CreativeCore.md&lt;br&gt;Lyrics.md&lt;br&gt;VocalDesign.md] --&gt; E2[ç”ŸæˆSunoæç¤ºè¯]
        E2 --&gt; E3[è¾“å‡º: MusicPrompt.md]
    end

    D3 --&gt; Step6
    D4 --&gt; Step6

    subgraph Step7 [è´¨é‡æ ¡éªŒå¼•æ“]
        F1[è¾“å…¥: æ‰€æœ‰å‰æœŸäº§å‡º] --&gt; F2{ä¸€è‡´æ€§æ£€æŸ¥?}
        F2 -- ä¸é€šè¿‡ --&gt; F3[è¿”å›å¯¹åº”æ¨¡å—ä¿®æ­£]
        F3 --&gt; Step5
        F2 -- é€šè¿‡ --&gt; F4[ç”Ÿæˆè´¨é‡æŠ¥å‘Š]
        F4 --&gt; F5[è¾“å‡º: QualityReport.md]
    end

    E3 --&gt; Step7

    subgraph Step8 [è¡ç”Ÿå†…å®¹å¼•æ“]
        G1[è¾“å…¥: å®Œæ•´ä½œå“åŒ…] --&gt; G2[ç”Ÿæˆè¥é”€ææ–™]
        G2 --&gt; G3[è¾“å‡º: DerivativeContent.md]
    end

    F5 --&gt; Step8 --&gt; End([æµç¨‹ç»“æŸ])

    %% æ ·å¼å®šä¹‰
    classDef process fill:#e1f5fe,stroke:#01579b,stroke-width:2px;
    classDef decision fill:#fff3e0,stroke:#ef6c00,stroke-width:2px;
    classDef inputoutput fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px;
    classDef startend fill:#fce4ec,stroke:#c2185b,stroke-width:2px;
    
    class Step1,Step3,Step4,Step5,Step6,Step7,Step8 process;
    class B2,F2 decision;
    class B5,C4,D3,D4,E3,F5,G3 inputoutput;
    class Start,End startend;
</code></pre>
<p>ç»è¿‡å¤šæ¬¡è¿­ä»£ï¼Œæˆ‘æœ€ç»ˆç¡®ç«‹äº†ä¸€å¥—æ ‡å‡†åŒ–éŸ³ä¹ç”Ÿäº§ç®¡çº¿ã€‚è¯¥ç³»ç»Ÿçš„æ ¸å¿ƒæ€æƒ³æ˜¯ <strong>â€œæ¨¡å—åŒ–åˆ†å·¥â€</strong> ä¸ <strong>â€œå¥‘çº¦åŒ–åä½œâ€</strong> ï¼Œæ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€ï¼Œå¹¶é€šè¿‡æ ‡å‡†åŒ–çš„æ–‡ä»¶æ¥å£ä¼ é€’æ•°æ®ï¼Œç¡®ä¿æµç¨‹çš„ç¨³å®šæ€§å’Œè¾“å‡ºè´¨é‡ã€‚</p>
<h3 data-id="heading-3">ç³»ç»Ÿæ¶æ„æ€»è§ˆ</h3>
<p>æ•´ä¸ªå·¥ä½œæµæ˜¯ä¸€ä¸ªä¸¥æ ¼çš„ç€‘å¸ƒæ¨¡å‹ï¼Œä¸Šæ¸¸æ¨¡å—çš„è¾“å‡ºæ˜¯ä¸‹æ¸¸æ¨¡å—çš„å”¯ä¸€è¾“å…¥ï¼š</p>
<p><code>[éœ€æ±‚è§£æå¼•æ“] â†’ [å®šä¹‰éŸ³ä¹å†…æ ¸] â†’ [ä½œè¯å¼•æ“] â†’ [ä½œæ›²å¼•æ“] â†’ [è´¨é‡æ ¡éªŒå¼•æ“] â†’ [è¡ç”Ÿå†…å®¹å¼•æ“]</code></p>
<p>æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ <code>[çŸ¥è¯†åº“æ’ä»¶]</code> å¯ä¸ºå„æ¨¡å—æä¾›ä¸“ä¸šæœ¯è¯­æ”¯æŒã€‚</p>
<h3 data-id="heading-4">æ ¸å¿ƒæ¨¡å—è¯¦è§£</h3>
<h4 data-id="heading-5">1. éœ€æ±‚è§£æå¼•æ“</h4>
<p><strong>è§’è‰²</strong>ï¼šéŸ³ä¹é¡¹ç›®åˆ†æå¸ˆ
<strong>ä»»åŠ¡</strong>ï¼šå°†æ¨¡ç³Šã€æ„Ÿæ€§çš„ç”¨æˆ·çµæ„Ÿï¼Œè½¬åŒ–ä¸ºæ¸…æ™°ã€æ— æ­§ä¹‰ã€å¯æ‰§è¡Œçš„éœ€æ±‚æ–‡æ¡£ã€‚
<strong>è¾“å…¥</strong>ï¼šç”¨æˆ·åŸå§‹éœ€æ±‚ï¼ˆå¦‚ï¼šâ€œåšä¸€é¦–ç§‘æŠ€æ„Ÿã€çƒ­è¡€çš„æ­Œâ€ï¼‰
<strong>è¾“å‡º</strong>ï¼š<code>ProjectSpec.md</code>
<strong>æ ¸å¿ƒä»·å€¼</strong>ï¼šé€šè¿‡â€œåæ¨¡ç³Šè§„åˆ™â€å¼ºåˆ¶å…·ä½“åŒ–ï¼Œå¥ å®šé¡¹ç›®è´¨é‡åŸºçŸ³ã€‚</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># é¡¹ç›®éœ€æ±‚è§„èŒƒ</span>
<span class="hljs-section">## æ ¸å¿ƒæƒ…ç»ª</span>
<span class="hljs-bullet">-</span> ä¸»å¯¼åŸºè°ƒï¼šç§‘æŠ€æ„Ÿçš„çƒ­è¡€ä¸æ†§æ†¬
<span class="hljs-bullet">-</span> æƒ…æ„ŸåŠ¨æ€ï¼šä»ç†æ€§è§‚å¯Ÿåˆ°æ„Ÿæ€§é‡Šæ”¾
<span class="hljs-section">## é£æ ¼æ–¹å‘</span>
<span class="hljs-bullet">-</span> æ„Ÿè§‰æè¿°ï¼šæœªæ¥éƒ½å¸‚å¤©é™…çº¿åœ¨é»æ˜æ—¶çš„æ™¯è±¡
<span class="hljs-bullet">-</span> åŠ¨æ€æ¯”å–»ï¼šå¦‚æ•°æ®æ´ªæµæ±‡èšæˆæ¾æ¹ƒæµªæ½®
<span class="hljs-section">## æ ¸å¿ƒæ„è±¡</span>
<span class="hljs-bullet">-</span> è§†è§‰ç¬¦å·ï¼šå¤–æ»©å»ºç­‘ç¾¤ã€æµåŠ¨çš„ä»£ç å…‰å¸¦
...
</code></pre>
<h4 data-id="heading-6">2. å®šä¹‰éŸ³ä¹å†…æ ¸</h4>
<p><strong>è§’è‰²</strong>ï¼šéŸ³ä¹åˆ›æ„æ¶æ„å¸ˆ
<strong>ä»»åŠ¡</strong>ï¼šå°†æ ‡å‡†åŒ–çš„éœ€æ±‚ï¼Œåˆ›é€ æ€§è½¬åŒ–ä¸ºä¸€ä»½å…·å¤‡æ·±åº¦ä¸æ‰§è¡Œæ€§çš„æ ¸å¿ƒåˆ›æ„è“å›¾ã€‚
<strong>è¾“å…¥</strong>ï¼š<code>ProjectSpec.md</code>
<strong>è¾“å‡º</strong>ï¼š<code>CreativeCore.md</code>
<strong>æ ¸å¿ƒä»·å€¼</strong>ï¼šå®Œæˆä»â€œéœ€æ±‚æ˜¯ä»€ä¹ˆâ€åˆ°â€œéŸ³ä¹æ€ä¹ˆåšâ€çš„å…³é”®è·³è·ƒã€‚</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># æ ¸å¿ƒåˆ›æ„è“å›¾</span>
<span class="hljs-section">## éŸ³ä¹æ¦‚å¿µè®¾è®¡</span>
<span class="hljs-bullet">-</span> æ ¸å¿ƒå¼ åŠ›ï¼šæ•°å­—åˆæˆçš„ç²¾ç¡®ä¸äººæ€§æ¸©æš–çš„å¯¹æŠ—èåˆ
<span class="hljs-bullet">-</span> é£æ ¼å®šä½ï¼šä»¥Synthwaveä¸ºåŸºåº•ï¼Œèå…¥Cinematicå…ƒç´ 
<span class="hljs-section">## å£°éŸ³è®¾è®¡æ¡†æ¶</span>
<span class="hljs-bullet">-</span> èŠ‚å¥ä¸å¾‹åŠ¨ï¼š128 BPM/4/4 - å¼ºåŠ²ç”µå­é¼“ç»„ä¸è„‰å†²è´æ–¯
...
</code></pre>
<h4 data-id="heading-7">3. ä½œè¯å¼•æ“</h4>
<p><strong>è§’è‰²</strong>ï¼šéŸ³ä¹å‰§æœ¬ä½œå®¶
<strong>ä»»åŠ¡</strong>ï¼šåŸºäºåˆ›æ„è“å›¾ï¼Œç”Ÿæˆç»“æ„åˆ›æ–°ã€æƒ…æ„Ÿç²¾å‡†ä¸”ç¬¦åˆSunoæ ¼å¼æ ‡å‡†çš„æ­Œè¯è„šæœ¬ã€‚
<strong>è¾“å…¥</strong>ï¼š<code>CreativeCore.md</code>
<strong>è¾“å‡º</strong>ï¼š</p>
<ul>
<li><code>Lyrics.md</code> (æ­Œè¯æ–‡ä»¶)</li>
<li><code>VocalDesign.md</code> (æ¼”å”±è®¾è®¡æ–‡ä»¶)
<strong>æ ¸å¿ƒä»·å€¼</strong>ï¼šè¾“å‡ºéæ¨¡æ¿åŒ–çš„ã€å…·æœ‰æˆå‰§å¼ åŠ›çš„æ­Œè¯ï¼Œå¹¶é™„å¸¦ä¸“ä¸šçš„æ¼”å”±æŒ‡å¯¼ã€‚</li>
</ul>
<pre><code class="hljs language-text" lang="text">[Intro] (æ°›å›´æ„Ÿç”µå­éŸ³æ•ˆ) /
åŸå¸‚åœ¨é‡å¯ ä»£ç çš„æ½®æ± /
[Verse 1] (å†·é™å™è¿°)
ç©¿è¿‡å¤–æ»©çš„é£ å¬è§æœªæ¥çš„å›éŸ³ /
...
</code></pre>
<h4 data-id="heading-8">4. ä½œæ›²å¼•æ“</h4>
<p><strong>è§’è‰²</strong>ï¼šSunoéŸ³æ•ˆè®¾è®¡å¸ˆ
<strong>ä»»åŠ¡</strong>ï¼šå°†åˆ›æ„è“å›¾å’Œæ­Œè¯â€œç¿»è¯‘â€æˆSunoèƒ½ç†è§£çš„ã€ç²¾ç¡®çš„éŸ³ä¹é£æ ¼æç¤ºè¯ã€‚
<strong>è¾“å…¥</strong>ï¼š<code>CreativeCore.md</code>, <code>Lyrics.md</code>, <code>VocalDesign.md</code>
<strong>è¾“å‡º</strong>ï¼š<code>MusicPrompt.md</code>
<strong>æ ¸å¿ƒä»·å€¼</strong>ï¼šå®ç°â€œéŸ³è‰²å™äº‹â€ï¼Œå°†æ–‡å­—æ¦‚å¿µè½¬åŒ–ä¸ºå…·ä½“çš„å£°éŸ³æè¿°ã€‚</p>
<pre><code class="hljs language-text" lang="text">Synthwave fused with Cinematic Pop, uplifting and futuristic.
Powerful male vocals with rap sections. 128 BPM.
Featuring soaring synthesizer leads and pounding electronic drums.
</code></pre>
<h4 data-id="heading-9">5. è´¨é‡æ ¡éªŒå¼•æ“</h4>
<p><strong>è§’è‰²</strong>ï¼šéŸ³ä¹è´¨é‡å®¡è®¡å¸ˆ
<strong>ä»»åŠ¡</strong>ï¼šå¯¹æ­Œè¯å’ŒéŸ³ä¹æç¤ºè¯è¿›è¡Œä¸€è‡´æ€§æ ¡éªŒï¼Œç¡®ä¿æ‰€æœ‰äº§å‡ºç¬¦åˆè‰ºæœ¯æ ‡å‡†å’ŒæŠ€æœ¯è§„èŒƒã€‚
<strong>è¾“å…¥</strong>ï¼š<code>CreativeCore.md</code>, <code>Lyrics.md</code>, <code>MusicPrompt.md</code>
<strong>è¾“å‡º</strong>ï¼š<code>QualityReport.md</code>
<strong>æ ¸å¿ƒä»·å€¼</strong>ï¼šä½œä¸ºè´¨é‡å®ˆé—¨å‘˜ï¼Œå½¢æˆåˆ›ä½œé—­ç¯ï¼Œç¡®ä¿æœ€ç»ˆäº§å‡ºä¸æœ€åˆæ„¿æ™¯ä¸€è‡´ã€‚</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># è´¨é‡æ ¡éªŒæŠ¥å‘Š</span>
<span class="hljs-section">## ä¸€è‡´æ€§æ£€æŸ¥</span>
<span class="hljs-bullet">-</span> [x] æ­Œè¯ä¸»é¢˜ä¸åˆ›æ„è“å›¾çš„æ ¸å¿ƒå¼ åŠ›ä¸€è‡´
<span class="hljs-bullet">-</span> [x] éŸ³ä¹é£æ ¼ä¸å†…æ ¸å®šä¹‰åŒ¹é…
<span class="hljs-section">## ä¼˜åŒ–å»ºè®®</span>
<span class="hljs-bullet">-</span> å‰¯æ­Œéƒ¨åˆ†å¯å¢åŠ å’Œå£°è®¾è®¡çš„æè¿°
</code></pre>
<h4 data-id="heading-10">6. è¡ç”Ÿå†…å®¹å¼•æ“</h4>
<p><strong>è§’è‰²</strong>ï¼šéŸ³ä¹äº§å“ç»ç†
<strong>ä»»åŠ¡</strong>ï¼šåŸºäºå®Œæ•´çš„éŸ³ä¹ä½œå“åŒ…ï¼Œè‡ªåŠ¨ç”Ÿæˆé…å¥—çš„è¥é”€å’Œå‘è¡Œææ–™ã€‚
<strong>è¾“å…¥</strong>ï¼šæ‰€æœ‰å‰æœŸäº§å‡ºæ–‡ä»¶
<strong>è¾“å‡º</strong>ï¼š<code>DerivativeContent.md</code>
<strong>æ ¸å¿ƒä»·å€¼</strong>ï¼šæœ€å¤§åŒ–ä½œå“ä»·å€¼ï¼Œæä¾›å¼€ç®±å³ç”¨çš„å®£å‘ç´ æã€‚</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># è¡ç”Ÿå†…å®¹åŒ…</span>
<span class="hljs-section">## æ­Œæ›²åç§°</span>
<span class="hljs-section">## å°é¢å›¾ç‰‡</span>
<span class="hljs-section">## æ­Œæ›²ç®€ä»‹</span>
ä¸€é¦–å…³äº...çš„Synthwaveä½œå“ã€‚
</code></pre>
<h2 data-id="heading-11">å¿ƒç†è·¯ç¨‹</h2>
<h3 data-id="heading-12">v1</h3>
<blockquote>
<p>ç›´æ¥æè¿°éœ€æ±‚-ç²˜è´´æ­Œè¯ç”Ÿæˆæç¤ºè¯-ç²˜è´´éŸ³ä¹æç¤ºè¯ç”Ÿæˆ-èåˆå‰é¢çš„è¾“å…¥ï¼Œæ•´åˆè¾“å‡ºæœ€åäº§ç‰©
v1å¯ä»¥è¾“å‡ºå†…å®¹ï¼Œä½†æµç¨‹è¿˜æ˜¯ä¸æ»¡æ„ï¼Œè™½ç„¶å¤Ÿç”¨ã€‚ä¹‹åæ„æ€æ–°æµç¨‹ï¼Œåé¢çš„æ‰€æœ‰æ­¥éª¤éƒ½æ˜¯æŒ‰ç…§æ–°çš„æµç¨‹ <code>æ¨¡ç³Šéœ€æ±‚æç¤ºè¯ç›®æ ‡å¡«ç©ºéœ€æ±‚ - ç†è§£éœ€æ±‚è¾“å‡ºæ¸…æ™°æ ‡å‡†çš„éœ€æ±‚ - æ ¹æ®æ ‡å‡†çš„éœ€æ±‚ç”Ÿæˆå†…æ ¸ - ç”Ÿäº§æ­Œè¯ -ç”Ÿæˆé£æ ¼æç¤ºè¯ - æ ¡éªŒ - è¾“å‡º</code></p>
</blockquote>
<pre><code class="hljs language-md" lang="md"><span class="hljs-section"># è§’è‰²è®¾å®š</span>
<span class="hljs-section"># ä»»åŠ¡è¯´æ˜</span>
<span class="hljs-section"># è¾“å…¥ä¿¡æ¯</span>
<span class="hljs-section"># è¾“å‡ºè¦æ±‚</span>
</code></pre>
<h3 data-id="heading-13">v2</h3>
<blockquote>
<p>v2çš„å‰é¢æ ¸å¿ƒæµç¨‹èµ°é€šäº†ï¼Œå¯æ˜¯æç¤ºè¯å¾ˆä¹±ï¼Œæœ€åçº¦æŸä¸é™åˆ¶å’Œç¤ºä¾‹å¯¹ç…§è¡¨æœªå®Œæˆå°±è½¬v3</p>
</blockquote>
<pre><code class="hljs language-md" lang="md"><span class="hljs-section"># Step [æ­¥éª¤åç§°]</span>
<span class="hljs-section">## è§’è‰²è®¾å®šï¼ˆRoleï¼‰</span>
<span class="hljs-section">## ä»»åŠ¡ç›®æ ‡ï¼ˆTaskï¼‰</span>
<span class="hljs-section">## è¾“å…¥å‚æ•°ï¼ˆInputsï¼‰</span>
<span class="hljs-section">### è¾“å‡ºæ ¼å¼ï¼ˆOutputsï¼‰</span>
<span class="hljs-section">## çº¦æŸä¸é™åˆ¶ï¼ˆConstraintsï¼‰</span>
<span class="hljs-section">## ç¤ºä¾‹å¯¹ç…§è¡¨ï¼ˆExampleï¼‰ </span>
</code></pre>
<h3 data-id="heading-14">v3</h3>
<blockquote>
<p>v3ä¹‹å‰æ˜¯é˜¶æ®µæ¦‚å¿µï¼Œè¿™é‡Œå¼•å…¥æ¨¡å—æ¦‚å¿µï¼Œå¼•å…¥çŸ¥è¯†åº“æ¦‚å¿µï¼Œæ–°çš„æ¨¡æ¿æ ¼å¼æ›´æ¸…æ™°</p>
</blockquote>
<pre><code class="hljs language-md" lang="md"><span class="hljs-section"># Module - {{modelName}}</span>
<span class="hljs-section">## Role</span>
<span class="hljs-section">## Task</span>
<span class="hljs-section">## Inputs</span>
<span class="hljs-section">## Outputs</span>
<span class="hljs-quote">&gt; <span class="hljs-strong">**æ–‡ä»¶å**</span>ï¼š`{{fileName}}.md`</span>
<span class="hljs-quote">&gt; <span class="hljs-strong">**æ ¼å¼**</span>ï¼šä¸¥æ ¼éµå¾ªä»¥ä¸‹Markdownæ¨¡æ¿</span>

<span class="hljs-code">```markdown ```</span>
<span class="hljs-section">## Rules</span>
<span class="hljs-section">## Example</span>
| è¾“å…¥ | è¾“å‡º |
| :--- | :--- |
</code></pre>
<h3 data-id="heading-15">v4</h3>
<blockquote>
<p>æˆ‘ä¸€ç›´æ˜¯å¯¹è¯æµï¼Œä¸ºäº†åŒºåˆ†ä¸åŒåŠŸèƒ½ï¼Œå¼•å…¥äº†æ ‡ç­¾åŒ…è£¹æç¤ºè¯ï¼Œå¢åŠ äº† debugã€devã€moduleã€plugin ç­‰æ ‡ç­¾ï¼Œç”¨äºæŒ‡å®šä¸åŒçš„åŠŸèƒ½æ¨¡å—ã€‚
debugçœŸçš„å¥½ç”¨ï¼Œåœ¨æˆ‘ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¾“å‡ºä¸ç¬¦åˆè¦æ±‚ä½¿ï¼Œåœ¨debugæ ‡ç­¾å†…è¦æ±‚æ¨¡å‹è‡ªå·±åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆï¼Œæ•ˆç‡å¾ˆé«˜éå¸¸æ–¹ä¾¿ã€‚</p>
</blockquote>
<pre><code class="hljs language-md" lang="md"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span></span>
<span class="hljs-section"># Module - {{modelName}}</span>
<span class="hljs-section">## Role</span>
<span class="hljs-section">## Task</span>
<span class="hljs-section">## Inputs</span>
<span class="hljs-section">## Outputs</span>
<span class="hljs-quote">&gt; <span class="hljs-strong">**æ–‡ä»¶å**</span>ï¼š`{{fileName}}.md`</span>
<span class="hljs-quote">&gt; <span class="hljs-strong">**æ ¼å¼**</span>ï¼šä¸¥æ ¼éµå¾ªä»¥ä¸‹Markdownæ¨¡æ¿</span>

<span class="hljs-code">```markdown ```</span>
<span class="hljs-section">## Rules</span>
<span class="hljs-section">## Example</span>
| è¾“å…¥ | è¾“å‡º |
| :--- | :--- |
<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-16">v4.1</h3>
<p>æŸ¥æ‰¾èµ„æ–™ï¼Œæ€»ç»“æ›´å®Œå–„çš„sunoè§„åˆ™</p>
<p><strong>èµ„æºåˆ†äº«ï¼š</strong>
åœ¨å®è·µä¸­æ•´ç†çš„è¯¦ç»†æ–‡æ¡£ï¼Œä¾›å‚è€ƒï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fqcn0ge2z1yhd.feishu.cn%2Fwiki%2FV7qtwgdDCiLfWfkWIglcEU1AnVc" target="_blank" title="https://qcn0ge2z1yhd.feishu.cn/wiki/V7qtwgdDCiLfWfkWIglcEU1AnVc" ref="nofollow noopener noreferrer">Suno AI æç¤ºè¯</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fqcn0ge2z1yhd.feishu.cn%2Fwiki%2FV06vwRsvbiPqhzk0qP6cmMdYnsh" target="_blank" title="https://qcn0ge2z1yhd.feishu.cn/wiki/V06vwRsvbiPqhzk0qP6cmMdYnsh" ref="nofollow noopener noreferrer">Suno AI æç¤ºè¯è§„åˆ™</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fqcn0ge2z1yhd.feishu.cn%2Fwiki%2FTkp8wZFZtiHtyDkhlLxcOND5nad" target="_blank" title="https://qcn0ge2z1yhd.feishu.cn/wiki/Tkp8wZFZtiHtyDkhlLxcOND5nad" ref="nofollow noopener noreferrer">AIéŸ³ä¹ç”ŸæˆæŒ‡å—V4</a></li>
</ul>
<h2 data-id="heading-17">ç»“è¯­</h2>
<h3 data-id="heading-18">å­¦åˆ°äº†ä»€ä¹ˆï¼Ÿ</h3>
<p>é€šè¿‡ä»é›¶å¼€å§‹è®¾è®¡å’Œè¿­ä»£è¿™å¥—SunoéŸ³ä¹å·¥ä½œæµï¼Œæˆ‘è·å¾—äº†å…³äºAIæ™ºèƒ½ä½“æ„å»ºçš„ç¬¬ä¸€æ‰‹ç»éªŒã€‚è¿™ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæç¤ºè¯ä¼˜åŒ–è¿‡ç¨‹ï¼Œæ›´æ˜¯ä¸€æ¬¡å®Œæ•´çš„æ™ºèƒ½ä½“ç³»ç»Ÿå¼€å‘ç”Ÿå‘½å‘¨æœŸå®è·µï¼š
å¥½çš„ï¼Œå¦‚æœæˆ‘æ˜¯ä½ ï¼Œå›é¡¾æ•´ä¸ªæ¢ç´¢è¿‡ç¨‹ï¼Œæˆ‘å­¦åˆ°äº†æœ€æ ¸å¿ƒçš„ä¸‰ç‚¹ï¼š</p>
<ol>
<li><strong>ä»â€œä¸‹æŒ‡ä»¤â€åˆ°â€œå»ºç³»ç»Ÿâ€çš„æ€ç»´è·ƒè¿</strong>
æœ€å¤§çš„æ”¶è·ä¸æ˜¯å†™å‡ºäº†æ›´å¥½çš„æç¤ºè¯ï¼Œè€Œæ˜¯å­¦ä¼šäº†ä¸ç›´æ¥å‘AIè¦ç»“æœï¼Œè€Œæ˜¯ä¸ºå®ƒè®¾è®¡ä¸€å¥—åˆ†å·¥æ˜ç¡®ã€æ¥å£æ¸…æ™°çš„åä½œç³»ç»Ÿã€‚æˆ‘ä»â€œç”¨æˆ·â€å˜æˆäº†â€œæ¶æ„å¸ˆâ€ã€‚</li>
<li><strong>â€œå¥‘çº¦â€æ¯”â€œæ¨¡å‹â€æ›´å…³é”®</strong>
æˆ‘å‘ç°ï¼Œç¡®ä¿å¤šä¸ªAIæ™ºèƒ½ä½“ç¨³å®šåä½œçš„æ ¸å¿ƒï¼Œä¸æ˜¯æ‰¾åˆ°ä¸€ä¸ªæœ€å¼ºå¤§çš„æ¨¡å‹ï¼Œè€Œæ˜¯ä¸ºå®ƒä»¬è®¾è®¡å¥½åƒ <code>ProjectSpec.md</code> è¿™æ ·çš„æ ‡å‡†åŒ–â€œå¥‘çº¦â€ï¼ˆæ¥å£ï¼‰ã€‚æ¸…æ™°çš„æ¥å£å®šä¹‰æ˜¯ç³»ç»Ÿç¨³å®šæ€§çš„åŸºçŸ³ã€‚</li>
<li><strong>åˆ›é€ åŠ›å¯ä»¥â€œå·¥ç¨‹åŒ–â€</strong>
æˆ‘æˆåŠŸåœ°å°†çœ‹ä¼¼ä¾èµ–çµæ„Ÿçš„éŸ³ä¹åˆ›ä½œï¼Œåˆ†è§£æˆäº†ä¸€ä¸ªå¯é‡å¤ã€å¯ä¼˜åŒ–ã€å¯æ§çš„å·¥ç¨‹æµç¨‹ã€‚è¿™è¯æ˜äº†å¤æ‚åˆ›æ„ä»»åŠ¡å¯ä»¥é€šè¿‡ç³»ç»ŸåŒ–çš„æ–¹æ³•å˜å¾—ç¨³å®šå’Œå¯é ã€‚</li>
</ol>
<h3 data-id="heading-19">å…¶ä»–</h3>
<p>ä¸‹ä¸€æ­¥å°±æ˜¯æŠŠv4æ¬åˆ°æ‰£å­ã€difyå·¥ä½œæµå®ç°æ›´ä¾¿æ·çš„uiæ“ä½œï¼Œå†å¢åŠ <strong>ç‚¹å­ç‹æ¨¡å—</strong>èŠ‚ç‚¹ï¼Œä½¿ç”¨å¾ªç¯èŠ‚ç‚¹è¾“å‡ºå¤šé£æ ¼ç‰ˆæœ¬ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ®ä¸€çœ¼å°±ä¼šğŸ—‚ï¸å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ ï¼Œç™½é€å‰åç«¯å…¨å¥—åŠŸæ³•]]></title>    <link>https://juejin.cn/post/7570268773333205019</link>    <guid>https://juejin.cn/post/7570268773333205019</guid>    <pubDate>2025-11-09T23:09:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570268773333205019" data-draft-id="7568706594881683466" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ®ä¸€çœ¼å°±ä¼šğŸ—‚ï¸å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ ï¼Œç™½é€å‰åç«¯å…¨å¥—åŠŸæ³•"/> <meta itemprop="keywords" content="Node.js,JavaScript,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-09T23:09:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="vilan_å¾®æ¾œ"/> <meta itemprop="url" content="https://juejin.cn/user/2225067267199320"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ®ä¸€çœ¼å°±ä¼šğŸ—‚ï¸å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ ï¼Œç™½é€å‰åç«¯å…¨å¥—åŠŸæ³•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2225067267199320/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    vilan_å¾®æ¾œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T23:09:25.000Z" title="Sun Nov 09 2025 23:09:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#5f6368;background-image:linear-gradient(90deg,rgba(240,191,213,.1) 3%,transparent 0),linear-gradient(1turn,rgba(240,191,213,.1) 3%,transparent 0);background-size:20px 20px;background-position:50%;letter-spacing:1px;word-spacing:1px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-left:50px;padding-bottom:5px;color:#5f6368}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{position:absolute;left:0;display:block;content:""}.markdown-body h1{font-size:32px;margin-bottom:5px}.markdown-body h1:before{top:0;content:"ğŸ¦„";font-size:32px}.markdown-body h2{padding-bottom:24px;border-bottom:1px solid #ececec}.markdown-body h2:before{top:0;left:8px;content:"ğŸ³";font-size:24px}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{top:-2px;left:8px;content:"ğŸ„";font-size:20px}.markdown-body h4{font-size:16px}.markdown-body h4:before{top:-2px;left:8px;content:"ğŸ¦¥";font-size:18px}.markdown-body h5{font-size:14px}.markdown-body h5:before{top:-2px;left:9px;content:"ğŸ¦©";font-size:16px}.markdown-body h6{font-size:12px;margin-top:5px}.markdown-body h6:before{top:-1px;left:10px;content:"ğŸ§";font-size:14px}.markdown-body p{line-height:1.9;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid rgba(253,121,168,.5);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#a6accd;background:#292d3e;border-radius:8px}.markdown-body a{text-decoration:none;color:#fd79a8;border-bottom:1px solid #fd79a8;padding:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(253,121,168,.1);color:#ee69a9}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body th{color:#fd79a8}.markdown-body th,.markdown-body tr:hover{background:rgba(253,121,168,.1)}.markdown-body td{min-width:120px}.markdown-body blockquote{position:relative;color:#666;padding:23px;margin:22px 0;border-left:4px solid #ee69a9;background-color:rgba(253,121,168,.1)}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;display:block;font-size:27px;color:#fd79a8;opacity:.8}.markdown-body blockquote:before{left:10px;top:0;content:"â"}.markdown-body blockquote:after{right:10px;bottom:0;content:"â"}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body strong{position:relative;color:#fd79a8}.markdown-body strong:before{content:"Â· "}.markdown-body strong:after{content:" Â·"}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#fd79a8}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#ee69a9}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>å¿«çœ‹ï¼å‰æ–¹å¥½åƒæœ‰ä»€ä¹ˆäººåœ¨äº‰åµã€‚</p>
<p>æˆ‘è¿™ä¸ªæ–‡ä»¶ä¸Šä¼ äº†è¿™ä¹ˆå¤šï¼Œæ€ä¹ˆåˆè¦é‡æ–°å¼€å§‹ä¸Šä¼ å•Šï¼Ÿ</p>
<p>æˆ‘è¿™ä¸ªç½‘é¡µæ€ä¹ˆåˆå¡ä½äº†ã€‚</p>
<p>åˆ‡å›¾ä»”å¿«æ¥çœ‹çœ‹ï¼</p>
<p><strong>å•Šå•Šå•Šï¼</strong> å‰æ–¹çªç„¶ä¼ æ¥ä¸€å£°å°–å«ï¼Œåªè§ä¸€ä¸ªå¹´è½»äººâ€œé¢¤é¢¤å·å·â€åœ°ä»å·¥ä½ä¸Šç«™èµ·ï¼ŒæŒ‡ç€ä»–åæ–¹çš„åŒäº‹ï¼Œéšåå¤§å–Šä¸€å£°ï¼šâ€œä½ ä¸è¦å†å«æˆ‘åˆ‡å›¾ä»”å•¦ï¼â€</p>
<p>è¯éŸ³åˆšè½ï¼Œåªè§åæ–¹åŒäº‹è¡¨ç°å‡ºä¸€å‰¯å—¤ä¹‹ä»¥é¼»çš„æ ·å­ï¼Œéšåå¸¦ç€ä¸€ä¸è½»è”‘ï¼Œå¯¹ç€é‚£ä¸ªå¹´è½»äººåˆæ’‚ä¸‹ä¸€å¥ï¼šâ€œåˆ‡å›¾ä»”ï¼â€ã€‚</p>
<p>éšå³ï¼Œé‚£ä¸ªå¹´è½»äººå…¨èº«éƒ½åœ¨é¢¤æŠ–ï¼Œä»¿ä½›å°±è¦......</p>
<h2 data-id="heading-0">å¼•è¨€</h2>
<p>å¼€å§‹å­¦ä¹ ã€‚</p>
<p>ä¸‹æ–‡å°†å¸¦ä½ æ‰“é€šä»å‰ç«¯æ–‡ä»¶åˆ†ç‰‡ã€æ–‡ä»¶å“ˆå¸Œè®¡ç®—ã€<code>Web Worker</code>ç”¨æ³•ã€æ–‡ä»¶æ–­ç‚¹ç»­ä¼ å’Œç§’ä¼ ï¼Œåˆ°åç«¯åˆ†ç‰‡æ¥æ”¶ã€æ–‡ä»¶åˆå¹¶çš„å®Œæ•´æŠ€æœ¯é“¾æ¡ã€‚</p>
<p><strong>åç«¯</strong>åŸºäºÂ <strong>Node.js + Express</strong>Â æ¡†æ¶ï¼Œä½¿ç”¨Â <strong>formidable</strong>Â åº“é«˜æ•ˆå¤„ç†åˆ†ç‰‡æ•°æ®ï¼Œæœ€ç»ˆå°†åˆ†ç‰‡åˆå¹¶ä¸ºå®Œæ•´æ–‡ä»¶ã€‚</p>
<p><strong>å‰ç«¯</strong>é‡‡ç”¨Â <strong>Vue 3 + TS + Vite</strong>Â æ„å»ºï¼Œä½¿ç”¨Â <strong>Naive UI</strong>Â å†™ä¸ªå¥½çœ‹ç‚¹çš„ä¸Šä¼ è¿›åº¦ç›‘æ§ç•Œé¢ï¼Œå¹¶åˆ©ç”¨Â <strong>Web Worker</strong>Â çº¿ç¨‹è®¡ç®—æ–‡ä»¶å“ˆå¸Œã€‚</p>
<p><strong>å…³é”®è¯ï¼š</strong> æ–‡ä»¶åˆ†ç‰‡ã€æ–‡ä»¶ç§’ä¼ ã€æ–­ç‚¹ç»­ä¼ ã€ä¸Šä¼ è¿›åº¦ã€æ–‡ä»¶hashã€Web Workerã€Node.js</p>
<h2 data-id="heading-1">å®ç°åŸç†å›¾è§£</h2>
<p>ä¸‹é¢<strong>ä¸¤å¼ å›¾</strong>å±•ç¤ºäº†ä»<strong>å‰ç«¯</strong>ä¸Šä¼ æ–‡ä»¶åˆ†ç‰‡åˆ°<strong>åç«¯</strong>è§£æåˆ†ç‰‡æ•°æ®å¹¶å†™å…¥æ–‡ä»¶ã€åˆå¹¶åˆ†ç‰‡æ–‡ä»¶çš„<strong>å…¨å¥—åŠŸæ³•</strong>ã€‚</p>
<h3 data-id="heading-2">å‰ç«¯å®ç°å›¾è§£</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7398d3f7c7e43349c2106ff954bb2ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdmlsYW5f5b6u5r6c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763339326&amp;x-signature=OtpaAiZGapc7u35U%2FtY6wB95Yf4%3D" alt="å‰ç«¯.png" loading="lazy"/></p>
<h3 data-id="heading-3">åç«¯å®ç°å›¾è§£</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39b1ad33662f4a1597ac084d99f70a6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdmlsYW5f5b6u5r6c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763339326&amp;x-signature=OaZCU5BRxPmO4xlasyj3XF5nmuY%3D" alt="æ— æ ‡é¢˜-2025-11-08-2359.png" loading="lazy"/></p>
<p>çœ‹å®Œå›¾è§£å¤§æ¦‚ç†è§£å®ç°æµç¨‹å°±å¯ä»¥ä¸Šæ‰‹å†™ä»£ç äº†</p>
<h2 data-id="heading-4">å‰ç«¯å®ç°ä»£ç </h2>
<p>é¦–å…ˆæˆ‘ä»¬çš„ç›®çš„æ˜¯å°è£…ä¸€ä¸ªæä¾›å¤§æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½çš„å‡½æ•°ï¼Œç”±äºå‡½æ•°ä¸­åˆæ¶‰åŠåˆ°é¡µé¢çš„ä¸€äº›<strong>å“åº”å¼çŠ¶æ€</strong>ï¼Œæ¯”å¦‚ä¸Šä¼ è¿›åº¦ï¼Œé‚£ä¹ˆæˆ‘ä»¬å§‘ä¸”å°±å«å®ƒä¸º<code>hook</code>å‡½æ•°å§ï¼Œç„¶åæŠŠå®ƒå‘½åä¸º<code>useBigFileUpload.ts</code></p>
<p>ä¸‹é¢å…ˆæŠŠéœ€è¦ç”¨åˆ°çš„<strong>å±æ€§å’Œç±»å‹</strong>å…ˆå†™ä¸Šï¼Œå…¶ä»–æ–¹æ³•åé¢å†é€æ­¥å®Œå–„ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> axios, { <span class="hljs-keyword">type</span> <span class="hljs-title class_">AxiosProgressEvent</span>, <span class="hljs-keyword">type</span> <span class="hljs-title class_">AxiosResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"axios"</span>;
<span class="hljs-keyword">import</span> { createDiscreteApi } <span class="hljs-keyword">from</span> <span class="hljs-string">"naive-ui"</span>;
<span class="hljs-keyword">import</span> { computed, markRaw, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;

<span class="hljs-keyword">const</span> baseUrl = <span class="hljs-string">"http://localhost:3000"</span>;

<span class="hljs-comment">// axioså®ä¾‹åŒ–</span>
<span class="hljs-keyword">const</span> http = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">baseURL</span>: baseUrl,
});

<span class="hljs-keyword">const</span> { message } = <span class="hljs-title function_">createDiscreteApi</span>([<span class="hljs-string">"message"</span>]);

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Props</span> = {
  <span class="hljs-attr">chunkSize</span>: <span class="hljs-built_in">number</span>;
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">ChunkRequestQueue</span> = {
  <span class="hljs-attr">promise</span>: <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">AxiosResponse</span>&gt;;
  <span class="hljs-attr">abortController</span>: <span class="hljs-title class_">AbortController</span>;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Chunk</span> = {
  <span class="hljs-comment">// åˆ‡ç‰‡æ•°æ®</span>
  <span class="hljs-attr">chunk</span>: <span class="hljs-title class_">Blob</span>;
  <span class="hljs-comment">// å½“å‰åˆ‡ç‰‡ç´¢å¼•</span>
  <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-comment">// åˆ‡ç‰‡æ–‡ä»¶å</span>
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-comment">// æ€»å¤§å°</span>
  <span class="hljs-attr">size</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-comment">// å·²ä¸Šä¼ å¤§å°</span>
  <span class="hljs-attr">uploaded</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-comment">// è¯·æ±‚æ€»è¿›åº¦</span>
  <span class="hljs-attr">requestSize</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-comment">// æ˜¯å¦å®Œæˆä¸Šä¼ </span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>;
  <span class="hljs-comment">// ä¸Šä¼ è¿›åº¦</span>
  <span class="hljs-attr">progress</span>: <span class="hljs-built_in">number</span>;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useBigFileUpload</span> = (<span class="hljs-params">
  props: Props = {
    chunkSize: <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1</span>,
  }
</span>) =&gt; {

  <span class="hljs-comment">// å½“å‰è®¡ç®—hashè¿›åº¦</span>
  <span class="hljs-keyword">const</span> hashProgress = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);

  <span class="hljs-comment">// æ˜¯å¦æš‚åœäº†ä¸Šä¼ </span>
  <span class="hljs-keyword">const</span> isPuase = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>);

  <span class="hljs-comment">// å½“å‰ä¸Šä¼ çš„æ–‡ä»¶</span>
  <span class="hljs-keyword">let</span> <span class="hljs-attr">fileTarget</span>: <span class="hljs-title class_">File</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;

  <span class="hljs-comment">// æ–‡ä»¶å“ˆå¸Œå€¼+æ–‡ä»¶åç¼€å</span>
  <span class="hljs-keyword">let</span> fileHash = <span class="hljs-string">""</span>;

  <span class="hljs-comment">// å½“å‰ä¸Šä¼ åˆ‡ç‰‡æ•°ç»„</span>
  <span class="hljs-keyword">const</span> chunks = ref&lt;<span class="hljs-title class_">Chunk</span>[]&gt;([]);

  <span class="hljs-comment">// å½“å‰ä¸Šä¼ è¯·æ±‚é˜Ÿåˆ—</span>
  <span class="hljs-keyword">let</span> <span class="hljs-attr">chunkReqQueueList</span>: <span class="hljs-title class_">ChunkRequestQueue</span>[] = [];

  <span class="hljs-comment">// å½“å‰ä¸Šä¼ å®Œæˆçš„åˆ‡ç‰‡/æ€»åˆ‡ç‰‡æ•°</span>
  <span class="hljs-keyword">const</span> percentage = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> chunkSize = chunks.<span class="hljs-property">value</span>.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">if</span> (chunkSize === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
    <span class="hljs-keyword">const</span> conpletedChunks = chunks.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">chunk</span>) =&gt;</span> chunk.<span class="hljs-property">completed</span>);
    <span class="hljs-keyword">return</span> (conpletedChunks.<span class="hljs-property">length</span> / chunkSize) * <span class="hljs-number">100</span>;
  });

  <span class="hljs-keyword">return</span> {
    percentage,
    chunks,
    isPuase,
    hashProgress,
  };
};

</code></pre>
<h3 data-id="heading-5">æ–‡ä»¶åˆ‡ç‰‡</h3>
<p>åˆ›å»º<code>createChunks</code>æ–¹æ³•ï¼Œå¯¹å¤§æ–‡ä»¶è¿›è¡Œåˆ‡ç‰‡</p>
<pre><code class="hljs language-ts" lang="ts"> <span class="hljs-comment">// åˆ›å»ºåˆ‡ç‰‡ï¼Œåˆ‡ç‰‡å¤§å°å¯æ ¹æ®è‡ªèº«éœ€æ±‚è°ƒæ•´</span>
  <span class="hljs-keyword">const</span> createChunks = (
    <span class="hljs-attr">file</span>: <span class="hljs-title class_">File</span>,
    <span class="hljs-attr">chunkSize</span>: <span class="hljs-built_in">number</span> = props.<span class="hljs-property">chunkSize</span>
  ): <span class="hljs-title class_">Blob</span>[] =&gt; {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">chunks</span>: <span class="hljs-title class_">Blob</span>[] = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, j = <span class="hljs-number">0</span>; i &lt; file.<span class="hljs-property">size</span>; i += chunkSize, j++) {
      chunks.<span class="hljs-title function_">push</span>(file.<span class="hljs-title function_">slice</span>(i, i + chunkSize));
    }
    <span class="hljs-keyword">return</span> chunks;
  };
</code></pre>
<p>é€šè¿‡åˆ†ç‰‡è®¡ç®—æ–‡ä»¶<code>hash</code>å€¼ï¼Œå…¶ä¸­æœ‰ä¸¤ç§è®¡ç®—ç±»å‹ï¼š</p>
<p>1.<strong>æŠ½æ ·åˆ†ç‰‡è®¡ç®—</strong>ã€‚é€šè¿‡æŠ½å–æ–‡ä»¶çš„ä¸€éƒ¨åˆ†åˆ†ç‰‡è¿›è¡Œä¸€éƒ¨åˆ†æ–‡ä»¶å†…å®¹çš„hashå€¼è®¡ç®—ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥èŠ‚çœè®¡ç®—è€—æ—¶ã€‚</p>
<p>2.<strong>å…¨é‡åˆ†ç‰‡è®¡ç®—</strong>ã€‚é€šè¿‡æ‰€æœ‰åˆ†ç‰‡è®¡ç®—å®Œæ•´çš„æ–‡ä»¶å†…å®¹hashå€¼ï¼Œè¿™ä¸ªæ–¹æ³•è®¡ç®—çš„å€¼ä¼šæ¯”è¾ƒå‡†ç¡®ï¼Œä½†æ˜¯è®¡ç®—è€—æ—¶ç›¸å¯¹å¤šä¸€äº›ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬<strong>é‡‡ç”¨</strong>çš„æ˜¯<strong>ç¬¬äºŒç§</strong>æ–¹æ³•è¿›è¡Œè®¡ç®—ã€‚</p>
<h3 data-id="heading-6">æ–‡ä»¶hashè®¡ç®—</h3>
<p>åœ¨ä½ çš„é¡¹ç›®çš„utilså·¥å…·åŒ…ä¸­åˆ›å»º<code>file-hash.work.js</code>æ–‡ä»¶ï¼Œè®¡ç®—æ–‡ä»¶å†…å®¹hashå€¼çš„<code>Web Worker</code>æ–¹æ³•</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// åœ¨ utils/workers/file-hash.work.js ä¸­</span>
<span class="hljs-comment">// å¼•å…¥ SparkMD5 è®¡ç®—æ–‡ä»¶å†…å®¹hash</span>
<span class="hljs-comment">// importScripts('/spark-md5@3.0.2/spark-md5.min.js');</span>
importScripts(<span class="hljs-string">'https://cdn.jsdelivr.net/npm/spark-md5@3.0.2/spark-md5.min.js'</span>);

self.<span class="hljs-property">onmessage</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
  <span class="hljs-comment">// ä»ä¸»çº¿ç¨‹æ¥æ”¶åˆ†ç‰‡æ•°æ®</span>
  <span class="hljs-keyword">const</span> { chunks } = e.<span class="hljs-property">data</span>;
  <span class="hljs-comment">// åˆ›å»º SparkMD5 å®ä¾‹</span>
  <span class="hljs-keyword">const</span> spark = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SparkMD5</span>.<span class="hljs-title class_">ArrayBuffer</span>();

  <span class="hljs-comment">// è¯»å–åˆ‡ç‰‡</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">readChunk</span>(<span class="hljs-params">index</span>) {
    <span class="hljs-keyword">if</span> (index &gt;= chunks.<span class="hljs-property">length</span>) {
      <span class="hljs-comment">// æ‰€æœ‰åˆ†ç‰‡å¤„ç†å®Œæ¯•ï¼Œè®¡ç®—æœ€ç»ˆå“ˆå¸Œ</span>
      <span class="hljs-keyword">const</span> hash = spark.<span class="hljs-title function_">end</span>();
      <span class="hljs-comment">// å‘ä¸»çº¿ç¨‹å‘é€æœ€ç»ˆè®¡ç®—çš„å“ˆå¸Œå€¼</span>
      self.<span class="hljs-title function_">postMessage</span>({ index, hash });
      <span class="hljs-comment">// æ‰€æœ‰åˆ†ç‰‡å¤„ç†å®Œæ¯•ï¼Œå…³é—­worker</span>
      self.<span class="hljs-title function_">close</span>();
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// åˆ›å»º FileReader å®ä¾‹, ç”¨äºè¯»å–åˆ†ç‰‡æ•°æ®</span>
    <span class="hljs-keyword">const</span> fileReader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>();
    <span class="hljs-comment">// è¯»å–åˆ†ç‰‡æ•°æ®</span>
    fileReader.<span class="hljs-title function_">readAsArrayBuffer</span>(chunks[index]);
    <span class="hljs-comment">// åˆ†ç‰‡æ•°æ®åŠ è½½å®Œæˆäº‹ä»¶ç›‘å¬</span>
    fileReader.<span class="hljs-property">onload</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-comment">// è¿½åŠ åˆ° SparkMD5 å®ä¾‹</span>
      spark.<span class="hljs-title function_">append</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>);
      <span class="hljs-comment">// å‘ä¸»çº¿ç¨‹å‘é€è®¡ç®—è¿›åº¦ç´¢å¼•</span>
      self.<span class="hljs-title function_">postMessage</span>({ index });
      <span class="hljs-comment">// è¯»å–ä¸‹ä¸€ä¸ªåˆ†ç‰‡</span>
      <span class="hljs-title function_">readChunk</span>(index + <span class="hljs-number">1</span>);
    };
  }
  <span class="hljs-comment">// ä»ç´¢å¼•0å¼€å§‹è¯»å–åˆ†ç‰‡</span>
  <span class="hljs-title function_">readChunk</span>(<span class="hljs-number">0</span>);
};
</code></pre>
<p>åœ¨<code>utils</code>æ–‡ä»¶å¤¹ä¸‹å†™å¥½<code>worker</code>å·¥å…·å‡½æ•°åï¼Œç»§ç»­åœ¨<code>useBigFileUpload</code>å‡½æ•°å½“ä¸­æ·»åŠ <code>getHashWorker</code>æ–¹æ³•å¼‚æ­¥è·å–æ–‡ä»¶<code>hash</code>å€¼ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * è®¡ç®—æ–‡ä»¶å“ˆå¸Œå€¼
 * <span class="hljs-doctag">@param</span> tempChunks åˆ‡ç‰‡æ•°ç»„
 * <span class="hljs-doctag">@returns</span> æ–‡ä»¶å“ˆå¸Œå€¼
 */</span>
<span class="hljs-keyword">const</span> getHashWorker = <span class="hljs-keyword">async</span> (<span class="hljs-attr">tempChunks</span>: <span class="hljs-title class_">Blob</span>[]): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; =&gt; {
  hashProgress.<span class="hljs-property">value</span> = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-comment">// å¯¼å…¥workerçº¿ç¨‹ï¼Œè®¡ç®—æ–‡ä»¶å“ˆå¸Œå€¼</span>
    <span class="hljs-keyword">const</span> worker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(
      <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">"../utils/workers/file-hash.work.js"</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>)
    );
    <span class="hljs-comment">// å‘workerçº¿ç¨‹å‘é€æ¶ˆæ¯ï¼Œè®¡ç®—æ–‡ä»¶å“ˆå¸Œå€¼</span>
    worker.<span class="hljs-title function_">postMessage</span>({
      <span class="hljs-attr">chunks</span>: tempChunks,
    });
    <span class="hljs-comment">// ç›‘å¬workerçº¿ç¨‹æ¶ˆæ¯ï¼Œè·å–è®¡ç®—æ–‡ä»¶å“ˆå¸Œå€¼ç»“æœ</span>
    worker.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> { index, hash } = e.<span class="hljs-property">data</span>;
      <span class="hljs-comment">// è®¡ç®—å½“å‰è®¡ç®—hashè¿›åº¦</span>
      <span class="hljs-keyword">if</span> (tempChunks.<span class="hljs-property">length</span>) {
        hashProgress.<span class="hljs-property">value</span> = (index / tempChunks.<span class="hljs-property">length</span>) * <span class="hljs-number">100</span>;
      }
      <span class="hljs-keyword">if</span> (hash) {
        <span class="hljs-comment">// å®Œæˆè®¡ç®—å“ˆå¸Œå€¼</span>
        <span class="hljs-title function_">resolve</span>(hash);
      }
    };
  });
};
</code></pre>
<p>æ‹¿åˆ°hashå€¼åå°±å¯ä»¥é€šè¿‡è¯¥å€¼æŸ¥è¯¢æœåŠ¡å™¨æ˜¯å¦å­˜åœ¨è¯¥æ–‡ä»¶ï¼Œæ¥å®ç°å¤§æ–‡ä»¶ç§’ä¼ </p>
<h3 data-id="heading-7">æ–‡ä»¶ç§’ä¼ </h3>
<p>é€šè¿‡<code>hash</code>æŸ¥è¯¢æœåŠ¡å™¨æ˜¯å¦<strong>å­˜åœ¨è¯¥æ–‡ä»¶</strong>ï¼Œå‰ç«¯æ ¹æ®è¿”å›ç»“æœåˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œæ–‡ä»¶ä¸Šä¼ ï¼Œå·²å­˜åœ¨åˆ™ç›´æ¥æ˜¾ç¤ºä¸Šä¼ å®Œæˆï¼Œå¦åˆ™æ¥ç€ä¸‹é¢è¿›è¡Œåˆ†ç‰‡ä¸Šä¼ ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²ç»ä¸Šä¼ 
 * <span class="hljs-doctag">@param</span> fileHash æ–‡ä»¶å“ˆå¸Œå€¼
 * <span class="hljs-doctag">@returns</span> æ£€æŸ¥ç»“æœ
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">checkFileApi</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">fileHash: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-comment">// é€šè¿‡æ–‡ä»¶hashæ£€æŸ¥æ˜¯å¦å·²ç»ä¸Šä¼ äº†è¯¥æ–‡ä»¶</span>
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> http.<span class="hljs-title function_">get</span>(<span class="hljs-string">`<span class="hljs-subst">${baseUrl}</span>/check/file?fileHash=<span class="hljs-subst">${fileHash}</span>`</span>);
  <span class="hljs-comment">// è¿”å›æ£€æŸ¥ç»“æœ</span>
  <span class="hljs-keyword">return</span> res.<span class="hljs-property">data</span>.<span class="hljs-property">hasExist</span>
}
</code></pre>
<h3 data-id="heading-8">æ–‡ä»¶æ–­ç‚¹ç»­ä¼ </h3>
<p>ä¸»è¦æ˜¯é€šè¿‡æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å·²ç»<strong>å­˜åœ¨è¯¥åˆ†ç‰‡</strong>ï¼Œå¹¶è¿”å›æŸ¥è¯¢ç»“æœï¼Œå‰ç«¯æ ¹æ®æŸ¥è¯¢ç»“æœåˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒç”¨åˆ†ç‰‡ä¸Šä¼ è¯·æ±‚æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * æ£€æŸ¥åˆ‡ç‰‡æ˜¯å¦å·²ç»ä¸Šä¼ 
 * <span class="hljs-doctag">@param</span> chunkName åˆ‡ç‰‡å
 * <span class="hljs-doctag">@returns</span> æ£€æŸ¥ç»“æœ
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">checkChunkApi</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">chunkName: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-comment">// åˆ›å»ºä¸­æ–­è¯·æ±‚å™¨</span>
  <span class="hljs-keyword">const</span> abortController = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();

  <span class="hljs-comment">// å‘ç”Ÿè¯·æ±‚å‰å…ˆéªŒè¯åˆ‡ç‰‡æ˜¯å¦å·²ç»ä¸Šä¼ </span>
  <span class="hljs-keyword">const</span> <span class="hljs-attr">res</span>: <span class="hljs-title class_">AxiosResponse</span>&lt;{
    <span class="hljs-attr">code</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">hasExist</span>: <span class="hljs-built_in">boolean</span>;
  }&gt; = <span class="hljs-keyword">await</span> http.<span class="hljs-title function_">get</span>(<span class="hljs-string">`<span class="hljs-subst">${baseUrl}</span>/chunk/check?chunkName=<span class="hljs-subst">${chunkName}</span>`</span>, {
    <span class="hljs-attr">signal</span>: abortController.<span class="hljs-property">signal</span>,
  });

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">res</span>: res,
    abortController,
  }
};
</code></pre>
<h3 data-id="heading-9">åˆ†ç‰‡ä¸Šä¼ è¯·æ±‚</h3>
<p>åˆ›å»ºå¼€å§‹åˆ†ç‰‡ä¸Šä¼ è¯·æ±‚æ–¹æ³•<code>uploadChunkApi</code></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * ä¸Šä¼ åˆ‡ç‰‡
 * <span class="hljs-doctag">@param</span> data åˆ‡ç‰‡æ•°æ®
 * <span class="hljs-doctag">@returns</span> ChunkRequestQueue ä¸Šä¼ è¯·æ±‚å¯¹è±¡
 */</span>
<span class="hljs-keyword">const</span> uploadChunkApi = (<span class="hljs-attr">data</span>: <span class="hljs-title class_">Chunk</span>): <span class="hljs-function"><span class="hljs-params">ChunkRequestQueue</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> { name, index, chunk } = data;
  <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();
  formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">"chunk"</span>, chunk);

  <span class="hljs-comment">// åˆ›å»ºä¸­æ–­è¯·æ±‚å™¨</span>
  <span class="hljs-keyword">const</span> abortController = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();

  <span class="hljs-keyword">const</span> promise = http.<span class="hljs-title function_">post</span>(<span class="hljs-string">`<span class="hljs-subst">${baseUrl}</span>/chunk?chunkName=<span class="hljs-subst">${name}</span>`</span>, formData, {
    <span class="hljs-attr">signal</span>: abortController.<span class="hljs-property">signal</span>,
    <span class="hljs-attr">onUploadProgress</span>: <span class="hljs-function">(<span class="hljs-params">progressEvent: AxiosProgressEvent</span>) =&gt;</span> {
      <span class="hljs-comment">// è®¡ç®—ä¸Šä¼ è¿›åº¦</span>
      <span class="hljs-keyword">if</span> (
        chunks.<span class="hljs-property">value</span>[index] &amp;&amp;
        progressEvent.<span class="hljs-property">total</span> &amp;&amp;
        progressEvent.<span class="hljs-property">progress</span>
      ) {
        <span class="hljs-comment">// è®°å½•å½“å‰ä¸Šä¼ åˆ‡ç‰‡è¯·æ±‚è¿›åº¦ã€‚</span>
        <span class="hljs-comment">// æ³¨æ„ï¼Œç”±äºç½‘ç»œè¯·æ±‚å…·æœ‰é¢å¤–å¼€é”€ï¼Œä¸Šä¼ è¿›åº¦å¯èƒ½ä¼šå’Œåˆ‡ç‰‡å¤§å°ä¸ä¸€æ ·</span>
        chunks.<span class="hljs-property">value</span>[index].<span class="hljs-property">uploaded</span> = progressEvent.<span class="hljs-property">loaded</span>;
        <span class="hljs-comment">// è®°å½•å½“å‰ä¸Šä¼ åˆ‡ç‰‡è¯·æ±‚æ€»å¤§å°</span>
        <span class="hljs-comment">// æ³¨æ„ï¼Œç”±äºç½‘ç»œè¯·æ±‚å…·æœ‰é¢å¤–å¼€é”€ï¼Œä¸Šä¼ è¿›åº¦å¯èƒ½ä¼šå’Œåˆ‡ç‰‡å¤§å°ä¸ä¸€æ ·</span>
        chunks.<span class="hljs-property">value</span>[index].<span class="hljs-property">requestSize</span> = progressEvent.<span class="hljs-property">total</span>;
        <span class="hljs-comment">// è®¡ç®—ä¸Šä¼ è¿›åº¦</span>
        chunks.<span class="hljs-property">value</span>[index].<span class="hljs-property">progress</span> = progressEvent.<span class="hljs-property">progress</span>;
      }
    },
  });

  <span class="hljs-keyword">return</span> {
    promise,
    abortController,
  };
};
</code></pre>
<p>åœ¨å‘é€åˆ†ç‰‡ä¸Šä¼ <code>http</code>è¯·æ±‚çš„æ–¹æ³•ä¸­ï¼Œç›‘å¬äº†<code>axios</code>çš„<code>onUploadProgress</code>å›è°ƒæ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•é‡Œé¢å¯ä»¥æ‹¿åˆ°è¯·æ±‚çš„å®Œæˆè¿›åº¦ï¼Œå…¶ä¸­è®°å½•äº†<code>AxiosProgressEvent</code>çš„3ä¸ªå±æ€§ï¼š<code>uploaded</code>ã€<code>total</code>ã€<code>progress</code>ã€‚ä¸»è¦æ˜¯<code>progress</code>é¡µé¢æ˜¾ç¤ºä¸Šä¼ è¿›åº¦éœ€è¦ï¼Œå…¶ä»–å¦‚æœé¡µé¢ä¸éœ€è¦æ˜¾ç¤ºï¼Œå¯æœ‰å¯æ— å§ã€‚</p>
<p>æœ€åæŠŠå½“å‰è¯·æ±‚çš„<code>promise</code>å¯¹è±¡å’Œä¸­æ–­è¯·æ±‚çš„<code>abortController</code>å¯¹è±¡è¿”å›ï¼Œæ”¾å…¥è¯·æ±‚é˜Ÿåˆ—å½“ä¸­ã€‚</p>
<p>å½“éœ€è¦æš‚åœä¸Šä¼ æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>abortController</code>è¿›è¡Œä¸­æ–­è¯·æ±‚ã€‚</p>
<h3 data-id="heading-10">åˆ†ç‰‡åˆå¹¶è¯·æ±‚</h3>
<p>åˆ›å»ºåˆå¹¶åˆ‡ç‰‡è¯·æ±‚æ–¹æ³•<code>mergeChunksApi</code>ï¼Œå½“è¯·æ±‚é˜Ÿåˆ—ä¸­çš„åˆ†ç‰‡éƒ½æˆåŠŸä¸Šä¼ åï¼Œè°ƒç”¨è¯¥æ–¹æ³•å¹¶æºå¸¦<code>fileHash</code>æ–‡ä»¶æ ‡è¯†ï¼Œç”¨äºæœåŠ¡å™¨æ‰¾åˆ°è¯¥æ–‡ä»¶åˆ†ç‰‡æ‰€åœ¨ä½ç½®ï¼Œåˆå¹¶æˆåŠŸåï¼Œæ–‡ä»¶å³ä¸Šä¼ å®Œæˆã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * åˆå¹¶åˆ‡ç‰‡
 * <span class="hljs-doctag">@param</span> fileHash æ–‡ä»¶å“ˆå¸Œå€¼
 * <span class="hljs-doctag">@returns</span> åˆå¹¶ç»“æœ
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">mergeChunksApi</span> = (<span class="hljs-params">fileHash: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-keyword">return</span> http.<span class="hljs-title function_">post</span>(<span class="hljs-string">`/merge-chunk`</span>, {
    fileHash,
  });
};
</code></pre>
<h3 data-id="heading-11">å¼€å§‹ä¸Šä¼ æ–‡ä»¶</h3>
<p>ä¸Šé¢çš„å‡†å¤‡å·¥ä½œå°±ç»ªåï¼Œå°±å¯ä»¥åˆ›å»ºä¸Šä¼ æ–‡ä»¶æ–¹æ³•äº†ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * å¼€å§‹ä¸Šä¼ 
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">file</span>
 * <span class="hljs-doctag">@param</span> resume æ˜¯å¦æ¢å¤ä¸Šä¼ 
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">startUpload</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">file: File, resume: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span></span>) =&gt; {
  <span class="hljs-keyword">if</span> (!file) {
    message.<span class="hljs-title function_">error</span>(<span class="hljs-string">"è¯·å…ˆé€‰æ‹©æ–‡ä»¶!"</span>);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// æ¢å¤ä¸Šä¼ ä¸ç”¨é‡æ–°åˆ›å»ºåˆ‡ç‰‡ï¼Œå»¶ç»­ä¹‹å‰çš„åˆ‡ç‰‡è¿›åº¦</span>
  <span class="hljs-keyword">if</span> (!resume) {
    <span class="hljs-comment">// ä¿å­˜æ–‡ä»¶ï¼Œç”¨äºåç»­æ¢å¤ä¸Šä¼ </span>
    fileTarget = file;
    <span class="hljs-comment">// é‡ç½®æš‚åœçŠ¶æ€ï¼Œé¿å…é‡å¤ä¸Šä¼ æ—¶æš‚åœçŠ¶æ€ä¸ºtrueå¯¼è‡´é—®é¢˜</span>
    isPuase.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-comment">// åˆ›å»ºåˆ‡ç‰‡</span>
    <span class="hljs-keyword">const</span> tempChunks = <span class="hljs-title function_">createChunks</span>(file);
    <span class="hljs-comment">// è®¡ç®—æ–‡ä»¶å“ˆå¸Œå€¼ï¼Œå¹¶æ‹¼æ¥æ–‡ä»¶åç¼€å</span>
    fileHash =
      (<span class="hljs-keyword">await</span> <span class="hljs-title function_">getHashWorker</span>(tempChunks)) + <span class="hljs-string">"."</span> + file.<span class="hljs-property">name</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">"."</span>).<span class="hljs-title function_">pop</span>();
    <span class="hljs-comment">// æ„å»ºåˆ‡ç‰‡å¯¹è±¡æ•°ç»„</span>
    chunks.<span class="hljs-property">value</span> = tempChunks.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">chunk, i</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">name</span>: <span class="hljs-title function_">buildChunkName</span>(fileHash, i),
        <span class="hljs-attr">chunk</span>: <span class="hljs-title function_">markRaw</span>(chunk),
        <span class="hljs-attr">index</span>: i,
        <span class="hljs-attr">size</span>: props.<span class="hljs-property">chunkSize</span>,
        <span class="hljs-attr">uploaded</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">requestSize</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">progress</span>: <span class="hljs-number">0</span>,
        <span class="hljs-keyword">get</span> <span class="hljs-title function_">completed</span>() {
          <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">progress</span> === <span class="hljs-number">1</span>;
        },
      };
    });
  }

  <span class="hljs-comment">// é€šè¿‡æ–‡ä»¶hashæ£€æŸ¥æ˜¯å¦å·²ç»ä¸Šä¼ äº†è¯¥æ–‡ä»¶</span>
  <span class="hljs-keyword">const</span> hasExist = <span class="hljs-keyword">await</span> <span class="hljs-title function_">checkFileApi</span>(fileHash);
  <span class="hljs-keyword">if</span> (hasExist) {
    message.<span class="hljs-title function_">warning</span>(<span class="hljs-string">"æ–‡ä»¶å·²å­˜åœ¨ï¼Œæ— éœ€é‡å¤ä¸Šä¼ "</span>);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// å¦‚æœæ˜¯æš‚åœåæ¢å¤ä¸Šä¼ æ—¶ï¼Œè¿‡æ»¤å‡ºæœªä¸Šä¼ å®Œæˆçš„åˆ‡ç‰‡</span>
  <span class="hljs-keyword">const</span> waitUploadChunks = chunks.<span class="hljs-property">value</span>
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">chunk</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> !chunk.<span class="hljs-property">completed</span>;
    });

  <span class="hljs-comment">// éå†æœªå®Œæˆä¸Šä¼ çš„åˆ‡ç‰‡</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; waitUploadChunks.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> chunk = waitUploadChunks[i] <span class="hljs-keyword">as</span> <span class="hljs-title class_">Chunk</span>;
    <span class="hljs-keyword">const</span> name = chunk.<span class="hljs-property">name</span>;

    <span class="hljs-comment">// åˆ›å»ºä¸­æ–­è¯·æ±‚å™¨</span>
    <span class="hljs-keyword">const</span> abortController = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();

    <span class="hljs-comment">// å‘ç”Ÿè¯·æ±‚å‰å…ˆéªŒè¯åˆ‡ç‰‡æ˜¯å¦å·²ç»ä¸Šä¼ </span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">res</span>: <span class="hljs-title class_">AxiosResponse</span>&lt;{
      <span class="hljs-attr">code</span>: <span class="hljs-built_in">number</span>;
      <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;
      <span class="hljs-attr">hasExist</span>: <span class="hljs-built_in">boolean</span>;
    }&gt; = <span class="hljs-keyword">await</span> http.<span class="hljs-title function_">get</span>(<span class="hljs-string">`<span class="hljs-subst">${baseUrl}</span>/chunk/check?chunkName=<span class="hljs-subst">${name}</span>`</span>, {
      <span class="hljs-attr">signal</span>: abortController.<span class="hljs-property">signal</span>,
    });

    <span class="hljs-comment">// æš‚åœäº†ç›´æ¥é€€å‡ºforå¾ªç¯ï¼Œä¸”ä¸å†æ‰§è¡Œforå¾ªç¯åé¢çš„ä»£ç </span>
    <span class="hljs-keyword">if</span> (isPuase.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">data</span>.<span class="hljs-property">hasExist</span>) {
      chunkReqQueueList[i] = {
        <span class="hljs-comment">// è¿”å›æ ¡éªŒç»“æœ</span>
        <span class="hljs-attr">promise</span>: <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(res),
        <span class="hljs-comment">// æ ¡éªŒåˆ‡ç‰‡æ˜¯å¦å­˜åœ¨ä¸­æ–­å™¨</span>
        abortController,
      };
      chunk.<span class="hljs-property">progress</span> = <span class="hljs-number">1</span>;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// åˆ‡ç‰‡ä¸å­˜åœ¨ï¼Œç»§ç»­ä¸Šä¼ </span>
      chunkReqQueueList[i] = <span class="hljs-title function_">uploadChunkApi</span>(chunk);
    }
  }

  <span class="hljs-keyword">if</span> (chunkReqQueueList.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(
      chunkReqQueueList.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">promise</span>)
    );

    <span class="hljs-comment">// åˆå¹¶åˆ‡ç‰‡</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">mergeChunksApi</span>(fileHash);
  }
};
</code></pre>
<p><strong>buildChunkNameæ–¹æ³•</strong></p>
<p>æ„å»ºå’ŒæœåŠ¡å™¨è¾¾æˆçº¦å®šçš„åˆ†ç‰‡åç§°ï¼ŒæœåŠ¡å™¨å¯é€šè¿‡<code>-</code>åˆ†å‰²è·å–åˆ†ç‰‡æ‰€å±æ–‡ä»¶ï¼›åœ¨åˆå¹¶åˆ†ç‰‡æ—¶å¯æ ¹æ®<code>index</code>ç´¢å¼•è¿›è¡Œæ’åºåˆå¹¶ï¼Œä¿è¯æ–‡ä»¶çš„å®Œæ•´æ€§ã€‚</p>
<pre><code class="hljs language-ts" lang="ts">  <span class="hljs-comment">/**
   * æ„å»ºåˆ‡ç‰‡å
   * <span class="hljs-doctag">@param</span> hash æ–‡ä»¶å“ˆå¸Œå€¼
   * <span class="hljs-doctag">@param</span> index åˆ‡ç‰‡ç´¢å¼•
   * <span class="hljs-doctag">@returns</span> åˆ‡ç‰‡å
   */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">buildChunkName</span> = (<span class="hljs-params">hash: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${hash}</span>-<span class="hljs-subst">${index}</span>`</span>;
  };
</code></pre>
<p>åœ¨å¼€å§‹ä¸Šä¼ çš„<code>startUpload</code>æ–¹æ³•ä¸­å…·æœ‰ä¸¤ç§æƒ…å†µï¼Œåˆ†åˆ«ä¸º<strong>å¼€å§‹ä¸Šä¼ </strong>å’Œ<strong>æ¢å¤ä¸Šä¼ </strong>ã€‚</p>
<p>å¼€å§‹ä¸Šä¼ æ—¶ï¼Œæ‰§è¡Œå®Œæ•´çš„æ­¥éª¤ï¼›åœ¨æ¢å¤ä¸Šä¼ æ—¶ï¼Œå¯æ ¹æ®å¼€å§‹ä¸Šä¼ æ—¶çš„çŠ¶æ€ï¼Œè¿‡æ»¤å‡ºæœªä¸Šä¼ çš„åˆ†ç‰‡<code>waitUploadChunks</code>æ•°ç»„ï¼Œå†å‘é€åˆ†ç‰‡ä¸Šä¼ è¯·æ±‚ï¼Œé¿å…ä¸å¿…è¦çš„æ€§èƒ½æŸè€—ã€‚</p>
<h3 data-id="heading-12">æš‚åœä¸Šä¼ æ–‡ä»¶</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// æš‚åœåˆ‡ç‰‡ä¸Šä¼ </span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">pauseUpload</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (!isPuase.<span class="hljs-property">value</span>) {
    isPuase.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
    chunkReqQueueList.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">req</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (req.<span class="hljs-property">abortController</span>) {
        req.<span class="hljs-property">abortController</span>.<span class="hljs-title function_">abort</span>(<span class="hljs-string">"ç”¨æˆ·å–æ¶ˆä¸Šä¼ !"</span>);
      }
    });
    <span class="hljs-comment">// æ¸…ç©ºä¸Šä¼ é˜Ÿåˆ—</span>
    chunkReqQueueList = [];
  } <span class="hljs-keyword">else</span> {
    message.<span class="hljs-title function_">warning</span>(<span class="hljs-string">"æ–‡ä»¶å·²æš‚åœä¸Šä¼ ï¼"</span>);
  }
};
</code></pre>
<h3 data-id="heading-13">æ¢å¤ä¸Šä¼ æ–‡ä»¶</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// æ¢å¤åˆ‡ç‰‡ä¸Šä¼ </span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">resumeUpload</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (fileTarget &amp;&amp; isPuase.<span class="hljs-property">value</span>) {
    isPuase.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-title function_">startUpload</span>(fileTarget, <span class="hljs-literal">true</span>);
  } <span class="hljs-keyword">else</span> {
    message.<span class="hljs-title function_">warning</span>(<span class="hljs-string">"æ–‡ä»¶æ­£åœ¨ä¸Šä¼ ä¸­ï¼"</span>);
  }
};
</code></pre>
<h3 data-id="heading-14">uié¡µé¢æ„å»º(ç”¨æ³•)</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bafc8e9c01864aed9f677bd5f85b4cdd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdmlsYW5f5b6u5r6c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763339326&amp;x-signature=%2FIezwXzIXT5L9OINZIurqLU5sJI%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-15">BigFileUpload.vue</h4>
<pre><code class="hljs language-ts" lang="ts">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"upload-file"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">n-upload</span> @<span class="hljs-attr">before-upload</span>=<span class="hljs-string">"onUpload"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">n-button</span>&gt;</span>ä¸Šä¼ æ–‡ä»¶<span class="hljs-tag">&lt;/<span class="hljs-name">n-button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">n-upload</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"section"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>æ–‡ä»¶å†…å®¹hashè®¡ç®—è¿›åº¦ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">n-progress</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"line"</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"green"</span> <span class="hljs-attr">:percentage</span>=<span class="hljs-string">"hashProgress"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"percentage section"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>ä¸Šä¼ è¿›åº¦ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">n-progress</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"line"</span> <span class="hljs-attr">:percentage</span>=<span class="hljs-string">"progress"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"actions section"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>æ“ä½œï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">n-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"default"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"onPause"</span>&gt;</span>æš‚åœ<span class="hljs-tag">&lt;/<span class="hljs-name">n-button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">n-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"onResume"</span>&gt;</span>ç»§ç»­<span class="hljs-tag">&lt;/<span class="hljs-name">n-button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">n-tag</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"error"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"isPuase"</span>&gt;</span>å·²æš‚åœ<span class="hljs-tag">&lt;/<span class="hljs-name">n-tag</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chunk-list"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>åˆ†ç‰‡ä¸Šä¼ åˆ—è¡¨<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ChunkDetail</span>
        <span class="hljs-attr">:list</span>=<span class="hljs-string">"chunks"</span>
      &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ChunkDetail</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">NUpload</span>, <span class="hljs-title class_">NButton</span>, useMessage, <span class="hljs-title class_">NProgress</span>, <span class="hljs-title class_">NTag</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"naive-ui"</span>;
<span class="hljs-keyword">import</span> type { <span class="hljs-title class_">UploadFileInfo</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"naive-ui"</span>;
<span class="hljs-keyword">import</span> { useBigFileUpload } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/hooks/useBigFileUpload"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChunkDetail</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./ChunkDetail.vue"</span>;
<span class="hljs-keyword">import</span> { computed } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;

<span class="hljs-keyword">const</span> {
  percentage,
  startUpload,
  pauseUpload,
  resumeUpload,
  chunks,
  isPuase,
  hashProgress
} = <span class="hljs-title function_">useBigFileUpload</span>();
<span class="hljs-keyword">const</span> message = <span class="hljs-title function_">useMessage</span>();

<span class="hljs-keyword">const</span> progress = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>(percentage.<span class="hljs-property">value</span>.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>))
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">onUpload</span> = (<span class="hljs-params">data: {
  file: UploadFileInfo;
  fileList: <span class="hljs-built_in">Array</span>&lt;UploadFileInfo&gt;;
  event?: Event;
}</span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
  <span class="hljs-keyword">const</span> file = data.<span class="hljs-property">file</span>.<span class="hljs-property">file</span>;
  <span class="hljs-keyword">if</span> (!file) {
    message.<span class="hljs-title function_">error</span>(<span class="hljs-string">"è¯·é€‰æ‹©æ–‡ä»¶!"</span>);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-title function_">startUpload</span>(file);
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">onPause</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">pauseUpload</span>();
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">onResume</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">resumeUpload</span>();
};

</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.upload-file</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">1000px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}
<span class="hljs-selector-class">.actions</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
}

<span class="hljs-selector-class">.chunk-list</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">600px</span>;
  <span class="hljs-attribute">overflow-y</span>: auto;
}
<span class="hljs-selector-class">.section</span> {
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">20px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

</span></code></pre>
<h4 data-id="heading-16">ChunkDetail.vue</h4>
<pre><code class="hljs language-ts" lang="ts">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chunk"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">n-table</span> <span class="hljs-attr">:bordered</span>=<span class="hljs-string">"false"</span> <span class="hljs-attr">:single-line</span>=<span class="hljs-string">"false"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">align</span>=<span class="hljs-string">"center"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>ç´¢å¼•<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>åç§°<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>åˆ†ç‰‡å¤§å°(byte)<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>è¯·æ±‚æ€»å¤§å°(byte)<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>å·²ä¸Šä¼ (byte)<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>ä¸Šä¼ è¿›åº¦<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>æ˜¯å¦å®Œæˆ<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"data in list"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"data.index"</span> <span class="hljs-attr">align</span>=<span class="hljs-string">"center"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{ data.index }}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{ data.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{ data.size}}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{ data.requestSize }}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{ data.uploaded }}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{ (data.progress * 100).toFixed(2) }}%<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">n-tag</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"data.completed"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"success"</span>&gt;</span>æ˜¯<span class="hljs-tag">&lt;/<span class="hljs-name">n-tag</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">n-tag</span> <span class="hljs-attr">v-else</span>&gt;</span>å¦<span class="hljs-tag">&lt;/<span class="hljs-name">n-tag</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">n-table</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">NTable</span>, <span class="hljs-title class_">NTag</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"naive-ui"</span>;
<span class="hljs-keyword">import</span> type { <span class="hljs-title class_">Chunk</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/hooks/useBigFileUpload"</span>;

defineProps&lt;{
  <span class="hljs-attr">list</span>: <span class="hljs-title class_">Chunk</span>[];
}&gt;();

</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-17">åç«¯å®ç°ä»£ç </h2>
<h3 data-id="heading-18">æ–‡ä»¶ä¸Šä¼ ç›®å½•ç¤ºä¾‹</h3>
<blockquote>
<p>temp: è§£æåˆ†ç‰‡æ•°æ®å†™å…¥çš„ä¸´æ—¶ç›®å½•ï¼Œå†™å…¥çš„åˆ†ç‰‡å¯èƒ½ä¸å®Œæ•´ï¼›</p>
<p>chunks: å†™å…¥å®Œæˆçš„åˆ†ç‰‡æ–‡ä»¶ç›®å½•ï¼›</p>
<p>upload: åˆ†ç‰‡åˆå¹¶å®Œæˆçš„æ–‡ä»¶ç›®å½•ï¼›</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2bff382a156b4def836c9f59007ecd54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdmlsYW5f5b6u5r6c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763339326&amp;x-signature=bRQZhw%2FiWUccJixQ0cCTJNKHhoE%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-19">æŸ¥è¯¢æ–‡ä»¶æ˜¯å¦å­˜åœ¨æ¥å£</h3>
<p>åœ¨<code>upload</code>æ–‡ä»¶å¤¹ä¸‹ï¼Œé€šè¿‡æ–‡ä»¶hashæŸ¥è¯¢ï¼Œæ˜¯å¦å­˜åœ¨è¯¥hashæ–‡ä»¶åçš„æ–‡ä»¶</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af95c2a86d204461abc4fbb9ff1c3d42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdmlsYW5f5b6u5r6c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763339326&amp;x-signature=p2AfhHDQf%2BRl%2FgegGhMf1UceJCA%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// æŸ¥è¯¢mergeDirç›®å½•ä¸‹æ˜¯å¦å­˜åœ¨ä¸Šä¼ çš„æ–‡ä»¶</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/check/file'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> fileHash = req.<span class="hljs-property">query</span>.<span class="hljs-property">fileHash</span>;
  <span class="hljs-keyword">const</span> filePath = path.<span class="hljs-title function_">join</span>(mergeDir, fileHash);
  <span class="hljs-keyword">const</span> hasExistFile = fs.<span class="hljs-title function_">existsSync</span>(filePath);
  <span class="hljs-keyword">if</span> (hasExistFile) {
    res.<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
      <span class="hljs-attr">message</span>: <span class="hljs-string">'æ–‡ä»¶å·²å­˜åœ¨'</span>,
      <span class="hljs-attr">hasExist</span>: <span class="hljs-literal">true</span>
    })
  } <span class="hljs-keyword">else</span> {
    res.<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
      <span class="hljs-attr">message</span>: <span class="hljs-string">'æ–‡ä»¶ä¸å­˜åœ¨'</span>,
      <span class="hljs-attr">hasExist</span>: <span class="hljs-literal">false</span>
    })
  }
})
</code></pre>
<h3 data-id="heading-20">æŸ¥è¯¢åˆ†ç‰‡æ˜¯å¦å­˜åœ¨æ¥å£</h3>
<p>åœ¨<code>chunks</code>ç›®å½•ä¸‹çš„æ–‡ä»¶<code>hash</code>æ‰€å±ç›®å½•ä¸‹ï¼ŒæŸ¥è¯¢æ˜¯å¦å­˜åœ¨è¯¥<strong>hashç´¢å¼•</strong>çš„åˆ†ç‰‡ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd26b4674cb8455bb4f8e4dfe6d86ea7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdmlsYW5f5b6u5r6c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763339326&amp;x-signature=9Vj4putG4L1LkBx9rW%2BnRzh1jss%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// éªŒè¯åˆ‡ç‰‡æ˜¯å¦å·²å­˜åœ¨æ¥å£</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/chunk/check'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {

  <span class="hljs-comment">// åˆ‡ç‰‡æ–‡ä»¶åç§°</span>
  <span class="hljs-keyword">const</span> chunkName = req.<span class="hljs-property">query</span>.<span class="hljs-property">chunkName</span>

  <span class="hljs-comment">// ä»åˆ‡ç‰‡æ–‡ä»¶åç§°ä¸­æå–æ–‡ä»¶hash</span>
  <span class="hljs-keyword">const</span> fileHash = <span class="hljs-title function_">extractFileHash</span>(chunkName);

  <span class="hljs-comment">// å¾…åˆå¹¶çš„åˆ†ç‰‡ç›®å½•è·¯å¾„</span>
  <span class="hljs-keyword">const</span> chunkPath = path.<span class="hljs-title function_">join</span>(chunkDir, fileHash, chunkName);

  <span class="hljs-comment">// æ£€æŸ¥å½“å‰åˆ‡ç‰‡æ–‡ä»¶æ˜¯å¦å·²ç»å­˜åœ¨</span>
  <span class="hljs-keyword">const</span> hasExistFile = fs.<span class="hljs-title function_">existsSync</span>(chunkPath);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'hasExistFile'</span>, hasExistFile, chunkPath);
  <span class="hljs-keyword">if</span> (hasExistFile) {
    <span class="hljs-comment">// ç›´æ¥å“åº”ã€‚ä¸å†æ‰§è¡Œåç»­ä¸­é—´ä»¶ï¼Œå¦‚åé¢çš„å›è°ƒupload.single('chunk')ã€åˆ‡ç‰‡ä¸Šä¼ æˆåŠŸå›è°ƒ</span>
    res.<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
      <span class="hljs-attr">message</span>: <span class="hljs-string">'åˆ‡ç‰‡å·²å­˜åœ¨ï¼Œè·³è¿‡è¯¥åˆ‡ç‰‡ä¸Šä¼ '</span>,
      <span class="hljs-attr">hasExist</span>: <span class="hljs-literal">true</span>
    })
    <span class="hljs-keyword">return</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// åˆ‡ç‰‡ä¸å­˜åœ¨</span>
    res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'åˆ‡ç‰‡ä¸å­˜åœ¨ï¼Œç»§ç»­ä¸Šä¼ '</span>, <span class="hljs-attr">hasExist</span>: <span class="hljs-literal">false</span> })
  }
  <span class="hljs-keyword">return</span> hasExistFile
})
</code></pre>
<h3 data-id="heading-21">åˆ†ç‰‡ä¸Šä¼ æ¥å£</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ä»åˆ†ç‰‡åç§°æå–æ–‡ä»¶hash</span>
<span class="hljs-comment">// å¦‚ï¼šchunkName: 91a509c780df16d509e69d604292e870.mp4-0</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">extractFileHash</span>(<span class="hljs-params">chunkName</span>) {
  <span class="hljs-keyword">return</span> chunkName.<span class="hljs-title function_">split</span>(<span class="hljs-string">'-'</span>)[<span class="hljs-number">0</span>];
}

<span class="hljs-comment">// åˆ†ç‰‡å­˜æ”¾è·¯å¾„</span>
<span class="hljs-keyword">const</span> chunkDir = path.<span class="hljs-title function_">join</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'chunks'</span>);

<span class="hljs-comment">// å¤„ç†åˆ†ç‰‡æ–‡ä»¶ä¸Šä¼ ã€‚</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/chunk'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {

  <span class="hljs-keyword">const</span> chunkName = req.<span class="hljs-property">query</span>.<span class="hljs-property">chunkName</span>;

  <span class="hljs-keyword">const</span> fileHash = <span class="hljs-title function_">extractFileHash</span>(chunkName);

  <span class="hljs-comment">// åˆ¤æ–­å½“å‰ç›®å½•æ²¡æœ‰tempæ–‡ä»¶å¤¹ï¼Œåˆ™åˆ›å»º</span>
  <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(<span class="hljs-string">'./temp'</span>)) {
    fs.<span class="hljs-title function_">mkdirSync</span>(<span class="hljs-string">'./temp'</span>, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> });
  }

  <span class="hljs-comment">// ä½¿ç”¨formidableè§£æè¡¨å•æ•°æ®</span>
  <span class="hljs-keyword">const</span> form = <span class="hljs-title function_">formidable</span>({
    <span class="hljs-attr">uploadDir</span>: <span class="hljs-string">'./temp'</span>, <span class="hljs-comment">// ä¸´æ—¶å­˜å‚¨è·¯å¾„</span>
    <span class="hljs-attr">keepExtensions</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">filename</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">return</span> chunkName
    }
  });

  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// è§£æè¡¨å•æ•°æ®ï¼Œå¹¶æŠŠåˆ†ç‰‡å†™å…¥ä¸´æ—¶ç›®å½•ä¸­</span>
    <span class="hljs-keyword">const</span> [fields, files] = <span class="hljs-keyword">await</span> form.<span class="hljs-title function_">parse</span>(req);
    <span class="hljs-keyword">const</span> chunkFile = files.<span class="hljs-property">chunk</span>[<span class="hljs-number">0</span>];

    <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(chunkDir)) {
      fs.<span class="hljs-title function_">mkdirSync</span>(chunkDir, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> });
    }
    <span class="hljs-comment">// å°†ä¸´æ—¶æ–‡ä»¶ç§»åŠ¨åˆ° chunkDir ç›®å½•</span>
    <span class="hljs-keyword">const</span> fileHashDir = path.<span class="hljs-title function_">join</span>(chunkDir, fileHash);
    <span class="hljs-keyword">const</span> targetPath = path.<span class="hljs-title function_">join</span>(fileHashDir, chunkName);
    <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(fileHashDir)) {
      fs.<span class="hljs-title function_">mkdirSync</span>(fileHashDir, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> });
    }
    fs.<span class="hljs-title function_">renameSync</span>(chunkFile.<span class="hljs-property">filepath</span>, targetPath)
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">msg</span>: <span class="hljs-string">'åˆ†ç‰‡ä¸Šä¼ å¤±è´¥'</span>, <span class="hljs-attr">error</span>: error });
  }

  res.<span class="hljs-title function_">send</span>({
    <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'åˆ†ç‰‡ä¸Šä¼ æˆåŠŸ'</span>,
    <span class="hljs-attr">file</span>: req.<span class="hljs-property">file</span>
  });
});
</code></pre>
<h3 data-id="heading-22">åˆå¹¶åˆ†ç‰‡æ¥å£</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// åˆå¹¶åˆ‡ç‰‡</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/merge-chunk'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { fileHash } = req.<span class="hljs-property">body</span>;
  <span class="hljs-keyword">if</span> (!fileHash) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'ç¼ºå°‘fileHashå‚æ•°'</span> });
  }
  <span class="hljs-comment">// åˆå¹¶åçš„æ–‡ä»¶è·¯å¾„ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºè¯¥ç›®å½•</span>
  <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(mergeDir)) {
    fs.<span class="hljs-title function_">mkdirSync</span>(mergeDir, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> });
  }
  <span class="hljs-keyword">const</span> mergeFilePath = path.<span class="hljs-title function_">join</span>(mergeDir, fileHash);
  <span class="hljs-keyword">const</span> chunkHashDir = path.<span class="hljs-title function_">join</span>(chunkDir, fileHash);

  <span class="hljs-comment">// è¯»å–ç›®å½•ä¸‹æ‰€æœ‰åˆ‡ç‰‡æ–‡ä»¶ï¼ŒæŒ‰ index æ’åº</span>
  <span class="hljs-keyword">const</span> chunkFilenames = fs.<span class="hljs-title function_">readdirSync</span>(chunkHashDir)
    <span class="hljs-comment">// æŒ‰ index æ’åº</span>
    .<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> indexA = <span class="hljs-built_in">parseInt</span>(a.<span class="hljs-title function_">split</span>(<span class="hljs-string">'-'</span>).<span class="hljs-title function_">pop</span>(), <span class="hljs-number">10</span>);
      <span class="hljs-keyword">const</span> indexB = <span class="hljs-built_in">parseInt</span>(b.<span class="hljs-title function_">split</span>(<span class="hljs-string">'-'</span>).<span class="hljs-title function_">pop</span>(), <span class="hljs-number">10</span>);
      <span class="hljs-keyword">return</span> indexA - indexB;
    });

  <span class="hljs-comment">// åˆ›å»ºå¯å†™æµï¼Œåˆå¹¶åˆ‡ç‰‡</span>
  <span class="hljs-keyword">const</span> writeStream = fs.<span class="hljs-title function_">createWriteStream</span>(mergeFilePath);
  <span class="hljs-keyword">let</span> mergedSize = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> chunkname <span class="hljs-keyword">of</span> chunkFilenames) {
      <span class="hljs-comment">// åˆ›å»ºå¯è¯»æµï¼Œè¯»å–åˆ‡ç‰‡</span>
      <span class="hljs-keyword">const</span> chunkPath = path.<span class="hljs-title function_">join</span>(chunkHashDir, chunkname);
      <span class="hljs-comment">// è¯»å–åˆ‡ç‰‡</span>
      <span class="hljs-keyword">const</span> data = fs.<span class="hljs-title function_">readFileSync</span>(chunkPath);
      <span class="hljs-comment">// å†™å…¥åˆå¹¶åçš„æ–‡ä»¶</span>
      writeStream.<span class="hljs-title function_">write</span>(data);
      <span class="hljs-comment">// ç´¯åŠ åˆå¹¶åçš„æ–‡ä»¶å¤§å°</span>
      mergedSize += data.<span class="hljs-property">length</span>;
      <span class="hljs-comment">// åˆ é™¤å·²åˆå¹¶çš„åˆ‡ç‰‡</span>
      fs.<span class="hljs-title function_">unlinkSync</span>(chunkPath);
    }
    <span class="hljs-comment">// åˆ é™¤ç©ºç›®å½•</span>
    fs.<span class="hljs-title function_">rmdirSync</span>(chunkHashDir);
    <span class="hljs-comment">// åˆå¹¶å®Œæˆåå…³é—­æµ</span>
    writeStream.<span class="hljs-title function_">end</span>();
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'åˆå¹¶å¤±è´¥!'</span>, <span class="hljs-attr">error</span>: err.<span class="hljs-property">message</span> });
  }

  res.<span class="hljs-title function_">send</span>({
    <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'æ–‡ä»¶åˆå¹¶æˆåŠŸ'</span>,
    <span class="hljs-attr">file</span>: {
      fileHash,
      <span class="hljs-attr">size</span>: mergedSize,
      <span class="hljs-attr">path</span>: mergeFilePath,
      chunkFilenames
    }
  });
});
</code></pre>
<h2 data-id="heading-23">æ€»ç»“</h2>
<p>æœ¬æ–‡ä½¿ç”¨æ–‡ä»¶å¯¹è±¡çš„<code>slice</code>æ–¹æ³•å¯¹å¤§æ–‡ä»¶è¿›è¡Œåˆ†ç‰‡ï¼Œä½¿ç”¨<code>SparkMD5</code>å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œ<code>hash</code>è®¡ç®—ï¼Œå¹¶æŠŠè®¡ç®—è¿‡ç¨‹æ‰§è¡Œåœ¨<code>Web Worker</code>çº¿ç¨‹å½“ä¸­ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼›</p>
<p>å®ç°<strong>åˆ†ç‰‡ä¸Šä¼ </strong>çš„<strong>æ ¸å¿ƒ</strong>æ˜¯ä½¿ç”¨æ–‡ä»¶<code>hash</code>å’Œåˆ†ç‰‡<strong>ç´¢å¼•</strong>ï¼Œå¯¹åˆ†ç‰‡åç§°è¿›è¡Œ<strong>æ ‡è¯†</strong>å’Œ<strong>æ’åº</strong>ï¼Œæ–¹ä¾¿åç«¯æŸ¥æ‰¾å’Œæ’åºåˆ†ç‰‡ï¼Œæœ€ååˆå¹¶åˆ†ç‰‡ä¸ºä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶ã€‚</p>
<h2 data-id="heading-24">å‰åç«¯å®Œæ•´æºç </h2>
<p>githubåœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjava6688%2Fbig-file-upload" target="_blank" title="https://github.com/java6688/big-file-upload" ref="nofollow noopener noreferrer">å¤§æ–‡ä»¶ä¸Šä¼ ç¤ºä¾‹ä»£ç </a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¯¹æˆ‘æ¥è¯´ï¼Œé‚£ä¸ªæ¡†æ¶å°±æ˜¯ Flutterã€‚]]></title>    <link>https://juejin.cn/post/7570201730992472090</link>    <guid>https://juejin.cn/post/7570201730992472090</guid>    <pubDate>2025-11-10T01:26:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570201730992472090" data-draft-id="7566131671172890633" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¯¹æˆ‘æ¥è¯´ï¼Œé‚£ä¸ªæ¡†æ¶å°±æ˜¯ Flutterã€‚"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-10T01:26:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JarvanMo"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565845704"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¯¹æˆ‘æ¥è¯´ï¼Œé‚£ä¸ªæ¡†æ¶å°±æ˜¯ Flutterã€‚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565845704/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JarvanMo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T01:26:24.000Z" title="Mon Nov 10 2025 01:26:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    52
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>å“ªä¸ªç¨‹åºå‘˜æ²¡ç»å†è¿‡è¿™äº‹å„¿ï¼šè€æ˜¯å¿ƒç—’ç—’åœ°æƒ³å»è¯•è¯•ä¸‹ä¸€ä¸ªâ€œçˆ†æ¬¾â€æ–°æŠ€æœ¯ï¼Ÿ</strong> æ–°æ¡†æ¶ä¸€åœ¨ Twitterï¼ˆæˆ– Xï¼‰ä¸Šå†’å‡ºæ¥ï¼Œåšæ–‡å°±å¹å®ƒæ˜¯â€œé¢ è¦†è€…â€ï¼Œç„¶å YouTube æ•™ç¨‹ç«‹é©¬é“ºå¤©ç›–åœ°è€Œæ¥ã€‚</p>
<p>è¿™ç§æ„Ÿè§‰æˆ‘å¤ªæ‡‚äº†ã€‚é‚£å‡ å¹´ï¼Œæˆ‘å°±æ˜¯è¿™ä¹ˆä¸€ä¸ªæ¡†æ¶æ¢ä¸€ä¸ªæ¡†æ¶åœ°æŠ˜è…¾â€”â€”<a href="https://link.juejin.cn?target=https%3A%2F%2Freactnative.dev%2F" target="_blank" title="https://reactnative.dev/" ref="nofollow noopener noreferrer">React Native</a>ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fionicframework.com%2F" target="_blank" title="https://ionicframework.com/" ref="nofollow noopener noreferrer">Ionic</a>ï¼Œç”šè‡³è¿˜ç›´æ¥ç©å„¿è¿‡ <a href="https://link.juejin.cn?target=https%3A%2F%2Fkotlinlang.org%2F" target="_blank" title="https://kotlinlang.org/" ref="nofollow noopener noreferrer">Kotlin</a>ã€‚æ¯ä¸ªéƒ½è¯´è‡ªå·±æ€§èƒ½æ›´é¡ºç•…ã€å¼€å‘æ›´å¿«ï¼Œæˆ–è€…å‘å¸ƒåº”ç”¨æ›´å®¹æ˜“ã€‚å¯ç»“æœå‘¢ï¼Œæ¯æ¬¡è¯•å®Œä¸€åœˆï¼Œæˆ‘åˆå›åˆ°äº†åŸåœ°ï¼š<strong>äººç´¯äº†ï¼Œæ€è·¯ä¹Ÿä¹±äº†ï¼Œç¦»æˆ‘æƒ³åšçš„é¡¹ç›®è¿˜æ˜¯ä¸€ç‚¹æ²¡é è¿‘ã€‚</strong></p>
<hr/>
<h2 data-id="heading-0">ğŸš€ ä¸ºä»€ä¹ˆæˆ‘åœæ­¢è¿½é€â€œä¸‹ä¸€ä¸ªå¤§æ¡†æ¶â€</h2>
<p>åœ¨æˆ‘ä¸‹å®šå†³å¿ƒä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fflutter.dev%2F" target="_blank" title="https://flutter.dev/" ref="nofollow noopener noreferrer">Flutter</a> çš„æ—¶å€™ï¼Œé‚£ç§ä¸æ–­åˆ‡æ¢æ¡†æ¶çš„å¾ªç¯å°±ç»“æŸäº†ã€‚å¹¶ä¸æ˜¯è¯´ Flutter æœ‰å¤šå®Œç¾ï¼ˆå‰§é€ä¸€ä¸‹ï¼šå®ƒå¹¶ä¸å®Œç¾ï¼‰ï¼Œè€Œæ˜¯å› ä¸ºå®ƒæ•™ä¼šäº†æˆ‘ä¸€ä¸ªé‡è¦çš„é“ç†ï¼š<strong>è¿½é€æ¡†æ¶ç»™æˆ‘å¸¦æ¥çš„æ¶ˆè€—ï¼Œè¿œå¤§äºå®ƒå¸¦æ¥çš„å¥½å¤„ã€‚</strong></p>
<p>è®©æˆ‘æ¥å‘Šè¯‰ä½ ï¼Œæˆ‘ä¸ºä»€ä¹ˆä¸å†è·‘å»è¿½é€â€œä¸‹ä¸€ä¸ªå¤§æ¡†æ¶â€äº†â€”â€”ä»¥åŠä¸ºä»€ä¹ˆåšæŒä½¿ç”¨ Flutterï¼Œæˆäº†æˆ‘èŒä¸šç”Ÿæ¶¯ä¸­æœ€æœ‰ä»·å€¼çš„å†³å®šã€‚</p>
<hr/>
<h3 data-id="heading-1">æ¡†æ¶ FOMOï¼ˆé”™å¤±ææƒ§ç—‡ï¼‰çš„é™·é˜±</h3>
<p>å¼€å‘è€…ä»¬ç‰¹åˆ«å®¹æ˜“é™·å…¥ <strong>FOMOï¼ˆFear of Missing Outï¼Œé”™å¤±ææƒ§ç—‡ï¼‰</strong> çš„é™·é˜±ã€‚æŠ€æœ¯åœˆå­è·‘å¾—é£å¿«ï¼Œå½“ä½ çœ‹åˆ°â€œæŸå…¬å¸ç”¨ Y æ¡†æ¶é‡å†™äº†ä»–ä»¬çš„åº”ç”¨ï¼Œä¸šç»©å¤§æ¶¨â€è¿™ç±»æ ‡é¢˜æ—¶ï¼Œå¾ˆå®¹æ˜“è§‰å¾—è‡ªå·±è½ä¼äº†ã€‚</p>
<p>ä½†å…³é”®åœ¨äºï¼š<strong>æ¯ä¸ªæ¡†æ¶éƒ½æœ‰å®ƒçš„â€œèœœæœˆæœŸâ€</strong> ã€‚æ—©æœŸä½¿ç”¨è€…æŠŠå®ƒå¹ä¸Šå¤©ï¼Œç¤¾åŒºçƒ­æƒ…é«˜æ¶¨ï¼Œå„ç§æ•™ç¨‹è®©ä¸€åˆ‡çœ‹èµ·æ¥æ¯«ä¸è´¹åŠ›ã€‚ç„¶è€Œï¼Œä¸€æ—¦ä½ æ·±å…¥æ¥è§¦ï¼Œä½ ä¼šå‘ç°è¿˜æ˜¯è€é—®é¢˜ï¼šå·¥å…·é“¾çš„å„ç§æ€ªç™–ã€æ–‡æ¡£ä¸Šçš„ç©ºç™½ï¼Œä»¥åŠé‚£äº›å¯èƒ½è€—è´¹ä½ æ•°å°æ—¶çš„éšæœº Bugã€‚</p>
<p>ä¸æ–­åˆ‡æ¢æ¡†æ¶è®©æˆ‘æœ‰äº†<strong>å¹¿åº¦ï¼Œä½†æ²¡æœ‰æ·±åº¦</strong>ã€‚æˆ‘æˆäº†ä¸€ä¸ªâ€œæ¡†æ¶ä¸‡äº‹é€šï¼Œä¸“ä¸šæ²¡ä¸€ä¸ªâ€ã€‚è€Œä¸”æˆ‘æ¢å¾—è¶Šå¤šï¼Œå®é™…çš„ç”Ÿäº§æ•ˆç‡å°±è¶Šä½ã€‚</p>
<hr/>
<h3 data-id="heading-2">ä¸ºä»€ä¹ˆ Flutter è„±é¢–è€Œå‡º</h3>
<p>é‚£ä¸ºä»€ä¹ˆæ˜¯ Flutter å‘¢ï¼Ÿè¯´å®è¯ï¼Œæˆ‘ä¸æ˜¯å¯¹å®ƒä¸€è§é’Ÿæƒ…ã€‚ä¸€å¼€å§‹æˆ‘å¾ˆæ€€ç–‘â€”â€”â€œåˆä¸€ä¸ªè·¨å¹³å°æ¡†æ¶ï¼Ÿâ€ ä½†éšç€æˆ‘ç”¨å®ƒæ¥åšä¸œè¥¿ï¼Œæœ‰ä¸‰ç‚¹è®©æˆ‘ç•™äº†ä¸‹æ¥ï¼š</p>
<ul>
<li><strong>è·¨å¹³å°çš„ä¸€è‡´æ€§ï¼š</strong> Flutter ä¸åªæ˜¯ç»™åŸç”Ÿç»„ä»¶åŒ…ä¸€å±‚å£³ã€‚å®ƒçš„æ¸²æŸ“å¼•æ“è®©æˆ‘å¯ä»¥å®ç°<strong>åƒç´ çº§çš„å®Œç¾æ§åˆ¶</strong>ï¼Œæ— è®ºæ˜¯åœ¨ iOSã€Androidï¼Œç”šè‡³ Web è¿˜æ˜¯æ¡Œé¢ç«¯ã€‚å†ä¹Ÿä¸ä¼šå‡ºç°é‚£ç§åœ¨ Android ä¸Šçœ‹ç€æ²¡äº‹ï¼Œä½†åœ¨ iOS ä¸Šå°±é”™ä½çš„å¥‡æ€ªæ ·å¼é—®é¢˜äº†ã€‚</li>
<li><strong>å¼€å‘è€…ä½“éªŒï¼š</strong> <strong>çƒ­é‡è½½ï¼ˆHot Reloadï¼‰</strong> å½»åº•æ”¹å˜äº†æˆ‘çš„ç¼–ç æ–¹å¼ã€‚å¿«é€Ÿè¿­ä»£ã€å³æ—¶çœ‹åˆ° UI å˜åŒ–ã€ä¸ç”¨é‡å¯åº”ç”¨å°±èƒ½æµ‹è¯•æ–°æƒ³æ³•â€”â€”è¿™æ„Ÿè§‰å°±åƒæ˜¯æ¡†æ¶åœ¨<strong>é…åˆæˆ‘</strong>å·¥ä½œï¼Œè€Œä¸æ˜¯å¤„å¤„è·Ÿæˆ‘ä½œå¯¹ã€‚</li>
<li><strong>ç¤¾åŒºå’Œç”Ÿæ€ï¼š</strong> Flutter çš„ç¤¾åŒºå¾ˆæœ‰çƒ­æƒ…ï¼Œè€Œä¸”æœ‰ Google æ’‘è…°ï¼Œç»™äº†å®ƒé•¿æœŸçš„å¯ä¿¡åº¦ã€‚å„ç§åŒ…ï¼ˆPackagesï¼‰åœ¨ä¸æ–­æˆç†Ÿï¼Œæ–‡æ¡£æœ‰äº†å·¨å¤§çš„è¿›æ­¥ï¼Œæˆ‘å¾ˆå°‘æ„Ÿè§‰è‡ªå·±æ˜¯åœ¨é»‘æš—ä¸­ç‹¬è‡ªæ‘¸ç´¢ã€‚</li>
</ul>
<p><strong>è¿™ä¸€æ¬¡ï¼Œæˆ‘ä¸å†è§‰å¾—è‡ªå·±å­¦çš„æ˜¯ä¸´æ—¶æ€§çš„ä¸œè¥¿äº†ã€‚æˆ‘æ„Ÿè§‰è‡ªå·±æ˜¯åœ¨æŠ•èµ„ä¸€ä¸ªèƒ½é•¿ä¹…ä½¿ç”¨çš„å·¥å…·ã€‚</strong></p>
<hr/>
<h3 data-id="heading-3">ä¸æ–­åˆ‡æ¢çš„éšæ€§æˆæœ¬</h3>
<p>è¿½é€æ¡†æ¶ä¸åªæ˜¯å­¦ä¹ æ›²çº¿å¸¦æ¥çš„æŒ«è´¥æ„Ÿâ€”â€”å®ƒè¿˜æœ‰éšæ€§æˆæœ¬ï¼š</p>
<ul>
<li><strong>è„‘åŠ›æ¶ˆè€—ï¼š</strong> æ¯ä¸ªæ¡†æ¶éƒ½å¸¦æœ‰ä¸€å¥—æ–°çš„å·¥å…·ã€æ–°çš„è°ƒè¯•æŠ€å·§å’Œæ–°çš„æ€ªç™–ã€‚ä¸åœåœ°åˆ‡æ¢ä¼šçƒ§æ‰ä½ çš„ç²¾åŠ›ï¼Œè€Œè¿™äº›ç²¾åŠ›æœ¬å¯ä»¥ç”¨åœ¨å¼€å‘çœŸæ­£çš„åº”ç”¨ä¸Šã€‚</li>
<li><strong>çŸ¥è¯†è‚¤æµ…ï¼š</strong> æµ…å°è¾„æ­¢å¤šä¸ªæ¡†æ¶æ„å‘³ç€ä½ å¾ˆéš¾çœŸæ­£ç²¾é€šä»»ä½•ä¸€ä¸ªã€‚è¿™åœ¨è°ƒè¯•å¤æ‚é—®é¢˜æˆ–å¯¹åº”ç”¨è¿›è¡Œæ‰©å±•æ—¶ä¼šè®©ä½ å¾ˆç—›è‹¦ã€‚</li>
<li><strong>æ—¶é—´æµªè´¹ï¼š</strong> è¯´çœŸçš„ï¼Œç”¨ä¸‰ç§ä¸åŒçš„æ¡†æ¶æŠŠä¸€ä¸ª Side Project é‡å†™ä¸‰æ¬¡ï¼Œè¿™ä¸å«æˆé•¿ã€‚<strong>è¿™æ˜¯æŠ«ç€å­¦ä¹ å¤–è¡£çš„æ‹–å»¶ç—‡ã€‚</strong></li>
</ul>
<p>æˆ‘æ„è¯†åˆ°ï¼Œæˆ‘çˆ±çš„å…¶å®æ˜¯<strong>å­¦ä¹ æ¡†æ¶</strong>ï¼Œè€Œä¸æ˜¯<strong>æ„å»ºäº§å“</strong>ã€‚Flutter ç»™äº†æˆ‘æ‰€éœ€è¦çš„ç¨³å®šæ€§ï¼Œè®©æˆ‘èƒ½é‡æ–°ä¸“æ³¨äºçœŸæ­£é‡è¦çš„äº‹æƒ…ï¼š<strong>æŠŠä¸œè¥¿äº¤ä»˜å‡ºå»ï¼ˆShippingï¼‰ã€‚</strong></p>
<hr/>
<h3 data-id="heading-4">å¹¿åº¦ä¸æ·±åº¦ï¼Œæ·±åº¦çš„åŠ›é‡</h3>
<p>åšæŒä½¿ç”¨ Flutter è®©æˆ‘è·å¾—äº†æ·±åº¦æˆé•¿ï¼Œè¿™æ˜¯ä¸æ–­åˆ‡æ¢æ¡†æ¶åšä¸åˆ°çš„ã€‚æˆ‘æ›´æ·±å…¥åœ°ç ”ç©¶äº†çŠ¶æ€ç®¡ç†æ¨¡å¼ã€æ¶æ„å†³ç­–å’Œæ€§èƒ½ä¼˜åŒ–ã€‚æˆ‘åšå‡ºæ¥çš„ Side Project ä¸åªæ˜¯å¼€äº†å¤´ï¼Œè€Œæ˜¯<strong>å®Œæˆäº†</strong>ã€‚</p>
<p>æ·±åº¦å¸¦æ¥äº†æ¸…æ™°åº¦ã€‚æˆ‘ä¸å†éœ€è¦æµªè´¹æ—¶é—´å» Google æœç´¢â€œæ¡†æ¶ X æ€ä¹ˆå¤„ç†å¯¼èˆªï¼Ÿâ€ï¼Œè€Œæ˜¯å¯¹ Flutter çš„ç”Ÿæ€ç³»ç»Ÿäº†å¦‚æŒ‡æŒã€‚è¿™ç§ä¿¡å¿ƒä¼šéšç€æ—¶é—´ä¸æ–­ç§¯ç´¯ï¼Œè®©æˆ‘æˆä¸ºä¸€ä¸ªæ›´å¿«ã€æ›´å¯é çš„å¼€å‘è€…ã€‚</p>
<hr/>
<h3 data-id="heading-5">ä½† Flutter æ˜¯â€œæ°¸è¿œçš„ç­”æ¡ˆâ€å—ï¼Ÿ</h3>
<p>æ²¡æœ‰å“ªä¸ªæ¡†æ¶æ˜¯æ°¸æ’çš„ã€‚Flutter ä¼šå‘å±•ï¼Œä¹Ÿè®¸äº”åˆ°åå¹´åä¼šæœ‰æ›´å¥½çš„ä¸œè¥¿å‡ºç°ã€‚ä½†æˆ‘å­¦åˆ°çš„æ˜¯ï¼Œé‡ç‚¹ä¸åœ¨äºæŒ‘é€‰ä¸€ä¸ªâ€œå®Œç¾â€çš„æ¡†æ¶ï¼Œè€Œåœ¨äº<strong>æŒ‘é€‰ä¸€ä¸ªç¨³å®šçš„æ¡†æ¶ï¼Œå¹¶åšæŒè¶³å¤Ÿé•¿çš„æ—¶é—´å»åˆ›é€ å‡ºæœ‰æ„ä¹‰çš„ä½œå“ã€‚</strong></p>
<p>æ¡†æ¶æ˜¯å·¥å…·ã€‚æˆ‘ä»¬ç”¨å®ƒä»¬åˆ›é€ å‡ºçš„ä»·å€¼æ‰æ˜¯æœ€é‡è¦çš„ã€‚è€Œ Flutterï¼Œæ°å¥½æ˜¯æˆ‘èŒä¸šç”Ÿæ¶¯è¿™ä¸ªé˜¶æ®µæœ€é€‚åˆæˆ‘çš„å·¥å…·ã€‚</p>
<hr/>
<h3 data-id="heading-6">ç»™åŒè¡Œçš„å»ºè®®</h3>
<p>å¦‚æœä½ å‘ç°è‡ªå·±æ€»æ˜¯åœ¨åˆ‡æ¢æ¡†æ¶ï¼Œä¸å¦¨é—®é—®è‡ªå·±ï¼š</p>
<ul>
<li>æˆ‘æ˜¯ä¸ºäº†<strong>æ„å»ºå‡ºçœŸæ­£çš„äº§å“</strong>æ‰å­¦çš„ï¼Œè¿˜æ˜¯ä»…ä»…ä¸ºäº†æ»¡è¶³å¥½å¥‡å¿ƒï¼Ÿ</li>
<li>æ¯”èµ·åœ¨ä¸€ä¸ªæ–°çš„ç”Ÿæ€é‡Œé‡æ–°å¼€å§‹ï¼Œæˆ‘å¦‚æœåœ¨ä¸€ä¸ªç”Ÿæ€é‡Œ<strong>é’»å¾—æ›´æ·±</strong>ä¼šä¸ä¼šæˆé•¿å¾—æ›´å¿«ï¼Ÿ</li>
<li>æˆ‘è¿™ç§ä¸æ–­åˆ‡æ¢æ€è·¯çš„æˆæœ¬åˆ°åº•æœ‰å¤šå¤§ï¼Ÿ</li>
</ul>
<p>æ¢ç´¢æ˜¯å¥½çš„â€”â€”å®ƒèƒ½è®©ä½ æ€ç»´æ›´æ•é”ã€‚ä½†åœ¨æŸä¸ªèŠ‚ç‚¹ï¼Œä½ å¾—ä¸‹å®šå†³å¿ƒã€‚å¯¹æˆ‘æ¥è¯´ï¼Œè¿™ä¸ªå†³å¿ƒå°±æ˜¯ <strong>Flutter</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-7">æœ€åçš„æƒ³æ³•</h3>
<p>è¿½é€â€œä¸‹ä¸€ä¸ªå¤§æ¡†æ¶â€æ„Ÿè§‰å¾ˆåˆºæ¿€ï¼Œä½†è¿™å…¶å®å°±åƒåœ¨è·‘æ­¥æœºä¸Šã€‚æˆ‘è·‘å¾—å¾ˆå¿«ï¼Œä½†å“ªå„¿éƒ½æ²¡å»ã€‚Flutter ç»™äº†æˆ‘ä¸€ä¸ªæœºä¼šï¼Œè®©æˆ‘å¯ä»¥èµ°ä¸‹è·‘æ­¥æœºï¼Œä¸“æ³¨äºçœŸæ­£çš„äº§å“ï¼Œå¹¶ä¸”ä½œä¸ºä¸€åå¼€å‘è€…ï¼Œ<strong>è·å¾—äº†æ·±åº¦è€Œéä»…ä»…æ˜¯å¹¿åº¦ä¸Šçš„æˆé•¿ã€‚</strong></p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¥åå†ä¹Ÿä¸ä¼šç¢°å…¶ä»–æ¡†æ¶äº†å—ï¼Ÿå½“ç„¶ä¸æ˜¯â€”â€”æˆ‘è¿˜ä¼šå…³æ³¨ç”Ÿæ€å˜åŒ–ã€‚ä½†æˆ‘ä¸ä¼šå†è®©ç‚’ä½œæ¥å¹²æ‰°æˆ‘çš„ä¸“æ³¨äº†ã€‚</p>
<p>è¯´åˆ°åº•ï¼Œæ¡†æ¶æ¥æ¥å»å»ã€‚æˆ‘ä»¬äº¤ä»˜çš„ä»£ç ã€æ„å»ºçš„åº”ç”¨ï¼Œä»¥åŠå®ƒä»¬æ‰€åˆ›é€ çš„å½±å“â€”â€”<strong>é‚£æ‰æ˜¯æ°¸æ’çš„ã€‚</strong></p>
<p>å¯¹æˆ‘æ¥è¯´ï¼ŒFlutter å°±æ˜¯å¸®åŠ©æˆ‘å®ç°è¿™ä¸€åˆ‡çš„å·¥å…·ã€‚ğŸš€</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å†ç»4ä¸ªæœˆï¼ŒåŸºäº Tiptap å’Œ NestJs æ‰“é€ ä¸€æ¬¾ AI é©±åŠ¨çš„æ™ºèƒ½æ–‡æ¡£åä½œå¹³å° ğŸš€ğŸš€ğŸš€]]></title>    <link>https://juejin.cn/post/7570271574348496905</link>    <guid>https://juejin.cn/post/7570271574348496905</guid>    <pubDate>2025-11-10T00:56:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570271574348496905" data-draft-id="7570271574348480521" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å†ç»4ä¸ªæœˆï¼ŒåŸºäº Tiptap å’Œ NestJs æ‰“é€ ä¸€æ¬¾ AI é©±åŠ¨çš„æ™ºèƒ½æ–‡æ¡£åä½œå¹³å° ğŸš€ğŸš€ğŸš€"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-11-10T00:56:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Moment"/> <meta itemprop="url" content="https://juejin.cn/user/3782764966460398"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å†ç»4ä¸ªæœˆï¼ŒåŸºäº Tiptap å’Œ NestJs æ‰“é€ ä¸€æ¬¾ AI é©±åŠ¨çš„æ™ºèƒ½æ–‡æ¡£åä½œå¹³å° ğŸš€ğŸš€ğŸš€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3782764966460398/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Moment
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T00:56:07.000Z" title="Mon Nov 10 2025 00:56:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>å½“ AI æŠ€æœ¯åˆšåˆšå…´èµ·æ—¶ï¼Œæˆ‘åŠ å…¥äº†ä¸€å®¶ AI åˆåˆ›å…¬å¸ã€‚ç”±äºæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­æœ‰ç€å¯¹é«˜çº§ç¼–è¾‘åŠŸèƒ½çš„éœ€æ±‚ï¼Œæˆ‘ç¬¬ä¸€æ¬¡æ¥è§¦åˆ°äº† Tiptapã€‚è®©æˆ‘å°è±¡æ·±åˆ»çš„æ˜¯ï¼ŒTiptap ä¸å…¶ä»–ç¼–è¾‘å™¨ç›¸æ¯”ï¼Œæœ€å¤§äº®ç‚¹åœ¨äºå®ƒçš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚è¿™ç§é«˜åº¦çš„å®šåˆ¶èƒ½åŠ›ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿæ ¹æ®éœ€æ±‚éšæ—¶è°ƒæ•´å’Œæ‰©å±•ç¼–è¾‘å™¨çš„åŠŸèƒ½ï¼Œå®Œå…¨æ»¡è¶³äº†æˆ‘ä»¬çš„ç‹¬ç‰¹è¦æ±‚ã€‚</p>
<p>ç»è¿‡ä¸€æ®µæ—¶é—´çš„ç ”ç©¶ï¼Œæˆ‘æ¸æ¸è®¤ä¸º Tiptap åº”è¯¥æ˜¯æˆ‘æœªæ¥é€‰æ‹©çš„é¦–é€‰ç¼–è¾‘å™¨ã€‚å¦å¤–ç°åœ¨å…¬å¸å¾ˆä¹…å°±ä¸å¹²äº†ï¼Œé¡¹ç›®ä¹Ÿæ²¡æœ‰ä¸Šçº¿ï¼Œæˆ‘å®Œå…¨å¯ä»¥å¤åˆ»é‡Œé¢çš„æ ¸å¿ƒåŠŸèƒ½ã€‚</p>
<p>ç°åœ¨åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.codecrack.cn%2Fdashboard" target="_blank" title="https://www.codecrack.cn/dashboard" ref="nofollow noopener noreferrer">dashboard</a> é¡µé¢ä¸Šèƒ½çœ‹åˆ°çš„åŸºæœ¬å°±æ˜¯å°†æ¥è¦å®ç°çš„æ ¸å¿ƒåŠŸèƒ½äº†ã€‚</p>
<p>é¦–å…ˆå…ˆè´´ç›¸å…³åœ°å€ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxun082%2FDocFlow" target="_blank" title="https://github.com/xun082/DocFlow" ref="nofollow noopener noreferrer">Github åœ°å€</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.codecrack.cn%2F" target="_blank" title="https://www.codecrack.cn/" ref="nofollow noopener noreferrer">åœ¨çº¿é¢„è§ˆ</a></p>
<p>å¾®ä¿¡è”ç³»æ–¹å¼æˆ–åŠ ç¾¤ï¼š<code>yunmz777</code></p>
<h2 data-id="heading-0">é¡¹ç›®ä»‹ç»</h2>
<p>DocFlow æ˜¯ä¸€ä¸ªåŸºäº Tiptap å’Œ Yjs æ„å»ºçš„æ™ºèƒ½åä½œå†™ä½œå¹³å°ï¼Œç±»ä¼¼é£ä¹¦çš„æ–‡æ¡£åŠŸèƒ½ï¼Œæ”¯æŒå¤šäººå®æ—¶åä½œç¼–è¾‘ã€‚å¹³å°ç»“åˆäº† AI ç”Ÿæˆå†…å®¹å’Œ RAG çŸ¥è¯†åº“æœç´¢ï¼Œå¸®åŠ©ç”¨æˆ·åœ¨åˆ›ä½œè¿‡ç¨‹ä¸­å¿«é€Ÿè·å–ç›¸å…³ä¿¡æ¯ï¼Œå¹¶æä¾›æ™ºèƒ½å†™ä½œå»ºè®®ã€‚</p>
<p>DocFlow è¿˜å°†å…·å¤‡ç±»ä¼¼ Dify çš„å·¥ä½œæµç¼–æ’åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥åˆ›å»ºè‡ªåŠ¨åŒ–æµç¨‹ï¼Œå®šä¹‰ä¸åŒä»»åŠ¡å’Œæ“ä½œçš„æ‰§è¡Œé¡ºåºï¼Œå®ç°ä»»åŠ¡çš„ä¸åŒè¾“å…¥è¾“å‡ºã€‚é€šè¿‡è¿™ä¸ªåŠŸèƒ½ï¼Œå›¢é˜Ÿå¯ä»¥é«˜æ•ˆåœ°ç®¡ç†åˆ›ä½œè¿‡ç¨‹ï¼Œæ„å»ºæ™ºèƒ½ä»£ç†ï¼ˆAgentï¼‰æ¥è‡ªåŠ¨å¤„ç†å†…å®¹ç”Ÿæˆã€æ–‡æ¡£æ•´ç†ç­‰ä»»åŠ¡ï¼Œæå¤§æå‡ç”Ÿäº§åŠ›ã€‚</p>
<p>æ— è®ºæ˜¯æ–‡æ¡£å†™ä½œã€çŸ¥è¯†ç®¡ç†ï¼Œè¿˜æ˜¯å¤æ‚æµç¨‹çš„è‡ªåŠ¨åŒ–ï¼ŒDocFlow éƒ½èƒ½æä¾›å¼ºå¤§çš„æ”¯æŒï¼Œå¸®åŠ©å›¢é˜Ÿä¼˜åŒ–å·¥ä½œæµå¹¶æå‡åˆ›ä½œæ•ˆç‡ã€‚</p>
<p>é¡¹ç›®é‡‡ç”¨çš„ NextJs å’Œ NestJs çš„å…¨æ ˆæ¶æ„ï¼Œ</p>
<p>é¦–é€‰æ˜¯å‰ç«¯çš„æŠ€æœ¯æ ˆæ ¸å¿ƒä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p>
<ol>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2F" target="_blank" title="https://nextjs.org/" ref="nofollow noopener noreferrer">Next.js</a>ï¼šç”¨äºæ„å»º React åº”ç”¨ï¼Œæ”¯æŒæœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰å’Œé™æ€ç”Ÿæˆï¼ˆSSGï¼‰ï¼Œéå¸¸é€‚åˆ SEO ä¼˜åŒ–å’Œæå‡é¡µé¢åŠ è½½é€Ÿåº¦ã€‚</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftiptap.dev%2F" target="_blank" title="https://tiptap.dev/" ref="nofollow noopener noreferrer">Tiptap</a>ï¼šç°ä»£åŒ–çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ”¯æŒé«˜åº¦å®šåˆ¶å’Œæ‰©å±•ï¼Œé€‚åˆå„ç§æ–‡æ¡£ç¼–è¾‘éœ€æ±‚ï¼Œå¹¶ä¸ React é›†æˆè‰¯å¥½ã€‚</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftailwindcss.com%2F" target="_blank" title="https://tailwindcss.com/" ref="nofollow noopener noreferrer">TailwindCSS</a>ï¼šé€šè¿‡å®ç”¨ç±»æ„å»ºå“åº”å¼å’Œç°ä»£åŒ–ç•Œé¢çš„ CSS æ¡†æ¶ï¼Œæé«˜å¼€å‘æ•ˆç‡å’Œçµæ´»æ€§ã€‚</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.radix-ui.com%2F" target="_blank" title="https://www.radix-ui.com/" ref="nofollow noopener noreferrer">Radix UI</a>ï¼šæä¾›é«˜è´¨é‡ã€æ— æ ·å¼çš„ UI ç»„ä»¶åº“ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿæ„å»ºæ— éšœç¢å’Œå“åº”å¼ç•Œé¢ã€‚</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.framer.com%2Fmotion%2F" target="_blank" title="https://www.framer.com/motion/" ref="nofollow noopener noreferrer">Framer Motion</a>ï¼š ç”¨äº React åº”ç”¨çš„åŠ¨ç”»åº“ï¼Œæä¾›ä¸°å¯Œçš„åŠ¨ç”»æ•ˆæœï¼Œå¢å¼ºç”¨æˆ·ä½“éªŒã€‚</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftanstack.com%2Fquery" target="_blank" title="https://tanstack.com/query" ref="nofollow noopener noreferrer">React Query</a>ï¼šé«˜æ•ˆçš„æ•°æ®è·å–å’ŒåŒæ­¥åº“ï¼Œç”¨äºç®¡ç†è¿œç¨‹æ•°æ®çš„åŠ è½½ã€ç¼“å­˜å’ŒåŒæ­¥ã€‚</p>
</li>
</ol>
<p>æœªæ¥åšæµç¨‹ç¼–æ’çš„è¯ä¼šä½¿ç”¨ React Flowã€‚</p>
<p>åç«¯æ ¸å¿ƒæŠ€æœ¯ï¼š</p>
<ol>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fnestjs.com%2F" target="_blank" title="https://nestjs.com/" ref="nofollow noopener noreferrer">NestJS</a>ï¼šç”¨äºæ„å»ºé«˜æ•ˆã€å¯æ‰©å±•çš„ Node.js åç«¯åº”ç”¨ï¼Œæ”¯æŒæ¨¡å—åŒ–å¼€å‘å’Œä¾èµ–æ³¨å…¥ï¼Œéå¸¸é€‚åˆæ„å»ºä¼ä¸šçº§åº”ç”¨ã€‚</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.fastify.io%2F" target="_blank" title="https://www.fastify.io/" ref="nofollow noopener noreferrer">Fastify</a>ï¼š é«˜æ€§èƒ½ã€ä½å¼€é”€çš„ Node.js HTTP æ¡†æ¶ï¼Œä¸“æ³¨äºä¼˜åŒ–é€Ÿåº¦ï¼Œé€‚åˆé«˜å¹¶å‘å’Œé«˜æ•ˆçš„ API æœåŠ¡ã€‚</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.prisma.io%2F" target="_blank" title="https://www.prisma.io/" ref="nofollow noopener noreferrer">Prisma</a>ï¼š ç°ä»£çš„ ORM å·¥å…·ï¼Œæä¾›ç±»å‹å®‰å…¨çš„æ•°æ®åº“æŸ¥è¯¢æ”¯æŒï¼Œé€‚ç”¨äº PostgreSQLã€MySQL ç­‰æ•°æ®åº“ã€‚</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cloudamqp.com%2F" target="_blank" title="https://www.cloudamqp.com/" ref="nofollow noopener noreferrer">MQ (æ¶ˆæ¯é˜Ÿåˆ—)</a>ï¼š ç”¨äºå¤„ç†å¼‚æ­¥ä»»åŠ¡å’Œæ¶ˆæ¯ä¼ é€’ï¼Œæ”¯æŒé«˜å¹¶å‘ã€é«˜å¯é æ€§çš„æ•°æ®ä¼ è¾“å’Œä»»åŠ¡è°ƒåº¦ã€‚</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fsocket.io%2F" target="_blank" title="https://socket.io/" ref="nofollow noopener noreferrer">Socket.io</a>ï¼šå®æ—¶é€šä¿¡åº“ï¼Œæ”¯æŒ WebSocketsï¼Œå¸®åŠ©è½»æ¾å®ç°å®æ—¶æ¶ˆæ¯æ¨é€å’Œ Web åº”ç”¨ä¹‹é—´çš„å®æ—¶é€šä¿¡ã€‚</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Flangchain.com%2F" target="_blank" title="https://langchain.com/" ref="nofollow noopener noreferrer">Langchain</a>ï¼š ç”¨äºä¸å¤šç§è¯­è¨€æ¨¡å‹ï¼ˆå¦‚ OpenAI çš„ GPTï¼‰äº¤äº’çš„æ¡†æ¶ï¼Œæ”¯æŒ AI åŠŸèƒ½çš„é›†æˆï¼Œå¦‚æ–‡æœ¬ç”Ÿæˆã€çŸ¥è¯†å›¾è°±ç­‰ã€‚</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fyjs.dev%2F" target="_blank" title="https://yjs.dev/" ref="nofollow noopener noreferrer">Yjs</a>ï¼šç”¨äºæ„å»ºå®æ—¶åä½œåº”ç”¨çš„æ¡†æ¶ï¼Œæ”¯æŒé«˜æ•ˆçš„æ•°æ®åŒæ­¥ï¼Œé€‚åˆå®æ—¶ç¼–è¾‘å’Œå¤šäººåä½œåœºæ™¯ã€‚</p>
</li>
</ol>
<h4 data-id="heading-1">ç›®å½•ç»“æ„</h4>
<p>ç›®å½•ç»“æ„é‡‡ç”¨æ¯”è¾ƒå¸¸è§çš„ç»“æ„ï¼š</p>
<pre><code class="hljs language-tree" lang="tree">src/
â”œâ”€â”€ app/                # Next.js åº”ç”¨ç›®å½•ï¼ŒåŒ…å«é¡µé¢è·¯ç”±ã€å¸ƒå±€é…ç½®ç­‰
â”œâ”€â”€ components/         # å¯å¤ç”¨çš„ UI ç»„ä»¶åº“
â”œâ”€â”€ extensions/         # Tiptap ç¼–è¾‘å™¨çš„è‡ªå®šä¹‰æ‰©å±•åŠŸèƒ½
â”œâ”€â”€ hooks/              # è‡ªå®šä¹‰ React Hooks
â”œâ”€â”€ services/           # ä¸šåŠ¡é€»è¾‘æœåŠ¡å±‚ï¼ˆå¦‚ API è°ƒç”¨ã€è¯·æ±‚å°è£…ç­‰ï¼‰
â”œâ”€â”€ stores/             # çŠ¶æ€ç®¡ç†ï¼ˆå¦‚ä½¿ç”¨ Zustandã€Jotai ç­‰ï¼‰
â”œâ”€â”€ styles/             # å…¨å±€æ ·å¼å’Œæ ·å¼æ¨¡å—
â”œâ”€â”€ types/              # å…¨å±€ TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°ã€è¾…åŠ©æ–¹æ³•
â”œâ”€â”€ worker/             # Web Worker å®ç°ï¼Œç”¨äºå¼‚æ­¥æˆ–æ€§èƒ½å¯†é›†å‹ä»»åŠ¡
â””â”€â”€ middleware.ts       # Next.js ä¸­é—´ä»¶ï¼Œç”¨äºè¯·æ±‚æ‹¦æˆªã€è®¤è¯æ§åˆ¶ç­‰
</code></pre>
<p>å…¶ä¸­ styles é‡Œé¢åŒ…å«äº†å¤§é‡çš„ tiptap çš„ css æ ·å¼ï¼Œè¿™äº› CSS æ–‡ä»¶ç”¨äºä¸º Tiptap æä¾›å®Œæ•´çš„å¯Œæ–‡æœ¬æ ·å¼æ”¯æŒã€‚ç”±äº Tiptap æ˜¯æ— å¤´ç»„ä»¶ï¼Œæ‰€æœ‰æ ·å¼ï¼ˆå¦‚æ®µè½ã€ä»£ç å—ã€è¡¨æ ¼ã€åˆ—è¡¨ã€ååŒç¼–è¾‘ç­‰ï¼‰éƒ½éœ€è‡ªè¡Œå®šä¹‰ã€‚æ¯ä¸ª CSS æ–‡ä»¶é’ˆå¯¹ä¸€ä¸ªåŠŸèƒ½æ¨¡å—è¿›è¡Œæ ·å¼åˆ†ç¦»ï¼Œä¾¿äºç»´æŠ¤ä¸æ‰©å±•ã€‚è¿™ç§æ‹†åˆ†æ–¹å¼èƒ½ä¿æŒæ ·å¼ç»“æ„æ¸…æ™°ã€èŒè´£æ˜ç¡®ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/716300c203454023869475fe75a8d00a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340967&amp;x-signature=Y%2B%2B%2BUaBYGB8O%2BRJFLg3Zuq%2FmxKI%3D" alt="20250923084026" loading="lazy"/></p>
<p>æ¯ä¸ªæ–‡ä»¶ä»£è¡¨ä¸åŒæ’ä»¶çš„æ ·å¼é…ç½®ã€‚ä¾‹å¦‚ï¼Œ<code>code.css</code> å®šä¹‰äº†ä»£ç å— <code>&lt;pre&gt;&lt;code&gt;</code> çš„æ ·å¼ï¼ŒåŒ…æ‹¬èƒŒæ™¯è‰²ã€å­—ä½“ã€è¡Œå·ç­‰ï¼Œé€‚é… <code>CodeBlock</code> æ’ä»¶ï¼Œå¹¶æ”¯æŒè¯­æ³•é«˜äº®æ•ˆæœã€‚</p>
<p>åœ¨ <code>components</code> ç›®å½•ä¸‹ï¼Œç»„ä»¶è¢«åˆ†ä¸ºä¸¤ä¸ªä¸åŒçš„åˆ†ç±»ï¼š</p>
<ul>
<li>
<p>src ç›®å½•ä¸­çš„ç»„ä»¶æ˜¯å…¨å±€å…¬å…±ç»„ä»¶æˆ–ä¸šåŠ¡ä¸­å¯å¤ç”¨çš„ç»„ä»¶ï¼Œé€‚ç”¨äºå¤šä¸ªé¡µé¢æˆ–åŠŸèƒ½æ¨¡å—ã€‚</p>
</li>
<li>
<p>app ç›®å½•ä¸‹çš„ç»„ä»¶åˆ™æ˜¯é’ˆå¯¹ç‰¹å®šé¡µé¢æˆ–å¸ƒå±€è·¯ç”±ç»„çš„ä¸šåŠ¡ç»„ä»¶ï¼Œä¸ºé¿å…ä¸è·¯ç”±å†²çªï¼Œæ¨èå°†è¿™äº›ç»„ä»¶å‘½åä¸º <code>_components</code>ã€‚</p>
</li>
</ul>
<h4 data-id="heading-2">æ ¸å¿ƒæ¨¡å—</h4>
<h5 data-id="heading-3">Service å°è£…å’Œè°ƒç”¨</h5>
<p>service ç›®å½•ä¸‹çš„ <code>request.ts</code> ä¸ºå…¨å±€çš„ <code>fetch</code> å°è£…ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c909afc96314e999c00f91eeef8957a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340967&amp;x-signature=fQJFeeFplV69XQZJgHuYP4BSeUc%3D" alt="20250923084309" loading="lazy"/></p>
<p>è¿™æ®µä»£ç å°è£…äº†ä¸€ä¸ªåŸºäº <code>fetch</code> çš„è¯·æ±‚å·¥å…·ç±»ï¼Œæ”¯æŒç»Ÿä¸€çš„è¯·æ±‚æ‹¦æˆªã€è¶…æ—¶æ§åˆ¶ã€é”™è¯¯å¤„ç†å’Œè‡ªåŠ¨é‡è¯•ç­‰é«˜çº§åŠŸèƒ½ã€‚å®ƒæä¾›äº† <code>get</code>ã€<code>post</code>ã€<code>put</code>ã€<code>delete</code>ã€<code>patch</code> ç­‰ HTTP è¯·æ±‚æ–¹æ³•ï¼Œå¹¶è¿”å›ç»Ÿä¸€æ ¼å¼çš„å“åº”ç»“æœï¼Œæ–¹ä¾¿åœ¨é¡¹ç›®ä¸­ç¨³å®šå¤ç”¨ã€‚</p>
<p>å¯¹äºä¸åŒæ¨¡å—çš„è¯·æ±‚ï¼Œå¯ä»¥åœ¨ services ç›®å½•ä¸‹åˆ›å»ºæ–°çš„å­ç›®å½•è¿›è¡Œæ¨¡å—åŒ–å°è£…ã€‚ä¾‹å¦‚ï¼Œå¯¹äº user æ¨¡å—ï¼Œå¯ä»¥åœ¨ <code>user</code> ç›®å½•ä¸‹åˆ›å»º <code>index.ts</code> æ¥å°è£…å‡½æ•°é€»è¾‘ï¼Œ<code>type.ts</code> ç”¨äºå®šä¹‰æ¥å£çš„å…¥å‚å’Œå‡ºå‚ç±»å‹ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä¸åŒæ¨¡å—çš„è¯·æ±‚é€»è¾‘æ¸…æ™°åˆ†ç¦»ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a2a861874ea47b398e7989d94acd2c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340967&amp;x-signature=lEgHHPGo1xxhJuG4I0RRjZB%2BlRA%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨å®é™…è°ƒç”¨æ—¶ï¼Œæ— éœ€æ˜¾å¼ä½¿ç”¨ <code>try...catch</code> æ¥æ•è·é”™è¯¯ã€‚å¯ä»¥é€šè¿‡ä¼ å…¥ä¸åŒçš„é”™è¯¯å¤„ç†é€»è¾‘ï¼Œç»Ÿä¸€çš„ <code>fetch</code> å®ä¾‹ä¼šè‡ªåŠ¨å¤„ç†é”™è¯¯å¹¶æ‰§è¡Œç›¸åº”çš„å¤„ç†æ–¹å¼ã€‚</p>
<h5 data-id="heading-4">Tiptap</h5>
<p>å€ŸåŠ© Tiptap å¼ºå¤§çš„æ‰©å±•åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åŸæœ‰åŸºç¡€ä¸Šè½»æ¾æ·»åŠ æ‰€éœ€çš„åŠŸèƒ½ï¼Œç”šè‡³å¯ä»¥åœ¨ Tiptap ä¸Šæ‰©å±•æ•´ä¸ªé¡µé¢ã€‚</p>
<p>åˆ›å»ºæ‰©å±•æ—¶ï¼Œä¸€èˆ¬éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Node</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@tiptap/core"</span>;
<span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">NodeViewWrapper</span>, <span class="hljs-comment">// ç”¨äºåŒ…è£… React ç»„ä»¶ä¸º NodeView</span>
  <span class="hljs-title class_">ReactNodeViewRenderer</span>, <span class="hljs-comment">// ç”¨äºåŒ…è£¹ React èŠ‚ç‚¹ï¼ŒTiptap ä¼šè¯†åˆ«å®ƒä½œä¸º NodeView çš„å®¹å™¨</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">"@tiptap/react"</span>;

<span class="hljs-comment">// ğŸ‘‰ ä½ çš„è‡ªå®šä¹‰ç»„ä»¶ï¼ˆå®é™…æ¸²æŸ“é€»è¾‘ï¼‰</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MyReactComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./MyReactComponent"</span>;

<span class="hljs-comment">// ğŸ‘‰ å®šä¹‰æ‰©å±•</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">MyNode</span> = <span class="hljs-title class_">Node</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">"myNode"</span>, <span class="hljs-comment">// èŠ‚ç‚¹åç§°ï¼Œå¿…é¡»å”¯ä¸€</span>
  <span class="hljs-attr">group</span>: <span class="hljs-string">"block"</span>, <span class="hljs-comment">// èŠ‚ç‚¹åˆ†ç»„ï¼Œå¯é€‰ block / inline / list</span>
  <span class="hljs-attr">atom</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// åŸå­èŠ‚ç‚¹ï¼Œä¸å¯ç¼–è¾‘å†…éƒ¨å†…å®¹</span>
  <span class="hljs-attr">draggable</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ˜¯å¦å…è®¸æ‹–æ‹½ç§»åŠ¨</span>
  <span class="hljs-attr">inline</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// æ˜¯å¦æ˜¯ inline ç±»å‹ï¼Œé»˜è®¤ä¸º block</span>

  <span class="hljs-comment">// HTML -&gt; Node æ˜ å°„ï¼ˆååºåˆ—åŒ–ï¼‰</span>
  <span class="hljs-title function_">parseHTML</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> [
      {
        <span class="hljs-attr">tag</span>: <span class="hljs-string">'div[data-type="my-node"]'</span>, <span class="hljs-comment">// å°† HTML æ ‡ç­¾æ˜ å°„åˆ°è¯¥èŠ‚ç‚¹</span>
      },
    ];
  },

  <span class="hljs-comment">// Node -&gt; HTML æ˜ å°„ï¼ˆåºåˆ—åŒ–ï¼‰</span>
  <span class="hljs-title function_">renderHTML</span>(<span class="hljs-params">{ HTMLAttributes }</span>) {
    <span class="hljs-keyword">return</span> [
      <span class="hljs-string">"div"</span>,
      { ...<span class="hljs-title class_">HTMLAttributes</span>, <span class="hljs-string">"data-type"</span>: <span class="hljs-string">"my-node"</span> }, <span class="hljs-comment">// ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®å±æ€§</span>
      <span class="hljs-string">""</span>, <span class="hljs-comment">// ç©ºçš„å†…å®¹ï¼ŒåŸå­èŠ‚ç‚¹ä¸åŒ…å«å¯ç¼–è¾‘å†…å®¹</span>
    ];
  },

  <span class="hljs-comment">// å®¢æˆ·ç«¯æ¸²æŸ“è§†å›¾ï¼ˆNodeViewï¼‰â€”â€” ä»…åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œ</span>
  <span class="hljs-title function_">addNodeView</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// ä»…åœ¨å®¢æˆ·ç«¯æ‰§è¡Œ NodeView æ¸²æŸ“</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">"undefined"</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">ReactNodeViewRenderer</span>(<span class="hljs-title class_">MyReactComponent</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// SSR æ—¶è·³è¿‡ NodeView</span>
  },

  <span class="hljs-comment">// è‡ªå®šä¹‰å‘½ä»¤ï¼šæ’å…¥è¯¥èŠ‚ç‚¹</span>
  <span class="hljs-title function_">addCommands</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">insertMyNode</span>:
        <span class="hljs-function">() =&gt;</span>
        <span class="hljs-function">(<span class="hljs-params">{ commands }</span>) =&gt;</span> {
          <span class="hljs-keyword">return</span> commands.<span class="hljs-title function_">insertContent</span>({
            <span class="hljs-attr">type</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>,
          });
        },
    };
  },
});
</code></pre>
<p>åˆ›å»ºå®Œæˆä¹‹åå¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å¹¶å¯¼å‡ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5dfa192c43246a4866d98f881fdf14f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340967&amp;x-signature=ig70A8sw1Dx63YBotOTmwN31%2BAM%3D" alt="20250923084804" loading="lazy"/></p>
<p>è¿™ä¸¤ä¸ªæ–‡ä»¶éƒ½è¦ã€‚</p>
<h5 data-id="heading-5">Prisma</h5>
<p>Prisma éå¸¸å¥½ç”¨ï¼Œæ‡‚çš„éƒ½æ‡‚ï¼Œé¡¹ç›®ç›®å‰ Mysql çš„æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/396b5cbd58644d48808cc183b0574633~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340967&amp;x-signature=4kJuiqWVpewzJwgolof7lWvtq3I%3D" alt="20250923092635" loading="lazy"/></p>
<h5 data-id="heading-6">Rabbitmq</h5>
<p>ç›®å‰é¡¹ç›®ä¸­çš„ AI æ’­å®¢ç”Ÿæˆé‡‡ç”¨æ¶ˆæ¯é˜Ÿåˆ—æœºåˆ¶è¿›è¡Œå¤„ç†ï¼Œä¸»è¦æ˜¯å› ä¸º TTS æ¥å£å­˜åœ¨è¾ƒé«˜çš„è¯·æ±‚å¹¶å‘ã€‚é€šè¿‡ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæˆ‘ä»¬ç¡®ä¿æ¯æ¬¡åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œä»è€Œé¿å…äº†å¹¶å‘è¯·æ±‚å¯¹ç³»ç»Ÿæ€§èƒ½çš„å½±å“ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61f9408866724ec2b53a41cff6fe1532~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340967&amp;x-signature=OYn%2FYzwrvM2CFO3TcFD2Wo07Nfg%3D" alt="20250923163214" loading="lazy"/></p>
<h2 data-id="heading-7">åŠŸèƒ½å±•ç¤º</h2>
<h3 data-id="heading-8">ååŒç¼–è¾‘</h3>
<p>ååŒç¼–è¾‘æˆ‘ä»¬å¯ä»¥å†æ–‡æ¡£è¿™é‡Œç‚¹å‡»æ–‡ä»¶è¿›è¡Œåˆ†äº«ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®æ–‡ä»¶çš„æƒé™ä»¥åŠæ˜¯å¦éœ€è¦å¯†ç ç­‰ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/268079e703b747b98a6740683a076a7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340967&amp;x-signature=6bat0oIBr2IGHmARjkdoLlQ33y8%3D" alt="20250923174959" loading="lazy"/></p>
<p>ä¹‹åå¯ä»¥å°†è¿™ä¸ª URL åˆ†äº«ç»™å…¶ä»–ç”¨æˆ·ï¼Œç‚¹å‡»ä¹‹åä¼šæœ‰è¿™æ ·çš„æ•ˆæœï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a2a5660df5a49ab99276ed3f57bd504~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340967&amp;x-signature=jc6IleveeFlQfBdzeT3PQC7tz4Y%3D" alt="20250923175045" loading="lazy"/></p>
<p>è¿™ä¸ªåŠŸèƒ½è·Ÿç™¾åº¦ç½‘ç›˜ä¹‹ç±»çš„åˆ†äº«ç±»ä¼¼ï¼Œè¿™é‡Œçš„ä¸»è¦ä½¿ç”¨äº† RBAC å’Œ ACL è¿›è¡Œæƒé™æ§åˆ¶ã€‚</p>
<p>ä¹‹åæˆ‘ä»¬å°±å¯ä»¥è¿›è¡ŒååŒç¼–è¾‘äº†ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aedcf6842f7442adb742e63b8999e8e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340967&amp;x-signature=jaAk2nngFKNFXrKxLtP2nHzHzHk%3D" alt="output.gif" loading="lazy"/></p>
<h3 data-id="heading-9">AI ç»­å†™å’Œ AI é—®ç­”</h3>
<p>AI ç»­å†™å’Œ AI é—®ç­”çš„åŠŸèƒ½æ­£åœ¨é€æ­¥å®ç°ï¼Œç›®å‰ä»¥åŠæ”¯æŒ RAG äº†ï¼Œå…ˆçœ‹æ•ˆæœï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34f061b856c349cdadc722a0c9d4ab39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340967&amp;x-signature=AfTsVdhH2PhlPJdsWqaprUDvZZk%3D" alt="continue.gif" loading="lazy"/></p>
<p>ä¸Šé¢çš„æ˜¯ç»­å†™çš„ï¼Œæ¥ä¸‹æ¥å±•ç¤º AI é—®ç­”çš„ï¼Œé¦–å…ˆæˆ‘ä»¬å¯ä»¥ä¸Šä¼ æˆ‘ä»¬è‡ªå·±çš„ä¸€äº›å†…å®¹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ec71db6892c4f3d889a31052089fdc0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340967&amp;x-signature=rjPizlOpDDlXpL3zm1NKkYIZqoQ%3D" alt="20250923182314" loading="lazy"/></p>
<p>ä¹‹åæˆ‘ä»¬æ‰§è¡Œ AI é—®ç­”ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25e04abf36414adcbd4972c795ae604f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340967&amp;x-signature=xtYPv%2FqGFA8NwXfX%2FCdZDTnKk5A%3D" alt="20250923182418" loading="lazy"/></p>
<p>ä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ·»åŠ çš„å†…å®¹è¢«æˆ‘ä»¬è¾“å‡ºåˆ°äº†è¿™é‡Œäº†ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬å½“å‰çš„ RAG çš„åŠŸèƒ½ï¼Œå½“ç„¶åç»­ä¼šç»§ç»­å¢å¼ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70bd0fd961d346009265538bd12446a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340967&amp;x-signature=WYGAscg5Ym1y3WnuShzabbi00fA%3D" alt="20250923182554" loading="lazy"/></p>
<p>ä»–çš„åŸç†å¦‚ä¸‹æµç¨‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1aa164498134d7ca1e138e44dfadb39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340967&amp;x-signature=hHBlonBxbC%2Fmpln3o6xjAIIYObw%3D" alt="image.png" loading="lazy"/></p>
<p>ä»æ–‡æ¡£å¤„ç†è§’åº¦æ¥çœ‹ï¼Œå®ç°æµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3709c07259544ada985fd43ee5640542~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340967&amp;x-signature=LApUV4R4An6pu04fuFc%2F56tVCjc%3D" alt="20250923183138" loading="lazy"/></p>
<h3 data-id="heading-10">AI æ’­å®¢</h3>
<p>AI æ’­å®¢å¤„ç†æµç¨‹æ˜¯ç”¨æˆ·ä¸Šä¼ ç®€å†å’Œé€‰æ‹©ç›¸å¯¹åº”çš„é¢è¯•å®˜ï¼Œä½†æ˜¯æœ€å¥½æ˜¯ç›¸åŒç®€å†å¯¹åº”é¢è¯•å®˜ç±»å‹ï¼Œä¸ç„¶å¯èƒ½ç”Ÿæˆå‡ºæ¥çš„å†…å®¹ä¹±ä¸ƒå…«ç³Ÿçš„ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3724a28049644525b0f0f8cbe0bda515~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340967&amp;x-signature=CxZUjh6LtnI6h87Gw72%2Fh29LFm4%3D" alt="20250923183508" loading="lazy"/></p>
<h3 data-id="heading-11">å…¶ä»–</h3>
<p>å…³äºç¼–è¾‘å™¨é‡Œé¢è¿˜æœ‰å¾ˆå¤šå†…å®¹æ²¡æœ‰ä»‹ç»åˆ°ï¼Œæ›´å¤šçš„å¯è‡ªè¡Œä½“éªŒ:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/735843b624ec4454963873465b7404ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340967&amp;x-signature=3eZbFrtUsiJ9v%2FdKBc3eXVx0BVE%3D" alt="20250923183627" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04ef7ba8aa0e42d8b72b454ce75a45c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340967&amp;x-signature=n%2Bg162vDDQBtjA20mKyQxr4f4Bo%3D" alt="20250923183658" loading="lazy"/></p>
<p>åç»­ä¼šç»§ç»­å¢å¼ºï¼Œæ·»åŠ å¯¼å…¥å¯¼å‡ºç­‰åŠŸèƒ½ã€‚</p>
<h2 data-id="heading-12">æœªæ¥</h2>
<p>å°†æ¥è¦åšçš„å†…å®¹éå¸¸æ ¸å¿ƒï¼Œä¾‹å¦‚ä¾§è¾¹æ è¿™è¾¹çš„ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f0e6e9a0fee4ddb92a84540602f036c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340967&amp;x-signature=qIAxFFo%2FpJo7GmJDt6I23OpX530%3D" alt="20250923183820" loading="lazy"/></p>
<p>é™¤äº†å‰é¢è®²äº†è¿™è¿™äº› Agent å’Œæµç¨‹ç¼–æ’ï¼Œå°†æ¥è¿˜ä¼šå®ç°å¦‚ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š</p>
<ol>
<li>
<p>æ·»åŠ ç»„ç»‡ï¼Œå¢å¼ºæƒé™ç®¡ç†ã€‚</p>
</li>
<li>
<p>å¯¹åº”æ–‡æ¡£æ”¯æŒè¯„è®ºåŠŸèƒ½</p>
</li>
<li>
<p>æ¥å…¥ Sentry åŸ‹ç‚¹ç›‘æ§</p>
</li>
<li>
<p>åç«¯æ¥å…¥ Prometheus ç›‘æ§</p>
</li>
</ol>
<h2 data-id="heading-13">æ€»ç»“</h2>
<p>å¦‚æœä½ å¯¹ AI åº”ç”¨ä¸å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ç”Ÿæ€æ„Ÿå…´è¶£ï¼Œæ¬¢è¿ä¸ºæœ¬ä»“åº“ç‚¹äº® Star å¹¶å¼€å¯ Watchï¼Œè·å–æœ€æ–°è¿­ä»£ã€‚</p>
<p>å¸Œæœ›äº†è§£æ›´å¤šæœåŠ¡ï¼ˆä¼ä¸šå’¨è¯¢ã€æ’ä»¶å®šåˆ¶ã€å‚ä¸å¼€å‘ã€ç§æœ‰åŒ–éƒ¨ç½²ç­‰ï¼‰ï¼Œè¯·æ·»åŠ å¾®ä¿¡ <code>yunmz777</code>ï¼ˆå¤‡æ³¨ï¼šDocFlowï¼‰ã€‚æˆ‘å°†é‚€è¯·ä½ è¿›å…¥æŠ€æœ¯äº¤æµç¾¤ï¼Œä¸ä¸€çº¿å¼€å‘è€…äº¤æµå®è·µç»éªŒã€è·å–è·¯çº¿å›¾ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxun082%2FDocFlow" target="_blank" title="https://github.com/xun082/DocFlow" ref="nofollow noopener noreferrer">Github åœ°å€</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.codecrack.cn%2F" target="_blank" title="https://www.codecrack.cn/" ref="nofollow noopener noreferrer">åœ¨çº¿é¢„è§ˆ</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æˆ‘ç”¨AIé‡æ„äº†ä¸€æ®µ500è¡Œçš„å±å±±ä»£ç ï¼Œè¿™æ˜¯æˆ‘çš„Promptå’Œæ€è€ƒè¿‡ç¨‹]]></title>    <link>https://juejin.cn/post/7570630923710054452</link>    <guid>https://juejin.cn/post/7570630923710054452</guid>    <pubDate>2025-11-10T04:06:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570630923710054452" data-draft-id="7570533058840739875" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æˆ‘ç”¨AIé‡æ„äº†ä¸€æ®µ500è¡Œçš„å±å±±ä»£ç ï¼Œè¿™æ˜¯æˆ‘çš„Promptå’Œæ€è€ƒè¿‡ç¨‹"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,æ¶æ„"/> <meta itemprop="datePublished" content="2025-11-10T04:06:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ErpanOmer"/> <meta itemprop="url" content="https://juejin.cn/user/3878732754331096"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æˆ‘ç”¨AIé‡æ„äº†ä¸€æ®µ500è¡Œçš„å±å±±ä»£ç ï¼Œè¿™æ˜¯æˆ‘çš„Promptå’Œæ€è€ƒè¿‡ç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3878732754331096/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ErpanOmer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T04:06:06.000Z" title="Mon Nov 10 2025 04:06:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb98623d8769476daf7d1403c737a111~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763352366&amp;x-signature=Hvk6BXnS9P%2BYX5MAILrp0denCkI%3D" alt="image.png" loading="lazy"/></p>
<p>å¤§å®¶å¥½ï¼Œæˆ‘æ¥äº†ğŸ™‚ã€‚</p>
<p>æˆ‘ä»¬å›¢é˜Ÿï¼Œç»´æŠ¤ç€ä¸€ä¸ªæœ‰5å¹´å†å²çš„å²è¯—çº§ä¸­åå°é¡¹ç›®ğŸ˜–ã€‚åœ¨è¿™åº§å±å±±é‡Œï¼Œæœ‰ä¸€ä¸ªå«<code>handleOrderSubmit.js</code>çš„æ–‡ä»¶ã€‚</p>
<p>å¯ä»¥ä¸‹è½½ç§ä¸€ç§ æœ‰å¤šå±ğŸ‘‰ <a href="https://link.juejin.cn?target=https%3A%2F%2Fpub-e8cc0cb9ebf94a2386b76f4ac3ac6ad2.r2.dev%2FhandleOrderSubmit.js" target="_blank" title="https://pub-e8cc0cb9ebf94a2386b76f4ac3ac6ad2.r2.dev/handleOrderSubmit.js" ref="nofollow noopener noreferrer">handleOrderSubmit.js</a></p>
<p>å®ƒæ˜¯ä¸€ä¸ª<strong>é•¿è¾¾500å¤šè¡Œ</strong>çš„React <code>useEffect</code> é’©å­å‡½æ•°ï¼ˆæ˜¯çš„ï¼Œä½ æ²¡çœ‹é”™ï¼Œä¸€ä¸ª<code>useEffect</code>ï¼‰ã€‚</p>
<p>å®ƒæ··åˆäº†è®¢å•æ•°æ®çš„<strong>æœ¬åœ°æ ¡éªŒ</strong>ã€<strong>ä»·æ ¼è®¡ç®—</strong>ã€<strong>ä¼˜æƒ åˆ¸åº”ç”¨</strong>ã€<strong>APIè¯·æ±‚</strong>ã€<strong>å…¨å±€çŠ¶æ€æ›´æ–°</strong>ã€ä»¥åŠ<strong>é”™è¯¯å¼¹çª—å¤„ç†</strong>... æ‰€æœ‰çš„é€»è¾‘ï¼Œéƒ½å¡åœ¨ä¸€ä¸ªå‡½æ•°é‡Œï¼Œç”¨<code>if/else</code>å’Œ<code>try/catch</code>å±‚å±‚åµŒå¥—ã€‚</p>
<p><strong>æ²¡äººæ•¢åŠ¨å®ƒğŸ˜–ã€‚</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40160288790c4322a54fa4ec39e1a6ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763352366&amp;x-signature=p9brzeAHElowFo7kT0xLwhguEpE%3D" alt="æœ¬äº‹è¯•è¯•çœ‹.gif" loading="lazy"/></p>
<p>æ¯æ¬¡äº§å“ç»ç†æä¸€ä¸ªå°éœ€æ±‚ï¼Œæ¯”å¦‚åœ¨æäº¤è®¢å•æ—¶ï¼Œå¢åŠ ä¸€ç§æ–°çš„ä¼˜æƒ åˆ¸ç±»å‹ï¼Œæˆ‘ä»¬æ•´ä¸ªå›¢é˜Ÿçš„è¡¨æƒ…éƒ½åƒè¢«é›·åŠˆäº†ã€‚å› ä¸ºæˆ‘ä»¬çŸ¥é“ï¼Œæ”¹è¿™ä¸ªå‡½æ•°ï¼Œè¦ä¹ˆåŠ ç­ä¸€å‘¨ï¼Œè¦ä¹ˆå°±ç­‰ç€P0çº§äº‹æ•…ã€‚</p>
<p>ä¸Šå‘¨ï¼Œäº§å“ç»ç†è¦æ±‚æˆ‘ä»¬åœ¨è¿™ä¸ªå‡½æ•°é‡Œï¼ŒåŠ å…¥ä¸€ä¸ªå…¨æ–°çš„é£æ§é€»è¾‘ã€‚</p>
<p>æˆ‘è¯„ä¼°äº†ä¸€ä¸‹ï¼Œæ‰‹åŠ¨é‡æ„ï¼Œè‡³å°‘éœ€è¦ä¸€ä¸ªèµ„æ·±å·¥ç¨‹å¸ˆä¸€å‘¨çš„æ—¶é—´ï¼Œè€Œä¸”é£é™©æå¤§ã€‚</p>
<p>æˆ‘å—å¤Ÿäº†ã€‚æˆ‘å†³å®šï¼ŒæŠŠè¿™ä¸ªçƒ«æ‰‹çš„ä»»åŠ¡ï¼Œæ‰”ç»™æˆ‘çš„å®ä¹ ç”Ÿâ€”â€”<strong>AI</strong>ï¼ˆæˆ‘ç”¨çš„æ˜¯GPT-5 miniï¼Œç©·ğŸ˜‚ï¼‰ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« ï¼Œå°±æ˜¯æˆ‘äººæœºåä½œï¼Œå•ƒä¸‹è¿™å—ç¡¬éª¨å¤´çš„å®Œæ•´å¤ç›˜ï¼Œå¤§å®¶ç»§ç»­çœ‹ã€‚</p>
<hr/>
<h4 data-id="heading-0"><strong>æˆ‘ä¸èƒ½ç›´æ¥è¯´é‡æ„å®ƒ</strong></h4>
<p>æˆ‘çŠ¯çš„ç¬¬ä¸€ä¸ªé”™è¯¯ï¼Œæ˜¯ç›´æ¥æŠŠ500è¡Œä»£ç è´´ç»™AIï¼Œç„¶åè¯´ï¼š<strong>å¸®æˆ‘é‡æ„è¿™æ®µä»£ç </strong>ã€‚</p>
<p>AIå¾ˆå¬è¯ï¼Œå®ƒç»™æˆ‘çš„ï¼Œæ˜¯ä¸€æ®µçœ‹èµ·æ¥æ›´æ•´æ´çš„ä»£ç â€”â€”å®ƒæŠŠ<code>if/else</code>æ¢æˆäº†<code>switch</code>ï¼Œæäº†å‡ ä¸ªå˜é‡... <strong>è¿™ä¸å«é‡æ„ï¼Œè¿™å«é‡æ–°æ’ç‰ˆ</strong>ï¼Œæ¯«æ— æ„ä¹‰ã€‚</p>
<p>æˆ‘å¾ˆå¿«æ„è¯†åˆ°ï¼š<strong>AIæ˜¯ä¸€ä¸ªèƒ½åŠ›è¶…å¼ºã€ä½†æ²¡æœ‰çµé­‚çš„æ‰§è¡Œè€…ã€‚æˆ‘ï¼Œä½œä¸ºå¼€å‘è€…ï¼Œå¿…é¡»ç»™å®ƒæä¾›ä¸€ä¸ªæ¸…æ™°çš„æ–¹æ¡ˆã€‚</strong></p>
<p>äºæ˜¯ï¼Œæˆ‘åˆ¶å®šäº†ä¸€ä¸ª<strong>äº”æ­¥é‡æ„æ³•</strong>ã€‚</p>
<hr/>
<h4 data-id="heading-1"><strong>æˆ‘çš„Promptå’Œæ€è€ƒ</strong></h4>
<p>æˆ‘çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>AIè´Ÿè´£æ‰§è¡Œï¼Œæˆ‘è´Ÿè´£å†³ç­–ã€‚</strong> æˆ‘è¦åƒä¸€ä¸ªæŒ‡æŒ¥å®¶ä¸€æ ·ï¼Œä¸€æ­¥ä¸€æ­¥åœ°å¼•å¯¼AIï¼ŒæŠŠè¿™500è¡Œçš„ä»£ç ï¼Œæ‹†è§£æˆé«˜å†…èšã€ä½è€¦åˆçš„æ¨¡å—ã€‚</p>
<h5 data-id="heading-2"><strong>ç¬¬ä¸€æ­¥ï¼šå…ˆè®©AIè¯»æ‡‚å±å±±</strong></h5>
<p>æˆ‘ä¸èƒ½ä¸Šæ¥å°±è®©AIæ”¹ã€‚æˆ‘å¾—å…ˆç¡®è®¤ï¼Œå®ƒå’Œæˆ‘å¯¹è¿™æ®µä»£ç çš„ç†è§£ï¼Œåœ¨ä¸€ä¸ªé¢‘é“ä¸Šã€‚</p>
<p><strong>Promptï¼š</strong></p>
<blockquote>
<p>ä½ æ˜¯ä¸€ä¸ªèµ„æ·±çš„Reactæ¶æ„å¸ˆã€‚è¯·åˆ†æä¸‹é¢è¿™æ®µ500è¡Œçš„<code>useEffect</code>ä»£ç ã€‚</p>
<ol>
<li><strong>å‘Šè¯‰æˆ‘å®ƒåšäº†å‡ ä»¶ä¸»è¦çš„äº‹æƒ…ï¼Ÿï¼ˆèŒè´£åˆ†æï¼‰</strong></li>
<li><strong>æ‰¾å‡ºæ‰€æœ‰çš„å‰¯ä½œç”¨</strong>ï¼ˆæ¯”å¦‚APIè¯·æ±‚ã€<code>localStorage</code>æ“ä½œã€å…¨å±€çŠ¶æ€æ›´æ–°ï¼‰ã€‚</li>
<li><strong>æ‰¾å‡ºæ‰€æœ‰çš„çº¯é€»è¾‘</strong>ï¼ˆæ¯”å¦‚æ•°æ®æ ¡éªŒã€ä»·æ ¼è®¡ç®—ï¼‰ã€‚</li>
<li><strong>è¯„ä»·å®ƒçš„å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§</strong>ã€‚</li>
</ol>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35d5a1e7897d4611b2e6063d63081384~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763352366&amp;x-signature=aXLE5rLPbGHmYg3X5B3MvGtaHaM%3D" alt="image.png" loading="lazy"/></p>
<p>GPTçš„å›ç­”ï¼Œç»™äº†æˆ‘ä¸€ä¸ªæƒŠå–œã€‚å®ƒæ¸…æ™°åœ°åˆ—å‡ºäº†ï¼š</p>
<ol>
<li><strong>èŒè´£</strong>ï¼šå®ƒæ‰¿æ‹…äº†è‡³å°‘5ä¸ªèŒè´£ï¼šè¡¨å•æ ¡éªŒã€ä»·æ ¼è®¡ç®—ã€åº“å­˜æ£€æŸ¥ã€åˆ›å»ºè®¢å•ã€å¤„ç†UIåé¦ˆã€‚</li>
<li><strong>å‰¯ä½œç”¨</strong>ï¼š<code>api.post(...)</code>, <code>setLoading(true)</code>, <code>showToast(...)</code>...</li>
<li><strong>çº¯é€»è¾‘</strong>ï¼š<code>validateForm(...)</code>, <code>calculateTotalPrice(...)</code>...</li>
<li><strong>è¯„ä»·</strong>ï¼šå¯ç»´æŠ¤æ€§æä½ï¼Œå•ä¸€èŒè´£åŸåˆ™è¢«ä¸¥é‡è¿åï¼Œå‡ ä¹ä¸å¯æµ‹è¯•ã€‚</li>
</ol>
<p>å¾ˆå¥½ï¼ŒAIçœ‹æ‡‚äº†ï¼æˆ‘ä»¬å°±å¯ä»¥å¯ä»¥å¼€å§‹äº†ğŸ˜ã€‚</p>
<h5 data-id="heading-3"><strong>ç¬¬äºŒæ­¥ï¼šå…ˆåˆ†ç¦»çº¯é€»è¾‘ä»£ç </strong></h5>
<p>è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ã€‚æˆ‘è¦æŠŠè®¡ç®—å’ŒåŠ¨ä½œåˆ†å¼€ã€‚</p>
<p><strong>Promptï¼š</strong></p>
<blockquote>
<p>éå¸¸å¥½ã€‚ç°åœ¨ï¼Œè¯·ä½ <strong>åªé’ˆå¯¹çº¯é€»è¾‘éƒ¨åˆ†</strong>ï¼ˆè¡¨å•æ ¡éªŒã€ä»·æ ¼è®¡ç®—ï¼‰è¿›è¡Œé‡æ„ã€‚</p>
<ol>
<li>æŠŠè¿™äº›é€»è¾‘ï¼Œä»åŸå‡½æ•°ä¸­<strong>æå–</strong>å‡ºæ¥ï¼Œå˜æˆ<strong>ç‹¬ç«‹çš„ã€å¯å¯¼å‡ºçš„çº¯å‡½æ•°</strong>ã€‚</li>
<li>è¿™äº›å‡½æ•°å¿…é¡»æ˜¯çº¯çš„ï¼š<strong>ä¸èƒ½æœ‰ä»»ä½•å‰¯ä½œç”¨</strong>ï¼ˆä¸èƒ½è°ƒç”¨<code>api</code>æˆ–<code>setLoading</code>ï¼‰ã€‚</li>
<li><strong>ä½¿ç”¨TypeScript</strong>ï¼Œä¸ºè¿™äº›æ–°å‡½æ•°çš„å…¥å‚å’Œè¿”å›å€¼ï¼Œæä¾›æ¸…æ™°çš„ç±»å‹å®šä¹‰ã€‚</li>
</ol>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d384affa5b6b488db2870ea7a7f2e350~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763352366&amp;x-signature=yC3uRhUdQgDBQbR2mBv1aKp6ZuM%3D" alt="image.png" loading="lazy"/></p>
<p>AIç«‹åˆ»å”°å”°å”°åœ°ç»™äº†æˆ‘å‡ ä¸ªæ–‡ä»¶ï¼š</p>
<p><code>validate.ts</code>:</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">validateOrder</span>(<span class="hljs-params">formData: OrderForm</span>): <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> {
  <span class="hljs-keyword">if</span> (!formData.<span class="hljs-property">user</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'ç”¨æˆ·ä¿¡æ¯ä¸èƒ½ä¸ºç©º'</span>;
  <span class="hljs-keyword">if</span> (formData.<span class="hljs-property">items</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'å•†å“ä¸èƒ½ä¸ºç©º'</span>;
  <span class="hljs-comment">// ... 10 more rules</span>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<p><code>calculator.ts</code>:</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">calculateTotalPrice</span>(<span class="hljs-params">items: Item[], coupon: Coupon</span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">let</span> total = items.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, item</span>) =&gt;</span> sum + item.<span class="hljs-property">price</span> * item.<span class="hljs-property">quantity</span>, <span class="hljs-number">0</span>);
  <span class="hljs-keyword">if</span> (coupon.<span class="hljs-property">type</span> === <span class="hljs-string">'PERCENT'</span>) {
    total *= (<span class="hljs-number">1</span> - coupon.<span class="hljs-property">value</span> / <span class="hljs-number">100</span>);
  }
  <span class="hljs-comment">// ... 20 more rules</span>
  <span class="hljs-keyword">return</span> total;
}
</code></pre>
<h5 data-id="heading-4"><strong>ç¬¬ä¸‰æ­¥ï¼šè®©AIä¸ºè‡ªå·±çš„ä»£ç åšæµ‹è¯•</strong></h5>
<p>æˆ‘æ€ä¹ˆçŸ¥é“AIæç‚¼çš„é€»è¾‘ï¼Œæ˜¯å¯¹çš„è¿˜æ˜¯é”™çš„ï¼Ÿ
<strong>ç­”æ¡ˆï¼šè®©å®ƒè‡ªå·±å†™å•å…ƒæµ‹è¯•æ¥è¯æ˜ã€‚</strong></p>
<p><strong>Promptï¼š</strong></p>
<blockquote>
<p>ä½ ç°åœ¨æ˜¯ä¸€ä¸ªQAå·¥ç¨‹å¸ˆã€‚è¯·ä½¿ç”¨<code>Vitest</code>ï¼Œä¸ºä½ åˆšæ‰æå–çš„<code>validateOrder</code>å’Œ<code>calculateTotalPrice</code>è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œ<strong>ç¼–å†™å…¨é¢çš„å•å…ƒæµ‹è¯•ç”¨ä¾‹</strong>ã€‚
å¿…é¡»è¦†ç›–æ‰€æœ‰è¾¹ç•Œæƒ…å†µï¼ŒåŒ…æ‹¬æ­£å¸¸ã€å¼‚å¸¸ã€å’Œè¾¹ç¼˜å€¼ã€‚</p>
</blockquote>
<p>AIå†æ¬¡ç»™äº†æˆ‘æƒŠå–œã€‚å®ƒç”Ÿæˆçš„æµ‹è¯•ç”¨ä¾‹ï¼Œæ¯”æˆ‘æ‰‹å†™çš„è¿˜è¦å…¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// calculator.test.ts</span>
<span class="hljs-keyword">import</span> { describe, it, expect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vitest'</span>;
<span class="hljs-keyword">import</span> { calculateTotalPrice } <span class="hljs-keyword">from</span> <span class="hljs-string">'./calculator'</span>;

<span class="hljs-title function_">describe</span>(<span class="hljs-string">'calculateTotalPrice'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'should return 0 for empty cart'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">expect</span>(<span class="hljs-title function_">calculateTotalPrice</span>([], <span class="hljs-literal">null</span>)).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">0</span>);
  });
  
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'should apply percent coupon'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> items = [{ <span class="hljs-attr">price</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-number">1</span> }];
    <span class="hljs-keyword">const</span> coupon = { <span class="hljs-attr">type</span>: <span class="hljs-string">'PERCENT'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">10</span> };
    <span class="hljs-title function_">expect</span>(<span class="hljs-title function_">calculateTotalPrice</span>(items, coupon)).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">90</span>);
  });
  <span class="hljs-comment">// ... çœç•¥æ›´å¤š</span>
});
</code></pre>
<p>æˆ‘æŠŠè¿™äº›æµ‹è¯•ç”¨ä¾‹è·‘äº†ä¸€éï¼Œ<strong>å…¨éƒ¨é€šè¿‡</strong>ã€‚æˆ‘ç°åœ¨ä¿¡å¿ƒå¤§å¢ğŸ˜ã€‚</p>
<h5 data-id="heading-5"><strong>ç¬¬å››æ­¥ï¼šé‡å†™åè°ƒå±‚</strong></h5>
<p>ç°åœ¨ï¼Œçº¯é€»è¾‘å·²ç»è¢«åˆ†ç¦»å¹¶éªŒè¯äº†ã€‚åŸæ¥çš„500è¡Œå±å±±ï¼Œåªå‰©ä¸‹å‰¯ä½œç”¨å’Œæµç¨‹æ§åˆ¶ä»£ç äº†ã€‚æ˜¯æ—¶å€™é‡å†™å®ƒäº†ã€‚</p>
<p><strong>Promptï¼š</strong></p>
<blockquote>
<p>å¹²å¾—æ¼‚äº®ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥é‡æ„é‚£ä¸ª<strong>åŸå§‹çš„<code>useEffect</code>å‡½æ•°</strong>ã€‚</p>
<ol>
<li>å®ƒç°åœ¨å”¯ä¸€çš„èŒè´£æ˜¯<strong>åè°ƒ</strong>ã€‚</li>
<li><strong>è°ƒç”¨</strong>æˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„<code>validateOrder</code>å’Œ<code>calculateTotalPrice</code>çº¯å‡½æ•°ã€‚</li>
<li>æŠŠæ‰€æœ‰çš„å‰¯ä½œç”¨ï¼ˆAPIè¯·æ±‚ã€<code>setLoading</code>ã€<code>showToast</code>ï¼‰<strong>æ¸…æ™°åœ°ç¼–æ’</strong>èµ·æ¥ã€‚</li>
<li><strong>ä½¿ç”¨<code>async/await</code></strong>ï¼Œè®©å¼‚æ­¥æµç¨‹æ›´æ¸…æ™°ï¼Œç”¨<code>try/catch</code>å¤„ç†é”™è¯¯ã€‚</li>
</ol>
</blockquote>
<p>è¿™æ¬¡ï¼ŒAIç»™æˆ‘çš„ï¼Œæ˜¯ä¸€ä¸ªåªæœ‰<strong>30è¡Œ</strong>å·¦å³çš„ã€æ¸…æ™°çš„æµç¨‹ä»£ç ï¼š</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// é‡æ„åçš„ useEffect</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">submitOrder</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 1. åè°ƒï¼šéªŒè¯ (çº¯)</span>
      <span class="hljs-keyword">const</span> errorMsg = <span class="hljs-title function_">validateOrder</span>(formData);
      <span class="hljs-keyword">if</span> (errorMsg) {
        <span class="hljs-title function_">showToast</span>(errorMsg);
        <span class="hljs-keyword">return</span>;
      }
      
      <span class="hljs-comment">// 2. åè°ƒï¼šè®¡ç®— (çº¯)</span>
      <span class="hljs-keyword">const</span> totalPrice = <span class="hljs-title function_">calculateTotalPrice</span>(formData.<span class="hljs-property">items</span>, formData.<span class="hljs-property">coupon</span>);

      <span class="hljs-comment">// 3. åè°ƒï¼šå‰¯ä½œç”¨ï¼ˆä¸çº¯ï¼‰</span>
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/order/submit'</span>, { ...formData, totalPrice });
      
      <span class="hljs-comment">// 4. åè°ƒï¼šå“åº”ï¼ˆä¸çº¯ï¼‰</span>
      <span class="hljs-keyword">if</span> (result.<span class="hljs-property">code</span> === <span class="hljs-number">200</span>) {
        <span class="hljs-title function_">showToast</span>(<span class="hljs-string">'è®¢å•æäº¤æˆåŠŸï¼'</span>);
        router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/success'</span>);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title function_">showToast</span>(result.<span class="hljs-property">message</span>);
      }
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-title function_">showToast</span>(err.<span class="hljs-property">message</span>);
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
    }
  };

  <span class="hljs-keyword">if</span> (isSubmitting) { <span class="hljs-comment">// å‡è®¾ä¸€ä¸ªè§¦å‘æ¡ä»¶</span>
    <span class="hljs-title function_">submitOrder</span>();
    <span class="hljs-title function_">setIsSubmitting</span>(<span class="hljs-literal">false</span>);
  }
}, [isSubmitting, formData <span class="hljs-comment">/* ...å…¶ä»–ä¾èµ– */</span>]);
</code></pre>
<h5 data-id="heading-6"><strong>ç¬¬äº”æ­¥ï¼šæœ€åå®ˆå«å·¥ä½œï¼ŒåŠ å…¥æ–°åŠŸèƒ½</strong></h5>
<p>åˆ«å¿˜äº†ï¼Œæˆ‘é‡æ„çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†åŠ é£æ§è¿™ä¸ªæ–°åŠŸèƒ½ã€‚</p>
<p><strong>Promptï¼š</strong></p>
<blockquote>
<p>æœ€åä¸€æ­¥ã€‚è¯·åœ¨APIè¯·æ±‚ä¹‹å‰ï¼ŒåŠ å…¥ä¸€ä¸ªé£æ§æ£€æŸ¥çš„é€»è¾‘ï¼ˆè°ƒç”¨<code>riskControl.check(...)</code>ï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œå¦‚æœæ£€æŸ¥ä¸é€šè¿‡ï¼Œå®ƒä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</p>
</blockquote>
<p>AIåœ¨ç¬¬2æ­¥å’Œç¬¬3æ­¥ä¹‹é—´ï¼ŒåŠ äº†å‡ è¡Œä»£ç ï¼Œå®Œç¾æ”¶å·¥ã€‚</p>
<hr/>
<p>è¿™æ¬¡é‡æ„ï¼Œæˆ‘æ€»å…±èŠ±äº†å¤§æ¦‚5ä¸ªå°æ—¶ï¼Œè€Œä¸æ˜¯åŸè®¡åˆ’çš„ä¸€å‘¨ã€‚</p>
<p>æ€»è§‰å¾— AI ä¸ä¼šæ·˜æ±°ä¼šå†™ä»£ç çš„å·¥ç¨‹å¸ˆã€‚</p>
<p>åªä¼šé™ç»´æ‰“å‡»é‚£äº›åªä¼šå †ç Œä»£ç çš„å·¥ç¨‹å¸ˆã€‚</p>
<p>é‚£æ®µ500è¡Œçš„å±å±±ï¼Œåœ¨è¿‡å»ï¼Œæ˜¯æˆ‘çš„å™©æ¢¦ï¼›ç°åœ¨ï¼Œæœ‰äº†AIçš„å¸®åŠ©ï¼Œå®ƒå˜æˆäº†æˆ‘çš„é¶åœºã€‚</p>
<p>è¿™ç§æ„Ÿè§‰ï¼ŒçœŸçˆ½ğŸ™Œã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot 2.x å’Œ 3.x çš„æ ¸å¿ƒåŒºåˆ«ï¼Œè¿™äº›å˜åŒ–ä½ å¿…é¡»çŸ¥é“]]></title>    <link>https://juejin.cn/post/7570191839593332799</link>    <guid>https://juejin.cn/post/7570191839593332799</guid>    <pubDate>2025-11-10T00:34:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570191839593332799" data-draft-id="7564573165705216015" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot 2.x å’Œ 3.x çš„æ ¸å¿ƒåŒºåˆ«ï¼Œè¿™äº›å˜åŒ–ä½ å¿…é¡»çŸ¥é“"/> <meta itemprop="keywords" content="åç«¯,Java,Spring Boot"/> <meta itemprop="datePublished" content="2025-11-10T00:34:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åˆ˜å¤§å"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot 2.x å’Œ 3.x çš„æ ¸å¿ƒåŒºåˆ«ï¼Œè¿™äº›å˜åŒ–ä½ å¿…é¡»çŸ¥é“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åˆ˜å¤§å
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T00:34:08.000Z" title="Mon Nov 10 2025 00:34:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å‰è¨€</h3>
<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¤§åï¼æœ‰å¾ˆå¤šæœ‹å‹ä¸çŸ¥é“<code>Springboot2.xå’Œ3.x</code>æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œç”¨ç€æ„Ÿè§‰éƒ½å·®ä¸å¤šã€‚å…¶å®3.xæ˜¯ä¸€ä¸ªé‡å¤§ç‰ˆæœ¬å‡çº§ã€‚</p>
<h4 data-id="heading-1">ä¸ºä»€ä¹ˆ Spring Boot 3.x è¿™ä¹ˆé‡è¦ï¼Ÿ</h4>
<p>å› ä¸ºå®ƒä¸ä»…ä»…æ˜¯åŠ äº†å‡ ä¸ªæ–°åŠŸèƒ½ï¼Œè€Œæ˜¯<strong>æ•´ä¸ªæŠ€æœ¯åœ°åŸºéƒ½å˜äº†</strong>ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬ä¸¾å‡ ä¸ªä¾‹å­æ¥äº†è§£ä¸€ä¸‹ã€‚</p>
<hr/>
<h3 data-id="heading-2">1. åŒ…åçš„æ›´æ–°ï¼š<code>javax</code> â†’ <code>jakarta</code></h3>
<p>è¿™æ˜¯2.xå‡çº§åˆ°3.xæ—¶ï¼Œ<strong>æ”¹åŠ¨æœ€å¤§çš„åœ°æ–¹</strong>ã€‚</p>
<h4 data-id="heading-3">Spring Boot 2.xï¼ˆè€ä»£ç ï¼‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.Id;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-comment">// getter/setter</span>
}
</code></pre>
<h4 data-id="heading-4">Spring Boot 3.xï¼ˆæ–°ä»£ç ï¼‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> jakarta.persistence.Entity;  <span class="hljs-comment">// æ³¨æ„ï¼šjavax â†’ jakarta</span>
<span class="hljs-keyword">import</span> jakarta.persistence.Id;
<span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletRequest; <span class="hljs-comment">// åŒæ ·å˜äº†</span>

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-comment">// getter/setter</span>
}
</code></pre>
<p><strong>åˆ’é‡ç‚¹</strong>ï¼š</p>
<ul>
<li>æ‰€æœ‰ <code>javax.*</code> éƒ½è¦æ”¹æˆ <code>jakarta.*</code>ï¼</li>
<li>å¦‚æœä½ ç”¨çš„æ˜¯ JPAã€Servletã€Validation ç­‰æŠ€æœ¯ï¼Œ<strong>å‡ ä¹æ¯ä¸ª Java æ–‡ä»¶éƒ½è¦æ”¹</strong>ã€‚</li>
<li>å»ºè®®ä½¿ç”¨ IDE çš„å…¨å±€æ›¿æ¢åŠŸèƒ½ï¼Œä½†è¦å°å¿ƒç¬¬ä¸‰æ–¹åº“æ˜¯å¦æ”¯æŒã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-5">2. å®‰å…¨é…ç½®</h3>
<p>Spring Boot 3.x é»˜è®¤ä½¿ç”¨ <strong>Spring Security 6</strong>ï¼Œé…ç½®æ–¹å¼å¤§å˜ã€‚</p>
<h4 data-id="heading-6">Spring Boot 2.x é…ç½®æ–¹å¼</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebSecurity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebSecurityConfigurerAdapter</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception {
        http
            .authorizeRequests()
                .antMatchers(<span class="hljs-string">"/public/**"</span>).permitAll()
                .anyRequest().authenticated()
            .and()
            .formLogin();
    }
}
</code></pre>
<p>æ³¨æ„ï¼š<code>WebSecurityConfigurerAdapter</code>åœ¨<code>Spring Security 6</code>ä¸­<strong>å·²è¢«åºŸå¼ƒ</strong>ï¼</p>
<h4 data-id="heading-7">Spring Boot 3.x æ¨èæ–¹å¼ï¼ˆä½¿ç”¨ Lambda DSLï¼‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebSecurity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConfig</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> SecurityFilterChain <span class="hljs-title function_">filterChain</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception {
        http
            .authorizeHttpRequests(authz -&gt; authz
                .requestMatchers(<span class="hljs-string">"/public/**"</span>).permitAll()
                .anyRequest().authenticated()
            )
            .formLogin(form -&gt; form
                .loginPage(<span class="hljs-string">"/login"</span>)
                .permitAll()
            );
        <span class="hljs-keyword">return</span> http.build();
    }
}
</code></pre>
<p><strong>å¥½å¤„</strong>ï¼š</p>
<ul>
<li>æ›´å‡½æ•°å¼ï¼Œä»£ç æ›´æ¸…æ™°ã€‚</li>
<li>ä¸ç”¨ç»§æ‰¿ï¼Œæ›´çµæ´»ã€‚</li>
<li>ç¼–è¯‘æ—¶å°±èƒ½å‘ç°é”™è¯¯ï¼Œè€Œä¸æ˜¯è¿è¡Œæ—¶æŠ¥é”™ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-8">3. åŸç”Ÿé•œåƒï¼ˆGraalVMï¼‰</h3>
<p>Spring Boot 3.x åŸç”Ÿæ”¯æŒ GraalVMï¼Œå¯ä»¥æŠŠ Java åº”ç”¨ç¼–è¯‘æˆ<strong>åŸç”Ÿå¯æ‰§è¡Œæ–‡ä»¶</strong>ã€‚</p>
<h4 data-id="heading-9">å¦‚ä½•å¯ç”¨åŸç”Ÿé•œåƒï¼Ÿ</h4>
<p>åœ¨ <code>pom.xml</code> ä¸­åŠ å…¥æ’ä»¶ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.graalvm.buildtools<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>native-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
</code></pre>
<p>ç„¶åè¿è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash">./mvnw -Pnative native:compile
</code></pre>
<p>ç¼–è¯‘å®Œæˆåï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ª<strong>ä¸ä¾èµ– JVM çš„å¯æ‰§è¡Œæ–‡ä»¶</strong>ï¼Œæ¯”å¦‚ <code>myapp</code>ã€‚</p>
<p>è¿è¡Œå®ƒï¼š</p>
<pre><code class="hljs language-bash" lang="bash">./myapp
</code></pre>
<p>ä½ ä¼šå‘ç°ï¼š</p>
<ul>
<li>å¯åŠ¨æ—¶é—´ï¼šä» 5 ç§’ â†’ <strong>0.1 ç§’</strong></li>
<li>å†…å­˜å ç”¨ï¼šä» 300MB â†’ <strong>50MB</strong></li>
</ul>
<p>ç‰¹åˆ«é€‚åˆï¼šServerlessã€å¾®æœåŠ¡ã€è¾¹ç¼˜è®¡ç®—ç­‰èµ„æºæ•æ„Ÿåœºæ™¯ã€‚</p>
<hr/>
<h3 data-id="heading-10">4. äº‘åŸç”Ÿæ”¯æŒï¼šLiveness å’Œ Readiness</h3>
<p>Spring Boot 3.x çš„å¥åº·æ£€æŸ¥æ›´ä¸“ä¸šï¼Œé€‚åˆ Kubernetesã€‚</p>
<h4 data-id="heading-11">é…ç½® <code>application.yml</code></h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">management:</span>
  <span class="hljs-attr">endpoint:</span>
    <span class="hljs-attr">health:</span>
      <span class="hljs-attr">show-details:</span> <span class="hljs-string">always</span>
  <span class="hljs-attr">endpoints:</span>
    <span class="hljs-attr">web:</span>
      <span class="hljs-attr">exposure:</span>
        <span class="hljs-attr">include:</span> <span class="hljs-string">health,info,liveness,readiness</span>
</code></pre>
<h4 data-id="heading-12">è®¿é—®æ–°ç«¯ç‚¹</h4>
<ul>
<li><code>GET /actuator/health/liveness</code> â†’ æ£€æŸ¥åº”ç”¨æ˜¯å¦â€œæ´»ç€â€ï¼ˆæ˜¯å¦å´©æºƒï¼‰</li>
<li><code>GET /actuator/health/readiness</code> â†’ æ£€æŸ¥åº”ç”¨æ˜¯å¦â€œå°±ç»ªâ€ï¼ˆæ˜¯å¦å¯ä»¥æ¥æ”¶æµé‡ï¼‰</li>
</ul>
<p>K8s å¯ä»¥ç”¨è¿™ä¸¤ä¸ªæ¥å£åšæ›´ç²¾å‡†çš„å¥åº·æ£€æŸ¥ï¼Œé¿å…è¯¯æ€æˆ–è¯¯å¯¼æµã€‚</p>
<hr/>
<h3 data-id="heading-13">é‚£æˆ‘ç°åœ¨è¯¥å‡çº§å—ï¼Ÿ</h3>
<p>çœ‹æƒ…å†µï¼åˆ†ä¸¤ç§ï¼š</p>
<h4 data-id="heading-14">æ¨èå‡çº§çš„æƒ…å†µï¼š</h4>
<ul>
<li><strong>æ–°é¡¹ç›®</strong>ï¼šç›´æ¥ä¸Š Spring Boot 3.x + Java 17ï¼</li>
<li><strong>æƒ³ç©åŸç”Ÿé•œåƒ</strong>ï¼šè¿½æ±‚æè‡´æ€§èƒ½å’Œå¯åŠ¨é€Ÿåº¦ã€‚</li>
<li><strong>äº‘åŸç”Ÿé¡¹ç›®</strong>ï¼šç”¨ K8sã€å¾®æœåŠ¡æ¶æ„ã€‚</li>
</ul>
<h4 data-id="heading-15">æš‚ç¼“å‡çº§çš„æƒ…å†µï¼š</h4>
<ul>
<li><strong>è¿˜åœ¨ç”¨ Java 8</strong>ï¼šå¿…é¡»å…ˆå‡çº§ JDKã€‚</li>
<li><strong>ä¾èµ–è€æ—§åº“</strong>ï¼šæ¯”å¦‚æŸäº›ä¸­é—´ä»¶ SDK è¿˜ä¸æ”¯æŒ <code>jakarta</code>ã€‚</li>
<li><strong>é¡¹ç›®ç¨³å®šï¼Œæ— å¤§æ”¹åŠ¨</strong>ï¼šå¯ä»¥ç­‰ä¸‹æ¬¡å¤§ç‰ˆæœ¬è¿­ä»£æ—¶å†å‡çº§ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-16">æ€»ç»“å¯¹æ¯”è¡¨</h3>








































<table><thead><tr><th>ç‰¹æ€§</th><th>Spring Boot 2.x</th><th>Spring Boot 3.x</th></tr></thead><tbody><tr><td><strong>æœ€ä½ Java ç‰ˆæœ¬</strong></td><td>Java 8</td><td><strong>Java 17</strong></td></tr><tr><td><strong>åŒ…å</strong></td><td><code>javax.*</code></td><td><code>jakarta.*</code></td></tr><tr><td><strong>åŸç”Ÿé•œåƒ</strong></td><td>ä¸æ”¯æŒ</td><td><strong>åŸç”Ÿæ”¯æŒ</strong></td></tr><tr><td><strong>Spring Security</strong></td><td>ç»§æ‰¿ <code>WebSecurityConfigurerAdapter</code></td><td>ä½¿ç”¨ <strong>DSL é…ç½®</strong></td></tr><tr><td><strong>äº‘åŸç”Ÿæ”¯æŒ</strong></td><td><code>/health</code></td><td><code>/liveness</code>, <code>/readiness</code></td></tr><tr><td><strong>æœªæ¥æ”¯æŒ</strong></td><td>é€æ¸åœæ­¢</td><td><strong>ä¸»æ¨ç‰ˆæœ¬</strong></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-17">æœ€åä¸€å¥è¯</h3>
<p>SpringBoot3.xä¸æ˜¯å¯é€‰é¡¹ï¼Œè€Œæ˜¯<strong>Java å¼€å‘ç°ä»£åŒ–çš„å¿…ç»ä¹‹è·¯</strong>ã€‚</p>
<p>æ—©ç‚¹äº†è§£ï¼Œæ—©ç‚¹å‡†å¤‡ï¼Œåˆ«ç­‰åˆ°å…¬å¸è¦æ±‚å‡çº§æ—¶ï¼Œä½ è¿˜åœ¨é—®â€œ<code>javax</code>å’Œ<code>jakarta</code>æœ‰å•¥åŒºåˆ«ï¼Ÿâ€</p>
<p>å¦å¤–<code>SpringBoot4.x</code>å¾ˆå¿«å°±å‘å¸ƒæ­£å¼ç‰ˆäº†ï¼Œå¯ä»¥å…³æ³¨ä¸€ä¸‹ã€‚</p>
<blockquote>
<p>æœ¬æ–‡é¦–å‘äºå…¬ä¼—å·ï¼šç¨‹åºå‘˜åˆ˜å¤§åï¼Œä¸“æ³¨åˆ†äº«å‰åç«¯å¼€å‘çš„å®æˆ˜ç¬”è®°ã€‚å…³æ³¨æˆ‘ï¼Œå°‘èµ°å¼¯è·¯ï¼Œä¸€èµ·è¿›æ­¥ï¼</p>
</blockquote>
<h4 data-id="heading-18">ğŸ“Œå¾€æœŸç²¾å½©</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FP7SMincYFKERZbNKAFtzGQ" target="_blank" title="https://mp.weixin.qq.com/s/P7SMincYFKERZbNKAFtzGQ" ref="nofollow noopener noreferrer">ã€Šè¿™20æ¡SQLä¼˜åŒ–æ–¹æ¡ˆï¼Œè®©ä½ çš„æ•°æ®åº“æŸ¥è¯¢é€Ÿåº¦æå‡10å€ã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fy-GJ26kl0-yT6hE3fy2KjQ" target="_blank" title="https://mp.weixin.qq.com/s/y-GJ26kl0-yT6hE3fy2KjQ" ref="nofollow noopener noreferrer">ã€ŠMySQL ä¸ºä»€ä¹ˆä¸æ¨èç”¨é›ªèŠ±ID å’Œ UUID åšä¸»é”®ï¼Ÿã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F1Th3DuMqYpt4Xg5hEywIww" target="_blank" title="https://mp.weixin.qq.com/s/1Th3DuMqYpt4Xg5hEywIww" ref="nofollow noopener noreferrer">ã€Šç”¨htmlå†™äº†ä¸ªè¶…å¥½ç”¨çš„ç½‘é¡µä¸»é¢˜åˆ‡æ¢æ’ä»¶ã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FfSMv8b_2Z-kozaBeiCgqrA" target="_blank" title="https://mp.weixin.qq.com/s/fSMv8b_2Z-kozaBeiCgqrA" ref="nofollow noopener noreferrer">ã€ŠSpringBoot3+Vue3å®ç°çš„æ•°æ®åº“æ–‡æ¡£å·¥å…·ã€‹</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‡ ç§è™šæ‹Ÿåˆ—è¡¨æŠ€æœ¯æ–¹æ¡ˆè°ƒç ”]]></title>    <link>https://juejin.cn/post/7570162686580523050</link>    <guid>https://juejin.cn/post/7570162686580523050</guid>    <pubDate>2025-11-10T01:55:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570162686580523050" data-draft-id="7569798982941999140" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‡ ç§è™šæ‹Ÿåˆ—è¡¨æŠ€æœ¯æ–¹æ¡ˆè°ƒç ”"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js,JavaScript"/> <meta itemprop="datePublished" content="2025-11-10T01:55:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‡³ç®€ç®€"/> <meta itemprop="url" content="https://juejin.cn/user/4212984286819384"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‡ ç§è™šæ‹Ÿåˆ—è¡¨æŠ€æœ¯æ–¹æ¡ˆè°ƒç ”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984286819384/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‡³ç®€ç®€
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T01:55:17.000Z" title="Mon Nov 10 2025 01:55:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    21
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">èƒŒæ™¯</h2>
<h3 data-id="heading-1">ä»€ä¹ˆæ˜¯è™šæ‹Ÿåˆ—è¡¨ï¼Ÿ</h3>
<p>è™šæ‹Ÿåˆ—è¡¨ï¼ˆVirtual Listï¼‰æ˜¯ä¸€ç§ä¼˜åŒ–é•¿åˆ—è¡¨æ¸²æŸ“æ€§èƒ½çš„æŠ€æœ¯ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯<strong>åªæ¸²æŸ“å¯è§åŒºåŸŸçš„åˆ—è¡¨é¡¹</strong>ï¼Œè€Œä¸æ˜¯æ¸²æŸ“æ‰€æœ‰æ•°æ®ã€‚å½“ç”¨æˆ·æ»šåŠ¨æ—¶ï¼ŒåŠ¨æ€åœ°åˆ›å»ºå’Œé”€æ¯ DOM å…ƒç´ ï¼Œä»è€Œå¤§å¹…å‡å°‘ DOM èŠ‚ç‚¹æ•°é‡ï¼Œæå‡æ¸²æŸ“æ€§èƒ½ã€‚</p>
<p>æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œç¬”è€…ä»Vue3çš„æŠ€æœ¯æ¡†æ¶æ¥è®²è§£è™šæ‹Ÿåˆ—è¡¨ä¸åŒåœºæ™¯ä¸­çš„ç”¨æ³•ï¼Œä¸æ¶‰åŠè™šæ‹Ÿåˆ—è¡¨çš„åŸç†ã€‚ç¤¾åŒºé‡Œæœ‰å¾ˆå¤šè®²è§£è™šæ‹Ÿåˆ—è¡¨çš„åŸç†çš„æ–‡ç« ï¼Œç¬”è€…ä¸å†èµ˜è¿°ã€‚ç¬”è€…ä»è™šæ‹Ÿåˆ—è¡¨çš„åˆ†ç±»ä¸Šç»Ÿç­¹æ¯ä¸€ç§è™šæ‹Ÿåˆ—è¡¨æŠ€æœ¯æ–¹æ¡ˆï¼Œå¹¶ç»™å‡ºå‚è€ƒç¤ºä¾‹ã€‚</p>
<h3 data-id="heading-2">ä¸ºä»€ä¹ˆä½¿ç”¨è™šæ‹Ÿåˆ—è¡¨ï¼Ÿ</h3>
<p><strong>ä¼ ç»Ÿåˆ—è¡¨çš„æ€§èƒ½ç“¶é¢ˆï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ¸²æŸ“ 10000 æ¡æ•°æ®</span>
<span class="hljs-keyword">const</span> items = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">10000</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i)

<span class="hljs-comment">// âŒ ä¼ ç»Ÿæ–¹å¼ï¼šåˆ›å»º 10000 ä¸ª DOM èŠ‚ç‚¹</span>
&lt;div v-<span class="hljs-keyword">for</span>=<span class="hljs-string">"item in items"</span> :key=<span class="hljs-string">"item"</span>&gt;{{ item }}&lt;/div&gt;
<span class="hljs-comment">// ç»“æœï¼šé¦–æ¬¡æ¸²æŸ“ç¼“æ…¢ã€æ»šåŠ¨å¡é¡¿ã€å†…å­˜å ç”¨é«˜</span>
</code></pre>
<p><strong>è™šæ‹Ÿåˆ—è¡¨çš„ä¼˜åŠ¿ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âœ… è™šæ‹Ÿåˆ—è¡¨ï¼šåªæ¸²æŸ“å¯è§çš„ ~10-20 ä¸ªèŠ‚ç‚¹</span>
<span class="hljs-comment">// å³ä½¿æœ‰ 10000 æ¡æ•°æ®ï¼ŒDOM ä¸­åªæœ‰å¯è§åŒºåŸŸçš„èŠ‚ç‚¹</span>
<span class="hljs-comment">// ç»“æœï¼šå¿«é€Ÿæ¸²æŸ“ã€æµç•…æ»šåŠ¨ã€ä½å†…å­˜å ç”¨</span>
</code></pre>
<h3 data-id="heading-3">@vueuse/core ç®€ä»‹</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvueuse.org%2F" target="_blank" title="https://vueuse.org/" ref="nofollow noopener noreferrer">@vueuse/core</a> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ Vue 3 ç»„åˆå¼ API å·¥å…·é›†ï¼Œå…¶ä¸­ <code>useVirtualList</code> æä¾›äº†å¼€ç®±å³ç”¨çš„è™šæ‹Ÿåˆ—è¡¨è§£å†³æ–¹æ¡ˆã€‚åç»­æ‰€æœ‰çš„ç¤ºä¾‹ä»£ç å‡ä½¿ç”¨ <code>useVirtualList</code> å®ç°</p>
<p><strong>å¿«é€Ÿå¼€å§‹</strong></p>
<pre><code class="hljs language-bash" lang="bash">npm install @vueuse/core
<span class="hljs-comment"># æˆ–</span>
pnpm add @vueuse/core
</code></pre>
<p>ä¸å¾—ä¸è¯´ï¼ŒVueçš„æŠ€æœ¯ç”Ÿæ€ä¸­ï¼Œå¾ˆå¤šç¬¬ä¸‰æ–¹ä¾èµ–å¼€ç®±å³ç”¨ï¼Œè¿™ä¸€ç‚¹éå¸¸æ£’ï¼</p>
<h2 data-id="heading-4">useVirtualList API è¯¦è§£</h2>
<h3 data-id="heading-5">åŸºæœ¬ç”¨æ³•</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { useVirtualList } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vueuse/core'</span>

<span class="hljs-keyword">const</span> { list, containerProps, wrapperProps } = <span class="hljs-title function_">useVirtualList</span>(
  items,    <span class="hljs-comment">// æ•°æ®æº</span>
  options   <span class="hljs-comment">// é…ç½®é€‰é¡¹</span>
)
</code></pre>
<h3 data-id="heading-6">å‚æ•°è¯´æ˜</h3>
<h4 data-id="heading-7">items (å¿…éœ€)</h4>
<p><strong>ç±»å‹ï¼š</strong> <code>MaybeRef&lt;T[]&gt;</code><br/>
<strong>è¯´æ˜ï¼š</strong> è¦æ¸²æŸ“çš„æ•°æ®æ•°ç»„ï¼Œå¯ä»¥æ˜¯å“åº”å¼å¼•ç”¨æˆ–æ™®é€šæ•°ç»„</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ–¹å¼ 1: å“åº”å¼å¼•ç”¨</span>
<span class="hljs-keyword">const</span> items = <span class="hljs-title function_">ref</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, ...])

<span class="hljs-comment">// æ–¹å¼ 2: æ™®é€šæ•°ç»„</span>
<span class="hljs-keyword">const</span> items = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, ...]

<span class="hljs-comment">// æ–¹å¼ 3: computed</span>
<span class="hljs-keyword">const</span> items = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> originalData.<span class="hljs-title function_">filter</span>(...))
</code></pre>
<h4 data-id="heading-8">options (å¿…éœ€)</h4>
<p><strong>ç±»å‹ï¼š</strong> <code>UseVirtualListOptions</code></p>























<table><thead><tr><th>é€‰é¡¹</th><th>ç±»å‹</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>itemHeight</code></td><td><code>number | (index: number) =&gt; number</code></td><td><strong>å¿…éœ€</strong></td><td>é¡¹ç›®é«˜åº¦ï¼Œå¯ä»¥æ˜¯å›ºå®šå€¼æˆ–è®¡ç®—å‡½æ•°</td></tr><tr><td><code>overscan</code></td><td><code>number</code></td><td><code>5</code></td><td>é¢„æ¸²æŸ“çš„é¢å¤–é¡¹ç›®æ•°é‡ï¼Œæå‡æ»šåŠ¨æµç•…åº¦</td></tr></tbody></table>
<h3 data-id="heading-9">è¿”å›å€¼è¯´æ˜</h3>
<h4 data-id="heading-10">list</h4>
<p><strong>ç±»å‹ï¼š</strong> <code>ComputedRef&lt;ListItem&lt;T&gt;[]&gt;</code><br/>
<strong>è¯´æ˜ï¼š</strong> å½“å‰åº”è¯¥æ¸²æŸ“çš„åˆ—è¡¨é¡¹æ•°ç»„</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ListItem</span>&lt;T&gt; {
  <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>    <span class="hljs-comment">// åœ¨åŸæ•°ç»„ä¸­çš„ç´¢å¼•</span>
  <span class="hljs-attr">data</span>: T         <span class="hljs-comment">// åŸå§‹æ•°æ®</span>
}
</code></pre>
<p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-vue" lang="vue">&lt;div v-for="item in list" :key="item.index"&gt;
  &lt;div&gt;ç´¢å¼•: {{ item.index }}&lt;/div&gt;
  &lt;div&gt;æ•°æ®: {{ item.data }}&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<h4 data-id="heading-11">containerProps (éå¸¸é‡è¦)</h4>
<p><strong>ç±»å‹ï¼š</strong> <code>Object</code><br/>
<strong>è¯´æ˜ï¼š</strong> éœ€è¦ç»‘å®šåˆ°å®¹å™¨å…ƒç´ çš„å±æ€§å¯¹è±¡</p>
<p><strong>åŒ…å«å±æ€§ï¼š</strong></p>
<ul>
<li><code>ref</code>: å®¹å™¨çš„å¼•ç”¨</li>
<li><code>onScroll</code>: æ»šåŠ¨äº‹ä»¶å¤„ç†å‡½æ•°</li>
<li><code>style</code>: å®¹å™¨æ ·å¼ï¼ˆå¯èƒ½åŒ…å« overflow ç­‰ï¼‰</li>
</ul>
<p><strong>ä½¿ç”¨æ–¹å¼ï¼š</strong></p>
<pre><code class="hljs language-vue" lang="vue">&lt;div v-bind="containerProps" style="height: 400px; overflow-y: auto;"&gt;
  &lt;!-- å†…å®¹ --&gt;
&lt;/div&gt;
</code></pre>
<h4 data-id="heading-12">wrapperProps (éå¸¸é‡è¦)</h4>
<p><strong>ç±»å‹ï¼š</strong> <code>Object</code><br/>
<strong>è¯´æ˜ï¼š</strong> éœ€è¦ç»‘å®šåˆ°åŒ…è£…å™¨å…ƒç´ çš„å±æ€§å¯¹è±¡</p>
<p><strong>åŒ…å«å±æ€§ï¼š</strong></p>
<ul>
<li><code>style</code>: åŒ…è£…å™¨æ ·å¼ï¼ŒåŒ…å«è®¡ç®—çš„æ€»é«˜åº¦</li>
</ul>
<p><strong>ä½œç”¨ï¼š</strong></p>
<ul>
<li>è®¾ç½®å†…éƒ¨å®¹å™¨çš„æ€»é«˜åº¦ï¼ˆåŸºäºæ‰€æœ‰é¡¹ç›®çš„æ€»é«˜åº¦ï¼‰</li>
<li>åˆ›å»ºæ­£ç¡®çš„æ»šåŠ¨åŒºåŸŸ</li>
<li>æ”¯æŒè™šæ‹ŸåŒ–å®šä½</li>
</ul>
<p><strong>ä½¿ç”¨æ–¹å¼ï¼š</strong></p>
<pre><code class="hljs language-vue" lang="vue">&lt;div v-bind="containerProps"&gt;
  &lt;div v-bind="wrapperProps"&gt;
    &lt;!-- åˆ—è¡¨é¡¹ --&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<h3 data-id="heading-13">å·¥ä½œåŸç†</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5900c2e31e3b4f7cafe7d17c335d4d88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Iez566A566A:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763345274&amp;x-signature=xqul89Zk8kzLIxbUgnhlULmCCJI%3D" alt="image.png" loading="lazy"/></p>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ol>
<li><strong>å®¹å™¨ï¼ˆContainerï¼‰ï¼š</strong> å›ºå®šé«˜åº¦ï¼Œoverflow å¯æ»šåŠ¨</li>
<li><strong>åŒ…è£…å™¨ï¼ˆWrapperï¼‰ï¼š</strong> é«˜åº¦ = æ‰€æœ‰é¡¹ç›®çš„æ€»é«˜åº¦</li>
<li><strong>åˆ—è¡¨é¡¹ï¼š</strong> åªæ¸²æŸ“å¯è§åŒºåŸŸçš„é¡¹ç›® ï¼ˆuseVirtualListè¿”å›çš„ listitemsï¼‰</li>
</ol>
<h2 data-id="heading-14">å››ç§è™šæ‹Ÿåˆ—è¡¨å®ç°æ–¹æ¡ˆ</h2>
<p>ç»è¿‡ç¬”è€…çš„è°ƒç ”ï¼Œä¸»è¦æœ‰å››ç§è™šæ‹Ÿåˆ—è¡¨æŠ€æœ¯æ–¹æ¡ˆ</p>
<h3 data-id="heading-15">å›ºå®šé¡¹é«˜åº¦ + å›ºå®šå®¹å™¨é«˜åº¦</h3>
<h4 data-id="heading-16">ğŸ“Œ æ–¹æ¡ˆç‰¹ç‚¹</h4>
<ul>
<li><strong>é¡¹ç›®é«˜åº¦ï¼š</strong> å›ºå®šï¼ˆå¦‚ 50pxï¼‰</li>
<li><strong>å®¹å™¨é«˜åº¦ï¼š</strong> å›ºå®šï¼ˆå¦‚ 400pxï¼‰</li>
<li><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> æ ‡å‡†åˆ—è¡¨ã€è¡¨æ ¼ã€èŠå¤©è®°å½•ç­‰ç»Ÿä¸€é«˜åº¦çš„åœºæ™¯</li>
</ul>
<h4 data-id="heading-17">ğŸ¯ é€‚ç”¨åœºæ™¯</h4>

























<table><thead><tr><th>åœºæ™¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ•°æ®åˆ—è¡¨</td><td>è¡¨æ ¼æ•°æ®ã€å•†å“åˆ—è¡¨ã€ç”¨æˆ·åˆ—è¡¨</td></tr><tr><td>æ—¥å¿—æŸ¥çœ‹å™¨</td><td>ç³»ç»Ÿæ—¥å¿—ã€æ“ä½œè®°å½•</td></tr><tr><td>èŠå¤©è®°å½•</td><td>ç®€å•æ–‡æœ¬æ¶ˆæ¯åˆ—è¡¨</td></tr><tr><td>æ–‡ä»¶æµè§ˆå™¨</td><td>æ–‡ä»¶/æ–‡ä»¶å¤¹åˆ—è¡¨</td></tr></tbody></table>
<h4 data-id="heading-18">ğŸ’» å®Œæ•´å®ç°ä»£ç </h4>
<p><strong>ç»„ä»¶ä»£ç ï¼š</strong> <code>FixedHeightVirtualList.vue</code></p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { ref } from "vue";
import { useVirtualList } from "@vueuse/core";

const props = defineProps({
  items: {
    type: Array,
    default: () =&gt; [],
    required: true,
  },
  itemHeight: {
    type: Number,
    default: 50,
  },
  containerHeight: {
    type: Number,
    default: 400,
  },
});

const container = ref(null);

// ğŸ”‘ å…³é”®é…ç½®ï¼šitemHeight ä¸ºå›ºå®šæ•°å€¼
const { list, containerProps, wrapperProps } = useVirtualList(props.items, {
  itemHeight: props.itemHeight,  // å›ºå®šé«˜åº¦
  overscan: 5,
});
&lt;/script&gt;

&lt;template&gt;
  &lt;div
    ref="container"
    class="virtual-list-container"
    :style="{ height: `${containerHeight}px` }"  &lt;!-- å›ºå®šå®¹å™¨é«˜åº¦ --&gt;
    v-bind="containerProps"
  &gt;
    &lt;div class="virtual-list-wrapper" v-bind="wrapperProps"&gt;
      &lt;div
        v-for="item in list"
        :key="item.index"
        class="virtual-list-item"
        :style="{ height: `${itemHeight}px` }"  &lt;!-- å›ºå®šé¡¹ç›®é«˜åº¦ --&gt;
      &gt;
        &lt;div class="item-content"&gt;
          &lt;span class="item-index"&gt;{{ item.data.id }}&lt;/span&gt;
          &lt;span class="item-text"&gt;{{ item.data.name }}&lt;/span&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;style scoped&gt;
.virtual-list-container {
  overflow: hidden;  /* ğŸ”‘ å…³é”®ï¼šoverflow hidden */
  border: 1px solid #e8e8e8;
  border-radius: 8px;
}

.virtual-list-item {
  display: flex;
  align-items: center;
  border-bottom: 1px solid #f0f0f0;
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-19">ğŸ“ ä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { ref } from 'vue'
import FixedHeightVirtualList from './components/FixedHeightVirtualList.vue'

const items = ref(
  Array.from({ length: 1000 }, (_, index) =&gt; ({
    id: index + 1,
    name: `é¡¹ç›® ${index + 1}`
  }))
)
&lt;/script&gt;

&lt;template&gt;
  &lt;FixedHeightVirtualList
    :items="items"
    :item-height="50"
    :container-height="400"
  /&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-20">âœ… ä¼˜ç‚¹</h4>
<ul>
<li>å®ç°ç®€å•ï¼Œæ€§èƒ½æœ€ä¼˜</li>
<li>æ»šåŠ¨æœ€æµç•…</li>
<li>è®¡ç®—å¼€é”€æœ€å°</li>
</ul>
<h4 data-id="heading-21">âŒ ç¼ºç‚¹</h4>
<ul>
<li>æ‰€æœ‰é¡¹ç›®å¿…é¡»é«˜åº¦ä¸€è‡´</li>
<li>å®¹å™¨é«˜åº¦å›ºå®šï¼Œä¸å¤Ÿçµæ´»</li>
</ul>
<hr/>
<h3 data-id="heading-22">å›ºå®šé¡¹é«˜åº¦ + åŠ¨æ€å®¹å™¨é«˜åº¦</h3>
<h4 data-id="heading-23">ğŸŒŠ æ–¹æ¡ˆç‰¹ç‚¹</h4>
<ul>
<li><strong>é¡¹ç›®é«˜åº¦ï¼š</strong> å›ºå®šï¼ˆå¦‚ 50pxï¼‰</li>
<li><strong>å®¹å™¨é«˜åº¦ï¼š</strong> åŠ¨æ€è‡ªé€‚åº”ï¼ˆmax-heightï¼‰</li>
<li><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> å“åº”å¼å¸ƒå±€ã€ä¸‹æ‹‰èœå•ã€å¼¹çª—åˆ—è¡¨</li>
</ul>
<h4 data-id="heading-24">ğŸ¯ é€‚ç”¨åœºæ™¯</h4>





























<table><thead><tr><th>åœºæ™¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ä¸‹æ‹‰é€‰æ‹©å™¨</td><td>æ•°æ®é‡ä¸ç¡®å®šçš„ä¸‹æ‹‰åˆ—è¡¨</td></tr><tr><td>æœç´¢å»ºè®®</td><td>æœç´¢ç»“æœåˆ—è¡¨ï¼ˆæ•°é‡åŠ¨æ€å˜åŒ–ï¼‰</td></tr><tr><td>å¼¹çª—åˆ—è¡¨</td><td>Modal ä¸­çš„åˆ—è¡¨å†…å®¹</td></tr><tr><td>ä¾§è¾¹æ èœå•</td><td>å“åº”å¼ä¾§è¾¹å¯¼èˆª</td></tr><tr><td>å“åº”å¼å¸ƒå±€</td><td>éœ€è¦é€‚åº”ä¸åŒå±å¹•å°ºå¯¸</td></tr></tbody></table>
<h4 data-id="heading-25">ğŸ’» å®Œæ•´å®ç°ä»£ç </h4>
<p><strong>ç»„ä»¶ä»£ç ï¼š</strong> <code>DynamicHeightVirtualList.vue</code></p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { ref } from "vue";
import { useVirtualList } from "@vueuse/core";

const props = defineProps({
  items: {
    type: Array,
    default: () =&gt; [],
    required: true,
  },
  itemHeight: {
    type: Number,
    default: 50,
  },
  maxHeight: {
    type: Number,
    default: 500,
  },
});

const container = ref(null);

// ğŸ”‘ å…³é”®é…ç½®ï¼šitemHeight ä¸ºå›ºå®šæ•°å€¼
const { list, containerProps, wrapperProps } = useVirtualList(props.items, {
  itemHeight: props.itemHeight,
  overscan: 5,
});
&lt;/script&gt;

&lt;template&gt;
  &lt;div
    ref="container"
    class="virtual-list-container"
    :style="{ maxHeight: `${maxHeight}px` }"  &lt;!-- ğŸ”‘ max-height å®ç°åŠ¨æ€ --&gt;
    v-bind="containerProps"
  &gt;
    &lt;div class="virtual-list-wrapper" v-bind="wrapperProps"&gt;
      &lt;div
        v-for="item in list"
        :key="item.index"
        class="virtual-list-item"
        :style="{ height: `${itemHeight}px` }"
      &gt;
        &lt;div class="item-content"&gt;
          &lt;span class="item-index"&gt;{{ item.data.id }}&lt;/span&gt;
          &lt;span class="item-text"&gt;{{ item.data.name }}&lt;/span&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;style scoped&gt;
.virtual-list-container {
  overflow-y: auto;  /* ğŸ”‘ å…³é”®ï¼šoverflow-y auto */
  border: 1px solid #e8e8e8;
  border-radius: 8px;
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-26">ğŸ“ ä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { ref } from 'vue'
import DynamicHeightVirtualList from './components/DynamicHeightVirtualList.vue'

// æ•°æ®é‡å°‘
const fewItems = ref(
  Array.from({ length: 4 }, (_, index) =&gt; ({
    id: index + 1,
    name: `é¡¹ç›® ${index + 1}`
  }))
)

// æ•°æ®é‡å¤š
const manyItems = ref(
  Array.from({ length: 1000 }, (_, index) =&gt; ({
    id: index + 1,
    name: `é¡¹ç›® ${index + 1}`
  }))
)
&lt;/script&gt;

&lt;template&gt;
  &lt;!-- æ•°æ®å°‘æ—¶ï¼Œå®¹å™¨é«˜åº¦ = 4 * 50 = 200px --&gt;
  &lt;DynamicHeightVirtualList
    :items="fewItems"
    :item-height="50"
    :max-height="400"
  /&gt;

  &lt;!-- æ•°æ®å¤šæ—¶ï¼Œå®¹å™¨é«˜åº¦ = max-height = 400pxï¼Œå‡ºç°æ»šåŠ¨æ¡ --&gt;
  &lt;DynamicHeightVirtualList
    :items="manyItems"
    :item-height="50"
    :max-height="400"
  /&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-27">ğŸ”„ å…³é”®å·®å¼‚å¯¹æ¯”</h4>






























<table><thead><tr><th>å±æ€§</th><th>å›ºå®šå®¹å™¨</th><th>åŠ¨æ€å®¹å™¨</th></tr></thead><tbody><tr><td>å®¹å™¨æ ·å¼</td><td><code>height: 400px</code></td><td><code>max-height: 400px</code></td></tr><tr><td>overflow</td><td><code>overflow: hidden</code></td><td><code>overflow-y: auto</code></td></tr><tr><td>æ•°æ®å°‘æ—¶</td><td>ä»å æ® 400px</td><td>è‡ªåŠ¨ç¼©å°</td></tr><tr><td>æ•°æ®å¤šæ—¶</td><td>æ˜¾ç¤ºæ»šåŠ¨æ¡</td><td>æ˜¾ç¤ºæ»šåŠ¨æ¡</td></tr></tbody></table>
<h4 data-id="heading-28">âœ… ä¼˜ç‚¹</h4>
<ul>
<li>å®¹å™¨é«˜åº¦è‡ªé€‚åº”ï¼Œæ›´çµæ´»</li>
<li>æ•°æ®å°‘æ—¶ä¸æµªè´¹ç©ºé—´</li>
<li>æ€§èƒ½ä¾ç„¶ä¼˜ç§€</li>
</ul>
<h4 data-id="heading-29">âŒ ç¼ºç‚¹</h4>
<ul>
<li>éœ€è¦æ­£ç¡®å¤„ç† overflow-y</li>
<li>å¸ƒå±€å¯èƒ½å› é«˜åº¦å˜åŒ–è€Œè·³åŠ¨</li>
</ul>
<hr/>
<h3 data-id="heading-30">åŠ¨æ€é¡¹é«˜åº¦ + å›ºå®šå®¹å™¨é«˜åº¦</h3>
<h4 data-id="heading-31">ğŸ¨ æ–¹æ¡ˆç‰¹ç‚¹</h4>
<ul>
<li><strong>é¡¹ç›®é«˜åº¦ï¼š</strong> åŠ¨æ€è®¡ç®—ï¼ˆé€šè¿‡å‡½æ•°ï¼‰</li>
<li><strong>å®¹å™¨é«˜åº¦ï¼š</strong> å›ºå®šï¼ˆå¦‚ 450pxï¼‰</li>
<li><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> å¤šæ ·åŒ–å†…å®¹ã€å¡ç‰‡åˆ—è¡¨ã€å¤æ‚å¸ƒå±€</li>
</ul>
<h4 data-id="heading-32">ğŸ¯ é€‚ç”¨åœºæ™¯</h4>





























<table><thead><tr><th>åœºæ™¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ–°é—»åˆ—è¡¨</td><td>æ ‡é¢˜é•¿åº¦ä¸ä¸€ï¼Œå†…å®¹é¢„è§ˆä¸åŒ</td></tr><tr><td>å¡ç‰‡æµ</td><td>ä¸åŒç±»å‹çš„å¡ç‰‡é«˜åº¦ä¸åŒ</td></tr><tr><td>è¯„è®ºåˆ—è¡¨</td><td>è¯„è®ºå†…å®¹é•¿åº¦ä¸ä¸€</td></tr><tr><td>å•†å“å±•ç¤º</td><td>ä¸åŒå•†å“ä¿¡æ¯å¤æ‚åº¦ä¸åŒ</td></tr><tr><td>é‚®ä»¶åˆ—è¡¨</td><td>å¸¦é™„ä»¶ã€æ ‡ç­¾ç­‰é¢å¤–ä¿¡æ¯</td></tr></tbody></table>
<h4 data-id="heading-33">ğŸ’» å®Œæ•´å®ç°ä»£ç </h4>
<p><strong>ç»„ä»¶ä»£ç ï¼š</strong> <code>VariableHeightVirtualList.vue</code></p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { ref } from "vue";
import { useVirtualList } from "@vueuse/core";

const props = defineProps({
  items: {
    type: Array,
    default: () =&gt; [],
    required: true,
  },
  containerHeight: {
    type: Number,
    default: 400,
  },
});

const container = ref(null);

// ğŸ”‘ å…³é”®ï¼šåŠ¨æ€è®¡ç®—æ¯ä¸ªé¡¹çš„é«˜åº¦
const getItemHeight = (index) =&gt; {
  // æ–¹å¼ 1: æ ¹æ®ç´¢å¼•æ¨¡å¼
  const heightPattern = index % 3;
  if (heightPattern === 0) return 60;  // å°é¡¹
  if (heightPattern === 1) return 80;  // ä¸­é¡¹
  return 100;                          // å¤§é¡¹
  
  // æ–¹å¼ 2: æ ¹æ®æ•°æ®å†…å®¹
  // const item = props.items[index];
  // return item.type === 'large' ? 100 : 50;
  
  // æ–¹å¼ 3: æ ¹æ®æ–‡æœ¬é•¿åº¦
  // const textLength = props.items[index].text.length;
  // return Math.max(50, Math.ceil(textLength / 20) * 30);
};

// ğŸ”‘ å…³é”®é…ç½®ï¼šitemHeight ä¸ºå‡½æ•°
const { list, containerProps, wrapperProps } = useVirtualList(props.items, {
  itemHeight: getItemHeight,  // å‡½æ•°ï¼Œä¸æ˜¯æ•°å€¼ï¼
  overscan: 5,
});
&lt;/script&gt;

&lt;template&gt;
  &lt;div
    ref="container"
    class="virtual-list-container"
    :style="{ height: `${containerHeight}px` }"
    v-bind="containerProps"
  &gt;
    &lt;div class="virtual-list-wrapper" v-bind="wrapperProps"&gt;
      &lt;div
        v-for="item in list"
        :key="item.index"
        class="virtual-list-item"
        :style="{ height: `${getItemHeight(item.index)}px` }"  &lt;!-- åŠ¨æ€é«˜åº¦ --&gt;
        :data-height="getItemHeight(item.index)"
      &gt;
        &lt;div class="item-content"&gt;
          &lt;span class="item-index"&gt;{{ item.data.id }}&lt;/span&gt;
          &lt;div class="item-info"&gt;
            &lt;span class="item-text"&gt;{{ item.data.name }}&lt;/span&gt;
            &lt;span class="item-height-tag"&gt;é«˜åº¦: {{ getItemHeight(item.index) }}px&lt;/span&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;style scoped&gt;
.virtual-list-container {
  overflow: hidden;
}

/* æ ¹æ®é«˜åº¦æ·»åŠ ä¸åŒçš„è§†è§‰æ ·å¼ */
.virtual-list-item[data-height="60"] {
  background: linear-gradient(135deg, #fff9e6 0%, #ffffff 100%);
}

.virtual-list-item[data-height="80"] {
  background: linear-gradient(135deg, #e6f7ff 0%, #ffffff 100%);
}

.virtual-list-item[data-height="100"] {
  background: linear-gradient(135deg, #f0f9ff 0%, #ffffff 100%);
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-34">ğŸ“ ä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { ref } from 'vue'
import VariableHeightVirtualList from './components/VariableHeightVirtualList.vue'

const items = ref(
  Array.from({ length: 400 }, (_, index) =&gt; ({
    id: index + 1,
    name: `é¡¹ç›® ${index + 1}`
  }))
)
&lt;/script&gt;

&lt;template&gt;
  &lt;VariableHeightVirtualList
    :items="items"
    :container-height="450"
  /&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-35">ğŸ¨ é«˜åº¦è®¡ç®—å‡½æ•°ç¤ºä¾‹</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç¤ºä¾‹ 1: åŸºäºç´¢å¼•çš„è§„å¾‹æ¨¡å¼</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getItemHeight</span> = (<span class="hljs-params">index</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-number">50</span> + (index % <span class="hljs-number">3</span>) * <span class="hljs-number">25</span>;  <span class="hljs-comment">// 50, 75, 100 å¾ªç¯</span>
};

<span class="hljs-comment">// ç¤ºä¾‹ 2: åŸºäºæ•°æ®ç±»å‹</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getItemHeight</span> = (<span class="hljs-params">index</span>) =&gt; {
  <span class="hljs-keyword">const</span> item = props.<span class="hljs-property">items</span>[index];
  <span class="hljs-keyword">switch</span>(item.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'header'</span>: <span class="hljs-keyword">return</span> <span class="hljs-number">80</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'content'</span>: <span class="hljs-keyword">return</span> <span class="hljs-number">120</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'footer'</span>: <span class="hljs-keyword">return</span> <span class="hljs-number">60</span>;
    <span class="hljs-attr">default</span>: <span class="hljs-keyword">return</span> <span class="hljs-number">50</span>;
  }
};

<span class="hljs-comment">// ç¤ºä¾‹ 3: åŸºäºå†…å®¹é•¿åº¦</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getItemHeight</span> = (<span class="hljs-params">index</span>) =&gt; {
  <span class="hljs-keyword">const</span> item = props.<span class="hljs-property">items</span>[index];
  <span class="hljs-keyword">const</span> textLength = item.<span class="hljs-property">description</span>?.<span class="hljs-property">length</span> || <span class="hljs-number">0</span>;
  <span class="hljs-keyword">const</span> lines = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(textLength / <span class="hljs-number">40</span>);  <span class="hljs-comment">// å‡è®¾æ¯è¡Œ 40 å­—ç¬¦</span>
  <span class="hljs-keyword">return</span> <span class="hljs-number">50</span> + (lines - <span class="hljs-number">1</span>) * <span class="hljs-number">20</span>;  <span class="hljs-comment">// åŸºç¡€é«˜åº¦ + é¢å¤–è¡Œé«˜åº¦</span>
};

<span class="hljs-comment">// ç¤ºä¾‹ 4: åŸºäºå±æ€§ç»„åˆ</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getItemHeight</span> = (<span class="hljs-params">index</span>) =&gt; {
  <span class="hljs-keyword">const</span> item = props.<span class="hljs-property">items</span>[index];
  <span class="hljs-keyword">let</span> height = <span class="hljs-number">60</span>;  <span class="hljs-comment">// åŸºç¡€é«˜åº¦</span>
  <span class="hljs-keyword">if</span> (item.<span class="hljs-property">hasImage</span>) height += <span class="hljs-number">200</span>;
  <span class="hljs-keyword">if</span> (item.<span class="hljs-property">hasTags</span>) height += <span class="hljs-number">30</span>;
  <span class="hljs-keyword">if</span> (item.<span class="hljs-property">hasActions</span>) height += <span class="hljs-number">40</span>;
  <span class="hljs-keyword">return</span> height;
};
</code></pre>
<h4 data-id="heading-36">âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹</h4>
<ol>
<li><strong>é«˜åº¦å¿…é¡»å¯é¢„æµ‹ï¼š</strong> <code>getItemHeight(index)</code> å¯¹åŒä¸€ä¸ª index å¿…é¡»å§‹ç»ˆè¿”å›ç›¸åŒçš„å€¼</li>
<li><strong>æ€§èƒ½è€ƒè™‘ï¼š</strong> å‡½æ•°ä¼šè¢«é¢‘ç¹è°ƒç”¨ï¼Œé¿å…å¤æ‚è®¡ç®—</li>
<li><strong>å®é™…é«˜åº¦åŒ¹é…ï¼š</strong> CSS å®é™…é«˜åº¦å¿…é¡»ä¸è®¡ç®—é«˜åº¦ä¸€è‡´</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šéšæœºé«˜åº¦ï¼ˆä¸å¯é¢„æµ‹ï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getItemHeight</span> = (<span class="hljs-params">index</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-number">50</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">50</span>;  <span class="hljs-comment">// æ¯æ¬¡è°ƒç”¨ç»“æœä¸åŒï¼</span>
};

<span class="hljs-comment">// âŒ é”™è¯¯ï¼šå¼‚æ­¥è®¡ç®—</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getItemHeight</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">index</span>) =&gt; {
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchData</span>(index);  <span class="hljs-comment">// ä¸æ”¯æŒå¼‚æ­¥ï¼</span>
  <span class="hljs-keyword">return</span> data.<span class="hljs-property">height</span>;
};

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šå¯é¢„æµ‹ã€åŒæ­¥</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getItemHeight</span> = (<span class="hljs-params">index</span>) =&gt; {
  <span class="hljs-keyword">return</span> props.<span class="hljs-property">items</span>[index].<span class="hljs-property">preCalculatedHeight</span>;  <span class="hljs-comment">// æå‰è®¡ç®—å¥½çš„é«˜åº¦</span>
};
</code></pre>
<h4 data-id="heading-37">âœ… ä¼˜ç‚¹</h4>
<ul>
<li>æ”¯æŒä¸åŒé«˜åº¦çš„é¡¹ç›®</li>
<li>å®¹å™¨é«˜åº¦å›ºå®šï¼Œå¸ƒå±€ç¨³å®š</li>
<li>è§†è§‰æ•ˆæœæ›´ä¸°å¯Œ</li>
</ul>
<h4 data-id="heading-38">âŒ ç¼ºç‚¹</h4>
<ul>
<li>é«˜åº¦å¿…é¡»æå‰å¯è®¡ç®—</li>
<li>ä¸æ”¯æŒçœŸæ­£çš„åŠ¨æ€å†…å®¹ï¼ˆå¦‚å›¾ç‰‡åŠ è½½åæ‰çŸ¥é“é«˜åº¦ï¼‰</li>
<li>è®¡ç®—å¼€é”€ç•¥é«˜äºå›ºå®šé«˜åº¦</li>
</ul>
<hr/>
<h3 data-id="heading-39">åŠ¨æ€é¡¹é«˜åº¦ + åŠ¨æ€å®¹å™¨é«˜åº¦</h3>
<h4 data-id="heading-40">ğŸŒˆ æ–¹æ¡ˆç‰¹ç‚¹</h4>
<ul>
<li><strong>é¡¹ç›®é«˜åº¦ï¼š</strong> åŠ¨æ€è®¡ç®—ï¼ˆé€šè¿‡å‡½æ•°ï¼‰</li>
<li><strong>å®¹å™¨é«˜åº¦ï¼š</strong> åŠ¨æ€è‡ªé€‚åº”ï¼ˆmax-heightï¼‰</li>
<li><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> æœ€çµæ´»çš„åœºæ™¯ï¼Œç»“åˆå‰ä¸‰ç§ä¼˜åŠ¿</li>
</ul>
<h4 data-id="heading-41">ğŸ¯ é€‚ç”¨åœºæ™¯</h4>





























<table><thead><tr><th>åœºæ™¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>å¤æ‚å¼¹çª—</td><td>å¼¹çª—å†…çš„å¤æ‚åˆ—è¡¨ï¼Œé«˜åº¦ä¸ç¡®å®š</td></tr><tr><td>æœç´¢ç»“æœ</td><td>ä¸åŒç±»å‹çš„æœç´¢ç»“æœæ··åˆ</td></tr><tr><td>é€šçŸ¥ä¸­å¿ƒ</td><td>ä¸åŒç±»å‹é€šçŸ¥ï¼Œæ•°é‡åŠ¨æ€å˜åŒ–</td></tr><tr><td>è´­ç‰©è½¦</td><td>ä¸åŒå•†å“ä¿¡æ¯ï¼Œæ•°é‡åŠ¨æ€</td></tr><tr><td>æ´»åŠ¨é¡µé¢</td><td>ä¸åŒç±»å‹çš„æ´»åŠ¨å¡ç‰‡</td></tr></tbody></table>
<h4 data-id="heading-42">ğŸ’» å®Œæ•´å®ç°ä»£ç </h4>
<p><strong>ç»„ä»¶ä»£ç ï¼š</strong> <code>FullyDynamicVirtualList.vue</code></p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { ref } from "vue";
import { useVirtualList } from "@vueuse/core";

const props = defineProps({
  items: {
    type: Array,
    default: () =&gt; [],
    required: true,
  },
  maxHeight: {
    type: Number,
    default: 500,
  },
});

const container = ref(null);

// ğŸ”‘ å…³é”®ï¼šåŠ¨æ€è®¡ç®—æ¯ä¸ªé¡¹çš„é«˜åº¦
const getItemHeight = (index) =&gt; {
  const heightPattern = index % 3;
  if (heightPattern === 0) return 60;
  if (heightPattern === 1) return 80;
  return 100;
};

// ğŸ”‘ å…³é”®é…ç½®ï¼šitemHeight ä¸ºå‡½æ•° + å®¹å™¨ä½¿ç”¨ max-height
const { list, containerProps, wrapperProps } = useVirtualList(props.items, {
  itemHeight: getItemHeight,
  overscan: 5,
});
&lt;/script&gt;

&lt;template&gt;
  &lt;div
    ref="container"
    class="virtual-list-container"
    :style="{ maxHeight: `${maxHeight}px` }"  &lt;!-- ğŸ”‘ max-height åŠ¨æ€å®¹å™¨ --&gt;
    v-bind="containerProps"
  &gt;
    &lt;div class="virtual-list-wrapper" v-bind="wrapperProps"&gt;
      &lt;div
        v-for="item in list"
        :key="item.index"
        class="virtual-list-item"
        :style="{ height: `${getItemHeight(item.index)}px` }"
        :data-height="getItemHeight(item.index)"
      &gt;
        &lt;div class="item-content"&gt;
          &lt;span class="item-index"&gt;{{ item.data.id }}&lt;/span&gt;
          &lt;div class="item-info"&gt;
            &lt;span class="item-text"&gt;{{ item.data.name }}&lt;/span&gt;
            &lt;span class="item-height-tag"&gt;é«˜åº¦: {{ getItemHeight(item.index) }}px&lt;/span&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;style scoped&gt;
.virtual-list-container {
  overflow-y: auto;  /* ğŸ”‘ å…³é”®ï¼šoverflow-y auto */
  border: 1px solid #e8e8e8;
  border-radius: 8px;
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-43">ğŸ“ ä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { ref } from 'vue'
import FullyDynamicVirtualList from './components/FullyDynamicVirtualList.vue'

const items = ref(
  Array.from({ length: 200 }, (_, index) =&gt; ({
    id: index + 1,
    name: `é¡¹ç›® ${index + 1}`
  }))
)
&lt;/script&gt;

&lt;template&gt;
  &lt;FullyDynamicVirtualList
    :items="items"
    :max-height="600"
  /&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-44">ğŸ¯ é€‚é…ä¸åŒæ•°æ®é‡</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;!-- æ•°æ®å°‘ï¼šå®¹å™¨è‡ªåŠ¨ç¼©å° --&gt;
  &lt;FullyDynamicVirtualList
    :items="[1, 2, 3]"
    :max-height="400"
  /&gt;
  &lt;!-- å®é™…é«˜åº¦çº¦: 60 + 80 + 100 = 240px --&gt;

  &lt;!-- æ•°æ®å¤šï¼šå®¹å™¨è¾¾åˆ°æœ€å¤§é«˜åº¦ï¼Œæ˜¾ç¤ºæ»šåŠ¨æ¡ --&gt;
  &lt;FullyDynamicVirtualList
    :items="Array(200)"
    :max-height="400"
  /&gt;
  &lt;!-- å®é™…é«˜åº¦: 400px (max-height) --&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-45">âœ… ä¼˜ç‚¹</h4>
<ul>
<li>æœ€å¤§çš„çµæ´»æ€§</li>
<li>é¡¹ç›®é«˜åº¦å¯å˜</li>
<li>å®¹å™¨é«˜åº¦è‡ªé€‚åº”</li>
<li>é€‚åº”å„ç§å¤æ‚åœºæ™¯</li>
</ul>
<h4 data-id="heading-46">âŒ ç¼ºç‚¹</h4>
<ul>
<li>å®ç°ç›¸å¯¹å¤æ‚</li>
<li>éœ€è¦åŒæ—¶å¤„ç†ä¸¤ç§åŠ¨æ€æ€§</li>
<li>æ€§èƒ½ç•¥ä½äºå‰ä¸‰ç§æ–¹æ¡ˆ</li>
</ul>
<hr/>
<h2 data-id="heading-47">æ€§èƒ½å¯¹æ¯”ä¸æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-48">æ€§èƒ½å¯¹æ¯”</h3>








































<table><thead><tr><th>æ–¹æ¡ˆ</th><th>æ€§èƒ½</th><th>çµæ´»æ€§</th><th>å®ç°éš¾åº¦</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>å›ºå®š+å›ºå®š</td><td>â­â­â­â­â­</td><td>â­â­</td><td>â­</td><td>æ ‡å‡†åˆ—è¡¨</td></tr><tr><td>å›ºå®š+åŠ¨æ€</td><td>â­â­â­â­â­</td><td>â­â­â­</td><td>â­â­</td><td>å“åº”å¼å¸ƒå±€</td></tr><tr><td>åŠ¨æ€+å›ºå®š</td><td>â­â­â­â­</td><td>â­â­â­â­</td><td>â­â­â­</td><td>å¤šæ ·åŒ–å†…å®¹</td></tr><tr><td>åŠ¨æ€+åŠ¨æ€</td><td>â­â­â­â­</td><td>â­â­â­â­â­</td><td>â­â­â­â­</td><td>å¤æ‚åœºæ™¯</td></tr></tbody></table>
<h3 data-id="heading-49">æ¸²æŸ“æ•ˆç‡å¯¹æ¯”</h3>
<p><strong>æµ‹è¯•æ¡ä»¶ï¼š</strong> 10,000 æ¡æ•°æ®</p>















































<table><thead><tr><th>æ–¹æ¡ˆ</th><th>DOM èŠ‚ç‚¹æ•°</th><th>é¦–æ¬¡æ¸²æŸ“æ—¶é—´</th><th>æ»šåŠ¨ FPS</th><th>å†…å­˜å ç”¨</th></tr></thead><tbody><tr><td>ä¼ ç»Ÿåˆ—è¡¨</td><td>10,000</td><td>~2000ms</td><td>&lt;30 FPS</td><td>~50MB</td></tr><tr><td>è™šæ‹Ÿåˆ—è¡¨ï¼ˆå›ºå®š+å›ºå®šï¼‰</td><td>~15</td><td>~50ms</td><td>60 FPS</td><td>~5MB</td></tr><tr><td>è™šæ‹Ÿåˆ—è¡¨ï¼ˆå›ºå®š+åŠ¨æ€ï¼‰</td><td>~15</td><td>~50ms</td><td>60 FPS</td><td>~5MB</td></tr><tr><td>è™šæ‹Ÿåˆ—è¡¨ï¼ˆåŠ¨æ€+å›ºå®šï¼‰</td><td>~15</td><td>~60ms</td><td>55-60 FPS</td><td>~5MB</td></tr><tr><td>è™šæ‹Ÿåˆ—è¡¨ï¼ˆåŠ¨æ€+åŠ¨æ€ï¼‰</td><td>~15</td><td>~60ms</td><td>55-60 FPS</td><td>~5MB</td></tr></tbody></table>
<h3 data-id="heading-50">æ–¹æ¡ˆé€‰æ‹©å†³ç­–æ ‘</h3>
<pre><code class="hljs">å¼€å§‹
  â”‚
  â”œâ”€ æ‰€æœ‰é¡¹ç›®é«˜åº¦æ˜¯å¦ç›¸åŒï¼Ÿ
  â”‚   â”œâ”€ æ˜¯ â”€â”€&gt; å®¹å™¨é«˜åº¦æ˜¯å¦å›ºå®šï¼Ÿ
  â”‚   â”‚         â”œâ”€ æ˜¯ â”€â”€&gt; ã€æ–¹æ¡ˆ1: å›ºå®š+å›ºå®šã€‘æœ€ä¼˜æ€§èƒ½ â­â­â­â­â­
  â”‚   â”‚         â””â”€ å¦ â”€â”€&gt; ã€æ–¹æ¡ˆ2: å›ºå®š+åŠ¨æ€ã€‘å“åº”å¼å¸ƒå±€ â­â­â­â­â­
  â”‚   â”‚
  â”‚   â””â”€ å¦ â”€â”€&gt; å®¹å™¨é«˜åº¦æ˜¯å¦å›ºå®šï¼Ÿ
  â”‚             â”œâ”€ æ˜¯ â”€â”€&gt; ã€æ–¹æ¡ˆ3: åŠ¨æ€+å›ºå®šã€‘å¤šæ ·åŒ–å†…å®¹ â­â­â­â­
  â”‚             â””â”€ å¦ â”€â”€&gt; ã€æ–¹æ¡ˆ4: åŠ¨æ€+åŠ¨æ€ã€‘æœ€å¤§çµæ´»æ€§ â­â­â­â­
</code></pre>
<h3 data-id="heading-51">æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-52">overscan å‚æ•°è°ƒä¼˜</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åŸºç¡€é…ç½®</span>
<span class="hljs-attr">overscan</span>: <span class="hljs-number">5</span>  <span class="hljs-comment">// é»˜è®¤å€¼ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯</span>

<span class="hljs-comment">// å¿«é€Ÿæ»šåŠ¨åœºæ™¯</span>
<span class="hljs-attr">overscan</span>: <span class="hljs-number">10</span>  <span class="hljs-comment">// å¢åŠ é¢„æ¸²æŸ“ï¼Œé˜²æ­¢ç™½å±</span>

<span class="hljs-comment">// æ€§èƒ½æ•æ„Ÿåœºæ™¯</span>
<span class="hljs-attr">overscan</span>: <span class="hljs-number">3</span>  <span class="hljs-comment">// å‡å°‘é¢„æ¸²æŸ“ï¼Œé™ä½å¼€é”€</span>

<span class="hljs-comment">// ç§»åŠ¨ç«¯</span>
<span class="hljs-attr">overscan</span>: <span class="hljs-number">8</span>  <span class="hljs-comment">// ç§»åŠ¨ç«¯æ»šåŠ¨æ›´å¿«ï¼Œå»ºè®®å¢åŠ </span>
</code></pre>
<h4 data-id="heading-53">é«˜åº¦è®¡ç®—ç¼“å­˜</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ ä¸æ¨èï¼šæ¯æ¬¡éƒ½è®¡ç®—</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getItemHeight</span> = (<span class="hljs-params">index</span>) =&gt; {
  <span class="hljs-keyword">const</span> item = props.<span class="hljs-property">items</span>[index];
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">calculateComplexHeight</span>(item);  <span class="hljs-comment">// å¤æ‚è®¡ç®—</span>
};

<span class="hljs-comment">// âœ… æ¨èï¼šç¼“å­˜è®¡ç®—ç»“æœ</span>
<span class="hljs-keyword">const</span> heightCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

<span class="hljs-keyword">const</span> <span class="hljs-title function_">getItemHeight</span> = (<span class="hljs-params">index</span>) =&gt; {
  <span class="hljs-keyword">if</span> (heightCache.<span class="hljs-title function_">has</span>(index)) {
    <span class="hljs-keyword">return</span> heightCache.<span class="hljs-title function_">get</span>(index);
  }
  
  <span class="hljs-keyword">const</span> item = props.<span class="hljs-property">items</span>[index];
  <span class="hljs-keyword">const</span> height = <span class="hljs-title function_">calculateComplexHeight</span>(item);
  heightCache.<span class="hljs-title function_">set</span>(index, height);
  <span class="hljs-keyword">return</span> height;
};

<span class="hljs-comment">// æ•°æ®å˜åŒ–æ—¶æ¸…é™¤ç¼“å­˜</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">items</span>, <span class="hljs-function">() =&gt;</span> {
  heightCache.<span class="hljs-title function_">clear</span>();
}, { <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span> });
</code></pre>
<h4 data-id="heading-54">å“åº”å¼ä¼˜åŒ–</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ ä¸æ¨èï¼šç›´æ¥ä¼ å…¥å“åº”å¼å¯¹è±¡</span>
<span class="hljs-keyword">const</span> items = <span class="hljs-title function_">reactive</span>([...]);

<span class="hljs-comment">// âœ… æ¨èï¼šä½¿ç”¨ ref</span>
<span class="hljs-keyword">const</span> items = <span class="hljs-title function_">ref</span>([...]);

<span class="hljs-comment">// âœ… æ›´å¥½ï¼šä½¿ç”¨ shallowRefï¼ˆå¤§æ•°æ®é‡ï¼‰</span>
<span class="hljs-keyword">const</span> items = <span class="hljs-title function_">shallowRef</span>([...]);
</code></pre>
<h4 data-id="heading-55">å¤§æ•°æ®é‡ä¼˜åŒ–</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ•°æ®é‡ &gt; 50,000 æ—¶çš„ä¼˜åŒ–ç­–ç•¥</span>

<span class="hljs-comment">// 1. ä½¿ç”¨ shallowRef</span>
<span class="hljs-keyword">const</span> items = <span class="hljs-title function_">shallowRef</span>(largeDataArray);

<span class="hljs-comment">// 2. å¢åŠ  overscan</span>
<span class="hljs-attr">overscan</span>: <span class="hljs-number">15</span>

<span class="hljs-comment">// 3. é˜²æŠ–æ»šåŠ¨äº‹ä»¶ï¼ˆå¦‚æœéœ€è¦è‡ªå®šä¹‰å¤„ç†ï¼‰</span>
<span class="hljs-keyword">const</span> handleScroll = <span class="hljs-title function_">useDebounceFn</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// å¤„ç†æ»šåŠ¨</span>
}, <span class="hljs-number">16</span>);  <span class="hljs-comment">// çº¦ 60fps</span>

<span class="hljs-comment">// 4. è™šæ‹Ÿæ»šåŠ¨æ¡ï¼ˆå¯é€‰ï¼‰</span>
<span class="hljs-comment">// ä½¿ç”¨è‡ªå®šä¹‰æ»šåŠ¨æ¡æ›¿ä»£åŸç”Ÿæ»šåŠ¨æ¡</span>
</code></pre>
<h4 data-id="heading-56">é¿å…å¸¸è§é”™è¯¯</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ é”™è¯¯ 1ï¼šåœ¨æ¨¡æ¿ä¸­ç›´æ¥è®¿é—®åŸæ•°ç»„</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in items"</span>&gt;</span>  <span class="hljs-comment">&lt;!-- é”™è¯¯ï¼åº”è¯¥ç”¨ list --&gt;</span>
    {{ item }}
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šä½¿ç”¨ list</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in list"</span>&gt;</span>  <span class="hljs-comment">&lt;!-- æ­£ç¡®ï¼--&gt;</span>
    {{ item.data }}
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="hljs-comment">// âŒ é”™è¯¯ 2ï¼šå¿˜è®°ç»‘å®š props</span>
&lt;div class="container"&gt;  &lt;!-- é”™è¯¯ï¼ç¼ºå°‘ v-bind --&gt;
  &lt;div class="wrapper"&gt;  &lt;!-- é”™è¯¯ï¼ç¼ºå°‘ v-bind --&gt;

// âœ… æ­£ç¡®ï¼šç»‘å®š containerProps å’Œ wrapperProps
&lt;div v-bind="containerProps"&gt;
  &lt;div v-bind="wrapperProps"&gt;

// âŒ é”™è¯¯ 3ï¼šé«˜åº¦è®¡ç®—ä¸å‡†ç¡®
.item {
  height: 50px;
  padding: 10px;  /* å®é™…é«˜åº¦ = 50 + 20 = 70px */
}

// âœ… æ­£ç¡®ï¼šç¡®ä¿è®¡ç®—é«˜åº¦åŒ…å« padding/border
itemHeight: 70  // æˆ–ä½¿ç”¨ box-sizing: border-box
</code></pre>
<hr/>
<h2 data-id="heading-57">å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-58">æ»šåŠ¨ä½ç½®è·³åŠ¨</h3>
<p><strong>é—®é¢˜ï¼š</strong> æ»šåŠ¨æ—¶åˆ—è¡¨ä½ç½®è·³åŠ¨</p>
<p><strong>åŸå› ï¼š</strong> è®¡ç®—é«˜åº¦ä¸å®é™…é«˜åº¦ä¸åŒ¹é…</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. ä½¿ç”¨ box-sizing: border-box</span>
.<span class="hljs-property">virtual</span>-list-item {
  box-<span class="hljs-attr">sizing</span>: border-box;
  <span class="hljs-attr">height</span>: 50px;  <span class="hljs-comment">/* åŒ…å« padding å’Œ border */</span>
  <span class="hljs-attr">padding</span>: 10px;
}

<span class="hljs-comment">// 2. ç¡®ä¿é«˜åº¦è®¡ç®—å‡†ç¡®</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getItemHeight</span> = (<span class="hljs-params">index</span>) =&gt; {
  <span class="hljs-keyword">const</span> baseHeight = <span class="hljs-number">50</span>;
  <span class="hljs-keyword">const</span> padding = <span class="hljs-number">20</span>;  <span class="hljs-comment">// top + bottom</span>
  <span class="hljs-keyword">const</span> border = <span class="hljs-number">2</span>;    <span class="hljs-comment">// top + bottom</span>
  <span class="hljs-keyword">return</span> baseHeight + padding + border;
};
</code></pre>
<h3 data-id="heading-59">é¦–æ¬¡æ¸²æŸ“ç™½å±</h3>
<p><strong>é—®é¢˜ï¼š</strong> é¦–æ¬¡åŠ è½½æ—¶çŸ­æš‚ç™½å±</p>
<p><strong>åŸå› ï¼š</strong> overscan å¤ªå°æˆ–æ•°æ®åŠ è½½æ…¢</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. å¢åŠ  overscan</span>
<span class="hljs-attr">overscan</span>: <span class="hljs-number">10</span>

<span class="hljs-comment">// 2. æ·»åŠ éª¨æ¶å±</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"loading"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">SkeletonItem</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"i in 10"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"i"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"containerProps"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- è™šæ‹Ÿåˆ—è¡¨ --&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="hljs-comment">// 3. é¢„åŠ è½½æ•°æ®</span>
<span class="hljs-title function_">onMounted</span>(<span class="hljs-keyword">async</span> () =&gt; {
  loading.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
  items.<span class="hljs-property">value</span> = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchData</span>();
  loading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
});
</code></pre>
<h3 data-id="heading-60">æ»šåŠ¨åˆ°æŒ‡å®šä½ç½®</h3>
<p><strong>é—®é¢˜ï¼š</strong> å¦‚ä½•æ»šåŠ¨åˆ°æŒ‡å®šç´¢å¼•çš„é¡¹ç›®</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ–¹æ³• 1: è®¡ç®—æ»šåŠ¨ä½ç½®ï¼ˆå›ºå®šé«˜åº¦ï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">scrollToIndex</span> = (<span class="hljs-params">index</span>) =&gt; {
  <span class="hljs-keyword">const</span> scrollTop = index * itemHeight;
  container.<span class="hljs-property">value</span>.<span class="hljs-property">scrollTop</span> = scrollTop;
};

<span class="hljs-comment">// æ–¹æ³• 2: è®¡ç®—æ»šåŠ¨ä½ç½®ï¼ˆåŠ¨æ€é«˜åº¦ï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">scrollToIndex</span> = (<span class="hljs-params">index</span>) =&gt; {
  <span class="hljs-keyword">let</span> scrollTop = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; index; i++) {
    scrollTop += <span class="hljs-title function_">getItemHeight</span>(i);
  }
  container.<span class="hljs-property">value</span>.<span class="hljs-property">scrollTop</span> = scrollTop;
};

<span class="hljs-comment">// æ–¹æ³• 3: ä½¿ç”¨ scrollIntoView</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">scrollToIndex</span> = (<span class="hljs-params">index</span>) =&gt; {
  <span class="hljs-comment">// éœ€è¦åœ¨ list ä¸­æ‰¾åˆ°å¯¹åº”çš„å…ƒç´ </span>
  <span class="hljs-keyword">const</span> element = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">`[data-index="<span class="hljs-subst">${index}</span>"]`</span>);
  element?.<span class="hljs-title function_">scrollIntoView</span>({ <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>, <span class="hljs-attr">block</span>: <span class="hljs-string">'start'</span> });
};
</code></pre>
<h3 data-id="heading-61">æ•°æ®æ›´æ–°åæ»šåŠ¨ä½ç½®é‡ç½®</h3>
<p><strong>é—®é¢˜ï¼š</strong> æ•°æ®æ›´æ–°åæ»šåŠ¨ä½ç½®è·³å›é¡¶éƒ¨</p>
<p><strong>åŸå› ï¼š</strong> items å¼•ç”¨å˜åŒ–å¯¼è‡´é‡æ–°è®¡ç®—</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šç›´æ¥èµ‹å€¼æ–°æ•°ç»„</span>
items.<span class="hljs-property">value</span> = newData;  <span class="hljs-comment">// å¼•ç”¨å˜åŒ–ï¼Œæ»šåŠ¨ä½ç½®é‡ç½®</span>

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šä¿æŒå¼•ç”¨ï¼Œä¿®æ”¹å†…å®¹</span>
<span class="hljs-comment">// æ–¹æ³• 1: ä½¿ç”¨ splice</span>
items.<span class="hljs-property">value</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, items.<span class="hljs-property">value</span>.<span class="hljs-property">length</span>, ...newData);

<span class="hljs-comment">// æ–¹æ³• 2: é€é¡¹æ›´æ–°</span>
newData.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
  items.<span class="hljs-property">value</span>[index] = item;
});

<span class="hljs-comment">// æ–¹æ³• 3: è®°å½•å¹¶æ¢å¤æ»šåŠ¨ä½ç½®</span>
<span class="hljs-keyword">const</span> scrollTop = container.<span class="hljs-property">value</span>.<span class="hljs-property">scrollTop</span>;
items.<span class="hljs-property">value</span> = newData;
<span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
  container.<span class="hljs-property">value</span>.<span class="hljs-property">scrollTop</span> = scrollTop;
});
</code></pre>
<h3 data-id="heading-62">åœ¨ TypeScript ä¸­ä½¿ç”¨</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { ref, <span class="hljs-title class_">Ref</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { useVirtualList, <span class="hljs-title class_">UseVirtualListOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vueuse/core'</span>

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ListItem</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>
  description?: <span class="hljs-built_in">string</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-attr">items</span>: <span class="hljs-title class_">Ref</span>&lt;<span class="hljs-title class_">ListItem</span>[]&gt; = <span class="hljs-title function_">ref</span>([
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Item 1'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Item 2'</span> }
])

<span class="hljs-keyword">const</span> <span class="hljs-attr">options</span>: <span class="hljs-title class_">UseVirtualListOptions</span> = {
  <span class="hljs-attr">itemHeight</span>: <span class="hljs-number">50</span>,
  <span class="hljs-attr">overscan</span>: <span class="hljs-number">5</span>
}

<span class="hljs-keyword">const</span> { list, containerProps, wrapperProps } = <span class="hljs-title function_">useVirtualList</span>(items, options)

<span class="hljs-comment">// list çš„ç±»å‹æ˜¯ ComputedRef&lt;{ index: number; data: ListItem }[]&gt;</span>
</code></pre>
<h3 data-id="heading-63">æœåŠ¡ç«¯æ¸²æŸ“ (SSR) æ”¯æŒ</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœ¨ SSR ç¯å¢ƒä¸­ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</span>

<span class="hljs-comment">// 1. å®¹å™¨é«˜åº¦å¿…é¡»æ˜ç¡®</span>
&lt;div :style=<span class="hljs-string">"{ height: '400px' }"</span>&gt;  &lt;!-- <span class="hljs-variable constant_">SSR</span> éœ€è¦æ˜ç¡®é«˜åº¦ --&gt;

<span class="hljs-comment">// 2. é¿å…åœ¨æœåŠ¡ç«¯è®¡ç®—æ»šåŠ¨</span>
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">setupVirtualList</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> === <span class="hljs-string">'undefined'</span>) <span class="hljs-keyword">return</span>  <span class="hljs-comment">// SSR ç¯å¢ƒè·³è¿‡</span>
  
  <span class="hljs-keyword">const</span> { list, containerProps, wrapperProps } = <span class="hljs-title function_">useVirtualList</span>(...)
  <span class="hljs-keyword">return</span> { list, containerProps, wrapperProps }
}

<span class="hljs-comment">// 3. ä½¿ç”¨ ClientOnly ç»„ä»¶ï¼ˆNuxt.jsï¼‰</span>
&lt;<span class="hljs-title class_">ClientOnly</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">VirtualList</span> <span class="hljs-attr">:items</span>=<span class="hljs-string">"items"</span> /&gt;</span></span>
&lt;/<span class="hljs-title class_">ClientOnly</span>&gt;
</code></pre>
<hr/>
<h2 data-id="heading-64">æ€»ç»“ä¸å¯¹æ¯”è¡¨</h2>
<h3 data-id="heading-65">å››ç§æ–¹æ¡ˆå®Œæ•´å¯¹æ¯”</h3>











































































<table><thead><tr><th>ç‰¹æ€§</th><th>å›ºå®š+å›ºå®š</th><th>å›ºå®š+åŠ¨æ€</th><th>åŠ¨æ€+å›ºå®š</th><th>åŠ¨æ€+åŠ¨æ€</th></tr></thead><tbody><tr><td><strong>é¡¹ç›®é«˜åº¦</strong></td><td>å›ºå®šå€¼</td><td>å›ºå®šå€¼</td><td>å‡½æ•°è®¡ç®—</td><td>å‡½æ•°è®¡ç®—</td></tr><tr><td><strong>å®¹å™¨é«˜åº¦</strong></td><td>height</td><td>max-height</td><td>height</td><td>max-height</td></tr><tr><td><strong>overflow</strong></td><td>hidden</td><td>auto</td><td>hidden</td><td>auto</td></tr><tr><td><strong>itemHeight</strong></td><td><code>50</code></td><td><code>50</code></td><td><code>(i) =&gt; ...</code></td><td><code>(i) =&gt; ...</code></td></tr><tr><td><strong>æ€§èƒ½è¯„åˆ†</strong></td><td>5/5</td><td>5/5</td><td>4/5</td><td>4/5</td></tr><tr><td><strong>çµæ´»æ€§è¯„åˆ†</strong></td><td>2/5</td><td>3/5</td><td>4/5</td><td>5/5</td></tr><tr><td><strong>å®ç°éš¾åº¦</strong></td><td>ç®€å•</td><td>ç®€å•</td><td>ä¸­ç­‰</td><td>ä¸­ç­‰</td></tr><tr><td><strong>å…¸å‹åº”ç”¨</strong></td><td>è¡¨æ ¼</td><td>ä¸‹æ‹‰èœå•</td><td>å¡ç‰‡åˆ—è¡¨</td><td>å¤æ‚å¼¹çª—</td></tr><tr><td><strong>æ•°æ®é‡å»ºè®®</strong></td><td>æ— é™åˆ¶</td><td>æ— é™åˆ¶</td><td>&lt; 100,000</td><td>&lt; 100,000</td></tr></tbody></table>
<h3 data-id="heading-66">API å‚æ•°é€ŸæŸ¥è¡¨</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// useVirtualList é…ç½®</span>
<span class="hljs-keyword">const</span> { list, containerProps, wrapperProps } = <span class="hljs-title function_">useVirtualList</span>(items, {
  <span class="hljs-attr">itemHeight</span>: <span class="hljs-number">50</span> | (<span class="hljs-function">(<span class="hljs-params">index: number</span>) =&gt;</span> number),  <span class="hljs-comment">// å¿…éœ€</span>
  <span class="hljs-attr">overscan</span>: <span class="hljs-number">5</span>                                     <span class="hljs-comment">// å¯é€‰ï¼Œé»˜è®¤ 5</span>
})
</code></pre>
<h3 data-id="heading-67">å…³é”®ä»£ç ç‰‡æ®µé€ŸæŸ¥</h3>
<h4 data-id="heading-68">å›ºå®šé«˜åº¦é…ç½®</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">itemHeight</span>: <span class="hljs-number">50</span>
</code></pre>
<h4 data-id="heading-69">åŠ¨æ€é«˜åº¦é…ç½®</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">itemHeight</span>: <span class="hljs-function">(<span class="hljs-params">index</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> index % <span class="hljs-number">2</span> === <span class="hljs-number">0</span> ? <span class="hljs-number">60</span> : <span class="hljs-number">80</span>
}
</code></pre>
<h4 data-id="heading-70">å›ºå®šå®¹å™¨</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;div :style="{ height: '400px' }" v-bind="containerProps"&gt;
</code></pre>
<h4 data-id="heading-71">åŠ¨æ€å®¹å™¨</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;div :style="{ maxHeight: '400px' }" v-bind="containerProps"&gt;
</code></pre>
<h4 data-id="heading-72">å®Œæ•´æ¨¡æ¿ç»“æ„</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;div v-bind="containerProps" :style="{ height: '400px' }"&gt;
  &lt;div v-bind="wrapperProps"&gt;
    &lt;div v-for="item in list" :key="item.index"&gt;
      {{ item.data }}
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<hr/>
<h2 data-id="heading-73">å‚è€ƒèµ„æº</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvueuse.org%2F" target="_blank" title="https://vueuse.org/" ref="nofollow noopener noreferrer">VueUse å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvueuse.org%2Fcore%2FuseVirtualList%2F" target="_blank" title="https://vueuse.org/core/useVirtualList/" ref="nofollow noopener noreferrer">useVirtualList API</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2F" target="_blank" title="https://vuejs.org/" ref="nofollow noopener noreferrer">Vue 3 å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FPerformance%2FVirtualization" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/Performance/Virtualization" ref="nofollow noopener noreferrer">è™šæ‹Ÿæ»šåŠ¨åŸç†</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FIntersection_Observer_API" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API" ref="nofollow noopener noreferrer">Intersection Observer API</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAkryum%2Fvue-virtual-scroller" target="_blank" title="https://github.com/Akryum/vue-virtual-scroller" ref="nofollow noopener noreferrer">vue-virtual-scroller</a> - åŠŸèƒ½æ›´å¼ºå¤§ï¼Œæ”¯æŒçœŸæ­£çš„åŠ¨æ€é«˜åº¦</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbvaughn%2Freact-window" target="_blank" title="https://github.com/bvaughn/react-window" ref="nofollow noopener noreferrer">react-window</a> - React ç”Ÿæ€çš„è™šæ‹Ÿåˆ—è¡¨åº“ï¼ˆå‚è€ƒå¯¹æ¯”ï¼‰</li>
</ul>
<h2 data-id="heading-74">å®Œæ•´é¡¹ç›®ç»“æ„</h2>
<pre><code class="hljs language-csharp" lang="csharp">vue3-sample/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ FixedHeightVirtualList.vue       <span class="hljs-meta"># å›ºå®š+å›ºå®š</span>
â”‚   â”‚   â”œâ”€â”€ DynamicHeightVirtualList.vue     <span class="hljs-meta"># å›ºå®š+åŠ¨æ€</span>
â”‚   â”‚   â”œâ”€â”€ VariableHeightVirtualList.vue    <span class="hljs-meta"># åŠ¨æ€+å›ºå®š</span>
â”‚   â”‚   â””â”€â”€ FullyDynamicVirtualList.vue      <span class="hljs-meta"># åŠ¨æ€+åŠ¨æ€</span>
â”‚   â”œâ”€â”€ App.vue                               <span class="hljs-meta"># ä½¿ç”¨ç¤ºä¾‹</span>
â”‚   â””â”€â”€ main.js
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ <span class="hljs-keyword">virtual</span>-list-guide.md                 <span class="hljs-meta"># æœ¬æ–‡æ¡£</span>
â”œâ”€â”€ package.json
â””â”€â”€ README.md
</code></pre>
<h2 data-id="heading-75">å¿«é€Ÿå¼€å§‹</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. å…‹éš†é¡¹ç›®</span>
git <span class="hljs-built_in">clone</span> https://github.com/ilcherry/virtuallist-examples

<span class="hljs-comment"># 2. å®‰è£…ä¾èµ–</span>
<span class="hljs-built_in">cd</span> vue3-sample
pnpm install

<span class="hljs-comment"># 3. è¿è¡Œå¼€å‘æœåŠ¡å™¨</span>
pnpm dev

<span class="hljs-comment"># 4. è®¿é—®</span>
<span class="hljs-comment"># æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:5173</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7713a4ca37da45889fc95437abf5910a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Iez566A566A:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763345274&amp;x-signature=a0IXGeB36N62EduHDm7pdDQ21lw%3D" alt="localhost_5173_.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Cursor æ— æ³•è·¨é¡¹ç›®è¯»å–æºç æ€ä¹ˆåŠï¼ŸMCP Easy Code Reader å¸®ä½ è§£å†³ï¼]]></title>    <link>https://juejin.cn/post/7570405675432935424</link>    <guid>https://juejin.cn/post/7570405675432935424</guid>    <pubDate>2025-11-10T00:17:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570405675432935424" data-draft-id="7569909335908761609" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Cursor æ— æ³•è·¨é¡¹ç›®è¯»å–æºç æ€ä¹ˆåŠï¼ŸMCP Easy Code Reader å¸®ä½ è§£å†³ï¼"/> <meta itemprop="keywords" content="åç«¯,Cursor,MCP"/> <meta itemprop="datePublished" content="2025-11-10T00:17:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ–¹åœ†æƒ³å½“å›¾çµ"/> <meta itemprop="url" content="https://juejin.cn/user/386633160473101"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Cursor æ— æ³•è·¨é¡¹ç›®è¯»å–æºç æ€ä¹ˆåŠï¼ŸMCP Easy Code Reader å¸®ä½ è§£å†³ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/386633160473101/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ–¹åœ†æƒ³å½“å›¾çµ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T00:17:35.000Z" title="Mon Nov 10 2025 00:17:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    102
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ <strong>æ–¹åœ†</strong>ã€‚æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç» MCP Server <strong>Easy Code Reader</strong>ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ åœ¨ä½¿ç”¨ Cursor/VSCode/IDEA ç¼–å†™ä»£ç æ—¶ï¼Œæ ¹æ®è°ƒç”¨é“¾è·¯å°†å¤šä¸ªé¡¹ç›®æˆ– Jar åŒ…ä¸­ç›¸å…³çš„ä»£ç è¯»å–åˆ°ä¸Šä¸‹æ–‡ä¸­ï¼Œä¾› Code Agent å¸®æˆ‘ä»¬åˆ†æé€»è¾‘å’Œç¼–å†™ä»£ç ï¼Œè€Œæ— éœ€å†æ‰‹åŠ¨å°†æºç å¤åˆ¶åˆ°å¯¹è¯æ¡†ä¸­å‘é€ç»™ AIï¼Œæé«˜ Code Agent å‡†ç¡®åº¦å’Œç¼–ç æ•ˆç‡ã€‚MCP å·²å‘å¸ƒ Github å’Œ MCP.soï¼Œæ¬¢è¿å¤§å®¶å‰å¾€ä¸‹è½½ä½¿ç”¨ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFangYuan33%2Feasy-code-reader" target="_blank" title="https://github.com/FangYuan33/easy-code-reader" ref="nofollow noopener noreferrer">Github: easy-code-reader</a>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFangYuan33%2Feasy-code-reader" target="_blank" title="https://github.com/FangYuan33/easy-code-reader" ref="nofollow noopener noreferrer">github.com/FangYuan33/â€¦</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmcp.so%2Fserver%2Feasy-code-reader%2FFangYuan33" target="_blank" title="https://mcp.so/server/easy-code-reader/FangYuan33" ref="nofollow noopener noreferrer">MCP.so: Easy Code Reader</a>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fmcp.so%2Fserver%2Feasy-code-reader%2FFangYuan33" target="_blank" title="https://mcp.so/server/easy-code-reader/FangYuan33" ref="nofollow noopener noreferrer">mcp.so/server/easyâ€¦</a></li>
</ul>
<p>åœ¨ä»‹ç»å¦‚ä½•æ¥å…¥ Easy Code Reader ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å®ƒåˆ°åº•èƒ½åšä»€ä¹ˆï¼š</p>
<h3 data-id="heading-0">Easy Code Reader æœ€ä½³å®è·µ</h3>
<p>Easy Code Reader ç‰¹åˆ«é€‚åˆä¸ Claudeã€ChatGPT ç­‰å¤§æ¨¡å‹é…åˆä½¿ç”¨ï¼Œæ¥ä¸‹æ¥ä»¥ Copilot Code Agent ç»“åˆ Claude4.5 æ¨¡å‹ä¸ºä¾‹ï¼Œä»‹ç»ä¸€äº›æœ€ä½³å®è·µï¼š</p>
<h4 data-id="heading-1">1. è·¨é¡¹ç›®è°ƒç”¨ï¼Œæ ¹æ®è°ƒç”¨é“¾è·¯åˆ†ææºç </h4>
<p>åœ¨æ¯”è¾ƒå¤æ‚çš„é¡¹ç›®ä¸­ä¸€èˆ¬ä¼šæ‹†åˆ†å¤šä¸ªå¾®æœåŠ¡ï¼ŒæŸäº›åŠŸèƒ½çš„å®ç°å¯èƒ½ä¼šè·¨å¤šä¸ªé¡¹ç›®è°ƒç”¨ï¼Œå¦‚æœé äººæ¢³ç†ç›¸å…³é€»è¾‘ä¼šæ¯”è¾ƒè€—æ—¶ï¼Œæ‰€ä»¥å¯ä»¥å°†æ¶‰åŠçš„ä»£ç  clone åˆ°æœ¬åœ°åä½¿ç”¨ Easy Code Reader MCP å¹¶ç»“åˆ Code Agent è¿›è¡Œåˆ†æã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä»¥ Nacos é¡¹ç›®ä¸ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬æƒ³äº†è§£ Nacos çš„æœåŠ¡æ³¨å†ŒåŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</p>
<p>é¦–å…ˆï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª Nacos Client å®¢æˆ·ç«¯ï¼Œåœ¨è¿™æ®µé€»è¾‘ä¸­æ‰§è¡ŒæœåŠ¡æ³¨å†Œï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(Main.class);

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NacosException, InterruptedException {
        logger.info(<span class="hljs-string">"å¼€å§‹åˆå§‹åŒ– Nacos å®¢æˆ·ç«¯..."</span>);

        <span class="hljs-type">Properties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
        properties.put(PropertyKeyConst.SERVER_ADDR, <span class="hljs-string">"127.0.0.1:8848"</span>);
        properties.put(PropertyKeyConst.NAMESPACE, <span class="hljs-string">"7430d8fe-99ce-4b20-866e-ed021a0652c9"</span>);

        <span class="hljs-type">NamingService</span> <span class="hljs-variable">namingService</span> <span class="hljs-operator">=</span> NacosFactory.createNamingService(properties);

        System.out.println(<span class="hljs-string">"=== æ³¨å†ŒæœåŠ¡å®ä¾‹ ==="</span>);
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ³¨å†Œä¸€ä¸ªæœåŠ¡å®ä¾‹</span>
            namingService.registerInstance(<span class="hljs-string">"test-service0"</span>, <span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">8080</span>);
            <span class="hljs-comment">// æ·»åŠ äº‹ä»¶ç›‘å¬å™¨</span>
            namingService.subscribe(<span class="hljs-string">"test-service"</span>, event -&gt; {
                System.out.println(<span class="hljs-string">"æœåŠ¡å®ä¾‹å˜åŒ–: "</span> + event);
            });
        } <span class="hljs-keyword">catch</span> (Exception e) {
            System.out.println(<span class="hljs-string">"æœåŠ¡æ³¨å†Œå¤±è´¥(é¢„æœŸï¼Œå› ä¸ºæœåŠ¡å™¨å¯èƒ½æœªå¯åŠ¨): "</span> + e.getMessage());
        }

        TimeUnit.HOURS.sleep(<span class="hljs-number">3</span>);
    }
}
</code></pre>
<p>å› ä¸ºæˆ‘ä»¬åˆ›å»º Nacos Client æ‰§è¡ŒæœåŠ¡æ³¨å†Œæ—¶æ˜¯ç”± Nacos æä¾›çš„ SDK ç›´æ¥è°ƒç”¨ <code>NamingService#registerInstance</code> æ–¹æ³•å®ç°çš„ï¼Œæˆ‘ä»¬å¹¶ä¸æ¸…æ¥šåº•å±‚æ˜¯å¦‚ä½•å®ç°çš„ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦äº†è§£å®ç°ç»†èŠ‚ï¼Œé‚£ä¹ˆå¯ä»¥å°† Nacos çš„æºç  Clone ä¸‹æ¥ï¼Œå¹¶ä½¿ç”¨ Easy Code Reader è¯»å–ç›¸å…³æºç ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ Promptï¼š</p>
<pre><code class="hljs language-text" lang="text">ä½ æ˜¯ä¸€ä½ Java ä¸“å®¶ï¼Œè¯·ä½ å¸®æˆ‘åˆ†æ #file:Main.java ä¸­ namingService.registerInstance æ–¹æ³•çš„é€»è¾‘ï¼Œè¿™æ®µé€»è¾‘çš„å®ç°åœ¨æœ¬åœ°é¡¹ç›®çš„ nacos ä¸­ï¼Œæ‰€ä»¥ä½ éœ€è¦åœ¨ nacos è¯»å–ä¸€ç³»åˆ—ç›¸å…³çš„æºç æ‰èƒ½äº†è§£å®ƒçš„æ ¸å¿ƒé€»è¾‘ï¼Œè¯»å– nacos é¡¹ç›®çš„ä»£ç ä½ å¯ä»¥å€ŸåŠ© easy-code-reader MCPï¼Œå…¶ä¸­åŒ…å«ä½ å¯ä»¥è·å–é¡¹ç›®ä¿¡æ¯ã€é¡¹ç›®ä¸­æ‰€æœ‰çš„æ–‡ä»¶ä¿¡æ¯å’ŒæŸä¸ªæ–‡ä»¶çš„å·¥å…·
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6be97ddfbf9741beb2a970d0add5d12d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pa55ZyG5oOz5b2T5Zu-54G1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763427930&amp;x-signature=be2xGWHfCln7%2BByZcuXPYDNBI28%3D" alt="img.png" loading="lazy"/></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œå®ƒä¼šä¸æ–­åœ°æ ¹æ®æºç è°ƒç”¨é“¾è·¯ï¼Œè¯»å–ç›¸å…³æºç å¹¶è¿›è¡Œåˆ†æï¼Œæœ€ç»ˆæˆ‘ä»¬å°±èƒ½äº†è§£æœåŠ¡æ³¨å†Œçš„å®ç°ç»†èŠ‚ï¼Œä¼šä½¿ç”¨åˆ° MCP Easy Code Reader æä¾›çš„å¤šä¸ªå·¥å…· <code>list_all_project</code>ã€<code>list_project_files</code> å’Œ <code>read_project_code</code>ï¼Œ å…·ä½“è°ƒç”¨ç»†èŠ‚å›¾ç¤ºå¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/199bdefe268e44239bf176494d5e5629~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pa55ZyG5oOz5b2T5Zu-54G1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763427930&amp;x-signature=BMAcqma6TG3bAiLSWchFWWiY7sc%3D" alt="image.png" loading="lazy"/></p>
<p>æœ€ç»ˆå¾—åˆ°åˆ†æç»“æœï¼ŒèŠ‚çœå¾ˆå¤šæ—¶é—´ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e6272d0af8547a7a8904df6ab85419d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pa55ZyG5oOz5b2T5Zu-54G1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763427930&amp;x-signature=5JtLHqWBDU%2FXPNnGomiHvxLNJGY%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-2">2. é˜…è¯» jar åŒ…æºç ï¼Œæ ¹æ®æºç å®Œæˆä»£ç ç¼–å†™</h4>
<p>åœ¨ä½¿ç”¨ç¬¬ä¸‰æ–¹æˆ–å…¶ä»–å¤–éƒ¨ä¾èµ–æ—¶ï¼ŒCopilot æˆ–å…¶ä»– Code Agent å¹¶ä¸èƒ½ç›´æ¥è¯»å– jar åŒ…ä¸­çš„æºç ï¼Œå¾€å¾€éœ€è¦æˆ‘ä»¬å°†æºç å†…å®¹æ‰‹åŠ¨å¤åˆ¶åˆ°æç¤ºè¯ä¸­æ‰èƒ½å®Œæˆï¼Œè´¹æ—¶è´¹åŠ›ã€‚åœ¨ Easy Code Reader ä¸­æä¾›äº† <code>read_jar_source</code> å·¥å…·æ¥è¯»å– jar åŒ…ä¸­çš„æºç ï¼Œå¸®æˆ‘ä»¬å®Œæˆå¼€å‘å®ç°ã€‚æˆ‘ä»¬è¿˜æ˜¯ä»¥å¦‚ä¸‹ä»£ç ä¸ºä¾‹ï¼Œç°åœ¨æˆ‘æƒ³å®ç°å¤šä¸ªæœåŠ¡å®ä¾‹çš„æ³¨å†Œï¼Œä½†æ˜¯æˆ‘åˆä¸äº†è§£ <code>NamingService</code> çš„å®ç°ï¼Œä¾¿å¯ä»¥å€ŸåŠ© <code>read_jar_source</code> æ¥å®Œæˆï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(Main.class);

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NacosException, InterruptedException {
        logger.info(<span class="hljs-string">"å¼€å§‹åˆå§‹åŒ– Nacos å®¢æˆ·ç«¯..."</span>);

        <span class="hljs-type">Properties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
        properties.put(PropertyKeyConst.SERVER_ADDR, <span class="hljs-string">"127.0.0.1:8848"</span>);
        properties.put(PropertyKeyConst.NAMESPACE, <span class="hljs-string">"7430d8fe-99ce-4b20-866e-ed021a0652c9"</span>);

        <span class="hljs-type">NamingService</span> <span class="hljs-variable">namingService</span> <span class="hljs-operator">=</span> NacosFactory.createNamingService(properties);

        System.out.println(<span class="hljs-string">"=== æ³¨å†ŒæœåŠ¡å®ä¾‹ ==="</span>);
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ³¨å†Œä¸€ä¸ªæœåŠ¡å®ä¾‹</span>
            namingService.registerInstance(<span class="hljs-string">"test-service0"</span>, <span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">8080</span>);
            <span class="hljs-comment">// æ·»åŠ äº‹ä»¶ç›‘å¬å™¨</span>
            namingService.subscribe(<span class="hljs-string">"test-service"</span>, event -&gt; {
                System.out.println(<span class="hljs-string">"æœåŠ¡å®ä¾‹å˜åŒ–: "</span> + event);
            });
            <span class="hljs-comment">// æ³¨å†Œå¤šä¸ªæœåŠ¡å®ä¾‹</span>

        } <span class="hljs-keyword">catch</span> (Exception e) {
            System.out.println(<span class="hljs-string">"æœåŠ¡æ³¨å†Œå¤±è´¥(é¢„æœŸï¼Œå› ä¸ºæœåŠ¡å™¨å¯èƒ½æœªå¯åŠ¨): "</span> + e.getMessage());
        }

        TimeUnit.HOURS.sleep(<span class="hljs-number">3</span>);
    }
}
</code></pre>
<pre><code class="hljs language-text" lang="text">ä½ æ˜¯ä¸€ä½ Java æŠ€æœ¯ä¸“å®¶ï¼Œç²¾é€š Nacos æ¡†æ¶ï¼Œè¯·ä½ å¸®æˆ‘åœ¨ #file:Main.java ä¸­å®Œæˆæ³¨å†Œå¤šä¸ªæœåŠ¡å®ä¾‹çš„é€»è¾‘ï¼Œåœ¨ç¼–å†™ä»£ç å‰ï¼Œä½ éœ€è¦å…ˆä½¿ç”¨ easy-code-reader çš„ read_jar_source å·¥å…·è¯»å– com.alibaba.nacos.api.naming.NamingService çš„æºç ä¿¡æ¯æ¥äº†è§£æ³¨å†Œå¤šä¸ªæœåŠ¡å®ä¾‹çš„æ–¹æ³•
</code></pre>
<p>å¤„ç†è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5660f4ee0073455cb83fed66a7dd0658~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pa55ZyG5oOz5b2T5Zu-54G1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763427930&amp;x-signature=W4sOhDWciJmY5HLfkXj4BmGmM%2Bo%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™æ ·æˆ‘ä»¬ä¾¿èƒ½å¤Ÿå¿«é€Ÿåœ°äº†è§£ <code>NamingService</code> çš„å®ç°ç»†èŠ‚ï¼Œä»è€Œå®Œæˆä»£ç ç¼–å†™å·¥ä½œï¼ŒèŠ‚çœäº†å¤§é‡æ—¶é—´ã€‚</p>
<h4 data-id="heading-3">3. è·¨é¡¹ç›®é˜…è¯»æºç ï¼Œæ ¹æ®æºç å®Œæˆæœ¬é¡¹ç›®å®ç°</h4>
<p>åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼ŒæŸäº›åŠŸèƒ½çš„å®ç°å¯èƒ½ä¼šè·¨å¤šä¸ªæ¨¡å—æˆ–å¾®æœåŠ¡ï¼Œå¦‚æœéƒ¨åˆ†é€»è¾‘å·²ç»å®ç°å¹¶ä¸”åç»­å…¶ä»–åº”ç”¨çš„é€»è¾‘éœ€è¦ä¾èµ–è¿™éƒ¨åˆ†é€»è¾‘æ—¶ï¼Œå¯ä»¥å€ŸåŠ© Easy Code Reader è¯»å–ç›¸å…³æ¨¡å—çš„æºç ï¼Œå¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£å’Œå®ç°å½“å‰é¡¹ç›®çš„åŠŸèƒ½ï¼Œç¤ºä¾‹ Prompt å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-text" lang="text">ä½ æ˜¯ä¸€ä½ Java æŠ€æœ¯ä¸“å®¶ï¼Œç°åœ¨æˆ‘è¦å®ç° XXX çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿™éƒ¨åˆ†é€»è¾‘çš„å®ç°éœ€è¦è°ƒç”¨æœ¬åœ°é¡¹ç›® A ä¸­ XXX çš„æ¥å£åŠå…¶å®ç°ï¼Œè¯·ä½ å€ŸåŠ© MCP easy-code-reader æ¥å¸®æˆ‘è¯»å– A é¡¹ç›®ä¸­çš„æºç ï¼Œå¹¶å¸®æˆ‘å®ç° XXX çš„ä¸šåŠ¡é€»è¾‘
</code></pre>
<p>å½“ç„¶é™¤äº†è¿™ä¸‰ç§åº”ç”¨åœºæ™¯ä»¥å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ Easy Code Reader å®Œæˆä»¥ä¸‹äº‹é¡¹ï¼š</p>
<ul>
<li><strong>å¼‚å¸¸é—®é¢˜å¿«é€Ÿæº¯æº</strong>ï¼šå¦‚æœæœ‰å¼‚å¸¸ä¿¡æ¯æ˜¯å¤–éƒ¨ jar åŒ…ä¾èµ–ä¸­æŠ›å‡ºæ¥çš„ï¼Œå¯ä»¥ä½¿ç”¨ <code>read_jar_source</code> å·¥å…·æ ¹æ®å¼‚å¸¸å †æ ˆæ—¥å¿—å¿«é€Ÿå®šä½å¼‚å¸¸ç‚¹</li>
<li><strong>ä¾èµ–å‡çº§å½±å“è¯„ä¼°ï¼ˆæ—§/æ–°ç‰ˆæœ¬å·®å¼‚æ ¸å¯¹ï¼‰</strong>ï¼šåŒæ ·æ˜¯ä½¿ç”¨ <code>read_jar_source</code> å·¥å…·æ¥å®Œæˆæ–°æ—§ç‰ˆæœ¬çš„å®ç°å·®å¼‚ï¼Œè¯„ä¼°å‡çº§å½±å“</li>
<li><strong>ä¸šåŠ¡ä»£ç é€»è¾‘è¯„å®¡</strong>ï¼šå¦‚æœä¸šåŠ¡é€»è¾‘å¼€å‘å®ç°åœ¨å¤šä¸ªé¡¹ç›®ä¸­ï¼Œå¯ä»¥å€ŸåŠ©è¯»å–æœ¬åœ°é¡¹ç›®ä»£ç çš„å·¥å…· <code>list_all_project</code>ã€<code>list_project_files</code> å’Œ <code>read_project_code</code>ï¼Œæ¥åˆ†ææ–°å¢çš„é€»è¾‘æ˜¯å¦æ»¡è¶³ä¸šåŠ¡è¦æ±‚</li>
<li><strong>æ–°äººå¿«é€Ÿä¸Šæ‰‹å¤šä¸ªå¾®æœåŠ¡</strong>ï¼šå€ŸåŠ©è¯»å–æœ¬åœ°é¡¹ç›®ä»£ç çš„å·¥å…·ï¼Œå¯ä»¥æ ¹æ®æ¥å£è°ƒç”¨é“¾è·¯å¿«é€Ÿç†æ¸…å¾®æœåŠ¡é¡¹ç›®ä»£ç ä¹‹é—´çš„å…³ç³»ï¼Œæé«˜ä¸Šæ‰‹é€Ÿåº¦</li>
</ul>
<hr/>
<p>æ—¢ç„¶å®ƒæœ‰è¿™ä¹ˆå¤šçš„åº”ç”¨åœºæ™¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•æ¥å…¥ Easy Code Reader å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹æ¥å…¥æ­¥éª¤ï¼š</p>
<p><a id="user-content-quick-start-uvx" title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="/></p>
<h3 data-id="heading-4">å¿«é€Ÿæ¥å…¥ï¼ˆæ–¹æ³•ä¸€ï¼‰ï¼šä½¿ç”¨ uvxï¼ˆæ¨è - å¼€ç®±å³ç”¨ï¼‰</h3>
<p>å®ƒçš„ç¯å¢ƒè¦æ±‚å¦‚ä¸‹ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fastral-sh%2Fuv" target="_blank" title="https://github.com/astral-sh/uv" ref="nofollow noopener noreferrer">uv</a> - Python åŒ…å’Œé¡¹ç›®ç®¡ç†å·¥å…·</li>
<li>Python 3.10 æˆ–æ›´é«˜ç‰ˆæœ¬</li>
<li>Java Development Kit (JDK) - ç”¨äºè¿è¡Œåç¼–è¯‘å™¨ï¼Œè¦æ±‚è‡³å°‘ Java 8</li>
</ul>
<p>å¦‚æœæ‚¨è¿˜æ²¡æœ‰å®‰è£… uvï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¿«é€Ÿå®‰è£…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS/Linux</span>
curl -LsSf https://astral.sh/uv/install.sh | sh

<span class="hljs-comment"># Windows</span>
powershell -c <span class="hljs-string">"irm https://astral.sh/uv/install.ps1 | iex"</span>

<span class="hljs-comment"># æˆ–ä½¿ç”¨ pip</span>
pip install uv
</code></pre>
<p>æˆ–è€…å‚è€ƒ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fastral-sh%2Fuv" target="_blank" title="https://github.com/astral-sh/uv" ref="nofollow noopener noreferrer">uv å®˜ç½‘</a> è¿›è¡Œå®‰è£…ï¼Œå¹¶é…ç½® uv çš„å®‰è£…è·¯å¾„æ·»åŠ åˆ°ç³»ç»Ÿ PATH ä¸­ï¼Œä»¥ä¾¿å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>uvx</code> å‘½ä»¤ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fastral-sh%2Fuv" target="_blank" title="https://github.com/astral-sh/uv" ref="nofollow noopener noreferrer">uv</a> æ˜¯ä¸€ä¸ªæå¿«çš„ Python åŒ…å’Œé¡¹ç›®ç®¡ç†å·¥å…·ã€‚ä½¿ç”¨ <code>uvx</code> å¯ä»¥æ— éœ€é¢„å…ˆå®‰è£…ï¼Œç›´æ¥è¿è¡Œï¼Œå‚è€ƒä»¥ä¸‹ MCP å®¢æˆ·ç«¯é…ç½®ï¼š</p>
<ul>
<li><code>--maven-repo</code>: æŒ‡å®š Maven ä»“åº“è·¯å¾„ï¼Œå°† <code>/custom/path/to/maven/repository</code> å†…å®¹æ›¿æ¢ä¸ºæœ¬åœ° Maven ä»“åº“è·¯å¾„å³å¯ï¼Œä¸é…ç½®é»˜è®¤ä½¿ç”¨ <strong>MAVEN_HOME</strong> ç›®å½•æˆ– <code>~/.m2/repository</code></li>
<li><code>--project-dir</code>: æŒ‡å®šæœ¬åœ°é¡¹ç›®ç›®å½•è·¯å¾„ï¼Œå°† <code>/customer/path/to/project-dir</code> æ›¿æ¢ä¸ºå®é™…ä¿å­˜æ‰€æœ‰é¡¹ç›®çš„è·¯å¾„</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"easy-code-reader"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"uvx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"easy-code-reader"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"--maven-repo"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"/custom/path/to/maven/repository"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"--project-dir"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"/customer/path/to/project-dir"</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å°†ä»¥ä¸Šå†…å®¹é…ç½®å¥½åï¼ŒAI åŠ©æ‰‹å³å¯é€šè¿‡ MCP åè®®è°ƒç”¨ Easy Code Reader æä¾›çš„å·¥å…·ï¼Œå®Œæˆå¤šé¡¹ç›®ã€å¤šä¾èµ–çš„ Java æºä»£ç è¯»å–å·¥ä½œã€‚</p>
<h3 data-id="heading-5">å¿«é€Ÿæ¥å…¥ï¼ˆæ–¹æ³•äºŒï¼‰ï¼šä½¿ç”¨ uv å®‰è£…åˆ°æœ¬åœ°ï¼ˆä¸æ¨èï¼‰</h3>
<p>å¦‚æœä½¿ç”¨ <strong>å¿«é€Ÿæ¥å…¥ï¼ˆæ–¹æ³•ä¸€ï¼‰</strong> å®‰è£…è¿è¡Œå¤±è´¥ï¼Œé‚£ä¹ˆå¯ä»¥é‡‡ç”¨ç›´æ¥å®‰è£…åˆ°æœ¬åœ°çš„æ–¹æ³•ï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">uv tool install easy-code-reader
</code></pre>
<p>å®‰è£…æˆåŠŸåï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤è·å–å®‰è£…ç›®å½•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">which</span> easy-code-reader
</code></pre>
<p>æ¯”å¦‚ï¼Œè¾“å‡ºç»“æœæ˜¯ï¼š/Users/fangyuan/.local/bin/easy-code-readerï¼Œé‚£ä¹ˆéœ€è¦æŒ‰ç…§å¦‚ä¸‹æ–¹å¼é…ç½® MCP å®¢æˆ·ç«¯ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"easy-code-reader"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/Users/fangyuan/.local/bin/easy-code-reader"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"--maven-repo"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"/custom/path/to/maven/repository"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"--project-dir"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"/customer/path/to/project-dir"</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ä¸€èˆ¬è¿™æ ·æ“ä½œéƒ½èƒ½å®Œæˆå®‰è£…ï¼Œåç»­å¦‚æœæœ‰ç‰ˆæœ¬æ›´æ–°ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå‡çº§ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">uv tool install --upgrade easy-code-reader
</code></pre>
<h3 data-id="heading-6">å¸¸è§é—®é¢˜</h3>
<h4 data-id="heading-7">Q1: spawn uvx ENOENT spawn uvx ENOENT</h4>
<p>uv å‘½ä»¤æœªæ‰¾åˆ°ï¼Œç¡®ä¿å·²æ­£ç¡®å®‰è£… uv å¹¶å°†å…¶è·¯å¾„æ·»åŠ åˆ°ç³»ç»Ÿ PATH ä¸­ï¼Œå‚è€ƒ <a href="#quick-start-uvx" title="#quick-start-uvx">å¿«é€Ÿæ¥å…¥ï¼ˆæ–¹æ³•ä¸€ï¼‰</a>ï¼Œå¹¶å°è¯•é‡å¯ IDE åå†å¯åŠ¨ MCP Serverã€‚</p>
<hr/>
<p>ä»¥ä¸Šå†…å®¹å°±æ˜¯ MCP Easy Code Reader çš„ä»‹ç»å’Œæ¥å…¥æ–¹æ³•ï¼Œæ¥ä¸‹æ¥çš„å†…å®¹ä¸»è¦ä»‹ç»ä¸€ä¸‹å®ƒçš„å®ç°åŸç†ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ç»§ç»­å¾€ä¸‹çœ‹ã€‚</p>
<h3 data-id="heading-8">Easy Code Reader å®ç°åŸç†</h3>
<p>å…¶å®ç¼–å†™ä¸€ä¸ª MCP Server å¹¶ä¸å¤æ‚ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒè¿™ç¯‡ Github ä¸Šçš„æ–‡ç«  <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FliaokongVFX%2FMCP-Chinese-Getting-Started-Guide" target="_blank" title="https://github.com/liaokongVFX/MCP-Chinese-Getting-Started-Guide" ref="nofollow noopener noreferrer">Model Context Protocol(MCP) ç¼–ç¨‹æé€Ÿå…¥é—¨</a>ã€‚Easy Code Reader é€šè¿‡ Python è¯­è¨€å®ç°ï¼Œå®ƒæä¾›äº† 4 ä¸ªä¸»è¦å·¥å…·æ¥ååŒå®Œæˆæºç è¯»å–å·¥ä½œï¼š</p>
<ol>
<li><code>list_all_project</code>: <strong>åˆ—å‡ºæ‰€æœ‰æœ¬åœ°é¡¹ç›®</strong>ï¼Œè¿™ä¸ªå·¥å…·èƒ½å°†é…ç½®çš„é¡¹ç›®ç›®å½• <code>--project-dir</code> ä¸‹æ‰€æœ‰çš„æ–‡ä»¶å¤¹éƒ½è¯»å–å‡ºæ¥ï¼Œæ¯ä¸ªæ–‡ä»¶å¤¹ä»£è¡¨ä¸€ä¸ªé¡¹ç›®ï¼Œè¿™æ · Code Agent ä¾¿èƒ½æ ¹æ®é¡¹ç›®åç§°æ¥é€‰æ‹©éœ€è¦è¯»å–çš„é¡¹ç›®</li>
<li><code>list_project_files</code>: <strong>åˆ—å‡ºæŒ‡å®šé¡¹ç›®ä¸­çš„æ‰€æœ‰æ–‡ä»¶å</strong>ï¼Œè¿™ä¸ªå·¥å…·èƒ½å°†æŒ‡å®šé¡¹ç›®ä¸‹çš„æ‰€æœ‰æºç æ–‡ä»¶åéƒ½è¯»å–å‡ºæ¥ï¼ŒCode Agent ä¾¿èƒ½æ ¹æ®è°ƒç”¨é“¾è·¯é€‰æ‹©éœ€è¦è¯»å–çš„æ–‡ä»¶</li>
<li><code>read_project_code</code>: <strong>è¯»å–æŒ‡å®šé¡¹ç›®ä¸­çš„æŸä¸ªæ–‡ä»¶æºç </strong>ï¼Œé€šè¿‡ä»¥ä¸Šä¸¤ä¸ªå·¥å…·ï¼ŒCode Agent èƒ½å¤Ÿå®šä½åˆ°éœ€è¦è¯»å–çš„æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªå·¥å…·å°†æºç å†…å®¹è¯»å–å‡ºæ¥ï¼Œä¾› Code Agent è¿›è¡Œåˆ†æ</li>
<li><code>read_jar_source</code>: <strong>è¯»å–æŒ‡å®š jar åŒ…ä¸­çš„æŸä¸ªç±»æºç </strong>ï¼Œå¦‚æœè°ƒç”¨é“¾è·¯ä¸­æœ‰å¤–éƒ¨ jar åŒ…ä¾èµ–çš„è¯ï¼ŒCode Agent ä¾¿å¯ä»¥ä½¿ç”¨è¿™ä¸ªå·¥å…·å°† jar åŒ…ä¸­çš„æºç è¯»å–å‡ºæ¥ï¼Œä¾›åˆ†æå’Œç¼–å†™ä»£ç </li>
</ol>
<p>è¿™å››ä¸ªå·¥å…·ååŒå·¥ä½œï¼Œä¾¿èƒ½å®ç°è·¨é¡¹ç›®ã€å¤šä¾èµ–çš„æºç è¯»å–å·¥ä½œï¼Œå¸®åŠ© Code Agent æ›´å¥½åœ°ç†è§£ä»£ç é€»è¾‘ï¼Œä»è€Œæé«˜ä»£ç ç¼–å†™æ•ˆç‡å’Œå‡†ç¡®åº¦ï¼Œä»¥ä¸‹æ˜¯ MCP Tool å®ç°çš„æŠ€æœ¯ç»†èŠ‚ï¼š</p>
<h4 data-id="heading-9">list_all_project</h4>
<p>åˆ—ä¸¾é¡¹ç›®ç›®å½•ä¸‹æ‰€æœ‰çš„é¡¹ç›®æ–‡ä»¶å¤¹åç§°ã€‚</p>
<p><strong>ç”¨é€”ï¼š</strong></p>
<ul>
<li>æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„é¡¹ç›®</li>
<li>å½“è¾“å…¥ä¸å®Œæ•´çš„é¡¹ç›®åæ—¶ï¼Œå¸®åŠ©æ¨ç†å‡ºæœ€æ¥è¿‘çš„é¡¹ç›®å</li>
<li>éªŒè¯é¡¹ç›®æ˜¯å¦å­˜åœ¨</li>
<li>æ”¯æŒé¡¹ç›®åç§°æ¨¡ç³ŠåŒ¹é…ï¼Œå¿«é€ŸæŸ¥æ‰¾ç‰¹å®šé¡¹ç›®</li>
</ul>
<p><strong>å‚æ•°ï¼š</strong></p>
<ul>
<li><code>project_dir</code> (å¯é€‰): é¡¹ç›®ç›®å½•è·¯å¾„ï¼Œå¦‚æœªæä¾›åˆ™ä½¿ç”¨å¯åŠ¨æ—¶é…ç½®çš„è·¯å¾„</li>
<li><code>project_name_pattern</code> (å¯é€‰): é¡¹ç›®åç§°æ¨¡ç³ŠåŒ¹é…æ¨¡å¼ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ï¼Œç”¨äºè¿‡æ»¤é¡¹ç›®åˆ—è¡¨
<ul>
<li>æ”¯æŒå·¦å³æ¨¡ç³ŠåŒ¹é…ï¼Œä¾‹å¦‚ <code>nacos</code> å°†åŒ¹é…åŒ…å« <code>nacos</code>ã€<code>Nacos</code>ã€<code>NACOS</code> çš„é¡¹ç›®å</li>
<li>âš ï¸ <strong>ä½¿ç”¨å»ºè®®</strong>ï¼šå¦‚æœåŒ¹é…æ¨¡å¼è¿‡äºä¸¥æ ¼å¯èƒ½å¯¼è‡´é—æ¼ç›®æ ‡é¡¹ç›®</li>
<li>ğŸ’¡ <strong>æœ€ä½³å®è·µ</strong>ï¼šè‹¥æœªæ‰¾åˆ°é¢„æœŸç»“æœï¼Œå»ºè®®ä¸ä¼ æ­¤å‚æ•°é‡æ–°æŸ¥è¯¢å®Œæ•´åˆ—è¡¨</li>
</ul>
</li>
</ul>
<p><strong>æ™ºèƒ½æç¤ºæœºåˆ¶ï¼š</strong></p>
<ul>
<li>å½“ä½¿ç”¨ <code>project_name_pattern</code> ä½†æœªåŒ¹é…åˆ°é¡¹ç›®æ—¶ï¼Œè¿”å›ç»“æœä¼šåŒ…å«æç¤ºä¿¡æ¯</li>
<li>å»ºè®® AI åŠ©æ‰‹åœ¨æœªæ‰¾åˆ°é¢„æœŸé¡¹ç›®æ—¶ï¼Œä¸ä¼  <code>project_name_pattern</code> å‚æ•°é‡æ–°æŸ¥è¯¢</li>
<li>æœ‰æ•ˆå‡å°‘å› è¿‡åº¦è¿‡æ»¤å¯¼è‡´çš„æŸ¥è¯¢å¤±è´¥</li>
</ul>
<p><strong>ç¤ºä¾‹ 1 - åˆ—å‡ºæ‰€æœ‰é¡¹ç›®ï¼š</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>ç¤ºä¾‹ 2 - ä½¿ç”¨é¡¹ç›®åç§°æ¨¡ç³ŠåŒ¹é…ï¼š</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"project_name_pattern"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"spring"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>è¿”å›æ ¼å¼ï¼š</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"project_dir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/path/to/projects"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"project_name_pattern"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"spring"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"total_projects"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"projects"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"spring-boot"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"spring-cloud-demo"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"hint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å·²ä½¿ç”¨é¡¹ç›®åç§°æ¨¡å¼ 'spring' è¿›è¡Œè¿‡æ»¤ã€‚å¦‚æœæœªæ‰¾åˆ°é¢„æœŸçš„é¡¹ç›®ï¼Œå¯èƒ½æ˜¯æ¨¡å¼åŒ¹é…è¿‡äºä¸¥æ ¼ã€‚å»ºè®®ï¼šä¸ä¼ å…¥ project_name_pattern å‚æ•°é‡æ–°è°ƒç”¨ list_all_project å·¥å…·æŸ¥çœ‹å®Œæ•´é¡¹ç›®åˆ—è¡¨ã€‚"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"total_all_projects"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>æç¤ºä¿¡æ¯è¯´æ˜ï¼š</strong></p>
<ul>
<li>å½“ä½¿ç”¨ <code>project_name_pattern</code> ä½†æœªåŒ¹é…åˆ°ä»»ä½•é¡¹ç›®æ—¶ï¼Œ<code>hint</code> å­—æ®µä¼šæç¤ºæ¨¡å¼å¯èƒ½è¿‡äºä¸¥æ ¼ï¼Œå¹¶æ˜¾ç¤ºæ€»é¡¹ç›®æ•° <code>total_all_projects</code></li>
<li>å½“ä½¿ç”¨ <code>project_name_pattern</code> ä¸”æœ‰åŒ¹é…ç»“æœæ—¶ï¼Œ<code>hint</code> å­—æ®µä¼šæé†’å¦‚æœç»“æœä¸ç¬¦åˆé¢„æœŸå¯ä»¥ä¸ä¼ å‚æ•°é‡æ–°æŸ¥è¯¢ï¼ŒåŒæ—¶æ˜¾ç¤ºæ€»é¡¹ç›®æ•°</li>
<li>è¿™ä¸ªæ™ºèƒ½æç¤ºæœºåˆ¶å¸®åŠ© AI åŠ©æ‰‹æ›´å¥½åœ°è°ƒæ•´æŸ¥è¯¢ç­–ç•¥ï¼Œé¿å…å› è¿‡åº¦è¿‡æ»¤é”™è¿‡ç›®æ ‡é¡¹ç›®</li>
</ul>
<h4 data-id="heading-10">list_project_files</h4>
<p>åˆ—å‡º Java é¡¹ç›®ä¸­çš„æºä»£ç æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶è·¯å¾„ã€‚</p>
<p><strong>ç”¨é€”ï¼š</strong></p>
<ul>
<li>äº†è§£é¡¹ç›®ç»“æ„å’Œæ–‡ä»¶ç»„ç»‡</li>
<li>æŸ¥æ‰¾ç‰¹å®šçš„ç±»æˆ–é…ç½®æ–‡ä»¶</li>
<li>åˆ†æç±»ä¹‹é—´çš„å…³ç³»å’Œä¾èµ–</li>
<li>å½“é¡¹ç›®æ–‡ä»¶è¿‡å¤šæ—¶ï¼Œèšç„¦ç‰¹å®šæ¨¡å—</li>
<li>æ”¯æŒæ–‡ä»¶åæ¨¡ç³ŠåŒ¹é…ï¼Œå¿«é€Ÿå®šä½ç›®æ ‡æ–‡ä»¶</li>
</ul>
<p><strong>æ”¯æŒä¸¤ç§æ¨¡å¼ï¼š</strong></p>
<ol>
<li><strong>å…¨é¡¹ç›®æ¨¡å¼</strong>ï¼ˆä¸æŒ‡å®š <code>sub_path</code>ï¼‰ï¼šåˆ—å‡ºæ•´ä¸ªé¡¹ç›®çš„æ‰€æœ‰æ–‡ä»¶</li>
<li><strong>èšç„¦æ¨¡å¼</strong>ï¼ˆæŒ‡å®š <code>sub_path</code>ï¼‰ï¼šåªåˆ—å‡ºæŒ‡å®šå­ç›®å½•ä¸‹çš„æ–‡ä»¶</li>
</ol>
<p><strong>å‚æ•°ï¼š</strong></p>
<ul>
<li><code>project_name</code> (å¿…éœ€): é¡¹ç›®åç§°ï¼Œä¾‹å¦‚ <code>nacos</code></li>
<li><code>sub_path</code> (å¯é€‰): æŒ‡å®šé¡¹ç›®å†…çš„å­ç›®å½•è·¯å¾„ï¼Œä¾‹å¦‚ <code>core</code> æˆ– <code>address/src/main/java</code></li>
<li><code>file_name_pattern</code> (å¯é€‰): æ–‡ä»¶åæ¨¡ç³ŠåŒ¹é…æ¨¡å¼ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ï¼Œç”¨äºè¿›ä¸€æ­¥è¿‡æ»¤æ–‡ä»¶åˆ—è¡¨
<ul>
<li>æ”¯æŒå·¦å³æ¨¡ç³ŠåŒ¹é…ï¼Œä¾‹å¦‚ <code>Service</code> å°†åŒ¹é…åŒ…å« <code>service</code>ã€<code>Service</code>ã€<code>SERVICE</code> çš„æ–‡ä»¶å</li>
<li>âš ï¸ <strong>ä½¿ç”¨å»ºè®®</strong>ï¼šå¦‚æœåŒ¹é…æ¨¡å¼è¿‡äºä¸¥æ ¼å¯èƒ½å¯¼è‡´é—æ¼ç›®æ ‡æ–‡ä»¶</li>
<li>ğŸ’¡ <strong>æœ€ä½³å®è·µ</strong>ï¼šè‹¥æœªæ‰¾åˆ°é¢„æœŸç»“æœï¼Œå»ºè®®ä¸ä¼ æ­¤å‚æ•°é‡æ–°æŸ¥è¯¢å®Œæ•´åˆ—è¡¨</li>
</ul>
</li>
<li><code>project_dir</code> (å¯é€‰): é¡¹ç›®æ‰€åœ¨çš„çˆ¶ç›®å½•è·¯å¾„ï¼Œå¦‚æœªæä¾›åˆ™ä½¿ç”¨å¯åŠ¨æ—¶é…ç½®çš„è·¯å¾„</li>
</ul>
<p><strong>è‡ªåŠ¨è¿‡æ»¤å†…å®¹ï¼š</strong></p>
<ul>
<li>âœ… åŒ…å«ï¼šJava æºä»£ç  (.java)ã€é…ç½®æ–‡ä»¶ (.xml, .properties, .yaml, .json ç­‰)ã€æ„å»ºè„šæœ¬ã€æ–‡æ¡£</li>
<li>âŒ æ’é™¤ï¼šæµ‹è¯•ç›®å½• (<code>src/test</code>)ã€ç¼–è¯‘äº§ç‰© (<code>target</code>, <code>build</code>)ã€IDE é…ç½®ã€ç‰ˆæœ¬æ§åˆ¶æ–‡ä»¶</li>
</ul>
<p><strong>æ™ºèƒ½æç¤ºæœºåˆ¶ï¼š</strong></p>
<ul>
<li>å½“ä½¿ç”¨ <code>file_name_pattern</code> ä½†æœªåŒ¹é…åˆ°æ–‡ä»¶æ—¶ï¼Œè¿”å›ç»“æœä¼šåŒ…å«æç¤ºä¿¡æ¯</li>
<li>å»ºè®® AI åŠ©æ‰‹åœ¨æœªæ‰¾åˆ°é¢„æœŸæ–‡ä»¶æ—¶ï¼Œä¸ä¼  <code>file_name_pattern</code> å‚æ•°é‡æ–°æŸ¥è¯¢</li>
<li>æœ‰æ•ˆå‡å°‘å› è¿‡åº¦è¿‡æ»¤å¯¼è‡´çš„æŸ¥è¯¢å¤±è´¥</li>
</ul>
<p><strong>ç¤ºä¾‹ 1 - åˆ—å‡ºæ•´ä¸ªé¡¹ç›®ï¼š</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"project_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"nacos"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>ç¤ºä¾‹ 2 - åªåˆ—å‡º core æ¨¡å—ï¼š</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"project_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"nacos"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"sub_path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"core"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>ç¤ºä¾‹ 3 - ä½¿ç”¨æ–‡ä»¶åæ¨¡ç³ŠåŒ¹é…ï¼š</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"project_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"nacos"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"file_name_pattern"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Service"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>è¿”å›æ ¼å¼ï¼š</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"project_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"nacos"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"project_dir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/path/to/projects/nacos"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"search_scope"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"core"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"file_name_pattern"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Service"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"total_files"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"files"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"core/src/main/java/com/alibaba/nacos/core/service/NacosService.java"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"api/src/main/java/com/alibaba/nacos/api/naming/NamingService.java"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"..."</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"hint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å·²ä½¿ç”¨æ–‡ä»¶åæ¨¡å¼ 'Service' è¿›è¡Œè¿‡æ»¤ã€‚å¦‚æœæœªæ‰¾åˆ°é¢„æœŸçš„æ–‡ä»¶ï¼Œå¯èƒ½æ˜¯æ¨¡å¼åŒ¹é…è¿‡äºä¸¥æ ¼ã€‚å»ºè®®ï¼šä¸ä¼ å…¥ file_name_pattern å‚æ•°é‡æ–°è°ƒç”¨ list_project_files å·¥å…·æŸ¥çœ‹å®Œæ•´æ–‡ä»¶åˆ—è¡¨ã€‚"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>æç¤ºä¿¡æ¯è¯´æ˜ï¼š</strong></p>
<ul>
<li>å½“ä½¿ç”¨ <code>file_name_pattern</code> ä½†æœªåŒ¹é…åˆ°ä»»ä½•æ–‡ä»¶æ—¶ï¼Œ<code>hint</code> å­—æ®µä¼šæç¤ºæ¨¡å¼å¯èƒ½è¿‡äºä¸¥æ ¼</li>
<li>å½“ä½¿ç”¨ <code>file_name_pattern</code> ä¸”æœ‰åŒ¹é…ç»“æœæ—¶ï¼Œ<code>hint</code> å­—æ®µä¼šæé†’å¦‚æœç»“æœä¸ç¬¦åˆé¢„æœŸå¯ä»¥ä¸ä¼ å‚æ•°é‡æ–°æŸ¥è¯¢</li>
<li>è¿™ä¸ªæ™ºèƒ½æç¤ºæœºåˆ¶å¸®åŠ© AI åŠ©æ‰‹æ›´å¥½åœ°è°ƒæ•´æŸ¥è¯¢ç­–ç•¥ï¼Œé¿å…å› è¿‡åº¦è¿‡æ»¤é”™è¿‡ç›®æ ‡æ–‡ä»¶</li>
</ul>
<h4 data-id="heading-11">read_project_code</h4>
<p>ä»æœ¬åœ°é¡¹ç›®ç›®å½•ä¸­è¯»å–æŒ‡å®šæ–‡ä»¶çš„æºä»£ç æˆ–é…ç½®æ–‡ä»¶å†…å®¹ã€‚</p>
<p><strong>ç”¨é€”ï¼š</strong></p>
<ul>
<li>è¯»å–å…·ä½“ç±»æˆ–æ–‡ä»¶çš„å®Œæ•´æºä»£ç </li>
<li>æŸ¥çœ‹é…ç½®æ–‡ä»¶å†…å®¹ï¼ˆpom.xmlã€application.ymlã€application.properties ç­‰ï¼‰</li>
<li>è¯»å–é¡¹ç›®æ–‡æ¡£ï¼ˆREADME.mdã€SQL è„šæœ¬ç­‰ï¼‰</li>
<li>æ”¯æŒå¤šæ¨¡å— Maven/Gradle é¡¹ç›®</li>
<li>è‡ªåŠ¨æœç´¢å¸¸è§çš„æºä»£ç å’Œé…ç½®æ–‡ä»¶è·¯å¾„</li>
</ul>
<p><strong>å‚æ•°ï¼š</strong></p>
<ul>
<li><code>project_name</code> (å¿…éœ€): é¡¹ç›®åç§°ï¼Œä¾‹å¦‚ <code>my-project</code></li>
<li><code>file_path</code> (å¿…éœ€): æ–‡ä»¶æ ‡è¯†ç¬¦ï¼šå¯ä»¥æ˜¯å®Œå…¨é™å®šçš„ Java ç±»åæˆ–æ–‡ä»¶ç›¸å¯¹è·¯å¾„
<ul>
<li>Java ç±»åæ ¼å¼ï¼š<code>com.example.MyClass</code> (è‡ªåŠ¨æŸ¥æ‰¾å¯¹åº”çš„ .java æ–‡ä»¶)</li>
<li>ç›¸å¯¹è·¯å¾„æ ¼å¼ï¼š<code>src/main/java/com/example/MyClass.java</code></li>
<li>æ¨¡å—ç›¸å¯¹è·¯å¾„ï¼š<code>core/src/main/java/com/example/MyClass.java</code></li>
<li>é…ç½®æ–‡ä»¶è·¯å¾„ï¼š<code>src/main/resources/application.yml</code>ã€<code>pom.xml</code></li>
<li>æ–‡æ¡£æ–‡ä»¶ï¼š<code>README.md</code>ã€<code>docs/setup.md</code></li>
</ul>
</li>
<li><code>project_dir</code> (å¯é€‰): é¡¹ç›®ç›®å½•è·¯å¾„ï¼Œå¦‚æœªæä¾›åˆ™ä½¿ç”¨å¯åŠ¨æ—¶é…ç½®çš„è·¯å¾„</li>
</ul>
<p><strong>æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼š</strong></p>
<ul>
<li>Java æºä»£ç  (.java)</li>
<li>é…ç½®æ–‡ä»¶ (.xml, .properties, .yaml, .yml, .json, .conf, .config)</li>
<li>æ„å»ºè„šæœ¬ (.gradle, .gradle.kts, pom.xml)</li>
<li>æ–‡æ¡£æ–‡ä»¶ (.md, .txt)</li>
<li>SQL è„šæœ¬ (.sql)</li>
<li>Shell è„šæœ¬ (.sh, .bat)</li>
</ul>
<p><strong>è‡ªåŠ¨æœç´¢è·¯å¾„ï¼š</strong></p>
<ul>
<li>å¯¹äº Java ç±»åï¼š<code>src/main/java/{class_path}.java</code>ã€<code>src/{class_path}.java</code>ã€<code>{class_path}.java</code></li>
<li>å¯¹äºé…ç½®æ–‡ä»¶ï¼šé¡¹ç›®æ ¹ç›®å½•ã€<code>src/main/resources/</code>ã€<code>src/</code>ã€<code>config/</code> åŠå­æ¨¡å—</li>
<li>æ”¯æŒå¤šæ¨¡å—é¡¹ç›®ä¸­çš„å­æ¨¡å—è·¯å¾„</li>
</ul>
<p><strong>æ¨èå·¥ä½œæµç¨‹ï¼š</strong></p>
<ol>
<li>ä½¿ç”¨ <code>list_all_project</code> ç¡®è®¤é¡¹ç›®å­˜åœ¨</li>
<li>ä½¿ç”¨ <code>list_project_files</code>ï¼ˆå»ºè®®å¸¦ <code>file_name_pattern</code> å‚æ•°ï¼‰æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨</li>
<li>ä½¿ç”¨æœ¬å·¥å…·è¯»å–å…·ä½“æ–‡ä»¶å†…å®¹</li>
</ol>
<p><strong>ç¤ºä¾‹ 1 - ä½¿ç”¨ç±»åè¯»å– Java æºä»£ç ï¼š</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"project_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-spring-app"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"file_path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"com.example.service.UserService"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>ç¤ºä¾‹ 2 - ä½¿ç”¨ç›¸å¯¹è·¯å¾„è¯»å– Java æ–‡ä»¶ï¼š</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"project_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"nacos"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"file_path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"address/src/main/java/com/alibaba/nacos/address/component/AddressServerGeneratorManager.java"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>ç¤ºä¾‹ 3 - è¯»å–é…ç½®æ–‡ä»¶ï¼š</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"project_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-spring-app"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"file_path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/main/resources/application.yml"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>ç¤ºä¾‹ 4 - è¯»å–é¡¹ç›®æ ¹ç›®å½•çš„æ–‡ä»¶ï¼š</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"project_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-spring-app"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"file_path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pom.xml"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>è¿”å›æ ¼å¼ï¼š</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"project_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-spring-app"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"class_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"com.example.service.UserService"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"file_path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/path/to/projects/my-spring-app/src/main/java/com/example/service/UserService.java"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"package com.example.service;\n\nimport ...\n\npublic class UserService {\n    // ...\n}"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-12">read_jar_source</h4>
<p>ä» Maven ä¾èµ–ä¸­è¯»å– Java ç±»çš„æºä»£ç ï¼ˆä¼˜å…ˆä» sources jarï¼Œå¦åˆ™åç¼–è¯‘ï¼‰ã€‚</p>
<p><strong>å‚æ•°ï¼š</strong></p>
<ul>
<li><code>group_id</code> (å¿…éœ€): Maven group IDï¼Œä¾‹å¦‚ <code>org.springframework</code></li>
<li><code>artifact_id</code> (å¿…éœ€): Maven artifact IDï¼Œä¾‹å¦‚ <code>spring-core</code></li>
<li><code>version</code> (å¿…éœ€): Maven versionï¼Œä¾‹å¦‚ <code>5.3.21</code></li>
<li><code>class_name</code> (å¿…éœ€): å®Œå…¨é™å®šçš„ç±»åï¼Œä¾‹å¦‚ <code>org.springframework.core.SpringVersion</code></li>
<li><code>prefer_sources</code> (å¯é€‰ï¼Œé»˜è®¤ <code>true</code>): ä¼˜å…ˆä½¿ç”¨ sources jar è€Œä¸æ˜¯åç¼–è¯‘</li>
</ul>
<p><strong>å·¥ä½œåŸç†ï¼š</strong></p>
<ol>
<li>é¦–å…ˆå°è¯•ä» <code>-sources.jar</code> ä¸­æå–æºä»£ç ï¼ˆå¦‚æœ <code>prefer_sources=true</code>ï¼‰</li>
<li>å¦‚æœ sources jar ä¸å­˜åœ¨æˆ–æå–å¤±è´¥ï¼Œè‡ªåŠ¨å›é€€åˆ°åç¼–è¯‘ä¸» JAR æ–‡ä»¶</li>
<li>æ”¯æŒ SNAPSHOT ç‰ˆæœ¬çš„æ™ºèƒ½å¤„ç†</li>
</ol>
<p><strong>æ™ºèƒ½é”™è¯¯æç¤ºï¼š</strong></p>
<p>å½“ JAR æ–‡ä»¶æœªæ‰¾åˆ°æ—¶ï¼Œå·¥å…·ä¼šæä¾›è¯¦ç»†çš„æ’æŸ¥å»ºè®®ï¼š</p>
<ul>
<li>æç¤ºå¯èƒ½çš„åŸå› ï¼ˆä¾èµ–æœªå®‰è£…ã€Maven åæ ‡é”™è¯¯ï¼‰</li>
<li>å»ºè®®ä½¿ç”¨ <code>read_project_code</code> å·¥å…·è¯»å–é¡¹ç›®çš„ <code>pom.xml</code> æ–‡ä»¶</li>
<li>æŒ‡å¯¼åœ¨ <code>&lt;dependencies&gt;</code> éƒ¨åˆ†æ ¸å¯¹æ­£ç¡®çš„ Maven åæ ‡</li>
<li>æç¤ºç¡®è®¤åæ ‡åé‡æ–°è°ƒç”¨å·¥å…·</li>
<li>è¯´æ˜å¯èƒ½éœ€è¦æ‰§è¡Œ Maven æ„å»ºå‘½ä»¤å®‰è£…ä¾èµ–</li>
</ul>
<p>è¿™ä¸ªæ™ºèƒ½æç¤ºæœºåˆ¶ç‰¹åˆ«é€‚åˆä¸ AI åŠ©æ‰‹é…åˆä½¿ç”¨ï¼Œèƒ½æœ‰æ•ˆå‡å°‘å›  Maven åæ ‡é”™è¯¯å¯¼è‡´çš„é‡å¤å°è¯•ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"group_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"org.springframework"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"artifact_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"spring-core"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"5.3.21"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"class_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"org.springframework.core.SpringVersion"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>è¿”å›æ ¼å¼ï¼š</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"class_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"org.springframework.core.SpringVersion"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"artifact"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"org.springframework:spring-core:5.3.21"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"source_type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sources.jar"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"package org.springframework.core;\n\npublic class SpringVersion {\n    // ...\n}"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>source_type å­—æ®µè¯´æ˜ï¼š</strong></p>
<p><code>source_type</code> å­—æ®µæ ‡è¯†æºç çš„æ¥æºï¼Œå¸®åŠ© AI åŠ©æ‰‹äº†è§£ä»£ç çš„å¯é æ€§å’Œæ–°é²œåº¦ï¼š</p>
<ul>
<li><code>"sources.jar"</code>: ä» Maven çš„ sources JAR æ–‡ä»¶ä¸­æå–ï¼ˆæœ€å¯é ï¼Œä¸å‘å¸ƒç‰ˆæœ¬å®Œå…¨ä¸€è‡´ï¼‰</li>
<li><code>"decompiled"</code>: é€šè¿‡åç¼–è¯‘å™¨æ–°åç¼–è¯‘ç”Ÿæˆï¼ˆå¯èƒ½å­˜åœ¨åç¼–è¯‘ä¸å®Œæ•´çš„æƒ…å†µï¼‰</li>
<li><code>"decompiled_cache"</code>: ä»ä¹‹å‰åç¼–è¯‘çš„ç¼“å­˜ä¸­è¯»å–ï¼ˆé¿å…é‡å¤åç¼–è¯‘ï¼Œæå‡æ€§èƒ½ï¼‰</li>
</ul>
<p>ğŸ’¡ <strong>ä½¿ç”¨å»ºè®®</strong>ï¼š</p>
<ul>
<li><code>sources.jar</code> æ¥æºçš„ä»£ç æœ€å‡†ç¡®ï¼Œå¯ç›´æ¥ä½œä¸ºåˆ†æä¾æ®</li>
<li><code>decompiled</code> æ¥æºçš„ä»£ç å¯èƒ½ä¼šæœ‰è¯­æ³•ç³–æ¢å¤ã€æ³›å‹æ“¦é™¤ç­‰åç¼–è¯‘ç‰¹å¾</li>
<li><code>decompiled_cache</code> ä¸ <code>decompiled</code> è´¨é‡ç›¸åŒï¼Œåªæ˜¯ä»ç¼“å­˜è¯»å–ä»¥æå‡æ•ˆç‡</li>
</ul>
<h5 data-id="heading-13">åç¼–è¯‘å™¨é€‰æ‹©ä¸ç¼“å­˜æœºåˆ¶</h5>
<p><code>read_jar_source</code> å·¥å…·æ”¯æŒå¤šä¸ªåç¼–è¯‘å™¨ï¼Œå¹¶æ ¹æ® Java ç‰ˆæœ¬è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„ï¼š</p>




















<table><thead><tr><th>Java ç‰ˆæœ¬</th><th>æ¨èåç¼–è¯‘å™¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>8 - 20</td><td>CFR</td><td>è‡ªåŠ¨ä½¿ç”¨ <strong>CFR</strong> åç¼–è¯‘å™¨ï¼ˆå…¼å®¹ Java 8+ï¼‰ï¼Œå·²åŒ…å«åœ¨åŒ…ä¸­ï¼š<code>src/easy_code_reader/decompilers/cfr.jar</code></td></tr><tr><td>21+</td><td>Fernflower</td><td>è‡ªåŠ¨ä½¿ç”¨ <strong>Fernflower</strong> åç¼–è¯‘å™¨ï¼ˆIntelliJ IDEA ä½¿ç”¨çš„åç¼–è¯‘å™¨ï¼‰ï¼Œå·²åŒ…å«åœ¨åŒ…ä¸­ï¼š<code>src/easy_code_reader/decompilers/fernflower.jar</code></td></tr></tbody></table>
<p>åç¼–è¯‘åçš„æ–‡ä»¶ä¼šè¢«ç¼“å­˜åœ¨ JAR åŒ…æ‰€åœ¨ç›®å½•çš„ <code>easy-code-reader/</code> å­ç›®å½•ä¸­ï¼Œä¾‹å¦‚ï¼š</p>
<p>å¦‚æœ JAR åŒ…ä½ç½®ä¸ºï¼š</p>
<pre><code class="hljs language-bash" lang="bash">~/.m2/repository/org/springframework/spring-core/5.3.21/spring-core-5.3.21.jar
</code></pre>
<p>åç¼–è¯‘åçš„æºæ–‡ä»¶å°†å­˜å‚¨åœ¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">~/.m2/repository/org/springframework/spring-core/5.3.21/easy-code-reader/spring-core-5.3.21.jar
</code></pre>
<p>ç¼“å­˜æ–‡ä»¶æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ª JAR æ ¼å¼çš„å‹ç¼©åŒ…ï¼ŒåŒ…å«æ‰€æœ‰åç¼–è¯‘åçš„ <code>.java</code> æ–‡ä»¶ï¼Œè¿™æ ·å¯ä»¥é¿å…é‡å¤åç¼–è¯‘ç›¸åŒçš„ JAR åŒ…ï¼Œæé«˜æ€§èƒ½ã€‚ä½† <strong>é’ˆå¯¹ SNAPSHOT ç‰ˆæœ¬éœ€è¦ç‰¹æ®Šå¤„ç†ï¼š</strong> å› ä¸º Maven é’ˆå¯¹å¿«ç…§ç‰ˆæœ¬ä¼šç”Ÿæˆå¸¦æ—¶é—´æˆ³çš„ JARï¼ˆå¦‚ <code>artifact-1.0.0-20251030.085053-1.jar</code>ï¼‰ï¼ŒEasy Code Reader ä¼šè‡ªåŠ¨æŸ¥æ‰¾æœ€æ–°çš„å¸¦æ—¶é—´æˆ³ç‰ˆæœ¬è¿›è¡Œåç¼–è¯‘ï¼Œå¹¶ä¸”ä»¥ç¼“å­˜ä»¥ <code>artifact-1.0.0-20251030.085053-1.jar</code> åç§°å­˜å‚¨ï¼Œæä¾›ç‰ˆæœ¬åˆ¤æ–­çš„ä¾æ®ï¼Œå½“æ£€æµ‹åˆ°æ–°ç‰ˆæœ¬æ—¶ï¼Œä¼šè‡ªåŠ¨æ¸…ç†æ—§çš„ SNAPSHOT ç¼“å­˜ï¼Œç”Ÿæˆæ–°çš„ç¼“å­˜æ–‡ä»¶ã€‚</p>
<hr/>
<h3 data-id="heading-14">å·¨äººçš„è‚©è†€</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmcp.so%2Fserver%2Feasy-code-reader%2FFangYuan33" target="_blank" title="https://mcp.so/server/easy-code-reader/FangYuan33" ref="nofollow noopener noreferrer">MCP.so: Easy Code Reader</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFangYuan33%2Feasy-code-reader" target="_blank" title="https://github.com/FangYuan33/easy-code-reader" ref="nofollow noopener noreferrer">Github: easy-code-reader</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsalitaba%2Fmaven-decoder-mcp" target="_blank" title="https://github.com/salitaba/maven-decoder-mcp" ref="nofollow noopener noreferrer">Github: maven-decoder-mcp</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJetBrains%2Ffernflower" target="_blank" title="https://github.com/JetBrains/fernflower" ref="nofollow noopener noreferrer">Github: fernflower</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯æ¶æ„ä¸­çš„ä¸­é—´å±‚è®¾è®¡ï¼šæ„å»ºç¨³å¥å¯ç»´æŠ¤çš„ç»„ä»¶ä½“ç³»]]></title>    <link>https://juejin.cn/post/7570651893869936692</link>    <guid>https://juejin.cn/post/7570651893869936692</guid>    <pubDate>2025-11-10T06:19:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570651893869936692" data-draft-id="7570651893869903924" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯æ¶æ„ä¸­çš„ä¸­é—´å±‚è®¾è®¡ï¼šæ„å»ºç¨³å¥å¯ç»´æŠ¤çš„ç»„ä»¶ä½“ç³»"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•,ä»£ç è§„èŒƒ"/> <meta itemprop="datePublished" content="2025-11-10T06:19:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§çŸ¥é—²é—²i"/> <meta itemprop="url" content="https://juejin.cn/user/3799545205237111"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯æ¶æ„ä¸­çš„ä¸­é—´å±‚è®¾è®¡ï¼šæ„å»ºç¨³å¥å¯ç»´æŠ¤çš„ç»„ä»¶ä½“ç³»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3799545205237111/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§çŸ¥é—²é—²i
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T06:19:53.000Z" title="Mon Nov 10 2025 06:19:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    84
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ç°ä»£å‰ç«¯å¼€å‘ä¸­ï¼Œä¸­é—´å±‚æ¶æ„è®¾è®¡å·²æˆä¸ºæ„å»ºå¤§å‹å¤æ‚åº”ç”¨çš„å…³é”®ç­–ç•¥ã€‚ç‰¹åˆ«æ˜¯åœ¨ç»„ä»¶åŒ–å¼€å‘ä¸­ï¼Œåˆç†çš„ä¸­é—´å±‚è®¾è®¡èƒ½å¤Ÿæ˜¾è‘—æå‡ä»£ç è´¨é‡ã€å›¢é˜Ÿåä½œæ•ˆç‡å’Œç³»ç»Ÿå¯ç»´æŠ¤æ€§ã€‚</p>
<p>================================================================================</p>
<h2 data-id="heading-0">ä¸€ã€ä»€ä¹ˆæ˜¯ç»„ä»¶ä¸­é—´å±‚ï¼Ÿ</h2>
<p>ç»„ä»¶ä¸­é—´å±‚æ˜¯ä½äºä¸šåŠ¡é€»è¾‘ä¸åŸºç¡€UIç»„ä»¶ä¹‹é—´çš„æŠ½è±¡å±‚ï¼Œå®ƒé€šè¿‡å¯¹åº•å±‚ç»„ä»¶ï¼ˆå¦‚ Ant Designã€Element UI ç­‰ï¼‰è¿›è¡Œç»Ÿä¸€å°è£…ï¼Œä¸ºä¸šåŠ¡å¼€å‘æä¾›æ ‡å‡†åŒ–ã€å¢å¼ºå‹çš„ç»„ä»¶æ¥å£ã€‚</p>
<p><strong>æ¶æ„å±‚æ¬¡ç¤ºæ„ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss">ä¸šåŠ¡ç»„ä»¶å±‚ (Business Components)
    â†“
ç»„ä»¶ä¸­é—´å±‚ (Component Middleware) â† æ ¸å¿ƒæŠ½è±¡å±‚
    â†“
åŸºç¡€UIåº“ (UI Libraries) â† AntDã€Element UI ç­‰
    â†“
åŸç”Ÿ<span class="hljs-selector-tag">HTML</span>å…ƒç´  (Native HTML)
</code></pre>
<h2 data-id="heading-1">äºŒã€ä¸­é—´å±‚è®¾è®¡çš„æ ¸å¿ƒä»·å€¼</h2>
<h3 data-id="heading-2">1. æŠ€æœ¯æ ˆè§£è€¦ä¸é£é™©æ§åˆ¶</h3>
<p><strong>é—®é¢˜åœºæ™¯ï¼š</strong> ä¸šåŠ¡ä»£ç ç›´æ¥ä¾èµ–ç‰¹å®šUIåº“ï¼Œå¯¼è‡´æŠ€æœ¯æ ˆåˆ‡æ¢æˆæœ¬æé«˜</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ ç›´æ¥ä¾èµ– - å±é™©çš„åšæ³•</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span>, <span class="hljs-title class_">Table</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserManagement</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>&gt;</span>åˆ é™¤ç”¨æˆ·<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Table</span> <span class="hljs-attr">dataSource</span>=<span class="hljs-string">{data}</span> /&gt;</span></span>
  );
}

<span class="hljs-comment">// âœ… ä¸­é—´å±‚å°è£… - å®‰å…¨çš„åšæ³•</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PrimaryButton</span>, <span class="hljs-title class_">DataTable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserManagement</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">PrimaryButton</span>&gt;</span>åˆ é™¤ç”¨æˆ·<span class="hljs-tag">&lt;/<span class="hljs-name">PrimaryButton</span>&gt;</span></span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">DataTable</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{data}</span> /&gt;</span></span>
  );
}
</code></pre>
<p><strong>ä¼˜åŠ¿ä½“ç°ï¼š</strong> å½“éœ€è¦ä» Ant Design è¿ç§»åˆ°å…¶ä»–UIåº“æ—¶ï¼Œåªéœ€ä¿®æ”¹ä¸­é—´å±‚å®ç°ï¼Œä¸šåŠ¡ä»£ç æ— éœ€æ”¹åŠ¨ã€‚</p>
<h3 data-id="heading-3">2. ç»Ÿä¸€è®¾è®¡è§„èŒƒä¸ç”¨æˆ·ä½“éªŒ</h3>
<p>é€šè¿‡ä¸­é—´å±‚å¼ºåˆ¶å®æ–½è®¾è®¡ç³»ç»Ÿè§„èŒƒï¼Œç¡®ä¿æ•´ä¸ªåº”ç”¨äº¤äº’ä¸€è‡´æ€§ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// components/EnhancedTable/index.tsx
import React from 'react'<span class="hljs-comment">;</span>
import { Table, Empty, Spin, Alert } from 'antd'<span class="hljs-comment">;</span>

interface EnhancedTableProps {
  loading?: boolean<span class="hljs-comment">;</span>
  error?: Error | null<span class="hljs-comment">;</span>
  data: any<span class="hljs-section">[]</span><span class="hljs-comment">;</span>
  columns: any<span class="hljs-section">[]</span><span class="hljs-comment">;</span>
  onRetry?: () =&gt; void<span class="hljs-comment">;</span>
}

export const EnhancedTable: React.FC&lt;EnhancedTableProps&gt; = ({
  <span class="hljs-attr">loading</span> = <span class="hljs-literal">false</span>,
  <span class="hljs-attr">error</span> = null,
  <span class="hljs-attr">data</span> = [],
  columns,
  onRetry,
  ...rest
}) =&gt; {
  if (error) {
    return (
      &lt;Alert
        <span class="hljs-attr">message</span>=<span class="hljs-string">"æ•°æ®åŠ è½½å¤±è´¥"</span>
        <span class="hljs-attr">description</span>={error.message}
        <span class="hljs-attr">type</span>=<span class="hljs-string">"error"</span>
        <span class="hljs-attr">action</span>={
          &lt;Button <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-literal">on</span>Click={<span class="hljs-literal">on</span>Retry}&gt;
            é‡è¯•
          &lt;/Button&gt;
        }
      /&gt;
    )<span class="hljs-comment">;</span>
  }

  return (
    &lt;Spin <span class="hljs-attr">spinning</span>={loading}&gt;
      &lt;Table
        <span class="hljs-attr">dataSource</span>={data}
        <span class="hljs-attr">columns</span>={columns}
        <span class="hljs-attr">locale</span>={{
          emptyText: (
            &lt;Empty 
              <span class="hljs-attr">description</span>={loading ? <span class="hljs-string">'åŠ è½½ä¸­...'</span> : <span class="hljs-string">'æš‚æ— æ•°æ®'</span>}
              <span class="hljs-attr">image</span>={Empty.PRESENTED_IMAGE_SIMPLE}
            /&gt;
          )
        }}
        <span class="hljs-attr">pagination</span>={{
          showSizeChanger: true,
          showQuickJumper: true,
          showTotal: (total) =&gt; `å…± ${total} æ¡`,
          pageSizeOptions: <span class="hljs-section">['10', '20', '50', '100']</span>,
        }}
        {...rest}
      /&gt;
    &lt;/Spin&gt;
  )<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-4">3. åŠŸèƒ½å¢å¼ºä¸æ¨ªåˆ‡å…³æ³¨ç‚¹å¤„ç†</h3>
<p>ä¸­é—´å±‚å¤©ç„¶é€‚åˆå¤„ç†è·¨ç»„ä»¶çš„é€šç”¨é€»è¾‘ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// components/SecureButton/index.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span>, message, <span class="hljs-title class_">Modal</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;
<span class="hljs-keyword">import</span> { usePermission } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/hooks/usePermission'</span>;
<span class="hljs-keyword">import</span> { useTracking } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/hooks/useTracking'</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">SecureButtonProps</span> {
  <span class="hljs-comment">// æƒé™æ§åˆ¶</span>
  permission?: <span class="hljs-built_in">string</span>;
  <span class="hljs-comment">// æ“ä½œç¡®è®¤</span>
  confirm?: <span class="hljs-built_in">string</span> | { <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span> };
  <span class="hljs-comment">// åŸ‹ç‚¹è¿½è¸ª</span>
  tracking?: { <span class="hljs-attr">event</span>: <span class="hljs-built_in">string</span>; data?: <span class="hljs-built_in">any</span> };
  <span class="hljs-comment">// é˜²é‡å¤æäº¤</span>
  debounce?: <span class="hljs-built_in">number</span>;
  onClick?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span> | <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">SecureButton</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">SecureButtonProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{
  permission,
  confirm,
  tracking,
  debounce = <span class="hljs-number">300</span>,
  onClick,
  children,
  ...props
}</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { hasPermission } = <span class="hljs-title function_">usePermission</span>();
  <span class="hljs-keyword">const</span> { trackEvent } = <span class="hljs-title function_">useTracking</span>();
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);

  <span class="hljs-comment">// æƒé™æ ¡éªŒ</span>
  <span class="hljs-keyword">if</span> (permission &amp;&amp; !<span class="hljs-title function_">hasPermission</span>(permission)) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// ç¡®è®¤å¯¹è¯æ¡†</span>
    <span class="hljs-keyword">if</span> (confirm) {
      <span class="hljs-keyword">const</span> confirmed = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
        <span class="hljs-title class_">Modal</span>.<span class="hljs-title function_">confirm</span>({
          <span class="hljs-attr">title</span>: <span class="hljs-keyword">typeof</span> confirm === <span class="hljs-string">'string'</span> ? <span class="hljs-string">'ç¡®è®¤æ“ä½œ'</span> : confirm.<span class="hljs-property">title</span>,
          <span class="hljs-attr">content</span>: <span class="hljs-keyword">typeof</span> confirm === <span class="hljs-string">'string'</span> ? confirm : confirm.<span class="hljs-property">content</span>,
          <span class="hljs-attr">onOk</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">true</span>),
          <span class="hljs-attr">onCancel</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">false</span>),
        });
      });
      
      <span class="hljs-keyword">if</span> (!confirmed) <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// åŸ‹ç‚¹è®°å½•</span>
    <span class="hljs-keyword">if</span> (tracking) {
      <span class="hljs-title function_">trackEvent</span>(tracking.<span class="hljs-property">event</span>, tracking.<span class="hljs-property">data</span>);
    }

    <span class="hljs-comment">// åŠ è½½çŠ¶æ€ä¸é˜²é‡å¤</span>
    <span class="hljs-keyword">if</span> (!loading) {
      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> onClick?.();
      } <span class="hljs-keyword">finally</span> {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>), debounce);
      }
    }
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
      {<span class="hljs-attr">...props</span>}
      <span class="hljs-attr">loading</span>=<span class="hljs-string">{loading}</span>
      <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleClick}</span>
      <span class="hljs-attr">disabled</span>=<span class="hljs-string">{props.disabled</span> || <span class="hljs-attr">loading</span>}
    &gt;</span>
      {children}
    <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span>
  );
};
</code></pre>
<h3 data-id="heading-5">4. ç±»å‹å®‰å…¨ä¸å¼€å‘ä½“éªŒæå‡</h3>
<p>é€šè¿‡ TypeScript æä¾›ç²¾ç¡®çš„ç±»å‹æç¤ºå’Œçº¦æŸï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// types/table.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TableColumn</span>&lt;T = <span class="hljs-built_in">any</span>&gt; {
  <span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">dataIndex</span>: keyof T;
  render?: <span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">any</span>, record: T, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactNode</span>;
  sorter?: <span class="hljs-built_in">boolean</span> | (<span class="hljs-function">(<span class="hljs-params">a: T, b: T</span>) =&gt;</span> <span class="hljs-built_in">number</span>);
  filters?: { <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">value</span>: <span class="hljs-built_in">any</span> }[];
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PaginationConfig</span> {
  <span class="hljs-attr">current</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">pageSize</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">total</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">onChange</span>: <span class="hljs-function">(<span class="hljs-params">page: <span class="hljs-built_in">number</span>, pageSize?: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
}

<span class="hljs-comment">// components/DataTable/index.tsx</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">TableColumn</span>, <span class="hljs-title class_">PaginationConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/types/table'</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">DataTableProps</span>&lt;T&gt; {
  <span class="hljs-attr">data</span>: T[];
  <span class="hljs-attr">columns</span>: <span class="hljs-title class_">TableColumn</span>&lt;T&gt;[];
  pagination?: <span class="hljs-title class_">PaginationConfig</span>;
  loading?: <span class="hljs-built_in">boolean</span>;
  rowKey?: keyof T | (<span class="hljs-function">(<span class="hljs-params">record: T</span>) =&gt;</span> <span class="hljs-built_in">string</span>);
}
</code></pre>
<h2 data-id="heading-6">ä¸‰ã€ä¸­é—´å±‚è®¾è®¡æ¨¡å¼ä¸å®è·µ</h2>
<h3 data-id="heading-7">1. ç»„åˆæ¨¡å¼ (Composition)</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// components/SearchTable/index.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">EnhancedTable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../EnhancedTable'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SearchBar</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../SearchBar'</span>;
<span class="hljs-keyword">import</span> { usePagination } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/hooks/usePagination'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">SearchTable</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">SearchTableProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{
  searchFields,
  onSearch,
  ...tableProps
}</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { pagination, setPagination } = <span class="hljs-title function_">usePagination</span>();
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSearch</span> = (<span class="hljs-params">values: <span class="hljs-built_in">any</span></span>) =&gt; {
    onSearch?.(values);
    <span class="hljs-title function_">setPagination</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> ({ ...prev, <span class="hljs-attr">current</span>: <span class="hljs-number">1</span> }));
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"search-table"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">SearchBar</span> <span class="hljs-attr">fields</span>=<span class="hljs-string">{searchFields}</span> <span class="hljs-attr">onSearch</span>=<span class="hljs-string">{handleSearch}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">EnhancedTable</span>
        {<span class="hljs-attr">...tableProps</span>}
        <span class="hljs-attr">pagination</span>=<span class="hljs-string">{{</span>
          <span class="hljs-attr">...pagination</span>,
          <span class="hljs-attr">onChange:</span> <span class="hljs-attr">setPagination</span>,
        }}
      /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};
</code></pre>
<h3 data-id="heading-8">2. é«˜é˜¶ç»„ä»¶æ¨¡å¼ (HOC)</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// hooks/withErrorBoundary.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> withErrorBoundary&lt;P <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span>&gt;(
  <span class="hljs-title class_">Component</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">ComponentType</span>&lt;P&gt;,
  fallback?: <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactNode</span>
) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ErrorBoundary</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span>&lt;P, { <span class="hljs-attr">hasError</span>: <span class="hljs-built_in">boolean</span> }&gt; {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props: P</span>) {
      <span class="hljs-variable language_">super</span>(props);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = { <span class="hljs-attr">hasError</span>: <span class="hljs-literal">false</span> };
    }

    <span class="hljs-keyword">static</span> <span class="hljs-title function_">getDerivedStateFromError</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">hasError</span>: <span class="hljs-literal">true</span> };
    }

    <span class="hljs-title function_">componentDidCatch</span>(<span class="hljs-params">error: <span class="hljs-built_in">Error</span>, errorInfo: React.ErrorInfo</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Component Error:'</span>, error, errorInfo);
    }

    <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">hasError</span>) {
        <span class="hljs-keyword">return</span> fallback || <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>ç»„ä»¶æ¸²æŸ“å¤±è´¥<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
      }

      <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Component</span> {<span class="hljs-attr">...this.props</span>} /&gt;</span></span>;
    }
  };
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">EnhancedTableWithErrorBoundary</span> = <span class="hljs-title function_">withErrorBoundary</span>(<span class="hljs-title class_">EnhancedTable</span>);
</code></pre>
<h3 data-id="heading-9">3. è‡ªå®šä¹‰ Hook æ¨¡å¼</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// hooks/useTable.ts</span>
<span class="hljs-keyword">import</span> { useState, useCallback } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> useTable&lt;T&gt;(<span class="hljs-attr">initialData</span>: T[] = []) {
  <span class="hljs-keyword">const</span> [data, setData] = useState&lt;T[]&gt;(initialData);
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> [error, setError] = useState&lt;<span class="hljs-title class_">Error</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-keyword">const</span> refresh = <span class="hljs-title function_">useCallback</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">fetchFunction</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;T[]&gt;) =&gt; {
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);
    <span class="hljs-title function_">setError</span>(<span class="hljs-literal">null</span>);
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchFunction</span>();
      <span class="hljs-title function_">setData</span>(result);
      <span class="hljs-keyword">return</span> result;
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-title function_">setError</span>(err <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>);
      <span class="hljs-keyword">throw</span> err;
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
    }
  }, []);

  <span class="hljs-keyword">return</span> {
    data,
    loading,
    error,
    setData,
    refresh,
  };
}
</code></pre>
<h2 data-id="heading-10">å››ã€å®é™…ä¸šåŠ¡åœºæ™¯åº”ç”¨</h2>
<h3 data-id="heading-11">åœºæ™¯ï¼šç”¨æˆ·ç®¡ç†ç³»ç»Ÿè¡¨æ ¼</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// features/user/components/UserTable.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SearchTable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/SearchTable'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SecureButton</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/SecureButton'</span>;
<span class="hljs-keyword">import</span> { useUserTable } <span class="hljs-keyword">from</span> <span class="hljs-string">'../hooks/useUserTable'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">UserTable</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> {
    data,
    loading,
    pagination,
    searchFields,
    handleSearch,
    handleDelete,
    handleEdit,
  } = <span class="hljs-title function_">useUserTable</span>();

  <span class="hljs-keyword">const</span> columns = [
    {
      <span class="hljs-attr">key</span>: <span class="hljs-string">'name'</span>,
      <span class="hljs-attr">title</span>: <span class="hljs-string">'å§“å'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'name'</span>,
    },
    {
      <span class="hljs-attr">key</span>: <span class="hljs-string">'email'</span>,
      <span class="hljs-attr">title</span>: <span class="hljs-string">'é‚®ç®±'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'email'</span>,
    },
    {
      <span class="hljs-attr">key</span>: <span class="hljs-string">'actions'</span>,
      <span class="hljs-attr">title</span>: <span class="hljs-string">'æ“ä½œ'</span>,
      <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">_, record</span>) =&gt;</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">SecureButton</span>
            <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span>
            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleEdit(record)}
            permission="user:edit"
          &gt;
            ç¼–è¾‘
          <span class="hljs-tag">&lt;/<span class="hljs-name">SecureButton</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">SecureButton</span>
            <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span>
            <span class="hljs-attr">danger</span>
            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleDelete(record.id)}
            permission="user:delete"
            confirm="ç¡®å®šåˆ é™¤è¯¥ç”¨æˆ·å—ï¼Ÿ"
            tracking={{ event: 'user_delete' }}
          &gt;
            åˆ é™¤
          <span class="hljs-tag">&lt;/<span class="hljs-name">SecureButton</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
      ),
    },
  ];

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">SearchTable</span>
      <span class="hljs-attr">columns</span>=<span class="hljs-string">{columns}</span>
      <span class="hljs-attr">data</span>=<span class="hljs-string">{data}</span>
      <span class="hljs-attr">loading</span>=<span class="hljs-string">{loading}</span>
      <span class="hljs-attr">pagination</span>=<span class="hljs-string">{pagination}</span>
      <span class="hljs-attr">searchFields</span>=<span class="hljs-string">{searchFields}</span>
      <span class="hljs-attr">onSearch</span>=<span class="hljs-string">{handleSearch}</span>
      <span class="hljs-attr">rowKey</span>=<span class="hljs-string">"id"</span>
    /&gt;</span></span>
  );
};
</code></pre>
<h2 data-id="heading-12">äº”ã€æ¶æ„æ”¶ç›Šä¸é•¿æœŸä»·å€¼</h2>
<h3 data-id="heading-13">å¯åº¦é‡çš„æŠ€æœ¯æ”¶ç›Š</h3>
<ul>
<li>
<p><strong>å¼€å‘æ•ˆç‡</strong>ï¼šç»„ä»¶å¤ç”¨ç‡æå‡ 40-60%</p>
</li>
<li>
<p><strong>ç»´æŠ¤æˆæœ¬</strong>ï¼šUIåº“å‡çº§å·¥ä½œé‡å‡å°‘ 70-80%</p>
</li>
<li>
<p><strong>ä»£ç è´¨é‡</strong>ï¼šç±»å‹è¦†ç›–ç‡æå‡è‡³ 90%+</p>
</li>
<li>
<p><strong>å›¢é˜Ÿåä½œ</strong>ï¼šæ–°æˆå‘˜ä¸Šæ‰‹æ—¶é—´ç¼©çŸ­ 50%</p>
</li>
</ul>
<h3 data-id="heading-14">æˆ˜ç•¥ä»·å€¼</h3>
<ol>
<li>
<p><strong>æŠ€æœ¯å€ºåŠ¡æ§åˆ¶</strong>ï¼šé€šè¿‡ä¸­é—´å±‚éš”ç¦»å˜åŒ–ï¼Œæœ‰æ•ˆæ§åˆ¶æŠ€æœ¯å€ºåŠ¡ç§¯ç´¯</p>
</li>
<li>
<p><strong>æ¸è¿›å¼é‡æ„</strong>ï¼šæ”¯æŒè€ç³»ç»Ÿæ¸è¿›å¼è¿ç§»å’Œé‡æ„</p>
</li>
<li>
<p><strong>å¤šç«¯é€‚é…</strong>ï¼šä¸ºå°ç¨‹åºã€ç§»åŠ¨ç«¯ç­‰ä¸åŒå¹³å°æä¾›ç»Ÿä¸€API</p>
</li>
<li>
<p><strong>A/Bæµ‹è¯•</strong>ï¼šåœ¨ä¸­é—´å±‚å®ç°æ— ä¾µå…¥çš„åŠŸèƒ½å¼€å…³å’Œå®éªŒé…ç½®</p>
</li>
</ol>
<h2 data-id="heading-15">å…­ã€æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹</h2>
<h3 data-id="heading-16">å®æ–½å»ºè®®</h3>
<ol>
<li>
<p><strong>æ¸è¿›å¼æ¨è¿›</strong>ï¼šä»æœ€å¸¸ç”¨çš„ç»„ä»¶å¼€å§‹å°è£…ï¼Œé€æ­¥è¦†ç›–</p>
</li>
<li>
<p><strong>æ–‡æ¡£é©±åŠ¨</strong>ï¼šä¸ºæ¯ä¸ªä¸­é—´å±‚ç»„ä»¶æä¾›å®Œæ•´çš„ä½¿ç”¨æ–‡æ¡£å’Œç¤ºä¾‹</p>
</li>
<li>
<p><strong>ç‰ˆæœ¬ç®¡ç†</strong>ï¼šå»ºç«‹ä¸­é—´å±‚ç»„ä»¶çš„ç‰ˆæœ¬å‘å¸ƒå’Œæ›´æ–°æœºåˆ¶</p>
</li>
<li>
<p><strong>æ€§èƒ½ç›‘æ§</strong>ï¼šç›‘æ§ä¸­é—´å±‚ç»„ä»¶çš„æ€§èƒ½å½±å“å’Œé”™è¯¯ç‡</p>
</li>
</ol>
<h3 data-id="heading-17">é¿å…çš„é™·é˜±</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ è¿‡åº¦å°è£… - å¢åŠ äº†ä¸å¿…è¦çš„å¤æ‚åº¦</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">SuperButton</span> = (<span class="hljs-params">{ 
  ultraProp, 
  megaConfig, 
  ...rest 
}</span>) =&gt; {
  <span class="hljs-comment">// è¿‡äºå¤æ‚çš„é€»è¾‘...</span>
};

<span class="hljs-comment">// âœ… é€‚åº¦å°è£… - ä¿æŒç®€å•æ¸…æ™°</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">PrimaryButton</span> = (<span class="hljs-params">{ 
  confirm, 
  tracking, 
  ...buttonProps 
}</span>) =&gt; {
  <span class="hljs-comment">// èšç„¦æ ¸å¿ƒå¢å¼ºåŠŸèƒ½...</span>
};
</code></pre>
<h2 data-id="heading-18">æ€»ç»“</h2>
<p>å‰ç«¯ç»„ä»¶ä¸­é—´å±‚è®¾è®¡ä¸ä»…æ˜¯æŠ€æœ¯å®ç°ï¼Œæ›´æ˜¯æ¶æ„æ€ç»´çš„ä½“ç°ã€‚å®ƒé€šè¿‡åˆç†çš„æŠ½è±¡å’Œå°è£…ï¼Œåœ¨ä¿è¯å¼€å‘ä½“éªŒçš„åŒæ—¶ï¼Œä¸ºåº”ç”¨é•¿æœŸæ¼”è¿›æä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚æˆåŠŸçš„ä¸­é—´å±‚è®¾è®¡åº”è¯¥åƒä¸€åº§ç²¾å¿ƒè®¾è®¡çš„æ¡¥æ¢ï¼Œæ—¢è¿æ¥ç°åœ¨ä¸æœªæ¥ï¼Œåˆæ‰¿è½½ç€å›¢é˜Ÿåä½œå’Œä¸šåŠ¡å‘å±•çš„é‡ä»»ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»é›¶åˆ°ä¸€ï¼šè¿™ç¯‡JavaScriptæŒ‡å—è®©ä½ æˆä¸ºç‹¬ç«‹å¼€å‘è€…]]></title>    <link>https://juejin.cn/post/7570187256105517062</link>    <guid>https://juejin.cn/post/7570187256105517062</guid>    <pubDate>2025-11-09T23:30:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570187256105517062" data-draft-id="7570162686580015146" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»é›¶åˆ°ä¸€ï¼šè¿™ç¯‡JavaScriptæŒ‡å—è®©ä½ æˆä¸ºç‹¬ç«‹å¼€å‘è€…"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-11-09T23:30:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‰¯å±±æœ‰é£æ¥"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»é›¶åˆ°ä¸€ï¼šè¿™ç¯‡JavaScriptæŒ‡å—è®©ä½ æˆä¸ºç‹¬ç«‹å¼€å‘è€…
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‰¯å±±æœ‰é£æ¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T23:30:56.000Z" title="Sun Nov 09 2025 23:30:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    27
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½ æ˜¯ä¸æ˜¯æ›¾ç»çœ‹ç€æ»¡å±çš„ä»£ç æ„Ÿåˆ°æ— ä»ä¸‹æ‰‹ï¼Ÿæˆ–è€…è·Ÿç€æ•™ç¨‹åšé¡¹ç›®æ—¶æ€»æ˜¯ä¸€å¤´é›¾æ°´ï¼Ÿåˆ«æ‹…å¿ƒï¼Œä»Šå¤©è¿™ç¯‡æ–‡ç« å°±æ˜¯ä¸ºä½ å‡†å¤‡çš„ã€‚å­¦å®Œè¿™ç¯‡å†…å®¹ï¼Œä½ å°±èƒ½çœŸæ­£ç†è§£JavaScriptçš„ç²¾é«“ï¼Œç‹¬ç«‹å¼€å‘å‡ºå±äºè‡ªå·±çš„åº”ç”¨ã€‚</p>
<p>æˆ‘ä¼šå¸¦ä½ ä»æœ€åŸºç¡€çš„æ¦‚å¿µå¼€å§‹ï¼Œä¸€æ­¥æ­¥æ„å»ºå®Œæ•´çš„åº”ç”¨æ€ç»´ã€‚ä¸ç”¨æ‹…å¿ƒè‡ªå·±æ˜¯æ–°æ‰‹ï¼Œæˆ‘ä¼šç”¨æœ€é€šä¿—æ˜“æ‡‚çš„æ–¹å¼è®²è§£æ¯ä¸ªå…³é”®ç‚¹ã€‚è¯»å®Œè¿™ç¯‡æ–‡ç« ï¼Œä½ å°†è·å¾—å®Œæ•´çš„JavaScriptå¼€å‘èƒ½åŠ›ï¼Œèƒ½å¤Ÿç‹¬ç«‹è®¾è®¡å’Œå®ç°å‰ç«¯åº”ç”¨ã€‚</p>
<h2 data-id="heading-0">JavaScriptçš„æ ¸å¿ƒæ¦‚å¿µ</h2>
<p>è®©æˆ‘ä»¬å…ˆæ¥ç†è§£JavaScriptçš„å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚å¾ˆå¤šäººå­¦ä¸ä¼šç¼–ç¨‹ï¼Œå°±æ˜¯å› ä¸ºä¸€å¼€å§‹è¢«å„ç§æœ¯è¯­å“ä½äº†ã€‚å…¶å®ç¼–ç¨‹å°±åƒå­¦åšèœï¼Œå…ˆææ¸…æ¥šæ²¹ç›é…±é†‹æ˜¯å¹²ä»€ä¹ˆçš„ï¼Œå†å­¦ç‚’èœå°±ç®€å•äº†ã€‚</p>
<p>å˜é‡å°±åƒå¨æˆ¿é‡Œçš„è°ƒæ–™ç“¶ï¼Œç”¨æ¥å­˜æ”¾å„ç§æ•°æ®ã€‚åœ¨JavaScriptä¸­ï¼Œæˆ‘ä»¬å¸¸ç”¨letå’Œconstæ¥å£°æ˜å˜é‡ã€‚çœ‹è¿™ä¸ªä¾‹å­ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// letç”¨äºå£°æ˜å¯ä»¥æ”¹å˜çš„å˜é‡</span>
<span class="hljs-keyword">let</span> userName = <span class="hljs-string">'å°æ˜'</span>;
userName = <span class="hljs-string">'å°çº¢'</span>; <span class="hljs-comment">// è¿™æ ·å¯ä»¥æ”¹å˜</span>

<span class="hljs-comment">// constç”¨äºå£°æ˜ä¸å˜çš„å¸¸é‡</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MAX_USERS</span> = <span class="hljs-number">100</span>;
<span class="hljs-comment">// MAX_USERS = 200; è¿™æ ·ä¼šæŠ¥é”™ï¼Œå› ä¸ºå¸¸é‡ä¸èƒ½é‡æ–°èµ‹å€¼</span>
</code></pre>
<p>å‡½æ•°å°±åƒæ˜¯é¢„åˆ¶çš„è°ƒå‘³æ–™ç»„åˆï¼Œä¸€æ¬¡è°ƒé…ï¼Œå¤šæ¬¡ä½¿ç”¨ã€‚ç†è§£å‡½æ•°æ˜¯ç‹¬ç«‹å¼€å‘çš„ç¬¬ä¸€æ­¥ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªç®€å•çš„å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">greetUser</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`ä½ å¥½ï¼Œ<span class="hljs-subst">${name}</span>ï¼æ¬¢è¿ä½¿ç”¨æˆ‘ä»¬çš„åº”ç”¨ã€‚`</span>;
}

<span class="hljs-comment">// ä½¿ç”¨å‡½æ•°</span>
<span class="hljs-keyword">const</span> greeting = <span class="hljs-title function_">greetUser</span>(<span class="hljs-string">'å¼ ä¸‰'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(greeting); <span class="hljs-comment">// è¾“å‡ºï¼šä½ å¥½ï¼Œå¼ ä¸‰ï¼æ¬¢è¿ä½¿ç”¨æˆ‘ä»¬çš„åº”ç”¨ã€‚</span>
</code></pre>
<p>å¯¹è±¡å’Œæ•°ç»„è®©æˆ‘ä»¬èƒ½å¤Ÿç»„ç»‡æ›´å¤æ‚çš„æ•°æ®ã€‚æƒ³è±¡ä½ è¦å¼€å‘ä¸€ä¸ªå¾…åŠäº‹é¡¹åº”ç”¨ï¼Œå°±éœ€è¦ç”¨è¿™äº›ç»“æ„æ¥å­˜å‚¨ä»»åŠ¡æ•°æ®ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç”¨å¯¹è±¡è¡¨ç¤ºä¸€ä¸ªä»»åŠ¡</span>
<span class="hljs-keyword">const</span> task = {
    <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">title</span>: <span class="hljs-string">'å­¦ä¹ JavaScript'</span>,
    <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">dueDate</span>: <span class="hljs-string">'2024-12-31'</span>
};

<span class="hljs-comment">// ç”¨æ•°ç»„å­˜å‚¨å¤šä¸ªä»»åŠ¡</span>
<span class="hljs-keyword">const</span> taskList = [
    task,
    {
        <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">'å†™é¡¹ç›®æ–‡æ¡£'</span>,
        <span class="hljs-attr">completed</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">dueDate</span>: <span class="hljs-string">'2024-11-15'</span>
    }
];
</code></pre>
<h2 data-id="heading-1">ç°ä»£JavaScriptå¼€å‘å¿…å¤‡æŠ€èƒ½</h2>
<p>æŒæ¡äº†åŸºç¡€æ¦‚å¿µï¼Œæ¥ä¸‹æ¥è¦äº†è§£ç°ä»£JavaScriptå¼€å‘çš„å¿…å¤‡æŠ€èƒ½ã€‚è¿™äº›æ˜¯ä½ èƒ½ç‹¬ç«‹å¼€å‘åº”ç”¨çš„åŸºçŸ³ã€‚</p>
<p>å¼‚æ­¥ç¼–ç¨‹æ˜¯å¿…é¡»æŒæ¡çš„é‡ç‚¹ã€‚ç°åœ¨çš„åº”ç”¨éƒ½éœ€è¦ä¸æœåŠ¡å™¨é€šä¿¡ï¼Œç†è§£Promiseå’Œasync/awaitè‡³å…³é‡è¦ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ¨¡æ‹Ÿä»æœåŠ¡å™¨è·å–æ•°æ®</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchUserData</span>(<span class="hljs-params">userId</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-keyword">if</span> (userId === <span class="hljs-number">1</span>) {
                <span class="hljs-title function_">resolve</span>({ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'æå››'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">28</span> });
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-title function_">reject</span>(<span class="hljs-string">'ç”¨æˆ·ä¸å­˜åœ¨'</span>);
            }
        }, <span class="hljs-number">1000</span>);
    });
}

<span class="hljs-comment">// ä½¿ç”¨async/awaitå¤„ç†å¼‚æ­¥æ“ä½œ</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">displayUserInfo</span>(<span class="hljs-params">userId</span>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ­£åœ¨åŠ è½½ç”¨æˆ·ä¿¡æ¯...'</span>);
        <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUserData</span>(userId);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ç”¨æˆ·å§“åï¼š<span class="hljs-subst">${user.name}</span>ï¼Œå¹´é¾„ï¼š<span class="hljs-subst">${user.age}</span>`</span>);
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'å‡ºé”™å•¦ï¼š'</span>, error);
    }
}

<span class="hljs-comment">// è°ƒç”¨å‡½æ•°</span>
<span class="hljs-title function_">displayUserInfo</span>(<span class="hljs-number">1</span>);
</code></pre>
<p>DOMæ“ä½œè®©JavaScriptèƒ½å¤Ÿä¸ç½‘é¡µäº¤äº’ã€‚è¿™æ˜¯å‰ç«¯å¼€å‘çš„æ ¸å¿ƒèƒ½åŠ›ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºæ–°çš„ä»»åŠ¡å…ƒç´ å¹¶æ·»åŠ åˆ°é¡µé¢</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">addTaskToDOM</span>(<span class="hljs-params">task</span>) {
    <span class="hljs-comment">// åˆ›å»ºä»»åŠ¡å®¹å™¨</span>
    <span class="hljs-keyword">const</span> taskElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
    taskElement.<span class="hljs-property">className</span> = <span class="hljs-string">'task-item'</span>;
    taskElement.<span class="hljs-property">id</span> = <span class="hljs-string">`task-<span class="hljs-subst">${task.id}</span>`</span>;
    
    <span class="hljs-comment">// è®¾ç½®ä»»åŠ¡å†…å®¹</span>
    taskElement.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
        &lt;input type="checkbox" <span class="hljs-subst">${task.completed ? <span class="hljs-string">'checked'</span> : <span class="hljs-string">''</span>}</span>&gt;
        &lt;span class="task-title"&gt;<span class="hljs-subst">${task.title}</span>&lt;/span&gt;
        &lt;span class="due-date"&gt;<span class="hljs-subst">${task.dueDate}</span>&lt;/span&gt;
        &lt;button class="delete-btn"&gt;åˆ é™¤&lt;/button&gt;
    `</span>;
    
    <span class="hljs-comment">// æ·»åŠ åˆ°ä»»åŠ¡åˆ—è¡¨</span>
    <span class="hljs-keyword">const</span> taskList = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'task-list'</span>);
    taskList.<span class="hljs-title function_">appendChild</span>(taskElement);
    
    <span class="hljs-comment">// æ·»åŠ åˆ é™¤åŠŸèƒ½</span>
    <span class="hljs-keyword">const</span> deleteBtn = taskElement.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.delete-btn'</span>);
    deleteBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        taskElement.<span class="hljs-title function_">remove</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`åˆ é™¤äº†ä»»åŠ¡ï¼š<span class="hljs-subst">${task.title}</span>`</span>);
    });
}
</code></pre>
<h2 data-id="heading-2">æ„å»ºå®Œæ•´çš„å¾…åŠäº‹é¡¹åº”ç”¨</h2>
<p>ç°åœ¨è®©æˆ‘ä»¬æŠŠè¿™äº›çŸ¥è¯†ç‚¹ä¸²è”èµ·æ¥ï¼Œæ„å»ºä¸€ä¸ªå®Œæ•´çš„å¾…åŠäº‹é¡¹åº”ç”¨ã€‚è¿™ä¸ªä¾‹å­ä¼šæ¶µç›–æ•°æ®ç®¡ç†ã€ç”¨æˆ·äº¤äº’ã€æœ¬åœ°å­˜å‚¨ç­‰æ ¸å¿ƒæ¦‚å¿µã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåº”ç”¨çŠ¶æ€ç®¡ç†å™¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TodoApp</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadTasks</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentId</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> ? 
            <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...<span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> t.<span class="hljs-property">id</span>)) + <span class="hljs-number">1</span> : <span class="hljs-number">1</span>;
    }
    
    <span class="hljs-comment">// ä»æœ¬åœ°å­˜å‚¨åŠ è½½ä»»åŠ¡</span>
    <span class="hljs-title function_">loadTasks</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> saved = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'todoTasks'</span>);
        <span class="hljs-keyword">return</span> saved ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(saved) : [];
    }
    
    <span class="hljs-comment">// ä¿å­˜ä»»åŠ¡åˆ°æœ¬åœ°å­˜å‚¨</span>
    <span class="hljs-title function_">saveTasks</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'todoTasks'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>));
    }
    
    <span class="hljs-comment">// æ·»åŠ æ–°ä»»åŠ¡</span>
    <span class="hljs-title function_">addTask</span>(<span class="hljs-params">title, dueDate</span>) {
        <span class="hljs-keyword">const</span> newTask = {
            <span class="hljs-attr">id</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentId</span>++,
            <span class="hljs-attr">title</span>: title,
            <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">dueDate</span>: dueDate,
            <span class="hljs-attr">createdAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>()
        };
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-title function_">push</span>(newTask);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveTasks</span>();
        <span class="hljs-keyword">return</span> newTask;
    }
    
    <span class="hljs-comment">// åˆ‡æ¢ä»»åŠ¡å®ŒæˆçŠ¶æ€</span>
    <span class="hljs-title function_">toggleTask</span>(<span class="hljs-params">id</span>) {
        <span class="hljs-keyword">const</span> task = <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> t.<span class="hljs-property">id</span> === id);
        <span class="hljs-keyword">if</span> (task) {
            task.<span class="hljs-property">completed</span> = !task.<span class="hljs-property">completed</span>;
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveTasks</span>();
        }
    }
    
    <span class="hljs-comment">// åˆ é™¤ä»»åŠ¡</span>
    <span class="hljs-title function_">deleteTask</span>(<span class="hljs-params">id</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> t.<span class="hljs-property">id</span> !== id);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveTasks</span>();
    }
    
    <span class="hljs-comment">// è·å–æ‰€æœ‰ä»»åŠ¡</span>
    <span class="hljs-title function_">getAllTasks</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>;
    }
    
    <span class="hljs-comment">// è·å–æœªå®Œæˆçš„ä»»åŠ¡</span>
    <span class="hljs-title function_">getActiveTasks</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> !t.<span class="hljs-property">completed</span>);
    }
    
    <span class="hljs-comment">// è·å–å·²å®Œæˆçš„ä»»åŠ¡</span>
    <span class="hljs-title function_">getCompletedTasks</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> t.<span class="hljs-property">completed</span>);
    }
}
</code></pre>
<p>æ¥ä¸‹æ¥æ˜¯ç”¨æˆ·ç•Œé¢æ§åˆ¶å™¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TodoUI</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">app</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span> = app;
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initializeEventListeners</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">render</span>();
    }
    
    <span class="hljs-comment">// åˆå§‹åŒ–äº‹ä»¶ç›‘å¬</span>
    <span class="hljs-title function_">initializeEventListeners</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> addButton = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'add-task-btn'</span>);
        <span class="hljs-keyword">const</span> taskInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'new-task-input'</span>);
        <span class="hljs-keyword">const</span> dueDateInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'due-date-input'</span>);
        
        addButton.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleAddTask</span>(taskInput, dueDateInput);
        });
        
        taskInput.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keypress'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">'Enter'</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleAddTask</span>(taskInput, dueDateInput);
            }
        });
    }
    
    <span class="hljs-comment">// å¤„ç†æ·»åŠ ä»»åŠ¡</span>
    <span class="hljs-title function_">handleAddTask</span>(<span class="hljs-params">taskInput, dueDateInput</span>) {
        <span class="hljs-keyword">const</span> title = taskInput.<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>();
        <span class="hljs-keyword">const</span> dueDate = dueDateInput.<span class="hljs-property">value</span>;
        
        <span class="hljs-keyword">if</span> (title) {
            <span class="hljs-keyword">const</span> newTask = <span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span>.<span class="hljs-title function_">addTask</span>(title, dueDate);
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">render</span>();
            taskInput.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>;
            dueDateInput.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>;
            
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ·»åŠ äº†æ–°ä»»åŠ¡ï¼š"<span class="hljs-subst">${title}</span>"`</span>);
        }
    }
    
    <span class="hljs-comment">// æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨</span>
    <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> taskList = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'task-list'</span>);
        taskList.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">''</span>;
        
        <span class="hljs-keyword">const</span> tasks = <span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span>.<span class="hljs-title function_">getAllTasks</span>();
        
        tasks.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">task</span> =&gt;</span> {
            <span class="hljs-keyword">const</span> taskElement = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createTaskElement</span>(task);
            taskList.<span class="hljs-title function_">appendChild</span>(taskElement);
        });
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateStats</span>();
    }
    
    <span class="hljs-comment">// åˆ›å»ºä»»åŠ¡å…ƒç´ </span>
    <span class="hljs-title function_">createTaskElement</span>(<span class="hljs-params">task</span>) {
        <span class="hljs-keyword">const</span> taskElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
        taskElement.<span class="hljs-property">className</span> = <span class="hljs-string">`task-item <span class="hljs-subst">${task.completed ? <span class="hljs-string">'completed'</span> : <span class="hljs-string">''</span>}</span>`</span>;
        taskElement.<span class="hljs-property">id</span> = <span class="hljs-string">`task-<span class="hljs-subst">${task.id}</span>`</span>;
        
        taskElement.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
            &lt;div class="task-content"&gt;
                &lt;input type="checkbox" <span class="hljs-subst">${task.completed ? <span class="hljs-string">'checked'</span> : <span class="hljs-string">''</span>}</span> 
                    class="task-checkbox"&gt;
                &lt;span class="task-title"&gt;<span class="hljs-subst">${task.title}</span>&lt;/span&gt;
                <span class="hljs-subst">${task.dueDate ? <span class="hljs-string">`&lt;span class="due-date"&gt;æˆªæ­¢ï¼š<span class="hljs-subst">${task.dueDate}</span>&lt;/span&gt;`</span> : <span class="hljs-string">''</span>}</span>
            &lt;/div&gt;
            &lt;button class="delete-btn"&gt;åˆ é™¤&lt;/button&gt;
        `</span>;
        
        <span class="hljs-comment">// æ·»åŠ å¤é€‰æ¡†äº‹ä»¶</span>
        <span class="hljs-keyword">const</span> checkbox = taskElement.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.task-checkbox'</span>);
        checkbox.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>, <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span>.<span class="hljs-title function_">toggleTask</span>(task.<span class="hljs-property">id</span>);
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">render</span>();
        });
        
        <span class="hljs-comment">// æ·»åŠ åˆ é™¤æŒ‰é’®äº‹ä»¶</span>
        <span class="hljs-keyword">const</span> deleteBtn = taskElement.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.delete-btn'</span>);
        deleteBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span>.<span class="hljs-title function_">deleteTask</span>(task.<span class="hljs-property">id</span>);
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">render</span>();
        });
        
        <span class="hljs-keyword">return</span> taskElement;
    }
    
    <span class="hljs-comment">// æ›´æ–°ç»Ÿè®¡ä¿¡æ¯</span>
    <span class="hljs-title function_">updateStats</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> totalTasks = <span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span>.<span class="hljs-title function_">getAllTasks</span>().<span class="hljs-property">length</span>;
        <span class="hljs-keyword">const</span> activeTasks = <span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span>.<span class="hljs-title function_">getActiveTasks</span>().<span class="hljs-property">length</span>;
        <span class="hljs-keyword">const</span> completedTasks = <span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span>.<span class="hljs-title function_">getCompletedTasks</span>().<span class="hljs-property">length</span>;
        
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ€»ä»»åŠ¡ï¼š<span class="hljs-subst">${totalTasks}</span>ï¼Œå¾…å®Œæˆï¼š<span class="hljs-subst">${activeTasks}</span>ï¼Œå·²å®Œæˆï¼š<span class="hljs-subst">${completedTasks}</span>`</span>);
    }
}
</code></pre>
<p>æœ€åæ˜¯åº”ç”¨çš„åˆå§‹åŒ–ä»£ç ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åº”ç”¨å¯åŠ¨å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">initializeApp</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// åˆ›å»ºåº”ç”¨å®ä¾‹</span>
    <span class="hljs-keyword">const</span> todoApp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TodoApp</span>();
    <span class="hljs-keyword">const</span> todoUI = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TodoUI</span>(todoApp);
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å¾…åŠäº‹é¡¹åº”ç”¨å·²å¯åŠ¨ï¼'</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å½“å‰ä»»åŠ¡æ•°é‡ï¼š'</span>, todoApp.<span class="hljs-title function_">getAllTasks</span>().<span class="hljs-property">length</span>);
    
    <span class="hljs-keyword">return</span> { todoApp, todoUI };
}

<span class="hljs-comment">// å½“é¡µé¢åŠ è½½å®Œæˆåå¯åŠ¨åº”ç”¨</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, initializeApp);
</code></pre>
<h2 data-id="heading-3">è¿›é˜¶æŠ€å·§å’Œæœ€ä½³å®è·µ</h2>
<p>å½“ä½ èƒ½å¤Ÿç‹¬ç«‹å®ŒæˆåŸºç¡€åº”ç”¨åï¼Œè¿™äº›è¿›é˜¶æŠ€å·§ä¼šè®©ä½ çš„ä»£ç æ›´åŠ ä¸“ä¸šå’Œå¯ç»´æŠ¤ã€‚</p>
<p>æ¨¡å—åŒ–æ˜¯ç°ä»£JavaScriptå¼€å‘çš„é‡è¦æ¦‚å¿µã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ES6æ¨¡å—æ¥ç»„ç»‡ä»£ç ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils/dateHelper.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">formatDate</span>(<span class="hljs-params">dateString</span>) {
    <span class="hljs-keyword">const</span> options = { <span class="hljs-attr">year</span>: <span class="hljs-string">'numeric'</span>, <span class="hljs-attr">month</span>: <span class="hljs-string">'short'</span>, <span class="hljs-attr">day</span>: <span class="hljs-string">'numeric'</span> };
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(dateString).<span class="hljs-title function_">toLocaleDateString</span>(<span class="hljs-string">'zh-CN'</span>, options);
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">isOverdue</span>(<span class="hljs-params">dueDate</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(dueDate) &lt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
}

<span class="hljs-comment">// åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­å¯¼å…¥ä½¿ç”¨</span>
<span class="hljs-keyword">import</span> { formatDate, isOverdue } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/dateHelper.js'</span>;

<span class="hljs-keyword">const</span> dueDate = <span class="hljs-string">'2024-12-31'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ ¼å¼åŒ–æ—¥æœŸï¼š<span class="hljs-subst">${formatDate(dueDate)}</span>`</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ˜¯å¦è¿‡æœŸï¼š<span class="hljs-subst">${isOverdue(dueDate)}</span>`</span>);
</code></pre>
<p>é”™è¯¯å¤„ç†æ˜¯ä¸“ä¸šå¼€å‘è€…çš„æ ‡å¿—ã€‚å­¦ä¼šä¼˜é›…åœ°å¤„ç†å„ç§å¼‚å¸¸æƒ…å†µï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DataValidator</span> {
    <span class="hljs-keyword">static</span> <span class="hljs-title function_">validateTask</span>(<span class="hljs-params">task</span>) {
        <span class="hljs-keyword">const</span> errors = [];
        
        <span class="hljs-keyword">if</span> (!task.<span class="hljs-property">title</span> || task.<span class="hljs-property">title</span>.<span class="hljs-title function_">trim</span>().<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
            errors.<span class="hljs-title function_">push</span>(<span class="hljs-string">'ä»»åŠ¡æ ‡é¢˜ä¸èƒ½ä¸ºç©º'</span>);
        }
        
        <span class="hljs-keyword">if</span> (task.<span class="hljs-property">title</span> &amp;&amp; task.<span class="hljs-property">title</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">100</span>) {
            errors.<span class="hljs-title function_">push</span>(<span class="hljs-string">'ä»»åŠ¡æ ‡é¢˜ä¸èƒ½è¶…è¿‡100ä¸ªå­—ç¬¦'</span>);
        }
        
        <span class="hljs-keyword">if</span> (task.<span class="hljs-property">dueDate</span> &amp;&amp; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(task.<span class="hljs-property">dueDate</span>) &lt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()) {
            errors.<span class="hljs-title function_">push</span>(<span class="hljs-string">'æˆªæ­¢æ—¥æœŸä¸èƒ½æ˜¯è¿‡å»çš„æ—¶é—´'</span>);
        }
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">isValid</span>: errors.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>,
            <span class="hljs-attr">errors</span>: errors
        };
    }
}

<span class="hljs-comment">// ä½¿ç”¨éªŒè¯å™¨</span>
<span class="hljs-keyword">const</span> newTask = {
    <span class="hljs-attr">title</span>: <span class="hljs-string">'å­¦ä¹ JavaScripté«˜çº§æŠ€å·§'</span>,
    <span class="hljs-attr">dueDate</span>: <span class="hljs-string">'2024-12-31'</span>
};

<span class="hljs-keyword">const</span> validation = <span class="hljs-title class_">DataValidator</span>.<span class="hljs-title function_">validateTask</span>(newTask);
<span class="hljs-keyword">if</span> (!validation.<span class="hljs-property">isValid</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'éªŒè¯å¤±è´¥ï¼š'</span>, validation.<span class="hljs-property">errors</span>);
} <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ä»»åŠ¡æ•°æ®æœ‰æ•ˆï¼Œå¯ä»¥ä¿å­˜'</span>);
}
</code></pre>
<p>æ€§èƒ½ä¼˜åŒ–è®©ä½ çš„åº”ç”¨æ›´åŠ æµç•…ã€‚è¿™é‡Œæœ‰ä¸€äº›å®ç”¨çš„ä¼˜åŒ–æŠ€å·§ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½¿ç”¨é˜²æŠ–ä¼˜åŒ–æœç´¢åŠŸèƒ½</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">func, wait</span>) {
    <span class="hljs-keyword">let</span> timeout;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">executedFunction</span>(<span class="hljs-params">...args</span>) {
        <span class="hljs-keyword">const</span> <span class="hljs-title function_">later</span> = (<span class="hljs-params"/>) =&gt; {
            <span class="hljs-built_in">clearTimeout</span>(timeout);
            <span class="hljs-title function_">func</span>(...args);
        };
        <span class="hljs-built_in">clearTimeout</span>(timeout);
        timeout = <span class="hljs-built_in">setTimeout</span>(later, wait);
    };
}

<span class="hljs-comment">// æœç´¢ä»»åŠ¡</span>
<span class="hljs-keyword">const</span> searchTasks = <span class="hljs-title function_">debounce</span>(<span class="hljs-function">(<span class="hljs-params">searchTerm</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> filteredTasks = todoApp.<span class="hljs-title function_">getAllTasks</span>().<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">task</span> =&gt;</span>
        task.<span class="hljs-property">title</span>.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">includes</span>(searchTerm.<span class="hljs-title function_">toLowerCase</span>())
    );
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ‰¾åˆ° <span class="hljs-subst">${filteredTasks.length}</span> ä¸ªåŒ¹é…çš„ä»»åŠ¡`</span>);
}, <span class="hljs-number">300</span>);

<span class="hljs-comment">// åœ¨è¾“å…¥æ¡†ä¸­ä½¿ç”¨</span>
<span class="hljs-keyword">const</span> searchInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'search-input'</span>);
searchInput.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'input'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-title function_">searchTasks</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>);
});
</code></pre>
<h2 data-id="heading-4">ä»å­¦ä¹ åˆ°å®æˆ˜çš„è½¬å˜</h2>
<p>å¾ˆå¤šäººå­¦å®ŒåŸºç¡€çŸ¥è¯†åï¼Œä¸çŸ¥é“å¦‚ä½•å¼€å§‹çœŸæ­£çš„é¡¹ç›®å¼€å‘ã€‚è¿™é‡Œç»™ä½ ä¸€ä¸ªæ¸…æ™°çš„è·¯å¾„ã€‚</p>
<p>é¦–å…ˆé€‰æ‹©é€‚åˆçš„ç»ƒä¹ é¡¹ç›®ã€‚ä»ç®€å•åˆ°å¤æ‚ï¼Œé€æ­¥æå‡ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é¡¹ç›®éš¾åº¦åˆ†çº§</span>
<span class="hljs-keyword">const</span> projectRoadmap = [
    {
        <span class="hljs-attr">level</span>: <span class="hljs-string">'åˆçº§'</span>,
        <span class="hljs-attr">projects</span>: [
            <span class="hljs-string">'ä¸ªäººåšå®¢é¡µé¢'</span>,
            <span class="hljs-string">'è®¡ç®—å™¨åº”ç”¨'</span>,
            <span class="hljs-string">'å¤©æ°”æŸ¥è¯¢å°å·¥å…·'</span>,
            <span class="hljs-string">'ç®€å•çš„æ¸¸æˆï¼ˆå¦‚äº•å­—æ£‹ï¼‰'</span>
        ],
        <span class="hljs-attr">skills</span>: [<span class="hljs-string">'åŸºç¡€DOMæ“ä½œ'</span>, <span class="hljs-string">'äº‹ä»¶å¤„ç†'</span>, <span class="hljs-string">'æ¡ä»¶åˆ¤æ–­'</span>]
    },
    {
        <span class="hljs-attr">level</span>: <span class="hljs-string">'ä¸­çº§'</span>,
        <span class="hljs-attr">projects</span>: [
            <span class="hljs-string">'å¾…åŠäº‹é¡¹åº”ç”¨ï¼ˆå¸¦æœ¬åœ°å­˜å‚¨ï¼‰'</span>,
            <span class="hljs-string">'è®°è´¦åº”ç”¨'</span>,
            <span class="hljs-string">'å›¾ç‰‡ç”»å»Š'</span>,
            <span class="hljs-string">'APIæ•°æ®å±•ç¤ºåº”ç”¨'</span>
        ],
        <span class="hljs-attr">skills</span>: [<span class="hljs-string">'å¼‚æ­¥ç¼–ç¨‹'</span>, <span class="hljs-string">'æœ¬åœ°å­˜å‚¨'</span>, <span class="hljs-string">'æ¨¡å—åŒ–'</span>, <span class="hljs-string">'é”™è¯¯å¤„ç†'</span>]
    },
    {
        <span class="hljs-attr">level</span>: <span class="hljs-string">'é«˜çº§'</span>,
        <span class="hljs-attr">projects</span>: [
            <span class="hljs-string">'å®æ—¶èŠå¤©åº”ç”¨'</span>,
            <span class="hljs-string">'ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ'</span>,
            <span class="hljs-string">'æ•°æ®å¯è§†åŒ–ä»ªè¡¨æ¿'</span>,
            <span class="hljs-string">'å°å‹ç”µå•†ç½‘ç«™'</span>
        ],
        <span class="hljs-attr">skills</span>: [<span class="hljs-string">'æ¡†æ¶ä½¿ç”¨'</span>, <span class="hljs-string">'çŠ¶æ€ç®¡ç†'</span>, <span class="hljs-string">'æ€§èƒ½ä¼˜åŒ–'</span>, <span class="hljs-string">'æµ‹è¯•'</span>]
    }
];
</code></pre>
<p>å­¦ä¼šé˜…è¯»æ–‡æ¡£å’ŒæŸ¥æ‰¾èµ„æ–™ã€‚è¿™æ˜¯ç‹¬ç«‹å¼€å‘è€…æœ€é‡è¦çš„èƒ½åŠ›ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ¨¡æ‹Ÿè§£å†³é—®é¢˜çš„è¿‡ç¨‹</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">solveProblem</span>(<span class="hljs-params">problemDescription</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'é—®é¢˜ï¼š'</span>, problemDescription);
    
    <span class="hljs-comment">// ç¬¬ä¸€æ­¥ï¼šåˆ†æé—®é¢˜</span>
    <span class="hljs-keyword">const</span> analysis = <span class="hljs-title function_">analyzeProblem</span>(problemDescription);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'é—®é¢˜åˆ†æï¼š'</span>, analysis);
    
    <span class="hljs-comment">// ç¬¬äºŒæ­¥ï¼šæŸ¥æ‰¾ç›¸å…³èµ„æ–™</span>
    <span class="hljs-keyword">const</span> resources = <span class="hljs-keyword">await</span> <span class="hljs-title function_">searchResources</span>(analysis.<span class="hljs-property">keywords</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç›¸å…³èµ„æºï¼š'</span>, resources);
    
    <span class="hljs-comment">// ç¬¬ä¸‰æ­¥ï¼šå°è¯•è§£å†³æ–¹æ¡ˆ</span>
    <span class="hljs-keyword">const</span> solution = <span class="hljs-title function_">trySolutions</span>(resources);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è§£å†³æ–¹æ¡ˆï¼š'</span>, solution);
    
    <span class="hljs-comment">// ç¬¬å››æ­¥ï¼šæ€»ç»“å­¦ä¹ </span>
    <span class="hljs-keyword">const</span> learnings = <span class="hljs-title function_">summarizeLearnings</span>(problemDescription, solution);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å­¦ä¹ æ€»ç»“ï¼š'</span>, learnings);
    
    <span class="hljs-keyword">return</span> solution;
}
</code></pre>
<p>å»ºç«‹è‡ªå·±çš„ä»£ç åº“å’Œå·¥å…·é›†ã€‚è¿™ä¼šå¤§å¤§æé«˜ä½ çš„å¼€å‘æ•ˆç‡ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸ªäººå·¥å…·å‡½æ•°åº“</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DevUtils</span> {
    <span class="hljs-comment">// æ·±åº¦å¤åˆ¶å¯¹è±¡</span>
    <span class="hljs-keyword">static</span> <span class="hljs-title function_">deepClone</span>(<span class="hljs-params">obj</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj));
    }
    
    <span class="hljs-comment">// ç”ŸæˆéšæœºID</span>
    <span class="hljs-keyword">static</span> <span class="hljs-title function_">generateId</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>().<span class="hljs-title function_">toString</span>(<span class="hljs-number">36</span>) + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>().<span class="hljs-title function_">toString</span>(<span class="hljs-number">36</span>).<span class="hljs-title function_">substr</span>(<span class="hljs-number">2</span>);
    }
    
    <span class="hljs-comment">// æ ¼å¼åŒ–æ–‡ä»¶å¤§å°</span>
    <span class="hljs-keyword">static</span> <span class="hljs-title function_">formatFileSize</span>(<span class="hljs-params">bytes</span>) {
        <span class="hljs-keyword">const</span> sizes = [<span class="hljs-string">'Bytes'</span>, <span class="hljs-string">'KB'</span>, <span class="hljs-string">'MB'</span>, <span class="hljs-string">'GB'</span>];
        <span class="hljs-keyword">if</span> (bytes === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'0 Bytes'</span>;
        <span class="hljs-keyword">const</span> i = <span class="hljs-built_in">parseInt</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">log</span>(bytes) / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1024</span>)));
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(bytes / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-number">1024</span>, i), <span class="hljs-number">2</span>) + <span class="hljs-string">' '</span> + sizes[i];
    }
    
    <span class="hljs-comment">// ç­‰å¾…æŒ‡å®šæ—¶é—´</span>
    <span class="hljs-keyword">static</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-params">ms</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, ms));
    }
}

<span class="hljs-comment">// ä½¿ç”¨å·¥å…·å‡½æ•°</span>
<span class="hljs-keyword">const</span> originalObject = { <span class="hljs-attr">name</span>: <span class="hljs-string">'æµ‹è¯•'</span>, <span class="hljs-attr">data</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>] };
<span class="hljs-keyword">const</span> clonedObject = <span class="hljs-title class_">DevUtils</span>.<span class="hljs-title function_">deepClone</span>(originalObject);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å…‹éš†çš„å¯¹è±¡ï¼š'</span>, clonedObject);
</code></pre>
<h2 data-id="heading-5">æŒç»­å­¦ä¹ å’Œè¿›æ­¥</h2>
<p>ç¼–ç¨‹æ˜¯ä¸€ä¸ªéœ€è¦æŒç»­å­¦ä¹ çš„é¢†åŸŸã€‚å»ºç«‹å¥½çš„å­¦ä¹ ä¹ æƒ¯ä¼šè®©ä½ èµ°å¾—æ›´è¿œã€‚</p>
<p>åˆ¶å®šåˆç†çš„å­¦ä¹ è®¡åˆ’ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å‘¨å­¦ä¹ è®¡åˆ’ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> weeklyLearningPlan = {
    <span class="hljs-attr">monday</span>: {
        <span class="hljs-attr">focus</span>: <span class="hljs-string">'æ–°æŠ€æœ¯æ¢ç´¢'</span>,
        <span class="hljs-attr">tasks</span>: [
            <span class="hljs-string">'é˜…è¯»ä¸€ç¯‡æŠ€æœ¯æ–‡ç« '</span>,
            <span class="hljs-string">'å°è¯•ä¸€ä¸ªæ–°çš„JavaScriptç‰¹æ€§'</span>,
            <span class="hljs-string">'å†™ä¸€ä¸ªå°demoéªŒè¯ç†è§£'</span>
        ],
        <span class="hljs-attr">time</span>: <span class="hljs-string">'1-2å°æ—¶'</span>
    },
    <span class="hljs-attr">wednesday</span>: {
        <span class="hljs-attr">focus</span>: <span class="hljs-string">'é¡¹ç›®å®è·µ'</span>,
        <span class="hljs-attr">tasks</span>: [
            <span class="hljs-string">'åœ¨ä¸ªäººé¡¹ç›®ä¸Šå·¥ä½œ'</span>,
            <span class="hljs-string">'é‡æ„æ—§ä»£ç '</span>,
            <span class="hljs-string">'æ·»åŠ æ–°åŠŸèƒ½'</span>
        ],
        <span class="hljs-attr">time</span>: <span class="hljs-string">'2-3å°æ—¶'</span>
    },
    <span class="hljs-attr">friday</span>: {
        <span class="hljs-attr">focus</span>: <span class="hljs-string">'æ€»ç»“å’Œå¤ä¹ '</span>,
        <span class="hljs-attr">tasks</span>: [
            <span class="hljs-string">'æ•´ç†æœ¬å‘¨å­¦ä¹ ç¬”è®°'</span>,
            <span class="hljs-string">'å›é¡¾é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ'</span>,
            <span class="hljs-string">'è§„åˆ’ä¸‹å‘¨å­¦ä¹ å†…å®¹'</span>
        ],
        <span class="hljs-attr">time</span>: <span class="hljs-string">'1å°æ—¶'</span>
    }
};
</code></pre>
<p>å‚ä¸å¼€æºé¡¹ç›®å’Œç¼–ç¨‹ç¤¾åŒºï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å‚ä¸å¼€æºçš„å»ºè®®æ­¥éª¤</span>
<span class="hljs-keyword">const</span> openSourceGuide = {
    <span class="hljs-attr">step1</span>: <span class="hljs-string">'å¯»æ‰¾æ„Ÿå…´è¶£çš„é¡¹ç›®'</span>,
    <span class="hljs-attr">criteria</span>: [
        <span class="hljs-string">'æœ‰æ¸…æ™°çš„æ–‡æ¡£'</span>,
        <span class="hljs-string">'æœ‰æ´»è·ƒçš„ç»´æŠ¤è€…'</span>,
        <span class="hljs-string">'æœ‰good first issueæ ‡ç­¾'</span>
    ],
    
    <span class="hljs-attr">step2</span>: <span class="hljs-string">'ç†è§£é¡¹ç›®ç»“æ„'</span>,
    <span class="hljs-attr">actions</span>: [
        <span class="hljs-string">'é˜…è¯»READMEå’Œè´¡çŒ®æŒ‡å—'</span>,
        <span class="hljs-string">'åœ¨æœ¬åœ°è¿è¡Œé¡¹ç›®'</span>,
        <span class="hljs-string">'æŸ¥çœ‹ç°æœ‰ä»£ç é£æ ¼'</span>
    ],
    
    <span class="hljs-attr">step3</span>: <span class="hljs-string">'ä»å°å¤„ç€æ‰‹'</span>,
    <span class="hljs-attr">suggestions</span>: [
        <span class="hljs-string">'ä¿®å¤æ–‡æ¡£é”™è¯¯'</span>,
        <span class="hljs-string">'è§£å†³ç®€å•çš„bug'</span>,
        <span class="hljs-string">'æ·»åŠ æµ‹è¯•ç”¨ä¾‹'</span>
    ],
    
    <span class="hljs-attr">step4</span>: <span class="hljs-string">'æäº¤è´¡çŒ®'</span>,
    <span class="hljs-attr">tips</span>: [
        <span class="hljs-string">'éµå¾ªé¡¹ç›®è§„èŒƒ'</span>,
        <span class="hljs-string">'ç¼–å†™æ¸…æ™°çš„æäº¤ä¿¡æ¯'</span>,
        <span class="hljs-string">'è€å¿ƒç­‰å¾…ä»£ç å®¡æŸ¥'</span>
    ]
};
</code></pre>
<h2 data-id="heading-6">çœŸæ­£çš„ç‹¬ç«‹å¼€å‘ä¹‹è·¯</h2>
<p>è¯»å®Œè¿™ç¯‡æ–‡ç« ï¼Œä½ å·²ç»æŒæ¡äº†ä»é›¶å¼€å§‹ç‹¬ç«‹å¼€å‘JavaScriptåº”ç”¨çš„æ ¸å¿ƒçŸ¥è¯†å’ŒæŠ€èƒ½ã€‚ä»åŸºç¡€è¯­æ³•åˆ°å®Œæ•´åº”ç”¨æ¶æ„ï¼Œä»ä»£ç ç¼–å†™åˆ°é—®é¢˜è§£å†³ï¼Œä½ ç°åœ¨å…·å¤‡äº†ç‹¬ç«‹æ¢ç´¢å’Œåˆ›é€ çš„èƒ½åŠ›ã€‚</p>
<p>è®°ä½ï¼Œæˆä¸ºçœŸæ­£çš„ç‹¬ç«‹å¼€å‘è€…ä¸åœ¨äºè®°ä½æ‰€æœ‰APIï¼Œè€Œåœ¨äºåŸ¹å…»è§£å†³é—®é¢˜çš„èƒ½åŠ›ã€‚å½“ä½ é‡åˆ°æœªçŸ¥çš„æŒ‘æˆ˜æ—¶ï¼Œèƒ½å¤Ÿå†·é™åˆ†æã€å¯»æ‰¾èµ„æºã€å°è¯•æ–¹æ¡ˆï¼Œè¿™æ‰æ˜¯æœ€å®è´µçš„æŠ€èƒ½ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Javaæ€§èƒ½è°ƒä¼˜çš„7ä¸ªè¢«ä½ä¼°çš„æŠ€å·§ï¼šä»ä»£ç åˆ°JVMå…¨é“¾è·¯ä¼˜åŒ–]]></title>    <link>https://juejin.cn/post/7570533058841198627</link>    <guid>https://juejin.cn/post/7570533058841198627</guid>    <pubDate>2025-11-10T04:19:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570533058841198627" data-draft-id="7570651893867774004" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Javaæ€§èƒ½è°ƒä¼˜çš„7ä¸ªè¢«ä½ä¼°çš„æŠ€å·§ï¼šä»ä»£ç åˆ°JVMå…¨é“¾è·¯ä¼˜åŒ–"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-10T04:19:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT_é™ˆå¯’"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Javaæ€§èƒ½è°ƒä¼˜çš„7ä¸ªè¢«ä½ä¼°çš„æŠ€å·§ï¼šä»ä»£ç åˆ°JVMå…¨é“¾è·¯ä¼˜åŒ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT_é™ˆå¯’
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T04:19:27.000Z" title="Mon Nov 10 2025 04:19:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Javaæ€§èƒ½è°ƒä¼˜çš„7ä¸ªè¢«ä½ä¼°çš„æŠ€å·§ï¼šä»ä»£ç åˆ°JVMå…¨é“¾è·¯ä¼˜åŒ–</strong></h2>
<h3 data-id="heading-1">å¼•è¨€</h3>
<p>åœ¨Javaå¼€å‘ä¸­ï¼Œæ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæ°¸æ’çš„è¯é¢˜ã€‚è™½ç„¶å¤§å¤šæ•°å¼€å‘è€…ç†Ÿæ‚‰åŸºç¡€çš„ä¼˜åŒ–æ‰‹æ®µï¼ˆå¦‚ä½¿ç”¨ç¼“å­˜ã€å‡å°‘æ•°æ®åº“æŸ¥è¯¢ç­‰ï¼‰ï¼Œä½†è®¸å¤šæ·±å±‚æ¬¡çš„æŠ€å·§å¾€å¾€è¢«ä½ä¼°æˆ–å¿½è§†ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨7ä¸ªé²œä¸ºäººçŸ¥ä½†æå…·ä»·å€¼çš„Javaæ€§èƒ½è°ƒä¼˜æŠ€å·§ï¼Œæ¶µç›–ä»ä»£ç ç¼–å†™åˆ°JVMå‚æ•°é…ç½®çš„å…¨é“¾è·¯ä¼˜åŒ–ã€‚è¿™äº›æŠ€å·§åŸºäºçœŸå®çš„å®è·µç»éªŒå’Œæƒå¨èµ„æ–™ï¼ˆå¦‚Oracleå®˜æ–¹æ–‡æ¡£ã€JVMè§„èŒƒåŠæ€§èƒ½ä¸“å®¶çš„å»ºè®®ï¼‰ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘è€…æŒ–æ˜æ›´æ·±å±‚æ¬¡çš„æ€§èƒ½æ½œåŠ›ã€‚</p>
<hr/>
<h3 data-id="heading-2">1. å­—ç¬¦ä¸²æ“ä½œçš„éšè—é™·é˜±ä¸ä¼˜åŒ–</h3>
<p>å­—ç¬¦ä¸²æ“ä½œæ˜¯Javaä¸­æœ€å¸¸è§çš„æ€§èƒ½ç“¶é¢ˆä¹‹ä¸€ï¼Œå°¤å…¶æ˜¯<code>String</code>çš„ä¸å¯å˜æ€§å¯¼è‡´çš„é¢‘ç¹å¯¹è±¡åˆ›å»ºã€‚ä»¥ä¸‹æ˜¯ä¸¤ä¸ªå…³é”®ä¼˜åŒ–ç‚¹ï¼š</p>
<h4 data-id="heading-3">ä½¿ç”¨<code>StringBuilder</code>æ›¿ä»£å­—ç¬¦ä¸²æ‹¼æ¥</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä½æ•ˆå†™æ³•</span>
<span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    result += i;
}

<span class="hljs-comment">// é«˜æ•ˆå†™æ³•</span>
<span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    sb.append(i);
}
<span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> sb.toString();
</code></pre>
<p><strong>åŸç†</strong>ï¼šæ¯æ¬¡<code>+=</code>æ“ä½œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„<code>String</code>å¯¹è±¡ï¼Œè€Œ<code>StringBuilder</code>é€šè¿‡å¯å˜å­—ç¬¦æ•°ç»„é¿å…é‡å¤åˆ†é…å†…å­˜ã€‚</p>
<h4 data-id="heading-4">é¢„åˆ†é…<code>StringBuilder</code>å®¹é‡</h4>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>StringBuilder</code>çš„åˆå§‹å®¹é‡ä¸º16å­—èŠ‚ï¼Œé¢‘ç¹æ‰©å®¹ä¼šæ¶ˆè€—èµ„æºã€‚é€šè¿‡é¢„ä¼°å¤§å°æå‰åˆ†é…å®¹é‡å¯æ˜¾è‘—æå‡æ€§èƒ½ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(<span class="hljs-number">1024</span>); <span class="hljs-comment">// é¢„åˆ†é…1KBç©ºé—´</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">2. é›†åˆç±»çš„é€‰æ‹©ä¸è°ƒä¼˜</h3>
<p>ä¸åŒçš„é›†åˆç±»åœ¨ä¸åŒåœºæ™¯ä¸‹æ€§èƒ½å·®å¼‚å·¨å¤§ï¼š</p>
<h4 data-id="heading-6"><code>ArrayList</code> vs <code>LinkedList</code></h4>
<ul>
<li><strong>éšæœºè®¿é—®</strong>ï¼š<code>ArrayList</code>çš„å¤æ‚åº¦ä¸ºO(1)ï¼Œè€Œ<code>LinkedList</code>ä¸ºO(n)ã€‚</li>
<li><strong>æ’å…¥/åˆ é™¤</strong>ï¼šåœ¨å¤´éƒ¨æ’å…¥æ—¶ï¼Œ<code>LinkedList</code>ï¼ˆO(1)ï¼‰ä¼˜äº<code>ArrayList</code>ï¼ˆO(n)ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-7">HashMapçš„è´Ÿè½½å› å­ä¸åˆå§‹åŒ–å¤§å°</h4>
<p>é»˜è®¤è´Ÿè½½å› å­ï¼ˆ0.75ï¼‰å’Œåˆå§‹å®¹é‡ï¼ˆ16ï¼‰å¯èƒ½ä¸é€‚ç”¨äºé«˜é¢‘åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œè‹¥é¢„æœŸå­˜å‚¨10,000ä¸ªå…ƒç´ ï¼š</p>
<pre><code class="hljs language-java" lang="java">Map&lt;String, Integer&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(<span class="hljs-number">16384</span>, <span class="hljs-number">0.5f</span>); <span class="hljs-comment">// å‡å°‘æ‰©å®¹æ¬¡æ•°</span>
</code></pre>
<hr/>
<h3 data-id="heading-8">3. JITç¼–è¯‘å™¨çš„å†·å¯åŠ¨ä¼˜åŒ–</h3>
<p>Javaçš„JITï¼ˆJust-In-Timeï¼‰ç¼–è¯‘å™¨è™½ç„¶èƒ½åŠ¨æ€ä¼˜åŒ–çƒ­ç‚¹ä»£ç ï¼Œä½†å†·å¯åŠ¨é˜¶æ®µä»å¯èƒ½æˆä¸ºç“¶é¢ˆã€‚ä»¥ä¸‹æ–¹æ³•å¯ç¼“è§£é—®é¢˜ï¼š</p>
<h4 data-id="heading-9"><strong>åˆ†å±‚ç¼–è¯‘ç­–ç•¥</strong></h4>
<p>é€šè¿‡JVMå‚æ•°å¯ç”¨åˆ†å±‚ç¼–è¯‘ï¼ˆé»˜è®¤å·²å¼€å¯ï¼‰ï¼š</p>
<pre><code class="hljs language-ruby" lang="ruby">-<span class="hljs-variable constant_">XX</span><span class="hljs-symbol">:+TieredCompilation</span>
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šç»“åˆè§£é‡Šæ‰§è¡Œä¸ç¼–è¯‘æ‰§è¡Œçš„ä¼˜åŠ¿ï¼Œé€æ­¥æå‡æ€§èƒ½ã€‚</p>
<h4 data-id="heading-10"><strong>é¢„çƒ­å…³é”®è·¯å¾„ä»£ç </strong></h4>
<p>åœ¨é«˜å¹¶å‘ç³»ç»Ÿä¸­ï¼Œå¯é€šè¿‡æ¨¡æ‹Ÿè¯·æ±‚æå‰è§¦å‘JITç¼–è¯‘æ ¸å¿ƒé€»è¾‘ã€‚</p>
<hr/>
<h3 data-id="heading-11">4. é€ƒé€¸åˆ†æä¸æ ˆä¸Šåˆ†é…</h3>
<p>é€ƒé€¸åˆ†æï¼ˆEscape Analysisï¼‰æ˜¯JVMçš„ä¸€é¡¹é«˜çº§ä¼˜åŒ–æŠ€æœ¯ï¼Œç”¨äºåˆ¤æ–­å¯¹è±¡æ˜¯å¦â€œé€ƒé€¸â€å‡ºå½“å‰æ–¹æ³•æˆ–çº¿ç¨‹ä½œç”¨åŸŸã€‚è‹¥æœªé€ƒé€¸ï¼ŒJVMå¯èƒ½ç›´æ¥åœ¨æ ˆä¸Šåˆ†é…å¯¹è±¡ï¼ˆè€Œéå †ï¼‰ï¼Œå‡å°‘GCå‹åŠ›ã€‚</p>
<h4 data-id="heading-12"><strong>å¦‚ä½•åˆ©ç”¨é€ƒé€¸åˆ†æï¼Ÿ</strong></h4>
<ul>
<li><strong>å±€éƒ¨åŒ–å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šå°½é‡ç¼©å°å¯¹è±¡çš„ä½œç”¨åŸŸã€‚</li>
<li><strong>é¿å…è¿”å›å†…éƒ¨æ•°ç»„å¼•ç”¨</strong>ï¼šé˜²æ­¢å¯¹è±¡é€ƒé€¸åˆ°å¤–éƒ¨ã€‚</li>
</ul>
<p>ç¤ºä¾‹å¯¹æ¯”ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¯èƒ½å¯¼è‡´é€ƒé€¸</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getData</span><span class="hljs-params">()</span> {
    <span class="hljs-type">byte</span>[] data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>];
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(data); <span class="hljs-comment">// dataé€šè¿‡Stringé€ƒé€¸</span>
}

<span class="hljs-comment">// æ›´ä¼˜å†™æ³•ï¼ˆè‹¥ä¸éœ€è¿”å›ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processData</span><span class="hljs-params">()</span> {
    <span class="hljs-type">byte</span>[] data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>]; <span class="hljs-comment">// å¯èƒ½æ ˆä¸Šåˆ†é…</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-13">5. GCè°ƒä¼˜çš„ä½æˆæœ¬é«˜å›æŠ¥æŠ€å·§</h3>
<h4 data-id="heading-14"><strong>é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†å™¨</strong></h4>

























<table><thead><tr><th>GCç±»å‹</th><th>é€‚ç”¨åœºæ™¯</th><th>JVMå‚æ•°</th></tr></thead><tbody><tr><td>G1GC</td><td>å¤§å †ã€ä½å»¶è¿Ÿéœ€æ±‚</td><td><code>-XX:+UseG1GC</code></td></tr><tr><td>ZGC</td><td>TBçº§å †ã€äºšæ¯«ç§’æš‚åœ</td><td><code>-XX:+UseZGC</code></td></tr><tr><td>Shenandoah</td><td>NUMAæ¶æ„ã€ä½å»¶è¿Ÿ</td><td><code>-XX:+UseShenandoahGC</code></td></tr></tbody></table>
<h4 data-id="heading-15"><strong>è°ƒæ•´SurvivoråŒºæ¯”ä¾‹</strong></h4>
<p>å¯¹äºçŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡å¤šçš„åº”ç”¨ï¼Œå¯é€šè¿‡è°ƒæ•´SurvivoråŒºæ¯”ä¾‹å‡å°‘æ™‹å‡åˆ°è€å¹´ä»£çš„é¢‘ç‡ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">-XX:<span class="hljs-attr">SurvivorRatio</span>=<span class="hljs-number">8</span> -XX:NewRatio=<span class="hljs-number">2</span>
</code></pre>
<hr/>
<h3 data-id="heading-16">6. Native Memoryçš„ç›‘æ§ä¸æ³„æ¼é˜²èŒƒ</h3>
<p>Javaåº”ç”¨çš„å†…å­˜é—®é¢˜ä¸é™äºå †å†…å­˜ï¼ŒNative Memoryæ³„æ¼åŒæ ·è‡´å‘½ã€‚ä»¥ä¸‹å·¥å…·å¯ç”¨äºè¯Šæ–­ï¼š</p>
<h4 data-id="heading-17"><strong>NMTï¼ˆNative Memory Trackingï¼‰</strong></h4>
<p>å¯ç”¨NMTç›‘æ§ï¼š</p>
<pre><code class="hljs language-ruby" lang="ruby">-<span class="hljs-variable constant_">XX</span><span class="hljs-symbol">:NativeMemoryTracking=detail</span> -<span class="hljs-variable constant_">XX</span><span class="hljs-symbol">:+UnlockDiagnosticVMOptions</span>
</code></pre>
<p>æŸ¥çœ‹æŠ¥å‘Šï¼š</p>
<pre><code class="hljs language-bash" lang="bash">jcmd &lt;pid&gt; VM.native_memory summary
</code></pre>
<h4 data-id="heading-18"><strong>å¸¸è§æ³„æ¼åœºæ™¯</strong></h4>
<ul>
<li>JNIè°ƒç”¨æœªé‡Šæ”¾çš„èµ„æºã€‚</li>
<li>Direct ByteBufferæœªæ˜¾å¼å›æ”¶ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-19">7. CPUç¼“å­˜å‹å¥½æ€§ç¼–ç¨‹</h3>
<p>ç°ä»£CPUçš„å¤šçº§ç¼“å­˜å¯¹æ€§èƒ½å½±å“æå¤§ã€‚ä»¥ä¸‹æ–¹æ³•å¯æå‡ç¼“å­˜å‘½ä¸­ç‡ï¼š</p>
<h4 data-id="heading-20"><strong>æ•°æ®å±€éƒ¨æ€§åŸç†çš„åº”ç”¨</strong></h4>
<ul>
<li><strong>ç´§å‡‘æ•°æ®ç»“æ„</strong>ï¼šé¿å…ç¨€ç–æ•°æ®å¸ƒå±€ï¼ˆå¦‚äºŒç»´æ•°ç»„ä¼˜å…ˆè¡Œå­˜å‚¨ï¼‰ã€‚</li>
<li><strong>ä¼ªå…±äº«é—®é¢˜çš„è§£å†³</strong> ï¼šä½¿ç”¨å¡«å……æˆ–æ³¨è§£å¯¹é½ç¼“å­˜è¡Œï¼š</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Contended</span> <span class="hljs-comment">// JDK8+æ”¯æŒ </span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> counter;
</code></pre>
<hr/>
<h3 data-id="heading-21">æ€»ç»“</h3>
<p>Javaæ€§èƒ½è°ƒä¼˜æ˜¯ä¸€ä¸ªæ¶‰åŠä»£ç ã€JVMä¹ƒè‡³ç¡¬ä»¶çš„ç³»ç»Ÿæ€§å·¥ç¨‹ã€‚æœ¬æ–‡ä»‹ç»çš„7ä¸ªæŠ€å·§â€”â€”ä»å­—ç¬¦ä¸²æ“ä½œçš„å¾®è§‚ä¼˜åŒ–åˆ°CPUç¼“å­˜çš„å®è§‚è®¾è®¡â€”â€”è¦†ç›–äº†å®¹æ˜“è¢«å¿½è§†å´è‡³å…³é‡è¦çš„é¢†åŸŸã€‚å®é™…åº”ç”¨ä¸­éœ€ç»“åˆProfilingå·¥å…·ï¼ˆå¦‚Async Profilerã€VisualVMï¼‰é‡åŒ–åˆ†æç“¶é¢ˆç‚¹ï¼Œé¿å…è¿‡æ—©ä¼˜åŒ–å¸¦æ¥çš„å¤æ‚æ€§ä¸Šå‡ã€‚è®°ä½ï¼šâ€œæ²¡æœ‰é“¶å¼¹â€ï¼Œåªæœ‰æŒç»­æµ‹é‡ä¸è¿­ä»£æ‰èƒ½æ„å»ºçœŸæ­£é«˜æ€§èƒ½çš„ç³»ç»Ÿï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBootå®ç°éšå¼å‚æ•°æ³¨å…¥]]></title>    <link>https://juejin.cn/post/7570187256105533446</link>    <guid>https://juejin.cn/post/7570187256105533446</guid>    <pubDate>2025-11-09T23:55:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570187256105533446" data-draft-id="7569920331118854184" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBootå®ç°éšå¼å‚æ•°æ³¨å…¥"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-09T23:55:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é£è±¡å—"/> <meta itemprop="url" content="https://juejin.cn/user/2524134428655159"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBootå®ç°éšå¼å‚æ•°æ³¨å…¥
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2524134428655159/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é£è±¡å—
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T23:55:57.000Z" title="Sun Nov 09 2025 23:55:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    29
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€ï¼šä¸€ä¸ªç—›ç‚¹</h2>
<p>æƒ³è±¡ä¸€ä¸‹è¿™æ ·çš„åœºæ™¯ï¼šç”¨æˆ·è¯·æ±‚å¸¦ç€ JWT Token è¿›å…¥ä½ çš„ç³»ç»Ÿï¼ŒFilter å±‚é¢è§£æ Token å¾—åˆ°ç”¨æˆ· IDï¼Œæ¥ä¸‹æ¥éœ€è¦ï¼š</p>
<ul>
<li>åœ¨ Controller å±‚è·å–ç”¨æˆ·ä¿¡æ¯</li>
<li>åœ¨ Service å±‚è¿›è¡Œæƒé™éªŒè¯</li>
<li>åœ¨æŸäº›ä¸šåŠ¡é€»è¾‘ä¸­è®°å½•æ“ä½œæ—¥å¿—</li>
</ul>
<p>æ¯ä¸€ä¸ªç¯èŠ‚éƒ½éœ€è¦çŸ¥é“"å½“å‰ç”¨æˆ·æ˜¯è°"ï¼Œçœ‹çœ‹ç›®å‰å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<h4 data-id="heading-1">ä¼ ç»Ÿæ–¹æ¡ˆçš„"ç¼ºé™·"</h4>
<p><strong>æ–¹æ¡ˆä¸€ï¼šThreadLocal</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// çœ‹èµ·æ¥å¾ˆ"Hack"</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;Long&gt; currentUser = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();
</code></pre>
<ul>
<li><strong>çº¿ç¨‹å®‰å…¨é—®é¢˜</strong>ï¼šåœ¨å¼‚æ­¥ç¯å¢ƒä¸‹å¯èƒ½å‡ºç°æ•°æ®é”™ä¹±</li>
<li><strong>å†…å­˜æ³„æ¼é£é™©</strong>ï¼šThreadLocal ä½¿ç”¨ä¸å½“å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼</li>
<li><strong>ä»£ç å¯è¯»æ€§å·®</strong>ï¼šéšå¼çš„æ•°æ®ä¼ é€’æ–¹å¼è®©ä»£ç é€»è¾‘å˜å¾—éš¾ä»¥è¿½è¸ª</li>
</ul>
<p><strong>æ–¹æ¡ˆäºŒï¼šHttpServletRequest.setAttribute()</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// çœ‹èµ·æ¥å¾ˆ"ä¸‘"</span>
<span class="hljs-meta">@GetMapping("/me")</span>
<span class="hljs-keyword">public</span> User <span class="hljs-title function_">getMyProfile</span><span class="hljs-params">(HttpServletRequest request)</span> {
    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> (Long) request.getAttribute(<span class="hljs-string">"currentUserId"</span>);
    <span class="hljs-keyword">return</span> userService.getById(userId);
}
</code></pre>
<ul>
<li><strong>ç±»å‹ä¸å®‰å…¨</strong>ï¼šéœ€è¦æ‰‹åŠ¨è¿›è¡Œç±»å‹è½¬æ¢ï¼Œå®¹æ˜“å‡ºç° ClassCastException</li>
<li><strong>ä»£ç å†—ä½™</strong>ï¼šæ¯ä¸ªéœ€è¦ç”¨æˆ·ä¿¡æ¯çš„ Controller éƒ½è¦é‡å¤ç›¸åŒçš„é€»è¾‘</li>
<li><strong>è¿åäº† Controller çš„"çº¯å‡€æ€§"</strong>ï¼šå¼•å…¥äº† Servlet API ä¾èµ–</li>
<li><strong>å­—ç¬¦ä¸²é­”æ³•å€¼</strong>ï¼šå±æ€§åç§°å®¹æ˜“å†™é”™ï¼Œç¼–è¯‘æ—¶æ— æ³•æ£€æŸ¥</li>
</ul>
<h2 data-id="heading-2">Spring MVCï¼šHandlerMethodArgumentResolver</h2>
<p>Spring MVC æä¾›äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼š<strong>è‡ªå®šä¹‰å‚æ•°è§£æå™¨ï¼ˆHandlerMethodArgumentResolverï¼‰</strong>ã€‚</p>
<p>è¿™ä¸ªè®¾è®¡æ¨¡å¼ä½“ç°äº† Spring æ¡†æ¶ä¸€è´¯çš„"çº¦å®šä¼˜äºé…ç½®"çš„ç†å¿µã€‚å®ƒä¸è¦æ±‚æˆ‘ä»¬æ”¹å˜ Filter å±‚é¢çš„å®ç°ï¼Œè€Œæ˜¯åœ¨å‚æ•°è§£æè¿™ä¸ªç¯èŠ‚åšæ–‡ç« ï¼Œé€šè¿‡æ‰©å±•æ¡†æ¶çš„èƒ½åŠ›æ¥è§£å†³é—®é¢˜ã€‚</p>
<h4 data-id="heading-3">è®¾è®¡æ€è·¯</h4>
<p>Spring MVC çš„ HandlerMethodArgumentResolver æœºåˆ¶å®é™…ä¸Šæ˜¯ä¸€ç§"é€‚é…å™¨æ¨¡å¼"çš„åº”ç”¨ã€‚å®ƒå°†ä¸åŒæ¥æºçš„å‚æ•°ï¼ˆRequest å‚æ•°ã€Path å˜é‡ã€Header ä¿¡æ¯ã€Session æ•°æ®ç­‰ï¼‰ç»Ÿä¸€é€‚é…æˆ Controller æ–¹æ³•å¯ä»¥ç›´æ¥ä½¿ç”¨çš„å½¢å¼ã€‚</p>
<p>è¿™ç§è®¾è®¡çš„å·§å¦™ä¹‹å¤„åœ¨äºï¼š</p>
<ul>
<li><strong>èŒè´£åˆ†ç¦»</strong>ï¼šFilter è´Ÿè´£è®¤è¯å’Œè®¾ç½®çŠ¶æ€ï¼ŒResolver è´Ÿè´£å‚æ•°è½¬æ¢</li>
<li><strong>å¯æ‰©å±•æ€§</strong>ï¼šå¯ä»¥è½»æ¾æ·»åŠ æ–°çš„å‚æ•°è§£æé€»è¾‘</li>
<li><strong>æ— ä¾µå…¥æ€§</strong>ï¼šä¸å½±å“ç°æœ‰çš„ä»£ç ç»“æ„</li>
</ul>
<p>è¿™ä¸ªæ–¹æ¡ˆçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>å°† request.getAttribute() æ“ä½œï¼Œå°è£…æˆç±»å‹å®‰å…¨çš„æ–¹æ³•å‚æ•°</strong>ã€‚</p>
<h4 data-id="heading-4">æ ¸å¿ƒå®ç°</h4>
<h5 data-id="heading-5">ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºè‡ªå®šä¹‰æ³¨è§£</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Target(ElementType.PARAMETER)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> CurrentUser {
}
</code></pre>
<h5 data-id="heading-6">ç¬¬äºŒæ­¥ï¼šå®ç°å‚æ•°è§£æå™¨</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentUserArgumentResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodArgumentResolver</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsParameter</span><span class="hljs-params">(MethodParameter parameter)</span> {
        <span class="hljs-comment">// åªè§£æè¢« @CurrentUser æ ‡è®°çš„å‚æ•°</span>
        <span class="hljs-keyword">return</span> parameter.hasParameterAnnotation(CurrentUser.class);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(MethodParameter parameter,
                                 ModelAndViewContainer mavContainer,
                                 NativeWebRequest webRequest,
                                 WebDataBinderFactory binderFactory)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// ä» request ä¸­è·å–ä¹‹å‰è®¾ç½®çš„ç”¨æˆ·ID</span>
        <span class="hljs-keyword">return</span> webRequest.getAttribute(<span class="hljs-string">"currentUserId"</span>, WebRequest.SCOPE_REQUEST);
    }
}
</code></pre>
<h5 data-id="heading-7">ç¬¬ä¸‰æ­¥ï¼šæ³¨å†Œè§£æå™¨</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebMvcConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> CurrentUserArgumentResolver currentUserArgumentResolver;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addArgumentResolvers</span><span class="hljs-params">(List&lt;HandlerMethodArgumentResolver&gt; resolvers)</span> {
        resolvers.add(currentUserArgumentResolver);
    }
}
</code></pre>
<h2 data-id="heading-8">æ–¹æ¡ˆç¤ºä¾‹</h2>
<h4 data-id="heading-9">Filter å±‚é¢</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtAuthenticationFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OncePerRequestFilter</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> JwtService jwtService;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilterInternal</span><span class="hljs-params">(HttpServletRequest request,
                                   HttpServletResponse response,
                                   FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> ServletException, IOException {

        <span class="hljs-type">String</span> <span class="hljs-variable">authorizationHeader</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">"Authorization"</span>);

        <span class="hljs-keyword">if</span> (authorizationHeader != <span class="hljs-literal">null</span> &amp;&amp; authorizationHeader.startsWith(<span class="hljs-string">"Bearer "</span>)) {
            <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> authorizationHeader.substring(<span class="hljs-number">7</span>);
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> jwtService.extractUserId(token);
                <span class="hljs-comment">// æ ‡å‡†ï¼šä½¿ç”¨ request.setAttribute è®¾ç½®</span>
                request.setAttribute(<span class="hljs-string">"currentUserId"</span>, userId);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                <span class="hljs-comment">// token æ— æ•ˆï¼Œç»§ç»­æ‰§è¡Œåç»­é€»è¾‘</span>
            }
        }

        filterChain.doFilter(request, response);
    }
}
</code></pre>
<h4 data-id="heading-10">Controller å±‚é¢</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/users")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;

    <span class="hljs-meta">@GetMapping("/me")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;User&gt; <span class="hljs-title function_">getCurrentUser</span><span class="hljs-params">(<span class="hljs-meta">@CurrentUser</span> Long userId)</span> {
        <span class="hljs-comment">// userId è¢«"é­”æ³•èˆ¬"åœ°è‡ªåŠ¨æ³¨å…¥äº†ï¼</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.findById(userId);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(user);
    }

    <span class="hljs-meta">@PutMapping("/me")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;User&gt; <span class="hljs-title function_">updateCurrentUser</span><span class="hljs-params">(<span class="hljs-meta">@CurrentUser</span> Long userId,
                                                 <span class="hljs-meta">@RequestBody</span> UserUpdateRequest request)</span> {
        <span class="hljs-comment">// æ¯ä¸ª Controller æ–¹æ³•éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ @CurrentUser</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">updatedUser</span> <span class="hljs-operator">=</span> userService.updateUser(userId, request);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(updatedUser);
    }

    <span class="hljs-meta">@GetMapping("/permissions")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;List&lt;Permission&gt;&gt; <span class="hljs-title function_">getUserPermissions</span><span class="hljs-params">(<span class="hljs-meta">@CurrentUser</span> Long userId)</span> {
        <span class="hljs-comment">// å®Œå…¨ç±»å‹å®‰å…¨ï¼Œæ— éœ€æ‰‹åŠ¨ç±»å‹è½¬æ¢</span>
        List&lt;Permission&gt; permissions = userService.getUserPermissions(userId);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(permissions);
    }
}
</code></pre>
<h2 data-id="heading-11">åŸç†è§£æ</h2>
<h4 data-id="heading-12">HandlerMethodArgumentResolver å·¥ä½œæµç¨‹</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[HTTPè¯·æ±‚] --&gt; B[Filteré“¾]
    B --&gt; C[DispatcherServlet]
    C --&gt; D[HandlerMapping]
    D --&gt; E[HandlerAdapter]
    E --&gt; F[HandlerMethodArgumentResolver]
    F --&gt; G{supportsParameter?}
    G --&gt;|Yes| H[resolveArgument]
    G --&gt;|No| I[ä½¿ç”¨é»˜è®¤è§£æå™¨]
    H --&gt; J[å‚æ•°æ³¨å…¥]
    I --&gt; J
    J --&gt; K[Controlleræ–¹æ³•æ‰§è¡Œ]
</code></pre>
<p>åœ¨è¿™ä¸ªæµç¨‹ä¸­ï¼ŒSpring MVC ä¼šæŒ‰ç…§æ³¨å†Œçš„é¡ºåºéå†æ‰€æœ‰çš„ HandlerMethodArgumentResolverï¼Œå¯¹äºæ¯ä¸ªéœ€è¦è§£æçš„å‚æ•°ï¼Œéƒ½ä¼šè°ƒç”¨ <code>supportsParameter()</code> æ–¹æ³•åˆ¤æ–­æ˜¯å¦æ”¯æŒï¼Œå¦‚æœæ”¯æŒåˆ™è°ƒç”¨ <code>resolveArgument()</code> æ–¹æ³•è¿›è¡Œå®é™…çš„å‚æ•°è§£æã€‚</p>
<h4 data-id="heading-13">æ–¹æ¡ˆä¼˜åŠ¿</h4>
<p>è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜åŠ¿ä¸ä»…ä½“ç°åœ¨ä»£ç å±‚é¢ï¼Œæ›´é‡è¦çš„æ˜¯å®ƒç¬¦åˆè½¯ä»¶å·¥ç¨‹çš„å¤šä¸ªé‡è¦åŸåˆ™ï¼š</p>
<p><strong>1. ç±»å‹å®‰å…¨</strong>ï¼šç¼–è¯‘æ—¶æ£€æŸ¥ï¼Œé¿å…è¿è¡Œæ—¶ç±»å‹è½¬æ¢é”™è¯¯ã€‚å½“ä½ é”™è¯¯åœ°å°† <code>@CurrentUser Long</code> å†™æˆ <code>@CurrentUser String</code> æ—¶ï¼Œç¼–è¯‘å™¨ä¼šç«‹åˆ»æé†’ä½ ã€‚</p>
<p><strong>2. ä»£ç ç®€æ´</strong>ï¼šController æ–¹æ³•ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ã€‚ä¸å†éœ€è¦æ¯æ¬¡éƒ½å†™ <code>request.getAttribute()</code> çš„æ ·æ¿ä»£ç ï¼Œè®©ä¸šåŠ¡é€»è¾‘æ›´åŠ æ¸…æ™°ã€‚</p>
<p><strong>3. å¯æµ‹è¯•æ€§</strong>ï¼šMock å˜å¾—ç®€å•ç›´æ¥ã€‚åœ¨å•å…ƒæµ‹è¯•ä¸­ï¼Œä½ åªéœ€è¦æ¨¡æ‹Ÿå‚æ•°å€¼ï¼Œè€Œä¸éœ€è¦æ„å»ºæ•´ä¸ª HttpServletRequest å¯¹è±¡ã€‚</p>
<p><strong>4. å¯ç»´æŠ¤æ€§</strong>ï¼šç»Ÿä¸€çš„ç”¨æˆ·ä¿¡æ¯è·å–æ–¹å¼ã€‚å½“éœ€è¦ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯çš„è·å–é€»è¾‘æ—¶ï¼Œåªéœ€è¦ä¿®æ”¹ Resolverï¼Œè€Œä¸éœ€è¦ä¿®æ”¹æ¯ä¸ª Controller æ–¹æ³•ã€‚</p>
<p><strong>5. æ‰©å±•æ€§</strong>ï¼šè½»æ¾æ”¯æŒæ›´å¤šç”¨æˆ·ç›¸å…³å±æ€§ã€‚é€šè¿‡ä¿®æ”¹ Resolver çš„é€»è¾‘ï¼Œå¯ä»¥æ”¯æŒè¿”å› User å¯¹è±¡ã€ç”¨æˆ·æƒé™ã€ç”¨æˆ·åå¥½è®¾ç½®ç­‰å¤æ‚ä¿¡æ¯ã€‚</p>
<p><strong>6. å…³æ³¨ç‚¹åˆ†ç¦»</strong>ï¼šFilter ä¸“æ³¨äºè®¤è¯é€»è¾‘ï¼ŒResolver ä¸“æ³¨äºå‚æ•°è§£æï¼ŒController ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼Œå„å¸å…¶èŒï¼Œä»£ç ç»“æ„æ›´åŠ æ¸…æ™°ã€‚</p>
<h2 data-id="heading-14">è¿›é˜¶ç”¨æ³•ï¼šä¼ é€’å®Œæ•´ç”¨æˆ·å¯¹è±¡</h2>
<p>åœ¨çœŸå®çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦çš„ä¸ä»…ä»…æ˜¯ç”¨æˆ· IDï¼Œè€Œæ˜¯å®Œæ•´çš„ç”¨æˆ·ä¿¡æ¯ã€æƒé™æ•°æ®ã€æˆ–è€…ç”¨æˆ·åå¥½è®¾ç½®ã€‚HandlerMethodArgumentResolver çš„å¼ºå¤§ä¹‹å¤„å°±åœ¨äºå®ƒå¯ä»¥æ™ºèƒ½åœ°æ ¹æ®å‚æ•°ç±»å‹è¿”å›ä¸åŒçš„å¯¹è±¡ã€‚</p>
<h4 data-id="heading-15">æ‰©å±•è§£æå™¨æ”¯æŒå¤æ‚å¯¹è±¡</h4>
<p>è¿™é‡Œçš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>æ ¹æ® Controller æ–¹æ³•çš„å‚æ•°ç±»å‹åŠ¨æ€å†³å®šè¿”å›ä»€ä¹ˆå¯¹è±¡</strong>ï¼Œè¿™æ ·å¯ä»¥æœ€å¤§ç¨‹åº¦åœ°æé«˜ä»£ç çš„çµæ´»æ€§å’Œå¤ç”¨æ€§ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentUserArgumentResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodArgumentResolver</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsParameter</span><span class="hljs-params">(MethodParameter parameter)</span> {
        <span class="hljs-keyword">return</span> parameter.hasParameterAnnotation(CurrentUser.class);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(MethodParameter parameter,
                                 ModelAndViewContainer mavContainer,
                                 NativeWebRequest webRequest,
                                 WebDataBinderFactory binderFactory)</span> <span class="hljs-keyword">throws</span> Exception {

        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> (Long) webRequest.getAttribute(<span class="hljs-string">"currentUserId"</span>, WebRequest.SCOPE_REQUEST);

        <span class="hljs-keyword">if</span> (userId == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// æˆ–è€…æŠ›å‡ºå¼‚å¸¸</span>
        }

        <span class="hljs-comment">// æ ¹æ®å‚æ•°ç±»å‹å†³å®šè¿”å›ä»€ä¹ˆ</span>
        Class&lt;?&gt; parameterType = parameter.getParameterType();

        <span class="hljs-keyword">if</span> (parameterType == Long.class || parameterType == <span class="hljs-type">long</span>.class) {
            <span class="hljs-keyword">return</span> userId;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (parameterType == User.class) {
            <span class="hljs-keyword">return</span> userService.findById(userId);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (parameterType == UserProfile.class) {
            <span class="hljs-keyword">return</span> userService.getUserProfile(userId);
        }

        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"Unsupported parameter type: "</span> + parameterType);
    }
}
</code></pre>
<h4 data-id="heading-16">Controller ä¸­çš„å¤šç§ç”¨æ³•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdvancedUserController</span> {

    <span class="hljs-meta">@GetMapping("/user/id")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title function_">getUserId</span><span class="hljs-params">(<span class="hljs-meta">@CurrentUser</span> Long userId)</span> {
        <span class="hljs-keyword">return</span> ResponseEntity.ok(<span class="hljs-string">"User ID: "</span> + userId);
    }

    <span class="hljs-meta">@GetMapping("/user/info")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;User&gt; <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">(<span class="hljs-meta">@CurrentUser</span> User user)</span> {
        <span class="hljs-keyword">return</span> ResponseEntity.ok(user);
    }

    <span class="hljs-meta">@GetMapping("/user/profile")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;UserProfile&gt; <span class="hljs-title function_">getUserProfile</span><span class="hljs-params">(<span class="hljs-meta">@CurrentUser</span> UserProfile profile)</span> {
        <span class="hljs-keyword">return</span> ResponseEntity.ok(profile);
    }
}
</code></pre>
<h2 data-id="heading-17">å®æˆ˜æŠ€å·§ä¸æ³¨æ„äº‹é¡¹</h2>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ HandlerMethodArgumentResolver æ—¶ï¼Œè¿˜éœ€è¦è€ƒè™‘ä¸€äº›å®é™…çš„å·¥ç¨‹é—®é¢˜ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„åœºæ™¯å’Œè§£å†³æ–¹æ¡ˆã€‚</p>
<h4 data-id="heading-18">1. å¼‚å¸¸å¤„ç†</h4>
<p>åœ¨ç”¨æˆ·æœªç™»å½•æˆ–è€… Token æ— æ•ˆçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä¼˜é›…åœ°å¤„ç†å¼‚å¸¸æƒ…å†µï¼Œè€Œä¸æ˜¯è®©ç³»ç»ŸæŠ›å‡ºéš¾ä»¥ç†è§£çš„é”™è¯¯ä¿¡æ¯ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentUserArgumentResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodArgumentResolver</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(...)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> (Long) webRequest.getAttribute(<span class="hljs-string">"currentUserId"</span>, WebRequest.SCOPE_REQUEST);

        <span class="hljs-keyword">if</span> (userId == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnauthorizedException</span>(<span class="hljs-string">"ç”¨æˆ·æœªç™»å½•"</span>);
        }

        <span class="hljs-keyword">return</span> userId;
    }
}

<span class="hljs-meta">@ControllerAdvice</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> {

    <span class="hljs-meta">@ExceptionHandler(UnauthorizedException.class)</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title function_">handleUnauthorized</span><span class="hljs-params">(UnauthorizedException e)</span> {
        <span class="hljs-keyword">return</span> ResponseEntity.status(<span class="hljs-number">401</span>).body(e.getMessage());
    }
}
</code></pre>
<h4 data-id="heading-19">2. ä¸ Spring Security é›†æˆ</h4>
<p>åœ¨è®¸å¤šä¼ä¸šçº§åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Spring Security è¿›è¡Œè®¤è¯å’Œæˆæƒã€‚å¦‚ä½•å°† Spring Security çš„ç”¨æˆ·ä¿¡æ¯ä¸æˆ‘ä»¬çš„è‡ªå®šä¹‰ Resolver ç»“åˆä½¿ç”¨æ˜¯ä¸€ä¸ªå¸¸è§é—®é¢˜ã€‚</p>
<p>Spring Security æä¾›äº† <code>SecurityContextHolder</code> æ¥å­˜å‚¨å½“å‰ç”¨æˆ·çš„è®¤è¯ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä»ä¸­è·å–ç”¨æˆ·è¯¦æƒ…ï¼Œç„¶åè½¬æ¢æˆæˆ‘ä»¬éœ€è¦çš„æ ¼å¼ã€‚è¿™ç§é›†æˆæ–¹å¼çš„ä¼˜åŠ¿æ˜¯å¯ä»¥å¤ç”¨ Spring Security çš„å®Œæ•´è®¤è¯ä½“ç³»ï¼ŒåŒ…æ‹¬å„ç§è®¤è¯æ–¹å¼ï¼ˆJWTã€OAuth2ã€Session ç­‰ï¼‰ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentUserArgumentResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodArgumentResolver</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(...)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Authentication</span> <span class="hljs-variable">authentication</span> <span class="hljs-operator">=</span> SecurityContextHolder.getContext().getAuthentication();

        <span class="hljs-keyword">if</span> (authentication != <span class="hljs-literal">null</span> &amp;&amp; authentication.isAuthenticated()) {
            <span class="hljs-type">UserDetails</span> <span class="hljs-variable">userDetails</span> <span class="hljs-operator">=</span> (UserDetails) authentication.getPrincipal();
            <span class="hljs-keyword">return</span> Long.parseLong(userDetails.getUsername()); <span class="hljs-comment">// å‡è®¾usernameå­˜å‚¨çš„æ˜¯userId</span>
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<h4 data-id="heading-20">3. å¤šç§Ÿæˆ·åœºæ™¯</h4>
<p>åœ¨ SaaS åº”ç”¨ä¸­ï¼Œå¤šç§Ÿæˆ·æ˜¯ä¸€ä¸ªå¸¸è§çš„éœ€æ±‚ã€‚é™¤äº†å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“å½“å‰ç§Ÿæˆ·çš„ä¿¡æ¯ã€‚é€šè¿‡åˆ›å»ºå¤šä¸ªè‡ªå®šä¹‰æ³¨è§£å’Œå¯¹åº”çš„ Resolverï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾å®ç°è¿™ç§éœ€æ±‚ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Target(ElementType.PARAMETER)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> CurrentTenant {
}

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentTenantArgumentResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodArgumentResolver</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsParameter</span><span class="hljs-params">(MethodParameter parameter)</span> {
        <span class="hljs-keyword">return</span> parameter.hasParameterAnnotation(CurrentTenant.class);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(...)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">return</span> webRequest.getAttribute(<span class="hljs-string">"currentTenantId"</span>, WebRequest.SCOPE_REQUEST);
    }
}

<span class="hljs-meta">@GetMapping("/tenant/data")</span>
<span class="hljs-keyword">public</span> ResponseEntity&lt;List&lt;Data&gt;&gt; <span class="hljs-title function_">getTenantData</span><span class="hljs-params">(<span class="hljs-meta">@CurrentUser</span> Long userId,
                                               <span class="hljs-meta">@CurrentTenant</span> Long tenantId)</span> {
    <span class="hljs-comment">// åŒæ—¶è·å–å½“å‰ç”¨æˆ·å’Œç§Ÿæˆ·ä¿¡æ¯</span>
    List&lt;Data&gt; data = dataService.findByUserAndTenant(userId, tenantId);
    <span class="hljs-keyword">return</span> ResponseEntity.ok(data);
}
</code></pre>
<h2 data-id="heading-21">æ€»ç»“</h2>
<p>é€šè¿‡ Spring MVC çš„ HandlerMethodArgumentResolveræˆ‘ä»¬å®ç°äº†ä¸€ä¸ªå¯ä»¥"è·¨ Filter ä¸ Controller ä¼ å‚"çš„æŠ€æœ¯å®ç°æ–¹æ¡ˆã€‚å°†åº•å±‚ Servlet API çš„ request.getAttribute() æ“ä½œæŠ½è±¡ä¸ºç¼–è¯‘æ—¶ç±»å‹å®‰å…¨çš„æ–¹æ³•å‚æ•°æ³¨å…¥ï¼Œå®ç°äº†æ¡†æ¶å±‚é¢çš„å‚æ•°è§£æé€‚é…ï¼Œæ—¢ä¿æŒäº†æ¶æ„çš„çº¯å‡€æ€§ï¼Œåˆæä¾›äº†å¼ºå¤§çš„æ‰©å±•èƒ½åŠ›ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è½¯ä»¶æµ‹è¯• | æµ‹è¯•å¼€å‘ | ä¸“é¡¹æµ‹è¯•æŠ€æœ¯åˆè¯†Hook]]></title>    <link>https://juejin.cn/post/7137925953270841351</link>    <guid>https://juejin.cn/post/7137925953270841351</guid>    <pubDate>2022-08-31T06:38:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7137925953270841351" data-draft-id="7137925302356803597" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è½¯ä»¶æµ‹è¯• | æµ‹è¯•å¼€å‘ | ä¸“é¡¹æµ‹è¯•æŠ€æœ¯åˆè¯†Hook"/> <meta itemprop="keywords" content="æµ‹è¯•"/> <meta itemprop="datePublished" content="2022-08-31T06:38:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="éœæ ¼æ²ƒå…¹_æµ‹è¯•"/> <meta itemprop="url" content="https://juejin.cn/user/1983934618934887"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è½¯ä»¶æµ‹è¯• | æµ‹è¯•å¼€å‘ | ä¸“é¡¹æµ‹è¯•æŠ€æœ¯åˆè¯†Hook
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1983934618934887/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    éœæ ¼æ²ƒå…¹_æµ‹è¯•
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2022-08-31T06:38:27.000Z" title="Wed Aug 31 2022 06:38:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2022-08-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    42
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ¬æ–‡èŠ‚é€‰è‡ªéœæ ¼æ²ƒå…¹æµ‹è¯•å­¦é™¢å†…éƒ¨æ•™æHook æŠ€æœ¯éœ€è¦é¢„å…ˆåˆ†æç›®æ ‡åº”ç”¨çš„æºä»£ç å’Œé€»è¾‘ï¼Œæ ¹æ®ç›®æ ‡æµ‹è¯•åœºæ™¯è®¾ç½®ç›®æ ‡ã€é€»è¾‘å’Œæ•°æ®ï¼Œç„¶åè¿è¡Œæ—¶åŠ¨æ€çš„å¯¹ç›®æ ‡å‡½æ•°å‚æ•°å€¼ã€é€»è¾‘æˆ–è€…è¿”å›å€¼åšä¿®æ”¹ï¼Œè¾¾åˆ°ä¿®æ”¹ç°æœ‰å‡½æ•°é€»è¾‘ã€å®ç°ç›®æ ‡æµ‹è¯•åœºæ™¯çš„ç›®çš„ã€‚Hookçš„ä»·å€¼åœ¨æµ‹è¯•ä¸­ï¼Œè™½ç„¶é€šè¿‡ä¿®æ”¹æ•°æ®ä»¥å®ç°æµ‹è¯•åœºæ™¯çš„éœ€æ±‚ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½å¯ä»¥é€šè¿‡ Mock æŠ€æœ¯å®ç°ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€å°éƒ¨åˆ†åœºæ™¯ï¼Œä¾‹å¦‚éœ€è¦ä¿®æ”¹åº”ç”¨å†…éƒ¨å‡½æ•°çš„å‚æ•°ã€è¿”å›å€¼æˆ–è¿è¡Œé€»è¾‘ç­‰æƒ…å†µï¼Œè¿™æ—¶å°±éœ€è¦ç”¨åˆ° Hook æŠ€æœ¯ã€‚å•å…ƒæµ‹è¯•ä¹‹å¤–ï¼ŒMock æŠ€æœ¯çš„ä¸»è¦ä½œç”¨æ˜¯å¯¹æœåŠ¡ã€æ¥å£è¿›è¡Œ Mockï¼Œé€šè¿‡ä»£ç†ç­‰æ–¹å¼å°†è¢«æµ‹æœåŠ¡å‘é€åˆ°ä¾èµ–æœåŠ¡çš„è¯·æ±‚è½¬å‘ç»™ Mock æœåŠ¡ï¼Œå†ç”± Mock æœåŠ¡æ ¹æ®è§„åˆ™ç»„è£…é¢„æœŸçš„è¿”å›æ•°æ®å“åº”ç»™è¢«æµ‹æœåŠ¡ï¼Œè¾¾åˆ°é¢„æœŸçš„æµ‹è¯•åœºæ™¯ã€‚Hook æŠ€æœ¯ä¸»è¦ç”¨äºæœåŠ¡å†…éƒ¨ä»£ç é€»è¾‘ä¸Šçš„ä¿®æ”¹ï¼Œå½“å‡½æ•°é—´ä¼ é€’çš„å‚æ•°æˆ–è€…å‡½æ•°å†…çš„é€»è¾‘éœ€è¦è¿›è¡Œä¿®æ”¹æ—¶ï¼Œæ•°æ®çš„ä¼ é€’å¹¶æ²¡æœ‰ç»è¿‡ç½‘ç»œï¼ŒMock æœåŠ¡æ— æ³•å¯¹å…¶è¿›è¡Œæ“ä½œï¼Œåªèƒ½é€šè¿‡ Hook æŠ€æœ¯é€šè¿‡åœ¨è¿è¡Œçš„ä»£ç ä¸­æ’å…¥é¢å¤–çš„ä»£ç æˆ–è€…åœ¨å†…å­˜ä¸­è¿›è¡Œæ“ä½œã€‚è¿™ç§æ›´ç²¾ç»†æ›´åº•å±‚çš„ä¿®æ”¹ï¼Œç›¸æ¯” Mock æŠ€æœ¯èƒ½å®ç°æ›´å¤šçš„ä¿®æ”¹èŒƒå›´ï¼Œé€‚ç”¨æ€§æ›´å¹¿ï¼Œéš¾åº¦ä¹Ÿæ›´å¤§ã€‚â€‹</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/040ff9dd86f34fd6b9b5055d18802a9a~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="" loading="lazy"/></p>
<p>JVM Sandboxç®€ä»‹</p>
<p>JVM-Sandbox æ˜¯ alibaba å¼€æºçš„ä¸€ä¸ª JVM æ²™ç®±å®¹å™¨ï¼Œåªèƒ½å¤„ç†ç›®æ ‡ä¸º Java åº”ç”¨çš„åœºæ™¯ï¼Œä¸»è¦çš„ç‰¹ç‚¹æ˜¯æ”¯æŒçƒ­æ’æ‹”ï¼ˆå¯ä»¥åœ¨ç›®æ ‡åº”ç”¨è¿è¡Œä¸­éšæ—¶è¿›è¡Œ Hook çš„åŠ è½½å’Œè§£é™¤ï¼‰ã€å¯ä»¥åŒæ—¶æ“ä½œæŒ‚è½½å¤šä¸ªç›®æ ‡åº”ç”¨ï¼Œç›¸äº’ä¹‹é—´ç‹¬ç«‹è®¾ç½®äº’ä¸å¹²æ‰°ã€æ”¯æŒçš„ç›®æ ‡åº”ç”¨ JDK ç‰ˆæœ¬è¾ƒå¹¿ï¼ˆ6-11ï¼‰ã€‚å·¥å…·æœ¬èº«åŠŸèƒ½å¾ˆå¤šï¼Œåœ¨è¿™é‡Œä»…ä»‹ç»å’Œä½¿ç”¨å®ƒç”¨ä½œ Hook çš„éƒ¨åˆ†åŠŸèƒ½ã€‚</p>
<p>JVM Sandboxå®‰è£…ä¸å¯åŠ¨</p>
<p>ä¸‹è½½</p>
<p>é¡¹ç›®çš„ github åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falibaba%2Fjvm-sandbox%25E3%2580%2582" target="_blank" title="https://github.com/alibaba/jvm-sandbox%E3%80%82" ref="nofollow noopener noreferrer">github.com/alibaba/jvmâ€¦</a></p>
<p>ä¸‹è½½æ‰€éœ€ç‰ˆæœ¬çš„äºŒè¿›åˆ¶å‹ç¼©åŒ…ï¼Œè§£å‹ï¼ˆæ¼”ç¤ºæ‰€ä½¿ç”¨çš„ç‰ˆæœ¬ä¸º 1.3.3ï¼‰ã€‚</p>
<p>ç¯å¢ƒå‡†å¤‡</p>
<p>å®˜æ–¹å£°æ˜æ”¯æŒçš„ç³»ç»Ÿæœ‰ï¼šLinuxï¼UNIXï¼MacOSï¼Œè¿™å‡ ä¸ªç³»ç»Ÿåªéœ€è¦ä¸‹è½½è§£å‹ç¼©å°±å¯ä»¥ç›´æ¥è¿è¡Œã€‚</p>
<p>å®˜æ–¹å¹¶æœªæ”¯æŒ Windows ç³»ç»Ÿï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹ï¼š</p>
<p>å®‰è£… Git Bashã€‚</p>
<p>å®‰è£… JDKï¼ˆç‰ˆæœ¬ 6-11ï¼Œæ¼”ç¤ºæ‰€ç”¨ç‰ˆæœ¬ä¸º 1.8.0_192ï¼‰ï¼Œè·¯å¾„ä¸­ä¸èƒ½å¸¦æœ‰ç©ºæ ¼ã€‚</p>
<p>åœ¨ Shell è„šæœ¬ä¸­ä¼šæœ‰ Java å‘½ä»¤çš„è°ƒç”¨ï¼Œæ‰€ä»¥ç”µè„‘ä¸­éœ€è¦ï¼Œå¹¶ä¸”å› ä¸º Git Bash è¿è¡Œ Shell è„šæœ¬æ—¶çš„ç›®å½•é—®é¢˜ã€‚</p>
<p>ä¿®æ”¹å¯åŠ¨è„šæœ¬bin/sandbox.sh ï¼Œå°†è„šæœ¬ä¸­ 183-188 è¡Œå†…å®¹æ³¨é‡Šã€‚â€‹</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a498c5fef5cd4959b8826dfd432fb4ea~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="" loading="lazy"/></p>
<p>å¯åŠ¨è„šæœ¬</p>
<p>ç”±äºå¯åŠ¨è„šæœ¬ä¸­ä½¿ç”¨äº†ç›¸å¯¹è·¯å¾„ï¼Œæ‰€ä»¥è¿è¡Œæ—¶éœ€è¦åˆ‡æ¢åˆ°é¡¹ç›®çš„ bin ç›®å½•ä¸‹æ“ä½œã€‚</p>
<p>åœ¨ bin ç›®å½•ä¸­æ‰§è¡Œè¯­å¥./sandbox.sh -p ç›®æ ‡åº”ç”¨pid ï¼Œå½“å‡ºç°å¦‚ä¸‹æç¤ºä¿¡æ¯ï¼Œè¯´æ˜ JVM-Sandbox å·²ç»æˆåŠŸå¯åŠ¨äº†ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml">                <span class="hljs-string">$</span> <span class="hljs-string">./sandbox.sh</span> <span class="hljs-string">-p</span> <span class="hljs-number">6204</span>
                <span class="hljs-attr">NAMESPACE :</span> <span class="hljs-string">default</span>

                  <span class="hljs-attr">VERSION :</span> <span class="hljs-number">1.3</span><span class="hljs-number">.3</span>

                     <span class="hljs-attr">MODE :</span> <span class="hljs-string">ATTACH</span>

              <span class="hljs-attr">SERVER_ADDR :</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>

              <span class="hljs-attr">SERVER_PORT :</span> <span class="hljs-number">4543</span>

           <span class="hljs-attr">UNSAFE_SUPPORT :</span> <span class="hljs-string">ENABLE</span>

             <span class="hljs-attr">SANDBOX_HOME :</span> <span class="hljs-string">e:/Download/sandbox/bin/..</span>

        <span class="hljs-attr">SYSTEM_MODULE_LIB :</span> <span class="hljs-string">e:/Download/sandbox/bin/..\module</span>

          <span class="hljs-attr">USER_MODULE_LIB :</span> <span class="hljs-string">E:\Download\sandbox\sandbox-module;~/.sandbox-module;</span>

      <span class="hljs-attr">SYSTEM_PROVIDER_LIB :</span> <span class="hljs-string">e:/Download/sandbox/bin/..\provider</span>

       <span class="hljs-attr">EVENT_POOL_SUPPORT :</span> <span class="hljs-string">DISABLE</span>
</code></pre>
<p>JVM-Sandbox åŒæ—¶è¿˜ä¼šå¯¹å¤–æä¾›æ¥å£ï¼Œå¯ä»¥é€šè¿‡è¯·æ±‚ç›´æ¥æ“ä½œ JVM-Sandboxï¼Œè¿™æ ·å°±èƒ½æ–¹ä¾¿çš„ä¸è‡ªå·±çš„æµ‹è¯•ä»£ç ç»“åˆä½¿ç”¨ã€‚</p>
<p>JVM Sandboxç¤ºä¾‹</p>
<p>ç›®æ ‡åº”ç”¨ä¸ºä¸€æ®µç®€å•çš„ Java ä»£ç ï¼Œä»£ç ä¸­å¯åŠ¨äº†ä¸€ä¸ªæ­»å¾ªç¯ï¼Œæ¯æ¬¡å¾ªç¯ä¼šæ‰“å°report æ–¹æ³•æ¥æ”¶åˆ°çš„å‚æ•°å€¼ï¼Œå‚æ•°å€¼å·²ç»åœ¨ä»£ç ä¸­å›ºå®šä¼ å…¥ï¼Œæ‰€ä»¥è¿è¡Œä¹‹åçš„ç»“æœæ˜¯ä¸€ä¸²ç›¸åŒçš„è¾“å‡ºå†…å®¹ã€‚å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">HookTarget</span> {
<span class="hljs-function">final <span class="hljs-keyword">void</span> <span class="hljs-title">report</span>(<span class="hljs-params">String stringParam, boolean boolParam, <span class="hljs-built_in">int</span> intParam</span>)</span> {

    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"stringParam is "</span> + stringParam);

    <span class="hljs-keyword">if</span> (boolParam) {

        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"boolParam is true!"</span>);

    } <span class="hljs-keyword">else</span> {

        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"boolParam is false"</span>);

    }

    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"intParam is "</span> + intParam);

}

<span class="hljs-function">final <span class="hljs-keyword">void</span> <span class="hljs-title">loopReport</span>() throws InterruptedException</span> {

    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {

        report(<span class="hljs-string">"a"</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">666</span>);

        Thread.sleep(<span class="hljs-number">1000</span>);

        System.<span class="hljs-keyword">out</span>.println();

    }

}

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String... args</span>) throws InterruptedException</span> {

    <span class="hljs-keyword">new</span> HookTarget().loopReport();

}
}
</code></pre>
<p>è¦ç¼–å†™ç¬¦åˆ JVM-Sandbox çš„ hook è„šæœ¬ï¼Œéœ€è¦å¼•å…¥sandbox-api å’Œ sandbox-debug-module ä¸¤ä¸ªä¾èµ–ã€‚</p>
<p>é€šè¿‡å®ç° jvm.sandbox ä¸­çš„ Module æ¥å£ï¼Œåœ¨ AdviceListener æ–¹æ³•ä¸­é‡å†™ before æ–¹æ³•ï¼Œè¿™æ ·å†™å…¥çš„è¯­å¥å°±ä¼šåœ¨ç›®æ ‡æ–¹æ³•ä½“æ‰§è¡Œä¹‹å‰è¿›è¡Œæ‰§è¡Œï¼Œèƒ½å¤Ÿä¿®æ”¹ç›®æ ‡æ–¹æ³•æ”¶åˆ°çš„å‚æ•°æ•°æ®ã€‚é€šè¿‡advice.changeParameter æ–¹æ³•ï¼Œä¿®æ”¹å¯¹åº”ä½ç½®çš„å‚æ•°æ•°å€¼ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç›®æ ‡å‚æ•°çš„ä½ç½®ï¼Œä» 0 å¼€å§‹ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæ›¿æ¢çš„å€¼ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.alibaba.jvm.sandbox.api.Information;
<span class="hljs-keyword">import</span> com.alibaba.jvm.sandbox.api.Module;
<span class="hljs-keyword">import</span> com.alibaba.jvm.sandbox.api.annotation.Command;
<span class="hljs-keyword">import</span> com.alibaba.jvm.sandbox.api.listener.ext.Advice;
<span class="hljs-keyword">import</span> com.alibaba.jvm.sandbox.api.listener.ext.AdviceListener;
<span class="hljs-keyword">import</span> com.alibaba.jvm.sandbox.api.listener.ext.EventWatchBuilder;
<span class="hljs-keyword">import</span> com.alibaba.jvm.sandbox.api.resource.ModuleEventWatcher;
<span class="hljs-keyword">import</span> org.kohsuke.MetaInfServices;
<span class="hljs-keyword">import</span> javax.annotation.Resource;
<span class="hljs-keyword">import</span> java.util.*;

<span class="hljs-meta">@MetaInfServices(Module.class)</span>
<span class="hljs-meta">@Information(id = "ceshiren.com", author = "ceshiren.com")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">hook_jvm</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Module</span> {

    <span class="hljs-meta">@Resource</span>

    <span class="hljs-keyword">private</span> ModuleEventWatcher moduleEventWatcher;

    <span class="hljs-meta">@Command("ceshiren")</span>

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">ceshiren</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Map&lt;String, String&gt; param)</span> {

        <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventWatchBuilder</span>(moduleEventWatcher)

                .onClass(<span class="hljs-string">"HookTarget"</span>)

                .onBehavior(<span class="hljs-string">"report"</span>)

                .onWatch(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AdviceListener</span>() {

                    <span class="hljs-meta">@Override</span>

                    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">(Advice advice)</span> <span class="hljs-keyword">throws</span> Throwable {

                        advice.changeParameter(<span class="hljs-number">0</span>, <span class="hljs-string">"Change By Hook!"</span>);

                        advice.changeParameter(<span class="hljs-number">1</span>, <span class="hljs-literal">false</span>);

                        advice.changeParameter(<span class="hljs-number">2</span>, <span class="hljs-number">965</span>);

                    }

                });

    }

}
</code></pre>
<p>}é¡¹ç›®é€šè¿‡ maven ç®¡ç†ä¾èµ–ï¼Œå¯¹åº”çš„pom.xml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-xml" lang="xml">    <span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>

     <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ceshiren_book<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.jvm.sandbox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sandbox-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.3.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.jvm.sandbox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sandbox-debug-module<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.3.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>

                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>

                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>

                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>attached<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>

                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>

                    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>

                    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>

                        <span class="hljs-tag">&lt;<span class="hljs-name">descriptorRefs</span>&gt;</span>

                            <span class="hljs-tag">&lt;<span class="hljs-name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">descriptorRef</span>&gt;</span>

                        <span class="hljs-tag">&lt;/<span class="hljs-name">descriptorRefs</span>&gt;</span>

                    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>

                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>

            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>

        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<p>è„šæœ¬ç¼–å†™å®Œæ¯•ä¹‹åï¼Œå°†é¡¹ç›®æ‰“æˆ Jar åŒ…ï¼Œæ”¾åˆ°ä¸‹è½½çš„ JVM-Sandbox é¡¹ç›®ä¸‹ sandbox-module ç›®å½•ä¸­ã€‚</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d4a9414d8a4f4c32894834ac76bf588f~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="" loading="lazy"/></p>
<p>å¯åŠ¨å†™å¥½çš„ java ç›®æ ‡ç¨‹åºï¼Œè¿è¡Œä¹‹åå‘½ä»¤è¡Œå¼€å§‹å¾ªç¯æ‰“å°ä¹‹å‰è®¾ç½®å¥½çš„è¯­å¥ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">stringParam <span class="hljs-keyword">is</span> a

boolParam <span class="hljs-keyword">is</span> <span class="hljs-literal">false</span>

intParam <span class="hljs-keyword">is</span> <span class="hljs-number">666</span>

stringParam <span class="hljs-keyword">is</span> a

boolParam <span class="hljs-keyword">is</span> <span class="hljs-literal">false</span>

intParam <span class="hljs-keyword">is</span> <span class="hljs-number">666</span>
</code></pre>
<p>åœ¨ gitbash å‘½ä»¤è¡Œä¸­æ‰“å¼€sandbox/bin ç›®å½•ï¼Œæ‰§è¡Œè¯­å¥./sandbox.sh -p ç›®æ ‡åº”ç”¨è¿›ç¨‹å· -d 'ceshiren.com/ceshiren' ï¼Œå¯åŠ¨ JVM-Sandbox å¹¶å¯¹ç›®æ ‡ç¨‹åºè¿›è¡Œ Hook æ“ä½œï¼Œå˜æ›´report æ–¹æ³•ä¸­ä¼ å…¥çš„å‚æ•°å€¼ï¼Œè¿™æ—¶å†å›åˆ°ç›®æ ‡ç¨‹åºè¿è¡Œçš„å‘½ä»¤è¡Œä¸­æŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ°å‘½ä»¤è¡Œä¸­è¾“å‡ºçš„å†…å®¹å·²ç»å˜æ›´ï¼Œå¦‚ä¸‹</p>
<p>è¾“å‡ºå†…å®¹çš„å˜æ›´ï¼Œè¯´æ˜ Hook å·²ç»ç”Ÿæ•ˆã€‚è¿™æ ·åœ¨ç›®æ ‡ç¨‹åºè¿è¡Œä¸­ä¿®æ”¹äº†æ–¹æ³•ä¼ å…¥çš„å‚æ•°å€¼ï¼Œè¾¾åˆ°äº† Hook çš„ç›®çš„ã€‚ç°åœ¨æ‰§è¡Œè¯­å¥./sandbox.sh -p ç›®æ ‡åº”ç”¨è¿›ç¨‹å· -S å¯ä»¥å…³é—­ä¿®æ”¹ï¼Œå‘½ä»¤è¡Œä¸­è¾“å‡ºçš„å†…å®¹å˜å›äº†åŸå§‹çš„è¾“å‡ºå†…å®¹ã€‚ç¤ºä¾‹ç®€å•å±•ç¤ºäº† JVM-Sandbox ç”¨ä½œ Hook å·¥å…·çš„åŠŸèƒ½ï¼Œé€šè¿‡ Hook åŠŸèƒ½å°±å¯ä»¥å¯¹ Java é¡¹ç›®çš„å†…éƒ¨è¿è¡Œé€»è¾‘å’Œå‚æ•°ã€è¿”å›å€¼è¿›è¡Œä¿®æ”¹ã€‚æµ‹è¯•åœºæ™¯çš„æ„å»ºã€æµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œéƒ½å˜å¾—æ›´åŠ æ–¹ä¾¿</p>
<pre><code class="hljs language-vbnet" lang="vbnet">stringParam <span class="hljs-built_in">is</span> Change <span class="hljs-keyword">By</span> Hook!

boolParam <span class="hljs-built_in">is</span> <span class="hljs-literal">false</span>

intParam <span class="hljs-built_in">is</span> <span class="hljs-number">965</span>

stringParam <span class="hljs-built_in">is</span> Change <span class="hljs-keyword">By</span> Hook!

boolParam <span class="hljs-built_in">is</span> <span class="hljs-literal">false</span>

intParam <span class="hljs-built_in">is</span> <span class="hljs-number">965</span>
</code></pre>
<ul>
<li>è¾“å‡ºå†…å®¹çš„å˜æ›´ï¼Œè¯´æ˜ Hook å·²ç»ç”Ÿæ•ˆã€‚è¿™æ ·åœ¨ç›®æ ‡ç¨‹åºè¿è¡Œä¸­ä¿®æ”¹äº†æ–¹æ³•ä¼ å…¥çš„å‚æ•°å€¼ï¼Œè¾¾åˆ°äº† Hook çš„ç›®çš„ã€‚</li>
<li>ç°åœ¨æ‰§è¡Œè¯­å¥./sandbox.sh -p ç›®æ ‡åº”ç”¨è¿›ç¨‹å· -S å¯ä»¥å…³é—­ä¿®æ”¹ï¼Œå‘½ä»¤è¡Œä¸­è¾“å‡ºçš„å†…å®¹å˜å›äº†åŸå§‹çš„è¾“å‡ºå†…å®¹ã€‚</li>
</ul>
<p>ç¤ºä¾‹ç®€å•å±•ç¤ºäº† JVM-Sandbox ç”¨ä½œ Hook å·¥å…·çš„åŠŸèƒ½ï¼Œé€šè¿‡ Hook åŠŸèƒ½å°±å¯ä»¥å¯¹ Java é¡¹ç›®çš„å†…éƒ¨è¿è¡Œé€»è¾‘å’Œå‚æ•°ã€è¿”å›å€¼è¿›è¡Œä¿®æ”¹ã€‚æµ‹è¯•åœºæ™¯çš„æ„å»ºã€æµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œéƒ½å˜å¾—æ›´åŠ æ–¹ä¾¿</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fqrcode.ceba.ceshiren.com%2Flink%3Fname%3Darticle%26project_id%3Dqrcode%26from%3Djuejin%26timestamp%3D1661940023%26author%3Dxueqi" target="_blank" title="https://qrcode.ceba.ceshiren.com/link?name=article&amp;project_id=qrcode&amp;from=juejin&amp;timestamp=1661940023&amp;author=xueqi" ref="nofollow noopener noreferrer">æ›´å¤šèµ„æ–™</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Cursoråœ¨å›æ”¶å›¢é˜Ÿçš„å®è·µ]]></title>    <link>https://juejin.cn/post/7570500819888439339</link>    <guid>https://juejin.cn/post/7570500819888439339</guid>    <pubDate>2025-11-10T03:52:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570500819888439339" data-draft-id="7569977160276852779" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Cursoråœ¨å›æ”¶å›¢é˜Ÿçš„å®è·µ"/> <meta itemprop="keywords" content="Cursor"/> <meta itemprop="datePublished" content="2025-11-10T03:52:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è½¬è½¬æŠ€æœ¯å›¢é˜Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/606586148237431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Cursoråœ¨å›æ”¶å›¢é˜Ÿçš„å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/606586148237431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è½¬è½¬æŠ€æœ¯å›¢é˜Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T03:52:37.000Z" title="Mon Nov 10 2025 03:52:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>æœ€è¿‘ä¸€æ®µæ—¶é—´ï¼Œå›æ”¶å›¢é˜Ÿä¸€ç›´åšæŒç”¨Cursoræ¥è¾…åŠ©å¼€å‘ï¼Œå¹¶åœ¨AIå¼€å‘æ¨¡å¼ä¸Šè¿›è¡Œäº†å¤šæ¬¡è¿­ä»£ã€‚ä»Šå¤©ï¼Œæˆ‘æƒ³å’Œå¤§å®¶åˆ†äº«ä¸€äº›æˆ‘ä»¬åœ¨AIç¼–ç¨‹æ–¹é¢çš„å®è·µå¿ƒå¾—ã€‚</p>
<p>é¦–å…ˆè¦æ˜ç¡®çš„æ˜¯ï¼ŒAIç¼–ç¨‹å¹¶ä¸èƒ½å–ä»£ç¨‹åºå‘˜çš„ç‹¬ç«‹ç¼–ç èƒ½åŠ›ï¼Œä¹Ÿä¸æ˜¯è¯´ç®€å•é…ç½®å‡ ä¸ªMCPå°±èƒ½è®©AIçš„ç¼–ç¨‹èƒ½åŠ›å‘ç”Ÿè´¨çš„é£è·ƒã€‚ä»Šå¤©æˆ‘å°†é‡ç‚¹ä»å®é™…åº”ç”¨å‡ºå‘ï¼Œåˆ†äº«ä¸€äº›AIç¼–ç¨‹çš„æ€è·¯ä¸æµç¨‹ä¼˜åŒ–ç»éªŒï¼Œå¸®åŠ©å„ä½çœŸæ­£çš„åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼ŒæŠŠAIç”¨èµ·æ¥ã€‚</p>
<h2 data-id="heading-1">æˆ‘ä»¬åˆ°åº•èƒ½ç”¨Cursorå¹²ä»€ä¹ˆ</h2>
<p>æˆ‘ä¸€ç›´åœ¨æ€è€ƒï¼Œä½œä¸ºä¸€ä¸ªæœˆä½¿ç”¨æˆæœ¬è¶…è¿‡100å—çš„â€œæƒå¨â€å·¥å…·æ¥è¯´ï¼Œå¦‚æœåªè®©ä»–åšä¸€äº›beançš„ç”Ÿæˆï¼Œmapperçš„ç”Ÿæˆï¼Œæœªå…å¤ªè¿‡äºæµªè´¹ã€‚ä½†æ˜¯å¦‚æœç›´æ¥æŠŠéœ€æ±‚æ–‡æ¡£å–‚ç»™ä»–ï¼Œç”Ÿæˆçš„ä»£ç è·ç¦»æˆ‘ä»¬çš„æœŸæœ›åˆå¤ªå¤§ã€‚æˆ‘ä»¬æ€»è¯´ï¼Œæƒ³è®©AIç”Ÿæˆç¬¦åˆè¦æ±‚çš„ä»£ç ï¼Œéœ€è¦è¯¦ç»†çš„å°†æˆ‘ä»¬çš„éœ€æ±‚å†™æˆæç¤ºè¯å‘Šè¯‰AIï¼Œä½†æ˜¯åˆ°åº•å¦‚ä½•æ‰ç®—è¯¦ç»†å‘¢ï¼Ÿå¦‚ä½•æ‰èƒ½å†™å‡ºè¿™ä»½è¯¦ç»†çš„æç¤ºè¯å‘¢ï¼Ÿ</p>
<p>ä¸‹é¢æ˜¯æˆ‘ä½¿ç”¨Cursorè¿›è¡Œé¡¹ç›®å¼€å‘çš„ä¸‰æ­¥èµ°ï¼š</p>
<ol>
<li>ç”±Cursorå¸®åŠ©å¼€å‘è€…æ‹†åˆ†é¡¹ç›®â€”â€”åˆæ­¥å®Œæˆæç¤ºè¯æ¡†æ¶</li>
<li>ç”±å¼€å‘è€…å¸®åŠ©Cursorç†è§£é¡¹ç›®â€”â€”ä¸°å¯Œæç¤ºè¯å†…å®¹</li>
<li>å®Œæˆå¼€å‘åç”±Cursorå¸®åŠ©å¼€å‘è€…è¿›è¡Œå›å½’éªŒè¯</li>
</ol>
<br/>
<h3 data-id="heading-2">ä¸€ã€è®©cursorå¸®åŠ©ä½ æ›´å¥½çš„æ‹†åˆ†é¡¹ç›®</h3>
<p>æ—¢ç„¶ç›´æ¥ç”Ÿæˆä»£ç éš¾åº¦å¤ªå¤§ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½å…ˆå°è¯•è®©AIåšä¸€äº›æ›´ç®€å•çš„äº‹æƒ…ï¼Œæ¯”å¦‚åˆ†æä¸€ä¸‹éœ€æ±‚æ–‡æ¡£ã€‚</p>
<p>ä¸€èˆ¬æ¥è®²ï¼Œå¯¹äºä¸€ä¸ªé¡¹ç›®çš„åˆ†æä¸»è¦åˆ†ä¸¤æ­¥ï¼š</p>
<ol>
<li>å¯¹äºé¡¹ç›®æ–°æµç¨‹çš„åˆ†æ</li>
<li>å¯¹äºç›¸å…³ç°çŠ¶çš„åˆ†æ</li>
</ol>
<p>ä¸Šè¿°æ­¥éª¤æ­¥å®Œæˆåæˆ‘ä»¬æœŸæœ›Cursorèƒ½å¤ŸåŸºäºéœ€æ±‚PRDæ–‡æ¡£ï¼Œå¸®æˆ‘ä»¬æ€»ç»“ä¸€ä»½å…¼å®¹å½“ä¸‹ç³»ç»Ÿé€»è¾‘çš„åˆæ­¥çš„åŠŸèƒ½åˆ†ææ–‡æ¡£ï¼ˆä¸éœ€è¦åŠŸèƒ½çš„å…·ä½“å®ç°æ–¹æ¡ˆï¼Œåªéœ€è¦ç¡®å®šæœ‰å“ªäº›åŠŸèƒ½å³å¯ï¼‰ï¼ŒåŒ…æ‹¬ä¸€äº›å®ä½“ç±»ã€VOå¯¹è±¡çš„å®šä¹‰ï¼Œæ¥å£å®šä¹‰ï¼Œæ•°æ®åº“è¡¨å®šä¹‰ç­‰ç­‰ã€‚</p>
<h4 data-id="heading-3">1ã€é’ˆå¯¹æ–°æµç¨‹ï¼ˆPRDæ–‡æ¡£ï¼‰çš„åˆ†æ</h4>
<p>Cursorå¯ä»¥å¾ˆå¥½çš„åˆ†æå¹¶æ€»ç»“PRDæ–‡æ¡£çš„å†…å®¹ï¼Œä½†äº§å“ç»™å‡ºçš„PRDæ–‡æ¡£ä¸­ä¸å¯é¿å…çš„ä¼šå¯¹ä¸€äº›â€œä¼—æ‰€å‘¨çŸ¥â€çš„ä¸Šä¸‹æ–‡è¿›è¡Œçœç•¥ï¼ŒCursorä¹Ÿå› æ­¤æ— æ³•å¾—çŸ¥é¡¹ç›®çš„å…¨è²Œï¼Œå•çº¯æŠŠPRDæ–‡æ¡£å–‚ç»™Cursorå¹¶ä¸èƒ½è®©ä»–ç›´æ¥ç”Ÿæˆç¬¦åˆæˆ‘ä»¬æœŸæœ›çš„ä»£ç ã€‚</p>
<p>ä½†è¿™ä¸ä»£è¡¨æˆ‘ä»¬åœ¨è¿™ä¸€é˜¶æ®µå®Œå…¨æ— æ³•è®©Cursorä¸ºæˆ‘ä»¬åˆ›é€ ä»·å€¼ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨Cursorçš„åˆ†ææ€»ç»“èƒ½åŠ›ï¼Œæ¢³ç†PRDæ–‡æ¡£ä¸­çš„åŠŸèƒ½ç‚¹ä¸è¦ç‚¹ï¼ŒåŠ é€Ÿè‡ªå·±ç†è§£é¡¹ç›®ï¼Œå¹¶ç»“åˆè‡ªå·±å¯¹prdçš„ç†è§£è¿›è¡ŒåŒå‘éªŒè¯ã€‚é¿å…åæœŸå¼€å‘æ—¶å‡ºç°ä¸äº§å“ç†è§£ä¸ç¬¦æˆ–è€…é—æ¼åŠŸèƒ½ç‚¹ã€‚</p>
<p>ä½¿ç”¨Cursorè¯»å–å¹¶åˆ†ææœ¬æ¬¡éœ€æ±‚PRDæ–‡æ¡£çš„å†…å®¹æ—¶ï¼Œä¸ºäº†ä¸è¢«ä¸Šä¸‹æ–‡é•¿åº¦æ‰€é™åˆ¶ï¼Œæˆ‘ä»¬éœ€è¦è®©Cursorå°†ä»–çš„æ€è€ƒç»“æœè¿›è¡Œè®°å½•ã€‚ä¾‹å¦‚ä¸‹é¢çš„æç¤ºè¯ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">https://dashen.zhuanspirit.com/pages/viewpage.action?<span class="hljs-attr">pageId</span>=xxxxxxxx 
æå–ä¸€ä¸‹ä¸Šé¢é“¾æ¥çš„æ–‡æ¡£ä¸­çš„å†…å®¹ã€‚å¸®æˆ‘æç‚¼ã€XXXXXè´¦å•ã€‘éƒ¨åˆ†ç›¸å…³åŠŸèƒ½ï¼Œæœ‰å“ªäº›éœ€è¦å¼€å‘çš„åŠŸèƒ½ç‚¹ï¼Œæ³¨æ„ï¼Œæˆ‘ä»¬æœ¬æ¬¡ä»…éœ€è¦æŸ¥è¯¢XXXXåˆ—è¡¨ä»¥åŠæŸ¥è¯¢XXXXæµæ°´è¯¦æƒ…ï¼Œå…¶ä½™ç›¸å…³åŠŸèƒ½å’Œç»„ä»¶å·²ç»å®ç°å®Œæˆã€‚
åˆ†æä½ éœ€è¦æ‹†åˆ†å‡ºå¤šå°‘ä¸ªåŠŸèƒ½ç‚¹ä»¥åŠæ¥å£

åœ¨æˆ‘è®©ä½ å†™ä»£ç ä¹‹å‰ä¸è¦ç”Ÿæˆä»£ç ï¼Œå…ˆé€æ­¥åˆ†æéœ€æ±‚ï¼Œå†è¯´æ˜ä½ æ‰“ç®—æ€ä¹ˆåš
å°†ä½ çš„æ€è€ƒä»¥mdçš„å½¢å¼ä¿å­˜åœ¨.docs/æŠ€æœ¯è®¾è®¡.mdä¸‹
</code></pre>
<blockquote>
<p>ä¹Ÿè®¸ä½ çš„åœ¨çº¿PRDæ–‡æ¡£éœ€è¦ç™»é™†æ‰å¯æŸ¥çœ‹ï¼Œè¿™é‡Œç»™å‡ºä¸¤ä¸ªè§£å†³æ–¹æ¡ˆï¼š</p>
<ol>
<li>æ‰¾åˆ°ä½ çš„æœ¬åœ°cookieï¼Œè®©Cursorå¸¦ç€cookieå¯¹ä½ çš„åœ¨çº¿æ–‡æ¡£è¿›è¡Œè®¿é—®</li>
<li>ä½¿ç”¨mcpï¼Œå…·ä½“æ–¹æ³•è¿™é‡Œä¸è¿›è¡Œå±•å¼€</li>
</ol>
</blockquote>
<p>ç„¶åï¼Œåå¤ä¸AIè¿›è¡Œæ²Ÿé€šï¼Œæ˜ç¡®å‘Šè¯‰ä»–æˆ‘ä»¬éœ€è¦ä»€ä¹ˆï¼Œä¸éœ€è¦ä»€ä¹ˆï¼Œä¾‹å¦‚ä¸‹é¢çš„æç¤ºè¯ã€‚</p>
<pre><code class="hljs">æˆ‘ä»¬ä¸åšæ•°æ®åŒæ­¥ä¸ä¿å­˜ç›¸å…³çš„å·¥ä½œï¼Œä»è®¾è®¡æ–¹æ¡ˆä¸­å‰”é™¤ï¼Œæ‰€æœ‰çš„æ•°æ®å·²ç»å‡†å¤‡å°±ç»ªï¼Œæˆ‘ä»¬åªéœ€è¦æŸ¥è¯¢å°±å¯ä»¥äº†
å¸®æˆ‘è®¾è®¡è¿™ä¸ªæ¥å£çš„æŸ¥è¯¢çš„å‚æ•°ä¸è¿”å›å€¼
</code></pre>
<br/>
<p>ä¸‹é¢æ˜¯åŸºäºCursorè¿›è¡ŒPRDæ–‡æ¡£åˆ†æçš„åŸºæœ¬æµç¨‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/153b7c74e3f042a487efe480cc838e0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763351557&amp;x-signature=%2BV%2Feyj2gMMJXYNrs%2BPxo%2BkdpoJQ%3D" alt="Cursorè¾…åŠ©ç¡®è®¤PRDæ–‡æ¡£åŠŸèƒ½ç‚¹çš„è¿‡ç¨‹" loading="lazy"/></p>
<p>é¦–å…ˆæ˜ç¡®ä¸€ç‚¹ï¼šä¸è¦è¯•å›¾è®©Cursoræ¥æ•™æˆ‘ä»¬å¦‚ä½•åšé¡¹ç›®ï¼Œè€Œæ˜¯è®©å®ƒååŠ©å®Œæˆæ¯ä¸ªç¯èŠ‚ã€‚æ‰€ä»¥å¦‚æœè§‰å¾—è‡ªå·±å¯ä»¥æ›´å¿«æ›´å‡†ç¡®çš„ä¿®æ”¹æ–‡æ¡£çš„æŸä¸€éƒ¨åˆ†ï¼Œä¸»åŠ¨å»ä¿®æ”¹ï¼Œä¸è¦è®©AIæ¥åšã€‚æ¯”å¦‚ï¼ŒAIå¸®å¿™è®¾è®¡äº†ä¸€ä¸ªå®ä½“å¯¹è±¡ï¼Œä½†æ˜¯å…¶ä¸­éƒ¨åˆ†å­—æ®µå‘½åä¸ç¬¦åˆæˆ‘ä»¬çš„ä¸šåŠ¡è¦æ±‚ï¼Œæˆ‘ä»¬å°±ä¸è¦è®©AIæ¥ä¿®æ”¹äº†ï¼Œç›´æ¥åŠ¨æ‰‹ä¿®æ”¹mdæ–‡æ¡£ã€‚</p>
<p>å¦å¤–ï¼Œå¦‚æœä½ äº²è‡ªæ”¹åŠ¨çš„å†…å®¹å¾ˆå¤šï¼Œå»ºè®®ä¸‹æ¬¡è·ŸCursoræ²Ÿé€šçš„æ—¶å€™æ–°å¼€å¯ä¸€ä¸ªå¯¹è¯æ¡†ï¼Œé‡æ–°è®©ä»–è¯»å–PRDæ–‡æ¡£åŠå¯¹åº”çš„åˆ†ææ–‡æ¡£ï¼Œå¦åˆ™Cursorä¼šä¿ç•™ä¹‹å‰ç”Ÿæˆçš„è®°å¿†ï¼Œå¯¼è‡´ä½ çš„æ”¹åŠ¨å¯èƒ½ä¸ä¼šç”Ÿæ•ˆã€‚</p>
<p>ä¸‹é¢æ˜¯æ­¤é˜¶æ®µç”Ÿæˆçš„åŠŸèƒ½åˆ†ææ–‡æ¡£çš„éƒ¨åˆ†å±•ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cad7926278946eb98ab687225d1ef9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763351557&amp;x-signature=phbq6jfAKDVncGSDsG3orHZC9H4%3D" alt="img" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d701f588f6b74d6aa757431eeafd1267~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763351557&amp;x-signature=guqaeK7MweqHyD3xrcqpN%2BN1Whk%3D" alt="CursoråŸºäºPRDæ–‡æ¡£åˆæ­¥ç”Ÿæˆçš„æ–‡æ¡£" loading="lazy"/></p>
<h4 data-id="heading-4">2ã€å¯¹äºç›®å‰å·²æœ‰ä»£ç çš„åˆ†æï¼Œä»¥åŠå½±å“èŒƒå›´åˆ†æ</h4>
<p>ç›¸æ¯”äºå¼€å‘è€…æ¥è¯´ï¼ŒCursorä¼šæ›´è´´è¿‘ä»£ç ã€‚æˆ‘ä»¬å¯ä»¥åœ¨Cursorçš„ååŠ©ä¸‹æ›´å¥½çš„å®Œæˆç°æœ‰ä¸šåŠ¡æµç¨‹çš„æ¢³ç†ã€‚
æ›´å…·ä½“çš„è®²ï¼Œæˆ‘ä»¬å¯ä»¥ä»éœ€æ±‚çš„ç›®æ ‡æ”¹åŠ¨ç‚¹å¼€å§‹ï¼Œæ¢³ç†å…¶æ‰€å±åŠŸèƒ½å’Œå®ç°æ–¹å¼ï¼ŒåŒ…å«æ•°æ®ç®¡ç†ã€äº¤äº’æµç¨‹ç­‰ç­‰ã€‚
è¿™é‡Œä»‹ç»ä¸€ä¸‹æˆ‘ä»¬å¸¸ç”¨çš„Cursoræ’ä»¶ï¼š
Mermaid Previewæ’ä»¶ï¼Œä¸Markdown Preview Enhancedæ’ä»¶ã€‚</p>
<blockquote>
<p>æµç¨‹å›¾ç”Ÿæˆæ’ä»¶
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2936d20205f84e8096c5483082f0f7c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763351557&amp;x-signature=WhNhktifJKbaS%2BXV%2BkEzB8fqYcA%3D" alt="img" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6c1026715a04c2e9af783feef7551fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763351557&amp;x-signature=c5jVMHbT5BU7uYDSapg1APaFJpQ%3D" alt="img" loading="lazy"/></p>
</blockquote>
<p>å®‰è£…å®Œæ’ä»¶å¹¶é‡å¯cursoråæˆ‘ä»¬ä¾¿å¯ä»¥é€šè¿‡å¦‚ä¸‹æç¤ºè¯è¿›è¡Œæµç¨‹å›¾ç”Ÿæˆäº†ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino">com.xxx.xxx.xxx.xxx.facade.SxxxxxxxxFacade<span class="hljs-meta">#getxxxxxx</span>
é’ˆå¯¹è¯¥æ–¹æ³•å¸®æˆ‘ç”Ÿæˆä¸€ä¸ª.mdçš„ä¸šåŠ¡æµç¨‹å›¾
</code></pre>
<br/>
<p>å¯¹äºå¤æ‚çš„ç³»ç»Ÿæµç¨‹æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºæ­¤ç§æ–¹æ³•ç”Ÿæˆæµç¨‹å›¾ï¼Œè¾…åŠ©ç¡®å®šæœ¬æ¬¡æ”¹åŠ¨çš„ä»£ç çš„å½±å“èŒƒå›´ã€‚</p>
<h3 data-id="heading-5">äºŒã€å¸®åŠ©Cursoræ›´å¥½çš„ç†è§£é¡¹ç›®ï¼Œå¹¶ç”Ÿæˆä»£ç </h3>
<p>æˆ‘ä»¬æ€»æ˜¯å¸Œæœ›æœ‰ä¸€ä¸ªå·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬æŒ–æ˜AIçš„æ½œåŠ›ï¼Œè®©ä»–æ›´å¥½çš„æ˜ç™½æˆ‘ä»¬çš„ç³»ç»Ÿï¼Œäº†è§£æˆ‘ä»¬çš„ä¸šåŠ¡ï¼Œä¾‹å¦‚å„ç§çŸ¥è¯†åº“ï¼Œå„ç§Ruleï½¡å³ä½¿AIçš„æ€ç»´èƒ½åŠ›å¯ä»¥ä¸çœŸäººåª²ç¾ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆéš¾æƒ³è±¡è®©ä½ èº«è¾¹çš„æŸä¸€ä½ç»éªŒä¸°å¯Œçš„åŒäº‹ä»…ä¾é äº§å“æ–‡æ¡£å°±å¯ä»¥å‡†ç¡®çš„å®Œæˆé¡¹ç›®å¼€å‘ã€‚é¡¹ç›®è¿‡ç¨‹ä¸­å¿…ç„¶ä¼šç»å†å¤šæ¬¡æ²Ÿé€š,å¤šæ¬¡æ–¹æ¡ˆä¿®æ­£ï¼Œæœ€ç»ˆå¤šæ–¹è¾¾æˆä¸€è‡´ï¼Œå†è¿›å…¥å¼€å‘é˜¶æ–­ã€‚
åŒæ ·ï¼Œåœ¨æ­£å¼è¿›è¡Œå¼€å‘å‰ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦æœ‰ä¸€ä»½æŠ€æœ¯æ–‡æ¡£æ¥æŒ‡å¯¼Cursorè¿›è¡Œå¼€å‘ã€‚<strong>ä¸åŒäºå‰é¢éœ€æ±‚æ–‡æ¡£çš„ç®€å•åˆ†æï¼Œè¿™ä¸€éƒ¨åˆ†çš„åˆ†æéœ€è¦å¯¹æ¯ä¸€ä¸ªåŠŸèƒ½æœ‰è¯¦ç»†çš„æè¿°</strong>ã€‚æˆ‘ä»¬å¯ä»¥åŸºäºä¹‹å‰è½åœ°mdæ–‡æ¡£ç»§ç»­è¿›è¡Œå®Œå–„ã€‚è¿™ä¸€é˜¶æ®µçš„ä¸»è¦ç›®æ ‡æ˜¯ä¸ºCursorè¡¥å……ä¸Šä¸‹æ–‡ç»†èŠ‚å¹¶æ ¸éªŒCursorç»“è®ºçš„è¿‡ç¨‹ã€‚æˆ‘ä»¬éœ€è¦é’ˆå¯¹æ¯ä¸€ä¸ªåŠŸèƒ½ç‚¹ï¼š</p>
<ol>
<li><strong>è°ƒæ•´AIçš„å‘½åæ–¹å¼ä¸ä»£ç ç”Ÿæˆä½ç½®</strong>ï¼ˆå¯ä»¥ä½¿ç”¨Ruleè¿›è¡Œç®€åŒ–ï¼‰ã€‚</li>
<li><strong>è°ƒæ•´AIä½¿ç”¨çš„å·¥å…·ç±»ä¸æœåŠ¡ç±»ã€‚</strong></li>
<li><strong>è°ƒæ•´AIçš„é€»è¾‘ç»†èŠ‚</strong>ï¼ˆä¾‹å¦‚è°ƒæ•´æ ¡éªŒè§„åˆ™ï¼Œåˆ¤æ–­é¡ºåºç­‰ï¼‰ã€‚</li>
<li><strong>è°ƒæ•´AIçš„ä¸šåŠ¡ç»†èŠ‚</strong>ï¼ˆä¼˜å…ˆä»PRDæ–‡æ¡£ä¸ŠèŠ‚é€‰åŸæ–‡ï¼Œå°è¯•è®©Cursorç†è§£ã€‚å¦‚æœPRDæ–‡æ¡£æ²¡æœ‰å†™æ¸…ä¸šåŠ¡æµç¨‹ï¼Œå°±è‡ªå·±åŠ¨æ‰‹æè¿°æµç¨‹æˆ–è€…å¹²è„†ç›´æ¥è®©Cursorè·³è¿‡ç”Ÿæˆå¹¶é¢„ç•™æ–¹æ³•ï¼Œæ–¹ä¾¿åé¢è‡ªå·±åŠ¨æ‰‹è¡¥å……é€»è¾‘ï¼‰ã€‚</li>
</ol>
<p>æœ€ç»ˆæˆ‘ä»¬å¾—åˆ°äº†è¿™æ ·ä¸€ä»½è¯¦ç»†æè¿°äº†ä¸šåŠ¡åŠŸèƒ½çš„mdæ–‡æ¡£ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6681742d8fa54dbb8528f5c798412597~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763351557&amp;x-signature=ud5L%2BwVmxA3ksQenWshch2Is3rQ%3D" alt="img" loading="lazy"/></p>
<p>å¦‚æ­¤ä¸€æ¥ï¼Œå¾—åˆ°çš„è¿™ä»½æ–‡æ¡£å®é™…ä¸Šæ˜¯æˆ‘ä»¬ä¸Cursoréƒ½èƒ½ç†è§£ï¼Œå¹¶ä¸”è¾¾æˆä¸€è‡´çš„ã€‚æˆ‘ä»¬ç»ˆäºå¾—åˆ°äº†é‚£ä»½å¯ä»¥ä¾›æˆ‘ä»¬ç”¨ä½œâ€œç”Ÿæˆæç¤ºè¯â€çš„åŠŸèƒ½åˆ†ææ–‡æ¡£ï¼ŒåŸºäºè¿™ä»½æ–‡æ¡£åç»­Cursorç”Ÿæˆçš„ä»£ç ä¹Ÿéƒ½åŸºæœ¬å¯ä»¥æ»¡è¶³è¦æ±‚ã€‚</p>
<p>ä¸‹å›¾ä¸ºä½¿ç”¨Cursorç”Ÿæˆä»£ç çš„æ•´ä½“é€»è¾‘æµç¨‹ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f17d9f31e86452ab4bb6a83b6e4a9fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763351557&amp;x-signature=wIoB931QkHRBWXsDetZcpDQh7lU%3D" alt="img" loading="lazy"/></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬æ¯æ¬¡åªå°±ä¸€ä¸ªåŠŸèƒ½ç‚¹è¿›è¡Œåˆ†æï¼Œå¹¶ä¸”ä¸€æ—¦ä½ è§‰å¾—è¿™ä¸ªåŠŸèƒ½ç‚¹å·²ç»ç›¸å¯¹å®Œå–„ï¼Œå°½å¿«è½åœ°æˆä»£ç ï¼Œä¸è¦ç•™åœ¨ä¸€èµ·ï¼Œè®©AIæœ€åä¸€èµ·ç”Ÿæˆã€‚
ä¸€æ–¹é¢AIåœ¨å¤„ç†è¿‡å¤šçš„å†…å®¹æ—¶ä¼šä¸å¯é¿å…çš„äº§ç”Ÿåå·®ï¼Œå¦ä¸€æ–¹é¢ï¼Œå¦‚æœé¡¹ç›®è¿‡å¤§ï¼Œæˆ‘ä»¬ä¹Ÿå®¹æ˜“å¿˜è®°ä¸€äº›ç»†èŠ‚ï¼Œå¯¼è‡´èŠ±è´¹é¢å¤–çš„æ—¶é—´æ¥è¿›è¡Œå›å¿†ä¸éªŒè¯ã€‚</p>
<h3 data-id="heading-6">ä¸‰ã€Cursorå¸®åŠ©å¼€å‘è€…è¿›è¡Œå›å½’éªŒè¯</h3>
<p>é™¤å»å¼€å‘é˜¶æ®µçš„è¾…åŠ©ä½œç”¨ï¼ŒCursorå¦ä¸€å¤§ä½œç”¨ä½“ç°åœ¨å¼€å‘åçš„è¾…åŠ©è´¨é‡ä¿è¯ä¸Šã€‚é€šå¸¸ä½“ç°åœ¨ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢ï¼š</p>
<ol>
<li>æ”¹åŠ¨å½±å“è¯„ä¼°</li>
<li>åŠŸèƒ½éªŒè¯</li>
</ol>
<p>ä¸ºäº†å®ç°ä¸Šè¿°èƒ½åŠ›ï¼Œæˆ‘ä»¬æŒ‰ç…§ä¸‰æ­¥èµ°çš„æ–¹å¼æ¥è¿›è¡Œ</p>
<h4 data-id="heading-7">1ã€æ”¹åŠ¨èŒƒå›´æ•´ç†</h4>
<p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤é€ä¸ªæ–‡ä»¶åˆ†æå½“å‰åˆ†æ”¯æ”¹åŠ¨ç‚¹å¹¶è¾“å‡ºåˆ°cr.diff æ–‡ä»¶ä¸­ï¼Œéšååœ¨mdæ–‡ä»¶æœ«å°¾è¿›è¡Œæ€»ç»“ï¼šgit diff origin/master Â &gt; cr.diff</p>
<h4 data-id="heading-8">2ã€åŸºæœ¬ä»£ç å®¡æŸ¥</h4>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æç¤ºè¯å¼•å¯¼Cursorè¿›è¡ŒåŸºæœ¬ä»£ç å®¡æŸ¥ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">æ‰«ædiff æ–‡ä»¶ä¸­çš„å·®å¼‚ä»£ç ã€‚reviwe çš„è§„åˆ™å¦‚ä¸‹

<span class="hljs-bullet">1.</span> æ–¹æ³•ä½“è¡Œæ•°åº”å°‘äº100è¡Œ, ä¸åŒ…æ‹¬ç©ºè¡Œ,å’Œæ³¨é‡Š
<span class="hljs-bullet">2.</span> æšä¸¾å®šä¹‰éœ€è¦æœ‰ä¸¤ä¸ªä»¥ä¸Šå±æ€§, code, name, å¹¶ä¸”éœ€è¦æœ‰é€šè¿‡codeè·å–æšä¸¾é¡¹çš„æ–¹æ³•
<span class="hljs-bullet">3.</span> æ¥å£è¿”å›falseÂ , å‰ç«¯æ˜¯å¦æœ‰å¯¹falseè¿›è¡Œå¤„ç†Â 
<span class="hljs-bullet">4.</span> throw äº†å¼‚å¸¸çš„ä½ç½®, ä¸€å®šè¦æ‰“logæ—¥å¿—Â 
<span class="hljs-bullet">5.</span> æ‰€æœ‰çš„public å…¬æœ‰æ–¹æ³•éƒ½è¦æ‰“å°å…¥å‚log.infoæ—¥å¿—Â 
<span class="hljs-bullet">6.</span> æ‰€æœ‰çš„public å…¬æœ‰æ–¹æ³•, ç»“æŸéƒ½è¦æ‰“å°ç»“æŸæ—¥å¿—Â 
<span class="hljs-bullet">7.</span> æ‰€æœ‰è°ƒç”¨rpcçš„æ–¹æ³•, éƒ½è¦æ‰“å°æ—¥å¿—
<span class="hljs-bullet">8.</span> æ‰€æœ‰æ–¹æ³•éƒ½è¦æœ‰æ–¹æ³•çº§åˆ«çš„æ³¨é‡Š
<span class="hljs-bullet">9.</span> try catchå¼‚å¸¸å, å¦‚æœåœ¨catch ä¸­åˆæŠ›å‡ºäº†æ–°åˆ›å»ºçš„å¼‚å¸¸æ—¶, éœ€è¦å°†åŸå¼‚å¸¸èµ‹å€¼ç»™æ–°å¼‚å¸¸
<span class="hljs-bullet">10.</span> ä¸èƒ½è°ƒç”¨è¢«æ ‡è®°@Deprecated çš„å±æ€§æˆ–æ–¹æ³•æˆ–ç±»
<span class="hljs-bullet">11.</span> å®šä¹‰çš„å¸¸é‡å€¼, ç»™å‡ºæ¸…æ™°çš„æ³¨é‡Šè¯´æ˜ç”¨é€”, é¿å…ç¡¬ç¼–ç 
<span class="hljs-bullet">12.</span> æ ‡æ³¨äº†@transactionalçš„æ–¹æ³•è¦æ˜ç¡®å›æ»šå¼‚å¸¸ç±»å‹, å¯¹äºåªè¯»æ“ä½œè¦æ ‡æ³¨åªè¯»readOnly=trueÂ æé«˜æ€§èƒ½
<span class="hljs-bullet">13.</span> 3æ¬¡ä»¥ä¸Šå­—ç¬¦ä¸²æ‹¼æ¥ä½¿ç”¨StringBuilderä»£æ›¿å­—ç¬¦ä¸²æ‹¼æ¥
<span class="hljs-bullet">14.</span> æ£€æŸ¥æ˜¯å¦å­˜åœ¨å…¶ä»–ç ´åå…¼å®¹æ€§çš„æ”¹åŠ¨æˆ–é€»è¾‘ä¸Šçš„é”™è¯¯
<span class="hljs-bullet">15.</span> æ£€æŸ¥æ˜¯å¦å­˜åœ¨å¾ªç¯è°ƒç”¨å¯¼è‡´çš„é€»è¾‘é—®é¢˜
16ã€æ–°å¢çš„é¡µé¢æäº¤å’Œæ”¯ä»˜ç›¸å…³æµç¨‹è¦è€ƒè™‘å¹‚ç­‰å¤„ç†
17ã€æ¥å£å¯èƒ½è¢«é‡å¤è°ƒç”¨å’Œmqæ¶ˆæ¯é‡å¤æ¥æ”¶åœºæ™¯è¦è€ƒè™‘å¹¶å‘å’Œäº‹åŠ¡å†²çªå’Œæ•°æ®è¦†ç›–ï¼Œè¦å–„ç”¨åˆ†å¸ƒå¼é”
18ã€é’ˆå¯¹æ•°æ®åº“å•ä¸€å­—æ®µçš„ä¿®æ”¹ï¼Œå°½å¯èƒ½è¦ç²¾ç¡®ä¿®æ”¹ï¼Œä½¿ç”¨æ•´ä½“å¯¹è±¡è¿›è¡Œä¿®æ”¹
19ã€æ˜¯å¦å­˜åœ¨é‡å¤ä»£ç 
20ã€ä¿®æ”¹é€»è¾‘æ˜¯å¦è®¾è®¡åˆ°è®¡æ•°ç³»ç»Ÿå£å¾„çš„ä¿®æ”¹
21ã€æ•°æ®äº¤äº’è¿‡ç¨‹ä¸­ï¼ˆæ•°æ®åº“å’Œå¤–éƒ¨è°ƒç”¨ï¼‰çš„ç©ºæŒ‡é’ˆåˆ¤æ–­å’Œå¤„ç†
22ã€çŠ¶æ€æµè½¬è¿‡ç¨‹å’Œæ¶‰åŠèµ„äº§æŸå¤±çš„éƒ¨åˆ†è¦å¯¹å‰ç½®çŠ¶æ€è¿›è¡Œæ ¡éªŒ
23ã€æ¶‰åŠæ•°æ®åº“å’Œå¤–éƒ¨äº‹åŠ¡çš„æ¥å£ï¼Œè¦ä¿è¯æ•´ä½“äº‹åŠ¡çš„ä¸€è‡´æ€§ï¼Œæ— æ³•ä¿è¯çš„è¦æœ‰è¡¥å¿æœºåˆ¶
24ã€æ¶‰åŠå¼‚æ­¥å›è°ƒçš„åœºæ™¯ï¼Œè¦è€ƒè™‘ä¸­é—´æ€çš„å¤„ç†
25ã€ä¸å…è®¸æŠŠé…ç½®è§„åˆ™äº¤ç»™è¿è¥åŒå­¦
26ã€è¿”å›çš„listç±»å‹ï¼Œè¦ç»™å®šé»˜è®¤å€¼ï¼Œä¸èƒ½ç»™null
27ã€ä¸»é”®å¿…é¡»è®¾ç½®è‡ªå¢æˆ–è€…ä½¿ç”¨åˆ†å¸ƒå¼id
28ã€æ•°æ®åº“è¡¨æ˜¯å¦å»ºç«‹äº†ç´¢å¼•
29ã€å¼‚å¸¸åœºæ™¯è¦æ‰“å°æŠ¥è­¦ï¼Œå°½å¯èƒ½ä¼˜å…ˆå¤šæ‰“å°
éå†æ‰€æœ‰è§„åˆ™, ä¸€ä¸ªè§„åˆ™ä¸€ä¸ªè§„åˆ™çš„å»æ£€æŸ¥å¢é‡ä»£ç çš„è§„èŒƒæ€§, æ¯ä¸ªè§„åˆ™è¿›è¡ŒReviewæ—¶, ä½¿ç”¨ç‹¬ç«‹çš„ä¸Šä¸‹æ–‡, æœ€åå½’çº³æ‰€æœ‰çš„Reviewç»“æœ.
è¾“å‡ºè¿åè§„åˆ™çš„æ–‡ä»¶ä½ç½®, åœ¨æˆ‘è¯´å¯ä»¥ä¿®æ”¹ä¹‹å‰ä¸è¦ä¿®æ”¹æ–‡ä»¶
</code></pre>
<h4 data-id="heading-9">3ã€åŠŸèƒ½è¾…åŠ©éªŒè¯</h4>
<p>åœ¨å®Œæˆä»£ç ç”Ÿæˆä¸åˆæ­¥å®¡æŸ¥åï¼Œæˆ‘ä»¬è¿›å…¥åŠŸèƒ½éªŒè¯é˜¶æ®µã€‚æ­¤æ—¶å¯åˆ©ç”¨Cursoråˆ†æä»£ç å˜æ›´ï¼Œè‡ªåŠ¨ç”Ÿæˆè‡ªæµ‹ç”¨ä¾‹æ¸…å•ã€‚é€šè¿‡æç¤ºè¯å¼•å¯¼Cursorç»“åˆä¸šåŠ¡é€»è¾‘ã€æ¥å£è¾“å…¥è¾“å‡ºåŠå¼‚å¸¸åˆ†æ”¯ï¼Œè¾“å‡ºè¦†ç›–æ ¸å¿ƒè·¯å¾„ã€è¾¹ç•Œæ¡ä»¶å’Œé”™è¯¯å¤„ç†çš„æµ‹è¯•åœºæ™¯ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs">åŸºäºå½“å‰ä»£ç å˜æ›´ï¼Œåˆ—å‡ºéœ€è¦è‡ªæµ‹çš„åŠŸèƒ½ç‚¹å’Œè¾¹ç•Œæƒ…å†µï¼ŒåŒ…æ‹¬æ­£å¸¸æµç¨‹ã€å¼‚å¸¸è¾“å…¥ã€çŠ¶æ€æ ¡éªŒç­‰ï¼Œè¾“å‡ºä¸ºè¡¨æ ¼å½¢å¼ï¼ŒåŒ…å«ç”¨ä¾‹ç¼–å·ã€åœºæ™¯æè¿°ã€é¢„æœŸç»“æœã€‚
</code></pre>
<p>è¯¥è¿‡ç¨‹ä¸ä»…æ˜¯æµ‹è¯•å‡†å¤‡ï¼Œæ›´æ˜¯å¯¹æ•´ä½“é€»è¾‘çš„å†ç¡®è®¤ã€‚é€šè¿‡Cursorè¾…åŠ©éªŒè¯ï¼Œæå‡è‡ªæµ‹å®Œæ•´æ€§ï¼Œå‡å°‘åæœŸå›å½’æˆæœ¬ï¼Œç¡®ä¿äº¤ä»˜è´¨é‡ã€‚</p>
<h2 data-id="heading-10">å°ç»“</h2>
<p>è‡³æ­¤ï¼Œæœ¬æ–‡åˆ†äº«äº†å›æ”¶å›¢é˜Ÿåœ¨AIç¼–ç¨‹å®è·µä¸­çš„ç»éªŒï¼Œé‡ç‚¹ä»‹ç»äº†å¦‚ä½•é«˜æ•ˆä½¿ç”¨Cursorè¾…åŠ©å¼€å‘ã€‚é€šè¿‡åˆ†é˜¶æ®µåä½œâ€”â€”ä»éœ€æ±‚åˆ†æï¼Œç°çŠ¶æ¢³ç†åˆ°æŠ€æœ¯è®¾è®¡ï¼Œä»£ç ç”Ÿæˆï¼Œå†åˆ°æµ‹è¯•éªŒè¯ã€‚</p>
<p>AIæ—¶ä»£ï¼Œå¼€å‘è€…çš„æ ¸å¿ƒç«äº‰åŠ›æ­£ä»â€œæŒæ¡çŸ¥è¯†â€è½¬å‘â€œæå‡ºé—®é¢˜â€ã€‚å·¥å…·å¦‚Cursorå¹¶éæ›¿ä»£å¼€å‘äººå‘˜ï¼Œè€Œæ˜¯é€šè¿‡äººæœºååŒï¼Œæå‡éœ€æ±‚ç†è§£ã€æŠ€æœ¯è®¾è®¡ä¸ä»£ç è´¨é‡çš„æ•ˆç‡ã€‚æˆ‘ä»¬è¦ä»¥ä¸“ä¸šç§¯ç´¯æ„å»ºæ¸…æ™°ä¸Šä¸‹æ–‡ï¼Œå¼•å¯¼AIå®Œæˆæ‹†è§£ã€åˆ†æã€ç”Ÿæˆä¸éªŒè¯ï¼Œæœ€ç»ˆå®ç°é«˜æ•ˆã€é«˜è´¨é‡çš„å¼€å‘é—­ç¯ã€‚</p>
<blockquote>
<p>å…³äºä½œè€…ï¼Œé»„æ•¬ä¹¾ï¼Œä¾ å®¢æ±‡Javaå¼€å‘å·¥ç¨‹å¸ˆã€‚</p>
</blockquote>
<blockquote>
<p>è½¬è½¬ç ”å‘ä¸­å¿ƒåŠä¸šç•Œå°ä¼™ä¼´ä»¬çš„æŠ€æœ¯å­¦ä¹ äº¤æµå¹³å°ï¼Œå®šæœŸåˆ†äº«ä¸€çº¿çš„å®æˆ˜ç»éªŒåŠä¸šç•Œå‰æ²¿çš„æŠ€æœ¯è¯é¢˜ã€‚
å…³æ³¨å…¬ä¼—å·ã€Œè½¬è½¬æŠ€æœ¯ã€ï¼ˆç»¼åˆæ€§ï¼‰ã€ã€Œå¤§è½¬è½¬FEã€ï¼ˆä¸“æ³¨äºFEï¼‰ã€ã€Œè½¬è½¬QAã€ï¼ˆä¸“æ³¨äºQAï¼‰ï¼Œæ›´å¤šå¹²è´§å®è·µï¼Œæ¬¢è¿äº¤æµåˆ†äº«~</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>