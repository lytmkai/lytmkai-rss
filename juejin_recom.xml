<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[ä½¿ç”¨ Claude Code ä¼˜åŒ–åšå®¢å†™ä½œï¼šæˆ‘çš„å®Œæ•´å·¥ä½œæµç¨‹]]></title>    <link>https://juejin.cn/post/7572453554332024832</link>    <guid>https://juejin.cn/post/7572453554332024832</guid>    <pubDate>2025-11-15T14:19:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572453554332024832" data-draft-id="7572493520003514402" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½¿ç”¨ Claude Code ä¼˜åŒ–åšå®¢å†™ä½œï¼šæˆ‘çš„å®Œæ•´å·¥ä½œæµç¨‹"/> <meta itemprop="keywords" content="Claude"/> <meta itemprop="datePublished" content="2025-11-15T14:19:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜¯é­”ä¸¸å•Š"/> <meta itemprop="url" content="https://juejin.cn/user/3217622495411292"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½¿ç”¨ Claude Code ä¼˜åŒ–åšå®¢å†™ä½œï¼šæˆ‘çš„å®Œæ•´å·¥ä½œæµç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3217622495411292/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜¯é­”ä¸¸å•Š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T14:19:09.000Z" title="Sat Nov 15 2025 14:19:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aaronheld.com%2Fpost%2Fstreamlining-blog-writing-with-claude-code" target="_blank" title="https://www.aaronheld.com/post/streamlining-blog-writing-with-claude-code" ref="nofollow noopener noreferrer">è½¬è½½</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7050bfcdd00419b848a93c61dab7ab0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763821149&amp;x-signature=tmWZMYdP6bevEPDB7nNLZFTxY70%3D" alt="" loading="lazy"/></p>
<p>ç°ä»£å†™ä½œè€…çš„é…ç½®ï¼šäººç±»åˆ›é€ åŠ›ä¸AIåŠ©æ‰‹çš„ç»“åˆ</p>
<h2 data-id="heading-0">ä»‹ç»</h2>
<p>25å¹´æ¥ï¼Œæˆ‘ä¸€ç›´åœ¨é€šè¿‡æ— æ•°æ¬¡å†™ä½œå’ŒæŠ€æœ¯æµç¨‹çš„è¿­ä»£æ¥å†™åšå®¢ã€‚æœ€è¿‘ï¼Œæˆ‘å‘ç°äº†ä¸€äº›è®©å†™ä½œå†æ¬¡å˜å¾—<strong>æ„‰å¿«</strong>çš„ä¸œè¥¿ï¼šClaude Codeã€‚è¿™ä¸æ˜¯å¦ä¸€ä¸ª"AIå°†å–ä»£å†™ä½œè€…"çš„æ•…äº‹ã€‚è€Œæ˜¯å…³äºAIå¦‚ä½•é€šè¿‡å¤„ç†å†…å®¹åˆ›å»ºçš„ç¹çéƒ¨åˆ†æ¥å¢å¼ºåˆ›é€ æ€§è¡¨è¾¾ã€‚å…³é”®æ˜¯ï¼Œå®ƒå¸®åŠ©æˆ‘å…‹æœäº†æœ€åçš„éšœç¢ï¼šå®é™…å‘å¸ƒã€‚</p>
<p>æˆ‘çš„å¤§å¤šæ•°æ–‡ç« éƒ½å§‹äºä»æœªè§è¿‡å¤©æ—¥çš„åˆç¨¿ã€‚ç°åœ¨ï¼Œæˆ‘çš„<strong>æœºå™¨äººä¼™ä¼´</strong>æŒ‡å¯¼æˆ‘å®Œæˆä»æƒ³æ³•åˆ°æ‰§è¡Œçš„æ•´ä¸ªè¿‡ç¨‹ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å¸¦ä½ èµ°è¿‡ä»æœ€åˆæƒ³æ³•åˆ°å‘å¸ƒæ–‡ç« çš„å®Œæ•´å·¥ä½œæµç¨‹ï¼Œå‡†ç¡®å±•ç¤ºClaude Codeå¦‚ä½•ä¸æˆ‘é€‰æ‹©çš„é™æ€ç½‘ç«™ç”Ÿæˆå™¨Hugoé›†æˆã€‚ä½ å°†çœ‹åˆ°çœŸå®çš„æˆªå›¾ã€å®é™…çš„å‘½ä»¤ï¼Œä»¥åŠå½“äººç±»æ´å¯ŸåŠ›ä¸AIåŠ©æ‰‹ç›¸é‡æ—¶å‘ç”Ÿçš„çœŸæ­£åä½œè¿‡ç¨‹ã€‚</p>
<h2 data-id="heading-1">éµå¾ªæ–‡æ¡£åŒ–çš„å·¥ä½œæµç¨‹</h2>
<p>æˆ‘å³å°†æ¼”ç¤ºçš„è¿‡ç¨‹ä¸æ˜¯ä¸´æ—¶çš„ - å®ƒéµå¾ªæˆ‘ç»è¿‡æ—¶é—´å¼€å‘å’Œå®Œå–„çš„ç‰¹å®šClaudeå·¥ä½œæµç¨‹æ–‡ä»¶ã€‚è¿™ä¸ªå·¥ä½œæµç¨‹æ–‡æ¡£ä½œä¸ºæŒ‡å¯¼ï¼ŒClaudeå¯ä»¥å‚è€ƒå®ƒä»¥åœ¨ä¸åŒåšå®¢å†™ä½œä¼šè¯ä¸­ä¿æŒä¸€è‡´æ€§ã€‚</p>
<p>ä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹å®Œæ•´çš„å·¥ä½œæµç¨‹æ–‡ä»¶ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faheld%2Faaronheld-blog%2Fblob%2Fmain%2F.claude%2Fworkflows%2Fcreate-blog-post-with-image.md" target="_blank" title="https://github.com/aheld/aaronheld-blog/blob/main/.claude/workflows/create-blog-post-with-image.md" ref="nofollow noopener noreferrer">create-blog-post-with-image.md</a></p>
<p>æ‹¥æœ‰æ–‡æ¡£åŒ–çš„å·¥ä½œæµç¨‹æä¾›äº†å‡ ä¸ªå¥½å¤„ï¼š</p>
<ul>
<li>åœ¨ä¸åŒå†™ä½œä¼šè¯ä¸­çš„<strong>ä¸€è‡´æ€§</strong></li>
<li>å…¶ä»–äººå¯ä»¥éµå¾ªçš„<strong>å¯é‡ç°è¿‡ç¨‹</strong></li>
<li>éšç€æˆ‘æ”¹è¿›å·¥ä½œæµç¨‹çš„<strong>è¿­ä»£æ”¹è¿›</strong></li>
<li>ä¸ºClaudeæä¾›<strong>ä¸Šä¸‹æ–‡</strong>ï¼Œè®©å®ƒç†è§£æˆ‘çš„åå¥½å’Œæ ‡å‡†</li>
</ul>
<p>è¿™ä¸ªå·¥ä½œæµç¨‹æ–‡ä»¶å……å½“è“å›¾ï¼Œå°†å¯èƒ½æ˜¯æ··ä¹±çš„åˆ›ä½œè¿‡ç¨‹è½¬å˜ä¸ºç»“æ„åŒ–çš„ã€å¯é‡å¤çš„ç³»ç»Ÿã€‚</p>
<h2 data-id="heading-2">è®¾ç½®ï¼šå››çª—å£å·¥ä½œæµç¨‹</h2>
<p>æˆ‘çš„Claude Codeåšå®¢å·¥ä½œæµç¨‹çš„åŸºç¡€æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å››çª—å£è®¾ç½®ï¼Œåˆ›å»ºäº†ä¸€ä¸ªå…¨é¢çš„å†™ä½œç¯å¢ƒã€‚ä»¥ä¸‹æ˜¯è¿™äº›çª—å£å¦‚ä½•ååŒå·¥ä½œï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d8c11a9375041adb60d583416db5cab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763821149&amp;x-signature=tJ2XljI%2FRFPDxbQMQaFG%2ByHxMrE%3D" alt="" loading="lazy"/></p>
<p>å››ä¸ªçª—å£å’Œè°å·¥ä½œï¼šHugoæœåŠ¡å™¨ã€Claude Codeã€VSCodeç¼–è¾‘å™¨å’Œç§»åŠ¨æµè§ˆå™¨é¢„è§ˆ</p>
<h3 data-id="heading-3">çª—å£1ï¼šHugoæœåŠ¡å™¨ç»ˆç«¯ï¼ˆå³ä¸‹è§’ï¼‰</h3>
<pre><code class="hljs language-css" lang="css">hugo server -D <span class="hljs-attr">--navigateToChanged</span>
</code></pre>
<p>è¿™åœ¨æ•´ä¸ªå†™ä½œè¿‡ç¨‹ä¸­ä¿æŒè¿è¡Œï¼Œéšç€å†…å®¹çš„æ¼”è¿›æä¾›å³æ—¶åé¦ˆã€‚<code>--navigateToChanged</code>æ ‡å¿—ä¼šè‡ªåŠ¨å°†ä½ çš„æµè§ˆå™¨å¯¼èˆªåˆ°æ›´æ–°çš„å†…å®¹ï¼Œä½¿åé¦ˆå¾ªç¯å‡ ä¹å³æ—¶ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">âš¡ hugo server --navigateToChanged

Watching <span class="hljs-keyword">for</span> changes <span class="hljs-keyword">in</span> /Users/aheld/Projects/aheld/aaronheld-blog/{archetypes,assets,content,i18n,layouts,static}

Watching <span class="hljs-keyword">for</span> config changes <span class="hljs-keyword">in</span> /Users/aheld/Projects/aheld/aaronheld-blog/config.yml, /Users/aheld/Projects/aheld/aaronheld-blog/go.mod

Start building sites â€¦

hugo v0.147.9+extended+withdeploy darwin/arm64 BuildDate=2025-06-23T08:22:20Z VendorInfo=brew



                  â”‚ EN
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€
 Pages            â”‚ 276

 Paginator pages  â”‚  43

 Non-page files   â”‚  47

 Static files     â”‚  20

 Processed images â”‚  26

 Aliases          â”‚  90

 Cleaned          â”‚   0



Built <span class="hljs-keyword">in</span> 132 ms

Environment: <span class="hljs-string">"development"</span>

Serving pages from disk

Running <span class="hljs-keyword">in</span> Fast Render Mode. For full rebuilds on change: hugo server --disableFastRender

Web Server is available at http://localhost:1313/ (<span class="hljs-built_in">bind</span> address 127.0.0.1)

Press Ctrl+C to stop
</code></pre>
<h3 data-id="heading-4">çª—å£2ï¼šClaude Codeç»ˆç«¯ï¼ˆå³ä¸Šè§’ï¼‰</h3>
<p>è¿™æ˜¯åä½œå‘ç”Ÿçš„åœ°æ–¹ã€‚æˆ‘ä½¿ç”¨Claude Codeè¿›è¡Œè§„åˆ’ã€ç ”ç©¶ã€å†™ä½œï¼Œç”šè‡³åœ¨éœ€è¦æ—¶è°ƒè¯•æ„å»ºè¿‡ç¨‹ã€‚Claudeæä¾›æˆ˜ç•¥æ€§æ€ç»´å’Œå†…å®¹ç”Ÿæˆï¼Œè€Œæˆ‘æŒ‡å¯¼æ–¹å‘ã€‚</p>
<h3 data-id="heading-5">çª—å£3ï¼šVSCodeç¼–è¾‘å™¨ï¼ˆå·¦ä¸Šè§’ï¼‰</h3>
<p>ç¼–è¾‘å™¨çª—å£æ˜¯æˆ‘å®¡æŸ¥Claudeçš„æ›´æ”¹ã€è¿›è¡Œå®æ—¶æ›´æ–°å’Œç»´æŠ¤è´¨é‡æ§åˆ¶çš„åœ°æ–¹ã€‚è¿™å¯¹åä½œè¿‡ç¨‹è‡³å…³é‡è¦ - æˆ‘å¯ä»¥å‡†ç¡®çœ‹åˆ°Claudeåœ¨ä¿®æ”¹ä»€ä¹ˆï¼Œå¹¶å®æ—¶æ‰¹å‡†æˆ–è°ƒæ•´æ›´æ”¹ã€‚</p>
<h3 data-id="heading-6">çª—å£4ï¼šç§»åŠ¨æ¨¡æ‹Ÿæ¨¡å¼çš„æµè§ˆå™¨ï¼ˆå·¦ä¸‹è§’ï¼‰</h3>
<p>è®¾ç½®ä¸ºç§»åŠ¨æ¨¡æ‹Ÿæ¨¡å¼çš„æµè§ˆå™¨çª—å£è®©æˆ‘èƒ½ç«‹å³çœ‹åˆ°å†…å®¹åœ¨å°å±å¹•ä¸Šçš„å¤–è§‚ã€‚ç”±äºå¤§å¤šæ•°è¯»è€…åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šè®¿é—®åšå®¢ï¼Œè¿™ç¡®ä¿å†…å®¹ä¸ºå®é™…çš„é˜…è¯»ä½“éªŒè¿›è¡Œäº†ä¼˜åŒ–ã€‚</p>
<p>è¿™ä¸ªå››çª—å£è®¾ç½®çš„ç¾å¦™ä¹‹å¤„åœ¨äºå®Œæ•´çš„åé¦ˆå¾ªç¯ï¼šClaudeç”Ÿæˆå†…å®¹ï¼Œæˆ‘åœ¨VSCodeä¸­å®¡æŸ¥ï¼ŒHugoç«‹å³é‡å»ºï¼Œæˆ‘å¯ä»¥ç«‹å³çœ‹åˆ°æ¡Œé¢å’Œç§»åŠ¨æ¼”ç¤ºã€‚è¿™å°±åƒæ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„ç¼–è¾‘å’Œè®¾è®¡å›¢é˜Ÿå®Œç¾åŒæ­¥å·¥ä½œã€‚</p>
<p>æˆ‘å–œæ¬¢åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨claude codeï¼Œè€Œä¸æ˜¯ä¸“é—¨çš„AIç¼–è¾‘å™¨ã€‚è¿™ç»™äº†æˆ‘é€‰æ‹©çš„è‡ªç”±ã€‚å½“è¿›è¡ŒWebå‰ç«¯å·¥ä½œæ—¶ï¼Œæˆ‘ç»å¸¸åœ¨è¿™ä¸ªå·¥ä½œæµç¨‹ä¸­ä½¿ç”¨neovimï¼Œå¹¶åœ¨ç§»åŠ¨è§†å›¾æ—è¾¹æ·»åŠ ä¸€ä¸ªé¢å¤–çš„æ¡Œé¢æµè§ˆå™¨é¢„è§ˆçª—å£ã€‚æˆ‘å‘ç°VSCode markdowné¢„è§ˆä¿æŒåŒæ­¥æ›´å¥½ï¼Œè¿™åœ¨è¿™ç§æƒ…å†µä¸‹å¾ˆæœ‰å¸®åŠ©ã€‚</p>
<h2 data-id="heading-7">ç¬¬1æ­¥ï¼šä½¿ç”¨Claudeçš„TodoWriteè¿›è¡Œå†…å®¹è§„åˆ’</h2>
<p>Claude Codeå¯¹å†™ä½œè€…æœ€æœ‰ç”¨çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯TodoWriteå·¥å…·ã€‚ä¸æ˜¯ä»ç©ºç™½é¡µé¢å¼€å§‹ï¼ˆä¼ ç»Ÿçš„å†™ä½œè€…å™©æ¢¦ï¼‰ï¼Œæˆ‘é¦–å…ˆè®©Claudeå°†å†™ä½œé¡¹ç›®åˆ†è§£ä¸ºå¯ç®¡ç†çš„ä»»åŠ¡ã€‚</p>
<pre><code class="hljs language-css" lang="css">build <span class="hljs-selector-tag">a</span> plan <span class="hljs-selector-tag">to</span> write <span class="hljs-selector-tag">a</span> blog <span class="hljs-selector-tag">article</span> about my local claude workflow <span class="hljs-selector-tag">to</span> write blog articles. <span class="hljs-selector-tag">I</span> want <span class="hljs-selector-tag">to</span> highlight the steps where <span class="hljs-selector-tag">I</span> use the workflow.

Write the <span class="hljs-selector-tag">article</span> by following the workflow and capturing screenshots and text commands at each step.

Add <span class="hljs-selector-tag">a</span> detail that <span class="hljs-selector-tag">I</span> am running "hugo serve" in another terminal window.

When the plan is done, write it <span class="hljs-selector-tag">to</span> <span class="hljs-selector-tag">a</span> local file under ./specs/
</code></pre>
<p>ä»¥åŠè¾“å‡ºï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">âº Perfect! I<span class="hljs-comment">'ve created a comprehensive plan for your Claude workflow blog article at specs/claude-workflow-blog-plan.md.</span>

The plan includes:

<span class="hljs-number">10</span> detailed workflow steps <span class="hljs-keyword">from</span> initial setup <span class="hljs-keyword">to</span> post-publication monitoring, <span class="hljs-keyword">with</span> <span class="hljs-keyword">each</span> <span class="hljs-keyword">step</span> covering:
- Specific content <span class="hljs-keyword">to</span> write
- Exact commands <span class="hljs-keyword">to</span> capture/demonstrate
- Screenshots needed at <span class="hljs-keyword">each</span> stage

<span class="hljs-keyword">Key</span> features <span class="hljs-keyword">of</span> the plan:
- Shows the dual-terminal approach (Hugo server running + Claude work terminal)
- Documents authentic workflow <span class="hljs-keyword">with</span> real commands <span class="hljs-built_in">and</span> outputs
- Includes proper screenshot organization <span class="hljs-built_in">and</span> naming
- Follows your existing blog <span class="hljs-keyword">structure</span> <span class="hljs-built_in">and</span> commit message standards
- Balances technical detail <span class="hljs-keyword">with</span> engaging storytelling

The plan <span class="hljs-built_in">is</span> designed <span class="hljs-keyword">to</span> create a <span class="hljs-number">1500</span>-<span class="hljs-number">2000</span> word article that authentically demonstrates how you use Claude Code <span class="hljs-keyword">for</span> blog writing <span class="hljs-keyword">while</span> providing actionable guidance <span class="hljs-keyword">for</span> readers.

<span class="hljs-keyword">Each</span> <span class="hljs-keyword">step</span> builds naturally <span class="hljs-keyword">on</span> the previous one, showing the complete journey <span class="hljs-keyword">from</span> idea <span class="hljs-keyword">to</span> published post.

You can now follow this plan <span class="hljs-keyword">step</span>-<span class="hljs-keyword">by</span>-<span class="hljs-keyword">step</span> <span class="hljs-keyword">to</span> write the actual blog article, capturing real screenshots <span class="hljs-built_in">and</span> command outputs <span class="hljs-keyword">as</span> you go through your genuine workflow!
</code></pre>
<p>å½“æˆ‘è¦æ±‚Claudeè§„åˆ’è¿™ç¯‡åšå®¢æ–‡ç« æ—¶å‘ç”Ÿäº†ä»€ä¹ˆï¼š</p>
<p>Claudeç«‹å³åˆ›å»ºäº†ä¸€ä¸ªç»“æ„åŒ–çš„ä»»åŠ¡åˆ—è¡¨ï¼š</p>
<ul>
<li>æ’°å†™å…³äºClaude + Hugoå·¥ä½œæµç¨‹çš„å¼•äººå…¥èƒœçš„ä»‹ç»</li>
<li>è®°å½•åŒç»ˆç«¯è®¾ç½®è¿‡ç¨‹</li>
<li>è§£é‡ŠClaudeçš„è§„åˆ’å’Œç ”ç©¶èƒ½åŠ›</li>
<li>å±•ç¤ºåä½œå†…å®¹åˆ›å»ºè¿‡ç¨‹</li>
<li>è®°å½•æµ‹è¯•å’Œé¢„è§ˆå·¥ä½œæµç¨‹</li>
<li>æ¶µç›–éƒ¨ç½²å’Œç›‘æ§æ­¥éª¤</li>
<li>æ’°å†™å¸¦æœ‰å¥½å¤„å’Œå»ºè®®çš„ç»“è®º</li>
</ul>
<p>è¿™ä¸ªè§„åˆ’é˜¶æ®µæœ‰ä¸¤ä¸ªç›®çš„ï¼š</p>
<ul>
<li><strong>åˆ†è§£å¤æ‚æ€§</strong> - å†™ä½œå˜æˆä¸€ç³»åˆ—è¾ƒå°çš„ã€å¯ç®¡ç†çš„ä»»åŠ¡</li>
<li><strong>ä¿æŒä¸“æ³¨</strong> - æ¯ä¸ªä»»åŠ¡éƒ½æœ‰æ˜ç¡®çš„ç›®æ ‡ï¼Œé˜²æ­¢"èŒƒå›´è”“å»¶"</li>
</ul>
<p>TodoWriteå·¥å…·è¿˜å®æ—¶è·Ÿè¸ªè¿›åº¦ï¼Œæ˜¾ç¤ºå·²å®Œæˆã€è¿›è¡Œä¸­å’Œå¾…å¤„ç†çš„ä»»åŠ¡ã€‚è¿™å°±åƒåœ¨å†™ä½œè¿‡ç¨‹ä¸­å†…ç½®äº†ä¸€ä¸ªç†Ÿç»ƒçš„é¡¹ç›®ç»ç†ã€‚</p>
<p>Claudeç”Ÿæˆè®¡åˆ’åï¼Œæˆ‘å®¡æŸ¥å¹¶ç¼–è¾‘å®ƒï¼Œç„¶åè¦æ±‚Claudeé‡æ–°åŠ è½½æœ€ç»ˆç‰ˆæœ¬ï¼Œç¡®ä¿å®ƒä»æ­£ç¡®çš„è“å›¾å¼€å§‹å·¥ä½œã€‚</p>
<h2 data-id="heading-8">ç¬¬2æ­¥ï¼šç ”ç©¶å’Œä¸Šä¸‹æ–‡æ”¶é›†</h2>
<p>Claude Codeæ“…é•¿ä»å¤šä¸ªæ¥æºæ”¶é›†ä¸Šä¸‹æ–‡ï¼Œä½¿ç ”ç©¶æ„Ÿè§‰ä¸åƒè€ƒå¤å­¦ï¼Œæ›´åƒåä½œã€‚å¯¹äºè¿™ç¯‡åšå®¢æ–‡ç« ï¼Œæˆ‘æ¼”ç¤ºäº†å‡ ä¸ªå…³é”®çš„ç ”ç©¶æ–¹æ³•ï¼š</p>
<h3 data-id="heading-9">æŒ–æ˜ç°æœ‰å†…å®¹</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä½¿ç”¨Claudeçš„Grepå·¥å…·æœç´¢æˆ‘å¤šå¹´çš„åšå®¢å†…å®¹ä»¥å¯»æ‰¾ç›¸å…³ä¸»é¢˜ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">âº ğŸ” <span class="hljs-keyword">Step</span> <span class="hljs-number">3</span>: Content Research <span class="hljs-built_in">and</span> Context Gathering

Now <span class="hljs-keyword">let</span><span class="hljs-comment">'s demonstrate Claude's research capabilities and how I leverage existing blog content for context.</span>

First, <span class="hljs-keyword">let</span><span class="hljs-comment">'s search for existing content related to workflows or AI:</span>

âº Search(pattern: <span class="hljs-string">"workflow|AI|automation|tool"</span>, path: <span class="hljs-string">"content/post"</span>)
â¿  Found <span class="hljs-number">67</span> files (ctrl+r <span class="hljs-keyword">to</span> expand)

âº Great! <span class="hljs-keyword">Let</span><span class="hljs-comment">'s look at some relevant posts that might provide context:</span>

âº Read(<span class="hljs-string">"content/post/we-finally-care-about-context/index.md"</span>)
â¿  Read <span class="hljs-number">10</span> lines (ctrl+r <span class="hljs-keyword">to</span> expand)

âº Read(<span class="hljs-string">"content/post/answers-chat-bot-for-your-wordpress-blog/index.md"</span>)
â¿  Read <span class="hljs-number">15</span> lines (ctrl+r <span class="hljs-keyword">to</span> expand)

âº Now <span class="hljs-keyword">let</span><span class="hljs-comment">'s demonstrate searching for more specific content:</span>

âº Bash(<span class="hljs-string">"find content/post -name \"</span>*.md\<span class="hljs-string">" | head -10"</span>)
â¿  content/post/the-weapon-<span class="hljs-keyword">by</span>-fredric-brown/index.md
     content/post/agile-vs-economic-downturns/index.md
     content/post/barcampphilly-was-a-success/index.md
     â€¦ +<span class="hljs-number">9</span> lines (ctrl+r <span class="hljs-keyword">to</span> expand)
</code></pre>
<p>è¿™æ­ç¤ºäº†ç›¸å…³æ–‡ç« ï¼Œå¦‚"æˆ‘ä»¬ç»ˆäºå…³å¿ƒä¸Šä¸‹æ–‡äº†"å’Œ"ä½ çš„WordPressåšå®¢çš„ç­”æ¡ˆèŠå¤©æœºå™¨äºº" - ä¸ºæˆ‘ä¹‹å‰å¯¹AIå’Œè‡ªåŠ¨åŒ–çš„æ€è€ƒæä¾›äº†å®è´µçš„ä¸Šä¸‹æ–‡ã€‚</p>
<h3 data-id="heading-10">å½“å‰ä¿¡æ¯çš„ç½‘ç»œç ”ç©¶</h3>
<p>ç”±äºAIå·¥å…·å‘å±•è¿…é€Ÿï¼Œæˆ‘è®©Claudeè¿›è¡Œç½‘ç»œç ”ç©¶ä»¥è·å–2025å¹´å…³äºClaude Codeå·¥ä½œæµç¨‹çš„æœ€æ–°ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">âº Now <span class="hljs-keyword">let</span> <span class="hljs-keyword">me</span> demonstrate <span class="hljs-keyword">using</span> Claude<span class="hljs-comment">'s web research capabilities by looking up current information about Claude Code:</span>

âº Web Search(<span class="hljs-string">"Claude Code AI assistant blog writing workflow 2025"</span>)
â¿  Did <span class="hljs-number">1</span> search <span class="hljs-keyword">in</span> <span class="hljs-number">29s</span>
</code></pre>
<p>ç ”ç©¶æ˜¾ç¤ºClaude Codeå·²ç»æ˜¾è‘—å‘å±•ï¼Œå¼€å‘äººå‘˜æŠ¥å‘Š"æ— è®ºå¤æ‚æ€§å¦‚ä½•ï¼Œ30-45åˆ†é’Ÿå†…å®Œæˆé¡¹ç›®"å’Œåƒå·¥ä½œæµç¨‹è‡ªåŠ¨åŒ–çš„é’©å­è¿™æ ·çš„æ–°åŠŸèƒ½ã€‚</p>
<pre><code class="hljs language-vbnet" lang="vbnet">âº Perfect! This demonstrates multiple research capabilities
This <span class="hljs-keyword">step</span> demonstrates Claude<span class="hljs-comment">'s research capabilities:</span>
- Searching existing content <span class="hljs-keyword">using</span> Grep <span class="hljs-built_in">and</span> Bash tools <span class="hljs-keyword">to</span> find relevant past articles
- Web research <span class="hljs-keyword">using</span> WebSearch <span class="hljs-keyword">to</span> <span class="hljs-keyword">get</span> current information about Claude Code
- Context synthesis combining multiple information sources <span class="hljs-keyword">to</span> inform the writing process
- Knowledge integration connecting <span class="hljs-built_in">new</span> research <span class="hljs-keyword">with</span> existing blog content patterns
</code></pre>
<p>å…³äºè¿™ä¸ªé˜¶æ®µçš„æœ‰è¶£ä¹‹å¤„åœ¨äºï¼Œæˆ‘æ²¡æœ‰è¦æ±‚Claudeåšä»»ä½•å¤–éƒ¨ç ”ç©¶ã€‚æˆ‘ä¿ç•™è¿™éƒ¨åˆ†æ˜¯å› ä¸ºæˆ‘çš„æœ‹å‹Claudeä¼¼ä¹å¯¹è¿™ä¸ªèƒ½åŠ›æ„Ÿåˆ°è‡ªè±ªï¼Œæˆ‘ä¸æƒ³è®©å®ƒæ„Ÿåˆ°è¢«å¿½è§†ã€‚</p>
<h3 data-id="heading-11">ä¸Šä¸‹æ–‡ç»¼åˆ</h3>
<p>é­”æ³•å‘ç”Ÿæ—¶æ˜¯Claudeå°†å†å²ä¸Šä¸‹æ–‡ï¼ˆä½ çš„ç°æœ‰å†…å®¹ï¼‰ä¸å½“å‰ç ”ç©¶ï¼ˆç½‘ç»œå‘ç°ï¼‰ç»“åˆèµ·æ¥ï¼Œä¸ºå†™ä½œè¿‡ç¨‹æä¾›ä¿¡æ¯ã€‚è¿™ä¸ä»…ä»…æ˜¯ä¿¡æ¯æ”¶é›† - å®ƒæ˜¯æ™ºèƒ½çš„ä¸Šä¸‹æ–‡ç¼–ç»‡ï¼Œç¡®ä¿æ–°å†…å®¹ä¸ä½ çš„ç°æœ‰ä½œå“è‡ªç„¶èåˆï¼ŒåŒæ—¶èå…¥æœ€æ–°å‘å±•ã€‚</p>
<h2 data-id="heading-12">ç¬¬3æ­¥ï¼šåä½œå†™ä½œè¿‡ç¨‹</h2>
<p>è¿™é‡Œå˜å¾—å…ƒäº† - æˆ‘å®é™…ä¸Šæ˜¯åœ¨æ¼”ç¤ºåä½œè¿‡ç¨‹æœ¬èº«æ—¶å†™è¿™ä¸€éƒ¨åˆ†ã€‚ä½ ç°åœ¨è¯»çš„å†…å®¹æ˜¯é€šè¿‡äººç±»æŒ‡å¯¼ä¸AIååŠ©ä¹‹é—´çš„è¿­ä»£ä¹‹èˆå†™æˆçš„ã€‚</p>
<h3 data-id="heading-13">Editå·¥å…·çš„å®é™…åº”ç”¨</h3>
<p>Claudeä¸é‡å†™æ•´ä¸ªç« èŠ‚ï¼Œè€Œæ˜¯ä½¿ç”¨æœ‰é’ˆå¯¹æ€§çš„ç¼–è¾‘æ¥æ‰©å±•å’Œæ”¹è¿›å†…å®¹ã€‚ä¾‹å¦‚ï¼Œç»†å¿ƒçš„è¯»è€…ä¼šæ³¨æ„åˆ°Claudeæœ€åˆè®¡åˆ’å†™æˆ‘çš„"åŒç»ˆç«¯"å·¥ä½œæµç¨‹ã€‚è¯»åˆ°é‚£ç‚¹æ—¶æˆ‘æ„è¯†åˆ°å®ƒä¸æˆ‘çš„å±å¹•ä¸åŒ¹é…ï¼Œæˆ‘å®é™…ä¸Šæœ‰å››ä¸ªçª—å£åœ¨è¿è¡Œã€‚æ‰€ä»¥æˆ‘å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-css" lang="css">Change the setup <span class="hljs-selector-tag">from</span> <span class="hljs-selector-tag">a</span> "Dual Terminal Workflow" <span class="hljs-selector-tag">to</span> <span class="hljs-selector-tag">a</span> <span class="hljs-number">4</span> window workflow. Highlight the same two terminals, but add the vscode editor (where <span class="hljs-selector-tag">I</span> make live updates and review claude's changes) as well as <span class="hljs-selector-tag">a</span> live reload browser set <span class="hljs-selector-tag">to</span> mobile emulation
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4ccb01473b74ab2a8ae2027f5974b75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763821149&amp;x-signature=78KyzOivKQyINaStf5bfF08izCA%3D" alt="" loading="lazy"/></p>
<p>æµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°æ˜¾ç¤ºæ–°å†…å®¹æ­£åœ¨è¢«å†™å…¥</p>
<h3 data-id="heading-14">å®æ—¶åé¦ˆå¾ªç¯</h3>
<p>åœ¨åå°è¿è¡Œçš„HugoæœåŠ¡å™¨æ„å‘³ç€æˆ‘å¯ä»¥ç«‹å³çœ‹åˆ°æ›´æ”¹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0da2ff7918d4e82912eb7e5acff66d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763821149&amp;x-signature=6MPkdv%2FgBIJdJ4Hl2bInM00QlDc%3D" alt="" loading="lazy"/></p>
<p>æµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°æ˜¾ç¤ºæ–°å†…å®¹æ­£åœ¨è¢«å†™å…¥</p>
<h3 data-id="heading-15">äººæœºä¼™ä¼´å…³ç³»</h3>
<p>è¿™ä¸æ˜¯Claude<strong>ä¸º</strong>æˆ‘å†™ä½œ - è€Œæ˜¯Claude<strong>ä¸</strong>æˆ‘ä¸€èµ·å†™ä½œã€‚æˆ‘æä¾›ï¼š</p>
<ul>
<li><strong>æ–¹å‘å’Œå£°éŸ³</strong> - "è®©è¿™éƒ¨åˆ†æ›´å¯¹è¯åŒ–"æˆ–"åœ¨è¿™é‡Œæ·»åŠ ä¸€ä¸ªæŠ€æœ¯ä¾‹å­"</li>
<li><strong>å†…å®¹ä¸“ä¸šçŸ¥è¯†</strong> - æˆ‘çš„å†™ä½œç»éªŒå’Œç‰¹å®šçŸ¥è¯†</li>
<li><strong>è´¨é‡æ§åˆ¶</strong> - å®¡æŸ¥æ¯ä¸ªæ›´æ”¹ä»¥ç¡®ä¿å®ƒç¬¦åˆæˆ‘çš„é£æ ¼å’Œæ„å›¾</li>
<li><strong>æœ€ç»ˆç‰ˆæœ¬</strong> - æˆ‘é€šå¸¸é‡å†™æˆ–é‡å†™è¿™äº›é¡µé¢ä¸Šçš„å¤§éƒ¨åˆ†å†…å®¹ã€‚å¸Œæœ›ä½ ç°åœ¨ç›¸ä¿¡æˆ‘æ­£åœ¨å†™è¿™ä¸ªå¥å­ï¼Œä½†æœªæ¥çš„å·¥ä½œæµç¨‹å°†æœ‰Claudeåœ¨æˆ‘çš„ä¸ªäººé£æ ¼ä¸Šè®­ç»ƒï¼Œæ‰€ä»¥è¿™ä¸ªåŒºåˆ«å¯èƒ½å˜å¾—æ›´åŠ æ¨¡ç³Šã€‚</li>
</ul>
<p>Claudeæä¾›ï¼š</p>
<ul>
<li><strong>ç»“æ„å’Œæµç¨‹</strong> - å°†æ€æƒ³ç»„ç»‡æˆè¿è´¯çš„ç« èŠ‚</li>
<li><strong>ç ”ç©¶ç»¼åˆ</strong> - å°†æ¥è‡ªå¤šä¸ªæ¥æºçš„ä¿¡æ¯ç¼–ç»‡åœ¨ä¸€èµ·</li>
<li><strong>è‰ç¨¿åŠ é€Ÿ</strong> - å°†ç²—ç•¥çš„æƒ³æ³•è½¬åŒ–ä¸ºç²¾ç‚¼çš„æ•£æ–‡</li>
<li><strong>ä¸€è‡´æ€§</strong> - åœ¨é•¿ç¯‡æ–‡ç« ä¸­ä¿æŒè¯­è°ƒå’Œé£æ ¼</li>
</ul>
<h3 data-id="heading-16">è¿­ä»£è¿‡ç¨‹</h3>
<p>å†™ä½œå˜æˆå¯¹è¯ï¼š</p>
<ul>
<li><strong>äººç±»</strong>ï¼š"æ‰©å±•ç ”ç©¶æ–¹æ³•éƒ¨åˆ†"</li>
<li><strong>Claude</strong>ï¼šæ·»åŠ å¸¦æœ‰ç¤ºä¾‹å’Œæˆªå›¾çš„è¯¦ç»†å†…å®¹</li>
<li><strong>äººç±»</strong>ï¼šé˜…è¯»å¹¶ç¼–è¾‘AIå†™çš„å†…å®¹</li>
<li><strong>äººç±»</strong>ï¼š"è¿™æ„Ÿè§‰å¤ªæŠ€æœ¯åŒ–äº† - è®©å®ƒæ›´æ˜“ç†è§£"</li>
<li><strong>Claude</strong>ï¼šä¿®æ”¹è¯­è¨€å¹¶æ·»åŠ ç±»æ¯”</li>
<li><strong>äººç±»</strong>ï¼šé˜…è¯»å¹¶ç¼–è¾‘AIå†™çš„å†…å®¹</li>
</ul>
<p>è¿™ç§æ¥å›ç»§ç»­ï¼Œç›´åˆ°å†…å®¹æ„Ÿè§‰åˆé€‚ã€‚è¿™æ˜¯åä½œç¼–è¾‘çš„æœ€ä½³çŠ¶æ€ã€‚</p>
<p>å¦‚æœä½ åœ¨Claudeçš„Editå·¥å…·ä¹‹å¤–ç›´æ¥å¯¹æ–‡ä»¶è¿›è¡Œç¼–è¾‘ï¼Œè®©Claudeé‡æ–°åŠ è½½æ–‡ä»¶ä»¥ç¡®ä¿å®ƒæœ‰æœ€æ–°ç‰ˆæœ¬æ˜¯ä¸€ä¸ªå¥½çš„åšæ³•ã€‚</p>
<h2 data-id="heading-17">ç¬¬4æ­¥ï¼šé€‰æ‹©æ ‡é¢˜å›¾åƒ</h2>
<p>åœ¨å‘å¸ƒä¹‹å‰ï¼Œæ¯ç¯‡åšå®¢æ–‡ç« éƒ½éœ€è¦ä¸€ä¸ªå¼•äººæ³¨ç›®çš„æ ‡é¢˜å›¾åƒã€‚Claude Codeä¸Unsplashçš„é›†æˆä½¿æ‰¾åˆ°å®Œç¾çš„å›¾åƒå˜å¾—ç®€å•ï¼Œå¹¶ç¡®ä¿é€‚å½“çš„å½’å±ã€‚</p>
<h3 data-id="heading-18">ä½¿ç”¨Unsplashé›†æˆæŸ¥æ‰¾å›¾åƒ</h3>
<p>å¯¹äºè¿™ç¯‡å…³äºAIè¾…åŠ©å†™ä½œçš„åšå®¢æ–‡ç« ï¼Œæˆ‘æœç´¢äº†èƒ½å¤Ÿæ•æ‰å·¥ä½œæµç¨‹æœ¬è´¨çš„å›¾åƒï¼š</p>
<pre><code class="hljs language-css" lang="css">find <span class="hljs-selector-tag">a</span> retro scifi image of <span class="hljs-selector-tag">a</span> helpful robot writer, preferably <span class="hljs-selector-tag">from</span> the pulp era
</code></pre>
<p>Claudeçš„Unsplashæœç´¢è¿”å›äº†å‡ ä¸ªé€‰é¡¹ï¼ŒåŒ…æ‹¬å¤å¤é£æ ¼çš„æœºå™¨äººå’Œæœªæ¥ä¸»ä¹‰çš„å†™ä½œåœºæ™¯ã€‚å®ƒè®¤ä¸ºé€‰æ‹©çš„å›¾åƒå®Œç¾åœ°æ•æ‰äº†åä½œçš„äººæœºå†™ä½œä¸»é¢˜ã€‚</p>
<pre><code class="hljs language-vbnet" lang="vbnet">âº I<span class="hljs-comment">'ll help you find a retro sci-fi image of a helpful robot writer from the pulp era using Unsplash.</span>

âº unsplash - search_photos (MCP)(query: <span class="hljs-string">"retro robot writer typewriter vintage sci-fi"</span>, per_page: <span class="hljs-number">5</span>)
â¿  âš  Large MCP response (~<span class="hljs-number">14.0</span>k tokens), this can fill up context
â¿  Found <span class="hljs-number">2400</span> photos (page <span class="hljs-number">1</span>/<span class="hljs-number">480</span>)

âº These are great vintage typewriter images, but I notice they<span class="hljs-comment">'re actual typewriters rather than robots. Let me try a more specific search for retro sci-fi robots or pulp era illustrations:</span>

âº unsplash - search_photos (MCP)(query: <span class="hljs-string">"pulp sci-fi robot illustration vintage"</span>, per_page: <span class="hljs-number">3</span>)
â¿  Found <span class="hljs-number">2400</span> photos (page <span class="hljs-number">1</span>/<span class="hljs-number">800</span>):
â¿  {
       <span class="hljs-string">"id"</span>: <span class="hljs-string">"kvX8IkD4OmQ"</span>,
       <span class="hljs-string">"slug"</span>: <span class="hljs-string">"black-and-gray-bicycle-with-stand-kvX8IkD4OmQ"</span>,
     â€¦ +<span class="hljs-number">120</span> lines (ctrl+r <span class="hljs-keyword">to</span> expand)
  â¿  [Image]
  â¿  {
       <span class="hljs-string">"id"</span>: <span class="hljs-string">"F799HJMu0kY"</span>,
       <span class="hljs-string">"slug"</span>: <span class="hljs-string">"gray-and-blue-robot-toy-F799HJMu0kY"</span>,
     â€¦ +<span class="hljs-number">117</span> lines (ctrl+r <span class="hljs-keyword">to</span> expand)
...

âº Perfect! I found some great options. The second image <span class="hljs-keyword">with</span> the gray <span class="hljs-built_in">and</span> blue robot toy <span class="hljs-built_in">is</span> perfect - it has a retro, helpful robot aesthetic that would work great <span class="hljs-keyword">as</span> a featured image <span class="hljs-keyword">for</span> your blog post. The third image <span class="hljs-keyword">of</span> the Tin Man <span class="hljs-keyword">from</span> Wizard <span class="hljs-keyword">of</span> Oz also has a nice vintage robot feel.

<span class="hljs-keyword">For</span> your blog post, I<span class="hljs-comment">'d recommend the gray and blue robot toy (image #2) as it:</span>
- Has a friendly, helpful appearance
- Retro sci-fi aesthetic without being too vintage/pulp
- Clean composition that would work well <span class="hljs-keyword">as</span> a featured image

&gt; yes use #<span class="hljs-number">2</span>

âº Perfect! Now <span class="hljs-keyword">let</span><span class="hljs-comment">'s update the blog post front matter to use the correct image filename:</span>

âº Update(<span class="hljs-string">"content/post/streamlining-blog-writing-with-claude-code/index.md"</span>)
â¿  Updated

âº Excellent! The image downloaded successfully (<span class="hljs-number">126</span>k file size). Now <span class="hljs-keyword">let</span><span class="hljs-comment">'s test how it looks in the Hugo server by checking if it's accessible:</span>
...

âº Perfect! Your blog post <span class="hljs-built_in">is</span> now complete <span class="hljs-keyword">with</span>:
</code></pre>
<h3 data-id="heading-19">è‡ªåŠ¨å½’å±å¤„ç†</h3>
<p>æˆ‘è®¾ç½®Claudeçš„Unsplashé›†æˆçš„æœ€ä½³åŠŸèƒ½ä¹‹ä¸€æ˜¯è‡ªåŠ¨å½’å±å¤„ç†ã€‚å½“ä½ é€‰æ‹©å›¾åƒæ—¶ï¼ŒClaudeä»¥é€‚å½“çš„markdownæ ¼å¼æä¾›å®Œæ•´çš„å½’å±æ–‡æœ¬ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Photo by <span class="hljs-section">[Johnny Briggs]</span>(https://unsplash.com/@johnnyboylee?<span class="hljs-attr">utm_content</span>=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash) <span class="hljs-literal">on</span> [Unsplash](https://unsplash.com/photos/black-typewriter-<span class="hljs-literal">on</span>-brown-wooden-table-Q2sI-omncsk?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash)
</code></pre>
<p>è¿™ç¡®ä¿å¯¹æ‘„å½±å¸ˆçš„é€‚å½“è®¤å¯ï¼ŒåŒæ—¶éµå®ˆUnsplashçš„æœåŠ¡æ¡æ¬¾ã€‚å›¾åƒä¼šè‡ªåŠ¨ä¸‹è½½åˆ°ä½ çš„æ–‡ç« ç›®å½•ï¼Œå¹¶å¸¦æœ‰é€‚å½“çš„æ–‡ä»¶åã€‚</p>
<h3 data-id="heading-20">ä¸Hugo Front matterçš„é›†æˆ</h3>
<p>é€‰æ‹©çš„å›¾åƒä¸Hugoçš„front matteræ— ç¼é›†æˆï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">cover:
  image: <span class="hljs-string">"featured-image.jpg"</span>
  alt: <span class="hljs-string">"Modern workspace with laptop and coffee representing AI-assisted writing workflow"</span>
  caption: <span class="hljs-string">"The modern writer's setup: Where human creativity meets AI assistance"</span>
</code></pre>
<p>è¿™ç§æ–¹æ³•ç¡®ä¿ä½ çš„åšå®¢æ–‡ç« æœ‰ä¸“ä¸šçš„ã€åˆæ³•åˆè§„çš„å›¾åƒï¼Œå¢å¼ºå†…å®¹è€Œä¸æ˜¯åˆ†æ•£æ³¨æ„åŠ›ã€‚</p>
<p>å¦‚æœä½ æ³¨æ„åˆ°è¿™é‡Œä½¿ç”¨çš„å›¾åƒï¼Œå®ƒ<strong>ä¸æ˜¯</strong>ä¸€ä¸ªç°è‰²å’Œè“è‰²çš„ç©å…·æœºå™¨äººï¼æˆ‘é€šè¿‡Claudeç»å†äº†å‡ å¼ å›¾åƒï¼Œç„¶åæˆ‘è‡ªå·±åšäº†ä¸€ä¸ªæœç´¢ã€‚ClaudeçœŸçš„å¾ˆåŠªåŠ›ï¼Œä½†æœ‰æ—¶æˆ‘åªéœ€è¦è‡ªå·±åšå·¥ä½œå¹¶æä¾›åé¦ˆã€‚</p>
<p>æˆ‘ä¸ªäººä¸å–œæ¬¢AIè‰ºæœ¯ã€‚ä½¿ç”¨é‚£å°†å’Œå‘å¸ƒClaudeåå‡ºçš„è¿™ç¯‡æ–‡ç« çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ä¸€æ ·æ‡’æƒ°å’Œä¸çœŸå®ã€‚å¦‚æœä½ å°Šé‡ä½ çš„å®¢æˆ·ã€è¯»è€…å’Œæ™®é€šäºº - ä¸è¦é‚£ä¹ˆæ‡’æƒ°ã€‚</p>
<p>æœ‰å¾ˆå¤šé«˜è´¨é‡å’Œè‰ºæœ¯æ€§çš„å›¾åƒï¼Œæˆ‘å®æ„¿ç”¨æˆ‘çš„å°åšå®¢é€šè¿‡å½’å±é“¾æ¥å’Œæˆ‘çš„æ„Ÿè°¢æ¥çªå‡ºæŸäººçš„åŠªåŠ›ï¼å¤å¤å°ç¯å’Œè€å¼æ‰“å­—æœºçš„æ ‡é¢˜å›¾åƒæ—¢åœ¨è‰ºæœ¯ä¸Šæœ‰è¶£ï¼Œåˆåœ¨æŠ€æœ¯ä¸Šæ‹æ‘„å¾—å¾ˆå¥½ã€‚</p>
<h2 data-id="heading-21">ç¬¬5æ­¥ï¼šå‘å¸ƒå’Œéƒ¨ç½²</h2>
<p>å·¥ä½œæµç¨‹çš„æœ€åä¸€æ­¥å±•ç¤ºäº†å†…å®¹åˆ›å»ºå’Œéƒ¨ç½²ä¹‹é—´çš„æ— ç¼é›†æˆã€‚ä¸€æ—¦åšå®¢æ–‡ç« å®Œæˆï¼Œå‘å¸ƒéµå¾ªå·²å»ºç«‹çš„Gitå·¥ä½œæµç¨‹ï¼ŒClaudeååŠ©ç›‘æ§ã€‚</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">let</span><span class="hljs-comment">'s publish this!</span>

Commit the current changes, use the github-action agent <span class="hljs-keyword">to</span> watch <span class="hljs-keyword">for</span> the job completion, <span class="hljs-built_in">and</span> <span class="hljs-keyword">then</span> check that version <span class="hljs-built_in">is</span> visible online at its proper url <span class="hljs-built_in">and</span> <span class="hljs-keyword">on</span> the homepage <span class="hljs-keyword">as</span> the most recent post
</code></pre>
<p>Claudeå¤„ç†æ•´ä¸ªéƒ¨ç½²è¿‡ç¨‹ï¼š</p>
<ul>
<li><strong>æš‚å­˜å’Œæäº¤æ‰€æœ‰æ›´æ”¹</strong>ï¼Œä½¿ç”¨é€‚å½“çš„æäº¤æ¶ˆæ¯æ ¼å¼</li>
<li><strong>æ¨é€åˆ°GitHub</strong>ï¼Œè§¦å‘è‡ªåŠ¨éƒ¨ç½²ç®¡é“</li>
<li><strong>ç›‘æ§GitHub Actions</strong>ï¼Œä½¿ç”¨ä¸“é—¨çš„ä»£ç†ç›‘è§†å·¥ä½œæµç¨‹å®Œæˆ</li>
<li><strong>éªŒè¯éƒ¨ç½²çŠ¶æ€</strong>ï¼Œç¡®è®¤è‰ç¨¿è¡Œä¸º</li>
</ul>
<h3 data-id="heading-22">Gitæäº¤æ ‡å‡†</h3>
<p>éµå¾ªCLAUDE.mdæ ‡å‡†ï¼Œæäº¤ä½¿ç”¨ç»“æ„åŒ–æ¶ˆæ¯ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">git</span> <span class="hljs-selector-tag">commit</span> <span class="hljs-selector-tag">-m</span> "<span class="hljs-selector-tag">Add</span> <span class="hljs-selector-tag">comprehensive</span> <span class="hljs-selector-tag">blog</span> <span class="hljs-selector-tag">post</span> <span class="hljs-selector-tag">about</span> <span class="hljs-selector-tag">Claude</span> <span class="hljs-selector-tag">Code</span> <span class="hljs-selector-tag">workflow</span>

<span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">Document</span> <span class="hljs-selector-tag">complete</span> <span class="hljs-number">4</span><span class="hljs-selector-tag">-window</span> <span class="hljs-selector-tag">workflow</span> <span class="hljs-selector-tag">setup</span> <span class="hljs-selector-tag">for</span> <span class="hljs-selector-tag">collaborative</span> <span class="hljs-selector-tag">writing</span>
<span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">Include</span> <span class="hljs-selector-tag">real</span> <span class="hljs-selector-tag">screenshots</span> <span class="hljs-selector-tag">and</span> <span class="hljs-selector-tag">command</span> <span class="hljs-selector-tag">examples</span> <span class="hljs-selector-tag">from</span> <span class="hljs-selector-tag">actual</span> <span class="hljs-selector-tag">process</span>
<span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">Cover</span> <span class="hljs-selector-tag">planning</span>, <span class="hljs-selector-tag">research</span>, <span class="hljs-selector-tag">writing</span>, <span class="hljs-selector-tag">and</span> <span class="hljs-selector-tag">deployment</span> <span class="hljs-selector-tag">phases</span>
<span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">Add</span> <span class="hljs-selector-tag">featured</span> <span class="hljs-selector-tag">image</span> <span class="hljs-selector-tag">with</span> <span class="hljs-selector-tag">proper</span> <span class="hljs-selector-tag">Unsplash</span> <span class="hljs-selector-tag">attribution</span>
<span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">Create</span> <span class="hljs-selector-tag">draft</span> <span class="hljs-selector-tag">version</span> <span class="hljs-selector-tag">for</span> <span class="hljs-selector-tag">review</span> <span class="hljs-selector-tag">before</span> <span class="hljs-selector-tag">publication</span>

ğŸ¤– <span class="hljs-selector-tag">Generated</span> <span class="hljs-selector-tag">with</span> <span class="hljs-selector-attr">[Claude Code]</span>(<span class="hljs-attribute">https</span>:<span class="hljs-comment">//claude.ai/code)</span>

<span class="hljs-attribute">Co-Authored-By</span>: Claude &lt;noreply<span class="hljs-variable">@anthropic</span>.com&gt;"
</code></pre>
<h3 data-id="heading-23">è‡ªåŠ¨éƒ¨ç½²ç®¡é“</h3>
<p>GitHub Actionså·¥ä½œæµç¨‹è‡ªåŠ¨ï¼š</p>
<ul>
<li>ä½¿ç”¨ç‰ˆæœ¬0.146.0æ„å»ºHugoç«™ç‚¹</li>
<li>éƒ¨ç½²åˆ°Azureé™æ€Web Apps</li>
<li>æä¾›éƒ¨ç½²çŠ¶æ€çš„å³æ—¶åé¦ˆ</li>
</ul>
<h3 data-id="heading-24">è‰ç¨¿éªŒè¯</h3>
<p>ClaudeéªŒè¯éƒ¨ç½²ï¼š</p>
<ul>
<li><strong>ä¸»é¡µæ£€æŸ¥</strong>ï¼šâœ… ç¡®è®¤æ–‡ç« ä½œä¸ºæœ€æ–°æ–‡ç« å¯è§</li>
<li><strong>ç›´æ¥URLæ£€æŸ¥</strong>ï¼šâœ… ç¡®è®¤200å“åº”å¹¶æ£€æŸ¥å†…å®¹</li>
<li><strong>éƒ¨ç½²çŠ¶æ€</strong>ï¼šâœ… ç›‘æ§GitHub Actionså®Œæˆ</li>
</ul>
<p>è¿™ç§éªŒè¯ç¡®ä¿å†…å®¹æ˜¯æˆ‘æ‰€æœŸæœ›çš„ã€‚ç”±äºæˆ‘ä¹Ÿä½¿ç”¨BrowserMCPï¼Œæˆ‘å¯ä»¥çœ‹åˆ°æˆ‘çš„æ¡Œé¢æµè§ˆå™¨åŠ è½½é¡µé¢ï¼Œæˆ‘å¯ä»¥åŒé‡æ£€æŸ¥å¸ƒå±€</p>
<pre><code class="hljs language-vbnet" lang="vbnet">âº github-actions-monitor(Monitor publication deployment)
â¿  Done (<span class="hljs-number">14</span> tool uses Â· <span class="hljs-number">75.9</span>k tokens Â· <span class="hljs-number">1</span>m <span class="hljs-number">57.4</span>s)

âº ğŸ‰ Publication Complete!

Your Claude Code workflow blog post <span class="hljs-built_in">is</span> now live <span class="hljs-built_in">and</span> <span class="hljs-keyword">public</span>!

âœ… Deployment Verified:
- GitHub Actions: Successfully deployed commit d6ad816
- Homepage: Shows <span class="hljs-keyword">as</span> the most recent post
- Direct URL: https://www.aaronheld.com/post/streamlining-blog-writing-<span class="hljs-keyword">with</span>-claude-code/ â† LIVE
- Content: All screenshots, formatting, <span class="hljs-built_in">and</span> content displaying perfectly

ğŸ¯ Meta Achievement Unlocked:
This blog post about the Claude Code workflow was created <span class="hljs-keyword">using</span> the exact workflow it describes - <span class="hljs-keyword">from</span> initial planning <span class="hljs-keyword">with</span> TodoWrite, through collaborative writing, <span class="hljs-keyword">to</span> automated deployment <span class="hljs-built_in">and</span> verification. The post serves <span class="hljs-keyword">as</span> both documentation <span class="hljs-built_in">and</span> proof-<span class="hljs-keyword">of</span>-concept!

ğŸ“Š Final Stats:
- Complete workflow demonstrated: Planning â†’ Research â†’ Writing â†’ Publishing
- Real screenshots captured: Showing actual process steps
- Comprehensive guide: <span class="hljs-number">1</span>,<span class="hljs-number">500</span>+ words <span class="hljs-keyword">with</span> technical details
- Live example: The post itself proves the workflow works

Your readers now have a complete, authentic guide <span class="hljs-keyword">to</span> AI-assisted blogging <span class="hljs-keyword">with</span> Claude Code, demonstrated through the very post they<span class="hljs-comment">'re reading!</span>
</code></pre>
<h2 data-id="heading-25">ç»“æœï¼šä¸ºä»€ä¹ˆè¿™ä¸ªå·¥ä½œæµç¨‹æœ‰æ•ˆ</h2>
<p>åœ¨å®æ–½è¿™ä¸ªClaude Code + Hugoå·¥ä½œæµç¨‹åï¼Œå‡ºç°äº†å‡ ä¸ªå…³é”®å¥½å¤„ï¼š</p>
<h3 data-id="heading-26">åœ¨ä¸æŸå¤±è´¨é‡çš„æƒ…å†µä¸‹èŠ‚çœæ—¶é—´</h3>
<p>è¿‡å»éœ€è¦æˆ‘å‡ å¤©å†™ä½œå’Œæ‹–å»¶çš„äº‹æƒ…ç°åœ¨åœ¨å‡ ä¸ªå°æ—¶çš„ä¸“æ³¨åŠªåŠ›ä¸­å‘ç”Ÿã€‚è´¨é‡å®é™…ä¸Š<strong>æé«˜</strong>äº†ã€‚ç ”ç©¶é˜¶æ®µæ›´å½»åº•ï¼Œç»“æ„æ›´æœ‰ç»„ç»‡ï¼Œè¿­ä»£ç¼–è¾‘è¿‡ç¨‹æ•æ‰åˆ°æˆ‘å¯èƒ½é—æ¼çš„é—®é¢˜ã€‚</p>
<h3 data-id="heading-27">å‡å°‘å†™ä½œéšœç¢</h3>
<p>TodoWriteè§„åˆ’é˜¶æ®µæ¶ˆé™¤äº†ç©ºç™½é¡µé¢é—®é¢˜ã€‚ä¸æ˜¯ç›¯ç€ç©ºæ–‡æ¡£æƒ³çŸ¥é“ä»å“ªé‡Œå¼€å§‹ï¼Œæˆ‘æœ‰ä¸€ä¸ªå®Œæˆç‰¹å®šä»»åŠ¡çš„æ¸…æ™°è·¯çº¿å›¾ã€‚</p>
<h3 data-id="heading-28">æ›´å¥½çš„ç ”ç©¶é›†æˆ</h3>
<p>Claudeèƒ½å¤Ÿå¿«é€Ÿæœç´¢æˆ‘çš„ç°æœ‰å†…å®¹å¹¶æ‹‰å…¥å½“å‰ç½‘ç»œç ”ç©¶ï¼Œæ„å‘³ç€æˆ‘çš„æ–‡ç« ä¿¡æ¯æ›´å……åˆ†ï¼Œä¸æˆ‘æ›´å¹¿æ³›çš„ä½œå“è”ç³»æ›´ç´§å¯†ã€‚æ³¨æ„ï¼šå¯¹äºæ›´æ·±å…¥çš„ç ”ç©¶ï¼Œæ¯”å¦‚æˆ‘å…³äºæ•æ·å’Œç»æµè¡°é€€çš„å¸–å­ï¼Œæˆ‘ä¿®æ”¹è¿™ä¸ªå·¥ä½œæµç¨‹ã€‚æˆ‘é¦–å…ˆåˆ›å»ºä¸€ä¸ªç©ºç™½å¸–å­å¹¶åœ¨Geminiä¸­è¿›è¡Œç ”ç©¶ã€‚ä¸€æ—¦æˆ‘æœ‰è‰ç¨¿ï¼Œæˆ‘å°†å…¶ç²˜è´´åˆ°VS Codeå¹¶ç»§ç»­è¿­ä»£ï¼Œä½¿ç”¨Claudeå¯»æ‰¾éAIç”Ÿæˆçš„å›¾åƒç­‰ä»»åŠ¡ã€‚</p>
<h3 data-id="heading-29">çœŸå®çš„åä½œ</h3>
<p>è¿™ä¸æ˜¯AIå–ä»£äººç±»åˆ›é€ åŠ› - è€Œæ˜¯AIæ”¾å¤§å®ƒã€‚æˆ‘çš„å£°éŸ³ã€ä¸“ä¸šçŸ¥è¯†å’Œç¼–è¾‘åˆ¤æ–­ä»ç„¶æ˜¯è¿‡ç¨‹çš„æ ¸å¿ƒã€‚Claudeå¤„ç†æœºæ¢°æ–¹é¢ï¼Œè€Œæˆ‘ä¸“æ³¨äºåˆ›æ„å’Œæˆ˜ç•¥å…ƒç´ ã€‚</p>
<h2 data-id="heading-30">å¼€å§‹ï¼šä½ çš„ä¸‹ä¸€æ­¥</h2>
<p>å¦‚æœä½ æƒ³è‡ªå·±å°è¯•è¿™ä¸ªå·¥ä½œæµç¨‹ï¼š</p>
<ul>
<li><strong>ä»Claude Codeå¼€å§‹</strong> - ç†Ÿæ‚‰TodoWriteã€Editå’Œç ”ç©¶å·¥å…·</li>
<li><strong>è®¾ç½®ä½ çš„ç¯å¢ƒ</strong> - HugoæœåŠ¡å™¨ï¼ˆæˆ–ä½ çš„é™æ€ç”Ÿæˆå™¨ï¼‰+ Claudeå·¥ä½œç©ºé—´</li>
<li><strong>ä»è§„åˆ’å¼€å§‹</strong> - è®©Claudeå°†ä½ çš„ä¸‹ä¸€ä¸ªå†™ä½œé¡¹ç›®åˆ†è§£ä¸ºå¯ç®¡ç†çš„ä»»åŠ¡</li>
<li><strong>å°è¯•ç ”ç©¶é˜¶æ®µ</strong> - å°è¯•å°†ç°æœ‰å†…å®¹æœç´¢ä¸ç½‘ç»œç ”ç©¶ç»“åˆèµ·æ¥</li>
<li><strong>æ‹¥æŠ±è¿­ä»£è¿‡ç¨‹</strong> - ä¸è¦æœŸæœ›ç¬¬ä¸€ç¨¿å°±å®Œç¾ï¼›è®©åä½œæ¼”è¿›</li>
</ul>
<p>å†…å®¹åˆ›å»ºçš„æœªæ¥ä¸æ˜¯å…³äºAIå–ä»£å†™ä½œè€… - è€Œæ˜¯å…³äºAIè®©å†™ä½œæ›´é«˜æ•ˆã€æ›´ç ”ç©¶é©±åŠ¨ï¼Œå¦ç‡åœ°è¯´ï¼Œæ›´æœ‰è¶£ã€‚å°è¯•ä¸€ä¸‹ï¼Œä½ å¯èƒ½ä¼šå‘ç°å†™ä½œå†æ¬¡å˜å¾—æ„‰å¿«ã€‚</p>
<p>æˆ‘ä¼šåœ¨æœªæ¥çš„å¸–å­ä¸­è¯¦ç»†ä»‹ç»æˆ‘çš„è®¾ç½®ã€‚æˆ‘å¤§é‡åˆ©ç”¨å‡ ä¸ªMCPå’ŒClaudeçš„å­ä»£ç†æ¥é«˜æ•ˆä½¿ç”¨ä¸Šä¸‹æ–‡ã€‚æˆ‘å›´ç»•å¤šæ­¥éª¤ä¸Šä¸‹æ–‡æ–‡ä»¶çš„å¾ˆå¤šæ€è€ƒéƒ½æ˜¯å…³äºå†…å­˜ç®¡ç†å’Œä¿æŒä»¤ç‰Œä½¿ç”¨ä¼˜åŒ–ã€‚è¿™ä¸ªå·¥ä½œæµç¨‹åœ¨æˆ‘çš„ä¸“ä¸šè®¡åˆ’ä¸Šè¿è¡Œè‰¯å¥½ï¼ˆåœ¨æœ¬æ–‡æ’°å†™æ—¶20ç¾å…ƒ/æœˆï¼‰</p>
<p>è¿™ç¯‡æ•´ä¸ªåšå®¢æ–‡ç« éƒ½æ˜¯ä½¿ç”¨ä¸Šè¿°ç¡®åˆ‡å·¥ä½œæµç¨‹ç¼–å†™çš„ï¼Œåœ¨å®é™…å†™ä½œè¿‡ç¨‹ä¸­æ•è·äº†çœŸå®çš„æˆªå›¾ã€‚åœ¨ä½¿ç”¨è¿‡ç¨‹çš„åŒæ—¶è®°å½•è¿‡ç¨‹æ˜¯ä¸€ç§æœ‰è¶£çš„å…ƒä½“éªŒï¼Œå› ä¸ºæˆ‘åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¸æ–­è°ƒæ•´è¿‡ç¨‹ã€‚æŒ‰ç…§AIå·¥ä½œæµç¨‹çš„å‘å±•é€Ÿåº¦ï¼Œæˆ‘éœ€è¦æ¯éš”å‡ å‘¨ä¿®æ”¹è¿™ç¯‡æ–‡ç« </p>
<p>å¦‚æœä½ ä¸ºä½ ä¸Šä¸€ä¸ªé¡¹ç›®æ„Ÿåˆ°éª„å‚²ï¼Œé‚£ä¹ˆä½ æ²¡æœ‰å­¦åˆ°ä»»ä½•ä¸œè¥¿ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æˆ‘å¦‚ä½•ä½¿ç”¨æ¯ä¸€ä¸ª Claude Code åŠŸèƒ½]]></title>    <link>https://juejin.cn/post/7572714389922873384</link>    <guid>https://juejin.cn/post/7572714389922873384</guid>    <pubDate>2025-11-15T14:38:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572714389922873384" data-draft-id="7572454929144987683" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æˆ‘å¦‚ä½•ä½¿ç”¨æ¯ä¸€ä¸ª Claude Code åŠŸèƒ½"/> <meta itemprop="keywords" content="Claude"/> <meta itemprop="datePublished" content="2025-11-15T14:38:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜¯é­”ä¸¸å•Š"/> <meta itemprop="url" content="https://juejin.cn/user/3217622495411292"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æˆ‘å¦‚ä½•ä½¿ç”¨æ¯ä¸€ä¸ª Claude Code åŠŸèƒ½
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3217622495411292/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜¯é­”ä¸¸å•Š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T14:38:32.000Z" title="Sat Nov 15 2025 14:38:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.sshh.io%2Fp%2Fhow-i-use-every-claude-code-feature" target="_blank" title="https://blog.sshh.io/p/how-i-use-every-claude-code-feature" ref="nofollow noopener noreferrer">è½¬è½½</a></p>
<p>å…³äºæˆ‘ä½¿ç”¨ Claude Code å„ç§æ–¹å¼çš„å…¨é¢æ€»ç»“ã€‚</p>
<hr/>
<p>æˆ‘ç»å¸¸ä½¿ç”¨ Claude Codeã€‚</p>
<p>ä½œä¸ºä¸šä½™çˆ±å¥½è€…ï¼Œæˆ‘æ¯å‘¨åœ¨è™šæ‹Ÿæœºä¸­è¿è¡Œå¥½å‡ æ¬¡ï¼Œç”¨äºä¸ªäººé¡¹ç›®ï¼Œç»å¸¸ä½¿ç”¨ <code>--dangerously-skip-permissions</code> æ¥éšæ€§ç¼–ç æˆ‘è„‘æµ·ä¸­æƒ³åˆ°çš„ä»»ä½•æƒ³æ³•ã€‚åœ¨å·¥ä½œä¸­ï¼Œæˆ‘å›¢é˜Ÿçš„ä¸€éƒ¨åˆ†ä¸ºæˆ‘ä»¬å·¥ç¨‹å›¢é˜Ÿæ„å»º AI-IDE è§„åˆ™å’Œå·¥å…·ï¼Œæ¯æœˆæ¶ˆè€—æ•°åäº¿ä¸ª token ä»…ç”¨äºä»£ç ç”Ÿæˆã€‚</p>
<p>CLI agent é¢†åŸŸå˜å¾—è¶Šæ¥è¶Šæ‹¥æŒ¤ï¼Œåœ¨ Claude Codeã€Gemini CLIã€Cursor å’Œ Codex CLI ä¹‹é—´ï¼Œæˆ‘è§‰å¾—çœŸæ­£çš„æ¯”èµ›æ˜¯åœ¨ Anthropic å’Œ OpenAI ä¹‹é—´ã€‚ä½†è¯´å®è¯ï¼Œå½“æˆ‘å’Œå…¶ä»–å¼€å‘è€…äº¤è°ˆæ—¶ï¼Œä»–ä»¬çš„é€‰æ‹©å¾€å¾€å½’ç»“ä¸ºçœ‹èµ·æ¥å¾ˆè¡¨é¢çš„ä¸œè¥¿â€”â€”ä¸€ä¸ª"å¹¸è¿"çš„åŠŸèƒ½å®ç°æˆ–è€…ä»–ä»¬åå¥½çš„ç³»ç»Ÿæç¤º"é£æ ¼"ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œè¿™äº›å·¥å…·éƒ½ç›¸å½“ä¸é”™ã€‚æˆ‘ä¹Ÿè§‰å¾—äººä»¬å¾€å¾€è¿‡åº¦å…³æ³¨è¾“å‡ºé£æ ¼æˆ– UIã€‚å¯¹æˆ‘æ¥è¯´ï¼Œ"ä½ å®Œå…¨æ­£ç¡®ï¼"çš„è°„åªšä¸æ˜¯ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„ bugï¼›è¿™æ˜¯ä¸€ä¸ªä¿¡å·ï¼Œè¯´æ˜ä½ å‚ä¸å¾—å¤ªå¤šäº†ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘çš„ç›®æ ‡æ˜¯"å‘å°„åå¿˜è®°"â€”â€”å§”æ‰˜ã€è®¾ç½®ä¸Šä¸‹æ–‡ï¼Œç„¶åè®©å®ƒå·¥ä½œã€‚é€šè¿‡æœ€ç»ˆçš„ PR è€Œä¸æ˜¯è¿‡ç¨‹æ¥è¯„åˆ¤å·¥å…·ã€‚</p>
<p>åšæŒä½¿ç”¨ Claude Code å‡ ä¸ªæœˆåï¼Œè¿™ç¯‡æ–‡ç« æ˜¯æˆ‘å¯¹ Claude Code æ•´ä¸ªç”Ÿæ€ç³»ç»Ÿçš„åæ€ã€‚æˆ‘ä»¬å°†æ¶µç›–æˆ‘ä½¿ç”¨çš„å‡ ä¹æ¯ä¸ªåŠŸèƒ½ï¼ˆåŒæ ·é‡è¦çš„æ˜¯ï¼Œæˆ‘æ²¡æœ‰ä½¿ç”¨çš„åŠŸèƒ½ï¼‰ï¼Œä»åŸºç¡€çš„ CLAUDE.md æ–‡ä»¶å’Œè‡ªå®šä¹‰æ–œæ å‘½ä»¤ï¼Œåˆ°å¼ºå¤§çš„ Subagentsã€Hooks å’Œ GitHub Actions ä¸–ç•Œã€‚è¿™ç¯‡æ–‡ç« æœ‰ç‚¹é•¿ï¼Œæˆ‘å»ºè®®å°†å…¶ä½œä¸ºå‚è€ƒè€Œä¸æ˜¯å®Œæ•´é˜…è¯»çš„å†…å®¹ã€‚</p>
<h2 data-id="heading-0">CLAUDE.md</h2>
<p>åœ¨ä½ çš„ä»£ç åº“ä¸­æœ‰æ•ˆä½¿ç”¨ Claude Code æœ€é‡è¦æ–‡ä»¶æ˜¯æ ¹ç›®å½•ä¸‹çš„ <code>CLAUDE.md</code>ã€‚è¿™ä¸ªæ–‡ä»¶æ˜¯ agent çš„"å®ªæ³•"ï¼Œæ˜¯äº†è§£ä½ çš„ç‰¹å®šå­˜å‚¨åº“å¦‚ä½•å·¥ä½œçš„ä¸»è¦çœŸå®æ¥æºã€‚</p>
<p>ä½ å¦‚ä½•å¤„ç†è¿™ä¸ªæ–‡ä»¶å–å†³äºä¸Šä¸‹æ–‡ã€‚å¯¹äºæˆ‘çš„ä¸šä½™é¡¹ç›®ï¼Œæˆ‘è®© Claude åœ¨å…¶ä¸­å€¾å€’ä»»ä½•å®ƒæƒ³è¦çš„ä¸œè¥¿ã€‚</p>
<p>åœ¨æˆ‘çš„ä¸“ä¸šå·¥ä½œä¸­ï¼Œæˆ‘ä»¬çš„å•ä½“ä»“åº“çš„ <code>CLAUDE.md</code> æ˜¯ä¸¥æ ¼ç»´æŠ¤çš„ï¼Œç›®å‰æœ‰ 13KBï¼ˆæˆ‘å¾ˆå®¹æ˜“çœ‹åˆ°å®ƒå¢é•¿åˆ° 25KBï¼‰ã€‚</p>
<ul>
<li>å®ƒåªè®°å½• 30%ï¼ˆä»»æ„ï¼‰æˆ–æ›´å¤šå·¥ç¨‹å¸ˆä½¿ç”¨çš„å·¥å…·å’Œ APIï¼ˆå…¶ä»–å·¥å…·åœ¨äº§å“æˆ–åº“ç‰¹å®šçš„ markdown æ–‡ä»¶ä¸­è®°å½•ï¼‰</li>
<li>æˆ‘ä»¬ç”šè‡³å¼€å§‹ä¸ºæ¯ä¸ªå†…éƒ¨å·¥å…·çš„æ–‡æ¡£æœ‰æ•ˆåˆ†é…æœ€å¤§ token è®¡æ•°ï¼Œå°±åƒå‘å›¢é˜Ÿå‡ºå”®"å¹¿å‘Šç©ºé—´"ä¸€æ ·ã€‚å¦‚æœä½ ä¸èƒ½ç®€æ´åœ°è§£é‡Šä½ çš„å·¥å…·ï¼Œå®ƒå°±ä¸é€‚åˆæ”¾åœ¨ <code>CLAUDE.md</code> ä¸­ã€‚</li>
</ul>
<h3 data-id="heading-1">æç¤ºå’Œå¸¸è§åæ¨¡å¼</h3>
<p>éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘ä»¬ä¸ºç¼–å†™æœ‰æ•ˆçš„ <code>CLAUDE.md</code> å‘å±•äº†å¼ºçƒˆã€æœ‰è§‚ç‚¹çš„å“²å­¦ã€‚</p>
<ol>
<li>
<p><strong>ä»æŠ¤æ å¼€å§‹ï¼Œè€Œä¸æ˜¯æ‰‹å†Œã€‚</strong> ä½ çš„ <code>CLAUDE.md</code> åº”è¯¥ä»å°å¼€å§‹ï¼ŒåŸºäº Claude å‡ºé”™çš„åœ°æ–¹è¿›è¡Œè®°å½•ã€‚</p>
</li>
<li>
<p><strong>ä¸è¦ @-æ–‡ä»¶æ–‡æ¡£ã€‚</strong> å¦‚æœä½ åœ¨åˆ«å¤„æœ‰å¤§é‡æ–‡æ¡£ï¼Œåœ¨ä½ çš„ <code>CLAUDE.md</code> ä¸­ @-æåŠè¿™äº›æ–‡ä»¶å¾ˆè¯±äººã€‚è¿™ä¼šåœ¨æ¯æ¬¡è¿è¡Œæ—¶é€šè¿‡åµŒå…¥æ•´ä¸ªæ–‡ä»¶æ¥è†¨èƒ€ä¸Šä¸‹æ–‡çª—å£ã€‚ä½†å¦‚æœä½ åªæ˜¯æåŠè·¯å¾„ï¼ŒClaude ç»å¸¸ä¼šå¿½ç•¥å®ƒã€‚ä½ å¿…é¡»å‘ agent æ¨é”€ä¸ºä»€ä¹ˆè¦ä»¥åŠä½•æ—¶è¯»å–æ–‡ä»¶ã€‚"å¯¹äºå¤æ‚â€¦â€¦ä½¿ç”¨æˆ–é‡åˆ° <code>FooBarError</code> æ—¶ï¼Œè¯·å‚é˜… <code>path/to/docs.md</code> ä»¥è·å–é«˜çº§æ•…éšœæ’é™¤æ­¥éª¤ã€‚"</p>
</li>
<li>
<p><strong>ä¸è¦åªè¯´"æ°¸è¿œä¸è¦"ã€‚</strong> é¿å…åƒ"æ°¸è¿œä¸è¦ä½¿ç”¨ <code>--foo-bar</code> æ ‡å¿—"è¿™æ ·çš„ä»…å¦å®šçº¦æŸã€‚å½“ agent è®¤ä¸ºå®ƒå¿…é¡»ä½¿ç”¨è¯¥æ ‡å¿—æ—¶ï¼Œå®ƒä¼šå¡ä½ã€‚å§‹ç»ˆæä¾›æ›¿ä»£æ–¹æ¡ˆã€‚</p>
</li>
<li>
<p><strong>ä½¿ç”¨ CLAUDE.md ä½œä¸ºå¼ºåˆ¶å‡½æ•°ã€‚</strong> å¦‚æœä½ çš„ CLI å‘½ä»¤å¤æ‚å†—é•¿ï¼Œä¸è¦å†™æ®µè½æ–‡æ¡£æ¥è§£é‡Šå®ƒä»¬ã€‚é‚£æ˜¯ä¿®è¡¥äººçš„é—®é¢˜ã€‚ç›¸åï¼Œç¼–å†™ä¸€ä¸ªå…·æœ‰æ¸…æ™°ã€ç›´è§‚ API çš„ç®€å• bash åŒ…è£…å™¨å¹¶è®°å½•å®ƒã€‚ä¿æŒ <code>CLAUDE.md</code> å°½å¯èƒ½ç®€çŸ­æ˜¯ç®€åŒ–ä»£ç åº“å’Œå†…éƒ¨å·¥å…·çš„æå¥½å¼ºåˆ¶å‡½æ•°ã€‚</p>
</li>
</ol>
<p>è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„å¿«ç…§ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># å•ä½“ä»“åº“</span>

<span class="hljs-section">## Python</span>
<span class="hljs-bullet">-</span> å§‹ç»ˆ ...
<span class="hljs-bullet">-</span> ä½¿ç”¨ <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">command</span>&gt;</span></span> æµ‹è¯•
... å¦å¤– 10 ä¸ª ...

<span class="hljs-section">## &lt;å†…éƒ¨ CLI å·¥å…·&gt;</span>
... 10 ä¸ªé¡¹ç›®ï¼Œä¸“æ³¨äº 80% çš„ç”¨ä¾‹ ...
<span class="hljs-bullet">-</span> &lt;ä½¿ç”¨ç¤ºä¾‹&gt;
<span class="hljs-bullet">-</span> å§‹ç»ˆ ...
<span class="hljs-bullet">-</span> æ°¸è¿œä¸è¦ <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">x</span>&gt;</span></span>ï¼Œåå¥½ <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Y</span>&gt;</span></span>

å¯¹äº &lt;å¤æ‚ä½¿ç”¨&gt; æˆ– &lt;é”™è¯¯&gt;ï¼Œè¯·å‚é˜… path/to/<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">tool</span>&gt;</span></span><span class="hljs-emphasis">_docs.md

...
</span></code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4452b60912d646fab8e429f0312ee86f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763822312&amp;x-signature=V9M021APJKXVd8wREvOH%2B0s%2B24M%3D" alt="" loading="lazy"/></p>
<p>æœ€åï¼Œæˆ‘ä»¬ä¿æŒè¿™ä¸ªæ–‡ä»¶ä¸ <code>AGENTS.md</code> æ–‡ä»¶åŒæ­¥ï¼Œä»¥ä¿æŒä¸æˆ‘ä»¬å·¥ç¨‹å¸ˆå¯èƒ½ä½¿ç”¨çš„å…¶ä»– AI IDE çš„å…¼å®¹æ€§ã€‚</p>
<p><em>å¦‚æœä½ æ­£åœ¨å¯»æ‰¾ä¸ºç¼–ç  agents ç¼–å†™ markdown çš„æ›´å¤šæç¤ºï¼Œè¯·å‚é˜…"AI Can't Read Your Docs"ã€"AI-powered Software Engineering"å’Œ"How Cursor (AI IDE) Works"ã€‚</em></p>
<p><strong>è¦ç‚¹ï¼š</strong> å°†ä½ çš„ <code>CLAUDE.md</code> è§†ä¸ºé«˜çº§ã€ç²¾é€‰çš„æŠ¤æ å’ŒæŒ‡é’ˆé›†åˆã€‚ç”¨å®ƒæ¥æŒ‡å¯¼ä½ éœ€è¦åœ¨å“ªé‡ŒæŠ•èµ„æ›´å¤š AIï¼ˆå’Œäººç±»ï¼‰å‹å¥½çš„å·¥å…·ï¼Œè€Œä¸æ˜¯è¯•å›¾ä½¿å…¶æˆä¸ºå…¨é¢çš„æ‰‹å†Œã€‚</p>
<h2 data-id="heading-2">Compact, Context, &amp; Clear</h2>
<p>æˆ‘å»ºè®®åœ¨ç¼–ç ä¼šè¯ä¸­é€”è‡³å°‘è¿è¡Œä¸€æ¬¡ <code>/context</code> æ¥äº†è§£ä½ å¦‚ä½•ä½¿ç”¨ä½ çš„ 200k token ä¸Šä¸‹æ–‡çª—å£ï¼ˆå³ä½¿ä½¿ç”¨ Sonnet-1Mï¼Œæˆ‘ä¹Ÿä¸ç›¸ä¿¡å®Œæ•´ä¸Šä¸‹æ–‡çª—å£è¢«æœ‰æ•ˆä½¿ç”¨ï¼‰ã€‚å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œåœ¨å•ä½“ä»“åº“ä¸­çš„æ–°ä¼šè¯åŸºå‡†æˆæœ¬çº¦ä¸º ~20k tokenï¼ˆ10%ï¼‰ï¼Œå‰©ä½™ 180k ç”¨äºè¿›è¡Œæ›´æ”¹â€”â€”è¿™å¯èƒ½ä¼šå¾ˆå¿«å¡«æ»¡ã€‚</p>
<p>æˆ‘æœ‰ä¸‰ä¸ªä¸»è¦å·¥ä½œæµç¨‹ï¼š</p>
<ul>
<li>
<p><strong><code>/compact</code>ï¼ˆé¿å…ï¼‰ï¼š</strong> æˆ‘å°½å¯èƒ½é¿å…ä½¿ç”¨è¿™ä¸ªã€‚è‡ªåŠ¨å‹ç¼©æ˜¯ä¸é€æ˜çš„ã€å®¹æ˜“å‡ºé”™çš„ï¼Œå¹¶ä¸”æ²¡æœ‰å¾ˆå¥½åœ°ä¼˜åŒ–ã€‚</p>
</li>
<li>
<p><strong><code>/clear</code> + <code>/catchup</code>ï¼ˆç®€å•é‡å¯ï¼‰ï¼š</strong> æˆ‘çš„é»˜è®¤é‡å¯æ–¹å¼ã€‚æˆ‘ <code>/clear</code> çŠ¶æ€ï¼Œç„¶åè¿è¡Œè‡ªå®šä¹‰çš„ <code>/catchup</code> å‘½ä»¤è®© Claude è¯»å–æˆ‘ git åˆ†æ”¯ä¸­æ‰€æœ‰æ›´æ”¹çš„æ–‡ä»¶ã€‚</p>
</li>
<li>
<p><strong>"Document &amp; Clear"ï¼ˆå¤æ‚é‡å¯ï¼‰ï¼š</strong> å¯¹äºå¤§å‹ä»»åŠ¡ã€‚æˆ‘è®© Claude å°†å…¶è®¡åˆ’å’Œè¿›åº¦è½¬å‚¨åˆ° <code>.md</code> æ–‡ä»¶ä¸­ï¼Œ<code>/clear</code> çŠ¶æ€ï¼Œç„¶åé€šè¿‡å‘Šè¯‰å®ƒè¯»å– <code>.md</code> æ–‡ä»¶å¹¶ç»§ç»­æ¥å¼€å§‹æ–°ä¼šè¯ã€‚</p>
</li>
</ul>
<p><strong>è¦ç‚¹ï¼š</strong> ä¸è¦ç›¸ä¿¡è‡ªåŠ¨å‹ç¼©ã€‚ä½¿ç”¨ <code>/clear</code> è¿›è¡Œç®€å•é‡å¯ï¼Œä½¿ç”¨"Document &amp; Clear"æ–¹æ³•ä¸ºå¤æ‚ä»»åŠ¡åˆ›å»ºæŒä¹…çš„å¤–éƒ¨"è®°å¿†"ã€‚</p>
<h2 data-id="heading-3">Custom Slash Commands</h2>
<p>æˆ‘è®¤ä¸ºæ–œæ å‘½ä»¤åªæ˜¯é¢‘ç¹ä½¿ç”¨çš„æç¤ºçš„ç®€å•å¿«æ·æ–¹å¼ï¼Œä»…æ­¤è€Œå·²ã€‚æˆ‘çš„è®¾ç½®æ˜¯æœ€å°åŒ–çš„ï¼š</p>
<ul>
<li>
<p><code>/catchup</code>ï¼šæˆ‘ä¹‹å‰æåˆ°çš„å‘½ä»¤ã€‚å®ƒåªæ˜¯æç¤º Claude è¯»å–æˆ‘å½“å‰ git åˆ†æ”¯ä¸­æ‰€æœ‰æ›´æ”¹çš„æ–‡ä»¶ã€‚</p>
</li>
<li>
<p><code>/pr</code>ï¼šä¸€ä¸ªç®€å•çš„åŠ©æ‰‹ï¼Œæ¸…ç†æˆ‘çš„ä»£ç ã€æš‚å­˜å®ƒå¹¶å‡†å¤‡ pull requestã€‚</p>
</li>
</ul>
<p>æ•æˆ‘ç›´è¨€ï¼Œå¦‚æœä½ æœ‰ä¸€é•¿ä¸²å¤æ‚çš„è‡ªå®šä¹‰æ–œæ å‘½ä»¤ï¼Œä½ å°±åˆ›å»ºäº†ä¸€ä¸ªåæ¨¡å¼ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œåƒ Claude è¿™æ ·çš„ agent çš„å…¨éƒ¨æ„ä¹‰åœ¨äºä½ å¯ä»¥è¾“å…¥å‡ ä¹ä»»ä½•ä½ æƒ³è¦çš„ä¸œè¥¿å¹¶è·å¾—æœ‰ç”¨çš„ã€å¯åˆå¹¶çš„ç»“æœã€‚å½“ä½ å¼ºè¿«å·¥ç¨‹å¸ˆï¼ˆæˆ–éå·¥ç¨‹å¸ˆï¼‰å­¦ä¹ ä¸€å¥—æ–°çš„ã€åœ¨æŸå¤„è®°å½•çš„åŸºæœ¬é­”æ³•å‘½ä»¤æ¥å®Œæˆå·¥ä½œæ—¶ï¼Œä½ å°±å¤±è´¥äº†ã€‚</p>
<p><strong>è¦ç‚¹ï¼š</strong> ä½¿ç”¨æ–œæ å‘½ä»¤ä½œä¸ºç®€å•çš„ä¸ªäººå¿«æ·æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½œä¸ºæ„å»ºæ›´ç›´è§‚çš„ <code>CLAUDE.md</code> å’Œæ›´å¥½å·¥å…·çš„ agent çš„æ›¿ä»£å“ã€‚</p>
<h2 data-id="heading-4">Custom Subagents</h2>
<p>åœ¨ç†è®ºä¸Šï¼Œè‡ªå®šä¹‰ subagents æ˜¯ Claude Code æœ€å¼ºå¤§çš„ä¸Šä¸‹æ–‡ç®¡ç†åŠŸèƒ½ã€‚æ¨é”€å¾ˆç®€å•ï¼šä¸€ä¸ªå¤æ‚ä»»åŠ¡éœ€è¦ X ä¸ª token çš„è¾“å…¥ä¸Šä¸‹æ–‡ï¼ˆä¾‹å¦‚ï¼Œå¦‚ä½•è¿è¡Œæµ‹è¯•ï¼‰ï¼Œç´¯ç§¯ Y ä¸ª token çš„å·¥ä½œä¸Šä¸‹æ–‡ï¼Œå¹¶äº§ç”Ÿ Z ä¸ª token çš„ç­”æ¡ˆã€‚è¿è¡Œ N ä¸ªä»»åŠ¡æ„å‘³ç€åœ¨ä½ çš„ä¸»çª—å£ä¸­æœ‰ <code>(X + Y + Z) * N</code> ä¸ª tokenã€‚</p>
<p>subagent è§£å†³æ–¹æ¡ˆæ˜¯å°† <code>(X + Y) * N</code> å·¥ä½œå¤–åŒ…ç»™ä¸“é—¨çš„ agentsï¼Œå®ƒä»¬åªè¿”å›æœ€ç»ˆçš„ Z token ç­”æ¡ˆï¼Œä¿æŒä¸»ä¸Šä¸‹æ–‡å¹²å‡€ã€‚</p>
<p>æˆ‘å‘ç°å®ƒä»¬æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æƒ³æ³•ï¼Œä½†åœ¨å®è·µä¸­ï¼Œè‡ªå®šä¹‰ subagents ä¼šäº§ç”Ÿä¸¤ä¸ªæ–°é—®é¢˜ï¼š</p>
<ol>
<li>
<p><strong>å®ƒä»¬å°é”ä¸Šä¸‹æ–‡ï¼š</strong> å¦‚æœæˆ‘åˆ¶ä½œä¸€ä¸ª <code>PythonTests</code> subagentï¼Œæˆ‘ç°åœ¨å·²ç»ä»æˆ‘çš„ä¸» agent ä¸­éšè—äº†æ‰€æœ‰æµ‹è¯•ä¸Šä¸‹æ–‡ã€‚å®ƒä¸å†èƒ½å¯¹æ›´æ”¹è¿›è¡Œæ•´ä½“æ¨ç†ã€‚å®ƒç°åœ¨è¢«è¿«è°ƒç”¨ subagent åªæ˜¯ä¸ºäº†çŸ¥é“å¦‚ä½•éªŒè¯è‡ªå·±çš„ä»£ç ã€‚</p>
</li>
<li>
<p><strong>å®ƒä»¬å¼ºåˆ¶äººç±»å·¥ä½œæµç¨‹ï¼š</strong> æ›´ç³Ÿç³•çš„æ˜¯ï¼Œå®ƒä»¬å¼ºè¿« Claude è¿›å…¥åƒµç¡¬çš„ã€äººç±»å®šä¹‰çš„å·¥ä½œæµç¨‹ã€‚æˆ‘ç°åœ¨åœ¨è§„å®šå®ƒå¿…é¡»å¦‚ä½•å§”æ‰˜ï¼Œè¿™æ­£æ˜¯æˆ‘è¯•å›¾è®© agent ä¸ºæˆ‘è§£å†³çš„é—®é¢˜ã€‚</p>
</li>
</ol>
<p>æˆ‘åå¥½çš„æ›¿ä»£æ–¹æ¡ˆæ˜¯ä½¿ç”¨ Claude å†…ç½®çš„ <code>Task(...)</code> åŠŸèƒ½æ¥ç”Ÿæˆé€šç”¨ agent çš„å‰¯æœ¬ã€‚</p>
<p>æˆ‘å°†æ‰€æœ‰å…³é”®ä¸Šä¸‹æ–‡æ”¾åœ¨ <code>CLAUDE.md</code> ä¸­ã€‚ç„¶åï¼Œæˆ‘è®©ä¸» agent å†³å®šä½•æ—¶ä»¥åŠå¦‚ä½•å°†å·¥ä½œå§”æ‰˜ç»™è‡ªèº«çš„å‰¯æœ¬ã€‚è¿™ç»™äº†æˆ‘æ‰€æœ‰ subagents çš„ä¸Šä¸‹æ–‡èŠ‚çœå¥½å¤„ï¼Œè€Œæ²¡æœ‰ç¼ºç‚¹ã€‚agent åŠ¨æ€ç®¡ç†è‡ªå·±çš„ç¼–æ’ã€‚</p>
<p>åœ¨æˆ‘çš„"Building Multi-Agent Systems (Part 2)"æ–‡ç« ä¸­ï¼Œæˆ‘ç§°ä¹‹ä¸º"Master-Clone"æ¶æ„ï¼Œæˆ‘å¼ºçƒˆåå¥½å®ƒè€Œä¸æ˜¯è‡ªå®šä¹‰ subagents é¼“åŠ±çš„"Lead-Specialist"æ¨¡å‹ã€‚</p>
<p><strong>è¦ç‚¹ï¼š</strong> è‡ªå®šä¹‰ subagents æ˜¯ä¸€ä¸ªè„†å¼±çš„è§£å†³æ–¹æ¡ˆã€‚ç»™ä½ çš„ä¸» agent ä¸Šä¸‹æ–‡ï¼ˆåœ¨ <code>CLAUDE.md</code> ä¸­ï¼‰å¹¶è®©å®ƒä½¿ç”¨è‡ªå·±çš„ <code>Task/Explore(...)</code> åŠŸèƒ½æ¥ç®¡ç†å§”æ‰˜ã€‚</p>
<h2 data-id="heading-5">Resume, Continue, &amp; History</h2>
<p>åœ¨ç®€å•å±‚é¢ä¸Šï¼Œæˆ‘ç»å¸¸ä½¿ç”¨ <code>claude --resume</code> å’Œ <code>claude --continue</code>ã€‚å®ƒä»¬éå¸¸é€‚åˆé‡å¯å‡ºé”™çš„ç»ˆç«¯æˆ–å¿«é€Ÿé‡å¯æ—§ä¼šè¯ã€‚æˆ‘ç»å¸¸ <code>claude --resume</code> å‡ å¤©å‰çš„ä¼šè¯ï¼Œåªæ˜¯è¯¢é—® agent æ€»ç»“å®ƒå¦‚ä½•å…‹æœç‰¹å®šé”™è¯¯ï¼Œç„¶åæˆ‘ç”¨å®ƒæ¥æ”¹è¿›æˆ‘ä»¬çš„ <code>CLAUDE.md</code> å’Œå†…éƒ¨å·¥å…·ã€‚</p>
<p>æ›´æ·±å…¥åœ°è¯´ï¼ŒClaude Code å°†æ‰€æœ‰ä¼šè¯å†å²å­˜å‚¨åœ¨ <code>~/.claude/projects/</code> ä¸­ï¼Œä»¥æŒ–æ˜åŸå§‹å†å²ä¼šè¯æ•°æ®ã€‚æˆ‘æœ‰è„šæœ¬å¯¹è¿™äº›æ—¥å¿—è¿è¡Œå…ƒåˆ†æï¼Œå¯»æ‰¾å¸¸è§å¼‚å¸¸ã€æƒé™è¯·æ±‚å’Œé”™è¯¯æ¨¡å¼ï¼Œä»¥å¸®åŠ©æ”¹è¿›é¢å‘ agent çš„ä¸Šä¸‹æ–‡ã€‚</p>
<p><strong>è¦ç‚¹ï¼š</strong> ä½¿ç”¨ <code>claude --resume</code> å’Œ <code>claude --continue</code> é‡å¯ä¼šè¯å¹¶å‘ç°è¢«åŸ‹è—çš„å†å²ä¸Šä¸‹æ–‡ã€‚</p>
<h2 data-id="heading-6">Hooks</h2>
<p>Hooks å¾ˆé‡è¦ã€‚æˆ‘ä¸åœ¨ä¸šä½™é¡¹ç›®ä¸­ä½¿ç”¨å®ƒä»¬ï¼Œä½†å®ƒä»¬å¯¹äºåœ¨å¤æ‚ä¼ä¸šä»“åº“ä¸­å¼•å¯¼ Claude è‡³å…³é‡è¦ã€‚å®ƒä»¬æ˜¯ç¡®å®šæ€§çš„"å¿…é¡»åš"è§„åˆ™ï¼Œè¡¥å…… <code>CLAUDE.md</code> ä¸­çš„"åº”è¯¥åš"å»ºè®®ã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨ä¸¤ç§ç±»å‹ï¼š</p>
<ol>
<li>
<p><strong>æäº¤æ—¶é˜»æ­¢ Hooksï¼š</strong> è¿™æ˜¯æˆ‘ä»¬çš„ä¸»è¦ç­–ç•¥ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ª <code>PreToolUse</code> hook åŒ…è£…ä»»ä½• <code>Bash(git commit)</code> å‘½ä»¤ã€‚å®ƒæ£€æŸ¥ <code>/tmp/agent-pre-commit-pass</code> æ–‡ä»¶ï¼Œæˆ‘ä»¬çš„æµ‹è¯•è„šæœ¬åªæœ‰åœ¨æ‰€æœ‰æµ‹è¯•é€šè¿‡æ—¶æ‰ä¼šåˆ›å»ºè¯¥æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶ç¼ºå¤±ï¼Œhook ä¼šé˜»æ­¢æäº¤ï¼Œè¿«ä½¿ Claude è¿›å…¥"æµ‹è¯•å¹¶ä¿®å¤"å¾ªç¯ï¼Œç›´åˆ°æ„å»ºå˜ä¸ºç»¿è‰²ã€‚</p>
</li>
<li>
<p><strong>æç¤º Hooksï¼š</strong> è¿™äº›æ˜¯ç®€å•çš„ã€éé˜»å¡çš„ hooksï¼Œå¦‚æœ agent æ­£åœ¨åšæ¬¡ä¼˜çš„äº‹æƒ…ï¼Œä¼šæä¾›"å³å‘å³å¿˜"çš„åé¦ˆã€‚</p>
</li>
</ol>
<p>æˆ‘ä»¬æœ‰æ„ä¸ä½¿ç”¨"å†™å…¥æ—¶é˜»æ­¢" hooksï¼ˆä¾‹å¦‚ï¼Œåœ¨ <code>Edit</code> æˆ– <code>Write</code> ä¸Šï¼‰ã€‚åœ¨è®¡åˆ’ä¸­é€”é˜»æ­¢ agent ä¼šæ··æ·†ç”šè‡³"æŒ«è´¥"å®ƒã€‚è®©å®ƒå®Œæˆå·¥ä½œç„¶ååœ¨æäº¤é˜¶æ®µæ£€æŸ¥æœ€ç»ˆçš„ã€å®Œæˆçš„ç»“æœè¦æœ‰æ•ˆå¾—å¤šã€‚</p>
<p><strong>è¦ç‚¹ï¼š</strong> ä½¿ç”¨ hooks åœ¨æäº¤æ—¶å¼ºåˆ¶çŠ¶æ€éªŒè¯ï¼ˆblock-at-submitï¼‰ã€‚é¿å…åœ¨å†™å…¥æ—¶é˜»æ­¢â€”â€”è®© agent å®Œæˆè®¡åˆ’ï¼Œç„¶åæ£€æŸ¥æœ€ç»ˆç»“æœã€‚</p>
<h2 data-id="heading-7">Planning Mode</h2>
<p>å¯¹äºä»»ä½•"å¤§å‹"åŠŸèƒ½æ›´æ”¹ï¼Œä½¿ç”¨ AI IDE è¿›è¡Œè§„åˆ’æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p>
<p>å¯¹äºæˆ‘çš„ä¸šä½™é¡¹ç›®ï¼Œæˆ‘åªä½¿ç”¨å†…ç½®çš„è§„åˆ’æ¨¡å¼ã€‚è¿™æ˜¯åœ¨ Claude å¼€å§‹ä¹‹å‰ä¸ä¹‹å¯¹é½çš„ä¸€ç§æ–¹å¼ï¼Œå®šä¹‰äº†å¦‚ä½•æ„å»ºæŸç‰©ä»¥åŠå®ƒéœ€è¦åœæ­¢å¹¶å±•ç¤ºå·¥ä½œçš„"æ£€æŸ¥ç‚¹"ã€‚å®šæœŸä½¿ç”¨è¿™ä¸ªå¯ä»¥å»ºç«‹å¼ºçƒˆçš„ç›´è§‰ï¼Œäº†è§£è·å¾—è‰¯å¥½è®¡åˆ’è€Œä¸è®© Claude æç ¸å®ç°æ‰€éœ€çš„æœ€å°ä¸Šä¸‹æ–‡ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„å·¥ä½œå•ä½“ä»“åº“ä¸­ï¼Œæˆ‘ä»¬å¼€å§‹æ¨å‡ºåŸºäº Claude Code SDK æ„å»ºçš„è‡ªå®šä¹‰è§„åˆ’å·¥å…·ã€‚å®ƒç±»ä¼¼äºåŸç”Ÿè®¡åˆ’æ¨¡å¼ï¼Œä½†ç»è¿‡å¤§é‡æç¤ºä»¥ä½¿å…¶è¾“å‡ºä¸æˆ‘ä»¬ç°æœ‰çš„æŠ€æœ¯è®¾è®¡æ ¼å¼å¯¹é½ã€‚å®ƒè¿˜å¼€ç®±å³ç”¨åœ°å¼ºåˆ¶æ‰§è¡Œæˆ‘ä»¬çš„å†…éƒ¨æœ€ä½³å®è·µâ€”â€”ä»ä»£ç ç»“æ„åˆ°æ•°æ®éšç§å’Œå®‰å…¨ã€‚è¿™è®©æˆ‘ä»¬çš„å·¥ç¨‹å¸ˆèƒ½å¤Ÿ" vibe plan"ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œå°±åƒä»–ä»¬æ˜¯é«˜çº§æ¶æ„å¸ˆä¸€æ ·ï¼ˆè‡³å°‘è¿™æ˜¯æ¨é”€çš„è¯´æ³•ï¼‰ã€‚</p>
<p><strong>è¦ç‚¹ï¼š</strong> å¯¹äºå¤æ‚æ›´æ”¹ï¼Œå§‹ç»ˆä½¿ç”¨å†…ç½®è§„åˆ’æ¨¡å¼åœ¨ agent å¼€å§‹å·¥ä½œä¹‹å‰å¯¹é½è®¡åˆ’ã€‚</p>
<h2 data-id="heading-8">Skills</h2>
<p>æˆ‘åŒæ„ Simon Willison çš„è§‚ç‚¹ï¼š<strong>Skills å¯èƒ½æ¯” MCP æ›´é‡è¦ã€‚</strong></p>
<p>å¦‚æœä½ ä¸€ç›´åœ¨å…³æ³¨æˆ‘çš„æ–‡ç« ï¼Œä½ ä¼šçŸ¥é“æˆ‘å·²ç»åç¦»äº† MCP è¿›è¡Œå¤§å¤šæ•°å¼€å‘å·¥ä½œï¼Œåå¥½æ„å»ºç®€å•çš„ CLIï¼ˆæ­£å¦‚æˆ‘åœ¨"AI Can't Read Your Docs"ä¸­äº‰è®ºçš„é‚£æ ·ï¼‰ã€‚æˆ‘çš„ agent è‡ªæ²»å¿ƒæ™ºæ¨¡å‹å·²ç»æ¼”å˜ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li>
<p><strong>å•ä¸€æç¤ºï¼š</strong> åœ¨ä¸€ä¸ªå·¨å¤§çš„æç¤ºä¸­ç»™ agent æ‰€æœ‰ä¸Šä¸‹æ–‡ã€‚ï¼ˆè„†å¼±ï¼Œä¸å¯æ‰©å±•ï¼‰</p>
</li>
<li>
<p><strong>å·¥å…·è°ƒç”¨ï¼š</strong> "ç»å…¸" agent æ¨¡å‹ã€‚æˆ‘ä»¬æ‰‹å·¥åˆ¶ä½œå·¥å…·å¹¶ä¸º agent æŠ½è±¡ç°å®ã€‚ï¼ˆæ›´å¥½ï¼Œä½†åˆ›å»ºäº†æ–°çš„æŠ½è±¡å’Œä¸Šä¸‹æ–‡ç“¶é¢ˆï¼‰</p>
</li>
<li>
<p><strong>è„šæœ¬ç¼–å†™ï¼š</strong> æˆ‘ä»¬ç»™ agent è®¿é—®åŸå§‹ç¯å¢ƒâ€”â€”äºŒè¿›åˆ¶æ–‡ä»¶ã€è„šæœ¬å’Œæ–‡æ¡£â€”â€”å®ƒåŠ¨æ€ç¼–å†™ä»£ç æ¥ä¸å®ƒä»¬äº¤äº’ã€‚</p>
</li>
</ol>
<p>è€ƒè™‘åˆ°è¿™ä¸ªæ¨¡å‹ï¼Œ<strong>Agent Skills</strong> æ˜¯æ˜æ˜¾çš„ä¸‹ä¸€ä¸ªåŠŸèƒ½ã€‚å®ƒä»¬æ˜¯"è„šæœ¬ç¼–å†™"å±‚çš„æ­£å¼äº§å“åŒ–ã€‚</p>
<p>å¦‚æœä½ åƒæˆ‘ä¸€æ ·ï¼Œå·²ç»åå¥½ CLI è€Œä¸æ˜¯ MCPï¼Œä½ ä¸€ç›´åœ¨éšå«åœ°è·å¾— Skills çš„å¥½å¤„ã€‚<code>SKILL.md</code> æ–‡ä»¶åªæ˜¯ä¸€ç§æ›´æœ‰ç»„ç»‡ã€å¯å…±äº«å’Œå¯å‘ç°çš„æ–¹å¼æ¥è®°å½•è¿™äº› CLI å’Œè„šæœ¬å¹¶å°†å®ƒä»¬æš´éœ²ç»™ agentã€‚</p>
<p><strong>è¦ç‚¹ï¼š</strong> Skills æ˜¯æ­£ç¡®çš„æŠ½è±¡ã€‚å®ƒä»¬æ­£å¼åŒ–äº†åŸºäº"è„šæœ¬ç¼–å†™"çš„ agent æ¨¡å‹ï¼Œè¿™æ¯” MCP ä»£è¡¨çš„åƒµç¡¬ã€ç±»ä¼¼ API çš„æ¨¡å‹æ›´å¥å£®å’Œçµæ´»ã€‚</p>
<h2 data-id="heading-9">MCP (Model Context Protocol)</h2>
<p>Skills ä¸æ„å‘³ç€ MCP å·²æ­»ï¼ˆå¦è§"Everything Wrong with MCP"ï¼‰ã€‚ä»¥å‰ï¼Œè®¸å¤šäººæ„å»ºäº†ç³Ÿç³•çš„ã€ä¸Šä¸‹æ–‡ç¹é‡çš„ MCPï¼Œæœ‰å‡ åä¸ªåªæ˜¯é•œåƒ REST API çš„å·¥å…·ï¼ˆ<code>read_thing_a()</code>ã€<code>read_thing_b()</code>ã€<code>update_thing_c()</code>ï¼‰ã€‚</p>
<p>"è„šæœ¬ç¼–å†™"æ¨¡å‹ï¼ˆç°åœ¨ç”± Skills æ­£å¼åŒ–ï¼‰æ›´å¥½ï¼Œä½†å®ƒéœ€è¦ä¸€ç§å®‰å…¨çš„æ–¹å¼æ¥è®¿é—®ç¯å¢ƒã€‚å¯¹æˆ‘æ¥è¯´ï¼Œè¿™æ˜¯ MCP æ–°çš„ã€æ›´é›†ä¸­çš„è§’è‰²ã€‚</p>
<p>è€Œä¸æ˜¯è‡ƒè‚¿çš„ APIï¼ŒMCP åº”è¯¥æ˜¯ä¸€ä¸ªç®€å•çš„ã€å®‰å…¨çš„ç½‘å…³ï¼Œæä¾›å‡ ä¸ªå¼ºå¤§çš„ã€é«˜çº§å·¥å…·ï¼š</p>
<ul>
<li><code>download_raw_data(filtersâ€¦)</code></li>
<li><code>take_sensitive_gated_action(argsâ€¦)</code></li>
<li><code>execute_code_in_environment_with_state(codeâ€¦)</code></li>
</ul>
<p>åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼ŒMCP çš„å·¥ä½œä¸æ˜¯ä¸º agent æŠ½è±¡ç°å®ï¼›å®ƒçš„å·¥ä½œæ˜¯ç®¡ç†è®¤è¯ã€ç½‘ç»œå’Œå®‰å…¨è¾¹ç•Œï¼Œç„¶åè®©è·¯ã€‚å®ƒä¸º agent æä¾›å…¥å£ç‚¹ï¼Œç„¶å agent ä½¿ç”¨å…¶è„šæœ¬ç¼–å†™å’Œ markdown ä¸Šä¸‹æ–‡æ¥å®Œæˆå®é™…å·¥ä½œã€‚</p>
<p>æˆ‘ä»ç„¶ä½¿ç”¨çš„å”¯ä¸€ MCP æ˜¯ç”¨äº Playwrightï¼Œè¿™å¾ˆåˆç†â€”â€”å®ƒæ˜¯ä¸€ä¸ªå¤æ‚çš„ã€æœ‰çŠ¶æ€çš„ç¯å¢ƒã€‚æˆ‘æ‰€æœ‰çš„æ— çŠ¶æ€å·¥å…·ï¼ˆå¦‚ Jiraã€AWSã€GitHubï¼‰éƒ½å·²è¿ç§»åˆ°ç®€å•çš„ CLIã€‚</p>
<p><strong>è¦ç‚¹ï¼š</strong> ä½¿ç”¨å……å½“æ•°æ®ç½‘å…³çš„ MCPã€‚ç»™ agent ä¸€ä¸¤ä¸ªé«˜çº§å·¥å…·ï¼ˆå¦‚åŸå§‹æ•°æ®è½¬å‚¨ APIï¼‰ï¼Œç„¶åå®ƒå¯ä»¥ç¼–å†™è„šæœ¬æ¥å¯¹æŠ—ã€‚</p>
<h2 data-id="heading-10">Claude Code SDK</h2>
<p>Claude Code ä¸ä»…ä»…æ˜¯ä¸€ä¸ªäº¤äº’å¼ CLIï¼›å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¼ºå¤§çš„ SDKï¼Œç”¨äºæ„å»ºå…¨æ–°çš„ agentsâ€”â€”æ—¢ç”¨äºç¼–ç ä»»åŠ¡ä¹Ÿç”¨äºéç¼–ç ä»»åŠ¡ã€‚æˆ‘å·²ç»å¼€å§‹å°†å®ƒä½œä¸ºæˆ‘é»˜è®¤çš„ agent æ¡†æ¶ï¼Œè€Œä¸æ˜¯åƒ LangChain/CrewAI è¿™æ ·çš„å·¥å…·ï¼Œç”¨äºå¤§å¤šæ•°æ–°çš„ä¸šä½™é¡¹ç›®ã€‚</p>
<p>æˆ‘ä»¥ä¸‰ç§ä¸»è¦æ–¹å¼ä½¿ç”¨å®ƒï¼š</p>
<ol>
<li>
<p><strong>å¤§è§„æ¨¡å¹¶è¡Œè„šæœ¬ç¼–å†™ï¼š</strong> å¯¹äºå¤§è§„æ¨¡é‡æ„ã€é”™è¯¯ä¿®å¤æˆ–è¿ç§»ï¼Œæˆ‘ä¸ä½¿ç”¨äº¤äº’å¼èŠå¤©ã€‚æˆ‘ç¼–å†™ç®€å•çš„ bash è„šæœ¬å¹¶è¡Œè°ƒç”¨ <code>claude -p "in /pathA change all refs from foo to bar"</code>ã€‚è¿™æ¯”è¯•å›¾è®©ä¸» agent ç®¡ç†å‡ åä¸ª subagent ä»»åŠ¡æ›´å…·å¯æ‰©å±•æ€§å’Œå¯æ§æ€§ã€‚</p>
</li>
<li>
<p><strong>æ„å»ºå†…éƒ¨èŠå¤©å·¥å…·ï¼š</strong> SDK éå¸¸é€‚åˆå°†å¤æ‚è¿‡ç¨‹åŒ…è£…åœ¨ç®€å•çš„èŠå¤©ç•Œé¢ä¸­ï¼Œä¾›éæŠ€æœ¯ç”¨æˆ·ä½¿ç”¨ã€‚æ¯”å¦‚ä¸€ä¸ªå®‰è£…ç¨‹åºï¼Œåœ¨å‡ºé”™æ—¶å›é€€åˆ° Claude Code SDK æ¥ä¸ºç”¨æˆ·ä¿®å¤é—®é¢˜ã€‚æˆ–è€…ä¸€ä¸ªå†…éƒ¨çš„"v0-at-home"å·¥å…·ï¼Œè®©æˆ‘ä»¬çš„è®¾è®¡å›¢é˜Ÿåœ¨æˆ‘ä»¬å†…éƒ¨çš„ UI æ¡†æ¶ä¸­ vibe-code æ¨¡æ‹Ÿå‰ç«¯ï¼Œç¡®ä¿ä»–ä»¬çš„æƒ³æ³•æ˜¯é«˜ä¿çœŸçš„ï¼Œå¹¶ä¸”ä»£ç æ›´ç›´æ¥å¯ç”¨åœ¨å‰ç«¯ç”Ÿäº§ä»£ç ä¸­ã€‚</p>
</li>
<li>
<p><strong>å¿«é€Ÿ Agent åŸå‹åˆ¶ä½œï¼š</strong> è¿™æ˜¯æˆ‘æœ€å¸¸è§çš„ç”¨æ³•ã€‚å®ƒä¸ä»…ç”¨äºç¼–ç ã€‚å¦‚æœæˆ‘å¯¹ä»»ä½• agent ä»»åŠ¡æœ‰æƒ³æ³•ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨è‡ªå®šä¹‰ CLI æˆ– MCP çš„"å¨èƒè°ƒæŸ¥ agent"ï¼‰ï¼Œæˆ‘ä½¿ç”¨ Claude Code SDK åœ¨æŠ•å…¥å®Œæ•´çš„ã€éƒ¨ç½²çš„è„šæ‰‹æ¶ä¹‹å‰å¿«é€Ÿæ„å»ºå’Œæµ‹è¯•åŸå‹ã€‚</p>
</li>
</ol>
<p><strong>è¦ç‚¹ï¼š</strong> Claude Code SDK æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ã€é€šç”¨çš„ agent æ¡†æ¶ã€‚ç”¨å®ƒæ¥æ‰¹å¤„ç†ä»£ç ã€æ„å»ºå†…éƒ¨å·¥å…·ï¼Œä»¥åŠåœ¨é‡‡ç”¨æ›´å¤æ‚çš„æ¡†æ¶ä¹‹å‰å¿«é€ŸåŸå‹åŒ–æ–°çš„ agentsã€‚</p>
<h2 data-id="heading-11">Claude Code GHA</h2>
<p>Claude Code GitHub Action (GHA) å¯èƒ½æ˜¯æˆ‘æœ€å–œæ¬¢å’Œæœ€è¢«ä½ä¼°çš„åŠŸèƒ½ä¹‹ä¸€ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ¦‚å¿µï¼šåªæ˜¯åœ¨ GHA ä¸­è¿è¡Œ Claude Codeã€‚ä½†æ­£æ˜¯è¿™ç§ç®€å•æ€§ä½¿å…¶å¦‚æ­¤å¼ºå¤§ã€‚</p>
<p>å®ƒç±»ä¼¼äº Cursor çš„åå° agents æˆ– Codex æ‰˜ç®¡çš„ web UIï¼Œä½†å¯å®šåˆ¶æ€§æ›´å¼ºã€‚ä½ æ§åˆ¶æ•´ä¸ªå®¹å™¨å’Œç¯å¢ƒï¼Œç»™ä½ æ›´å¤šçš„æ•°æ®è®¿é—®æƒé™ï¼Œå…³é”®æ˜¯ï¼Œæ¯”ä»»ä½•å…¶ä»–äº§å“æä¾›æ›´å¼ºçš„æ²™ç›’å’Œå®¡è®¡æ§åˆ¶ã€‚æ­¤å¤–ï¼Œå®ƒæ”¯æŒæ‰€æœ‰é«˜çº§åŠŸèƒ½ï¼Œå¦‚ Hooks å’Œ MCPã€‚</p>
<p>æˆ‘ä»¬ç”¨å®ƒæ¥æ„å»ºè‡ªå®šä¹‰çš„"ä»ä»»ä½•åœ°æ–¹åˆ›å»º PR"å·¥å…·ã€‚ç”¨æˆ·å¯ä»¥ä» Slackã€Jira ç”šè‡³ CloudWatch è­¦æŠ¥è§¦å‘ PRï¼ŒGHA å°†ä¿®å¤é”™è¯¯æˆ–æ·»åŠ åŠŸèƒ½å¹¶è¿”å›ä¸€ä¸ªå®Œå…¨æµ‹è¯•çš„ PRÂ¹ã€‚</p>
<p>ç”±äº GHA æ—¥å¿—æ˜¯å®Œæ•´çš„ agent æ—¥å¿—ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ“ä½œæµç¨‹ï¼Œåœ¨å…¬å¸å±‚é¢å®šæœŸå®¡æŸ¥è¿™äº›æ—¥å¿—ï¼Œå¯»æ‰¾å¸¸è§é”™è¯¯ã€bash é”™è¯¯æˆ–ä¸å¯¹é½çš„å·¥ç¨‹å®è·µã€‚è¿™åˆ›å»ºäº†ä¸€ä¸ªæ•°æ®é©±åŠ¨çš„é£è½®ï¼šBugs â†’ æ”¹è¿›çš„ CLAUDE.md / CLIs â†’ æ›´å¥½çš„ Agentã€‚</p>
<pre><code class="hljs language-bash" lang="bash">$ query-claude-gha-logs --since 5d | claude -p <span class="hljs-string">"see what the other claudes were getting stuck on and fix it, then put up a PR"</span>
</code></pre>
<p><strong>è¦ç‚¹ï¼š</strong> GHA æ˜¯æ“ä½œåŒ– Claude Code çš„ç»ˆææ–¹å¼ã€‚å®ƒå°†å®ƒä»ä¸ªäººå·¥å…·è½¬å˜ä¸ºå·¥ç¨‹ç³»ç»Ÿçš„æ ¸å¿ƒã€å¯å®¡è®¡å’Œè‡ªæˆ‘æ”¹è¿›çš„éƒ¨åˆ†ã€‚</p>
<h2 data-id="heading-12">settings.json</h2>
<p>æœ€åï¼Œæˆ‘å‘ç°å¯¹äºä¸šä½™å’Œä¸“ä¸šå·¥ä½œï¼Œæœ‰å‡ ä¸ªç‰¹å®šçš„ <code>settings.json</code> é…ç½®è‡³å…³é‡è¦ã€‚</p>
<ul>
<li>
<p><strong><code>HTTPS_PROXY</code>/<code>HTTP_PROXY</code></strong>ï¼šè¿™å¯¹äºè°ƒè¯•å¾ˆæ£’ã€‚æˆ‘ç”¨å®ƒæ¥æ£€æŸ¥åŸå§‹æµé‡ï¼Œçœ‹çœ‹ Claude æ­£åœ¨å‘é€ä»€ä¹ˆæç¤ºã€‚å¯¹äºåå° agentsï¼Œå®ƒä¹Ÿæ˜¯ç»†ç²’åº¦ç½‘ç»œæ²™ç›’çš„å¼ºå¤§å·¥å…·ã€‚</p>
</li>
<li>
<p><strong><code>MCP_TOOL_TIMEOUT</code>/<code>BASH_MAX_TIMEOUT_MS</code></strong>ï¼šæˆ‘æé«˜äº†è¿™äº›ã€‚æˆ‘å–œæ¬¢è¿è¡Œé•¿è€Œå¤æ‚çš„å‘½ä»¤ï¼Œé»˜è®¤è¶…æ—¶é€šå¸¸è¿‡äºä¿å®ˆã€‚è€å®è¯´ï¼Œæ—¢ç„¶ bash åå°ä»»åŠ¡å·²ç»å­˜åœ¨ï¼Œæˆ‘ä¸ç¡®å®šè¿™æ˜¯å¦ä»ç„¶éœ€è¦ï¼Œä½†æˆ‘ä¿ç•™å®ƒä»¥é˜²ä¸‡ä¸€ã€‚</p>
</li>
<li>
<p><strong><code>ANTHROPIC_API_KEY</code></strong>ï¼šåœ¨å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¼ä¸š API å¯†é’¥ï¼ˆé€šè¿‡ apiKeyHelperï¼‰ã€‚å®ƒå°†æˆ‘ä»¬ä»"æŒ‰åº§ä½"è®¸å¯æ¨¡å¼è½¬å˜ä¸º"åŸºäºä½¿ç”¨"å®šä»·ï¼Œè¿™å¯¹æˆ‘ä»¬çš„å·¥ä½œæ–¹å¼æ¥è¯´æ˜¯æ›´å¥½çš„æ¨¡å‹ã€‚</p>
<ul>
<li>å®ƒè€ƒè™‘äº†å¼€å‘è€…ä½¿ç”¨çš„å·¨å¤§å·®å¼‚ï¼ˆæˆ‘ä»¬çœ‹åˆ°å·¥ç¨‹å¸ˆä¹‹é—´æœ‰ 1:100x çš„å·®å¼‚ï¼‰ã€‚</li>
<li>å®ƒè®©å·¥ç¨‹å¸ˆå¯ä»¥åœ¨æˆ‘ä»¬çš„å•ä¸€ä¼ä¸šè´¦æˆ·ä¸‹å°è¯•é Claude Code LLM è„šæœ¬ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>"permissions"</code></strong>ï¼šæˆ‘å¶å°”ä¼šè‡ªæˆ‘å®¡è®¡æˆ‘å…è®¸ Claude è‡ªåŠ¨è¿è¡Œçš„å‘½ä»¤åˆ—è¡¨ã€‚</p>
</li>
</ul>
<p><strong>è¦ç‚¹ï¼š</strong> ä½ çš„ <code>settings.json</code> æ˜¯é«˜çº§è‡ªå®šä¹‰çš„å¼ºå¤§åœ°æ–¹ã€‚</p>
<h2 data-id="heading-13">Conclusion</h2>
<p>å†…å®¹å¾ˆå¤šï¼Œä½†å¸Œæœ›ä½ è§‰å¾—æœ‰ç”¨ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰ä½¿ç”¨åŸºäº CLI çš„ agentï¼Œå¦‚ Claude Code æˆ– Codex CLIï¼Œä½ å¯èƒ½åº”è¯¥å¼€å§‹ä½¿ç”¨ã€‚å…³äºè¿™äº›é«˜çº§åŠŸèƒ½å¾ˆå°‘æœ‰å¥½çš„æŒ‡å—ï¼Œæ‰€ä»¥å­¦ä¹ çš„å”¯ä¸€æ–¹æ³•æ˜¯æŠ•å…¥å…¶ä¸­ã€‚</p>
<hr/>
<p>Â¹å¯¹æˆ‘æ¥è¯´ï¼Œä¸€ä¸ªç›¸å½“æœ‰è¶£çš„å“²å­¦é—®é¢˜æ˜¯ï¼Œä¸€ä¸ªç›´æ¥ä»å®¢æˆ·è¯·æ±‚ï¼ˆæ²¡æœ‰å†…éƒ¨äººç±»æç¤ºè€…ï¼‰ç”Ÿæˆçš„ PR åº”è¯¥æœ‰å¤šå°‘å®¡æŸ¥è€…ï¼Ÿæˆ‘ä»¬ç°åœ¨æš‚æ—¶å¯¹ä»»ä½• AI å‘èµ·çš„ PR é‡‡ç”¨ 2 ä¸ªäººç±»æ‰¹å‡†ï¼Œä½†å½“ä¸å†æ˜¯äººä¸ºå¦ä¸€ä¸ªäººç±»åˆ¶ä½œä¸œè¥¿ä¾›å…¶å®¡æŸ¥æ—¶ï¼Œè¿™æœ‰ç‚¹å¥‡æ€ªçš„æ¨¡å¼è½¬å˜ï¼ˆè‡³å°‘å¯¹æˆ‘æ¥è¯´æ˜¯è¿™æ ·ï¼‰ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬ä¸€æ¬¡ç”¨ Ollama è·‘è§†è§‰æ¨¡å‹ï¼šQwen2.5-VL 7B ç»™äº†æˆ‘ä¸€ä¸ªæ„å¤–æƒŠå–œ]]></title>    <link>https://juejin.cn/post/7572510909445783602</link>    <guid>https://juejin.cn/post/7572510909445783602</guid>    <pubDate>2025-11-15T14:43:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572510909445783602" data-draft-id="7572497847770972187" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬ä¸€æ¬¡ç”¨ Ollama è·‘è§†è§‰æ¨¡å‹ï¼šQwen2.5-VL 7B ç»™äº†æˆ‘ä¸€ä¸ªæ„å¤–æƒŠå–œ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-15T14:43:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‹‡å“¥Javaå®æˆ˜"/> <meta itemprop="url" content="https://juejin.cn/user/3693987061329080"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬ä¸€æ¬¡ç”¨ Ollama è·‘è§†è§‰æ¨¡å‹ï¼šQwen2.5-VL 7B ç»™äº†æˆ‘ä¸€ä¸ªæ„å¤–æƒŠå–œ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3693987061329080/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‹‡å“¥Javaå®æˆ˜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T14:43:19.000Z" title="Sat Nov 15 2025 14:43:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å‰å‡ å¤©åœ¨ Mac ä¸Šå®‰è£…äº† Ollamaï¼Œå¹¶ä¸‹è½½äº† Qwen2.5-VL 7B åšäº†ä¸€äº›æµ‹è¯•ï¼Œæ•´ä¸ªè¿‡ç¨‹è¿˜æŒºæœ‰æ„æ€ï¼Œåˆ†äº«ç»™å¤§å®¶ã€‚</p>
<h2 data-id="heading-0">1 Mac å®‰è£… Ollama</h2>
<p>è¿›å…¥ Ollama å®˜ç½‘ ï¼Œæˆ‘çš„ç”µè„‘æ˜¯ Mac Studio ï¼Œæ‰€ä»¥é€‰æ‹© MacOS ä¸‹è½½ ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18c08a20628e46939de3845bc0741a28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YuH5ZOlSmF2YeWunuaImA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763822598&amp;x-signature=xNMGGgrNT7Ld1ODuyem0ql4itVU%3D" alt="image-20251115204120250" loading="lazy"/></p>
<p>ä¸‹è½½å®Œæˆåï¼ŒåŒå‡»å®‰è£… ï¼Œå®‰è£…å®Œæˆåç•Œé¢å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0aac9729c09d46b898d3aaf639483421~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YuH5ZOlSmF2YeWunuaImA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763822598&amp;x-signature=R2l61ISKOmHaKFCLxyvv4cLIKy0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">2 ä¸‹è½½ Qwen 2.5 VL 7B</h2>
<p>Qwen 2.5-VL æ˜¯é˜¿é‡Œå·´å·´é€šä¹‰åƒé—®å›¢é˜Ÿå¼€å‘çš„ä¸€æ¬¾å¼€æºçš„æ——èˆ°çº§è§†è§‰è¯­è¨€æ¨¡å‹ã€‚</p>
<p>å®ƒèƒ½å¤Ÿå¤„ç†æ–‡æœ¬ã€å›¾åƒå’Œè§†é¢‘ï¼Œå¹¶å…·å¤‡å¼ºå¤§çš„è§†è§‰ç†è§£å’Œäº¤äº’èƒ½åŠ›ã€‚è¯¥æ¨¡å‹æœ‰ä¸åŒå‚æ•°è§„æ¨¡ï¼ˆå¦‚ 3Bã€7B å’Œ 72Bï¼‰ï¼Œé€‚ç”¨äºä»è¾¹ç¼˜ AI åˆ°é«˜æ€§èƒ½è®¡ç®—çš„å¤šç§åœºæ™¯ ã€‚</p>
<p>ä¸‹è½½ Qwen 2.5 VL æœ‰ä¸¤ç§æ–¹å¼ ï¼š</p>
<p><strong>1ã€é€šè¿‡å‘½ä»¤è¡Œè¯·æ±‚</strong></p>
<pre><code class="hljs">ollama pull qwen2.5vl:7b
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c498324096134bb89fcc8a6720e6c43f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YuH5ZOlSmF2YeWunuaImA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763822598&amp;x-signature=LhXMCOCs6vaemLnqTHzaGoV4VX8%3D" alt="" loading="lazy"/></p>
<p><strong>2ã€é€šè¿‡ Ollama GUI ç•Œé¢å®‰è£…</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6af61ece64e44ad4a852809189094c6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YuH5ZOlSmF2YeWunuaImA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763822598&amp;x-signature=%2BV%2BnGnhaQ8r%2Bhg8cduLbzSc4U3k%3D" alt="" loading="lazy"/></p>
<p>åœ¨ GUI ç•Œé¢é€‰æ‹©æ¨¡å‹ ï¼Œè‹¥æœªä¸‹è½½ä¼šæ˜¾ç¤ºä¸‹è½½å›¾æ ‡ï¼Œç„¶ååœ¨å¯¹è¯æ¡†ä¸­è¾“å…¥ä»»æ„æ–‡æœ¬å³å¯è‡ªåŠ¨ä¸‹è½½ã€‚</p>
<h2 data-id="heading-2">3 æ–‡æœ¬/å›¾ç‰‡ä½“éªŒ</h2>
<p>ä¸‹è½½å®Œæ¨¡å‹åï¼Œå³å¯åœ¨å¯¹è¯æ¡†ä¸­è¿›è¡Œå¯¹è¯ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/652343a76a76444b90294d8579ccf729~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YuH5ZOlSmF2YeWunuaImA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763822598&amp;x-signature=PK9q5%2Bs%2BHqlFW3Mh3BGitEBxzA4%3D" alt="" loading="lazy"/></p>
<p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ ollama å¯åŠ¨æ¨¡å‹åå±•å¼€å¯¹è¯ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">ollama run qwen2<span class="hljs-number">.5</span>vl:<span class="hljs-number">7b</span>
</code></pre>
<p>æ¥ä¸‹æ¥ï¼Œè¿›è¡Œå›¾ç‰‡æ£€æµ‹ï¼Œå›¾ç‰‡å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6b6fb58686541caa1886c875d4bc7e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YuH5ZOlSmF2YeWunuaImA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763822598&amp;x-signature=NRsviItMqgwuHOKJjK0GNJ582qg%3D" alt="" loading="lazy"/></p>
<p>æ£€æµ‹ç»“æœï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57e3a93aed86459ca6c71fe48aeaae8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YuH5ZOlSmF2YeWunuaImA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763822598&amp;x-signature=%2FplIQsTRUkFT8t5d7lSNqCKDqE8%3D" alt="" loading="lazy"/></p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¯¥æ¨¡å‹è¯†åˆ«å›¾åƒä¸­çš„æ–‡å­—ã€å…¬å¼æˆ–æŠ½å–ç¥¨æ®ã€è¯ä»¶ã€è¡¨å•ä¸­çš„ä¿¡æ¯ï¼Œæ”¯æŒæ ¼å¼åŒ–è¾“å‡ºæ–‡æœ¬ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e512c6b3b1c47ef872bbd4fc40cae9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YuH5ZOlSmF2YeWunuaImA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763822598&amp;x-signature=lDJAGUQo0HVAHwX74WfNbhV21Xg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">4 ç¨‹åºè°ƒç”¨åˆ†æå›¾ç‰‡</h2>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç¼–å†™ python è°ƒç”¨ Ollama æ¥å£ï¼ŒåŒæ ·æ˜¯åˆ†æå›¾ç‰‡ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fef6e0a70d33491d83ee831c437d6886~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YuH5ZOlSmF2YeWunuaImA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763822598&amp;x-signature=BO8d8z3k8xfvKu7KUojX%2FcE%2BoLQ%3D" alt="" loading="lazy"/></p>
<p>åŒæ ·ï¼ŒOllama ä¹Ÿæ”¯æŒå…¼å®¹ OpenAI çš„æ¥å£åè®® ï¼Œå¯ä»¥å®ç°æµå¼å¯¹è¯ï¼Œè§ä¸‹å›¾ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">curl http://localhost:<span class="hljs-number">11434</span>/api/chat -d <span class="hljs-comment">'{</span>
 Â <span class="hljs-string">"model"</span>: <span class="hljs-string">"qwen2.5vl:7b"</span>,
 Â <span class="hljs-string">"messages"</span>: [
 Â   { <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"å†™ä¸€æ®µä»£ç "</span> }
  ]
}<span class="hljs-comment">'</span>
</code></pre>
<p>æ•ˆæœè§ä¸‹å›¾ ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9f803bb3c794d59b1f61528b138ced3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YuH5ZOlSmF2YeWunuaImA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763822598&amp;x-signature=2qoq8esIsQzQACIPSNLRQmSdf54%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">5 æ€»ç»“</h2>
<p>Qwen 2.5-VL 7B ç®€ç›´å°±æ˜¯â€œæœ¬åœ°è§†è§‰å°é’¢ç‚®â€ï¼Œå„ç§å›¾åƒä¿¡æ¯éƒ½èƒ½ä¸€æŠŠæŠ“ï¼Œæ— è®ºç»™å®ƒæˆªå›¾ã€ç¥¨æ®ã€å›¾è¡¨è¿˜æ˜¯å¤æ‚åœºæ™¯ï¼Œå®ƒéƒ½èƒ½æœ‰æ‰€ä½œä¸ºã€‚</p>
<p>ç¬”è€…è®¤ä¸ºå®ƒå°¤å…¶é€‚åˆåœ¨å¦‚ä¸‹åœºæ™¯ä¸­å‘æŒ¥ä½œç”¨ï¼š</p>
<ul>
<li><strong>æ–‡æ¡£å’Œç¥¨æ®è§£æ</strong>ï¼šå‘ç¥¨ã€åˆåŒã€æŠ¥è¡¨ã€æ‰«æä»¶ï¼Œä¸€æ¬¡æ¨ç†å³å¯æå–æ–‡å­—å¹¶ç”Ÿæˆç»“æ„åŒ–æ•°æ®</li>
<li><strong>è¡¨æ ¼ä¸å›¾è¡¨è§£æ</strong>ï¼šè´¢åŠ¡æŠ¥è¡¨ã€ç»Ÿè®¡å›¾è¡¨ï¼Œå¿«é€Ÿæå–è¡¨å¤´å’Œæ•°æ®ï¼Œæ–¹ä¾¿åç»­åˆ†æ</li>
<li><strong>å›¾ç‰‡åœºæ™¯ç†è§£</strong>ï¼šä»“åº“ã€æœºæˆ¿ã€åŠå…¬å®¤ç­‰ç…§ç‰‡ï¼Œè‡ªåŠ¨è¯†åˆ«ç‰©ä½“å’Œæ•´ä½“åœºæ™¯</li>
<li><strong>å¤šæ¨¡æ€é—®ç­”</strong>ï¼šç»“åˆå›¾ç‰‡å’Œæ–‡æœ¬å†…å®¹å›ç­”é—®é¢˜ï¼Œæ”¯æŒç§‘ç ”ã€æ•™è‚²æˆ–äº§å“åŸå‹</li>
<li><strong>å†…å®¹å®¡æ ¸ä¸åˆè§„æ£€æµ‹</strong>ï¼šè¯†åˆ«æ•æ„Ÿæ–‡å­—æˆ–è¿è§„å›¾åƒï¼Œæœ¬åœ°éƒ¨ç½²ä¿æŠ¤éšç§</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¦‚ä½•ä½¿ç”¨Superpowers MCPå¼ºåˆ¶Claude Codeåœ¨ç¼–ç å‰è¿›è¡Œè§„åˆ’]]></title>    <link>https://juejin.cn/post/7572714389922889768</link>    <guid>https://juejin.cn/post/7572714389922889768</guid>    <pubDate>2025-11-15T14:51:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572714389922889768" data-draft-id="7572524368878927906" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¦‚ä½•ä½¿ç”¨Superpowers MCPå¼ºåˆ¶Claude Codeåœ¨ç¼–ç å‰è¿›è¡Œè§„åˆ’"/> <meta itemprop="keywords" content="Claude"/> <meta itemprop="datePublished" content="2025-11-15T14:51:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜¯é­”ä¸¸å•Š"/> <meta itemprop="url" content="https://juejin.cn/user/3217622495411292"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¦‚ä½•ä½¿ç”¨Superpowers MCPå¼ºåˆ¶Claude Codeåœ¨ç¼–ç å‰è¿›è¡Œè§„åˆ’
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3217622495411292/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜¯é­”ä¸¸å•Š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T14:51:54.000Z" title="Sat Nov 15 2025 14:51:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.trevorlasn.com%2Fblog%2Fsuperpowers-claude-code-skills" target="_blank" title="https://www.trevorlasn.com/blog/superpowers-claude-code-skills" ref="nofollow noopener noreferrer">è½¬è½½</a></p>
<p>Superpowersæ˜¯ä¸€ä¸ªå¼ºåˆ¶æ‰§è¡Œç³»ç»ŸåŒ–å·¥ä½œæµçš„MCPã€‚æˆ‘ä½¿ç”¨å®ƒå°†skillcraftå‡çº§åˆ°Next.js 16ï¼Œæ²¡æœ‰é—æ¼ä»»ä½•ä¸€ä¸ªæ–‡ä»¶ã€‚</p>
<p>æˆ‘è¿‡å»å‡ ä¸ªæœˆä¸€ç›´åœ¨ç”¨Claudeæ„å»ºskillcraft.aiã€‚Claudeå¾ˆæ“…é•¿å¿«é€Ÿç¼–å†™ä»£ç ï¼Œä½†å®ƒæœ‰ä¸€ä¸ªé—®é¢˜ï¼šå®ƒç»å¸¸è·³è¿‡æ­¥éª¤ã€‚</p>
<p>å½“æˆ‘è®©Claudeå¸®åŠ©è¿ç§»æŸä¸ªå¤§å‹é¡¹ç›®æ—¶ï¼Œå®ƒä¼šç«‹å³å¼€å§‹å»ºè®®ä¿®æ”¹ã€‚æ²¡æœ‰è§„åˆ’é˜¶æ®µã€‚æ²¡æœ‰"è®©æˆ‘å…ˆæ‰¾åˆ°æ‰€æœ‰éœ€è¦æ›´æ–°çš„æ–‡ä»¶"ã€‚åªæ˜¯ç›´æ¥è¿›å…¥ä»£ç ä¿®æ”¹å¹¶æœŸæœ›è·å¾—æœ€å¥½çš„ç»“æœã€‚</p>
<p>è¿™å°±æ˜¯ä½ é—æ¼æ–‡ä»¶çš„æ–¹å¼ã€‚è¿™å°±æ˜¯ä½ å‘å¸ƒbugçš„æ–¹å¼ã€‚</p>
<p>Superpowersæ˜¯ä¸€ä¸ªè§£å†³è¿™ä¸ªé—®é¢˜MCPã€‚å®ƒåŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªç»“æ„åŒ–å·¥ä½œæµåº“â€”â€”æµ‹è¯•ã€è°ƒè¯•ã€è§„åˆ’â€”â€”Claude Codeä¼šè‡ªåŠ¨åŠ è½½å¹¶çœŸæ­£éµå¾ªçš„å·¥ä½œæµã€‚</p>
<p>Claude Codeä¸­çš„skillæ˜¯ä¸€ä¸ªåŒ…å«æŒ‡ä»¤ã€è„šæœ¬å’Œèµ„æºçš„æ–‡ä»¶å¤¹ï¼ŒClaudeåœ¨éœ€è¦æ—¶ä¼šåŠ è½½å®ƒã€‚è¿™æ˜¯Anthropicçš„Agent SkillsåŠŸèƒ½çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥åŠŸèƒ½å¯åœ¨Claudeåº”ç”¨ã€Claude Codeå’ŒAPIä¸­å·¥ä½œã€‚æ¯ä¸ªskillå®šä¹‰äº†å®ƒä½•æ—¶é€‚ç”¨ã€éµå¾ªä»€ä¹ˆæµç¨‹ä»¥åŠä¸èƒ½èµ°ä»€ä¹ˆæ·å¾„ã€‚å½“ä½ å¼€å§‹ä¸€ä¸ªåŒ¹é…skillçš„ä»»åŠ¡æ—¶ï¼ŒClaudeä¼šæ‰«æå¯ç”¨çš„skillsï¼Œæ‰¾åˆ°åŒ¹é…é¡¹å¹¶è‡ªåŠ¨åŠ è½½å®ƒã€‚</p>
<p>æˆ‘ç»å¸¸ä½¿ç”¨ä¸‰ä¸ªæ–œæ å‘½ä»¤ï¼š</p>





















<table><thead><tr><th>å‘½ä»¤</th><th>å®ƒçš„ä½œç”¨</th></tr></thead><tbody><tr><td><code>/superpowers:brainstorm</code></td><td>åœ¨ç¼–ç å‰å®Œå–„ç²—ç•¥çš„æƒ³æ³•</td></tr><tr><td><code>/superpowers:write-plan</code></td><td>åˆ›å»ºè¯¦ç»†çš„å®æ–½è®¡åˆ’</td></tr><tr><td><code>/superpowers:execute-plan</code></td><td>ä»¥æ‰¹æ¬¡æ–¹å¼è¿è¡Œè®¡åˆ’å¹¶è¿›è¡Œå®¡æŸ¥æ£€æŸ¥ç‚¹</td></tr></tbody></table>
<p>æˆ‘å°†Superpowersæ·»åŠ åˆ°æˆ‘çš„<code>CLAUDE.md</code>ä¸­ï¼Œè¿™æ ·å®ƒåœ¨æ¯æ¬¡ä¼šè¯æ—¶éƒ½ä¼šè‡ªåŠ¨åŠ è½½ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Project Setup</span>

Use the Superpowers MCP <span class="hljs-keyword">for</span> <span class="hljs-built_in">all</span> development work. Load it at session start.
</code></pre>
<p>è¿™å¯¹tokenæ•ˆç‡æ¥è¯´æ„ä¹‰é‡å¤§â€”â€”Claudeä¸å†ç‡ƒçƒ§contextè¯•å›¾å°†æ‰€æœ‰å†…å®¹ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œè€Œæ˜¯å°†å·¥ä½œåˆ†æˆ5åˆ†é’Ÿçš„å—å¹¶å°†è¿›åº¦å†™å…¥markdownæ–‡ä»¶ã€‚ä½ æ°¸è¿œä¸ä¼šåœ¨ä¼šè¯ä¹‹é—´ä¸¢å¤±ä¸Šä¸‹æ–‡ï¼Œå› ä¸ºè®¡åˆ’å°±åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯é”å®šåœ¨ä¸‰å°æ—¶å‰è¾¾åˆ°tokené™åˆ¶çš„æŸä¸ªå¯¹è¯ä¸­ã€‚</p>
<p>ç”Ÿæˆçš„æ–‡ä»¶çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs language-ruby" lang="ruby">~<span class="hljs-regexp">/.config/superpowers</span><span class="hljs-regexp">/
â””â”€â”€ plans/</span>
    â””â”€â”€ nextjs-<span class="hljs-number">16</span>-migration/
        â”œâ”€â”€ <span class="hljs-variable constant_">PLAN</span>.md                  <span class="hljs-comment"># Complete migration roadmap</span>
        â”œâ”€â”€ progress.md              <span class="hljs-comment"># Current status and completed tasks</span>
        â””â”€â”€ verification.md          <span class="hljs-comment"># Test commands and success criteria</span>
</code></pre>
<p><code>PLAN.md</code>æ–‡ä»¶åŒ…å«æ‰€æœ‰å†…å®¹ï¼š</p>





































<table><thead><tr><th>éƒ¨åˆ†</th><th>åŒ…å«å†…å®¹</th></tr></thead><tbody><tr><td>Overview</td><td>éœ€è¦æ”¹å˜ä»€ä¹ˆä»¥åŠä¸ºä»€ä¹ˆ</td></tr><tr><td>Phase 1</td><td>APIè·¯ç”±é‡æ„ï¼ˆ23ä¸ªæ–‡ä»¶ï¼‰</td></tr><tr><td>Phase 2</td><td>ç»„ä»¶æ—¶é—´æ•æ„Ÿæ€§ä¿®å¤</td></tr><tr><td>Phase 3</td><td>Context provider Suspenseè¾¹ç•Œ</td></tr><tr><td>Phase 4</td><td>å¯ç”¨cacheComponents</td></tr><tr><td>Phase 5</td><td>æµ‹è¯•å’ŒéªŒè¯</td></tr><tr><td>Rollback</td><td>å¦‚æœå‡ºç°æ•…éšœæ€ä¹ˆåŠ</td></tr></tbody></table>
<p>Skillcraftè¿è¡Œåœ¨Next.jsä¸Šï¼Œæˆ‘æƒ³å¯ç”¨Next.js 16ä¸­çš„æ–°<code>cacheComponents</code>åŠŸèƒ½ã€‚è¿™ä¸ªä¸œè¥¿ä¼šç ´åå„ç§æ¨¡å¼â€”â€”è®¿é—®<code>searchParams</code>çš„APIè·¯ç”±ï¼Œä½¿ç”¨<code>new Date()</code>çš„ç»„ä»¶ï¼Œæ²¡æœ‰Suspenseè¾¹ç•Œçš„context providersã€‚</p>
<p>æˆ‘è¿è¡Œ<code>/superpowers:write-plan</code>å¹¶å¾—åˆ°äº†ä¸€ä¸ª500è¡Œçš„è®¡åˆ’ã€‚ä¸æ˜¯ä¸€äº›æ¨¡ç³Šçš„å¤§çº²ï¼Œè€Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„è·¯çº¿å›¾ï¼šæ‰€æœ‰23ä¸ªéœ€è¦æ›´æ”¹çš„APIè·¯ç”±æ–‡ä»¶ï¼Œä¸¤ä¸ªä¼šç ´åé¢„æ¸²æŸ“çš„ä½¿ç”¨<code>new Date()</code>çš„ç»„ä»¶ï¼Œéœ€è¦Suspenseè¾¹ç•Œçš„ç‰¹å®šcontext providersï¼Œä»¥åŠä¸€ä¸ªå¸¦æœ‰æµ‹è¯•æ£€æŸ¥ç‚¹çš„4å¤©æ—¶é—´çº¿ã€‚</p>
<p>è¯¥è®¡åˆ’åŒ…å«äº†æ¯ä¸ªé˜¶æ®µçš„éªŒè¯å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Test specific endpoints after API refactoring</span>
curl http://localhost:3000/api/leaderboard
curl http://localhost:3000/api/courses/recent
curl http://localhost:3000/api/topics
</code></pre>
<p>å®ƒè®°å½•äº†ä¿®æ”¹å‰åçš„æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Before: Incompatible with cacheComponents</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> runtime = <span class="hljs-string">'nodejs'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> dynamic = <span class="hljs-string">'force-dynamic'</span>

<span class="hljs-comment">// After: Clean (API routes are dynamic by default)</span>
<span class="hljs-comment">// Note: With cacheComponents enabled, API routes are dynamic by default</span>
</code></pre>
<p>å®ƒç”šè‡³å®šä¹‰äº†æˆåŠŸæ ‡å‡†ï¼ˆæ„å»ºæˆåŠŸï¼ŒCLSä¿æŒåœ¨0.000ï¼ŒLighthouseåˆ†æ•°â‰¥ 95ï¼‰å’Œå›æ»šè®¡åˆ’ã€‚</p>
<p>æ²¡æœ‰è¿™ä¸ªè®¡åˆ’ï¼Œæˆ‘ä¼šå¯ç”¨cacheComponentsï¼Œé‡åˆ°é”™è¯¯ï¼Œé€ä¸€ä¿®å¤ï¼Œå¹¶è‚¯å®šä¼šé—æ¼è¾¹ç¼˜æƒ…å†µã€‚è¿ç§»ä¼šéœ€è¦å‡ å¤©çš„ååº”å¼è°ƒè¯•ã€‚æœ‰äº†è®¡åˆ’ï¼Œåœ¨æ¥è§¦ä»»ä½•ä»£ç ä¹‹å‰æˆ‘å°±æœ‰äº†å®Œæ•´çš„è·¯çº¿å›¾ã€‚</p>
<p>è¯¥åº“åŒ…å«å¤šä¸ªç”¨äºæµ‹è¯•ã€è°ƒè¯•å’Œå¼€å‘å·¥ä½œæµçš„skillsï¼š</p>





















<table><thead><tr><th>Skill</th><th>å®ƒå¼ºåˆ¶æ‰§è¡Œçš„å†…å®¹</th></tr></thead><tbody><tr><td><code>test-driven-development</code></td><td>RED-GREEN-REFACTORï¼šç¼–å†™æµ‹è¯•ï¼Œè§‚å¯Ÿå¤±è´¥ï¼Œç¼–å†™ä»£ç </td></tr><tr><td><code>systematic-debugging</code></td><td>4é˜¶æ®µæ–¹æ³•ï¼šæ ¹æœ¬åŸå› è°ƒæŸ¥ â†’ æ¨¡å¼åˆ†æ â†’ å‡è®¾æµ‹è¯• â†’ å®æ–½</td></tr><tr><td><code>verification-before-completion</code></td><td>åœ¨å£°ç§°å·¥ä½œå®Œæˆä¹‹å‰è¿è¡ŒéªŒè¯å‘½ä»¤å¹¶ç¡®è®¤è¾“å‡º</td></tr></tbody></table>
<p>è¿™äº›skillså­—é¢ä¸Šé˜»æ­¢ä½ è·³è¿‡æ­¥éª¤ã€‚å†ä¹Ÿæ²¡æœ‰"æˆ‘è®¤ä¸ºå®ƒæœ‰æ•ˆ"è€Œæ²¡æœ‰è¯æ˜çš„æƒ…å†µã€‚</p>
<p>å¦‚æœä½ æ­£åœ¨è¿›è¡Œè¿ç§»å¹¶éœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ¨¡å¼çš„æ‰€æœ‰å®ä¾‹ï¼ŒSuperpowersä¼šæ‰¾åˆ°å®ƒä»¬æ‰€æœ‰ã€‚å¦‚æœä½ æ­£åœ¨è°ƒè¯•å¹¶å³å°†çŒœæµ‹ä¿®å¤æ–¹æ¡ˆï¼Œå®ƒä¼šé˜»æ­¢ä½ å¹¶è®©ä½ å…ˆè°ƒæŸ¥æ ¹æœ¬åŸå› ã€‚å¦‚æœé—æ¼ä¸€ä¸ªæ–‡ä»¶ä¼šç ´åç”Ÿäº§ç¯å¢ƒï¼Œå®ƒä¼šåœ¨ä½ å®Œæˆä¹‹å‰è®©ä½ éªŒè¯ä¸€åˆ‡ã€‚</p>
<h2 data-id="heading-0">å®‰è£…</h2>
<p>Superpowersä¸Claude Codeï¼ˆCLIå·¥å…·ï¼‰ä¸€èµ·å·¥ä½œã€‚é€šè¿‡æ’ä»¶å¸‚åœºå®‰è£…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># In Claude Code</span>
/plugin marketplace add obra/superpowers-marketplace
/plugin install superpowers@superpowers-marketplace
</code></pre>
<p>æˆ–è€…æ‰‹åŠ¨å°†å…¶æ·»åŠ åˆ°<code>.claude/plugins.json</code>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"plugins"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"superpowers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"owner"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"obra"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"repo"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"superpowers"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å½“Claude Codeå¯åŠ¨æ—¶ï¼Œä½ ä¼šçœ‹åˆ°skillsåŠ è½½çš„ç¡®è®¤ä¿¡æ¯ã€‚ç„¶ååªéœ€ä½¿ç”¨æ–œæ å‘½ä»¤ï¼šåœ¨å¼€å§‹å¤æ‚åŠŸèƒ½ä¹‹å‰ä½¿ç”¨<code>/superpowers:brainstorm</code>ï¼Œå¯¹äºè¿ç§»æˆ–å¤šæ–‡ä»¶é‡æ„ä½¿ç”¨<code>/superpowers:write-plan</code>ï¼Œä½¿ç”¨<code>/superpowers:execute-plan</code>ä»¥æ‰¹æ¬¡æ–¹å¼è¿è¡Œè¿™äº›è®¡åˆ’ã€‚</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åç«¯å¼€å‘å¦‚ä½•å°†åˆ›æ–°è½¬åŒ–ä¸ºä¸“åˆ©ï¼Ÿæ¡ˆä¾‹ã€æµç¨‹ä¸å®æ“æŒ‡å—]]></title>    <link>https://juejin.cn/post/7572403510468296747</link>    <guid>https://juejin.cn/post/7572403510468296747</guid>    <pubDate>2025-11-15T13:13:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572403510468296747" data-draft-id="7572481101710000182" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åç«¯å¼€å‘å¦‚ä½•å°†åˆ›æ–°è½¬åŒ–ä¸ºä¸“åˆ©ï¼Ÿæ¡ˆä¾‹ã€æµç¨‹ä¸å®æ“æŒ‡å—"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-15T13:13:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="oioihoii"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åç«¯å¼€å‘å¦‚ä½•å°†åˆ›æ–°è½¬åŒ–ä¸ºä¸“åˆ©ï¼Ÿæ¡ˆä¾‹ã€æµç¨‹ä¸å®æ“æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    oioihoii
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T13:13:16.000Z" title="Sat Nov 15 2025 13:13:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨æŠ€æœ¯é©±åŠ¨çš„å•†ä¸šç¯å¢ƒä¸­ï¼Œä¸“åˆ©ä¸ä»…æ˜¯æ³•å¾‹ä¿æŠ¤çš„ç›¾ç‰Œï¼Œæ›´æ˜¯ä¼ä¸šæ ¸å¿ƒç«äº‰åŠ›çš„ä½“ç°ã€‚å¾ˆå¤šåç«¯å¼€å‘è€…å¯èƒ½è®¤ä¸ºä¸“åˆ©ç¦»æ—¥å¸¸ coding å¾ˆé¥è¿œï¼Œä½†å®é™…ä¸Šï¼Œ<strong>åç«¯æŠ€æœ¯æ–¹æ¡ˆå®Œå…¨å¯ä»¥ç”³è¯·ä¸“åˆ©</strong>ï¼Œåªè¦å®ƒèƒ½è§£å†³å…·ä½“çš„æŠ€æœ¯é—®é¢˜å¹¶äº§ç”ŸæŠ€æœ¯æ•ˆæœã€‚æœ¬æ–‡å°†ç»“åˆçœŸå®æ¡ˆä¾‹ï¼Œä¸ºä½ è§£æåç«¯ä¸“åˆ©ä»æ„æ€åˆ°è½åœ°çš„å…¨è¿‡ç¨‹ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ ä¸ºä»€ä¹ˆåç«¯åˆ›æ–°å¯ä»¥ç”³è¯·ä¸“åˆ©ï¼Ÿ</h2>
<p>è®¸å¤šäººæœ‰ä¸€ä¸ªè¯¯è§£ï¼Œè®¤ä¸ºâ€œè½¯ä»¶ä»£ç â€æˆ–â€œç®—æ³•â€ä¸èƒ½ç”³è¯·ä¸“åˆ©ã€‚å®é™…ä¸Šï¼Œæ³•å¾‹æ’æ–¥çš„æ˜¯<strong>çº¯ç²¹çš„æ•°å­¦ç®—æ³•ã€å•†ä¸šæ–¹æ³•æˆ–æ™ºåŠ›æ´»åŠ¨è§„åˆ™</strong>æœ¬èº«ï¼Œä½†å½“ä½ çš„ç¨‹åº<strong>ä½œä¸ºæŠ€æœ¯æ–¹æ¡ˆçš„ä¸€éƒ¨åˆ†</strong>ï¼Œç”¨äºè§£å†³å…·ä½“æŠ€æœ¯é—®é¢˜æ—¶ï¼Œå®ƒå°±å…·å¤‡äº†ç”³è¯·ä¸“åˆ©çš„æ½œåŠ›ã€‚</p>
<p>æ ¹æ®ã€Šä¸“åˆ©å®¡æŸ¥æŒ‡å—ã€‹ï¼Œåˆ¤æ–­ä¸€ä¸ªæ¶‰åŠè®¡ç®—æœºç¨‹åºçš„å‘æ˜æ˜¯å¦å¯ä¸“åˆ©ï¼Œå…³é”®åœ¨äºå®ƒæ˜¯å¦æ„æˆäº†ä¸€ä¸ª <strong>â€œæŠ€æœ¯æ–¹æ¡ˆâ€</strong> ï¼Œå³ï¼š</p>
<ul>
<li><strong>è§£å†³çš„æ˜¯æŠ€æœ¯é—®é¢˜</strong>ï¼ˆå¦‚æå‡ç¡¬ä»¶æ•ˆèƒ½ã€ä¼˜åŒ–ç½‘ç»œèµ„æºã€ä¿éšœæ•°æ®å®‰å…¨ï¼‰</li>
<li><strong>é‡‡ç”¨äº†éµå¾ªè‡ªç„¶è§„å¾‹çš„æŠ€æœ¯æ‰‹æ®µ</strong>ï¼ˆé€šè¿‡è®¡ç®—æœºç¨‹åºå¯¹è®¡ç®—æœºå†…éƒ¨æˆ–å¤–éƒ¨å¯¹è±¡è¿›è¡Œæ§åˆ¶æˆ–å¤„ç†ï¼‰</li>
<li><strong>è·å¾—äº†ç¬¦åˆè‡ªç„¶è§„å¾‹çš„æŠ€æœ¯æ•ˆæœ</strong>ï¼ˆå¦‚é™ä½æœåŠ¡å™¨è´Ÿè½½ã€æé«˜æ•°æ®å¤„ç†é€Ÿåº¦ï¼‰</li>
</ul>
<p><strong>åç«¯ä¸“åˆ©ä¿æŠ¤çš„æ˜¯ä»€ä¹ˆï¼Ÿ</strong>
ä¸ä¿æŠ¤ä»£ç è¡¨è¾¾å½¢å¼çš„<strong>è½¯ä»¶è‘—ä½œæƒ</strong>ä¸åŒï¼Œä¸“åˆ©ä¿æŠ¤çš„æ˜¯è½¯ä»¶çš„è®¾è®¡<strong>æ„æ€ä¸è§£å†³æ–¹æ¡ˆ</strong>ã€‚è¿™æ„å‘³ç€ï¼Œå³ä¾¿ä»–äººç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€é‡å†™äº†ä½ çš„æ ¸å¿ƒé€»è¾‘ï¼Œåªè¦å®ç°äº†ç›¸åŒçš„æŠ€æœ¯æ–¹æ¡ˆï¼Œä¹Ÿå¯èƒ½æ„æˆä¾µæƒã€‚</p>
<h2 data-id="heading-1">äºŒã€ çœŸå®æ¡ˆä¾‹ï¼šåç«¯ä¸“åˆ©å°±åœ¨æˆ‘ä»¬èº«è¾¹</h2>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›è¿‘å¹´æ¥å·²å…¬å¼€çš„çœŸå®åç«¯ä¸“åˆ©æ¡ˆä¾‹ï¼Œå®ƒä»¬éƒ½æºäºè§£å†³å®é™…å¼€å‘ä¸­çš„ç—›ç‚¹ã€‚</p>





























<table><thead><tr><th align="left">ä¸“åˆ©åç§°</th><th align="left">ç”³è¯·äºº/ä¸“åˆ©æƒäºº</th><th align="left">æ ¸å¿ƒè¦è§£å†³çš„æŠ€æœ¯é—®é¢˜</th><th align="left">æŠ€æœ¯æ–¹æ¡ˆæ¦‚è§ˆ</th></tr></thead><tbody><tr><td align="left"><strong>ã€ŠæœåŠ¡æ³¨å†ŒåŠæ‹¦æˆªæ–¹æ³•ã€è£…ç½®ã€ç”µå­è®¾å¤‡åŠå¯è¯»å­˜å‚¨ä»‹è´¨ã€‹</strong></td><td align="left">å¤©å†•ç§‘æŠ€</td><td align="left">è§£å†³åŸç”ŸgRPCæ¡†æ¶åœ¨æœåŠ¡ç®¡ç†ä¸­å­˜åœ¨çš„<strong>ä»£ç å†—ä½™ã€æ‹¦æˆªç²’åº¦ç²—ã€åŠ¨æ€æ‰©å±•å›°éš¾</strong>ç­‰é—®é¢˜ã€‚</td><td align="left">å¼•å…¥<strong>Javaè‡ªå®šä¹‰æ³¨è§£</strong>ï¼Œåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å®ŒæˆæœåŠ¡çš„æ³¨å†Œä¸æ‹¦æˆªå™¨çš„ç»‘å®šï¼Œå®ç°äº†<strong>æ–¹æ³•çº§çš„ç²¾å‡†æ‹¦æˆª</strong>å’Œé…ç½®çš„è‡ªåŠ¨åŒ–ã€‚</td></tr><tr><td align="left"><strong>ã€Šåç«¯æœåŠ¡è°ƒç”¨æ–¹æ³•ã€è£…ç½®ã€ç”µå­è®¾å¤‡åŠç¨‹åºäº§å“ã€‹</strong></td><td align="left">æ‹‰å¡æ‹‰</td><td align="left">ä¼˜åŒ–åç«¯æœåŠ¡è°ƒç”¨æ—¶çš„<strong>èµ„æºåˆ©ç”¨ä¸æ•ˆç‡</strong>ï¼Œåˆç†å¤„ç†åŒæ­¥ä¸å¼‚æ­¥ä»»åŠ¡ã€‚</td><td align="left">å°†æœåŠ¡è°ƒç”¨è¯·æ±‚æ³¨å†Œä¸ºIOäº‹ä»¶ï¼Œç”±åŒæ­¥çº¿ç¨‹è½®è¯¢é˜Ÿåˆ—ï¼Œå¹¶æ ¹æ®äº‹ä»¶ç±»å‹<strong>æ™ºèƒ½åˆ†é…ç”±åŒæ­¥çº¿ç¨‹å¤„ç†æˆ–æ´¾å‘ç»™å¼‚æ­¥çº¿ç¨‹</strong>ï¼Œå¤„ç†å®Œæˆåå†å›å½’åŒæ­¥é˜Ÿåˆ—ã€‚</td></tr><tr><td align="left"><strong>ã€Šä¸€ç§åŸºäºä¸­é—´å±‚çš„å¤šAgentæ´¾å‘æ–¹æ³•åŠè£…ç½®ã€‹</strong></td><td align="left">æ˜“æ–¹è¾¾åŸºé‡‘</td><td align="left">åœ¨å‰ç«¯ä¸åç«¯ä¹‹é—´å®ç°<strong>ç»Ÿä¸€ã€æ ‡å‡†åŒ–çš„æ¥å£è§£è€¦</strong>ï¼Œä»¥é«˜æ•ˆæ´¾å‘å’Œç®¡ç†å¤šä¸ªAI Agentã€‚</td><td align="left">é€šè¿‡ä¸€ä¸ª<strong>ä¸­é—´å±‚</strong>å¯¹ç”¨æˆ·è¯·æ±‚è¿›è¡Œé¢„å¤„ç†ã€åŒ¹é…ç›®æ ‡Agentã€æ•´åˆç­”å¤æ•°æ®å¹¶è¿”å›ï¼Œå®ç°äº†å‰åç«¯çš„è§£è€¦å’ŒAgentçš„ç²¾å‡†æ´¾å‘ã€‚</td></tr></tbody></table>
<p>ä»è¿™äº›æ¡ˆä¾‹å¯ä»¥çœ‹å‡ºï¼Œåç«¯ä¸“åˆ©å¹¶éé¥ä¸å¯åŠçš„â€œé»‘ç§‘æŠ€â€ï¼Œå®ƒä»¬å¾€å¾€æ˜¯å¯¹<strong>ç°æœ‰æ¡†æ¶çš„ä¼˜åŒ–ã€å¯¹ç‰¹å®šä¸šåŠ¡åœºæ™¯ä¸‹æŠ€æœ¯éš¾é¢˜çš„æ”»å…‹ï¼Œæˆ–æ˜¯è®¾è®¡äº†ä¸€å¥—æ›´é«˜æ•ˆçš„æ¶æ„æ¨¡å¼</strong>ã€‚</p>
<h2 data-id="heading-2">ä¸‰ã€ ä»ä»£ç åˆ°ä¸“åˆ©ï¼šå…³é”®æ­¥éª¤ä¸æ’°å†™æŠ€å·§</h2>
<p>å°†ä½ çš„åç«¯åˆ›æ–°è½¬åŒ–ä¸ºä¸“åˆ©ï¼Œéœ€è¦ç»å†ä¸€ä¸ªç³»ç»Ÿæ€§çš„è¿‡ç¨‹ã€‚</p>
<h3 data-id="heading-3">1. ç¡®å®šæŠ€æœ¯åˆ›æ–°ç‚¹</h3>
<p>è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ã€‚é—®è‡ªå·±ï¼šæˆ‘çš„ä»£ç ç©¶ç«Ÿåœ¨å“ªæ–¹é¢å®ç°äº†çªç ´ï¼Ÿ</p>
<ul>
<li><strong>æ˜¯æ–°çš„ç®—æ³•å—ï¼Ÿ</strong>ï¼ˆå¦‚ä¸€ç§æ–°çš„åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†æœºåˆ¶ï¼‰</li>
<li><strong>æ˜¯ç³»ç»Ÿæ¶æ„çš„ä¼˜åŒ–å—ï¼Ÿ</strong>ï¼ˆå¦‚ä¸€ç§æ–°çš„å¾®æœåŠ¡é—´é€šä¿¡åè®®ï¼‰</li>
<li><strong>æ˜¯æå‡äº†æŸé¡¹æ€§èƒ½æŒ‡æ ‡å—ï¼Ÿ</strong>ï¼ˆå¦‚é€šè¿‡åˆ›æ–°çš„ç¼“å­˜åŒæ­¥ç®—æ³•ï¼Œæé«˜äº†æ•°æ®å¤„ç†é€Ÿåº¦ï¼‰</li>
</ul>
<p><strong>åœ¨ç¡®å®šåˆ›æ–°ç‚¹åï¼ŒåŠ¡å¿…è¿›è¡Œä¸“åˆ©æ£€ç´¢</strong>ï¼Œåˆ©ç”¨Google Patentsã€å„å›½ä¸“åˆ©å±€å®˜ç½‘ç­‰æ•°æ®åº“ï¼Œç¡®è®¤ä½ çš„æƒ³æ³•æ˜¯å¦å…·å¤‡æ–°é¢–æ€§ã€‚</p>
<h3 data-id="heading-4">2. æ’°å†™é«˜è´¨é‡çš„ä¸“åˆ©ç”³è¯·æ–‡ä»¶</h3>
<p>ä¸“åˆ©ç”³è¯·æ–‡ä»¶æœ‰ä¸¥æ ¼çš„æ ¼å¼è¦æ±‚ï¼Œä¸»è¦åŒ…æ‹¬è¯´æ˜ä¹¦ã€æƒåˆ©è¦æ±‚ä¹¦ã€æ‘˜è¦å’Œé™„å›¾ã€‚å¯¹äºåç«¯ä¸“åˆ©ï¼Œä»¥ä¸‹å‡ ç‚¹è‡³å…³é‡è¦ï¼š</p>
<ul>
<li><strong>å¼ºè°ƒâ€œæŠ€æœ¯ä¸‰è¦ç´ â€</strong>ï¼šåœ¨æ•´ä¸ªè¯´æ˜ä¹¦ä¸­ï¼Œåå¤æ¸…æ™°åœ°é˜è¿° <strong>â€œæŠ€æœ¯é—®é¢˜â€ã€â€œæŠ€æœ¯æ‰‹æ®µâ€å’Œâ€œæŠ€æœ¯æ•ˆæœâ€</strong> ã€‚</li>
<li><strong>å–„ç”¨é™„å›¾</strong>ï¼šç»˜åˆ¶æ¸…æ™°çš„<strong>ç³»ç»Ÿæ¶æ„å›¾ã€æ•°æ®æµç¨‹å›¾ã€æ¨¡å—äº¤äº’å›¾</strong>ï¼Œè¿™èƒ½å¸®åŠ©å®¡æŸ¥å‘˜ç›´è§‚åœ°ç†è§£ä½ çš„æ–¹æ¡ˆã€‚</li>
<li><strong>å†™å¥½æƒåˆ©è¦æ±‚ä¹¦</strong>ï¼šè¿™æ˜¯å®šä¹‰ä¸“åˆ©ä¿æŠ¤èŒƒå›´çš„æ³•å¾‹æ ¸å¿ƒã€‚é€šå¸¸éœ€è¦å‡†å¤‡ï¼š
<ul>
<li><strong>æ–¹æ³•æƒåˆ©è¦æ±‚</strong>ï¼šæè¿°æ‰§è¡Œè¯¥è½¯ä»¶åŠŸèƒ½çš„å„ä¸ªæ­¥éª¤ã€‚</li>
<li><strong>è™šæ‹Ÿè£…ç½®æƒåˆ©è¦æ±‚</strong>ï¼šæè¿°æ‰§è¡Œè¯¥è½¯ä»¶åŠŸèƒ½çš„è™šæ‹ŸåŠŸèƒ½æ¨¡å—ï¼ˆä¾‹å¦‚ï¼šâ€œä¸€ç§â€¦è£…ç½®ï¼ŒåŒ…æ‹¬ï¼šæ¥æ”¶æ¨¡å—ã€å¤„ç†æ¨¡å—ã€å‘é€æ¨¡å—â€ï¼‰ã€‚</li>
<li><strong>ï¼ˆå¯é€‰ï¼‰éè™šæ‹Ÿè£…ç½®æƒåˆ©è¦æ±‚</strong>ï¼šå¦‚æœè€ƒè™‘æœªæ¥åœ¨ç¾å›½ç­‰åœ°åŒºå¸ƒå±€ï¼Œè¿˜éœ€è¦å‡†å¤‡åŒ…å«å¤„ç†å™¨ã€å­˜å‚¨å™¨ç­‰ç¡¬ä»¶ç»“æ„çš„æƒåˆ©è¦æ±‚ï¼Œä¾‹å¦‚â€œä¸€ç§â€¦è£…ç½®ï¼ŒåŒ…æ‹¬å¤„ç†å™¨ï¼Œæ‰€è¿°å¤„ç†å™¨ç”¨äºâ€¦â€ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5">3. åº”å¯¹å®¡æŸ¥æµç¨‹</h3>
<p>æäº¤ç”³è¯·åï¼Œä¸“åˆ©å±€ä¼šè¿›è¡Œå®¡æŸ¥ã€‚å®¡æŸ¥å‘˜å¯èƒ½ä¼šå°±æŠ€æœ¯çš„æ–°é¢–æ€§ã€åˆ›é€ æ€§ç­‰æå‡ºæ„è§ã€‚ä½ éœ€è¦ä¸ä¸“åˆ©ä»£ç†äººå¯†åˆ‡é…åˆï¼Œè¯¦ç»†å›åº”å®¡æŸ¥å‘˜çš„ç–‘é—®ï¼Œå¹¶æä¾›å……åˆ†çš„æŠ€æœ¯è§£é‡Šã€‚</p>
<h2 data-id="heading-6">å››ã€ ç»™åç«¯å¼€å‘è€…çš„ä¸“åˆ©æ„æ€å¯å‘</h2>
<p>ä½ çš„æ—¥å¸¸å·¥ä½œå¯èƒ½å°±è•´å«ç€ä¸“åˆ©çš„ç§å­ï¼š</p>
<ul>
<li><strong>èšç„¦æ€§èƒ½ç“¶é¢ˆ</strong>ï¼šä½ æ˜¯å¦è®¾è®¡äº†ä¸€ç§å·§å¦™çš„<strong>æ•°æ®åº“è¿æ¥æ± ç®¡ç†æ–¹æ¡ˆ</strong>ï¼Œæ˜¾è‘—é™ä½äº†é«˜å¹¶å‘ä¸‹çš„å“åº”å»¶è¿Ÿï¼Ÿ</li>
<li><strong>è§£å†³ä¸šåŠ¡ä¸€è‡´æ€§</strong>ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä½ æ˜¯å¦å‘æ˜äº†ä¸€ç§<strong>æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ</strong>ï¼Œç¡®ä¿äº†è·¨æœåŠ¡çš„æ•°æ®å‡†ç¡®ï¼Ÿ</li>
<li><strong>ä¼˜åŒ–èµ„æºè°ƒåº¦</strong>ï¼šä½ æ˜¯å¦æ”¹è¿›äº†<strong>Kubernetesçš„è°ƒåº¦å™¨</strong>ï¼Œä½¿å¾—é›†ç¾¤è®¡ç®—èµ„æºåˆ©ç”¨ç‡å¤§å¹…æå‡ï¼Ÿ</li>
<li><strong>å¢å¼ºç³»ç»Ÿå®‰å…¨</strong>ï¼šä½ æ˜¯å¦è®¾è®¡äº†ä¸€å¥—<strong>APIè®¿é—®æƒé™çš„åŠ¨æ€æ ¡éªŒæœºåˆ¶</strong>ï¼Œæœ‰æ•ˆé˜²å¾¡äº†æœªæˆæƒè®¿é—®ï¼Ÿ</li>
</ul>
<h2 data-id="heading-7">äº”ã€ é‡è¦æé†’</h2>
<ul>
<li><strong>å¯»æ±‚ä¸“ä¸šå¸®åŠ©</strong>ï¼šä¸“åˆ©ç”³è¯·ï¼Œå°¤å…¶æ˜¯æƒåˆ©è¦æ±‚ä¹¦çš„æ’°å†™ï¼Œä¸“ä¸šæ€§æå¼ºã€‚å¼ºçƒˆå»ºè®®ä¸<strong>ä¸“åˆ©ä»£ç†äºº</strong>åˆä½œï¼Œç‰¹åˆ«æ˜¯æ‰¾æœ‰è®¡ç®—æœºè½¯ä»¶é¢†åŸŸç»éªŒçš„ä»£ç†äººï¼Œèƒ½æ˜¾è‘—æé«˜æˆåŠŸç‡ã€‚</li>
<li><strong>æ³¨æ„ç”³è¯·æ—¶æœº</strong>ï¼šåœ¨ç”³è¯·ä¸“åˆ©ä¹‹å‰ï¼Œ<strong>åˆ‡å‹¿åœ¨æŠ€æœ¯ä¼šè®®ã€è®ºå›æˆ–å­¦æœ¯æœŸåˆŠä¸Šè¿‡æ—©å…¬å¼€ä½ çš„æŠ€æœ¯ç»†èŠ‚</strong>ï¼Œå¦åˆ™å¯èƒ½ä¼šç ´åå…¶æ–°é¢–æ€§ï¼Œå¯¼è‡´æ— æ³•æˆæƒã€‚</li>
<li><strong>å…¬å¸æ”¿ç­–ä¸å¥–åŠ±</strong>ï¼šå¾ˆå¤šç§‘æŠ€å…¬å¸è®¾æœ‰ä¸“é—¨çš„ä¸“åˆ©å§”å‘˜ä¼šå’Œå¥–åŠ±æœºåˆ¶ï¼Œé¼“åŠ±å‘˜å·¥ç”³æŠ¥ã€‚ç§¯æäº†è§£å¹¶åˆ©ç”¨å…¬å¸å†…éƒ¨æ”¿ç­–ï¼Œè¿™ä¸ä»…èƒ½ä¿æŠ¤åˆ›æ–°ï¼Œè¿˜å¯èƒ½ä¸ºä½ å¸¦æ¥ä¸°åšçš„å›æŠ¥ã€‚</li>
</ul>
<h2 data-id="heading-8">ç»“è¯­</h2>
<p>å°†åç«¯åˆ›æ–°ç”³è¯·ä¸ºä¸“åˆ©ï¼Œæ˜¯ä¸€ä¸ªå°†æŠ€æœ¯æ™ºæ…§è½¬åŒ–ä¸ºæ³•å¾‹èµ„äº§å’Œå•†ä¸šç«äº‰åŠ›çš„è¿‡ç¨‹ã€‚å®ƒå¹¶éé«˜ä¸å¯æ”€ï¼Œåªè¦ä½ å–„äºå‘ç°ã€å‹¤äºæ€»ç»“ï¼Œå¹¶æ‡‚å¾—è¿ç”¨è§„åˆ™ï¼Œä½ çš„ä»£ç åŒæ ·å¯ä»¥æˆä¸ºå—æ³•å¾‹ä¿æŠ¤çš„å‘æ˜åˆ›é€ ã€‚</p>
<p>å¸Œæœ›æœ¬æ–‡èƒ½ä¸ºä½ æ‰“å¼€ä¸€æ‰‡æ–°çš„å¤§é—¨ã€‚å¦‚æœä½ æ­£åœ¨æŸä¸ªæŠ€æœ¯ç‚¹ä¸Šæœ‰æ‰€çªç ´ï¼Œä¸å¦¨ç°åœ¨å°±æŒ‰ç…§æ–‡ä¸­çš„æ€è·¯è¯„ä¼°ä¸€ä¸‹å®ƒçš„ä¸“åˆ©æ½œåŠ›å§ï¼</p>
<hr/>
<p><strong>å…è´£å£°æ˜</strong>ï¼šæœ¬æ–‡å†…å®¹ä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆä»»ä½•å½¢å¼çš„æ³•å¾‹å»ºè®®ã€‚åœ¨å…·ä½“ç”³è¯·ä¸“åˆ©æ—¶ï¼Œè¯·åŠ¡å¿…å’¨è¯¢å¹¶å§”æ‰˜ä¸“ä¸šçš„ä¸“åˆ©ä»£ç†æœºæ„æˆ–å¾‹å¸ˆã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ–‡å¿ƒ5.0ï¼š2.4ä¸‡äº¿å‚æ•°çš„â€œå…¨èƒ½AIâ€ï¼Œå®ƒçœŸåšåˆ°äº†å—ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7572459217811832895</link>    <guid>https://juejin.cn/post/7572459217811832895</guid>    <pubDate>2025-11-15T13:13:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572459217811832895" data-draft-id="7572403510468280363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ–‡å¿ƒ5.0ï¼š2.4ä¸‡äº¿å‚æ•°çš„â€œå…¨èƒ½AIâ€ï¼Œå®ƒçœŸåšåˆ°äº†å—ï¼Ÿ"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-15T13:13:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¢¨é£å¦‚é›ª"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ–‡å¿ƒ5.0ï¼š2.4ä¸‡äº¿å‚æ•°çš„â€œå…¨èƒ½AIâ€ï¼Œå®ƒçœŸåšåˆ°äº†å—ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¢¨é£å¦‚é›ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T13:13:31.000Z" title="Sat Nov 15 2025 13:13:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å’±ä»¬AIåœˆé‡Œæœ€è¿‘æœ€ç«çš„è¯é¢˜æ˜¯å•¥ï¼Ÿé‚£å¿…é¡»æ˜¯ç™¾åº¦æ–‡å¿ƒå¤§æ¨¡å‹5.0çš„æ¨ªç©ºå‡ºä¸–å•Šï¼è¯´å®è¯ï¼Œåˆšå¬åˆ°è¿™æ•°å­—çš„æ—¶å€™ï¼Œæˆ‘ä¹Ÿæ„£äº†ä¸€ä¸‹â€”â€”2.4ä¸‡äº¿å‚æ•°ï¼Œè¿™ç®€ç›´æ˜¯æŠŠæ•´ä¸ªçŸ¥è¯†å®‡å®™éƒ½å¡è¿›äº†ä¸€ä¸ªå¤§è„‘é‡Œã€‚ä½†å‚æ•°å¤šå°±ä¸€å®šå¥½å—ï¼Ÿæ–‡å¿ƒ5.0æƒ³å‘Šè¯‰æˆ‘ä»¬ï¼Œå®ƒä¸å…‰è¦â€œå¤§â€ï¼Œæ›´è¦â€œåŸç”Ÿå…¨æ¨¡æ€â€çš„æ™ºæ…§ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-15_20.55.23-1024x633.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-15_20.55.23-1024x633.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35c1e4cbd35f46128ec6261b66a43d6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763817210&amp;x-signature=FjeUVmJ5d9b16TSookIzt60jVW8%3D" alt="iShot_2025-11-15_20.55.23" loading="lazy"/></a></p>
<h3 data-id="heading-0">ä¸åªæ˜¯â€œå¤§â€ï¼Œæ›´æ˜¯â€œç²¾æ˜â€çš„å¤§è„‘</h3>
<p>2.4ä¸‡äº¿å‚æ•°ï¼Œè¿™ä¸ªæ•°å­—å¬èµ·æ¥å¾ˆå”¬äººï¼Œæ¯•ç«Ÿå¤§å¤šæ•°äººå¯¹ä¸‡äº¿è¿™ä¸ªé‡çº§æ²¡ä»€ä¹ˆæ¦‚å¿µã€‚ä½†å¦‚æœæˆ‘å‘Šè¯‰ä½ ï¼Œè¿™ä¸ªåºå¤§çš„æ™ºèƒ½ä½“æ¯æ¬¡è§£å†³é—®é¢˜æ—¶ï¼Œåªä¼šæ¿€æ´»å…¶ä¸­ä¸åˆ°3%çš„â€œä¸“å®¶â€æ¥å·¥ä½œï¼Œä½ æ˜¯ä¸æ˜¯ä¼šè§‰å¾—æ›´æœ‰è¶£äº†ï¼Ÿ</p>
<p>è¿™å¯ä¸æ˜¯ä»€ä¹ˆé­”æœ¯ï¼Œè€Œæ˜¯æ–‡å¿ƒ5.0é‡‡ç”¨çš„â€œè¶…ç¨€ç–æ··åˆä¸“å®¶ï¼ˆMoEï¼‰æ¶æ„â€åœ¨å‘æŒ¥ä½œç”¨ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªæ‹¥æœ‰æ— æ•°é¡¶å°–é¡¾é—®çš„æ™ºå›Šå›¢ï¼Œå½“æ¥åˆ°ä¸€ä¸ªå…·ä½“ä»»åŠ¡æ—¶ï¼Œç³»ç»Ÿä¼šç²¾å‡†åœ°æŒ‘é€‰å‡ºæœ€æ“…é•¿è¿™ä¸ªé¢†åŸŸçš„å‡ ä½ä¸“å®¶æ¥å‡ºè°‹åˆ’ç­–ï¼Œè€Œä¸æ˜¯è®©æ‰€æœ‰äººéƒ½å‚ä¸ã€‚è¿™æ ·ä¸€æ¥ï¼Œå®ƒæ—¢èƒ½æ‹¥æœ‰æµ·é‡çš„çŸ¥è¯†å‚¨å¤‡ï¼Œåˆèƒ½ä¿è¯æ¯æ¬¡æ€è€ƒéƒ½é«˜æ•ˆã€è¿…é€Ÿã€‚è¿™ç®€ç›´å°±æ˜¯æŠŠâ€œç”¨å¯¹äººâ€çš„æ™ºæ…§å‘æŒ¥åˆ°äº†æè‡´ï¼Œå½»åº•å‘Šåˆ«äº†â€œå¤§è€Œç¬¨é‡â€çš„åˆ»æ¿å°è±¡ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-15_20.55.30-1024x581.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-15_20.55.30-1024x581.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a46ff3811a644582aeedf930be7a3be8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763817210&amp;x-signature=gRSKxQ8GlErAbWv1Akp1pb86ae0%3D" alt="iShot_2025-11-15_20.55.30" loading="lazy"/></a></p>
<h3 data-id="heading-1">å‘Šåˆ«â€œæ‹¼æ¥æ€ªâ€ï¼šçœŸæ­£â€œçœ‹å¬æ‡‚â€çš„AI</h3>
<p>å¦‚æœè¯´å‚æ•°è§„æ¨¡æ˜¯ä½“é‡ï¼Œé‚£â€œåŸç”Ÿå…¨æ¨¡æ€â€å°±æ˜¯æ–‡å¿ƒ5.0çœŸæ­£çš„çµé­‚ã€‚åœ¨è¿‡å»ï¼Œå¾ˆå¤šæ‰€è°“çš„å¤šæ¨¡æ€æ¨¡å‹ï¼Œå…¶å®æ›´åƒæ˜¯æŠŠæ–‡æœ¬ã€å›¾ç‰‡ã€éŸ³é¢‘æ¨¡å‹åæœŸâ€œæ‹¼æ¥â€èµ·æ¥çš„ï¼Œå®ƒä»¬å„è‡ªä¸ºæˆ˜ï¼Œç†è§£èµ·æ¥éš¾å…æœ‰ç‚¹éš”é˜‚ã€‚</p>
<p>ä½†æ–‡å¿ƒ5.0ä¸ä¸€æ ·ï¼Œå®ƒä»â€œå¨˜èƒé‡Œâ€â€”â€”ä¹Ÿå°±æ˜¯æ¨¡å‹è®­ç»ƒçš„ä¸€å¼€å§‹ï¼Œå°±è®©æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘è¿™äº›ä¸åŒæ¨¡æ€çš„æ•°æ®åœ¨ç»Ÿä¸€çš„æ¶æ„ä¸‹ä¸€èµ·å­¦ä¹ ã€ä¸€èµ·æˆé•¿ã€‚è¿™å°±åƒæˆ‘ä»¬äººç±»ä¸€æ ·ï¼ŒåŒæ—¶åŠ¨ç”¨è§†è§‰ã€å¬è§‰ã€è¯­è¨€å»ç†è§£è¿™ä¸ªä¸–ç•Œï¼Œçœ‹åˆ°ä¸€åªé¸Ÿåœ¨å”±æ­Œï¼Œæˆ‘ä»¬èƒ½ç«‹åˆ»å°†å®ƒçš„å½¢è±¡å’Œå£°éŸ³è”ç³»èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„è®¤çŸ¥ã€‚æ–‡å¿ƒ5.0çš„ç›®æ ‡ï¼Œå°±æ˜¯è®©AIä¹Ÿèƒ½æ‹¥æœ‰è¿™ç§ä»åº•å±‚å°±ä¸€ä½“åŒ–çš„ç†è§£ä¸ç”Ÿæˆèƒ½åŠ›ï¼Œè€Œä¸æ˜¯ç®€å•çš„â€œçœ‹å›¾è¯´è¯â€æˆ–â€œå¬å£°ä½œè¯—â€ã€‚è¿™ç§â€œä¸€ä½“åŒ–â€æ„å‘³ç€å®ƒèƒ½æ›´æœ¬è´¨ã€æ›´ç²¾å‡†åœ°ç†è§£ä½ çš„æ„å›¾ï¼Œä¹Ÿèƒ½ç”Ÿæˆæ›´è¿è´¯ã€æ›´å¯Œæœ‰æƒ³è±¡åŠ›çš„å†…å®¹ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-15_20.55.40-1024x537.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-15_20.55.40-1024x537.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/634c05740e764fdd867bd08edc2cfc81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763817210&amp;x-signature=iXyCD0EFTv%2Bnk%2BWKI5vKNTlTKZ0%3D" alt="iShot_2025-11-15_20.55.40" loading="lazy"/></a></p>
<h3 data-id="heading-2">å®åŠ›å‡ ä½•ï¼Ÿå®æµ‹ä¸è¯„æµ‹è§çœŸç« </h3>
<p>é‚£ä¹ˆï¼Œè¿™æ ·ä¸€ä¸ªâ€œå¤§è€Œç²¾æ˜â€åˆâ€œåŸç”Ÿå…¨æ¨¡æ€â€çš„æ¨¡å‹ï¼Œç©¶ç«Ÿèƒ½åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>æ ¹æ®å®˜æ–¹å…¬å¸ƒçš„æ•°æ®ï¼Œæ–‡å¿ƒ5.0åœ¨40å¤šé¡¹æƒå¨åŸºå‡†æµ‹è¯•ä¸­ï¼Œå…¶è¯­è¨€ä¸å¤šæ¨¡æ€ç†è§£èƒ½åŠ›å·²ç»èƒ½ä¸Gemini-2.5-Proã€GPT-5-Highè¿™äº›å›½é™…é¡¶å°–æ¨¡å‹<strong>æŒå¹³</strong>ã€‚æ›´è®©äººå…´å¥‹çš„æ˜¯ï¼Œå®ƒåœ¨LMArenaå¤§æ¨¡å‹ç«æŠ€åœºçš„æ–‡æœ¬ä»»åŠ¡è¯„æµ‹ä¸­ï¼Œä½åˆ—å…¨çƒå¹¶åˆ—ç¬¬äºŒã€ä¸­å›½ç¬¬ä¸€ï¼</p>
<p>åª’ä½“çš„å®æµ‹ä¹Ÿé€éœ²å‡ºä¸å°‘äº®ç‚¹ï¼š</p>
<ul>
<li><strong>è§†é¢‘ç†è§£é«˜æ‰‹</strong>ï¼šå®ƒèƒ½ç²¾å‡†åˆ†æã€Šåä¾¦æ¢æŸ¯å—ã€‹ä¸­å¤æ‚çš„ç ´æ¡ˆé€»è¾‘é“¾ï¼Œç”šè‡³èƒ½æ€»ç»“é•¿è¾¾35åˆ†é’Ÿçš„è‹±æ–‡å¯¹è¯è§†é¢‘çš„æ ¸å¿ƒè§‚ç‚¹å’Œå‘è¨€è€…ç«‹åœºï¼Œè¿™å¯ä¸æ˜¯ç®€å•çš„å†…å®¹è¯†åˆ«ï¼Œè€Œæ˜¯æ·±å±‚æ¬¡çš„é€»è¾‘åˆ†æå’Œæ¦‚æ‹¬èƒ½åŠ›ã€‚</li>
<li><strong>åˆ›æ„ç¼–ç¨‹å¤§å¸ˆ</strong>ï¼šä½ éšå£ä¸€å¥â€œæŠŠå¯¹æ‰‹çš„æ£‹å­ç›´æ¥æ‰”è¿›ä»€åˆ¹æµ·â€ï¼Œå®ƒå°±èƒ½ç†è§£ä½ å¤©é©¬è¡Œç©ºçš„æ„å›¾ï¼Œç”Ÿæˆä¸€ä¸ªå¯è¿è¡Œçš„â€œæŠ€èƒ½äº”å­æ£‹â€ç½‘é¡µæ¸¸æˆä»£ç ã€‚è¿™æƒ³è±¡åŠ›ä¸æ‰§è¡ŒåŠ›ï¼ŒçœŸæ˜¯è®©äººæ‹æ¡ˆå«ç»ã€‚</li>
<li><strong>é«˜æƒ…å•†æ²Ÿé€šè€…</strong>ï¼šåœ¨å¤„ç†æƒ…æ„Ÿç±»é—®é¢˜æ—¶ï¼Œæ–‡å¿ƒ5.0çš„å›å¤ä¸å†æ˜¯å†·å†°å†°çš„å¥—è¯ï¼Œè€Œæ˜¯å±•ç°å‡ºæ›´å¼ºçš„åŒç†å¿ƒå’Œç»†è…»æ„Ÿï¼Œå°±åƒä¸€ä¸ªçœŸæ­£çš„â€œé«˜æƒ…å•†â€æœ‹å‹åœ¨ä¸ä½ äº¤æµã€‚</li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-15_20.55.45-1024x389.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-15_20.55.45-1024x389.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95a906475fe04196a55ed6acfd161a06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763817210&amp;x-signature=9pGbqMPHsrvqcpATSB1sXiUYcxM%3D" alt="iShot_2025-11-15_20.55.45" loading="lazy"/></a></p>
<h3 data-id="heading-3">èµ°å‘ç°å®ï¼šè§¦æ‰‹å¯åŠçš„AIæ™ºèƒ½ä½“</h3>
<p>æ–‡å¿ƒå¤§æ¨¡å‹5.0å¹¶éæŸä¹‹é«˜é˜çš„å®éªŒå®¤äº§å“ã€‚æ™®é€šç”¨æˆ·ç°åœ¨å°±èƒ½é€šè¿‡**â€œæ–‡å¿ƒä¸€è¨€Appâ€<strong>ä½“éªŒåˆ°å®ƒçš„Previewç‰ˆæœ¬ã€‚è€Œå¯¹äºæˆ‘ä»¬å¼€å‘è€…å’Œä¼ä¸šç”¨æˆ·æ¥è¯´ï¼Œåˆ™å¯ä»¥é€šè¿‡</strong>ç™¾åº¦åƒå¸†å¤§æ¨¡å‹å¹³å°**è°ƒç”¨å…¶APIæœåŠ¡ï¼Œå°†è¿™äº›å¼ºå¤§çš„èƒ½åŠ›é›†æˆåˆ°æˆ‘ä»¬è‡ªå·±çš„äº§å“å’Œè§£å†³æ–¹æ¡ˆä¸­ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-15_20.56.09-1024x296.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-15_20.56.09-1024x296.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4038c0f285348bd83deebbd3bbabfb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763817210&amp;x-signature=VHUkK%2ByOwYaR4%2Fa3nZFT8qJcI%2Fo%3D" alt="iShot_2025-11-15_20.56.09" loading="lazy"/></a></p>
<p>ç™¾åº¦åˆ›å§‹äººæå½¦å®æ›¾è¯´è¿‡ï¼Œâ€œæ™ºèƒ½æœ¬èº«æ˜¯æœ€å¤§çš„åº”ç”¨ï¼Œè€ŒæŠ€æœ¯è¿­ä»£é€Ÿåº¦æ˜¯å”¯ä¸€çš„æŠ¤åŸæ²³â€ã€‚æ–‡å¿ƒ5.0çš„å‘å¸ƒï¼Œæ— ç–‘æ˜¯ç™¾åº¦åœ¨è¿™æ¡æŠ¤åŸæ²³ä¸Šåˆä¸€æ¬¡æ·±æŒ–ã€‚å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªæŠ€æœ¯ä¸Šçš„çªç ´ï¼Œæ›´æ˜¯ä¸ºæˆ‘ä»¬æç»˜äº†ä¸€ä¸ªæ›´å…·æƒ³è±¡åŠ›çš„AIæœªæ¥ï¼šä¸€ä¸ªä¸å†å—é™äºå•ä¸€æ¨¡æ€ã€èƒ½çœŸæ­£åƒäººä¸€æ ·æ€è€ƒã€ç†è§£å’Œåˆ›é€ çš„æ™ºèƒ½æ—¶ä»£ã€‚</p>
<p><strong>å¦‚æœä½ ä¹Ÿå¯¹æœ€æ–°çš„AIä¿¡æ¯æ„Ÿå…´è¶£æˆ–è€…æœ‰ç–‘é—® éƒ½å¯ä»¥åŠ å…¥æˆ‘çš„å¤§å®¶åº­ ç¬¬ä¸€æ—¶é—´åˆ†äº«æœ€æ–°AIèµ„è®¯ã€å·¥å…·ã€æ•™ç¨‹ã€æ–‡æ¡£ æ¬¢è¿ä½ çš„åŠ å…¥ï¼ï¼ï¼ğŸ˜‰ğŸ˜‰ğŸ˜‰</strong></p>
<p>å…¬ä¼—å·ï¼šå¢¨é£å¦‚é›ªå°ç«™</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»åç«¯å¼€å‘è€…åˆ°Agentå·¥ç¨‹å¸ˆï¼šä¸€ä»½ç³»ç»Ÿæ€§çš„å­¦ä¹ æŒ‡å—]]></title>    <link>https://juejin.cn/post/7572459217811865663</link>    <guid>https://juejin.cn/post/7572459217811865663</guid>    <pubDate>2025-11-15T13:25:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572459217811865663" data-draft-id="7572459757107363894" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»åç«¯å¼€å‘è€…åˆ°Agentå·¥ç¨‹å¸ˆï¼šä¸€ä»½ç³»ç»Ÿæ€§çš„å­¦ä¹ æŒ‡å—"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-15T13:25:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="oioihoii"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»åç«¯å¼€å‘è€…åˆ°Agentå·¥ç¨‹å¸ˆï¼šä¸€ä»½ç³»ç»Ÿæ€§çš„å­¦ä¹ æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    oioihoii
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T13:25:50.000Z" title="Sat Nov 15 2025 13:25:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ä¸‹é¢çš„å†…å®¹æ˜¯ä¹‹å‰ç”¨AIç”Ÿæˆçš„ï¼Œæ ¹æ®è¿™ä»½AIå¤§çº²ï¼Œæˆ‘å·²ç»åˆ°äº†ç¬¬äºŒé˜¶æ®µï¼Œæˆ‘æ„Ÿè§‰è¿™ä»½è·¯çº¿å›¾ç¡®å®åˆ‡å®å¯è¡Œï¼Œæ‰€ä»¥ä¸“é—¨ç¿»å‡ºæ¥åšåˆ†äº«ã€‚</p>
</blockquote>
<h3 data-id="heading-0">ä¸ºä»€ä¹ˆåç«¯å¼€å‘è€…æ˜¯å­¦ä¹ Agentçš„ç»ä½³äººé€‰ï¼Ÿ</h3>
<p>å¦‚æœä½ æ˜¯ä¸€ååç«¯å¼€å‘è€…ï¼Œæ­å–œä½ ï¼Œä½ å·²ç»å…·å¤‡äº†å­¦ä¹ AgentæŠ€æœ¯çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š</p>
<ol>
<li><strong>ç³»ç»Ÿæ¶æ„æ€ç»´</strong>ï¼šä½ èƒ½ç†è§£å¤æ‚ç³»ç»Ÿç”±æ¨¡å—ç»„æˆå¹¶è®¾è®¡å…¶äº¤äº’ï¼Œè€ŒAgentæœ¬èº«å°±æ˜¯ä¸€ç§â€œå¾®ç³»ç»Ÿâ€ã€‚</li>
<li><strong>APIè®¾è®¡ä¸é›†æˆä¸“å®¶</strong>ï¼šAgentçš„æ ¸å¿ƒèƒ½åŠ›ä¹‹ä¸€å°±æ˜¯è°ƒç”¨å·¥å…·ï¼ˆToolï¼‰ï¼Œè€Œè¿™æœ¬è´¨ä¸Šå°±æ˜¯APIè°ƒç”¨ï¼Œè¿™æ˜¯ä½ çš„è€æœ¬è¡Œã€‚</li>
<li><strong>å¹¶å‘ä¸å¼‚æ­¥ç¼–ç¨‹é«˜æ‰‹</strong>ï¼šAgentç»å¸¸éœ€è¦å¤„ç†å¤šæ­¥éª¤ä»»åŠ¡æˆ–å¹¶å‘è¯·æ±‚ï¼Œä½ å¯¹å¼‚æ­¥æµç¨‹çš„æ§åˆ¶èƒ½åŠ›è‡³å…³é‡è¦ã€‚</li>
<li><strong>å·¥ç¨‹åŒ–ä¸è¿ç»´ä¸“å®¶</strong>ï¼šä½ çŸ¥é“å¦‚ä½•ç¼–å†™å¯æµ‹è¯•ã€å¯éƒ¨ç½²ã€å¯ç›‘æ§çš„ä»£ç ï¼Œè¿™æ­£æ˜¯PoCæ¼”ç¤ºä¸ç”Ÿäº§çº§Agentç³»ç»Ÿçš„ä¸»è¦å·®è·ã€‚</li>
</ol>
<p>è¿™ä»½æŒ‡å—å°†ä¸ºä½ è§„åˆ’ä¸€æ¡ä»å…¥é—¨åˆ°ç²¾é€šçš„æ¸…æ™°è·¯å¾„ã€‚</p>
<h3 data-id="heading-1">å­¦ä¹ è·¯çº¿å›¾ï¼šå››ä¸ªé˜¶æ®µï¼Œä»å…¥é—¨åˆ°ä¸“å®¶</h3>
<p>æˆ‘ä»¬å»ºè®®éµå¾ªä»¥ä¸‹å››ä¸ªé˜¶æ®µï¼Œå¾ªåºæ¸è¿›ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½åŒ…å«æ˜ç¡®çš„ç›®æ ‡ã€æŠ€æœ¯è¦ç‚¹å’Œå®è·µé¡¹ç›®ã€‚</p>
<hr/>
<h4 data-id="heading-2"><strong>é˜¶æ®µä¸€ï¼šåŸºç¡€è®¤çŸ¥ä¸ç¯å¢ƒæ­å»ºï¼ˆ1-2å‘¨ï¼‰</strong></h4>
<p><strong>ç›®æ ‡</strong>ï¼šå»ºç«‹å¯¹Agentçš„æ ¸å¿ƒè®¤çŸ¥ï¼Œæ­å»ºå¼€å‘ç¯å¢ƒã€‚</p>
<p><strong>å­¦ä¹ å†…å®¹</strong>ï¼š</p>
<ul>
<li><strong>æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼š
<ul>
<li><strong>Agent</strong>ï¼šèƒ½æ„ŸçŸ¥ç¯å¢ƒã€å†³ç­–å¹¶æ‰§è¡ŒåŠ¨ä½œä»¥è¾¾æˆç›®æ ‡çš„ç¨‹åºã€‚</li>
<li><strong>LLM</strong>ï¼šAgentçš„â€œå¤§è„‘â€ï¼Œè´Ÿè´£ç†è§£ä¸æ¨ç†ã€‚</li>
<li><strong>Prompt Engineering</strong>ï¼šä¸LLMå¤§è„‘é«˜æ•ˆæ²Ÿé€šçš„â€œè¯­è¨€â€ã€‚</li>
<li><strong>Tool/Function Calling</strong>ï¼šAgentçš„â€œæ‰‹å’Œè„šâ€ï¼Œç”¨äºæ‰§è¡Œå…·ä½“æ“ä½œï¼ˆå¦‚è°ƒç”¨APIã€æŸ¥è¯¢DBï¼‰ã€‚</li>
</ul>
</li>
<li><strong>æŠ€æœ¯é€‰å‹</strong>ï¼š
<ul>
<li><strong>è¯­è¨€</strong>ï¼šé¦–é€‰<strong>Python</strong>ï¼Œå› å…¶æ‹¥æœ‰æœ€æˆç†Ÿçš„AIç”Ÿæ€ã€‚</li>
<li><strong>æ¡†æ¶</strong>ï¼š<strong>LangChain</strong>ï¼Œå½“å‰æœ€ä¸»æµçš„Agentåº”ç”¨å¼€å‘æ¡†æ¶ã€‚</li>
<li><strong>æ¨¡å‹API</strong>ï¼šä»<strong>OpenAI GPT-4o/3.5-Turbo</strong>å¼€å§‹ï¼Œå…¶å¯¹Function Callingæ”¯æŒè‰¯å¥½ã€‚</li>
</ul>
</li>
</ul>
<p><strong>åŠ¨æ‰‹å®è·µ</strong>ï¼š</p>
<ol>
<li>é…ç½®Pythonç¯å¢ƒï¼Œå®‰è£…<code>langchain</code>ã€<code>langchain-openai</code>ç­‰æ ¸å¿ƒåº“ã€‚</li>
<li>è·å–OpenAI API Keyã€‚</li>
<li>ç¼–å†™ä¸€ä¸ªæœ€ç®€å•çš„è„šæœ¬ï¼ŒæˆåŠŸè°ƒç”¨ChatGPT APIã€‚</li>
</ol>
<hr/>
<h4 data-id="heading-3"><strong>é˜¶æ®µäºŒï¼šæŒæ¡æ ¸å¿ƒç»„ä»¶ä¸ç®€å•å®è·µï¼ˆ2-3å‘¨ï¼‰</strong></h4>
<p><strong>ç›®æ ‡</strong>ï¼šæ·±å…¥ç†è§£LangChainæ ¸å¿ƒæ¨¡å—ï¼Œæ„å»ºèƒ½è°ƒç”¨å·¥å…·çš„å•ä¸€Agentã€‚</p>
<p><strong>å­¦ä¹ å†…å®¹</strong>ï¼š</p>
<ul>
<li><strong>LangChainæ ¸å¿ƒç»„ä»¶</strong>ï¼š
<ul>
<li><strong>Models</strong>ï¼šæ¥å…¥ä¸åŒLLMã€‚</li>
<li><strong>Prompts</strong>ï¼šä½¿ç”¨<code>ChatPromptTemplate</code>æ„å»ºé«˜è´¨é‡çš„å¯¹è¯æç¤ºã€‚</li>
<li><strong>Chains</strong>ï¼šå°†å¤šä¸ªæ­¥éª¤ä¸²è”æˆå·¥ä½œæµã€‚</li>
<li><strong>Tools</strong>ï¼š<strong>ä½ çš„æ ¸å¿ƒä¼˜åŠ¿åŒº</strong>ï¼å­¦ä¹ å¦‚ä½•å°†ä»»æ„å‡½æ•°æˆ–HTTP APIå°è£…æˆAgentå¯è°ƒç”¨çš„Toolã€‚</li>
<li><strong>Agents</strong>ï¼šç†è§£å†…ç½®Agentç±»å‹ï¼ˆå¦‚<code>OPENAI_FUNCTIONS</code>ï¼‰åŠå…¶æ‰§è¡Œå¾ªç¯ã€‚</li>
</ul>
</li>
</ul>
<p><strong>é¡¹ç›®å®æˆ˜</strong>ï¼š</p>
<ul>
<li><strong>é¡¹ç›®1ï¼šæ™ºèƒ½å¤©æ°”æŸ¥è¯¢åŠ©æ‰‹</strong>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šç”¨æˆ·è¾“å…¥â€œä¸Šæµ·å¤©æ°”å¦‚ä½•ï¼Ÿâ€ï¼ŒAgentè‡ªåŠ¨è°ƒç”¨å¤©æ°”APIå¹¶è¿”å›ç»“æœã€‚</li>
<li><strong>æŠ€æœ¯è¦ç‚¹</strong>ï¼šå°è£…å¤©æ°”APIä¸ºToolï¼Œä½¿ç”¨Agentè¿›è¡Œè§„åˆ’å’Œè°ƒç”¨ã€‚</li>
</ul>
</li>
<li><strong>é¡¹ç›®2ï¼šè‡ªç„¶è¯­è¨€æ•°æ®åº“æŸ¥è¯¢åŠ©æ‰‹</strong>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šç”¨æˆ·ç”¨è‡ªç„¶è¯­è¨€æŸ¥è¯¢æ•°æ®åº“ï¼Œå¦‚â€œæŸ¥è¯¢é”€å”®é¢æœ€é«˜çš„äº§å“â€ã€‚</li>
<li><strong>æŠ€æœ¯è¦ç‚¹</strong>ï¼šå°è£…SQLæŸ¥è¯¢ä¸ºToolï¼Œ<strong>é‡ç‚¹å®è·µSQLå®‰å…¨æ ¡éªŒ</strong>ï¼Œé˜²æ­¢SQLæ³¨å…¥ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-4"><strong>é˜¶æ®µä¸‰ï¼šè¿›é˜¶æ¦‚å¿µä¸å¤æ‚ç³»ç»Ÿæ„å»ºï¼ˆ3-4å‘¨ï¼‰</strong></h4>
<p><strong>ç›®æ ‡</strong>ï¼šæ„å»ºå¤šæ­¥éª¤ã€æœ‰çŠ¶æ€ã€å…·å¤‡ä¸“ä¸šçŸ¥è¯†çš„å¤æ‚Agentç³»ç»Ÿã€‚</p>
<p><strong>å­¦ä¹ å†…å®¹</strong>ï¼š</p>
<ul>
<li><strong>RAG</strong>ï¼šæ£€ç´¢å¢å¼ºç”Ÿæˆã€‚è®©Agentå…·å¤‡è®¿é—®ç§æœ‰çŸ¥è¯†åº“çš„èƒ½åŠ›ã€‚
<ul>
<li>æ ¸å¿ƒæµç¨‹ï¼šæ–‡æ¡£åŠ è½½ -&gt; åˆ‡åˆ† -&gt; å‘é‡åŒ– -&gt; å­˜å‚¨åˆ°å‘é‡æ•°æ®åº“ï¼ˆå¦‚ChromaDB/FAISSï¼‰-&gt; æ£€ç´¢ã€‚</li>
</ul>
</li>
<li><strong>LangGraph</strong>ï¼š<strong>æ„å»ºå¤æ‚Agentçš„ç»ˆæåˆ©å™¨</strong>ã€‚å®ƒç”¨å›¾çš„æ¦‚å¿µæ¥å®šä¹‰å…·æœ‰çŠ¶æ€ã€å¾ªç¯å’Œåˆ†æ”¯çš„å¤æ‚å·¥ä½œæµï¼Œéå¸¸é€‚åˆå®ç°ReActæ¨¡å¼ã€‚</li>
</ul>
<p><strong>é¡¹ç›®å®æˆ˜</strong>ï¼š</p>
<ul>
<li><strong>é¡¹ç›®3ï¼šæŠ€æœ¯æ–‡æ¡£æ™ºèƒ½é—®ç­”æœºå™¨äººï¼ˆRAGï¼‰</strong>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šåŸºäºå…¬å¸/é¡¹ç›®çš„æŠ€æœ¯æ–‡æ¡£ï¼ˆMarkdown/PDFï¼‰ï¼Œå›ç­”ç²¾å‡†çš„æŠ€æœ¯é—®é¢˜ã€‚</li>
<li><strong>æŠ€æœ¯è¦ç‚¹</strong>ï¼šæ­å»ºå®Œæ•´çš„RAGç®¡é“ï¼Œé›†æˆå‘é‡æ•°æ®åº“è¿›è¡Œç›¸ä¼¼æ€§æ£€ç´¢ã€‚</li>
</ul>
</li>
<li><strong>é¡¹ç›®4ï¼šè‡ªä¸»ç ”ç©¶åŠ©æ‰‹ï¼ˆLangGraphï¼‰</strong>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šç»™å®šä¸€ä¸ªå¤æ‚ä¸»é¢˜ï¼ŒAgentèƒ½è‡ªåŠ¨è§„åˆ’æ­¥éª¤ï¼ˆæœç´¢ -&gt; é˜…è¯» -&gt; æ€»ç»“ -&gt; æŠ¥å‘Šï¼‰ã€‚</li>
<li><strong>æŠ€æœ¯è¦ç‚¹</strong>ï¼šä½¿ç”¨LangGraphå®šä¹‰çŠ¶æ€å’ŒèŠ‚ç‚¹ï¼Œæ„å»ºä¸€ä¸ªå¯æ§çš„ã€å¤šæ­¥éª¤çš„è‡ªä¸»Agentã€‚<strong>æ­¤å¤„å¯å®Œç¾è¿ç”¨ä½ çš„å¾®æœåŠ¡ç¼–æ’ç»éªŒ</strong>ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-5"><strong>é˜¶æ®µå››ï¼šå·¥ç¨‹åŒ–ã€ä¼˜åŒ–ä¸ç”Ÿäº§éƒ¨ç½²ï¼ˆé•¿æœŸï¼‰</strong></h4>
<p><strong>ç›®æ ‡</strong>ï¼šå°†Agentç³»ç»Ÿæ‰“ç£¨è‡³ç”Ÿäº§çº§åˆ«ã€‚</p>
<p><strong>å­¦ä¹ å†…å®¹</strong>ï¼š</p>
<ul>
<li><strong>å¯è§‚æµ‹æ€§</strong>ï¼š
<ul>
<li>ä½¿ç”¨<strong>LangSmith</strong>å¯¹Agentçš„æ€è€ƒè¿‡ç¨‹ã€å·¥å…·è°ƒç”¨ã€è€—æ—¶å’Œæˆæœ¬è¿›è¡Œå…¨æ–¹ä½è¿½è¸ªå’Œè°ƒè¯•ã€‚</li>
<li>å»ºç«‹ä¸šåŠ¡æŒ‡æ ‡ï¼ˆå¦‚ä»»åŠ¡å®Œæˆç‡ï¼‰æ¥è¯„ä¼°Agentæ€§èƒ½ã€‚</li>
</ul>
</li>
<li><strong>ä¼˜åŒ–</strong>ï¼š
<ul>
<li><strong>ç¼“å­˜</strong>ï¼šå¯¹Embeddingå’ŒLLMå“åº”è¿›è¡Œç¼“å­˜ä»¥é™ä½æˆæœ¬ä¸å»¶è¿Ÿã€‚</li>
<li><strong>é™æµä¸é™çº§</strong>ï¼šä¿éšœLLM APIçš„ç¨³å®šæ€§å’ŒæœåŠ¡çš„éŸ§æ€§ã€‚</li>
<li><strong>æ¨¡å‹é€‰å‹</strong>ï¼šæ¢ç´¢æˆæœ¬æ•ˆç›Šæ›´é«˜çš„å¼€æºæ¨¡å‹ï¼ˆå¦‚é€šè¿‡Ollamaéƒ¨ç½²Llamaã€Qwenç­‰ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>éƒ¨ç½²</strong>ï¼š
<ul>
<li>ä½¿ç”¨<strong>FastAPI</strong>å°†Agentå°è£…æˆRESTful APIã€‚</li>
<li>ä½¿ç”¨<strong>Docker</strong>å®¹å™¨åŒ–åº”ç”¨ã€‚</li>
<li>åœ¨<strong>Kubernetes</strong>ä¸Šéƒ¨ç½²ï¼Œå®ç°å¼¹æ€§ä¼¸ç¼©ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-6">ç»™åç«¯å¼€å‘è€…çš„æ ¸å¿ƒå»ºè®®</h3>
<ol>
<li><strong>å‘æŒ¥ä½ çš„å·¥ç¨‹ä¼˜åŠ¿</strong>ï¼šå½“ä½ æ„å»ºAgentæ—¶ï¼Œä½ ä¸ä»…ä»…æ˜¯åœ¨å†™Promptï¼Œä½ æ˜¯åœ¨<strong>è®¾è®¡ä¸€ä¸ªç³»ç»Ÿ</strong>ã€‚ç”¨ä½ ç†Ÿæ‚‰çš„æ¶æ„æ¨¡å¼ã€è®¾è®¡åŸåˆ™å»æ€è€ƒAgentçš„å„ä¸ªç»„ä»¶ã€‚</li>
<li><strong>ä»åšä¸­å­¦</strong>ï¼šAgentæŠ€æœ¯å®è·µæ€§æå¼ºã€‚ä¸è¦åœç•™åœ¨ç†è®ºï¼Œä»ç¬¬ä¸€ä¸ªå°é¡¹ç›®å¼€å§‹æ•²ä»£ç ï¼Œé‡åˆ°çš„æ¯ä¸€ä¸ªé—®é¢˜éƒ½æ˜¯æœ€å¥½çš„å­¦ä¹ ææ–™ã€‚</li>
<li><strong>æ‹¥æŠ±ç¤¾åŒº</strong>ï¼šLangChainæ–‡æ¡£è¯¦å°½ï¼ŒDiscordç¤¾åŒºæ´»è·ƒã€‚é‡åˆ°é—®é¢˜æ—¶ï¼Œè¿™äº›éƒ½æ˜¯å®è´µçš„èµ„æºã€‚</li>
</ol>
<p>AgentæŠ€æœ¯æ­£åœ¨è¿…é€Ÿæ”¹å˜è½¯ä»¶ä¸ä¸–ç•Œçš„äº¤äº’æ–¹å¼ã€‚ä½œä¸ºä¸€ååç«¯å¼€å‘è€…ï¼Œä½ æ‰‹æ¡ç³»ç»Ÿå·¥ç¨‹çš„é’¥åŒ™ï¼Œå¿…å°†èƒ½åœ¨è¿™åœºå˜é©ä¸­æ„å»ºå‡ºç¨³å®šã€å¼ºå¤§ä¸”çœŸæ­£æœ‰ç”¨çš„æ™ºèƒ½ç³»ç»Ÿã€‚</p>
<p><strong>ç¥ä½ å­¦ä¹ é¡ºåˆ©ï¼Œå¼€å¯ä½ çš„Agentå·¥ç¨‹å¸ˆä¹‹æ—…ï¼</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MinIO ä¸å†â€œå¼€æ”¾â€ï¼ŒRustFS èƒ½å¦æˆä¸ºæ›´ä¼˜é€‰æ‹©ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7572459757107396662</link>    <guid>https://juejin.cn/post/7572459757107396662</guid>    <pubDate>2025-11-15T13:29:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572459757107396662" data-draft-id="7572459217811882047" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MinIO ä¸å†â€œå¼€æ”¾â€ï¼ŒRustFS èƒ½å¦æˆä¸ºæ›´ä¼˜é€‰æ‹©ï¼Ÿ"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-15T13:29:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çš®çš®æ—551"/> <meta itemprop="url" content="https://juejin.cn/user/2447981921436084"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MinIO ä¸å†â€œå¼€æ”¾â€ï¼ŒRustFS èƒ½å¦æˆä¸ºæ›´ä¼˜é€‰æ‹©ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2447981921436084/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çš®çš®æ—551
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T13:29:08.000Z" title="Sat Nov 15 2025 13:29:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿‘å¹´æ¥ï¼ŒMinIO çš„å•†ä¸šåŒ–æ­¥ä¼ä¸æ–­åŠ é€Ÿï¼Œå…¶ä¸€ç³»åˆ—æ“ä½œ<strong>ä»ä¿®æ”¹å¼€æºåè®®åˆ°é™åˆ¶å¼€æºç‰ˆæœ¬åŠŸèƒ½</strong>Â â€”â€”è®©è®¸å¤šå¿ å®ç”¨æˆ·æ„Ÿåˆ°ä¸å®‰ã€‚æ›¾ç»é‚£ä¸ªå¼€æ”¾ã€è‡ªç”±çš„ MinIO ä¼¼ä¹æ­£æ¸è¡Œæ¸è¿œï¼Œè¿™è®©ä¸šç•Œå¼€å§‹è¿«åˆ‡å¯»æ‰¾ä¸€ä¸ªæ›´å¼€æ”¾ã€å¯¹å•†ä¸šæ›´å‹å¥½ã€æ›´çº¯ç²¹çš„å¼€æºæ›¿ä»£æ–¹æ¡ˆã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b6698768ef14913bed354b38c6bfae3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763818148&amp;x-signature=OP%2FbGaUmke%2BHb18BWV3umsbtXlY%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å›¾ç‰‡</p>
<p>åœ¨è¿™æ ·çš„èƒŒæ™¯ä¸‹ï¼ŒRustFS åº”è¿è€Œç”Ÿã€‚<strong>å®ƒä¸ä»…æ˜¯ä¸€ä¸ªé›„å¿ƒå‹ƒå‹ƒçš„ MinIO å¼€æºå¹³æ›¿ï¼Œæ›´ä»£è¡¨äº†ä¸€æ¡åšæŒè‡ªä¸»å¯æ§çš„æŠ€æœ¯è·¯çº¿</strong>Â ã€‚ä¸ºäº†æ›´ç›´è§‚åœ°å±•ç¤º RustFS çš„ä»·å€¼ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db247a0dd12f4d59be0337fe2adc5106~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763818148&amp;x-signature=rFoINCL4%2FnjwIBEz7%2BdcsciUIjs%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å›¾ç‰‡</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f87184ec965949f0bd746d59956ec046~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763818148&amp;x-signature=h6AvnbJo9BPpy%2BzwAeegYACMnDc%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å›¾ç‰‡</p>
<p>ä½œä¸º MinIO çš„å¼€æºå¹³æ›¿ï¼ŒRustFS å‚è€ƒäº† MinIO çš„ç®€æ´ã€è½»é‡ã€å¯æ‰©å±•ã€ä¼˜é›…çš„æ¶æ„ã€‚RustFS çš„åŸºæœ¬æ¶æ„æ˜¯åˆ†å¸ƒå¼ç½‘æ ¼ï¼Œä¸€ç§ä½¿ç”¨å¤šä¸ªèŠ‚ç‚¹æ‰§è¡Œå•ä¸ªä»»åŠ¡çš„è®¡ç®—æœºæ¶æ„ã€‚æ‘’å¼ƒäº†ä¼ ç»Ÿåˆ†å¸ƒå¼å­˜å‚¨ä¸­å¤æ‚çš„ä¸»èŠ‚ç‚¹ã€å…ƒæ•°æ®èŠ‚ç‚¹ã€æ•°æ®èŠ‚ç‚¹è§’è‰²åˆ’åˆ†ï¼ŒèŠ‚ç‚¹é€šè¿‡ç½‘ç»œç›¸äº’è¿æ¥ï¼Œè¿™ä½¿å¾—å®ƒä»¬èƒ½å¤Ÿç›¸äº’é€šä¿¡ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c1f09a3f4584664b5a5e59a613a86ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763818148&amp;x-signature=zafwKeO5FGlsEuoJDpLqgJRh5hc%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å›¾ç‰‡</p>
<h4 data-id="heading-0">ç‰¹æ€§</h4>
<ul>
<li>
<p>é«˜æ€§èƒ½</p>
<p>ï¼šä½¿ç”¨ Rust æ„å»ºï¼Œç¡®ä¿é€Ÿåº¦å’Œæ•ˆç‡ã€‚</p>
</li>
<li>
<p>åˆ†å¸ƒå¼æ¶æ„</p>
<p>ï¼šå¯æ‰©å±•ä¸”å®¹é”™çš„è®¾è®¡ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡éƒ¨ç½²ã€‚</p>
</li>
<li>
<p>S3 å…¼å®¹æ€§</p>
<p>ï¼šä¸ç°æœ‰ S3 å…¼å®¹åº”ç”¨ç¨‹åºæ— ç¼é›†æˆã€‚</p>
</li>
<li>
<p>æ•°æ®æ¹–æ”¯æŒ</p>
<p>ï¼šé’ˆå¯¹å¤§æ•°æ®å’Œ AI å·¥ä½œè´Ÿè½½è¿›è¡Œäº†ä¼˜åŒ–ã€‚</p>
</li>
<li>
<p>å¼€æº</p>
<p>ï¼šé‡‡ç”¨ Apache 2.0 è®¸å¯è¯ï¼Œé¼“åŠ±ç¤¾åŒºè´¡çŒ®å’Œé€æ˜åº¦ã€‚</p>
</li>
<li>
<p>ç”¨æˆ·å‹å¥½</p>
<p>ï¼šè®¾è®¡ç®€å•ï¼Œæ˜“äºéƒ¨ç½²å’Œç®¡ç†ã€‚</p>
</li>
<li>
<p><strong>å¼€æºåœ°å€****<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frustfs%2Frustfs" target="_blank" title="https://github.com/rustfs/rustfs" ref="nofollow noopener noreferrer">github.com/rustfs/rustâ€¦</a></strong></p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/460a9e8ce1b7483b8a0e70343d45336d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763818148&amp;x-signature=3%2F5OxTVXHsDOX2IrUz%2BD%2Fyq8vA0%3D" alt="å›¾ç‰‡" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€å‘ä¸€ä¸ªè®¡æ—¶å™¨ç»„ä»¶]]></title>    <link>https://juejin.cn/post/7572454929144872995</link>    <guid>https://juejin.cn/post/7572454929144872995</guid>    <pubDate>2025-11-15T12:51:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572454929144872995" data-draft-id="7572454929144856611" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€å‘ä¸€ä¸ªè®¡æ—¶å™¨ç»„ä»¶"/> <meta itemprop="keywords" content="å‰ç«¯,æµè§ˆå™¨"/> <meta itemprop="datePublished" content="2025-11-15T12:51:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å®‰æ±‰ç”Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/2533716584308935"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€å‘ä¸€ä¸ªè®¡æ—¶å™¨ç»„ä»¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2533716584308935/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å®‰æ±‰ç”Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T12:51:36.000Z" title="Sat Nov 15 2025 12:51:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">âœ… 1ã€è®¡æ—¶é€»è¾‘æ”¾åœ¨ Web Workerï¼Œä¸æ”¾åœ¨ä¸»çº¿ç¨‹</h2>
<ul>
<li>ç°ä»£æµè§ˆå™¨ä¸ºäº†çœç”µå’Œæ€§èƒ½ï¼Œä¼šå¯¹éå½“å‰æ˜¾ç¤ºçš„æ ‡ç­¾é¡µå®æ–½é™åˆ¶ï¼Œ<code>setTimeout / setInterval</code>å¯èƒ½å»¶è¿Ÿï¼›</li>
<li>ä¸ä¼šè¢«ä¸»çº¿ç¨‹çš„æ¸²æŸ“/JSæ‰§è¡Œé˜»å¡å½±å“ã€‚</li>
</ul>
<h2 data-id="heading-1">âœ… 2ã€é€’å½’ setTimeoutï¼Œä¸ç”¨ setInterval</h2>
<p><strong>1ã€setInterval çš„ç¼ºé™·ï¼š</strong></p>
<blockquote>
<p>setInterval(fn, 1000) çš„å«ä¹‰æ˜¯ï¼š â€œæ¯éš” 1000msï¼Œå°† fn æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—â€ï¼Œä½†ä¸ä¿è¯ fn ä½•æ—¶å¼€å§‹æ‰§è¡Œã€‚</p>
</blockquote>
<p>å¦‚æœä¸»çº¿ç¨‹ç¹å¿™ï¼ˆå¦‚æ¸²æŸ“å¡é¡¿ã€å¤§é‡è®¡ç®—ï¼‰ï¼Œfn å¯èƒ½å»¶è¿Ÿæ‰§è¡Œï¼Œè€Œä¸‹ä¸€æ¬¡å›è°ƒä»æŒ‰å›ºå®šé—´éš”æ’é˜Ÿï¼Œå¯¼è‡´ï¼šç´¯è®¡è¯¯å·®è¶Šæ¥è¶Šå¤§ï¼Œå®é™…æ‰§è¡Œé¢‘ç‡è¿œä½äºé¢„æœŸã€‚</p>
<p><strong>2ã€setTimeout é€’å½’çš„ä¼˜åŠ¿:</strong></p>
<blockquote>
<p>åŠ¨æ€è°ƒæ•´ä¸‹ä¸€æ¬¡å»¶è¿Ÿæ—¶é—´ï¼Œè¡¥å¿ä¸Šä¸€æ¬¡çš„æ‰§è¡Œè€—æ—¶ï¼ŒsetTimeout é€’å½’æ˜¯â€œæ‰§è¡Œå®Œå†çº¦ä¸‹ä¸€æ¬¡â€ï¼Œé¿å…ä»»åŠ¡å †ç§¯ã€‚</p>
</blockquote>
<pre><code class="hljs language-scss" lang="scss">functionÂ <span class="hljs-built_in">tick</span>()Â {
Â Â <span class="hljs-comment">//Â ...</span>
Â Â <span class="hljs-built_in">setTimeout</span>(tick,Â <span class="hljs-number">1000</span>);Â <span class="hljs-comment">//Â ä¸‹ä¸€æ¬¡åœ¨â€œæœ¬æ¬¡ç»“æŸåâ€å†å®‰æ’</span>
}
<span class="hljs-built_in">tick</span>();
</code></pre>
<p><strong>æ¯æ¬¡éƒ½æ˜¯â€œä¸Šä¸€æ¬¡ç»“æŸ + 1000msâ€ï¼Œä¸ä¼šå †ç§¯ï¼Œè¯¯å·®ä¸ç´¯ç§¯ï¼</strong></p>
<h2 data-id="heading-2">âœ… 3ã€å®Œæ•´ä»£ç </h2>
<p><strong>Timer.vueï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">&lt;scriptÂ setupÂ <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;
importÂ {Â onBeforeUnmount,Â refÂ }Â fromÂ 'vue'<span class="hljs-comment">;</span>
importÂ {
Â Â COMPLETE,
Â Â COUNTDOWN,
Â Â formatSeconds,
Â Â PAUSE,
Â Â RESET,
Â Â START,
Â Â UPDATE,
}Â fromÂ './timer.utils'<span class="hljs-comment">;</span>

constÂ <span class="hljs-attr">worker</span>Â =Â newÂ Worker(newÂ URL(<span class="hljs-string">'./timer.worker.ts'</span>,Â import.meta.url),Â {
Â Â type:Â 'module',
})<span class="hljs-comment">;</span>

constÂ <span class="hljs-attr">props</span>Â =Â withDefaults(
Â Â defineProps&lt;{
Â Â Â Â mode?:Â 'countdown'Â |Â 'countup'<span class="hljs-comment">;Â //Â è®¡æ—¶æ¨¡å¼:Â countdown:å€’è®¡æ—¶,Â countup:è®¡æ—¶</span>
Â Â Â Â remMinutes?:Â number<span class="hljs-comment">;Â //Â å€’è®¡æ—¶åˆå§‹åˆ†é’Ÿæ•°ï¼ˆä»…Â countdownÂ æ¨¡å¼æœ‰æ•ˆï¼‰</span>
Â Â Â Â immediate?:Â boolean<span class="hljs-comment">;Â //Â æ˜¯å¦ç«‹å³å¼€å§‹è®¡æ—¶</span>
Â Â Â Â control?:Â boolean<span class="hljs-comment">;Â //Â æ˜¯å¦æ˜¾ç¤ºæ§åˆ¶æŒ‰é’®</span>
Â Â Â Â step?:Â number<span class="hljs-comment">;Â //Â è®¡æ—¶æ­¥é•¿(å•ä½ï¼šç§’ï¼Œé™åˆ¶æ•´ç§’ï¼‰</span>
Â Â Â Â onStart?:Â ()Â =&gt;Â void<span class="hljs-comment">;</span>
Â Â Â Â onUpdate?:Â (time:Â string<span class="hljs-section">[]</span>)Â =&gt;Â void<span class="hljs-comment">;</span>
Â Â Â Â onPause?:Â (time:Â string<span class="hljs-section">[]</span>)Â =&gt;Â void<span class="hljs-comment">;</span>
Â Â Â Â onComplete?:Â ()Â =&gt;Â void<span class="hljs-comment">;</span>
Â Â Â Â onReset?:Â ()Â =&gt;Â void<span class="hljs-comment">;</span>
Â Â }&gt;(),
Â Â {
Â Â Â Â mode:Â COUNTDOWN,
Â Â Â Â immediate:Â true,
Â Â Â Â control:Â true,
Â Â Â Â step:Â 1,
Â Â }
)<span class="hljs-comment">;</span>

//Â å½“å‰è¿è¡ŒçŠ¶æ€ï¼š
//Â -Â undefinedï¼šæœªå¼€å§‹ï¼ˆåˆå§‹æˆ–é‡ç½®åï¼‰
//Â -Â trueï¼šæ­£åœ¨è¿è¡Œ
//Â -Â falseï¼šå·²æš‚åœ
constÂ <span class="hljs-attr">isStart</span>Â =Â ref&lt;boolean&gt;()<span class="hljs-comment">;</span>

//Â å½“å‰æ€»ç§’æ•°
letÂ <span class="hljs-attr">currentSeconds</span>Â =Â props.modeÂ ===Â COUNTDOWNÂ ?Â (props.remMinutesÂ ??Â <span class="hljs-number">0</span>)Â *Â <span class="hljs-number">60</span>Â :Â <span class="hljs-number">0</span><span class="hljs-comment">;</span>

//Â åˆå§‹åŒ–æ—¶é—´æ ¼å¼Â <span class="hljs-section">[HH,Â MM,Â SS]</span>
constÂ <span class="hljs-attr">initialTime</span>Â =Â formatSeconds(currentSeconds)<span class="hljs-comment">;</span>
constÂ <span class="hljs-attr">hours</span>Â =Â ref(initialTime[<span class="hljs-number">0</span>])<span class="hljs-comment">;</span>
constÂ <span class="hljs-attr">minutes</span>Â =Â ref(initialTime[<span class="hljs-number">1</span>])<span class="hljs-comment">;</span>
constÂ <span class="hljs-attr">seconds</span>Â =Â ref(initialTime[<span class="hljs-number">2</span>])<span class="hljs-comment">;</span>

listenWorkerMsg()<span class="hljs-comment">;</span>

ifÂ (props.immediate)Â {
Â Â start()<span class="hljs-comment">;</span>
}

functionÂ listenWorkerMsg()Â {
Â Â <span class="hljs-attr">worker.onmessage</span>Â =Â eventÂ =&gt;Â {
Â Â Â Â constÂ {Â time,Â type,Â rawSecondsÂ }Â =Â event.data<span class="hljs-comment">;</span>

Â Â Â Â ifÂ (<span class="hljs-attr">type</span>Â ===Â UPDATE)Â {
Â Â Â Â Â Â <span class="hljs-section">[hours.value,Â minutes.value,Â seconds.value]</span>Â =Â time<span class="hljs-comment">;</span>
Â Â Â Â Â Â <span class="hljs-attr">currentSeconds</span>Â =Â rawSeconds<span class="hljs-comment">;</span>
Â Â Â Â Â Â props.onUpdate?.(<span class="hljs-section">[hours.value,Â minutes.value,Â seconds.value]</span>Â asÂ string<span class="hljs-section">[]</span>)<span class="hljs-comment">;</span>
Â Â Â Â }

Â Â Â Â ifÂ (<span class="hljs-attr">type</span>Â ===Â COMPLETE)Â {
Â Â Â Â Â Â <span class="hljs-attr">isStart.value</span>Â =Â undefined<span class="hljs-comment">;</span>
Â Â Â Â Â Â props.onComplete?.()<span class="hljs-comment">;</span>
Â Â Â Â }
Â Â }<span class="hljs-comment">;</span>
}

functionÂ start()Â {
Â Â ifÂ (<span class="hljs-attr">isStart.value</span>Â ===Â <span class="hljs-literal">true</span>)Â {
Â Â Â Â return<span class="hljs-comment">;</span>
Â Â }
Â Â <span class="hljs-attr">isStart.value</span>Â =Â <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
Â Â constÂ {Â mode,Â stepÂ }Â =Â props<span class="hljs-comment">;</span>
Â Â worker.postMessage({
Â Â Â Â action:Â START,
Â Â Â Â step:Â Math.max(1,Â Math.floor(step)),Â //Â ä»…æ”¯æŒç§’çº§æ›´æ–°
Â Â Â Â mode,
Â Â Â Â currentSeconds,
Â Â })<span class="hljs-comment">;</span>
Â Â props.onStart?.()<span class="hljs-comment">;</span>
}

functionÂ pause()Â {
Â Â ifÂ (isStart.valueÂ !==Â true)Â {
Â Â Â Â return<span class="hljs-comment">;</span>
Â Â }
Â Â <span class="hljs-attr">isStart.value</span>Â =Â <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
Â Â worker.postMessage({Â action:Â PAUSEÂ })<span class="hljs-comment">;</span>
Â Â props.onPause?.(<span class="hljs-section">[hours.value,Â minutes.value,Â seconds.value]</span>Â asÂ string<span class="hljs-section">[]</span>)<span class="hljs-comment">;</span>
}

functionÂ reset()Â {
Â Â worker.postMessage({Â action:Â RESETÂ })<span class="hljs-comment">;</span>
Â Â <span class="hljs-attr">isStart.value</span>Â =Â undefined<span class="hljs-comment">;</span>
Â Â constÂ {Â mode,Â remMinutes,Â immediateÂ }Â =Â props<span class="hljs-comment">;</span>
Â Â <span class="hljs-attr">currentSeconds</span>Â =Â modeÂ ===Â COUNTDOWNÂ ?Â (remMinutesÂ ??Â <span class="hljs-number">0</span>)Â *Â <span class="hljs-number">60</span>Â :Â <span class="hljs-number">0</span><span class="hljs-comment">;</span>
Â Â ifÂ (immediate)Â {
Â Â Â Â start()<span class="hljs-comment">;</span>
Â Â }
Â Â props.onReset?.()<span class="hljs-comment">;</span>
}

onBeforeUnmount(()Â =&gt;Â {
Â Â worker.terminate()<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>

defineExpose({
Â Â start,
Â Â pause,
Â Â reset,
})<span class="hljs-comment">;</span>
&lt;/script&gt;
</code></pre>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span>Â <span class="hljs-attr">class</span>=<span class="hljs-string">"timer"</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span>Â <span class="hljs-attr">class</span>=<span class="hljs-string">"timer-container"</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">slot</span>Â <span class="hljs-attr">:hours</span>=<span class="hljs-string">"hours"</span>Â <span class="hljs-attr">:minutes</span>=<span class="hljs-string">"minutes"</span>Â <span class="hljs-attr">:seconds</span>=<span class="hljs-string">"seconds"</span>&gt;</span>
Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{Â hoursÂ }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">span</span>Â <span class="hljs-attr">class</span>=<span class="hljs-string">"delimiter"</span>&gt;</span>:<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{Â minutesÂ }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">span</span>Â <span class="hljs-attr">class</span>=<span class="hljs-string">"delimiter"</span>&gt;</span>:<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{Â secondsÂ }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span>Â <span class="hljs-attr">class</span>=<span class="hljs-string">"controls-container"</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">slot</span>Â <span class="hljs-attr">name</span>=<span class="hljs-string">"controls"</span>&gt;</span>
Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span>Â <span class="hljs-attr">v-if</span>=<span class="hljs-string">"control"</span>Â <span class="hljs-attr">class</span>=<span class="hljs-string">"controls"</span>&gt;</span>
Â Â Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">button</span>Â <span class="hljs-attr">class</span>=<span class="hljs-string">"btn"</span>Â <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"isStartÂ ===Â true"</span>Â @<span class="hljs-attr">click</span>=<span class="hljs-string">"start"</span>&gt;</span>å¼€å§‹<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
Â Â Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">button</span>Â <span class="hljs-attr">class</span>=<span class="hljs-string">"btn"</span>Â <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"isStartÂ ===Â false"</span>Â @<span class="hljs-attr">click</span>=<span class="hljs-string">"pause"</span>&gt;</span>æš‚åœ<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
Â Â Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">button</span>Â <span class="hljs-attr">class</span>=<span class="hljs-string">"btn"</span>Â @<span class="hljs-attr">click</span>=<span class="hljs-string">"reset"</span>&gt;</span>é‡ç½®<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>Â <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span>Â <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.timer-container</span>Â {
Â Â <span class="hljs-attribute">font-size</span>:Â <span class="hljs-number">20px</span>;
Â Â <span class="hljs-attribute">font-weight</span>:Â <span class="hljs-number">500</span>;
Â Â <span class="hljs-attribute">letter-spacing</span>:Â <span class="hljs-number">3px</span>;
Â Â <span class="hljs-attribute">display</span>:Â flex;
Â Â <span class="hljs-attribute">align-items</span>:Â center;
Â Â <span class="hljs-attribute">justify-content</span>:Â center;

Â Â <span class="hljs-selector-class">.delimiter</span>Â {
Â Â Â Â <span class="hljs-attribute">transform</span>:Â <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">1px</span>);
Â Â }
}

<span class="hljs-selector-class">.controls</span>Â {
Â Â <span class="hljs-attribute">margin-top</span>:Â <span class="hljs-number">8px</span>;
Â Â <span class="hljs-attribute">display</span>:Â flex;
Â Â <span class="hljs-attribute">align-items</span>:Â center;
Â Â <span class="hljs-attribute">justify-content</span>:Â center;

Â Â <span class="hljs-selector-class">.btn</span>Â {
Â Â Â Â <span class="hljs-attribute">margin</span>:Â <span class="hljs-number">0</span>Â <span class="hljs-number">4px</span>;
Â Â Â Â <span class="hljs-attribute">border-radius</span>:Â <span class="hljs-number">8px</span>;
Â Â Â Â <span class="hljs-attribute">border</span>:Â <span class="hljs-number">1px</span>Â solidÂ transparent;
Â Â Â Â <span class="hljs-attribute">padding</span>:Â <span class="hljs-number">0.6em</span>Â <span class="hljs-number">1.2em</span>;
Â Â }

Â Â <span class="hljs-selector-class">.btn</span><span class="hljs-selector-pseudo">:hover</span>Â {
Â Â Â Â <span class="hljs-attribute">border-color</span>:Â <span class="hljs-number">#646cff</span>;
Â Â }

Â Â <span class="hljs-selector-class">.btn</span><span class="hljs-selector-pseudo">:focus</span>,
Â Â <span class="hljs-selector-class">.btn</span><span class="hljs-selector-pseudo">:focus</span>-visibleÂ {
Â Â Â Â <span class="hljs-attribute">outline</span>:Â <span class="hljs-number">4px</span>Â autoÂ -webkit-focus-ring-color;
Â Â }

Â Â &amp;<span class="hljs-selector-class">.disabled</span>Â {
Â Â Â Â <span class="hljs-selector-class">.btn</span>Â {
Â Â Â Â Â Â <span class="hljs-attribute">background</span>:Â <span class="hljs-number">#f4f4f4</span>;
Â Â Â Â Â Â <span class="hljs-attribute">cursor</span>:Â not-allowed;
Â Â Â Â }
Â Â }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><strong>timer.worker.tsï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">/**
Â *Â webÂ workerÂ é˜²æ­¢ä¸»çº¿ç¨‹é˜»å¡ã€æµè§ˆå™¨æ ‡ç­¾é¡µæœªæ¿€æ´»æ—¶ï¼Œå½±å“è®¡æ—¶ç²¾åº¦
Â */

importÂ {
Â Â COMPLETE,
Â Â COUNTDOWN,
Â Â COUNTUP,
Â Â formatSeconds,
Â Â PAUSE,
Â Â RESET,
Â Â START,
Â Â UPDATE,
}Â fromÂ './timer.utils.ts'<span class="hljs-comment">;</span>

letÂ <span class="hljs-attr">isRunning</span>Â =Â <span class="hljs-literal">false</span><span class="hljs-comment">;Â //Â æ˜¯å¦è¿è¡Œä¸­</span>
letÂ timeoutId:Â numberÂ |Â null<span class="hljs-comment">;</span>

<span class="hljs-attr">self.onmessage</span>Â =Â eventÂ =&gt;Â {
Â Â constÂ {Â action,Â mode,Â step,Â currentSecondsÂ }Â =Â event.data<span class="hljs-comment">;</span>

Â Â //Â é‡ç½®/æš‚åœ
Â Â ifÂ (<span class="hljs-attr">action</span>Â ===Â RESETÂ ||Â actionÂ ===Â PAUSE)Â {
Â Â Â Â stopTimer()<span class="hljs-comment">;</span>
Â Â Â Â return<span class="hljs-comment">;</span>
Â Â }

Â Â //Â å¼€å§‹
Â Â ifÂ (<span class="hljs-attr">action</span>Â ===Â START)Â {
Â Â Â Â stopTimer()<span class="hljs-comment">;</span>
Â Â Â Â <span class="hljs-attr">isRunning</span>Â =Â <span class="hljs-literal">true</span><span class="hljs-comment">;</span>

Â Â Â Â ifÂ (<span class="hljs-attr">mode</span>Â ===Â COUNTDOWN)Â {
Â Â Â Â Â Â startCountdown(currentSeconds,Â step)<span class="hljs-comment">;</span>
Â Â Â Â }

Â Â Â Â ifÂ (<span class="hljs-attr">mode</span>Â ===Â COUNTUP)Â {
Â Â Â Â Â Â startCountup(currentSeconds,Â step)<span class="hljs-comment">;</span>
Â Â Â Â }
Â Â }
}<span class="hljs-comment">;</span>

functionÂ startCountdown(remaining:Â number,Â step:Â number)Â {
Â Â constÂ <span class="hljs-attr">tick</span>Â =Â ()Â =&gt;Â {
Â Â Â Â ifÂ (!isRunning)Â return<span class="hljs-comment">;</span>

Â Â Â Â //Â å‘é€å½“å‰æ—¶é—´çŠ¶æ€
Â Â Â Â self.postMessage({
Â Â Â Â Â Â type:Â UPDATE,
Â Â Â Â Â Â time:Â formatSeconds(remaining),
Â Â Â Â Â Â rawSeconds:Â remaining,
Â Â Â Â })<span class="hljs-comment">;</span>

Â Â Â Â //Â å¦‚æœå·²ç»“æŸ
Â Â Â Â ifÂ (remainingÂ &lt;=Â 0)Â {
Â Â Â Â Â Â self.postMessage({Â type:Â COMPLETEÂ })<span class="hljs-comment">;</span>
Â Â Â Â Â Â stopTimer()<span class="hljs-comment">;</span>
Â Â Â Â Â Â return<span class="hljs-comment">;</span>
Â Â Â Â }

Â Â Â Â //Â è®¡ç®—ä¸‹ä¸€æ¬¡å‰©ä½™æ—¶é—´ï¼ˆç¡®ä¿ä¸å°äºÂ 0ï¼‰
Â Â Â Â constÂ <span class="hljs-attr">nextRemaining</span>Â =Â Math.max(<span class="hljs-number">0</span>,Â remainingÂ -Â step)<span class="hljs-comment">;</span>
Â Â Â Â constÂ <span class="hljs-attr">delay</span>Â =Â (remainingÂ -Â nextRemaining)Â *Â <span class="hljs-number">1000</span><span class="hljs-comment">;Â //Â ç²¾ç¡®å»¶è¿Ÿ</span>

Â Â Â Â ifÂ (nextRemainingÂ &gt;Â 0)Â {
Â Â Â Â Â Â //Â ç»§ç»­å€’è®¡æ—¶
Â Â Â Â Â Â <span class="hljs-attr">timeoutId</span>Â =Â self.setTimeout(tick,Â delay)<span class="hljs-comment">;</span>
Â Â Â Â }Â elseÂ {
Â Â Â Â Â Â //Â æœ€åä¸€æ¬¡å½’é›¶
Â Â Â Â Â Â <span class="hljs-attr">timeoutId</span>Â =Â self.setTimeout(()Â =&gt;Â {
Â Â Â Â Â Â Â Â self.postMessage({
Â Â Â Â Â Â Â Â Â Â type:Â UPDATE,
Â Â Â Â Â Â Â Â Â Â time:Â formatSeconds(0),
Â Â Â Â Â Â Â Â Â Â rawSeconds:Â 0,
Â Â Â Â Â Â Â Â })<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â self.postMessage({Â type:Â COMPLETEÂ })<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â stopTimer()<span class="hljs-comment">;</span>
Â Â Â Â Â Â },Â delay)<span class="hljs-comment">;</span>
Â Â Â Â }

Â Â Â Â <span class="hljs-attr">remaining</span>Â =Â nextRemaining<span class="hljs-comment">;</span>
Â Â }<span class="hljs-comment">;</span>

Â Â tick()<span class="hljs-comment">;Â //Â ç«‹å³è§¦å‘ç¬¬ä¸€æ¬¡æ›´æ–°ï¼ˆæ˜¾ç¤ºåˆå§‹å€¼ï¼‰</span>
}

functionÂ startCountup(elapsed:Â number,Â step:Â number)Â {
Â Â constÂ <span class="hljs-attr">tick</span>Â =Â ()Â =&gt;Â {
Â Â Â Â ifÂ (!isRunning)Â return<span class="hljs-comment">;</span>

Â Â Â Â self.postMessage({
Â Â Â Â Â Â type:Â UPDATE,
Â Â Â Â Â Â time:Â formatSeconds(elapsed),
Â Â Â Â Â Â rawSeconds:Â elapsed,
Â Â Â Â })<span class="hljs-comment">;</span>

Â Â Â Â elapsedÂ +=Â step<span class="hljs-comment">;</span>
Â Â Â Â <span class="hljs-attr">timeoutId</span>Â =Â self.setTimeout(tick,Â stepÂ *Â <span class="hljs-number">1000</span>)<span class="hljs-comment">;</span>
Â Â }<span class="hljs-comment">;</span>

Â Â tick()<span class="hljs-comment">;</span>
}

functionÂ stopTimer()Â {
Â Â ifÂ (timeoutId)Â {
Â Â Â Â self.clearTimeout(timeoutId)<span class="hljs-comment">;</span>
Â Â Â Â <span class="hljs-attr">timeoutId</span>Â =Â null<span class="hljs-comment">;</span>
Â Â }
Â Â <span class="hljs-attr">isRunning</span>Â =Â <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
}
</code></pre>
<p><strong>timer.utils.ts:</strong></p>
<pre><code class="hljs language-ini" lang="ini">functionÂ formatSeconds(totalSeconds:Â number)Â {
Â Â <span class="hljs-attr">totalSeconds</span>Â =Â Math.max(<span class="hljs-number">0</span>,Â totalSeconds)<span class="hljs-comment">;</span>
Â Â constÂ <span class="hljs-attr">h</span>Â =Â Math.floor(totalSecondsÂ /Â <span class="hljs-number">3600</span>)<span class="hljs-comment">;</span>
Â Â constÂ <span class="hljs-attr">m</span>Â =Â Math.floor((totalSecondsÂ %Â <span class="hljs-number">3600</span>)Â /Â <span class="hljs-number">60</span>)<span class="hljs-comment">;</span>
Â Â constÂ <span class="hljs-attr">s</span>Â =Â totalSecondsÂ %Â <span class="hljs-number">60</span><span class="hljs-comment">;</span>
Â Â returnÂ <span class="hljs-section">[h,Â m,Â s]</span>.map(<span class="hljs-attr">v</span>Â =&gt;Â String(v).padStart(<span class="hljs-number">2</span>,Â <span class="hljs-string">'0'</span>))<span class="hljs-comment">;</span>
}

constÂ <span class="hljs-attr">COUNTDOWN</span>Â =Â <span class="hljs-string">'countdown'</span><span class="hljs-comment">;</span>
constÂ <span class="hljs-attr">COUNTUP</span>Â =Â <span class="hljs-string">'countup'</span><span class="hljs-comment">;</span>

constÂ <span class="hljs-attr">START</span>Â =Â <span class="hljs-string">'start'</span><span class="hljs-comment">;</span>
constÂ <span class="hljs-attr">PAUSE</span>Â =Â <span class="hljs-string">'pause'</span><span class="hljs-comment">;</span>
constÂ <span class="hljs-attr">RESET</span>Â =Â <span class="hljs-string">'reset'</span><span class="hljs-comment">;</span>

constÂ <span class="hljs-attr">UPDATE</span>Â =Â <span class="hljs-string">'update'</span><span class="hljs-comment">;</span>
constÂ <span class="hljs-attr">COMPLETE</span>Â =Â <span class="hljs-string">'complete'</span><span class="hljs-comment">;</span>

exportÂ {
Â Â formatSeconds,
Â Â COUNTDOWN,
Â Â COUNTUP,
Â Â START,
Â Â PAUSE,
Â Â RESET,
Â Â UPDATE,
Â Â COMPLETE,
}<span class="hljs-comment">;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++ä¸­æœ‰åŒå‘æ˜ å°„æ•°æ®ç»“æ„å—ï¼ŸKeyå’ŒValueèƒ½å¦åŒå‘æŸ¥æ‰¾ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7572385850635534342</link>    <guid>https://juejin.cn/post/7572385850635534342</guid>    <pubDate>2025-11-14T10:24:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572385850635534342" data-draft-id="7572385850635501574" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++ä¸­æœ‰åŒå‘æ˜ å°„æ•°æ®ç»“æ„å—ï¼ŸKeyå’ŒValueèƒ½å¦åŒå‘æŸ¥æ‰¾ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-14T10:24:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="oioihoii"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++ä¸­æœ‰åŒå‘æ˜ å°„æ•°æ®ç»“æ„å—ï¼ŸKeyå’ŒValueèƒ½å¦åŒå‘æŸ¥æ‰¾ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    oioihoii
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T10:24:11.000Z" title="Fri Nov 14 2025 10:24:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    15
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨æ—¥å¸¸çš„C++å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°è¿™æ ·çš„éœ€æ±‚ï¼šä¸ä»…éœ€è¦é€šè¿‡keyå¿«é€Ÿæ‰¾åˆ°valueï¼Œè¿˜éœ€è¦é€šè¿‡valueåæŸ¥keyã€‚è¿™ç§åŒå‘æ˜ å°„çš„éœ€æ±‚åœ¨å®é™…é¡¹ç›®ä¸­ååˆ†å¸¸è§ï¼Œæ¯”å¦‚ç”¨æˆ·IDä¸ç”¨æˆ·åçš„æ˜ å°„ã€é”™è¯¯ç ä¸é”™è¯¯ä¿¡æ¯çš„å¯¹åº”å…³ç³»ç­‰ã€‚é‚£ä¹ˆï¼ŒC++æ ‡å‡†åº“æ˜¯å¦æä¾›äº†è¿™æ ·çš„æ•°æ®ç»“æ„å‘¢ï¼Ÿ</p>
<h2 data-id="heading-0">C++æ ‡å‡†åº“çš„ç°çŠ¶ï¼šä»¤äººé—æ†¾çš„ç¼ºå¤±</h2>
<p>ä»¤äººé—æ†¾çš„æ˜¯ï¼ŒC++æ ‡å‡†åº“ä¸­å¹¶æ²¡æœ‰ç›´æ¥æä¾›ä¸“é—¨çš„åŒå‘æ˜ å°„æ•°æ®ç»“æ„ã€‚æˆ‘ä»¬ç†Ÿæ‚‰çš„<code>std::map</code>å’Œ<code>std::unordered_map</code>éƒ½åªèƒ½å®ç°å•å‘æŸ¥æ‰¾â€”â€”åªèƒ½é€šè¿‡keyæŸ¥æ‰¾valueï¼Œæ— æ³•é€šè¿‡valueå¿«é€Ÿæ‰¾åˆ°keyã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unordered_map&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>

<span class="hljs-comment">// ä¼ ç»Ÿçš„unordered_mapåªèƒ½å•å‘æŸ¥æ‰¾</span>
std::unordered_map&lt;<span class="hljs-type">int</span>, std::string&gt; single_map;
single_map[<span class="hljs-number">1</span>] = <span class="hljs-string">"Alice"</span>;
single_map[<span class="hljs-number">2</span>] = <span class="hljs-string">"Bob"</span>;

<span class="hljs-comment">// å¯ä»¥é€šè¿‡keyæ‰¾åˆ°value</span>
std::string name = single_map[<span class="hljs-number">1</span>];  <span class="hljs-comment">// æ­£ç¡®ï¼šå¾—åˆ°"Alice"</span>

<span class="hljs-comment">// ä½†æ˜¯æ— æ³•ç›´æ¥é€šè¿‡valueæ‰¾åˆ°key</span>
<span class="hljs-comment">// éœ€è¦éå†æ•´ä¸ªmapï¼Œæ•ˆç‡ä½ä¸‹ï¼</span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">findKeyByValue</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; value)</span> </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; pair : single_map) {
        <span class="hljs-keyword">if</span> (pair.second == value) {
            <span class="hljs-keyword">return</span> pair.first;
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// æœªæ‰¾åˆ°</span>
}
</code></pre>
<p>è¿™ç§éå†æŸ¥æ‰¾çš„æ–¹å¼æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œåœ¨æ•°æ®é‡è¾ƒå¤§æ—¶æ€§èƒ½æ˜¯æ— æ³•æ¥å—çš„ã€‚</p>
<h2 data-id="heading-1">è§£å†³æ–¹æ¡ˆï¼šè‡ªå·±åŠ¨æ‰‹ï¼Œä¸°è¡£è¶³é£Ÿ</h2>
<p>æ—¢ç„¶æ ‡å‡†åº“æ²¡æœ‰æä¾›ï¼Œæˆ‘ä»¬å°±éœ€è¦è‡ªå·±å®ç°ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„è§£å†³æ–¹æ¡ˆï¼š</p>
<h3 data-id="heading-2">æ–¹æ¡ˆä¸€ï¼šåŒunordered_mapå®ç°ï¼ˆæ¨èï¼‰</h3>
<p>è¿™æ˜¯æœ€ç›´æ¥ä¸”é«˜æ•ˆçš„æ–¹æ³•ï¼Œç»´æŠ¤ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Œåˆ†åˆ«å­˜å‚¨key-&gt;valueå’Œvalue-&gt;keyçš„æ˜ å°„å…³ç³»ã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unordered_map&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdexcept&gt;</span></span>

<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> K, <span class="hljs-keyword">typename</span> V&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BiDirectionalMap</span> {
<span class="hljs-keyword">private</span>:
    std::unordered_map&lt;K, V&gt; key_to_value;
    std::unordered_map&lt;V, K&gt; value_to_key;

<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// æ’å…¥é”®å€¼å¯¹</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(<span class="hljs-type">const</span> K&amp; key, <span class="hljs-type">const</span> V&amp; value)</span> </span>{
        <span class="hljs-keyword">if</span> (key_to_value.<span class="hljs-built_in">count</span>(key) || value_to_key.<span class="hljs-built_in">count</span>(value)) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">invalid_argument</span>(<span class="hljs-string">"Key or value already exists"</span>);
        }
        key_to_value[key] = value;
        value_to_key[value] = key;
    }
    
    <span class="hljs-comment">// é€šè¿‡keyè·å–value</span>
    <span class="hljs-function">V <span class="hljs-title">getValue</span><span class="hljs-params">(<span class="hljs-type">const</span> K&amp; key)</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">auto</span> it = key_to_value.<span class="hljs-built_in">find</span>(key);
        <span class="hljs-keyword">if</span> (it == key_to_value.<span class="hljs-built_in">end</span>()) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">out_of_range</span>(<span class="hljs-string">"Key not found"</span>);
        }
        <span class="hljs-keyword">return</span> it-&gt;second;
    }
    
    <span class="hljs-comment">// é€šè¿‡valueè·å–key</span>
    <span class="hljs-function">K <span class="hljs-title">getKey</span><span class="hljs-params">(<span class="hljs-type">const</span> V&amp; value)</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">auto</span> it = value_to_key.<span class="hljs-built_in">find</span>(value);
        <span class="hljs-keyword">if</span> (it == value_to_key.<span class="hljs-built_in">end</span>()) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">out_of_range</span>(<span class="hljs-string">"Value not found"</span>);
        }
        <span class="hljs-keyword">return</span> it-&gt;second;
    }
    
    <span class="hljs-comment">// æ£€æŸ¥keyæ˜¯å¦å­˜åœ¨</span>
    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">containsKey</span><span class="hljs-params">(<span class="hljs-type">const</span> K&amp; key)</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> key_to_value.<span class="hljs-built_in">find</span>(key) != key_to_value.<span class="hljs-built_in">end</span>();
    }
    
    <span class="hljs-comment">// æ£€æŸ¥valueæ˜¯å¦å­˜åœ¨</span>
    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">containsValue</span><span class="hljs-params">(<span class="hljs-type">const</span> V&amp; value)</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> value_to_key.<span class="hljs-built_in">find</span>(value) != value_to_key.<span class="hljs-built_in">end</span>();
    }
    
    <span class="hljs-comment">// é€šè¿‡keyåˆ é™¤</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">eraseByKey</span><span class="hljs-params">(<span class="hljs-type">const</span> K&amp; key)</span> </span>{
        <span class="hljs-keyword">auto</span> it = key_to_value.<span class="hljs-built_in">find</span>(key);
        <span class="hljs-keyword">if</span> (it != key_to_value.<span class="hljs-built_in">end</span>()) {
            value_to_key.<span class="hljs-built_in">erase</span>(it-&gt;second);
            key_to_value.<span class="hljs-built_in">erase</span>(it);
        }
    }
    
    <span class="hljs-comment">// é€šè¿‡valueåˆ é™¤</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">eraseByValue</span><span class="hljs-params">(<span class="hljs-type">const</span> V&amp; value)</span> </span>{
        <span class="hljs-keyword">auto</span> it = value_to_key.<span class="hljs-built_in">find</span>(value);
        <span class="hljs-keyword">if</span> (it != value_to_key.<span class="hljs-built_in">end</span>()) {
            key_to_value.<span class="hljs-built_in">erase</span>(it-&gt;second);
            value_to_key.<span class="hljs-built_in">erase</span>(it);
        }
    }
    
    <span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">size</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> key_to_value.<span class="hljs-built_in">size</span>();
    }
    
    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">empty</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> key_to_value.<span class="hljs-built_in">empty</span>();
    }
};

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    BiDirectionalMap&lt;<span class="hljs-type">int</span>, std::string&gt; id_name_map;
    
    <span class="hljs-comment">// æ’å…¥æ•°æ®</span>
    id_name_map.<span class="hljs-built_in">insert</span>(<span class="hljs-number">1</span>, <span class="hljs-string">"Alice"</span>);
    id_name_map.<span class="hljs-built_in">insert</span>(<span class="hljs-number">2</span>, <span class="hljs-string">"Bob"</span>);
    id_name_map.<span class="hljs-built_in">insert</span>(<span class="hljs-number">3</span>, <span class="hljs-string">"Charlie"</span>);
    
    <span class="hljs-comment">// åŒå‘æŸ¥æ‰¾</span>
    std::cout &lt;&lt; <span class="hljs-string">"Name for ID 2: "</span> &lt;&lt; id_name_map.<span class="hljs-built_in">getValue</span>(<span class="hljs-number">2</span>) &lt;&lt; std::endl; <span class="hljs-comment">// Bob</span>
    std::cout &lt;&lt; <span class="hljs-string">"ID for name 'Alice': "</span> &lt;&lt; id_name_map.<span class="hljs-built_in">getKey</span>(<span class="hljs-string">"Alice"</span>) &lt;&lt; std::endl; <span class="hljs-comment">// 1</span>
    
    <span class="hljs-comment">// åˆ é™¤æ“ä½œ</span>
    id_name_map.<span class="hljs-built_in">eraseByKey</span>(<span class="hljs-number">3</span>); <span class="hljs-comment">// é€šè¿‡keyåˆ é™¤</span>
    id_name_map.<span class="hljs-built_in">eraseByValue</span>(<span class="hljs-string">"Bob"</span>); <span class="hljs-comment">// é€šè¿‡valueåˆ é™¤</span>
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>è¿™ç§å®ç°çš„ä¼˜ç‚¹æ˜¯ï¼š</p>
<ul>
<li><strong>æŸ¥æ‰¾æ•ˆç‡é«˜</strong>ï¼šä¸¤ä¸ªæ–¹å‘éƒ½æ˜¯O(1)æ—¶é—´å¤æ‚åº¦</li>
<li><strong>å®ç°ç®€å•</strong>ï¼šä»£ç ç›´è§‚æ˜“æ‡‚</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šæ”¯æŒä¸åŒçš„keyå’Œvalueç±»å‹</li>
</ul>
<p>ç¼ºç‚¹æ˜¯ï¼š</p>
<ul>
<li><strong>å†…å­˜å ç”¨ç¿»å€</strong>ï¼šéœ€è¦å­˜å‚¨ä¸¤ä»½æ•°æ®</li>
<li><strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼šéœ€è¦ç¡®ä¿ä¸¤ä¸ªmapå§‹ç»ˆä¿æŒåŒæ­¥</li>
</ul>
<h3 data-id="heading-3">æ–¹æ¡ˆäºŒï¼šä½¿ç”¨Boost.Bimap</h3>
<p>å¦‚æœä½ ä¸ä»‹æ„ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼ŒBooståº“æä¾›äº†ç°æˆçš„<code>bimap</code>å®ç°ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;boost/bimap.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    boost::bimap&lt;<span class="hljs-type">int</span>, std::string&gt; bimap;
    
    <span class="hljs-comment">// æ’å…¥æ•°æ®</span>
    bimap.<span class="hljs-built_in">insert</span>({<span class="hljs-number">1</span>, <span class="hljs-string">"Alice"</span>});
    bimap.<span class="hljs-built_in">insert</span>({<span class="hljs-number">2</span>, <span class="hljs-string">"Bob"</span>});
    bimap.<span class="hljs-built_in">insert</span>({<span class="hljs-number">3</span>, <span class="hljs-string">"Charlie"</span>});
    
    <span class="hljs-comment">// å·¦è§†å›¾ï¼škey-&gt;value</span>
    <span class="hljs-keyword">auto</span> left_it = bimap.left.<span class="hljs-built_in">find</span>(<span class="hljs-number">2</span>);
    <span class="hljs-keyword">if</span> (left_it != bimap.left.<span class="hljs-built_in">end</span>()) {
        std::cout &lt;&lt; <span class="hljs-string">"Left lookup: "</span> &lt;&lt; left_it-&gt;second &lt;&lt; std::endl; <span class="hljs-comment">// Bob</span>
    }
    
    <span class="hljs-comment">// å³è§†å›¾ï¼švalue-&gt;key</span>
    <span class="hljs-keyword">auto</span> right_it = bimap.right.<span class="hljs-built_in">find</span>(<span class="hljs-string">"Alice"</span>);
    <span class="hljs-keyword">if</span> (right_it != bimap.right.<span class="hljs-built_in">end</span>()) {
        std::cout &lt;&lt; <span class="hljs-string">"Right lookup: "</span> &lt;&lt; right_it-&gt;second &lt;&lt; std::endl; <span class="hljs-comment">// 1</span>
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>Boost.Bimapçš„ä¼˜ç‚¹ï¼š</p>
<ul>
<li><strong>åŠŸèƒ½å®Œå–„</strong>ï¼šæä¾›äº†ä¸°å¯Œçš„æ¥å£å’Œé…ç½®é€‰é¡¹</li>
<li><strong>ç»è¿‡å……åˆ†æµ‹è¯•</strong>ï¼šå·¥ä¸šçº§è´¨é‡</li>
<li><strong>æ”¯æŒå¤šç§æ˜ å°„ç±»å‹</strong>ï¼šä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šç­‰</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li><strong>ä¾èµ–Booståº“</strong>ï¼šéœ€è¦é¢å¤–å®‰è£…å’Œé…ç½®</li>
<li><strong>ç¼–è¯‘æ—¶é—´å¢åŠ </strong>ï¼šæ¨¡æ¿ä»£ç è¾ƒå¤š</li>
</ul>
<h3 data-id="heading-4">æ–¹æ¡ˆä¸‰ï¼šå•ä¸€å®¹å™¨çš„å·§å¦™ç”¨æ³•</h3>
<p>åœ¨æŸäº›ç‰¹å®šåœºæ™¯ä¸‹ï¼Œå¦‚æœkeyå’Œvalueçš„ç±»å‹ç›¸åŒä¸”ä¸ä¼šå†²çªï¼Œå¯ä»¥ä½¿ç”¨å•ä¸€å®¹å™¨ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unordered_map&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SymmetricMap</span> {
<span class="hljs-keyword">private</span>:
    std::unordered_map&lt;std::string, std::string&gt; data;

<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; a, <span class="hljs-type">const</span> std::string&amp; b)</span> </span>{
        data[a] = b;
        data[b] = a;
    }
    
    <span class="hljs-function">std::string <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; key)</span> </span>{
        <span class="hljs-keyword">auto</span> it = data.<span class="hljs-built_in">find</span>(key);
        <span class="hljs-keyword">return</span> it != data.<span class="hljs-built_in">end</span>() ? it-&gt;second : <span class="hljs-string">""</span>;
    }
    
    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">contains</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; key)</span> </span>{
        <span class="hljs-keyword">return</span> data.<span class="hljs-built_in">find</span>(key) != data.<span class="hljs-built_in">end</span>();
    }
};

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹ï¼šåŸŸåä¸IPæ˜ å°„ï¼ˆå‡è®¾ä¸ä¼šå†²çªï¼‰</span>
SymmetricMap domain_ip_map;
domain_ip_map.<span class="hljs-built_in">insert</span>(<span class="hljs-string">"google.com"</span>, <span class="hljs-string">"8.8.8.8"</span>);
domain_ip_map.<span class="hljs-built_in">insert</span>(<span class="hljs-string">"github.com"</span>, <span class="hljs-string">"1.1.1.1"</span>);

std::cout &lt;&lt; domain_ip_map.<span class="hljs-built_in">get</span>(<span class="hljs-string">"google.com"</span>); <span class="hljs-comment">// 8.8.8.8</span>
std::cout &lt;&lt; domain_ip_map.<span class="hljs-built_in">get</span>(<span class="hljs-string">"8.8.8.8"</span>);    <span class="hljs-comment">// google.com</span>
</code></pre>
<p>è¿™ç§æ–¹æ³•åªé€‚ç”¨äºå¾ˆæœ‰é™çš„åœºæ™¯ï¼Œä½¿ç”¨æ—¶éœ€è¦æ ¼å¤–å°å¿ƒã€‚</p>
<h2 data-id="heading-5">æ€§èƒ½è€ƒé‡ï¼šå¦‚ä½•é€‰æ‹©é€‚åˆçš„æ–¹æ¡ˆï¼Ÿ</h2>
<p>åœ¨é€‰æ‹©åŒå‘æ˜ å°„çš„å®ç°æ–¹æ¡ˆæ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å› ç´ ï¼š</p>
<ol>
<li>
<p><strong>æ•°æ®è§„æ¨¡</strong></p>
<ul>
<li>å°æ•°æ®é‡ï¼šä»»ä½•æ–¹æ¡ˆéƒ½å¯ä»¥</li>
<li>å¤§æ•°æ®é‡ï¼šä¼˜å…ˆè€ƒè™‘åŒunordered_mapæˆ–Boost.Bimap</li>
</ul>
</li>
<li>
<p><strong>æ€§èƒ½è¦æ±‚</strong></p>
<ul>
<li>è¦æ±‚O(1)æŸ¥æ‰¾ï¼šé€‰æ‹©åŸºäºå“ˆå¸Œè¡¨çš„å®ç°</li>
<li>å¯ä»¥æ¥å—O(log n)ï¼šä¹Ÿå¯ä»¥è€ƒè™‘åŸºäºstd::mapçš„å®ç°</li>
</ul>
</li>
<li>
<p><strong>å¼€å‘ç¯å¢ƒ</strong></p>
<ul>
<li>å…è®¸ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼šè€ƒè™‘Boost.Bimap</li>
<li>çº¯æ ‡å‡†åº“ç¯å¢ƒï¼šé€‰æ‹©åŒunordered_mapå®ç°</li>
</ul>
</li>
<li>
<p><strong>å†…å­˜é™åˆ¶</strong></p>
<ul>
<li>å†…å­˜å……è¶³ï¼šåŒunordered_map</li>
<li>å†…å­˜ç´§å¼ ï¼šå¯èƒ½éœ€è¦è€ƒè™‘å…¶ä»–ä¼˜åŒ–æ–¹æ¡ˆ</li>
</ul>
</li>
</ol>
<h2 data-id="heading-6">å®é™…åº”ç”¨åœºæ™¯</h2>
<p>åŒå‘æ˜ å°„åœ¨çœŸå®é¡¹ç›®ä¸­æœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// åœºæ™¯1ï¼šç”¨æˆ·ç³»ç»Ÿ</span>
BiDirectionalMap&lt;UserID, std::string&gt; user_system;
user_system.<span class="hljs-built_in">insert</span>(<span class="hljs-number">1001</span>, <span class="hljs-string">"alice@email.com"</span>);
user_system.<span class="hljs-built_in">insert</span>(<span class="hljs-number">1002</span>, <span class="hljs-string">"bob@email.com"</span>);

<span class="hljs-comment">// æ—¢å¯ä»¥é€šè¿‡IDæ‰¾é‚®ç®±ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é‚®ç®±æ‰¾ID</span>

<span class="hljs-comment">// åœºæ™¯2ï¼šé…ç½®ç³»ç»Ÿ</span>
BiDirectionalMap&lt;std::string, <span class="hljs-type">int</span>&gt; config_map;
config_map.<span class="hljs-built_in">insert</span>(<span class="hljs-string">"MAX_CONNECTIONS"</span>, <span class="hljs-number">100</span>);
config_map.<span class="hljs-built_in">insert</span>(<span class="hljs-string">"TIMEOUT_MS"</span>, <span class="hljs-number">5000</span>);

<span class="hljs-comment">// åœºæ™¯3ï¼šæšä¸¾å€¼æ˜ å°„</span>
<span class="hljs-keyword">enum class</span> <span class="hljs-title class_">ErrorCode</span> { SUCCESS, NOT_FOUND, PERMISSION_DENIED };
BiDirectionalMap&lt;ErrorCode, std::string&gt; error_messages;
error_messages.<span class="hljs-built_in">insert</span>(ErrorCode::SUCCESS, <span class="hljs-string">"Operation successful"</span>);
error_messages.<span class="hljs-built_in">insert</span>(ErrorCode::NOT_FOUND, <span class="hljs-string">"Resource not found"</span>);
</code></pre>
<h2 data-id="heading-7">æ€»ç»“ä¸å»ºè®®</h2>
<p>å›åˆ°æˆ‘ä»¬æœ€åˆçš„é—®é¢˜ï¼šC++ä¸­æœ‰åŒå‘æ˜ å°„æ•°æ®ç»“æ„å—ï¼Ÿç­”æ¡ˆæ˜¯ï¼šæ ‡å‡†åº“ä¸­æ²¡æœ‰ç›´æ¥æä¾›ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®ç°ã€‚</p>
<p><strong>ç»™å¼€å‘è€…çš„å»ºè®®ï¼š</strong></p>
<ol>
<li>
<p><strong>å¯¹äºå¤§å¤šæ•°é¡¹ç›®</strong>ï¼Œæ¨èä½¿ç”¨åŒ<code>std::unordered_map</code>çš„å®ç°ï¼Œå®ƒç®€å•ã€é«˜æ•ˆä¸”ä¸ä¾èµ–å¤–éƒ¨åº“ã€‚</p>
</li>
<li>
<p><strong>å¯¹äºå¤æ‚é¡¹ç›®</strong>ï¼Œå¦‚æœå·²ç»åœ¨ä½¿ç”¨Booståº“ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨<code>boost::bimap</code>ã€‚</p>
</li>
<li>
<p><strong>å¯¹äºæ€§èƒ½æ•æ„Ÿçš„åœºæ™¯</strong>ï¼ŒåŠ¡å¿…è¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼Œé€‰æ‹©æœ€é€‚åˆå…·ä½“ç”¨ä¾‹çš„å®ç°ã€‚</p>
</li>
<li>
<p><strong>è®°å¾—å¤„ç†å¼‚å¸¸æƒ…å†µ</strong>ï¼Œç‰¹åˆ«æ˜¯åœ¨æ’å…¥é‡å¤keyæˆ–valueæ—¶çš„å¤„ç†ç­–ç•¥ã€‚</p>
</li>
</ol>
<p>åŒå‘æ˜ å°„è™½ç„¶ä¸åœ¨C++æ ‡å‡†åº“ä¸­ï¼Œä½†é€šè¿‡åˆç†çš„å°è£…å’Œè®¾è®¡ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥æ„å»ºå‡ºé«˜æ•ˆã€æ˜“ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚è¿™æ­£ä½“ç°äº†C++çš„å“²å­¦ï¼šä¸æä¾›ä½ ä¸éœ€è¦çš„ä¸œè¥¿ï¼Œä½†ç»™ä½ æ„å»ºæ‰€éœ€ä¸€åˆ‡çš„å·¥å…·ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸŒ å®æ—¶ååŒ AIGCï¼šå¤šäººåœ¨çº¿ Web åˆ›ä½œçš„æŠ€æœ¯æ¶æ„è®¾è®¡]]></title>    <link>https://juejin.cn/post/7572408522439049251</link>    <guid>https://juejin.cn/post/7572408522439049251</guid>    <pubDate>2025-11-15T11:57:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572408522439049251" data-draft-id="7572408522439032867" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸŒ å®æ—¶ååŒ AIGCï¼šå¤šäººåœ¨çº¿ Web åˆ›ä½œçš„æŠ€æœ¯æ¶æ„è®¾è®¡"/> <meta itemprop="keywords" content="å‰ç«¯,Trae,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-15T11:57:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸŒ å®æ—¶ååŒ AIGCï¼šå¤šäººåœ¨çº¿ Web åˆ›ä½œçš„æŠ€æœ¯æ¶æ„è®¾è®¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T11:57:51.000Z" title="Sat Nov 15 2025 11:57:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"â";top:8px;left:5px}.markdown-body blockquote:after{content:"â";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸ§  ä¸€ã€å‰è¨€ï¼šä»å•æœºAIåˆ°ç¾¤ä½“åˆ›ä½œçš„æ¼”åŒ–</h2>
<p>ä¸€ä¸ªäººå¯¹ç€AIç”»å›¾ã€ç”Ÿæˆæ–‡æ¡ˆï¼Œåƒç‹¬è‡ªè°ˆæ‹çˆ±ã€‚<br/>
è€Œå½“ä½ å’Œ5ä¸ªä¼™ä¼´ä¸€èµ·å®æ—¶æ”¹æç¤ºè¯ã€AIåŒæ­¥ç»˜ç”»æ—¶ï¼Œé‚£å°±æ˜¯<strong>å¤šçº¿ç¨‹çš„çˆ±æƒ…æ•…äº‹</strong>ã€‚</p>
<p>å®æ—¶ååŒ AIGCï¼ˆAI Generated Contentï¼‰æ­£å¤„åœ¨ç§‘å­¦ä¸è‰ºæœ¯çš„äº¤æ±‡ç‚¹ï¼š<br/>
å®ƒè¦ä¿è¯<strong>åŒæ­¥æ€§</strong>ã€<strong>ä¸€è‡´æ€§</strong>ã€<strong>ä½å»¶è¿Ÿæ„Ÿ</strong>ï¼ŒåŒæ—¶è®©AIåƒâ€œè‰ºæœ¯åŠ©ç†â€ï¼Œåœ¨å¤šç”¨æˆ·åŒæ—¶æ“ä½œä¸‹ä¿æŒé€»è¾‘ä¼˜é›…ï¼Œè€Œéç²¾ç¥åˆ†è£‚ã€‚</p>
<hr/>
<h2 data-id="heading-1">ğŸ§© äºŒã€ä¼ ç»ŸAIGCåä½œçš„é—®é¢˜ï¼šAI æ€»æ…¢åŠæ‹</h2>
<p>åœ¨ç»å…¸ AIGC åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¸¸è§çš„äº¤äº’æ¨¡å¼æ˜¯ï¼š</p>
<ol>
<li>ç”¨æˆ·æäº¤æç¤ºè¯ï¼›</li>
<li>æœåŠ¡ç«¯æ‰§è¡Œæ¨ç†ï¼›</li>
<li>æ¨¡å‹ç”Ÿæˆç»“æœï¼›</li>
<li>å®¢æˆ·ç«¯æ¸²æŸ“è¾“å‡ºã€‚</li>
</ol>
<p>å¬ä¸Šå»æµç¨‹æ¸…æ™°ï¼Œä½†â€œä¸€è‡´æ€§â€å´æ˜¯è‡´å‘½ä¼¤ï¼š</p>
<ul>
<li>A æ”¹äº†æç¤ºè¯ï¼ŒB è¿˜åœ¨åŸºäºæ—§ç‰ˆæœ¬ç”Ÿæˆã€‚</li>
<li>èŠå¤©åä½œåŒºå»¶è¿ŸåŒæ­¥ï¼ŒAIå¿½ç„¶è¾“å‡ºâ€œä¸¤ç§é£æ ¼æ··åˆâ€çš„å°´å°¬ä½œå“ã€‚</li>
<li>æ–‡ä»¶ç‰ˆæœ¬å†²çªï¼Œè®©AIä¸çŸ¥å¬è°çš„å‘½ä»¤ã€‚</li>
</ul>
<p>è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦çš„ä¸æ˜¯æ›´å¿«çš„æ˜¾å¡ï¼Œè€Œæ˜¯<strong>æ›´èªæ˜çš„æ¶æ„</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-2">ğŸ•¸ ä¸‰ã€åº•å±‚åŸç†ï¼šè®© AI ä¸äººç±»å…±äº«â€œçŠ¶æ€å®‡å®™â€</h2>
<p>è¦è®© AIGC å®æ—¶ååŒï¼Œç³»ç»Ÿå¿…é¡»å…·å¤‡ä¸€ç§èƒ½åŠ›ï¼š</p>
<blockquote>
<p><strong>æ¯ä¸ªç”¨æˆ·ä¸AIçœ‹åˆ°çš„ä¸–ç•Œï¼Œå¿…é¡»åŒæºã€åŒæ€ã€å¯å†²çªæ¢å¤ã€‚</strong></p>
</blockquote>
<p>è¿™èƒŒåçš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>CRDTs</strong>ï¼ˆConflict-free Replicated Data Typesï¼‰æˆ–<strong>Operational Transformation (OT)</strong> ã€‚</p>
<p>é€šä¿—ç‚¹è®²ï¼Œå®ƒåƒæ˜¯ä¸€ä¸ªâ€œçŠ¶æ€å¤šå…ƒå®‡å®™â€ï¼š<br/>
æ¯ä¸ªç”¨æˆ·éƒ½èƒ½è‡ªç”±ä¿®æ”¹è‡ªå·±çš„â€œå±€éƒ¨çŠ¶æ€â€ï¼Œç³»ç»Ÿä¼šåœ¨åå°<strong>åˆå¹¶æ—¶é—´çº¿</strong>ï¼Œç¡®ä¿æœ€ç»ˆçš„ç°å®ä¸å´©æºƒã€‚</p>
<hr/>
<h2 data-id="heading-3">âš™ï¸ å››ã€æ€»ä½“æ¶æ„è®¾è®¡â€”â€”è®©AIå‚ä¸ç¼–èˆ</h2>
<p>ä¼ ç»Ÿåä½œæ–‡æ¡£æ¶æ„ä¸€èˆ¬æ˜¯ç”¨æˆ·é—´ä¿¡æ¯åŒæ­¥ï¼Œ<br/>
è€Œåœ¨<strong>ååŒAIGC</strong>ä¸­ï¼ŒAIæœ¬èº«ä¹Ÿæˆä¸ºä¸€ä¸ªâ€œè™šæ‹Ÿå‚ä¸è€…â€ï¼Œå…±äº«åä½œç©ºé—´ä¸­çš„çŠ¶æ€ã€‚</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[ Client User A ]</span> â†”
                     \
                      <span class="hljs-selector-attr">[ Realtime Sync Layer ]</span> â†” <span class="hljs-selector-attr">[ AI Co-Generator Engine ]</span>
                     /
<span class="hljs-selector-attr">[ Client User B ]</span> â†”
</code></pre>
<h3 data-id="heading-4">å…³é”®æ¨¡å—è§£æï¼š</h3>
<ol>
<li>
<p><strong>å‰ç«¯å®æ—¶æ„ŸçŸ¥å±‚ï¼ˆWebRTC / WebSocketï¼‰</strong></p>
<ul>
<li>ä¿è¯æ¯«ç§’çº§çŠ¶æ€åŒæ­¥ï¼›</li>
<li>ä½¿ç”¨å·®é‡çŠ¶æ€ï¼ˆdelta stateï¼‰ä¼ è¾“ä»¥å‡å°‘å¸¦å®½ï¼›</li>
</ul>
</li>
<li>
<p><strong>åä½œçŠ¶æ€å¼•æ“ï¼ˆCRDT / OTï¼‰</strong></p>
<ul>
<li>ç®¡ç†æ‰€æœ‰ç”¨æˆ·çš„æ“ä½œæ„å›¾ï¼›</li>
<li>è‡ªåŠ¨å¤„ç†å†²çªã€æ—¶åºã€ç‰ˆæœ¬ï¼›</li>
</ul>
</li>
<li>
<p><strong>AI Co-Generator Engineï¼ˆå…±åˆ›å¼•æ“ï¼‰</strong></p>
<ul>
<li>ç›‘å¬å…¨å±€çŠ¶æ€å˜åŒ–ï¼›</li>
<li>ç»“åˆä¸Šä¸‹æ–‡ã€ä¿®æ”¹å†å²ã€ç”¨æˆ·æƒé‡ä½œè¯­ä¹‰èåˆç”Ÿæˆï¼›</li>
</ul>
</li>
<li>
<p><strong>æ¸²æŸ“ä¸åé¦ˆæ¨¡å—</strong></p>
<ul>
<li>è¿”å›AIç”Ÿæˆçš„ä¸­é—´ç‰‡æ®µï¼Œå®ç°å®æ—¶å¯è§†åŒ–åé¦ˆï¼›</li>
<li>è®©AIGCä»¿ä½›åœ¨å’Œæ¯ä½ç”¨æˆ·â€œå¯¹è¯ä½œç”»â€ã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-5">ğŸ”§ äº”ã€æ ¸å¿ƒé€»è¾‘ç¤ºä¾‹ (JavaScript)</h2>
<p>ä¸‹é¢ä»¥ç²¾ç®€ç‰ˆä¼ªä»£ç å±•ç¤º <strong>å¤šç”¨æˆ·å®æ—¶å…±åˆ›AIGC</strong> çš„çŠ¶æ€é€šä¿¡ä¸åŒæ­¥ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// ğŸŒ Realtime Collaborative AIGC Prototype

const <span class="hljs-attr">users</span> = new Map()<span class="hljs-comment">;</span>
const <span class="hljs-attr">sharedState</span> = { prompt: <span class="hljs-string">""</span>, version: <span class="hljs-number">0</span> }<span class="hljs-comment">;</span>
const <span class="hljs-attr">WebSocketServer</span> = require(<span class="hljs-string">"ws"</span>).Server<span class="hljs-comment">;</span>

const <span class="hljs-attr">wss</span> = new WebSocketServer({ port: <span class="hljs-number">8080</span> })<span class="hljs-comment">;</span>

// æ¨¡æ‹Ÿ AI æ¨¡å—ï¼ˆå‡è£…èªæ˜ï¼‰
function generateAIResponse(prompt) {
  const <span class="hljs-attr">responses</span> = [
    <span class="hljs-string">"AIæ„æ€æ–°çš„è§†è§‰æ„å›¾..."</span>,
    <span class="hljs-string">"æ¨¡å‹æ­£åœ¨èåˆè‰ºæœ¯å®¶Aä¸Bçš„æç¤º..."</span>,
    <span class="hljs-string">"ğŸ¨ AIè¯´ï¼šè¿™ä¸€æ¬¡æˆ‘ä»¬ç”»å‡ºçµæ„Ÿçš„æ³¢åŠ¨ã€‚"</span>
  ]<span class="hljs-comment">;</span>
  return responses<span class="hljs-section">[Math.floor(Math.random() * responses.length)]</span><span class="hljs-comment">;</span>
}

// å¹¿æ’­å‡½æ•°
function broadcast(state) {
  for (const user of users.values()) {
    user.send(JSON.stringify(state))<span class="hljs-comment">;</span>
  }
}

wss.on("connection", function connection(ws) {
  const <span class="hljs-attr">id</span> = Date.now()<span class="hljs-comment">;</span>
  users.set(id, ws)<span class="hljs-comment">;</span>

  ws.on("message", (msg) =&gt; {
    const <span class="hljs-attr">data</span> = JSON.parse(msg)<span class="hljs-comment">;</span>
    <span class="hljs-attr">sharedState.prompt</span> = data.prompt<span class="hljs-comment">;</span>
    sharedState.version++<span class="hljs-comment">;</span>

    // è°ƒç”¨AIç”Ÿæˆé€»è¾‘
    const <span class="hljs-attr">aiReply</span> = generateAIResponse(sharedState.prompt)<span class="hljs-comment">;</span>
    <span class="hljs-attr">sharedState.aiResponse</span> = aiReply<span class="hljs-comment">;</span>

    broadcast(sharedState)<span class="hljs-comment">;</span>
  })<span class="hljs-comment">;</span>

  ws.on("close", () =&gt; users.delete(id))<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<p>ğŸ’¡ ä¸Šè¿°æ¶æ„æ¨¡æ‹Ÿäº†ä¸€ä¸ªéå¸¸åŸå§‹çš„â€œååŒAIç”Ÿæˆç³»ç»Ÿâ€ï¼š</p>
<ul>
<li>æ‰€æœ‰äººå…±äº«ä¸€ä¸ªæç¤ºè¯çŠ¶æ€ï¼›</li>
<li>å®æ—¶å¹¿æ’­AIçš„å“åº”ï¼›</li>
<li>æ‰€æœ‰å®¢æˆ·ç«¯éƒ½ä¿æŒåŒæ­¥â€œåˆ›é€ å®‡å®™â€ã€‚</li>
</ul>
<p>çœŸå®æƒ…å†µä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ Redis + CRDT + Vector Clock ç­‰æœºåˆ¶åšæ›´ç¨³å¥çš„ç‰ˆæœ¬åˆå¹¶ã€‚</p>
<hr/>
<h2 data-id="heading-6">ğŸ’¬ å…­ã€ä¸€è‡´æ€§ â‰  åŒæ­¥ï¼Œè€Œæ˜¯â€œæ—¶é—´çš„ç¼–æ’â€</h2>
<p>å¾ˆå¤šå·¥ç¨‹å¸ˆè¯¯ä»¥ä¸º<strong>åŒæ­¥</strong>å°±ä»£è¡¨ä¸€è‡´æ€§ï¼Œ<br/>
ä½†åœ¨å®æ—¶AIGCä¸­ï¼Œä¸€è‡´æ€§æ›´åƒæ˜¯ä¸€ç§<strong>è¯­ä¹‰å…±è¯†</strong>ï¼š</p>
<ul>
<li>ç”¨æˆ·Aè¾“å…¥â€œæ·»åŠ è“è‰²ç¯å…‰â€ï¼›</li>
<li>ç”¨æˆ·Båœ¨åŒä¸€æ—¶åˆ»ä¿®æ”¹â€œèƒŒæ™¯ä¸ºå¤œç©ºâ€ï¼›</li>
<li>AIå¿…é¡»æ˜ç™½ä¸¤ä¸ªæ„å›¾ä¸æ˜¯å†²çªï¼Œè€Œæ˜¯<strong>åŒåœºè¡¨æ¼”</strong>ã€‚</li>
</ul>
<p>æ‰€ä»¥æœªæ¥çš„AIGCç³»ç»Ÿï¼Œä¸ä»…éœ€è¦è¯†åˆ«æç¤ºæ–‡æœ¬ï¼Œè¿˜è¦ç†è§£<strong>å¤šäººè¯­æ„ä¸»å¼ ä¹‹é—´çš„å’Œè°å†²çªå…³ç³»</strong>ã€‚</p>
<p>å¯ä»¥è¯´ï¼ŒAIä¸ä»…ç”Ÿæˆå›¾åƒï¼Œä¹Ÿè¦æ‡‚å¾—â€œç¤¾ä¼šååŒè¯­è¨€å­¦â€ã€‚</p>
<hr/>
<h2 data-id="heading-7">ğŸ”® ä¸ƒã€å“²å­¦å°¾å£°ï¼šAIï¼Œä¸åªæ˜¯ç”»å®¶ï¼Œæ›´æ˜¯åˆä½œè€…</h2>
<p>å½“å¤šäººåŒæ—¶åœ¨Webé¡µé¢ä¸Šä¸AIå…±åŒåˆ›ä½œæ—¶ï¼Œ<br/>
æˆ‘ä»¬å…¶å®åœ¨æ„å»ºä¸€ç§<strong>æ–°çš„é›†ä½“æ™ºèƒ½ç»“æ„</strong>ï¼š</p>
<blockquote>
<p>ç”¨æˆ·è´¡çŒ®ä¸Šä¸‹æ–‡ï¼ŒAIè´¡çŒ®æ¨¡å¼ï¼›<br/>
ç³»ç»Ÿä¸€è‡´æ¨¡å‹ç»´æŒçŠ¶æ€ï¼›<br/>
åˆ›é€ åŠ›ä¸å†æ˜¯ä¸ªä½“çš„ï¼Œè€Œæ˜¯å…±äº«çš„èµ„æºåœºã€‚</p>
</blockquote>
<p>æˆ–è®¸æœªæ¥çš„â€œç”»å¸ƒâ€ä¸æ˜¯Canvasï¼Œè€Œæ˜¯ä¸€ä¸ªæœ‰ç”Ÿå‘½çš„ã€å¯äº¤äº’çš„AIç½‘ç»œç”Ÿå‘½ä½“ã€‚<br/>
æ¯ä¸€æ¬¡æ–‡å­—è¾“å…¥ã€æ¯ä¸€ç¬”ç¬”è§¦ï¼Œä¸åªæ˜¯æ•°æ®ï¼Œè€Œæ˜¯ä¸€æ¬¡åœ¨<strong>äººæœºå…±æŒ¯</strong>ä¸‹çš„ååŒè¯—ç¯‡ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ”¥ â€œSolo Codingâ€çš„è¿‘æœŸçƒ­åº¦è§£æï¼ˆæˆªè‡³ 2025 å¹´æœ«ï¼‰]]></title>    <link>https://juejin.cn/post/7572453554331795456</link>    <guid>https://juejin.cn/post/7572453554331795456</guid>    <pubDate>2025-11-15T11:56:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572453554331795456" data-draft-id="7572454929144758307" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ”¥ â€œSolo Codingâ€çš„è¿‘æœŸçƒ­åº¦è§£æï¼ˆæˆªè‡³ 2025 å¹´æœ«ï¼‰"/> <meta itemprop="keywords" content="Trae,äººå·¥æ™ºèƒ½,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-15T11:56:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ”¥ â€œSolo Codingâ€çš„è¿‘æœŸçƒ­åº¦è§£æï¼ˆæˆªè‡³ 2025 å¹´æœ«ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T11:56:31.000Z" title="Sat Nov 15 2025 11:56:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"â";top:8px;left:5px}.markdown-body blockquote:after{content:"â";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ğŸ§  ä¸€ã€æ¦‚å¿µå›é¡¾</h3>
<p><strong>Solo Coding</strong> å¹¶ä¸æ˜¯æ–°è¯ï¼Œä½†åœ¨è¿‡å»ä¸€å¹´éšç€ <strong>AIGC ç¼–ç¨‹è¾…åŠ©å·¥å…·ï¼ˆå¦‚ Copilotã€Cursorã€TabNineã€ChatGPT Code Interpreterï¼‰</strong> çš„æ™®åŠï¼Œå®ƒè¢«é‡æ–°å®šä¹‰ä¸ºï¼š</p>
<blockquote>
<p><strong>ä¸€ä¸ªäººç‹¬ç«‹å¼€å‘å®Œæ•´ç³»ç»Ÿï¼Œä½†å…·å¤‡å›¢é˜Ÿçº§æ•ˆç‡ã€‚</strong></p>
</blockquote>
<p>è¿™ä¸ä¼ ç»Ÿæ„ä¹‰çš„â€œç‹¬ç«‹å¼€å‘è€…ï¼ˆIndie Developerï¼‰â€ä¸åŒï¼Œæ ¸å¿ƒåœ¨äºå€ŸåŠ© AI çš„åˆä½œåŠ›é‡ï¼Œå®ç°å‡†å›¢é˜Ÿå¼çš„ä¸ªäººç”Ÿäº§åŠ›çˆ†å‘ã€‚</p>
<hr/>
<h3 data-id="heading-1">ğŸ“ˆ äºŒã€çƒ­åº¦å¢é•¿è¶‹åŠ¿</h3>

























<table><thead><tr><th>æ—¶é—´åŒºé—´</th><th>å…³é”®è¯è¶‹åŠ¿å˜åŒ–</th><th>ä¸»è¦é©±åŠ¨å› ç´ </th></tr></thead><tbody><tr><td>2024 Q4</td><td>ç¨³å®šä¸Šå‡</td><td>AIç¼–ç¨‹åŠ©æ‰‹æ™®åŠã€åˆ›ä¸šæ½®æ¶ŒåŠ¨</td></tr><tr><td>2025 Q1</td><td>æ˜æ˜¾å¢é•¿</td><td>GitHub &amp; HuggingFace æ¨å‡ºâ€œAIåä½œå·¥ä½œæµâ€</td></tr><tr><td>2025 Q3â€”Q4</td><td>é«˜çƒ­ç¨³å®šé˜¶æ®µ</td><td>ä¸ªäººAIå¼€å‘è€…ç”Ÿæ€ï¼ˆAI Indie Devï¼‰å½¢æˆåœˆå±‚</td></tr></tbody></table>
<p>ç›®å‰åœ¨å¼€å‘è€…ç¤¾åŒºï¼ˆRedditã€æ¨ç‰¹ã€Bç«™ã€çŸ¥ä¹ã€HackerNewsï¼‰ä¸­ï¼Œâ€œsolo codingâ€å¸¸ä¸ä»¥ä¸‹è¯ç›¸å…³è”ï¼š</p>
<ul>
<li>AIGC + DevOps</li>
<li>AI pair programmer</li>
<li>One-man startup</li>
<li>AutoDeploy AI</li>
<li>Web full-stack with GPT</li>
</ul>
<hr/>
<h3 data-id="heading-2">ğŸ’¡ ä¸‰ã€ä¸ºä»€ä¹ˆå®ƒè¿™ä¹ˆç«ï¼Ÿ</h3>
<ol>
<li><strong>AIå·¥å…·é—¨æ§›ä¸‹é™</strong> â€”â€” æ— éœ€åºå¤§å›¢é˜Ÿï¼Œä¹Ÿèƒ½å®Œæˆç«¯åˆ°ç«¯åº”ç”¨ã€‚</li>
<li><strong>äº‘ç«¯èµ„æºæŒ‰éœ€è®¡è´¹</strong> â€”â€” å¼¹æ€§æœåŠ¡å™¨ã€æ— æœåŠ¡å™¨æ¶æ„ï¼ˆServerlessï¼‰è®©ä¸ªäººéƒ¨ç½²å˜å¾—å®¹æ˜“ã€‚</li>
<li><strong>ç¤¾ä¼šå¿ƒç†è½¬å‘</strong> â€”â€” è¶Šæ¥è¶Šå¤šå¼€å‘è€…è¿½æ±‚â€œä¸ªäººåˆ›é€ è‡ªç”±åº¦â€ï¼ŒAIè®©å•äººé¡¹ç›®å…·å¤‡â€œå›¢é˜Ÿçµé­‚â€ã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-3">ğŸ§© å››ã€ç°å®ä¸­çš„ Solo Coding å…¸å‹åœºæ™¯</h3>
<ul>
<li>ä½¿ç”¨ ChatGPT/Cursor + VSCode ç‹¬ç«‹æ­å»º SaaS é¡¹ç›®</li>
<li>ä¸€äººå¼€å‘ + AI è‡ªåŠ¨åŒ–ç”Ÿæˆ UIã€APIã€æ–‡æ¡£</li>
<li>åœ¨äº‘å¹³å°ä¸Š3åˆ†é’Ÿç”Ÿæˆéƒ¨ç½²ç¯å¢ƒï¼ˆAI + IaCï¼‰</li>
<li>AIç”Ÿæˆæµ‹è¯•ã€æç¤ºè¯é©±åŠ¨ä»£ç ã€è‡ªåŠ¨CI/CD</li>
</ul>
<hr/>
<h3 data-id="heading-4">ğŸš€ äº”ã€æœªæ¥è¶‹åŠ¿å±•æœ›</h3>
<blockquote>
<p><strong>Solo Coding â†’ AI-Orchestrated Development</strong></p>
</blockquote>
<p>æœªæ¥ä¸‰å¹´ï¼Œâ€œsolo codingâ€ ä¼šæ¼”å˜ä¸ºä¸€ç§â€œAIç¼–æ’å¼å¼€å‘â€ï¼š</p>
<ul>
<li>å•äººè´Ÿè´£æ¶æ„ä¸é€»è¾‘æ€ç»´</li>
<li>AIè´Ÿè´£ç¼–ç ã€éƒ¨ç½²ä¸è¿ç»´</li>
<li>å›¢é˜Ÿé¡¹ç›®æ¼”å˜ä¸ºâ€œå¤šæ™ºèƒ½ä½“ååŒç³»ç»Ÿâ€</li>
</ul>
<p>å¯ä»¥å°†å®ƒè§†ä¸ºå¼€å‘ç•Œçš„â€œé‡å­æ€åˆ›ä¸šâ€â€”â€”<br/>
ä½ ä¸€ä¸ªäººï¼Œå´åƒä¸€ä¸ªå¤šè¿›ç¨‹è¿è¡Œçš„å›¢é˜Ÿã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€ç©¿è¶ŠEffective C++ã€‘æ¡æ¬¾19ï¼šè®¾è®¡classçŠ¹å¦‚è®¾è®¡typeâ€”â€”ç”¨æˆ·å®šä¹‰ç±»å‹çš„è‰ºæœ¯ä¸ç§‘å­¦]]></title>    <link>https://juejin.cn/post/7572137760448200745</link>    <guid>https://juejin.cn/post/7572137760448200745</guid>    <pubDate>2025-11-14T08:41:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572137760448200745" data-draft-id="7572039006530650148" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€ç©¿è¶ŠEffective C++ã€‘æ¡æ¬¾19ï¼šè®¾è®¡classçŠ¹å¦‚è®¾è®¡typeâ€”â€”ç”¨æˆ·å®šä¹‰ç±»å‹çš„è‰ºæœ¯ä¸ç§‘å­¦"/> <meta itemprop="keywords" content="C++,é¢è¯•"/> <meta itemprop="datePublished" content="2025-11-14T08:41:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ²æ€¡æ—¸"/> <meta itemprop="url" content="https://juejin.cn/user/2875978146656750"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€ç©¿è¶ŠEffective C++ã€‘æ¡æ¬¾19ï¼šè®¾è®¡classçŠ¹å¦‚è®¾è®¡typeâ€”â€”ç”¨æˆ·å®šä¹‰ç±»å‹çš„è‰ºæœ¯ä¸ç§‘å­¦
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978146656750/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ²æ€¡æ—¸
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T08:41:11.000Z" title="Fri Nov 14 2025 08:41:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿™ä¸ªæ¡æ¬¾æ­ç¤ºäº†C++é¢å‘å¯¹è±¡è®¾è®¡çš„æ ¸å¿ƒç†å¿µï¼šå®šä¹‰æ–°classå°±æ˜¯å®šä¹‰æ–°typeã€‚ä¼˜ç§€çš„classè®¾è®¡åº”è¯¥è®©ç”¨æˆ·å®šä¹‰ç±»å‹ä¸å†…ç½®ç±»å‹æ— ç¼åä½œï¼Œè¿™è¦æ±‚æˆ‘ä»¬åœ¨è®¾è®¡æ—¶è€ƒè™‘ç±»å‹ç³»ç»Ÿçš„å®Œæ•´æ€§ã€ä¸€è‡´æ€§å’Œç›´è§‚æ€§ã€‚</p>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3192f88c8a34169975da1a2c32874e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKQ5oCh5pe4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763714471&amp;x-signature=I7wIk%2F3NvpACB342B5FOZzZ78hQ%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-0"><strong>æ€ç»´å¯¼å›¾ï¼šclassè®¾è®¡çš„å®Œæ•´ä½“ç³»</strong></h3>
<hr/>
<h3 data-id="heading-1"><strong>å…³é”®æ´è§ä¸è¡ŒåŠ¨æŒ‡å—</strong></h3>
<h4 data-id="heading-2"><strong>å¿…é¡»éµå®ˆçš„æ ¸å¿ƒåŸåˆ™ï¼š</strong></h4>
<ol>
<li><strong>ç±»å‹å®Œæ•´æ€§</strong>ï¼šç”¨æˆ·å®šä¹‰ç±»å‹åº”è¯¥æä¾›å®Œæ•´çš„è¡Œä¸ºè¯­ä¹‰ï¼Œä¸å†…ç½®ç±»å‹æ— ç¼åä½œ</li>
<li><strong>èµ„æºå®‰å…¨</strong>ï¼šéµå¾ªRAIIåŸåˆ™ï¼Œç¡®ä¿èµ„æºçš„æ­£ç¡®è·å–å’Œé‡Šæ”¾</li>
<li><strong>æ¥å£ä¸€è‡´æ€§</strong>ï¼šæä¾›ç›´è§‚ã€ä¸€è‡´çš„æ¥å£ï¼Œç¬¦åˆç”¨æˆ·çš„å¿ƒç†é¢„æœŸ</li>
<li><strong>å¼‚å¸¸å®‰å…¨</strong>ï¼šæ˜ç¡®æ ‡æ³¨å¹¶ä¿è¯ä¸åŒçº§åˆ«çš„å¼‚å¸¸å®‰å…¨æ€§</li>
</ol>
<h4 data-id="heading-3"><strong>ç°ä»£C++å¼€å‘å»ºè®®ï¼š</strong></h4>
<ol>
<li><strong>ä¸‰äº”æ³•åˆ™åº”ç”¨</strong>ï¼šæ ¹æ®éœ€è¦å®šä¹‰æ‹·è´æ§åˆ¶æˆå‘˜ï¼Œæˆ–ä½¿ç”¨=default/=delete</li>
<li><strong>ç§»åŠ¨è¯­ä¹‰æ”¯æŒ</strong>ï¼šä¸ºèµ„æºç®¡ç†ç±»æä¾›ç§»åŠ¨æ“ä½œä»¥è·å¾—æ€§èƒ½ä¼˜åŠ¿</li>
<li><strong>noexceptæ­£ç¡®ä½¿ç”¨</strong>ï¼šå¯¹ä¸æŠ›å¼‚å¸¸çš„æ“ä½œæ­£ç¡®æ ‡è®°noexcept</li>
<li><strong>constexpræ”¯æŒ</strong>ï¼šä¸ºå¯åœ¨ç¼–è¯‘æœŸè®¡ç®—çš„æ“ä½œæä¾›constexpr</li>
</ol>
<h4 data-id="heading-4"><strong>è®¾è®¡åŸåˆ™æ€»ç»“ï¼š</strong></h4>
<ol>
<li><strong>æœ€å°å®Œæ•´åŸåˆ™</strong>ï¼šæä¾›æœ€å°ä½†å®Œæ•´çš„æ¥å£é›†åˆ</li>
<li><strong>è¯­ä¹‰æ˜ç¡®åŸåˆ™</strong>ï¼šæ¯ä¸ªæ“ä½œéƒ½æœ‰æ˜ç¡®ã€ä¸€è‡´çš„è¯­ä¹‰</li>
<li><strong>èµ„æºè‡ªæ²»åŸåˆ™</strong>ï¼šç±»å‹è´Ÿè´£ç®¡ç†è‡ªå·±çš„èµ„æº</li>
<li><strong>æ‰©å±•å¼€æ”¾åŸåˆ™</strong>ï¼šè®¾è®¡å…è®¸åˆç†çš„æ‰©å±•è€Œä¸ç ´åç°æœ‰ä»£ç </li>
</ol>
<h4 data-id="heading-5"><strong>éœ€è¦è­¦æƒ•çš„é™·é˜±ï¼š</strong></h4>
<ol>
<li><strong>éšå¼è½¬æ¢é™·é˜±</strong>ï¼šå•å‚æ•°æ„é€ å‡½æ•°å’Œè½¬æ¢è¿ç®—ç¬¦çš„è¯¯ç”¨</li>
<li><strong>åˆ‡ç‰‡é—®é¢˜</strong>ï¼šå€¼è¯­ä¹‰ä¸‹çš„å¯¹è±¡åˆ‡ç‰‡</li>
<li><strong>å¼‚å¸¸å®‰å…¨æ¼æ´</strong>ï¼šèµ„æºæ³„æ¼å’Œä¸ä¸€è‡´çŠ¶æ€</li>
<li><strong>çº¿ç¨‹å®‰å…¨æ··æ·†</strong>ï¼šé”™è¯¯çš„çº¿ç¨‹å®‰å…¨å‡è®¾</li>
</ol>
<p><strong>æœ€ç»ˆå»ºè®®ï¼š</strong> å°†æ¯ä¸ªclassè®¾è®¡è§†ä¸ºè¯­è¨€æ‰©å±•çš„æœºä¼šã€‚åŸ¹å…»"è¯­è¨€è®¾è®¡è€…æ€ç»´"â€”â€”åœ¨è®¾è®¡æ¯ä¸ªclassæ—¶éƒ½æ€è€ƒï¼š"è¿™ä¸ªç±»å‹åº”è¯¥æ€æ ·èå…¥C++ç±»å‹ç³»ç»Ÿï¼Ÿå®ƒçš„è¡Œä¸ºåº”è¯¥åƒå†…ç½®ç±»å‹å—ï¼Ÿç”¨æˆ·ä¼šæ€æ ·ä½¿ç”¨å®ƒï¼Ÿ" è¿™ç§æ€ç»´æ–¹å¼æ˜¯æ„å»ºä¼˜ç§€C++ä»£ç åº“çš„å…³é”®ã€‚</p>
<p>è®°ä½ï¼š<strong>åœ¨C++ä¸­ï¼Œè®¾è®¡classå°±æ˜¯è®¾è®¡typeã€‚ä¼˜ç§€çš„ç”¨æˆ·å®šä¹‰ç±»å‹åº”è¯¥è®©ä½¿ç”¨è€…å¿˜è®°å®ƒæ˜¯ç”¨æˆ·å®šä¹‰çš„ã€‚</strong> æ¡æ¬¾19æ•™ä¼šæˆ‘ä»¬çš„ä¸ä»…æ˜¯ä¸€ç»„æŠ€æœ¯è§„åˆ™ï¼Œæ›´æ˜¯é¢å‘å¯¹è±¡è®¾è®¡å“²å­¦åœ¨C++ä¸­çš„å…·ä½“ä½“ç°ã€‚</p>
<hr/>
<h3 data-id="heading-6"><strong>æ·±å…¥è§£æï¼šclassè®¾è®¡çš„æ ¸å¿ƒæŒ‘æˆ˜</strong></h3>
<h4 data-id="heading-7"><strong>1. é—®é¢˜æ ¹æºï¼šç±»å‹è¯­ä¹‰çš„å®Œæ•´æ€§</strong></h4>
<p><strong>å…¸å‹çš„ä¸å®Œæ•´ç±»å‹è®¾è®¡ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ç³Ÿç³•çš„å­—ç¬¦ä¸²ç±»å‹è®¾è®¡ - è¯­ä¹‰ä¸å®Œæ•´</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BadString</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">BadString</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* str) {
        <span class="hljs-keyword">if</span> (str) {
            data_ = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[<span class="hljs-built_in">strlen</span>(str) + <span class="hljs-number">1</span>];
            <span class="hljs-built_in">strcpy</span>(data_, str);
        }
    }
    
    ~<span class="hljs-built_in">BadString</span>() {
        <span class="hljs-keyword">delete</span>[] data_;
    }
    
    <span class="hljs-comment">// ç¼ºå°‘æ‹·è´æ„é€ å‡½æ•°ï¼</span>
    <span class="hljs-comment">// ç¼ºå°‘æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ï¼</span>
    <span class="hljs-comment">// ç¼ºå°‘ç§»åŠ¨æ“ä½œï¼</span>
    
    <span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">char</span>* <span class="hljs-title">c_str</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> data_; }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">char</span>* data_ = <span class="hljs-literal">nullptr</span>;
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_incomplete_type</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">BadString <span class="hljs-title">s1</span><span class="hljs-params">(<span class="hljs-string">"hello"</span>)</span></span>;
    
    <span class="hljs-comment">// ç¾éš¾ï¼é»˜è®¤æ‹·è´æ˜¯æµ…æ‹·è´</span>
    <span class="hljs-comment">// BadString s2 = s1;  // åŒé‡åˆ é™¤ï¼</span>
    
    <span class="hljs-comment">// åŒæ ·çš„é—®é¢˜ï¼</span>
    <span class="hljs-comment">// BadString s3("world");</span>
    <span class="hljs-comment">// s3 = s1;  // å†…å­˜æ³„æ¼ + åŒé‡åˆ é™¤ï¼</span>
    
    <span class="hljs-comment">// æ— æ³•é«˜æ•ˆè¿”å›ï¼</span>
    <span class="hljs-comment">// auto createString() -&gt; BadString {</span>
    <span class="hljs-comment">//     BadString local("local");</span>
    <span class="hljs-comment">//     return local;  // æ˜‚è´µçš„æ‹·è´ï¼</span>
    <span class="hljs-comment">// }</span>
}
</code></pre>
<p><strong>èµ„æºç®¡ç†çš„ä¸å®Œæ•´è®¾è®¡ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// èµ„æºç®¡ç†ä¸å®Œæ•´çš„æ–‡ä»¶ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BadFile</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">BadFile</span>(<span class="hljs-type">const</span> std::string&amp; filename) 
        : <span class="hljs-built_in">handle_</span>(<span class="hljs-built_in">fopen</span>(filename.<span class="hljs-built_in">c_str</span>(), <span class="hljs-string">"r"</span>)) {
        <span class="hljs-keyword">if</span> (!handle_) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">runtime_error</span>(<span class="hljs-string">"æ— æ³•æ‰“å¼€æ–‡ä»¶"</span>);
        }
    }
    
    ~<span class="hljs-built_in">BadFile</span>() {
        <span class="hljs-keyword">if</span> (handle_) {
            <span class="hljs-built_in">fclose</span>(handle_);
        }
    }
    
    <span class="hljs-comment">// è¯»å–æ–‡ä»¶å†…å®¹</span>
    <span class="hljs-function">std::string <span class="hljs-title">read</span><span class="hljs-params">(<span class="hljs-type">size_t</span> size)</span> </span>{
        <span class="hljs-function">std::string <span class="hljs-title">result</span><span class="hljs-params">(size, <span class="hljs-string">'\0'</span>)</span></span>;
        <span class="hljs-built_in">fread</span>(&amp;result[<span class="hljs-number">0</span>], <span class="hljs-number">1</span>, size, handle_);
        <span class="hljs-keyword">return</span> result;
    }
    
<span class="hljs-keyword">private</span>:
    FILE* handle_;
    
    <span class="hljs-comment">// ç¦æ­¢æ‹·è´ï¼Œä½†æ²¡æœ‰æä¾›ç§»åŠ¨è¯­ä¹‰ï¼</span>
    <span class="hljs-built_in">BadFile</span>(<span class="hljs-type">const</span> BadFile&amp;) = <span class="hljs-keyword">delete</span>;
    BadFile&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> BadFile&amp;) = <span class="hljs-keyword">delete</span>;
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_bad_resource_management</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">BadFile <span class="hljs-title">file1</span><span class="hljs-params">(<span class="hljs-string">"data.txt"</span>)</span></span>;
    <span class="hljs-keyword">auto</span> content = file1.<span class="hljs-built_in">read</span>(<span class="hljs-number">100</span>);
    
    <span class="hljs-comment">// æ— æ³•åœ¨å®¹å™¨ä¸­ä½¿ç”¨ï¼</span>
    <span class="hljs-comment">// std::vector&lt;BadFile&gt; files;</span>
    <span class="hljs-comment">// files.push_back(BadFile("test.txt"));  // ç¼–è¯‘é”™è¯¯ï¼</span>
    
    <span class="hljs-comment">// æ— æ³•é«˜æ•ˆè¿”å›ï¼</span>
    <span class="hljs-comment">// auto openConfig() -&gt; BadFile {</span>
    <span class="hljs-comment">//     BadFile local("config.txt");</span>
    <span class="hljs-comment">//     return local;  // ç¼–è¯‘é”™è¯¯ï¼æ²¡æœ‰ç§»åŠ¨æ„é€ å‡½æ•°</span>
    <span class="hljs-comment">// }</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-8"><strong>è§£å†³æ–¹æ¡ˆï¼šå®Œæ•´çš„ç±»å‹è®¾è®¡</strong></h3>
<h4 data-id="heading-9"><strong>1. ä¸‰äº”æ³•åˆ™çš„æ­£ç¡®åº”ç”¨</strong></h4>
<p><strong>å®Œæ•´çš„å­—ç¬¦ä¸²ç±»å‹è®¾è®¡ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ä¼˜ç§€çš„å­—ç¬¦ä¸²ç±»å‹ - éµå¾ªä¸‰äº”æ³•åˆ™</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GoodString</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// é»˜è®¤æ„é€ å‡½æ•°</span>
    <span class="hljs-built_in">GoodString</span>() = <span class="hljs-keyword">default</span>;
    
    <span class="hljs-comment">// æ„é€ å‡½æ•°</span>
    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">GoodString</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* str)</span> </span>{
        <span class="hljs-keyword">if</span> (str) {
            size_ = std::<span class="hljs-built_in">strlen</span>(str);
            data_ = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[size_ + <span class="hljs-number">1</span>];
            std::<span class="hljs-built_in">strcpy</span>(data_, str);
        }
    }
    
    <span class="hljs-built_in">GoodString</span>(<span class="hljs-type">const</span> std::string&amp; str) 
        : <span class="hljs-built_in">GoodString</span>(str.<span class="hljs-built_in">c_str</span>()) {}
    
    <span class="hljs-comment">// 1. ææ„å‡½æ•°</span>
    ~<span class="hljs-built_in">GoodString</span>() {
        <span class="hljs-keyword">delete</span>[] data_;
    }
    
    <span class="hljs-comment">// 2. æ‹·è´æ„é€ å‡½æ•°</span>
    <span class="hljs-built_in">GoodString</span>(<span class="hljs-type">const</span> GoodString&amp; other) 
        : <span class="hljs-built_in">size_</span>(other.size_) {
        <span class="hljs-keyword">if</span> (other.data_) {
            data_ = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[size_ + <span class="hljs-number">1</span>];
            std::<span class="hljs-built_in">strcpy</span>(data_, other.data_);
        }
    }
    
    <span class="hljs-comment">// 3. æ‹·è´èµ‹å€¼è¿ç®—ç¬¦</span>
    GoodString&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> GoodString&amp; other) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> != &amp;other) {  <span class="hljs-comment">// è‡ªæˆ‘èµ‹å€¼æ£€æŸ¥</span>
            GoodString <span class="hljs-built_in">temp</span>(other);  <span class="hljs-comment">// æ‹·è´æ„é€ </span>
            <span class="hljs-built_in">swap</span>(temp);             <span class="hljs-comment">// äº¤æ¢ - å¼ºå¼‚å¸¸å®‰å…¨ä¿è¯</span>
        }
        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
    }
    
    <span class="hljs-comment">// 4. ç§»åŠ¨æ„é€ å‡½æ•°</span>
    <span class="hljs-built_in">GoodString</span>(GoodString&amp;&amp; other) <span class="hljs-keyword">noexcept</span> 
        : <span class="hljs-built_in">data_</span>(other.data_), <span class="hljs-built_in">size_</span>(other.size_) {
        other.data_ = <span class="hljs-literal">nullptr</span>;
        other.size_ = <span class="hljs-number">0</span>;
    }
    
    <span class="hljs-comment">// 5. ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦</span>
    GoodString&amp; <span class="hljs-keyword">operator</span>=(GoodString&amp;&amp; other) <span class="hljs-keyword">noexcept</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> != &amp;other) {
            <span class="hljs-keyword">delete</span>[] data_;        <span class="hljs-comment">// é‡Šæ”¾å½“å‰èµ„æº</span>
            data_ = other.data_;
            size_ = other.size_;
            other.data_ = <span class="hljs-literal">nullptr</span>;
            other.size_ = <span class="hljs-number">0</span>;
        }
        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
    }
    
    <span class="hljs-comment">// äº¤æ¢æ“ä½œ</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">swap</span><span class="hljs-params">(GoodString&amp; other)</span> <span class="hljs-keyword">noexcept</span> </span>{
        std::<span class="hljs-built_in">swap</span>(data_, other.data_);
        std::<span class="hljs-built_in">swap</span>(size_, other.size_);
    }
    
    <span class="hljs-comment">// è®¿é—®æ¥å£</span>
    <span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">char</span>* <span class="hljs-title">c_str</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">noexcept</span> </span>{ 
        <span class="hljs-keyword">return</span> data_ ? data_ : <span class="hljs-string">""</span>; 
    }
    
    <span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">size</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">noexcept</span> </span>{ <span class="hljs-keyword">return</span> size_; }
    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">empty</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">noexcept</span> </span>{ <span class="hljs-keyword">return</span> size_ == <span class="hljs-number">0</span>; }
    
    <span class="hljs-comment">// è¿ç®—ç¬¦é‡è½½</span>
    <span class="hljs-keyword">friend</span> <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-type">const</span> GoodString&amp; lhs, <span class="hljs-type">const</span> GoodString&amp; rhs) {
        <span class="hljs-keyword">if</span> (lhs.size_ != rhs.size_) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">strcmp</span>(lhs.<span class="hljs-built_in">c_str</span>(), rhs.<span class="hljs-built_in">c_str</span>()) == <span class="hljs-number">0</span>;
    }
    
    <span class="hljs-keyword">friend</span> <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>!=(<span class="hljs-type">const</span> GoodString&amp; lhs, <span class="hljs-type">const</span> GoodString&amp; rhs) {
        <span class="hljs-keyword">return</span> !(lhs == rhs);
    }
    
    <span class="hljs-comment">// æµè¾“å‡ºæ”¯æŒ</span>
    <span class="hljs-keyword">friend</span> std::ostream&amp; <span class="hljs-keyword">operator</span>&lt;&lt;(std::ostream&amp; os, <span class="hljs-type">const</span> GoodString&amp; str) {
        <span class="hljs-keyword">return</span> os &lt;&lt; str.<span class="hljs-built_in">c_str</span>();
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">char</span>* data_ = <span class="hljs-literal">nullptr</span>;
    <span class="hljs-type">size_t</span> size_ = <span class="hljs-number">0</span>;
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_good_string</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// å„ç§æ„é€ éƒ½æ­£å¸¸å·¥ä½œ</span>
    GoodString s1;
    <span class="hljs-function">GoodString <span class="hljs-title">s2</span><span class="hljs-params">(<span class="hljs-string">"hello"</span>)</span></span>;
    GoodString s3 = s2;           <span class="hljs-comment">// æ‹·è´æ„é€ </span>
    GoodString s4 = std::<span class="hljs-built_in">move</span>(s2); <span class="hljs-comment">// ç§»åŠ¨æ„é€ </span>
    
    <span class="hljs-comment">// èµ‹å€¼æ“ä½œ</span>
    s1 = s3;                      <span class="hljs-comment">// æ‹·è´èµ‹å€¼</span>
    s3 = <span class="hljs-built_in">GoodString</span>(<span class="hljs-string">"world"</span>);     <span class="hljs-comment">// ç§»åŠ¨èµ‹å€¼</span>
    
    <span class="hljs-comment">// åœ¨å®¹å™¨ä¸­å·¥ä½œè‰¯å¥½</span>
    std::vector&lt;GoodString&gt; strings;
    strings.<span class="hljs-built_in">emplace_back</span>(<span class="hljs-string">"item1"</span>);
    strings.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">GoodString</span>(<span class="hljs-string">"item2"</span>));
    
    <span class="hljs-comment">// å¯ä»¥é«˜æ•ˆè¿”å›</span>
    <span class="hljs-keyword">auto</span> createString = []() -&gt; GoodString {
        GoodString <span class="hljs-built_in">local</span>(<span class="hljs-string">"created"</span>);
        <span class="hljs-keyword">return</span> local;  <span class="hljs-comment">// ç§»åŠ¨æ„é€ æˆ–NRVO</span>
    };
    
    <span class="hljs-keyword">auto</span> s5 = <span class="hljs-built_in">createString</span>();  <span class="hljs-comment">// é«˜æ•ˆï¼</span>
    
    std::cout &lt;&lt; <span class="hljs-string">"s1: "</span> &lt;&lt; s1 &lt;&lt; <span class="hljs-string">", s3: "</span> &lt;&lt; s3 &lt;&lt; <span class="hljs-string">", s5: "</span> &lt;&lt; s5 &lt;&lt; std::endl;
}
</code></pre>
<h4 data-id="heading-10"><strong>2. é›¶æ³•åˆ™çš„ç°ä»£åº”ç”¨</strong></h4>
<p><strong>ä½¿ç”¨æ ‡å‡†åº“ç»„ä»¶ï¼Œéµå¾ªé›¶æ³•åˆ™ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>

<span class="hljs-comment">// éµå¾ªé›¶æ³•åˆ™çš„ç±» - è®©ç¼–è¯‘å™¨ç”Ÿæˆç‰¹æ®Šæˆå‘˜å‡½æ•°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ZeroRuleClass</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// ä¸éœ€è¦æ˜¾å¼å®šä¹‰ææ„å‡½æ•°ã€æ‹·è´/ç§»åŠ¨æ“ä½œ</span>
    <span class="hljs-comment">// ç¼–è¯‘å™¨ç”Ÿæˆçš„ç‰ˆæœ¬å®Œå…¨æ­£ç¡®</span>
    
    <span class="hljs-built_in">ZeroRuleClass</span>(std::string name, std::vector&lt;<span class="hljs-type">int</span>&gt; data)
        : <span class="hljs-built_in">name_</span>(std::<span class="hljs-built_in">move</span>(name))
        , <span class="hljs-built_in">data_</span>(std::<span class="hljs-built_in">move</span>(data))
        , <span class="hljs-built_in">cache_</span>(std::<span class="hljs-built_in">make_shared</span>&lt;Cache&gt;())
    {}
    
    <span class="hljs-comment">// ä¸šåŠ¡æ¥å£</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">process</span><span class="hljs-params">()</span> </span>{
        cachedValue_ = std::<span class="hljs-built_in">accumulate</span>(data_.<span class="hljs-built_in">begin</span>(), data_.<span class="hljs-built_in">end</span>(), <span class="hljs-number">0</span>);
        cache_-&gt;<span class="hljs-built_in">update</span>(cachedValue_);
    }
    
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getCachedValue</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> cachedValue_; }
    <span class="hljs-function"><span class="hljs-type">const</span> std::string&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> name_; }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Cache</span> {
        <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-type">int</span> value)</span> </span>{
            <span class="hljs-comment">// ç¼“å­˜æ›´æ–°é€»è¾‘</span>
            lastValue = value;
        }
        <span class="hljs-type">int</span> lastValue = <span class="hljs-number">0</span>;
    };
    
    std::string name_;
    std::vector&lt;<span class="hljs-type">int</span>&gt; data_;
    std::shared_ptr&lt;Cache&gt; cache_;  <span class="hljs-comment">// å…±äº«æ‰€æœ‰æƒï¼Œæµ…æ‹·è´æ­£ç¡®</span>
    <span class="hljs-type">int</span> cachedValue_ = <span class="hljs-number">0</span>;
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_zero_rule</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">ZeroRuleClass <span class="hljs-title">obj1</span><span class="hljs-params">(<span class="hljs-string">"test"</span>, {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>})</span></span>;
    obj1.<span class="hljs-built_in">process</span>();
    
    <span class="hljs-comment">// ç¼–è¯‘å™¨ç”Ÿæˆçš„æ‹·è´æ“ä½œå®Œå…¨æ­£ç¡®</span>
    ZeroRuleClass obj2 = obj1;
    
    <span class="hljs-comment">// ç¼–è¯‘å™¨ç”Ÿæˆçš„ç§»åŠ¨æ“ä½œé«˜æ•ˆ</span>
    ZeroRuleClass obj3 = std::<span class="hljs-built_in">move</span>(obj1);
    
    <span class="hljs-comment">// åœ¨å®¹å™¨ä¸­å·¥ä½œè‰¯å¥½</span>
    std::vector&lt;ZeroRuleClass&gt; objects;
    objects.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">ZeroRuleClass</span>(<span class="hljs-string">"item"</span>, {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>}));
    objects.<span class="hljs-built_in">emplace_back</span>(<span class="hljs-string">"emplace"</span>, std::vector&lt;<span class="hljs-type">int</span>&gt;{<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>});
    
    std::cout &lt;&lt; <span class="hljs-string">"obj2: "</span> &lt;&lt; obj2.<span class="hljs-built_in">getName</span>() 
              &lt;&lt; <span class="hljs-string">", value: "</span> &lt;&lt; obj2.<span class="hljs-built_in">getCachedValue</span>() &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="hljs-string">"obj3: "</span> &lt;&lt; obj3.<span class="hljs-built_in">getName</span>() 
              &lt;&lt; <span class="hljs-string">", value: "</span> &lt;&lt; obj3.<span class="hljs-built_in">getCachedValue</span>() &lt;&lt; std::endl;
}
</code></pre>
<hr/>
<h3 data-id="heading-11"><strong>ç»§æ‰¿ä½“ç³»è®¾è®¡</strong></h3>
<h4 data-id="heading-12"><strong>1. å…¬æœ‰ç»§æ‰¿ä¸is-aå…³ç³»</strong></h4>
<p><strong>æ­£ç¡®çš„ç»§æ‰¿å±‚æ¬¡è®¾è®¡ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>

<span class="hljs-comment">// å½¢çŠ¶åŸºç±» - æ¥å£å®šä¹‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Shape</span>() = <span class="hljs-keyword">default</span>;  <span class="hljs-comment">// åŸºç±»å¿…é¡»æœ‰è™šææ„å‡½æ•°ï¼</span>
    
    <span class="hljs-comment">// çº¯è™šå‡½æ•° - æ¥å£å¥‘çº¦</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">double</span> <span class="hljs-title">area</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">double</span> <span class="hljs-title">perimeter</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> std::string <span class="hljs-title">name</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// éè™šå‡½æ•° - ä¸å˜è¡Œä¸º</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">printInfo</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        std::cout &lt;&lt; <span class="hljs-built_in">name</span>() &lt;&lt; <span class="hljs-string">": area="</span> &lt;&lt; <span class="hljs-built_in">area</span>() 
                  &lt;&lt; <span class="hljs-string">", perimeter="</span> &lt;&lt; <span class="hljs-built_in">perimeter</span>() &lt;&lt; std::endl;
    }
    
    <span class="hljs-comment">// è™šå‡½æ•° - å¯é‡å†™çš„é»˜è®¤è¡Œä¸º</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">scale</span><span class="hljs-params">(<span class="hljs-type">double</span> factor)</span> </span>= <span class="hljs-number">0</span>;
    
<span class="hljs-keyword">protected</span>:
    <span class="hljs-comment">// ä¿æŠ¤æˆå‘˜ - æ´¾ç”Ÿç±»å®ç°è¾…åŠ©å‡½æ•°</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">validateFactor</span><span class="hljs-params">(<span class="hljs-type">double</span> factor)</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">if</span> (factor &lt;= <span class="hljs-number">0.0</span>) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">invalid_argument</span>(<span class="hljs-string">"ç¼©æ”¾å› å­å¿…é¡»ä¸ºæ­£æ•°"</span>);
        }
    }
};

<span class="hljs-comment">// çŸ©å½¢ - å…·ä½“å®ç°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> : <span class="hljs-keyword">public</span> Shape {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Rectangle</span>(<span class="hljs-type">double</span> width, <span class="hljs-type">double</span> height) 
        : <span class="hljs-built_in">width_</span>(width), <span class="hljs-built_in">height_</span>(height) {
        <span class="hljs-keyword">if</span> (width &lt;= <span class="hljs-number">0</span> || height &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">invalid_argument</span>(<span class="hljs-string">"å®½åº¦å’Œé«˜åº¦å¿…é¡»ä¸ºæ­£æ•°"</span>);
        }
    }
    
    <span class="hljs-comment">// å®ç°çº¯è™šå‡½æ•°</span>
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">area</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> width_ * height_;
    }
    
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">perimeter</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span> * (width_ + height_);
    }
    
    <span class="hljs-function">std::string <span class="hljs-title">name</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Rectangle"</span>;
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">scale</span><span class="hljs-params">(<span class="hljs-type">double</span> factor)</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-built_in">validateFactor</span>(factor);
        width_ *= factor;
        height_ *= factor;
    }
    
    <span class="hljs-comment">// çŸ©å½¢ç‰¹æœ‰æ“ä½œ</span>
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">getWidth</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> width_; }
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">getHeight</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> height_; }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">double</span> width_;
    <span class="hljs-type">double</span> height_;
};

<span class="hljs-comment">// åœ†å½¢ - å…·ä½“å®ç°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> : <span class="hljs-keyword">public</span> Shape {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Circle</span><span class="hljs-params">(<span class="hljs-type">double</span> radius)</span> : radius_(radius) {</span>
        <span class="hljs-keyword">if</span> (radius &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">invalid_argument</span>(<span class="hljs-string">"åŠå¾„å¿…é¡»ä¸ºæ­£æ•°"</span>);
        }
    }
    
    <span class="hljs-comment">// å®ç°çº¯è™šå‡½æ•°</span>
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">area</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-number">3.141592653589793</span> * radius_ * radius_;
    }
    
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">perimeter</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span> * <span class="hljs-number">3.141592653589793</span> * radius_;
    }
    
    <span class="hljs-function">std::string <span class="hljs-title">name</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Circle"</span>;
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">scale</span><span class="hljs-params">(<span class="hljs-type">double</span> factor)</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-built_in">validateFactor</span>(factor);
        radius_ *= factor;
    }
    
    <span class="hljs-comment">// åœ†å½¢ç‰¹æœ‰æ“ä½œ</span>
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">getRadius</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> radius_; }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">double</span> radius_;
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_good_inheritance</span><span class="hljs-params">()</span> </span>{
    std::vector&lt;std::unique_ptr&lt;Shape&gt;&gt; shapes;
    
    shapes.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_unique</span>&lt;Rectangle&gt;(<span class="hljs-number">10.0</span>, <span class="hljs-number">5.0</span>));
    shapes.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_unique</span>&lt;Circle&gt;(<span class="hljs-number">3.0</span>));
    
    <span class="hljs-comment">// å¤šæ€è¡Œä¸º - ç¬¦åˆLiskovæ›¿æ¢åŸåˆ™</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; shape : shapes) {
        shape-&gt;<span class="hljs-built_in">printInfo</span>();  <span class="hljs-comment">// æ­£ç¡®è°ƒç”¨å„ä¸ªæ´¾ç”Ÿç±»çš„å®ç°</span>
        
        <span class="hljs-comment">// å¯ä»¥å®‰å…¨åœ°ç¼©æ”¾</span>
        shape-&gt;<span class="hljs-built_in">scale</span>(<span class="hljs-number">2.0</span>);
        shape-&gt;<span class="hljs-built_in">printInfo</span>();
    }
    
    <span class="hljs-comment">// ç±»å‹å®‰å…¨çš„å‘ä¸‹è½¬å‹</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">auto</span> rect = <span class="hljs-built_in">dynamic_cast</span>&lt;Rectangle*&gt;(shapes[<span class="hljs-number">0</span>].<span class="hljs-built_in">get</span>())) {
        std::cout &lt;&lt; <span class="hljs-string">"çŸ©å½¢å®½åº¦: "</span> &lt;&lt; rect-&gt;<span class="hljs-built_in">getWidth</span>() &lt;&lt; std::endl;
    }
}
</code></pre>
<h4 data-id="heading-13"><strong>2. éå…¬æœ‰ç»§æ‰¿çš„æ­£ç¡®ä½¿ç”¨</strong></h4>
<p><strong>ä½¿ç”¨ç»„åˆè€Œéç§æœ‰ç»§æ‰¿ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ä½¿ç”¨ç»„åˆè€Œä¸æ˜¯ç§æœ‰ç»§æ‰¿çš„ä¾‹å­</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Timer</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">start</span><span class="hljs-params">()</span> </span>{ <span class="hljs-comment">/* å¯åŠ¨è®¡æ—¶å™¨ */</span> }
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">stop</span><span class="hljs-params">()</span> </span>{ <span class="hljs-comment">/* åœæ­¢è®¡æ—¶å™¨ */</span> }
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">elapsed</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-comment">/* è¿”å›ç»è¿‡æ—¶é—´ */</span> <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>; }
};

<span class="hljs-comment">// ç³Ÿç³•çš„è®¾è®¡ - ç§æœ‰ç»§æ‰¿è¯¯ç”¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BadTask</span> : <span class="hljs-keyword">private</span> Timer {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-built_in">start</span>();
        <span class="hljs-comment">// æ‰§è¡Œä»»åŠ¡...</span>
        <span class="hljs-built_in">stop</span>();
        std::cout &lt;&lt; <span class="hljs-string">"è€—æ—¶: "</span> &lt;&lt; <span class="hljs-built_in">elapsed</span>() &lt;&lt; <span class="hljs-string">"ç§’"</span> &lt;&lt; std::endl;
    }
    <span class="hljs-comment">// é—®é¢˜ï¼šTimerçš„æ¥å£æš´éœ²ç»™äº†BadTaskçš„ç”¨æˆ·å—ï¼Ÿ</span>
};

<span class="hljs-comment">// ä¼˜ç§€çš„è®¾è®¡ - ä½¿ç”¨ç»„åˆ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GoodTask</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span> </span>{
        timer_.<span class="hljs-built_in">start</span>();
        <span class="hljs-comment">// æ‰§è¡Œä»»åŠ¡...</span>
        timer_.<span class="hljs-built_in">stop</span>();
        std::cout &lt;&lt; <span class="hljs-string">"è€—æ—¶: "</span> &lt;&lt; timer_.<span class="hljs-built_in">elapsed</span>() &lt;&lt; <span class="hljs-string">"ç§’"</span> &lt;&lt; std::endl;
    }
    
    <span class="hljs-comment">// æ˜ç¡®çš„æ¥å£ï¼Œæ²¡æœ‰æ„å¤–çš„Timeræ–¹æ³•æš´éœ²</span>
    
<span class="hljs-keyword">private</span>:
    Timer timer_;  <span class="hljs-comment">// ç»„åˆï¼Œä¸æ˜¯ç»§æ‰¿</span>
};

<span class="hljs-comment">// ç§æœ‰ç»§æ‰¿çš„æ­£å½“ä½¿ç”¨åœºæ™¯</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> {
<span class="hljs-keyword">protected</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">protectedMethod</span><span class="hljs-params">()</span> </span>{ <span class="hljs-comment">/* å—ä¿æŠ¤çš„æ–¹æ³• */</span> }
    <span class="hljs-type">int</span> protectedData;
};

<span class="hljs-comment">// æ­£å½“çš„ç§æœ‰ç»§æ‰¿ï¼šéœ€è¦é‡å†™è™šå‡½æ•°æˆ–è®¿é—®å—ä¿æŠ¤æˆå‘˜</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">private</span> Base {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">useBaseFunctionality</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-built_in">protectedMethod</span>();  <span class="hljs-comment">// å¯ä»¥è®¿é—®åŸºç±»å—ä¿æŠ¤æˆå‘˜</span>
        protectedData = <span class="hljs-number">42</span>;
    }
    
    <span class="hljs-comment">// ä¸æš´éœ²Baseçš„æ¥å£ç»™Derivedçš„ç”¨æˆ·</span>
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_composition_over_inheritance</span><span class="hljs-params">()</span> </span>{
    GoodTask task;
    task.<span class="hljs-built_in">execute</span>();
    
    <span class="hljs-comment">// æ¸…æ™°çš„æ¥å£ï¼Œæ²¡æœ‰æ„å¤–çš„Timeræ–¹æ³•</span>
    <span class="hljs-comment">// task.start();  // ç¼–è¯‘é”™è¯¯ï¼è¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„</span>
    
    BadTask badTask;
    badTask.<span class="hljs-built_in">execute</span>();
    <span class="hljs-comment">// badTask.start();  // ç¼–è¯‘é”™è¯¯ï¼Œä½†è®¾è®¡æ„å›¾ä¸å¦‚ç»„åˆæ¸…æ™°</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-14"><strong>ç±»å‹è½¬æ¢è®¾è®¡</strong></h3>
<h4 data-id="heading-15"><strong>1. æ˜¾å¼è½¬æ¢çš„å®‰å…¨è®¾è®¡</strong></h4>
<p><strong>å®‰å…¨çš„ç±»å‹è½¬æ¢æ¥å£ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sstream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdexcept&gt;</span></span>

<span class="hljs-comment">// å®‰å…¨çš„æ•°å€¼ç±»å‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeNumber</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// æ˜¾å¼æ„é€ å‡½æ•° - é¿å…éšå¼è½¬æ¢</span>
    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">SafeNumber</span><span class="hljs-params">(<span class="hljs-type">int</span> value)</span> : value_(value) {</span>}
    
    <span class="hljs-comment">// ä»å­—ç¬¦ä¸²æ„é€  - æ˜¾å¼ï¼Œå¸¦éªŒè¯</span>
    <span class="hljs-function"><span class="hljs-type">static</span> std::optional&lt;SafeNumber&gt; <span class="hljs-title">fromString</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; str)</span> </span>{
        <span class="hljs-keyword">try</span> {
            std::<span class="hljs-type">size_t</span> pos;
            <span class="hljs-type">int</span> value = std::<span class="hljs-built_in">stoi</span>(str, &amp;pos);
            
            <span class="hljs-comment">// éªŒè¯æ•´ä¸ªå­—ç¬¦ä¸²éƒ½è¢«è§£æ</span>
            <span class="hljs-keyword">if</span> (pos != str.<span class="hljs-built_in">length</span>()) {
                <span class="hljs-keyword">return</span> std::<span class="hljs-literal">nullopt</span>;
            }
            
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">SafeNumber</span>(value);
        } <span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> std::exception&amp;) {
            <span class="hljs-keyword">return</span> std::<span class="hljs-literal">nullopt</span>;
        }
    }
    
    <span class="hljs-comment">// è½¬æ¢åˆ°å…¶ä»–ç±»å‹ - æ˜¾å¼å‘½åå‡½æ•°</span>
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">toInt</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">noexcept</span> </span>{ <span class="hljs-keyword">return</span> value_; }
    <span class="hljs-function">std::string <span class="hljs-title">toString</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">to_string</span>(value_); }
    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-keyword">operator</span> <span class="hljs-title">int</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> value_; }  <span class="hljs-comment">// æ˜¾å¼è½¬æ¢è¿ç®—ç¬¦</span>
    
    <span class="hljs-comment">// ç®—æœ¯è¿ç®—ç¬¦</span>
    SafeNumber <span class="hljs-keyword">operator</span>+(<span class="hljs-type">const</span> SafeNumber&amp; other) <span class="hljs-type">const</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">SafeNumber</span>(value_ + other.value_);
    }
    
    SafeNumber <span class="hljs-keyword">operator</span>-(<span class="hljs-type">const</span> SafeNumber&amp; other) <span class="hljs-type">const</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">SafeNumber</span>(value_ - other.value_);
    }
    
    <span class="hljs-comment">// æ¯”è¾ƒè¿ç®—ç¬¦</span>
    <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-type">const</span> SafeNumber&amp; other) <span class="hljs-type">const</span> = <span class="hljs-keyword">default</span>;
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span> value_;
};

<span class="hljs-comment">// ä½¿ç”¨æ˜¾å¼è½¬æ¢çš„æ—¥æœŸç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Date</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Date</span>(<span class="hljs-type">int</span> year, <span class="hljs-type">int</span> month, <span class="hljs-type">int</span> day) 
        : <span class="hljs-built_in">year_</span>(year), <span class="hljs-built_in">month_</span>(month), <span class="hljs-built_in">day_</span>(day) {
        <span class="hljs-built_in">validate</span>();
    }
    
    <span class="hljs-comment">// æ˜¾å¼è½¬æ¢å‡½æ•° - æ¸…æ™°çš„è¯­ä¹‰</span>
    <span class="hljs-function">std::string <span class="hljs-title">toIsoString</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        std::ostringstream oss;
        oss &lt;&lt; year_ &lt;&lt; <span class="hljs-string">"-"</span> 
            &lt;&lt; (month_ &lt; <span class="hljs-number">10</span> ? <span class="hljs-string">"0"</span> : <span class="hljs-string">""</span>) &lt;&lt; month_ &lt;&lt; <span class="hljs-string">"-"</span>
            &lt;&lt; (day_ &lt; <span class="hljs-number">10</span> ? <span class="hljs-string">"0"</span> : <span class="hljs-string">""</span>) &lt;&lt; day_;
        <span class="hljs-keyword">return</span> oss.<span class="hljs-built_in">str</span>();
    }
    
    <span class="hljs-comment">// æ˜ç¡®çš„è½¬æ¢ï¼Œè€Œä¸æ˜¯éšå¼è½¬æ¢</span>
    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-keyword">operator</span> <span class="hljs-title">std::string</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">toIsoString</span>();
    }
    
    <span class="hljs-comment">// ä¸å…è®¸åˆ°intçš„éšå¼è½¬æ¢ - è¯­ä¹‰ä¸æ˜ç¡®ï¼</span>
    <span class="hljs-comment">// operator int() const = delete;  // æˆ–è€…ä¸æä¾›</span>
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">validate</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">if</span> (month_ &lt; <span class="hljs-number">1</span> || month_ &gt; <span class="hljs-number">12</span>) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">invalid_argument</span>(<span class="hljs-string">"æœˆä»½å¿…é¡»åœ¨1-12ä¹‹é—´"</span>);
        }
        <span class="hljs-keyword">if</span> (day_ &lt; <span class="hljs-number">1</span> || day_ &gt; <span class="hljs-number">31</span>) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">invalid_argument</span>(<span class="hljs-string">"æ—¥æœŸå¿…é¡»åœ¨1-31ä¹‹é—´"</span>);
        }
        <span class="hljs-comment">// æ›´å¤æ‚çš„éªŒè¯...</span>
    }
    
    <span class="hljs-type">int</span> year_, month_, day_;
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_safe_conversions</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// å®‰å…¨çš„æ•°å€¼åˆ›å»º</span>
    <span class="hljs-keyword">auto</span> num1 = <span class="hljs-built_in">SafeNumber</span>(<span class="hljs-number">42</span>);
    <span class="hljs-keyword">auto</span> num2 = SafeNumber::<span class="hljs-built_in">fromString</span>(<span class="hljs-string">"100"</span>);
    
    <span class="hljs-keyword">if</span> (num2) {
        <span class="hljs-keyword">auto</span> result = num1 + *num2;
        std::cout &lt;&lt; <span class="hljs-string">"ç»“æœ: "</span> &lt;&lt; result.<span class="hljs-built_in">toInt</span>() &lt;&lt; std::endl;
    }
    
    <span class="hljs-comment">// å¤±è´¥çš„è½¬æ¢å®‰å…¨å¤„ç†</span>
    <span class="hljs-keyword">auto</span> invalid = SafeNumber::<span class="hljs-built_in">fromString</span>(<span class="hljs-string">"abc"</span>);
    <span class="hljs-keyword">if</span> (!invalid) {
        std::cout &lt;&lt; <span class="hljs-string">"æ— æ•ˆçš„æ•°å­—å­—ç¬¦ä¸²"</span> &lt;&lt; std::endl;
    }
    
    <span class="hljs-comment">// æ˜ç¡®çš„æ—¥æœŸè½¬æ¢</span>
    <span class="hljs-function">Date <span class="hljs-title">today</span><span class="hljs-params">(<span class="hljs-number">2023</span>, <span class="hljs-number">10</span>, <span class="hljs-number">15</span>)</span></span>;
    std::string isoDate = today.<span class="hljs-built_in">toIsoString</span>();  <span class="hljs-comment">// æ˜ç¡®è°ƒç”¨</span>
    std::string explicitStr = <span class="hljs-built_in">static_cast</span>&lt;std::string&gt;(today);  <span class="hljs-comment">// æ˜¾å¼è½¬æ¢</span>
    
    <span class="hljs-comment">// ä»¥ä¸‹ä»£ç ä¸ä¼šç¼–è¯‘ - è¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼</span>
    <span class="hljs-comment">// std::string implicitStr = today;  // ç¼–è¯‘é”™è¯¯ï¼æ²¡æœ‰éšå¼è½¬æ¢</span>
    <span class="hljs-comment">// int invalidInt = today;           // ç¼–è¯‘é”™è¯¯ï¼</span>
    
    std::cout &lt;&lt; <span class="hljs-string">"ISOæ—¥æœŸ: "</span> &lt;&lt; isoDate &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="hljs-string">"æ˜¾å¼å­—ç¬¦ä¸²: "</span> &lt;&lt; explicitStr &lt;&lt; std::endl;
}
</code></pre>
<hr/>
<h3 data-id="heading-16"><strong>å¼‚å¸¸å®‰å…¨è®¾è®¡</strong></h3>
<h4 data-id="heading-17"><strong>1. å¼ºå¼‚å¸¸å®‰å…¨ä¿è¯</strong></h4>
<p><strong>æä¾›å¼ºå¼‚å¸¸å®‰å…¨ä¿è¯çš„ç±»ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdexcept&gt;</span></span>

<span class="hljs-comment">// å¼ºå¼‚å¸¸å®‰å…¨çš„å®¹å™¨åŒ…è£…å™¨</span>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeVector</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">SafeVector</span>() = <span class="hljs-keyword">default</span>;
    
    <span class="hljs-comment">// æ‹·è´æ„é€ å‡½æ•° - å¼ºå¼‚å¸¸å®‰å…¨</span>
    <span class="hljs-built_in">SafeVector</span>(<span class="hljs-type">const</span> SafeVector&amp; other) 
        : <span class="hljs-built_in">data_</span>(other.data_)  <span class="hljs-comment">// vectorçš„æ‹·è´æ„é€ å‡½æ•°æä¾›å¼ºä¿è¯</span>
    {}
    
    <span class="hljs-comment">// æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ - å¼ºå¼‚å¸¸å®‰å…¨ï¼ˆæ‹·è´å¹¶äº¤æ¢æƒ¯ç”¨æ³•ï¼‰</span>
    SafeVector&amp; <span class="hljs-keyword">operator</span>=(SafeVector other) <span class="hljs-keyword">noexcept</span> {
        <span class="hljs-built_in">swap</span>(other);
        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
    }
    
    <span class="hljs-comment">// ç§»åŠ¨æ“ä½œ - noexcept</span>
    <span class="hljs-built_in">SafeVector</span>(SafeVector&amp;&amp; other) <span class="hljs-keyword">noexcept</span> = <span class="hljs-keyword">default</span>;
    SafeVector&amp; <span class="hljs-keyword">operator</span>=(SafeVector&amp;&amp; other) <span class="hljs-keyword">noexcept</span> = <span class="hljs-keyword">default</span>;
    
    <span class="hljs-comment">// äº¤æ¢ - noexcept</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">swap</span><span class="hljs-params">(SafeVector&amp; other)</span> <span class="hljs-keyword">noexcept</span> </span>{
        data_.<span class="hljs-built_in">swap</span>(other.data_);
    }
    
    <span class="hljs-comment">// å¼ºå¼‚å¸¸å®‰å…¨çš„æ’å…¥æ“ä½œ</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push_back</span><span class="hljs-params">(<span class="hljs-type">const</span> T&amp; value)</span> </span>{
        <span class="hljs-comment">// åˆ›å»ºå‰¯æœ¬ï¼Œå¦‚æœæ‹·è´æ„é€ æŠ›å‡ºå¼‚å¸¸ï¼Œä¸å½±å“å½“å‰å¯¹è±¡</span>
        SafeVector temp = *<span class="hljs-keyword">this</span>;
        
        <span class="hljs-comment">// ä¿®æ”¹å‰¯æœ¬ - å¦‚æœè¿™ä¸ªæ“ä½œå¤±è´¥ï¼Œtempä¼šè¢«é”€æ¯ï¼Œä½†*thisä¸å˜</span>
        temp.data_.<span class="hljs-built_in">push_back</span>(value);
        
        <span class="hljs-comment">// äº¤æ¢ - noexceptï¼Œä¸ä¼šæŠ›å‡º</span>
        <span class="hljs-built_in">swap</span>(temp);
        
        <span class="hljs-comment">// tempç¦»å¼€ä½œç”¨åŸŸï¼Œæ¸…ç†æ—§æ•°æ®</span>
    }
    
    <span class="hljs-comment">// å¼ºå¼‚å¸¸å®‰å…¨çš„æ’å…¥æ“ä½œ - ç§»åŠ¨ç‰ˆæœ¬</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push_back</span><span class="hljs-params">(T&amp;&amp; value)</span> </span>{
        SafeVector temp = *<span class="hljs-keyword">this</span>;
        temp.data_.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">move</span>(value));
        <span class="hljs-built_in">swap</span>(temp);
    }
    
    <span class="hljs-comment">// å¼ºå¼‚å¸¸å®‰å…¨çš„æ‰¹é‡æ’å…¥</span>
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> InputIt&gt;
    <span class="hljs-type">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(InputIt first, InputIt last)</span> </span>{
        SafeVector temp = *<span class="hljs-keyword">this</span>;
        temp.data_.<span class="hljs-built_in">insert</span>(temp.data_.<span class="hljs-built_in">end</span>(), first, last);
        <span class="hljs-built_in">swap</span>(temp);
    }
    
    <span class="hljs-comment">// å¼ºå¼‚å¸¸å®‰å…¨çš„åˆ é™¤æ“ä½œ</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">erase</span><span class="hljs-params">(<span class="hljs-type">size_t</span> index)</span> </span>{
        <span class="hljs-keyword">if</span> (index &gt;= data_.<span class="hljs-built_in">size</span>()) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">out_of_range</span>(<span class="hljs-string">"ç´¢å¼•è¶Šç•Œ"</span>);
        }
        
        SafeVector temp = *<span class="hljs-keyword">this</span>;
        temp.data_.<span class="hljs-built_in">erase</span>(temp.data_.<span class="hljs-built_in">begin</span>() + index);
        <span class="hljs-built_in">swap</span>(temp);
    }
    
    <span class="hljs-comment">// è®¿é—®æ¥å£</span>
    <span class="hljs-function"><span class="hljs-type">const</span> T&amp; <span class="hljs-title">at</span><span class="hljs-params">(<span class="hljs-type">size_t</span> index)</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">if</span> (index &gt;= data_.<span class="hljs-built_in">size</span>()) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">out_of_range</span>(<span class="hljs-string">"ç´¢å¼•è¶Šç•Œ"</span>);
        }
        <span class="hljs-keyword">return</span> data_[index];
    }
    
    <span class="hljs-function">T&amp; <span class="hljs-title">at</span><span class="hljs-params">(<span class="hljs-type">size_t</span> index)</span> </span>{
        <span class="hljs-keyword">if</span> (index &gt;= data_.<span class="hljs-built_in">size</span>()) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">out_of_range</span>(<span class="hljs-string">"ç´¢å¼•è¶Šç•Œ"</span>);
        }
        <span class="hljs-keyword">return</span> data_[index];
    }
    
    <span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">size</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">noexcept</span> </span>{ <span class="hljs-keyword">return</span> data_.<span class="hljs-built_in">size</span>(); }
    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">empty</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">noexcept</span> </span>{ <span class="hljs-keyword">return</span> data_.<span class="hljs-built_in">empty</span>(); }
    
    <span class="hljs-comment">// è¿­ä»£å™¨æ”¯æŒ</span>
    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">begin</span><span class="hljs-params">()</span> <span class="hljs-keyword">noexcept</span> </span>{ <span class="hljs-keyword">return</span> data_.<span class="hljs-built_in">begin</span>(); }
    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">end</span><span class="hljs-params">()</span> <span class="hljs-keyword">noexcept</span> </span>{ <span class="hljs-keyword">return</span> data_.<span class="hljs-built_in">end</span>(); }
    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">begin</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">noexcept</span> </span>{ <span class="hljs-keyword">return</span> data_.<span class="hljs-built_in">begin</span>(); }
    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">end</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">noexcept</span> </span>{ <span class="hljs-keyword">return</span> data_.<span class="hljs-built_in">end</span>(); }
    
<span class="hljs-keyword">private</span>:
    std::vector&lt;T&gt; data_;
};

<span class="hljs-comment">// å¼‚å¸¸å®‰å…¨çš„æ•°æ®åº“äº‹åŠ¡åŒ…è£…å™¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseTransaction</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">DatabaseTransaction</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; dbName)</span> 
        : committed_(false) {</span>
        <span class="hljs-comment">// æ¨¡æ‹Ÿæ•°æ®åº“è¿æ¥</span>
        std::cout &lt;&lt; <span class="hljs-string">"å¼€å§‹äº‹åŠ¡: "</span> &lt;&lt; dbName &lt;&lt; std::endl;
    }
    
    <span class="hljs-comment">// ç¦æ­¢æ‹·è´</span>
    <span class="hljs-built_in">DatabaseTransaction</span>(<span class="hljs-type">const</span> DatabaseTransaction&amp;) = <span class="hljs-keyword">delete</span>;
    DatabaseTransaction&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> DatabaseTransaction&amp;) = <span class="hljs-keyword">delete</span>;
    
    <span class="hljs-comment">// ç§»åŠ¨è¯­ä¹‰</span>
    <span class="hljs-built_in">DatabaseTransaction</span>(DatabaseTransaction&amp;&amp; other) <span class="hljs-keyword">noexcept</span> 
        : <span class="hljs-built_in">committed_</span>(other.committed_) {
        other.committed_ = <span class="hljs-literal">false</span>;  <span class="hljs-comment">// ç§»åŠ¨åæºå¯¹è±¡ä¸å†æ‹¥æœ‰äº‹åŠ¡</span>
    }
    
    DatabaseTransaction&amp; <span class="hljs-keyword">operator</span>=(DatabaseTransaction&amp;&amp; other) <span class="hljs-keyword">noexcept</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> != &amp;other) {
            <span class="hljs-built_in">rollbackIfNeeded</span>();  <span class="hljs-comment">// å›æ»šå½“å‰äº‹åŠ¡</span>
            committed_ = other.committed_;
            other.committed_ = <span class="hljs-literal">false</span>;
        }
        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
    }
    
    <span class="hljs-comment">// ææ„å‡½æ•° - è‡ªåŠ¨å›æ»šæœªæäº¤çš„äº‹åŠ¡</span>
    ~<span class="hljs-built_in">DatabaseTransaction</span>() <span class="hljs-keyword">noexcept</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-built_in">rollbackIfNeeded</span>();
        } <span class="hljs-built_in">catch</span> (...) {
            <span class="hljs-comment">// ææ„å‡½æ•°ä¸åº”è¯¥æŠ›å‡ºå¼‚å¸¸</span>
            std::cerr &lt;&lt; <span class="hljs-string">"å›æ»šäº‹åŠ¡æ—¶å‘ç”Ÿå¼‚å¸¸"</span> &lt;&lt; std::endl;
        }
    }
    
    <span class="hljs-comment">// ä¸šåŠ¡æ“ä½œ - æä¾›åŸºæœ¬å¼‚å¸¸å®‰å…¨ä¿è¯</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; query)</span> </span>{
        <span class="hljs-built_in">validateActive</span>();
        
        <span class="hljs-comment">// æ¨¡æ‹Ÿå¯èƒ½å¤±è´¥çš„æ“ä½œ</span>
        <span class="hljs-keyword">if</span> (query.<span class="hljs-built_in">empty</span>()) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">invalid_argument</span>(<span class="hljs-string">"æŸ¥è¯¢ä¸èƒ½ä¸ºç©º"</span>);
        }
        
        std::cout &lt;&lt; <span class="hljs-string">"æ‰§è¡Œ: "</span> &lt;&lt; query &lt;&lt; std::endl;
        <span class="hljs-comment">// å®é™…æ•°æ®åº“æ“ä½œ...</span>
    }
    
    <span class="hljs-comment">// æäº¤ - å¦‚æœä¸æˆåŠŸåˆ™æŠ›å‡ºå¼‚å¸¸</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">commit</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-built_in">validateActive</span>();
        
        <span class="hljs-comment">// æ¨¡æ‹Ÿå¯èƒ½å¤±è´¥çš„æäº¤</span>
        std::cout &lt;&lt; <span class="hljs-string">"æäº¤äº‹åŠ¡..."</span> &lt;&lt; std::endl;
        
        committed_ = <span class="hljs-literal">true</span>;  <span class="hljs-comment">// æ ‡è®°ä¸ºå·²æäº¤</span>
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">validateActive</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">if</span> (committed_) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">logic_error</span>(<span class="hljs-string">"äº‹åŠ¡å·²æäº¤ï¼Œä¸èƒ½ç»§ç»­æ“ä½œ"</span>);
        }
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">rollbackIfNeeded</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (!committed_) {
            std::cout &lt;&lt; <span class="hljs-string">"å›æ»šäº‹åŠ¡"</span> &lt;&lt; std::endl;
            <span class="hljs-comment">// å®é™…å›æ»šé€»è¾‘...</span>
        }
    }
    
    <span class="hljs-type">bool</span> committed_;
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_exception_safety</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// å¼ºå¼‚å¸¸å®‰å…¨çš„å®¹å™¨ä½¿ç”¨</span>
    SafeVector&lt;<span class="hljs-type">int</span>&gt; numbers;
    
    <span class="hljs-keyword">try</span> {
        numbers.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">1</span>);
        numbers.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">2</span>);
        numbers.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">3</span>);
        
        <span class="hljs-comment">// å³ä½¿è¿™é‡ŒæŠ›å‡ºå¼‚å¸¸ï¼Œnumbersä»ä¿æŒæœ‰æ•ˆçŠ¶æ€</span>
        numbers.<span class="hljs-built_in">erase</span>(<span class="hljs-number">1</span>);
        
        std::cout &lt;&lt; <span class="hljs-string">"å®¹å™¨å†…å®¹: "</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; num : numbers) {
            std::cout &lt;&lt; num &lt;&lt; <span class="hljs-string">" "</span>;
        }
        std::cout &lt;&lt; std::endl;
        
    } <span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> std::exception&amp; e) {
        std::cout &lt;&lt; <span class="hljs-string">"æ“ä½œå¤±è´¥: "</span> &lt;&lt; e.<span class="hljs-built_in">what</span>() &lt;&lt; std::endl;
        <span class="hljs-comment">// numbersä»ç„¶å¤„äºä¸€è‡´çŠ¶æ€ï¼</span>
    }
    
    <span class="hljs-comment">// å¼‚å¸¸å®‰å…¨çš„æ•°æ®åº“äº‹åŠ¡</span>
    <span class="hljs-keyword">try</span> {
        <span class="hljs-function">DatabaseTransaction <span class="hljs-title">tx</span><span class="hljs-params">(<span class="hljs-string">"test.db"</span>)</span></span>;
        
        tx.<span class="hljs-built_in">execute</span>(<span class="hljs-string">"INSERT INTO users VALUES (1, 'Alice')"</span>);
        tx.<span class="hljs-built_in">execute</span>(<span class="hljs-string">"UPDATE stats SET count = count + 1"</span>);
        
        <span class="hljs-comment">// å¦‚æœæäº¤å¤±è´¥ï¼Œææ„å‡½æ•°ä¼šè‡ªåŠ¨å›æ»š</span>
        tx.<span class="hljs-built_in">commit</span>();
        std::cout &lt;&lt; <span class="hljs-string">"äº‹åŠ¡æäº¤æˆåŠŸ"</span> &lt;&lt; std::endl;
        
    } <span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> std::exception&amp; e) {
        std::cout &lt;&lt; <span class="hljs-string">"äº‹åŠ¡å¤±è´¥: "</span> &lt;&lt; e.<span class="hljs-built_in">what</span>() &lt;&lt; std::endl;
        <span class="hljs-comment">// ä¸éœ€è¦æ‰‹åŠ¨å›æ»š - RAIIå¤„ç†äº†ï¼</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-18"><strong>ç°ä»£C++ç‰¹æ€§é›†æˆ</strong></h3>
<h4 data-id="heading-19"><strong>1. constexprä¸ç¼–è¯‘æœŸè®¡ç®—</strong></h4>
<p><strong>ç¼–è¯‘æœŸå‹å¥½çš„ç±»å‹è®¾è®¡ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;array&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;type_traits&gt;</span></span>

<span class="hljs-comment">// ç¼–è¯‘æœŸæœ‰ç†æ•°ç±»å‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Rational</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// constexpræ„é€ å‡½æ•°</span>
    <span class="hljs-function"><span class="hljs-keyword">constexpr</span> <span class="hljs-title">Rational</span><span class="hljs-params">(<span class="hljs-type">int</span> numerator = <span class="hljs-number">0</span>, <span class="hljs-type">int</span> denominator = <span class="hljs-number">1</span>)</span> 
        : num_(numerator), den_(denominator) {</span>
        <span class="hljs-keyword">if</span> (denominator == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-string">"åˆ†æ¯ä¸èƒ½ä¸ºé›¶"</span>;  <span class="hljs-comment">// åœ¨ç¼–è¯‘æœŸä¼šå¯¼è‡´é”™è¯¯</span>
        }
        <span class="hljs-built_in">normalize</span>();
    }
    
    <span class="hljs-comment">// constexprè®¿é—®å™¨</span>
    <span class="hljs-function"><span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> <span class="hljs-title">numerator</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">noexcept</span> </span>{ <span class="hljs-keyword">return</span> num_; }
    <span class="hljs-function"><span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> <span class="hljs-title">denominator</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">noexcept</span> </span>{ <span class="hljs-keyword">return</span> den_; }
    
    <span class="hljs-comment">// constexprç®—æœ¯è¿ç®—</span>
    <span class="hljs-keyword">constexpr</span> Rational <span class="hljs-keyword">operator</span>+(<span class="hljs-type">const</span> Rational&amp; other) <span class="hljs-type">const</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Rational</span>(
            num_ * other.den_ + other.num_ * den_,
            den_ * other.den_
        );
    }
    
    <span class="hljs-keyword">constexpr</span> Rational <span class="hljs-keyword">operator</span>-(<span class="hljs-type">const</span> Rational&amp; other) <span class="hljs-type">const</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Rational</span>(
            num_ * other.den_ - other.num_ * den_,
            den_ * other.den_
        );
    }
    
    <span class="hljs-keyword">constexpr</span> Rational <span class="hljs-keyword">operator</span>*(<span class="hljs-type">const</span> Rational&amp; other) <span class="hljs-type">const</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Rational</span>(num_ * other.num_, den_ * other.den_);
    }
    
    <span class="hljs-keyword">constexpr</span> Rational <span class="hljs-keyword">operator</span>/(<span class="hljs-type">const</span> Rational&amp; other) <span class="hljs-type">const</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Rational</span>(num_ * other.den_, den_ * other.num_);
    }
    
    <span class="hljs-comment">// constexpræ¯”è¾ƒè¿ç®—ç¬¦</span>
    <span class="hljs-keyword">constexpr</span> <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-type">const</span> Rational&amp; other) <span class="hljs-type">const</span> {
        <span class="hljs-keyword">return</span> num_ * other.den_ == other.num_ * den_;
    }
    
    <span class="hljs-keyword">constexpr</span> <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>!=(<span class="hljs-type">const</span> Rational&amp; other) <span class="hljs-type">const</span> {
        <span class="hljs-keyword">return</span> !(*<span class="hljs-keyword">this</span> == other);
    }
    
    <span class="hljs-comment">// è½¬æ¢åˆ°double - constexpr</span>
    <span class="hljs-function"><span class="hljs-keyword">constexpr</span> <span class="hljs-type">double</span> <span class="hljs-title">toDouble</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">double</span>&gt;(num_) / den_;
    }
    
    <span class="hljs-comment">// ç¼–è¯‘æœŸè®¡ç®—çš„æœ€å¤§å…¬çº¦æ•°</span>
    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> <span class="hljs-title">gcd</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> </span>{
        <span class="hljs-keyword">return</span> b == <span class="hljs-number">0</span> ? a : <span class="hljs-built_in">gcd</span>(b, a % b);
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-function"><span class="hljs-keyword">constexpr</span> <span class="hljs-type">void</span> <span class="hljs-title">normalize</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (den_ &lt; <span class="hljs-number">0</span>) {
            num_ = -num_;
            den_ = -den_;
        }
        <span class="hljs-type">int</span> g = <span class="hljs-built_in">gcd</span>(num_ &lt; <span class="hljs-number">0</span> ? -num_ : num_, den_);
        num_ /= g;
        den_ /= g;
    }
    
    <span class="hljs-type">int</span> num_;
    <span class="hljs-type">int</span> den_;
};

<span class="hljs-comment">// ç¼–è¯‘æœŸè®¡ç®—çš„æ•°å­¦å‡½æ•°</span>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">constexpr</span> T <span class="hljs-title">compileTimePower</span><span class="hljs-params">(T base, <span class="hljs-type">int</span> exp)</span> </span>{
    <span class="hljs-built_in">static_assert</span>(std::is_arithmetic_v&lt;T&gt;, <span class="hljs-string">"å¿…é¡»æ˜¯ç®—æœ¯ç±»å‹"</span>);
    
    <span class="hljs-keyword">if</span> (exp &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">T</span>(<span class="hljs-number">1</span>) / <span class="hljs-built_in">compileTimePower</span>(base, -exp);
    }
    
    T result = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">while</span> (exp &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">if</span> (exp % <span class="hljs-number">2</span> == <span class="hljs-number">1</span>) {
            result *= base;
        }
        base *= base;
        exp /= <span class="hljs-number">2</span>;
    }
    <span class="hljs-keyword">return</span> result;
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_constexpr_design</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// ç¼–è¯‘æœŸè®¡ç®—</span>
    <span class="hljs-function"><span class="hljs-keyword">constexpr</span> Rational <span class="hljs-title">r1</span><span class="hljs-params">(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">constexpr</span> Rational <span class="hljs-title">r2</span><span class="hljs-params">(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>)</span></span>;
    <span class="hljs-keyword">constexpr</span> Rational sum = r1 + r2;  <span class="hljs-comment">// 5/6</span>
    
    <span class="hljs-keyword">constexpr</span> <span class="hljs-type">double</span> result = sum.<span class="hljs-built_in">toDouble</span>();
    std::cout &lt;&lt; <span class="hljs-string">"1/2 + 1/3 = "</span> &lt;&lt; result &lt;&lt; std::endl;
    
    <span class="hljs-comment">// ç¼–è¯‘æœŸå¹‚è®¡ç®—</span>
    <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> square = <span class="hljs-built_in">compileTimePower</span>(<span class="hljs-number">5</span>, <span class="hljs-number">2</span>);  <span class="hljs-comment">// 25</span>
    <span class="hljs-keyword">constexpr</span> <span class="hljs-type">double</span> cube = <span class="hljs-built_in">compileTimePower</span>(<span class="hljs-number">2.0</span>, <span class="hljs-number">3</span>);  <span class="hljs-comment">// 8.0</span>
    
    std::cout &lt;&lt; <span class="hljs-string">"5^2 = "</span> &lt;&lt; square &lt;&lt; <span class="hljs-string">", 2.0^3 = "</span> &lt;&lt; cube &lt;&lt; std::endl;
    
    <span class="hljs-comment">// åœ¨ç¼–è¯‘æœŸæ•°ç»„ä¸­ä½¿ç”¨</span>
    <span class="hljs-keyword">constexpr</span> std::array&lt;Rational, 3&gt; fractions = {
        <span class="hljs-built_in">Rational</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>),
        <span class="hljs-built_in">Rational</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>), 
        <span class="hljs-built_in">Rational</span>(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)
    };
    
    <span class="hljs-built_in">static_assert</span>(fractions[<span class="hljs-number">0</span>].<span class="hljs-built_in">numerator</span>() == <span class="hljs-number">1</span>);
    <span class="hljs-built_in">static_assert</span>(fractions[<span class="hljs-number">0</span>].<span class="hljs-built_in">denominator</span>() == <span class="hljs-number">2</span>);
    
    std::cout &lt;&lt; <span class="hljs-string">"ç¼–è¯‘æœŸåˆ†æ•°æ•°ç»„: "</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; frac : fractions) {
        std::cout &lt;&lt; frac.<span class="hljs-built_in">numerator</span>() &lt;&lt; <span class="hljs-string">"/"</span> &lt;&lt; frac.<span class="hljs-built_in">denominator</span>() &lt;&lt; <span class="hljs-string">" "</span>;
    }
    std::cout &lt;&lt; std::endl;
    
    <span class="hljs-comment">// è¿è¡Œæ—¶ä½¿ç”¨åŒæ ·çš„æ¥å£</span>
    <span class="hljs-function">Rational <span class="hljs-title">a</span><span class="hljs-params">(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>)</span>, <span class="hljs-title">b</span><span class="hljs-params">(<span class="hljs-number">2</span>, <span class="hljs-number">7</span>)</span></span>;
    <span class="hljs-keyword">auto</span> c = a * b;
    std::cout &lt;&lt; <span class="hljs-string">"3/5 * 2/7 = "</span> &lt;&lt; c.<span class="hljs-built_in">numerator</span>() 
              &lt;&lt; <span class="hljs-string">"/"</span> &lt;&lt; c.<span class="hljs-built_in">denominator</span>() &lt;&lt; std::endl;
}
</code></pre>
<hr/>
<h3 data-id="heading-20"><strong>å®æˆ˜æ¡ˆä¾‹ï¼šçœŸå®ä¸–ç•Œç±»è®¾è®¡</strong></h3>
<h4 data-id="heading-21"><strong>æ¡ˆä¾‹1ï¼šçº¿ç¨‹å®‰å…¨çš„è§‚å¯Ÿè€…æ¨¡å¼</strong></h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;functional&gt;</span></span>

<span class="hljs-comment">// çº¿ç¨‹å®‰å…¨çš„è§‚å¯Ÿè€…æ¨¡å¼</span>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span>... Args&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Observable</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">using</span> Observer = std::function&lt;<span class="hljs-built_in">void</span>(Args...)&gt;;
    <span class="hljs-keyword">using</span> ObserverId = <span class="hljs-type">size_t</span>;
    
    <span class="hljs-built_in">Observable</span>() = <span class="hljs-keyword">default</span>;
    
    <span class="hljs-comment">// ç¦æ­¢æ‹·è´ï¼ˆç§»åŠ¨å…è®¸ï¼‰</span>
    <span class="hljs-built_in">Observable</span>(<span class="hljs-type">const</span> Observable&amp;) = <span class="hljs-keyword">delete</span>;
    Observable&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> Observable&amp;) = <span class="hljs-keyword">delete</span>;
    
    <span class="hljs-comment">// æ³¨å†Œè§‚å¯Ÿè€…ï¼Œè¿”å›å¯ç”¨äºå–æ¶ˆæ³¨å†Œçš„ID</span>
    <span class="hljs-function">ObserverId <span class="hljs-title">registerObserver</span><span class="hljs-params">(Observer observer)</span> </span>{
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mutex_)</span></span>;
        ObserverId id = nextId_++;
        observers_.<span class="hljs-built_in">emplace_back</span>(id, std::<span class="hljs-built_in">move</span>(observer));
        <span class="hljs-keyword">return</span> id;
    }
    
    <span class="hljs-comment">// å–æ¶ˆæ³¨å†Œè§‚å¯Ÿè€…</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">unregisterObserver</span><span class="hljs-params">(ObserverId id)</span> </span>{
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mutex_)</span></span>;
        observers_.<span class="hljs-built_in">erase</span>(
            std::<span class="hljs-built_in">remove_if</span>(observers_.<span class="hljs-built_in">begin</span>(), observers_.<span class="hljs-built_in">end</span>(),
                [id](<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; item) { <span class="hljs-keyword">return</span> item.first == id; }),
            observers_.<span class="hljs-built_in">end</span>()
        );
    }
    
    <span class="hljs-comment">// é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">notify</span><span class="hljs-params">(Args... args)</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-comment">// æ‹·è´è§‚å¯Ÿè€…åˆ—è¡¨ä»¥é¿å…æ­»é”</span>
        <span class="hljs-keyword">auto</span> observersCopy = <span class="hljs-built_in">getObserversCopy</span>();
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; [id, observer] : observersCopy) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-built_in">observer</span>(args...);
            } <span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> std::exception&amp; e) {
                <span class="hljs-comment">// è§‚å¯Ÿè€…å¼‚å¸¸ä¸åº”è¯¥å½±å“å…¶ä»–è§‚å¯Ÿè€…</span>
                std::cerr &lt;&lt; <span class="hljs-string">"è§‚å¯Ÿè€… "</span> &lt;&lt; id &lt;&lt; <span class="hljs-string">" å¼‚å¸¸: "</span> &lt;&lt; e.<span class="hljs-built_in">what</span>() &lt;&lt; std::endl;
            }
        }
    }
    
    <span class="hljs-comment">// è§‚å¯Ÿè€…æ•°é‡</span>
    <span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">observerCount</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mutex_)</span></span>;
        <span class="hljs-keyword">return</span> observers_.<span class="hljs-built_in">size</span>();
    }
    
<span class="hljs-keyword">private</span>:
    std::vector&lt;std::pair&lt;ObserverId, Observer&gt;&gt; <span class="hljs-built_in">getObserversCopy</span>() <span class="hljs-type">const</span> {
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mutex_)</span></span>;
        <span class="hljs-keyword">return</span> observers_;
    }
    
    <span class="hljs-keyword">mutable</span> std::mutex mutex_;
    std::vector&lt;std::pair&lt;ObserverId, Observer&gt;&gt; observers_;
    ObserverId nextId_ = <span class="hljs-number">1</span>;
};

<span class="hljs-comment">// ä½¿ç”¨è§‚å¯Ÿè€…çš„æ¸©åº¦ä¼ æ„Ÿå™¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TemperatureSensor</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">using</span> TemperatureObserver = Observable&lt;<span class="hljs-type">double</span>&gt;;
    
    <span class="hljs-built_in">TemperatureSensor</span>() = <span class="hljs-keyword">default</span>;
    
    <span class="hljs-comment">// æ³¨å†Œæ¸©åº¦è§‚å¯Ÿè€…</span>
    <span class="hljs-function">TemperatureObserver::ObserverId 
    <span class="hljs-title">registerTemperatureObserver</span><span class="hljs-params">(TemperatureObserver::Observer observer)</span> </span>{
        <span class="hljs-keyword">return</span> temperatureObservable_.<span class="hljs-built_in">registerObserver</span>(std::<span class="hljs-built_in">move</span>(observer));
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">unregisterTemperatureObserver</span><span class="hljs-params">(TemperatureObserver::ObserverId id)</span> </span>{
        temperatureObservable_.<span class="hljs-built_in">unregisterObserver</span>(id);
    }
    
    <span class="hljs-comment">// æ›´æ–°æ¸©åº¦å¹¶é€šçŸ¥è§‚å¯Ÿè€…</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">updateTemperature</span><span class="hljs-params">(<span class="hljs-type">double</span> temperature)</span> </span>{
        currentTemperature_ = temperature;
        temperatureObservable_.<span class="hljs-built_in">notify</span>(temperature);
    }
    
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">getCurrentTemperature</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> currentTemperature_; }
    
<span class="hljs-keyword">private</span>:
    TemperatureObserver temperatureObservable_;
    <span class="hljs-type">double</span> currentTemperature_ = <span class="hljs-number">0.0</span>;
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_observer_pattern</span><span class="hljs-params">()</span> </span>{
    TemperatureSensor sensor;
    
    <span class="hljs-comment">// æ³¨å†Œå¤šä¸ªè§‚å¯Ÿè€…</span>
    <span class="hljs-keyword">auto</span> id1 = sensor.<span class="hljs-built_in">registerTemperatureObserver</span>([](<span class="hljs-type">double</span> temp) {
        std::cout &lt;&lt; <span class="hljs-string">"è§‚å¯Ÿè€…1: æ¸©åº¦æ›´æ–°ä¸º "</span> &lt;&lt; temp &lt;&lt; <span class="hljs-string">"Â°C"</span> &lt;&lt; std::endl;
    });
    
    <span class="hljs-keyword">auto</span> id2 = sensor.<span class="hljs-built_in">registerTemperatureObserver</span>([](<span class="hljs-type">double</span> temp) {
        <span class="hljs-keyword">if</span> (temp &gt; <span class="hljs-number">30.0</span>) {
            std::cout &lt;&lt; <span class="hljs-string">"è§‚å¯Ÿè€…2: è­¦å‘Šï¼æ¸©åº¦è¿‡é«˜: "</span> &lt;&lt; temp &lt;&lt; <span class="hljs-string">"Â°C"</span> &lt;&lt; std::endl;
        }
    });
    
    <span class="hljs-comment">// æ¨¡æ‹Ÿæ¸©åº¦æ›´æ–°</span>
    sensor.<span class="hljs-built_in">updateTemperature</span>(<span class="hljs-number">25.5</span>);
    sensor.<span class="hljs-built_in">updateTemperature</span>(<span class="hljs-number">32.1</span>);
    
    std::cout &lt;&lt; <span class="hljs-string">"å½“å‰è§‚å¯Ÿè€…æ•°é‡: "</span> &lt;&lt; sensor.<span class="hljs-built_in">observerCount</span>() &lt;&lt; std::endl;
    
    <span class="hljs-comment">// å–æ¶ˆæ³¨å†Œä¸€ä¸ªè§‚å¯Ÿè€…</span>
    sensor.<span class="hljs-built_in">unregisterTemperatureObserver</span>(id1);
    sensor.<span class="hljs-built_in">updateTemperature</span>(<span class="hljs-number">28.0</span>);
    
    std::cout &lt;&lt; <span class="hljs-string">"å–æ¶ˆæ³¨å†Œåè§‚å¯Ÿè€…æ•°é‡: "</span> &lt;&lt; sensor.<span class="hljs-built_in">observerCount</span>() &lt;&lt; std::endl;
}
</code></pre>
<h4 data-id="heading-22"><strong>æ¡ˆä¾‹2ï¼šç­–ç•¥æ¨¡å¼ä¸ç±»å‹æ“¦é™¤</strong></h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;type_traits&gt;</span></span>

<span class="hljs-comment">// ç±»å‹æ“¦é™¤çš„ç»˜åˆ¶ç­–ç•¥</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DrawStrategy</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    <span class="hljs-title">DrawStrategy</span><span class="hljs-params">(T&amp;&amp; strategy)</span> 
        : pImpl_(std::make_unique&lt;Model&lt;T&gt;&gt;(std::forward&lt;T&gt;(strategy))) 
    {</span>}
    
    <span class="hljs-comment">// é»˜è®¤æ“ä½œ</span>
    <span class="hljs-built_in">DrawStrategy</span>() = <span class="hljs-keyword">default</span>;
    <span class="hljs-built_in">DrawStrategy</span>(DrawStrategy&amp;&amp;) = <span class="hljs-keyword">default</span>;
    DrawStrategy&amp; <span class="hljs-keyword">operator</span>=(DrawStrategy&amp;&amp;) = <span class="hljs-keyword">default</span>;
    
    <span class="hljs-comment">// ç¦æ­¢æ‹·è´</span>
    <span class="hljs-built_in">DrawStrategy</span>(<span class="hljs-type">const</span> DrawStrategy&amp;) = <span class="hljs-keyword">delete</span>;
    DrawStrategy&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> DrawStrategy&amp;) = <span class="hljs-keyword">delete</span>;
    
    <span class="hljs-comment">// ç»˜åˆ¶æ“ä½œ</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y, <span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span> <span class="hljs-type">const</span> </span>{
        pImpl_-&gt;<span class="hljs-built_in">draw</span>(x, y, width, height);
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Concept</span> {
        <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Concept</span>() = <span class="hljs-keyword">default</span>;
        <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y, <span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;
    };
    
    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Model</span> : Concept {
        <span class="hljs-built_in">Model</span>(T&amp;&amp; strategy) : <span class="hljs-built_in">strategy_</span>(std::forward&lt;T&gt;(strategy)) {}
        
        <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y, <span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
            strategy_.<span class="hljs-built_in">draw</span>(x, y, width, height);
        }
        
        T strategy_;
    };
    
    std::unique_ptr&lt;Concept&gt; pImpl_;
};

<span class="hljs-comment">// å…·ä½“çš„ç»˜åˆ¶ç­–ç•¥</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SolidDrawStrategy</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y, <span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span> <span class="hljs-type">const</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"å®å¿ƒç»˜åˆ¶: ä½ç½®("</span> &lt;&lt; x &lt;&lt; <span class="hljs-string">","</span> &lt;&lt; y 
                  &lt;&lt; <span class="hljs-string">"), å¤§å°("</span> &lt;&lt; width &lt;&lt; <span class="hljs-string">"x"</span> &lt;&lt; height &lt;&lt; <span class="hljs-string">")"</span> &lt;&lt; std::endl;
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BorderDrawStrategy</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y, <span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span> <span class="hljs-type">const</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"è¾¹æ¡†ç»˜åˆ¶: ä½ç½®("</span> &lt;&lt; x &lt;&lt; <span class="hljs-string">","</span> &lt;&lt; y 
                  &lt;&lt; <span class="hljs-string">"), å¤§å°("</span> &lt;&lt; width &lt;&lt; <span class="hljs-string">"x"</span> &lt;&lt; height &lt;&lt; <span class="hljs-string">")"</span> &lt;&lt; std::endl;
    }
};

<span class="hljs-comment">// ä½¿ç”¨ç­–ç•¥æ¨¡å¼çš„å›¾å½¢ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Shape</span>(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y, <span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height, DrawStrategy drawer)
        : <span class="hljs-built_in">x_</span>(x), <span class="hljs-built_in">y_</span>(y), <span class="hljs-built_in">width_</span>(width), <span class="hljs-built_in">height_</span>(height)
        , <span class="hljs-built_in">drawer_</span>(std::<span class="hljs-built_in">move</span>(drawer))
    {}
    
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Shape</span>() = <span class="hljs-keyword">default</span>;
    
    <span class="hljs-comment">// ç»˜åˆ¶æ“ä½œ</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        drawer_.<span class="hljs-built_in">draw</span>(x_, y_, width_, height_);
    }
    
    <span class="hljs-comment">// ç§»åŠ¨å’Œä½ç½®æ“ä½œ</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">move</span><span class="hljs-params">(<span class="hljs-type">int</span> dx, <span class="hljs-type">int</span> dy)</span> </span>{
        x_ += dx;
        y_ += dy;
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setPosition</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> </span>{
        x_ = x;
        y_ = y;
    }
    
    <span class="hljs-comment">// è®¿é—®å™¨</span>
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getX</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> x_; }
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getY</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> y_; }
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getWidth</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> width_; }
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getHeight</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> height_; }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span> x_, y_, width_, height_;
    DrawStrategy drawer_;
};

<span class="hljs-comment">// å…·ä½“çš„å›¾å½¢ç±»å‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> : <span class="hljs-keyword">public</span> Shape {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Rectangle</span>(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y, <span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height, DrawStrategy drawer)
        : <span class="hljs-built_in">Shape</span>(x, y, width, height, std::<span class="hljs-built_in">move</span>(drawer))
    {}
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"çŸ©å½¢ - "</span>;
        Shape::<span class="hljs-built_in">draw</span>();
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> : <span class="hljs-keyword">public</span> Shape {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Circle</span>(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y, <span class="hljs-type">int</span> radius, DrawStrategy drawer)
        : <span class="hljs-built_in">Shape</span>(x, y, radius * <span class="hljs-number">2</span>, radius * <span class="hljs-number">2</span>, std::<span class="hljs-built_in">move</span>(drawer))
        , <span class="hljs-built_in">radius_</span>(radius)
    {}
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"åœ†å½¢(åŠå¾„="</span> &lt;&lt; radius_ &lt;&lt; <span class="hljs-string">") - "</span>;
        Shape::<span class="hljs-built_in">draw</span>();
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span> radius_;
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_strategy_pattern</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// åˆ›å»ºä¸åŒçš„ç»˜åˆ¶ç­–ç•¥</span>
    SolidDrawStrategy solidDrawer;
    BorderDrawStrategy borderDrawer;
    
    <span class="hljs-comment">// åˆ›å»ºä½¿ç”¨ä¸åŒç­–ç•¥çš„å›¾å½¢</span>
    <span class="hljs-function">Rectangle <span class="hljs-title">rect1</span><span class="hljs-params">(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">100</span>, <span class="hljs-number">50</span>, DrawStrategy(solidDrawer))</span></span>;
    <span class="hljs-function">Rectangle <span class="hljs-title">rect2</span><span class="hljs-params">(<span class="hljs-number">50</span>, <span class="hljs-number">50</span>, <span class="hljs-number">80</span>, <span class="hljs-number">60</span>, DrawStrategy(borderDrawer))</span></span>;
    <span class="hljs-function">Circle <span class="hljs-title">circle</span><span class="hljs-params">(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">25</span>, DrawStrategy(solidDrawer))</span></span>;
    
    <span class="hljs-comment">// ç»˜åˆ¶æ‰€æœ‰å›¾å½¢</span>
    std::vector&lt;std::unique_ptr&lt;Shape&gt;&gt; shapes;
    shapes.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_unique</span>&lt;Rectangle&gt;(rect1));
    shapes.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_unique</span>&lt;Rectangle&gt;(rect2));
    shapes.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_unique</span>&lt;Circle&gt;(circle));
    
    <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; shape : shapes) {
        shape-&gt;<span class="hljs-built_in">draw</span>();
    }
    
    <span class="hljs-comment">// è¿è¡Œæ—¶åˆ‡æ¢ç­–ç•¥</span>
    std::cout &lt;&lt; <span class="hljs-string">"\nåˆ‡æ¢ç»˜åˆ¶ç­–ç•¥å:"</span> &lt;&lt; std::endl;
    <span class="hljs-function">Rectangle <span class="hljs-title">dynamicRect</span><span class="hljs-params">(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">200</span>, <span class="hljs-number">100</span>, DrawStrategy(solidDrawer))</span></span>;
    dynamicRect.<span class="hljs-built_in">draw</span>();
    
    <span class="hljs-comment">// åŠ¨æ€æ›´æ¢ç­–ç•¥</span>
    dynamicRect = <span class="hljs-built_in">Rectangle</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">200</span>, <span class="hljs-number">100</span>, <span class="hljs-built_in">DrawStrategy</span>(borderDrawer));
    dynamicRect.<span class="hljs-built_in">draw</span>();
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Databend SQL nom Parser æ€§èƒ½ä¼˜åŒ–]]></title>    <link>https://juejin.cn/post/7572099468247629859</link>    <guid>https://juejin.cn/post/7572099468247629859</guid>    <pubDate>2025-11-14T03:46:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572099468247629859" data-draft-id="7571068689765859368" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Databend SQL nom Parser æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="keywords" content="æ•°æ®åº“"/> <meta itemprop="datePublished" content="2025-11-14T03:46:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Databend"/> <meta itemprop="url" content="https://juejin.cn/user/4477651847485534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Databend SQL nom Parser æ€§èƒ½ä¼˜åŒ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4477651847485534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Databend
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T03:46:19.000Z" title="Fri Nov 14 2025 03:46:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">nom ç®€ä»‹</h2>
<p>nom æ˜¯ Rust ç”Ÿæ€ä¸­éå¸¸å—æ¬¢è¿çš„è§£ææ¡†æ¶ï¼šæ€§èƒ½ä¼˜ç§€ã€ç»„åˆçµæ´»ï¼Œå¹¶ä¸”èƒ½å¾ˆå¥½åœ°åˆ©ç”¨ Rust çš„ç±»å‹ç³»ç»Ÿã€‚Databend åœ¨ SQL è¡¨è¾¾å¼å’Œè¯­å¥è§£æä¸Šå¤§é‡ä½¿ç”¨ nomï¼Œå¼€å‘ä½“éªŒä¸é”™ï¼Œå¯è¯»æ€§ä¹Ÿé«˜ã€‚</p>
<p>ä¸è¿‡ï¼Œç»„åˆå¼ parser å®¹æ˜“åœ¨ä¸ç»æ„é—´åŸ‹ä¸‹æ€§èƒ½éšæ‚£â€”â€”å°¤å…¶æ˜¯å½“å¤šä¸ªåˆ†æ”¯ç»“æ„ç›¸ä¼¼ã€å†åŠ ä¸Šé€’å½’åµŒå¥—æ—¶ï¼Œå›æº¯æˆæœ¬ä¼šæŒ‡æ•°çº§è†¨èƒ€ã€‚</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">/// ä¸€ä¸ªç®€å•çš„ parserï¼šåŒ¹é… "foo" æˆ– "bar"</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">foo_or_bar</span>(input: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> IResult&lt;&amp;<span class="hljs-type">str</span>, &amp;<span class="hljs-type">str</span>&gt; {
    <span class="hljs-title function_ invoke__">alt</span>((
        <span class="hljs-title function_ invoke__">tag</span>(<span class="hljs-string">"foo"</span>),
        <span class="hljs-title function_ invoke__">tag</span>(<span class="hljs-string">"bar"</span>),
    ))(input)
}
</code></pre>
<h2 data-id="heading-1">é—®é¢˜æ¡ˆä¾‹ï¼šfunction åµŒå¥—æ‹–æ…¢è§£æ</h2>
<p>ä¸€æ¬¡ç”¨æˆ·åé¦ˆé‡Œï¼Œæˆ‘ä»¬æ”¶åˆ°äº†ä¸€æ¡è§£æ 20 åˆ†é’Ÿéƒ½è·‘ä¸å®Œçš„ SQLã€‚ç«ç„°å›¾æ¸…æ¥šåœ°æ˜¾ç¤ºï¼šå‡½æ•°è§£æåå¤å°è¯•ã€å±‚å±‚å›æº¯ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed580c8a64b84c06a6ad4a11637f19a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGF0YWJlbmQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763696779&amp;x-signature=541M4V9NRlqAMOyVElSPlTWFdvw%3D" alt="1280X1280.JPEG" loading="lazy"/></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">select</span> json_object_insert(
           json_object_insert(
                   json_object_insert(
                           json_object_insert(
                                   json_object_insert(
                                           <span class="hljs-string">'{}'</span>::variant,
                                           <span class="hljs-string">'email_address'</span>, <span class="hljs-string">'gokul'</span>, <span class="hljs-literal">true</span>,
                                           <span class="hljs-string">'home_phone'</span>, <span class="hljs-number">12345</span>, <span class="hljs-literal">true</span>,
                                           <span class="hljs-string">'mobile_phone'</span>, <span class="hljs-number">345678</span>, <span class="hljs-literal">true</span>,
                                           <span class="hljs-string">'race_code'</span>, <span class="hljs-string">'M'</span>, <span class="hljs-literal">true</span>
                                   ),
                                   <span class="hljs-string">'race_desc'</span>, <span class="hljs-string">'m'</span>, <span class="hljs-literal">true</span>,
                                   <span class="hljs-string">'marital_status_code'</span>, <span class="hljs-string">'y'</span>, <span class="hljs-literal">true</span>,
                                   <span class="hljs-string">'marital_status_desc'</span>, <span class="hljs-string">'yu'</span>, <span class="hljs-literal">true</span>,
                                   <span class="hljs-string">'prefix'</span>, <span class="hljs-string">'hj'</span>, <span class="hljs-literal">true</span>
                           ),
                           <span class="hljs-string">'first_name'</span>, <span class="hljs-string">'g'</span>, <span class="hljs-literal">true</span>,
                           <span class="hljs-string">'last_name'</span>, <span class="hljs-string">'p'</span>, <span class="hljs-literal">true</span>,
                           <span class="hljs-string">'deceased_date'</span>, <span class="hljs-string">'2085-05-07'</span>, <span class="hljs-literal">true</span>,
                           <span class="hljs-string">'birth_date'</span>, <span class="hljs-string">'6789'</span>, <span class="hljs-literal">true</span>
                   ),
                   <span class="hljs-string">'middle_name'</span>, <span class="hljs-string">'89'</span>, <span class="hljs-literal">true</span>,
                   <span class="hljs-string">'middle_initial'</span>, <span class="hljs-string">'0789'</span>, <span class="hljs-literal">true</span>,
                   <span class="hljs-string">'gender_code'</span>, <span class="hljs-string">'56789'</span>, <span class="hljs-literal">true</span>,
                   <span class="hljs-string">'gender_desc'</span>, <span class="hljs-string">'m'</span>, <span class="hljs-literal">true</span>
           ),
           <span class="hljs-string">'home_phone_line_type'</span>, <span class="hljs-string">'uyt'</span>, <span class="hljs-literal">true</span>,
           <span class="hljs-string">'mobile_phone_line_type'</span>, <span class="hljs-number">4</span>, <span class="hljs-literal">true</span>
   );
</code></pre>
<p>å½“æ—¶çš„å‡½æ•°è§£æå†™æ³•å¤§è‡´å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">function_call</span> = <span class="hljs-title function_ invoke__">map</span>(
    rule! {
        #function_name
        ~ <span class="hljs-string">"("</span> ~ DISTINCT? ~ #<span class="hljs-title function_ invoke__">comma_separated_list0</span>(<span class="hljs-title function_ invoke__">subexpr</span>(<span class="hljs-number">0</span>))? ~ <span class="hljs-string">")"</span>
    },
    |(name, _, opt_distinct, opt_args, _)| ExprElement::FunctionCall { .. },
);
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">function_call_with_lambda</span> = <span class="hljs-title function_ invoke__">map</span>(
    rule! {
        #function_name
        ~ <span class="hljs-string">"("</span> ~ #<span class="hljs-title function_ invoke__">subexpr</span>(<span class="hljs-number">0</span>) ~ <span class="hljs-string">","</span> ~ #lambda_params ~ <span class="hljs-string">"-&gt;"</span> ~ #<span class="hljs-title function_ invoke__">subexpr</span>(<span class="hljs-number">0</span>) ~ <span class="hljs-string">")"</span>
    },
    |(name, _, arg, _, params, _, expr, _)| ExprElement::FunctionCall { .. },
);
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">function_call_with_window</span> = <span class="hljs-title function_ invoke__">map</span>(
    rule! {
        #function_name
        ~ <span class="hljs-string">"("</span> ~ DISTINCT? ~ #<span class="hljs-title function_ invoke__">comma_separated_list0</span>(<span class="hljs-title function_ invoke__">subexpr</span>(<span class="hljs-number">0</span>))? ~ <span class="hljs-string">")"</span>
        ~ #window_function
    },
    |(name, _, opt_distinct, opt_args, _, window)| ExprElement::FunctionCall { .. },
);
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">function_call_with_within_group_window</span> = <span class="hljs-title function_ invoke__">map</span>(
    rule! {
        #function_name
        ~ <span class="hljs-string">"("</span> ~ DISTINCT? ~ #<span class="hljs-title function_ invoke__">comma_separated_list0</span>(<span class="hljs-title function_ invoke__">subexpr</span>(<span class="hljs-number">0</span>))? ~ <span class="hljs-string">")"</span>
        ~ #within_group
        ~ #window_function?
    },
    |(name, _, opt_distinct, opt_args, _, order_by, window)| ExprElement::FunctionCall { .. },
);
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">function_call_with_params_window</span> = <span class="hljs-title function_ invoke__">map</span>(
    rule! {
        #function_name
        ~ <span class="hljs-string">"("</span> ~ #<span class="hljs-title function_ invoke__">comma_separated_list1</span>(<span class="hljs-title function_ invoke__">subexpr</span>(<span class="hljs-number">0</span>)) ~ <span class="hljs-string">")"</span>
        ~ <span class="hljs-string">"("</span> ~ DISTINCT? ~ #<span class="hljs-title function_ invoke__">comma_separated_list0</span>(<span class="hljs-title function_ invoke__">subexpr</span>(<span class="hljs-number">0</span>))? ~ <span class="hljs-string">")"</span>
        ~ #window_function?
    },
    |(name, _, params, _, _, opt_distinct, opt_args, _, window)| ExprElement::FunctionCall { .. },
);

rule! {
    #function_call_with_lambda : <span class="hljs-string">"`function(..., x -&gt; ...)`"</span>
    | #function_call_with_window : <span class="hljs-string">"`function(...) OVER ([ PARTITION BY &lt;expr&gt;, ... ] [ ORDER BY &lt;expr&gt;, ... ] [ &lt;window frame&gt; ])`"</span>
    | #function_call_with_within_group_window: <span class="hljs-string">"`function(...) [ WITHIN GROUP ( ORDER BY &lt;expr&gt;, ... ) ] OVER ([ PARTITION BY &lt;expr&gt;, ... ] [ ORDER BY &lt;expr&gt;, ... ] [ &lt;window frame&gt; ])`"</span>
    | #function_call_with_params_window : <span class="hljs-string">"`function(...)(...) OVER ([ PARTITION BY &lt;expr&gt;, ... ] [ ORDER BY &lt;expr&gt;, ... ] [ &lt;window frame&gt; ])`"</span>
    | #function_call : <span class="hljs-string">"`function(...)`"</span>
}
</code></pre>
<p>è¿™æ®µä»£ç å¯¹é˜…è¯»è€…éå¸¸å‹å¥½ï¼Œä½†ä¹Ÿæœ‰ä¸¤ä¸ªç‰¹å¾ï¼š</p>
<ul>
<li>æ‰€æœ‰åˆ†æ”¯éƒ½ä»¥ <code>function(...)</code> èµ·æ‰‹ï¼›</li>
<li>æ·±åº¦ä¼˜å…ˆçš„ <code>alt</code> æ¯æ¬¡åŒ¹é…å¤±è´¥éƒ½ä¼šå›æº¯åˆ°ä¸‹ä¸€ä¸ªåˆ†æ”¯ã€‚</li>
</ul>
<p>åœ¨ä¸Šé¢è¿™ç§äº”å±‚åµŒå¥—ã€æ¯å±‚æ¨¡å¼æ•°é‡ä¸º 5 çš„åœºæ™¯é‡Œï¼Œæœ€å¸¸è§çš„ â€œçº¯å‡½æ•°è°ƒç”¨â€ åˆ†æ”¯æ”¾åœ¨æœ€åï¼Œå®é™…è¦å°è¯• <code>5^5 = 3125</code> æ¬¡æ‰èƒ½å‘½ä¸­ã€‚å¤æ‚åº¦é£™å‡åˆ° <code>O(m^n)</code>ï¼Œæ€§èƒ½ç«‹åˆ»å´©æ‰ã€‚</p>
<h2 data-id="heading-2">ä¼˜åŒ–æ–¹æ¡ˆä¸€ï¼šæŠ˜å ç›¸ä¼¼åˆ†æ”¯ï¼Œé¿å…æŒ‡æ•°çº§å›æº¯</h2>
<p>é—®é¢˜æ ¹æºæ˜¯â€œç»“æ„é«˜åº¦ç›¸ä¼¼ + é€’å½’ + æ·±åº¦ä¼˜å…ˆå›æº¯â€ã€‚æˆ‘ä»¬æŠŠå¤šä¸ªåˆ†æ”¯æŠ˜å æˆä¸€æ¬¡è§£æï¼Œå†æ ¹æ®åŒ¹é…åˆ°çš„åç¼€æ¥å†³å®šå…·ä½“çš„å‡½æ•°ç±»å‹ï¼Œç›¸å½“äºæŠŠæµç¨‹å˜æˆäº†â€œå…ˆæ•´ä½“åŒ¹é…ï¼Œå†åˆ†ç±»å¤„ç†â€çš„å¹¿åº¦ä¼˜å…ˆæ€è·¯ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">function_call_body</span> = <span class="hljs-title function_ invoke__">map_res</span>(
    rule! {
        <span class="hljs-string">"("</span> ~ DISTINCT? ~ #<span class="hljs-title function_ invoke__">subexpr</span>(<span class="hljs-number">0</span>)? ~ <span class="hljs-string">","</span>? ~ (#lambda_params ~ <span class="hljs-string">"-&gt;"</span> ~ #<span class="hljs-title function_ invoke__">subexpr</span>(<span class="hljs-number">0</span>))? ~ #<span class="hljs-title function_ invoke__">comma_separated_list1</span>(<span class="hljs-title function_ invoke__">subexpr</span>(<span class="hljs-number">0</span>))? ~ <span class="hljs-string">")"</span>
        ~ (<span class="hljs-string">"("</span> ~ DISTINCT? ~ #<span class="hljs-title function_ invoke__">comma_separated_list0</span>(<span class="hljs-title function_ invoke__">subexpr</span>(<span class="hljs-number">0</span>))? ~ <span class="hljs-string">")"</span>)?
        ~ #within_group?
        ~ #window_function?
    },
    |(
        _,
        opt_distinct_0,
        first_param,
        _,
        opt_lambda,
        params_0,
        _,
        params_1,
        order_by,
        window,
    )| {
        <span class="hljs-title function_ invoke__">match</span> (
            first_param,
            opt_lambda,
            opt_distinct_0,
            params_0,
            params_1,
            order_by,
            window,
        ) {
            (
                <span class="hljs-title function_ invoke__">Some</span>(first_param),
                <span class="hljs-title function_ invoke__">Some</span>((lambda_params, _, arg_1)),
                <span class="hljs-literal">None</span>,
                <span class="hljs-literal">None</span>,
                <span class="hljs-literal">None</span>,
                <span class="hljs-literal">None</span>,
                <span class="hljs-literal">None</span>,
            ) =&gt; <span class="hljs-title function_ invoke__">Ok</span>(FunctionCallSuffix::Lambda { .. }),
            (
                <span class="hljs-title function_ invoke__">Some</span>(first_param),
                <span class="hljs-literal">None</span>,
                <span class="hljs-literal">None</span>,
                params_0,
                <span class="hljs-title function_ invoke__">Some</span>((_, opt_distinct_1, params_1, _)),
                <span class="hljs-literal">None</span>,
                window,
            ) =&gt; <span class="hljs-title function_ invoke__">Ok</span>(FunctionCallSuffix::ParamsWindow { .. }),
            (first_param, <span class="hljs-literal">None</span>, opt_distinct, params, <span class="hljs-literal">None</span>, <span class="hljs-title function_ invoke__">Some</span>(order_by), window) =&gt; {
                <span class="hljs-title function_ invoke__">Ok</span>(FunctionCallSuffix::WithInGroupWindow { .. })
            }
            (first_param, <span class="hljs-literal">None</span>, opt_distinct, params, <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>, <span class="hljs-title function_ invoke__">Some</span>(window)) =&gt; {
                <span class="hljs-title function_ invoke__">Ok</span>(FunctionCallSuffix::Window { .. })
            }
            (first_param, <span class="hljs-literal">None</span>, opt_distinct, params, <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>) =&gt; {
                <span class="hljs-title function_ invoke__">Ok</span>(FunctionCallSuffix::Simple { .. })
            }
            _ =&gt; <span class="hljs-title function_ invoke__">Err</span>(nom::Err::<span class="hljs-title function_ invoke__">Error</span>(ErrorKind::<span class="hljs-title function_ invoke__">Other</span>(
                <span class="hljs-string">"Unsupported function format"</span>,
            ))),
        }
    },
);
</code></pre>
<p>ä¸€æ¬¡è§£æå®Œæˆæ‰€æœ‰ç»“æ„åŒ¹é…ï¼Œå†æ ¹æ®åˆ†æ”¯ç±»å‹è£…é…ç»“æœï¼Œç›´æ¥æ¶ˆé™¤äº†æŒ‡æ•°çº§å›æº¯ã€‚è¯¥ä¼˜åŒ–è½åœ°åï¼ŒåŸå…ˆéœ€è¦å‡ ååˆ†é’Ÿçš„ SQL å¦‚ä»Šåªè¦å‡ åæ¯«ç§’ã€‚</p>
<h2 data-id="heading-3">ä¼˜åŒ–æ–¹æ¡ˆäºŒï¼šé«˜é¢‘ Token è§£æç›´æ¥ hard code</h2>
<p>function å›æº¯é—®é¢˜è§£å†³åï¼Œæˆ‘ä»¬åˆåœ¨è¡¨è¾¾å¼è§£æä¸ŠæŠ“åˆ°äº†ç¬¬äºŒä¸ªçƒ­ç‚¹ï¼š<code>Binary/Unary/Json Operator</code> ç­‰ç®€å• token è¢«é¢‘ç¹å‘½ä¸­ï¼Œè€ŒåŸå…ˆçš„å®ç°æ˜¯ <code>alt + value + rule!</code> çš„ç»„åˆã€‚è¿™ä¸ªç»„åˆæ¯æ¬¡è°ƒç”¨éƒ½è¦ï¼š</p>
<ul>
<li>æ„é€ é—­åŒ…ï¼›</li>
<li>åŒ…è£…é”™è¯¯ä¿¡æ¯ï¼›</li>
<li>æ„å»ºè¿”å›å€¼ï¼›</li>
<li>å†è¿›å…¥ä¸‹ä¸€å±‚ parserã€‚</li>
</ul>
<p>å¯¹äºå‡ ä¹åªåŒ…å«å•ä¸ª token çš„åœºæ™¯ï¼Œç›´æ¥æ‰‹å†™åŒ¹é…ä¼šå¿«å¾—å¤šã€‚Databend çš„ <code>expr</code> æœ‰ 49 ä¸ªåˆ†æ”¯ï¼Œçƒ­åº¦éå¸¸é«˜ï¼ŒæŠŠè¿™äº›åˆ†æ”¯ hard code æ‰æ”¶ç›Šæå¯è§‚ã€‚ä»¥ä¸‹æ˜¯ <code>json_op</code> æ›¿æ¢å‰åçš„å®ç°ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// åŸå®ç°ï¼šalt + rule!</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">json_op</span>(i: Input) <span class="hljs-punctuation">-&gt;</span> IResult&lt;JsonOperator&gt; {
    <span class="hljs-title function_ invoke__">alt</span>((
        <span class="hljs-title function_ invoke__">value</span>(JsonOperator::Arrow, rule! { <span class="hljs-string">"-&gt;"</span> }),
        <span class="hljs-title function_ invoke__">value</span>(JsonOperator::LongArrow, rule! { <span class="hljs-string">"-&gt;&gt;"</span> }),
        <span class="hljs-title function_ invoke__">value</span>(JsonOperator::HashArrow, rule! { <span class="hljs-string">"#&gt;"</span> }),
        <span class="hljs-title function_ invoke__">value</span>(JsonOperator::HashLongArrow, rule! { <span class="hljs-string">"#&gt;&gt;"</span> }),
        <span class="hljs-title function_ invoke__">value</span>(JsonOperator::Question, rule! { <span class="hljs-string">"?"</span> }),
        <span class="hljs-title function_ invoke__">value</span>(JsonOperator::QuestionOr, rule! { <span class="hljs-string">"?|"</span> }),
        <span class="hljs-title function_ invoke__">value</span>(JsonOperator::QuestionAnd, rule! { <span class="hljs-string">"?&amp;"</span> }),
        <span class="hljs-title function_ invoke__">value</span>(JsonOperator::AtArrow, rule! { <span class="hljs-string">"@&gt;"</span> }),
        <span class="hljs-title function_ invoke__">value</span>(JsonOperator::ArrowAt, rule! { <span class="hljs-string">"&lt;@"</span> }),
        <span class="hljs-title function_ invoke__">value</span>(JsonOperator::AtQuestion, rule! { <span class="hljs-string">"@?"</span> }),
        <span class="hljs-title function_ invoke__">value</span>(JsonOperator::AtAt, rule! { <span class="hljs-string">"@@"</span> }),
        <span class="hljs-title function_ invoke__">value</span>(JsonOperator::HashMinus, rule! { <span class="hljs-string">"#-"</span> }),
    ))(i)
}

<span class="hljs-comment">// æ–°å®ç°ï¼šhard code</span>
<span class="hljs-built_in">macro_rules!</span> op_branch {
    ($i:ident, $token_0:ident, $($kind:ident =&gt; $op:expr),+ $(,)?) =&gt; {
        <span class="hljs-keyword">match</span> $token_0.kind {
            $(
                TokenKind::$kind =&gt; <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">return_op</span>($i, <span class="hljs-number">1</span>, $op),
            )+
            _ =&gt; (),
        }
    };
}

<span class="hljs-title function_ invoke__">pub</span>(<span class="hljs-keyword">crate</span>) <span class="hljs-keyword">fn</span> <span class="hljs-title function_">json_op_simple</span>(i: Input) <span class="hljs-punctuation">-&gt;</span> IResult&lt;JsonOperator&gt; {
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(token_0) = i.tokens.<span class="hljs-title function_ invoke__">first</span>() {
        op_branch!(
            i, token_0,
            RArrow =&gt; JsonOperator::Arrow,
            LongRArrow =&gt; JsonOperator::LongArrow,
            HashRArrow =&gt; JsonOperator::HashArrow,
            HashLongRArrow =&gt; JsonOperator::HashLongArrow,
            Placeholder =&gt; JsonOperator::Question,
            QuestionOr =&gt; JsonOperator::QuestionOr,
            QuestionAnd =&gt; JsonOperator::QuestionAnd,
            AtArrow =&gt; JsonOperator::AtArrow,
            ArrowAt =&gt; JsonOperator::ArrowAt,
            AtQuestion =&gt; JsonOperator::AtQuestion,
            AtAt =&gt; JsonOperator::AtAt,
            HashMinus =&gt; JsonOperator::HashMinus,
        );
    }
    <span class="hljs-title function_ invoke__">Err</span>(nom::Err::<span class="hljs-title function_ invoke__">Error</span>(Error::<span class="hljs-title function_ invoke__">from_error_kind</span>(
        i,
        ErrorKind::<span class="hljs-title function_ invoke__">Other</span>(<span class="hljs-string">"expecting `-&gt;`, '-&gt;&gt;', '#&gt;', '#&gt;&gt;', '?', '?|', '?&amp;', '@&gt;', '&lt;@', '@?', '@@', '#-', or more ..."</span>),
    )))
}

<span class="hljs-meta">#[inline]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">return_op</span>&lt;T&gt;(i: Input, start: <span class="hljs-type">usize</span>, op: T) <span class="hljs-punctuation">-&gt;</span> IResult&lt;T&gt; {
    <span class="hljs-title function_ invoke__">Ok</span>((i.<span class="hljs-title function_ invoke__">slice</span>(start..), op))
}
</code></pre>
<h3 data-id="heading-4">Benchmark</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">bench</span>                            <span class="hljs-string">fastest</span>       <span class="hljs-string">â”‚</span> <span class="hljs-string">slowest</span>       <span class="hljs-string">â”‚</span> <span class="hljs-string">median</span>        <span class="hljs-string">â”‚</span> <span class="hljs-string">mean</span>          <span class="hljs-string">â”‚</span> <span class="hljs-string">samples</span> <span class="hljs-string">â”‚</span> <span class="hljs-string">iters</span>
<span class="hljs-string">â•°â”€</span> <span class="hljs-string">dummy</span>                                       <span class="hljs-string">â”‚</span>               <span class="hljs-string">â”‚</span>               <span class="hljs-string">â”‚</span>               <span class="hljs-string">â”‚</span>         <span class="hljs-string">â”‚</span>
   <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">test_json_op_parse</span>         <span class="hljs-number">413.8</span> <span class="hljs-string">ns</span>      <span class="hljs-string">â”‚</span> <span class="hljs-number">2.817</span> <span class="hljs-string">Âµs</span>      <span class="hljs-string">â”‚</span> <span class="hljs-number">441.3</span> <span class="hljs-string">ns</span>      <span class="hljs-string">â”‚</span> <span class="hljs-number">482.6</span> <span class="hljs-string">ns</span>      <span class="hljs-string">â”‚</span> <span class="hljs-number">100</span>     <span class="hljs-string">â”‚</span> <span class="hljs-number">100</span>
   <span class="hljs-string">â•°â”€</span> <span class="hljs-string">test_json_op_parse_simple</span>  <span class="hljs-number">35.41</span> <span class="hljs-string">ns</span>      <span class="hljs-string">â”‚</span> <span class="hljs-number">54.89</span> <span class="hljs-string">ns</span>      <span class="hljs-string">â”‚</span> <span class="hljs-number">37.1</span> <span class="hljs-string">ns</span>       <span class="hljs-string">â”‚</span> <span class="hljs-number">37.61</span> <span class="hljs-string">ns</span>      <span class="hljs-string">â”‚</span> <span class="hljs-number">100</span>     <span class="hljs-string">â”‚</span> <span class="hljs-number">6400</span>
</code></pre>
<p>hard code ç‰ˆæœ¬èƒ½å¸¦æ¥çº¦ 10 å€çš„æ”¶ç›Šã€‚</p>
<h2 data-id="heading-5">ASM åˆ†æï¼šç¡¬ä»¶è§†è§’çš„å·®å¼‚</h2>
<p>å€ŸåŠ© <code>cargo asm -p databend-common-ast --lib databend_common_ast::parser::expr::json_op</code>ï¼Œæˆ‘ä»¬å¯¹æ¯”äº†ä¸¤ç§å®ç°çš„æ±‡ç¼–ï¼š</p>








































<table><thead><tr><th align="left">å¯¹æ¯”ç‚¹</th><th align="left">alt + value + rule!</th><th align="left">hard code</th></tr></thead><tbody><tr><td align="left">æ ˆå†…å­˜ä½¿ç”¨é‡</td><td align="left"><code>sub rsp, 288</code>ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½è¦åˆ†é… 288 å­—èŠ‚</td><td align="left">å‡ ä¹æ— æ˜¾å¼æ ˆåˆ†é…</td></tr><tr><td align="left">åˆå§‹åŒ–é€»è¾‘</td><td align="left">è¿è¡Œæ—¶é€é¡¹æ„é€ æ•°ç»„ï¼ˆå­—ç¬¦ä¸²æŒ‡é’ˆã€é•¿åº¦ã€æ ‡å¿—ä½ï¼‰</td><td align="left">ç›´æ¥è·³è½¬é™æ€è¡¨æˆ–ç¼–è¯‘æœŸå¸¸é‡</td></tr><tr><td align="left">å¯„å­˜å™¨æ“ä½œ</td><td align="left">å¤§é‡ <code>mov</code>ã€<code>lea</code>ï¼Œè¯´æ˜åœ¨æ„å»ºä¸´æ—¶æ•°æ®</td><td align="left">å°‘é‡è·³è¡¨ä¸åˆ†æ”¯ï¼Œè·¯å¾„çŸ­</td></tr><tr><td align="left">å‡½æ•°è°ƒç”¨</td><td align="left">è°ƒ <code>&lt;Alt&gt;::choice</code>ï¼Œå‚æ•°æ¥è‡ªåˆšæ„é€ çš„æ•°ç»„</td><td align="left">è°ƒåŒä¸€å‡½æ•°ï¼Œä½†å‚æ•°æ˜¯é™æ€å¸¸é‡</td></tr><tr><td align="left">ä»£ç é•¿åº¦</td><td align="left">å¾ˆé•¿ã€å±•å¼€æ˜æ˜¾</td><td align="left">ç²¾ç®€ï¼Œä¾¿äº CPU é¢„æµ‹/ç¼“å­˜</td></tr><tr><td align="left">æ€§èƒ½ç»“è®º</td><td align="left">æ¯æ¬¡è§£æéƒ½é‡å¤æ„é€ æ•°æ®ï¼Œååé‡ä½</td><td align="left">çº¯åˆ†æ”¯åˆ¤æ–­ï¼Œå¸¸é‡æŠ˜å ï¼Œæ€§èƒ½ç¨³å®š</td></tr></tbody></table>
<details>
<summary>æŸ¥çœ‹å®Œæ•´ hard code asm</summary>
<pre><code class="hljs language-asm" lang="asm">
.section .text.databend_common_ast::parser::expr::json_op,"ax",@progbits
        .globl  databend_common_ast::parser::expr::json_op
.type   databend_common_ast::parser::expr::json_op,@function
databend_common_ast::parser::expr::json_op:
        .cfi_startproc
        push r14
        .cfi_def_cfa_offset 16
        push rbx
        .cfi_def_cfa_offset 24
        sub rsp, 88
        .cfi_def_cfa_offset 112
        .cfi_offset rbx, -24
        .cfi_offset r14, -16
        mov rbx, rdi
        mov rax, qword ptr [rsi + 8]
        test rax, rax
        je .LBB5402_3
        mov rcx, qword ptr [rsi]
        movzx edx, word ptr [rcx + 24]
        add edx, -47
        cmp edx, 26
        ja .LBB5402_3
        lea rdi, [rip + .LJTI5402_0]
        movsxd rdx, dword ptr [rdi + 4*rdx]
        add rdx, rdi
        jmp rdx
        dec rax
        add rcx, 32
        movzx edx, word ptr [rsi + 24]
        mov rsi, qword ptr [rsi + 16]
        mov qword ptr [rbx + 8], rcx
        mov qword ptr [rbx + 16], rax
        mov qword ptr [rbx + 24], rsi
        mov word ptr [rbx + 32], dx
        mov byte ptr [rbx + 40], 0
        jmp .LBB5402_16
        dec rax
        add rcx, 32
        movzx edx, word ptr [rsi + 24]
        mov rsi, qword ptr [rsi + 16]
        mov qword ptr [rbx + 8], rcx
        mov qword ptr [rbx + 16], rax
        mov qword ptr [rbx + 24], rsi
        mov word ptr [rbx + 32], dx
        mov byte ptr [rbx + 40], 10
        jmp .LBB5402_16
        dec rax
        add rcx, 32
        movzx edx, word ptr [rsi + 24]
        mov rsi, qword ptr [rsi + 16]
        mov qword ptr [rbx + 8], rcx
        mov qword ptr [rbx + 16], rax
        mov qword ptr [rbx + 24], rsi
        mov word ptr [rbx + 32], dx
        mov byte ptr [rbx + 40], 2
        jmp .LBB5402_16
        dec rax
        add rcx, 32
        movzx edx, word ptr [rsi + 24]
        mov rsi, qword ptr [rsi + 16]
        mov qword ptr [rbx + 8], rcx
        mov qword ptr [rbx + 16], rax
        mov qword ptr [rbx + 24], rsi
        mov word ptr [rbx + 32], dx
        mov byte ptr [rbx + 40], 5
        jmp .LBB5402_16
        dec rax
        add rcx, 32
        movzx edx, word ptr [rsi + 24]
        mov rsi, qword ptr [rsi + 16]
        mov qword ptr [rbx + 8], rcx
        mov qword ptr [rbx + 16], rax
        mov qword ptr [rbx + 24], rsi
        mov word ptr [rbx + 32], dx
        mov byte ptr [rbx + 40], 11
        jmp .LBB5402_16
        dec rax
        add rcx, 32
        movzx edx, word ptr [rsi + 24]
        mov rsi, qword ptr [rsi + 16]
        mov qword ptr [rbx + 8], rcx
        mov qword ptr [rbx + 16], rax
        mov qword ptr [rbx + 24], rsi
        mov word ptr [rbx + 32], dx
        mov byte ptr [rbx + 40], 1
        jmp .LBB5402_16
        dec rax
        add rcx, 32
        movzx edx, word ptr [rsi + 24]
        mov rsi, qword ptr [rsi + 16]
        mov qword ptr [rbx + 8], rcx
        mov qword ptr [rbx + 16], rax
        mov qword ptr [rbx + 24], rsi
        mov word ptr [rbx + 32], dx
        mov byte ptr [rbx + 40], 6
        jmp .LBB5402_16
        dec rax
        add rcx, 32
        movzx edx, word ptr [rsi + 24]
        mov rsi, qword ptr [rsi + 16]
        mov qword ptr [rbx + 8], rcx
        mov qword ptr [rbx + 16], rax
        mov qword ptr [rbx + 24], rsi
        mov word ptr [rbx + 32], dx
        mov byte ptr [rbx + 40], 8
        jmp .LBB5402_16
        dec rax
        add rcx, 32
        movzx edx, word ptr [rsi + 24]
        mov rsi, qword ptr [rsi + 16]
        mov qword ptr [rbx + 8], rcx
        mov qword ptr [rbx + 16], rax
        mov qword ptr [rbx + 24], rsi
        mov word ptr [rbx + 32], dx
        mov byte ptr [rbx + 40], 3
        jmp .LBB5402_16
        dec rax
        add rcx, 32
        movzx edx, word ptr [rsi + 24]
        mov rsi, qword ptr [rsi + 16]
        mov qword ptr [rbx + 8], rcx
        mov qword ptr [rbx + 16], rax
        mov qword ptr [rbx + 24], rsi
        mov word ptr [rbx + 32], dx
        mov byte ptr [rbx + 40], 4
        jmp .LBB5402_16
        dec rax
        add rcx, 32
        movzx edx, word ptr [rsi + 24]
        mov rsi, qword ptr [rsi + 16]
        mov qword ptr [rbx + 8], rcx
        mov qword ptr [rbx + 16], rax
        mov qword ptr [rbx + 24], rsi
        mov word ptr [rbx + 32], dx
        mov byte ptr [rbx + 40], 9
        jmp .LBB5402_16
        dec rax
        add rcx, 32
        movzx edx, word ptr [rsi + 24]
        mov rsi, qword ptr [rsi + 16]
        mov qword ptr [rbx + 8], rcx
        mov qword ptr [rbx + 16], rax
        mov qword ptr [rbx + 24], rsi
        mov word ptr [rbx + 32], dx
        mov byte ptr [rbx + 40], 7
.LBB5402_16:
        mov qword ptr [rbx], 3
.LBB5402_17:
        mov rax, rbx
        add rsp, 88
        .cfi_def_cfa_offset 24
        pop rbx
        .cfi_def_cfa_offset 16
        pop r14
        .cfi_def_cfa_offset 8
        ret
</code></pre>
</details>
<details>
<summary>æŸ¥çœ‹å®Œæ•´ alt + value + rule! asm</summary>
<pre><code class="hljs language-asm" lang="asm">
.section .text.databend_common_ast::parser::expr::json_op,"ax",@progbits
        .globl  databend_common_ast::parser::expr::json_op
.type   databend_common_ast::parser::expr::json_op,@function
databend_common_ast::parser::expr::json_op:
        .cfi_startproc
        push rbx
        .cfi_def_cfa_offset 16
        sub rsp, 288
        .cfi_def_cfa_offset 304
        .cfi_offset rbx, -16
        mov rdx, rsi
        mov rbx, rdi
        lea rax, [rip + .Lanon.ebe4306c54ac692c121f4b459a487d88.465]
        mov rsi, rsp
        mov qword ptr [rsi], rax
        mov eax, 2
        mov qword ptr [rsi + 8], rax
        mov byte ptr [rsi + 16], 0
        lea rcx, [rip + .Lanon.ebe4306c54ac692c121f4b459a487d88.466]
        mov qword ptr [rsi + 24], rcx
        mov ecx, 3
        mov qword ptr [rsi + 32], rcx
        mov byte ptr [rsi + 40], 1
        lea rdi, [rip + .Lanon.ebe4306c54ac692c121f4b459a487d88.467]
        mov qword ptr [rsi + 48], rdi
        mov qword ptr [rsi + 56], rax
        mov byte ptr [rsi + 64], 2
        lea rdi, [rip + .Lanon.ebe4306c54ac692c121f4b459a487d88.468]
        mov qword ptr [rsi + 72], rdi
        mov qword ptr [rsi + 80], rcx
        mov byte ptr [rsi + 88], 3
        lea rcx, [rip + .Lanon.ebe4306c54ac692c121f4b459a487d88.469]
        mov qword ptr [rsi + 96], rcx
        mov qword ptr [rsi + 104], 1
        mov byte ptr [rsi + 112], 4
        lea rcx, [rip + .Lanon.ebe4306c54ac692c121f4b459a487d88.471]
        mov qword ptr [rsi + 120], rcx
        mov qword ptr [rsi + 128], rax
        mov byte ptr [rsi + 136], 5
        lea rcx, [rip + .Lanon.ebe4306c54ac692c121f4b459a487d88.472]
        mov qword ptr [rsi + 144], rcx
        mov qword ptr [rsi + 152], rax
        mov byte ptr [rsi + 160], 6
        lea rcx, [rip + .Lanon.ebe4306c54ac692c121f4b459a487d88.473]
        mov qword ptr [rsi + 168], rcx
        mov qword ptr [rsi + 176], rax
        mov byte ptr [rsi + 184], 7
        lea rcx, [rip + .Lanon.ebe4306c54ac692c121f4b459a487d88.474]
        mov qword ptr [rsi + 192], rcx
        mov qword ptr [rsi + 200], rax
        mov byte ptr [rsi + 208], 8
        lea rcx, [rip + .Lanon.ebe4306c54ac692c121f4b459a487d88.475]
        mov qword ptr [rsi + 216], rcx
        mov qword ptr [rsi + 224], rax
        mov byte ptr [rsi + 232], 9
        lea rcx, [rip + .Lanon.ebe4306c54ac692c121f4b459a487d88.476]
        mov qword ptr [rsi + 240], rcx
        mov qword ptr [rsi + 248], rax
        mov byte ptr [rsi + 256], 10
        lea rcx, [rip + .Lanon.ebe4306c54ac692c121f4b459a487d88.477]
        mov qword ptr [rsi + 264], rcx
        mov qword ptr [rsi + 272], rax
        mov byte ptr [rsi + 280], 11
        mov rdi, rbx
        call qword ptr [rip + &lt;(A,B,C,D,E,F,G,H,I,J,K,L) as nom::branch::Alt&gt;::choice@GOTPCREL]
        mov rax, rbx
        add rsp, 288
        .cfi_def_cfa_offset 16
        pop rbx
        .cfi_def_cfa_offset 8
        ret
</code></pre>
</details>
<h2 data-id="heading-6">ç»éªŒæ€»ç»“</h2>
<ul>
<li>åˆå¹¶ç»“æ„ç›¸ä¼¼çš„ parserï¼Œé¿å…æ·±åº¦ä¼˜å…ˆ + å›æº¯å¯¼è‡´çš„æŒ‡æ•°çº§çˆ†ç‚¸ã€‚</li>
<li>é«˜é¢‘ã€ç®€å• token çš„è§£æç›´æ¥ hard codeï¼Œçœæ‰é—­åŒ…ã€é”™è¯¯åŒ…è£…ç­‰é¢å¤–æˆæœ¬ã€‚</li>
<li>åŠæ—¶æŸ¥çœ‹ç«ç„°å›¾ï¼Œèƒ½å‘ç°å¼‚å¸¸æ·±çš„è§£ææ ˆã€‚</li>
<li>å¿…è¦æ—¶å¯¹çƒ­ç‚¹è·¯å¾„åšæ±‡ç¼–çº§åˆ†æï¼Œæ›´å®¹æ˜“éªŒè¯ä¼˜åŒ–æ–¹å‘ã€‚</li>
</ul>
<p>è¿™ä¸¤é¡¹ä¼˜åŒ–è½åœ°åï¼ŒDatabend çš„å‡½æ•°è°ƒç”¨è§£æä»åˆ†é’Ÿçº§é™åˆ°æ¯«ç§’çº§ï¼Œè¡¨è¾¾å¼è§£æä¹Ÿè·å¾—äº†é‡çº§ä¸Šçš„æ€§èƒ½æå‡ã€‚</p>
<h2 data-id="heading-7">å…³äº Databend</h2>
<p>Databend æ˜¯ä¸€æ¬¾å¼€æºã€å¼¹æ€§ã€ä½æˆæœ¬ï¼ŒåŸºäºå¯¹è±¡å­˜å‚¨ä¹Ÿå¯ä»¥åšå®æ—¶åˆ†æçš„æ–°å¼æ¹–ä»“ã€‚æœŸå¾…æ‚¨çš„å…³æ³¨ï¼Œä¸€èµ·æ¢ç´¢äº‘åŸç”Ÿæ•°ä»“è§£å†³æ–¹æ¡ˆï¼Œæ‰“é€ æ–°ä¸€ä»£å¼€æº Data Cloudã€‚</p>
<p>ğŸ‘¨â€ğŸ’»â€ Databend Cloudï¼š<a href="https://link.juejin.cn/?target=https%3A%2F%2Fdatabend.cn%2F" title="https://link.juejin.cn/?target=https%3A%2F%2Fdatabend.cn%2F" target="_blank">databend.cn</a></p>
<p>ğŸ“– Databend æ–‡æ¡£ï¼š<a href="https://link.juejin.cn/?target=https%3A%2F%2Fdocs.databend.cn%2F" title="https://link.juejin.cn/?target=https%3A%2F%2Fdocs.databend.cn%2F" target="_blank">docs.databend.cn</a></p>
<p>ğŸ’» Wechatï¼šDatabend</p>
<p>âœ¨ GitHubï¼š<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fdatabendlabs%2Fdatabend" title="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fdatabendlabs%2Fdatabend" target="_blank">github.com/databendlabâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Laravel 11ä¸UniAppå®æˆ˜ï¼šæ„å»ºé«˜æ€§èƒ½ç”µå•†APIä¸ç§»åŠ¨ç«¯äº¤äº’ç³»ç»Ÿ]]></title>    <link>https://juejin.cn/post/7572459757107085366</link>    <guid>https://juejin.cn/post/7572459757107085366</guid>    <pubDate>2025-11-15T10:00:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572459757107085366" data-draft-id="7572465262739128339" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Laravel 11ä¸UniAppå®æˆ˜ï¼šæ„å»ºé«˜æ€§èƒ½ç”µå•†APIä¸ç§»åŠ¨ç«¯äº¤äº’ç³»ç»Ÿ"/> <meta itemprop="keywords" content="Laravel"/> <meta itemprop="datePublished" content="2025-11-15T10:00:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JienDa"/> <meta itemprop="url" content="https://juejin.cn/user/2930617309202010"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Laravel 11ä¸UniAppå®æˆ˜ï¼šæ„å»ºé«˜æ€§èƒ½ç”µå•†APIä¸ç§»åŠ¨ç«¯äº¤äº’ç³»ç»Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2930617309202010/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JienDa
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T10:00:25.000Z" title="Sat Nov 15 2025 10:00:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Laravel 11ä¸UniAppå®æˆ˜ï¼šæ„å»ºé«˜æ€§èƒ½ç”µå•†APIä¸ç§»åŠ¨ç«¯äº¤äº’ç³»ç»Ÿ</h2>
<h3 data-id="heading-1">ä¸€ã€åœºæ™¯èƒŒæ™¯ä¸å¸‚åœºåˆ†æ</h3>
<h4 data-id="heading-2">1.1 ç§»åŠ¨ç”µå•†å‘å±•è¶‹åŠ¿</h4>
<p>2025å¹´ï¼Œç§»åŠ¨äº’è”ç½‘å·²è¿›å…¥æ·±åº¦å‘å±•é˜¶æ®µï¼Œç§»åŠ¨ç«¯è´­ç‰©å·²æˆä¸ºä¸»æµæ¶ˆè´¹æ–¹å¼ã€‚æ ¹æ®å¸‚åœºè°ƒç ”æ•°æ®ï¼Œä¸­å›½ç§»åŠ¨ç”µå•†å¸‚åœºè§„æ¨¡é¢„è®¡å°†è¾¾åˆ°<strong>XXä¸‡äº¿å…ƒ</strong>ï¼Œç§»åŠ¨ç«¯äº¤æ˜“å æ¯”è¶…è¿‡<strong>85%</strong> ã€‚åœ¨è¿™æ ·çš„å¸‚åœºç¯å¢ƒä¸‹ï¼Œä¼ä¸šéœ€è¦å¿«é€Ÿæ­å»ºæ—¢èƒ½æ»¡è¶³åç«¯ç®¡ç†éœ€æ±‚ï¼Œåˆèƒ½æä¾›ä¼˜è´¨ç§»åŠ¨ç«¯ç”¨æˆ·ä½“éªŒçš„ç”µå•†ç³»ç»Ÿã€‚</p>
<h4 data-id="heading-3">1.2 æŠ€æœ¯é€‰å‹ä¼˜åŠ¿</h4>
<p><strong>Laravel 11</strong>ä½œä¸ºPHPç”Ÿæ€ä¸­æœ€å—æ¬¢è¿çš„ç°ä»£åŒ–æ¡†æ¶ï¼Œåœ¨2025å¹´æŒç»­ä¿æŒé¢†å…ˆåœ°ä½ã€‚å…¶æœ€æ–°ç‰ˆæœ¬åŸºäºPHP 8.2+é‡æ„ï¼Œåœ¨æ€§èƒ½ã€å®‰å…¨æ€§ã€å¼€å‘æ•ˆç‡ç­‰æ–¹é¢éƒ½æœ‰æ˜¾è‘—æå‡ã€‚Laravel 11å¼•å…¥äº†æç®€åº”ç”¨ç»“æ„ã€æ”¹è¿›çš„HTTPå®¢æˆ·ç«¯ã€ä¼˜åŒ–æŸ¥è¯¢ç”Ÿæˆå™¨ç­‰æ–°ç‰¹æ€§ï¼Œç‰¹åˆ«é€‚åˆæ„å»ºé«˜æ€§èƒ½APIæœåŠ¡ã€‚</p>
<p><strong>UniApp</strong>ä½œä¸ºè·¨å¹³å°å¼€å‘æ¡†æ¶ï¼Œæ”¯æŒä¸€å¥—ä»£ç ç¼–è¯‘åˆ°iOSã€Androidã€H5ç­‰å¤šä¸ªå¹³å°ï¼Œæå¤§é™ä½äº†ç§»åŠ¨ç«¯å¼€å‘æˆæœ¬ã€‚ç»“åˆLaravel 11æ„å»ºçš„RESTful APIï¼Œå¯ä»¥å®ç°å‰åç«¯å®Œå…¨åˆ†ç¦»ï¼Œæå‡å¼€å‘æ•ˆç‡å’Œç³»ç»Ÿå¯ç»´æŠ¤æ€§ã€‚</p>
<h3 data-id="heading-4">äºŒã€ç³»ç»Ÿæ¶æ„è®¾è®¡</h3>
<h4 data-id="heading-5">2.1 æ•´ä½“æ¶æ„</h4>
<p>åŸºäºLaravel 11å’ŒUniAppçš„ç”µå•†ç³»ç»Ÿé‡‡ç”¨<strong>å‰åç«¯åˆ†ç¦»æ¶æ„</strong>ï¼Œå°†ç³»ç»Ÿåˆ’åˆ†ä¸ºä»¥ä¸‹å±‚æ¬¡ï¼š</p>
<ul>
<li>
<p>â€¢
<strong>åç«¯APIå±‚</strong>ï¼šLaravel 11æ„å»ºçš„RESTful APIæœåŠ¡ï¼Œæä¾›ç”¨æˆ·è®¤è¯ã€å•†å“ç®¡ç†ã€è®¢å•å¤„ç†ç­‰æ ¸å¿ƒåŠŸèƒ½</p>
</li>
<li>
<p>â€¢
<strong>å‰ç«¯åº”ç”¨å±‚</strong>ï¼šUniAppæ„å»ºçš„è·¨å¹³å°ç§»åŠ¨åº”ç”¨ï¼Œè´Ÿè´£ç”¨æˆ·ç•Œé¢å±•ç¤ºå’Œäº¤äº’</p>
</li>
<li>
<p>â€¢
<strong>æ•°æ®å­˜å‚¨å±‚</strong>ï¼šMySQLæ•°æ®åº“å­˜å‚¨ä¸šåŠ¡æ•°æ®ï¼ŒRedisç”¨äºç¼“å­˜å’Œä¼šè¯ç®¡ç†</p>
</li>
<li>
<p>â€¢
<strong>ç¬¬ä¸‰æ–¹æœåŠ¡</strong>ï¼šæ”¯ä»˜ç½‘å…³ã€çŸ­ä¿¡æœåŠ¡ã€ç‰©æµæŸ¥è¯¢ç­‰ç¬¬ä¸‰æ–¹APIé›†æˆ</p>
</li>
</ul>
<h4 data-id="heading-6">2.2 æŠ€æœ¯æ ˆé€‰å‹</h4>








































<table><thead><tr><th>å±‚æ¬¡</th><th>æŠ€æœ¯é€‰å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>åç«¯æ¡†æ¶</td><td>Laravel 11</td><td>ç°ä»£åŒ–PHPæ¡†æ¶ï¼Œæä¾›ä¼˜é›…çš„APIå¼€å‘ä½“éªŒ</td></tr><tr><td>å‰ç«¯æ¡†æ¶</td><td>UniApp + Vue.js</td><td>è·¨å¹³å°å¼€å‘ï¼Œä¸€å¥—ä»£ç å¤šç«¯è¿è¡Œ</td></tr><tr><td>æ•°æ®åº“</td><td>MySQL 8.0+</td><td>å…³ç³»å‹æ•°æ®åº“ï¼Œæ”¯æŒäº‹åŠ¡å’Œå¤æ‚æŸ¥è¯¢</td></tr><tr><td>ç¼“å­˜</td><td>Redis</td><td>å†…å­˜æ•°æ®åº“ï¼Œç”¨äºç¼“å­˜å’Œä¼šè¯ç®¡ç†</td></tr><tr><td>è®¤è¯æ–¹å¼</td><td>JWT Token</td><td>æ— çŠ¶æ€è®¤è¯ï¼Œé€‚åˆAPIåœºæ™¯</td></tr><tr><td>éƒ¨ç½²ç¯å¢ƒ</td><td>Docker + Nginx</td><td>å®¹å™¨åŒ–éƒ¨ç½²ï¼Œä¾¿äºæ‰©å±•å’Œç»´æŠ¤</td></tr></tbody></table>
<h3 data-id="heading-7">ä¸‰ã€æ ¸å¿ƒæ¨¡å—è®¾è®¡ä¸å®ç°</h3>
<h4 data-id="heading-8">3.1 ç”¨æˆ·è®¤è¯æ¨¡å—</h4>
<p>Laravel 11æä¾›äº†å®Œå–„çš„è®¤è¯ç³»ç»Ÿï¼Œç»“åˆJWT Tokenå®ç°æ— çŠ¶æ€è®¤è¯ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// å®‰è£…JWTè®¤è¯åŒ…</span>
composer <span class="hljs-keyword">require</span> tymon/jwt-auth

<span class="hljs-comment">// é…ç½®JWTå¯†é’¥</span>
php artisan jwt:secret

<span class="hljs-comment">// ç”¨æˆ·æ¨¡å‹é…ç½®</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title class_">App</span>\<span class="hljs-title class_">Models</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Foundation</span>\<span class="hljs-title">Auth</span>\<span class="hljs-title">User</span> <span class="hljs-keyword">as</span> <span class="hljs-title">Authenticatable</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Tymon</span>\<span class="hljs-title">JWTAuth</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">JWTSubject</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Authenticatable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">JWTSubject</span>
</span>{
    <span class="hljs-comment">// è·å–JWTæ ‡è¯†</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getJWTIdentifier</span>(<span class="hljs-params"/>)
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getKey</span>();
    }

    <span class="hljs-comment">// è‡ªå®šä¹‰JWTå£°æ˜</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getJWTCustomClaims</span>(<span class="hljs-params"/>)
    </span>{
        <span class="hljs-keyword">return</span> [];
    }
}
</code></pre>
<p><strong>ç™»å½•æ¥å£å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">App</span>\<span class="hljs-title class_">Http</span>\<span class="hljs-title class_">Controllers</span>\<span class="hljs-title class_">Api</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Models</span>\<span class="hljs-title">User</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Request</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">Hash</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Tymon</span>\<span class="hljs-title">JWTAuth</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">JWTAuth</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AuthController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>)
    </span>{
        <span class="hljs-variable">$credentials</span> = <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">only</span>(<span class="hljs-string">'email'</span>, <span class="hljs-string">'password'</span>);
        
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$token</span> = <span class="hljs-title class_">JWTAuth</span>::<span class="hljs-title function_ invoke__">attempt</span>(<span class="hljs-variable">$credentials</span>)) {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">response</span>()-&gt;<span class="hljs-title function_ invoke__">json</span>([<span class="hljs-string">'error'</span> =&gt; <span class="hljs-string">'Unauthorized'</span>], <span class="hljs-number">401</span>);
        }

        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">response</span>()-&gt;<span class="hljs-title function_ invoke__">json</span>([
            <span class="hljs-string">'access_token'</span> =&gt; <span class="hljs-variable">$token</span>,
            <span class="hljs-string">'token_type'</span> =&gt; <span class="hljs-string">'bearer'</span>,
            <span class="hljs-string">'expires_in'</span> =&gt; <span class="hljs-title function_ invoke__">config</span>(<span class="hljs-string">'jwt.ttl'</span>) * <span class="hljs-number">60</span>
        ]);
    }
}
</code></pre>
<h4 data-id="heading-9">3.2 å•†å“ç®¡ç†æ¨¡å—</h4>
<p>å•†å“æ¨¡å—æ˜¯ç”µå•†ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œéœ€è¦å¤„ç†å•†å“åˆ†ç±»ã€SKUç®¡ç†ã€åº“å­˜æ§åˆ¶ç­‰å¤æ‚ä¸šåŠ¡ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">App</span>\<span class="hljs-title class_">Http</span>\<span class="hljs-title class_">Controllers</span>\<span class="hljs-title class_">Api</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Models</span>\<span class="hljs-title">Product</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Resources</span>\<span class="hljs-title">ProductResource</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Request</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProductController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-comment">// å•†å“åˆ—è¡¨æ¥å£</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>)
    </span>{
        <span class="hljs-variable">$query</span> = <span class="hljs-title class_">Product</span>::<span class="hljs-title function_ invoke__">with</span>([<span class="hljs-string">'category'</span>, <span class="hljs-string">'skus'</span>])
            -&gt;<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-string">'status'</span>, <span class="hljs-number">1</span>);

        <span class="hljs-comment">// åˆ†ç±»ç­›é€‰</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">has</span>(<span class="hljs-string">'category_id'</span>)) {
            <span class="hljs-variable">$query</span>-&gt;<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-string">'category_id'</span>, <span class="hljs-variable">$request</span>-&gt;category_id);
        }

        <span class="hljs-comment">// å…³é”®è¯æœç´¢</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">has</span>(<span class="hljs-string">'keyword'</span>)) {
            <span class="hljs-variable">$query</span>-&gt;<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-string">'name'</span>, <span class="hljs-string">'like'</span>, <span class="hljs-string">"%<span class="hljs-subst">{$request-&gt;keyword}</span>%"</span>);
        }

        <span class="hljs-comment">// ä»·æ ¼æ’åº</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">has</span>(<span class="hljs-string">'sort'</span>)) {
            <span class="hljs-variable">$query</span>-&gt;<span class="hljs-title function_ invoke__">orderBy</span>(<span class="hljs-string">'price'</span>, <span class="hljs-variable">$request</span>-&gt;sort);
        }

        <span class="hljs-variable">$products</span> = <span class="hljs-variable">$query</span>-&gt;<span class="hljs-title function_ invoke__">paginate</span>(<span class="hljs-number">20</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-title class_">ProductResource</span>::<span class="hljs-title function_ invoke__">collection</span>(<span class="hljs-variable">$products</span>);
    }

    <span class="hljs-comment">// å•†å“è¯¦æƒ…æ¥å£</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span>(<span class="hljs-params"><span class="hljs-variable">$id</span></span>)
    </span>{
        <span class="hljs-variable">$product</span> = <span class="hljs-title class_">Product</span>::<span class="hljs-title function_ invoke__">with</span>([<span class="hljs-string">'category'</span>, <span class="hljs-string">'skus'</span>, <span class="hljs-string">'attributes'</span>])
            -&gt;<span class="hljs-title function_ invoke__">findOrFail</span>(<span class="hljs-variable">$id</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductResource</span>(<span class="hljs-variable">$product</span>);
    }
}
</code></pre>
<p><strong>APIèµ„æºæ ¼å¼åŒ–</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">namespace App\Http\Resources;

use Illuminate\Http\Resources\Json\JsonResource;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductResource</span> <span class="hljs-title">extends</span> <span class="hljs-title">JsonResource</span>
{
    <span class="hljs-keyword">public</span> function toArray($request)
    {
        <span class="hljs-keyword">return</span> [
            <span class="hljs-string">'id'</span> =&gt; $<span class="hljs-keyword">this</span>-&gt;id,
            <span class="hljs-string">'name'</span> =&gt; $<span class="hljs-keyword">this</span>-&gt;name,
            <span class="hljs-string">'price'</span> =&gt; $<span class="hljs-keyword">this</span>-&gt;price,
            <span class="hljs-string">'stock'</span> =&gt; $<span class="hljs-keyword">this</span>-&gt;stock,
            <span class="hljs-string">'images'</span> =&gt; $<span class="hljs-keyword">this</span>-&gt;images,
            <span class="hljs-string">'description'</span> =&gt; $<span class="hljs-keyword">this</span>-&gt;description,
            <span class="hljs-string">'category'</span> =&gt; new CategoryResource($<span class="hljs-keyword">this</span>-&gt;whenLoaded(<span class="hljs-string">'category'</span>)),
            <span class="hljs-string">'skus'</span> =&gt; SkuResource::collection($<span class="hljs-keyword">this</span>-&gt;whenLoaded(<span class="hljs-string">'skus'</span>)),
            <span class="hljs-string">'created_at'</span> =&gt; $<span class="hljs-keyword">this</span>-&gt;created_at-&gt;toDateTimeString(),
            <span class="hljs-string">'updated_at'</span> =&gt; $<span class="hljs-keyword">this</span>-&gt;updated_at-&gt;toDateTimeString(),
        ];
    }
}
</code></pre>
<h4 data-id="heading-10">3.3 è´­ç‰©è½¦æ¨¡å—</h4>
<p>è´­ç‰©è½¦æ¨¡å—éœ€è¦å¤„ç†å•†å“æ·»åŠ ã€æ•°é‡ä¿®æ”¹ã€ä»·æ ¼è®¡ç®—ç­‰ä¸šåŠ¡ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">App</span>\<span class="hljs-title class_">Http</span>\<span class="hljs-title class_">Controllers</span>\<span class="hljs-title class_">Api</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Models</span>\<span class="hljs-title">Cart</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Models</span>\<span class="hljs-title">Product</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Request</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">Auth</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CartController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-comment">// è·å–è´­ç‰©è½¦åˆ—è¡¨</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"/>)
    </span>{
        <span class="hljs-variable">$carts</span> = <span class="hljs-title class_">Cart</span>::<span class="hljs-title function_ invoke__">with</span>(<span class="hljs-string">'product'</span>)
            -&gt;<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-string">'user_id'</span>, <span class="hljs-title class_">Auth</span>::<span class="hljs-title function_ invoke__">id</span>())
            -&gt;<span class="hljs-title function_ invoke__">get</span>();

        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">response</span>()-&gt;<span class="hljs-title function_ invoke__">json</span>([
            <span class="hljs-string">'data'</span> =&gt; <span class="hljs-variable">$carts</span>,
            <span class="hljs-string">'total_amount'</span> =&gt; <span class="hljs-variable">$this</span>-&gt;<span class="hljs-title function_ invoke__">calculateTotalAmount</span>(<span class="hljs-variable">$carts</span>)
        ]);
    }

    <span class="hljs-comment">// æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">store</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>)
    </span>{
        <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">validate</span>([
            <span class="hljs-string">'product_id'</span> =&gt; <span class="hljs-string">'required|exists:products,id'</span>,
            <span class="hljs-string">'quantity'</span> =&gt; <span class="hljs-string">'required|integer|min:1'</span>
        ]);

        <span class="hljs-variable">$product</span> = <span class="hljs-title class_">Product</span>::<span class="hljs-title function_ invoke__">find</span>(<span class="hljs-variable">$request</span>-&gt;product_id);

        <span class="hljs-comment">// æ£€æŸ¥åº“å­˜</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$product</span>-&gt;stock &lt; <span class="hljs-variable">$request</span>-&gt;quantity) {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">response</span>()-&gt;<span class="hljs-title function_ invoke__">json</span>([<span class="hljs-string">'error'</span> =&gt; <span class="hljs-string">'åº“å­˜ä¸è¶³'</span>], <span class="hljs-number">400</span>);
        }

        <span class="hljs-comment">// æ£€æŸ¥è´­ç‰©è½¦æ˜¯å¦å·²å­˜åœ¨è¯¥å•†å“</span>
        <span class="hljs-variable">$cart</span> = <span class="hljs-title class_">Cart</span>::<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-string">'user_id'</span>, <span class="hljs-title class_">Auth</span>::<span class="hljs-title function_ invoke__">id</span>())
            -&gt;<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-string">'product_id'</span>, <span class="hljs-variable">$request</span>-&gt;product_id)
            -&gt;<span class="hljs-title function_ invoke__">first</span>();

        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$cart</span>) {
            <span class="hljs-variable">$cart</span>-&gt;quantity += <span class="hljs-variable">$request</span>-&gt;quantity;
            <span class="hljs-variable">$cart</span>-&gt;<span class="hljs-title function_ invoke__">save</span>();
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-title class_">Cart</span>::<span class="hljs-title function_ invoke__">create</span>([
                <span class="hljs-string">'user_id'</span> =&gt; <span class="hljs-title class_">Auth</span>::<span class="hljs-title function_ invoke__">id</span>(),
                <span class="hljs-string">'product_id'</span> =&gt; <span class="hljs-variable">$request</span>-&gt;product_id,
                <span class="hljs-string">'quantity'</span> =&gt; <span class="hljs-variable">$request</span>-&gt;quantity,
                <span class="hljs-string">'price'</span> =&gt; <span class="hljs-variable">$product</span>-&gt;price
            ]);
        }

        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">response</span>()-&gt;<span class="hljs-title function_ invoke__">json</span>([<span class="hljs-string">'message'</span> =&gt; <span class="hljs-string">'æ·»åŠ æˆåŠŸ'</span>]);
    }

    <span class="hljs-comment">// è®¡ç®—è´­ç‰©è½¦æ€»é‡‘é¢</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">calculateTotalAmount</span>(<span class="hljs-params"><span class="hljs-variable">$carts</span></span>)
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$carts</span>-&gt;<span class="hljs-title function_ invoke__">sum</span>(function (<span class="hljs-variable">$cart</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-variable">$cart</span>-&gt;quantity * <span class="hljs-variable">$cart</span>-&gt;price;
        });
    }
}
</code></pre>
<h4 data-id="heading-11">3.4 è®¢å•æ¨¡å—</h4>
<p>è®¢å•æ¨¡å—æ˜¯ç”µå•†ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œæ¶‰åŠè®¢å•åˆ›å»ºã€æ”¯ä»˜ã€çŠ¶æ€æµè½¬ç­‰å¤æ‚æµç¨‹ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">App</span>\<span class="hljs-title class_">Http</span>\<span class="hljs-title class_">Controllers</span>\<span class="hljs-title class_">Api</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Models</span>\<span class="hljs-title">Order</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Models</span>\<span class="hljs-title">OrderItem</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Models</span>\<span class="hljs-title">Cart</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Models</span>\<span class="hljs-title">Product</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Request</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">DB</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">Auth</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-comment">// åˆ›å»ºè®¢å•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">store</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>)
    </span>{
        DB::<span class="hljs-title function_ invoke__">beginTransaction</span>();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-variable">$carts</span> = <span class="hljs-title class_">Cart</span>::<span class="hljs-title function_ invoke__">with</span>(<span class="hljs-string">'product'</span>)
                -&gt;<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-string">'user_id'</span>, <span class="hljs-title class_">Auth</span>::<span class="hljs-title function_ invoke__">id</span>())
                -&gt;<span class="hljs-title function_ invoke__">get</span>();

            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$carts</span>-&gt;<span class="hljs-title function_ invoke__">isEmpty</span>()) {
                <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">response</span>()-&gt;<span class="hljs-title function_ invoke__">json</span>([<span class="hljs-string">'error'</span> =&gt; <span class="hljs-string">'è´­ç‰©è½¦ä¸ºç©º'</span>], <span class="hljs-number">400</span>);
            }

            <span class="hljs-comment">// è®¡ç®—è®¢å•æ€»é‡‘é¢</span>
            <span class="hljs-variable">$totalAmount</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">calculateTotalAmount</span>(<span class="hljs-variable">$carts</span>);

            <span class="hljs-comment">// åˆ›å»ºè®¢å•</span>
            <span class="hljs-variable">$order</span> = <span class="hljs-title class_">Order</span>::<span class="hljs-title function_ invoke__">create</span>([
                <span class="hljs-string">'user_id'</span> =&gt; <span class="hljs-title class_">Auth</span>::<span class="hljs-title function_ invoke__">id</span>(),
                <span class="hljs-string">'order_no'</span> =&gt; <span class="hljs-variable">$this</span>-&gt;<span class="hljs-title function_ invoke__">generateOrderNo</span>(),
                <span class="hljs-string">'total_amount'</span> =&gt; <span class="hljs-variable">$totalAmount</span>,
                <span class="hljs-string">'status'</span> =&gt; <span class="hljs-title class_">Order</span>::<span class="hljs-variable constant_">STATUS_PENDING</span>,
                <span class="hljs-string">'address'</span> =&gt; <span class="hljs-variable">$request</span>-&gt;address,
                <span class="hljs-string">'consignee'</span> =&gt; <span class="hljs-variable">$request</span>-&gt;consignee,
                <span class="hljs-string">'phone'</span> =&gt; <span class="hljs-variable">$request</span>-&gt;phone
            ]);

            <span class="hljs-comment">// åˆ›å»ºè®¢å•å•†å“</span>
            <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$carts</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$cart</span>) {
                <span class="hljs-title class_">OrderItem</span>::<span class="hljs-title function_ invoke__">create</span>([
                    <span class="hljs-string">'order_id'</span> =&gt; <span class="hljs-variable">$order</span>-&gt;id,
                    <span class="hljs-string">'product_id'</span> =&gt; <span class="hljs-variable">$cart</span>-&gt;product_id,
                    <span class="hljs-string">'product_name'</span> =&gt; <span class="hljs-variable">$cart</span>-&gt;product-&gt;name,
                    <span class="hljs-string">'product_image'</span> =&gt; <span class="hljs-variable">$cart</span>-&gt;product-&gt;image,
                    <span class="hljs-string">'price'</span> =&gt; <span class="hljs-variable">$cart</span>-&gt;price,
                    <span class="hljs-string">'quantity'</span> =&gt; <span class="hljs-variable">$cart</span>-&gt;quantity,
                    <span class="hljs-string">'total_amount'</span> =&gt; <span class="hljs-variable">$cart</span>-&gt;price * <span class="hljs-variable">$cart</span>-&gt;quantity
                ]);

                <span class="hljs-comment">// æ‰£å‡åº“å­˜</span>
                <span class="hljs-variable">$product</span> = <span class="hljs-title class_">Product</span>::<span class="hljs-title function_ invoke__">find</span>(<span class="hljs-variable">$cart</span>-&gt;product_id);
                <span class="hljs-variable">$product</span>-&gt;<span class="hljs-title function_ invoke__">decrement</span>(<span class="hljs-string">'stock'</span>, <span class="hljs-variable">$cart</span>-&gt;quantity);
            }

            <span class="hljs-comment">// æ¸…ç©ºè´­ç‰©è½¦</span>
            <span class="hljs-title class_">Cart</span>::<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-string">'user_id'</span>, <span class="hljs-title class_">Auth</span>::<span class="hljs-title function_ invoke__">id</span>())-&gt;<span class="hljs-title function_ invoke__">delete</span>();

            DB::<span class="hljs-title function_ invoke__">commit</span>();

            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">response</span>()-&gt;<span class="hljs-title function_ invoke__">json</span>([
                <span class="hljs-string">'message'</span> =&gt; <span class="hljs-string">'è®¢å•åˆ›å»ºæˆåŠŸ'</span>,
                <span class="hljs-string">'data'</span> =&gt; <span class="hljs-variable">$order</span>
            ]);

        } <span class="hljs-keyword">catch</span> (\<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) {
            DB::<span class="hljs-title function_ invoke__">rollBack</span>();
            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">response</span>()-&gt;<span class="hljs-title function_ invoke__">json</span>([<span class="hljs-string">'error'</span> =&gt; <span class="hljs-string">'è®¢å•åˆ›å»ºå¤±è´¥'</span>], <span class="hljs-number">500</span>);
        }
    }

    <span class="hljs-comment">// ç”Ÿæˆè®¢å•å·</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generateOrderNo</span>(<span class="hljs-params"/>)
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">'YmdHis'</span>) . <span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">1000</span>, <span class="hljs-number">9999</span>);
    }
}
</code></pre>
<h3 data-id="heading-12">å››ã€æ¥å£è®¾è®¡ä¸è°ƒç”¨</h3>
<h4 data-id="heading-13">4.1 RESTful APIè®¾è®¡è§„èŒƒ</h4>
<p>Laravel 11æä¾›äº†ä¼˜é›…çš„APIå¼€å‘ä½“éªŒï¼Œéµå¾ªRESTfulè®¾è®¡åŸåˆ™ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// routes/api.php</span>
Route::<span class="hljs-title function_ invoke__">prefix</span>(<span class="hljs-symbol">'api</span>')<span class="hljs-punctuation">-&gt;</span><span class="hljs-title function_ invoke__">group</span>(<span class="hljs-title function_ invoke__">function</span> () {
    <span class="hljs-comment">// ç”¨æˆ·è®¤è¯</span>
    Route::<span class="hljs-title function_ invoke__">post</span>(<span class="hljs-symbol">'login</span>', [AuthController::class, <span class="hljs-symbol">'login</span>']);
    Route::<span class="hljs-title function_ invoke__">post</span>(<span class="hljs-symbol">'register</span>', [AuthController::class, <span class="hljs-symbol">'register</span>']);
    
    <span class="hljs-comment">// éœ€è¦è®¤è¯çš„è·¯ç”±</span>
    Route::<span class="hljs-title function_ invoke__">middleware</span>(<span class="hljs-symbol">'auth</span>:api')<span class="hljs-punctuation">-&gt;</span><span class="hljs-title function_ invoke__">group</span>(<span class="hljs-title function_ invoke__">function</span> () {
        Route::<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-symbol">'user</span>', [UserController::class, <span class="hljs-symbol">'info</span>']);
        Route::<span class="hljs-title function_ invoke__">put</span>(<span class="hljs-symbol">'user</span>', [UserController::class, <span class="hljs-symbol">'update</span>']);
        
        <span class="hljs-comment">// å•†å“ç›¸å…³</span>
        Route::<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-symbol">'products</span>', [ProductController::class, <span class="hljs-symbol">'index</span>']);
        Route::<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-symbol">'products</span>/{id}', [ProductController::class, <span class="hljs-symbol">'show</span>']);
        
        <span class="hljs-comment">// è´­ç‰©è½¦</span>
        Route::<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-symbol">'cart</span>', [CartController::class, <span class="hljs-symbol">'index</span>']);
        Route::<span class="hljs-title function_ invoke__">post</span>(<span class="hljs-symbol">'cart</span>', [CartController::class, <span class="hljs-symbol">'store</span>']);
        Route::<span class="hljs-title function_ invoke__">put</span>(<span class="hljs-symbol">'cart</span>/{id}', [CartController::class, <span class="hljs-symbol">'update</span>']);
        Route::<span class="hljs-title function_ invoke__">delete</span>(<span class="hljs-symbol">'cart</span>/{id}', [CartController::class, <span class="hljs-symbol">'destroy</span>']);
        
        <span class="hljs-comment">// è®¢å•</span>
        Route::<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-symbol">'orders</span>', [OrderController::class, <span class="hljs-symbol">'index</span>']);
        Route::<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-symbol">'orders</span>/{id}', [OrderController::class, <span class="hljs-symbol">'show</span>']);
        Route::<span class="hljs-title function_ invoke__">post</span>(<span class="hljs-symbol">'orders</span>', [OrderController::class, <span class="hljs-symbol">'store</span>']);
        Route::<span class="hljs-title function_ invoke__">post</span>(<span class="hljs-symbol">'orders</span>/{id}/pay', [OrderController::class, <span class="hljs-symbol">'pay</span>']);
    });
});
</code></pre>
<h4 data-id="heading-14">4.2 æ¥å£è®¤è¯ä¸æˆæƒ</h4>
<p>Laravel 11çš„JWTè®¤è¯ä¸­é—´ä»¶é…ç½®ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// app/Http/Kernel.php</span>
<span class="hljs-keyword">protected</span> <span class="hljs-variable">$routeMiddleware</span> = [
    <span class="hljs-string">'auth'</span> =&gt; <span class="hljs-title class_">\App\Http\Middleware\Authenticate</span>::<span class="hljs-variable language_">class</span>,
    <span class="hljs-string">'auth.basic'</span> =&gt; <span class="hljs-title class_">\Illuminate\Auth\Middleware\AuthenticateWithBasicAuth</span>::<span class="hljs-variable language_">class</span>,
    <span class="hljs-string">'auth.api'</span> =&gt; <span class="hljs-title class_">\Tymon\JWTAuth\Http\Middleware\Authenticate</span>::<span class="hljs-variable language_">class</span>,
    <span class="hljs-string">'bindings'</span> =&gt; <span class="hljs-title class_">\Illuminate\Routing\Middleware\SubstituteBindings</span>::<span class="hljs-variable language_">class</span>,
    <span class="hljs-string">'can'</span> =&gt; <span class="hljs-title class_">\Illuminate\Auth\Middleware\AuthorizeGate</span>::<span class="hljs-variable language_">class</span>,
    <span class="hljs-string">'guest'</span> =&gt; <span class="hljs-title class_">\Illuminate\Auth\Middleware\RedirectIfAuthenticated</span>::<span class="hljs-variable language_">class</span>,
    <span class="hljs-string">'throttle'</span> =&gt; <span class="hljs-title class_">\Illuminate\Routing\Middleware\ThrottleRequests</span>::<span class="hljs-variable language_">class</span>,
];
</code></pre>
<h4 data-id="heading-15">4.3 æ•°æ®éªŒè¯ä¸é”™è¯¯å¤„ç†</h4>
<p>Laravel 11æä¾›äº†å¼ºå¤§çš„è¡¨å•è¯·æ±‚éªŒè¯ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">App</span>\<span class="hljs-title class_">Http</span>\<span class="hljs-title class_">Requests</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Foundation</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">FormRequest</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreateOrderRequest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">FormRequest</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authorize</span>(<span class="hljs-params"/>)
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rules</span>(<span class="hljs-params"/>)
    </span>{
        <span class="hljs-keyword">return</span> [
            <span class="hljs-string">'address'</span> =&gt; <span class="hljs-string">'required|string|max:255'</span>,
            <span class="hljs-string">'consignee'</span> =&gt; <span class="hljs-string">'required|string|max:50'</span>,
            <span class="hljs-string">'phone'</span> =&gt; <span class="hljs-string">'required|string|regex:/^1[3-9]\d{9}$/'</span>,
            <span class="hljs-string">'items'</span> =&gt; <span class="hljs-string">'required|array'</span>,
            <span class="hljs-string">'items.*.product_id'</span> =&gt; <span class="hljs-string">'required|exists:products,id'</span>,
            <span class="hljs-string">'items.*.quantity'</span> =&gt; <span class="hljs-string">'required|integer|min:1'</span>
        ];
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">messages</span>(<span class="hljs-params"/>)
    </span>{
        <span class="hljs-keyword">return</span> [
            <span class="hljs-string">'address.required'</span> =&gt; <span class="hljs-string">'æ”¶è´§åœ°å€ä¸èƒ½ä¸ºç©º'</span>,
            <span class="hljs-string">'consignee.required'</span> =&gt; <span class="hljs-string">'æ”¶è´§äººä¸èƒ½ä¸ºç©º'</span>,
            <span class="hljs-string">'phone.required'</span> =&gt; <span class="hljs-string">'æ‰‹æœºå·ä¸èƒ½ä¸ºç©º'</span>,
            <span class="hljs-string">'phone.regex'</span> =&gt; <span class="hljs-string">'æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®'</span>,
        ];
    }
}
</code></pre>
<h3 data-id="heading-16">äº”ã€UniAppå‰ç«¯è°ƒç”¨ç¤ºä¾‹</h3>
<h4 data-id="heading-17">5.1 ç¯å¢ƒé…ç½®ä¸è¯·æ±‚å°è£…</h4>
<p>åœ¨UniAppä¸­é…ç½®APIè¯·æ±‚åŸºç¡€é…ç½®ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils/request.js</span>
<span class="hljs-keyword">import</span> { getToken } <span class="hljs-keyword">from</span> <span class="hljs-string">'./auth'</span>

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">BASE_URL</span> = <span class="hljs-string">'https://api.yourdomain.com/api'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">request</span> = (<span class="hljs-params">options</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    uni.<span class="hljs-title function_">request</span>({
      <span class="hljs-attr">url</span>: <span class="hljs-variable constant_">BASE_URL</span> + options.<span class="hljs-property">url</span>,
      <span class="hljs-attr">method</span>: options.<span class="hljs-property">method</span> || <span class="hljs-string">'GET'</span>,
      <span class="hljs-attr">data</span>: options.<span class="hljs-property">data</span> || {},
      <span class="hljs-attr">header</span>: {
        <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
        <span class="hljs-string">'Authorization'</span>: <span class="hljs-title function_">getToken</span>() ? <span class="hljs-string">`Bearer <span class="hljs-subst">${getToken()}</span>`</span> : <span class="hljs-string">''</span>
      },
      <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (res.<span class="hljs-property">statusCode</span> === <span class="hljs-number">200</span>) {
          <span class="hljs-title function_">resolve</span>(res.<span class="hljs-property">data</span>)
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-title function_">reject</span>(res)
        }
      },
      <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
        <span class="hljs-title function_">reject</span>(err)
      }
    })
  })
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> request
</code></pre>
<h4 data-id="heading-18">5.2 ç”¨æˆ·è®¤è¯è°ƒç”¨</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// services/auth.js</span>
<span class="hljs-keyword">import</span> request <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/request'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">login</span> = (<span class="hljs-params">data</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
    <span class="hljs-attr">url</span>: <span class="hljs-string">'/login'</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
    data
  })
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getUserInfo</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
    <span class="hljs-attr">url</span>: <span class="hljs-string">'/user'</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>
  })
}
</code></pre>
<h4 data-id="heading-19">5.3 å•†å“åˆ—è¡¨è°ƒç”¨</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// services/product.js</span>
<span class="hljs-keyword">import</span> request <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/request'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getProducts</span> = (<span class="hljs-params">params = {}</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
    <span class="hljs-attr">url</span>: <span class="hljs-string">'/products'</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
    <span class="hljs-attr">data</span>: params
  })
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getProductDetail</span> = (<span class="hljs-params">id</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
    <span class="hljs-attr">url</span>: <span class="hljs-string">`/products/<span class="hljs-subst">${id}</span>`</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>
  })
}
</code></pre>
<h4 data-id="heading-20">5.4 è´­ç‰©è½¦æ“ä½œ</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// services/cart.js</span>
<span class="hljs-keyword">import</span> request <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/request'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getCartList</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
    <span class="hljs-attr">url</span>: <span class="hljs-string">'/cart'</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>
  })
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">addToCart</span> = (<span class="hljs-params">data</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
    <span class="hljs-attr">url</span>: <span class="hljs-string">'/cart'</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
    data
  })
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">updateCart</span> = (<span class="hljs-params">id, data</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
    <span class="hljs-attr">url</span>: <span class="hljs-string">`/cart/<span class="hljs-subst">${id}</span>`</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">'PUT'</span>,
    data
  })
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">removeFromCart</span> = (<span class="hljs-params">id</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
    <span class="hljs-attr">url</span>: <span class="hljs-string">`/cart/<span class="hljs-subst">${id}</span>`</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">'DELETE'</span>
  })
}
</code></pre>
<h4 data-id="heading-21">5.5 è®¢å•ç®¡ç†</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// services/order.js</span>
<span class="hljs-keyword">import</span> request <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/request'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">createOrder</span> = (<span class="hljs-params">data</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
    <span class="hljs-attr">url</span>: <span class="hljs-string">'/orders'</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
    data
  })
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getOrderList</span> = (<span class="hljs-params">params = {}</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
    <span class="hljs-attr">url</span>: <span class="hljs-string">'/orders'</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
    <span class="hljs-attr">data</span>: params
  })
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getOrderDetail</span> = (<span class="hljs-params">id</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
    <span class="hljs-attr">url</span>: <span class="hljs-string">`/orders/<span class="hljs-subst">${id}</span>`</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>
  })
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">payOrder</span> = (<span class="hljs-params">id</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
    <span class="hljs-attr">url</span>: <span class="hljs-string">`/orders/<span class="hljs-subst">${id}</span>/pay`</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>
  })
}
</code></pre>
<h3 data-id="heading-22">å…­ã€æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</h3>
<h4 data-id="heading-23">6.1 æ•°æ®åº“ä¼˜åŒ–</h4>
<p><strong>ç´¢å¼•ä¼˜åŒ–</strong>ï¼šä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ï¼š</p>
<pre><code class="hljs language-go" lang="go">-- å•†å“è¡¨ç´¢å¼•
ALTER TABLE <span class="hljs-string">`products`</span> ADD INDEX <span class="hljs-string">`idx_category_status`</span> (<span class="hljs-string">`category_id`</span>, <span class="hljs-string">`status`</span>);
ALTER TABLE <span class="hljs-string">`products`</span> ADD INDEX <span class="hljs-string">`idx_name`</span> (<span class="hljs-string">`name`</span>);
ALTER TABLE <span class="hljs-string">`products`</span> ADD INDEX <span class="hljs-string">`idx_price`</span> (<span class="hljs-string">`price`</span>);

-- è®¢å•è¡¨ç´¢å¼•
ALTER TABLE <span class="hljs-string">`orders`</span> ADD INDEX <span class="hljs-string">`idx_user_status`</span> (<span class="hljs-string">`user_id`</span>, <span class="hljs-string">`status`</span>);
ALTER TABLE <span class="hljs-string">`orders`</span> ADD INDEX <span class="hljs-string">`idx_created_at`</span> (<span class="hljs-string">`created_at`</span>);

-- è´­ç‰©è½¦è¡¨ç´¢å¼•
ALTER TABLE <span class="hljs-string">`carts`</span> ADD INDEX <span class="hljs-string">`idx_user_product`</span> (<span class="hljs-string">`user_id`</span>, <span class="hljs-string">`product_id`</span>);
</code></pre>
<p><strong>æŸ¥è¯¢ä¼˜åŒ–</strong>ï¼šé¿å…N+1æŸ¥è¯¢é—®é¢˜ï¼Œä½¿ç”¨withé¢„åŠ è½½å…³è”æ•°æ®ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// ä¼˜åŒ–å‰ï¼šN+1æŸ¥è¯¢</span>
<span class="hljs-variable">$orders</span> = <span class="hljs-title class_">Order</span>::<span class="hljs-title function_ invoke__">all</span>();
<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$orders</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$order</span>) {
    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$order</span>-&gt;user-&gt;name; <span class="hljs-comment">// æ¯æ¬¡å¾ªç¯éƒ½ä¼šæŸ¥è¯¢æ•°æ®åº“</span>
}

<span class="hljs-comment">// ä¼˜åŒ–åï¼šé¢„åŠ è½½å…³è”æ•°æ®</span>
<span class="hljs-variable">$orders</span> = <span class="hljs-title class_">Order</span>::<span class="hljs-title function_ invoke__">with</span>(<span class="hljs-string">'user'</span>, <span class="hljs-string">'items.product'</span>)-&gt;<span class="hljs-title function_ invoke__">get</span>();
</code></pre>
<h4 data-id="heading-24">6.2 ç¼“å­˜ç­–ç•¥</h4>
<p>Laravel 11æä¾›äº†å¼ºå¤§çš„ç¼“å­˜æœºåˆ¶ï¼Œæ”¯æŒå¤šç§ç¼“å­˜é©±åŠ¨ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// é…ç½®ç¼“å­˜é©±åŠ¨ä¸ºRedis
<span class="hljs-attr">CACHE_DRIVER</span>=redis
<span class="hljs-attr">REDIS_HOST</span>=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>
<span class="hljs-attr">REDIS_PASSWORD</span>=null
<span class="hljs-attr">REDIS_PORT</span>=<span class="hljs-number">6379</span>

// å•†å“è¯¦æƒ…ç¼“å­˜
public function show($id)
{
    $<span class="hljs-attr">cacheKey</span> = <span class="hljs-string">'product:'</span> . <span class="hljs-variable">$id</span><span class="hljs-comment">;</span>
    
    $<span class="hljs-attr">product</span> = Cache::remember(<span class="hljs-variable">$cacheKey</span>, <span class="hljs-number">3600</span>, function () use (<span class="hljs-variable">$id</span>) {
        return Product::with(<span class="hljs-section">['category', 'skus', 'attributes']</span>)
            -&gt;findOrFail($id)<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

    return new ProductResource($product)<span class="hljs-comment">;</span>
}

// å•†å“åˆ—è¡¨ç¼“å­˜
public function index(Request $request)
{
    $<span class="hljs-attr">cacheKey</span> = <span class="hljs-string">'products:'</span> . md5(json_encode(<span class="hljs-variable">$request</span>-&gt;all()))<span class="hljs-comment">;</span>
    
    $<span class="hljs-attr">products</span> = Cache::remember(<span class="hljs-variable">$cacheKey</span>, <span class="hljs-number">300</span>, function () use (<span class="hljs-variable">$request</span>) {
        $<span class="hljs-attr">query</span> = Product::with(<span class="hljs-string">'category'</span>)
            -&gt;where('status', 1)<span class="hljs-comment">;</span>

        // æŸ¥è¯¢æ¡ä»¶...
        
        return $query-&gt;paginate(20)<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

    return ProductResource::collection($products)<span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-25">6.3 é˜Ÿåˆ—å¤„ç†</h4>
<p>å¯¹äºè€—æ—¶æ“ä½œï¼Œå¦‚å‘é€é‚®ä»¶ã€ç”ŸæˆæŠ¥è¡¨ç­‰ï¼Œä½¿ç”¨é˜Ÿåˆ—å¼‚æ­¥å¤„ç†ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// é…ç½®é˜Ÿåˆ—é©±åŠ¨ä¸ºRedis</span>
QUEUE_CONNECTION=redis

<span class="hljs-comment">// åˆ›å»ºé˜Ÿåˆ—ä»»åŠ¡</span>
php artisan make:job SendOrderEmail

<span class="hljs-comment">// å‘é€è®¢å•é‚®ä»¶ä»»åŠ¡</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title class_">App</span>\<span class="hljs-title class_">Jobs</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Models</span>\<span class="hljs-title">Order</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Bus</span>\<span class="hljs-title">Queueable</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Contracts</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">ShouldQueue</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Foundation</span>\<span class="hljs-title">Bus</span>\<span class="hljs-title">Dispatchable</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">InteractsWithQueue</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Queue</span>\<span class="hljs-title">SerializesModels</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">Mail</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SendOrderEmail</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ShouldQueue</span>
</span>{
    <span class="hljs-keyword">use</span> <span class="hljs-title">Dispatchable</span>, <span class="hljs-title">InteractsWithQueue</span>, <span class="hljs-title">Queueable</span>, <span class="hljs-title">SerializesModels</span>;

    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$order</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">Order <span class="hljs-variable">$order</span></span>)
    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;order = <span class="hljs-variable">$order</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span>(<span class="hljs-params"/>)
    </span>{
        <span class="hljs-title class_">Mail</span>::<span class="hljs-title function_ invoke__">to</span>(<span class="hljs-variable">$this</span>-&gt;order-&gt;user-&gt;email)
            -&gt;<span class="hljs-title function_ invoke__">send</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderCreated</span>(<span class="hljs-variable">$this</span>-&gt;order));
    }
}

<span class="hljs-comment">// åœ¨æ§åˆ¶å™¨ä¸­åˆ†å‘ä»»åŠ¡</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">store</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>)
</span>{
    <span class="hljs-comment">// åˆ›å»ºè®¢å•...</span>
    
    <span class="hljs-title class_">SendOrderEmail</span>::<span class="hljs-title function_ invoke__">dispatch</span>(<span class="hljs-variable">$order</span>);
    
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">response</span>()-&gt;<span class="hljs-title function_ invoke__">json</span>([<span class="hljs-string">'message'</span> =&gt; <span class="hljs-string">'è®¢å•åˆ›å»ºæˆåŠŸ'</span>]);
}
</code></pre>
<h3 data-id="heading-26">ä¸ƒã€å®‰å…¨é˜²æŠ¤æªæ–½</h3>
<h4 data-id="heading-27">7.1 è¾“å…¥éªŒè¯ä¸è¿‡æ»¤</h4>
<p>Laravel 11å†…ç½®äº†å¼ºå¤§çš„éªŒè¯æœºåˆ¶ï¼Œé˜²æ­¢SQLæ³¨å…¥å’ŒXSSæ”»å‡»ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">store</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>)
</span>{
    <span class="hljs-variable">$validated</span> = <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">validate</span>([
        <span class="hljs-string">'name'</span> =&gt; <span class="hljs-string">'required|string|max:255'</span>,
        <span class="hljs-string">'email'</span> =&gt; <span class="hljs-string">'required|email|unique:users'</span>,
        <span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">'required|string|min:8'</span>,
        <span class="hljs-string">'phone'</span> =&gt; <span class="hljs-string">'required|string|regex:/^1[3-9]\d{9}$/'</span>,
        <span class="hljs-string">'avatar'</span> =&gt; <span class="hljs-string">'nullable|image|max:2048'</span>
    ]);

    <span class="hljs-comment">// å®‰å…¨å¤„ç†è¾“å…¥æ•°æ®</span>
    <span class="hljs-variable">$user</span> = <span class="hljs-title class_">User</span>::<span class="hljs-title function_ invoke__">create</span>([
        <span class="hljs-string">'name'</span> =&gt; <span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$validated</span>[<span class="hljs-string">'name'</span>]),
        <span class="hljs-string">'email'</span> =&gt; <span class="hljs-variable">$validated</span>[<span class="hljs-string">'email'</span>],
        <span class="hljs-string">'password'</span> =&gt; <span class="hljs-title class_">Hash</span>::<span class="hljs-title function_ invoke__">make</span>(<span class="hljs-variable">$validated</span>[<span class="hljs-string">'password'</span>]),
        <span class="hljs-string">'phone'</span> =&gt; <span class="hljs-variable">$validated</span>[<span class="hljs-string">'phone'</span>]
    ]);

    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">response</span>()-&gt;<span class="hljs-title function_ invoke__">json</span>(<span class="hljs-variable">$user</span>);
}
</code></pre>
<h4 data-id="heading-28">7.2 é€Ÿç‡é™åˆ¶</h4>
<p>é˜²æ­¢APIæ»¥ç”¨ï¼Œé…ç½®é€Ÿç‡é™åˆ¶ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// åœ¨è·¯ç”±ä¸­é…ç½®é€Ÿç‡é™åˆ¶</span>
<span class="hljs-title class_">Route</span>::<span class="hljs-title function_ invoke__">middleware</span>([<span class="hljs-string">'auth:api'</span>, <span class="hljs-string">'throttle:60,1'</span>])-&gt;<span class="hljs-title function_ invoke__">group</span>(function () {
    <span class="hljs-title class_">Route</span>::<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">'profile'</span>, [<span class="hljs-title class_">UserController</span>::<span class="hljs-variable language_">class</span>, <span class="hljs-string">'profile'</span>]);
    <span class="hljs-title class_">Route</span>::<span class="hljs-title function_ invoke__">put</span>(<span class="hljs-string">'profile'</span>, [<span class="hljs-title class_">UserController</span>::<span class="hljs-variable language_">class</span>, <span class="hljs-string">'update'</span>]);
});

<span class="hljs-comment">// åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸­è‡ªå®šä¹‰é€Ÿç‡é™åˆ¶</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>)
</span>{
    <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">middleware</span>(<span class="hljs-string">'throttle:5,1'</span>)-&gt;<span class="hljs-title function_ invoke__">only</span>(<span class="hljs-string">'login'</span>);
    
    <span class="hljs-comment">// ç™»å½•é€»è¾‘...</span>
}
</code></pre>
<h4 data-id="heading-29">7.3 CSRFé˜²æŠ¤</h4>
<p>è™½ç„¶APIé€šå¸¸ä¸éœ€è¦CSRF Tokenï¼Œä½†å¯¹äºæŸäº›æ“ä½œä»éœ€ä¿æŠ¤ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// åœ¨VerifyCsrfTokenä¸­é—´ä»¶ä¸­æ’é™¤APIè·¯ç”±</span>
<span class="hljs-keyword">protected</span> <span class="hljs-variable">$except</span> = [
    <span class="hljs-string">'api/*'</span>
];

<span class="hljs-comment">// å¯¹äºéœ€è¦CSRFä¿æŠ¤çš„æ“ä½œ</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>)
</span>{
    <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">validate</span>([
        <span class="hljs-string">'_token'</span> =&gt; <span class="hljs-string">'required'</span>
    ]);
    
    <span class="hljs-comment">// æ›´æ–°é€»è¾‘...</span>
}
</code></pre>
<h3 data-id="heading-30">å…«ã€éƒ¨ç½²ä¸è¿ç»´</h3>
<h4 data-id="heading-31">8.1 ç”Ÿäº§ç¯å¢ƒé…ç½®</h4>
<p>Laravel 11çš„ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ç”Ÿæˆåº”ç”¨å¯†é’¥</span>
php artisan key:generate

<span class="hljs-comment"># é…ç½®ç¯å¢ƒå˜é‡</span>
<span class="hljs-attr">APP_ENV</span>=production
<span class="hljs-attr">APP_DEBUG</span>=<span class="hljs-literal">false</span>
<span class="hljs-attr">APP_KEY</span>=base64:...

<span class="hljs-comment"># é…ç½®æ•°æ®åº“è¿æ¥</span>
<span class="hljs-attr">DB_CONNECTION</span>=mysql
<span class="hljs-attr">DB_HOST</span>=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>
<span class="hljs-attr">DB_PORT</span>=<span class="hljs-number">3306</span>
<span class="hljs-attr">DB_DATABASE</span>=your_database
<span class="hljs-attr">DB_USERNAME</span>=your_username
<span class="hljs-attr">DB_PASSWORD</span>=your_password

<span class="hljs-comment"># é…ç½®ç¼“å­˜</span>
<span class="hljs-attr">CACHE_DRIVER</span>=redis
<span class="hljs-attr">SESSION_DRIVER</span>=redis
<span class="hljs-attr">QUEUE_CONNECTION</span>=redis
</code></pre>
<h4 data-id="heading-32">8.2 æ€§èƒ½ä¼˜åŒ–å‘½ä»¤</h4>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># ç”Ÿæˆé…ç½®ç¼“å­˜</span>
php artisan config:cache

<span class="hljs-comment"># ç”Ÿæˆè·¯ç”±ç¼“å­˜</span>
php artisan route:cache

<span class="hljs-comment"># ç”Ÿæˆè§†å›¾ç¼“å­˜</span>
php artisan view:cache

<span class="hljs-comment"># ä¼˜åŒ–è‡ªåŠ¨åŠ è½½</span>
composer <span class="hljs-keyword">dump</span>-autoload --optimize

<span class="hljs-comment"># è¿è¡Œæ•°æ®åº“è¿ç§»</span>
php artisan migrate --force
</code></pre>
<h4 data-id="heading-33">8.3 ç›‘æ§ä¸æ—¥å¿—</h4>
<p>é…ç½®æ—¥å¿—è®°å½•å’Œé”™è¯¯ç›‘æ§ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// è®°å½•APIè¯·æ±‚æ—¥å¿—</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span>, <span class="hljs-built_in">Closure</span> <span class="hljs-variable">$next</span></span>)
</span>{
    <span class="hljs-variable">$start</span> = <span class="hljs-title function_ invoke__">microtime</span>(<span class="hljs-literal">true</span>);
    
    <span class="hljs-variable">$response</span> = <span class="hljs-variable">$next</span>(<span class="hljs-variable">$request</span>);
    
    <span class="hljs-variable">$duration</span> = <span class="hljs-title function_ invoke__">microtime</span>(<span class="hljs-literal">true</span>) - <span class="hljs-variable">$start</span>;
    
    <span class="hljs-title class_">Log</span>::<span class="hljs-title function_ invoke__">info</span>(<span class="hljs-string">'API Request'</span>, [
        <span class="hljs-string">'method'</span> =&gt; <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">method</span>(),
        <span class="hljs-string">'url'</span> =&gt; <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">fullUrl</span>(),
        <span class="hljs-string">'ip'</span> =&gt; <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">ip</span>(),
        <span class="hljs-string">'duration'</span> =&gt; <span class="hljs-variable">$duration</span>,
        <span class="hljs-string">'status'</span> =&gt; <span class="hljs-variable">$response</span>-&gt;<span class="hljs-title function_ invoke__">getStatusCode</span>()
    ]);
    
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$response</span>;
}
</code></pre>
<h3 data-id="heading-34">ä¹ã€æ€»ç»“ä¸å±•æœ›</h3>
<p>Laravel 11ä¸UniAppçš„ç»“åˆä¸ºç”µå•†ç³»ç»Ÿå¼€å‘æä¾›äº†å®Œæ•´çš„è§£å†³æ–¹æ¡ˆã€‚Laravel 11çš„ç°ä»£åŒ–ç‰¹æ€§å’Œå¼ºå¤§ç”Ÿæ€ï¼Œé…åˆUniAppçš„è·¨å¹³å°èƒ½åŠ›ï¼Œèƒ½å¤Ÿå¿«é€Ÿæ„å»ºé«˜æ€§èƒ½ã€å¯æ‰©å±•çš„ç”µå•†åº”ç”¨ã€‚</p>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>
<p><strong>ä»£ç è§„èŒƒ</strong>ï¼šéµå¾ªPSRæ ‡å‡†ï¼Œä¿æŒä»£ç æ•´æ´å¯ç»´æŠ¤</p>
</li>
<li>
<p><strong>æµ‹è¯•é©±åŠ¨</strong>ï¼šç¼–å†™å•å…ƒæµ‹è¯•å’ŒåŠŸèƒ½æµ‹è¯•ï¼Œç¡®ä¿ä»£ç è´¨é‡</p>
</li>
<li>
<p><strong>æŒç»­é›†æˆ</strong>ï¼šä½¿ç”¨CI/CDå·¥å…·è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹</p>
</li>
<li>
<p><strong>ç›‘æ§å‘Šè­¦</strong>ï¼šç›‘æ§ç³»ç»Ÿæ€§èƒ½ï¼ŒåŠæ—¶å‘ç°å¹¶è§£å†³é—®é¢˜</p>
</li>
</ol>
<p>éšç€æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼ŒLaravelæ¡†æ¶ä¹Ÿåœ¨æŒç»­æ¼”è¿›ï¼Œæœªæ¥å¯ä»¥å…³æ³¨ä»¥ä¸‹æ–¹å‘ï¼š</p>
<ul>
<li>
<p>â€¢
<strong>å¾®æœåŠ¡æ¶æ„</strong>ï¼šå°†ç³»ç»Ÿæ‹†åˆ†ä¸ºæ›´å°çš„æœåŠ¡å•å…ƒï¼Œæå‡å¯æ‰©å±•æ€§</p>
</li>
<li>
<p>â€¢
<strong>Serverlesséƒ¨ç½²</strong>ï¼šä½¿ç”¨æ— æœåŠ¡å™¨æ¶æ„é™ä½è¿ç»´æˆæœ¬</p>
</li>
<li>
<p>â€¢
<strong>AIé›†æˆ</strong>ï¼šé›†æˆæ¨èç®—æ³•ã€æ™ºèƒ½å®¢æœç­‰AIèƒ½åŠ›</p>
</li>
<li>
<p>â€¢
<strong>åŒºå—é“¾åº”ç”¨</strong>ï¼šæ¢ç´¢å»ä¸­å¿ƒåŒ–ç”µå•†æ¨¡å¼</p>
</li>
</ul>
<p>é€šè¿‡æœ¬æ–‡çš„å­¦ä¹ ï¼Œç›¸ä¿¡ä½ å·²ç»æŒæ¡äº†ä½¿ç”¨Laravel 11å’ŒUniAppæ„å»ºç”µå•†ç³»ç»Ÿçš„æ ¸å¿ƒæŠ€èƒ½ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¿˜éœ€è¦æ ¹æ®å…·ä½“ä¸šåŠ¡éœ€æ±‚è¿›è¡Œå®šåˆ¶å¼€å‘ï¼Œä¸æ–­ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½å’Œç”¨æˆ·ä½“éªŒï¼Œæ‰“é€ å‡ºçœŸæ­£ä¼˜ç§€çš„ç”µå•†å¹³å°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++ å†…å­˜ä¸æ€§èƒ½ä¼˜åŒ–ï¼šè¯­è¨€ç‰¹æ€§çš„å¼€é”€åˆ†æä¸æ›¿ä»£æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7572510909445308466</link>    <guid>https://juejin.cn/post/7572510909445308466</guid>    <pubDate>2025-11-15T09:28:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572510909445308466" data-draft-id="7572485825705754633" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++ å†…å­˜ä¸æ€§èƒ½ä¼˜åŒ–ï¼šè¯­è¨€ç‰¹æ€§çš„å¼€é”€åˆ†æä¸æ›¿ä»£æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="C++"/> <meta itemprop="datePublished" content="2025-11-15T09:28:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¸©å®‡é£"/> <meta itemprop="url" content="https://juejin.cn/user/4300945219403368"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++ å†…å­˜ä¸æ€§èƒ½ä¼˜åŒ–ï¼šè¯­è¨€ç‰¹æ€§çš„å¼€é”€åˆ†æä¸æ›¿ä»£æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4300945219403368/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¸©å®‡é£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T09:28:55.000Z" title="Sat Nov 15 2025 09:28:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»35åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å†…å­˜å’Œæ€§èƒ½æ•æ„Ÿçš„ C++ ç³»ç»Ÿå¼€å‘ä¸­ï¼Œè¯­è¨€ç‰¹æ€§çš„é€‰æ‹©ç›´æ¥å†³å®šç¨‹åºçš„å†…å­˜å ç”¨å’Œè¿è¡Œæ•ˆç‡ã€‚æœ¬æ–‡é’ˆå¯¹ RTTIã€å¼‚å¸¸å¤„ç†ã€è™šå‡½æ•°ã€æ³›å‹ç¼–ç¨‹ã€å€¼è¯­ä¹‰ã€åŠ¨æ€å†…å­˜åˆ†é…ç­‰å…³é”®è¯­è¨€ç‰¹æ€§ï¼Œä»åº•å±‚å®ç°æœºåˆ¶å‡ºå‘ï¼Œæ·±å…¥åˆ†æå…¶å†…å­˜å¼€é”€å’Œæ€§èƒ½ä»£ä»·ï¼Œå¹¶æä¾›å¤šç§é«˜æ€§èƒ½æ›¿ä»£æ–¹æ¡ˆçš„å¯¹æ¯”ã€‚é€šè¿‡ç†è§£è¿™äº›ç‰¹æ€§çš„æƒè¡¡å–èˆï¼Œå¸®åŠ©å¼€å‘è€…åœ¨å†…å­˜æ•ˆç‡ã€è¿è¡Œæ€§èƒ½å’Œä»£ç è´¨é‡ä¹‹é—´åšå‡ºæ˜æ™ºçš„æŠ€æœ¯é€‰æ‹©ã€‚</p>
<h2 data-id="heading-0">ç¦ç”¨ RTTIï¼ˆè¿è¡Œæ—¶ç±»å‹è¯†åˆ«ï¼‰</h2>
<p>RTTI æä¾›è¿è¡Œæ—¶ç±»å‹è¯†åˆ«èƒ½åŠ›ï¼Œä½†ä¾èµ– type_info è¡¨å’Œè™šå‡½æ•°è¡¨ï¼Œå¢åŠ å†…å­˜å ç”¨å’Œè¿è¡Œæ—¶å¼€é”€ã€‚ä½¿ç”¨ç¼–è¯‘é€‰é¡¹ <code>-fno-rtti</code> ç¦ç”¨ RTTI åï¼Œ<code>typeid</code>ã€<code>dynamic_cast</code>ã€<code>std::any</code> ç­‰ç‰¹æ€§æ— æ³•ä½¿ç”¨ã€‚æœ¬ç« ä»‹ç» RTTI çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ï¼Œåˆ†æå…¶åº•å±‚å®ç°æœºåˆ¶å’Œæ€§èƒ½ä»£ä»·ï¼Œå¹¶æä¾›ç¼–è¯‘æœŸç±»å‹è¯†åˆ«ã€è‡ªå®šä¹‰ç±»å‹ IDã€std::variant ç­‰æ›¿ä»£æ–¹æ¡ˆã€‚</p>
<h3 data-id="heading-1">RTTI ç®€è¿°</h3>
<p>RTTI(Run-Time Type Information) æ˜¯ C++ æä¾›çš„è¿è¡Œæ—¶ç±»å‹è¯†åˆ«æœºåˆ¶ï¼Œå…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶æŸ¥è¯¢å¯¹è±¡çš„å®é™…ç±»å‹ã€‚RTTI ä¸»è¦åŒ…å«ä¸‰ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š<code>typeid</code> è¿ç®—ç¬¦ã€<code>dynamic_cast</code> è¿ç®—ç¬¦å’Œ <code>std::any</code> ç±»å‹ã€‚</p>
<p><strong>typeid è¿ç®—ç¬¦</strong></p>
<p><code>typeid</code> è¿”å›å¯¹è±¡çš„ç±»å‹ä¿¡æ¯ï¼Œç»“æœæ˜¯ <code>std::type_info</code> å¯¹è±¡çš„å¼•ç”¨ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;typeinfo&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Base</span>() = <span class="hljs-keyword">default</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">public</span> Base {};

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    std::unique_ptr&lt;Base&gt; ptr = std::<span class="hljs-built_in">make_unique</span>&lt;Derived&gt;();

    <span class="hljs-comment">// è·å–ç±»å‹ä¿¡æ¯</span>
    <span class="hljs-type">const</span> std::type_info&amp; info = <span class="hljs-built_in">typeid</span>(*ptr);
    std::cout &lt;&lt; info.<span class="hljs-built_in">name</span>() &lt;&lt; std::endl;  <span class="hljs-comment">// è¾“å‡ºï¼šDerived</span>

    <span class="hljs-comment">// ç±»å‹æ¯”è¾ƒ</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">typeid</span>(*ptr) == <span class="hljs-built_in">typeid</span>(Derived)) {
        std::cout &lt;&lt; <span class="hljs-string">"ptr points to Derived"</span> &lt;&lt; std::endl;
    }

    <span class="hljs-comment">// è‡ªåŠ¨é‡Šæ”¾ï¼Œæ— éœ€æ‰‹åŠ¨ delete</span>
}
</code></pre>
<p><strong>dynamic_cast è¿ç®—ç¬¦</strong></p>
<p><code>dynamic_cast</code> ç”¨äºåœ¨ç»§æ‰¿å±‚æ¬¡ä¸­è¿›è¡Œå®‰å…¨çš„å‘ä¸‹è½¬æ¢(Downcast)ï¼Œå¦‚æœè½¬æ¢å¤±è´¥è¿”å› <code>nullptr</code>ï¼ˆæŒ‡é’ˆï¼‰æˆ–æŠ›å‡ºå¼‚å¸¸ï¼ˆå¼•ç”¨ï¼‰ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Base</span>() = <span class="hljs-keyword">default</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived1</span> : <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">derived1Method</span><span class="hljs-params">()</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"Derived1 method"</span> &lt;&lt; std::endl;
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived2</span> : <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">derived2Method</span><span class="hljs-params">()</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"Derived2 method"</span> &lt;&lt; std::endl;
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">process</span><span class="hljs-params">(Base* base)</span> </span>{
    <span class="hljs-comment">// å°è¯•å‘ä¸‹è½¬æ¢</span>
    <span class="hljs-keyword">if</span> (Derived1* d1 = <span class="hljs-built_in">dynamic_cast</span>&lt;Derived1*&gt;(base)) {
        d1-&gt;<span class="hljs-built_in">derived1Method</span>();
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Derived2* d2 = <span class="hljs-built_in">dynamic_cast</span>&lt;Derived2*&gt;(base)) {
        d2-&gt;<span class="hljs-built_in">derived2Method</span>();
    }
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    std::unique_ptr&lt;Base&gt; ptr1 = std::<span class="hljs-built_in">make_unique</span>&lt;Derived1&gt;();
    std::unique_ptr&lt;Base&gt; ptr2 = std::<span class="hljs-built_in">make_unique</span>&lt;Derived2&gt;();

    <span class="hljs-built_in">process</span>(ptr1.<span class="hljs-built_in">get</span>());  <span class="hljs-comment">// è¾“å‡ºï¼šDerived1 method</span>
    <span class="hljs-built_in">process</span>(ptr2.<span class="hljs-built_in">get</span>());  <span class="hljs-comment">// è¾“å‡ºï¼šDerived2 method</span>

    <span class="hljs-comment">// è‡ªåŠ¨é‡Šæ”¾ï¼Œæ— éœ€æ‰‹åŠ¨ delete</span>
}
</code></pre>
<p><strong>std::any</strong></p>
<p><code>std::any</code>(C++17) å¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹çš„å€¼ï¼Œä½¿ç”¨ RTTI åœ¨è¿è¡Œæ—¶è¯†åˆ«å­˜å‚¨çš„ç±»å‹ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;any&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// å­˜å‚¨ä¸åŒç±»å‹çš„å€¼</span>
    std::any value;

    value = <span class="hljs-number">42</span>;
    std::cout &lt;&lt; std::<span class="hljs-built_in">any_cast</span>&lt;<span class="hljs-type">int</span>&gt;(value) &lt;&lt; std::endl;  <span class="hljs-comment">// è¾“å‡ºï¼š42</span>

    value = <span class="hljs-number">3.14</span>;
    std::cout &lt;&lt; std::<span class="hljs-built_in">any_cast</span>&lt;<span class="hljs-type">double</span>&gt;(value) &lt;&lt; std::endl;  <span class="hljs-comment">// è¾“å‡ºï¼š3.14</span>

    value = std::<span class="hljs-built_in">string</span>(<span class="hljs-string">"hello"</span>);
    std::cout &lt;&lt; std::<span class="hljs-built_in">any_cast</span>&lt;std::string&gt;(value) &lt;&lt; std::endl;  <span class="hljs-comment">// è¾“å‡ºï¼šhello</span>

    <span class="hljs-comment">// ç±»å‹æ£€æŸ¥</span>
    <span class="hljs-keyword">if</span> (value.<span class="hljs-built_in">type</span>() == <span class="hljs-built_in">typeid</span>(std::string)) {
        std::cout &lt;&lt; <span class="hljs-string">"value contains a string"</span> &lt;&lt; std::endl;
    }

    <span class="hljs-comment">// ç±»å‹é”™è¯¯æ—¶æŠ›å‡ºå¼‚å¸¸</span>
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">int</span> x = std::<span class="hljs-built_in">any_cast</span>&lt;<span class="hljs-type">int</span>&gt;(value);  <span class="hljs-comment">// value å½“å‰æ˜¯ string</span>
    } <span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> std::bad_any_cast&amp; e) {
        std::cout &lt;&lt; <span class="hljs-string">"Bad cast: "</span> &lt;&lt; e.<span class="hljs-built_in">what</span>() &lt;&lt; std::endl;
    }
}
</code></pre>
<p>è¿™äº› RTTI ç‰¹æ€§æä¾›äº†çµæ´»çš„è¿è¡Œæ—¶ç±»å‹å¤„ç†èƒ½åŠ›ï¼Œä½†éƒ½ä¾èµ–ç¼–è¯‘å™¨ç”Ÿæˆçš„ç±»å‹ä¿¡æ¯è¡¨ï¼Œä¼šå¸¦æ¥é¢å¤–çš„å†…å­˜å’Œæ€§èƒ½å¼€é”€ã€‚</p>
<h3 data-id="heading-2">åº•å±‚å®ç°ä¸å¼€é”€åˆ†æ</h3>
<p>RTTI çš„å®ç°ä¾èµ–ç¼–è¯‘å™¨ç”Ÿæˆçš„å…ƒæ•°æ®ã€‚ç†è§£åº•å±‚å®ç°æœºåˆ¶æœ‰åŠ©äºé‡åŒ– RTTI çš„å†…å­˜å’Œæ€§èƒ½ä»£ä»·ã€‚</p>
<h4 data-id="heading-3">typeid</h4>
<p><code>typeid</code> çš„è¡Œä¸ºå–å†³äºç±»æ˜¯å¦åŒ…å«è™šå‡½æ•°ã€‚</p>
<p><strong>æ²¡æœ‰è™šå‡½æ•°çš„ç±»</strong>ï¼š<code>typeid</code> åœ¨<strong>ç¼–è¯‘æœŸ</strong>ç¡®å®šç±»å‹ï¼Œæ— è¿è¡Œæ—¶å¼€é”€ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleClass</span> {
    <span class="hljs-type">int</span> data_;
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">SimpleClass</span>(<span class="hljs-type">int</span> d) : <span class="hljs-built_in">data_</span>(d) {}
};

<span class="hljs-built_in">static_assert</span>(<span class="hljs-built_in">sizeof</span>(SimpleClass) == <span class="hljs-number">4</span>);

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">SimpleClass <span class="hljs-title">obj</span><span class="hljs-params">(<span class="hljs-number">42</span>)</span></span>;
    <span class="hljs-type">const</span> std::type_info&amp; info = <span class="hljs-built_in">typeid</span>(obj);

    <span class="hljs-comment">// ç¼–è¯‘æœŸç¡®å®šç±»å‹ï¼Œç­‰ä»·äºï¼š</span>
    <span class="hljs-comment">// const std::type_info&amp; info = typeid(SimpleClass);</span>

    std::cout &lt;&lt; info.<span class="hljs-built_in">name</span>() &lt;&lt; std::endl;  <span class="hljs-comment">// è¾“å‡ºï¼šSimpleClass</span>
}
</code></pre>
<p><strong>æœ‰è™šå‡½æ•°çš„ç±»</strong>ï¼šå¯¹äºæœ‰è™šå‡½æ•°çš„ç±»ï¼Œ<code>typeid</code> éœ€è¦åœ¨<strong>è¿è¡Œæ—¶</strong>é€šè¿‡ vptr æŸ¥æ‰¾ç±»å‹ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> {
    <span class="hljs-type">int</span> data_;
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Base</span>() = <span class="hljs-keyword">default</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">public</span> Base {};

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    std::unique_ptr&lt;Base&gt; ptr = std::<span class="hljs-built_in">make_unique</span>&lt;Derived&gt;();

    <span class="hljs-comment">// è¿è¡Œæ—¶ç¡®å®šç±»å‹</span>
    <span class="hljs-type">const</span> std::type_info&amp; info = <span class="hljs-built_in">typeid</span>(*ptr);
    std::cout &lt;&lt; info.<span class="hljs-built_in">name</span>() &lt;&lt; std::endl;  <span class="hljs-comment">// è¾“å‡ºï¼šDerived</span>

    <span class="hljs-comment">// è‡ªåŠ¨é‡Šæ”¾</span>
}
</code></pre>
<p>åº•å±‚å®ç°ï¼ˆæ¦‚å¿µæ€§è¯´æ˜ï¼Œå®é™…å®ç°ä¾ç¼–è¯‘å™¨è€Œå¼‚ï¼‰ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ç¼–è¯‘å™¨ç”Ÿæˆçš„ä¼ªä»£ç ï¼ˆæ¦‚å¿µæ€§è¯´æ˜ï¼‰ï¼š</span>
<span class="hljs-comment">// 1. è¯»å–å¯¹è±¡çš„ vptr</span>
<span class="hljs-type">void</span>** vptr = *(<span class="hljs-type">void</span>***)ptr;

<span class="hljs-comment">// 2. ä» vtable è¯»å– type_info æŒ‡é’ˆ</span>
<span class="hljs-type">const</span> std::type_info* type_info_ptr = (<span class="hljs-type">const</span> std::type_info*)vptr[<span class="hljs-number">-1</span>];

<span class="hljs-comment">// 3. è¿”å› type_info å¼•ç”¨</span>
<span class="hljs-keyword">return</span> *type_info_ptr;
</code></pre>
<p>å†…å­˜å¸ƒå±€ï¼šå¯¹è±¡<strong>æœ‰ vptr</strong>ï¼Œé¢å¤–å ç”¨æŒ‡é’ˆå¤§å°çš„å¼€é”€ï¼ˆ64 ä½ç³»ç»Ÿ 8 å­—èŠ‚ï¼Œ32 ä½ç³»ç»Ÿ 4 å­—èŠ‚ï¼‰ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// Base å¯¹è±¡å†…å­˜å¸ƒå±€ï¼ˆ64ä½ç³»ç»Ÿï¼‰ï¼š</span>
<span class="hljs-comment">// [vptr: 8å­—èŠ‚][data_: 4å­—èŠ‚][padding: 4å­—èŠ‚]</span>
<span class="hljs-built_in">sizeof</span>(Base) = <span class="hljs-number">16</span>  <span class="hljs-comment">// 8 (vptr) + 4 (data_) + 4 (padding)</span>

<span class="hljs-comment">// å†…å­˜å¸ƒå±€å¯è§†åŒ–ï¼š</span>
<span class="hljs-comment">// +--------+--------+--------+--------+</span>
<span class="hljs-comment">// |  vptr  |  vptr  | data_  | data_  |</span>
<span class="hljs-comment">// | (ä½4B) | (é«˜4B) | (4B)   | padding|</span>
<span class="hljs-comment">// +--------+--------+--------+--------+</span>
<span class="hljs-comment">// åœ°å€: 0x00   0x04   0x08   0x0C</span>
</code></pre>
<p><strong>å†…å­˜ä¸æ€§èƒ½å¯¹æ¯”</strong></p>























<table><thead><tr><th>æƒ…å†µ</th><th>å¯¹è±¡å†…å­˜å¼€é”€</th><th>æ€§èƒ½å¼€é”€</th><th>ç±»å‹ç¡®å®šæ—¶æœº</th></tr></thead><tbody><tr><td>æ— è™šå‡½æ•°çš„ç±»</td><td>æ— é¢å¤–å¼€é”€</td><td>æ— å¼€é”€</td><td>ç¼–è¯‘æœŸ</td></tr><tr><td>æœ‰è™šå‡½æ•°çš„ç±»</td><td>+8 å­—èŠ‚ï¼ˆ64 ä½ç³»ç»Ÿ vptrï¼‰</td><td>2 æ¬¡å†…å­˜è®¿é—®</td><td>è¿è¡Œæ—¶</td></tr></tbody></table>
<h4 data-id="heading-4">dynamic_cast</h4>
<p><code>dynamic_cast</code> åªèƒ½ç”¨äº<strong>æœ‰è™šå‡½æ•°çš„å¤šæ€ç±»å‹</strong>ã€‚</p>
<p><strong>ç»§æ‰¿æ— è™šå‡½æ•°çš„ç±»ï¼ˆç¼–è¯‘é”™è¯¯ï¼‰</strong>ï¼šå¦‚æœåŸºç±»æ²¡æœ‰è™šå‡½æ•°ï¼Œæ— æ³•ä½¿ç”¨ <code>dynamic_cast</code>ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> {};  <span class="hljs-comment">// æ²¡æœ‰è™šå‡½æ•°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">public</span> Base {};

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    std::unique_ptr&lt;Base&gt; ptr = std::<span class="hljs-built_in">make_unique</span>&lt;Derived&gt;();
    Derived* d = <span class="hljs-built_in">dynamic_cast</span>&lt;Derived*&gt;(ptr.<span class="hljs-built_in">get</span>());  <span class="hljs-comment">// ç¼–è¯‘é”™è¯¯ï¼šBase ä¸æ˜¯å¤šæ€ç±»å‹</span>
}
</code></pre>
<p><strong>ç»§æ‰¿æœ‰è™šå‡½æ•°çš„ç±»ï¼ˆæ­£å¸¸å·¥ä½œï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Base</span>() = <span class="hljs-keyword">default</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">derivedMethod</span><span class="hljs-params">()</span> </span>{}
};

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    std::unique_ptr&lt;Base&gt; ptr = std::<span class="hljs-built_in">make_unique</span>&lt;Derived&gt;();

    <span class="hljs-comment">// å‘ä¸‹è½¬æ¢æˆåŠŸ</span>
    Derived* d = <span class="hljs-built_in">dynamic_cast</span>&lt;Derived*&gt;(ptr.<span class="hljs-built_in">get</span>());  <span class="hljs-comment">// è¿”å› Derived*</span>
    <span class="hljs-keyword">if</span> (d) {
        d-&gt;<span class="hljs-built_in">derivedMethod</span>();
    }

    <span class="hljs-comment">// è‡ªåŠ¨é‡Šæ”¾</span>
}
</code></pre>
<p>åº•å±‚å®ç°ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ç¼–è¯‘å™¨ç”Ÿæˆçš„ä¼ªä»£ç ï¼š</span>
<span class="hljs-comment">// 1. è·å–æºå¯¹è±¡çš„ type_info</span>
<span class="hljs-type">const</span> std::type_info* src_type = <span class="hljs-built_in">get_type_info</span>(ptr);

<span class="hljs-comment">// 2. è·å–ç›®æ ‡ç±»å‹çš„ type_info</span>
<span class="hljs-type">const</span> std::type_info* dst_type = &amp;<span class="hljs-built_in">typeid</span>(Derived);

<span class="hljs-comment">// 3. è°ƒç”¨è¿è¡Œæ—¶åº“å‡½æ•°</span>
<span class="hljs-type">void</span>* result = __dynamic_cast(
    ptr,          <span class="hljs-comment">// æºæŒ‡é’ˆ</span>
    src_type,     <span class="hljs-comment">// æºç±»å‹</span>
    dst_type,     <span class="hljs-comment">// ç›®æ ‡ç±»å‹</span>
    <span class="hljs-number">-1</span>            <span class="hljs-comment">// åç§»é‡</span>
);

<span class="hljs-comment">// 4. æ¯”è¾ƒç±»å‹æ˜¯å¦åŒ¹é…ï¼Œè®¡ç®—æŒ‡é’ˆåç§»</span>
</code></pre>
<p><strong>å†…å­˜ä¸æ€§èƒ½å¯¹æ¯”</strong></p>





























<table><thead><tr><th>æƒ…å†µ</th><th>å¯¹è±¡å†…å­˜å¼€é”€</th><th>æ€§èƒ½å¼€é”€</th><th>èƒ½å¦ä½¿ç”¨ dynamic_cast</th></tr></thead><tbody><tr><td>åŸºç±»æ— è™šå‡½æ•°</td><td>æ— é¢å¤–å¼€é”€</td><td>-</td><td>å¦ï¼ˆç¼–è¯‘é”™è¯¯ï¼‰</td></tr><tr><td>å•ç»§æ‰¿ã€æµ…å±‚æ¬¡</td><td>+8 å­—èŠ‚ï¼ˆvptrï¼‰</td><td>2-3 æ¬¡å†…å­˜è®¿é—®ï¼ˆvptr â†’ type_info â†’ æ¯”è¾ƒï¼‰</td><td>æ˜¯</td></tr><tr><td>å¤šé‡ç»§æ‰¿ã€æ·±å±‚ç»§æ‰¿</td><td>+8 å­—èŠ‚ï¼ˆvptrï¼‰</td><td>å¤šæ¬¡å†…å­˜è®¿é—®ï¼ˆéœ€éå†ç»§æ‰¿é“¾ã€è®¡ç®—åç§»ï¼‰</td><td>æ˜¯</td></tr></tbody></table>
<p>å¤šé‡ç»§æ‰¿å’Œæ·±å±‚ç»§æ‰¿çš„æ€§èƒ½å¼€é”€æ›´é«˜çš„åŸå› ï¼š</p>
<ul>
<li><strong>æ·±å±‚ç»§æ‰¿</strong>ï¼šéœ€è¦éå†ä»å­ç±»åˆ°åŸºç±»çš„ç»§æ‰¿é“¾ï¼Œé€å±‚æ¯”è¾ƒç±»å‹ä¿¡æ¯</li>
<li><strong>å¤šé‡ç»§æ‰¿</strong>ï¼šéœ€è¦è®¡ç®—ä¸åŒåŸºç±»å­å¯¹è±¡çš„æŒ‡é’ˆåç§»é‡ï¼Œå¯èƒ½æ¶‰åŠå¤šä¸ª vtable æŸ¥æ‰¾</li>
</ul>
<h4 data-id="heading-5">std::any</h4>
<p><code>std::any</code> é€šè¿‡ç±»å‹æ“¦é™¤æŠ€æœ¯å®ç°ç±»å‹è¯†åˆ«ï¼Œå†…éƒ¨é€šè¿‡å‡½æ•°æŒ‡é’ˆå’Œ RTTI é…åˆå·¥ä½œï¼Œæ— è®ºå­˜å‚¨çš„ç±»å‹æ˜¯å¦æœ‰è™šå‡½æ•°ã€‚</p>
<p><strong>å®ç°æœºåˆ¶</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// std::any çš„ç®€åŒ–å®ç°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">any</span> {
    <span class="hljs-keyword">union</span> <span class="hljs-title class_">Storage</span> {
        <span class="hljs-type">void</span>* heap_ptr;              <span class="hljs-comment">// å¤§å¯¹è±¡ä½¿ç”¨å †åˆ†é…</span>
        <span class="hljs-built_in">alignas</span>(<span class="hljs-number">8</span>) <span class="hljs-type">char</span> buffer[<span class="hljs-number">16</span>];  <span class="hljs-comment">// å°å¯¹è±¡ä½¿ç”¨æ ˆç¼“å†²åŒºï¼ˆSBOï¼‰</span>
    } storage_;

    <span class="hljs-comment">// æ“ä½œå‡½æ•°æŒ‡é’ˆï¼ˆé€šè¿‡è¿™äº›å‡½æ•°é—´æ¥è®¿é—® type_infoï¼‰</span>
    <span class="hljs-built_in">void</span> (*destroy_)(Storage&amp;);
    <span class="hljs-built_in">void</span> (*copy_)(Storage&amp;, <span class="hljs-type">const</span> Storage&amp;);
    <span class="hljs-type">const</span> std::type_info&amp; (*get_type_)();  <span class="hljs-comment">// è·å–ç±»å‹ä¿¡æ¯çš„å‡½æ•°æŒ‡é’ˆ</span>

<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    <span class="hljs-title">any</span><span class="hljs-params">(T&amp;&amp; value)</span> </span>{
        <span class="hljs-comment">// ä¸ºæ¯ä¸ªç±»å‹ T ç”Ÿæˆç‰¹åŒ–çš„å‡½æ•°</span>
        get_type_ = []() -&gt; <span class="hljs-type">const</span> std::type_info&amp; {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">typeid</span>(T);  <span class="hljs-comment">// ä¾èµ– RTTI</span>
        };
        <span class="hljs-comment">// ... å…¶ä»–åˆå§‹åŒ–</span>
    }

    <span class="hljs-function"><span class="hljs-type">const</span> std::type_info&amp; <span class="hljs-title">type</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">get_type_</span>();  <span class="hljs-comment">// é€šè¿‡å‡½æ•°æŒ‡é’ˆè·å– type_info</span>
    }
};
</code></pre>
<p><strong>ä½¿ç”¨ç¤ºä¾‹</strong></p>
<pre><code class="hljs language-cpp" lang="cpp">std::any value = <span class="hljs-number">42</span>;  <span class="hljs-comment">// å­˜å‚¨ int</span>

<span class="hljs-comment">// any_cast å®ç°</span>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
T <span class="hljs-title">any_cast</span><span class="hljs-params">(<span class="hljs-type">const</span> any&amp; operand)</span> </span>{
    <span class="hljs-comment">// æ¯”è¾ƒ type_info</span>
    <span class="hljs-keyword">if</span> (operand.<span class="hljs-built_in">type</span>() != <span class="hljs-built_in">typeid</span>(T)) {
        <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">bad_any_cast</span>();
    }
    <span class="hljs-keyword">return</span> *<span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">const</span> T*&gt;(&amp;operand.storage_);
}

<span class="hljs-type">int</span> x = <span class="hljs-built_in">any_cast</span>&lt;<span class="hljs-type">int</span>&gt;(value);  <span class="hljs-comment">// OK</span>
<span class="hljs-type">double</span> d = <span class="hljs-built_in">any_cast</span>&lt;<span class="hljs-type">double</span>&gt;(value);  <span class="hljs-comment">// æŠ›å‡º bad_any_cast</span>
</code></pre>
<p><strong>å†…å­˜å¼€é”€</strong></p>
<p><code>std::any</code> å¯¹è±¡æœ¬èº«çš„å¤§å°å›ºå®šä¸º 32-48 å­—èŠ‚ï¼ŒåŒ…å«ï¼š</p>
<ul>
<li>type_info æŒ‡é’ˆï¼ˆ8 å­—èŠ‚ï¼‰</li>
<li>å­˜å‚¨ç©ºé—´ï¼ˆ16-24 å­—èŠ‚ï¼Œç”¨äºå°å¯¹è±¡ä¼˜åŒ–ï¼‰</li>
<li>å‡½æ•°æŒ‡é’ˆï¼ˆ8-16 å­—èŠ‚ï¼Œç”¨äºææ„ã€æ‹·è´ç­‰æ“ä½œï¼‰</li>
</ul>
<p>å­˜å‚¨æ•°æ®æ—¶çš„å†…å­˜åˆ†é…ï¼š</p>
<ul>
<li><strong>å°å¯¹è±¡</strong>ï¼ˆâ‰¤16 å­—èŠ‚ï¼‰ï¼šä½¿ç”¨å†…éƒ¨æ ˆç¼“å†²åŒºï¼Œæ— é¢å¤–å †åˆ†é…</li>
<li><strong>å¤§å¯¹è±¡</strong>ï¼ˆ&gt;16 å­—èŠ‚ï¼‰ï¼šä½¿ç”¨å †åˆ†é…ï¼Œéœ€è¦é¢å¤–å†…å­˜</li>
</ul>
<pre><code class="hljs language-cpp" lang="cpp">std::any a1 = <span class="hljs-number">42</span>;                    <span class="hljs-comment">// int (4å­—èŠ‚)ï¼Œæ ˆç¼“å†²åŒº</span>
std::any a2 = std::<span class="hljs-built_in">string</span>(<span class="hljs-string">"hello"</span>);  <span class="hljs-comment">// string (&gt;16å­—èŠ‚)ï¼Œå †åˆ†é…</span>
</code></pre>
<p><strong>æ€§èƒ½å¼€é”€</strong></p>
<p>ç±»å‹æ£€æŸ¥ï¼šæ¯”è¾ƒ type_info æŒ‡é’ˆï¼ˆ1 æ¬¡æŒ‡é’ˆæ¯”è¾ƒï¼‰</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">if</span> (operand.type_ != &amp;<span class="hljs-built_in">typeid</span>(T)) {  <span class="hljs-comment">// æŒ‡é’ˆæ¯”è¾ƒ</span>
    <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">bad_any_cast</span>();
}
</code></pre>
<h3 data-id="heading-6">æ›¿ä»£æ–¹æ¡ˆä¸€ï¼šç¼–è¯‘æœŸç±»å‹è¯†åˆ«ï¼ˆæ›¿ä»£ typeid å’Œ dynamic_castï¼‰</h3>
<p>ç¼–è¯‘æœŸç±»å‹è¯†åˆ«é€šè¿‡æ¨¡æ¿å’Œ <code>if constexpr</code> åœ¨ç¼–è¯‘æœŸç¡®å®šç±»å‹ï¼Œå®Œå…¨æ¶ˆé™¤è¿è¡Œæ—¶å¼€é”€ã€‚é€‚åˆç±»å‹åœ¨ç¼–è¯‘æœŸå·²çŸ¥çš„åœºæ™¯ã€‚</p>
<p><strong>ä½¿ç”¨ if constexpr è¿›è¡Œç±»å‹åˆ†å‘</strong></p>
<p><code>if constexpr</code>(C++17) æ ¹æ®ç¼–è¯‘æœŸæ¡ä»¶é€‰æ‹©ä»£ç åˆ†æ”¯ï¼Œæœªé€‰ä¸­çš„åˆ†æ”¯ä¸ä¼šç”Ÿæˆä»£ç ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;type_traits&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-type">void</span> <span class="hljs-title">process</span><span class="hljs-params">(T value)</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">if</span> <span class="hljs-title">constexpr</span> <span class="hljs-params">(std::is_integral_v&lt;T&gt;)</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"Integer: "</span> &lt;&lt; value &lt;&lt; std::endl;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-built_in">constexpr</span> (std::is_floating_point_v&lt;T&gt;) {
        std::cout &lt;&lt; <span class="hljs-string">"Float: "</span> &lt;&lt; value &lt;&lt; std::endl;
    } <span class="hljs-keyword">else</span> {
        std::cout &lt;&lt; <span class="hljs-string">"Other type"</span> &lt;&lt; std::endl;
    }
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-built_in">process</span>(<span class="hljs-number">42</span>);      <span class="hljs-comment">// ç¼–è¯‘æœŸé€‰æ‹©ç¬¬ä¸€ä¸ªåˆ†æ”¯</span>
    <span class="hljs-built_in">process</span>(<span class="hljs-number">3.14</span>);    <span class="hljs-comment">// ç¼–è¯‘æœŸé€‰æ‹©ç¬¬äºŒä¸ªåˆ†æ”¯</span>
    <span class="hljs-built_in">process</span>(<span class="hljs-string">"hello"</span>); <span class="hljs-comment">// ç¼–è¯‘æœŸé€‰æ‹©ç¬¬ä¸‰ä¸ªåˆ†æ”¯</span>
}
</code></pre>
<p>ç¼–è¯‘å™¨ä¸ºæ¯ä¸ªç±»å‹ç”Ÿæˆç‰¹åŒ–ä»£ç ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// process&lt;int&gt; ç”Ÿæˆçš„ä»£ç ï¼ˆç®€åŒ–ï¼‰</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">process_int</span><span class="hljs-params">(<span class="hljs-type">int</span> value)</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"Integer: "</span> &lt;&lt; value &lt;&lt; std::endl;
    <span class="hljs-comment">// å…¶ä»–åˆ†æ”¯çš„ä»£ç è¢«å®Œå…¨ä¸¢å¼ƒ</span>
}

<span class="hljs-comment">// process&lt;double&gt; ç”Ÿæˆçš„ä»£ç ï¼ˆç®€åŒ–ï¼‰</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">process_double</span><span class="hljs-params">(<span class="hljs-type">double</span> value)</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"Float: "</span> &lt;&lt; value &lt;&lt; std::endl;
    <span class="hljs-comment">// å…¶ä»–åˆ†æ”¯çš„ä»£ç è¢«å®Œå…¨ä¸¢å¼ƒ</span>
}
</code></pre>
<p><strong>ä½¿ç”¨ CRTP å®ç°ç¼–è¯‘æœŸå¤šæ€</strong></p>
<p>CRTP(Curiously Recurring Template Pattern) é€šè¿‡æ¨¡æ¿ç»§æ‰¿å®ç°ç¼–è¯‘æœŸå¤šæ€ï¼Œæ›¿ä»£è™šå‡½æ•°ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// CRTP åŸºç±»</span>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Derived&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">area</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-comment">// ç¼–è¯‘æœŸè½¬æ¢ä¸ºæ´¾ç”Ÿç±»ï¼Œé™æ€åˆ†å‘</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">const</span> Derived*&gt;(<span class="hljs-keyword">this</span>)-&gt;<span class="hljs-built_in">areaImpl</span>();
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> : <span class="hljs-keyword">public</span> Shape&lt;Circle&gt; {
    <span class="hljs-type">double</span> radius_;
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Circle</span>(<span class="hljs-type">double</span> r) : <span class="hljs-built_in">radius_</span>(r) {}
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">areaImpl</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-number">3.14159</span> * radius_ * radius_;
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> : <span class="hljs-keyword">public</span> Shape&lt;Rectangle&gt; {
    <span class="hljs-type">double</span> width_, height_;
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Rectangle</span>(<span class="hljs-type">double</span> w, <span class="hljs-type">double</span> h) : <span class="hljs-built_in">width_</span>(w), <span class="hljs-built_in">height_</span>(h) {}
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">areaImpl</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> width_ * height_;
    }
};

<span class="hljs-comment">// æ¨¡æ¿å‡½æ•°å¤„ç†ä¸åŒç±»å‹</span>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> ShapeType&gt;
<span class="hljs-type">void</span> <span class="hljs-title">printArea</span><span class="hljs-params">(<span class="hljs-type">const</span> Shape&lt;ShapeType&gt;&amp; shape)</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"Area: "</span> &lt;&lt; shape.<span class="hljs-built_in">area</span>() &lt;&lt; std::endl;
    <span class="hljs-comment">// ç¼–è¯‘æœŸç¡®å®šè°ƒç”¨ Circle::areaImpl æˆ– Rectangle::areaImpl</span>
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">Circle <span class="hljs-title">c</span><span class="hljs-params">(<span class="hljs-number">5.0</span>)</span></span>;
    <span class="hljs-function">Rectangle <span class="hljs-title">r</span><span class="hljs-params">(<span class="hljs-number">3.0</span>, <span class="hljs-number">4.0</span>)</span></span>;

    <span class="hljs-built_in">printArea</span>(c);  <span class="hljs-comment">// ç¼–è¯‘å™¨å®ä¾‹åŒ– printArea&lt;Circle&gt;</span>
    <span class="hljs-built_in">printArea</span>(r);  <span class="hljs-comment">// ç¼–è¯‘å™¨å®ä¾‹åŒ– printArea&lt;Rectangle&gt;</span>
}
</code></pre>
<p><strong>å†…å­˜ä¸æ€§èƒ½å¯¹æ¯”</strong></p>























<table><thead><tr><th>æ–¹æ¡ˆ</th><th>å¯¹è±¡å†…å­˜å¼€é”€</th><th>æ€§èƒ½å¼€é”€</th><th>è¿è¡Œæ—¶å¤šæ€</th></tr></thead><tbody><tr><td>RTTI (<code>dynamic_cast</code>)</td><td>+8 å­—èŠ‚ vptr</td><td>å¤šæ¬¡å†…å­˜è®¿é—®</td><td>æ”¯æŒ</td></tr><tr><td>ç¼–è¯‘æœŸç±»å‹è¯†åˆ«</td><td>æ— é¢å¤–å¼€é”€</td><td>é›¶å¼€é”€ï¼ˆç›´æ¥è°ƒç”¨ï¼‰</td><td>ä¸æ”¯æŒ</td></tr></tbody></table>
<h3 data-id="heading-7">æ›¿ä»£æ–¹æ¡ˆäºŒï¼šè‡ªå®šä¹‰ç±»å‹ ID ç³»ç»Ÿï¼ˆæ›¿ä»£ dynamic_castï¼‰</h3>
<p>è‡ªå®šä¹‰ç±»å‹ ID ç³»ç»Ÿé€šè¿‡ä¸ºæ¯ä¸ªç±»åˆ†é…å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œåœ¨è¿è¡Œæ—¶è¿›è¡Œç±»å‹åŒ¹é…ï¼Œæ€§èƒ½ä¼˜äº <code>dynamic_cast</code>ã€‚</p>
<p><strong>åŸºç¡€å®ç°</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ç±»å‹ ID æšä¸¾</span>
<span class="hljs-keyword">enum class</span> <span class="hljs-title class_">TypeID</span> {
    Base,
    Derived1,
    Derived2,
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> {
<span class="hljs-keyword">protected</span>:
    TypeID type_id_;

    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Base</span><span class="hljs-params">(TypeID id)</span> : type_id_(id) {</span>}

<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Base</span>() = <span class="hljs-keyword">default</span>;

    <span class="hljs-function">TypeID <span class="hljs-title">getTypeID</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> type_id_; }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived1</span> : <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Derived1</span>() : <span class="hljs-built_in">Base</span>(TypeID::Derived1) {}

    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">derived1Method</span><span class="hljs-params">()</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"Derived1 method"</span> &lt;&lt; std::endl;
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived2</span> : <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Derived2</span>() : <span class="hljs-built_in">Base</span>(TypeID::Derived2) {}

    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">derived2Method</span><span class="hljs-params">()</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"Derived2 method"</span> &lt;&lt; std::endl;
    }
};

<span class="hljs-comment">// ç±»å‹å®‰å…¨çš„å‘ä¸‹è½¬æ¢</span>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Derived, TypeID ID&gt;
Derived* <span class="hljs-title">cast</span><span class="hljs-params">(Base* base)</span> </span>{
    <span class="hljs-keyword">if</span> (base &amp;&amp; base-&gt;<span class="hljs-built_in">getTypeID</span>() == ID) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">static_cast</span>&lt;Derived*&gt;(base);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">process</span><span class="hljs-params">(Base* base)</span> </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">auto</span>* d1 = <span class="hljs-built_in">cast</span>&lt;Derived1, TypeID::Derived1&gt;(base)) {
        d1-&gt;<span class="hljs-built_in">derived1Method</span>();
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">auto</span>* d2 = <span class="hljs-built_in">cast</span>&lt;Derived2, TypeID::Derived2&gt;(base)) {
        d2-&gt;<span class="hljs-built_in">derived2Method</span>();
    }
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    std::unique_ptr&lt;Base&gt; ptr = std::<span class="hljs-built_in">make_unique</span>&lt;Derived1&gt;();
    <span class="hljs-built_in">process</span>(ptr.<span class="hljs-built_in">get</span>());  <span class="hljs-comment">// è¾“å‡ºï¼šDerived1 method</span>
}
</code></pre>
<p><strong>è‡ªåŠ¨ç”Ÿæˆç±»å‹ ID</strong></p>
<p>ä½¿ç”¨é™æ€è®¡æ•°å™¨è‡ªåŠ¨ä¸ºæ¯ä¸ªç±»åˆ†é…å”¯ä¸€ IDï¼Œé¿å…æ‰‹åŠ¨ç»´æŠ¤æšä¸¾ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> {
    <span class="hljs-keyword">using</span> TypeIDValue = <span class="hljs-type">uint32_t</span>;

<span class="hljs-keyword">protected</span>:
    TypeIDValue type_id_;

    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Base</span><span class="hljs-params">(TypeIDValue id)</span> : type_id_(id) {</span>}

    <span class="hljs-comment">// é™æ€ç±»å‹ ID ç”Ÿæˆå™¨</span>
    <span class="hljs-function"><span class="hljs-type">static</span> TypeIDValue <span class="hljs-title">nextTypeID</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">static</span> TypeIDValue next_id = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">return</span> next_id++;
    }

<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Base</span>() = <span class="hljs-keyword">default</span>;

    <span class="hljs-function">TypeIDValue <span class="hljs-title">getTypeID</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> type_id_; }

    <span class="hljs-comment">// è·å–ç±»å‹çš„é™æ€ ID</span>
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    <span class="hljs-type">static</span> TypeIDValue <span class="hljs-title">getStaticTypeID</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">static</span> TypeIDValue id = <span class="hljs-built_in">nextTypeID</span>();
        <span class="hljs-keyword">return</span> id;
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived1</span> : <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Derived1</span>() : <span class="hljs-built_in">Base</span>(<span class="hljs-built_in">getStaticTypeID</span>&lt;Derived1&gt;()) {}
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived2</span> : <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Derived2</span>() : <span class="hljs-built_in">Base</span>(<span class="hljs-built_in">getStaticTypeID</span>&lt;Derived2&gt;()) {}
};

<span class="hljs-comment">// ç±»å‹å®‰å…¨çš„å‘ä¸‹è½¬æ¢</span>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Derived&gt;
Derived* <span class="hljs-title">cast</span><span class="hljs-params">(Base* base)</span> </span>{
    <span class="hljs-keyword">if</span> (base &amp;&amp; base-&gt;<span class="hljs-built_in">getTypeID</span>() == Base::<span class="hljs-built_in">getStaticTypeID</span>&lt;Derived&gt;()) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">static_cast</span>&lt;Derived*&gt;(base);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">process</span><span class="hljs-params">(Base* base)</span> </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">auto</span>* d1 = <span class="hljs-built_in">cast</span>&lt;Derived1&gt;(base)) {
        d1-&gt;<span class="hljs-built_in">derived1Method</span>();
    }
}
</code></pre>
<p><strong>å†…å­˜ä¸æ€§èƒ½å¯¹æ¯”</strong></p>























<table><thead><tr><th>æ–¹æ¡ˆ</th><th>å¯¹è±¡å†…å­˜å¼€é”€</th><th>æ€§èƒ½å¼€é”€</th><th>è¿è¡Œæ—¶å¤šæ€</th></tr></thead><tbody><tr><td><code>dynamic_cast</code></td><td>+8 å­—èŠ‚ vptr</td><td>å¤šæ¬¡å†…å­˜è®¿é—®</td><td>æ”¯æŒ</td></tr><tr><td>è‡ªå®šä¹‰ç±»å‹ ID</td><td>+4 å­—èŠ‚ <code>type_id_</code></td><td>1 æ¬¡æ•´æ•°æ¯”è¾ƒ</td><td>æ”¯æŒ</td></tr></tbody></table>
<h3 data-id="heading-8">æ›¿ä»£æ–¹æ¡ˆä¸‰ï¼šstd::variantï¼ˆæ›¿ä»£ std::any å’Œè¿è¡Œæ—¶ç±»å‹åˆ‡æ¢ï¼‰</h3>
<p><code>std::variant</code>(C++17) æ˜¯ç±»å‹å®‰å…¨çš„è”åˆä½“ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æœŸç¡®å®šçš„ç±»å‹é›†åˆä¸­å­˜å‚¨ä»»æ„ä¸€ä¸ªï¼Œæ€§èƒ½ä¼˜äº <code>std::any</code>ã€‚</p>
<p><strong>åŸºç¡€ç”¨æ³•</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;variant&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-comment">// å®šä¹‰å¯èƒ½çš„ç±»å‹é›†åˆ</span>
<span class="hljs-keyword">using</span> Data = std::variant&lt;<span class="hljs-type">int</span>, <span class="hljs-type">double</span>, std::string&gt;;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    Data value;

    value = <span class="hljs-number">42</span>;
    std::cout &lt;&lt; std::<span class="hljs-built_in">get</span>&lt;<span class="hljs-type">int</span>&gt;(value) &lt;&lt; std::endl;  <span class="hljs-comment">// è¾“å‡ºï¼š42</span>

    value = <span class="hljs-number">3.14</span>;
    std::cout &lt;&lt; std::<span class="hljs-built_in">get</span>&lt;<span class="hljs-type">double</span>&gt;(value) &lt;&lt; std::endl;  <span class="hljs-comment">// è¾“å‡ºï¼š3.14</span>

    value = std::<span class="hljs-built_in">string</span>(<span class="hljs-string">"hello"</span>);
    std::cout &lt;&lt; std::<span class="hljs-built_in">get</span>&lt;std::string&gt;(value) &lt;&lt; std::endl;  <span class="hljs-comment">// è¾“å‡ºï¼šhello</span>
}
</code></pre>
<p><strong>å†…å­˜å¸ƒå±€</strong></p>
<p><code>std::variant</code> çš„å¤§å°ç­‰äºæœ€å¤§ç±»å‹çš„å¤§å°åŠ ä¸Šç´¢å¼•å­—èŠ‚ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Small</span> { <span class="hljs-type">char</span> c; };          <span class="hljs-comment">// 1 å­—èŠ‚</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Medium</span> { <span class="hljs-type">int</span> i; };          <span class="hljs-comment">// 4 å­—èŠ‚</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Large</span> { <span class="hljs-type">double</span> d[<span class="hljs-number">10</span>]; };    <span class="hljs-comment">// 80 å­—èŠ‚</span>

<span class="hljs-keyword">using</span> V = std::variant&lt;Small, Medium, Large&gt;;

<span class="hljs-comment">// sizeof(V) = 80 (Large) + padding + ç´¢å¼•</span>
<span class="hljs-comment">// é€šå¸¸æ˜¯ 88 å­—èŠ‚</span>
</code></pre>
<p><strong>å†…å­˜ä¸æ€§èƒ½å¯¹æ¯”</strong></p>























<table><thead><tr><th>æ–¹æ¡ˆ</th><th>å¯¹è±¡å†…å­˜å¼€é”€</th><th>æ€§èƒ½å¼€é”€</th><th>ç±»å‹é›†åˆ</th></tr></thead><tbody><tr><td><code>std::any</code></td><td>32-48 å­—èŠ‚ï¼ˆå›ºå®šï¼‰</td><td>æŒ‡é’ˆæ¯”è¾ƒ</td><td>ä»»æ„ç±»å‹</td></tr><tr><td><code>std::variant</code></td><td>æœ€å¤§ç±»å‹å¤§å° + ç´¢å¼•</td><td>æ•´æ•°æ¯”è¾ƒï¼ˆç´¢å¼•ï¼‰</td><td>ç¼–è¯‘æœŸç¡®å®š</td></tr></tbody></table>
<h2 data-id="heading-9">ç¦ç”¨å¼‚å¸¸æ•è·</h2>
<p>C++ å¼‚å¸¸æ•è·æ¶‰åŠæ ˆå±•å¼€(Stack Unwinding)ã€RTTI æŸ¥è¯¢ã€å†…å­˜åˆ†é…ç­‰æ“ä½œï¼Œåœ¨é«˜æ€§èƒ½ç³»ç»Ÿä¸­å¸¦æ¥æ˜¾è‘—è¿è¡Œæ—¶å¼€é”€ã€‚ä½¿ç”¨ç¼–è¯‘é€‰é¡¹ <code>-fno-exceptions</code> ç¦ç”¨å¼‚å¸¸å¤„ç†åï¼Œä¸èƒ½ä½¿ç”¨ <code>try-catch</code> è¯­å¥ï¼Œä»è€Œæ¶ˆé™¤å¼‚å¸¸æ•è·çš„è¿è¡Œæ—¶ä»£ä»·ã€‚</p>
<h3 data-id="heading-10">å¼‚å¸¸æ•è·ç®€è¿°</h3>
<p>C++ å¼‚å¸¸å¤„ç†(Exception Handling)å…è®¸åœ¨æ£€æµ‹åˆ°é”™è¯¯çš„ä½ç½®æŠ›å‡ºå¼‚å¸¸(throw)ï¼Œåœ¨è°ƒç”¨æ ˆçš„ä¸Šå±‚æ•è·(catch)å¹¶å¤„ç†ã€‚å¼‚å¸¸ä¼šè‡ªåŠ¨æ²¿è°ƒç”¨æ ˆå‘ä¸Šä¼ æ’­ï¼Œç›´åˆ°è¢«æ•è·æˆ–å¯¼è‡´ç¨‹åºç»ˆæ­¢ã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdexcept&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">divide</span><span class="hljs-params">(<span class="hljs-type">double</span> a, <span class="hljs-type">double</span> b)</span> </span>{
    <span class="hljs-keyword">if</span> (b == <span class="hljs-number">0.0</span>) {
        <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">runtime_error</span>(<span class="hljs-string">"Division by zero"</span>);  <span class="hljs-comment">// æŠ›å‡ºå¼‚å¸¸</span>
    }
    <span class="hljs-keyword">return</span> a / b;
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">double</span> result = <span class="hljs-built_in">divide</span>(<span class="hljs-number">10.0</span>, <span class="hljs-number">0.0</span>);
        std::cout &lt;&lt; <span class="hljs-string">"Result: "</span> &lt;&lt; result &lt;&lt; std::endl;
    } <span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> std::runtime_error&amp; e) {  <span class="hljs-comment">// æ•è·å¼‚å¸¸</span>
        std::cerr &lt;&lt; <span class="hljs-string">"Error: "</span> &lt;&lt; e.<span class="hljs-built_in">what</span>() &lt;&lt; std::endl;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>å¼‚å¸¸ä¼ æ’­è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è°ƒç”¨æ ˆä¸Šæ‰€æœ‰å±€éƒ¨å¯¹è±¡çš„ææ„å‡½æ•°(Stack Unwinding)ï¼Œç¡®ä¿èµ„æºæ­£ç¡®é‡Šæ”¾ã€‚</p>
<h3 data-id="heading-11">åº•å±‚å®ç°ä¸å¼€é”€åˆ†æ</h3>
<p>å¼‚å¸¸å¤„ç†çš„æ€§èƒ½å¼€é”€ä¸»è¦æ¥è‡ªä¸‰ä¸ªæ–¹é¢ï¼šæ ˆå±•å¼€(Stack Unwinding)ã€RTTI ç±»å‹åŒ¹é…å’Œå¼‚å¸¸å¯¹è±¡åˆ†é…ã€‚</p>
<p><strong>æ ˆå±•å¼€æœºåˆ¶</strong></p>
<p>å½“å¼‚å¸¸æŠ›å‡ºåï¼Œè¿è¡Œæ—¶ç³»ç»Ÿéœ€è¦æ²¿è°ƒç”¨æ ˆå‘ä¸ŠæŸ¥æ‰¾åŒ¹é…çš„ catch å—ï¼ŒåŒæ—¶è°ƒç”¨æ ˆä¸Šæ‰€æœ‰å±€éƒ¨å¯¹è±¡çš„ææ„å‡½æ•°ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Resource</span> {
    <span class="hljs-type">int</span> id_;
    <span class="hljs-built_in">Resource</span>(<span class="hljs-type">int</span> id) : <span class="hljs-built_in">id_</span>(id) {
        std::cout &lt;&lt; <span class="hljs-string">"Resource "</span> &lt;&lt; id_ &lt;&lt; <span class="hljs-string">" acquired\n"</span>;
    }
    ~<span class="hljs-built_in">Resource</span>() {
        std::cout &lt;&lt; <span class="hljs-string">"Resource "</span> &lt;&lt; id_ &lt;&lt; <span class="hljs-string">" released\n"</span>;
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">level3</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">Resource <span class="hljs-title">r3</span><span class="hljs-params">(<span class="hljs-number">3</span>)</span></span>;
    <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">runtime_error</span>(<span class="hljs-string">"Error"</span>);
    <span class="hljs-comment">// r3 çš„ææ„å‡½æ•°ä¼šè¢«è°ƒç”¨</span>
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">level2</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">Resource <span class="hljs-title">r2</span><span class="hljs-params">(<span class="hljs-number">2</span>)</span></span>;
    <span class="hljs-built_in">level3</span>();
    <span class="hljs-comment">// r2 çš„ææ„å‡½æ•°ä¼šè¢«è°ƒç”¨</span>
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">level1</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">Resource <span class="hljs-title">r1</span><span class="hljs-params">(<span class="hljs-number">1</span>)</span></span>;
    <span class="hljs-keyword">try</span> {
        <span class="hljs-built_in">level2</span>();
    } <span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> std::exception&amp; e) {
        std::cout &lt;&lt; <span class="hljs-string">"Caught: "</span> &lt;&lt; e.<span class="hljs-built_in">what</span>() &lt;&lt; <span class="hljs-string">"\n"</span>;
    }
    <span class="hljs-comment">// r1 æ­£å¸¸ææ„</span>
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-built_in">level1</span>();
    <span class="hljs-comment">// è¾“å‡ºé¡ºåºï¼š</span>
    <span class="hljs-comment">// Resource 1 acquired</span>
    <span class="hljs-comment">// Resource 2 acquired</span>
    <span class="hljs-comment">// Resource 3 acquired</span>
    <span class="hljs-comment">// Resource 3 released  (æ ˆå±•å¼€)</span>
    <span class="hljs-comment">// Resource 2 released  (æ ˆå±•å¼€)</span>
    <span class="hljs-comment">// Caught: Error</span>
    <span class="hljs-comment">// Resource 1 released  (æ­£å¸¸ææ„)</span>
}
</code></pre>
<p>æ ˆå±•å¼€çš„åº•å±‚å®ç°ä¾èµ–ç¼–è¯‘å™¨ç”Ÿæˆçš„å…ƒæ•°æ®è¡¨ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ç¼–è¯‘å™¨ç”Ÿæˆçš„æ ˆå±•å¼€è¡¨ï¼ˆä¼ªä»£ç ï¼‰</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">UnwindEntry</span> {
    <span class="hljs-type">void</span>* function_start;    <span class="hljs-comment">// å‡½æ•°èµ·å§‹åœ°å€</span>
    <span class="hljs-type">void</span>* function_end;      <span class="hljs-comment">// å‡½æ•°ç»“æŸåœ°å€</span>
    <span class="hljs-type">void</span>* lsda;              <span class="hljs-comment">// Language Specific Data Areaï¼ˆææ„å‡½æ•°åˆ—è¡¨ï¼‰</span>
    <span class="hljs-type">void</span>* personality;       <span class="hljs-comment">// å¼‚å¸¸å¤„ç†å‡½æ•°æŒ‡é’ˆ</span>
};
</code></pre>
<p>å½“å¼‚å¸¸æŠ›å‡ºæ—¶ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li><strong>æŸ¥æ‰¾æ ˆå±•å¼€è¡¨</strong>ï¼šæ ¹æ®å½“å‰æŒ‡ä»¤åœ°å€æŸ¥æ‰¾å¯¹åº”çš„ UnwindEntry</li>
<li><strong>è°ƒç”¨ææ„å‡½æ•°</strong>ï¼šæŒ‰ LSDA è®°å½•çš„é¡ºåºè°ƒç”¨å±€éƒ¨å¯¹è±¡çš„ææ„å‡½æ•°</li>
<li><strong>æ¢å¤æ ˆå¸§</strong>ï¼šæ¢å¤å¯„å­˜å™¨çŠ¶æ€ï¼Œè·³è½¬åˆ°ä¸Šä¸€å±‚è°ƒç”¨è€…</li>
<li><strong>é‡å¤æ­¥éª¤ 1-3</strong>ï¼šç›´åˆ°æ‰¾åˆ°åŒ¹é…çš„ catch å—</li>
</ol>
<p><strong>RTTI ç±»å‹åŒ¹é…</strong></p>
<p>catch å—éœ€è¦åœ¨è¿è¡Œæ—¶åˆ¤æ–­å¼‚å¸¸å¯¹è±¡æ˜¯å¦åŒ¹é…ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-built_in">DerivedError</span>();
} <span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> BaseError&amp; e) {     <span class="hljs-comment">// åŒ¹é…ï¼ˆæ´¾ç”Ÿç±» â†’ åŸºç±»ï¼‰</span>
    <span class="hljs-comment">// å¤„ç†å¼‚å¸¸</span>
} <span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> OtherError&amp; e) {    <span class="hljs-comment">// ä¸åŒ¹é…</span>
    <span class="hljs-comment">// ä¸æ‰§è¡Œ</span>
}
</code></pre>
<p>ç±»å‹åŒ¹é…ä¾èµ– RTTIï¼Œè¿è¡Œæ—¶ç³»ç»Ÿéœ€è¦ï¼š</p>
<ol>
<li>è·å–å¼‚å¸¸å¯¹è±¡çš„ type_infoï¼ˆé€šè¿‡ vptrï¼‰</li>
<li>é€ä¸ªæ¯”è¾ƒ catch å—çš„ç›®æ ‡ç±»å‹</li>
<li>æ£€æŸ¥ç»§æ‰¿å…³ç³»ï¼ˆå¦‚æœç›®æ ‡æ˜¯åŸºç±»ï¼‰</li>
</ol>
<p><strong>å¼‚å¸¸å¯¹è±¡åˆ†é…</strong></p>
<p>æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿéœ€è¦åœ¨å †ä¸Šåˆ†é…å¼‚å¸¸å¯¹è±¡çš„å‰¯æœ¬ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">throwException</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">LargeException <span class="hljs-title">ex</span><span class="hljs-params">(<span class="hljs-comment">/* å¤§é‡æ•°æ® */</span>)</span></span>;
    <span class="hljs-keyword">throw</span> ex;  <span class="hljs-comment">// å¤åˆ¶ ex åˆ°å †ä¸Š</span>
    <span class="hljs-comment">// ex çš„æ ˆå†…å­˜ä¼šè¢«é‡Šæ”¾ï¼ˆæ ˆå±•å¼€ï¼‰</span>
}
</code></pre>
<p>å¼‚å¸¸å¯¹è±¡åˆ†é…çš„å¼€é”€ï¼š</p>
<ul>
<li><strong>å†…å­˜åˆ†é…</strong>ï¼šè°ƒç”¨ <code>__cxa_allocate_exception</code>ï¼ˆç±»ä¼¼ mallocï¼‰</li>
<li><strong>å¯¹è±¡æ„é€ </strong>ï¼šè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°æˆ–ç§»åŠ¨æ„é€ å‡½æ•°</li>
<li><strong>å†…å­˜é‡Šæ”¾</strong>ï¼šå¼‚å¸¸å¤„ç†å®Œæˆåè°ƒç”¨ <code>__cxa_free_exception</code></li>
</ul>
<p><strong>æ€§èƒ½å¼€é”€æ€»ç»“</strong></p>






























<table><thead><tr><th>æ“ä½œ</th><th>å¼€é”€ç±»å‹</th><th>å½±å“èŒƒå›´</th></tr></thead><tbody><tr><td>æ ˆå±•å¼€</td><td>å¤šæ¬¡å†…å­˜è®¿é—®ï¼ˆæŸ¥è¡¨ã€è°ƒç”¨ææ„å‡½æ•°ï¼‰</td><td>æ‰€æœ‰è°ƒç”¨å±‚çº§</td></tr><tr><td>ç±»å‹åŒ¹é…</td><td>RTTI æŸ¥è¯¢ã€ç±»å‹æ¯”è¾ƒ</td><td>æ¯ä¸ª catch å—</td></tr><tr><td>å¯¹è±¡åˆ†é…</td><td>å †åˆ†é…ã€æ‹·è´æ„é€ ã€é‡Šæ”¾</td><td>æ¯æ¬¡ throw</td></tr><tr><td>äºŒè¿›åˆ¶è†¨èƒ€</td><td>æ ˆå±•å¼€è¡¨ã€LSDA å…ƒæ•°æ®</td><td>å¢åŠ  5-15% ä½“ç§¯</td></tr></tbody></table>
<p>å³ä½¿æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šç”Ÿæˆæ ˆå±•å¼€è¡¨å’Œå¼‚å¸¸å¤„ç†ä»£ç ï¼Œå¢åŠ äºŒè¿›åˆ¶ä½“ç§¯å’ŒæŒ‡ä»¤ç¼“å­˜å‹åŠ›ã€‚</p>
<h3 data-id="heading-12">æ›¿ä»£æ–¹æ¡ˆï¼šç›´æ¥ç»ˆæ­¢ç¨‹åº</h3>
<p>æ£€æµ‹åˆ°é”™è¯¯æ—¶ç›´æ¥è°ƒç”¨ <code>std::abort()</code> ç»ˆæ­¢ç¨‹åºï¼Œé¿å…å¼‚å¸¸æ•è·çš„æ ˆå±•å¼€ã€RTTI æŸ¥è¯¢å’Œå†…å­˜åˆ†é…å¼€é”€ã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdlib&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">divide</span><span class="hljs-params">(<span class="hljs-type">double</span> a, <span class="hljs-type">double</span> b)</span> </span>{
    <span class="hljs-keyword">if</span> (b == <span class="hljs-number">0.0</span>) {
        std::cerr &lt;&lt; <span class="hljs-string">"Fatal error: Division by zero\n"</span>;
        std::<span class="hljs-built_in">abort</span>();  <span class="hljs-comment">// ç«‹å³ç»ˆæ­¢ç¨‹åº</span>
    }
    <span class="hljs-keyword">return</span> a / b;
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">double</span> result = <span class="hljs-built_in">divide</span>(<span class="hljs-number">10.0</span>, <span class="hljs-number">0.0</span>);
    std::cout &lt;&lt; <span class="hljs-string">"Result: "</span> &lt;&lt; result &lt;&lt; std::endl;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>è¿™ç§ç­–ç•¥å°†é”™è¯¯è§†ä¸ºè‡´å‘½é”™è¯¯(Fatal Error)ï¼Œé€‚åˆé«˜æ€§èƒ½è®¡ç®—ã€åµŒå…¥å¼ç³»ç»Ÿç­‰å¯¹æ€§èƒ½æåº¦æ•æ„Ÿçš„åœºæ™¯ã€‚</p>
<h2 data-id="heading-13">é¿å…ä½¿ç”¨è™šå‡½æ•°</h2>
<p>è™šå‡½æ•°é€šè¿‡è™šå‡½æ•°è¡¨(vtable)å®ç°è¿è¡Œæ—¶å¤šæ€ï¼Œä½†æ¯ä¸ªå¯¹è±¡éœ€è¦é¢å¤–å­˜å‚¨ vptr æŒ‡é’ˆï¼ˆ8 å­—èŠ‚ï¼‰ï¼Œæ¯æ¬¡è™šå‡½æ•°è°ƒç”¨éœ€è¦ä¸¤æ¬¡å†…å­˜é—´æ¥è®¿é—®ï¼Œä¸”é˜»æ­¢ç¼–è¯‘å™¨å†…è”ä¼˜åŒ–ã€‚æœ¬ç« åˆ†æè™šå‡½æ•°çš„åº•å±‚å®ç°å’Œæ€§èƒ½å¼€é”€ï¼Œå¹¶æä¾› CRTPã€æ¨¡æ¿ã€std::variantã€std::function ç­‰æ›¿ä»£æ–¹æ¡ˆã€‚</p>
<h3 data-id="heading-14">è™šå‡½æ•°ç®€è¿°</h3>
<p>è™šå‡½æ•°(Virtual Function)å…è®¸é€šè¿‡åŸºç±»æŒ‡é’ˆæˆ–å¼•ç”¨è°ƒç”¨æ´¾ç”Ÿç±»çš„é‡å†™å‡½æ•°ï¼Œå®ç°è¿è¡Œæ—¶å¤šæ€(Runtime Polymorphism)ã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">double</span> <span class="hljs-title">area</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;  <span class="hljs-comment">// çº¯è™šå‡½æ•°</span>
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Shape</span>() = <span class="hljs-keyword">default</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> : <span class="hljs-keyword">public</span> Shape {
    <span class="hljs-type">double</span> radius_;
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Circle</span>(<span class="hljs-type">double</span> r) : <span class="hljs-built_in">radius_</span>(r) {}
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">area</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-number">3.14159</span> * radius_ * radius_;
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> : <span class="hljs-keyword">public</span> Shape {
    <span class="hljs-type">double</span> width_, height_;
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Rectangle</span>(<span class="hljs-type">double</span> w, <span class="hljs-type">double</span> h) : <span class="hljs-built_in">width_</span>(w), <span class="hljs-built_in">height_</span>(h) {}
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">area</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> width_ * height_;
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">printArea</span><span class="hljs-params">(<span class="hljs-type">const</span> Shape&amp; shape)</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"Area: "</span> &lt;&lt; shape.<span class="hljs-built_in">area</span>() &lt;&lt; std::endl;  <span class="hljs-comment">// è¿è¡Œæ—¶ç¡®å®šè°ƒç”¨å“ªä¸ªå‡½æ•°</span>
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">Circle <span class="hljs-title">c</span><span class="hljs-params">(<span class="hljs-number">5.0</span>)</span></span>;
    <span class="hljs-function">Rectangle <span class="hljs-title">r</span><span class="hljs-params">(<span class="hljs-number">3.0</span>, <span class="hljs-number">4.0</span>)</span></span>;

    <span class="hljs-built_in">printArea</span>(c);  <span class="hljs-comment">// è¾“å‡ºï¼šArea: 78.5398</span>
    <span class="hljs-built_in">printArea</span>(r);  <span class="hljs-comment">// è¾“å‡ºï¼šArea: 12</span>

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>è™šå‡½æ•°çš„å…³é”®ç‰¹æ€§ï¼š</p>
<ul>
<li>é€šè¿‡åŸºç±»æŒ‡é’ˆæˆ–å¼•ç”¨ç»Ÿä¸€ç®¡ç†ä¸åŒæ´¾ç”Ÿç±»å¯¹è±¡</li>
<li>è¿è¡Œæ—¶æ ¹æ®å¯¹è±¡çš„å®é™…ç±»å‹é€‰æ‹©è°ƒç”¨çš„å‡½æ•°</li>
<li>ä¾èµ–è™šå‡½æ•°è¡¨(vtable)å’Œè™šè¡¨æŒ‡é’ˆ(vptr)å®ç°</li>
</ul>
<h3 data-id="heading-15">åº•å±‚å®ç°ä¸å¼€é”€åˆ†æ</h3>
<p>è™šå‡½æ•°çš„å®ç°ä¾èµ–è™šå‡½æ•°è¡¨(vtable)å’Œè™šè¡¨æŒ‡é’ˆ(vptr)ã€‚</p>
<p><strong>vtable å’Œ vptr</strong></p>
<p>ç¼–è¯‘å™¨ä¸ºæ¯ä¸ªåŒ…å«è™šå‡½æ•°çš„ç±»ç”Ÿæˆä¸€ä¸ª vtableï¼Œå­˜å‚¨è¯¥ç±»æ‰€æœ‰è™šå‡½æ•°çš„åœ°å€ã€‚æ¯ä¸ªå¯¹è±¡åŒ…å«ä¸€ä¸ª vptrï¼ŒæŒ‡å‘å…¶ç±»çš„ vtableã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">func1</span><span class="hljs-params">()</span> </span>{}
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">func2</span><span class="hljs-params">()</span> </span>{}
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func1</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>{}  <span class="hljs-comment">// é‡å†™ func1</span>
};
</code></pre>
<p>å†…å­˜å¸ƒå±€ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// Base vtable</span>
Base::vtable = { &amp;Base::func1, &amp;Base::func2 };

<span class="hljs-comment">// Derived vtable</span>
Derived::vtable = { &amp;Derived::func1, &amp;Base::func2 };

<span class="hljs-comment">// å¯¹è±¡å†…å­˜å¸ƒå±€</span>
Base obj1:     [vptr â†’ Base::vtable]
Derived obj2:  [vptr â†’ Derived::vtable]
</code></pre>
<p><strong>è™šå‡½æ•°è°ƒç”¨è¿‡ç¨‹</strong>ï¼šè™šå‡½æ•°è°ƒç”¨æ¶‰åŠä¸¤æ¬¡å†…å­˜é—´æ¥è®¿é—®ï¼Œæ™®é€šå‡½æ•°è°ƒç”¨æ˜¯ç›´æ¥è°ƒç”¨ã€‚</p>
<p><strong>æ±‡ç¼–ä»£ç å¯¹æ¯”</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// æ™®é€šå‡½æ•°è°ƒç”¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Simple</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">()</span> </span>{ <span class="hljs-comment">/* ... */</span> }
};

Simple obj;
obj.<span class="hljs-built_in">func</span>();

<span class="hljs-comment">// ç”Ÿæˆçš„æ±‡ç¼–ï¼ˆç®€åŒ–ï¼‰ï¼š</span>
<span class="hljs-comment">// call Simple::func  // ç›´æ¥è°ƒç”¨ï¼Œåœ°å€åœ¨ç¼–è¯‘æœŸç¡®å®š</span>
</code></pre>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// è™šå‡½æ•°è°ƒç”¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">()</span> </span>{ <span class="hljs-comment">/* ... */</span> }
};

Base* ptr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Derived</span>();
ptr-&gt;<span class="hljs-built_in">func</span>();

<span class="hljs-comment">// ç”Ÿæˆçš„æ±‡ç¼–ï¼ˆç®€åŒ–ï¼‰ï¼š</span>
<span class="hljs-comment">// mov rax, [ptr]        ; 1. è¯»å– vptrï¼ˆç¬¬ä¸€æ¬¡å†…å­˜è®¿é—®ï¼‰</span>
<span class="hljs-comment">// mov rax, [rax]        ; 2. è¯»å– vtable[0]ï¼ˆç¬¬äºŒæ¬¡å†…å­˜è®¿é—®ï¼‰</span>
<span class="hljs-comment">// call rax              ; 3. é—´æ¥è°ƒç”¨</span>
</code></pre>
<p><strong>æ€§èƒ½å¼€é”€æ€»ç»“</strong></p>





























<table><thead><tr><th>é¡¹ç›®</th><th>å¼€é”€</th></tr></thead><tbody><tr><td>å¯¹è±¡å†…å­˜</td><td>+8 å­—èŠ‚ vptrï¼ˆ64 ä½ç³»ç»Ÿï¼‰</td></tr><tr><td>è°ƒç”¨å¼€é”€</td><td>2 æ¬¡å†…å­˜é—´æ¥è®¿é—®</td></tr><tr><td>å†…è”ä¼˜åŒ–</td><td>é€šå¸¸æ— æ³•å†…è”ï¼ˆé™¤éç¼–è¯‘å™¨èƒ½å»è™šåŒ–ï¼‰</td></tr><tr><td>ç¼“å­˜å‹å¥½æ€§</td><td>vtable å¯èƒ½ä¸åœ¨ç¼“å­˜ä¸­ï¼Œå¢åŠ ç¼“å­˜æœªå‘½ä¸­</td></tr><tr><td>äºŒè¿›åˆ¶ä½“ç§¯</td><td>æ¯ä¸ªç±»å¢åŠ  vtableï¼ˆN ä¸ªè™šå‡½æ•° Ã— 8 å­—èŠ‚ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-16">æ›¿ä»£æ–¹æ¡ˆä¸€ï¼šç¼–è¯‘æœŸå¤šæ€ï¼ˆCRTP å’Œç­–ç•¥æ¨¡å¼ï¼‰</h3>
<p>ç¼–è¯‘æœŸå¤šæ€é€šè¿‡æ¨¡æ¿åœ¨ç¼–è¯‘æœŸç¡®å®šè°ƒç”¨çš„å‡½æ•°ï¼Œæ¶ˆé™¤è™šå‡½æ•°çš„è¿è¡Œæ—¶å¼€é”€ã€‚</p>
<p><strong>CRTPï¼ˆå¥‡å¼‚é€’å½’æ¨¡æ¿æ¨¡å¼ï¼‰</strong></p>
<p>CRTP é€šè¿‡æ¨¡æ¿ç»§æ‰¿å®ç°ç¼–è¯‘æœŸå¤šæ€ï¼ŒåŸºç±»æ¨¡æ¿å‚æ•°æ˜¯æ´¾ç”Ÿç±»æœ¬èº«ã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// CRTP åŸºç±»</span>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Derived&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">area</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-comment">// ç¼–è¯‘æœŸè½¬æ¢ä¸ºæ´¾ç”Ÿç±»ï¼Œé™æ€åˆ†å‘</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">const</span> Derived*&gt;(<span class="hljs-keyword">this</span>)-&gt;<span class="hljs-built_in">areaImpl</span>();
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> : <span class="hljs-keyword">public</span> Shape&lt;Circle&gt; {
    <span class="hljs-type">double</span> radius_;
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Circle</span>(<span class="hljs-type">double</span> r) : <span class="hljs-built_in">radius_</span>(r) {}
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">areaImpl</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-number">3.14159</span> * radius_ * radius_;
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> : <span class="hljs-keyword">public</span> Shape&lt;Rectangle&gt; {
    <span class="hljs-type">double</span> width_, height_;
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Rectangle</span>(<span class="hljs-type">double</span> w, <span class="hljs-type">double</span> h) : <span class="hljs-built_in">width_</span>(w), <span class="hljs-built_in">height_</span>(h) {}
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">areaImpl</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> width_ * height_;
    }
};

<span class="hljs-comment">// æ¨¡æ¿å‡½æ•°å¤„ç†ä¸åŒç±»å‹</span>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> ShapeType&gt;
<span class="hljs-type">void</span> <span class="hljs-title">printArea</span><span class="hljs-params">(<span class="hljs-type">const</span> Shape&lt;ShapeType&gt;&amp; shape)</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"Area: "</span> &lt;&lt; shape.<span class="hljs-built_in">area</span>() &lt;&lt; std::endl;
    <span class="hljs-comment">// ç¼–è¯‘æœŸç¡®å®šè°ƒç”¨ Circle::areaImpl æˆ– Rectangle::areaImpl</span>
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">Circle <span class="hljs-title">c</span><span class="hljs-params">(<span class="hljs-number">5.0</span>)</span></span>;
    <span class="hljs-function">Rectangle <span class="hljs-title">r</span><span class="hljs-params">(<span class="hljs-number">3.0</span>, <span class="hljs-number">4.0</span>)</span></span>;

    <span class="hljs-built_in">printArea</span>(c);  <span class="hljs-comment">// ç¼–è¯‘å™¨å®ä¾‹åŒ– printArea&lt;Circle&gt;</span>
    <span class="hljs-built_in">printArea</span>(r);  <span class="hljs-comment">// ç¼–è¯‘å™¨å®ä¾‹åŒ– printArea&lt;Rectangle&gt;</span>
}
</code></pre>
<p>åº•å±‚å®ç°ï¼šç¼–è¯‘å™¨ä¸ºæ¯ä¸ªæ´¾ç”Ÿç±»ç”Ÿæˆç‰¹åŒ–ä»£ç ï¼Œ<code>area()</code> è°ƒç”¨åœ¨ç¼–è¯‘æœŸè§£æä¸ºç›´æ¥å‡½æ•°è°ƒç”¨ï¼Œå¯ä»¥å†…è”ã€‚</p>
<p><strong>ç­–ç•¥æ¨¡å¼ï¼ˆæ¨¡æ¿å‚æ•°ï¼‰</strong></p>
<p>å°†è¡Œä¸ºä½œä¸ºæ¨¡æ¿å‚æ•°ä¼ é€’ï¼Œå®ç°ç¼–è¯‘æœŸç­–ç•¥é€‰æ‹©ã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ç­–ç•¥æ¥å£ï¼ˆç¼–è¯‘æœŸï¼‰</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">FastStrategy</span> {
    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title">compute</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> </span>{ <span class="hljs-keyword">return</span> x * <span class="hljs-number">2</span>; }
};

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">PreciseStrategy</span> {
    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title">compute</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> </span>{ <span class="hljs-keyword">return</span> x * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>; }
};

<span class="hljs-comment">// ä½¿ç”¨ç­–ç•¥</span>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Strategy&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Processor</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">process</span><span class="hljs-params">(<span class="hljs-type">int</span> value)</span> </span>{
        <span class="hljs-keyword">return</span> Strategy::<span class="hljs-built_in">compute</span>(value);  <span class="hljs-comment">// ç¼–è¯‘æœŸç¡®å®šè°ƒç”¨å“ªä¸ªå‡½æ•°</span>
    }
};

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    Processor&lt;FastStrategy&gt; p1;
    Processor&lt;PreciseStrategy&gt; p2;

    std::cout &lt;&lt; p1.<span class="hljs-built_in">process</span>(<span class="hljs-number">10</span>) &lt;&lt; std::endl;  <span class="hljs-comment">// è¾“å‡ºï¼š20</span>
    std::cout &lt;&lt; p2.<span class="hljs-built_in">process</span>(<span class="hljs-number">10</span>) &lt;&lt; std::endl;  <span class="hljs-comment">// è¾“å‡ºï¼š21</span>
}
</code></pre>
<p>ç¼–è¯‘æœŸå¤šæ€çš„é™åˆ¶ï¼š</p>
<ul>
<li><strong>æ— æ³•ç”¨åŸºç±»æŒ‡é’ˆç»Ÿä¸€ç®¡ç†</strong>ï¼š<code>Shape&lt;Circle&gt;*</code> å’Œ <code>Shape&lt;Rectangle&gt;*</code> æ˜¯ä¸åŒç±»å‹ï¼Œæ— æ³•å­˜å‚¨åœ¨åŒä¸€ä¸ªå®¹å™¨ä¸­</li>
<li><strong>æ— è¿è¡Œæ—¶å¤šæ€</strong>ï¼šç±»å‹å¿…é¡»åœ¨ç¼–è¯‘æœŸç¡®å®šï¼Œæ— æ³•æ ¹æ®è¿è¡Œæ—¶æ¡ä»¶é€‰æ‹©ç±»å‹</li>
</ul>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ç¼–è¯‘é”™è¯¯ï¼šShape&lt;Circle&gt; å’Œ Shape&lt;Rectangle&gt; æ˜¯ä¸åŒç±»å‹</span>
Shape&lt;Circle&gt;* ptr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Rectangle</span>(<span class="hljs-number">3.0</span>, <span class="hljs-number">4.0</span>);  <span class="hljs-comment">// é”™è¯¯</span>

<span class="hljs-comment">// æ— æ³•ä½¿ç”¨åŸºç±»æŒ‡é’ˆå®¹å™¨</span>
std::vector&lt;Shape&lt;???&gt;*&gt; shapes;  <span class="hljs-comment">// æ— æ³•è¡¨è¾¾</span>
</code></pre>
<p><strong>æ€§èƒ½å¯¹æ¯”</strong></p>


























<table><thead><tr><th>æ–¹æ¡ˆ</th><th>å¯¹è±¡å†…å­˜</th><th>è°ƒç”¨å¼€é”€</th><th>å†…è”ä¼˜åŒ–</th><th>è¿è¡Œæ—¶å¤šæ€</th></tr></thead><tbody><tr><td>è™šå‡½æ•°</td><td>+8 å­—èŠ‚</td><td>2 æ¬¡å†…å­˜é—´æ¥è®¿é—®</td><td>ä¸å¯å†…è”</td><td>æ”¯æŒ</td></tr><tr><td>CRTP/ç­–ç•¥æ¨¡å¼</td><td>æ— é¢å¤–</td><td>ç›´æ¥è°ƒç”¨</td><td>å¯å†…è”</td><td>ä¸æ”¯æŒ</td></tr></tbody></table>
<h3 data-id="heading-17">æ›¿ä»£æ–¹æ¡ˆäºŒï¼šstd::variant</h3>
<p><code>std::variant</code>(C++17) æ˜¯ç±»å‹å®‰å…¨çš„è”åˆä½“ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æœŸç¡®å®šçš„ç±»å‹é›†åˆä¸­å­˜å‚¨ä»»æ„ä¸€ä¸ªï¼Œç»“åˆ <code>std::visit</code> å®ç°ç±»å‹å®‰å…¨çš„å¤šæ€ã€‚</p>
<p><strong>åŸºç¡€ç”¨æ³•</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;variant&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> {
    <span class="hljs-type">double</span> radius_;
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Circle</span>(<span class="hljs-type">double</span> r) : <span class="hljs-built_in">radius_</span>(r) {}
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">area</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-number">3.14159</span> * radius_ * radius_;
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> {
    <span class="hljs-type">double</span> width_, height_;
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Rectangle</span>(<span class="hljs-type">double</span> w, <span class="hljs-type">double</span> h) : <span class="hljs-built_in">width_</span>(w), <span class="hljs-built_in">height_</span>(h) {}
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">area</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> width_ * height_;
    }
};

<span class="hljs-comment">// å®šä¹‰å¯èƒ½çš„ç±»å‹é›†åˆ</span>
<span class="hljs-keyword">using</span> Shape = std::variant&lt;Circle, Rectangle&gt;;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// ç»Ÿä¸€å­˜å‚¨ä¸åŒç±»å‹</span>
    std::vector&lt;Shape&gt; shapes;
    shapes.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">Circle</span>(<span class="hljs-number">5.0</span>));
    shapes.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">Rectangle</span>(<span class="hljs-number">3.0</span>, <span class="hljs-number">4.0</span>));

    <span class="hljs-comment">// ä½¿ç”¨ std::visit å¤„ç†</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; shape : shapes) {
        std::<span class="hljs-built_in">visit</span>([](<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; s) {
            std::cout &lt;&lt; <span class="hljs-string">"Area: "</span> &lt;&lt; s.<span class="hljs-built_in">area</span>() &lt;&lt; std::endl;
        }, shape);
    }
}
</code></pre>
<p><strong>åº•å±‚å®ç°ï¼ˆç®€åŒ–è¯´æ˜ï¼‰</strong></p>
<p><code>std::variant</code> å†…éƒ¨ä½¿ç”¨ union å­˜å‚¨æ•°æ®ï¼Œå¹¶ç»´æŠ¤ä¸€ä¸ªç´¢å¼•æ ‡è¯†å½“å‰å­˜å‚¨çš„ç±»å‹ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ç®€åŒ–çš„ variant å®ç°ï¼ˆæ¦‚å¿µæ€§è¯´æ˜ï¼‰</span>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span>... Types&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">variant</span> {
    <span class="hljs-keyword">union</span> <span class="hljs-title class_">Storage</span> {
        <span class="hljs-comment">// å­˜å‚¨æ‰€æœ‰å¯èƒ½çš„ç±»å‹</span>
    } storage_;

    <span class="hljs-type">size_t</span> index_;  <span class="hljs-comment">// å½“å‰ç±»å‹çš„ç´¢å¼•ï¼ˆ0, 1, 2...ï¼‰</span>
};
</code></pre>
<p>ç±»å‹åˆ†å‘é€šè¿‡ç´¢å¼•è¿›è¡Œè·³è½¬ã€‚å®é™…çš„ <code>std::visit</code> å®ç°è¿œæ¯”è¿™é‡Œå±•ç¤ºçš„å¤æ‚ï¼Œæ¶‰åŠè·³è½¬è¡¨ä¼˜åŒ–ã€ç¼–è¯‘æœŸåˆ†æ”¯æ¶ˆé™¤ç­‰æŠ€æœ¯ï¼Œä»¥ä¸‹æ˜¯æ¦‚å¿µæ€§è¯´æ˜ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// std::visit çš„ç®€åŒ–å®ç°ï¼ˆæ¦‚å¿µæ€§è¯´æ˜ï¼‰</span>
<span class="hljs-keyword">switch</span> (variant.index_) {
    <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>: <span class="hljs-keyword">return</span> <span class="hljs-built_in">visitor</span>(std::<span class="hljs-built_in">get</span>&lt;<span class="hljs-number">0</span>&gt;(variant));  <span class="hljs-comment">// Circle</span>
    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-keyword">return</span> <span class="hljs-built_in">visitor</span>(std::<span class="hljs-built_in">get</span>&lt;<span class="hljs-number">1</span>&gt;(variant));  <span class="hljs-comment">// Rectangle</span>
}
</code></pre>
<p><strong>å¼€é”€å¯¹æ¯”</strong></p>


























<table><thead><tr><th>æ–¹æ¡ˆ</th><th>å¯¹è±¡å†…å­˜</th><th>è°ƒç”¨å¼€é”€</th><th>å†…è”ä¼˜åŒ–</th><th>è¿è¡Œæ—¶å¤šæ€</th></tr></thead><tbody><tr><td>è™šå‡½æ•°</td><td>+8 å­—èŠ‚ vptr</td><td>2 æ¬¡å†…å­˜è®¿é—®</td><td>ä¸å¯å†…è”</td><td>æ”¯æŒ</td></tr><tr><td><code>std::variant</code></td><td>æœ€å¤§ç±»å‹å¤§å° + ç´¢å¼•(8B)</td><td>switch è·³è½¬ï¼Œç¼–è¯‘å™¨ä¼˜åŒ–</td><td>å¯èƒ½å†…è”</td><td>æ”¯æŒ</td></tr></tbody></table>
<h3 data-id="heading-18">æ›¿ä»£æ–¹æ¡ˆä¸‰ï¼šstd::function</h3>
<p><code>std::function</code>(C++11) æ˜¯é€šç”¨å‡½æ•°åŒ…è£…å™¨ï¼Œå¯ä»¥å­˜å‚¨ä»»æ„å¯è°ƒç”¨å¯¹è±¡ï¼ˆå‡½æ•°æŒ‡é’ˆã€lambdaã€å‡½æ•°å¯¹è±¡ï¼‰ï¼Œå®ç°è¡Œä¸ºçº§åˆ«çš„å¤šæ€ã€‚</p>
<p><strong>åŸºç¡€ç”¨æ³•</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;functional&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">circleArea</span><span class="hljs-params">(<span class="hljs-type">double</span> radius)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-number">3.14159</span> * radius * radius;
}

<span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">rectangleArea</span><span class="hljs-params">(<span class="hljs-type">double</span> width, <span class="hljs-type">double</span> height)</span> </span>{
    <span class="hljs-keyword">return</span> width * height;
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">using</span> AreaCalculator = std::function&lt;<span class="hljs-built_in">double</span>()&gt;;
    std::vector&lt;AreaCalculator&gt; calculators;

    <span class="hljs-comment">// ä½¿ç”¨ lambda æ•è·å‚æ•°</span>
    calculators.<span class="hljs-built_in">push_back</span>([]() { <span class="hljs-keyword">return</span> <span class="hljs-built_in">circleArea</span>(<span class="hljs-number">5.0</span>); });
    calculators.<span class="hljs-built_in">push_back</span>([]() { <span class="hljs-keyword">return</span> <span class="hljs-built_in">rectangleArea</span>(<span class="hljs-number">3.0</span>, <span class="hljs-number">4.0</span>); });

    <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; calc : calculators) {
        std::cout &lt;&lt; <span class="hljs-string">"Area: "</span> &lt;&lt; <span class="hljs-built_in">calc</span>() &lt;&lt; std::endl;
    }
}
</code></pre>
<p><strong>åº•å±‚å®ç°</strong></p>
<p><code>std::function</code> ä½¿ç”¨ç±»å‹æ“¦é™¤(Type Erasure)ï¼Œå†…éƒ¨å­˜å‚¨å‡½æ•°æŒ‡é’ˆå’Œå¯è°ƒç”¨å¯¹è±¡ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ç®€åŒ–çš„ std::function å®ç°</span>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> R, <span class="hljs-keyword">typename</span>... Args&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">function</span>&lt;<span class="hljs-built_in">R</span>(Args...)&gt; {
    <span class="hljs-type">void</span>* callable_;  <span class="hljs-comment">// æŒ‡å‘å¯è°ƒç”¨å¯¹è±¡</span>
    <span class="hljs-built_in">R</span> (*invoker_)(<span class="hljs-type">void</span>*, Args...);  <span class="hljs-comment">// è°ƒç”¨é€‚é…å™¨</span>

<span class="hljs-keyword">public</span>:
    <span class="hljs-function">R <span class="hljs-title">operator</span><span class="hljs-params">()</span><span class="hljs-params">(Args... args)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">invoker_</span>(callable_, std::forward&lt;Args&gt;(args)...);
    }
};
</code></pre>
<p><strong>å¼€é”€å¯¹æ¯”</strong></p>





























<table><thead><tr><th>æ–¹æ¡ˆ</th><th>å¯¹è±¡å†…å­˜</th><th>è°ƒç”¨å¼€é”€</th><th>å†…è”ä¼˜åŒ–</th></tr></thead><tbody><tr><td>è™šå‡½æ•°</td><td>+8 å­—èŠ‚</td><td>2 æ¬¡å†…å­˜è®¿é—®</td><td>ä¸å¯å†…è”</td></tr><tr><td><code>std::function</code></td><td>32-48 å­—èŠ‚</td><td>1 æ¬¡å‡½æ•°æŒ‡é’ˆé—´æ¥è°ƒç”¨</td><td>ä¸å¯å†…è”</td></tr><tr><td>å‡½æ•°æŒ‡é’ˆ</td><td>8 å­—èŠ‚</td><td>1 æ¬¡å‡½æ•°æŒ‡é’ˆé—´æ¥è°ƒç”¨</td><td>ä¸å¯å†…è”</td></tr></tbody></table>
<p><code>std::function</code> é€‚åˆå›è°ƒã€äº‹ä»¶å¤„ç†ç­‰åœºæ™¯ï¼Œä½†å†…å­˜å¼€é”€å¤§ï¼Œä¸é€‚åˆæ€§èƒ½å…³é”®è·¯å¾„ã€‚</p>
<h2 data-id="heading-19">æ¨èä½¿ç”¨æ³›å‹ç¼–ç¨‹</h2>
<p>æ³›å‹ç¼–ç¨‹é€šè¿‡æ¨¡æ¿åœ¨ç¼–è¯‘æœŸç”Ÿæˆç‰¹åŒ–ä»£ç ï¼Œå®ç°é›¶è¿è¡Œæ—¶å¼€é”€çš„ç±»å‹æŠ½è±¡ã€‚ç¼–è¯‘å™¨å¯ä»¥å†…è”ã€å¸¸é‡æŠ˜å å’Œæ­»ä»£ç æ¶ˆé™¤ç­‰ä¼˜åŒ–ï¼Œæ€§èƒ½ç­‰åŒç”šè‡³ä¼˜äºæ‰‹å†™ä»£ç ã€‚æœ¬ç« ä»‹ç»æ¨¡æ¿çš„æ€§èƒ½ä¼˜åŠ¿ã€ç¼–è¯‘æœŸè®¡ç®—ã€constexpr å’Œæ¨¡æ¿å…ƒç¼–ç¨‹ç­‰æŠ€æœ¯ã€‚</p>
<h3 data-id="heading-20">æ³›å‹ç¼–ç¨‹ç®€è¿°</h3>
<p>æ³›å‹ç¼–ç¨‹(Generic Programming)é€šè¿‡æ¨¡æ¿å‚æ•°åŒ–ç±»å‹ï¼Œç¼–å†™ä¸ç±»å‹æ— å…³çš„ä»£ç ã€‚ç¼–è¯‘å™¨ä¸ºæ¯ä¸ªä½¿ç”¨çš„ç±»å‹ç”Ÿæˆç‰¹åŒ–ä»£ç ã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// å‡½æ•°æ¨¡æ¿</span>
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
T <span class="hljs-title">max</span><span class="hljs-params">(T a, T b)</span> </span>{
    <span class="hljs-keyword">return</span> (a &gt; b) ? a : b;
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">int</span> i = <span class="hljs-built_in">max</span>(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>);        <span class="hljs-comment">// ç¼–è¯‘å™¨ç”Ÿæˆ max&lt;int&gt;</span>
    <span class="hljs-type">double</span> d = <span class="hljs-built_in">max</span>(<span class="hljs-number">3.14</span>, <span class="hljs-number">2.71</span>); <span class="hljs-comment">// ç¼–è¯‘å™¨ç”Ÿæˆ max&lt;double&gt;</span>
}
</code></pre>
<p>ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆï¼ˆç®€åŒ–ï¼‰</span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">max_int</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> </span>{
    <span class="hljs-keyword">return</span> (a &gt; b) ? a : b;
}

<span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">max_double</span><span class="hljs-params">(<span class="hljs-type">double</span> a, <span class="hljs-type">double</span> b)</span> </span>{
    <span class="hljs-keyword">return</span> (a &gt; b) ? a : b;
}
</code></pre>
<h3 data-id="heading-21">æ€§èƒ½ä¼˜åŠ¿</h3>
<p>æ¨¡æ¿ä»£ç åœ¨ç¼–è¯‘æœŸå®Œå…¨å±•å¼€ï¼Œç¼–è¯‘å™¨å¯ä»¥è¿›è¡Œæ¿€è¿›ä¼˜åŒ–ã€‚</p>
<p><strong>å†…è”ä¼˜åŒ–</strong></p>
<p>æ¨¡æ¿å‡½æ•°è‡ªåŠ¨å†…è”ï¼Œæ¶ˆé™¤å‡½æ•°è°ƒç”¨å¼€é”€ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">inline</span> T <span class="hljs-title">square</span><span class="hljs-params">(T x)</span> </span>{
    <span class="hljs-keyword">return</span> x * x;
}

<span class="hljs-type">int</span> result = <span class="hljs-built_in">square</span>(<span class="hljs-number">5</span>);  <span class="hljs-comment">// ç¼–è¯‘å™¨ç›´æ¥ç”Ÿæˆï¼šint result = 25;</span>
</code></pre>
<p><strong>å¸¸é‡æŠ˜å </strong></p>
<p>ç¼–è¯‘æœŸè®¡ç®—å¸¸é‡è¡¨è¾¾å¼ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-type">int</span> N&gt;
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Factorial</span> {
    <span class="hljs-type">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> value = N * Factorial&lt;N - <span class="hljs-number">1</span>&gt;::value;
};

<span class="hljs-keyword">template</span>&lt;&gt;
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Factorial</span>&lt;<span class="hljs-number">0</span>&gt; {
    <span class="hljs-type">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> value = <span class="hljs-number">1</span>;
};

<span class="hljs-type">int</span> x = Factorial&lt;<span class="hljs-number">5</span>&gt;::value;  <span class="hljs-comment">// ç¼–è¯‘æœŸè®¡ç®—ä¸º 120</span>
</code></pre>
<p><strong>æ­»ä»£ç æ¶ˆé™¤</strong></p>
<p>ç¼–è¯‘å™¨ç§»é™¤æœªä½¿ç”¨çš„åˆ†æ”¯ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-type">bool</span> UseCache&gt;
<span class="hljs-type">int</span> <span class="hljs-title">compute</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">if</span> <span class="hljs-title">constexpr</span> <span class="hljs-params">(UseCache)</span> </span>{
        <span class="hljs-keyword">return</span> cachedValue;  <span class="hljs-comment">// ä½¿ç”¨ç¼“å­˜</span>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> x * x;        <span class="hljs-comment">// ç›´æ¥è®¡ç®—</span>
    }
}

<span class="hljs-type">int</span> a = <span class="hljs-built_in">compute</span>&lt;<span class="hljs-literal">false</span>&gt;(<span class="hljs-number">10</span>);  <span class="hljs-comment">// ç¼–è¯‘å™¨åªç”Ÿæˆ return x * x</span>
</code></pre>
<h3 data-id="heading-22">constexpr å’Œç¼–è¯‘æœŸè®¡ç®—</h3>
<p><code>constexpr</code>(C++11) æ ‡è®°çš„å‡½æ•°å’Œå˜é‡åœ¨ç¼–è¯‘æœŸè®¡ç®—ï¼Œç”Ÿæˆå¸¸é‡ï¼Œè¿è¡Œæ—¶é›¶å¼€é”€ã€‚</p>
<p><strong>constexpr å‡½æ•°</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;array&gt;</span></span>

<span class="hljs-function"><span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> <span class="hljs-title">factorial</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> </span>{
    <span class="hljs-keyword">return</span> (n &lt;= <span class="hljs-number">1</span>) ? <span class="hljs-number">1</span> : n * <span class="hljs-built_in">factorial</span>(n - <span class="hljs-number">1</span>);
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> result = <span class="hljs-built_in">factorial</span>(<span class="hljs-number">5</span>);  <span class="hljs-comment">// ç¼–è¯‘æœŸè®¡ç®—ä¸º 120</span>
    std::array&lt;<span class="hljs-type">int</span>, factorial(4)&gt; arr;    <span class="hljs-comment">// ä½¿ç”¨ std::arrayï¼Œç¼–è¯‘æœŸè®¡ç®—å¤§å°</span>
}
</code></pre>
<p>ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">const</span> <span class="hljs-type">int</span> result = <span class="hljs-number">120</span>;         <span class="hljs-comment">// ç›´æ¥å¸¸é‡</span>
    std::array&lt;<span class="hljs-type">int</span>, 24&gt; arr;        <span class="hljs-comment">// ç›´æ¥å¸¸é‡</span>
}
</code></pre>
<p><strong>constexpr ç±»</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Point</span> {
    <span class="hljs-type">int</span> x_, y_;
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">constexpr</span> <span class="hljs-title">Point</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> : x_(x), y_(y) {</span>}
    <span class="hljs-function"><span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> <span class="hljs-title">getX</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> x_; }
    <span class="hljs-function"><span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> <span class="hljs-title">distance</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> x_ * x_ + y_ * y_; }
};

<span class="hljs-function"><span class="hljs-keyword">constexpr</span> Point <span class="hljs-title">p</span><span class="hljs-params">(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)</span></span>;
<span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> d = p.<span class="hljs-built_in">distance</span>();  <span class="hljs-comment">// ç¼–è¯‘æœŸè®¡ç®—ä¸º 25</span>
</code></pre>
<p><strong>constexpr vs è¿è¡Œæ—¶è®¡ç®—</strong></p>




















<table><thead><tr><th>æ–¹æ¡ˆ</th><th>è®¡ç®—æ—¶æœº</th><th>è¿è¡Œæ—¶å¼€é”€</th></tr></thead><tbody><tr><td>è¿è¡Œæ—¶è®¡ç®—</td><td>è¿è¡Œæ—¶</td><td>å‡½æ•°è°ƒç”¨</td></tr><tr><td><code>constexpr</code> è®¡ç®—</td><td>ç¼–è¯‘æœŸ</td><td>é›¶å¼€é”€</td></tr></tbody></table>
<p><code>constexpr</code> å°†è®¡ç®—æå‰åˆ°ç¼–è¯‘æœŸï¼Œè¿è¡Œæ—¶ç›´æ¥ä½¿ç”¨å¸¸é‡ï¼Œæ˜¯é›¶æˆæœ¬æŠ½è±¡çš„å…¸èŒƒã€‚</p>
<h2 data-id="heading-23">æ¨èä½¿ç”¨å€¼è¯­ä¹‰ä¸ç§»åŠ¨è¯­ä¹‰</h2>
<p>å€¼è¯­ä¹‰(Value Semantics)é€šè¿‡ç›´æ¥å­˜å‚¨å¯¹è±¡é¿å…æŒ‡é’ˆé—´æ¥è®¿é—®ï¼Œæé«˜ç¼“å­˜å±€éƒ¨æ€§å’Œè®¿é—®é€Ÿåº¦ã€‚ç§»åŠ¨è¯­ä¹‰(Move Semantics)é€šè¿‡è½¬ç§»èµ„æºæ‰€æœ‰æƒé¿å…æ·±æ‹·è´å¼€é”€ã€‚ä¸¤è€…ç»“åˆæ˜¯ C++ é«˜æ€§èƒ½ç¼–ç¨‹çš„æ ¸å¿ƒå®è·µï¼šæŒ‰å€¼ä¼ é€’é…åˆç§»åŠ¨è¯­ä¹‰ï¼Œæ—¢ä¿æŒä»£ç ç®€æ´ï¼Œåˆå®ç°é›¶æ‹·è´æ€§èƒ½ã€‚</p>
<h3 data-id="heading-24">å€¼è¯­ä¹‰</h3>
<p>å€¼è¯­ä¹‰ç›´æ¥å­˜å‚¨å¯¹è±¡æœ¬èº«ï¼Œè€ŒéæŒ‡é’ˆæˆ–å¼•ç”¨ã€‚å¯¹è±¡æ‹·è´æ—¶å¤åˆ¶æ•´ä¸ªå†…å®¹ã€‚</p>
<p><strong>å€¼è¯­ä¹‰ vs å¼•ç”¨è¯­ä¹‰</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// å€¼è¯­ä¹‰ï¼šç›´æ¥å­˜å‚¨å¯¹è±¡</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Point</span> {
    <span class="hljs-type">int</span> x, y;
};

std::vector&lt;Point&gt; points;
points.<span class="hljs-built_in">push_back</span>(Point{<span class="hljs-number">1</span>, <span class="hljs-number">2</span>});  <span class="hljs-comment">// å¯¹è±¡ç›´æ¥å­˜å‚¨åœ¨ vector å†…å­˜ä¸­</span>

<span class="hljs-comment">// å¼•ç”¨è¯­ä¹‰ï¼šå­˜å‚¨æŒ‡é’ˆ</span>
std::vector&lt;Point*&gt; pointPtrs;
pointPtrs.<span class="hljs-built_in">push_back</span>(<span class="hljs-keyword">new</span> Point{<span class="hljs-number">1</span>, <span class="hljs-number">2</span>});  <span class="hljs-comment">// åªå­˜å‚¨æŒ‡é’ˆï¼Œå¯¹è±¡åœ¨å †ä¸Š</span>
</code></pre>
<p>å†…å­˜å¸ƒå±€å¯¹æ¯”ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// å€¼è¯­ä¹‰ï¼šè¿ç»­å†…å­˜</span>
points: [Point{<span class="hljs-number">1</span>,<span class="hljs-number">2</span>}][Point{<span class="hljs-number">3</span>,<span class="hljs-number">4</span>}][Point{<span class="hljs-number">5</span>,<span class="hljs-number">6</span>}]
        â†‘ ç›´æ¥è®¿é—®ï¼Œç¼“å­˜å‹å¥½

<span class="hljs-comment">// å¼•ç”¨è¯­ä¹‰ï¼šé—´æ¥è®¿é—®</span>
pointPtrs: [ptr1][ptr2][ptr3]
            â†“     â†“     â†“
          å †å†…å­˜åˆ†æ•£ï¼Œç¼“å­˜æœªå‘½ä¸­
</code></pre>
<p><strong>æ€§èƒ½ä¼˜åŠ¿</strong></p>
<p>å€¼è¯­ä¹‰çš„ç¼“å­˜å±€éƒ¨æ€§ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// å€¼è¯­ä¹‰ï¼šè¿ç»­è®¿é—®ï¼Œç¼“å­˜å‘½ä¸­ç‡é«˜</span>
<span class="hljs-function">std::vector&lt;Point&gt; <span class="hljs-title">points</span><span class="hljs-params">(<span class="hljs-number">1000</span>)</span></span>;
<span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; p : points) {
    <span class="hljs-built_in">process</span>(p);  <span class="hljs-comment">// é¡ºåºè®¿é—®è¿ç»­å†…å­˜ï¼Œåˆ©ç”¨ CPU ç¼“å­˜</span>
}

<span class="hljs-comment">// å¼•ç”¨è¯­ä¹‰ï¼šéšæœºè®¿é—®ï¼Œç¼“å­˜æœªå‘½ä¸­</span>
<span class="hljs-function">std::vector&lt;Point*&gt; <span class="hljs-title">pointPtrs</span><span class="hljs-params">(<span class="hljs-number">1000</span>)</span></span>;
<span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>* p : pointPtrs) {
    <span class="hljs-built_in">process</span>(*p);  <span class="hljs-comment">// æ¯æ¬¡è§£å¼•ç”¨å¯èƒ½ç¼“å­˜æœªå‘½ä¸­</span>
}
</code></pre>
<p>å€¼è¯­ä¹‰ä¼˜åŠ¿ï¼š</p>
<ul>
<li>æ— æŒ‡é’ˆé—´æ¥è®¿é—®ï¼Œå‡å°‘å†…å­˜è®¿é—®æ¬¡æ•°</li>
<li>å†…å­˜è¿ç»­ï¼Œæé«˜ç¼“å­˜å‘½ä¸­ç‡</li>
<li>æ— éœ€æ‰‹åŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ</li>
</ul>
<h3 data-id="heading-25">ç§»åŠ¨è¯­ä¹‰</h3>
<p>ç§»åŠ¨è¯­ä¹‰(C++11)é€šè¿‡è½¬ç§»èµ„æºæ‰€æœ‰æƒé¿å…æ·±æ‹·è´ï¼Œä½¿ç”¨å³å€¼å¼•ç”¨(<code>&amp;&amp;</code>)å’Œ <code>std::move</code> å®ç°ã€‚</p>
<p><strong>æ‹·è´ vs ç§»åŠ¨</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>

<span class="hljs-function">std::vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">createVector</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">std::vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">v</span><span class="hljs-params">(<span class="hljs-number">1000000</span>)</span></span>;
    <span class="hljs-keyword">return</span> v;  <span class="hljs-comment">// è¿”å›ä¸´æ—¶å¯¹è±¡</span>
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// æ‹·è´ï¼šæ·±æ‹·è´æ‰€æœ‰å…ƒç´ ï¼ˆæ…¢ï¼‰</span>
    std::vector&lt;<span class="hljs-type">int</span>&gt; v1 = <span class="hljs-built_in">createVector</span>();  <span class="hljs-comment">// C++11 ä¹‹å‰ï¼šæ‹·è´ 100 ä¸‡ä¸ªå…ƒç´ </span>

    <span class="hljs-comment">// ç§»åŠ¨ï¼šè½¬ç§»å†…å­˜æ‰€æœ‰æƒï¼ˆå¿«ï¼‰</span>
    std::vector&lt;<span class="hljs-type">int</span>&gt; v2 = <span class="hljs-built_in">createVector</span>();  <span class="hljs-comment">// C++11 ä¹‹åï¼šç§»åŠ¨æ„é€ ï¼Œåªè½¬ç§»æŒ‡é’ˆ</span>
}
</code></pre>
<p>ç§»åŠ¨æ„é€ å‡½æ•°å®ç°ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Buffer</span> {
    <span class="hljs-type">int</span>* data_;
    <span class="hljs-type">size_t</span> size_;
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// æ‹·è´æ„é€ ï¼šæ·±æ‹·è´</span>
    <span class="hljs-built_in">Buffer</span>(<span class="hljs-type">const</span> Buffer&amp; other) : <span class="hljs-built_in">size_</span>(other.size_) {
        data_ = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[size_];
        std::<span class="hljs-built_in">copy</span>(other.data_, other.data_ + size_, data_);  <span class="hljs-comment">// æ‹·è´æ‰€æœ‰å…ƒç´ </span>
    }

    <span class="hljs-comment">// ç§»åŠ¨æ„é€ ï¼šè½¬ç§»æ‰€æœ‰æƒ</span>
    <span class="hljs-built_in">Buffer</span>(Buffer&amp;&amp; other) <span class="hljs-keyword">noexcept</span> : <span class="hljs-built_in">data_</span>(other.data_), <span class="hljs-built_in">size_</span>(other.size_) {
        other.data_ = <span class="hljs-literal">nullptr</span>;  <span class="hljs-comment">// æ¸…ç©ºæºå¯¹è±¡</span>
        other.size_ = <span class="hljs-number">0</span>;
    }
};
</code></pre>
<p><strong>std::move</strong></p>
<p><code>std::move</code> å°†å·¦å€¼è½¬æ¢ä¸ºå³å€¼å¼•ç”¨ï¼Œè§¦å‘ç§»åŠ¨è¯­ä¹‰ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">std::vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">v1</span><span class="hljs-params">(<span class="hljs-number">1000000</span>)</span></span>;
std::vector&lt;<span class="hljs-type">int</span>&gt; v2 = std::<span class="hljs-built_in">move</span>(v1);  <span class="hljs-comment">// ç§»åŠ¨ï¼Œv1 è¢«æ¸…ç©º</span>
</code></pre>
<p><strong>æ€§èƒ½ä¼˜åŠ¿</strong></p>
<p>ç§»åŠ¨è¯­ä¹‰å®ç°æŒ‰å€¼ä¼ é€’çš„é›¶æ‹·è´ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// æŒ‰å€¼è¿”å› + ç§»åŠ¨è¯­ä¹‰ = é›¶æ‹·è´</span>
<span class="hljs-function">std::vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">createLargeVector</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">std::vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">v</span><span class="hljs-params">(<span class="hljs-number">1000000</span>)</span></span>;
    <span class="hljs-keyword">return</span> v;  <span class="hljs-comment">// è‡ªåŠ¨ç§»åŠ¨ï¼Œæ— æ‹·è´</span>
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">processVector</span><span class="hljs-params">(std::vector&lt;<span class="hljs-type">int</span>&gt; v)</span> </span>{  <span class="hljs-comment">// æŒ‰å€¼æ¥æ”¶</span>
    <span class="hljs-comment">// å¤„ç† v</span>
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">auto</span> v = <span class="hljs-built_in">createLargeVector</span>();  <span class="hljs-comment">// ç§»åŠ¨æ„é€ </span>
    <span class="hljs-built_in">processVector</span>(std::<span class="hljs-built_in">move</span>(v));   <span class="hljs-comment">// ç§»åŠ¨ä¼ é€’</span>
}
</code></pre>
<p>ç§»åŠ¨è¯­ä¹‰ä¼˜åŠ¿ï¼š</p>
<ul>
<li>é¿å…æ·±æ‹·è´ï¼Œåªè½¬ç§»æŒ‡é’ˆï¼ˆO(1) vs O(n)ï¼‰</li>
<li>é…åˆå€¼è¯­ä¹‰ï¼Œå®ç°ç®€æ´è¯­æ³•å’Œæè‡´æ€§èƒ½</li>
</ul>
<h2 data-id="heading-26">é¿å…ä½¿ç”¨åŠ¨æ€å†…å­˜åˆ†é…</h2>
<p>åŠ¨æ€å†…å­˜åˆ†é…é€šè¿‡ <code>new</code>/<code>delete</code>ã€<code>malloc</code>/<code>free</code> åœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œä½†æ¶‰åŠç³»ç»Ÿè°ƒç”¨ã€å†…å­˜ç¢ç‰‡å’Œç¼“å­˜æœªå‘½ä¸­ç­‰å¼€é”€ã€‚æœ¬ç« åˆ†æåŠ¨æ€å†…å­˜åˆ†é…çš„åº•å±‚å®ç°å’Œæ€§èƒ½ä»£ä»·ï¼Œå¹¶æä¾›æ ˆåˆ†é…ã€å†…å­˜æ± ã€è‡ªå®šä¹‰åˆ†é…å™¨ç­‰æ›¿ä»£æ–¹æ¡ˆã€‚</p>
<h3 data-id="heading-27">åŠ¨æ€å†…å­˜åˆ†é…ç®€è¿°</h3>
<p>åŠ¨æ€å†…å­˜åˆ†é…(Dynamic Memory Allocation)åœ¨è¿è¡Œæ—¶ä»å †(Heap)ä¸Šåˆ†é…å†…å­˜ï¼Œç”Ÿå‘½å‘¨æœŸç”±ç¨‹åºå‘˜æ§åˆ¶ã€‚C++ æä¾› <code>new</code>/<code>delete</code> è¿ç®—ç¬¦ï¼ŒC æä¾› <code>malloc</code>/<code>free</code> å‡½æ•°ã€‚</p>
<p><strong>åŸºç¡€ç”¨æ³•</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Resource</span> {
    <span class="hljs-type">int</span>* data_;
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Resource</span>(<span class="hljs-type">int</span> size) : <span class="hljs-built_in">data_</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[size]) {
        std::cout &lt;&lt; <span class="hljs-string">"Resource allocated\n"</span>;
    }
    ~<span class="hljs-built_in">Resource</span>() {
        <span class="hljs-keyword">delete</span>[] data_;
        std::cout &lt;&lt; <span class="hljs-string">"Resource released\n"</span>;
    }
};

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// newï¼šåˆ†é…å†…å­˜ + è°ƒç”¨æ„é€ å‡½æ•°</span>
    Resource* r = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Resource</span>(<span class="hljs-number">100</span>);
    <span class="hljs-keyword">delete</span> r;  <span class="hljs-comment">// è°ƒç”¨ææ„å‡½æ•° + é‡Šæ”¾å†…å­˜</span>

    <span class="hljs-comment">// mallocï¼šåªåˆ†é…åŸå§‹å†…å­˜ï¼Œä¸è°ƒç”¨æ„é€ å‡½æ•°</span>
    <span class="hljs-type">int</span>* arr = (<span class="hljs-type">int</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">1000</span> * <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">int</span>));
    <span class="hljs-built_in">free</span>(arr);  <span class="hljs-comment">// åªé‡Šæ”¾å†…å­˜ï¼Œä¸è°ƒç”¨ææ„å‡½æ•°</span>

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>new vs malloc</strong></p>






























<table><thead><tr><th>ç‰¹æ€§</th><th><code>new</code>/<code>delete</code></th><th><code>malloc</code>/<code>free</code></th></tr></thead><tbody><tr><td>ç±»å‹</td><td>C++ è¿ç®—ç¬¦</td><td>C å‡½æ•°</td></tr><tr><td>è°ƒç”¨æ„é€ /ææ„å‡½æ•°</td><td>æ˜¯</td><td>å¦</td></tr><tr><td>ç±»å‹å®‰å…¨</td><td>æ˜¯ï¼ˆè‡ªåŠ¨æ¨å¯¼ç±»å‹ï¼‰</td><td>å¦ï¼ˆéœ€è¦å¼ºåˆ¶è½¬æ¢ï¼‰</td></tr><tr><td>å¤±è´¥å¤„ç†</td><td>æŠ›å‡º <code>std::bad_alloc</code></td><td>è¿”å› <code>nullptr</code></td></tr></tbody></table>
<p>åŠ¨æ€å†…å­˜åˆ†é…çš„å…¸å‹ä½¿ç”¨åœºæ™¯åŒ…æ‹¬å¤§å°ä¸ç¡®å®šï¼ˆè¿è¡Œæ—¶æ‰çŸ¥é“éœ€è¦å¤šå°‘å†…å­˜ï¼‰ã€ç”Ÿå‘½å‘¨æœŸè·¨è¶Šä½œç”¨åŸŸï¼ˆå¯¹è±¡éœ€è¦åœ¨å‡½æ•°è¿”å›åç»§ç»­å­˜åœ¨ï¼‰ã€å¤šæ€å¯¹è±¡ç®¡ç†ï¼ˆä½¿ç”¨åŸºç±»æŒ‡é’ˆç®¡ç†ä¸åŒæ´¾ç”Ÿç±»å¯¹è±¡ï¼‰ã€‚è™½ç„¶åŠ¨æ€å†…å­˜åˆ†é…æä¾›äº†çµæ´»æ€§ï¼Œä½†å¸¦æ¥äº†æ˜¾è‘—çš„æ€§èƒ½å¼€é”€å’Œç®¡ç†å¤æ‚åº¦ã€‚</p>
<h3 data-id="heading-28">åº•å±‚å®ç°ä¸å¼€é”€åˆ†æ</h3>
<p>åŠ¨æ€å†…å­˜åˆ†é…çš„æ€§èƒ½å¼€é”€ä¸»è¦æ¥è‡ªå››ä¸ªæ–¹é¢ï¼šç³»ç»Ÿè°ƒç”¨ã€å†…å­˜ç®¡ç†å™¨ç»´æŠ¤ã€å†…å­˜ç¢ç‰‡å’Œç¼“å­˜æœªå‘½ä¸­ã€‚</p>
<p><strong>ç³»ç»Ÿè°ƒç”¨å¼€é”€</strong></p>
<p>é¢‘ç¹çš„å°å†…å­˜åˆ†é…ä¼šè§¦å‘ç³»ç»Ÿè°ƒç”¨ï¼Œé™·å…¥å†…æ ¸æ€ï¼Œå¼€é”€è¿œå¤§äºç”¨æˆ·æ€æ“ä½œã€‚ç°ä»£å†…å­˜åˆ†é…å™¨ï¼ˆå¦‚ ptmallocã€jemallocï¼‰é€šè¿‡å†…å­˜æ± ç¼“è§£è¿™ä¸€é—®é¢˜ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// å†…å­˜åˆ†é…å™¨çš„ç®€åŒ–å·¥ä½œæµç¨‹</span>
<span class="hljs-function"><span class="hljs-type">void</span>* <span class="hljs-title">malloc</span><span class="hljs-params">(<span class="hljs-type">size_t</span> size)</span> </span>{
    <span class="hljs-comment">// 1. æ£€æŸ¥å†…å­˜æ± æ˜¯å¦æœ‰ç©ºé—²å—</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">has_free_block_in_pool</span>(size)) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">allocate_from_pool</span>(size);  <span class="hljs-comment">// ç”¨æˆ·æ€ï¼Œå¿«é€Ÿ</span>
    }

    <span class="hljs-comment">// 2. å†…å­˜æ± ä¸è¶³ï¼Œå‘æ“ä½œç³»ç»Ÿç”³è¯·å¤§å—å†…å­˜</span>
    <span class="hljs-type">void</span>* ptr = <span class="hljs-built_in">sbrk</span>(BIG_SIZE);  <span class="hljs-comment">// ç³»ç»Ÿè°ƒç”¨ï¼Œæ…¢</span>
    <span class="hljs-built_in">add_to_pool</span>(ptr);
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">allocate_from_pool</span>(size);
}
</code></pre>
<p>å†…å­˜æ± åˆ†é…ä»ç”¨æˆ·æ€å®Œæˆï¼Œè€Œç³»ç»Ÿè°ƒç”¨éœ€è¦é™·å…¥å†…æ ¸æ€ï¼Œä¸¤è€…çš„æ€§èƒ½å·®è·å·¨å¤§ã€‚</p>
<p><strong>å†…å­˜ç®¡ç†å™¨ç»´æŠ¤å¼€é”€</strong></p>
<p>å†…å­˜åˆ†é…å™¨éœ€è¦ç»´æŠ¤å…ƒæ•°æ®ï¼ˆç©ºé—²é“¾è¡¨ã€å¤§å°ä¿¡æ¯ç­‰ï¼‰ï¼Œæ¯æ¬¡åˆ†é…/é‡Šæ”¾éƒ½éœ€è¦æŸ¥æ‰¾å’Œæ›´æ–°ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// å…¸å‹çš„å†…å­˜å—ç»“æ„</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">MemoryBlock</span> {
    <span class="hljs-type">size_t</span> size;           <span class="hljs-comment">// å—å¤§å°ï¼ˆ8 å­—èŠ‚ï¼‰</span>
    <span class="hljs-type">bool</span> is_free;          <span class="hljs-comment">// æ˜¯å¦ç©ºé—²ï¼ˆ1 å­—èŠ‚ï¼‰</span>
    MemoryBlock* next;     <span class="hljs-comment">// ä¸‹ä¸€ä¸ªç©ºé—²å—ï¼ˆ8 å­—èŠ‚ï¼‰</span>
    <span class="hljs-type">char</span> padding[<span class="hljs-number">7</span>];       <span class="hljs-comment">// å¯¹é½å¡«å……</span>
    <span class="hljs-comment">// æ€»å¼€é”€ï¼š24 å­—èŠ‚</span>
    <span class="hljs-type">char</span> user_data[];      <span class="hljs-comment">// ç”¨æˆ·æ•°æ®</span>
};
</code></pre>
<p>å¯¹äºå°å¯¹è±¡ï¼Œå…ƒæ•°æ®å¼€é”€å æ¯”æ˜¾è‘—ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// åˆ†é… 8 å­—èŠ‚å¯¹è±¡</span>
<span class="hljs-type">int</span>* ptr = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">2</span>];  <span class="hljs-comment">// ç”¨æˆ·æ•°æ®ï¼š8 å­—èŠ‚</span>
<span class="hljs-comment">// å®é™…å ç”¨ï¼š8 (æ•°æ®) + 24 (å…ƒæ•°æ®) = 32 å­—èŠ‚</span>
<span class="hljs-comment">// å¼€é”€ï¼š300%</span>
</code></pre>
<p><strong>å†…å­˜ç¢ç‰‡</strong></p>
<p>é¢‘ç¹åˆ†é…/é‡Šæ”¾ä¸åŒå¤§å°çš„å†…å­˜å¯¼è‡´ç¢ç‰‡ï¼Œé™ä½å†…å­˜åˆ©ç”¨ç‡ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// åˆ†é…å’Œé‡Šæ”¾å¯¼è‡´ç¢ç‰‡</span>
<span class="hljs-type">int</span>* a = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">100</span>];   <span class="hljs-comment">// 400 å­—èŠ‚</span>
<span class="hljs-type">int</span>* b = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">200</span>];   <span class="hljs-comment">// 800 å­—èŠ‚</span>
<span class="hljs-type">int</span>* c = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">100</span>];   <span class="hljs-comment">// 400 å­—èŠ‚</span>

<span class="hljs-keyword">delete</span>[] b;              <span class="hljs-comment">// é‡Šæ”¾ bï¼Œä¸­é—´ç•™ä¸‹ 800 å­—èŠ‚ç©ºæ´</span>

<span class="hljs-comment">// å°è¯•åˆ†é… 1000 å­—èŠ‚ï¼Œè™½ç„¶æ€»ç©ºé—²å†…å­˜è¶³å¤Ÿï¼Œä½†æ— è¿ç»­ç©ºé—´</span>
<span class="hljs-type">int</span>* d = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">250</span>];   <span class="hljs-comment">// å¯èƒ½å¤±è´¥æˆ–è§¦å‘ç³»ç»Ÿè°ƒç”¨</span>
</code></pre>
<p>å†…å­˜å¸ƒå±€ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[a: 400B]</span><span class="hljs-selector-attr">[ç©ºæ´: 800B]</span><span class="hljs-selector-attr">[c: 400B]</span>
          â†‘ æ— æ³•åˆ†é… <span class="hljs-number">1000</span>B
</code></pre>
<p><strong>ç¼“å­˜æœªå‘½ä¸­</strong></p>
<p>å †ä¸Šåˆ†é…çš„å¯¹è±¡åœ°å€åˆ†æ•£ï¼Œç›¸æ¯”æ ˆä¸Šè¿ç»­åˆ†é…ï¼Œç¼“å­˜å‘½ä¸­ç‡ä½ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// å †åˆ†é…ï¼šå¯¹è±¡åœ°å€åˆ†æ•£</span>
std::vector&lt;<span class="hljs-type">int</span>*&gt; heap_ptrs;
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    heap_ptrs.<span class="hljs-built_in">push_back</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>(i));  <span class="hljs-comment">// æ¯ä¸ª int å¯èƒ½åœ¨ä¸åŒçš„ç¼“å­˜è¡Œ</span>
}

<span class="hljs-comment">// è®¿é—®æ—¶ç¼“å­˜æœªå‘½ä¸­ç‡é«˜</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>* ptr : heap_ptrs) {
    <span class="hljs-built_in">process</span>(*ptr);  <span class="hljs-comment">// æ¯æ¬¡è®¿é—®å¯èƒ½å¯¼è‡´ç¼“å­˜æœªå‘½ä¸­</span>
}

<span class="hljs-comment">// æ ˆåˆ†é…ï¼šå¯¹è±¡è¿ç»­å­˜å‚¨</span>
<span class="hljs-type">int</span> stack_arr[<span class="hljs-number">1000</span>];
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    stack_arr[i] = i;  <span class="hljs-comment">// è¿ç»­å†…å­˜</span>
}

<span class="hljs-comment">// è®¿é—®æ—¶ç¼“å­˜å‹å¥½</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> val : stack_arr) {
    <span class="hljs-built_in">process</span>(val);  <span class="hljs-comment">// é¡ºåºè®¿é—®ï¼Œé¢„å–æ•ˆç‡é«˜</span>
}
</code></pre>
<p><strong>å¼€é”€æ€»ç»“</strong></p>





























<table><thead><tr><th>å¼€é”€ç±»å‹</th><th>å½±å“</th></tr></thead><tbody><tr><td>ç³»ç»Ÿè°ƒç”¨</td><td>é™·å…¥å†…æ ¸æ€ï¼Œå¼€é”€å¤§</td></tr><tr><td>å…ƒæ•°æ®ç»´æŠ¤</td><td>æŸ¥æ‰¾ç©ºé—²å—ã€æ›´æ–°é“¾è¡¨</td></tr><tr><td>å†…å­˜ç¢ç‰‡</td><td>é™ä½å†…å­˜åˆ©ç”¨ç‡ã€è§¦å‘é¢å¤–åˆ†é…</td></tr><tr><td>ç¼“å­˜æœªå‘½ä¸­</td><td>å†…å­˜è®¿é—®å»¶è¿Ÿå¢åŠ </td></tr><tr><td>å¯¹è±¡æ„é€ ææ„</td><td>new/delete è°ƒç”¨æ„é€ /ææ„å‡½æ•°</td></tr></tbody></table>
<h3 data-id="heading-29">æ›¿ä»£æ–¹æ¡ˆä¸€ï¼šæ ˆåˆ†é…ä¸å›ºå®šå¤§å°å®¹å™¨</h3>
<p>æ ˆåˆ†é…åœ¨å‡½æ•°è°ƒç”¨æ—¶è‡ªåŠ¨åˆ†é…å’Œé‡Šæ”¾ï¼Œæ— ç³»ç»Ÿè°ƒç”¨å¼€é”€ï¼Œå†…å­˜è¿ç»­ï¼Œç¼“å­˜å‹å¥½ã€‚å¯¹äºå¤§å°ç¡®å®šçš„æ•°æ®ï¼Œä½¿ç”¨æ ˆåˆ†é…æˆ–å›ºå®šå¤§å°å®¹å™¨ï¼ˆå¦‚ <code>std::array</code>ï¼‰æ›¿ä»£å †åˆ†é…ã€‚</p>
<p><strong>æ ˆåˆ†é…</strong></p>
<p>æ ˆåˆ†é…åªéœ€è°ƒæ•´æ ˆæŒ‡é’ˆï¼Œé›¶å¼€é”€ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">processData</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// æ ˆåˆ†é…ï¼šè‡ªåŠ¨åˆ†é…å’Œé‡Šæ”¾</span>
    <span class="hljs-type">int</span> arr[<span class="hljs-number">1000</span>];  <span class="hljs-comment">// ç¼–è¯‘æœŸç¡®å®šå¤§å°</span>
    <span class="hljs-comment">// ä½¿ç”¨ arr...</span>
}  <span class="hljs-comment">// å‡½æ•°è¿”å›æ—¶è‡ªåŠ¨é‡Šæ”¾ï¼Œæ— éœ€ delete</span>
</code></pre>
<p>æ±‡ç¼–ä»£ç ï¼ˆç®€åŒ–ï¼‰ï¼š</p>
<pre><code class="hljs language-asm" lang="asm">; åˆ†é…æ ˆç©ºé—´
sub rsp, 4000  ; ç§»åŠ¨æ ˆæŒ‡é’ˆï¼Œåˆ†é… 4000 å­—èŠ‚

; å‡½æ•°ä½“...

; é‡Šæ”¾æ ˆç©ºé—´
add rsp, 4000  ; æ¢å¤æ ˆæŒ‡é’ˆ
</code></pre>
<p>æ ˆåˆ†é…åªéœ€ä¸€æ¡æŒ‡ä»¤ï¼Œç›¸æ¯”å †åˆ†é…ï¼ˆéœ€è¦æŸ¥æ‰¾ç©ºé—²å—ã€æ›´æ–°é“¾è¡¨ï¼‰ï¼Œæ€§èƒ½æå‡æ˜¾è‘—ã€‚</p>
<p><strong>std::array</strong></p>
<p><code>std::array</code>(C++11) æ˜¯æ ˆä¸Šåˆ†é…çš„å›ºå®šå¤§å°æ•°ç»„ï¼Œæä¾› STL å®¹å™¨æ¥å£ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;array&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">comparePerformance</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// std::vectorï¼šå †åˆ†é…</span>
    <span class="hljs-function">std::vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">vec</span><span class="hljs-params">(<span class="hljs-number">1000</span>)</span></span>;  <span class="hljs-comment">// è°ƒç”¨ new int[1000]</span>
    <span class="hljs-comment">// ä½¿ç”¨ vec...</span>
    <span class="hljs-comment">// vec ææ„æ—¶è°ƒç”¨ delete[]</span>

    <span class="hljs-comment">// std::arrayï¼šæ ˆåˆ†é…</span>
    std::array&lt;<span class="hljs-type">int</span>, 1000&gt; arr;  <span class="hljs-comment">// æ ˆä¸Šåˆ†é…ï¼Œé›¶å¼€é”€</span>
    <span class="hljs-comment">// ä½¿ç”¨ arr...</span>
}  <span class="hljs-comment">// arr è‡ªåŠ¨é‡Šæ”¾ï¼Œæ— éœ€ææ„æ“ä½œ</span>
</code></pre>
<p><strong>å°å­—ç¬¦ä¸²ä¼˜åŒ–ï¼ˆSSOï¼‰</strong></p>
<p><code>std::string</code> ä½¿ç”¨ SSO(Small String Optimization)ï¼ŒçŸ­å­—ç¬¦ä¸²å­˜å‚¨åœ¨æ ˆä¸Šçš„å†…éƒ¨ç¼“å†²åŒºï¼Œé¿å…å †åˆ†é…ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// çŸ­å­—ç¬¦ä¸²ï¼šä½¿ç”¨ SSOï¼Œæ— å †åˆ†é…</span>
    std::string short_str = <span class="hljs-string">"hello"</span>;  <span class="hljs-comment">// é€šå¸¸ â‰¤15 å­—ç¬¦ä½¿ç”¨ SSO</span>
    std::cout &lt;&lt; <span class="hljs-string">"Capacity: "</span> &lt;&lt; short_str.<span class="hljs-built_in">capacity</span>() &lt;&lt; std::endl;  <span class="hljs-comment">// 15</span>

    <span class="hljs-comment">// é•¿å­—ç¬¦ä¸²ï¼šå †åˆ†é…</span>
    std::string long_str = <span class="hljs-string">"This is a very long string that exceeds SSO buffer"</span>;
    std::cout &lt;&lt; <span class="hljs-string">"Capacity: "</span> &lt;&lt; long_str.<span class="hljs-built_in">capacity</span>() &lt;&lt; std::endl;  <span class="hljs-comment">// &gt; 15</span>
}
</code></pre>
<p>SSO å®ç°ï¼ˆç®€åŒ–ï¼‰ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">string</span> {
    <span class="hljs-keyword">union</span> {
        <span class="hljs-type">char</span> sso_buffer_[<span class="hljs-number">16</span>];  <span class="hljs-comment">// çŸ­å­—ç¬¦ä¸²ç¼“å†²åŒº</span>
        <span class="hljs-type">char</span>* heap_ptr_;       <span class="hljs-comment">// é•¿å­—ç¬¦ä¸²å †æŒ‡é’ˆ</span>
    };
    <span class="hljs-type">size_t</span> size_;
    <span class="hljs-type">size_t</span> capacity_;

<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">string</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* str) {
        size_ = <span class="hljs-built_in">strlen</span>(str);
        <span class="hljs-keyword">if</span> (size_ &lt;= <span class="hljs-number">15</span>) {
            <span class="hljs-comment">// ä½¿ç”¨ SSO</span>
            <span class="hljs-built_in">memcpy</span>(sso_buffer_, str, size_);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// å †åˆ†é…</span>
            heap_ptr_ = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[size_ + <span class="hljs-number">1</span>];
            <span class="hljs-built_in">memcpy</span>(heap_ptr_, str, size_);
        }
    }
};
</code></pre>
<p><strong>æ€§èƒ½å¯¹æ¯”</strong></p>








































<table><thead><tr><th>æ–¹æ¡ˆ</th><th>åˆ†é…å¼€é”€</th><th>é‡Šæ”¾å¼€é”€</th><th>ç¼“å­˜å‹å¥½æ€§</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>å †åˆ†é…</td><td>æ…¢</td><td>æ…¢</td><td>å·®</td><td>å¤§å°ä¸ç¡®å®šã€å¤§å¯¹è±¡</td></tr><tr><td>æ ˆåˆ†é…</td><td>æå¿«</td><td>æå¿«</td><td>ä¼˜</td><td>å¤§å°ç¡®å®šã€å°å¯¹è±¡</td></tr><tr><td><code>std::array</code></td><td>é›¶å¼€é”€</td><td>é›¶å¼€é”€</td><td>ä¼˜</td><td>å›ºå®šå¤§å°æ•°ç»„</td></tr><tr><td><code>std::string</code> SSO</td><td>é›¶å¼€é”€</td><td>é›¶å¼€é”€</td><td>ä¼˜</td><td>çŸ­å­—ç¬¦ä¸²ï¼ˆâ‰¤15 å­—ç¬¦ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-30">æ›¿ä»£æ–¹æ¡ˆäºŒï¼šå†…å­˜æ± </h3>
<p>å†…å­˜æ± (Memory Pool)é¢„å…ˆåˆ†é…å¤§å—å†…å­˜ï¼Œä½¿ç”¨é“¾è¡¨ç®¡ç†ç©ºé—²å—ï¼Œé¿å…é¢‘ç¹çš„ç³»ç»Ÿè°ƒç”¨å’Œå†…å­˜ç¢ç‰‡ï¼Œæ˜¾è‘—æå‡åˆ†é…/é‡Šæ”¾æ€§èƒ½ã€‚</p>
<p><strong>å®ç°</strong>ï¼šå†…å­˜æ± ä¸ºç‰¹å®šç±»å‹é¢„å…ˆåˆ†é…å¤§å—å†…å­˜ï¼Œä½¿ç”¨é“¾è¡¨ç®¡ç†ç©ºé—²å—ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstddef&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdlib&gt;</span></span>

<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MemoryPool</span> {
    <span class="hljs-keyword">union</span> <span class="hljs-title class_">Block</span> {
        T data;        <span class="hljs-comment">// å¯¹è±¡æ•°æ®</span>
        Block* next;   <span class="hljs-comment">// ç©ºé—²é“¾è¡¨æŒ‡é’ˆï¼ˆå¯¹è±¡æœªæ„é€ æ—¶ä½¿ç”¨ï¼‰</span>
    };

    Block* free_list_;  <span class="hljs-comment">// ç©ºé—²å—é“¾è¡¨</span>
    Block* pool_;       <span class="hljs-comment">// å†…å­˜æ± èµ·å§‹åœ°å€</span>
    <span class="hljs-type">size_t</span> capacity_;   <span class="hljs-comment">// æ± å®¹é‡</span>

<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">MemoryPool</span>(<span class="hljs-type">size_t</span> block_count) : <span class="hljs-built_in">capacity_</span>(block_count) {
        <span class="hljs-comment">// é¢„å…ˆåˆ†é…å¤§å—å†…å­˜</span>
        pool_ = (Block*)<span class="hljs-built_in">malloc</span>(<span class="hljs-built_in">sizeof</span>(Block) * block_count);

        <span class="hljs-comment">// å°†å†…å­˜åˆ’åˆ†ä¸ºå—ï¼Œè¿æ¥åˆ°ç©ºé—²é“¾è¡¨</span>
        free_list_ = pool_;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; block_count - <span class="hljs-number">1</span>; ++i) {
            pool_[i].next = &amp;pool_[i + <span class="hljs-number">1</span>];
        }
        pool_[block_count - <span class="hljs-number">1</span>].next = <span class="hljs-literal">nullptr</span>;
    }

    ~<span class="hljs-built_in">MemoryPool</span>() {
        <span class="hljs-built_in">free</span>(pool_);
    }

    <span class="hljs-function">T* <span class="hljs-title">allocate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (!free_list_) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">bad_alloc</span>();  <span class="hljs-comment">// å†…å­˜æ± è€—å°½ï¼ŒæŠ›å‡ºå¼‚å¸¸</span>
        }

        <span class="hljs-comment">// ä»ç©ºé—²é“¾è¡¨å¤´éƒ¨å–å‡ºä¸€ä¸ªå—</span>
        Block* block = free_list_;
        free_list_ = block-&gt;next;

        <span class="hljs-comment">// åœ¨å—ä¸Šæ„é€ å¯¹è±¡</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">new</span> (&amp;block-&gt;data) <span class="hljs-built_in">T</span>();
    }

    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">deallocate</span><span class="hljs-params">(T* ptr)</span> </span>{
        <span class="hljs-comment">// è°ƒç”¨ææ„å‡½æ•°</span>
        ptr-&gt;~<span class="hljs-built_in">T</span>();

        <span class="hljs-comment">// å°†å—å½’è¿˜åˆ°ç©ºé—²é“¾è¡¨å¤´éƒ¨</span>
        Block* block = <span class="hljs-built_in">reinterpret_cast</span>&lt;Block*&gt;(ptr);
        block-&gt;next = free_list_;
        free_list_ = block;
    }
};

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Object</span> {
    <span class="hljs-type">int</span> data_[<span class="hljs-number">10</span>];
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Object</span>() { <span class="hljs-comment">/* æ„é€ é€»è¾‘ */</span> }
    ~<span class="hljs-built_in">Object</span>() { <span class="hljs-comment">/* ææ„é€»è¾‘ */</span> }
};

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">MemoryPool&lt;Object&gt; <span class="hljs-title">pool</span><span class="hljs-params">(<span class="hljs-number">1000</span>)</span></span>;  <span class="hljs-comment">// 1000 ä¸ª Object å—</span>

    Object* p1 = pool.<span class="hljs-built_in">allocate</span>();  <span class="hljs-comment">// O(1)ï¼Œè‡ªåŠ¨è°ƒç”¨æ„é€ å‡½æ•°</span>
    Object* p2 = pool.<span class="hljs-built_in">allocate</span>();

    pool.<span class="hljs-built_in">deallocate</span>(p1);  <span class="hljs-comment">// O(1)ï¼Œè‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•°</span>
    pool.<span class="hljs-built_in">deallocate</span>(p2);
}
</code></pre>
<p><strong>çº¿ç¨‹å®‰å…¨è¯´æ˜</strong>ï¼šä¸Šè¿°å†…å­˜æ± å®ç°æ˜¯<strong>çº¿ç¨‹ä¸å®‰å…¨</strong>çš„ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨ä¼šå¯¼è‡´ç«æ€æ¡ä»¶ã€‚</p>
<p><strong>æ€§èƒ½å¯¹æ¯”</strong></p>

































<table><thead><tr><th>æ–¹æ¡ˆ</th><th>åˆ†é…å¼€é”€</th><th>é‡Šæ”¾å¼€é”€</th><th>å†…å­˜ç¢ç‰‡</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>å †åˆ†é…</td><td>æ…¢</td><td>æ…¢</td><td>æœ‰</td><td>é€šç”¨åœºæ™¯</td></tr><tr><td>å†…å­˜æ± ï¼ˆè‡ªåŠ¨æ„é€ /ææ„ï¼‰</td><td>å¿« + æ„é€ å¼€é”€</td><td>å¿« + ææ„å¼€é”€</td><td>æ— </td><td>å›ºå®šå¤§å°å¯¹è±¡çš„é¢‘ç¹åˆ†é…/é‡Šæ”¾</td></tr><tr><td>å†…å­˜æ± ï¼ˆæ‰‹åŠ¨æ„é€ /ææ„ï¼‰</td><td>éå¸¸å¿«</td><td>éå¸¸å¿«</td><td>æ— </td><td>æ„é€ /ææ„å¼€é”€å¤§çš„å¯¹è±¡å¤ç”¨</td></tr></tbody></table>
<h3 data-id="heading-31">æ›¿ä»£æ–¹æ¡ˆä¸‰ï¼šè‡ªå®šä¹‰åˆ†é…å™¨</h3>
<p>STL å®¹å™¨æ”¯æŒè‡ªå®šä¹‰åˆ†é…å™¨(Allocator)ï¼Œå…è®¸æ›¿æ¢é»˜è®¤çš„å †åˆ†é…ç­–ç•¥ã€‚é€šè¿‡è‡ªå®šä¹‰åˆ†é…å™¨å¯ä»¥ä½¿ç”¨å†…å­˜æ± ã€æ ˆåˆ†é…ç­‰é«˜æ€§èƒ½ç­–ç•¥ã€‚</p>
<p><strong>è‡ªå®šä¹‰åˆ†é…å™¨æ¥å£</strong></p>
<p>åˆ†é…å™¨éœ€è¦å®ç°ä»¥ä¸‹æ¥å£ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomAllocator</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">using</span> value_type = T;

    <span class="hljs-comment">// åˆ†é… n ä¸ª T å¯¹è±¡çš„å†…å­˜ï¼ˆä¸è°ƒç”¨æ„é€ å‡½æ•°ï¼‰</span>
    <span class="hljs-function">T* <span class="hljs-title">allocate</span><span class="hljs-params">(<span class="hljs-type">size_t</span> n)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">static_cast</span>&lt;T*&gt;(<span class="hljs-built_in">malloc</span>(n * <span class="hljs-built_in">sizeof</span>(T)));
    }

    <span class="hljs-comment">// é‡Šæ”¾å†…å­˜ï¼ˆä¸è°ƒç”¨ææ„å‡½æ•°ï¼‰</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">deallocate</span><span class="hljs-params">(T* ptr, <span class="hljs-type">size_t</span> n)</span> </span>{
        <span class="hljs-built_in">free</span>(ptr);
    }

    <span class="hljs-comment">// æ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆåˆ¤æ–­åˆ†é…å™¨æ˜¯å¦å¯äº’æ¢ï¼‰</span>
    <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-type">const</span> CustomAllocator&amp;) <span class="hljs-type">const</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; }
    <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>!=(<span class="hljs-type">const</span> CustomAllocator&amp;) <span class="hljs-type">const</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }
};
</code></pre>
<p><strong>ä½¿ç”¨å†…å­˜æ± çš„åˆ†é…å™¨</strong></p>
<p>ç»“åˆå‰é¢çš„å†…å­˜æ± å®ç°ï¼Œåˆ›å»ºåŸºäºå†…å­˜æ± çš„åˆ†é…å™¨ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PoolAllocator</span> {
    MemoryPool&lt;T&gt;* pool_;  <span class="hljs-comment">// å…±äº«å†…å­˜æ± </span>

<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">using</span> value_type = T;

    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">PoolAllocator</span><span class="hljs-params">(MemoryPool&lt;T&gt;* pool)</span> : pool_(pool) {</span>}

    <span class="hljs-function">T* <span class="hljs-title">allocate</span><span class="hljs-params">(<span class="hljs-type">size_t</span> n)</span> </span>{
        <span class="hljs-keyword">if</span> (n != <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">bad_alloc</span>();  <span class="hljs-comment">// å†…å­˜æ± åªæ”¯æŒå•ä¸ªå¯¹è±¡åˆ†é…</span>
        }
        <span class="hljs-keyword">return</span> pool_-&gt;<span class="hljs-built_in">allocate</span>();
    }

    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">deallocate</span><span class="hljs-params">(T* ptr, <span class="hljs-type">size_t</span> n)</span> </span>{
        pool_-&gt;<span class="hljs-built_in">deallocate</span>(ptr);
    }

    <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-type">const</span> PoolAllocator&amp; other) <span class="hljs-type">const</span> {
        <span class="hljs-keyword">return</span> pool_ == other.pool_;
    }
    <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>!=(<span class="hljs-type">const</span> PoolAllocator&amp; other) <span class="hljs-type">const</span> {
        <span class="hljs-keyword">return</span> !(*<span class="hljs-keyword">this</span> == other);
    }
};

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">MemoryPool&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">pool</span><span class="hljs-params">(<span class="hljs-number">10000</span>)</span></span>;
    <span class="hljs-function">PoolAllocator&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">alloc</span><span class="hljs-params">(&amp;pool)</span></span>;

    <span class="hljs-comment">// std::vector ä½¿ç”¨è‡ªå®šä¹‰åˆ†é…å™¨</span>
    std::vector&lt;<span class="hljs-type">int</span>, PoolAllocator&lt;<span class="hljs-type">int</span>&gt;&gt; <span class="hljs-built_in">vec</span>(alloc);
    vec.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// ä½¿ç”¨å†…å­˜æ± åˆ†é…</span>
    vec.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">2</span>);
}
</code></pre>
<p><strong>std::pmrï¼ˆå¤šæ€åˆ†é…å™¨ï¼‰</strong></p>
<p>C++17 å¼•å…¥ <code>std::pmr</code>(Polymorphic Memory Resource)ï¼Œæä¾›è¿è¡Œæ—¶å¯åˆ‡æ¢çš„å†…å­˜åˆ†é…ç­–ç•¥ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory_resource&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// æ ˆä¸Šçš„å•è°ƒç¼“å†²åŒº</span>
    <span class="hljs-type">char</span> buffer[<span class="hljs-number">10000</span>];
    std::<span class="hljs-function">pmr::monotonic_buffer_resource <span class="hljs-title">pool</span><span class="hljs-params">(buffer, <span class="hljs-keyword">sizeof</span>(buffer))</span></span>;

    <span class="hljs-comment">// ä½¿ç”¨ pmr::vectorï¼Œå†…å­˜ä» buffer åˆ†é…</span>
    std::<span class="hljs-function">pmr::vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">vec</span><span class="hljs-params">(&amp;pool)</span></span>;
    vec.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">1</span>);
    vec.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">2</span>);
    <span class="hljs-comment">// vec ææ„æ—¶ï¼Œå†…å­˜è‡ªåŠ¨å½’è¿˜åˆ° poolï¼ˆå®é™…ä¸Šå•è°ƒç¼“å†²åŒºä¸å›æ”¶ï¼‰</span>
}
</code></pre>
<p><code>std::pmr</code> æä¾›å¤šç§é¢„å®šä¹‰åˆ†é…å™¨ï¼š</p>
<ul>
<li><code>monotonic_buffer_resource</code>ï¼šå•è°ƒé€’å¢åˆ†é…ï¼Œä¸æ”¯æŒå•ä¸ªå¯¹è±¡é‡Šæ”¾</li>
<li><code>unsynchronized_pool_resource</code>ï¼šçº¿ç¨‹ä¸å®‰å…¨çš„å†…å­˜æ± </li>
<li><code>synchronized_pool_resource</code>ï¼šçº¿ç¨‹å®‰å…¨çš„å†…å­˜æ± </li>
</ul>
<p><strong>æ€§èƒ½å¯¹æ¯”</strong></p>








































<table><thead><tr><th>åˆ†é…å™¨ç±»å‹</th><th>åˆ†é…å¼€é”€</th><th>é‡Šæ”¾å¼€é”€</th><th>çº¿ç¨‹å®‰å…¨</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>é»˜è®¤åˆ†é…å™¨ï¼ˆstd::allocatorï¼‰</td><td>ä¸­ç­‰</td><td>ä¸­ç­‰</td><td>æ˜¯</td><td>é€šç”¨åœºæ™¯</td></tr><tr><td>å†…å­˜æ± åˆ†é…å™¨</td><td>å¿«</td><td>å¿«</td><td>å¦</td><td>å›ºå®šå¤§å°å¯¹è±¡é¢‘ç¹åˆ†é…</td></tr><tr><td>monotonic_buffer_resource</td><td>éå¸¸å¿«</td><td>é›¶å¼€é”€</td><td>å¦</td><td>ä¸´æ—¶æ•°æ®ã€æ‰¹é‡é‡Šæ”¾åœºæ™¯</td></tr><tr><td>synchronized_pool_resource</td><td>è¾ƒå¿«</td><td>è¾ƒå¿«</td><td>æ˜¯</td><td>å¤šçº¿ç¨‹ç¯å¢ƒ</td></tr></tbody></table>
<p>è‡ªå®šä¹‰åˆ†é…å™¨é€‚åˆå¯¹æ€§èƒ½æœ‰æè‡´è¦æ±‚çš„åœºæ™¯ï¼Œé€šè¿‡é€‰æ‹©åˆé€‚çš„åˆ†é…ç­–ç•¥ï¼Œå¯ä»¥å¤§å¹…å‡å°‘å†…å­˜åˆ†é…å¼€é”€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»è®¾è®¡èµ„äº§åˆ°ç”Ÿäº§ä»£ç ï¼šæ„å»ºç»„ä»¶ä¸€è‡´æ€§çš„è‡ªåŠ¨åŒ–é—­ç¯]]></title>    <link>https://juejin.cn/post/7572403510468100139</link>    <guid>https://juejin.cn/post/7572403510468100139</guid>    <pubDate>2025-11-15T10:52:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572403510468100139" data-draft-id="7572465262739144723" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" ä»è®¾è®¡èµ„äº§åˆ°ç”Ÿäº§ä»£ç ï¼šæ„å»ºç»„ä»¶ä¸€è‡´æ€§çš„è‡ªåŠ¨åŒ–é—­ç¯"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-15T10:52:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="workpieces"/> <meta itemprop="url" content="https://juejin.cn/user/2432565183260792"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             ä»è®¾è®¡èµ„äº§åˆ°ç”Ÿäº§ä»£ç ï¼šæ„å»ºç»„ä»¶ä¸€è‡´æ€§çš„è‡ªåŠ¨åŒ–é—­ç¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2432565183260792/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    workpieces
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T10:52:47.000Z" title="Sat Nov 15 2025 10:52:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. æŒ‘æˆ˜ä¸èƒŒæ™¯ï¼šè®¾è®¡ç³»ç»Ÿä¸­çš„â€œç†µå¢â€é—®é¢˜</h2>
<p>åœ¨ç°ä»£è½¯ä»¶å¼€å‘æµç¨‹ä¸­ï¼Œè®¾è®¡ç³»ç»Ÿï¼ˆDesign Systemï¼‰æ˜¯ç¡®ä¿äº§å“ç•Œé¢ç»Ÿä¸€æ€§å’Œç”¨æˆ·ä½“éªŒè¿è´¯æ€§çš„åŸºçŸ³ã€‚ç„¶è€Œï¼Œè®¾è®¡ç¨¿ä¸å®é™…ä»£ç å®ç°ä¹‹é—´å­˜åœ¨ç€ä¸€ç§å¤©ç„¶çš„â€œç†µå¢â€è¶‹åŠ¿ï¼Œå³éšç€é¡¹ç›®è¿­ä»£å’Œå›¢é˜Ÿåä½œçš„æ·±å…¥ï¼Œä¸¤è€…ä¹‹é—´çš„å·®å¼‚ä¼šä¸æ–­ç´¯ç§¯ï¼Œè¿™ç§ç°è±¡è¢«ç§°ä¸º<strong>è®¾è®¡æ¼‚ç§»ï¼ˆDesign Driftï¼‰</strong> ã€‚å½“æ ¸å¿ƒç»„ä»¶å¦‚æŒ‰é’®ï¼ˆButtonï¼‰ã€å¡ç‰‡ï¼ˆCardï¼‰å’Œè¾“å…¥æ¡†ï¼ˆInputï¼‰åœ¨è®¾è®¡å·¥å…·ï¼ˆå¦‚ Figmaï¼‰ä¸­è¢«æ›´æ–°åï¼Œå‰ç«¯ä»£ç æœªèƒ½åŠæ—¶æˆ–å‡†ç¡®åœ°åŒæ­¥ï¼Œå°±ä¼šå¯¼è‡´ç”¨æˆ·ä½“éªŒçš„å‰²è£‚ã€å¼€å‘æ•ˆç‡çš„ä¸‹é™ä»¥åŠå“ç‰Œèµ„äº§çš„ç¨€é‡Šã€‚</p>
<p>è§£å†³ç»„ä»¶ä¸€è‡´æ€§é—®é¢˜çš„å…³é”®ï¼Œåœ¨äºå»ºç«‹ä¸€ä¸ª<strong>è‡ªåŠ¨åŒ–ã€å¯é‡åŒ–</strong>çš„é—­ç¯æµæ°´çº¿ã€‚è¿™ä¸ä»…è¦æ±‚å¼€å‘è€…å…·å¤‡é«˜åº¦çš„è‡ªå¾‹æ€§ï¼Œæ›´éœ€è¦ä¸€å¥—æœºåˆ¶æ¥ä¸»åŠ¨ç›‘æµ‹ã€æŠ¥å‘Šå¹¶é©±åŠ¨å·®å¼‚çš„ä¿®å¤ã€‚æœ¬æ–‡å°†è¯¦ç»†é˜è¿°å¦‚ä½•æ„å»ºä¸€ä¸ªä» Figma è®¾è®¡èµ„äº§åˆ°ç”Ÿäº§ä»£ç çš„è‡ªåŠ¨åŒ–å¯¹é½æµæ°´çº¿ï¼Œä»¥ç¡®ä¿å±æ€§ã€çŠ¶æ€ã€äº¤äº’å’Œå¯è®¿é—®æ€§ï¼ˆa11yï¼‰çš„é«˜åº¦ä¸€è‡´æ€§ã€‚</p>
<h2 data-id="heading-1">2. è‡ªåŠ¨åŒ–é—­ç¯ï¼šFigma-to-Code å¯¹é½æµæ°´çº¿æ¶æ„</h2>
<p>å®ç°è®¾è®¡ä¸ä»£ç ä¸€è‡´æ€§çš„æ ¸å¿ƒåœ¨äºæ„å»ºä¸€ä¸ªæŒç»­é›†æˆ/æŒç»­äº¤ä»˜ï¼ˆCI/CDï¼‰é©±åŠ¨çš„è‡ªåŠ¨åŒ–é—­ç¯ã€‚è¿™ä¸ªé—­ç¯å°†è®¾è®¡èµ„äº§çš„å˜æ›´è§†ä¸ºä»£ç çš„å˜æ›´ï¼Œå¹¶è§¦å‘ä¸€ç³»åˆ—çš„éªŒè¯å’Œåé¦ˆæœºåˆ¶ã€‚</p>
<p>ä¸‹å›¾å±•ç¤ºäº†è¿™ä¸€è‡ªåŠ¨åŒ–æµæ°´çº¿çš„ç³»ç»Ÿæ¶æ„ï¼Œå®ƒå°†è®¾è®¡ã€è‡ªåŠ¨åŒ–ã€ä»£ç å’Œåé¦ˆå››ä¸ªå…³é”®å±‚çº§ç´§å¯†è¿æ¥ï¼Œå½¢æˆä¸€ä¸ªè‡ªä¿®å¤çš„ç³»ç»Ÿã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3ca4430768d4181a3af1ee8bc7856ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd29ya3BpZWNlcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763808767&amp;x-signature=JmVgBzWyMxccbkULfRdGlXyiMdk%3D" alt="ç³»ç»Ÿæ¶æ„å›¾ï¼šFigma-to-Code è‡ªåŠ¨åŒ–å¯¹é½æµæ°´çº¿" title="null" loading="lazy"/></p>
<p>ç³»ç»Ÿæ¶æ„å›¾ï¼šFigma-to-Code è‡ªåŠ¨åŒ–å¯¹é½æµæ°´çº¿</p>
<p>è¯¥æµæ°´çº¿çš„å·¥ä½œæµç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºï¼šè®¾è®¡èµ„äº§é€šè¿‡ <strong>Figma MCP API</strong> æš´éœ²å…ƒæ•°æ®ï¼Œç»ç”±è‡ªåŠ¨åŒ–å·¥å…·é“¾è¿›è¡Œä»£ç ç”Ÿæˆå’Œè§†è§‰å›å½’æµ‹è¯•ï¼Œæœ€ç»ˆå°†å·®å¼‚è½¬åŒ–ä¸ºç»“æ„åŒ–çš„ <strong>Issue</strong>ï¼Œé©±åŠ¨å¼€å‘è€…è¿›è¡Œç²¾ç¡®ä¿®å¤ï¼Œä»è€Œå®Œæˆä¸€æ¬¡é—­ç¯ã€‚</p>
<blockquote>
<p><strong>æŠ€æœ¯ç»†èŠ‚</strong>ï¼šæˆ‘ä»¬æ¨èä½¿ç”¨å®˜æ–¹ç»´æŠ¤çš„ <code>figma-mcp-sdk</code> åº“ï¼ˆGitHub åœ°å€ï¼š<code>https://github.com/figma/figma-mcp-sdk</code>ï¼‰æ¥å¤„ç†ä¸ Figma çš„æ•°æ®äº¤äº’ã€‚åŒæ—¶ï¼Œç¤¾åŒºä¹Ÿæœ‰ä¼˜ç§€çš„æ›¿ä»£æ–¹æ¡ˆï¼Œä¾‹å¦‚ <code>Figma-Context-MCP</code>ï¼ˆGitHub åœ°å€ï¼š<code>https://github.com/GLips/Figma-Context-MCP</code>ï¼‰ï¼Œå¯ä»¥æ ¹æ®é¡¹ç›®éœ€æ±‚é€‰æ‹©åˆé€‚çš„å·¥å…·ã€‚</p>
</blockquote>
<h2 data-id="heading-2">3. æ­¥éª¤ä¸€ï¼šè®¾è®¡å…ƒæ•°æ®çš„æå–ä¸è§„èŒƒåŒ–</h2>
<p>æµæ°´çº¿çš„ç¬¬ä¸€æ­¥æ˜¯ç²¾ç¡®åœ°ä»è®¾è®¡å·¥å…·ä¸­æå–ç»„ä»¶çš„<strong>è§„èŒƒï¼ˆSpecificationï¼‰</strong> ã€‚å¯¹äº Buttonã€Cardã€Input è¿™ç±»æ ¸å¿ƒç»„ä»¶ï¼Œå…¶è§„èŒƒåŒ…æ‹¬å°ºå¯¸ï¼ˆS/M/Lï¼‰ã€çŠ¶æ€ï¼ˆHover/Pressed/Disabledï¼‰ã€å›¾æ ‡æœ‰æ— ç­‰ã€‚</p>
<p><strong>æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆï¼šDesign Token</strong></p>
<p>ç›´æ¥ä» Figma API è·å–çš„åŸå§‹æ•°æ®å¾€å¾€æ˜¯é›¶æ•£çš„æ ·å¼å€¼ï¼ˆå¦‚é¢œè‰²ä»£ç ã€åƒç´ å€¼ï¼‰ã€‚ä¸ºäº†å®ç°è®¾è®¡è¯­è¨€çš„ç»“æ„åŒ–å’Œè·¨å¹³å°å¤ç”¨ï¼Œæˆ‘ä»¬å¿…é¡»å¼•å…¥ <strong>Design Token</strong> ä½œä¸ºè®¾è®¡ä¸ä»£ç ä¹‹é—´çš„â€œé€šç”¨è¯­è¨€â€ã€‚Design Token æ˜¯è®¾è®¡å†³ç­–çš„åŸå­åŒ–å‘½åå®ä½“ï¼Œä¾‹å¦‚ <code>$color-primary-blue</code> æˆ– <code>$spacing-medium</code>ã€‚</p>

























<table><thead><tr><th>æå–ç›®æ ‡</th><th>æè¿°</th><th>è§„èŒƒåŒ–ç­–ç•¥</th></tr></thead><tbody><tr><td><strong>å±æ€§</strong></td><td>å°ºå¯¸ï¼ˆSizeï¼‰ã€ç±»å‹ï¼ˆVariantï¼‰ã€å›¾æ ‡ï¼ˆIconï¼‰</td><td>æ˜ å°„ä¸ºä»£ç ç»„ä»¶çš„ Propsï¼Œä¸¥æ ¼å®šä¹‰ TS æ¥å£ã€‚</td></tr><tr><td><strong>çŠ¶æ€</strong></td><td>æ‚¬åœï¼ˆHoverï¼‰ã€æŒ‰ä¸‹ï¼ˆPressedï¼‰ã€ç¦ç”¨ï¼ˆDisabledï¼‰</td><td>æå–çŠ¶æ€ä¸‹çš„æ ·å¼å˜åŒ–ï¼Œå¦‚é¢œè‰²ã€é˜´å½±ã€é€æ˜åº¦ã€‚</td></tr><tr><td><strong>äº¤äº’</strong></td><td>ç„¦ç‚¹ï¼ˆFocusï¼‰ã€åŠ è½½ä¸­ï¼ˆBusyï¼‰</td><td>æå– <code>:focus-visible</code> æ ·å¼å’Œ <code>aria-busy</code> çŠ¶æ€çš„è§†è§‰åé¦ˆã€‚</td></tr></tbody></table>
<p>é€šè¿‡ <strong>Figma MCP</strong> æå–çš„å…ƒæ•°æ®åº”é¦–å…ˆè¢«è½¬åŒ–ä¸º Design Tokenï¼Œç„¶åè¿™äº› Token è¢«ç”¨äºé©±åŠ¨ä»£ç ç”Ÿæˆå’Œæ ·å¼å®šä¹‰ï¼Œç¡®ä¿è®¾è®¡æ„å›¾åœ¨ä»£ç å±‚é¢å¾—åˆ°å‡†ç¡®çš„è¡¨è¾¾ã€‚</p>
<blockquote>
<p><strong>Figma MCP æ¥å£åœ°å€</strong>ï¼šç»„ä»¶è§„èŒƒçš„åŸå§‹ JSON æ•°æ®å¯ä»¥é€šè¿‡ <code>https://api.figma.com/v1/mcp/files/{file_key}/components</code> æ¥å£è·å–ã€‚</p>
</blockquote>
<h3 data-id="heading-3">æŠ€æœ¯æ–¹æ¡ˆç¤ºä¾‹ï¼šDesign Token ç»“æ„</h3>
<p>Design Token é€šå¸¸ä»¥ JSON æˆ– YAML æ ¼å¼å­˜å‚¨ï¼Œä½œä¸ºè®¾è®¡å’Œä»£ç ä¹‹é—´çš„å•ä¸€äº‹å®æ¥æºï¼ˆSingle Source of Truthï¼‰ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€åŒ–çš„ Button ç»„ä»¶é¢œè‰² Token ç»“æ„ï¼š</p>
<pre><code class="hljs language-css" lang="css">  {
Â Â "<span class="hljs-attribute">color</span>":Â {
Â Â Â Â "brand":Â {
Â Â Â Â Â Â "primary":Â {
Â Â Â Â Â Â Â Â "value":Â <span class="hljs-string">"#007AFF"</span>,
Â Â Â Â Â Â Â Â <span class="hljs-string">"type"</span>:Â <span class="hljs-string">"color"</span>
Â Â Â Â Â Â },
Â Â Â Â Â Â "primary-hover":Â {
Â Â Â Â Â Â Â Â "value":Â <span class="hljs-string">"#005BB5"</span>,
Â Â Â Â Â Â Â Â <span class="hljs-string">"type"</span>:Â <span class="hljs-string">"color"</span>
Â Â Â Â Â Â }
Â Â Â Â }
Â Â },
Â Â "component":Â {
Â Â Â Â "<span class="hljs-selector-tag">button</span>":Â {
Â Â Â Â Â Â "primary":Â {
Â Â Â Â Â Â Â Â "<span class="hljs-attribute">background</span>":Â <span class="hljs-string">"{color.brand.primary}"</span>,
Â Â Â Â Â Â Â Â <span class="hljs-string">"background-hover"</span>:Â <span class="hljs-string">"{color.brand.primary-hover}"</span>
Â Â Â Â Â Â }
Â Â Â Â }
Â Â }
}
</code></pre>
<p>ä»£ç ç”Ÿæˆå™¨ä¼šè¯»å–è¿™äº› Tokenï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º CSS å˜é‡ï¼ˆå¦‚ <code>--color-brand-primary</code>ï¼‰æˆ– SCSS å˜é‡ï¼Œä¾›ç»„ä»¶ä»£ç ä½¿ç”¨ã€‚</p>
<h2 data-id="heading-4">4. æ­¥éª¤äºŒï¼šåŸºäºè§„èŒƒçš„ç»„ä»¶ä»£ç ç”Ÿæˆï¼ˆReact/TSï¼‰</h2>
<p>åœ¨è·å–äº†è§„èŒƒåŒ–çš„ Design Token å’Œç»„ä»¶å±æ€§å®šä¹‰åï¼Œä¸‹ä¸€æ­¥æ˜¯ç”Ÿæˆé«˜è´¨é‡çš„ç»„ä»¶ä»£ç ã€‚è¿™ä¸ä»…ä»…æ˜¯ç®€å•çš„æ ·å¼è½¬æ¢ï¼Œæ›´éœ€è¦å…³æ³¨<strong>å·¥ç¨‹è´¨é‡</strong>å’Œ<strong>å¯è®¿é—®æ€§</strong>ã€‚</p>
<p>ä»¥ React + TypeScript å®ç°çš„ <code>&lt;Button/&gt;</code> ç»„ä»¶ä¸ºä¾‹ï¼Œä»£ç ç”Ÿæˆå¼•æ“éœ€è¦ç¡®ä¿ä»¥ä¸‹å…³é”®ç‚¹çš„å®ç°ï¼š</p>
<ol>
<li>
<ol>
<li><strong>ç±»å‹å®‰å…¨ï¼ˆType Safetyï¼‰</strong> ï¼šåŸºäº Design Token å¯¼å‡ºçš„å±æ€§ï¼Œè‡ªåŠ¨ç”Ÿæˆä¸¥æ ¼çš„ TypeScript æ¥å£ï¼Œä¾‹å¦‚ï¼š</li>
</ol>

<pre><code class="hljs language-arduino" lang="arduino">  interfaceÂ ButtonPropsÂ {
Â Â size:Â <span class="hljs-string">'S'</span>Â |Â <span class="hljs-string">'M'</span>Â |Â <span class="hljs-string">'L'</span>;
Â Â variant:Â <span class="hljs-string">'primary'</span>Â |Â <span class="hljs-string">'secondary'</span>;
Â Â icon?:Â React.ReactNode;
Â Â isPressed?:Â <span class="hljs-type">boolean</span>;Â <span class="hljs-comment">//Â å¯¹åº”Â aria-pressed</span>
Â Â isBusy?:Â <span class="hljs-type">boolean</span>;Â Â Â Â <span class="hljs-comment">//Â å¯¹åº”Â aria-busy</span>
}
</code></pre>
</li>
<li>
<ol start="2">
<li><strong>å¯è®¿é—®æ€§ï¼ˆAccessibility, a11yï¼‰</strong> ï¼šè‡ªåŠ¨æ³¨å…¥ WAI-ARIA å±æ€§ã€‚ä¾‹å¦‚ï¼Œå½“æŒ‰é’®å¤„äºåŠ è½½çŠ¶æ€æ—¶ï¼Œåº”è®¾ç½® <code>aria-busy="true"</code>ï¼›å½“æŒ‰é’®è¢«æŒ‰ä¸‹æ—¶ï¼Œåº”è®¾ç½® <code>aria-pressed="true"</code>ã€‚åŒæ—¶ï¼Œå¿…é¡»å®ç° <code>:focus-visible</code> ä¼ªç±»çš„æ— éšœç¢ç„¦ç‚¹æ ·å¼ï¼Œç¡®ä¿é”®ç›˜ç”¨æˆ·èƒ½å¤Ÿæ¸…æ™°è¯†åˆ«å½“å‰ç„¦ç‚¹ä½ç½®ã€‚</li>
</ol>
</li>
<li>
<ol start="3">
<li><strong>çŠ¶æ€é€»è¾‘</strong>ï¼šæ ¹æ®æå–çš„çŠ¶æ€è§„èŒƒï¼Œç”Ÿæˆå¯¹åº”çš„ CSS æˆ– CSS-in-JS æ ·å¼ï¼Œç²¾ç¡®åŒ¹é… Figma ä¸­ Hoverã€Pressedã€Disabled çŠ¶æ€çš„è§†è§‰æ•ˆæœã€‚</li>
</ol>
</li>
</ol>
<p>é«˜è´¨é‡çš„ä»£ç ç”Ÿæˆä¸ä»…æé«˜äº†å¼€å‘æ•ˆç‡ï¼Œæ›´ä»æºå¤´ä¸Šä¿è¯äº†ç»„ä»¶çš„<strong>åŠŸèƒ½ä¸€è‡´æ€§</strong>å’Œ<strong>è¯­ä¹‰æ­£ç¡®æ€§</strong>ã€‚</p>
<h3 data-id="heading-5">æŠ€æœ¯æ–¹æ¡ˆç¤ºä¾‹ï¼šReact/TS Button ç»„ä»¶å®ç°</h3>
<p>ä»¥ä¸‹æ˜¯ <code>&lt;Button/&gt;</code> ç»„ä»¶çš„å…³é”®å®ç°ä¼ªä»£ç ï¼Œå®ƒå±•ç¤ºäº†å¦‚ä½•å°† Design Token é©±åŠ¨çš„æ ·å¼ã€TypeScript ç±»å‹å’Œå¯è®¿é—®æ€§å±æ€§ï¼ˆa11yï¼‰ç»“åˆèµ·æ¥ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">  <span class="hljs-comment">//Â Button.tsxÂ -Â ä¼ªä»£ç </span>
<span class="hljs-keyword">import</span>Â <span class="hljs-title class_">React</span>Â <span class="hljs-keyword">from</span>Â <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span>Â <span class="hljs-string">'./Button.css'</span>;Â <span class="hljs-comment">//Â æ ·å¼æ–‡ä»¶ç”±Â DesignÂ TokenÂ ç¼–è¯‘ç”Ÿæˆ</span>

<span class="hljs-keyword">interface</span>Â <span class="hljs-title class_">ButtonProps</span>Â {
Â Â <span class="hljs-attr">size</span>:Â <span class="hljs-string">'S'</span>Â |Â <span class="hljs-string">'M'</span>Â |Â <span class="hljs-string">'L'</span>;
Â Â <span class="hljs-attr">variant</span>:Â <span class="hljs-string">'primary'</span>Â |Â <span class="hljs-string">'secondary'</span>;
Â Â icon?:Â <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactNode</span>;
Â Â isPressed?:Â <span class="hljs-built_in">boolean</span>;Â <span class="hljs-comment">//Â å¯¹åº”Â FigmaÂ çš„Â PressedÂ çŠ¶æ€</span>
Â Â isBusy?:Â <span class="hljs-built_in">boolean</span>;Â Â Â Â <span class="hljs-comment">//Â å¯¹åº”Â FigmaÂ çš„Â LoadingÂ çŠ¶æ€</span>
Â Â <span class="hljs-attr">children</span>:Â <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactNode</span>;
Â Â <span class="hljs-attr">onClick</span>:Â <span class="hljs-function">()Â =&gt;</span>Â <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">const</span>Â <span class="hljs-title class_">Button</span>:Â <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">ButtonProps</span>&gt;Â =Â <span class="hljs-function">(<span class="hljs-params">{
Â Â size,
Â Â variant,
Â Â icon,
Â Â isPressedÂ =Â <span class="hljs-literal">false</span>,
Â Â isBusyÂ =Â <span class="hljs-literal">false</span>,
Â Â children,
Â Â ...rest
}</span>)Â =&gt;</span>Â {
Â Â <span class="hljs-comment">//Â 1.Â åŠ¨æ€ç±»åï¼šæ ¹æ®Â PropsÂ æ˜ å°„Â DesignÂ TokenÂ æ ·å¼</span>
Â Â <span class="hljs-keyword">const</span>Â classNameÂ =Â <span class="hljs-string">`btnÂ btn--<span class="hljs-subst">${variant}</span>Â btn--<span class="hljs-subst">${size}</span>Â <span class="hljs-subst">${isBusyÂ ?Â <span class="hljs-string">'btn--busy'</span>Â :Â <span class="hljs-string">''</span>}</span>`</span>;

Â Â <span class="hljs-comment">//Â 2.Â å¯è®¿é—®æ€§Â (a11y)Â å±æ€§æ³¨å…¥</span>
Â Â <span class="hljs-keyword">const</span>Â ariaPropsÂ =Â {
Â Â Â Â <span class="hljs-string">'aria-pressed'</span>:Â isPressed,
Â Â Â Â <span class="hljs-string">'aria-busy'</span>:Â isBusy,
Â Â Â Â <span class="hljs-string">'aria-disabled'</span>:Â isBusyÂ ||Â rest.<span class="hljs-property">disabled</span>,Â <span class="hljs-comment">//Â å¿™ç¢Œæˆ–ç¦ç”¨æ—¶ï¼Œä¹Ÿåº”ç¦ç”¨</span>
Â Â };

Â Â <span class="hljs-keyword">return</span>Â (
Â Â Â Â <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>
Â Â Â Â Â Â <span class="hljs-attr">className</span>=<span class="hljs-string">{className}</span>
Â Â Â Â Â Â <span class="hljs-attr">disabled</span>=<span class="hljs-string">{rest.disabled</span>Â ||Â <span class="hljs-attr">isBusy</span>}
Â Â Â Â Â Â {<span class="hljs-attr">...ariaProps</span>}
Â Â Â Â Â Â {<span class="hljs-attr">...rest</span>}
Â Â Â Â &gt;</span>
Â Â Â Â Â Â {isBusyÂ ?Â <span class="hljs-tag">&lt;<span class="hljs-name">span</span>Â <span class="hljs-attr">className</span>=<span class="hljs-string">"spinner"</span>Â /&gt;</span>Â :Â icon}
Â Â Â Â Â Â {children}
Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
Â Â );
};

<span class="hljs-comment">//Â Button.cssÂ -Â å…³é”®çŠ¶æ€æ ·å¼ï¼ˆç”±Â DesignÂ TokenÂ ç¼–è¯‘ï¼‰</span>
<span class="hljs-comment">/*
.btn:focus-visibleÂ {
Â Â outline:Â 3pxÂ solidÂ var(--color-focus-ring);Â //Â æ— éšœç¢ç„¦ç‚¹æ ·å¼
Â Â outline-offset:Â 2px;
}

.btn--primary:hoverÂ {
Â Â background-color:Â var(--color-brand-primary-hover);Â //Â é©±åŠ¨è§†è§‰å›å½’çš„æ ·å¼
}
*/</span>
</code></pre>
<p>è¿™ä¸ªç¤ºä¾‹æ¸…æ™°åœ°å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ç±»å‹å®šä¹‰ï¼ˆ<code>ButtonProps</code>ï¼‰ã€çŠ¶æ€å±æ€§ï¼ˆ<code>isPressed</code>, <code>isBusy</code>ï¼‰å’Œ ARIA å±æ€§çš„æ³¨å…¥ï¼Œå®ç°è®¾è®¡è§„èŒƒä¸­å¯¹äº¤äº’å’Œå¯è®¿é—®æ€§çš„è¦æ±‚ã€‚</p>
<h2 data-id="heading-6">5. æ­¥éª¤ä¸‰ï¼šè§†è§‰å›å½’ä¸å·®å¼‚é‡åŒ–</h2>
<p>åŠŸèƒ½å’Œè¯­ä¹‰çš„ä¸€è‡´æ€§æ˜¯åŸºç¡€ï¼Œä½†<strong>è§†è§‰ä¸€è‡´æ€§</strong>æ‰æ˜¯ç”¨æˆ·ç›´æ¥æ„ŸçŸ¥åˆ°çš„è´¨é‡ã€‚è§†è§‰å›å½’æµ‹è¯•æ˜¯ç¡®ä¿è®¾è®¡ä¸ä»£ç è§†è§‰å¯¹é½çš„æœ€ç»ˆé˜²çº¿ã€‚</p>
<p><strong>æµç¨‹ä¸å·¥å…·é“¾</strong></p>
<ol>
<li>
<ol>
<li><strong>æ¸²æŸ“ç»„ä»¶</strong>ï¼šåœ¨éš”ç¦»çš„æµ‹è¯•ç¯å¢ƒï¼ˆå¦‚ Storybookï¼‰ä¸­ï¼Œæ¸²æŸ“æ‰€æœ‰ç»„åˆçŠ¶æ€ä¸‹çš„æ ¸å¿ƒç»„ä»¶ï¼ˆButtonã€Cardã€Inputï¼‰ã€‚</li>
</ol>
</li>
<li>
<ol start="2">
<li><strong>è‡ªåŠ¨åŒ–æˆªå›¾</strong>ï¼šCI/CD æµç¨‹è§¦å‘è‡ªåŠ¨åŒ–å·¥å…·ï¼ˆå¦‚ Playwright æˆ– Chromaticï¼‰å¯¹æ¯ä¸ªç»„ä»¶çŠ¶æ€è¿›è¡Œæˆªå›¾ã€‚</li>
</ol>
</li>
<li>
<ol start="3">
<li><strong>åƒç´ çº§æ¯”å¯¹</strong>ï¼šå°†ä»£ç ç¯å¢ƒç”Ÿæˆçš„æˆªå›¾ä¸ Figma å¯¼å‡ºçš„â€œé»„é‡‘æ ‡å‡†â€å‚è€ƒå›¾è¿›è¡Œåƒç´ çº§æ¯”å¯¹ã€‚</li>
</ol>
</li>
</ol>
<p>ä¸‹å›¾å±•ç¤ºäº†è§†è§‰å›å½’æµ‹è¯•çš„å·¥ä½œåŸç†ï¼šé€šè¿‡é«˜äº®æ˜¾ç¤ºä¸¤ä¸ªå›¾åƒä¹‹é—´çš„åƒç´ å·®å¼‚ï¼Œå®ç°å·®å¼‚çš„<strong>é‡åŒ–</strong>ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/402274c549334cc2871b98b7a38fdeb1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd29ya3BpZWNlcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763808767&amp;x-signature=E1KSGOR9dSej40OlJwpr%2BdLaOAo%3D" alt="è§†è§‰å›å½’å¯¹æ¯”ç¤ºæ„å›¾ï¼šé«˜äº®åƒç´ å·®å¼‚" title="null" loading="lazy"/></p>
<p>è§†è§‰å›å½’å¯¹æ¯”ç¤ºæ„å›¾ï¼šé«˜äº®åƒç´ å·®å¼‚</p>
<p><strong>å·®å¼‚é‡åŒ–æŒ‡æ ‡</strong>ï¼š<br/>
è§†è§‰å›å½’å·¥å…·ä¼šè¾“å‡ºä¸€ä¸ªå·®å¼‚ç™¾åˆ†æ¯”ï¼ˆPixel Difference Percentageï¼‰ã€‚åªæœ‰å½“è¿™ä¸ªç™¾åˆ†æ¯”<strong>è¶…è¿‡é¢„è®¾çš„é˜ˆå€¼</strong>ï¼ˆä¾‹å¦‚ 0.1%ï¼‰æ—¶ï¼Œæ‰ä¼šè¢«åˆ¤å®šä¸ºâ€œè¶…å·®â€ï¼Œå¹¶è§¦å‘åç»­çš„åé¦ˆæµç¨‹ã€‚è¿™ç§é‡åŒ–æœºåˆ¶å°†ä¸»è§‚çš„â€œçœ‹èµ·æ¥ä¸ä¸€æ ·â€è½¬åŒ–ä¸ºå®¢è§‚çš„å·¥ç¨‹æŒ‡æ ‡ã€‚</p>
<h3 data-id="heading-7">æŠ€æœ¯æ–¹æ¡ˆç¤ºä¾‹ï¼šè§†è§‰å›å½’è„šæœ¬ï¼ˆPlaywright/Storybookï¼‰</h3>
<p>è§†è§‰å›å½’è„šæœ¬çš„æ ¸å¿ƒæ˜¯éå†ç»„ä»¶çš„æ‰€æœ‰çŠ¶æ€ç»„åˆï¼Œè¿›è¡Œæˆªå›¾ï¼Œå¹¶è°ƒç”¨æ¯”å¯¹å·¥å…·ã€‚ä»¥ä¸‹æ˜¯åŸºäº Playwright å’Œ Storybook çš„ä¼ªä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-dart" lang="dart">  <span class="hljs-comment">//Â visual-regression.test.jsÂ -Â ä¼ªä»£ç </span>
<span class="hljs-keyword">const</span>Â {Â test,Â expectÂ }Â =Â require(<span class="hljs-string">'@playwright/test'</span>);

test.describe(<span class="hljs-string">'ButtonÂ ComponentÂ VisualÂ Regression'</span>,Â ()Â =&gt;Â {
Â Â <span class="hljs-comment">//Â 1.Â è®¿é—®Â StorybookÂ é¡µé¢</span>
Â Â test.beforeEach(<span class="hljs-keyword">async</span>Â ({Â pageÂ })Â =&gt;Â {
Â Â Â Â <span class="hljs-keyword">await</span>Â page.goto(<span class="hljs-string">'http://localhost:6006/iframe.html?id=components-button--all-states'</span>);
Â Â });

Â Â <span class="hljs-comment">//Â 2.Â æµ‹è¯•Â HoverÂ çŠ¶æ€</span>
Â Â test(<span class="hljs-string">'shouldÂ matchÂ snapshotÂ forÂ PrimaryÂ ButtonÂ HoverÂ state'</span>,Â <span class="hljs-keyword">async</span>Â ({Â pageÂ })Â =&gt;Â {
Â Â Â Â <span class="hljs-keyword">const</span>Â primaryButtonÂ =Â page.locator(<span class="hljs-string">'[data-testid="primary-button"]'</span>);
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â è§¦å‘Â HoverÂ çŠ¶æ€</span>
Â Â Â Â <span class="hljs-keyword">await</span>Â primaryButton.hover();Â 
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â æˆªå›¾å¹¶ä¸åŸºå‡†å›¾ï¼ˆFigmaÂ å¯¼å‡ºå›¾ï¼‰æ¯”å¯¹</span>
Â Â Â Â <span class="hljs-keyword">await</span>Â expect(primaryButton).toHaveScreenshot(<span class="hljs-string">'primary-button-hover.png'</span>,Â {
Â Â Â Â Â Â <span class="hljs-comment">//Â é…ç½®åƒç´ å·®å¼‚é˜ˆå€¼ï¼Œä¾‹å¦‚Â 0.1%</span>
Â Â Â Â Â Â maxDiffPixelRatio:Â <span class="hljs-number">0.001</span>,Â 
Â Â Â Â });
Â Â });

Â Â <span class="hljs-comment">//Â 3.Â æµ‹è¯•Â DisabledÂ çŠ¶æ€</span>
Â Â test(<span class="hljs-string">'shouldÂ matchÂ snapshotÂ forÂ DisabledÂ ButtonÂ state'</span>,Â <span class="hljs-keyword">async</span>Â ({Â pageÂ })Â =&gt;Â {
Â Â Â Â <span class="hljs-keyword">const</span>Â disabledButtonÂ =Â page.locator(<span class="hljs-string">'[data-testid="disabled-button"]'</span>);
Â Â Â Â <span class="hljs-keyword">await</span>Â expect(disabledButton).toHaveScreenshot(<span class="hljs-string">'disabled-button.png'</span>,Â {
Â Â Â Â Â Â maxDiffPixelRatio:Â <span class="hljs-number">0.001</span>,
Â Â Â Â });
Â Â });
Â Â 
Â Â <span class="hljs-comment">//Â ...Â å…¶ä»–çŠ¶æ€ï¼ˆPressed,Â Busy,Â SizeÂ S/M/Lï¼‰</span>
});
</code></pre>
<p>è¿™æ®µè„šæœ¬é€šè¿‡æ¨¡æ‹Ÿç”¨æˆ·äº¤äº’ï¼ˆå¦‚ <code>hover()</code>ï¼‰ï¼Œç¡®ä¿äº†ç»„ä»¶åœ¨å„ç§<strong>åŠ¨æ€çŠ¶æ€</strong>ä¸‹çš„è§†è§‰æ•ˆæœä¹Ÿèƒ½è¢«ç²¾ç¡®æ•è·å’ŒéªŒè¯ï¼Œä»è€Œå®ç°äº†å¯¹ Figma è§„èŒƒä¸­æ‰€æœ‰çŠ¶æ€çš„è‡ªåŠ¨åŒ–å¯¹é½ã€‚</p>
<h2 data-id="heading-8">6. æ­¥éª¤å››ï¼šå·®å¼‚ Issue çš„è‡ªåŠ¨åŒ–ç”Ÿæˆä¸è¿½è¸ª</h2>
<p>è§†è§‰å›å½’æŠ¥å‘Šçš„ä»·å€¼åœ¨äºå…¶<strong>å¯æ“ä½œæ€§</strong>ã€‚ä¸€ä¸ªä¼˜ç§€çš„æµæ°´çº¿å¿…é¡»å°†åŸå§‹çš„åƒç´ å·®å¼‚æŠ¥å‘Šè½¬åŒ–ä¸ºå¼€å‘è€…å¯ä»¥ç›´æ¥å¤„ç†çš„ç»“æ„åŒ–ä»»åŠ¡ã€‚</p>
<p>å½“æ£€æµ‹åˆ°è¶…å·®æ—¶ï¼Œç³»ç»Ÿåº”è‡ªåŠ¨åˆ›å»º Issue åˆ°é¡¹ç›®ç®¡ç†å¹³å°ï¼ˆå¦‚ Jira æˆ– GitHub Issuesï¼‰ï¼Œå¹¶éµå¾ªç»Ÿä¸€çš„ Issue æ¨¡æ¿ï¼Œç¡®ä¿ä¿¡æ¯å®Œæ•´ä¸”æ˜“äºä¿®å¤ã€‚</p>



































<table><thead><tr><th>Issue å­—æ®µ</th><th>ç¤ºä¾‹å†…å®¹</th><th>è‡ªåŠ¨åŒ–æ¥æº</th></tr></thead><tbody><tr><td><strong>æ ‡é¢˜</strong></td><td><code>[Button]-Hover-é¢œè‰²å·®å¼‚</code></td><td>ç»„ä»¶åã€çŠ¶æ€ã€å·®å¼‚ç±»å‹</td></tr><tr><td><strong>å½±å“èŒƒå›´</strong></td><td><code>Button.tsx, Button.css</code></td><td>ä»£ç ç”Ÿæˆ/å›å½’æµ‹è¯•çš„ä¸Šä¸‹æ–‡</td></tr><tr><td><strong>å¤ç°æ­¥éª¤</strong></td><td>è®¿é—® Storybook é“¾æ¥ï¼Œå°†é¼ æ ‡æ‚¬åœåœ¨ Primary Button ä¸Šã€‚</td><td>è‡ªåŠ¨åŒ–æµ‹è¯•ç¯å¢ƒé“¾æ¥</td></tr><tr><td><strong>å·®å¼‚æˆªå›¾</strong></td><td>é™„å¸¦è§†è§‰å›å½’å·¥å…·ç”Ÿæˆçš„å¯¹æ¯”å›¾é“¾æ¥ã€‚</td><td>è§†è§‰å›å½’æŠ¥å‘Š</td></tr><tr><td><strong>ä¿®å¤å»ºè®®</strong></td><td>æ£€æŸ¥ CSS å˜é‡ <code>$color-primary-hover</code> æ˜¯å¦ä¸ Design Token ä¸€è‡´ã€‚</td><td>Design Token æ˜ å°„è¡¨</td></tr></tbody></table>
<p>è¿™ç§è‡ªåŠ¨åŒ–çš„ Issue æ¸…å•ï¼Œå°†â€œè®¾è®¡æ¼‚ç§»â€çš„å‘ç°ã€é‡åŒ–å’Œä¿®å¤å·¥ä½œå®Œå…¨çº³å…¥äº†å·¥ç¨‹æµç¨‹ï¼Œæå¤§åœ°ç¼©çŸ­äº†åé¦ˆå‘¨æœŸï¼Œå¹¶ç¡®ä¿äº†æ¯ä¸€ä¸ªä¸ä¸€è‡´ç‚¹éƒ½èƒ½è¢«ç²¾ç¡®è¿½è¸ªå’Œè§£å†³ã€‚</p>
<h2 data-id="heading-9">7. å®è·µæŒ‡å—ï¼šAI é©±åŠ¨çš„ç»„ä»¶å¯¹é½æ“ä½œæ‰‹å†Œ</h2>
<p>ä¸ºäº†è®©è¿™å¥—æµæ°´çº¿çœŸæ­£è½åœ°ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ™ºèƒ½çš„â€œåè°ƒè€…â€æ¥æ‰§è¡Œè·¨å·¥å…·é“¾çš„å¤æ‚æŒ‡ä»¤ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠè®¾è®¡è§„èŒƒçš„è§£è¯»å’Œä»£ç çš„åˆæ­¥ç”Ÿæˆã€‚åœ¨æˆ‘ä»¬çš„å®è·µä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨äº†ä¸€ä¸ªåŸºäº <strong>Model Context Protocol (MCP)</strong> çš„ AI ä»£ç†ï¼ˆä¾‹å¦‚ï¼Œç”¨æˆ·æåˆ°çš„ <code>claude</code> æˆ–ä¸€ä¸ªå®šåˆ¶çš„ AI-CLI å·¥å…·ï¼‰æ¥é©±åŠ¨æ ¸å¿ƒæ­¥éª¤ã€‚</p>
<p>ä»¥ä¸‹æ˜¯å®ç°æ‚¨æœ€åˆè®¾æƒ³çš„å››ä¸ªæ ¸å¿ƒæ­¥éª¤æ‰€éœ€çš„æŠ€æœ¯æŒ‡ç¤ºå’Œæç¤ºè¯æ¨¡æ¿ï¼š</p>
<h3 data-id="heading-10">æ­¥éª¤ 1: è¯»å–ç»„ä»¶è§„èŒƒï¼ˆFigma MCP + AI è§£è¯»ï¼‰</h3>
<p><strong>ç›®æ ‡</strong>ï¼šå°† Figma ä¸­ Button ç»„ä»¶çš„è§†è§‰å’Œäº¤äº’è§„èŒƒï¼ˆå°ºå¯¸ã€çŠ¶æ€ã€a11yï¼‰ç»“æ„åŒ–åœ°æå–å‡ºæ¥ã€‚</p>
<p><strong>æŠ€æœ¯æŒ‡ç¤º</strong>ï¼šé€šè¿‡ Figma MCP æ¥å£è·å–ç»„ä»¶çš„ JSON æè¿°ï¼Œç„¶åå°†æè¿°å’Œæå–è¦æ±‚ä¼ é€’ç»™ AI ä»£ç†ã€‚</p>
<p><strong>æç¤ºè¯æ¨¡æ¿</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">  #Â æ¨¡æ‹ŸÂ AI-CLIÂ è°ƒç”¨ï¼Œè¯»å–Â FigmaÂ ç»„ä»¶å¹¶ç”Ÿæˆç»“æ„åŒ–è§„èŒƒ
claudeÂ "è¯»å–Â FigmaÂ çš„Â <span class="hljs-selector-tag">Button</span>Â ç»„ä»¶ï¼šå°ºå¯¸(S/M/L)ã€çŠ¶æ€(Hover/Pressed/Disabled)ã€å›¾æ ‡æœ‰æ— ã€a11yÂ å±æ€§(aria-pressed/aria-busy)ã€‚è¾“å‡ºä¸ºÂ MarkdownÂ è¡¨æ ¼æ ¼å¼çš„ç»„ä»¶è§„èŒƒæ–‡æ¡£ã€‚"
</code></pre>
<p><strong>é¢„æœŸäº§å‡º</strong>ï¼šä¸€ä»½åŒ…å«æ‰€æœ‰çŠ¶æ€ã€å±æ€§åŠå…¶å¯¹åº”å€¼çš„ Markdown è§„èŒƒæ–‡æ¡£ã€‚</p>
<h3 data-id="heading-11">æ­¥éª¤ 2: ç”Ÿæˆä»£ç å®ç°ï¼ˆAI ä»£ç ç”Ÿæˆ + TS/a11y çº¦æŸï¼‰</h3>
<p><strong>ç›®æ ‡</strong>ï¼šåŸºäºä¸Šä¸€æ­¥çš„è§„èŒƒï¼Œç”Ÿæˆé«˜è´¨é‡ã€ç¬¦åˆ React/TS è§„èŒƒä¸”åŒ…å« a11y å±æ€§çš„ç»„ä»¶ä»£ç ã€‚</p>
<p><strong>æŠ€æœ¯æŒ‡ç¤º</strong>ï¼šå°†ä¸Šä¸€æ­¥çš„è§„èŒƒæ–‡æ¡£ä½œä¸ºä¸Šä¸‹æ–‡ï¼Œè¦æ±‚ AI ä»£ç†ç”Ÿæˆå®Œæ•´çš„ç»„ä»¶æ–‡ä»¶å’Œå•æµ‹æ–‡ä»¶ã€‚</p>
<p><strong>æç¤ºè¯æ¨¡æ¿</strong>ï¼š</p>
<pre><code class="hljs language-css" lang="css">  #Â æ¨¡æ‹ŸÂ AI-CLIÂ è°ƒç”¨ï¼Œç”Ÿæˆä»£ç å®ç°
claudeÂ "åŸºäºæä¾›çš„Â <span class="hljs-selector-tag">Button</span>Â ç»„ä»¶è§„èŒƒï¼ˆ<span class="hljs-selector-attr">[å¼•ç”¨æ­¥éª¤1çš„è§„èŒƒæ–‡æ¡£]</span>ï¼‰ï¼Œè¾“å‡ºå®Œæ•´çš„Â &lt;<span class="hljs-selector-tag">Button</span>/&gt;Â ç»„ä»¶Â React+TSÂ å®ç°ã€‚è¦æ±‚ï¼š
<span class="hljs-number">1</span>.Â å¿…é¡»æ”¯æŒÂ aria-pressed/aria-busyÂ å±æ€§æ³¨å…¥ã€‚
<span class="hljs-number">2</span>.Â å¿…é¡»åŒ…å«Â <span class="hljs-selector-pseudo">:focus</span>-visibleÂ çš„æ— éšœç¢ç„¦ç‚¹æ ·å¼ã€‚
<span class="hljs-number">3</span>.Â é™„å¸¦Â TSÂ ç±»å‹å®šä¹‰å’Œè‡³å°‘ä¸€ä¸ªçŠ¶æ€ï¼ˆå¦‚Â Hoverï¼‰çš„å•æµ‹æ–‡ä»¶ï¼ˆä½¿ç”¨Â Jest/TestingÂ Libraryï¼‰ã€‚"
</code></pre>
<p><strong>é¢„æœŸäº§å‡º</strong>ï¼š<code>Button.tsx</code> (ç»„ä»¶ä»£ç ), <code>Button.css</code> (æ ·å¼æ–‡ä»¶), <code>Button.test.tsx</code> (å•æµ‹æ–‡ä»¶)ã€‚</p>
<h3 data-id="heading-12">æ­¥éª¤ 3: å›å½’å¯¹æ¯”ï¼ˆè§†è§‰å›å½’è„šæœ¬ç”Ÿæˆï¼‰</h3>
<p><strong>ç›®æ ‡</strong>ï¼šç”Ÿæˆä¸€ä¸ª Playwright/Storybook è„šæœ¬ï¼Œç”¨äºè‡ªåŠ¨åŒ–æ‰§è¡Œè§†è§‰å›å½’æµ‹è¯•ã€‚</p>
<p><strong>æŠ€æœ¯æŒ‡ç¤º</strong>ï¼šè¦æ±‚ AI ä»£ç†ç”Ÿæˆä¸€ä¸ªèƒ½å¤Ÿéå†æ‰€æœ‰å…³é”®çŠ¶æ€ï¼ˆHover, Pressed, Disabled, Busyï¼‰å¹¶è¿›è¡Œæˆªå›¾æ¯”å¯¹çš„æµ‹è¯•è„šæœ¬ã€‚</p>
<p><strong>æç¤ºè¯æ¨¡æ¿</strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">  #Â æ¨¡æ‹ŸÂ AI-CLIÂ è°ƒç”¨ï¼Œç”Ÿæˆè§†è§‰å›å½’è„šæœ¬
claudeÂ "ç”ŸæˆÂ PlaywrightÂ è§†è§‰å›å½’è„šæœ¬ã€‚ç›®æ ‡æ˜¯æµ‹è¯•Â <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span>/&gt;</span></span>Â ç»„ä»¶çš„Â Hover,Â Pressed,Â DisabledÂ ä¸‰ç§çŠ¶æ€ã€‚è„šæœ¬éœ€åŒ…å«ï¼š
<span class="hljs-bullet">1.</span>Â è®¿é—®Â StorybookÂ ç¯å¢ƒçš„é€»è¾‘ã€‚
<span class="hljs-bullet">2.</span>Â æ¨¡æ‹Ÿç”¨æˆ·äº¤äº’ï¼ˆå¦‚Â .hover()ï¼‰ã€‚
<span class="hljs-bullet">3.</span>Â ä½¿ç”¨Â toHaveScreenshot()Â æ–¹æ³•ï¼Œè®¾ç½®Â maxDiffPixelRatioÂ ä¸ºÂ 0.001Â è¿›è¡Œåƒç´ çº§æ¯”å¯¹ã€‚
<span class="hljs-bullet">4.</span>Â è¾“å‡ºå®Œæ•´çš„Â visual-regression.test.jsÂ æ–‡ä»¶å†…å®¹ã€‚"
</code></pre>
<p><strong>é¢„æœŸäº§å‡º</strong>ï¼š<code>visual-regression.test.js</code> (è§†è§‰å›å½’è„šæœ¬)ã€‚</p>
<h3 data-id="heading-13">æ­¥éª¤ 4: å·®å¼‚ Issue æ¸…å•ï¼ˆæŠ¥å‘Šç»“æ„åŒ–ï¼‰</h3>
<p><strong>ç›®æ ‡</strong>ï¼šå°†è§†è§‰å›å½’å·¥å…·ï¼ˆå¦‚ Chromatic æˆ– Playwright æŠ¥å‘Šï¼‰è¾“å‡ºçš„åŸå§‹å·®å¼‚æ•°æ®ï¼Œè½¬åŒ–ä¸ºå¯å¯¼å…¥é¡¹ç›®ç®¡ç†å¹³å°ï¼ˆå¦‚ Jiraï¼‰çš„ç»“æ„åŒ– Issue æ¸…å•ã€‚</p>
<p><strong>æŠ€æœ¯æŒ‡ç¤º</strong>ï¼šå°†è§†è§‰å›å½’æŠ¥å‘Šçš„ JSON æˆ– Markdown æ‘˜è¦ä½œä¸ºè¾“å…¥ï¼Œè¦æ±‚ AI ä»£ç†å°†å…¶æ ¼å¼åŒ–ä¸º Issue æ¨¡æ¿ã€‚</p>
<p><strong>æç¤ºè¯æ¨¡æ¿</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">  <span class="hljs-comment">#Â æ¨¡æ‹ŸÂ AI-CLIÂ è°ƒç”¨ï¼Œå°†å·®å¼‚æŠ¥å‘Šè½¬åŒ–ä¸ºÂ Issue</span>
claudeÂ -pÂ "æŠŠè§†è§‰å›å½’æŠ¥å‘Šä¸­çš„æ‰€æœ‰è¶…å·®é¡¹è½¬ä¸ºÂ IssueÂ æ¸…å•ã€‚æ¯ä¸ªÂ IssueÂ å¿…é¡»éµå¾ªä»¥ä¸‹æ ¼å¼ï¼š
æ ‡é¢˜:Â <span class="hljs-section">[ç»„ä»¶å]</span>-<span class="hljs-section">[çŠ¶æ€]</span>-<span class="hljs-section">[é—®é¢˜ç±»å‹]</span>
å­—æ®µ:Â å½±å“èŒƒå›´/å¤ç°æ­¥éª¤/ä¿®å¤å»ºè®®
å¤ç°æ­¥éª¤ä¸­å¿…é¡»åŒ…å«Â StorybookÂ é“¾æ¥å’Œå·®å¼‚æˆªå›¾é“¾æ¥ã€‚
è¾“å‡ºä¸ºÂ MarkdownÂ æ ¼å¼çš„Â IssueÂ åˆ—è¡¨ï¼Œå¯ç›´æ¥å¤åˆ¶åˆ°Â Jira/GitHubÂ IssueÂ æ‰¹é‡åˆ›å»ºå·¥å…·ä¸­ã€‚"
</code></pre>
<p><strong>é¢„æœŸäº§å‡º</strong>ï¼šMarkdown æ ¼å¼çš„ Issue æ¸…å•ã€‚</p>
<h2 data-id="heading-14">8. æ€»ç»“ä¸å±•æœ›ï¼šæŒç»­é›†æˆä¸­çš„è®¾è®¡ä¸€è‡´æ€§ä¿éšœ</h2>
<p>æ„å»ºâ€œè®¾è®¡åˆ°ä»£ç çš„ä¸€è‡´æ€§æ£€æŸ¥â€æµæ°´çº¿ï¼Œæ˜¯ä»<strong>è¢«åŠ¨ä¿®å¤</strong>è½¬å‘<strong>ä¸»åŠ¨ä¿éšœ</strong>çš„å…³é”®ä¸€æ­¥ã€‚å®ƒå°†è®¾è®¡ç³»ç»Ÿä»ä¸€ä¸ªé™æ€çš„è§„èŒƒæ–‡æ¡£ï¼Œå‡çº§ä¸ºä¸€ä¸ªåœ¨æŒç»­é›†æˆç¯å¢ƒä¸­è¿è¡Œçš„<strong>åŠ¨æ€è´¨é‡ä¿éšœæœºåˆ¶</strong>ã€‚</p>
<p>é€šè¿‡ <strong>Figma MCP</strong> æå–è®¾è®¡å…ƒæ•°æ®ã€åŸºäº <strong>Design Token</strong> é©±åŠ¨ä»£ç ç”Ÿæˆã€åˆ©ç”¨ <strong>è§†è§‰å›å½’</strong> è¿›è¡Œé‡åŒ–éªŒè¯ï¼Œå¹¶æœ€ç»ˆé€šè¿‡ <strong>è‡ªåŠ¨åŒ– Issue</strong> å®Œæˆé—­ç¯ï¼Œæˆ‘ä»¬æˆåŠŸåœ°å°†è®¾è®¡ä¸€è‡´æ€§çº³å…¥äº†å·¥ç¨‹è´¨é‡çš„èŒƒç•´ã€‚è¿™ä¸ä»…è§£æ”¾äº†è®¾è®¡å¸ˆå’Œå¼€å‘è€…çš„é‡å¤æ€§åŠ³åŠ¨ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒä¸ºç”¨æˆ·æä¾›äº†å§‹ç»ˆå¦‚ä¸€ã€é«˜è´¨é‡çš„äº§å“ä½“éªŒã€‚æœªæ¥ï¼Œè¿™ä¸€æœºåˆ¶å¯ä»¥æ‰©å±•åˆ°æ›´å¤æ‚çš„ç»„ä»¶ã€åŠ¨ç”»æ•ˆæœä¹ƒè‡³æ•´ä¸ªé¡µé¢çš„å¸ƒå±€ä¸€è‡´æ€§æ£€æŸ¥ï¼Œå®ç°çœŸæ­£çš„è®¾è®¡ä¸å·¥ç¨‹ä¸€ä½“åŒ–ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è§£å†³è®¿é—® https ç½‘ç«™æ—¶ï¼Œåç«¯é‡å®šå‘æˆ–è·å– URL å˜æˆ http çš„é—®é¢˜]]></title>    <link>https://juejin.cn/post/7572138663120371754</link>    <guid>https://juejin.cn/post/7572138663120371754</guid>    <pubDate>2025-11-14T04:09:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572138663120371754" data-draft-id="7572048000302825513" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è§£å†³è®¿é—® https ç½‘ç«™æ—¶ï¼Œåç«¯é‡å®šå‘æˆ–è·å– URL å˜æˆ http çš„é—®é¢˜"/> <meta itemprop="keywords" content="åç«¯,Java,Nginx"/> <meta itemprop="datePublished" content="2025-11-14T04:09:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mzlogin"/> <meta itemprop="url" content="https://juejin.cn/user/1890815727118414"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è§£å†³è®¿é—® https ç½‘ç«™æ—¶ï¼Œåç«¯é‡å®šå‘æˆ–è·å– URL å˜æˆ http çš„é—®é¢˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1890815727118414/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mzlogin
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T04:09:32.000Z" title="Fri Nov 14 2025 04:09:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸€ç§å¸¸è§çš„æœåŠ¡éƒ¨ç½²æ¶æ„æ˜¯ Nginx åå‘ä»£ç†åç«¯ Java åº”ç”¨æœåŠ¡å™¨ï¼ŒNginx ç›‘å¬ 443 ç«¯å£å¤„ç† https è¯·æ±‚ï¼Œç„¶åè½¬å‘ç»™åç«¯æœåŠ¡å™¨ã€‚</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/113072053cce4c44815057a72ee7a785~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=361&amp;h=293&amp;s=7062&amp;e=png&amp;a=1&amp;b=d4e7d3" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å¯¹åº”çš„ Nginx é…ç½®å¤§è‡´å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">upstreamÂ www {
Â  Â Â serverÂ 192.168.1.101:8080Â  <span class="hljs-attr">weight</span>=<span class="hljs-number">100</span>Â max_fails=<span class="hljs-number">3</span>Â fail_timeout=<span class="hljs-number">10</span>s<span class="hljs-comment">;</span>
Â  Â Â serverÂ 192.168.1.102:8080Â  <span class="hljs-attr">weight</span>=<span class="hljs-number">100</span>Â max_fails=<span class="hljs-number">3</span>Â fail_timeout=<span class="hljs-number">10</span>s<span class="hljs-comment">;</span>
}
serverÂ {
Â  Â Â listenÂ 443Â ssl<span class="hljs-comment">;</span>
Â  Â Â server_nameÂ example.com<span class="hljs-comment">;</span>
Â  Â Â ssl_certificateÂ /path/to/cert.pem<span class="hljs-comment">;</span>
Â  Â Â ssl_certificate_keyÂ /path/to/key.pem<span class="hljs-comment">;</span>
Â  Â Â locationÂ / {
Â  Â  Â  Â Â proxy_passÂ http://www<span class="hljs-comment">;</span>
Â  Â  }
}
</code></pre>
<p>å³ï¼šå®¢æˆ·ç«¯ä¸ Nginx ä¹‹é—´æ˜¯ httpsï¼ŒNginx ä¸åç«¯ Java åº”ç”¨æœåŠ¡å™¨ä¹‹é—´æ˜¯ httpã€‚</p>
<p>è¿™æ ·å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œå¦‚ï¼š</p>
<ol>
<li>
<p><code>HttpServletRequest.getRequestURL()</code></p>
<p>è·å–åˆ°çš„ URL æ˜¯ Nginx ä¸åç«¯æœåŠ¡å™¨ä¹‹é—´çš„ http URLï¼Œæ¯”å¦‚ <code>http://192.168.1.101:8080/xxx</code>ï¼›</p>
</li>
<li>
<p><code>HttpServletResponse.sendRedirect()</code></p>
<p>ç”Ÿæˆçš„é‡å®šå‘ URL ä¹Ÿæ˜¯ http URLã€‚</p>
</li>
</ol>
<p>è¦è§£å†³è¿™äº›é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ Nginx é…ç½® + å°‘é‡åç«¯ä»£ç ä¿®æ”¹æ¥å®ç°ã€‚</p>
<h2 data-id="heading-0">è§£å†³åº”ç”¨ä¸­è·å–åˆ°çš„ URL çš„é—®é¢˜</h2>
<p>ç”¨æˆ·å®é™…è®¿é—®çš„æ˜¯ <code>https://example.com/xxx</code>ï¼Œä½†æ˜¯åç«¯åº”ç”¨è·å–åˆ°çš„ URL æ˜¯ <code>http://192.168.1.101:8080/xxx</code>ï¼Œå¦‚ä½•è®©åç«¯åº”ç”¨è·å–åˆ°æ­£ç¡®çš„ URL å‘¢ï¼Ÿ</p>
<p>ç¬¬ä¸€æ­¥ï¼ŒNginx å¯ä»¥é€šè¿‡ <code>proxy_set_header Host</code> æŒ‡ä»¤å°†å®¢æˆ·ç«¯è¯·æ±‚çš„ Host å¤´ä¼ é€’ç»™åç«¯æœåŠ¡å™¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">locationÂ / {
Â  Â Â <span class="hljs-comment"># ...</span>
Â  Â Â proxy_set_headerÂ HostÂ <span class="hljs-variable">$host</span>;
}
</code></pre>
<p>è¿™æ ·ï¼Œåç«¯åº”ç”¨é€šè¿‡ <code>HttpServletRequest.getRequestURL()</code> è·å–åˆ°çš„ URL å°±æ˜¯ <code>http://example.com/xxx</code> äº†ã€‚</p>
<p>ä½†æ­¤æ—¶ï¼Œåè®®ä»ç„¶ä¸å¯¹ï¼Œè¿˜æ˜¯ httpã€‚</p>
<p>è¦ç»™åç«¯åº”ç”¨ä¼ é€’æ­£ç¡®çš„åè®®ï¼Œé€šå¸¸çš„åšæ³•æ˜¯ä½¿ç”¨ <code>X-Forwarded-Proto</code> å¤´ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">locationÂ / {
Â  Â Â <span class="hljs-comment"># ...</span>
Â  Â Â proxy_set_headerÂ X-Forwarded-ProtoÂ <span class="hljs-variable">$scheme</span>;
}
</code></pre>
<p>æ·»åŠ è¿™ä¸ªå¤´ä¹‹åå¹¶ä¸ä¼šè®© <code>HttpServletRequest.getRequestURL()</code> ç›´æ¥è¿”å› https URLï¼Œéœ€è¦åœ¨åç«¯åº”ç”¨ä¸­åšä¸€äº›å¤„ç†ã€‚ä»¥ Java åº”ç”¨ä¸ºä¾‹ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªè¿‡æ»¤å™¨ï¼ˆFilterï¼‰æ¥ä¿®æ”¹ request çš„ schemeï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span>Â javax.servlet.*;
<span class="hljs-keyword">import</span>Â javax.servlet.http.HttpServletRequest;
<span class="hljs-keyword">import</span>Â javax.servlet.http.HttpServletRequestWrapper;
<span class="hljs-keyword">import</span>Â org.apache.commons.lang3.StringUtils;
<span class="hljs-keyword">import</span>Â org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span>Â java.io.IOException;
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">XForwardedProtoFilter</span>Â <span class="hljs-keyword">implements</span>Â <span class="hljs-title class_">Filter</span>Â {
Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span>
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">throws</span>Â IOException, ServletException {
Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (requestÂ <span class="hljs-keyword">instanceof</span>Â HttpServletRequest) {
Â  Â  Â  Â  Â  Â Â <span class="hljs-type">HttpServletRequest</span>Â <span class="hljs-variable">httpRequest</span>Â <span class="hljs-operator">=</span>Â (HttpServletRequest) request;
Â  Â  Â  Â  Â  Â Â <span class="hljs-type">String</span>Â <span class="hljs-variable">xForwardedProto</span>Â <span class="hljs-operator">=</span>Â httpRequest.getHeader(<span class="hljs-string">"X-Forwarded-Proto"</span>);
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (StringUtils.isNotBlank(xForwardedProto) &amp;&amp; !xForwardedProto.equalsIgnoreCase(httpRequest.getScheme()) &amp;&amp; xForwardedProto.equalsIgnoreCase(<span class="hljs-string">"https"</span>)) {
Â  Â  Â  Â  Â  Â  Â  Â  httpRequest =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">HttpServletRequestWrapper</span>(httpRequest) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">public</span>Â StringÂ <span class="hljs-title function_">getScheme</span><span class="hljs-params">()</span>Â {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â xForwardedProto;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">public</span>Â StringBufferÂ <span class="hljs-title function_">getRequestURL</span><span class="hljs-params">()</span>Â {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-type">StringBuffer</span>Â <span class="hljs-variable">requestURL</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-built_in">super</span>.getRequestURL();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (requestURL !=Â <span class="hljs-literal">null</span>Â &amp;&amp; requestURL.length() &gt;Â <span class="hljs-number">0</span>) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-type">int</span>Â <span class="hljs-variable">index</span>Â <span class="hljs-operator">=</span>Â requestURL.indexOf(<span class="hljs-string">"://"</span>);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (index &gt;Â <span class="hljs-number">0</span>) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  requestURL.replace(<span class="hljs-number">0</span>, index, xForwardedProto);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â requestURL;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  chain.doFilter(httpRequest, response);
Â  Â  Â  Â  }Â <span class="hljs-keyword">else</span>Â {
Â  Â  Â  Â  Â  Â  chain.doFilter(request, response);
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">init</span><span class="hljs-params">(FilterConfig filterConfig)</span>Â <span class="hljs-keyword">throws</span>Â ServletException {
Â  Â  }
Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span>Â {
Â  Â  }
}
</code></pre>
<p>è‡³æ­¤ï¼Œåç«¯åº”ç”¨é€šè¿‡ <code>HttpServletRequest.getRequestURL()</code> è·å–åˆ°çš„ URL å°±æ˜¯ <code>https://example.com/xxx</code> äº†ã€‚</p>
<h2 data-id="heading-1">è§£å†³é‡å®šå‘ URL çš„é—®é¢˜</h2>
<p>åç«¯åº”ç”¨é€šè¿‡ <code>HttpServletResponse.sendRedirect()</code> ç”Ÿæˆçš„é‡å®šå‘ URL ä¹Ÿæ˜¯ http URLï¼Œå¦‚ä½•è®©å®ƒå˜æˆ https å‘¢ï¼Ÿ</p>
<p>è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡ Nginx çš„å¦ä¸€æŒ‡ä»¤ <code>proxy_redirect</code> æ¥è§£å†³ï¼Œè¯¥æŒ‡ä»¤ç”¨äºä¿®æ”¹ä»åç«¯æœåŠ¡å™¨è¿”å›çš„ <code>Location</code> å’Œ <code>Refresh</code> å“åº”å¤´ã€‚</p>
<pre><code class="hljs language-perl" lang="perl">locationÂ / {
Â  Â Â <span class="hljs-comment"># ...</span>
Â  Â Â proxy_redirectÂ http:<span class="hljs-regexp">//</span>Â $scheme:<span class="hljs-regexp">//</span>;
}
</code></pre>
<p>è¿™æ ·ï¼Œå½“åç«¯åº”ç”¨è¿”å›ä¸€ä¸ªé‡å®šå‘å“åº”æ—¶ï¼ŒNginx ä¼šå°† <code>Location</code> å¤´ä¸­çš„ <code>http://</code> æ›¿æ¢ä¸º <code>$scheme://</code>ï¼Œå³ <code>https://</code>ã€‚</p>
<h2 data-id="heading-2">è¿›ä¸€æ­¥æ€è€ƒï¼šå½“ Nginx å‰é¢è¿˜æœ‰è´Ÿè½½å‡è¡¡å™¨æ—¶</h2>
<p>åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼ŒNginx å‰é¢å¯èƒ½è¿˜æœ‰å•†ç”¨è´Ÿè½½å‡è¡¡å™¨ï¼ˆå¦‚ AWS ELBã€é˜¿é‡Œäº‘ SLB ç­‰ï¼‰ï¼Œè¿™æ—¶éœ€è¦è€ƒè™‘è´Ÿè½½å‡è¡¡å™¨ä¸ Nginx ä¹‹é—´çš„åè®®é—®é¢˜ã€‚</p>
<p>å¦‚æœè´Ÿè½½å‡è¡¡å™¨ä¸ Nginx ä¹‹é—´æ˜¯ httpï¼Œè€Œ Nginx ä¸åç«¯åº”ç”¨ä¹‹é—´æ˜¯ httpï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨è´Ÿè½½å‡è¡¡å™¨å’Œ Nginx ä¹‹é—´æ·»åŠ  <code>X-Forwarded-Proto</code> å¤´ï¼Œä»¥ä¾¿ Nginx èƒ½å¤Ÿæ­£ç¡®åœ°è¯†åˆ«åŸå§‹è¯·æ±‚çš„åè®®ã€‚</p>
<p>ä¸»æµçš„è´Ÿè½½å‡è¡¡å™¨é…ç½®é¡¹é‡Œåº”è¯¥éƒ½æœ‰æ·»åŠ  <code>X-Forwarded-Proto</code> å¤´çš„é€‰é¡¹å¼€å…³ï¼Œæ¯”å¦‚é˜¿é‡Œäº‘ï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/378eb621996f4a7ea3f16535fc290261~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=974&amp;h=438&amp;s=89095&amp;e=png&amp;b=fefefe" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯è¿™æ ·é…ç½®åï¼ŒNginx é…ç½®ä¹Ÿéœ€è¦åšç›¸åº”çš„è°ƒæ•´ï¼Œå°† <code>$scheme</code> æ›¿æ¢ä¸º <code>$http_x_forwarded_proto</code>ï¼š<br/>
ï¼ˆæ­¤ç§åœºæ™¯ <code>$scheme</code> ä¸ºè´Ÿè½½å‡è¡¡å™¨ä¸ Nginx ä¹‹é—´çš„åè®® httpï¼Œ<code>$http_x_forwarded_proto</code> ä¸ºè´Ÿè½½å‡è¡¡å™¨é€šè¿‡ Header é€ä¼ è¿‡æ¥çš„å‰ç«¯è®¿é—®åè®® httpsã€‚ï¼‰</p>
<pre><code class="hljs language-perl" lang="perl">locationÂ / {
Â  Â Â <span class="hljs-comment"># ...</span>
Â  Â Â proxy_set_headerÂ X-Forwarded-ProtoÂ $http_x_forwarded_proto;
Â  Â Â proxy_redirectÂ http:<span class="hljs-regexp">//</span>Â $http_x_forwarded_proto:<span class="hljs-regexp">//</span>;
}
</code></pre>
<h2 data-id="heading-3">å‚è€ƒé“¾æ¥</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnginx.org%2Fen%2Fdocs%2Fhttp%2Fngx_http_proxy_module.html%23proxy_set_header" target="_blank" title="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_set_header" ref="nofollow noopener noreferrer">Nginx å®˜æ–¹æ–‡æ¡£ - proxy_set_header</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnginx.org%2Fen%2Fdocs%2Fhttp%2Fngx_http_proxy_module.html%23proxy_redirect" target="_blank" title="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_redirect" ref="nofollow noopener noreferrer">Nginx å®˜æ–¹æ–‡æ¡£ - proxy_redirect</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnginx.org%2Fen%2Fdocs%2Fhttp%2Fngx_http_core_module.html%23variables" target="_blank" title="https://nginx.org/en/docs/http/ngx_http_core_module.html#variables" ref="nofollow noopener noreferrer">Nginx å®˜æ–¹æ–‡æ¡£ - Embedded Variables</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter CI/CD å®Œæ•´æŒ‡å—ï¼šä» Bitbucket Pipelines åˆ° Play Store è‡ªåŠ¨åŒ–éƒ¨ç½²]]></title>    <link>https://juejin.cn/post/7572062035141328906</link>    <guid>https://juejin.cn/post/7572062035141328906</guid>    <pubDate>2025-11-14T00:59:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572062035141328906" data-draft-id="7569488854836789294" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter CI/CD å®Œæ•´æŒ‡å—ï¼šä» Bitbucket Pipelines åˆ° Play Store è‡ªåŠ¨åŒ–éƒ¨ç½²"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-14T00:59:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JarvanMo"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565845704"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter CI/CD å®Œæ•´æŒ‡å—ï¼šä» Bitbucket Pipelines åˆ° Play Store è‡ªåŠ¨åŒ–éƒ¨ç½²
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565845704/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JarvanMo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T00:59:10.000Z" title="Fri Nov 14 2025 00:59:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    19
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ‰‹åŠ¨æ„å»ºã€ç­¾åå’Œä¸Šä¼  <strong>Flutter</strong> åº”ç”¨çš„è¿‡ç¨‹<strong>æ—¢ç¹çåˆå®¹æ˜“å‡ºé”™</strong>ã€‚ä½ å¾—æ‰¾åˆ°æ­£ç¡®çš„ç­¾åå¯†é’¥ï¼Œè®°ä½å¯†ç ï¼Œè¿è¡Œæ„å»ºå‘½ä»¤ï¼Œç„¶åå°å¿ƒç¿¼ç¿¼åœ°å°†ç”Ÿæˆçš„ <code>.aab</code> æˆ– <code>.apk</code> æ–‡ä»¶ä¸Šä¼ åˆ° <strong>Google Play Console</strong>ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸ä»…è€—æ—¶ï¼Œè€Œä¸”ä¸¥é‡æ‹–æ…¢äº†ç‰ˆæœ¬æ›´æ–°çš„é€Ÿåº¦ã€‚</p>
<p><strong>æŒç»­é›†æˆä¸æŒç»­éƒ¨ç½²ï¼ˆCI/CDï¼‰</strong> å°±æ˜¯è§£å†³ä¹‹é“ã€‚é€šè¿‡å»ºç«‹ä¸€æ¡è‡ªåŠ¨åŒ–æµæ°´çº¿ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿æ¯ä¸€æ¬¡ä»£ç æ¨é€åˆ°ä»“åº“åï¼Œéƒ½èƒ½è‡ªåŠ¨å®Œæˆåˆ†æã€æµ‹è¯•ã€æ„å»ºï¼Œç”šè‡³éƒ¨ç½²ã€‚</p>
<p>æœ¬æŒ‡å—å°†å¸¦é¢†ä½ ä½¿ç”¨ <strong>Bitbucket Pipelines</strong> å’Œ <strong>Fastlane</strong>ï¼Œä¸ºä½ çš„ Flutter åº”ç”¨æ­å»ºä¸€æ¡å®Œæ•´çš„ CI/CD æµæ°´çº¿ã€‚æˆ‘ä»¬å°†ä»åŸºç¡€çš„æµ‹è¯•å’Œç­¾ååº”ç”¨åŒ…æ„å»ºå¼€å§‹ï¼Œé€æ­¥å®ç°å®Œå…¨è‡ªåŠ¨éƒ¨ç½²åˆ° Google Play å•†åº—çš„å†…éƒ¨æµ‹è¯•è½¨é“ã€‚</p>
<hr/>
<h2 data-id="heading-0"><strong>å‡†å¤‡å·¥ä½œ</strong></h2>
<ul>
<li>ä¸€ä¸ªå·²åœ¨ <strong>Bitbucket ä»“åº“</strong>ä¸­çš„ Flutter é¡¹ç›®ã€‚</li>
<li>ä¸€ä¸ª <strong>Android ç­¾åå¯†é’¥</strong>ï¼ˆ<code>.jks</code> æ–‡ä»¶ï¼‰åŠå…¶å‡­è¯ï¼ˆå¯†é’¥åº“å¯†ç ã€å¯†é’¥åˆ«åã€å¯†é’¥å¯†ç ï¼‰ã€‚</li>
<li>ä½ çš„ Bitbucket ä»“åº“çš„<strong>ç®¡ç†æƒé™</strong>ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-1"><strong>ç¬¬ä¸€éƒ¨åˆ†ï¼šå¥ å®šåŸºç¡€ â€” æ¯æ¬¡æ¨é€éƒ½è¿›è¡Œæ„å»ºå’Œæµ‹è¯•</strong></h2>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªèƒ½å¤Ÿåœ¨æ¯æ¬¡ä»£ç æ¨é€æ—¶ï¼ŒéªŒè¯ä»£ç å¹¶æ„å»ºå·²ç­¾åçš„ <strong>Android App Bundle</strong> çš„æµæ°´çº¿ã€‚</p>
<h3 data-id="heading-2"><strong>æ­¥éª¤ 1ï¼šå¯ç”¨ Bitbucket Pipelines</strong></h3>
<p>è¿™æ˜¯æœ€ç®€å•çš„ä¸€æ­¥ï¼š</p>
<ol>
<li>åœ¨ Bitbucket ä¸Šå¯¼èˆªåˆ°ä½ çš„<strong>ä»“åº“</strong>ã€‚</li>
<li>åœ¨å·¦ä¾§è¾¹æ ï¼Œç‚¹å‡» <strong>ä»“åº“è®¾ç½®ï¼ˆRepository settingsï¼‰</strong> ã€‚</li>
<li>åœ¨â€œPipelinesâ€éƒ¨åˆ†ä¸‹ï¼Œç‚¹å‡» <strong>è®¾ç½®ï¼ˆSettingsï¼‰</strong> ã€‚</li>
<li>åˆ‡æ¢å¼€å…³ä»¥<strong>å¯ç”¨ Pipelines</strong>ã€‚Bitbucket ä¼šæä¾›ä¸€äº›æ¨¡æ¿ï¼Œç›®å‰ä½ å¯ä»¥å…ˆå¿½ç•¥ã€‚</li>
</ol>
<h3 data-id="heading-3"><strong>æ­¥éª¤ 2ï¼šåˆ›å»º <code>bitbucket-pipelines.yml</code> æ–‡ä»¶</strong></h3>
<p>åœ¨ä½ çš„ Flutter é¡¹ç›®çš„æ ¹ç›®å½•ï¼ˆä¸ <code>pubspec.yaml</code> åŒçº§ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º <code>bitbucket-pipelines.yml</code> çš„æ–°æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶æ˜¯è‡ªåŠ¨åŒ–æµç¨‹çš„æ ¸å¿ƒï¼ŒåŒ…å«æµæ°´çº¿çš„æ‰€æœ‰æŒ‡ä»¤ã€‚</p>
<h3 data-id="heading-4"><strong>æ­¥éª¤ 3ï¼šå®šä¹‰ Docker é•œåƒå’Œç¼“å­˜</strong></h3>
<p>YAML æ–‡ä»¶çš„ç¬¬ä¸€éƒ¨åˆ†æ˜¯å®šä¹‰æ‰§è¡Œç¯å¢ƒã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªç¤¾åŒºç»´æŠ¤çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcirruslabs%2Fdocker-images-flutter%2Fpkgs%2Fcontainer%2Fflutter" target="_blank" title="https://github.com/cirruslabs/docker-images-flutter/pkgs/container/flutter" ref="nofollow noopener noreferrer">Flutter Docker é•œåƒ</a>çš„ç‰¹å®šç‰ˆæœ¬ï¼ˆè¿™é‡Œä»¥ <strong>Flutter 3.32.7</strong> ä¸ºä¾‹ï¼‰ã€‚åŒæ—¶ï¼Œ<strong>ç¼“å­˜</strong>ä¹Ÿè‡³å…³é‡è¦ï¼Œå®ƒå¯ä»¥é¿å…æ¯æ¬¡æ„å»ºæ—¶éƒ½é‡æ–°ä¸‹è½½ Flutter SDK å’Œ pub åŒ…ï¼Œä»è€ŒåŠ å¿«æ„å»ºé€Ÿåº¦ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">image:</span> <span class="hljs-string">ghcr.io/cirruslabs/flutter:3.32.7</span>

<span class="hljs-attr">definitions:</span>
  <span class="hljs-attr">caches:</span>
    <span class="hljs-comment"># Cache the Flutter SDK between builds</span>
    <span class="hljs-attr">flutter:</span> <span class="hljs-string">/flutter</span>
    <span class="hljs-comment"># Cache the pub packages</span>
    <span class="hljs-attr">pub:</span> <span class="hljs-string">$HOME/.pub-cache</span>

<span class="hljs-attr">clone:</span>
  <span class="hljs-attr">depth:</span> <span class="hljs-number">1</span> <span class="hljs-comment"># Perform a shallow clone for faster checkout</span>
</code></pre>
<hr/>
<h2 data-id="heading-5">æ­¥éª¤ 4ï¼šåˆ›å»ºç¬¬ä¸€ä¸ªæµæ°´çº¿ï¼ˆåˆ†æä¸æµ‹è¯•ï¼‰ğŸ§ª</h2>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥é…ç½®ä¸€ä¸ªç®€å•çš„æµæ°´çº¿ï¼Œè®©å®ƒåœ¨<strong>æ¨é€åˆ°ä»»æ„åˆ†æ”¯</strong>æ—¶è‡ªåŠ¨è¿è¡Œã€‚è¿™æ¡æµæ°´çº¿å°†è´Ÿè´£æ‹‰å–ä¾èµ–é¡¹ã€åˆ†æä»£ç å¹¶è¿è¡Œæµ‹è¯•ã€‚</p>
<p>è¯·å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°ä½ çš„ <code>bitbucket-pipelines.yml</code> æ–‡ä»¶ä¸­ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">pipelines:</span>
  <span class="hljs-attr">default:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">step:</span>
        <span class="hljs-attr">name:</span> <span class="hljs-string">Analyze</span> <span class="hljs-string">and</span> <span class="hljs-string">Test</span>
        <span class="hljs-attr">caches:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">pub</span>
        <span class="hljs-attr">script:</span>
          <span class="hljs-comment"># Get Flutter packages</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">flutter</span> <span class="hljs-string">pub</span> <span class="hljs-string">get</span>
          <span class="hljs-comment"># Run the linter/analyzer</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">flutter</span> <span class="hljs-string">analyze</span>
          <span class="hljs-comment"># Run all widget tests (you can comment this out if you don't have tests)</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">flutter</span> <span class="hljs-string">test</span>
</code></pre>
<h2 data-id="heading-6">æ­¥éª¤ 4ï¼šåˆ›å»ºç¬¬ä¸€ä¸ªæµæ°´çº¿ï¼ˆåˆ†æä¸æµ‹è¯•ï¼‰ğŸ§ª</h2>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥é…ç½®ä¸€æ¡<strong>ç®€å•æµæ°´çº¿</strong>ï¼Œè®©å®ƒåœ¨ä»£ç <strong>æ¨é€åˆ°ä»»æ„åˆ†æ”¯</strong>æ—¶è‡ªåŠ¨è¿è¡Œã€‚è¿™æ¡æµæ°´çº¿å°†è´Ÿè´£è·å–ä¾èµ–é¡¹ã€åˆ†æä»£ç ï¼Œå¹¶è¿è¡Œæµ‹è¯•ã€‚</p>
<p>è¯·å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°ä½ çš„ <code>bitbucket-pipelines.yml</code> æ–‡ä»¶ä¸­ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">pipelines:</span>
  <span class="hljs-attr">default:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">step:</span>
        <span class="hljs-attr">name:</span> <span class="hljs-string">Analyze</span> <span class="hljs-string">and</span> <span class="hljs-string">Test</span>
        <span class="hljs-attr">caches:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">pub</span>
        <span class="hljs-attr">script:</span>
          <span class="hljs-comment"># Get Flutter packages</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">flutter</span> <span class="hljs-string">pub</span> <span class="hljs-string">get</span>
          <span class="hljs-comment"># Run the linter/analyzer</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">flutter</span> <span class="hljs-string">analyze</span>
          <span class="hljs-comment"># Run all widget tests (you can comment this out if you don't have tests)</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">flutter</span> <span class="hljs-string">test</span>
</code></pre>
<h2 data-id="heading-7"><strong>é…ç½®è¯¦è§£</strong> âš™ï¸</h2>
<p>è®©æˆ‘ä»¬æ¥åˆ†è§£ä¸€ä¸‹è¿™æ®µé…ç½®çš„å«ä¹‰ï¼š</p>
<ul>
<li><strong><code>pipelines &gt; default</code></strong>: å®šä¹‰äº†ä¸€ä¸ªæµæ°´çº¿ï¼Œå®ƒä¼šåœ¨<strong>æ¯ä¸€æ¬¡æäº¤ï¼ˆcommitï¼‰</strong> è¢«æ¨é€æ—¶è¿è¡Œã€‚</li>
<li><strong><code>step</code></strong>: ä¸€ä¸ªæµæ°´çº¿ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤ç»„æˆï¼Œæ¯ä¸ªæ­¥éª¤éƒ½åœ¨ä¸€ä¸ª<strong>å…¨æ–°çš„ Docker å®¹å™¨</strong>ä¸­è¿è¡Œã€‚</li>
<li><strong><code>name</code></strong>: ä¸€ä¸ªæè¿°æ€§çš„åç§°ï¼Œå®ƒå°†æ˜¾ç¤ºåœ¨ Bitbucket çš„ç”¨æˆ·ç•Œé¢ï¼ˆUIï¼‰ä¸­ã€‚</li>
<li><strong><code>caches</code></strong>: æŒ‡å®šæ­¤æ­¥éª¤åº”è¯¥ä½¿ç”¨æˆ‘ä»¬åœ¨å‰é¢å®šä¹‰è¿‡çš„ <strong><code>pub</code> ç¼“å­˜</strong>ã€‚</li>
<li><strong><code>script</code></strong>: éœ€è¦æŒ‰é¡ºåºæ‰§è¡Œçš„ <strong>Shell å‘½ä»¤åˆ—è¡¨</strong>ã€‚</li>
</ul>
<p><strong>æäº¤å¹¶æ¨é€</strong>è¿™ä¸ªæ–‡ä»¶ã€‚ä½ åº”è¯¥å°±èƒ½åœ¨ä»“åº“çš„ <strong>â€œPipelinesâ€</strong> ï¼ˆæµæ°´çº¿ï¼‰éƒ¨åˆ†çœ‹åˆ°ä½ çš„<strong>ç¬¬ä¸€ä¸ªæµæ°´çº¿å¼€å§‹è¿è¡Œ</strong>äº†ã€‚</p>
<hr/>
<h2 data-id="heading-8"><strong>æ­¥éª¤ 5ï¼šå¤„ç† Android æ„å»ºæ‰€éœ€çš„å¯†é’¥ä¿¡æ¯</strong> ğŸ”‘</h2>
<p>ä½ <strong>ç»ä¸åº”è¯¥</strong>å°†ä½ çš„ç­¾åå¯†é’¥æˆ–å¯†ç ç›´æ¥æäº¤åˆ°ä»“åº“ä¸­ã€‚Bitbucket æä¾›äº†ä¸€ç§å®‰å…¨çš„æ–¹å¼æ¥å¤„ç†è¿™äº›æ•æ„Ÿä¿¡æ¯ï¼Œé‚£å°±æ˜¯**â€œä»“åº“å˜é‡â€ï¼ˆRepository variablesï¼‰**ã€‚</p>
<h3 data-id="heading-9"><strong>5a. ç¼–ç ä½ çš„ Keystore æ–‡ä»¶å’Œå‡­è¯</strong></h3>
<p>ä½ çš„ <code>.jks</code> æ–‡ä»¶æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚ä¸ºäº†å°†å…¶ä½œä¸ºå˜é‡å­˜å‚¨ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ <strong>Base64</strong> å°†å…¶ç¼–ç æˆæ–‡æœ¬æ ¼å¼ã€‚æ‰“å¼€ç»ˆç«¯å¹¶è¿è¡Œç›¸åº”çš„å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># On macOS/Linux  </span>
<span class="hljs-string">base64</span> <span class="hljs-string">-i</span> <span class="hljs-string">my-upload-key.jks</span> <span class="hljs-string">-o</span> <span class="hljs-string">key.txt</span>  
  
<span class="hljs-comment"># On Windows (using PowerShell)  </span>
[<span class="hljs-string">Convert</span>]<span class="hljs-string">::ToBase64String([IO.File]::ReadAllBytes("my-upload-key.jks"))</span> <span class="hljs-string">|</span> <span class="hljs-string">Out-File</span> <span class="hljs-string">-FilePath</span> <span class="hljs-string">"key.txt"</span>
</code></pre>
<p>è¿è¡Œä¸Šè¿°å‘½ä»¤ä¼šç”Ÿæˆä¸€ä¸ªåä¸º <strong><code>key.txt</code></strong> çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª<strong>å¾ˆé•¿çš„å­—ç¬¦ä¸²</strong>ã€‚è¯·å¤åˆ¶æ•´ä¸ªå­—ç¬¦ä¸²ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬ç”¨<strong>åŒæ ·çš„æ–¹æ³•</strong>æ¥å¤„ç† <code>key.properties</code> æ–‡ä»¶ï¼Œä»¥ä¾¿<strong>ç¼–ç è®¿é—® <code>.jks</code> æ–‡ä»¶æ‰€éœ€çš„å‡­è¯</strong>ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># On macOS/Linux  </span>
<span class="hljs-string">base64</span> <span class="hljs-string">-i</span> <span class="hljs-string">key.properties</span> <span class="hljs-string">-o</span> <span class="hljs-string">properties.txt</span>  
  
<span class="hljs-comment"># On Windows (using PowerShell)  </span>
[<span class="hljs-string">Convert</span>]<span class="hljs-string">::ToBase64String([IO.File]::ReadAllBytes("key.properties"))</span> <span class="hljs-string">|</span> <span class="hljs-string">Out-File</span> <span class="hljs-string">-FilePath</span> <span class="hljs-string">"properties.txt"</span>
</code></pre>
<h2 data-id="heading-10">5b. å°†å˜é‡æ·»åŠ åˆ° Bitbucket ğŸ”</h2>
<p>å‰å¾€ <strong>ä»“åº“è®¾ç½®ï¼ˆRepository settingsï¼‰</strong> -&gt; <strong>æµæ°´çº¿ï¼ˆPipelinesï¼‰</strong> -&gt; <strong>ä»“åº“å˜é‡ï¼ˆRepository variablesï¼‰</strong> ã€‚</p>
<p>æ·»åŠ ä»¥ä¸‹å˜é‡ã€‚<strong>è‡³å…³é‡è¦</strong>çš„ä¸€ç‚¹æ˜¯ï¼Œè¯·ä¸º<strong>æ¯ä¸ªå˜é‡éƒ½å‹¾é€‰â€œå·²ä¿æŠ¤â€ï¼ˆSecuredï¼‰æ¡†</strong>ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript">| <span class="hljs-title class_">Variable</span> <span class="hljs-title class_">Name</span>             | <span class="hljs-title class_">Value</span>                                              |
| ------------------------- | -------------------------------------------------- |
| <span class="hljs-string">`ANDROID_KEYSTORE_BASE64`</span> | <span class="hljs-title class_">Paste</span> the entire base64 <span class="hljs-built_in">string</span> <span class="hljs-keyword">from</span> <span class="hljs-string">`key.txt`</span>.     |
| <span class="hljs-string">`ANDROID_KEYPROPERTIES_BASE64`</span> | <span class="hljs-title class_">Paste</span> the entire base64 <span class="hljs-built_in">string</span> <span class="hljs-keyword">from</span> <span class="hljs-string">`properties.txt`</span>.                   |
</code></pre>
<hr/>
<h2 data-id="heading-11">æ­¥éª¤ 6ï¼šæ„å»ºå·²ç­¾åçš„ Android åº”ç”¨åŒ…ï¼ˆAABï¼‰âœ…</h2>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„æµæ°´çº¿ï¼Œè®©å®ƒåœ¨æ¯æ¬¡æ¨é€åˆ° <strong><code>development</code> åˆ†æ”¯</strong>æ—¶ï¼Œè‡ªåŠ¨æ„å»ºä¸€ä¸ª<strong>å·²ç­¾åçš„ <code>.aab</code> æ–‡ä»¶</strong>ã€‚</p>
<p>è¯·å°†ä»¥ä¸‹ä»£ç å—æ·»åŠ åˆ°ä½ çš„ <code>.yml</code> æ–‡ä»¶çš„ <strong><code>pipelines</code></strong> é”®ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ... (image, definitions, and default pipeline from above) ...</span>
pipelines:
  <span class="hljs-comment"># ... (default pipeline here) ...</span>
  branches:
    development:
      - step:
          name: Analyze and Build App Bundle
          size: 2x <span class="hljs-comment"># Use a larger build container for performance</span>
          caches:
            - pub
          script:
            - <span class="hljs-built_in">rm</span> -f pubspec.lock
            - flutter pub get
            - flutter analyze
            - flutter <span class="hljs-built_in">test</span>

            <span class="hljs-comment"># Decode and write the keystore file from the repository variable</span>
            - <span class="hljs-built_in">echo</span> <span class="hljs-variable">$ANDROID_KEYSTORE_BASE64</span> | <span class="hljs-built_in">base64</span> -d &gt; android/app/keystore.jks

            <span class="hljs-comment"># Create the key.properties file with the keystore credentials</span>
            - <span class="hljs-built_in">echo</span> <span class="hljs-variable">$ANDROID_KEYPROPERTIES_BASE64</span> | <span class="hljs-built_in">base64</span> -d &gt; android/key.properties

            <span class="hljs-comment"># Build the app bundle</span>
            - flutter build appbundle --obfuscate --split-debug-info=./debug_info -t lib/main_dev.dart --release
          artifacts:
            <span class="hljs-comment"># Save the built app bundle so it can be downloaded</span>
            - build/app/outputs/bundle/release/app-release.aab
</code></pre>
<h2 data-id="heading-12"><strong>å…³é”®æ–°å¢å†…å®¹è§£æ</strong> ğŸ’¡</h2>
<ul>
<li><strong><code>branches &gt; development</code></strong>: è¿™æ¡æµæ°´çº¿<strong>åªä¼š</strong>åœ¨ä»£ç æ¨é€åˆ° <strong><code>development</code> åˆ†æ”¯</strong>æ—¶è¿è¡Œã€‚</li>
<li><strong><code>size: 2x</code></strong>: æ„å»º Flutter åº”ç”¨æ˜¯èµ„æºå¯†é›†å‹çš„ã€‚è®¾ç½® <strong><code>2x</code></strong> ä¼šåˆ†é…<strong>åŒå€å†…å­˜</strong>ï¼Œè¿™èƒ½é˜²æ­¢æ„å»ºé”™è¯¯å¹¶åŠ å¿«é€Ÿåº¦ã€‚</li>
<li><strong><code>echo â€¦ | base64 -d â€¦</code></strong>: è¿™æ˜¯<strong>è‡³å…³é‡è¦çš„å‘½ä»¤</strong>ï¼Œå®ƒåè½¬äº†æˆ‘ä»¬ä¹‹å‰çš„æ­¥éª¤ã€‚å®ƒå–å‡ºå®‰å…¨çš„å˜é‡ï¼Œå°†å…¶ä» Base64 <strong>è§£ç </strong>ï¼Œå¹¶é‡æ–°å†™å…¥ä¸€ä¸ª<strong>äºŒè¿›åˆ¶çš„ <code>.jks</code> æˆ– <code>.properties</code> æ–‡ä»¶</strong>ã€‚</li>
<li><strong><code>flutter build appbundle â€¦</code></strong>: æˆ‘ä»¬ä½¿ç”¨æ ‡å‡†çš„æ„å»ºå‘½ä»¤ï¼Œå¸¦æœ‰<strong>æ··æ·†</strong>ï¼ˆobfuscationï¼‰å’Œä¸€ä¸ªç‰¹å®šçš„å…¥å£ç‚¹ï¼ˆ<code>-t lib/main_dev.dart</code>ï¼‰ã€‚</li>
<li><strong><code>artifacts</code></strong>: è¿™å‘Šè¯‰ Bitbucket <strong>ä¿å­˜</strong>æŒ‡å®šçš„æ–‡ä»¶ï¼ˆ<code>app-release.aab</code>ï¼‰ï¼Œä½ å¯ä»¥åœ¨æµæ°´çº¿ç»“æœé¡µé¢ä¸‹è½½å®ƒã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-13"><strong>ç¬¬äºŒéƒ¨åˆ†ï¼šæœ€åå†²åˆº â€” ä½¿ç”¨ Fastlane è‡ªåŠ¨åŒ–éƒ¨ç½²åˆ° Play Store</strong> ğŸš€</h2>
<p>æ„å»ºåº”ç”¨å›ºç„¶å¾ˆå¥½ï¼Œä½†çœŸæ­£çš„é­”åŠ›åœ¨äº<strong>è‡ªåŠ¨åŒ–éƒ¨ç½²</strong>ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†é›†æˆ <strong>Fastlane</strong>â€”â€”ä¸€ä¸ªä¸“ä¸ºè‡ªåŠ¨åŒ–åº”ç”¨å‘å¸ƒè€Œè®¾è®¡çš„å¼€æºå¹³å°ã€‚</p>
<h3 data-id="heading-14"><strong>æ–°å·¥ä½œæµç¨‹æ¦‚è§ˆ</strong></h3>
<ol>
<li><strong>æœ¬åœ°è®¾ç½®</strong>: æˆ‘ä»¬å°†å…ˆåœ¨æœ¬åœ°è®¾ç½® Fastlaneï¼Œç¡®ä¿å®ƒå¯ä»¥æ­£ç¡®åœ°ä¸ Google Play å•†åº—é€šä¿¡ã€‚</li>
<li><strong>Google å‡­è¯</strong>: æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª <strong>Google Cloud æœåŠ¡è´¦å·</strong>ï¼ŒFastlane å°†ä½¿ç”¨å®ƒè¿›è¡Œèº«ä»½éªŒè¯ã€‚</li>
<li><strong>å®‰å…¨å˜é‡</strong>: æˆ‘ä»¬å°†å¯¹ç§˜å¯†çš„æœåŠ¡è´¦å· <strong>JSON å¯†é’¥è¿›è¡Œç¼–ç </strong>ï¼Œå¹¶å°†å…¶å®‰å…¨åœ°å­˜å‚¨åœ¨ Bitbucket ä¸­ã€‚</li>
<li><strong>æµæ°´çº¿æ›´æ–°</strong>: æˆ‘ä»¬å°†ä¿®æ”¹ <code>.yml</code> æ–‡ä»¶ï¼Œä½¿å…¶<strong>å®‰è£…å¹¶è¿è¡Œ Fastlane</strong>ï¼Œç”± Fastlane å¤„ç†æ„å»ºå’Œéƒ¨ç½²å·¥ä½œã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-15"><strong>æ­¥éª¤ 1ï¼šè·å– Google Play API å‡­è¯</strong> ğŸ”‘</h2>
<p>Fastlane éœ€è¦ä¸€ä¸ªæœåŠ¡è´¦å·æ‰èƒ½ä»£è¡¨ä½ æ‰§è¡Œæ“ä½œã€‚</p>
<h3 data-id="heading-16"><strong>åˆ›å»ºæœåŠ¡è´¦å·</strong></h3>
<ol>
<li>åœ¨ <strong>Google Cloud Console</strong> ä¸­ï¼Œå¯¼èˆªåˆ° <strong>IAM ä¸ç®¡ç†ï¼ˆIAM &amp; Adminï¼‰ -&gt; æœåŠ¡è´¦å·ï¼ˆService Accountsï¼‰</strong> ã€‚</li>
<li>ç‚¹å‡» <strong>+ åˆ›å»ºæœåŠ¡è´¦å·ï¼ˆ+ CREATE SERVICE ACCOUNTï¼‰</strong> ï¼Œç»™å®ƒå‘½åï¼ˆä¾‹å¦‚ï¼š<code>bitbucket-ci-cd-deploys</code>ï¼‰ï¼Œç„¶åç‚¹å‡» <strong>åˆ›å»ºå¹¶ç»§ç»­ï¼ˆCREATE AND CONTINUEï¼‰</strong> ã€‚</li>
<li>åœ¨â€œæˆäºˆæ­¤æœåŠ¡è´¦å·å¯¹é¡¹ç›®çš„è®¿é—®æƒé™â€ä¸‹ï¼Œæ·»åŠ è§’è‰² <strong>â€œæœåŠ¡è´¦å·ç”¨æˆ·â€ï¼ˆService Account Userï¼‰</strong> ã€‚ç‚¹å‡» <strong>ç»§ç»­ï¼ˆCONTINUEï¼‰</strong> ï¼Œç„¶å <strong>å®Œæˆï¼ˆDONEï¼‰</strong> ã€‚</li>
</ol>
<h3 data-id="heading-17"><strong>åˆ›å»ºå¹¶ä¸‹è½½ JSON å¯†é’¥</strong></h3>
<ol>
<li>æ‰¾åˆ°ä½ åˆšåˆ›å»ºçš„æœåŠ¡è´¦å·ã€‚ç‚¹å‡»æ—è¾¹çš„<strong>ä¸‰ä¸ªç‚¹èœå•</strong>ï¼Œé€‰æ‹© <strong>ç®¡ç†å¯†é’¥ï¼ˆManage keysï¼‰</strong> ã€‚</li>
<li>ç‚¹å‡» <strong>æ·»åŠ å¯†é’¥ï¼ˆADD KEYï¼‰</strong> -&gt; <strong>åˆ›å»ºæ–°å¯†é’¥ï¼ˆCreate new keyï¼‰</strong> ã€‚é€‰æ‹© <strong>JSON</strong> å¹¶ç‚¹å‡» <strong>åˆ›å»ºï¼ˆCREATEï¼‰</strong> ã€‚</li>
<li>ä¸€ä¸ª JSON æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼š<code>your-service-account-key.json</code>ï¼‰å°†è¢«ä¸‹è½½ã€‚<strong>è¿™ä¸ªæ–‡ä»¶å°±æ˜¯ä½ çš„å¯†ç ï¼ŒåŠ¡å¿…ä¿æŒå®‰å…¨ï¼Œä¸è¦æäº¤åˆ°ä»“åº“ä¸­ã€‚</strong></li>
</ol>
<h3 data-id="heading-18"><strong>åœ¨ Play Console ä¸­æˆäºˆæƒé™</strong></h3>
<ol>
<li>å‰å¾€ <strong>Google Play Console</strong> çš„ <strong>ç”¨æˆ·ä¸æƒé™ï¼ˆUsers &amp; Permissionsï¼‰</strong> é¡µé¢ï¼Œç‚¹å‡» <strong>é‚€è¯·æ–°ç”¨æˆ·ï¼ˆInvite new usersï¼‰</strong> ã€‚</li>
<li>ç²˜è´´æœåŠ¡è´¦å·çš„<strong>ç”µå­é‚®ä»¶åœ°å€</strong>ï¼Œå¹¶æˆäºˆæ‰€éœ€çš„æƒé™ï¼ˆä¾‹å¦‚ï¼š<strong>ç®¡ç†å‘˜ï¼ˆAdminï¼‰</strong> æˆ–ç‰¹å®šçš„ <strong>å‘å¸ƒç»ç†ï¼ˆRelease Managerï¼‰</strong> è§’è‰²ï¼‰ã€‚ç‚¹å‡» <strong>é‚€è¯·ç”¨æˆ·ï¼ˆInvite userï¼‰</strong> ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-19"><strong>æ­¥éª¤ 2ï¼šåœ¨æœ¬åœ°å®‰è£…å’Œé…ç½® Fastlane</strong> ğŸ› ï¸</h2>
<p>æˆ‘ä»¬å°†åœ¨ä½ çš„ Flutter é¡¹ç›®çš„ <strong><code>android</code> ç›®å½•</strong>ä¸­è®¾ç½® Fastlaneã€‚</p>
<h3 data-id="heading-20"><strong>å®‰è£… Fastlane</strong></h3>
<p>è¯·éµå¾ª <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.fastlane.tools%2F" target="_blank" title="https://docs.fastlane.tools/" ref="nofollow noopener noreferrer">Fastlane å®˜æ–¹è®¾ç½®æŒ‡å—</a>ã€‚å¼ºçƒˆå»ºè®®ä½¿ç”¨ <strong>Bundler</strong>ã€‚</p>
<h3 data-id="heading-21"><strong>åˆå§‹åŒ– Fastlane</strong></h3>
<ol>
<li>åœ¨ç»ˆç«¯ä¸­è¿›å…¥ä½ çš„é¡¹ç›® <strong><code>android</code> ç›®å½•</strong>ï¼š<code>cd android</code>ã€‚</li>
<li>è¿è¡Œ <strong><code>fastlane init</code></strong>ã€‚</li>
<li>å®ƒä¼šè¦æ±‚è¾“å…¥ä½ çš„åº”ç”¨çš„<strong>åŒ…å</strong>å’Œ<strong>ç§˜å¯† JSON æ–‡ä»¶</strong>çš„è·¯å¾„ï¼ˆä¾‹å¦‚ï¼š<code>./your-service-account-key.json</code>ï¼‰ã€‚</li>
</ol>
<h3 data-id="heading-22"><strong>é…ç½® <code>fastlane/Appfile</code></strong></h3>
<p>ç¡®ä¿å…¶ä¸­çš„è·¯å¾„è®¾ç½®æ˜¯æ­£ç¡®çš„ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># fastlane/Appfile  </span>
json_key_file(<span class="hljs-string">"./your-service-account-key.json"</span>) <span class="hljs-comment"># Path to your JSON key  </span>
package_name(<span class="hljs-string">"com.your.app.package"</span>)
</code></pre>
<h2 data-id="heading-23">4. å®‰è£… <code>flutter_version</code> æ’ä»¶ ğŸ› ï¸</h2>
<p>ä¸ºäº†èƒ½<strong>è‡ªåŠ¨</strong>ä» <code>pubspec.yaml</code> æ–‡ä»¶ä¸­è·å–åº”ç”¨çš„<strong>ç‰ˆæœ¬åç§°ï¼ˆversion nameï¼‰</strong> å’Œ<strong>ç‰ˆæœ¬ä»£ç ï¼ˆversion codeï¼‰</strong> ï¼Œè¯·åœ¨ <code>android</code> ç›®å½•ä¸‹è¿è¡Œæ­¤å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">  bundle <span class="hljs-built_in">exec</span> fastlane add_plugin flutter_version
</code></pre>
<h2 data-id="heading-24">5. é…ç½® <code>fastlane/Fastfile</code> ğŸ› ï¸</h2>
<p>è¿™é‡Œå°±æ˜¯ä½ å®šä¹‰ <strong>â€œå¿«è½¦é“â€ï¼ˆlanesï¼‰</strong> çš„åœ°æ–¹ã€‚è¯·ç”¨ä»¥ä¸‹å†…å®¹æ›¿æ¢æ‰æ–‡ä»¶ä¸­çš„åŸæœ‰å†…å®¹ï¼š</p>
<pre><code class="hljs language-ruby" lang="ruby">
<span class="hljs-comment"># fastlane/Fastfile</span>
default_platform(<span class="hljs-symbol">:android</span>)

platform <span class="hljs-symbol">:android</span> <span class="hljs-keyword">do</span>
  desc <span class="hljs-string">"Builds and deploys to the Google Play internal testing track"</span>
  lane <span class="hljs-symbol">:deploy_internal</span> <span class="hljs-keyword">do</span>
    <span class="hljs-comment"># Go up to the root to run Flutter commands</span>
    <span class="hljs-title class_">Dir</span>.chdir(<span class="hljs-string">".."</span>) <span class="hljs-keyword">do</span>
      sh(<span class="hljs-string">"flutter"</span>, <span class="hljs-string">"build"</span>, <span class="hljs-string">"appbundle"</span>, <span class="hljs-string">"--obfuscate"</span>, <span class="hljs-string">"--split-debug-info=./debug_info"</span>, <span class="hljs-string">"-t"</span>, <span class="hljs-string">"lib/main_dev.dart"</span>, <span class="hljs-string">"--release"</span>)
    <span class="hljs-keyword">end</span>
    
    version_info = flutter_version()
    version_name = version_info[<span class="hljs-string">"version_name"</span>] <span class="hljs-comment"># e.g., "1.2.3"</span>
    build_number = version_info[<span class="hljs-string">"version_code"</span>] <span class="hljs-comment"># e.g., "45"</span>

    <span class="hljs-comment"># Upload to the Play Store</span>
    upload_to_play_store(
      <span class="hljs-symbol">track:</span> <span class="hljs-string">'internal'</span>, <span class="hljs-comment"># Deploy to the internal testing track</span>
      <span class="hljs-symbol">aab:</span> <span class="hljs-string">'../build/app/outputs/bundle/release/app-release.aab'</span>,
      <span class="hljs-symbol">version_name:</span> <span class="hljs-string">"<span class="hljs-subst">#{version_name}</span>(<span class="hljs-subst">#{build_number}</span>)"</span>
    )
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h2 data-id="heading-25">6. åœ¨æœ¬åœ°è¿›è¡Œæµ‹è¯•ï¼ˆå¼ºçƒˆæ¨èï¼‰âœ…</h2>
<p>åœ¨ä½ çš„ç»ˆç«¯ï¼ˆä»éœ€ä½äº <strong><code>android</code> ç›®å½•</strong>ä¸­ï¼‰è¿è¡Œå‘½ä»¤ï¼š<code>fastlane deploy_internal</code>ã€‚å¦‚æœè¿™æ¡å‘½ä»¤æˆåŠŸè¿è¡Œï¼Œé‚£ä¹ˆä½ å°±å‡†å¤‡å¥½è¿›è¡Œè‡ªåŠ¨åŒ–éƒ¨ç½²äº†ã€‚</p>
<h2 data-id="heading-26">æ›´æ–° <code>.gitignore</code> æ–‡ä»¶ ğŸ”’</h2>
<p><strong>ç¡®ä¿</strong>ä½ çš„<strong>æ ¹ç›®å½•ä¸‹çš„ <code>.gitignore</code> æ–‡ä»¶</strong>åŒ…å«äº†é‚£ä¸ªç§˜å¯†çš„ JSON å¯†é’¥æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/android/your-service-account-key.json  
/android/gemfile.lock
</code></pre>
<h2 data-id="heading-27">æ­¥éª¤ 4ï¼šæ›´æ–° Bitbucket Pipelines ä»¥è¿›è¡Œéƒ¨ç½² ğŸš€</h2>
<p>æœ€åä¸€æ­¥ï¼Œè®©æˆ‘ä»¬æŠŠ <strong>Fastlane</strong> é›†æˆåˆ° <code>bitbucket-pipelines.yml</code> æ–‡ä»¶ä¸­ã€‚</p>
<h3 data-id="heading-28"><strong>å°† JSON å¯†é’¥æ·»åŠ ä¸ºå®‰å…¨å˜é‡</strong> ğŸ”’</h3>
<p>åƒå¤„ç† Keystore æ–‡ä»¶ä¸€æ ·ï¼Œä½ éœ€è¦å¯¹ <strong>JSON å¯†é’¥æ–‡ä»¶</strong>è¿›è¡Œç¼–ç ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"> base64 -i your-service-account-<span class="hljs-keyword">key</span>.json -o play-<span class="hljs-keyword">key</span>.txt
</code></pre>
<p>å°†å­—ç¬¦ä¸²ä» <strong><code>play-key.txt</code></strong> æ–‡ä»¶ä¸­å¤åˆ¶å‡ºæ¥ã€‚</p>
<p>å‰å¾€ <strong>ä»“åº“è®¾ç½®ï¼ˆRepository settingsï¼‰</strong> -&gt; <strong>ä»“åº“å˜é‡ï¼ˆRepository variablesï¼‰</strong> ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„<strong>å—ä¿æŠ¤å˜é‡</strong>ï¼Œå‘½åä¸º <strong><code>GPLAY_SERVICE_ACCOUNT_KEY_BASE64</code></strong>ï¼Œå¹¶å°†å¤åˆ¶çš„å­—ç¬¦ä¸²ç²˜è´´ä¸ºå®ƒçš„å€¼ã€‚</p>
<h2 data-id="heading-29"><strong>ä¿®æ”¹ <code>bitbucket-pipelines.yml</code> æ–‡ä»¶</strong> âš™ï¸</h2>
<p>ç”¨è¿™ä¸ª<strong>æ–°ç‰ˆæœ¬</strong>çš„æµæ°´çº¿æ›¿æ¢æ‰ä½ åŸæœ‰çš„ <code>development</code> åˆ†æ”¯æµæ°´çº¿ã€‚å®ƒä¼š<strong>ç®€åŒ–å¾ˆå¤š</strong>ï¼Œå› ä¸º <strong>Fastlane</strong> æ›¿æˆ‘ä»¬å¤„ç†äº†å¤§éƒ¨åˆ†é€»è¾‘ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">branches:</span>
  <span class="hljs-attr">development:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">step:</span>
        <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">and</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">to</span> <span class="hljs-string">Internal</span> <span class="hljs-string">Testing</span>
        <span class="hljs-attr">size:</span> <span class="hljs-string">2x</span>
        <span class="hljs-attr">caches:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">pub</span>
        <span class="hljs-attr">script:</span>
          <span class="hljs-comment"># Basic setup and analysis</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">rm</span> <span class="hljs-string">-f</span> <span class="hljs-string">pubspec.lock</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">flutter</span> <span class="hljs-string">pub</span> <span class="hljs-string">get</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">flutter</span> <span class="hljs-string">analyze</span>
          
          <span class="hljs-comment"># Restore Android Keystore for the build</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">echo</span> <span class="hljs-string">$ANDROID_KEYSTORE_BASE64</span> <span class="hljs-string">|</span> <span class="hljs-string">base64</span> <span class="hljs-string">-d</span> <span class="hljs-string">&gt;</span> <span class="hljs-string">android/app/keystore.jks</span>
          
          <span class="hljs-comment"># Create the key.properties file with the keystore credentials</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">echo</span> <span class="hljs-string">$ANDROID_KEYPROPERTIES_BASE64</span> <span class="hljs-string">|</span> <span class="hljs-string">base64</span> <span class="hljs-string">-d</span> <span class="hljs-string">&gt;</span> <span class="hljs-string">android/key.properties</span>

          <span class="hljs-comment"># Restore Google Play API key for Fastlane</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">echo</span> <span class="hljs-string">$GPLAY_SERVICE_ACCOUNT_KEY_BASE64</span> <span class="hljs-string">|</span> <span class="hljs-string">base64</span> <span class="hljs-string">-d</span> <span class="hljs-string">&gt;</span> <span class="hljs-string">android/your-service-account-key.json</span>

          <span class="hljs-comment"># --- Deployment via Fastlane ---</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">cd</span> <span class="hljs-string">android</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">bundle</span> <span class="hljs-string">install</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">bundle</span> <span class="hljs-string">exec</span> <span class="hljs-string">fastlane</span> <span class="hljs-string">deploy_internal</span>
        <span class="hljs-attr">artifacts:</span>
          <span class="hljs-comment"># Save the built artifact just in case</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">build/app/outputs/bundle/release/app-release.aab</span>
</code></pre>
<hr/>
<h2 data-id="heading-30">ç»“è®º ğŸ‰</h2>
<p><strong>æ­å–œï¼</strong> ä½ ç°åœ¨æ‹¥æœ‰äº†ä¸€æ¡å¼ºå¤§ä¸”<strong>å®Œå…¨è‡ªåŠ¨åŒ–</strong>çš„ CI/CD æµæ°´çº¿ã€‚</p>
<p>ä»Šåï¼Œæ¯ä¸€æ¬¡æ¨é€åˆ°ä½ çš„ <strong><code>development</code> åˆ†æ”¯</strong>çš„ä»£ç ï¼Œéƒ½å°†<strong>æ— éœ€ä»»ä½•æ‰‹åŠ¨å¹²é¢„</strong>ï¼Œè‡ªåŠ¨å®Œæˆåˆ†æã€æ„å»ºã€ç­¾åï¼Œå¹¶éƒ¨ç½²åˆ° <strong>Google Play å•†åº—çš„å†…éƒ¨æµ‹è¯•äººå‘˜</strong>æ‰‹ä¸­ã€‚</p>
<p>è¿™å¥—è®¾ç½®ä¸ä»…ä¸ºä½ èŠ‚çœäº†æ— æ•°æ—¶é—´ï¼Œè¿˜ç¡®ä¿äº†å‘å¸ƒæµç¨‹çš„<strong>ä¸€è‡´æ€§ã€å¯é æ€§å’Œå®‰å…¨æ€§</strong>ï¼Œè®©ä½ èƒ½å¤Ÿä¸“æ³¨äºä½ æœ€æ“…é•¿çš„äº‹æƒ…ï¼š<strong>æ„å»ºå‡ºè‰²çš„åº”ç”¨ï¼</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Rustæ€§èƒ½è°ƒä¼˜ï¼šä»åŠé€€åˆ°çœŸé¦™]]></title>    <link>https://juejin.cn/post/7572387666979602458</link>    <guid>https://juejin.cn/post/7572387666979602458</guid>    <pubDate>2025-11-14T09:30:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572387666979602458" data-draft-id="7572387068313632795" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Rustæ€§èƒ½è°ƒä¼˜ï¼šä»åŠé€€åˆ°çœŸé¦™"/> <meta itemprop="keywords" content="åç«¯,Rust"/> <meta itemprop="datePublished" content="2025-11-14T09:30:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¯¥ç”¨æˆ·å·²ä¸å­˜åœ¨"/> <meta itemprop="url" content="https://juejin.cn/user/64217584778579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Rustæ€§èƒ½è°ƒä¼˜ï¼šä»åŠé€€åˆ°çœŸé¦™
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/64217584778579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¯¥ç”¨æˆ·å·²ä¸å­˜åœ¨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T09:30:28.000Z" title="Fri Nov 14 2025 09:30:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ°çƒäººéƒ½è¯´Rustå¿«ï¼Œå®‰å…¨ï¼Œå¹¶å‘ç‰›ã€‚ä½†æœ‰æ—¶å€™æˆ‘ä»¬å†™å‡ºæ¥çš„ä»£ç ï¼Œè·‘èµ·æ¥å´åƒè¸©äº†è„šåˆ¹è½¦ã€‚è¿™æ˜¯ä¸ºå•¥ï¼Ÿå…¶å®ï¼ŒRustç»™ä½ çš„æ³•æ‹‰åˆ©ï¼Œä½ å¯èƒ½åªå½“æˆäº†ä¹°èœè½¦åœ¨å¼€ã€‚æ€§èƒ½è¿™ç©æ„å„¿ï¼Œä¸æ˜¯ç„å­¦ï¼Œè€Œæ˜¯ç§‘å­¦ï¼ˆå’Œä¸€ç‚¹ç‚¹å°æŠ€å·§ï¼‰ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e6c1e35b051470187dd4403d22d2f41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763717428&amp;x-signature=%2F0ay3p4Tx4ORdciqe%2F4kt3M7QaY%3D" alt="" loading="lazy"/></p>
<p>BUTï¼Œåœ¨å¼€å§‹ä¹‹å‰ï¼Œè°ä¹Ÿä¸æƒ³åœ¨é…ç½®ç¯å¢ƒè¿™ç§ç ´äº‹ä¸Šæµªè´¹ç”Ÿå‘½ï¼Œå¯¹å§ï¼Ÿè£…Rustã€è£…PostgreSQLã€è£…Redisâ€¦â€¦ä¸€å¥—ä¸‹æ¥ï¼ŒåŠå¤©æ²¡äº†ã€‚è¿™é‡Œå°±è¦ç”¨ ServBayï¼Œè¿™æ˜¯å¼€å‘è€…çš„ç¦éŸ³ï¼Œä¸€é”®å°±èƒ½æŠŠ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com%2Ffeatures%2Frust" target="_blank" title="https://www.servbay.com/features/rust" ref="nofollow noopener noreferrer">Rustå¼€å‘ç¯å¢ƒ</a>ç»™æå®šäº†ï¼Œè¿å¸¦å„ç§æ•°æ®åº“éƒ½å®‰æ’å¾—æ˜æ˜ç™½ç™½ã€‚å“¥å“¥ä½ æ”¾å¿ƒé£ï¼ŒServBayæ°¸ç›¸éšã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f347da97bce49ceab5534d1873f695c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763717428&amp;x-signature=wecwow2FYQ4iV2p4%2F18%2B3z%2BZ3AM%3D" alt="" loading="lazy"/></p>
<p>å¥½äº†ï¼Œç¯å¢ƒæå®šï¼Œç³»å¥½å®‰å…¨å¸¦ï¼Œæˆ‘ä»¬å‘è½¦ï¼</p>
<h4 data-id="heading-0"><strong>æŠ€å·§ä¸€ï¼šå‡½æ•°å‚æ•°åˆ«è€ç”¨</strong><code>String</code>ï¼Œ<code>&amp;str</code><strong>æ‰æ˜¯ä¸‡é‡‘æ²¹</strong></h4>
<p>è¿™å¯èƒ½æ˜¯æ–°æ‰‹æœ€å®¹æ˜“çŠ¯çš„é”™è¯¯ã€‚çœ‹åˆ°å­—ç¬¦ä¸²ï¼Œä¸‹æ„è¯†å°±ç”¨<code>String</code>ã€‚</p>
<p><strong>åˆ«è¿™ä¹ˆå¹²ï¼š</strong></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// æ¯æ¬¡è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œéƒ½å¯èƒ½å‘ç”Ÿä¸€æ¬¡å†…å­˜æ‹·è´ï¼ŒæŠŠæ‰€æœ‰æƒäº¤å‡ºå»</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">welcome_user</span>(name: <span class="hljs-type">String</span>) {
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Hello, {}! æ¬¢è¿æ¥åˆ°Rustçš„ä¸–ç•Œï¼"</span>, name);
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">user_name</span> = <span class="hljs-string">"CodeWizard"</span>.<span class="hljs-title function_ invoke__">to_string</span>();
    <span class="hljs-comment">// ä¸ºäº†ä¸å¤±å» user_name çš„æ‰€æœ‰æƒï¼Œä½ ä¸å¾—ä¸å…‹éš†å®ƒ</span>
    <span class="hljs-title function_ invoke__">welcome_user</span>(user_name.<span class="hljs-title function_ invoke__">clone</span>()); 
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"ä½ çš„ç”¨æˆ·åæ˜¯: {}"</span>, user_name); <span class="hljs-comment">// å¦‚æœä¸cloneï¼Œè¿™é‡Œå°±ç¼–è¯‘ä¸è¿‡äº†</span>
}
</code></pre>
<p><strong>è¯•è¯•è¿™ä¸ªï¼š</strong></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// ä½¿ç”¨ &amp;strï¼Œæˆ‘ä»¬åªæ˜¯å€Ÿç”¨äº†æ•°æ®ï¼Œä¸æ¶‰åŠæ‰€æœ‰æƒè½¬ç§»</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">welcome_user</span>(name: &amp;<span class="hljs-type">str</span>) {
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Hello, {}! æ¬¢è¿æ¥åˆ°Rustçš„ä¸–ç•Œï¼"</span>, name);
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">user_name</span> = <span class="hljs-string">"CodeWizard"</span>.<span class="hljs-title function_ invoke__">to_string</span>();
    <span class="hljs-title function_ invoke__">welcome_user</span>(&amp;user_name); <span class="hljs-comment">// è½»æ¾å€Ÿç”¨</span>
    <span class="hljs-title function_ invoke__">welcome_user</span>(<span class="hljs-string">"Newbie"</span>); <span class="hljs-comment">// å­—ç¬¦ä¸²å­—é¢é‡ä¹Ÿå®Œå…¨æ²¡é—®é¢˜</span>
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"ä½ çš„ç”¨æˆ·åæ˜¯: {}"</span>, user_name); <span class="hljs-comment">// user_name è¿˜åœ¨ï¼Œå•¥äº‹æ²¡æœ‰</span>
}
</code></pre>
<p><strong>ä¸ºå•¥å‘¢ï¼Ÿ</strong> <code>String</code>æ˜¯åŠ¨æ€çš„ã€æ‹¥æœ‰æ‰€æœ‰æƒçš„å­—ç¬¦ä¸²ï¼ŒæŠŠå®ƒä½œä¸ºå‚æ•°ä¼ é€’ï¼Œè¦ä¹ˆæ‰€æœ‰æƒè¢«ç§»èµ°ï¼ˆåŸæ¥çš„å˜é‡ä¸èƒ½å†ç”¨ï¼‰ï¼Œè¦ä¹ˆä½ å°±å¾—<code>clone()</code>ä¸€ä»½ï¼Œè¿™å¯æ˜¯å®æ‰“å®çš„å†…å­˜åˆ†é…å’Œæ‹·è´ï¼Œå¼€é”€ä¸å°ã€‚è€Œ<code>&amp;str</code>ï¼ˆå­—ç¬¦ä¸²åˆ‡ç‰‡ï¼‰åªæ˜¯ä¸€ä¸ªâ€œå¼•ç”¨â€ï¼Œä¸€ä¸ªæŒ‡å‘æ•°æ®æŸéƒ¨åˆ†çš„â€œæŒ‡é’ˆ+é•¿åº¦â€ç»„åˆï¼Œä¼ é€’å®ƒå°±è·Ÿé€’å¼ åç‰‡ä¸€æ ·è½»å·§ï¼Œä¸äº§ç”Ÿä»»ä½•æ•°æ®æ‹·è´ã€‚</p>
<h4 data-id="heading-1"><strong>æŠ€å·§äºŒï¼šæ•°æ®å…±äº«ï¼Ÿåˆ«å‚»å‚»åœ°</strong><code>clone()</code>ï¼Œè¯·ç”¨**<code>Arc</code>**</h4>
<p>å½“å¤šä¸ªçº¿ç¨‹æˆ–å¤šä¸ªæ•°æ®ç»“æ„éœ€è¦è®¿é—®åŒä¸€ä»½å¤§æ•°æ®æ—¶ï¼Œæ¯”å¦‚ä¸€ä¸ªå…±äº«çš„é…ç½®ä¿¡æ¯ï¼Œæ— è„‘<code>clone()</code>ä¼šä»˜å‡ºæ²‰é‡çš„ä»£ä»·ã€‚</p>
<p><strong>åˆ«è¿™ä¹ˆå¹²ï¼š</strong></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::thread;

<span class="hljs-meta">#[derive(Clone)]</span> <span class="hljs-comment">// ä¸ºäº†èƒ½åœ¨çº¿ç¨‹é—´ä¼ é€’ï¼Œä¸å¾—ä¸åŠ ä¸ŠClone</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">AppConfig</span> {
    api_key: <span class="hljs-type">String</span>,
    timeout: <span class="hljs-type">u32</span>,
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">config</span> = AppConfig {
        api_key: <span class="hljs-string">"a_very_long_and_secret_api_key"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
        timeout: <span class="hljs-number">5000</span>,
    };

    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">handles</span> = <span class="hljs-built_in">vec!</span>[];
    <span class="hljs-keyword">for</span> <span class="hljs-variable">i</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..<span class="hljs-number">5</span> {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">thread_config</span> = config.<span class="hljs-title function_ invoke__">clone</span>(); <span class="hljs-comment">// æ¯æ¬¡éƒ½æ·±åº¦æ‹·è´æ•´ä¸ªç»“æ„ä½“</span>
        handles.<span class="hljs-title function_ invoke__">push</span>(thread::<span class="hljs-title function_ invoke__">spawn</span>(<span class="hljs-keyword">move</span> || {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"çº¿ç¨‹ {} ä½¿ç”¨çš„ API Key æ˜¯: {}"</span>, i, thread_config.api_key);
        }));
    }

    <span class="hljs-keyword">for</span> <span class="hljs-variable">handle</span> <span class="hljs-keyword">in</span> handles {
        handle.<span class="hljs-title function_ invoke__">join</span>().<span class="hljs-title function_ invoke__">unwrap</span>();
    }
}
</code></pre>
<p><strong>è¯•è¯•è¿™ä¸ªï¼š</strong></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::sync::Arc;
<span class="hljs-keyword">use</span> std::thread;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">AppConfig</span> {
    api_key: <span class="hljs-type">String</span>,
    timeout: <span class="hljs-type">u32</span>,
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-comment">// Arcæ˜¯â€œåŸå­å¼•ç”¨è®¡æ•°â€æ™ºèƒ½æŒ‡é’ˆï¼Œå¯ä»¥å®‰å…¨åœ°åœ¨çº¿ç¨‹é—´å…±äº«æ•°æ®</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">config</span> = Arc::<span class="hljs-title function_ invoke__">new</span>(AppConfig {
        api_key: <span class="hljs-string">"a_very_long_and_secret_api_key"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
        timeout: <span class="hljs-number">5000</span>,
    });

    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">handles</span> = <span class="hljs-built_in">vec!</span>[];
    <span class="hljs-keyword">for</span> <span class="hljs-variable">i</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..<span class="hljs-number">5</span> {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">thread_config</span> = Arc::<span class="hljs-title function_ invoke__">clone</span>(&amp;config); <span class="hljs-comment">// è¿™ä¸æ˜¯æ•°æ®æ‹·è´ï¼åªæ˜¯å¢åŠ å¼•ç”¨è®¡æ•°ï¼Œéå¸¸å¿«</span>
        handles.<span class="hljs-title function_ invoke__">push</span>(thread::<span class="hljs-title function_ invoke__">spawn</span>(<span class="hljs-keyword">move</span> || {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"çº¿ç¨‹ {} ä½¿ç”¨çš„ API Key æ˜¯: {}"</span>, i, thread_config.api_key);
        }));
    }

    <span class="hljs-keyword">for</span> <span class="hljs-variable">handle</span> <span class="hljs-keyword">in</span> handles {
        handle.<span class="hljs-title function_ invoke__">join</span>().<span class="hljs-title function_ invoke__">unwrap</span>();
    }
}
</code></pre>
<p><strong>ä¸ºå•¥å‘¢ï¼Ÿ</strong> <code>Arc::clone()</code>åšçš„ä¸æ˜¯å¤åˆ¶æ•°æ®æœ¬ä½“ï¼Œå®ƒåªæ˜¯æŠŠä¸€ä¸ªè®°å½•â€œæœ‰å¤šå°‘äººæ­£åœ¨å¼•ç”¨è¿™ä»½æ•°æ®â€çš„è®¡æ•°å™¨åŠ ä¸€ã€‚è¿™ä¸ªæ“ä½œéå¸¸è½»é‡ï¼Œå‡ ä¹æ²¡æœ‰æˆæœ¬ã€‚åªæœ‰å½“æœ€åä¸€ä¸ªå¼•ç”¨æ¶ˆå¤±æ—¶ï¼Œæ•°æ®æ‰ä¼šè¢«çœŸæ­£æ¸…ç†ã€‚é¢å¯¹å¤šçº¿ç¨‹å…±äº«åªè¯»æ•°æ®çš„åœºæ™¯ï¼Œ<code>Arc</code>å°±æ˜¯ä¸äºŒä¹‹é€‰ã€‚</p>
<h4 data-id="heading-2"><strong>æŠ€å·§ä¸‰ï¼š</strong> <strong>è¿­ä»£å™¨</strong> <strong>å¤§æ³•å¥½ï¼Œå‘Šåˆ«Cé£æ ¼çš„ç´¢å¼•å¾ªç¯</strong></h4>
<p>è¿˜åœ¨ç”¨<code>for i in 0..vec.len()</code>ï¼Ÿé‚£å¯å°±é”™è¿‡äº†Rustç¼–è¯‘å™¨ç»™å‡†å¤‡çš„å…è´¹åˆé¤ã€‚</p>
<p><strong>åˆ«è¿™ä¹ˆå¹²ï¼š</strong></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">numbers</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>];
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">sum_of_squares</span> = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> <span class="hljs-variable">i</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..numbers.<span class="hljs-title function_ invoke__">len</span>() {
        <span class="hljs-comment">// æ¯æ¬¡è®¿é—® numbers[i]ï¼Œç¼–è¯‘å™¨éƒ½ä¼šæ’å…¥ä¸€ä¸ªè¾¹ç•Œæ£€æŸ¥ï¼Œä»¥é˜²ä½ è¶Šç•Œ</span>
        <span class="hljs-keyword">if</span> numbers[i] % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> {
            sum_of_squares += numbers[i] * numbers[i];
        }
    }
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"å¶æ•°çš„å¹³æ–¹å’Œæ˜¯: {}"</span>, sum_of_squares);
}
</code></pre>
<p><strong>è¯•è¯•è¿™ä¸ªï¼š</strong></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">numbers</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>];
    <span class="hljs-comment">// è¿­ä»£å™¨æ˜¯æƒ°æ€§çš„ï¼Œå¹¶ä¸”é“¾å¼è°ƒç”¨ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–æˆä¸€ä¸ªé«˜æ•ˆçš„å¾ªç¯</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">sum_of_squares</span>: <span class="hljs-type">i32</span> = numbers
        .<span class="hljs-title function_ invoke__">iter</span>()                <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨</span>
        .<span class="hljs-title function_ invoke__">filter</span>(|&amp;&amp;n| n % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) <span class="hljs-comment">// ç­›é€‰å‡ºå¶æ•°</span>
        .<span class="hljs-title function_ invoke__">map</span>(|&amp;n| n * n)       <span class="hljs-comment">// è®¡ç®—å¹³æ–¹</span>
        .<span class="hljs-title function_ invoke__">sum</span>();                <span class="hljs-comment">// æ±‚å’Œ</span>

    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"å¶æ•°çš„å¹³æ–¹å’Œæ˜¯: {}"</span>, sum_of_squares);
}
</code></pre>
<p><strong>ä¸ºå•¥å‘¢ï¼Ÿ</strong> Rustçš„è¿­ä»£å™¨æ˜¯é›¶æˆæœ¬æŠ½è±¡ã€‚å†™çš„é“¾å¼è°ƒç”¨ï¼Œåœ¨ç¼–è¯‘åä¼šè¢«èåˆæˆä¸€ä¸ªæ‰‹å†™çš„ã€æå…¶é«˜æ•ˆçš„å¾ªç¯ï¼Œè€Œä¸”ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶å°±èƒ½ç¡®å®šè®¿é—®ä¸ä¼šè¶Šç•Œï¼Œä»è€Œå»æ‰äº†è¿è¡Œæ—¶çš„è¾¹ç•Œæ£€æŸ¥ã€‚æ—¢å®‰å…¨ï¼Œåˆé«˜æ•ˆï¼Œä»£ç è¿˜æ›´æ¸…æ™°ï¼Œä½•ä¹è€Œä¸ä¸ºï¼Ÿ</p>
<h4 data-id="heading-3"><strong>æŠ€å·§å››ï¼š</strong> <strong>æ³›å‹</strong> <strong>ä¼˜äºåŠ¨æ€åˆ†å‘ï¼ˆ</strong> <code>Box&lt;dyn Trait&gt;</code> <strong>ï¼‰</strong></h4>
<p>å½“ä»£ç éœ€è¦å¤„ç†å¤šç§ä¸åŒç±»å‹ï¼Œä½†å®ƒä»¬éƒ½å®ç°äº†åŒä¸€ä¸ª<code>Trait</code>æ—¶ï¼Œè¿™æ—¶å€™ä¼šæœ‰ä¸¤ç§é€‰æ‹©ï¼šé™æ€åˆ†å‘ï¼ˆæ³›å‹ï¼‰å’ŒåŠ¨æ€åˆ†å‘ï¼ˆTraitå¯¹è±¡ï¼‰ã€‚åœ¨æ€§èƒ½æ•æ„Ÿçš„è·¯å¾„ä¸Šï¼Œè¯·é€‰æ‹©å‰è€…ã€‚</p>
<p><strong>åˆ«è¿™ä¹ˆå¹²ï¼ˆåŠ¨æ€åˆ†å‘ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">trait</span> <span class="hljs-title class_">Sound</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">make_sound</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">String</span>;
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Dog</span>;
<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Sound</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Dog</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">make_sound</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">String</span> { <span class="hljs-string">"æ±ªæ±ª!"</span>.<span class="hljs-title function_ invoke__">to_string</span>() }
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Cat</span>;
<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Sound</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Cat</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">make_sound</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">String</span> { <span class="hljs-string">"å–µ~"</span>.<span class="hljs-title function_ invoke__">to_string</span>() }
}

<span class="hljs-comment">// ä½¿ç”¨Box&lt;dyn Trait&gt;ï¼Œè¿è¡Œæ—¶éœ€è¦é€šè¿‡è™šå‡½æ•°è¡¨(vtable)æŸ¥æ‰¾å…·ä½“è°ƒç”¨å“ªä¸ªæ–¹æ³•</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">trigger_sound</span>(animal: <span class="hljs-type">Box</span>&lt;<span class="hljs-keyword">dyn</span> Sound&gt;) {
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{}"</span>, animal.<span class="hljs-title function_ invoke__">make_sound</span>());
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-title function_ invoke__">trigger_sound</span>(<span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">new</span>(Dog));
    <span class="hljs-title function_ invoke__">trigger_sound</span>(<span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">new</span>(Cat));
}
</code></pre>
<p><strong>è¯•è¯•è¿™ä¸ªï¼ˆé™æ€åˆ†å‘ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">trait</span> <span class="hljs-title class_">Sound</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">make_sound</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">String</span>;
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Dog</span>;
<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Sound</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Dog</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">make_sound</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">String</span> { <span class="hljs-string">"æ±ªæ±ª!"</span>.<span class="hljs-title function_ invoke__">to_string</span>() }
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Cat</span>;
<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Sound</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Cat</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">make_sound</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">String</span> { <span class="hljs-string">"å–µ~"</span>.<span class="hljs-title function_ invoke__">to_string</span>() }
}

<span class="hljs-comment">// ä½¿ç”¨æ³›å‹ï¼Œç¼–è¯‘å™¨ä¼šä¸ºæ¯ç§ç±»å‹ç”Ÿæˆä¸€ä¸ªä¸“é—¨çš„ç‰ˆæœ¬ï¼Œæ²¡æœ‰è¿è¡Œæ—¶å¼€é”€</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">trigger_sound</span>&lt;T: Sound&gt;(animal: T) {
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{}"</span>, animal.<span class="hljs-title function_ invoke__">make_sound</span>());
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-title function_ invoke__">trigger_sound</span>(Dog);
    <span class="hljs-title function_ invoke__">trigger_sound</span>(Cat);
}
</code></pre>
<p><strong>ä¸ºå•¥å‘¢ï¼Ÿ</strong> åŠ¨æ€åˆ†å‘<code>Box&lt;dyn Trait&gt;</code>éœ€è¦åœ¨è¿è¡Œæ—¶æŸ¥æ‰¾ä¸€ä¸ªå«åšâ€œè™šè¡¨â€çš„ä¸œè¥¿æ¥ç¡®å®šåˆ°åº•è¯¥è°ƒç”¨å“ªä¸ªå…·ä½“å®ç°çš„æ–¹æ³•ï¼Œè¿™ä¼šå¸¦æ¥é¢å¤–çš„æŒ‡é’ˆé—´æ¥å¼•ç”¨å’ŒæŸ¥æ‰¾å¼€é”€ã€‚è€Œæ³›å‹ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶å°±çŸ¥é“è¦ç”¨<code>Dog</code>è¿˜æ˜¯<code>Cat</code>ï¼Œå®ƒä¼šç›´æ¥ç”Ÿæˆä¸¤ä¸ªä¸åŒç‰ˆæœ¬çš„<code>trigger_sound</code>å‡½æ•°ï¼Œä¸€ä¸ªç»™<code>Dog</code>ï¼Œä¸€ä¸ªç»™<code>Cat</code>ï¼Œè°ƒç”¨æ—¶ç›´æ¥å°±æ˜¯å‡½æ•°åœ°å€ï¼Œæ²¡æœ‰ä»»ä½•è¿è¡Œæ—¶å¼€é”€ã€‚è¿™ç§æŠ€æœ¯ä¹Ÿå«å•æ€åŒ–ã€‚</p>
<h4 data-id="heading-4"><strong>æŠ€å·§äº”ï¼šç»™å°å‡½æ•°æˆ´ä¸Š</strong><code>#[inline]</code><strong>çš„å¸½å­</strong></h4>
<p>å¯¹äºé‚£äº›åˆå°åˆè¢«é¢‘ç¹è°ƒç”¨çš„å‡½æ•°ï¼Œå‡½æ•°è°ƒç”¨æœ¬èº«çš„å¼€é”€ï¼ˆæ¯”å¦‚å»ºç«‹æ ˆå¸§ï¼‰å¯èƒ½æ¯”å‡½æ•°ä½“æ‰§è¡Œçš„å¼€é”€è¿˜å¤§ã€‚</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// è¿™æ˜¯ä¸€ä¸ªéå¸¸å°çš„è¾…åŠ©å‡½æ•°</span>
<span class="hljs-meta">#[inline]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">is_positive</span>(n: <span class="hljs-type">i32</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">bool</span> {
    n &gt; <span class="hljs-number">0</span>
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">count_positives</span>(numbers: &amp;[<span class="hljs-type">i32</span>]) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span> {
    numbers.<span class="hljs-title function_ invoke__">iter</span>().<span class="hljs-title function_ invoke__">filter</span>(|&amp;&amp;n| <span class="hljs-title function_ invoke__">is_positive</span>(n)).<span class="hljs-title function_ invoke__">count</span>()
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">data</span> = <span class="hljs-built_in">vec!</span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æ­£æ•°çš„ä¸ªæ•°: {}"</span>, <span class="hljs-title function_ invoke__">count_positives</span>(&amp;data));
}
</code></pre>
<p><strong>ä¸ºå•¥å‘¢ï¼Ÿ</strong> <code>#[inline]</code>åƒæ˜¯ä¸€ä¸ªç»™ç¼–è¯‘å™¨çš„å»ºè®®ï¼Œå‘Šè¯‰å®ƒï¼šâ€œå“¥ä»¬ï¼ŒæŠŠè¿™ä¸ªå‡½æ•°çš„ä»£ç ç›´æ¥å¤åˆ¶ç²˜è´´åˆ°è°ƒç”¨å®ƒçš„åœ°æ–¹å§ï¼Œåˆ«èµ°å‡½æ•°è°ƒç”¨æµç¨‹äº†ã€‚â€ è¿™æ ·å°±æ¶ˆé™¤äº†å‡½æ•°è°ƒç”¨çš„å¼€é”€ã€‚å½“ç„¶ï¼Œåˆ«æ»¥ç”¨ï¼Œç»™ä¸€ä¸ªå·¨å¤§çš„å‡½æ•°åŠ ä¸Š<code>#[inline]</code>åªä¼šè®©æœ€ç»ˆç¨‹åºä½“ç§¯è†¨èƒ€ï¼Œå¾—ä¸å¿å¤±ã€‚</p>
<h4 data-id="heading-5"><strong>æŠ€å·§å…­ï¼šæ ˆä¸Šåˆ†é…æ°¸è¿œæ¯”å †ä¸Šå¿«</strong></h4>
<p>èƒ½æ”¾åœ¨æ ˆä¸Šçš„æ•°æ®ï¼Œå°±åˆ«å¾€å †ä¸Šæ‰”ã€‚æ ˆåˆ†é…å°±æ˜¯ç§»åŠ¨ä¸€ä¸‹æ ˆæŒ‡é’ˆï¼Œå¿«å¦‚é—ªç”µï¼›å †åˆ†é…åˆ™éœ€è¦å»ä»“åº“ï¼ˆå †ï¼‰é‡Œæ‰¾ä¸€å—åˆé€‚çš„ç©ºåœ°ï¼Œè¦æ…¢å¾—å¤šã€‚</p>
<p><strong>åˆ«è¿™ä¹ˆå¹²ï¼š</strong></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Point</span> {
    x: <span class="hljs-type">f64</span>,
    y: <span class="hljs-type">f64</span>,
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-comment">// Box::newä¼šæŠŠæ•°æ®åˆ†é…åœ¨å †ä¸Š</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">p1</span> = <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">new</span>(Point { x: <span class="hljs-number">1.0</span>, y: <span class="hljs-number">2.0</span> });
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"å †ä¸Šçš„ç‚¹: ({}, {})"</span>, p1.x, p1.y);
}
</code></pre>
<p><strong>è¯•è¯•è¿™ä¸ªï¼š</strong></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Point</span> {
    x: <span class="hljs-type">f64</span>,
    y: <span class="hljs-type">f64</span>,
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-comment">// é»˜è®¤æƒ…å†µä¸‹ï¼Œå˜é‡æ˜¯åˆ†é…åœ¨æ ˆä¸Šçš„</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">p1</span> = Point { x: <span class="hljs-number">1.0</span>, y: <span class="hljs-number">2.0</span> };
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æ ˆä¸Šçš„ç‚¹: ({}, {})"</span>, p1.x, p1.y);
}
</code></pre>
<p>è¿™ä¸ªæŠ€å·§çœ‹èµ·æ¥éå¸¸ç®€å•ï¼Œä½†å…¶æ ¸å¿ƒæ˜¯å½“ä¸éœ€è¦åœ¨å‡½æ•°è¿”å›åæ•°æ®ä»ç„¶å­˜æ´»ï¼Œæˆ–è€…æ•°æ®å¤§å°åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šæ—¶ï¼Œä¼˜å…ˆä½¿ç”¨æ ˆã€‚<code>Box</code>ã€<code>String</code>ã€<code>Vec</code>è¿™ç±»éƒ½æ˜¯åœ¨å †ä¸Šåˆ†é…çš„ï¼Œä½¿ç”¨æ—¶è¦å¿ƒé‡Œæœ‰æ•°ã€‚</p>
<h4 data-id="heading-6"><strong>æŠ€å·§ä¸ƒï¼š</strong> <code>MaybeUninit</code> <strong>ï¼šå¤§</strong> <strong>å†…å­˜</strong> <strong>åˆå§‹åŒ–æ—¶å¼€æŒ‚äº†</strong></h4>
<p>å¦‚æœéœ€è¦ä¸€å—éå¸¸å¤§çš„å†…å­˜ï¼Œå¹¶ä¸”ç¡®å®šé©¬ä¸Šä¼šç”¨è‡ªå·±çš„æ•°æ®æŠŠå®ƒå¡«æ»¡æ—¶ï¼Œè®©Rustå…ˆç”¨0åˆå§‹åŒ–ä¸€éçš„è¯ï¼Œçº¯å±æµªè´¹CPUã€‚</p>
<p>è¿™æ˜¯ä¸€ä¸ªé«˜çº§æŠ€å·§ï¼Œéœ€è¦ä½¿ç”¨<code>unsafe</code>ï¼Œæ–°æ‰‹æ…ç”¨ï¼</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::mem::MaybeUninit;

<span class="hljs-keyword">const</span> BUFFER_SIZE: <span class="hljs-type">usize</span> = <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>; <span class="hljs-comment">// 1MB</span>

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªVecï¼Œä½†å‘Šè¯‰Rustï¼šâ€œå…ˆåˆ«åˆå§‹åŒ–è¿™å—å†…å­˜ï¼Œæˆ‘å¾…ä¼šå„¿è‡ªå·±å¼„â€</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">buffer</span>: <span class="hljs-type">Vec</span>&lt;MaybeUninit&lt;<span class="hljs-type">u8</span>&gt;&gt; = <span class="hljs-type">Vec</span>::<span class="hljs-title function_ invoke__">with_capacity</span>(BUFFER_SIZE);

    <span class="hljs-comment">// å‡è®¾æˆ‘ä»¬ä»æŸä¸ªåœ°æ–¹è¯»å–æ•°æ®å¡«æ»¡äº†è¿™å—ç¼“å†²åŒº</span>
    <span class="hljs-comment">// è¿™é‡Œæˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„å¾ªç¯æ¨¡æ‹Ÿ</span>
    <span class="hljs-comment">// æ³¨æ„ï¼šåœ¨çœŸå®åœºæ™¯ä¸­ï¼Œä½ ä¼šç”¨ç±»ä¼¼ read_exact çš„æ–¹æ³•å¡«å……</span>
    <span class="hljs-keyword">unsafe</span> {
        <span class="hljs-comment">// ä¼ªè£…æˆå·²ç»åˆå§‹åŒ–äº†ï¼Œå› ä¸ºæˆ‘ä»¬ç¡®ä¿¡ä¸‹é¢çš„ä»£ç ä¼šå®Œæˆåˆå§‹åŒ–</span>
        buffer.<span class="hljs-title function_ invoke__">set_len</span>(BUFFER_SIZE); 
        <span class="hljs-keyword">for</span> <span class="hljs-variable">i</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..BUFFER_SIZE {
            <span class="hljs-comment">// get_mut_uncheckedæ˜¯`unsafe`çš„ï¼Œä½†æˆ‘ä»¬çŸ¥é“ç´¢å¼•æ˜¯åˆæ³•çš„</span>
            *buffer.<span class="hljs-title function_ invoke__">get_mut_unchecked</span>(i) = MaybeUninit::<span class="hljs-title function_ invoke__">new</span>((i % <span class="hljs-number">256</span>) <span class="hljs-keyword">as</span> <span class="hljs-type">u8</span>);
        }
    }

    <span class="hljs-comment">// ç°åœ¨ï¼Œæˆ‘ä»¬ç¡®ä¿¡å†…å­˜å·²ç»å®Œå…¨åˆå§‹åŒ–ï¼Œå¯ä»¥å®‰å…¨åœ°æŠŠå®ƒè½¬æ¢æˆ Vec&lt;u8&gt;</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">buffer</span>: <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">u8</span>&gt; = <span class="hljs-keyword">unsafe</span> {
        <span class="hljs-comment">// è¿™æ­¥è½¬æ¢æ˜¯é›¶æˆæœ¬çš„ï¼Œå› ä¸ºå†…å­˜å¸ƒå±€å®Œå…¨ä¸€æ ·</span>
        std::mem::<span class="hljs-title function_ invoke__">transmute</span>(buffer)
    };

    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"ç¼“å†²åŒºåˆ›å»ºå¹¶å¡«å……å®Œæ¯•ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯: {}"</span>, buffer[<span class="hljs-number">0</span>]);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æœ€åä¸€ä¸ªå…ƒç´ æ˜¯: {}"</span>, buffer[BUFFER_SIZE - <span class="hljs-number">1</span>]);
}
</code></pre>
<p><strong>ä¸ºå•¥å‘¢ï¼Ÿ</strong> <code>Vec::with_capacity</code>åªåˆ†é…å†…å­˜ï¼Œä¸åˆå§‹åŒ–ã€‚ä½†å¦‚æœä½ æ¥ç€ç”¨<code>resize</code>æˆ–è€…å…¶ä»–å®‰å…¨çš„æ–¹æ³•ï¼Œå®ƒè¿˜æ˜¯ä¼šå¸®ä½ åˆå§‹åŒ–ã€‚<code>MaybeUninit</code>å…è®¸ä½ è·³è¿‡è¿™ä¸ªé»˜è®¤çš„åˆå§‹åŒ–æ­¥éª¤ï¼Œç›´æ¥æ“ä½œæœªåˆå§‹åŒ–çš„å†…å­˜ï¼Œå¯¹äºé«˜æ€§èƒ½ç½‘ç»œç¼–ç¨‹ã€æ•°æ®è§£æç­‰åœºæ™¯ï¼Œèƒ½çœä¸‹å¯è§‚çš„æ—¶é—´ã€‚ä½†è®°ä½ï¼Œ<code>unsafe</code>æ„å‘³ç€ä½ å¾—è‡ªå·±å¯¹å†…å­˜å®‰å…¨è´Ÿè´£ï¼</p>
<h3 data-id="heading-7"><strong>æ€»ç»“ä¸€ä¸‹</strong></h3>
<p>Rustæ€§èƒ½è°ƒä¼˜çš„æ ¸å¿ƒæ€æƒ³æ— éå‡ ç‚¹ï¼š</p>
<ul>
<li>
<p><strong>å‡å°‘</strong> <strong>å†…å­˜</strong> <strong>åˆ†é…å’Œæ‹·è´</strong>ï¼šå¤šç”¨å€Ÿç”¨ï¼ˆ<code>&amp;</code>ï¼‰ï¼Œå–„ç”¨æ™ºèƒ½æŒ‡é’ˆï¼ˆ<code>Arc</code>ï¼‰ã€‚</p>
</li>
<li>
<p><strong>è®©ç¼–è¯‘å™¨å¸®ä½ å¹²æ´»</strong>ï¼šå¤šç”¨è¿­ä»£å™¨ï¼Œå¤šç”¨æ³›å‹ã€‚</p>
</li>
<li>
<p><strong>ç†è§£</strong> <strong>å†…å­˜</strong> <strong>å¸ƒå±€</strong>ï¼šåŒºåˆ†æ ˆå’Œå †ï¼ŒçŸ¥é“ä»€ä¹ˆæ—¶å€™è¯¥ç”¨è°ã€‚</p>
</li>
</ul>
<p>å½“ç„¶ï¼Œä¼˜åŒ–è¦è®²ç©¶ç« æ³•ï¼Œä¸è¦ä¸Šæ¥å°±å¯¹ç€è´´è„¸ä»£ç å¼€å¤§ã€‚å…ˆç”¨æ€§èƒ½åˆ†æå·¥å…·ï¼ˆæ¯”å¦‚<code>cargo-flamegraph</code>ï¼‰æ‰¾åˆ°é—®é¢˜åœ¨å“ªï¼Œå†å¯¹ç—‡ä¸‹è¯ã€‚</p>
<p>æœ€åï¼Œåˆ«å¿˜äº†ï¼Œä¸€ä¸ªé¡ºæ‰‹çš„å¼€å‘ç¯å¢ƒæ˜¯é«˜æ•ˆå·¥ä½œçš„å¼€å§‹ã€‚ServBay æå®šç¹ççš„é…ç½®ï¼Œå¼€å‘è€…å°±èƒ½æŠŠå…¨éƒ¨ç²¾åŠ›æŠ•å…¥åˆ°ç¼–å†™ä¼˜é›…ä¸”é«˜æ€§èƒ½çš„Rustä»£ç ä¸­ã€‚ç°åœ¨ï¼Œå»æŠŠä½ çš„ä¹°èœè½¦è°ƒæ•™æˆä¸€è¾†çœŸæ­£çš„æ³•æ‹‰åˆ©å§ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ•‘å‘½ï¼è¿™ä¸ªä½ä»£ç å·¥å…·å¤ªé¦™äº† â€”â€”TinyEngine ç‰©æ–™è‡ªåŠ¨å¯¼å…¥ä¸Šæ‰‹]]></title>    <link>https://juejin.cn/post/7572340344509169690</link>    <guid>https://juejin.cn/post/7572340344509169690</guid>    <pubDate>2025-11-14T08:52:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572340344509169690" data-draft-id="7572387068313272347" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ•‘å‘½ï¼è¿™ä¸ªä½ä»£ç å·¥å…·å¤ªé¦™äº† â€”â€”TinyEngine ç‰©æ–™è‡ªåŠ¨å¯¼å…¥ä¸Šæ‰‹"/> <meta itemprop="keywords" content="å‰ç«¯,ä½ä»£ç ,GitHub"/> <meta itemprop="datePublished" content="2025-11-14T08:52:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OpenTinyç¤¾åŒº"/> <meta itemprop="url" content="https://juejin.cn/user/3808325101432983"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ•‘å‘½ï¼è¿™ä¸ªä½ä»£ç å·¥å…·å¤ªé¦™äº† â€”â€”TinyEngine ç‰©æ–™è‡ªåŠ¨å¯¼å…¥ä¸Šæ‰‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808325101432983/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OpenTinyç¤¾åŒº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T08:52:53.000Z" title="Fri Nov 14 2025 08:52:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    25
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ¬æ–‡ç”±TinyEngineä½ä»£ç ç‰©æ–™å¯¼å…¥åŠŸèƒ½è´¡çŒ®è€…å¼ ç­ åŒå­¦åŸåˆ›ã€‚</p>
<h2 data-id="heading-0">å¼•è¨€ï¼šä½ä»£ç ç‰©æ–™æ¥å…¥çš„ç—›ç‚¹ä¸è§£å†³æ–¹æ¡ˆ</h2>
<p>åœ¨ä½ä»£ç å¹³å°å¼€å‘ä¸­ï¼Œç‰©æ–™æ¥å…¥æ˜¯æ ¸å¿ƒç¯èŠ‚ä¹‹ä¸€ã€‚ä¼ ç»Ÿç‰©æ–™æ¥å…¥ä¾èµ–å¼€å‘è€…æ‰‹åŠ¨ç¼–å†™ç¬¦åˆå¹³å°åè®®çš„ JSON é…ç½®ï¼Œä¸ä»…æ•ˆç‡ä½ä¸‹ï¼Œè¿˜å®¹æ˜“å› äººä¸ºå¤±è¯¯å¯¼è‡´å…¼å®¹æ€§é—®é¢˜ â€”â€” å°¤å…¶æ˜¯é¢å¯¹æµ·é‡ UI ç»„ä»¶æ—¶ï¼Œé‡å¤çš„äººå·¥æ“ä½œä¼šå¤§å¹…æ‹–æ…¢å¼€å‘è¿›åº¦ã€‚</p>
<p>ä¸ºè§£å†³è¿™ä¸€ç—›ç‚¹ï¼Œæˆ‘ä»¬å¼€å‘äº†Â <strong>TinyEngine ä½ä»£ç ç‰©æ–™è‡ªåŠ¨å¯¼å…¥å·¥å…·</strong>ï¼Œæ”¯æŒé€šè¿‡ URL çˆ¬å–ã€NPM åŒ…è§£æã€æºç ä¸Šä¼ ä¸‰ç§æ–¹å¼ï¼Œè‡ªåŠ¨æå–ç»„ä»¶çš„ Props/Events/Slots ç­‰ API ä¿¡æ¯ï¼Œå¹¶è½¬æ¢ä¸ºç¬¦åˆ TinyEngine åè®®çš„æ ‡å‡†ç‰©æ–™æ ¼å¼ã€‚é…å¥—çš„å¯è§†åŒ–å‰ç«¯å®ç°äº† "å¯¼å…¥ - é¢„è§ˆ - ç¼–è¾‘ - ä¿å­˜" å…¨æµç¨‹é—­ç¯ï¼Œå°†ç‰©æ–™æ¥å…¥æ•ˆç‡å¤§å¹…åº¦æå‡ã€‚</p>
<p>æœ¬æ–‡å°†ä»é¡¹ç›®è®¾è®¡ã€æ ¸å¿ƒæ¨¡å—å®ç°ã€é¡¹ç›®éƒ¨ç½²ä¸ä½¿ç”¨æŒ‡å—ç­‰æ–¹é¢ï¼Œå¸¦å¤§å®¶å…¨é¢äº†è§£è¿™ä¸ªå‰åç«¯ä¸€ä½“åŒ–çš„ç‰©æ–™å¤„ç†æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-1">ä¸€ã€é¡¹ç›®æ¦‚è§ˆï¼šæŠ€æœ¯æ ˆä¸æ ¸å¿ƒæ¶æ„</h2>
<h3 data-id="heading-2">1. æŠ€æœ¯æ ˆé€‰å‹</h3>
<h4 data-id="heading-3">åç«¯æŠ€æœ¯æ ˆ</h4>
<ul>
<li>è¿è¡Œç¯å¢ƒï¼šNode.js v20.19.5+ï¼ˆåŸç”Ÿæ”¯æŒ fetch ä¸ ES6 + è¯­æ³•ï¼‰</li>
<li>æ ¸å¿ƒä¾èµ–ï¼šExpressï¼ˆæ¥å£æœåŠ¡ï¼‰ã€MySQLï¼ˆç‰©æ–™å­˜å‚¨ï¼‰ã€Puppeteerï¼ˆURL çˆ¬å–ï¼‰ã€LLM SDKï¼ˆAPI æå–ï¼‰</li>
<li>æ ¸å¿ƒèƒ½åŠ›ï¼šå¤šæºæ•°æ®è§£æã€ç‰©æ–™åè®®è½¬æ¢ã€å¼‚æ­¥ä»»åŠ¡ç®¡ç†</li>
</ul>
<h4 data-id="heading-4">å‰ç«¯æŠ€æœ¯æ ˆ</h4>
<ul>
<li>æ¡†æ¶ï¼šVue 3.2+ï¼ˆ<code>&lt;script setup&gt;</code>è¯­æ³•ï¼‰</li>
<li>æ„å»ºå·¥å…·ï¼šVite 4.0+ï¼ˆé«˜æ•ˆçƒ­æ›´æ–°ä¸è·¨åŸŸä»£ç†ï¼‰</li>
<li>UI ç»„ä»¶ï¼šOpenTiny Vueï¼ˆè½»é‡åŒ–ä¼ä¸šçº§ç»„ä»¶åº“ï¼‰</li>
<li>æ ¸å¿ƒèƒ½åŠ›ï¼šåŠ¨æ€è¡¨å•ã€ä»»åŠ¡è¿›åº¦å¯è§†åŒ–ã€è¡¨æ ¼ç¼–è¾‘ã€æ‰¹é‡æ•°æ®ç®¡ç†</li>
</ul>
<h3 data-id="heading-5">2. æ•´ä½“æ¶æ„è®¾è®¡</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6d431b4a4af456da4a045ae343b2843~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763718186&amp;x-signature=RZjgmjfjRhTYtKLAQURPS0xo2Mk%3D" alt="1.png" loading="lazy"/></p>
<p>é¡¹ç›®é‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œæ ¸å¿ƒäº¤äº’æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>å‰ç«¯å‘èµ·å¯¼å…¥è¯·æ±‚ï¼ˆæºå¸¦ URL/NPM ä¿¡æ¯ / æºç æ–‡ä»¶ï¼‰ï¼›</li>
<li>åç«¯åˆ›å»ºå¼‚æ­¥ä»»åŠ¡ï¼Œæ ¹æ®å¯¼å…¥ç±»å‹æ‰§è¡Œå¯¹åº”è§£æé€»è¾‘ï¼›</li>
<li>è°ƒç”¨ LLM æ¥å£æå–ç»“æ„åŒ– API ä¿¡æ¯ï¼Œè½¬æ¢ä¸ºæ ‡å‡†ç‰©æ–™æ ¼å¼ï¼›</li>
<li>å‰ç«¯é€šè¿‡è½®è¯¢è·å–ä»»åŠ¡è¿›åº¦ï¼Œå®æ—¶å±•ç¤ºå¤„ç†çŠ¶æ€ï¼›</li>
<li>å¤„ç†å®Œæˆåï¼Œå‰ç«¯æä¾›ç‰©æ–™é¢„è§ˆä¸ç¼–è¾‘åŠŸèƒ½ï¼Œæ”¯æŒä¿å­˜åˆ°æ•°æ®åº“ã€‚</li>
</ol>
<h2 data-id="heading-6">äºŒã€æ ¸å¿ƒåŠŸèƒ½æ‹†è§£ï¼šä»è§£æåˆ°å¯è§†åŒ–</h2>
<h3 data-id="heading-7">1. å¤šæºç‰©æ–™è§£æï¼ˆåç«¯æ ¸å¿ƒèƒ½åŠ›ï¼‰</h3>
<p>ä¾æ‰˜å››å¤§æ ¸å¿ƒæ¨¡å—ååŒå·¥ä½œï¼Œå®ç°URLã€NPMã€æºç ä¸‰ç§å¯¼å…¥æ–¹å¼çš„æ ‡å‡†åŒ–è§£æï¼Œå…¨ç¨‹è‡ªåŠ¨åŒ–å®Œæˆä»åŸå§‹æ•°æ®åˆ°TinyEngineæ ‡å‡†ç‰©æ–™çš„è½¬åŒ–ã€‚</p>
<h4 data-id="heading-8">ï¼ˆ1ï¼‰URL å¯¼å…¥</h4>
<p>åŸºäº <strong>APIç”Ÿæˆæ¨¡å—</strong> çš„URLè¡¨æ ¼é©±åŠ¨æµç¨‹ï¼Œé€šè¿‡Puppeteeræ¨¡æ‹Ÿæµè§ˆå™¨è®¿é—®ç›®æ ‡URLï¼Œæ ¹æ®ç”¨æˆ·æŒ‡å®šçš„CSSé€‰æ‹©å™¨ç²¾å‡†å®šä½APIè¡¨æ ¼æ•°æ®ï¼Œæ­é…é‡è¯•æœºåˆ¶ä¿éšœçˆ¬å–ç¨³å®šæ€§ï¼›è·å–è¡¨æ ¼æ•°æ®åï¼Œä¼ é€’ç»™LLMæ¨¡å‹è¿›è¡Œç»“æ„åŒ–å¤„ç†ï¼Œç”ŸæˆåŒ…å«Props/Events/Slotsçš„åŸå§‹API JSONï¼›éšåç» <strong>ç‰©æ–™è½¬æ¢æ¨¡å—</strong> è½¬åŒ–ä¸ºç¬¦åˆTinyEngineè§„èŒƒçš„ç‰©æ–™æ ¼å¼ï¼Œæœ€åç”± <strong>åå¤„ç†æ¨¡å—</strong> å®Œæˆç»„ä»¶åæ ‡å‡†åŒ–ï¼ˆå¦‚ç»Ÿä¸€ä¸ºPascalCaseæ ¼å¼ï¼‰åŠè§„åˆ™åŒ–ä¼˜åŒ–ï¼Œç¡®ä¿ç‰©æ–™ä¸€è‡´æ€§ã€‚</p>
<h4 data-id="heading-9">ï¼ˆ2ï¼‰NPM å¯¼å…¥</h4>
<p>æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„NPMåŒ…åä¸ç»„ä»¶ååï¼Œåç«¯è‡ªåŠ¨ä¸‹è½½å¯¹åº”åŒ…èµ„æºï¼Œé€šè¿‡ <strong>æ–‡ä»¶ç­›é€‰æ¨¡å—</strong> çš„NPMç±»å‹è§„åˆ™ï¼ˆå¼ºåˆ¶æ ¡éªŒ<code>index</code>å…¥å£æ–‡ä»¶ï¼Œæå–å«ç»„ä»¶å…³é”®è¯çš„æ ¸å¿ƒæ–‡ä»¶ï¼Œè‡ªåŠ¨è·³è¿‡<code>style</code>ã€<code>utils</code>ç­‰éAPIç›¸å…³ç›®å½•åŠ<code>.map</code>æ–‡ä»¶ï¼‰å®Œæˆæ–‡ä»¶ç­›é€‰ï¼›ç­›é€‰åçš„æ ¸å¿ƒæ–‡ä»¶è¿›å…¥ <strong>APIç”Ÿæˆæ¨¡å—</strong> çš„æ–‡ä»¶é©±åŠ¨æµç¨‹ï¼Œç»LLMè§£æç”ŸæˆåŸå§‹API JSONï¼›å†é€šè¿‡ <strong>ç‰©æ–™è½¬æ¢æ¨¡å—</strong> è¡¥å……ç»„ä»¶åŸºæœ¬ä¿¡æ¯ã€è§„èŒƒProps/Events/Slotså®šä¹‰ï¼Œæœ€ç»ˆç”± <strong>åå¤„ç†æ¨¡å—</strong> æŒ‰é¢„è®¾è§„åˆ™ä¼˜åŒ–ï¼ˆæ— éœ€å¤„ç†çš„ç»„ä»¶ç›´æ¥ä¿ç•™ã€è¡¨æ ¼ç»„ä»¶åˆå¹¶åˆ—å®šä¹‰ç­‰ï¼‰ï¼Œè¾“å‡ºæ ‡å‡†ç‰©æ–™ã€‚</p>
<h4 data-id="heading-10">ï¼ˆ3ï¼‰æºç å¯¼å…¥</h4>
<p>ç”¨æˆ·å¯ä¸Šä¼ Vueç»„ä»¶æºç æ–‡ä»¶æˆ–ZIPå‹ç¼©åŒ…ï¼Œåç«¯è§£å‹åè§¦å‘ <strong>æ–‡ä»¶ç­›é€‰æ¨¡å—</strong> çš„æºç ç±»å‹å¤„ç†é€»è¾‘â€”â€”è‡ªåŠ¨è¯†åˆ«<code>index.js/ts</code>å…¥å£æ–‡ä»¶åŠProps/Eventså®šä¹‰æ–‡ä»¶ï¼Œè¿‡æ»¤éAPIç›¸å…³å†…å®¹ï¼›ç­›é€‰åçš„æœ‰æ•ˆæ–‡ä»¶è¿›å…¥ <strong>APIç”Ÿæˆæ¨¡å—</strong> æ‰§è¡Œæ–‡ä»¶é©±åŠ¨æµç¨‹ï¼Œç»LLMè§£æç”ŸæˆåŸå§‹API JSONï¼›åç»­é€šè¿‡ <strong>ç‰©æ–™è½¬æ¢æ¨¡å—</strong> è½¬åŒ–ä¸ºTinyEngineæ ‡å‡†æ ¼å¼ï¼Œå†ç”± <strong>åå¤„ç†æ¨¡å—</strong> æ¸…ç†å­é¡¹ç»„ä»¶å†—ä½™ç‰‡æ®µã€ç»Ÿä¸€ç»„ä»¶åæ ¼å¼ï¼Œæœ€ç»ˆç”Ÿæˆå¯ç›´æ¥ä½¿ç”¨çš„æ ‡å‡†åŒ–ç‰©æ–™ã€‚</p>
<h3 data-id="heading-11">2. å¯è§†åŒ–æ“ä½œé—­ç¯ï¼ˆå‰ç«¯æ ¸å¿ƒèƒ½åŠ›ï¼‰</h3>
<h4 data-id="heading-12">ï¼ˆ1ï¼‰åŠ¨æ€å¯¼å…¥è¡¨å•</h4>
<p>æ ¹æ®ç”¨æˆ·é€‰æ‹©çš„å¯¼å…¥ç±»å‹ï¼ˆURL/NPM/ æºç ï¼‰ï¼Œè‡ªåŠ¨åˆ‡æ¢å¯¹åº”è¡¨å•ï¼š</p>
<ul>
<li>URL å¯¼å…¥ï¼šå±•ç¤º URL è¾“å…¥æ¡†ä¸è¡¨æ ¼ CSS é€‰æ‹©å™¨è¾“å…¥æ¡†ï¼›</li>
<li>NPM å¯¼å…¥ï¼šå±•ç¤ºåŒ…åä¸ç»„ä»¶åè¾“å…¥æ¡†ï¼›</li>
<li>æºç å¯¼å…¥ï¼šå±•ç¤ºæ–‡ä»¶ä¸Šä¼ ç»„ä»¶ï¼ˆæ”¯æŒå•ä¸ªæ–‡ä»¶ä¸ ZIP åŒ…ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-13">ï¼ˆ2ï¼‰ä»»åŠ¡è¿›åº¦å¯è§†åŒ–</h4>
<ul>
<li>æäº¤å¯¼å…¥è¯·æ±‚åï¼Œå±•ç¤ºè¿›åº¦æ¡å®æ—¶æ›´æ–°å¤„ç†è¿›åº¦ï¼ˆ0-100%ï¼‰ï¼›</li>
<li>å¤„ç†ä¸­ä»»åŠ¡æ”¯æŒæœ€å°åŒ–ä¸ºå³ä¾§æ‚¬æµ®å¡ç‰‡ï¼Œä¸å½±å“å…¶ä»–æ“ä½œï¼Œç‚¹å‡»å¯é‡æ–°æ‰“å¼€æ¨¡æ€æ¡†æŸ¥çœ‹è¯¦æƒ…ï¼›</li>
<li>ä»»åŠ¡çŠ¶æ€å®æ—¶åé¦ˆï¼ˆå¤„ç†ä¸­ / æˆåŠŸ / å¤±è´¥ï¼‰ï¼Œå¤±è´¥æ—¶æ˜¾ç¤ºå…·ä½“é”™è¯¯ä¿¡æ¯ã€‚</li>
</ul>
<h4 data-id="heading-14">ï¼ˆ3ï¼‰ç‰©æ–™é¢„è§ˆä¸ç¼–è¾‘</h4>
<p>ä»»åŠ¡å¤„ç†æˆåŠŸåï¼Œé€šè¿‡è¡¨æ ¼å±•ç¤ºç”Ÿæˆçš„ç‰©æ–™åˆ—è¡¨ï¼Œæ”¯æŒï¼š</p>
<ul>
<li>ä¸»è¡¨å±•ç¤ºåŸºç¡€ä¿¡æ¯ï¼ˆç»„ä»¶åã€å¯¼å…¥ç±»å‹ã€å¯¼å…¥æ—¶é—´ç­‰ï¼‰ï¼›</li>
<li>å±•å¼€è¡ŒæŸ¥çœ‹å­è¡¨ï¼ˆå±æ€§ / äº‹ä»¶ / æ’æ§½ï¼‰ï¼Œæ”¯æŒç¼–è¾‘å­—æ®µå€¼ã€åˆ é™¤æ— æ•ˆé¡¹ï¼›</li>
<li>ç¼–è¾‘åå®æ—¶æäº¤æ›´æ–°ï¼Œç¡®ä¿æ•°æ®åŒæ­¥åˆ°åç«¯ã€‚</li>
</ul>
<h4 data-id="heading-15">ï¼ˆ4ï¼‰ç‰©æ–™åº“ç®¡ç†</h4>
<p>æä¾›å®Œæ•´çš„ç‰©æ–™ç®¡ç†åŠŸèƒ½ï¼š</p>
<ul>
<li>ç­›é€‰ä¸æœç´¢ï¼šæŒ‰ç»„ä»¶åç²¾ç¡®ç­›é€‰ã€å…³é”®è¯æ¨¡ç³Šæœç´¢ï¼›</li>
<li>æ‰¹é‡æ“ä½œï¼šæ‰¹é‡å¯¼å‡ºé€‰ä¸­ç‰©æ–™ä¸º JSON æ–‡ä»¶ã€æ‰¹é‡åˆ é™¤æ— ç”¨ç‰©æ–™ï¼›</li>
<li>åˆ†é¡µæ§åˆ¶ï¼šé»˜è®¤ 10 æ¡ / é¡µï¼Œæ”¯æŒè‡ªå®šä¹‰æ¯é¡µæ˜¾ç¤ºæ•°é‡ã€‚</li>
</ul>
<h2 data-id="heading-16">ä¸‰ã€é¡¹ç›®éƒ¨ç½²</h2>
<h3 data-id="heading-17">1. ç¯å¢ƒè¦æ±‚</h3>



































<table><thead><tr><th>ç¯å¢ƒ/å·¥å…·</th><th>ç‰ˆæœ¬è¦æ±‚</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Node.js</td><td>v20.19.5 åŠä»¥ä¸Š</td><td>æ”¯æŒ<code>fetch</code>ã€ES6+è¯­æ³•ï¼Œå‰åç«¯é€šç”¨ï¼Œå»ºè®®ä½¿ç”¨å®˜ç½‘é•¿æœŸæ”¯æŒç‰ˆç¡®ä¿å…¼å®¹æ€§</td></tr><tr><td>å‰ç«¯æ¡†æ¶</td><td>Vue 3.2+</td><td>å‰ç«¯é‡‡ç”¨<code>&lt;script setup&gt;</code>è¯­æ³•å¼€å‘ï¼Œéœ€ç¡®ä¿ä¾èµ–ç‰ˆæœ¬ç¬¦åˆè¦æ±‚</td></tr><tr><td>æ„å»ºå·¥å…·</td><td>Vite 4.0+</td><td>è´Ÿè´£å‰ç«¯é¡¹ç›®æ„å»ºã€çƒ­æ›´æ–°åŠè·¨åŸŸä»£ç†é…ç½®ï¼Œå½“å‰é¡¹ç›®å®é™…ä½¿ç”¨v7.1.7ç‰ˆæœ¬</td></tr><tr><td>æ•°æ®åº“</td><td>MySQL 8.0 åŠä»¥ä¸Š</td><td>ç”¨äºå­˜å‚¨ç‰©æ–™æ•°æ®ï¼Œéœ€æå‰æœ¬åœ°å®‰è£…å¹¶å¯åŠ¨</td></tr><tr><td>ä¾èµ–æœåŠ¡</td><td>LLMæ¥å£ï¼ˆå¦‚DeepSeek/Qwen/OpenAIï¼‰</td><td>åç«¯æ ¸å¿ƒä¾èµ–ï¼Œéœ€å‡†å¤‡æ”¯æŒJSONè¾“å‡ºçš„å¤§æ¨¡å‹æ¥å£åŠå¯¹åº”APIå¯†é’¥ã€æ¥å£åœ°å€</td></tr></tbody></table>
<h3 data-id="heading-18">2. å®‰è£…ä¸é…ç½®</h3>
<h4 data-id="heading-19">2.1 å…‹éš†ä»“åº“</h4>
<p>é¦–å…ˆå°†é¡¹ç›®ä»£ç å…‹éš†åˆ°æœ¬åœ°ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> &lt;ä»“åº“åœ°å€&gt;  <span class="hljs-comment"># æ›¿æ¢ä¸ºå®é™…çš„é¡¹ç›®ä»“åº“åœ°å€</span>
</code></pre>
<h4 data-id="heading-20">2.2 å®‰è£…ä¾èµ–</h4>
<p>è¿›å…¥é¡¹ç›®æ ¹ç›®å½•åï¼Œåˆ†åˆ«å®‰è£…åç«¯å’Œå‰ç«¯çš„ä¾èµ–åŒ…ï¼Œç¡®ä¿ç¯å¢ƒä¸€è‡´æ€§ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. å®‰è£…åç«¯ä¾èµ–</span>
<span class="hljs-built_in">cd</span> backend
npm install  <span class="hljs-comment"># è‹¥ä½¿ç”¨yarn/pnpmï¼Œå¯æ›¿æ¢ä¸ºyarn install/pnpm install</span>

<span class="hljs-comment"># 2. å®‰è£…å‰ç«¯ä¾èµ–ï¼ˆéœ€æ–°å¼€ç»ˆç«¯æˆ–è¿”å›æ ¹ç›®å½•ï¼‰</span>
<span class="hljs-built_in">cd</span> frontend
npm install  <span class="hljs-comment"># åŒç†å¯æ›¿æ¢ä¸ºå¯¹åº”åŒ…ç®¡ç†å·¥å…·çš„å®‰è£…å‘½ä»¤</span>
</code></pre>
<h4 data-id="heading-21">2.3 ç¯å¢ƒé…ç½®</h4>
<h5 data-id="heading-22">ï¼ˆ1ï¼‰åç«¯é…ç½®</h5>
<ol>
<li>
<p><strong>å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿</strong>ï¼šè¿›å…¥åç«¯ç›®å½•ï¼Œå°† <code>.env.example</code> æ¨¡æ¿æ–‡ä»¶å¤åˆ¶ä¸ºå®é™…ä½¿ç”¨çš„ <code>.env</code> æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> backend  <span class="hljs-comment"># è‹¥å½“å‰ä¸åœ¨åç«¯ç›®å½•éœ€æ‰§è¡Œæ­¤å‘½ä»¤</span>
<span class="hljs-built_in">cp</span> .env.example .<span class="hljs-built_in">env</span>  <span class="hljs-comment"># Windowsç³»ç»Ÿå¯æ‰‹åŠ¨å¤åˆ¶æ–‡ä»¶å¹¶é‡å‘½åä¸º.env</span>
</code></pre>
</li>
<li>
<p><strong>ç¼–è¾‘.envæ–‡ä»¶å‚æ•°</strong>ï¼šç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ <code>.env</code> æ–‡ä»¶ï¼Œæ ¹æ®æœ¬åœ°ç¯å¢ƒå’Œå®é™…èµ„æºä¿¡æ¯å¡«å†™ä»¥ä¸‹å…³é”®é…ç½®ï¼ˆæ›¿æ¢å ä½ç¬¦å†…å®¹ï¼‰ï¼š</p>
<pre><code class="hljs language-env" lang="env"># æœåŠ¡å™¨é…ç½®
SERVER_PORT=3001                  # åç«¯æœåŠ¡ç«¯å£ï¼Œé»˜è®¤3001ï¼Œå¯æŒ‰éœ€ä¿®æ”¹
CORS_ALLOW_ORIGIN=http://localhost:8080 # å‰ç«¯åœ°å€ï¼Œéœ€ä¸å‰ç«¯ç«¯å£ä¿æŒä¸€è‡´ï¼Œè§£å†³è·¨åŸŸé—®é¢˜

# æ•°æ®åº“é…ç½®ï¼ˆéœ€ä¸æœ¬åœ°MySQLç¯å¢ƒåŒ¹é…ï¼‰
MYSQL_HOST=localhost       # MySQLæœåŠ¡åœ°å€ï¼Œæœ¬åœ°é»˜è®¤localhost
MYSQL_PORT=3306            # MySQLç«¯å£ï¼Œé»˜è®¤3306
MYSQL_USER=root            # MySQLç”¨æˆ·åï¼Œæ›¿æ¢ä¸ºä½ çš„å®é™…ç”¨æˆ·å
MYSQL_PASSWORD=your_password    # MySQLå¯†ç ï¼Œæ›¿æ¢ä¸ºä½ çš„å®é™…å¯†ç ï¼ˆæ— å¯†ç åˆ™ç•™ç©ºï¼‰
MYSQL_DATABASE=lowcode_material # æ•°æ®åº“åï¼Œéœ€åç»­æ‰‹åŠ¨åˆ›å»ºè¯¥åº“

# LLMæ¨¡å‹é…ç½®ï¼ˆå¿…å¡«ï¼Œæ›¿æ¢ä¸ºå®é™…å¯ç”¨çš„å¤§æ¨¡å‹ä¿¡æ¯ï¼‰
OPENAI_MODEL=deepseek-reasoner            # æ¨¡å‹åç§°ï¼Œå¦‚deepseek-reasonerã€Qwen3-32Bç­‰
OPENAI_API_KEY=your_api_key_here          # æ¨¡å‹APIå¯†é’¥ï¼Œä»å¯¹åº”å¹³å°è·å–
OPENAI_BASE_URL=https://api.deepseek.com/v1 # æ¨¡å‹æ¥å£åœ°å€ï¼ŒæŒ‰å®é™…å¹³å°å¡«å†™

# é»˜è®¤è·¯å¾„é…ç½®ï¼ˆç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œï¼‰
DEFAULT_OUTPUT_DIR=output-log       # æœ€ç»ˆç‰©æ–™JSONè¾“å‡ºç›®å½•
DEFAULT_SCHEMA_LOG_DIR=schema-log   # è½¬æ¢è¿‡ç¨‹æ—¥å¿—ç›®å½•
DEFAULT_API_LOG_DIR=raw-api-log     # åŸå§‹API JSONæ—¥å¿—ç›®å½•
</code></pre>
</li>
</ol>
<h5 data-id="heading-23">ï¼ˆ2ï¼‰å‰ç«¯é…ç½®ï¼ˆè·¨åŸŸä¸ç«¯å£ï¼‰</h5>
<p>å‰ç«¯éœ€é…ç½®ä»£ç†å¯¹æ¥åç«¯æœåŠ¡ï¼Œç¡®ä¿æ¥å£è¯·æ±‚æ­£å¸¸ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>è¿›å…¥å‰ç«¯ç›®å½•ï¼Œæ‰“å¼€ <code>vite.config.js</code> æ–‡ä»¶ï¼ˆè·¯å¾„ï¼š<code>frontend/vite.config.js</code>ï¼‰ï¼›</li>
<li>ç¡®è®¤æˆ–ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼ˆéœ€ä¸åç«¯ <code>.env</code> ä¸­çš„é…ç½®ä¿æŒä¸€è‡´ï¼‰ï¼š
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>; 
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>; 

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vue</span>()],
  <span class="hljs-attr">server</span>: {
    <span class="hljs-attr">port</span>: <span class="hljs-number">8080</span>, <span class="hljs-comment">// å‰ç«¯ç«¯å£ï¼Œé»˜è®¤8080ï¼Œéœ€ä¸åç«¯CORS_ALLOW_ORIGINä¸­çš„ç«¯å£ä¸€è‡´</span>
    <span class="hljs-attr">proxy</span>: {
      <span class="hljs-comment">// ä»£ç†æ‰€æœ‰/apiå‰ç¼€çš„è¯·æ±‚åˆ°åç«¯æœåŠ¡</span>
      <span class="hljs-string">'/api'</span>: {
        <span class="hljs-attr">target</span>: <span class="hljs-string">'http://localhost:3001'</span>, <span class="hljs-comment">// åç«¯æœåŠ¡åœ°å€ï¼Œä¸SERVER_PORTä¸€è‡´</span>
        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å¼€å¯è·¨åŸŸé€‚é…</span>
      }
    }
  }
});
</code></pre>
<ul>
<li>è‹¥ä¿®æ”¹äº†å‰ç«¯ç«¯å£æˆ–åç«¯æœåŠ¡ç«¯å£ï¼Œéœ€åŒæ­¥æ›´æ–°å¯¹åº”é…ç½®ã€‚</li>
</ul>
</li>
</ol>
<h3 data-id="heading-24">3. å¿«é€Ÿå¯åŠ¨</h3>
<p>å‰åç«¯æœåŠ¡éœ€æŒ‰ç‰¹å®šé¡ºåºå¯åŠ¨ï¼Œæ ¸å¿ƒé¡ºåºï¼š<strong>å¯åŠ¨MySQLæœåŠ¡ â†’ åˆ›å»ºé¡¹ç›®æ•°æ®åº“ â†’ å¯åŠ¨åç«¯æœåŠ¡ â†’ å¯åŠ¨å‰ç«¯æœåŠ¡</strong>ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<h4 data-id="heading-25">3.1 å¯åŠ¨MySQLæœåŠ¡å¹¶åˆ›å»ºé¡¹ç›®æ•°æ®åº“</h4>
<h5 data-id="heading-26">ï¼ˆ1ï¼‰å¯åŠ¨MySQLæœåŠ¡</h5>
<p>æ ¹æ®æœ¬åœ°æ“ä½œç³»ç»Ÿï¼Œæ‰§è¡Œå¯¹åº”å¯åŠ¨å‘½ä»¤ï¼š</p>
<ul>
<li><strong>Windows</strong>ï¼šé€šè¿‡â€œæœåŠ¡â€ç®¡ç†å™¨æ‰¾åˆ°â€œMySQLâ€æœåŠ¡ï¼Œå³é”®ç‚¹å‡»â€œå¯åŠ¨â€ï¼›</li>
<li><strong>macOSï¼ˆHomebrewå®‰è£…ï¼‰</strong>ï¼šæ‰“å¼€ç»ˆç«¯æ‰§è¡Œ <code>brew services start mysql</code>ï¼›</li>
<li><strong>Linuxï¼ˆç³»ç»ŸæœåŠ¡ï¼Œä»¥Ubuntuä¸ºä¾‹ï¼‰</strong>ï¼šæ‰§è¡Œ <code>sudo systemctl start mysql</code>ï¼ˆå…¶ä»–å‘è¡Œç‰ˆæŒ‰å¯¹åº”å‘½ä»¤æ“ä½œï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-27">ï¼ˆ2ï¼‰æ‰‹åŠ¨åˆ›å»ºé¡¹ç›®æ•°æ®åº“</h5>
<p>é¡¹ç›®éœ€ä½¿ç”¨é¢„å…ˆåˆ›å»ºçš„ <code>lowcode_material</code> æ•°æ®åº“ï¼Œæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>æ‰“å¼€ç»ˆç«¯/å‘½ä»¤æç¤ºç¬¦ï¼Œç™»å½•MySQLï¼š
<pre><code class="hljs language-bash" lang="bash">mysql -u root -p  <span class="hljs-comment"># æ›¿æ¢rootä¸ºä½ çš„MySQLç”¨æˆ·åï¼Œå›è½¦åè¾“å…¥å¯†ç ï¼ˆæ— å¯†ç ç›´æ¥å›è½¦ï¼‰</span>
</code></pre>
</li>
<li>æ‰§è¡ŒSQLå‘½ä»¤åˆ›å»ºæ•°æ®åº“ï¼ˆæŒ‡å®šå­—ç¬¦é›†é¿å…ä¸­æ–‡ä¹±ç ï¼‰ï¼š
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> DATABASE IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> lowcode_material 
<span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb4 
<span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci;
</code></pre>
</li>
<li>ï¼ˆå¯é€‰ï¼‰éªŒè¯æ•°æ®åº“åˆ›å»ºæˆåŠŸï¼š
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SHOW</span> DATABASES;  # æ‰§è¡ŒåæŸ¥çœ‹è¾“å‡ºåˆ—è¡¨ï¼Œç¡®è®¤åŒ…å«lowcode_material
</code></pre>
</li>
<li>é€€å‡ºMySQLå‘½ä»¤è¡Œï¼š
<pre><code class="hljs language-sql" lang="sql">exit;
</code></pre>
</li>
</ol>
<h4 data-id="heading-28">3.2 å¯åŠ¨åç«¯æœåŠ¡</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¿›å…¥åç«¯ç›®å½•ï¼ˆè‹¥å½“å‰ä¸åœ¨è¯¥ç›®å½•ï¼‰</span>
<span class="hljs-built_in">cd</span> backend

<span class="hljs-comment"># å¯åŠ¨å¼€å‘ç¯å¢ƒæœåŠ¡ï¼ˆä½¿ç”¨é…ç½®çš„npmè„šæœ¬ï¼‰</span>
npm run serve
</code></pre>
<ul>
<li>å¯åŠ¨æˆåŠŸæ ‡è¯†ï¼šç»ˆç«¯æ˜¾ç¤ºæœåŠ¡ç›‘å¬ä¿¡æ¯ï¼ˆå¦‚ <code>åç«¯æœåŠ¡å¯åŠ¨æˆåŠŸï¼Œç«¯å£ï¼š3001</code>ï¼‰ï¼›</li>
<li>éªŒè¯æ¥å£å¯ç”¨æ€§ï¼šå¯é€šè¿‡æµè§ˆå™¨è®¿é—® <code>http://localhost:3001/api/material/docs</code>ï¼ŒæŸ¥çœ‹ç®€æ˜“æ¥å£æ–‡æ¡£ã€‚</li>
</ul>
<h4 data-id="heading-29">3.3 å¯åŠ¨å‰ç«¯æœåŠ¡</h4>
<p>éœ€æ–°å¼€ä¸€ä¸ªç»ˆç«¯ï¼ˆé¿å…ä¸åç«¯æœåŠ¡å†²çªï¼‰ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¿›å…¥å‰ç«¯ç›®å½•</span>
<span class="hljs-built_in">cd</span> frontend

<span class="hljs-comment"># å¯åŠ¨å¼€å‘ç¯å¢ƒï¼ˆæ”¯æŒçƒ­æ›´æ–°ï¼Œä¿®æ”¹ä»£ç åè‡ªåŠ¨åˆ·æ–°ï¼‰</span>
npm run dev
</code></pre>
<ul>
<li>å¯åŠ¨æˆåŠŸæ ‡è¯†ï¼šç»ˆç«¯è¾“å‡º <code>VITE v7.1.7 ready in 300 ms</code> åŠè®¿é—®åœ°å€ï¼›</li>
<li>è®¿é—®å‰ç«¯ï¼šæ‰“å¼€æµè§ˆå™¨è¾“å…¥é»˜è®¤åœ°å€ <code>http://localhost:8080</code>ï¼Œå³å¯è¿›å…¥ç‰©æ–™ç®¡ç†é¦–é¡µã€‚</li>
</ul>
<h3 data-id="heading-30">4. å¯åŠ¨å¸¸è§é—®é¢˜æ’æŸ¥</h3>
<ul>
<li><strong>MySQLè¿æ¥å¤±è´¥</strong>ï¼šæ£€æŸ¥ <code>.env</code> ä¸­æ•°æ®åº“é…ç½®ï¼ˆåœ°å€ã€ç«¯å£ã€ç”¨æˆ·åã€å¯†ç ï¼‰æ˜¯å¦ä¸æœ¬åœ°ç¯å¢ƒä¸€è‡´ï¼Œç¡®ä¿MySQLæœåŠ¡å·²å¯åŠ¨ï¼›</li>
<li><strong>LLMæ¥å£æŠ¥é”™</strong>ï¼šæ£€æŸ¥æ¨¡å‹é…ç½®ï¼ˆAPIå¯†é’¥ã€æ¥å£åœ°å€ã€æ¨¡å‹åç§°ï¼‰æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿æ¥å£å¯æ­£å¸¸è®¿é—®ä¸”æœ‰å‰©ä½™è°ƒç”¨é¢åº¦ã€‚</li>
</ul>
<h3 data-id="heading-31">å››ã€æ ¸å¿ƒä½¿ç”¨æµç¨‹</h3>
<ol>
<li>è®¿é—®å‰ç«¯åœ°å€ï¼ˆé»˜è®¤Â <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8080%2F" target="_blank" title="http://localhost:8080/" ref="nofollow noopener noreferrer">http://localhost:8080</a>ï¼‰ï¼Œè¿›å…¥ç‰©æ–™ç®¡ç†é¦–é¡µï¼›</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b0e2e6d07324be498cb956deb352aa5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763718186&amp;x-signature=LC0pkXe05hEjes3UL7%2BrigAtkO8%3D" alt="2.png" loading="lazy"/></p>
<ol start="2">
<li>
<p>é€‰æ‹©å¯¼å…¥æ–¹å¼ï¼ˆURL / NPM / æºç ï¼‰ï¼Œå¡«å†™å¯¹åº”ä¿¡æ¯ï¼ˆå¦‚ URL åœ°å€ã€NPM åŒ…åã€ä¸Šä¼ æºç æ–‡ä»¶ï¼‰ï¼›</p>
<ul>
<li><strong>URL å¯¼å…¥</strong>ï¼šè¾“å…¥URLåœ°å€å’ŒAPIè¡¨æ ¼CSSé€‰æ‹©å™¨ï¼›
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6a03c011c9f46a1b3014d3a78d26bd8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763718186&amp;x-signature=luqvKNeBxpSrNGW3Y7MJqlV4iOg%3D" alt="3.gif" loading="lazy"/></li>
<li><strong>NPM å¯¼å…¥</strong>ï¼šè¾“å…¥NPMåŒ…åå’Œç»„ä»¶åç§°ï¼›
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95a79e1f19a84de7a203958ebbd23f00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763718186&amp;x-signature=jpGWRvfTzBMAo19TWkoKpcQ5xP4%3D" alt="4.gif" loading="lazy"/></li>
<li><strong>æºç å¯¼å…¥</strong>ï¼šä¸Šä¼ æºç æ–‡ä»¶ï¼ˆæ”¯æŒå•ä¸ªæ–‡ä»¶æˆ–zipï¼‰ã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/577c0731b8b6452f81f558d259448ca6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763718186&amp;x-signature=wiqkUTjKMT9pdepuBTzoezlHeTs%3D" alt="5.gif" loading="lazy"/></li>
</ul>
</li>
<li>
<p>æäº¤åç­‰å¾…ä»»åŠ¡å¤„ç†ï¼Œå®æ—¶æŸ¥çœ‹è¿›åº¦æ¡ï¼ˆ0-100%ï¼‰ï¼Œè¿›åº¦æ¡æ”¯æŒæœ€å°åŒ–ï¼›</p>
</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5022535803f4caca5f72bd553944f82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763718186&amp;x-signature=VkqUc%2BunVwIUppn0ulMRwztL%2FSI%3D" alt="6.gif" loading="lazy"/></p>
<ol start="4">
<li>ä»»åŠ¡æˆåŠŸåï¼Œé¢„è§ˆç”Ÿæˆçš„ç‰©æ–™æ•°æ®ï¼ˆå±æ€§ / äº‹ä»¶ / æ’æ§½ï¼‰ï¼Œå¯ç›´æ¥ç¼–è¾‘ä¿®æ”¹æˆ–åˆ é™¤ï¼›</li>
</ol>
<ul>
<li>ç¼–è¾‘å±æ€§/äº‹ä»¶/æ’æ§½</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49b981635d66404f84730d14683dfb58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763718186&amp;x-signature=yzHVdvHyP5%2F8IbseV4QiAtMEQ%2B8%3D" alt="7.gif" loading="lazy"/></p>
<ul>
<li>åˆ é™¤å±æ€§/äº‹ä»¶/æ’æ§½</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0e4268aa09c41e797ad0abf5ca7602e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763718186&amp;x-signature=VyeoPFx%2FiWGZ%2F7DPnO8MBbLHzbA%3D" alt="8.gif" loading="lazy"/></p>
<ul>
<li>åˆ é™¤ç»„ä»¶ç‰©æ–™</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e77aa5abb44843cdaf07d880a1546d34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763718186&amp;x-signature=M4toKZm2vhEN8RML1%2Fpkthzd%2Bhs%3D" alt="9.gif" loading="lazy"/></p>
<ol start="5">
<li>ç‚¹å‡» â€œä¿å­˜åˆ°ç‰©æ–™åº“â€ï¼Œå°†ç‰©æ–™åŒæ­¥è‡³ MySQL æ•°æ®åº“ï¼›</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5829c93097643e79aebb7e8b9508bb3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763718186&amp;x-signature=pr372PfrHpBiVbd3fbb%2FA8HEJz8%3D" alt="10.gif" loading="lazy"/></p>
<ol start="6">
<li>åœ¨é¦–é¡µé€šè¿‡ç­›é€‰ã€æœç´¢åŠŸèƒ½ç®¡ç†å·²ä¿å­˜çš„ç‰©æ–™ï¼Œæ”¯æŒæ‰¹é‡å¯¼å‡ºæˆ–åˆ é™¤ã€‚</li>
</ol>
<ul>
<li>é€šè¿‡ç»„ä»¶åç§°ç­›é€‰ç»„ä»¶ç‰©æ–™</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86019bdd78eb4a03b9571ea9c54077c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763718186&amp;x-signature=aHDAIUG5uCSWXEEgoim6Yr3DvTA%3D" alt="11.gif" loading="lazy"/></p>
<ul>
<li>é€šè¿‡å…³é”®è¯ç­›é€‰ç»„ä»¶ç‰©æ–™</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a18c20622434b8e9a0e94a2c8523d7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763718186&amp;x-signature=YB%2Fm8HSpVJuVjeqvJuPi9DiRC48%3D" alt="12.gif" loading="lazy"/></p>
<ul>
<li>æ‰¹é‡åˆ é™¤ç»„ä»¶ç‰©æ–™</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4662a72b1674fd5a9b4be4d2ba16235~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763718186&amp;x-signature=JeJ3YvwxneQ2smBslCFqFiKwtdk%3D" alt="13.gif" loading="lazy"/></p>
<ul>
<li>æ‰¹é‡å¯¼å‡ºç»„ä»¶ç‰©æ–™</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e15b7249246440ef9ea73a8f439ee63e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763718186&amp;x-signature=nq59kheuy0PErWFVXy31gNiJI7s%3D" alt="14.gif" loading="lazy"/></p>
<p>å¯¼å‡ºæ–‡ä»¶å¦‚ä¸‹ï¼ˆä»¥element-plusçš„Breadcrumbä¸ºä¾‹ï¼‰ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">[</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"npm"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"package"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"element-plus"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"exportName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ElBreadcrumb"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"icon"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"breadcrumb"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"zh_CN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"é¢åŒ…å±‘"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"tags"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"å¯¼èˆª"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"é¢åŒ…å±‘"</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"group"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"element-plus"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"schema"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"slots"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"default"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"label"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"zh_CN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"é»˜è®¤å†…å®¹"</span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"zh_CN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"è‡ªå®šä¹‰é»˜è®¤å†…å®¹"</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"events"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"label"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"zh_CN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"åŸºç¡€å±æ€§"</span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
            <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"cols"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">12</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ArrayItemConfigurator-test"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"label"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                  <span class="hljs-attr">"zh_CN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"åˆ†éš”ç¬¦"</span>
                <span class="hljs-punctuation">}</span>
              <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"widget"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"props"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                  <span class="hljs-attr">"placeholder"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"è¯·è¾“å…¥åˆ†éš”ç¬¦"</span>
                <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"component"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"InputConfigurator"</span>
              <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"disabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"property"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"separator"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"readOnly"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"required"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"zh_CN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"åˆ†éš”ç¬¦"</span>
              <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"defaultValue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"labelPosition"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"left"</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"cols"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">12</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"unknown"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"label"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                  <span class="hljs-attr">"zh_CN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å›¾æ ‡åˆ†éš”ç¬¦"</span>
                <span class="hljs-punctuation">}</span>
              <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"widget"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"props"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                  <span class="hljs-attr">"placeholder"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"è¯·è¾“å…¥å›¾æ ‡åç§°"</span>
                <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"component"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"InputConfigurator"</span>
              <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"disabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"property"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"separatorIcon"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"readOnly"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"required"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å›¾æ ‡åˆ†éš”ç¬¦ç»„ä»¶"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"defaultValue"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"labelPosition"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"left"</span>
            <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"zh_CN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ç»„ä»¶æ ¸å¿ƒåŠŸèƒ½ç›¸å…³çš„é…ç½®ï¼ŒåŒ…æ‹¬ separatorã€ separatorIcon ç­‰æ ¸å¿ƒå±æ€§"</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"devMode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"proCode"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"doc_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"element-plus"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"keywords"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"Breadcrumb"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"é¢åŒ…å±‘"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"å¯¼èˆª"</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"snippets"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"icon"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"breadcrumb"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"zh_CN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"é¢åŒ…å±‘"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"schema"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
            <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"props"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"to"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/home"</span>
              <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                <span class="hljs-punctuation">{</span>
                  <span class="hljs-attr">"props"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                    <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"é¦–é¡µ"</span>
                  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                  <span class="hljs-attr">"componentName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Text"</span>
                <span class="hljs-punctuation">}</span>
              <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"componentName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ElBreadcrumbItem"</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"props"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"to"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/list"</span>
              <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                <span class="hljs-punctuation">{</span>
                  <span class="hljs-attr">"props"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                    <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"åˆ—è¡¨é¡µ"</span>
                  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                  <span class="hljs-attr">"componentName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Text"</span>
                <span class="hljs-punctuation">}</span>
              <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"componentName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ElBreadcrumbItem"</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"props"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                <span class="hljs-punctuation">{</span>
                  <span class="hljs-attr">"props"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                    <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"è¯¦æƒ…é¡µ"</span>
                  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                  <span class="hljs-attr">"componentName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Text"</span>
                <span class="hljs-punctuation">}</span>
              <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"componentName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ElBreadcrumbItem"</span>
            <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"element-plus"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"screenshot"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"snippetName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ElBreadcrumb"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"component"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ElBreadcrumb"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"configure"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"loop"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"styles"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"isModal"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"isLayout"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"isPopper"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"condition"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"framework"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Vue"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"shortcuts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-string">"separator"</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"isNullNode"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"contextMenu"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"actions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-string">"copy"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-string">"remove"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-string">"insert"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-string">"updateAttr"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-string">"bindEvent"</span>
        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"disable"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"isContainer"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"nestingRule"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"childWhitelist"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ElBreadcrumbItem"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"parentWhitelist"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"ancestorWhitelist"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"descendantBlacklist"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"clickCapture"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"rootSelector"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"é¢åŒ…å±‘å¯¼èˆªç»„ä»¶ï¼Œç”¨äºæ˜¾ç¤ºå½“å‰é¡µé¢åœ¨ç³»ç»Ÿå±‚çº§ ç»“æ„ä¸­çš„ä½ç½®"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">]</span>
</code></pre>
<h2 data-id="heading-32">æ€»ç»“</h2>
<p>TinyEngine ä½ä»£ç ç‰©æ–™è‡ªåŠ¨å¯¼å…¥å·¥å…·çš„æ ¸å¿ƒç›®æ ‡ï¼Œæ˜¯é€šè¿‡ã€Œè‡ªåŠ¨åŒ–è§£æ + å¯è§†åŒ–æ“ä½œã€çš„é—­ç¯è®¾è®¡ï¼Œè§£å†³äº†ä½ä»£ç ç‰©æ–™æ¥å…¥çš„æ•ˆç‡ç“¶é¢ˆä¸å…¼å®¹æ€§éš¾é¢˜ã€‚æ— è®ºæ˜¯ URL çˆ¬å–ã€NPM è§£æè¿˜æ˜¯æºç ä¸Šä¼ ï¼Œå·¥å…·éƒ½åŠ›æ±‚ç®€åŒ–å…¨æµç¨‹æ“ä½œï¼Œè®©å¼€å‘è€…æ— éœ€å…³æ³¨åº•å±‚åè®®ç»†èŠ‚ä¸æ ¼å¼è½¬æ¢é€»è¾‘ï¼Œå³å¯å¿«é€Ÿå°†å„ç±» UI ç»„ä»¶æ— ç¼è½¬åŒ–ä¸ºç¬¦åˆ TinyEngine æ ‡å‡†çš„å¯ç”¨ç‰©æ–™ï¼Œè®©ä½ä»£ç ç‰©æ–™æ¥å…¥ä»ç¹ççš„æ‰‹åŠ¨é…ç½®ï¼Œè½¬å˜ä¸ºé«˜æ•ˆã€çœå¿ƒçš„ä¸€ç«™å¼æ“ä½œã€‚</p>
<h2 data-id="heading-33">å…³äºOpenTiny</h2>
<p>æ¬¢è¿åŠ å…¥ OpenTiny å¼€æºç¤¾åŒºã€‚æ·»åŠ å¾®ä¿¡å°åŠ©æ‰‹ï¼šopentiny-official ä¸€èµ·å‚ä¸äº¤æµå‰ç«¯æŠ€æœ¯ï½</p>
<p>OpenTiny å®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.design" target="_blank" title="https://opentiny.design" ref="nofollow noopener noreferrer">opentiny.design</a><br/>
OpenTiny ä»£ç ä»“åº“ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny" target="_blank" title="https://github.com/opentiny" ref="nofollow noopener noreferrer">github.com/opentiny</a><br/>
TinyVue æºç ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-vue" target="_blank" title="https://github.com/opentiny/tiny-vue" ref="nofollow noopener noreferrer">github.com/opentiny/tiâ€¦</a><br/>
TinyEngine æºç ï¼šâ€…<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine" target="_blank" title="https://github.com/opentiny/tiny-engine" ref="nofollow noopener noreferrer">github.com/opentiny/tiâ€¦</a><br/>
æ¬¢è¿è¿›å…¥ä»£ç ä»“åº“ StarğŸŒŸTinyEngineã€TinyVueã€TinyNGã€TinyCLIã€TinyEditor~ å¦‚æœä½ ä¹Ÿæƒ³è¦å…±å»ºï¼Œå¯ä»¥è¿›å…¥ä»£ç ä»“åº“ï¼Œæ‰¾åˆ° good first issue æ ‡ç­¾ï¼Œä¸€èµ·å‚ä¸å¼€æºè´¡çŒ®~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis RedisTimeSeries åœ¨springbootä¸­çš„åº”ç”¨]]></title>    <link>https://juejin.cn/post/7572157115906703410</link>    <guid>https://juejin.cn/post/7572157115906703410</guid>    <pubDate>2025-11-14T03:05:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572157115906703410" data-draft-id="7572132100361060398" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis RedisTimeSeries åœ¨springbootä¸­çš„åº”ç”¨"/> <meta itemprop="keywords" content="Redis,åç«¯,Spring Boot"/> <meta itemprop="datePublished" content="2025-11-14T03:05:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å”å°ç "/> <meta itemprop="url" content="https://juejin.cn/user/4055468706891367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis RedisTimeSeries åœ¨springbootä¸­çš„åº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4055468706891367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å”å°ç 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T03:05:17.000Z" title="Fri Nov 14 2025 03:05:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">åœºæ™¯</h2>
<p>æˆ‘ä»¬ç°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œä½¿ç”¨å›½äº§çš„Gbaseæ•°æ®åº“ï¼Œæœ‰ä¸ªåˆ†é’Ÿè¡¨çš„æ•°æ®ï¼Œå¤§æ¦‚æœ‰20ä¸ªå­—æ®µï¼Œå­˜å‚¨çš„çš„ç«™ç‚¹å¤§æ¦‚æ˜¯4000å¤šä¸ªï¼Œå¤§æ¦‚ç®—ä¸‹æ•°æ®é‡</p>
<p>æ¯å°æ—¶ï¼š4000*60=240000</p>
<p>æ¯å¤©ï¼š40000* 60 * 24=5760000</p>
<p>ä½†æ˜¯æˆ‘ä»¬å®é™…ä¸Šç”¨çš„æœ€é¢‘ç¹çš„æ˜¯æ—¶é—´å­—æ®µå’Œä¸€ä¸ªè¦ç´ å­—æ®µï¼Œæ—¶é—´å­—æ®µå·²ç»åŠ äº†ç´¢å¼•ï¼Œè¦ç´ å­—æ®µæ•°æ®æ˜¯ä¸Šæ¥çš„ç›‘æµ‹æ•°æ®ã€‚å¯¹æ­¤å­—æ®µçš„è¯·æ±‚é¢‘ç‡æ˜¯æœ€é«˜çš„ï¼Œç›®å‰å“åº”æ—¶é—´è¿‡é•¿ï¼Œä¸¥é‡å½±å“åˆ°ç”¨æˆ·ä½“éªŒæ„Ÿ ï¼Œç°éœ€è¦è¿›è¡Œå¯¹å…¶ä¼˜åŒ–ï¼Œè€ƒè™‘åˆ°åº“çš„ç»´æŠ¤ç”±ç”¨æˆ·è´Ÿè´£ï¼Œæˆ‘ä»¬åªæœ‰æŸ¥è¯¢æƒé™ã€‚æå‡ºå¦‚ä¸‹å‡ ç§æ–¹å¼</p>
<p>1ã€åˆ†åº“åˆ†è¡¨</p>
<p>2ã€å›½äº§æ—¶åºåº“<strong>TDengine</strong>è¿›è¡Œæ›¿ä»£</p>
<p>3ã€å†å²æ•°æ®å’Œæœ€æ–°æ•°æ®åˆ†å¼€å­˜å‚¨</p>
<p>4ã€ä½¿ç”¨Redisç¼“å­˜</p>
<p>5ã€å¤§æ•°æ®æ–¹æ¡ˆ</p>
<p>è€ƒè™‘åˆ°ç”¨æˆ·å•ä½çš„ç‰¹æ®Šæ€§ï¼Œç¬¬ä¸€è¦æ»¡è¶³å›½äº§è¦æ±‚ï¼Œç¬¬äºŒæ˜¯æ•°æ®åº“æ˜¯æŒ‡å®šä¸“ç”¨ï¼Œç¬¬ä¸‰æ•°æ®åº“ç»´æŠ¤ä¸åœ¨æˆ‘ä»¬è¿™é‡Œã€‚æœ€ç»ˆå†³å®šä½¿ç”¨Redisçš„TSæ¥è§£å†³ã€‚</p>
<p>ä¸»è¦å®ç°é€»è¾‘ï¼šredisä¸­ç¼“å­˜æœ€è¿‘3å°æ—¶å†…çš„æ‰€æœ‰æœ‰æ•ˆæ•°æ®ï¼Œæ³¨æ„æ˜¯æœ‰æ•ˆæ•°æ®ï¼Œæ¯”å¦‚æŸä¸ªç«™ç‚¹çš„æ•°æ®ç¼ºæµ‹æˆ–è€…æ˜¯ä¸€ç›´æ²¡æ•°æ®ï¼Œåˆ™ä¸è¿›è¡Œç¼“å­˜ï¼Œå…¶å®å¾ˆå¤šæ—¶å€™éƒ½æ˜¯æ²¡æ•°æ®çš„ï¼Œé™¤éåˆ°é›¨å­£ï¼Œè¿™æ ·ä¸‹æ¥redisç¼“å­˜çš„æ•°æ®ä¼šå°‘å¾ˆå¤šã€‚</p>
<p>æ•°æ®ç”±ç”¨æˆ·åŒæ­¥åˆ°RedisæœåŠ¡ï¼Œæˆ‘ä»¬è¿›è¡ŒæŸ¥è¯¢ï¼Œæ‰€ä»¥æœ¬æ–‡å›´ç»•ä½¿ç”¨æ¥å†™</p>
<p>å¦‚æœæ‚¨æœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œä¸å¦¨äº¤æµä¸€ä¸‹ï¼Œéå¸¸æ„Ÿè°¢æ‚¨æŒ‡å¯¼ã€‚</p>
<h2 data-id="heading-1">Redis-TS</h2>
<h3 data-id="heading-2">äº†è§£</h3>
<p>RedisTimeSeries æ˜¯ä¸€ä¸ª Redis æ¨¡å—ï¼Œç”¨äºå­˜å‚¨ã€æŸ¥è¯¢å’Œç®¡ç†æ—¶é—´åºåˆ—æ•°æ®ã€‚ä¸ä¼ ç»Ÿçš„æ—¶é—´åºåˆ—æ•°æ®åº“ç›¸æ¯”ï¼Œå®ƒçš„ä¼˜åŠ¿åœ¨äºæä½çš„å»¶è¿Ÿå’Œä¸ Redis ç”Ÿæ€çš„æ— ç¼é›†æˆã€‚</p>
<p><strong>æ ¸å¿ƒæ¦‚å¿µï¼š</strong></p>
<ul>
<li><strong>æ—¶é—´åºåˆ—</strong>ï¼šä¸€ä¸ªç”±æ—¶é—´æˆ³å’Œå€¼ç»„æˆçš„æ•°æ®ç‚¹åºåˆ—ã€‚</li>
<li><strong>æ ‡ç­¾</strong>ï¼šå¯ä»¥ä¸ºæ¯ä¸ªæ—¶é—´åºåˆ—è®¾ç½®å¤šä¸ªæ ‡ç­¾ï¼ˆå¦‚ <code>station_id=52889</code>, <code>element=V12001</code>ï¼‰ï¼Œä»è€Œå®ç°é«˜æ•ˆçš„ç­›é€‰å’Œåˆ†ç»„æŸ¥è¯¢ã€‚</li>
</ul>
<h3 data-id="heading-3">1ã€æœ¬åœ°å®‰è£…</h3>
<p>è¿™é‡Œæˆ‘ä»¬å®‰è£…æœ€æ–°ç‰ˆçš„ï¼Œé»˜è®¤è‡ªå¸¦äº†TSæ¨¡å—ï¼Œæ¨èä½¿ç”¨Linuxç¯å¢ƒ,ä½ ä¼šçœå»å¾ˆå¤šéº»çƒ¦</p>
<pre><code class="hljs language-xml" lang="xml"> docker run -d \
  --privileged=true \
  -p 6380:6379 \
  --restart always \
  -v /data/redis/redis.conf:/etc/redis/redis.conf \
  -v /data/redis/data:/data \
  --name myredis \
  redis \
  redis-server /etc/redis/redis.conf --appendonly yes
</code></pre>
<p>å¯ä»¥æŠŠç”¨æˆ·ä¾§æ•°æ®çš„rdbæ–‡ä»¶ç›´æ¥æ‹·è´è¿‡æ¥ï¼Œæ•°æ®å°±åˆ°æœ¬åœ°äº†</p>
<h3 data-id="heading-4">2ã€ä½¿ç”¨</h3>
<p>æˆ‘ç”¨çš„springbootæ¡†æ¶ä¸º2.7.18ï¼Œç½‘ä¸Šæ‰¾äº†ä¸€åœˆï¼Œæ²¡æ‰¾åˆ°æ¯”è¾ƒå¥½ç”¨çš„å…³äºTSå°è£…çš„ç»„ä»¶</p>
<p>å®˜ç½‘ä¸Šæœ‰è¯¦ç»†çš„å‘½ä»¤ä½¿ç”¨æ–¹å¼ï¼Œè¿™é‡Œä¸åœ¨èµ˜è¿° <a href="https://link.juejin.cn?target=https%3A%2F%2Fredis.ac.cn%2Fdocs%2Flatest%2Fcommands%2F%3Fgroup%3Dtimeseries" target="_blank" title="https://redis.ac.cn/docs/latest/commands/?group=timeseries" ref="nofollow noopener noreferrer">redis.ac.cn/docs/latestâ€¦</a></p>
<p>æœ¬æ¬¡ä½¿ç”¨åˆ°å‡ ä¸ªå‘½ä»¤</p>
<p><strong>1ã€è·å–æœ€æ–°æ•°æ® ï¼ˆTS.MGETï¼‰</strong></p>
<p><strong>2ã€æ­£å¸¸æŸ¥è¯¢æŸä¸ªæ—¶é—´æ®µæ•°æ® ï¼ˆTS.MRANGEï¼‰</strong></p>
<p><strong>3ã€ç®¡é“æ–¹å¼æŸ¥è¯¢ï¼ˆTS.RANGEï¼‰</strong></p>
<p>ç®¡é“å’Œluaè„šæœ¬çš„åŒºåˆ«å¯¹æ¯”ï¼Œé‰´äºå¯¹æ¯”ï¼Œæ‰€ä»¥é€‰æ‹©äº†ç®¡é“æ–¹å¼æ‰§è¡Œ</p>








































<table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">ç®¡é“</th><th align="left">Lua è„šæœ¬</th></tr></thead><tbody><tr><td align="left"><strong>æ ¸å¿ƒç›®æ ‡</strong></td><td align="left"><strong>æå‡ååé‡</strong>ï¼Œå‡å°‘ç½‘ç»œå»¶è¿Ÿ</td><td align="left"><strong>ä¿è¯åŸå­æ€§</strong>ï¼Œå®ç°å¤æ‚é€»è¾‘</td></tr><tr><td align="left"><strong>åŸå­æ€§</strong></td><td align="left"><strong>ä¸ä¿è¯</strong>ã€‚ç®¡é“ä¸­çš„å‘½ä»¤å¯èƒ½ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯çš„å‘½ä»¤æ’å…¥ã€‚</td><td align="left"><strong>ä¿è¯</strong>ã€‚è„šæœ¬åœ¨æ‰§è¡ŒæœŸé—´ï¼ŒRedisæœåŠ¡å™¨ä¸ä¼šå¤„ç†å…¶ä»–å‘½ä»¤ï¼Œç›¸å½“äºâ€œæ•°æ®åº“äº‹åŠ¡â€ã€‚</td></tr><tr><td align="left"><strong>é€»è¾‘èƒ½åŠ›</strong></td><td align="left">æ— ã€‚åªæ˜¯ä¸€æ‰¹å‘½ä»¤çš„ç®€å•æ‰“åŒ…ï¼Œå‘½ä»¤ä¹‹é—´æ— æ³•ç›¸äº’å½±å“ã€‚</td><td align="left"><strong>å¼ºå¤§</strong>ã€‚å¯ä»¥ä½¿ç”¨å˜é‡ã€æ¡ä»¶åˆ¤æ–­ã€å¾ªç¯ç­‰ç¼–ç¨‹ç»“æ„ï¼Œå‰ä¸€ä¸ªå‘½ä»¤çš„ç»“æœå¯ä»¥ç›´æ¥ç”¨äºä¸‹ä¸€ä¸ªå‘½ä»¤ã€‚</td></tr><tr><td align="left"><strong>æ€§èƒ½ä¼˜åŠ¿</strong></td><td align="left"><strong>æé«˜</strong>ã€‚å°†å¤šä¸ªç½‘ç»œå¾€è¿”å‹ç¼©ä¸ºä¸€æ¬¡ï¼Œæå¤§æå‡æ‰¹é‡æ“ä½œçš„ååé‡ã€‚</td><td align="left"><strong>é«˜</strong>ã€‚è™½ç„¶ä¹Ÿéœ€è¦ä¸€æ¬¡ç½‘ç»œå¾€è¿”ï¼Œä½†é¿å…äº†å¤šæ¬¡ç½‘ç»œå»¶è¿Ÿã€‚å…¶ä¼˜åŠ¿æ›´å¤šä½“ç°åœ¨åŸå­æ€§ä¸Šï¼Œè€Œéçº¯ç²¹çš„ååé‡ã€‚</td></tr><tr><td align="left"><strong>é”™è¯¯å¤„ç†</strong></td><td align="left">ç®¡é“ä¸­æŸä¸ªå‘½ä»¤å¤±è´¥ï¼Œ<strong>ä¸ä¼šå½±å“</strong>å…¶ä»–å‘½ä»¤çš„æ‰§è¡Œã€‚</td><td align="left">è„šæœ¬ä¸­å¦‚æœå‡ºç°é”™è¯¯ï¼Œæ•´ä¸ªè„šæœ¬éƒ½ä¼š<strong>å›æ»š</strong>ï¼Œæ‰€æœ‰ä¿®æ”¹éƒ½ä¸ä¼šç”Ÿæ•ˆã€‚</td></tr><tr><td align="left"><strong>ä½¿ç”¨åœºæ™¯</strong></td><td align="left">- æ‰¹é‡å†™å…¥æ•°æ® - æ‰¹é‡è¯»å–ä¸ç›¸å…³çš„æ•°æ® - æ›´æ–°å¤§é‡è®¡æ•°å™¨</td><td align="left">- éœ€è¦åŸå­æ€§çš„æ“ä½œï¼ˆå¦‚ï¼šç§’æ€æ‰£åº“å­˜ã€è½¬è´¦ï¼‰ - å‰åå‘½ä»¤æœ‰ä¾èµ–ï¼ˆå¦‚ï¼šå…ˆæ£€æŸ¥å†è®¾ç½®ï¼‰ - å®ç°å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚ï¼šè®¡ç®—æ»‘åŠ¨çª—å£å¹³å‡å€¼ï¼‰</td></tr></tbody></table>
<p><strong>4ã€æ•°æ®ç»Ÿè®¡</strong></p>
<p>å•ç«™ç‚¹ï¼Œå•è¦ç´ ä½¿ç”¨ï¼šTS.RANGEï¼Œå¤šç«™ç‚¹å¤šè¦ç´ ä½¿ç”¨TS.MRANGE</p>
<p><strong>5ã€çª—å£ç»Ÿè®¡ï¼ˆTS.MRANGEï¼‰</strong></p>
<p>æ³¨æ„ï¼šæ­¤ç‰ˆæœ¬çš„RedisTemplatedçš„executeæ–¹æ³•æ˜¯æ²¡åŠæ³•ç›´æ¥æ‰§è¡ŒTSçš„å‘½ä»¤çš„ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨Lettuceä¸­çš„æ–¹æ³•æ¥æ‰§è¡Œ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.dfec.api.util;

<span class="hljs-keyword">import</span> com.alibaba.fastjson2.JSON;
<span class="hljs-keyword">import</span> com.dfec.api.constant.ApiConstant;
<span class="hljs-keyword">import</span> com.dfec.api.entity.TsResult;
<span class="hljs-keyword">import</span> com.dfec.api.entity.cache.StatParam;
<span class="hljs-keyword">import</span> com.dfec.common.bean.constant.RetCode;
<span class="hljs-keyword">import</span> com.dfec.common.bean.exception.OuterException;
<span class="hljs-keyword">import</span> io.lettuce.core.RedisFuture;
<span class="hljs-keyword">import</span> io.lettuce.core.cluster.api.async.RedisClusterAsyncCommands;
<span class="hljs-keyword">import</span> io.lettuce.core.codec.ByteArrayCodec;
<span class="hljs-keyword">import</span> io.lettuce.core.codec.StringCodec;
<span class="hljs-keyword">import</span> io.lettuce.core.internal.Exceptions;
<span class="hljs-keyword">import</span> io.lettuce.core.output.ObjectOutput;
<span class="hljs-keyword">import</span> io.lettuce.core.protocol.CommandArgs;
<span class="hljs-keyword">import</span> io.lettuce.core.protocol.ProtocolKeyword;
<span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;
<span class="hljs-keyword">import</span> org.springframework.data.redis.connection.lettuce.LettuceConnection;
<span class="hljs-keyword">import</span> org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory;
<span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisConnectionUtils;
<span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;
<span class="hljs-keyword">import</span> org.springframework.data.redis.core.script.DefaultRedisScript;
<span class="hljs-keyword">import</span> org.springframework.data.redis.core.script.RedisScript;
<span class="hljs-keyword">import</span> org.springframework.data.redis.serializer.JdkSerializationRedisSerializer;
<span class="hljs-keyword">import</span> org.springframework.data.redis.serializer.RedisSerializer;
<span class="hljs-keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> javax.annotation.Resource;
<span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;
<span class="hljs-keyword">import</span> java.util.*;
<span class="hljs-keyword">import</span> java.util.concurrent.ExecutionException;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;
<span class="hljs-keyword">import</span> java.util.stream.Collectors;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> com.dfec.api.util.DateUtil.dateStrArrToLongArr;

<span class="hljs-comment">/**
 * Redis TSæ“ä½œå·¥å…·ç±»
 *
 * <span class="hljs-doctag">@author</span> tangrg
 * <span class="hljs-doctag">@email</span> 1446232546@qq.com
 * <span class="hljs-doctag">@date</span> 2025-10-2025/10/13 09:39:46
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisUtil</span> {

    LettuceConnection connection;

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> LettuceConnectionFactory lettuceConnectionFactory;

    <span class="hljs-comment">/**
     * å°† Redis TS.MRANGE è¿”å›çš„ Map&lt;String, List&lt;Object&gt;&gt;ï¼ˆkey=seriesName, value=List&lt;[ts, val]&gt;ï¼‰
     * è½¬æ¢ä¸º Map&lt;String, List&lt;TsResult&gt;&gt;ï¼Œé€‚é…ä½ å½“å‰çš„ TsResult ç±»ï¼ˆå« key: LocalDateTimeï¼‰
     *
     * <span class="hljs-doctag">@param</span> rawData åŸå§‹è¿”å›æ•°æ®ï¼Œæ ¼å¼ä¸º Map&lt;String, List&lt;Object&gt;&gt;ï¼Œå…¶ä¸­ value æ˜¯ List&lt;[ts, val]&gt;
     * <span class="hljs-doctag">@return</span> Map&lt;String, List&lt;TsResult&gt;&gt;
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;String, List&lt;TsResult&gt;&gt; <span class="hljs-title function_">convertToTsResultMap</span><span class="hljs-params">(Map&lt;String, List&lt;Object&gt;&gt; rawData)</span> {
        Map&lt;String, List&lt;TsResult&gt;&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

        <span class="hljs-keyword">if</span> (rawData == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> result;
        }

        <span class="hljs-keyword">for</span> (Map.Entry&lt;String, List&lt;Object&gt;&gt; entry : rawData.entrySet()) {
            <span class="hljs-type">String</span> <span class="hljs-variable">seriesKey</span> <span class="hljs-operator">=</span> entry.getKey();  <span class="hljs-comment">// å¦‚ "pm:ts:52889:V12001"</span>
            List&lt;Object&gt; dataPoints = entry.getValue();  <span class="hljs-comment">// List&lt;Object&gt;ï¼Œæ¯ä¸ªæ˜¯ [ts, val]</span>

            List&lt;TsResult&gt; tsResults = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

            <span class="hljs-keyword">for</span> (Object dp : dataPoints) {
                <span class="hljs-keyword">if</span> (!(dp <span class="hljs-keyword">instanceof</span> List)) {
                    <span class="hljs-keyword">continue</span>;
                }

                List&lt;Object&gt; point = (List&lt;Object&gt;) dp;
                <span class="hljs-keyword">if</span> (point.size() == <span class="hljs-number">2</span> &amp;&amp; !(point.get(<span class="hljs-number">0</span>) <span class="hljs-keyword">instanceof</span> List)) {
                    dealResult(point, tsResults);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">try</span> {
                        point.forEach(item1 -&gt; {
                            <span class="hljs-keyword">if</span> (item1 <span class="hljs-keyword">instanceof</span> List) {
                                <span class="hljs-type">List</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> (List) item1;
                                dealResult(item, tsResults);
                            }
                        });
                    } <span class="hljs-keyword">catch</span> (Exception e) {
                        <span class="hljs-comment">// ç±»å‹è½¬æ¢å¼‚å¸¸ï¼Œè·³è¿‡è¯¥ç‚¹</span>
                        <span class="hljs-keyword">continue</span>;
                    }
                }
            }

            result.put(seriesKey, tsResults);
        }

        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dealResult</span><span class="hljs-params">(List&lt;Object&gt; point, List&lt;TsResult&gt; tsResults)</span> {
        <span class="hljs-type">TsResult</span> <span class="hljs-variable">tsResult</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TsResult</span>();
        tsResult.setTime((Long) point.get(<span class="hljs-number">0</span>));
        tsResult.setKey(DateUtil.longToLocalDateTime((Long) point.get(<span class="hljs-number">0</span>)));
        tsResult.setVal((Double) point.get(<span class="hljs-number">1</span>));
        tsResults.add(tsResult);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">awaitAll</span><span class="hljs-params">(<span class="hljs-type">long</span> timeout, TimeUnit unit, java.util.concurrent.Future&lt;?&gt;... futures)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">long</span> <span class="hljs-variable">nanos</span> <span class="hljs-operator">=</span> unit.toNanos(timeout);
            <span class="hljs-type">long</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> System.nanoTime();

            <span class="hljs-keyword">for</span> (java.util.concurrent.Future&lt;?&gt; f : futures) {
                <span class="hljs-keyword">if</span> (timeout &lt;= <span class="hljs-number">0L</span>) {
                    f.get();
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">if</span> (nanos &lt; <span class="hljs-number">0L</span>) {
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                    }
                    <span class="hljs-keyword">try</span> {
                        f.get(nanos, TimeUnit.NANOSECONDS);
                    } <span class="hljs-keyword">catch</span> (Exception e) {
<span class="hljs-comment">//                        e.printStackTrace();</span>
<span class="hljs-comment">//                        System.out.println("ç»“æœå€¼ä¸å­˜åœ¨");</span>
                    }

                    <span class="hljs-type">long</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> System.nanoTime();
                    nanos -= now - time;
                    time = now;
                }
            }

            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> Exceptions.fromSynchronization(e);
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;<span class="hljs-type">byte</span>[]&gt; buildArgsFilterMap(Map&lt;String, Object&gt; filterMap) {
        List&lt;<span class="hljs-type">byte</span>[]&gt; args = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">if</span>(filterMap.containsKey(ApiConstant.FILTER_BY_VALUE)){
            args.add(ApiConstant.FILTER_BY_VALUE.getBytes());
            <span class="hljs-type">byte</span>[] bytes = filterMap.get(ApiConstant.FILTER_BY_VALUE).toString().getBytes();
            args.add(bytes);
            filterMap.remove(ApiConstant.FILTER_BY_VALUE);
        }
        <span class="hljs-keyword">if</span> (filterMap != <span class="hljs-literal">null</span> &amp;&amp; !filterMap.isEmpty()) {
            args.add(<span class="hljs-string">"FILTER"</span>.getBytes());
            filterMap.forEach((key, value) -&gt; {
                <span class="hljs-type">String</span> <span class="hljs-variable">param</span> <span class="hljs-operator">=</span> key + <span class="hljs-string">"="</span> + value;
                args.add(param.getBytes());
            });

        }
        <span class="hljs-keyword">return</span> args;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getBucketSizeMs</span><span class="hljs-params">(Long from, Long to, Integer windowSize, String dateType)</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">bucketSizeMs</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (windowSize == <span class="hljs-literal">null</span>) {
            bucketSizeMs = to - from;
        } <span class="hljs-keyword">else</span> {
            bucketSizeMs = windowSize * getAdjTime(dateType);
        }
        <span class="hljs-keyword">return</span> bucketSizeMs;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Long <span class="hljs-title function_">getAdjTime</span><span class="hljs-params">(String dateType)</span> {
        <span class="hljs-keyword">switch</span> (dateType) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"MIN"</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-number">60</span> * <span class="hljs-number">1000L</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"HOUR"</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000L</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"DAY"</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000L</span>;
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-number">0L</span>;
        }
    }

    <span class="hljs-comment">/**
     * æŸ¥è¯¢æŸä¸ªæ—¶é—´èŒƒå›´å†…çš„æ—¶é—´åºåˆ—æ•°æ®
     *
     * <span class="hljs-doctag">@param</span> key  æ—¶é—´åºåˆ—çš„ keyï¼Œæ¯”å¦‚ "mytimeseries"
     * <span class="hljs-doctag">@param</span> from å¼€å§‹æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼Œæ¯”å¦‚ 1712345600000ï¼‰
     * <span class="hljs-doctag">@param</span> to   ç»“æŸæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼Œæ¯”å¦‚ 1712345720000ï¼‰
     * <span class="hljs-doctag">@return</span> åŸå§‹è¿”å›ç»“æœï¼Œæ˜¯ä¸€ä¸ª List&lt;Object&gt;ï¼Œæ¯ä¸¤ä¸ªå…ƒç´ ä»£è¡¨ [timestamp, value]
     */</span>
    <span class="hljs-keyword">public</span> List&lt;TsResult&gt; <span class="hljs-title function_">queryTimeRange</span><span class="hljs-params">(String key, <span class="hljs-type">long</span> from, <span class="hljs-type">long</span> to, Map&lt;String, Object&gt; filterMap,String dataCode)</span> {
        <span class="hljs-type">byte</span>[][] args = buildTsRangeArgs(key, from, to, filterMap);

        <span class="hljs-type">LettuceConnection</span> <span class="hljs-variable">connection1</span> <span class="hljs-operator">=</span> getLettuceConnection();
        <span class="hljs-type">ObjectOutput</span> <span class="hljs-variable">keyValueListOutput</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutput</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringCodec</span>());
        List&lt;List&lt;Object&gt;&gt; execute = (List&lt;List&lt;Object&gt;&gt;) connection1.execute(<span class="hljs-string">"TS.RANGE"</span>, keyValueListOutput, args);

        List&lt;TsResult&gt; tsResults = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        execute.forEach(item -&gt; {
            dealResult(item, tsResults);
        });
        <span class="hljs-keyword">return</span> tsResults;

    }

    <span class="hljs-keyword">public</span> Map&lt;String, List&lt;TsResult&gt;&gt; <span class="hljs-title function_">queryTimeRangeByPipe</span><span class="hljs-params">(List&lt;String&gt; keys, String timeRange,String redisEleRange,String dataCode)</span> {
        Long[] dateArr = dateStrArrToLongArr(timeRange,dataCode);
        <span class="hljs-keyword">return</span> queryTimeRangeByPipe(keys, dateArr[<span class="hljs-number">0</span>], dateArr[<span class="hljs-number">1</span>],redisEleRange);
    }

    <span class="hljs-comment">/**
     * redis çš„pipe
     * å­˜åœ¨çš„é—®é¢˜ï¼šå¦‚æœå…¶ä¸­æœ‰ä¸€ä¸ªç«™ç‚¹çš„å€¼ä¸å­˜åœ¨ï¼Œåˆ™ä¼šæŠ¥é”™Caused by: io.lettuce.core.RedisCommandExecutionException: ERR TSDB: the key does not exist,é€šè¿‡é‡å†™çš„æ–¹å¼æ¥è§£å†³
     * 
     *
     * <span class="hljs-doctag">@param</span> keys
     * <span class="hljs-doctag">@param</span> from
     * <span class="hljs-doctag">@param</span> to
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-keyword">public</span> Map&lt;String, List&lt;TsResult&gt;&gt; <span class="hljs-title function_">queryTimeRangeByPipe</span><span class="hljs-params">(List&lt;String&gt; keys, <span class="hljs-type">long</span> from, <span class="hljs-type">long</span> to,String redisEleRange)</span> {
        Map&lt;String, List&lt;TsResult&gt;&gt; output = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

        <span class="hljs-type">LettuceConnection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> getLettuceConnection();

        RedisClusterAsyncCommands&lt;<span class="hljs-type">byte</span>[], <span class="hljs-type">byte</span>[]&gt; commands = connection.getNativeConnection();
        <span class="hljs-keyword">try</span> {

            <span class="hljs-comment">// 3. å¼€å¯ Pipeline æ¨¡å¼ï¼ˆå…³é—­è‡ªåŠ¨ flushï¼‰</span>
            commands.setAutoFlushCommands(<span class="hljs-literal">false</span>);


            List&lt;RedisFuture&lt;?&gt;&gt; futures = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();


            <span class="hljs-comment">// å•ç‹¬ä¿å­˜ TS.RANGE çš„ futures</span>
            List&lt;RedisFuture&lt;List&lt;Object&gt;&gt;&gt; tsRangeFutures = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

            <span class="hljs-keyword">for</span> (String tsKey : keys) {
                <span class="hljs-type">byte</span>[] keyBytes = tsKey.getBytes(StandardCharsets.UTF_8);

                <span class="hljs-type">ProtocolKeyword</span> <span class="hljs-variable">tsRangeKeyword</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProtocolKeyword</span>() {
                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] getBytes() {
                        <span class="hljs-keyword">return</span> <span class="hljs-string">"TS.RANGE"</span>.getBytes(StandardCharsets.UTF_8);
                    }

                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">name</span><span class="hljs-params">()</span> {
                        <span class="hljs-keyword">return</span> <span class="hljs-string">"TS.RANGE"</span>;
                    }
                };

                CommandArgs&lt;<span class="hljs-type">byte</span>[], <span class="hljs-type">byte</span>[]&gt; args = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommandArgs</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayCodec</span>()).addKey(keyBytes).add(from).add(to);

                <span class="hljs-keyword">if</span>(StringUtils.isNotBlank(redisEleRange)){
                    args.add(ApiConstant.FILTER_BY_VALUE).add(redisEleRange);
                }

                <span class="hljs-type">ObjectOutput</span> <span class="hljs-variable">keyValueListOutput</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutput</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringCodec</span>());

                <span class="hljs-meta">@SuppressWarnings("unchecked")</span> RedisFuture&lt;List&lt;Object&gt;&gt; tsFuture = (RedisFuture&lt;List&lt;Object&gt;&gt;) commands.dispatch(tsRangeKeyword, keyValueListOutput, args);

                futures.add(tsFuture);
                tsRangeFutures.add(tsFuture);
            }

            <span class="hljs-comment">// æ‰§è¡Œ pipeline</span>
            commands.flushCommands();

            <span class="hljs-comment">// ç­‰å¾…æ‰€æœ‰å®Œæˆ</span>
            RedisFuture[] array = futures.toArray(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisFuture</span>[<span class="hljs-number">0</span>]);
            awaitAll(<span class="hljs-number">60</span>, TimeUnit.SECONDS, array);

            <span class="hljs-comment">// è§£æ TS.RANGE ç»“æœ</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">tsIndex</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
            <span class="hljs-keyword">for</span> (String tsKey : keys) {
                RedisFuture&lt;List&lt;Object&gt;&gt; tsFuture = tsRangeFutures.get(tsIndex);
                List&lt;Object&gt; rawTsData = <span class="hljs-literal">null</span>;
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">/**
                     * é˜»å¡è·å–ç»“æœ
                     * è¿™é‡Œå¦‚æœè·å–ç»“æœå¤±è´¥ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œç›´æ¥æ‰§è¡Œå¤±è´¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ¶é€ ä¸€ä¸ªç©ºé›†åˆç»™åé¢ä½¿ç”¨
                     */</span>
                    rawTsData = tsFuture.get();
                } <span class="hljs-keyword">catch</span> (InterruptedException | ExecutionException e) {
                    rawTsData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
                }


<span class="hljs-comment">//                System.out.println("TS.RANGE ç»“æœ for key [" + tsKey + "]: " + rawTsData);</span>

                List&lt;TsResult&gt; tsResults = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
                <span class="hljs-keyword">if</span> (rawTsData != <span class="hljs-literal">null</span>) {

                    <span class="hljs-keyword">for</span> (Object item : rawTsData) {
                        <span class="hljs-keyword">if</span> (item <span class="hljs-keyword">instanceof</span> List) {
                            List&lt;?&gt; tsEntry = (List&lt;?&gt;) item;
                            <span class="hljs-keyword">if</span> (tsEntry.size() &gt;= <span class="hljs-number">2</span>) {
                                <span class="hljs-type">TsResult</span> <span class="hljs-variable">tsResult</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TsResult</span>();
                                <span class="hljs-type">Long</span> <span class="hljs-variable">timestamp</span> <span class="hljs-operator">=</span> ((Number) tsEntry.get(<span class="hljs-number">0</span>)).longValue();
                                <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> tsEntry.get(<span class="hljs-number">1</span>);
                                tsResult.setTime(timestamp);
                                tsResult.setVal((Double) value);
                                tsResult.setKey(DateUtil.longToLocalDateTime(timestamp));
                                tsResults.add(tsResult);
                            }
                        }
                    }
                }
                output.put(tsKey, tsResults);

                tsIndex++;
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            commands.setAutoFlushCommands(<span class="hljs-literal">true</span>);
            <span class="hljs-keyword">if</span> (connection != <span class="hljs-literal">null</span>) {
                RedisConnectionUtils.releaseConnection(connection, lettuceConnectionFactory);
            }
        }

        <span class="hljs-keyword">return</span> output;

    }

    <span class="hljs-keyword">private</span> LettuceConnection <span class="hljs-title function_">getLettuceConnection</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (connection != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> connection;
        }
        connection = (LettuceConnection) lettuceConnectionFactory.getConnection();
        <span class="hljs-keyword">return</span> connection;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeLua</span><span class="hljs-params">()</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">luaScript</span> <span class="hljs-operator">=</span> <span class="hljs-string">"local from = tonumber(ARGV[#ARGV - 1]) "</span> + <span class="hljs-string">"local to = tonumber(ARGV[#ARGV]) "</span> + <span class="hljs-string">"if not from or not to then return { err = 'from å’Œ to å¿…é¡»æ˜¯æœ‰æ•ˆçš„æ—¶é—´æˆ³ï¼ˆæ¯«ç§’çº§æ•°å­—ï¼Œä¾‹å¦‚ 1760895600000ï¼‰' } end "</span> + <span class="hljs-string">"local result = {} "</span> + <span class="hljs-string">"for i = 1, #ARGV - 2 do "</span> + <span class="hljs-string">"  local key = ARGV[i] "</span> + <span class="hljs-string">"  local res = redis.call('TS.RANGE', key, from, to) "</span> + <span class="hljs-string">"  local row = { key } "</span> + <span class="hljs-string">"  for j = 1, #res do "</span> + <span class="hljs-string">"    table.insert(row, res[j][1]) "</span> + <span class="hljs-string">"    table.insert(row, res[j][2]) "</span> + <span class="hljs-string">"  end "</span> + <span class="hljs-string">"  table.insert(result, row) "</span> + <span class="hljs-string">"end "</span> + <span class="hljs-string">"return result"</span>;
        RedisScript&lt;Object&gt; objectRedisScript = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRedisScript</span>&lt;&gt;(luaScript, Object.class);
        List&lt;String&gt; args1 = Arrays.asList(<span class="hljs-string">"pm:ts:52980:V13011"</span>, <span class="hljs-string">"pm:ts:52981:V13011"</span>, <span class="hljs-string">"pm:ts:52983:V13011"</span>, <span class="hljs-string">"pm:ts:53906:V13011"</span>, <span class="hljs-string">"pm:ts:53908:V13011"</span>, <span class="hljs-string">"1761068400000"</span>,  <span class="hljs-comment">// fromï¼ˆå­—ç¬¦ä¸²ï¼Œä½†ä¼šè¢« tonumbe() è½¬æˆæ•°å­—ï¼‰</span>
                <span class="hljs-string">"1761270000000"</span>   <span class="hljs-comment">// toï¼ˆå­—ç¬¦ä¸²ï¼Œä½†ä¼šè¢« tonumbe() è½¬æˆæ•°å­—ï¼‰</span>
        );
        List&lt;<span class="hljs-type">byte</span>[]&gt; argsList = Arrays.asList(<span class="hljs-string">"pm:ts:52980:V13011"</span>.getBytes(), <span class="hljs-string">"pm:ts:52981:V13011"</span>.getBytes(), <span class="hljs-string">"pm:ts:52983:V13011"</span>.getBytes(), <span class="hljs-string">"pm:ts:53906:V13011"</span>.getBytes(), <span class="hljs-string">"pm:ts:53908:V13011"</span>.getBytes(), <span class="hljs-string">"1761068400000"</span>.getBytes(),  <span class="hljs-comment">// fromï¼ˆå­—ç¬¦ä¸²ï¼Œä½†ä¼šè¢« tonumbe() è½¬æˆæ•°å­—ï¼‰</span>
                <span class="hljs-string">"1761270000000"</span>.getBytes()   <span class="hljs-comment">// toï¼ˆå­—ç¬¦ä¸²ï¼Œä½†ä¼šè¢« tonumbe() è½¬æˆæ•°å­—ï¼‰</span>
        );
        <span class="hljs-type">RedisSerializer</span> <span class="hljs-variable">stringRedisSerializer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>();
        <span class="hljs-type">JdkSerializationRedisSerializer</span> <span class="hljs-variable">jdkSerializationRedisSerializer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdkSerializationRedisSerializer</span>();

        <span class="hljs-type">Object</span> <span class="hljs-variable">execute1</span> <span class="hljs-operator">=</span> redisTemplate.execute(objectRedisScript, stringRedisSerializer, jdkSerializationRedisSerializer, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(), args1.toArray());
    }

    <span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[][] buildTsRangeArgs(String key, <span class="hljs-type">long</span> from, <span class="hljs-type">long</span> to, Map&lt;String, Object&gt; filterMap) {
        List&lt;<span class="hljs-type">byte</span>[]&gt; argsList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        argsList.add(key.getBytes());
        argsList.add(String.valueOf(from).getBytes());
        argsList.add(String.valueOf(to).getBytes());

        <span class="hljs-keyword">if</span> (filterMap != <span class="hljs-literal">null</span> &amp;&amp; !filterMap.isEmpty()) {
            argsList.add(<span class="hljs-string">"FILTER"</span>.getBytes());
            <span class="hljs-type">String</span> <span class="hljs-variable">filterStr</span> <span class="hljs-operator">=</span> filterMap.entrySet().stream().map(entry -&gt; entry.getKey() + <span class="hljs-string">"="</span> + entry.getValue()).collect(Collectors.joining(<span class="hljs-string">" "</span>));
            argsList.add(filterStr.getBytes());
        }

        <span class="hljs-keyword">return</span> argsList.toArray(<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">0</span>][]);
    }

    <span class="hljs-keyword">public</span> List&lt;TsResult&gt; <span class="hljs-title function_">queryTimeRange</span><span class="hljs-params">(String key, Long[] longs, Map&lt;String, Object&gt; filterMap,String dataCode)</span> {
        <span class="hljs-keyword">return</span> queryTimeRange(key, longs[<span class="hljs-number">0</span>], longs[<span class="hljs-number">1</span>], filterMap,dataCode);
    }

    <span class="hljs-comment">/**
     * æŸ¥è¯¢æŸä¸ªæ—¶é—´èŒƒå›´å†…çš„æ—¶é—´åºåˆ—æ•°æ®
     *
     * <span class="hljs-doctag">@param</span> key       æ—¶é—´åºåˆ—çš„ keyï¼Œæ¯”å¦‚ "mytimeseries"
     * <span class="hljs-doctag">@param</span> timeRange æ—¶é—´èŒƒå›´ï¼Œæ ¼å¼ä¸º "[å¼€å§‹æ—¶é—´, ç»“æŸæ—¶é—´]"ï¼Œå¦‚ "[20251020014000,20251023064000]"
     * <span class="hljs-doctag">@return</span> åŸå§‹è¿”å›ç»“æœï¼Œæ˜¯ä¸€ä¸ª List&lt;Object&gt;ï¼Œæ¯ä¸¤ä¸ªå…ƒç´ ä»£è¡¨ [timestamp, value]
     */</span>
    <span class="hljs-keyword">public</span> List&lt;TsResult&gt; <span class="hljs-title function_">queryTimeRange</span><span class="hljs-params">(String key, String timeRange, Map&lt;String, Object&gt; filterMap,String dataCode)</span> {
        Long[] longs = dateStrArrToLongArr(timeRange,dataCode);
        <span class="hljs-keyword">return</span> queryTimeRange(key, longs[<span class="hljs-number">0</span>], longs[<span class="hljs-number">1</span>], filterMap,dataCode);
    }

    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">get</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-keyword">return</span> redisTemplate.opsForValue().get(key);
    }

    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">getObject</span><span class="hljs-params">(String key, Class&lt;T&gt; clazz)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> (String) redisTemplate.opsForValue().get(key);
        <span class="hljs-keyword">return</span> value == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : JSON.parseObject(value, clazz);
    }

    <span class="hljs-comment">/**
     * è·å– HashMap æ•°æ®
     *
     * <span class="hljs-doctag">@param</span> key HashMap çš„ key
     * <span class="hljs-doctag">@return</span> HashMap æ•°æ®
     */</span>
    <span class="hljs-keyword">public</span> Map&lt;Object, Object&gt; <span class="hljs-title function_">getHash</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-keyword">return</span> redisTemplate.opsForHash().entries(key);

    }


    <span class="hljs-comment">/**
     * è§£æ TS.MRANGE å‘½ä»¤è¿”å›çš„åŸå§‹æ•°æ®ï¼ˆList&lt;Object&gt;ï¼‰ï¼Œæ„é€  TsResult åˆ—è¡¨
     */</span>

    <span class="hljs-comment">/**
     * æ‰§è¡Œ TS.MRANGE å‘½ä»¤ï¼ŒæŸ¥è¯¢æ»¡è¶³ FILTER æ¡ä»¶çš„å¤šä¸ª TimeSeries åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„æ•°æ®
     *
     * <span class="hljs-doctag">@param</span> timeRange æ—¶é—´èŒƒå›´ï¼Œæ ¼å¼ä¸º "[å¼€å§‹æ—¶é—´, ç»“æŸæ—¶é—´]"ï¼Œå¦‚ "[20251020014000,20251023064000]"
     * <span class="hljs-doctag">@param</span> filterMap æ ‡ç­¾è¿‡æ»¤æ¡ä»¶ï¼Œå¦‚ {"table": "pm", "station_id": "52889", "element": "V12001"}
     * <span class="hljs-doctag">@return</span> æŸ¥è¯¢ç»“æœï¼Œæ¯ä¸ªå…ƒç´ ä¸º TsResultï¼ˆåŒ…å« keyã€timestampã€valueï¼‰
     * <span class="hljs-doctag">@see</span> &lt;a href="https://oss.redis.com/redistimeseries/commands/#tsmrange"&gt;TS.MRANGE&lt;/a&gt;
     *
     */</span>
    <span class="hljs-keyword">public</span> Map&lt;String, List&lt;TsResult&gt;&gt; <span class="hljs-title function_">queryMrange</span><span class="hljs-params">(String timeRange, Map&lt;String, Object&gt; filterMap,String dataCode)</span> {
        Long[] longs = dateStrArrToLongArr(timeRange,dataCode);
        <span class="hljs-keyword">return</span> queryMrange(longs[<span class="hljs-number">0</span>], longs[<span class="hljs-number">1</span>], filterMap, <span class="hljs-string">"TS.MRANGE"</span>);
    }

    <span class="hljs-comment">/**
     *
     * æ‰§è¡Œ TS.MGET å‘½ä»¤ï¼ŒæŸ¥è¯¢æ»¡è¶³ FILTER æ¡ä»¶çš„å¤šä¸ª TimeSeries çš„æœ€æ–°æ•°æ®
     * ç¤ºä¾‹ï¼šTS.MGET FILTER table=pm station_id=(52889,52674) element=V13011
     *
     * <span class="hljs-doctag">@param</span> filterMap æ ‡ç­¾è¿‡æ»¤æ¡ä»¶ï¼Œå¦‚ {"table": "pm", "station_id": "52889", "element": "V12001"}
     * <span class="hljs-doctag">@return</span> æŸ¥è¯¢ç»“æœï¼Œæ¯ä¸ªå…ƒç´ ä¸º TsResultï¼ˆåŒ…å« keyã€timestampã€valueï¼‰
     * <span class="hljs-doctag">@see</span> &lt;a href="https://oss.redis.com/redistimeseries/commands/#tsmrange"&gt;TS.MGET&lt;/a&gt;
     *
     **/</span>
    <span class="hljs-keyword">public</span> Map&lt;String, List&lt;TsResult&gt;&gt; <span class="hljs-title function_">queryMget</span><span class="hljs-params">(Map&lt;String, Object&gt; filterMap)</span> {
        <span class="hljs-keyword">return</span> queryMrange(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, filterMap, <span class="hljs-string">"TS.MGET"</span>);
    }

    <span class="hljs-comment">/**
     * æ‰§è¡Œ TS.MRANGE å‘½ä»¤ï¼ŒæŸ¥è¯¢æ»¡è¶³ FILTER æ¡ä»¶çš„å¤šä¸ª TimeSeries åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„æ•°æ®
     *
     * <span class="hljs-doctag">@param</span> from      å¼€å§‹æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
     * <span class="hljs-doctag">@param</span> to        ç»“æŸæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
     * <span class="hljs-doctag">@param</span> filterMap æ ‡ç­¾è¿‡æ»¤æ¡ä»¶ï¼Œå¦‚ {"table": "pm", "station_id": "52889", "element": "V12001"}
     * <span class="hljs-doctag">@return</span> æŸ¥è¯¢ç»“æœï¼Œæ¯ä¸ªå…ƒç´ ä¸º TsResultï¼ˆåŒ…å« keyã€timestampã€valueï¼‰
     */</span>
    <span class="hljs-keyword">public</span> Map&lt;String, List&lt;TsResult&gt;&gt; <span class="hljs-title function_">queryMrange</span><span class="hljs-params">(Long from, Long to, Map&lt;String, Object&gt; filterMap, String cmd)</span> {
        <span class="hljs-comment">// 1. æ„é€  TS.MRANGE å‘½ä»¤çš„å‚æ•°</span>
        List&lt;<span class="hljs-type">byte</span>[]&gt; args = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">if</span> (from == <span class="hljs-literal">null</span> &amp;&amp; to == <span class="hljs-literal">null</span>) {
            args = buildArgsFilterMap(filterMap);
        } <span class="hljs-keyword">else</span> {
            args = buildMrangeArgs(from, to, filterMap);
        }

        <span class="hljs-keyword">return</span> executeCmdByArgs(cmd, args, <span class="hljs-literal">null</span>);
    }

    <span class="hljs-keyword">private</span> Map&lt;String, List&lt;TsResult&gt;&gt; <span class="hljs-title function_">executeCmdByArgs</span><span class="hljs-params">(String cmd, List&lt;<span class="hljs-type">byte</span>[]&gt; args, String key)</span> {
        <span class="hljs-comment">// 2. è·å– Lettuce åŸç”Ÿè¿æ¥</span>
        <span class="hljs-type">LettuceConnection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> getLettuceConnection();

        <span class="hljs-comment">// 3. æ‰§è¡Œ TS.MRANGE å‘½ä»¤</span>
        <span class="hljs-type">ObjectOutput</span> <span class="hljs-variable">keyValueListOutput</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutput</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringCodec</span>());
        <span class="hljs-type">Object</span> <span class="hljs-variable">execute</span> <span class="hljs-operator">=</span> connection.execute(cmd, keyValueListOutput, args.toArray(<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">0</span>][]));
        Map&lt;String, List&lt;Object&gt;&gt; rawResult = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">if</span> (execute <span class="hljs-keyword">instanceof</span> List) {
            Map&lt;String, List&lt;Object&gt;&gt; objectObjectHashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            objectObjectHashMap.put(key, (List&lt;Object&gt;) execute);
            rawResult = objectObjectHashMap;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (execute <span class="hljs-keyword">instanceof</span> Map) {
            rawResult = (Map&lt;String, List&lt;Object&gt;&gt;) execute;
        }

        <span class="hljs-comment">// 4. è§£æè¿”å›ç»“æœï¼Œæ„é€  TsResult åˆ—è¡¨</span>
        <span class="hljs-keyword">return</span> convertToTsResultMap(rawResult);
    }

    <span class="hljs-comment">/**
     * æ„é€  TS.MRANGE å‘½ä»¤çš„å‚æ•°ï¼ˆbyte[] æ ¼å¼ï¼‰
     */</span>
    <span class="hljs-keyword">private</span> List&lt;<span class="hljs-type">byte</span>[]&gt; buildMrangeArgs(Long from, Long to, Map&lt;String, Object&gt; filterMap) {
        List&lt;<span class="hljs-type">byte</span>[]&gt; args = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        args.add(String.valueOf(from).getBytes());  <span class="hljs-comment">// from (timestamp)</span>
        args.add(String.valueOf(to).getBytes());    <span class="hljs-comment">// to (timestamp)</span>

        List&lt;<span class="hljs-type">byte</span>[]&gt; bytes = buildArgsFilterMap(filterMap);
        args.addAll(bytes);
        <span class="hljs-keyword">return</span> args;
    }

    <span class="hljs-comment">/**
     * æ„ä»¶ç»Ÿè®¡å‚æ•°-å¤šä¸ªç«™ç‚¹ï¼Œå¤šä¸ªè¦ç´ ï¼ˆè¿™é‡Œåªèƒ½ç»Ÿè®¡å¤šç«™ç‚¹ã€å•è¦ç´ ï¼‰
     * TS.MRANGE 1761323040000 1761526920000   AGGREGATION sum 203880000 BUCKETTIMESTAMP + FILTER station_id=(52889,52881) table=pm GROUPBY station_id REDUCE min
     * TS.MRANGE 1701323040000 1761526920000   AGGREGATION sum 203880000 BUCKETTIMESTAMP + FILTER station_id=(52889,52881) table=mm GROUPBY station_id REDUCE min
     * TS.MRANGE 1729787040000 1761872520000   AGGREGATION sum 203880000 BUCKETTIMESTAMP + FILTER station_id=(52980,52881,52889) element=(V12001,V11291) table=mm GROUPBY station_id   REDUCE min
     * TS.MRANGE 1729787040000 1761872520000   AGGREGATION sum 203880000 BUCKETTIMESTAMP + FILTER station_id=(52980,52881,52889) element=(V11291) table=mm GROUPBY station_id,element   REDUCE min ï¼ˆä¸è¡Œï¼‰
     * TS.MRANGE 1729787040000 1761872520000   AGGREGATION sum 203880000 BUCKETTIMESTAMP + FILTER station_id=(52980,52881,52889) element=(V12001) table=mm GROUPBY station_id   REDUCE min
     * TS.MRANGE 1729787040000 1761872520000   FILTER station_id=(52980,52881,52889) element=(V12001) table=mm AGGREGATION sum 203880000 BUCKETTIMESTAMP +  GROUPBY station_id   REDUCE min
     *
     * <span class="hljs-doctag">@param</span> from
     * <span class="hljs-doctag">@param</span> to
     * <span class="hljs-doctag">@param</span> stationIds
     * <span class="hljs-doctag">@param</span> table
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-keyword">private</span> List&lt;<span class="hljs-type">byte</span>[]&gt; buildStatMrangeArgs(Long from, Long to, List&lt;String&gt; stationIds, List&lt;String&gt; elements, String table, String dateType,String redisEleRange) {
        List&lt;<span class="hljs-type">byte</span>[]&gt; args = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        args.add(String.valueOf(from).getBytes());
        args.add(String.valueOf(to).getBytes());
        <span class="hljs-keyword">if</span>(StringUtils.isNotBlank(redisEleRange)){
            args.add(ApiConstant.FILTER_BY_VALUE.getBytes());
            args.add(redisEleRange.getBytes());
        }
        args.add(<span class="hljs-string">"AGGREGATION"</span>.getBytes());
        args.add(<span class="hljs-string">"sum"</span>.getBytes());
        <span class="hljs-type">long</span> <span class="hljs-variable">bucket_size_ms</span> <span class="hljs-operator">=</span> to - from;
        args.add(String.valueOf(bucket_size_ms).getBytes());
        args.add(<span class="hljs-string">"BUCKETTIMESTAMP"</span>.getBytes());
        args.add(<span class="hljs-string">"+"</span>.getBytes());
        args.add(<span class="hljs-string">"ALIGN"</span>.getBytes());
        <span class="hljs-type">long</span> <span class="hljs-variable">alignTime</span> <span class="hljs-operator">=</span> getAlignTime(from, bucket_size_ms, dateType);
        args.add(String.valueOf(alignTime).getBytes());
        args.add(<span class="hljs-string">"FILTER"</span>.getBytes());
        args.add((<span class="hljs-string">"station_id=("</span> + String.join(<span class="hljs-string">","</span>, stationIds) + <span class="hljs-string">")"</span>).getBytes());
        args.add((<span class="hljs-string">"element=("</span> + String.join(<span class="hljs-string">","</span>, elements) + <span class="hljs-string">")"</span>).getBytes());
        args.add((<span class="hljs-string">"table="</span> + table).getBytes());
        args.add(<span class="hljs-string">"GROUPBY"</span>.getBytes());
        args.add(<span class="hljs-string">"station_id"</span>.getBytes());
<span class="hljs-comment">//        args.add("element".getBytes());</span>
        args.add(<span class="hljs-string">"REDUCE"</span>.getBytes());
        args.add(<span class="hljs-string">"min"</span>.getBytes());
        <span class="hljs-keyword">return</span> args;
    }

    <span class="hljs-comment">/**
     * æ„ä»¶å•ç«™ç‚¹çš„ èšåˆæˆ–è€…5åˆ†é’Ÿçš„èšåˆ
     * TS.RANGE pm:ts:52889:V13011 1761323040000 1761526920000  AGGREGATION sum 203880000 BUCKETTIMESTAMP + ALIGN align_time
     * TS.RANGE pm:ts:52889:V13011 1761323040000 1761526920000 FILTER_BY_VALUE -inf 30  AGGREGATION sum 203880000 BUCKETTIMESTAMP + ALIGN align_time
     *
     * <span class="hljs-doctag">@param</span> from
     * <span class="hljs-doctag">@param</span> to
     * <span class="hljs-doctag">@param</span> key
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-keyword">private</span> List&lt;<span class="hljs-type">byte</span>[]&gt; buildStatRangeArgs(Long from, Long to, String key, StatParam statParam, String dateType,String redisEleRange) {
        <span class="hljs-type">Integer</span> <span class="hljs-variable">windowSize</span> <span class="hljs-operator">=</span> statParam.getWindowSize();
        <span class="hljs-type">String</span> <span class="hljs-variable">statType</span> <span class="hljs-operator">=</span> statParam.getStatType();
        List&lt;<span class="hljs-type">byte</span>[]&gt; args = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        args.add(key.getBytes());
        args.add(String.valueOf(from).getBytes());
        args.add(String.valueOf(to).getBytes());
        <span class="hljs-keyword">if</span>(StringUtils.isNotBlank(redisEleRange)){
            args.add(ApiConstant.FILTER_BY_VALUE.getBytes());
            args.add(redisEleRange.getBytes());
        }
        args.add(<span class="hljs-string">"AGGREGATION"</span>.getBytes());
        args.add(statType.getBytes());
        <span class="hljs-type">long</span> <span class="hljs-variable">bucket_size_ms</span> <span class="hljs-operator">=</span> getBucketSizeMs(from, to, windowSize, dateType);
        args.add(String.valueOf(bucket_size_ms).getBytes());
        args.add(<span class="hljs-string">"BUCKETTIMESTAMP"</span>.getBytes());
        args.add(<span class="hljs-string">"+"</span>.getBytes());
        args.add(<span class="hljs-string">"ALIGN"</span>.getBytes());
        <span class="hljs-type">long</span> <span class="hljs-variable">alignTime</span> <span class="hljs-operator">=</span> getAlignTime(from, bucket_size_ms, dateType);
        args.add(String.valueOf(alignTime).getBytes());
        <span class="hljs-keyword">return</span> args;
    }

    <span class="hljs-comment">/**
     * è·å–å¯¹é½æ—¶é—´
     * align_time = (start_ts // bucket_size_ms) * bucket_size_ms+ adj_time
     *
     * <span class="hljs-doctag">@param</span> from
     * <span class="hljs-doctag">@param</span> bucket_size_ms
     * <span class="hljs-doctag">@param</span> dateType
     * <span class="hljs-doctag">@param</span> dateType
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-keyword">private</span> Long <span class="hljs-title function_">getAlignTime</span><span class="hljs-params">(Long from, <span class="hljs-type">long</span> bucket_size_ms, String dateType)</span> {
        <span class="hljs-keyword">return</span> from / bucket_size_ms * bucket_size_ms + getAdjTime(dateType);
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getKey</span><span class="hljs-params">(String stationId, String table, String element)</span> {
        <span class="hljs-keyword">return</span> table + <span class="hljs-string">":ts:"</span> + stationId + <span class="hljs-string">":"</span> + element;
    }

    <span class="hljs-comment">/**
     * æ•°æ®ç»Ÿè®¡
     * 1.å¦‚æœæ˜¯å•ä¸ªç«™ç‚¹ï¼ŒæŒ‰ç…§å•ä¸ªç«™ç‚¹çš„æ–¹å¼è¿›è¡Œèšåˆ
     * TS.RANGE pm:ts:52889:V13011 start_ts end_ts  AGGREGATION sum bucket_size_ms BUCKETTIMESTAMP + ALIGN align_time
     * TS.RANGE pm:ts:52889:V13011 1761323040000 1761526920000  AGGREGATION sum 203880000 BUCKETTIMESTAMP + ALIGN align_time
     * 2.å¦‚æœæ˜¯å¤šä¸ªç«™ç‚¹ï¼ŒæŒ‰ç…§å¤šä¸ªç«™ç‚¹è¿›è¡Œèšåˆ
     * TS.MRANGE 1761323040000 1761526920000   AGGREGATION sum 203880000 BUCKETTIMESTAMP + FILTER station_id=(52889,52881) table=pm GROUPBY station_id REDUCE min
     * 3.éœ€è¦åŒºåˆ†ä¸€ä¸‹æ˜¯ä¸æ˜¯5åˆ†é’Ÿçš„èšåˆæ–¹å¼
     *
     * <span class="hljs-doctag">@param</span> timeRange  æ—¶é—´èŒƒå›´ [start_ts, end_ts]
     * <span class="hljs-doctag">@param</span> stationIds ç«™ç‚¹ç¼–å·
     * <span class="hljs-doctag">@param</span> table      è¡¨å pm/mm
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-keyword">public</span> Map&lt;String, List&lt;TsResult&gt;&gt; <span class="hljs-title function_">statTsDataMiddle</span><span class="hljs-params">(String timeRange, List&lt;String&gt; stationIds, List&lt;String&gt; elements, String table, StatParam statParam, String dateType,String redisEleRange,String dataCode)</span> {
        Long[] timeParamArr = dateStrArrToLongArr(timeRange,dataCode);
        <span class="hljs-keyword">if</span> (stationIds.isEmpty()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OuterException</span>(RetCode.BAD_REQUEST, <span class="hljs-string">"ç«™ç‚¹ç¼–å·ä¸èƒ½ä¸ºç©º"</span>);
        }
        <span class="hljs-keyword">if</span> (elements.isEmpty()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OuterException</span>(RetCode.BAD_REQUEST, <span class="hljs-string">"è¦ç´ ä¸èƒ½ä¸ºç©º"</span>);
        }
        <span class="hljs-keyword">if</span> (stationIds.size() == <span class="hljs-number">1</span> &amp;&amp; elements.size() == <span class="hljs-number">1</span>) {
            <span class="hljs-comment">//å•ç«™ç‚¹ã€å•è¦ç´ æŒ‰ç…§ TS.RANGEçš„æ–¹å¼è¿›è¡Œç»Ÿè®¡</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> getKey(stationIds.get(<span class="hljs-number">0</span>), table, elements.get(<span class="hljs-number">0</span>));
            List&lt;<span class="hljs-type">byte</span>[]&gt; args = buildStatRangeArgs(timeParamArr[<span class="hljs-number">0</span>], timeParamArr[<span class="hljs-number">1</span>], key, statParam, dateType,redisEleRange);
            <span class="hljs-keyword">return</span> executeCmdByArgs(<span class="hljs-string">"TS.RANGE"</span>, args, key);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//å¤šç«™ç‚¹ã€å•è¦ç´ æŒ‰ç…§ TS.MRANGEçš„æ–¹å¼è¿›è¡Œç»Ÿè®¡</span>
            List&lt;<span class="hljs-type">byte</span>[]&gt; args = buildStatMrangeArgs(timeParamArr[<span class="hljs-number">0</span>], timeParamArr[<span class="hljs-number">1</span>], stationIds, elements, table, dateType,redisEleRange);
            Map&lt;String, List&lt;TsResult&gt;&gt; stringListMap = executeCmdByArgs(<span class="hljs-string">"TS.MRANGE"</span>, args, <span class="hljs-literal">null</span>);
            <span class="hljs-comment">//ç»“æœå€¼è½¬æ¢</span>
            <span class="hljs-keyword">return</span> convertToResultMap(stringListMap, table, elements.get(<span class="hljs-number">0</span>));
        }

    }

    <span class="hljs-keyword">private</span> Map&lt;String, List&lt;TsResult&gt;&gt; <span class="hljs-title function_">convertToResultMap</span><span class="hljs-params">(Map&lt;String, List&lt;TsResult&gt;&gt; stringListMap, String tableName, String ele)</span> {
        <span class="hljs-keyword">return</span> stringListMap.entrySet()
                .stream()
                .collect(Collectors.toMap(
                        entry -&gt; buildNewKey(entry.getKey(), tableName, ele),
                        Map.Entry::getValue
                ));
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">buildNewKey</span><span class="hljs-params">(String originalKey, String tableName, String ele)</span> {
        String[] split = originalKey.split(<span class="hljs-string">"="</span>);
        <span class="hljs-keyword">return</span> tableName + <span class="hljs-string">":ts:"</span> + split[<span class="hljs-number">1</span>] + <span class="hljs-string">":"</span> + ele;
    }

    <span class="hljs-comment">/**
     * åŸºäºredisçš„æ•°æ®ç»Ÿè®¡ç»“æœï¼Œåšä¸¤ä»¶äº‹
     * 1.å¦‚æœæ˜¯çª—å£èšåˆï¼Œä½¿ç”¨ALIGNå‚æ•°è°ƒæ•´æ¡¶çš„å¼€å§‹æ—¶é—´ï¼Œä½¿å…¶ä»01å¼€å§‹ï¼Œè·å–çš„æ—¶é—´æˆ³å‡å»adj_timeï¼Œå¾—åˆ°å®é™…çš„èšåˆæ—¶é—´
     * 2.ç»Ÿä¸€å¤„ç†mapçš„keyï¼Œè®©å…¶åé¢çš„æµç¨‹å¯ç»Ÿä¸€å¤„ç†
     *
     * <span class="hljs-doctag">@param</span> timeRange
     * <span class="hljs-doctag">@param</span> stationIds
     * <span class="hljs-doctag">@param</span> elements
     * <span class="hljs-doctag">@param</span> table
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-keyword">public</span> Map&lt;String, List&lt;TsResult&gt;&gt; <span class="hljs-title function_">statTsData</span><span class="hljs-params">(String timeRange, List&lt;String&gt; stationIds, List&lt;String&gt; elements, String table, String dateType, StatParam statParam,String redisEleRange,String dataCode)</span> {
        Map&lt;String, List&lt;TsResult&gt;&gt; stringListMap = statTsDataMiddle(timeRange, stationIds, elements, table, statParam, dateType,redisEleRange,dataCode);
        <span class="hljs-keyword">if</span> (statParam.getWindowSize() == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> stringListMap;
        }
        <span class="hljs-keyword">return</span> stringListMap.entrySet().stream().collect(Collectors.toMap(entry -&gt; entry.getKey(), entry -&gt; entry.getValue().stream().map(result -&gt; {
            <span class="hljs-type">long</span> <span class="hljs-variable">l</span> <span class="hljs-operator">=</span> result.getTime() - getAdjTime(dateType);
            result.setTime(l);
            result.setKey(DateUtil.longToLocalDateTime(l));
            <span class="hljs-keyword">return</span> result;
        }).collect(Collectors.toList())));
    }


    <span class="hljs-comment">/**
     * è·å–æ‰€æœ‰ä»¥ meta:staid: å¼€å¤´çš„ Hash Keyï¼Œå¹¶è¿”å›å®ƒä»¬çš„ HGETALL æ•°æ®
     */</span>
    <span class="hljs-keyword">public</span> Map&lt;String, Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">getAllMetaStaidHashes</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 1. ä½¿ç”¨ keys() æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…çš„ key</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">pattern</span> <span class="hljs-operator">=</span> <span class="hljs-string">"meta:staid:*"</span>;
        Set&lt;String&gt; keys = redisTemplate.keys(pattern);

        <span class="hljs-keyword">if</span> (keys == <span class="hljs-literal">null</span> || keys.isEmpty()) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        }

        Map&lt;String, Map&lt;String, Object&gt;&gt; collect = keys.stream().collect(Collectors.toMap(key -&gt; key.split(<span class="hljs-string">":"</span>)[<span class="hljs-number">2</span>], key -&gt; {
            <span class="hljs-comment">// è·å–åŸå§‹ Hash æ•°æ®ï¼šMap&lt;Object, Object&gt;</span>
            Map&lt;Object, Object&gt; rawEntries = redisTemplate.opsForHash().entries(key);

            <span class="hljs-comment">// è½¬æ¢ä¸º Map&lt;String, Object&gt;</span>
            Map&lt;String, Object&gt; stringifiedEntries = rawEntries.entrySet().stream().collect(Collectors.toMap(entry -&gt; entry.getKey().toString(),          <span class="hljs-comment">// å­—æ®µåè½¬ String</span>
                    entry -&gt; entry.getValue()                  <span class="hljs-comment">// å­—æ®µå€¼ä¿æŒ Object</span>
            ));
            <span class="hljs-keyword">return</span> stringifiedEntries;
        }));
        <span class="hljs-keyword">return</span> collect;
    }




}

</code></pre>
<pre><code class="hljs language-xml" lang="xml">package com.dfec.api.entity;

import java.time.LocalDateTime;

/**
 *
 * @author tangrg
 * @email 1446232546@qq.com
 * @date 2025-10-2025/10/23 10:38:06
 */
public class TsResult {

    private Long time;

    private LocalDateTime  key;

    private Double val;

    public Long getTime() {
        return time;
    }

    public void setTime(Long time) {
        this.time = time;
    }

    public LocalDateTime getKey() {
        return key;
    }

    public void setKey(LocalDateTime key) {
        this.key = key;
    }

    public Double getVal() {
        return val;
    }

    public void setVal(Double val) {
        this.val = val;
    }
}

</code></pre>
<p>æœ€è¿‘é¡¹ç›®æ¯”è¾ƒèµ¶ï¼Œå…¶å®å¯ä»¥è€ƒè™‘å°†è¿™éƒ¨åˆ†å°è£…æˆä¸€ä¸ªstarteræ¥ä½¿ç”¨ï¼Œåé¢æœ‰æ—¶é—´ä¼šè€ƒè™‘</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS åƒç´ â‰ ç‰©ç†åƒç´ ï¼š0.5px æ•ˆæœçš„æ ¸å¿ƒå¯†ç æ˜¯ä»€ä¹ˆï¼Ÿ]]></title>    <link>https://juejin.cn/post/7572161976594137140</link>    <guid>https://juejin.cn/post/7572161976594137140</guid>    <pubDate>2025-11-14T09:02:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572161976594137140" data-draft-id="7572141390857502720" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS åƒç´ â‰ ç‰©ç†åƒç´ ï¼š0.5px æ•ˆæœçš„æ ¸å¿ƒå¯†ç æ˜¯ä»€ä¹ˆï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,CSS,é¢è¯•"/> <meta itemprop="datePublished" content="2025-11-14T09:02:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ‹‰ä¸åŠ¨çš„çŒª"/> <meta itemprop="url" content="https://juejin.cn/user/1429793504759630"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS åƒç´ â‰ ç‰©ç†åƒç´ ï¼š0.5px æ•ˆæœçš„æ ¸å¿ƒå¯†ç æ˜¯ä»€ä¹ˆï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1429793504759630/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ‹‰ä¸åŠ¨çš„çŒª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T09:02:17.000Z" title="Fri Nov 14 2025 09:02:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    38
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="an-old-hope">.hljs-comment,.hljs-quote{color:#b6b18b}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#eb3c54}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#e7ce56}.hljs-attribute{color:#ee7c2b}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#4fb4d7}.hljs-section,.hljs-title{color:#78bb65}.hljs-keyword,.hljs-selector-tag{color:#b45ea4}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1c1d21;color:#c0c5ce}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å…ˆæ˜ç¡®ä¸¤è€…çš„å…³ç³»ï¼š<strong>CSS åƒç´ æ˜¯ â€œé€»è¾‘åƒç´ â€ï¼ˆé¡µé¢å¸ƒå±€ç”¨ï¼‰ï¼Œç‰©ç†åƒç´ æ˜¯å±å¹•å®é™…å‘å…‰çš„åƒç´ ç‚¹</strong>ï¼Œä¸¤è€…é€šè¿‡Â <strong>è®¾å¤‡åƒç´ æ¯”ï¼ˆDPRï¼‰</strong> Â å…³è”ï¼Œå…¬å¼ä¸ºï¼š<code>1 ä¸ª CSS åƒç´  = DPR Ã— DPR ä¸ªç‰©ç†åƒç´ </code>ï¼ˆä»…é«˜æ¸…å±ç¼©æ”¾ä¸º 1 æ—¶ï¼‰ã€‚</p>
<p>ç†è§£è¿™ä¸ªæ ¸å¿ƒå…³ç³»åï¼Œå†çœ‹ 0.5px æ•ˆæœçš„å®ç°é€»è¾‘å°±æ›´æ¸…æ™°äº†ï¼Œä»¥ä¸‹é‡æ–°æ•´ç†ï¼ˆé‡ç‚¹è¡¥å……åƒç´ å…³ç³»ï¼Œå†å¯¹åº”æ–¹æ³•ï¼‰ï¼š</p>
<h3 data-id="heading-0">ä¸€ã€å…ˆææ‡‚ï¼šCSS åƒç´ ã€ç‰©ç†åƒç´ ã€DPR çš„æ ¸å¿ƒå…³ç³»</h3>
<ol>
<li>
<p><strong>å®šä¹‰</strong></p>
<ul>
<li>
<p>CSS åƒç´ ï¼šå†™ä»£ç æ—¶ç”¨çš„å•ä½ï¼ˆå¦‚Â <code>width: 100px</code>ï¼‰ï¼Œæ˜¯æµè§ˆå™¨æ¸²æŸ“å¸ƒå±€çš„ â€œé€»è¾‘å•ä½â€ï¼Œå’Œå±å¹•ç¡¬ä»¶æ— å…³ã€‚</p>
</li>
<li>
<p>ç‰©ç†åƒç´ ï¼šå±å¹•é¢æ¿ä¸Šå®é™…çš„å‘å…‰ç‚¹ï¼ˆå¦‚æ‰‹æœºå±åˆ†è¾¨ç‡ 1080Ã—2340ï¼Œå°±æ˜¯æ¨ªå‘ 1080 ä¸ªã€çºµå‘ 2340 ä¸ªç‰©ç†åƒç´ ï¼‰ï¼Œæ˜¯å±å¹•çš„ç¡¬ä»¶å±æ€§ã€‚</p>
</li>
<li>
<p>DPRï¼ˆè®¾å¤‡åƒç´ æ¯”ï¼‰ï¼š<code>DPR = ç‰©ç†åƒç´ å®½åº¦ / CSS åƒç´ å®½åº¦</code>ï¼ˆé»˜è®¤é¡µé¢ç¼©æ”¾ä¸º 1 æ—¶ï¼‰ï¼Œç”±è®¾å¤‡ç¡¬ä»¶å†³å®šã€‚</p>
<ul>
<li>ä¾‹ 1ï¼šè€æ¬¾æ™®é€šå±ï¼ˆDPR=1ï¼‰ï¼š1 ä¸ª CSS åƒç´  = 1Ã—1 ä¸ªç‰©ç†åƒç´ ï¼ˆå†™Â <code>1px</code>Â å°±å¯¹åº”å±å¹• 1 ä¸ªå‘å…‰ç‚¹ï¼‰ã€‚</li>
<li>ä¾‹ 2ï¼šé«˜æ¸…å±ï¼ˆDPR=2ï¼Œå¦‚ iPhone 8ï¼‰ï¼š1 ä¸ª CSS åƒç´  = 2Ã—2 ä¸ªç‰©ç†åƒç´ ï¼ˆå†™Â <code>1px</code>Â å®é™…å ç”¨å±å¹• 4 ä¸ªå‘å…‰ç‚¹ï¼Œè§†è§‰ä¸Šæ›´ç²—ï¼‰ã€‚</li>
<li>ä¾‹ 3ï¼šè¶…é«˜æ¸…å±ï¼ˆDPR=3ï¼Œå¦‚ iPhone 14 Proï¼‰ï¼š1 ä¸ª CSS åƒç´  = 3Ã—3 ä¸ªç‰©ç†åƒç´ ï¼ˆå†™Â <code>1px</code>Â å ç”¨ 9 ä¸ªå‘å…‰ç‚¹ï¼Œæ›´ç²—ï¼‰ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>å…³é”®ç»“è®º</strong></p>
<ul>
<li>æˆ‘ä»¬æƒ³è¦çš„ â€œ0.5px æ•ˆæœâ€ï¼Œæœ¬è´¨æ˜¯Â <strong>è®©çº¿æ¡åªå ç”¨ 1 ä¸ªç‰©ç†åƒç´ </strong>ï¼ˆè§†è§‰ä¸Šæœ€ç»†ï¼‰ã€‚</li>
<li>ä½†é«˜æ¸…å±ï¼ˆDPRâ‰¥2ï¼‰é»˜è®¤ä¸‹ï¼Œ1 ä¸ª CSS åƒç´ ä¼šå ç”¨å¤šä¸ªç‰©ç†åƒç´ ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥å†™Â <code>1px</code>ï¼Œéœ€è¦é€šè¿‡æ–¹æ³• â€œå‹ç¼©â€ CSS åƒç´ å¯¹åº”çš„ç‰©ç†åƒç´ æ•°é‡ï¼Œæœ€ç»ˆè½åˆ° 1 ä¸ªç‰©ç†åƒç´ ä¸Šã€‚</li>
</ul>
</li>
</ol>
<h3 data-id="heading-1">äºŒã€æŒ‰ DPR è¦æ±‚åˆ†ç±»çš„ 0.5px å®ç°æ–¹æ³•ï¼ˆç»“åˆåƒç´ å…³ç³»ï¼‰</h3>
<h4 data-id="heading-2">ï¼ˆä¸€ï¼‰ä»… DPRâ‰¥2 ç”Ÿæ•ˆï¼šç›´æ¥è®© CSS åƒç´ å¯¹åº” 1 ä¸ªç‰©ç†åƒç´ </h4>
<p>æ ¸å¿ƒé€»è¾‘ï¼šåˆ©ç”¨ DPRâ‰¥2 çš„åƒç´ æ˜ å°„å…³ç³»ï¼Œè®© CSS åƒç´ ç»è¿‡è®¡ç®—åï¼Œåˆšå¥½å¯¹åº” 1 ä¸ªç‰©ç†åƒç´ ã€‚</p>
<h5 data-id="heading-3">1. ç›´æ¥å£°æ˜Â <code>0.5px</code></h5>
<ul>
<li><strong>åƒç´ å…³ç³»</strong>ï¼šDPR=2 æ—¶ï¼Œ<code>0.5px</code>Â CSS åƒç´  = 0.5Ã—2 = 1 ä¸ªç‰©ç†åƒç´ ï¼ˆåˆšå¥½æ»¡è¶³éœ€æ±‚ï¼‰ï¼›DPR=3 æ—¶ï¼Œ<code>0.5px</code>Â CSS åƒç´  = 0.5Ã—3 = 1.5 ä¸ªç‰©ç†åƒç´ ï¼ˆæ¥è¿‘ç»†çº¿æ¡ï¼Œè§†è§‰å¯æ¥å—ï¼‰ã€‚</li>
<li><strong>å‰æ</strong>ï¼šDPRâ‰¥2 + æµè§ˆå™¨æ”¯æŒäºšåƒç´ æ¸²æŸ“ï¼ˆiOS 9+ã€Android 8.0+ï¼‰ã€‚</li>
<li><strong>ä»£ç </strong>ï¼š<code>border: 0.5px solid #000;</code></li>
<li><strong>å±€é™</strong>ï¼šDPR=1 æ—¶ï¼Œ<code>0.5px</code>Â CSS åƒç´  = 0.5Ã—1 = 0.5 ä¸ªç‰©ç†åƒç´ ï¼ˆå±å¹•æ— æ³•æ¸²æŸ“ï¼Œä¼šå››èˆäº”å…¥ä¸º 0px æˆ– 1pxï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-4">2.Â <code>transform: scale(0.5)</code>Â ç¼©æ”¾</h5>
<ul>
<li>
<p><strong>åƒç´ å…³ç³»</strong>ï¼šå…ˆå†™Â <code>1px</code>Â CSS åƒç´ ï¼ˆDPR=2 æ—¶å¯¹åº” 2 ä¸ªç‰©ç†åƒç´ ï¼‰ï¼Œå†ç¼©æ”¾ 50%ï¼Œæœ€ç»ˆ 2Ã—50% = 1 ä¸ªç‰©ç†åƒç´ ã€‚</p>
</li>
<li>
<p><strong>å‰æ</strong>ï¼šDPRâ‰¥2ï¼ˆåªæœ‰ DPRâ‰¥2 æ—¶ï¼Œ1px CSS åƒç´ æ‰ä¼šå¯¹åº” â‰¥2 ä¸ªç‰©ç†åƒç´ ï¼Œç¼©æ”¾åæ‰èƒ½è½åˆ° 1 ä¸ªï¼‰ã€‚</p>
</li>
<li>
<p><strong>ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.line</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">1px</span>; <span class="hljs-comment">/* 1px CSS = 2 ç‰©ç†åƒç´ ï¼ˆDPR=2ï¼‰ */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#000</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.5</span>); <span class="hljs-comment">/* 2 ç‰©ç†åƒç´  Ã— 0.5 = 1 ç‰©ç†åƒç´  */</span>
}
</code></pre>
</li>
<li>
<p><strong>å±€é™</strong>ï¼šDPR=1 æ—¶ï¼Œ1px CSS åƒç´  = 1 ç‰©ç†åƒç´ ï¼Œç¼©æ”¾åå˜æˆ 0.5 ç‰©ç†åƒç´ ï¼ˆå±å¹•æ— æ³•æ¸²æŸ“ï¼Œçº¿æ¡æ¶ˆå¤±æˆ–æ¨¡ç³Šï¼‰ã€‚</p>
</li>
</ul>
<h5 data-id="heading-5">3.Â <code>viewport</code>Â ç¼©æ”¾ï¼ˆå…¨å±€æ–¹æ¡ˆï¼‰</h5>
<ul>
<li>
<p><strong>åƒç´ å…³ç³»</strong>ï¼šé€šè¿‡Â <code>initial-scale=1/DPR</code>Â æ”¹å˜é¡µé¢ç¼©æ”¾æ¯”ä¾‹ï¼Œè®© 1px CSS åƒç´ ç›´æ¥å¯¹åº” 1 ä¸ªç‰©ç†åƒç´ ã€‚</p>
<ul>
<li>ä¾‹ï¼šDPR=2 æ—¶ï¼Œç¼©æ”¾ 50%ï¼ˆ1/2ï¼‰ï¼Œæ­¤æ—¶ 1px CSS åƒç´  = 1 ç‰©ç†åƒç´ ï¼ˆåŸæœ¬ 2 ç‰©ç†åƒç´ ï¼Œç¼©æ”¾åå‹ç¼©ä¸º 1ï¼‰ï¼›DPR=3 æ—¶ï¼Œç¼©æ”¾ 33.3%ï¼ˆ1/3ï¼‰ï¼Œ1px CSS åƒç´  = 1 ç‰©ç†åƒç´ ã€‚</li>
</ul>
</li>
<li>
<p><strong>å‰æ</strong>ï¼šDPRâ‰¥2ï¼ˆé«˜æ¸…å±ï¼‰ï¼Œéœ€é…åˆå¸ƒå±€å•ä½ï¼ˆå¦‚ remï¼‰è°ƒæ•´ã€‚</p>
</li>
<li>
<p><strong>ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;meta <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> content=<span class="hljs-string">"width=device-width, initial-scale=1.0, user-scalable=no"</span>&gt;
&lt;script&gt;
  const <span class="hljs-attr">dpr</span> = window.devicePixelRatio || <span class="hljs-number">1</span><span class="hljs-comment">;</span>
  document.querySelector('meta<span class="hljs-section">[name="viewport"]</span>').setAttribute('content', 
    `<span class="hljs-attr">width</span>=device-width, initial-scale=<span class="hljs-variable">${1/dpr}</span>, user-scalable=<span class="hljs-literal">no</span>`
  )<span class="hljs-comment">;</span>
&lt;/script&gt;
</code></pre>
</li>
<li>
<p><strong>ä¼˜åŠ¿</strong>ï¼šç›´æ¥å†™Â <code>border: 1px</code>Â å°±æ˜¯ 1 ç‰©ç†åƒç´ ï¼Œé€‚é…æ‰€æœ‰ DPRâ‰¥2 çš„è®¾å¤‡ã€‚</p>
</li>
<li>
<p><strong>å±€é™</strong>ï¼šå…¨å±€ç¼©æ”¾ä¼šå½±å“å¸ƒå±€ï¼Œéœ€é‡æ–°è®¡ç®— rem åŸºå‡†å€¼ï¼ˆå¦‚Â <code>html { font-size: 16px * dpr }</code>ï¼‰ã€‚</p>
</li>
</ul>
<h4 data-id="heading-6">ï¼ˆäºŒï¼‰DPRâ‰¥2 æœ€ä¼˜ï¼ŒDPR=1 å¯æ¨¡æ‹Ÿï¼šè§†è§‰å±‚é¢å®ç° â€œç»†äº 1pxâ€</h4>
<p>æ ¸å¿ƒé€»è¾‘ï¼šä¸ä¾èµ–åƒç´ æ˜ å°„çš„ç²¾å‡†è®¡ç®—ï¼Œè€Œæ˜¯é€šè¿‡è§†è§‰æ¬ºéª—æˆ–çŸ¢é‡æ¸²æŸ“ï¼Œè®©çº¿æ¡çœ‹èµ·æ¥æ¯” 1px ç»†ï¼ˆDPR=1 æ—¶æ— æ³•å®ç° 1 ç‰©ç†åƒç´ ï¼Œåªèƒ½æ¨¡æ‹Ÿï¼‰ã€‚</p>
<h5 data-id="heading-7">1. SVG ç»˜åˆ¶</h5>
<ul>
<li>
<p><strong>åƒç´ å…³ç³»</strong>ï¼šSVG æ˜¯çŸ¢é‡å›¾ï¼Œä¸ä¾èµ– CSS åƒç´ å’Œç‰©ç†åƒç´ çš„æ˜ å°„ï¼Œç›´æ¥æŒ‰ â€œåæ ‡ + çº¿æ¡å®½åº¦â€ æ¸²æŸ“ã€‚</p>
<ul>
<li>DPRâ‰¥2 æ—¶ï¼š<code>stroke-width="1"</code>Â +Â <code>y1="0.5"</code>Â ç›´æ¥æ¸²æŸ“ä¸º 1 ä¸ªç‰©ç†åƒç´ ï¼ˆçŸ¢é‡æ¸²æŸ“æ”¯æŒäºšåƒç´ ç²¾å‡†æ§åˆ¶ï¼‰ã€‚</li>
<li>DPR=1 æ—¶ï¼šåŒæ ·çš„ä»£ç ä¼šæ¸²æŸ“ä¸º â€œè§†è§‰ä¸Š 0.5px ç»†çš„çº¿æ¡â€ï¼ˆå®é™…è¿˜æ˜¯ 1 ç‰©ç†åƒç´ ï¼Œä½†çŸ¢é‡ç¼©æ”¾è®©è¾¹ç¼˜æ›´ç»†è…»ï¼Œæ¯”ç›´æ¥å†™Â <code>1px</code>Â çœ‹èµ·æ¥ç»†ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>å‰æ</strong>ï¼šæ— ä¸¥æ ¼ DPR è¦æ±‚ï¼Œæ‰€æœ‰æ”¯æŒ SVG çš„æµè§ˆå™¨ï¼ˆå‡ ä¹æ‰€æœ‰ç§»åŠ¨ç«¯ï¼‰ã€‚</p>
</li>
<li>
<p><strong>ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">&lt;svg width=<span class="hljs-string">"100%"</span> height=<span class="hljs-string">"1"</span> xmlns=<span class="hljs-string">"http://www.w3.org/2000/svg"</span>&gt;
  &lt;line x1=<span class="hljs-string">"0"</span> y1=<span class="hljs-string">"0.5"</span> x2=<span class="hljs-string">"100%"</span> y2=<span class="hljs-string">"0.5"</span> stroke=<span class="hljs-string">"#000"</span> stroke-width=<span class="hljs-string">"1"</span> /&gt;
&lt;/svg&gt;
</code></pre>
</li>
</ul>
<h5 data-id="heading-8">2. èƒŒæ™¯æ¸å˜ï¼ˆ<code>background-image</code>ï¼‰</h5>
<ul>
<li>
<p><strong>åƒç´ å…³ç³»</strong>ï¼šåˆ©ç”¨ 1px é«˜çš„ CSS å®¹å™¨ï¼Œé€šè¿‡é¢œè‰²åˆ†å‰²æ¨¡æ‹Ÿ â€œåŠåƒç´ â€ã€‚</p>
<ul>
<li>DPR=2 æ—¶ï¼š1px CSS å®¹å™¨ = 2 ç‰©ç†åƒç´ é«˜ï¼Œæ¸å˜ â€œé€æ˜ 50% + æœ‰è‰² 50%â€ åˆšå¥½å¯¹åº” 1 ä¸ªç‰©ç†åƒç´ çš„æœ‰è‰²çº¿æ¡ã€‚</li>
<li>DPR=1 æ—¶ï¼š1px CSS å®¹å™¨ = 1 ç‰©ç†åƒç´ é«˜ï¼Œæ¸å˜åè§†è§‰ä¸Šæ˜¯ â€œåŠé€æ˜ç»†çº¿â€ï¼ˆæ¯”çº¯Â <code>1px</code>Â ç»†ï¼Œä½†æœ¬è´¨æ˜¯ 1 ç‰©ç†åƒç´ çš„é¢œè‰²å åŠ ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>å‰æ</strong>ï¼šæ”¯æŒ CSS3 æ¸å˜çš„æµè§ˆå™¨ï¼ˆiOS 7+ã€Android 4.4+ï¼‰ã€‚</p>
</li>
<li>
<p><strong>ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.line</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">1px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(to bottom, transparent <span class="hljs-number">50%</span>, <span class="hljs-number">#000</span> <span class="hljs-number">50%</span>);
}
</code></pre>
</li>
</ul>
<h5 data-id="heading-9">3.Â <code>box-shadow</code>Â æ¨¡æ‹Ÿ</h5>
<ul>
<li><strong>åƒç´ å…³ç³»</strong>ï¼šDPR=2 æ—¶ï¼Œ<code>box-shadow: 0 0.5px 0 #000</code>Â ä¸­ï¼Œ0.5px CSS åç§»é‡ = 1 ç‰©ç†åƒç´ ï¼Œå½¢æˆ 1 ç‰©ç†åƒç´ çš„ç»†é˜´å½±ï¼ˆè§†è§‰ä¸Šæ˜¯ç»†çº¿æ¡ï¼‰ã€‚</li>
<li><strong>å‰æ</strong>ï¼šDPRâ‰¥2ï¼ˆDPR=1 æ—¶ï¼Œ0.5px åç§» = 0.5 ç‰©ç†åƒç´ ï¼Œå±å¹•æ— æ³•æ¸²æŸ“ï¼Œé˜´å½±ä¸æ˜¾ç¤ºæˆ–æ¨¡ç³Šï¼‰ã€‚</li>
<li><strong>ä»£ç </strong>ï¼š<code>box-shadow: 0 0.5px 0 #000;</code></li>
</ul>
<h3 data-id="heading-10">ä¸‰ã€æœ€ç»ˆæ€»ç»“ï¼ˆç»“åˆåƒç´ å…³ç³»ï¼‰</h3>















































<table><thead><tr><th>å®ç°æ–¹å¼</th><th>åƒç´ æ˜ å°„é€»è¾‘ï¼ˆæ ¸å¿ƒï¼‰</th><th>ä¾èµ– DPR</th><th>è§†è§‰æ•ˆæœ</th></tr></thead><tbody><tr><td>ç›´æ¥Â <code>0.5px</code></td><td>DPRâ‰¥2 æ—¶ï¼Œ0.5px CSS = 1 ç‰©ç†åƒç´ </td><td>DPRâ‰¥2</td><td>ç²¾å‡†ç»†çº¿æ¡</td></tr><tr><td><code>transform: scale</code></td><td>DPRâ‰¥2 æ—¶ï¼Œ1px CSSï¼ˆ2 ç‰©ç†åƒç´ ï¼‰ç¼©æ”¾ 50% = 1 ç‰©ç†åƒç´ </td><td>DPRâ‰¥2</td><td>å…¼å®¹æ€§å¥½ï¼Œç²¾å‡†ç»†çº¿æ¡</td></tr><tr><td><code>viewport</code>Â ç¼©æ”¾</td><td>DPRâ‰¥2 æ—¶ï¼Œç¼©æ”¾ 1/DPR è®© 1px CSS = 1 ç‰©ç†åƒç´ </td><td>DPRâ‰¥2</td><td>å…¨å±€é€‚é…ï¼Œç²¾å‡†ç»†çº¿æ¡</td></tr><tr><td>SVG ç»˜åˆ¶</td><td>çŸ¢é‡æ¸²æŸ“ï¼Œç›´æ¥æ§åˆ¶ 1 ç‰©ç†åƒç´ ï¼ˆDPRâ‰¥2ï¼‰æˆ–æ¨¡æ‹Ÿç»†çº¿æ¡ï¼ˆDPR=1ï¼‰</td><td>æ— ï¼ˆDPRâ‰¥2 æœ€ä¼˜ï¼‰</td><td>è·¨è®¾å¤‡ï¼Œç»†è…»æ— æ¨¡ç³Š</td></tr><tr><td>èƒŒæ™¯æ¸å˜</td><td>DPRâ‰¥2 æ—¶ 1px CSSï¼ˆ2 ç‰©ç†åƒç´ ï¼‰é¢œè‰²åˆ†å‰² = 1 ç‰©ç†åƒç´ ï¼›DPR=1 æ—¶è§†è§‰æ¬ºéª—</td><td>æ— ï¼ˆDPRâ‰¥2 æœ€ä¼˜ï¼‰</td><td>æ¨¡æ‹Ÿç»†çº¿æ¡ï¼Œæ— å…¼å®¹æ€§é—®é¢˜</td></tr><tr><td><code>box-shadow</code></td><td>DPRâ‰¥2 æ—¶ï¼Œ0.5px CSS åç§» = 1 ç‰©ç†åƒç´ é˜´å½±</td><td>DPRâ‰¥2</td><td>éè¾¹æ¡†çº¿æ¡é€‚ç”¨</td></tr></tbody></table>
<p><strong>æ ¸å¿ƒä¸€å¥è¯</strong>ï¼šæ‰€æœ‰ â€œçœŸå® 0.5px æ•ˆæœâ€ï¼ˆ1 ç‰©ç†åƒç´ ï¼‰éƒ½ä¾èµ– DPRâ‰¥2 çš„é«˜æ¸…å±ï¼ˆåˆ©ç”¨ CSS åƒç´ ä¸ç‰©ç†åƒç´ çš„æ˜ å°„å…³ç³»ï¼‰ï¼›DPR=1 æ—¶åªèƒ½æ¨¡æ‹Ÿï¼Œæ— æ³•å®ç°ç‰©ç†çº§åŠåƒç´ ã€‚</p>
<h3 data-id="heading-11">ä»¥ä¸‹æ˜¯åŒ…å«Â <strong>CSS åƒç´  / ç‰©ç†åƒç´  / DPR å…³ç³»è¯´æ˜</strong>Â çš„ 0.5px å…¼å®¹ä»£ç åˆé›†ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½æ ‡æ³¨æ ¸å¿ƒé€»è¾‘å’Œé€‚ç”¨åœºæ™¯ï¼Œå¯ç›´æ¥å¤åˆ¶ä½¿ç”¨ï¼š</h3>
<h3 data-id="heading-12">ä¸€ã€è¯´æ˜ï¼ˆæ‰€æœ‰æ–¹æ³•é€šç”¨ï¼‰</h3>
<ul>
<li>æ ¸å¿ƒç›®æ ‡ï¼šè®©çº¿æ¡æœ€ç»ˆå ç”¨Â <strong>1 ä¸ªç‰©ç†åƒç´ </strong>ï¼ˆè§†è§‰æœ€ç»†ï¼‰ã€‚</li>
<li>åƒç´ å…³ç³»ï¼š<code>1 CSS åƒç´  = DPR Ã— DPR ç‰©ç†åƒç´ </code>ï¼ˆé»˜è®¤ç¼©æ”¾ 1 æ—¶ï¼‰ï¼Œé«˜æ¸…å±ï¼ˆDPRâ‰¥2ï¼‰éœ€é€šè¿‡ä»£ç  â€œå‹ç¼©â€ æ˜ å°„å…³ç³»ã€‚</li>
<li>é€‚é…åŸåˆ™ï¼šä¼˜å…ˆé€‰å…¼å®¹æ€§å¹¿ã€æ— å¸ƒå±€å½±å“çš„æ–¹æ³•ï¼ˆå¦‚ SVGã€transform ç¼©æ”¾ï¼‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-13">äºŒã€6 ç§å®ç”¨å…¼å®¹ä»£ç </h3>
<h4 data-id="heading-14">1. æ¨èé¦–é€‰ï¼štransform: scale (0.5) ç¼©æ”¾ï¼ˆDPRâ‰¥2 ç”Ÿæ•ˆï¼Œå…¼å®¹æ€§æœ€å¥½ï¼‰</h4>
<ul>
<li>æ ¸å¿ƒé€»è¾‘ï¼š1px CSS åƒç´ ï¼ˆDPR=2 æ—¶å¯¹åº” 2 ç‰©ç†åƒç´ ï¼‰â†’ ç¼©æ”¾ 50% â†’ æœ€ç»ˆ 1 ç‰©ç†åƒç´ ã€‚</li>
<li>é€‚ç”¨åœºæ™¯ï¼šè¾¹æ¡†ã€ç‹¬ç«‹çº¿æ¡ï¼Œä¸å½±å“å¸ƒå±€ã€‚</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* é€šç”¨ç»†çº¿æ¡ç±»ï¼ˆä¸Šä¸‹å·¦å³å¯æŒ‰éœ€è°ƒæ•´ï¼‰ */</span>
<span class="hljs-selector-class">.thin-line</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-comment">/* çˆ¶å®¹å™¨éœ€è§¦å‘ BFCï¼Œé¿å…çº¿æ¡æº¢å‡º */</span>
  <span class="hljs-attribute">overflow</span>: hidden;
}

<span class="hljs-selector-class">.thin-line</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">""</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">1px</span>; <span class="hljs-comment">/* 1px CSS = 2 ç‰©ç†åƒç´ ï¼ˆDPR=2ï¼‰ */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#000</span>; <span class="hljs-comment">/* çº¿æ¡é¢œè‰² */</span>
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">0.5</span>); <span class="hljs-comment">/* å‚ç›´ç¼©æ”¾ 50% â†’ 2 ç‰©ç†åƒç´  â†’ 1 ç‰©ç†åƒç´  */</span>
  <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span>; <span class="hljs-comment">/* ç¼©æ”¾åŸç‚¹é¿å…åç§» */</span>
}

<span class="hljs-comment">/* æ¨ªå‘çº¿æ¡ï¼ˆé»˜è®¤ï¼‰ã€çºµå‘çº¿æ¡ï¼ˆæŒ‰éœ€æ·»åŠ ï¼‰ */</span>
<span class="hljs-selector-class">.thin-line-vertical</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">1px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleX</span>(<span class="hljs-number">0.5</span>);
}
</code></pre>
<ul>
<li>ä½¿ç”¨æ–¹å¼ï¼š<code>&lt;div class="thin-line"&gt;å†…å®¹&lt;/div&gt;</code></li>
</ul>
<hr/>
<h4 data-id="heading-15">2. è·¨ DPR ä¼˜é€‰ï¼šSVG ç»˜åˆ¶ï¼ˆæ‰€æœ‰è®¾å¤‡é€‚é…ï¼Œç²¾å‡†æ— æ¨¡ç³Šï¼‰</h4>
<ul>
<li>æ ¸å¿ƒé€»è¾‘ï¼šSVG çŸ¢é‡æ¸²æŸ“ä¸ä¾èµ–åƒç´ æ˜ å°„ï¼Œç›´æ¥æŒ‡å®š 1 ç‰©ç†åƒç´ çº¿æ¡ï¼ˆDPRâ‰¥2 ç²¾å‡†ï¼ŒDPR=1 æ¨¡æ‹Ÿç»†çº¿æ¡ï¼‰ã€‚</li>
<li>é€‚ç”¨åœºæ™¯ï¼šUI ä¸¥æ ¼è¿˜åŸã€è·¨è®¾å¤‡å…¼å®¹ï¼ˆæ¨èç”¨äºåˆ†å‰²çº¿ã€è¾¹æ¡†ï¼‰ã€‚</li>
</ul>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- æ¨ªå‘ç»†çº¿æ¡ï¼ˆç›´æ¥åµŒå…¥ï¼Œå¯å¤ç”¨ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"svg-thin-line"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"100%"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"1"</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.w3.org/2000/svg"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- y1="0.5" + stroke-width="1" â†’ ç›´æ¥å¯¹åº” 1 ç‰©ç†åƒç´ ï¼ˆDPRâ‰¥2ï¼‰ --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">line</span> <span class="hljs-attr">x1</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">y1</span>=<span class="hljs-string">"0.5"</span> <span class="hljs-attr">x2</span>=<span class="hljs-string">"100%"</span> <span class="hljs-attr">y2</span>=<span class="hljs-string">"0.5"</span> <span class="hljs-attr">stroke</span>=<span class="hljs-string">"#000"</span> <span class="hljs-attr">stroke-width</span>=<span class="hljs-string">"1"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>

<span class="hljs-comment">&lt;!-- çºµå‘ç»†çº¿æ¡ï¼ˆå®½åº¦ 100%ï¼Œé«˜åº¦è‡ªé€‚åº”ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"svg-thin-line-vertical"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"1"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"100%"</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.w3.org/2000/svg"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">line</span> <span class="hljs-attr">x1</span>=<span class="hljs-string">"0.5"</span> <span class="hljs-attr">y1</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">x2</span>=<span class="hljs-string">"0.5"</span> <span class="hljs-attr">y2</span>=<span class="hljs-string">"100%"</span> <span class="hljs-attr">stroke</span>=<span class="hljs-string">"#000"</span> <span class="hljs-attr">stroke-width</span>=<span class="hljs-string">"1"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>

<span class="hljs-comment">&lt;!-- æ ·å¼ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
  <span class="hljs-selector-class">.svg-thin-line</span> {
    <span class="hljs-attribute">display</span>: block;
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">8px</span> <span class="hljs-number">0</span>; <span class="hljs-comment">/* ä¸Šä¸‹é—´è· */</span>
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<ul>
<li>ä½¿ç”¨æ–¹å¼ï¼šç›´æ¥åµŒå…¥ HTMLï¼Œä¿®æ”¹Â <code>stroke</code>Â é¢œè‰²ã€<code>width</code>/<code>height</code>Â é€‚é…åœºæ™¯ã€‚</li>
</ul>
<hr/>
<h4 data-id="heading-16">3. ç°ä»£è®¾å¤‡ï¼šç›´æ¥ 0.5px å£°æ˜ï¼ˆç®€æ´é«˜æ•ˆï¼ŒDPRâ‰¥2 + ç°ä»£æµè§ˆå™¨ï¼‰</h4>
<ul>
<li>æ ¸å¿ƒé€»è¾‘ï¼šDPR=2 æ—¶ï¼Œ0.5px CSS åƒç´  = 1 ç‰©ç†åƒç´ ï¼Œæµè§ˆå™¨ç›´æ¥æ¸²æŸ“ã€‚</li>
<li>é€‚ç”¨åœºæ™¯ï¼šiOS 9+ã€Android 8.0+ è®¾å¤‡ï¼Œæ— éœ€å…¼å®¹æ—§æœºå‹ã€‚</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* ç›´æ¥å£°æ˜ï¼Œç®€æ´é«˜æ•ˆ */</span>
<span class="hljs-selector-class">.simple-thin-line</span> {
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">0.5px</span> solid <span class="hljs-number">#000</span>; <span class="hljs-comment">/* æ¨ªå‘çº¿æ¡ */</span>
  <span class="hljs-comment">/* çºµå‘çº¿æ¡ï¼šborder-left: 0.5px solid #000; */</span>
}

<span class="hljs-comment">/* å…¼å®¹å†™æ³•ï¼ˆéƒ¨åˆ†æµè§ˆå™¨éœ€å‰ç¼€ï¼‰ */</span>
<span class="hljs-selector-class">.compact-thin-line</span> {
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">0.5px</span> solid <span class="hljs-number">#000</span>;
  -webkit-<span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">0.5px</span> solid <span class="hljs-number">#000</span>;
}
</code></pre>
<ul>
<li>ä½¿ç”¨æ–¹å¼ï¼š<code>&lt;div class="simple-thin-line"&gt;å†…å®¹&lt;/div&gt;</code></li>
</ul>
<hr/>
<h4 data-id="heading-17">4. å…¨å±€é€‚é…ï¼šviewport ç¼©æ”¾ï¼ˆDPRâ‰¥2ï¼Œå…¨å±€ç»†çº¿æ¡ç»Ÿä¸€ï¼‰</h4>
<ul>
<li>æ ¸å¿ƒé€»è¾‘ï¼šç¼©æ”¾é¡µé¢ä¸ºÂ <code>1/DPR</code>ï¼Œè®© 1px CSS åƒç´  = 1 ç‰©ç†åƒç´ ï¼ˆéœ€é…åˆ rem å¸ƒå±€ï¼‰ã€‚</li>
<li>é€‚ç”¨åœºæ™¯ï¼šæ•´ä¸ªé¡µé¢éœ€è¦å¤§é‡ç»†çº¿æ¡ï¼Œæ„¿æ„è°ƒæ•´å¸ƒå±€å•ä½ã€‚</li>
</ul>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- ç¬¬ä¸€æ­¥ï¼šè®¾ç½® viewportï¼ˆåˆå§‹ç¼©æ”¾ 1.0ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, user-scalable=no"</span>&gt;</span>

<span class="hljs-comment">&lt;!-- ç¬¬äºŒæ­¥ï¼šåŠ¨æ€è°ƒæ•´ç¼©æ”¾æ¯”ä¾‹ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  (<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> dpr = <span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span> || <span class="hljs-number">1</span>;
    <span class="hljs-keyword">const</span> viewport = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'viewport'</span>);
    <span class="hljs-comment">// ç¼©æ”¾ 1/DPRï¼Œè®© 1px CSS = 1 ç‰©ç†åƒç´ ï¼ˆDPR=2 â†’ ç¼©æ”¾ 50%ï¼‰</span>
    viewport.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'content'</span>, <span class="hljs-string">`width=device-width, initial-scale=<span class="hljs-subst">${<span class="hljs-number">1</span>/dpr}</span>, user-scalable=no`</span>);
    
    <span class="hljs-comment">// å¯é€‰ï¼šè°ƒæ•´ rem åŸºå‡†å€¼ï¼ˆé¿å…å¸ƒå±€é”™ä¹±ï¼‰</span>
    <span class="hljs-keyword">const</span> html = <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>;
    html.<span class="hljs-property">style</span>.<span class="hljs-property">fontSize</span> = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-number">16</span> * dpr}</span>px`</span>; <span class="hljs-comment">// 1rem = 16*dpr pxï¼ˆé€‚é…ç¼©æ”¾åå¸ƒå±€ï¼‰</span>
  })();
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- ç¬¬ä¸‰æ­¥ï¼šç›´æ¥å†™ 1px å³å¯ï¼ˆæ­¤æ—¶ 1px = 1 ç‰©ç†åƒç´ ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
  <span class="hljs-selector-class">.global-thin-line</span> {
    <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#000</span>; <span class="hljs-comment">/* å®é™…æ˜¯ 1 ç‰©ç†åƒç´ ç»†çº¿æ¡ */</span>
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0.5rem</span> <span class="hljs-number">0</span>; <span class="hljs-comment">/* rem å•ä½é€‚é…ç¼©æ”¾åå¸ƒå±€ */</span>
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<ul>
<li>ä½¿ç”¨æ–¹å¼ï¼šå…¨å±€å¼•å…¥è„šæœ¬ï¼Œä¹‹åæ‰€æœ‰Â <code>1px</code>Â è¾¹æ¡†éƒ½ä¼šå˜æˆç»†çº¿æ¡ã€‚</li>
</ul>
<hr/>
<h4 data-id="heading-18">5. è§†è§‰æ¨¡æ‹Ÿï¼šèƒŒæ™¯æ¸å˜ï¼ˆæ— å…¼å®¹æ€§é—®é¢˜ï¼ŒDPRâ‰¥2 æœ€ä¼˜ï¼‰</h4>
<ul>
<li>æ ¸å¿ƒé€»è¾‘ï¼š1px CSS å®¹å™¨ï¼ˆDPR=2 æ—¶ 2 ç‰©ç†åƒç´ ï¼‰â†’ é¢œè‰²åˆ†å‰²ä¸º 50% é€æ˜ + 50% æœ‰è‰² â†’ è§†è§‰ä¸Š 1 ç‰©ç†åƒç´ ã€‚</li>
<li>é€‚ç”¨åœºæ™¯ï¼šèƒŒæ™¯çº¿æ¡ã€æ— æ³•ç”¨è¾¹æ¡† / ä¼ªå…ƒç´ çš„åœºæ™¯ã€‚</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* æ¨ªå‘çº¿æ¡ */</span>
<span class="hljs-selector-class">.gradient-thin-line</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">1px</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-comment">/* ä¸ŠåŠé€æ˜ï¼Œä¸‹åŠæœ‰è‰² â†’ è§†è§‰ä¸Šç»†çº¿æ¡ */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(to bottom, transparent <span class="hljs-number">50%</span>, <span class="hljs-number">#000</span> <span class="hljs-number">50%</span>);
  <span class="hljs-attribute">background-size</span>: <span class="hljs-number">100%</span> <span class="hljs-number">1px</span>;
}

<span class="hljs-comment">/* çºµå‘çº¿æ¡ */</span>
<span class="hljs-selector-class">.gradient-thin-line-vertical</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">1px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(to right, transparent <span class="hljs-number">50%</span>, <span class="hljs-number">#000</span> <span class="hljs-number">50%</span>);
  <span class="hljs-attribute">background-size</span>: <span class="hljs-number">1px</span> <span class="hljs-number">100%</span>;
}
</code></pre>
<ul>
<li>ä½¿ç”¨æ–¹å¼ï¼š<code>&lt;div class="gradient-thin-line"&gt;&lt;/div&gt;</code>ï¼ˆç‹¬ç«‹çº¿æ¡å®¹å™¨ï¼‰ã€‚</li>
</ul>
<hr/>
<h4 data-id="heading-19">6. éè¾¹æ¡†åœºæ™¯ï¼šbox-shadow æ¨¡æ‹Ÿï¼ˆDPRâ‰¥2ï¼Œé€‚åˆé˜´å½±ç±»çº¿æ¡ï¼‰</h4>
<ul>
<li>æ ¸å¿ƒé€»è¾‘ï¼šDPR=2 æ—¶ï¼Œ0.5px CSS åç§» = 1 ç‰©ç†åƒç´ ï¼Œé˜´å½±å³ç»†çº¿æ¡ã€‚</li>
<li>é€‚ç”¨åœºæ™¯ï¼šæ— éœ€å ç”¨å¸ƒå±€ç©ºé—´çš„çº¿æ¡ï¼ˆå¦‚æ–‡å­—ä¸‹æ–¹ç»†ä¸‹åˆ’çº¿ï¼‰ã€‚</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.shadow-thin-line</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">0</span>;
  <span class="hljs-comment">/* y è½´åç§» 0.5px â†’ 1 ç‰©ç†åƒç´ ï¼Œæ— æ¨¡ç³Šã€æ— æ‰©æ•£ */</span>
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0.5px</span> <span class="hljs-number">0</span> <span class="hljs-number">#000</span>;
  -webkit-<span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0.5px</span> <span class="hljs-number">0</span> <span class="hljs-number">#000</span>; <span class="hljs-comment">/* å…¼å®¹ Safari */</span>
}

<span class="hljs-comment">/* æ–‡å­—ä¸‹åˆ’çº¿ç¤ºä¾‹ */</span>
<span class="hljs-selector-class">.text-thin-underline</span> {
  <span class="hljs-attribute">display</span>: inline-block;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0.5px</span> <span class="hljs-number">0</span> <span class="hljs-number">#000</span>;
  <span class="hljs-attribute">padding-bottom</span>: <span class="hljs-number">2px</span>;
}
</code></pre>
<ul>
<li>ä½¿ç”¨æ–¹å¼ï¼š<code>&lt;span class="text-thin-underline"&gt;å¸¦ç»†ä¸‹åˆ’çº¿çš„æ–‡å­—&lt;/span&gt;</code></li>
</ul>
<hr/>
<h3 data-id="heading-20">ä¸‰ã€ä½¿ç”¨å»ºè®®</h3>
<ol>
<li>ä¼˜å…ˆé€‰Â <strong>transform ç¼©æ”¾</strong>Â æˆ–Â <strong>SVG ç»˜åˆ¶</strong>ï¼šå…¼å®¹æ€§å¹¿ã€æ— å¸ƒå±€å½±å“ï¼Œè¦†ç›– 99% åœºæ™¯ã€‚</li>
<li>ç°ä»£è®¾å¤‡ï¼ˆiOS 9+/Android 8.0+ï¼‰ç›´æ¥ç”¨Â <strong>0.5px å£°æ˜</strong>ï¼šä»£ç æœ€ç®€æ´ã€‚</li>
<li>å…¨å±€å¤§é‡ç»†çº¿æ¡ç”¨Â <strong>viewport ç¼©æ”¾</strong>ï¼šéœ€é…åˆ rem å¸ƒå±€ï¼Œä¸€æ¬¡æ€§è§£å†³æ‰€æœ‰çº¿æ¡é—®é¢˜ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Javaå­¦ä¹ ç¬¬29å¤© - ä¼ä¸šçº§ç³»ç»Ÿæ¶æ„ä¸å®æˆ˜]]></title>    <link>https://juejin.cn/post/7572028313931104296</link>    <guid>https://juejin.cn/post/7572028313931104296</guid>    <pubDate>2025-11-14T02:12:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572028313931104296" data-draft-id="7572051762984550452" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Javaå­¦ä¹ ç¬¬29å¤© - ä¼ä¸šçº§ç³»ç»Ÿæ¶æ„ä¸å®æˆ˜"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-14T02:12:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æµ®æ¸¸æœ¬å°Š"/> <meta itemprop="url" content="https://juejin.cn/user/2533726710668696"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Javaå­¦ä¹ ç¬¬29å¤© - ä¼ä¸šçº§ç³»ç»Ÿæ¶æ„ä¸å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2533726710668696/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æµ®æ¸¸æœ¬å°Š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T02:12:58.000Z" title="Fri Nov 14 2025 02:12:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    15
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å­¦ä¹ ç›®æ ‡</h2>
<p>æŒæ¡ä¼ä¸šçº§ç³»ç»Ÿæ¶æ„è®¾è®¡æ–¹æ³•ï¼Œå­¦ä¹ é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡æ¨¡å¼ï¼Œæ·±å…¥ç†è§£åˆ†å¸ƒå¼é”ä¸IDç”Ÿæˆï¼ŒæŒæ¡ç³»ç»Ÿæ¶æ„æ¼”è¿›è·¯å¾„ï¼Œå­¦ä¹ ä¼ä¸šçº§å¼€å‘æœ€ä½³å®è·µã€‚</p>
<hr/>
<h2 data-id="heading-1">1. ä¼ä¸šçº§æ¶æ„è®¾è®¡</h2>
<h3 data-id="heading-2">1.1 é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰</h3>
<p><strong>DDDæ ¸å¿ƒæ¦‚å¿µå®ç°ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å®ä½“ï¼ˆEntityï¼‰- æœ‰å”¯ä¸€æ ‡è¯†</span>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "t_order")</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span> {
    
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-keyword">private</span> String orderNumber;
    <span class="hljs-keyword">private</span> Long userId;
    <span class="hljs-keyword">private</span> BigDecimal totalAmount;
    <span class="hljs-keyword">private</span> OrderStatus status;
    <span class="hljs-keyword">private</span> Date createTime;
    
    <span class="hljs-comment">// é¢†åŸŸè¡Œä¸º</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">confirm</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.status != OrderStatus.PENDING) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"åªæœ‰å¾…ç¡®è®¤è®¢å•æ‰èƒ½ç¡®è®¤"</span>);
        }
        <span class="hljs-built_in">this</span>.status = OrderStatus.CONFIRMED;
        log.info(<span class="hljs-string">"è®¢å•ç¡®è®¤: orderNumber={}"</span>, <span class="hljs-built_in">this</span>.orderNumber);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancel</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.status == OrderStatus.COMPLETED || <span class="hljs-built_in">this</span>.status == OrderStatus.CANCELLED) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"å·²å®Œæˆæˆ–å·²å–æ¶ˆçš„è®¢å•ä¸èƒ½å–æ¶ˆ"</span>);
        }
        <span class="hljs-built_in">this</span>.status = OrderStatus.CANCELLED;
        log.info(<span class="hljs-string">"è®¢å•å–æ¶ˆ: orderNumber={}"</span>, <span class="hljs-built_in">this</span>.orderNumber);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pay</span><span class="hljs-params">(BigDecimal amount)</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.status != OrderStatus.CONFIRMED) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"åªæœ‰å·²ç¡®è®¤è®¢å•æ‰èƒ½æ”¯ä»˜"</span>);
        }
        <span class="hljs-keyword">if</span> (amount.compareTo(<span class="hljs-built_in">this</span>.totalAmount) != <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"æ”¯ä»˜é‡‘é¢ä¸è®¢å•é‡‘é¢ä¸åŒ¹é…"</span>);
        }
        <span class="hljs-built_in">this</span>.status = OrderStatus.PAID;
        log.info(<span class="hljs-string">"è®¢å•æ”¯ä»˜: orderNumber={}, amount={}"</span>, <span class="hljs-built_in">this</span>.orderNumber, amount);
    }
}

<span class="hljs-comment">// å€¼å¯¹è±¡ï¼ˆValue Objectï¼‰- æ— å”¯ä¸€æ ‡è¯†ï¼Œé€šè¿‡å±æ€§å€¼åˆ¤æ–­ç›¸ç­‰</span>
<span class="hljs-meta">@Embeddable</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> {
    
    <span class="hljs-keyword">private</span> String province;
    <span class="hljs-keyword">private</span> String city;
    <span class="hljs-keyword">private</span> String district;
    <span class="hljs-keyword">private</span> String street;
    <span class="hljs-keyword">private</span> String zipCode;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">(String province, String city, String district, String street, String zipCode)</span> {
        <span class="hljs-built_in">this</span>.province = province;
        <span class="hljs-built_in">this</span>.city = city;
        <span class="hljs-built_in">this</span>.district = district;
        <span class="hljs-built_in">this</span>.street = street;
        <span class="hljs-built_in">this</span>.zipCode = zipCode;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">equals</span><span class="hljs-params">(Object o)</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span> == o) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">if</span> (o == <span class="hljs-literal">null</span> || getClass() != o.getClass()) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-type">Address</span> <span class="hljs-variable">address</span> <span class="hljs-operator">=</span> (Address) o;
        <span class="hljs-keyword">return</span> Objects.equals(province, address.province) &amp;&amp;
               Objects.equals(city, address.city) &amp;&amp;
               Objects.equals(district, address.district) &amp;&amp;
               Objects.equals(street, address.street) &amp;&amp;
               Objects.equals(zipCode, address.zipCode);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> Objects.hash(province, city, district, street, zipCode);
    }
}

<span class="hljs-comment">// èšåˆæ ¹ï¼ˆAggregate Rootï¼‰- èšåˆçš„å…¥å£</span>
<span class="hljs-meta">@AggregateRoot</span>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "t_order")</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderAggregate</span> {
    
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-keyword">private</span> String orderNumber;
    <span class="hljs-keyword">private</span> Long userId;
    
    <span class="hljs-meta">@Embedded</span>
    <span class="hljs-keyword">private</span> Address shippingAddress;
    
    <span class="hljs-meta">@OneToMany(cascade = CascadeType.ALL, fetch = FetchType.LAZY)</span>
    <span class="hljs-meta">@JoinColumn(name = "order_id")</span>
    <span class="hljs-keyword">private</span> List&lt;OrderItem&gt; items;
    
    <span class="hljs-keyword">private</span> OrderStatus status;
    
    <span class="hljs-comment">// èšåˆå†…éƒ¨ä¸€è‡´æ€§ä¿è¯</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addItem</span><span class="hljs-params">(OrderItem item)</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.items == <span class="hljs-literal">null</span>) {
            <span class="hljs-built_in">this</span>.items = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        }
        
        <span class="hljs-comment">// ä¸šåŠ¡è§„åˆ™ï¼šè®¢å•é¡¹ä¸èƒ½é‡å¤æ·»åŠ </span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">exists</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.items.stream()
            .anyMatch(i -&gt; i.getProductId().equals(item.getProductId()));
        <span class="hljs-keyword">if</span> (exists) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"è®¢å•é¡¹å·²å­˜åœ¨"</span>);
        }
        
        <span class="hljs-built_in">this</span>.items.add(item);
        log.info(<span class="hljs-string">"æ·»åŠ è®¢å•é¡¹: orderNumber={}, productId={}"</span>, <span class="hljs-built_in">this</span>.orderNumber, item.getProductId());
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeItem</span><span class="hljs-params">(Long productId)</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.items == <span class="hljs-literal">null</span> || <span class="hljs-built_in">this</span>.items.isEmpty()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"è®¢å•é¡¹ä¸ºç©º"</span>);
        }
        
        <span class="hljs-type">boolean</span> <span class="hljs-variable">removed</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.items.removeIf(item -&gt; item.getProductId().equals(productId));
        <span class="hljs-keyword">if</span> (!removed) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"è®¢å•é¡¹ä¸å­˜åœ¨"</span>);
        }
        
        log.info(<span class="hljs-string">"ç§»é™¤è®¢å•é¡¹: orderNumber={}, productId={}"</span>, <span class="hljs-built_in">this</span>.orderNumber, productId);
    }
    
    <span class="hljs-comment">// è®¡ç®—è®¢å•æ€»é‡‘é¢</span>
    <span class="hljs-keyword">public</span> BigDecimal <span class="hljs-title function_">calculateTotal</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.items == <span class="hljs-literal">null</span> || <span class="hljs-built_in">this</span>.items.isEmpty()) {
            <span class="hljs-keyword">return</span> BigDecimal.ZERO;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.items.stream()
            .map(item -&gt; item.getPrice().multiply(BigDecimal.valueOf(item.getQuantity())))
            .reduce(BigDecimal.ZERO, BigDecimal::add);
    }
}

<span class="hljs-comment">// é¢†åŸŸæœåŠ¡ï¼ˆDomain Serviceï¼‰- ä¸å±äºä»»ä½•å®ä½“çš„ä¸šåŠ¡é€»è¾‘</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderDomainService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderRepository orderRepository;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> InventoryService inventoryService;
    
    <span class="hljs-comment">// é¢†åŸŸæœåŠ¡ï¼šå¤„ç†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Long userId, List&lt;OrderItem&gt; items, Address shippingAddress)</span> {
        <span class="hljs-comment">// 1. éªŒè¯åº“å­˜</span>
        <span class="hljs-keyword">for</span> (OrderItem item : items) {
            <span class="hljs-type">boolean</span> <span class="hljs-variable">available</span> <span class="hljs-operator">=</span> inventoryService.checkAvailability(item.getProductId(), item.getQuantity());
            <span class="hljs-keyword">if</span> (!available) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InsufficientInventoryException</span>(<span class="hljs-string">"åº“å­˜ä¸è¶³: productId="</span> + item.getProductId());
            }
        }
        
        <span class="hljs-comment">// 2. åˆ›å»ºè®¢å•</span>
        <span class="hljs-type">OrderAggregate</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderAggregate</span>();
        order.setOrderNumber(generateOrderNumber());
        order.setUserId(userId);
        order.setShippingAddress(shippingAddress);
        order.setStatus(OrderStatus.PENDING);
        
        <span class="hljs-comment">// 3. æ·»åŠ è®¢å•é¡¹</span>
        <span class="hljs-keyword">for</span> (OrderItem item : items) {
            order.addItem(item);
        }
        
        <span class="hljs-comment">// 4. ä¿å­˜è®¢å•</span>
        orderRepository.save(order);
        
        <span class="hljs-comment">// 5. æ‰£å‡åº“å­˜</span>
        <span class="hljs-keyword">for</span> (OrderItem item : items) {
            inventoryService.deductInventory(item.getProductId(), item.getQuantity());
        }
        
        log.info(<span class="hljs-string">"åˆ›å»ºè®¢å•æˆåŠŸ: orderNumber={}, userId={}"</span>, order.getOrderNumber(), userId);
        <span class="hljs-keyword">return</span> convertToOrder(order);
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">generateOrderNumber</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ORD"</span> + System.currentTimeMillis() + (<span class="hljs-type">int</span>)(Math.random() * <span class="hljs-number">1000</span>);
    }
    
    <span class="hljs-keyword">private</span> Order <span class="hljs-title function_">convertToOrder</span><span class="hljs-params">(OrderAggregate aggregate)</span> {
        <span class="hljs-comment">// è½¬æ¢ä¸ºOrderå®ä½“</span>
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>();
        order.setId(aggregate.getId());
        order.setOrderNumber(aggregate.getOrderNumber());
        order.setUserId(aggregate.getUserId());
        order.setStatus(aggregate.getStatus());
        <span class="hljs-keyword">return</span> order;
    }
}

<span class="hljs-comment">// é¢†åŸŸäº‹ä»¶ï¼ˆDomain Eventï¼‰</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderCreatedEvent</span> {
    <span class="hljs-keyword">private</span> String orderNumber;
    <span class="hljs-keyword">private</span> Long userId;
    <span class="hljs-keyword">private</span> BigDecimal totalAmount;
    <span class="hljs-keyword">private</span> Date createTime;
}

<span class="hljs-comment">// é¢†åŸŸäº‹ä»¶å‘å¸ƒå™¨</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DomainEventPublisher</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ApplicationEventPublisher eventPublisher;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">publish</span><span class="hljs-params">(DomainEvent event)</span> {
        log.info(<span class="hljs-string">"å‘å¸ƒé¢†åŸŸäº‹ä»¶: {}"</span>, event.getClass().getSimpleName());
        eventPublisher.publishEvent(event);
    }
}

<span class="hljs-comment">// é¢†åŸŸäº‹ä»¶å¤„ç†å™¨</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderEventHandler</span> {
    
    <span class="hljs-meta">@EventListener</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleOrderCreated</span><span class="hljs-params">(OrderCreatedEvent event)</span> {
        log.info(<span class="hljs-string">"å¤„ç†è®¢å•åˆ›å»ºäº‹ä»¶: orderNumber={}"</span>, event.getOrderNumber());
        <span class="hljs-comment">// å‘é€é€šçŸ¥ã€æ›´æ–°ç»Ÿè®¡ç­‰</span>
    }
}
</code></pre>
<h3 data-id="heading-3">1.2 CQRSï¼ˆå‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»ï¼‰</h3>
<p><strong>CQRSå®ç°ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å‘½ä»¤ï¼ˆCommandï¼‰- å†™æ“ä½œ</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CreateOrderCommand</span> {
    <span class="hljs-keyword">private</span> Long userId;
    <span class="hljs-keyword">private</span> List&lt;OrderItemDTO&gt; items;
    <span class="hljs-keyword">private</span> AddressDTO shippingAddress;
}

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CancelOrderCommand</span> {
    <span class="hljs-keyword">private</span> String orderNumber;
    <span class="hljs-keyword">private</span> String reason;
}

<span class="hljs-comment">// å‘½ä»¤å¤„ç†å™¨</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderCommandHandler</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderDomainService orderDomainService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderWriteRepository orderWriteRepository;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(CreateOrderCommand command)</span> {
        <span class="hljs-comment">// æ‰§è¡Œå†™æ“ä½œ</span>
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderDomainService.createOrder(
            command.getUserId(),
            convertToOrderItems(command.getItems()),
            convertToAddress(command.getShippingAddress())
        );
        
        orderWriteRepository.save(order);
        log.info(<span class="hljs-string">"å¤„ç†åˆ›å»ºè®¢å•å‘½ä»¤: userId={}"</span>, command.getUserId());
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(CancelOrderCommand command)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderWriteRepository.findByOrderNumber(command.getOrderNumber());
        <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderNotFoundException</span>(<span class="hljs-string">"è®¢å•ä¸å­˜åœ¨: "</span> + command.getOrderNumber());
        }
        
        order.cancel();
        orderWriteRepository.save(order);
        log.info(<span class="hljs-string">"å¤„ç†å–æ¶ˆè®¢å•å‘½ä»¤: orderNumber={}"</span>, command.getOrderNumber());
    }
    
    <span class="hljs-keyword">private</span> List&lt;OrderItem&gt; <span class="hljs-title function_">convertToOrderItems</span><span class="hljs-params">(List&lt;OrderItemDTO&gt; dtos)</span> {
        <span class="hljs-keyword">return</span> dtos.stream()
            .map(dto -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderItem</span>(dto.getProductId(), dto.getQuantity(), dto.getPrice()))
            .collect(Collectors.toList());
    }
    
    <span class="hljs-keyword">private</span> Address <span class="hljs-title function_">convertToAddress</span><span class="hljs-params">(AddressDTO dto)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(dto.getProvince(), dto.getCity(), dto.getDistrict(), 
                          dto.getStreet(), dto.getZipCode());
    }
}

<span class="hljs-comment">// æŸ¥è¯¢ï¼ˆQueryï¼‰- è¯»æ“ä½œ</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GetOrderQuery</span> {
    <span class="hljs-keyword">private</span> String orderNumber;
}

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GetUserOrdersQuery</span> {
    <span class="hljs-keyword">private</span> Long userId;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> page;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> size;
}

<span class="hljs-comment">// æŸ¥è¯¢å¤„ç†å™¨</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderQueryHandler</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderReadRepository orderReadRepository;
    
    <span class="hljs-keyword">public</span> OrderDTO <span class="hljs-title function_">handle</span><span class="hljs-params">(GetOrderQuery query)</span> {
        <span class="hljs-type">OrderReadModel</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderReadRepository.findByOrderNumber(query.getOrderNumber());
        <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderNotFoundException</span>(<span class="hljs-string">"è®¢å•ä¸å­˜åœ¨: "</span> + query.getOrderNumber());
        }
        <span class="hljs-keyword">return</span> convertToDTO(order);
    }
    
    <span class="hljs-keyword">public</span> Page&lt;OrderDTO&gt; <span class="hljs-title function_">handle</span><span class="hljs-params">(GetUserOrdersQuery query)</span> {
        Page&lt;OrderReadModel&gt; orders = orderReadRepository.findByUserId(
            query.getUserId(), 
            PageRequest.of(query.getPage(), query.getSize())
        );
        <span class="hljs-keyword">return</span> orders.map(<span class="hljs-built_in">this</span>::convertToDTO);
    }
    
    <span class="hljs-keyword">private</span> OrderDTO <span class="hljs-title function_">convertToDTO</span><span class="hljs-params">(OrderReadModel model)</span> {
        <span class="hljs-type">OrderDTO</span> <span class="hljs-variable">dto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderDTO</span>();
        dto.setOrderNumber(model.getOrderNumber());
        dto.setUserId(model.getUserId());
        dto.setTotalAmount(model.getTotalAmount());
        dto.setStatus(model.getStatus());
        dto.setCreateTime(model.getCreateTime());
        <span class="hljs-keyword">return</span> dto;
    }
}

<span class="hljs-comment">// è¯»å†™åˆ†ç¦»çš„Repository</span>
<span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderWriteRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;Order, Long&gt; {
    Order <span class="hljs-title function_">findByOrderNumber</span><span class="hljs-params">(String orderNumber)</span>;
}

<span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderReadRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;OrderReadModel, Long&gt; {
    OrderReadModel <span class="hljs-title function_">findByOrderNumber</span><span class="hljs-params">(String orderNumber)</span>;
    Page&lt;OrderReadModel&gt; <span class="hljs-title function_">findByUserId</span><span class="hljs-params">(Long userId, Pageable pageable)</span>;
}

<span class="hljs-comment">// è¯»æ¨¡å‹ï¼ˆä¼˜åŒ–æŸ¥è¯¢ï¼‰</span>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "order_read_view")</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderReadModel</span> {
    
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String orderNumber;
    <span class="hljs-keyword">private</span> Long userId;
    <span class="hljs-keyword">private</span> BigDecimal totalAmount;
    <span class="hljs-keyword">private</span> OrderStatus status;
    <span class="hljs-keyword">private</span> Date createTime;
    
    <span class="hljs-comment">// åªè¯»å­—æ®µï¼Œç”¨äºæŸ¥è¯¢ä¼˜åŒ–</span>
    <span class="hljs-keyword">private</span> String userName;
    <span class="hljs-keyword">private</span> String userPhone;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> itemCount;
}
</code></pre>
<h3 data-id="heading-4">1.3 äº‹ä»¶é©±åŠ¨æ¶æ„</h3>
<p><strong>äº‹ä»¶é©±åŠ¨æ¶æ„å®ç°ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// äº‹ä»¶æ€»çº¿</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EventBus</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DomainEvent</span>&gt;, List&lt;EventHandler&gt;&gt; handlers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
    
    <span class="hljs-comment">// æ³¨å†Œäº‹ä»¶å¤„ç†å™¨</span>
    <span class="hljs-keyword">public</span> &lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DomainEvent</span>&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">subscribe</span><span class="hljs-params">(Class&lt;T&gt; eventType, EventHandler&lt;T&gt; handler)</span> {
        handlers.computeIfAbsent(eventType, k -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">CopyOnWriteArrayList</span>&lt;&gt;()).add(handler);
        log.info(<span class="hljs-string">"æ³¨å†Œäº‹ä»¶å¤„ç†å™¨: eventType={}, handler={}"</span>, eventType.getSimpleName(), handler.getClass().getSimpleName());
    }
    
    <span class="hljs-comment">// å‘å¸ƒäº‹ä»¶</span>
    <span class="hljs-keyword">public</span> &lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DomainEvent</span>&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">publish</span><span class="hljs-params">(T event)</span> {
        List&lt;EventHandler&gt; eventHandlers = handlers.get(event.getClass());
        <span class="hljs-keyword">if</span> (eventHandlers != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">for</span> (EventHandler handler : eventHandlers) {
                <span class="hljs-keyword">try</span> {
                    handler.handle(event);
                } <span class="hljs-keyword">catch</span> (Exception e) {
                    log.error(<span class="hljs-string">"äº‹ä»¶å¤„ç†å¤±è´¥: event={}, handler={}"</span>, event, handler.getClass().getSimpleName(), e);
                }
            }
        }
        log.info(<span class="hljs-string">"å‘å¸ƒäº‹ä»¶: {}"</span>, event.getClass().getSimpleName());
    }
    
    <span class="hljs-comment">// å¼‚æ­¥å‘å¸ƒäº‹ä»¶</span>
    <span class="hljs-keyword">public</span> &lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DomainEvent</span>&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">publishAsync</span><span class="hljs-params">(T event)</span> {
        CompletableFuture.runAsync(() -&gt; publish(event));
    }
}

<span class="hljs-comment">// äº‹ä»¶å¤„ç†å™¨æ¥å£</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">EventHandler</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DomainEvent</span>&gt; {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(T event)</span>;
}

<span class="hljs-comment">// è®¢å•äº‹ä»¶å¤„ç†å™¨</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderEventHandlers</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> NotificationService notificationService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> InventoryService inventoryService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> PaymentService paymentService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> EventBus eventBus;
    
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ³¨å†Œäº‹ä»¶å¤„ç†å™¨</span>
        eventBus.subscribe(OrderCreatedEvent.class, <span class="hljs-built_in">this</span>::handleOrderCreated);
        eventBus.subscribe(OrderPaidEvent.class, <span class="hljs-built_in">this</span>::handleOrderPaid);
        eventBus.subscribe(OrderCancelledEvent.class, <span class="hljs-built_in">this</span>::handleOrderCancelled);
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleOrderCreated</span><span class="hljs-params">(OrderCreatedEvent event)</span> {
        log.info(<span class="hljs-string">"å¤„ç†è®¢å•åˆ›å»ºäº‹ä»¶: orderNumber={}"</span>, event.getOrderNumber());
        
        <span class="hljs-comment">// 1. å‘é€é€šçŸ¥</span>
        notificationService.sendOrderCreatedNotification(event.getUserId(), event.getOrderNumber());
        
        <span class="hljs-comment">// 2. æ‰£å‡åº“å­˜</span>
        <span class="hljs-comment">// inventoryService.deductInventory(...);</span>
        
        <span class="hljs-comment">// 3. è§¦å‘å…¶ä»–ä¸šåŠ¡é€»è¾‘</span>
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleOrderPaid</span><span class="hljs-params">(OrderPaidEvent event)</span> {
        log.info(<span class="hljs-string">"å¤„ç†è®¢å•æ”¯ä»˜äº‹ä»¶: orderNumber={}"</span>, event.getOrderNumber());
        
        <span class="hljs-comment">// 1. å‘é€æ”¯ä»˜æˆåŠŸé€šçŸ¥</span>
        notificationService.sendPaymentSuccessNotification(event.getUserId(), event.getOrderNumber());
        
        <span class="hljs-comment">// 2. æ›´æ–°è®¢å•çŠ¶æ€</span>
        <span class="hljs-comment">// orderService.updateOrderStatus(...);</span>
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleOrderCancelled</span><span class="hljs-params">(OrderCancelledEvent event)</span> {
        log.info(<span class="hljs-string">"å¤„ç†è®¢å•å–æ¶ˆäº‹ä»¶: orderNumber={}"</span>, event.getOrderNumber());
        
        <span class="hljs-comment">// 1. å‘é€å–æ¶ˆé€šçŸ¥</span>
        notificationService.sendOrderCancelledNotification(event.getUserId(), event.getOrderNumber());
        
        <span class="hljs-comment">// 2. æ¢å¤åº“å­˜</span>
        <span class="hljs-comment">// inventoryService.restoreInventory(...);</span>
    }
}

<span class="hljs-comment">// äº‹ä»¶å­˜å‚¨</span>
<span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">EventStore</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;EventEntity, Long&gt; {
    List&lt;EventEntity&gt; <span class="hljs-title function_">findByAggregateIdAndAggregateType</span><span class="hljs-params">(String aggregateId, String aggregateType)</span>;
}

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "event_store")</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EventEntity</span> {
    
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-keyword">private</span> String aggregateId;
    <span class="hljs-keyword">private</span> String aggregateType;
    <span class="hljs-keyword">private</span> String eventType;
    
    <span class="hljs-meta">@Lob</span>
    <span class="hljs-keyword">private</span> String eventData;
    
    <span class="hljs-keyword">private</span> Date occurredOn;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> version;
}
</code></pre>
<hr/>
<h2 data-id="heading-5">2. é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡</h2>
<h3 data-id="heading-6">2.1 é™æµç®—æ³•</h3>
<p><strong>é™æµç®—æ³•å®ç°ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é™æµå™¨æ¥å£</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">RateLimiter</span> {
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">()</span>;
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> <span class="hljs-keyword">permits</span>)</span>;
}

<span class="hljs-comment">// å›ºå®šçª—å£é™æµ</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FixedWindowRateLimiter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RateLimiter</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> limit;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> windowSize; <span class="hljs-comment">// çª—å£å¤§å°ï¼ˆæ¯«ç§’ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">counter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> <span class="hljs-variable">windowStart</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">FixedWindowRateLimiter</span><span class="hljs-params">(<span class="hljs-type">int</span> limit, <span class="hljs-type">long</span> windowSizeMillis)</span> {
        <span class="hljs-built_in">this</span>.limit = limit;
        <span class="hljs-built_in">this</span>.windowSize = windowSizeMillis;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> tryAcquire(<span class="hljs-number">1</span>);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> <span class="hljs-keyword">permits</span>)</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">currentTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        
        <span class="hljs-keyword">synchronized</span> (lock) {
            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦è¿›å…¥æ–°çª—å£</span>
            <span class="hljs-keyword">if</span> (currentTime - windowStart &gt;= windowSize) {
                counter.set(<span class="hljs-number">0</span>);
                windowStart = currentTime;
            }
            
            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦è¶…è¿‡é™åˆ¶</span>
            <span class="hljs-keyword">if</span> (counter.get() + <span class="hljs-keyword">permits</span> &lt;= limit) {
                counter.addAndGet(<span class="hljs-keyword">permits</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCurrentCount</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> counter.get();
    }
}

<span class="hljs-comment">// æ»‘åŠ¨çª—å£é™æµ</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SlidingWindowRateLimiter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RateLimiter</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> limit;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> windowSize;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Queue&lt;Long&gt; requests = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentLinkedQueue</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SlidingWindowRateLimiter</span><span class="hljs-params">(<span class="hljs-type">int</span> limit, <span class="hljs-type">long</span> windowSizeMillis)</span> {
        <span class="hljs-built_in">this</span>.limit = limit;
        <span class="hljs-built_in">this</span>.windowSize = windowSizeMillis;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> tryAcquire(<span class="hljs-number">1</span>);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> <span class="hljs-keyword">permits</span>)</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">currentTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        
        <span class="hljs-comment">// ç§»é™¤è¿‡æœŸçš„è¯·æ±‚</span>
        <span class="hljs-keyword">while</span> (!requests.isEmpty() &amp;&amp; currentTime - requests.peek() &gt; windowSize) {
            requests.poll();
        }
        
        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦è¶…è¿‡é™åˆ¶</span>
        <span class="hljs-keyword">if</span> (requests.size() + <span class="hljs-keyword">permits</span> &lt;= limit) {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">permits</span>; i++) {
                requests.offer(currentTime);
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}

<span class="hljs-comment">// ä»¤ç‰Œæ¡¶é™æµ</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TokenBucketRateLimiter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RateLimiter</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> capacity; <span class="hljs-comment">// æ¡¶å®¹é‡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> refillRate; <span class="hljs-comment">// æ¯ç§’è¡¥å……çš„ä»¤ç‰Œæ•°</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> tokens; <span class="hljs-comment">// å½“å‰ä»¤ç‰Œæ•°</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> lastRefillTime; <span class="hljs-comment">// ä¸Šæ¬¡è¡¥å……æ—¶é—´</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TokenBucketRateLimiter</span><span class="hljs-params">(<span class="hljs-type">int</span> capacity, <span class="hljs-type">double</span> refillRate)</span> {
        <span class="hljs-built_in">this</span>.capacity = capacity;
        <span class="hljs-built_in">this</span>.refillRate = refillRate;
        <span class="hljs-built_in">this</span>.tokens = capacity;
        <span class="hljs-built_in">this</span>.lastRefillTime = System.currentTimeMillis();
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> tryAcquire(<span class="hljs-number">1</span>);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> <span class="hljs-keyword">permits</span>)</span> {
        <span class="hljs-keyword">synchronized</span> (lock) {
            refillTokens();
            
            <span class="hljs-keyword">if</span> (tokens &gt;= <span class="hljs-keyword">permits</span>) {
                tokens -= <span class="hljs-keyword">permits</span>;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">refillTokens</span><span class="hljs-params">()</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">currentTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-type">long</span> <span class="hljs-variable">elapsed</span> <span class="hljs-operator">=</span> currentTime - lastRefillTime;
        
        <span class="hljs-keyword">if</span> (elapsed &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-type">double</span> <span class="hljs-variable">tokensToAdd</span> <span class="hljs-operator">=</span> (elapsed / <span class="hljs-number">1000.0</span>) * refillRate;
            tokens = Math.min(capacity, tokens + tokensToAdd);
            lastRefillTime = currentTime;
        }
    }
}

<span class="hljs-comment">// æ¼æ¡¶é™æµ</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LeakyBucketRateLimiter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RateLimiter</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> capacity; <span class="hljs-comment">// æ¡¶å®¹é‡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> leakRate; <span class="hljs-comment">// æ¯ç§’æ¼å‡ºçš„é€Ÿç‡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> water; <span class="hljs-comment">// å½“å‰æ°´é‡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> lastLeakTime; <span class="hljs-comment">// ä¸Šæ¬¡æ¼æ°´æ—¶é—´</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LeakyBucketRateLimiter</span><span class="hljs-params">(<span class="hljs-type">int</span> capacity, <span class="hljs-type">double</span> leakRate)</span> {
        <span class="hljs-built_in">this</span>.capacity = capacity;
        <span class="hljs-built_in">this</span>.leakRate = leakRate;
        <span class="hljs-built_in">this</span>.water = <span class="hljs-number">0</span>;
        <span class="hljs-built_in">this</span>.lastLeakTime = System.currentTimeMillis();
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> tryAcquire(<span class="hljs-number">1</span>);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> <span class="hljs-keyword">permits</span>)</span> {
        <span class="hljs-keyword">synchronized</span> (lock) {
            leakWater();
            
            <span class="hljs-keyword">if</span> (water + <span class="hljs-keyword">permits</span> &lt;= capacity) {
                water += <span class="hljs-keyword">permits</span>;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">leakWater</span><span class="hljs-params">()</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">currentTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-type">long</span> <span class="hljs-variable">elapsed</span> <span class="hljs-operator">=</span> currentTime - lastLeakTime;
        
        <span class="hljs-keyword">if</span> (elapsed &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-type">double</span> <span class="hljs-variable">waterToLeak</span> <span class="hljs-operator">=</span> (elapsed / <span class="hljs-number">1000.0</span>) * leakRate;
            water = Math.max(<span class="hljs-number">0</span>, water - waterToLeak);
            lastLeakTime = currentTime;
        }
    }
}

<span class="hljs-comment">// é™æµæ³¨è§£</span>
<span class="hljs-meta">@Target(ElementType.METHOD)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> RateLimit {
    <span class="hljs-type">int</span> <span class="hljs-title function_">limit</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-number">100</span>;
    <span class="hljs-type">long</span> <span class="hljs-title function_">windowSize</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-number">1000</span>; <span class="hljs-comment">// æ¯«ç§’</span>
    RateLimitType <span class="hljs-title function_">type</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> RateLimitType.FIXED_WINDOW;
}

<span class="hljs-keyword">enum</span> <span class="hljs-title class_">RateLimitType</span> {
    FIXED_WINDOW,
    SLIDING_WINDOW,
    TOKEN_BUCKET,
    LEAKY_BUCKET
}

<span class="hljs-comment">// é™æµåˆ‡é¢</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RateLimitAspect</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, RateLimiter&gt; limiters = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
    
    <span class="hljs-meta">@Around("@annotation(rateLimit)")</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">rateLimit</span><span class="hljs-params">(ProceedingJoinPoint joinPoint, RateLimit rateLimit)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> generateKey(joinPoint);
        <span class="hljs-type">RateLimiter</span> <span class="hljs-variable">limiter</span> <span class="hljs-operator">=</span> limiters.computeIfAbsent(key, k -&gt; createRateLimiter(rateLimit));
        
        <span class="hljs-keyword">if</span> (!limiter.tryAcquire()) {
            log.warn(<span class="hljs-string">"è¯·æ±‚è¢«é™æµ: key={}"</span>, key);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RateLimitException</span>(<span class="hljs-string">"è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åé‡è¯•"</span>);
        }
        
        <span class="hljs-keyword">return</span> joinPoint.proceed();
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">generateKey</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> {
        <span class="hljs-keyword">return</span> joinPoint.getSignature().toLongString();
    }
    
    <span class="hljs-keyword">private</span> RateLimiter <span class="hljs-title function_">createRateLimiter</span><span class="hljs-params">(RateLimit rateLimit)</span> {
        <span class="hljs-keyword">switch</span> (rateLimit.type()) {
            <span class="hljs-keyword">case</span> FIXED_WINDOW:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FixedWindowRateLimiter</span>(rateLimit.limit(), rateLimit.windowSize());
            <span class="hljs-keyword">case</span> SLIDING_WINDOW:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SlidingWindowRateLimiter</span>(rateLimit.limit(), rateLimit.windowSize());
            <span class="hljs-keyword">case</span> TOKEN_BUCKET:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TokenBucketRateLimiter</span>(rateLimit.limit(), rateLimit.limit() / (rateLimit.windowSize() / <span class="hljs-number">1000.0</span>));
            <span class="hljs-keyword">case</span> LEAKY_BUCKET:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LeakyBucketRateLimiter</span>(rateLimit.limit(), rateLimit.limit() / (rateLimit.windowSize() / <span class="hljs-number">1000.0</span>));
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FixedWindowRateLimiter</span>(rateLimit.limit(), rateLimit.windowSize());
        }
    }
}
</code></pre>
<h3 data-id="heading-7">2.2 ç†”æ–­é™çº§</h3>
<p><strong>ç†”æ–­é™çº§å®ç°ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç†”æ–­å™¨çŠ¶æ€</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">CircuitBreakerState</span> {
    CLOSED,    <span class="hljs-comment">// å…³é—­ï¼šæ­£å¸¸çŠ¶æ€</span>
    OPEN,      <span class="hljs-comment">// æ‰“å¼€ï¼šç†”æ–­çŠ¶æ€</span>
    HALF_OPEN  <span class="hljs-comment">// åŠå¼€ï¼šå°è¯•æ¢å¤</span>
}

<span class="hljs-comment">// ç†”æ–­å™¨</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CircuitBreaker</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">CircuitBreakerState</span> <span class="hljs-variable">state</span> <span class="hljs-operator">=</span> CircuitBreakerState.CLOSED;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">failureCount</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">successCount</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> lastFailureTime;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> failureThreshold; <span class="hljs-comment">// å¤±è´¥é˜ˆå€¼</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> timeout; <span class="hljs-comment">// è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> halfOpenTimeout; <span class="hljs-comment">// åŠå¼€çŠ¶æ€è¶…æ—¶æ—¶é—´</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CircuitBreaker</span><span class="hljs-params">(<span class="hljs-type">int</span> failureThreshold, <span class="hljs-type">long</span> timeout, <span class="hljs-type">long</span> halfOpenTimeout)</span> {
        <span class="hljs-built_in">this</span>.failureThreshold = failureThreshold;
        <span class="hljs-built_in">this</span>.timeout = timeout;
        <span class="hljs-built_in">this</span>.halfOpenTimeout = halfOpenTimeout;
    }
    
    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">execute</span><span class="hljs-params">(Supplier&lt;T&gt; supplier)</span> {
        <span class="hljs-keyword">if</span> (state == CircuitBreakerState.OPEN) {
            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦å¯ä»¥è¿›å…¥åŠå¼€çŠ¶æ€</span>
            <span class="hljs-keyword">if</span> (System.currentTimeMillis() - lastFailureTime &gt; timeout) {
                state = CircuitBreakerState.HALF_OPEN;
                successCount.set(<span class="hljs-number">0</span>);
                log.info(<span class="hljs-string">"ç†”æ–­å™¨è¿›å…¥åŠå¼€çŠ¶æ€"</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CircuitBreakerOpenException</span>(<span class="hljs-string">"ç†”æ–­å™¨å·²æ‰“å¼€"</span>);
            }
        }
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> supplier.get();
            onSuccess();
            <span class="hljs-keyword">return</span> result;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            onFailure();
            <span class="hljs-keyword">throw</span> e;
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (state == CircuitBreakerState.HALF_OPEN) {
            successCount.incrementAndGet();
            <span class="hljs-keyword">if</span> (successCount.get() &gt;= <span class="hljs-number">3</span>) { <span class="hljs-comment">// è¿ç»­æˆåŠŸ3æ¬¡ï¼Œæ¢å¤æ­£å¸¸</span>
                state = CircuitBreakerState.CLOSED;
                failureCount.set(<span class="hljs-number">0</span>);
                log.info(<span class="hljs-string">"ç†”æ–­å™¨æ¢å¤æ­£å¸¸"</span>);
            }
        } <span class="hljs-keyword">else</span> {
            failureCount.set(<span class="hljs-number">0</span>);
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailure</span><span class="hljs-params">()</span> {
        failureCount.incrementAndGet();
        lastFailureTime = System.currentTimeMillis();
        
        <span class="hljs-keyword">if</span> (failureCount.get() &gt;= failureThreshold) {
            state = CircuitBreakerState.OPEN;
            log.warn(<span class="hljs-string">"ç†”æ–­å™¨æ‰“å¼€: failureCount={}"</span>, failureCount.get());
        }
    }
    
    <span class="hljs-keyword">public</span> CircuitBreakerState <span class="hljs-title function_">getState</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> state;
    }
}

<span class="hljs-comment">// é™çº§ç­–ç•¥</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FallbackService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> CircuitBreaker circuitBreaker;
    
    <span class="hljs-comment">// æ‰§è¡Œå¸¦é™çº§çš„æ“ä½œ</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">executeWithFallback</span><span class="hljs-params">(Supplier&lt;T&gt; supplier, Supplier&lt;T&gt; fallback)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> circuitBreaker.execute(supplier);
        } <span class="hljs-keyword">catch</span> (CircuitBreakerOpenException e) {
            log.warn(<span class="hljs-string">"æ‰§è¡Œé™çº§ç­–ç•¥"</span>);
            <span class="hljs-keyword">return</span> fallback.get();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"æ‰§è¡Œå¤±è´¥ï¼Œä½¿ç”¨é™çº§ç­–ç•¥"</span>, e);
            <span class="hljs-keyword">return</span> fallback.get();
        }
    }
    
    <span class="hljs-comment">// å¼‚æ­¥é™çº§</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; CompletableFuture&lt;T&gt; <span class="hljs-title function_">executeWithAsyncFallback</span><span class="hljs-params">(
        Supplier&lt;CompletableFuture&lt;T&gt;&gt; supplier, 
        Supplier&lt;T&gt; fallback)</span> {
        
        <span class="hljs-keyword">return</span> supplier.get()
            .exceptionally(throwable -&gt; {
                log.warn(<span class="hljs-string">"å¼‚æ­¥æ‰§è¡Œå¤±è´¥ï¼Œä½¿ç”¨é™çº§ç­–ç•¥"</span>, throwable);
                <span class="hljs-keyword">return</span> fallback.get();
            });
    }
}

<span class="hljs-comment">// ç†”æ–­é™çº§ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceWithCircuitBreaker</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> CircuitBreaker circuitBreaker;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> FallbackService fallbackService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserRepository userRepository;
    
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUserById</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-keyword">return</span> fallbackService.executeWithFallback(
            () -&gt; {
                <span class="hljs-comment">// æ­£å¸¸æŸ¥è¯¢</span>
                <span class="hljs-keyword">return</span> userRepository.findById(userId)
                    .orElseThrow(() -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserNotFoundException</span>(<span class="hljs-string">"ç”¨æˆ·ä¸å­˜åœ¨"</span>));
            },
            () -&gt; {
                <span class="hljs-comment">// é™çº§ç­–ç•¥ï¼šè¿”å›é»˜è®¤ç”¨æˆ·</span>
                log.info(<span class="hljs-string">"ä½¿ç”¨é™çº§ç­–ç•¥è¿”å›é»˜è®¤ç”¨æˆ·"</span>);
                <span class="hljs-keyword">return</span> createDefaultUser(userId);
            }
        );
    }
    
    <span class="hljs-keyword">private</span> User <span class="hljs-title function_">createDefaultUser</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
        user.setId(userId);
        user.setName(<span class="hljs-string">"é»˜è®¤ç”¨æˆ·"</span>);
        <span class="hljs-keyword">return</span> user;
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-8">3. åˆ†å¸ƒå¼é”æ·±åº¦åº”ç”¨</h2>
<h3 data-id="heading-9">3.1 Redisåˆ†å¸ƒå¼é”</h3>
<p><strong>Redisåˆ†å¸ƒå¼é”å®ç°ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Redisåˆ†å¸ƒå¼é”</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisDistributedLock</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">LOCK_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"lock:"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">LOCK_SCRIPT</span> <span class="hljs-operator">=</span> 
        <span class="hljs-string">"if redis.call('get', KEYS[1]) == ARGV[1] then "</span> +
        <span class="hljs-string">"return redis.call('del', KEYS[1]) "</span> +
        <span class="hljs-string">"else return 0 end"</span>;
    
    <span class="hljs-comment">// è·å–é”</span>
    <span class="hljs-keyword">public</span> DistributedLock <span class="hljs-title function_">acquireLock</span><span class="hljs-params">(String key, <span class="hljs-type">long</span> expireTime, TimeUnit timeUnit)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> LOCK_PREFIX + key;
        <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        <span class="hljs-type">long</span> <span class="hljs-variable">expireMillis</span> <span class="hljs-operator">=</span> timeUnit.toMillis(expireTime);
        
        <span class="hljs-type">Boolean</span> <span class="hljs-variable">acquired</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().setIfAbsent(
            lockKey, 
            lockValue, 
            expireMillis, 
            TimeUnit.MILLISECONDS
        );
        
        <span class="hljs-keyword">if</span> (Boolean.TRUE.equals(acquired)) {
            log.info(<span class="hljs-string">"è·å–åˆ†å¸ƒå¼é”æˆåŠŸ: key={}, value={}"</span>, lockKey, lockValue);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisLockImpl</span>(lockKey, lockValue, expireMillis);
        }
        
        log.warn(<span class="hljs-string">"è·å–åˆ†å¸ƒå¼é”å¤±è´¥: key={}"</span>, lockKey);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    
    <span class="hljs-comment">// å¯é‡å…¥é”å®ç°</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisLockImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DistributedLock</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String lockKey;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String lockValue;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> expireTime;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;Integer&gt; reentrantCount = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();
        
        <span class="hljs-keyword">public</span> <span class="hljs-title function_">RedisLockImpl</span><span class="hljs-params">(String lockKey, String lockValue, <span class="hljs-type">long</span> expireTime)</span> {
            <span class="hljs-built_in">this</span>.lockKey = lockKey;
            <span class="hljs-built_in">this</span>.lockValue = lockValue;
            <span class="hljs-built_in">this</span>.expireTime = expireTime;
            <span class="hljs-built_in">this</span>.reentrantCount.set(<span class="hljs-number">1</span>);
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(<span class="hljs-type">long</span> timeout, TimeUnit unit)</span> {
            <span class="hljs-type">Integer</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> reentrantCount.get();
            <span class="hljs-keyword">if</span> (count != <span class="hljs-literal">null</span> &amp;&amp; count &gt; <span class="hljs-number">0</span>) {
                reentrantCount.set(count + <span class="hljs-number">1</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">()</span> {
            <span class="hljs-type">Integer</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> reentrantCount.get();
            <span class="hljs-keyword">if</span> (count != <span class="hljs-literal">null</span> &amp;&amp; count &gt; <span class="hljs-number">1</span>) {
                reentrantCount.set(count - <span class="hljs-number">1</span>);
                <span class="hljs-keyword">return</span>;
            }
            
            <span class="hljs-comment">// ä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­æ€§</span>
            DefaultRedisScript&lt;Long&gt; script = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRedisScript</span>&lt;&gt;();
            script.setScriptText(LOCK_SCRIPT);
            script.setResultType(Long.class);
            
            <span class="hljs-type">Long</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> redisTemplate.execute(script, 
                Collections.singletonList(lockKey), lockValue);
            
            <span class="hljs-keyword">if</span> (result != <span class="hljs-literal">null</span> &amp;&amp; result == <span class="hljs-number">1</span>) {
                log.info(<span class="hljs-string">"é‡Šæ”¾åˆ†å¸ƒå¼é”æˆåŠŸ: key={}"</span>, lockKey);
                reentrantCount.remove();
            } <span class="hljs-keyword">else</span> {
                log.warn(<span class="hljs-string">"é‡Šæ”¾åˆ†å¸ƒå¼é”å¤±è´¥: key={}"</span>, lockKey);
            }
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
            unlock();
        }
    }
}

<span class="hljs-comment">// ZooKeeperåˆ†å¸ƒå¼é”</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZooKeeperDistributedLock</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CuratorFramework client;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">LOCK_PATH</span> <span class="hljs-operator">=</span> <span class="hljs-string">"/locks"</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ZooKeeperDistributedLock</span><span class="hljs-params">(<span class="hljs-meta">@Value("${zookeeper.connect-string}")</span> String connectString)</span> {
        <span class="hljs-built_in">this</span>.client = CuratorFrameworkFactory.newClient(connectString, 
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">RetryForever</span>(<span class="hljs-number">1000</span>));
        <span class="hljs-built_in">this</span>.client.start();
    }
    
    <span class="hljs-keyword">public</span> DistributedLock <span class="hljs-title function_">acquireLock</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">lockPath</span> <span class="hljs-operator">=</span> LOCK_PATH + <span class="hljs-string">"/"</span> + key;
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">InterProcessMutex</span> <span class="hljs-variable">mutex</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InterProcessMutex</span>(client, lockPath);
            mutex.acquire();
            
            log.info(<span class="hljs-string">"è·å–ZooKeeperåˆ†å¸ƒå¼é”æˆåŠŸ: key={}"</span>, key);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZooKeeperLockImpl</span>(mutex, key);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"è·å–ZooKeeperåˆ†å¸ƒå¼é”å¤±è´¥: key={}"</span>, key, e);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è·å–é”å¤±è´¥"</span>, e);
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZooKeeperLockImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DistributedLock</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> InterProcessMutex mutex;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String key;
        
        <span class="hljs-keyword">public</span> <span class="hljs-title function_">ZooKeeperLockImpl</span><span class="hljs-params">(InterProcessMutex mutex, String key)</span> {
            <span class="hljs-built_in">this</span>.mutex = mutex;
            <span class="hljs-built_in">this</span>.key = key;
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(<span class="hljs-type">long</span> timeout, TimeUnit unit)</span> {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">return</span> mutex.acquire(timeout, unit);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.error(<span class="hljs-string">"å°è¯•è·å–é”å¤±è´¥: key={}"</span>, key, e);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">try</span> {
                mutex.release();
                log.info(<span class="hljs-string">"é‡Šæ”¾ZooKeeperåˆ†å¸ƒå¼é”æˆåŠŸ: key={}"</span>, key);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.error(<span class="hljs-string">"é‡Šæ”¾é”å¤±è´¥: key={}"</span>, key, e);
            }
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
            unlock();
        }
    }
}

<span class="hljs-comment">// æ•°æ®åº“åˆ†å¸ƒå¼é”</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseDistributedLock</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> JdbcTemplate jdbcTemplate;
    
    <span class="hljs-comment">// åŸºäºæ•°æ®åº“å”¯ä¸€ç´¢å¼•çš„åˆ†å¸ƒå¼é”</span>
    <span class="hljs-keyword">public</span> DistributedLock <span class="hljs-title function_">acquireLock</span><span class="hljs-params">(String key, <span class="hljs-type">long</span> expireTime)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"lock_"</span> + key;
        <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        <span class="hljs-type">Date</span> <span class="hljs-variable">expireTime</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(System.currentTimeMillis() + expireTime);
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// å°è¯•æ’å…¥é”è®°å½•</span>
            jdbcTemplate.update(
                <span class="hljs-string">"INSERT INTO distributed_lock (lock_key, lock_value, expire_time) VALUES (?, ?, ?)"</span>,
                lockKey, lockValue, expireTime
            );
            
            log.info(<span class="hljs-string">"è·å–æ•°æ®åº“åˆ†å¸ƒå¼é”æˆåŠŸ: key={}"</span>, lockKey);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DatabaseLockImpl</span>(lockKey, lockValue);
        } <span class="hljs-keyword">catch</span> (DuplicateKeyException e) {
            <span class="hljs-comment">// é”å·²å­˜åœ¨ï¼Œæ£€æŸ¥æ˜¯å¦è¿‡æœŸ</span>
            Map&lt;String, Object&gt; lock = jdbcTemplate.queryForMap(
                <span class="hljs-string">"SELECT * FROM distributed_lock WHERE lock_key = ?"</span>, lockKey
            );
            
            <span class="hljs-type">Date</span> <span class="hljs-variable">existingExpireTime</span> <span class="hljs-operator">=</span> (Date) lock.get(<span class="hljs-string">"expire_time"</span>);
            <span class="hljs-keyword">if</span> (existingExpireTime.before(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>())) {
                <span class="hljs-comment">// é”å·²è¿‡æœŸï¼Œåˆ é™¤å¹¶é‡æ–°è·å–</span>
                jdbcTemplate.update(<span class="hljs-string">"DELETE FROM distributed_lock WHERE lock_key = ?"</span>, lockKey);
                <span class="hljs-keyword">return</span> acquireLock(key, expireTime);
            }
            
            log.warn(<span class="hljs-string">"è·å–æ•°æ®åº“åˆ†å¸ƒå¼é”å¤±è´¥: key={}, é”å·²å­˜åœ¨ä¸”æœªè¿‡æœŸ"</span>, lockKey);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseLockImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DistributedLock</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String lockKey;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String lockValue;
        
        <span class="hljs-keyword">public</span> <span class="hljs-title function_">DatabaseLockImpl</span><span class="hljs-params">(String lockKey, String lockValue)</span> {
            <span class="hljs-built_in">this</span>.lockKey = lockKey;
            <span class="hljs-built_in">this</span>.lockValue = lockValue;
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(<span class="hljs-type">long</span> timeout, TimeUnit unit)</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// å·²è·å–é”</span>
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">()</span> {
            <span class="hljs-type">int</span> <span class="hljs-variable">deleted</span> <span class="hljs-operator">=</span> jdbcTemplate.update(
                <span class="hljs-string">"DELETE FROM distributed_lock WHERE lock_key = ? AND lock_value = ?"</span>,
                lockKey, lockValue
            );
            
            <span class="hljs-keyword">if</span> (deleted &gt; <span class="hljs-number">0</span>) {
                log.info(<span class="hljs-string">"é‡Šæ”¾æ•°æ®åº“åˆ†å¸ƒå¼é”æˆåŠŸ: key={}"</span>, lockKey);
            } <span class="hljs-keyword">else</span> {
                log.warn(<span class="hljs-string">"é‡Šæ”¾æ•°æ®åº“åˆ†å¸ƒå¼é”å¤±è´¥: key={}"</span>, lockKey);
            }
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
            unlock();
        }
    }
}

<span class="hljs-comment">// åˆ†å¸ƒå¼é”æ¥å£</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DistributedLock</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AutoCloseable</span> {
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(<span class="hljs-type">long</span> timeout, TimeUnit unit)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">()</span>;
}
</code></pre>
<hr/>
<h2 data-id="heading-10">4. åˆ†å¸ƒå¼IDç”Ÿæˆ</h2>
<h3 data-id="heading-11">4.1 é›ªèŠ±ç®—æ³•</h3>
<p><strong>é›ªèŠ±ç®—æ³•å®ç°ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é›ªèŠ±ç®—æ³•IDç”Ÿæˆå™¨</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SnowflakeIdGenerator</span> {
    
    <span class="hljs-comment">// å¼€å§‹æ—¶é—´æˆ³ (2024-01-01)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">START_TIMESTAMP</span> <span class="hljs-operator">=</span> <span class="hljs-number">1704067200000L</span>;
    
    <span class="hljs-comment">// æœºå™¨IDæ‰€å çš„ä½æ•°</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">WORKER_ID_BITS</span> <span class="hljs-operator">=</span> <span class="hljs-number">5L</span>;
    <span class="hljs-comment">// æ•°æ®ä¸­å¿ƒIDæ‰€å çš„ä½æ•°</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">DATACENTER_ID_BITS</span> <span class="hljs-operator">=</span> <span class="hljs-number">5L</span>;
    <span class="hljs-comment">// åºåˆ—å·æ‰€å çš„ä½æ•°</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">SEQUENCE_BITS</span> <span class="hljs-operator">=</span> <span class="hljs-number">12L</span>;
    
    <span class="hljs-comment">// æœºå™¨IDæœ€å¤§å€¼</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">MAX_WORKER_ID</span> <span class="hljs-operator">=</span> ~(-<span class="hljs-number">1L</span> &lt;&lt; WORKER_ID_BITS);
    <span class="hljs-comment">// æ•°æ®ä¸­å¿ƒIDæœ€å¤§å€¼</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">MAX_DATACENTER_ID</span> <span class="hljs-operator">=</span> ~(-<span class="hljs-number">1L</span> &lt;&lt; DATACENTER_ID_BITS);
    
    <span class="hljs-comment">// æœºå™¨IDå‘å·¦ç§»12ä½</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">WORKER_ID_SHIFT</span> <span class="hljs-operator">=</span> SEQUENCE_BITS;
    <span class="hljs-comment">// æ•°æ®ä¸­å¿ƒIDå‘å·¦ç§»17ä½(12+5)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">DATACENTER_ID_SHIFT</span> <span class="hljs-operator">=</span> SEQUENCE_BITS + WORKER_ID_BITS;
    <span class="hljs-comment">// æ—¶é—´æˆ³å‘å·¦ç§»22ä½(5+5+12)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">TIMESTAMP_LEFT_SHIFT</span> <span class="hljs-operator">=</span> SEQUENCE_BITS + WORKER_ID_BITS + DATACENTER_ID_BITS;
    
    <span class="hljs-comment">// ç”Ÿæˆåºåˆ—çš„æ©ç ï¼Œè¿™é‡Œä¸º4095 (0b111111111111=0xfff=4095)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">SEQUENCE_MASK</span> <span class="hljs-operator">=</span> ~(-<span class="hljs-number">1L</span> &lt;&lt; SEQUENCE_BITS);
    
    <span class="hljs-comment">// å·¥ä½œæœºå™¨ID(0~31)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> workerId;
    <span class="hljs-comment">// æ•°æ®ä¸­å¿ƒID(0~31)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> datacenterId;
    <span class="hljs-comment">// æ¯«ç§’å†…åºåˆ—(0~4095)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">sequence</span> <span class="hljs-operator">=</span> <span class="hljs-number">0L</span>;
    <span class="hljs-comment">// ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆ³</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">lastTimestamp</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1L</span>;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SnowflakeIdGenerator</span><span class="hljs-params">(<span class="hljs-meta">@Value("${snowflake.worker-id}")</span> <span class="hljs-type">long</span> workerId,
                               <span class="hljs-meta">@Value("${snowflake.datacenter-id}")</span> <span class="hljs-type">long</span> datacenterId)</span> {
        <span class="hljs-keyword">if</span> (workerId &gt; MAX_WORKER_ID || workerId &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(
                String.format(<span class="hljs-string">"worker Id can't be greater than %d or less than 0"</span>, MAX_WORKER_ID));
        }
        <span class="hljs-keyword">if</span> (datacenterId &gt; MAX_DATACENTER_ID || datacenterId &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(
                String.format(<span class="hljs-string">"datacenter Id can't be greater than %d or less than 0"</span>, MAX_DATACENTER_ID));
        }
        <span class="hljs-built_in">this</span>.workerId = workerId;
        <span class="hljs-built_in">this</span>.datacenterId = datacenterId;
        log.info(<span class="hljs-string">"åˆå§‹åŒ–é›ªèŠ±ç®—æ³•IDç”Ÿæˆå™¨: workerId={}, datacenterId={}"</span>, workerId, datacenterId);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">long</span> <span class="hljs-title function_">nextId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span> (lock) {
            <span class="hljs-type">long</span> <span class="hljs-variable">timestamp</span> <span class="hljs-operator">=</span> timeGen();
            
            <span class="hljs-comment">// å¦‚æœå½“å‰æ—¶é—´å°äºä¸Šä¸€æ¬¡IDç”Ÿæˆçš„æ—¶é—´æˆ³ï¼Œè¯´æ˜ç³»ç»Ÿæ—¶é’Ÿå›é€€è¿‡</span>
            <span class="hljs-keyword">if</span> (timestamp &lt; lastTimestamp) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(
                    String.format(<span class="hljs-string">"Clock moved backwards. Refusing to generate id for %d milliseconds"</span>,
                        lastTimestamp - timestamp));
            }
            
            <span class="hljs-comment">// å¦‚æœæ˜¯åŒä¸€æ—¶é—´ç”Ÿæˆçš„ï¼Œåˆ™è¿›è¡Œæ¯«ç§’å†…åºåˆ—</span>
            <span class="hljs-keyword">if</span> (lastTimestamp == timestamp) {
                sequence = (sequence + <span class="hljs-number">1</span>) &amp; SEQUENCE_MASK;
                <span class="hljs-comment">// æ¯«ç§’å†…åºåˆ—æº¢å‡º</span>
                <span class="hljs-keyword">if</span> (sequence == <span class="hljs-number">0</span>) {
                    <span class="hljs-comment">// é˜»å¡åˆ°ä¸‹ä¸€ä¸ªæ¯«ç§’,è·å¾—æ–°çš„æ—¶é—´æˆ³</span>
                    timestamp = tilNextMillis(lastTimestamp);
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// æ—¶é—´æˆ³æ”¹å˜ï¼Œæ¯«ç§’å†…åºåˆ—é‡ç½®</span>
                sequence = <span class="hljs-number">0L</span>;
            }
            
            <span class="hljs-comment">// ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆ³</span>
            lastTimestamp = timestamp;
            
            <span class="hljs-comment">// ç§»ä½å¹¶é€šè¿‡æˆ–è¿ç®—æ‹¼åˆ°ä¸€èµ·ç»„æˆ64ä½çš„ID</span>
            <span class="hljs-keyword">return</span> ((timestamp - START_TIMESTAMP) &lt;&lt; TIMESTAMP_LEFT_SHIFT)
                | (datacenterId &lt;&lt; DATACENTER_ID_SHIFT)
                | (workerId &lt;&lt; WORKER_ID_SHIFT)
                | sequence;
        }
    }
    
    <span class="hljs-comment">// é˜»å¡åˆ°ä¸‹ä¸€ä¸ªæ¯«ç§’ï¼Œç›´åˆ°è·å¾—æ–°çš„æ—¶é—´æˆ³</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-title function_">tilNextMillis</span><span class="hljs-params">(<span class="hljs-type">long</span> lastTimestamp)</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">timestamp</span> <span class="hljs-operator">=</span> timeGen();
        <span class="hljs-keyword">while</span> (timestamp &lt;= lastTimestamp) {
            timestamp = timeGen();
        }
        <span class="hljs-keyword">return</span> timestamp;
    }
    
    <span class="hljs-comment">// è¿”å›ä»¥æ¯«ç§’ä¸ºå•ä½çš„å½“å‰æ—¶é—´</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-title function_">timeGen</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> System.currentTimeMillis();
    }
    
    <span class="hljs-comment">// è§£æIDä¿¡æ¯</span>
    <span class="hljs-keyword">public</span> SnowflakeIdInfo <span class="hljs-title function_">parseId</span><span class="hljs-params">(<span class="hljs-type">long</span> id)</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">timestamp</span> <span class="hljs-operator">=</span> (id &gt;&gt; TIMESTAMP_LEFT_SHIFT) + START_TIMESTAMP;
        <span class="hljs-type">long</span> <span class="hljs-variable">datacenterId</span> <span class="hljs-operator">=</span> (id &gt;&gt; DATACENTER_ID_SHIFT) &amp; ((<span class="hljs-number">1L</span> &lt;&lt; DATACENTER_ID_BITS) - <span class="hljs-number">1</span>);
        <span class="hljs-type">long</span> <span class="hljs-variable">workerId</span> <span class="hljs-operator">=</span> (id &gt;&gt; WORKER_ID_SHIFT) &amp; ((<span class="hljs-number">1L</span> &lt;&lt; WORKER_ID_BITS) - <span class="hljs-number">1</span>);
        <span class="hljs-type">long</span> <span class="hljs-variable">sequence</span> <span class="hljs-operator">=</span> id &amp; SEQUENCE_MASK;
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SnowflakeIdInfo</span>(timestamp, datacenterId, workerId, sequence);
    }
}

<span class="hljs-comment">// IDä¿¡æ¯</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SnowflakeIdInfo</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> timestamp;
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> datacenterId;
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> workerId;
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> sequence;
}
</code></pre>
<h3 data-id="heading-12">4.2 å…¶ä»–IDç”Ÿæˆæ–¹æ¡ˆ</h3>
<p><strong>å…¶ä»–IDç”Ÿæˆæ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// UUIDç”Ÿæˆå™¨</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UUIDGenerator</span> {
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">generateUUID</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> UUID.randomUUID().toString();
    }
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">generateUUIDWithoutHyphens</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> UUID.randomUUID().toString().replace(<span class="hljs-string">"-"</span>, <span class="hljs-string">""</span>);
    }
}

<span class="hljs-comment">// æ•°æ®åº“åºåˆ—IDç”Ÿæˆå™¨</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseSequenceIdGenerator</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> JdbcTemplate jdbcTemplate;
    
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">generateId</span><span class="hljs-params">(String sequenceName)</span> {
        <span class="hljs-comment">// MySQL</span>
        jdbcTemplate.update(<span class="hljs-string">"UPDATE sequence SET current_value = current_value + 1 WHERE name = ?"</span>, sequenceName);
        <span class="hljs-type">Long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> jdbcTemplate.queryForObject(
            <span class="hljs-string">"SELECT current_value FROM sequence WHERE name = ?"</span>, 
            Long.class, sequenceName);
        <span class="hljs-keyword">return</span> id;
    }
    
    <span class="hljs-comment">// Redisè‡ªå¢IDç”Ÿæˆå™¨</span>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;
    
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">generateIdFromRedis</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-keyword">return</span> redisTemplate.opsForValue().increment(key);
    }
    
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">generateIdWithPrefix</span><span class="hljs-params">(String prefix)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">"id:"</span> + prefix;
        <span class="hljs-keyword">return</span> redisTemplate.opsForValue().increment(key);
    }
}

<span class="hljs-comment">// IDç”Ÿæˆå™¨å·¥å‚</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IdGeneratorFactory</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> SnowflakeIdGenerator snowflakeIdGenerator;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UUIDGenerator uuidGenerator;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> DatabaseSequenceIdGenerator databaseSequenceIdGenerator;
    
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">generateId</span><span class="hljs-params">(IdType type)</span> {
        <span class="hljs-keyword">switch</span> (type) {
            <span class="hljs-keyword">case</span> SNOWFLAKE:
                <span class="hljs-keyword">return</span> snowflakeIdGenerator.nextId();
            <span class="hljs-keyword">case</span> DATABASE_SEQUENCE:
                <span class="hljs-keyword">return</span> databaseSequenceIdGenerator.generateId(<span class="hljs-string">"default_sequence"</span>);
            <span class="hljs-keyword">case</span> REDIS_INCREMENT:
                <span class="hljs-keyword">return</span> databaseSequenceIdGenerator.generateIdFromRedis(<span class="hljs-string">"id:default"</span>);
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"ä¸æ”¯æŒçš„IDç±»å‹: "</span> + type);
        }
    }
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">generateStringId</span><span class="hljs-params">(IdType type)</span> {
        <span class="hljs-keyword">switch</span> (type) {
            <span class="hljs-keyword">case</span> UUID:
                <span class="hljs-keyword">return</span> uuidGenerator.generateUUID();
            <span class="hljs-keyword">case</span> UUID_WITHOUT_HYPHENS:
                <span class="hljs-keyword">return</span> uuidGenerator.generateUUIDWithoutHyphens();
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"ä¸æ”¯æŒçš„å­—ç¬¦ä¸²IDç±»å‹: "</span> + type);
        }
    }
}

<span class="hljs-keyword">enum</span> <span class="hljs-title class_">IdType</span> {
    SNOWFLAKE,
    UUID,
    UUID_WITHOUT_HYPHENS,
    DATABASE_SEQUENCE,
    REDIS_INCREMENT
}
</code></pre>
<hr/>
<h2 data-id="heading-13">5. ç³»ç»Ÿæ¶æ„æ¼”è¿›</h2>
<h3 data-id="heading-14">5.1 å•ä½“åˆ°å¾®æœåŠ¡æ¼”è¿›</h3>
<p><strong>æ¶æ„æ¼”è¿›ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å•ä½“æ¶æ„ç¤ºä¾‹</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api")</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MonolithicController</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderService orderService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> PaymentService paymentService;
    
    <span class="hljs-comment">// å•ä½“æ¶æ„ï¼šæ‰€æœ‰åŠŸèƒ½åœ¨ä¸€ä¸ªåº”ç”¨ä¸­</span>
    <span class="hljs-meta">@PostMapping("/order")</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">createOrder</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> CreateOrderRequest request)</span> {
        <span class="hljs-comment">// 1. åˆ›å»ºç”¨æˆ·ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.getOrCreateUser(request.getUserId());
        
        <span class="hljs-comment">// 2. åˆ›å»ºè®¢å•</span>
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderService.createOrder(request);
        
        <span class="hljs-comment">// 3. å¤„ç†æ”¯ä»˜</span>
        <span class="hljs-type">Payment</span> <span class="hljs-variable">payment</span> <span class="hljs-operator">=</span> paymentService.processPayment(order);
        
        <span class="hljs-keyword">return</span> order;
    }
}

<span class="hljs-comment">// å¾®æœåŠ¡æ¶æ„ï¼šæœåŠ¡æ‹†åˆ†</span>
<span class="hljs-comment">// User Service</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/users")</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;
    
    <span class="hljs-meta">@GetMapping("/{userId}")</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long userId)</span> {
        <span class="hljs-keyword">return</span> userService.getUserById(userId);
    }
}

<span class="hljs-comment">// Order Service</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/orders")</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderService orderService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserFeignClient userFeignClient;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> PaymentFeignClient paymentFeignClient;
    
    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">createOrder</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> CreateOrderRequest request)</span> {
        <span class="hljs-comment">// è°ƒç”¨ç”¨æˆ·æœåŠ¡</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userFeignClient.getUser(request.getUserId());
        
        <span class="hljs-comment">// åˆ›å»ºè®¢å•</span>
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderService.createOrder(request);
        
        <span class="hljs-comment">// è°ƒç”¨æ”¯ä»˜æœåŠ¡</span>
        <span class="hljs-type">Payment</span> <span class="hljs-variable">payment</span> <span class="hljs-operator">=</span> paymentFeignClient.processPayment(order);
        
        <span class="hljs-keyword">return</span> order;
    }
}

<span class="hljs-comment">// Feignå®¢æˆ·ç«¯</span>
<span class="hljs-meta">@FeignClient(name = "user-service", url = "${services.user-service.url}")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserFeignClient</span> {
    <span class="hljs-meta">@GetMapping("/api/users/{userId}")</span>
    User <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable("userId")</span> Long userId)</span>;
}

<span class="hljs-meta">@FeignClient(name = "payment-service", url = "${services.payment-service.url}")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PaymentFeignClient</span> {
    <span class="hljs-meta">@PostMapping("/api/payments")</span>
    Payment <span class="hljs-title function_">processPayment</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Order order)</span>;
}
</code></pre>
<h3 data-id="heading-15">5.2 å¾®æœåŠ¡åˆ°äº‘åŸç”Ÿæ¼”è¿›</h3>
<p><strong>äº‘åŸç”Ÿæ¶æ„ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// äº‘åŸç”Ÿé…ç½®</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CloudNativeConfig</span> {
    
    <span class="hljs-comment">// é…ç½®ä¸­å¿ƒï¼ˆNacos/Config Serverï¼‰</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@ConfigurationProperties(prefix = "app")</span>
    <span class="hljs-keyword">public</span> AppProperties <span class="hljs-title function_">appProperties</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppProperties</span>();
    }
    
    <span class="hljs-comment">// æœåŠ¡å‘ç°ï¼ˆNacos/Eurekaï¼‰</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> ServiceDiscovery <span class="hljs-title function_">serviceDiscovery</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NacosServiceDiscovery</span>();
    }
    
    <span class="hljs-comment">// å¥åº·æ£€æŸ¥</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> HealthIndicator <span class="hljs-title function_">customHealthIndicator</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomHealthIndicator</span>();
    }
}

<span class="hljs-comment">// äº‘åŸç”Ÿåº”ç”¨ç‰¹æ€§</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EnableDiscoveryClient</span>
<span class="hljs-meta">@EnableCircuitBreaker</span>
<span class="hljs-meta">@EnableConfigServer</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CloudNativeApplication</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">SpringApplication</span> <span class="hljs-variable">app</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpringApplication</span>(CloudNativeApplication.class);
        
        <span class="hljs-comment">// ä»ç¯å¢ƒå˜é‡è¯»å–é…ç½®ï¼ˆ12-Factor Appï¼‰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> System.getenv(<span class="hljs-string">"PORT"</span>);
        <span class="hljs-keyword">if</span> (port != <span class="hljs-literal">null</span>) {
            app.setDefaultProperties(Collections.singletonMap(<span class="hljs-string">"server.port"</span>, port));
        }
        
        app.run(args);
    }
}

<span class="hljs-comment">// å®¹å™¨åŒ–æ”¯æŒ</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ContainerAwareService</span> {
    
    <span class="hljs-comment">// æ£€æµ‹æ˜¯å¦åœ¨å®¹å™¨ä¸­è¿è¡Œ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isRunningInContainer</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">"/.dockerenv"</span>).exists() || 
               System.getenv(<span class="hljs-string">"KUBERNETES_SERVICE_HOST"</span>) != <span class="hljs-literal">null</span>;
    }
    
    <span class="hljs-comment">// è·å–å®¹å™¨ä¿¡æ¯</span>
    <span class="hljs-keyword">public</span> ContainerInfo <span class="hljs-title function_">getContainerInfo</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ContainerInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ContainerInfo</span>();
        info.setContainerId(System.getenv(<span class="hljs-string">"HOSTNAME"</span>));
        info.setPodName(System.getenv(<span class="hljs-string">"POD_NAME"</span>));
        info.setNamespace(System.getenv(<span class="hljs-string">"POD_NAMESPACE"</span>));
        <span class="hljs-keyword">return</span> info;
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-16">6. ä¼ä¸šçº§æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-17">6.1 ä»£ç è§„èŒƒä¸è®¾è®¡æ¨¡å¼</h3>
<p><strong>æœ€ä½³å®è·µç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç­–ç•¥æ¨¡å¼ï¼šæ”¯ä»˜ç­–ç•¥</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PaymentStrategy</span> {
    PaymentResult <span class="hljs-title function_">pay</span><span class="hljs-params">(PaymentRequest request)</span>;
}

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AlipayStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PaymentStrategy</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> PaymentResult <span class="hljs-title function_">pay</span><span class="hljs-params">(PaymentRequest request)</span> {
        <span class="hljs-comment">// æ”¯ä»˜å®æ”¯ä»˜é€»è¾‘</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PaymentResult</span>(<span class="hljs-literal">true</span>, <span class="hljs-string">"æ”¯ä»˜å®æ”¯ä»˜æˆåŠŸ"</span>);
    }
}

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WechatPayStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PaymentStrategy</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> PaymentResult <span class="hljs-title function_">pay</span><span class="hljs-params">(PaymentRequest request)</span> {
        <span class="hljs-comment">// å¾®ä¿¡æ”¯ä»˜é€»è¾‘</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PaymentResult</span>(<span class="hljs-literal">true</span>, <span class="hljs-string">"å¾®ä¿¡æ”¯ä»˜æˆåŠŸ"</span>);
    }
}

<span class="hljs-comment">// ç­–ç•¥å·¥å‚</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentStrategyFactory</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;PaymentType, PaymentStrategy&gt; strategies;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">PaymentStrategyFactory</span><span class="hljs-params">(List&lt;PaymentStrategy&gt; strategyList)</span> {
        <span class="hljs-built_in">this</span>.strategies = strategyList.stream()
            .collect(Collectors.toMap(
                <span class="hljs-built_in">this</span>::getPaymentType,
                strategy -&gt; strategy
            ));
    }
    
    <span class="hljs-keyword">public</span> PaymentStrategy <span class="hljs-title function_">getStrategy</span><span class="hljs-params">(PaymentType type)</span> {
        <span class="hljs-type">PaymentStrategy</span> <span class="hljs-variable">strategy</span> <span class="hljs-operator">=</span> strategies.get(type);
        <span class="hljs-keyword">if</span> (strategy == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"ä¸æ”¯æŒçš„æ”¯ä»˜æ–¹å¼: "</span> + type);
        }
        <span class="hljs-keyword">return</span> strategy;
    }
    
    <span class="hljs-keyword">private</span> PaymentType <span class="hljs-title function_">getPaymentType</span><span class="hljs-params">(PaymentStrategy strategy)</span> {
        <span class="hljs-keyword">if</span> (strategy <span class="hljs-keyword">instanceof</span> AlipayStrategy) {
            <span class="hljs-keyword">return</span> PaymentType.ALIPAY;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (strategy <span class="hljs-keyword">instanceof</span> WechatPayStrategy) {
            <span class="hljs-keyword">return</span> PaymentType.WECHAT;
        }
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"æœªçŸ¥çš„æ”¯ä»˜ç­–ç•¥"</span>);
    }
}

<span class="hljs-comment">// å»ºé€ è€…æ¨¡å¼ï¼šå¤æ‚å¯¹è±¡æ„å»º</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderRequest</span> {
    <span class="hljs-keyword">private</span> Long userId;
    <span class="hljs-keyword">private</span> List&lt;OrderItem&gt; items;
    <span class="hljs-keyword">private</span> Address shippingAddress;
    <span class="hljs-keyword">private</span> PaymentMethod paymentMethod;
    <span class="hljs-keyword">private</span> String remark;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderRequestBuilder</span> {
        <span class="hljs-keyword">public</span> OrderRequestBuilder <span class="hljs-title function_">validate</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">if</span> (userId == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"ç”¨æˆ·IDä¸èƒ½ä¸ºç©º"</span>);
            }
            <span class="hljs-keyword">if</span> (items == <span class="hljs-literal">null</span> || items.isEmpty()) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"è®¢å•é¡¹ä¸èƒ½ä¸ºç©º"</span>);
            }
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }
    }
}

<span class="hljs-comment">// è§‚å¯Ÿè€…æ¨¡å¼ï¼šäº‹ä»¶é€šçŸ¥</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderEventNotifier</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;OrderEventListener&gt; listeners = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CopyOnWriteArrayList</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addListener</span><span class="hljs-params">(OrderEventListener listener)</span> {
        listeners.add(listener);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyOrderCreated</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-type">OrderEvent</span> <span class="hljs-variable">event</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderCreatedEvent</span>(order);
        listeners.forEach(listener -&gt; {
            <span class="hljs-keyword">try</span> {
                listener.onOrderCreated(event);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.error(<span class="hljs-string">"äº‹ä»¶ç›‘å¬å™¨å¤„ç†å¤±è´¥"</span>, e);
            }
        });
    }
}
</code></pre>
<h3 data-id="heading-18">6.2 æ€§èƒ½ä¼˜åŒ–å®è·µ</h3>
<p><strong>æ€§èƒ½ä¼˜åŒ–ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ‰¹é‡æ“ä½œä¼˜åŒ–</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchOperationService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserRepository userRepository;
    
    <span class="hljs-comment">// æ‰¹é‡æ’å…¥ä¼˜åŒ–</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">batchInsertUsers</span><span class="hljs-params">(List&lt;User&gt; users)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">batchSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; users.size(); i += batchSize) {
            List&lt;User&gt; batch = users.subList(i, Math.min(i + batchSize, users.size()));
            userRepository.saveAll(batch);
            userRepository.flush(); <span class="hljs-comment">// å¼ºåˆ¶åˆ·æ–°åˆ°æ•°æ®åº“</span>
        }
    }
    
    <span class="hljs-comment">// å¼‚æ­¥æ‰¹é‡å¤„ç†</span>
    <span class="hljs-meta">@Async</span>
    <span class="hljs-keyword">public</span> CompletableFuture&lt;Void&gt; <span class="hljs-title function_">batchProcessAsync</span><span class="hljs-params">(List&lt;Order&gt; orders)</span> {
        <span class="hljs-keyword">return</span> CompletableFuture.runAsync(() -&gt; {
            orders.parallelStream().forEach(<span class="hljs-built_in">this</span>::processOrder);
        });
    }
}

<span class="hljs-comment">// è¿æ¥æ± ä¼˜åŒ–</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataSourceConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">dataSource</span><span class="hljs-params">()</span> {
        <span class="hljs-type">HikariConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HikariConfig</span>();
        config.setJdbcUrl(<span class="hljs-string">"jdbc:mysql://localhost:3306/db"</span>);
        config.setUsername(<span class="hljs-string">"root"</span>);
        config.setPassword(<span class="hljs-string">"password"</span>);
        
        <span class="hljs-comment">// è¿æ¥æ± ä¼˜åŒ–é…ç½®</span>
        config.setMaximumPoolSize(<span class="hljs-number">20</span>); <span class="hljs-comment">// æœ€å¤§è¿æ¥æ•°</span>
        config.setMinimumIdle(<span class="hljs-number">5</span>); <span class="hljs-comment">// æœ€å°ç©ºé—²è¿æ¥</span>
        config.setConnectionTimeout(<span class="hljs-number">30000</span>); <span class="hljs-comment">// è¿æ¥è¶…æ—¶</span>
        config.setIdleTimeout(<span class="hljs-number">600000</span>); <span class="hljs-comment">// ç©ºé—²è¶…æ—¶</span>
        config.setMaxLifetime(<span class="hljs-number">1800000</span>); <span class="hljs-comment">// æœ€å¤§ç”Ÿå‘½å‘¨æœŸ</span>
        config.setLeakDetectionThreshold(<span class="hljs-number">60000</span>); <span class="hljs-comment">// æ³„æ¼æ£€æµ‹</span>
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HikariDataSource</span>(config);
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python 3.12 æ–°ç‰¹æ€§å®æˆ˜ï¼š10ä¸ªè®©ä½ ä»£ç æ›´ä¼˜é›…çš„éšè—æŠ€å·§]]></title>    <link>https://juejin.cn/post/7572028313930743848</link>    <guid>https://juejin.cn/post/7572028313930743848</guid>    <pubDate>2025-11-14T00:17:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572028313930743848" data-draft-id="7572010680897290280" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python 3.12 æ–°ç‰¹æ€§å®æˆ˜ï¼š10ä¸ªè®©ä½ ä»£ç æ›´ä¼˜é›…çš„éšè—æŠ€å·§"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-14T00:17:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT_é™ˆå¯’"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python 3.12 æ–°ç‰¹æ€§å®æˆ˜ï¼š10ä¸ªè®©ä½ ä»£ç æ›´ä¼˜é›…çš„éšè—æŠ€å·§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT_é™ˆå¯’
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T00:17:21.000Z" title="Fri Nov 14 2025 00:17:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    15
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Python 3.12 æ–°ç‰¹æ€§å®æˆ˜ï¼š10ä¸ªè®©ä½ ä»£ç æ›´ä¼˜é›…çš„éšè—æŠ€å·§</strong></h2>
<h2 data-id="heading-1">å¼•è¨€</h2>
<p>Python 3.12ä½œä¸ºPythonè¯­è¨€çš„æœ€æ–°ç¨³å®šç‰ˆæœ¬ï¼Œå¸¦æ¥äº†è®¸å¤šä»¤äººå…´å¥‹çš„æ–°ç‰¹æ€§å’Œæ”¹è¿›ã€‚å°½ç®¡ä¸€äº›å˜åŒ–ï¼ˆå¦‚æ€§èƒ½ä¼˜åŒ–å’Œç±»å‹ç³»ç»Ÿå¢å¼ºï¼‰å·²ç»è¢«å¹¿æ³›è®¨è®ºï¼Œä½†è¿˜æœ‰ä¸€äº›éšè—çš„æŠ€å·§å’ŒåŠŸèƒ½å°šæœªè¢«å……åˆ†å‘æ˜ã€‚è¿™äº›ç‰¹æ€§ä¸ä»…èƒ½è®©ä½ çš„ä»£ç æ›´åŠ ç®€æ´é«˜æ•ˆï¼Œè¿˜èƒ½æå‡å¼€å‘ä½“éªŒã€‚</p>
<p>æœ¬æ–‡å°†æ·±å…¥æ¢è®¨Python 3.12ä¸­10ä¸ªé²œä¸ºäººçŸ¥ä½†æå…¶å®ç”¨çš„ç‰¹æ€§ï¼Œå¹¶é€šè¿‡å®é™…ä»£ç ç¤ºä¾‹å±•ç¤ºå¦‚ä½•å°†å®ƒä»¬åº”ç”¨åˆ°ä½ çš„é¡¹ç›®ä¸­ã€‚æ— è®ºä½ æ˜¯æ•°æ®ç§‘å­¦å®¶ã€Webå¼€å‘è€…è¿˜æ˜¯è‡ªåŠ¨åŒ–è„šæœ¬ç¼–å†™è€…ï¼Œè¿™äº›æŠ€å·§éƒ½èƒ½å¸®åŠ©ä½ å†™å‡ºæ›´ä¼˜é›…çš„Pythonä»£ç ã€‚</p>
<hr/>
<h2 data-id="heading-2">ä¸»ä½“å†…å®¹</h2>
<h3 data-id="heading-3">1. æ›´çµæ´»çš„f-stringè¡¨è¾¾å¼</h3>
<p>Python 3.12è¿›ä¸€æ­¥æ‰©å±•äº†f-stringçš„åŠŸèƒ½ï¼Œå…è®¸åœ¨è¡¨è¾¾å¼éƒ¨åˆ†ä½¿ç”¨æ›´å¤šè¯­æ³•ç»“æ„ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Python 3.12ä¹‹å‰ä¼šæŠ¥é”™</span>
value = <span class="hljs-string">"hello"</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{value.upper() <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(value) &gt; <span class="hljs-number">3</span> <span class="hljs-keyword">else</span> value.lower()}</span>"</span>)

<span class="hljs-comment"># Python 3.12æ–°å¢æ”¯æŒå¤šè¡Œè¡¨è¾¾å¼å’Œæ³¨é‡Š</span>
name = <span class="hljs-string">"Alice"</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Welcome, <span class="hljs-subst">{
    name.upper() 
    # This comment <span class="hljs-keyword">is</span> now valid
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(name) &gt; <span class="hljs-number">5</span> 
    <span class="hljs-keyword">else</span> name.lower()
}</span>"</span>)
</code></pre>
<p>è¿™é¡¹æ”¹è¿›ä½¿å¾—f-stringèƒ½å¤Ÿå¤„ç†æ›´å¤æ‚çš„é€»è¾‘ï¼ŒåŒæ—¶ä¿æŒä»£ç å¯è¯»æ€§ã€‚</p>
<h3 data-id="heading-4">2. TypedDictçš„æ”¹è¿›ä¸<code>Required</code>/<code>NotRequired</code></h3>
<p>ç±»å‹æ³¨è§£ç³»ç»Ÿè¿æ¥é‡è¦æ›´æ–°ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypedDict, Required, NotRequired

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    name: Required[<span class="hljs-built_in">str</span>]
    age: NotRequired[<span class="hljs-built_in">int</span>]

<span class="hljs-comment"># Python 3.12è¿˜æ”¯æŒä»»æ„é”®åçš„TypedDict</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>(TypedDict, total=<span class="hljs-literal">False</span>):
    __extra_items__: <span class="hljs-built_in">str</span> | <span class="hljs-built_in">int</span>
</code></pre>
<p>è¿™äº›æ”¹è¿›è®©ç±»å‹ç³»ç»Ÿèƒ½æ›´å¥½åœ°æè¿°ç°å®ä¸–ç•Œçš„æ•°æ®ç»“æ„ã€‚</p>
<h3 data-id="heading-5">3. <code>@override</code>è£…é¥°å™¨çš„å¼•å…¥</h3>
<p>æ–°çš„è£…é¥°å™¨å¸®åŠ©æ•è·å­ç±»æ–¹æ³•é‡å†™æ—¶çš„é”™è¯¯ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> override

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">method</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">int</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span>(<span class="hljs-title class_ inherited__">Parent</span>):
<span class="hljs-meta">    @override</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">method</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">int</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>().method() * <span class="hljs-number">2</span>
    
    <span class="hljs-comment"># @overrideä¼šæ£€æµ‹åˆ°è¿™ä¸ªæ‹¼å†™é”™è¯¯</span>
    <span class="hljs-comment"># def methid(self): pass  </span>
</code></pre>
<p>è¿™åœ¨å¤§å‹é¡¹ç›®ä¸­èƒ½æœ‰æ•ˆé˜²æ­¢å› æ–¹æ³•åæ‹¼å†™é”™è¯¯å¯¼è‡´çš„bugã€‚</p>
<h3 data-id="heading-6">4. Bufferåè®®çš„é‡å¤§æ”¹è¿›</h3>
<p>å¯¹äºé«˜æ€§èƒ½æ•°å€¼è®¡ç®—å’Œæ•°æ®å¤„ç†çš„é‡å¤§æå‡ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_buffer</span>(<span class="hljs-params">buf: <span class="hljs-built_in">memoryview</span></span>) -&gt; <span class="hljs-literal">None</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Processing buffer with shape <span class="hljs-subst">{buf.shape}</span>"</span>)

arr = np.array([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>], dtype=np.int32)
process_buffer(<span class="hljs-built_in">memoryview</span>(arr))
</code></pre>
<p>æ–°çš„ç¼“å†²åè®®æ”¯æŒå¤šç»´æ•°ç»„å’Œæ›´å¤šæ•°æ®ç±»å‹ã€‚</p>
<h3 data-id="heading-7">5. <code>ExceptionGroup</code>å’Œ<code>except*</code>çš„å®é™…åº”ç”¨</h3>
<p>æ›´å¥½çš„å¼‚å¸¸å¤„ç†æ–¹å¼ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">raise</span> ExceptionGroup(
        <span class="hljs-string">"Multiple errors"</span>,
        [ValueError(<span class="hljs-string">"bad value"</span>), TypeError(<span class="hljs-string">"wrong type"</span>)]
    )
<span class="hljs-keyword">except</span>* ValueError <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Caught ValueErrors: <span class="hljs-subst">{e.exceptions}</span>"</span>)
<span class="hljs-keyword">except</span>* TypeError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Caught TypeErrors"</span>)
</code></pre>
<p>è¿™å¯¹äºå¹¶å‘ç¼–ç¨‹å’Œå¤æ‚ç³»ç»Ÿä¸­çš„é”™è¯¯å¤„ç†ç‰¹åˆ«æœ‰ç”¨ã€‚</p>
<h3 data-id="heading-8">6. Unpackingæ³›å‹ç±»å‹çš„å¢å¼ºæ”¯æŒ</h3>
<p>ç±»å‹ç³»ç»Ÿä¸­æ›´å¥½çš„è§£åŒ…æ”¯æŒï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Unpack, TypedDict

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Point</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    x: <span class="hljs-built_in">float</span>
    y: <span class="hljs-built_in">float</span>
    
<span class="hljs-keyword">def</span> <span class="hljs-title function_">draw_point</span>(<span class="hljs-params">**kwargs: Unpack[Point]</span>) -&gt; <span class="hljs-literal">None</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Drawing at (<span class="hljs-subst">{kwargs[<span class="hljs-string">'x'</span>]}</span>, <span class="hljs-subst">{kwargs[<span class="hljs-string">'y'</span>]}</span>)"</span>)
    
draw_point(x=<span class="hljs-number">1.0</span>, y=<span class="hljs-number">2.0</span>)
</code></pre>
<p>è¿™ä½¿å¾—ç±»å‹æ£€æŸ¥å™¨èƒ½æ›´å¥½åœ°ç†è§£å¯å˜å…³é”®å­—å‚æ•°çš„ç»“æ„ã€‚</p>
<h3 data-id="heading-9">7. <code>asyncio.TaskGroup</code>æ›¿ä»£æ—§ç‰ˆAPI</h3>
<p>æ›´ç°ä»£çš„å¼‚æ­¥ç¼–ç¨‹æ–¹å¼ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">worker</span>(<span class="hljs-params">name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"Result from <span class="hljs-subst">{name}</span>"</span>

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> asyncio.TaskGroup() <span class="hljs-keyword">as</span> tg:
        task1 = tg.create_task(worker(<span class="hljs-string">"task1"</span>))
        task2 = tg.create_task(worker(<span class="hljs-string">"task2"</span>))
    
    <span class="hljs-built_in">print</span>(task1.result(), task2.result())

asyncio.run(main())
</code></pre>
<p>TaskGroupæä¾›äº†æ¯”gatheræ›´å®‰å…¨çš„ä»»åŠ¡ç®¡ç†æ–¹å¼ã€‚</p>
<h3 data-id="heading-10">8. <code>sys.excepthook</code>çº¿ç¨‹å®‰å…¨æ€§çš„æ”¹å–„</h3>
<p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­æ›´å¯é çš„å¼‚å¸¸å¤„ç†ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sys, threading

<span class="hljs-keyword">def</span> <span class="hljs-title function_">custom_hook</span>(<span class="hljs-params">exc_type, exc_value, exc_traceback</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Caught <span class="hljs-subst">{exc_type.__name__}</span>: <span class="hljs-subst">{exc_value}</span>"</span>)

sys.excepthook = custom_hook

<span class="hljs-keyword">def</span> <span class="hljs-title function_">worker</span>():
    <span class="hljs-number">1</span>/<span class="hljs-number">0</span>
    
threading.Thread(target=worker).start()
</code></pre>
<p>ç°åœ¨å¯ä»¥ç¡®ä¿è‡ªå®šä¹‰å¼‚å¸¸é’©å­åœ¨æ‰€æœ‰çº¿ç¨‹ä¸­éƒ½ç”Ÿæ•ˆã€‚</p>
<h3 data-id="heading-11">9. <code>dataclass_transform</code>è£…é¥°å™¨çš„å¨åŠ›</h3>
<p>åˆ›å»ºè‡ªå®šä¹‰æ•°æ®ç±»è£…é¥°å™¨å˜å¾—æ›´å®¹æ˜“ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> dataclass_transform, <span class="hljs-type">Any</span> 

<span class="hljs-meta">@dataclass_transform()</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_model</span>(<span class="hljs-params">cls: <span class="hljs-built_in">type</span>[<span class="hljs-type">Any</span>]</span>) -&gt; <span class="hljs-built_in">type</span>[<span class="hljs-type">Any</span>]:
   <span class="hljs-comment"># ...å®ç°è‡ªå®šä¹‰é€»è¾‘...</span>
   <span class="hljs-keyword">return</span> cls 

<span class="hljs-meta">@create_model </span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Point</span>:
   x: <span class="hljs-built_in">float</span> 
   y: <span class="hljs-built_in">float</span> 

p = Point(x=<span class="hljs-number">1</span>, y=<span class="hljs-number">2</span>)  
<span class="hljs-built_in">print</span>(p.x)  
</code></pre>
<p>è¿™å¯¹äºæ¡†æ¶å¼€å‘è€…ç‰¹åˆ«æœ‰ä»·å€¼ã€‚</p>
<h3 data-id="heading-12">10. GILä¼˜åŒ–çš„å®é™…å½±å“ï¼ˆè™½ç„¶ä¸å®Œå…¨éšè—ï¼‰</h3>
<p>è™½ç„¶GILä¼˜åŒ–ä¸æ˜¯éšè—ç‰¹æ€§ï¼Œä½†å®ƒçš„å®é™…å½±å“å€¼å¾—å…³æ³¨ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> concurrent.futures 
<span class="hljs-keyword">import</span> time 

<span class="hljs-keyword">def</span> <span class="hljs-title function_">compute</span>(<span class="hljs-params">n</span>):
   <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>(i*i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n))

start = time.perf_counter()
<span class="hljs-keyword">with</span> concurrent.futures.ThreadPoolExecutor() <span class="hljs-keyword">as</span> executor:
   results = <span class="hljs-built_in">list</span>(executor.<span class="hljs-built_in">map</span>(compute, [<span class="hljs-number">10_000_000</span>]*<span class="hljs-number">8</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Time taken: <span class="hljs-subst">{time.perf_counter()-start:<span class="hljs-number">.2</span>f}</span>s"</span>)
</code></pre>
<p>åœ¨I/Oå¯†é›†å‹ä»»åŠ¡ä¸­å¯èƒ½çœ‹åˆ°æ˜¾è‘—çš„æ€§èƒ½æå‡ï¼ˆå…·ä½“å–å†³äºå·¥ä½œè´Ÿè½½ï¼‰ã€‚</p>
<hr/>
<h2 data-id="heading-13">Pythonå†…éƒ¨æœºåˆ¶çš„å®ç”¨æŠ€å·§ï¼ˆå¥–åŠ±å†…å®¹ï¼‰</h2>
<p>é™¤äº†è¯­è¨€ç‰¹æ€§çš„æ›´æ–°å¤–ï¼Œäº†è§£ä¸€äº›å†…éƒ¨æœºåˆ¶ä¹Ÿèƒ½è®©ä½ çš„ä»£ç æ›´é«˜æ•ˆï¼š</p>
<ul>
<li><strong>æ¨¡å—åŠ è½½åŠ é€Ÿ</strong>ï¼šåˆ©ç”¨PYTHONPYCACHEPREFIXé›†ä¸­ç¼“å­˜å­—èŠ‚ç æ–‡ä»¶åŠ å¿«å¯¼å…¥é€Ÿåº¦ã€‚</li>
<li><strong>å†…å­˜è§†å›¾å…±äº«</strong>ï¼šä½¿ç”¨memoryviewåœ¨ä¸åŒæ•°æ®ç»“æ„é—´å…±äº«å†…å­˜è€Œä¸å¤åˆ¶æ•°æ®ã€‚</li>
<li><strong>å­—å…¸æ’å…¥é¡ºåºä¿è¯</strong>ï¼šä¾èµ–dictä¿æŒæ’å…¥é¡ºåºçš„ç‰¹æ€§ç®€åŒ–æŸäº›ç®—æ³•å®ç°ã€‚</li>
<li><strong>è§£é‡Šå™¨å¯åŠ¨ä¼˜åŒ–</strong>ï¼šé€šè¿‡PYTHONNODEBUGRANGESç¦ç”¨è°ƒè¯•ä¿¡æ¯æé«˜å¯åŠ¨é€Ÿåº¦ã€‚</li>
<li><strong>å­—èŠ‚ç å†…è”ç¼“å­˜</strong>ï¼šäº†è§£å¦‚ä½•ç¼–å†™åˆ©äºJITä¼˜åŒ–çš„æ¨¡å¼åŒ¹é…è¯­å¥ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-14">APIå…¼å®¹æ€§æ³¨æ„äº‹é¡¹ä¸è¿ç§»ç­–ç•¥</h2>
<p>å‡çº§åˆ°Python3.12æ—¶éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li>datetimeæ¨¡å—UTCç›¸å…³è¡Œä¸ºçš„å˜æ›´å¯èƒ½å½±å“æ—¶é—´æ•æ„Ÿåº”ç”¨ã€‚</li>
<li>Deprecatedçš„distutilså·²è¢«å®Œå…¨ç§»é™¤ã€‚</li>
<li>TLSç›¸å…³é»˜è®¤è®¾ç½®çš„å¼ºåŒ–å¯èƒ½å¯¼è‡´æ—§æœåŠ¡å™¨è¿æ¥å¤±è´¥ã€‚</li>
<li>pathlib.Path.glob()æ–¹æ³•ç°åœ¨éµå¾ªå¤§å°å†™æ•æ„Ÿæ€§è§„åˆ™çš„ä¸€è‡´æ€§æ›´å¥½ã€‚</li>
</ul>
<p>å»ºè®®è¿ç§»æ­¥éª¤ï¼š</p>
<ol>
<li><code>pip install pyupgrade</code></li>
<li><code>pyupgrade --py312-plus your_code.py</code></li>
<li><code>mypy --strict</code></li>
<li><code>pytest -xvs your_tests/</code></li>
</ol>
<hr/>
<h2 data-id="heading-15">æ€»ç»“ä¸å±•æœ›æ€è€ƒé¢˜ä¸å®è·µå»ºè®®æ¢ç´¢æ›´å¤šå¯èƒ½æ€§æœ€ä½³å®è·µåˆ†äº«ç¤¾åŒºèµ„æºæ¨èè¿›é˜¶å­¦ä¹ è·¯å¾„ç»“è¯­</h2></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»£ç éš”ç¦»é©å‘½ï¼šç”¨ JavaScript Realm å®‰å…¨è¿è¡Œä¸å¯ä¿¡ä»£ç ]]></title>    <link>https://juejin.cn/post/7572190151351566336</link>    <guid>https://juejin.cn/post/7572190151351566336</guid>    <pubDate>2025-11-14T06:51:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572190151351566336" data-draft-id="7572161976593317940" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»£ç éš”ç¦»é©å‘½ï¼šç”¨ JavaScript Realm å®‰å…¨è¿è¡Œä¸å¯ä¿¡ä»£ç "/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-11-14T06:51:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§çŸ¥é—²é—²i"/> <meta itemprop="url" content="https://juejin.cn/user/3799545205237111"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»£ç éš”ç¦»é©å‘½ï¼šç”¨ JavaScript Realm å®‰å…¨è¿è¡Œä¸å¯ä¿¡ä»£ç 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3799545205237111/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§çŸ¥é—²é—²i
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T06:51:12.000Z" title="Fri Nov 14 2025 06:51:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    33
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å¤šå¹´çš„å¼€å‘ç”Ÿæ¶¯ä¸­ï¼Œæˆ‘å¸¦é¢†å›¢é˜Ÿäº¤ä»˜äº†æ— æ•°ä¸­ç­‰è§„æ¨¡çš„å¤–åŒ…é¡¹ç›®ï¼Œé‡åˆ°è¿‡å„ç§æ£˜æ‰‹çš„æŠ€æœ¯æŒ‘æˆ˜ã€‚ä½†æœ€è¿‘åœ¨è°ƒè¯•ä¸€ä¸ªå¤æ‚çš„å¤š iframe åº”ç”¨æ—¶ï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªè¢«å¤§å¤šæ•°å¼€å‘è€…å¿½ç•¥çš„ JavaScript ç‰¹æ€§ï¼Œå®ƒå½»åº•æ”¹å˜äº†æˆ‘å¯¹ä»£ç å®‰å…¨æ€§çš„è®¤çŸ¥ã€‚</p>
<p>======================================================================================================================</p>
<h2 data-id="heading-0">ä»ä¸€æ¬¡ç”Ÿäº§äº‹æ•…è¯´èµ·</h2>
<p>æƒ³è±¡è¿™ä¸ªåœºæ™¯ï¼šä½ ä¸ºå®¢æˆ·çš„xxå¹³å°å¼€å‘äº†ä¸€ä¸ªæ’ä»¶ç³»ç»Ÿï¼Œå…è®¸å•†å®¶ç¼–å†™è‡ªå®šä¹‰ JavaScript æ¥å¢å¼ºåº—é“ºåŠŸèƒ½ã€‚ä¸€åˆ‡éƒ½å¾ˆç¾å¥½ï¼Œç›´åˆ°æŸä¸ªå•†å®¶å†™äº†è¿™æ ·çš„ä»£ç ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æŸä¸ª"åˆ›æ–°"å•†å®¶çš„æ’ä»¶ä»£ç </span>
<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">push</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"å“ˆå“ˆï¼Œæˆ‘é‡å†™äº†æ•°ç»„æ–¹æ³•ï¼"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-string">"æç ´åäº†"</span>;
};
</code></pre>
<p>ç»“æœå¦‚ä½•ï¼Ÿæ•´ä¸ªxxå¹³å°çš„è´­ç‰©è½¦ã€å•†å“åˆ—è¡¨ã€è®¢å•ç³»ç»Ÿå…¨çº¿å´©æºƒã€‚è¿™å°±æ˜¯å…¸å‹çš„å…¨å±€æ±¡æŸ“é—®é¢˜â€”â€”å½“ä¸å¯ä¿¡ä»£ç ä¸æ ¸å¿ƒä¸šåŠ¡å…±äº«åŒä¸€ä¸ªæ‰§è¡Œç¯å¢ƒæ—¶ï¼Œç¾éš¾éšæ—¶å¯èƒ½å‘ç”Ÿã€‚</p>
<h2 data-id="heading-1">Realmï¼šJavaScript çš„éš”ç¦»è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-2">ä»€ä¹ˆæ˜¯ Realmï¼Ÿ</h3>
<p>Realm æ˜¯ JavaScript çš„éš”ç¦»æ‰§è¡Œç¯å¢ƒï¼Œå¯ä»¥ç†è§£ä¸º"ä¸€å¥—å…¨æ–°çš„ JavaScript å®‡å®™"ã€‚æ¯ä¸ª Realm éƒ½æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„å†…ç½®å¯¹è±¡å’Œå…¨å±€ä½œç”¨åŸŸã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸»ç¯å¢ƒ</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Array</span>); <span class="hljs-comment">// [Function: Array]</span>

<span class="hljs-comment">// åˆ›å»º iframeï¼ˆè‡ªåŠ¨ç”Ÿæˆæ–° Realmï¼‰</span>
<span class="hljs-keyword">const</span> iframe = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'iframe'</span>);
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(iframe);

<span class="hljs-comment">// iframe ä¸­çš„ Array æ˜¯å…¨æ–°çš„æ„é€ å™¨</span>
<span class="hljs-keyword">const</span> iframeArray = iframe.<span class="hljs-property">contentWindow</span>.<span class="hljs-property">Array</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Array</span> === iframeArray); <span class="hljs-comment">// falseï¼</span>
</code></pre>
<p>çœ‹åˆ°è¿™ä¸ªç»“æœæ—¶ï¼Œæˆ‘å›¢é˜Ÿçš„å°ä¼™ä¼´ä»¬éƒ½æƒŠå‘†äº†ã€‚ä¸¤ä¸ª Array æ„é€ å™¨åŠŸèƒ½å®Œå…¨ç›¸åŒï¼Œä½†å´æ˜¯å®Œå…¨ç‹¬ç«‹çš„å¯¹è±¡ï¼Œè¿™å°±æ˜¯ Realm çš„å¼ºå¤§ä¹‹å¤„ã€‚</p>
<h3 data-id="heading-3">Realm çš„ç»„æˆè¦ç´ </h3>
<p>æ¯ä¸ª Realm éƒ½åŒ…å«å®Œæ•´çš„è¿è¡Œç¯å¢ƒï¼š</p>
<ul>
<li>
<p><strong>å…¨å±€å¯¹è±¡</strong>ï¼šæµè§ˆå™¨ä¸­çš„ window æˆ– Node.js ä¸­çš„ global</p>
</li>
<li>
<p><strong>å†…ç½®æ„é€ å™¨</strong>ï¼šArrayã€Objectã€Functionã€Error ç­‰</p>
</li>
<li>
<p><strong>å·¥å…·å‡½æ•°</strong>ï¼šsetTimeoutã€fetchã€JSON ç­‰</p>
</li>
<li>
<p><strong>åŸå‹å¯¹è±¡</strong>ï¼šArray.prototypeã€Object.prototype ç­‰åŸºç¡€åŸå‹</p>
</li>
</ul>
<h2 data-id="heading-4">å®æˆ˜ï¼šä¸‰ç§ Realm å®ç°æ–¹æ¡ˆ</h2>
<h3 data-id="heading-5">æ–¹æ¡ˆä¸€ï¼šShadowRealmï¼ˆæœªæ¥æ ‡å‡†ï¼‰</h3>
<p>ShadowRealm æ˜¯ TC39 æ ‡å‡†ææ¡ˆï¼ˆStage 3ï¼‰ï¼Œä¸“ä¸ºä»£ç éš”ç¦»è®¾è®¡ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// åˆ›å»ºéš”ç¦»ç¯å¢ƒ</span>
<span class="hljs-type">const</span> realm = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ShadowRealm</span>();

<span class="hljs-comment">// å®‰å…¨æ‰§è¡Œä¸å¯ä¿¡ä»£ç </span>
<span class="hljs-type">const</span> result = realm.<span class="hljs-built_in">evaluate</span>(`
    <span class="hljs-comment">// è¿™é‡Œæ— æ³•è®¿é—®ä¸»ç¯å¢ƒçš„ä»»ä½•å˜é‡</span>
    <span class="hljs-type">const</span> sensitiveData = <span class="hljs-string">"è¿™æ®µæ•°æ®å¾ˆå®‰å…¨"</span>;
    <span class="hljs-number">2</span> + <span class="hljs-number">2</span>
`);

console.<span class="hljs-built_in">log</span>(result); <span class="hljs-comment">// 4</span>
console.<span class="hljs-built_in">log</span>(typeof sensitiveData); <span class="hljs-comment">// undefinedï¼ˆå®Œå…¨éš”ç¦»ï¼‰</span>
</code></pre>
<p>å½“å‰å¯ç”¨ polyfillï¼š</p>
<pre><code class="hljs language-ini" lang="ini">npm install shadowrealm-api

import ShadowRealm from 'shadowrealm-api'<span class="hljs-comment">;</span>

const <span class="hljs-attr">realm</span> = new ShadowRealm()<span class="hljs-comment">;</span>
const <span class="hljs-attr">userCodeResult</span> = realm.evaluate(userSuppliedCode)<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-6">æ–¹æ¡ˆäºŒï¼šiframe æ²™ç®±ï¼ˆç”Ÿäº§ç¯å¢ƒé¦–é€‰ï¼‰</h3>
<p>å¯¹äºéœ€è¦ç«‹å³ä¸Šçº¿çš„é¡¹ç›®ï¼Œiframe æ˜¯æœ€å¯é çš„è§£å†³æ–¹æ¡ˆï¼š</p>
<pre><code class="hljs language-ini" lang="ini">function createSafeSandbox() {
    const <span class="hljs-attr">frame</span> = document.createElement(<span class="hljs-string">'iframe'</span>)<span class="hljs-comment">;</span>
    
    // å…³é”®é…ç½®ï¼šé™åˆ¶æƒé™
    <span class="hljs-attr">frame.sandbox</span> = [
        <span class="hljs-string">'allow-scripts'</span>,     // å…è®¸æ‰§è¡Œè„šæœ¬
        // <span class="hljs-string">'allow-same-origin'</span> // è°¨æ…ä½¿ç”¨ï¼šå…è®¸åŒæºè®¿é—®
    ].join(<span class="hljs-string">' '</span>)<span class="hljs-comment">;</span>
    
    <span class="hljs-attr">frame.style.display</span> = <span class="hljs-string">'none'</span><span class="hljs-comment">;</span>
    document.body.appendChild(frame)<span class="hljs-comment">;</span>
    
    return {
        evaluate: (code) =&gt; frame.contentWindow.eval(code),
        destroy: () =&gt; frame.remove()
    }<span class="hljs-comment">;</span>
}

// ä½¿ç”¨ç¤ºä¾‹
const <span class="hljs-attr">sandbox</span> = createSafeSandbox()<span class="hljs-comment">;</span>
try {
    const <span class="hljs-attr">result</span> = sandbox.evaluate(<span class="hljs-string">'2 + 2'</span>)<span class="hljs-comment">;</span>
    console.log('å®‰å…¨è®¡ç®—ç»“æœ:', result)<span class="hljs-comment">;</span>
} finally {
    sandbox.destroy()<span class="hljs-comment">;</span>
}
</code></pre>
<h3 data-id="heading-7">æ–¹æ¡ˆä¸‰ï¼šWeb Workerï¼ˆçº¯è®¡ç®—åœºæ™¯ï¼‰</h3>
<p>å¯¹äº CPU å¯†é›†å‹ä»»åŠ¡ï¼ŒWeb Worker æä¾›è‰¯å¥½çš„éš”ç¦»æ€§ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// åˆ›å»ºéš”ç¦»çš„å·¥ä½œçº¿ç¨‹</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">workerCode</span> = `
    <span class="hljs-built_in">self</span>.onmessage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">result</span> = <span class="hljs-keyword">eval</span>(e.data.code);
            <span class="hljs-built_in">self</span>.<span class="hljs-title function_ invoke__">postMessage</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, result });
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-built_in">self</span>.<span class="hljs-title function_ invoke__">postMessage</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: error.message });
        }
    };
`;

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">blob</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([workerCode], { type: <span class="hljs-string">'application/javascript'</span> });
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">worker</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(URL.<span class="hljs-title function_ invoke__">createObjectURL</span>(blob));

worker.onmessage = (e) =&gt; {
    <span class="hljs-keyword">if</span> (e.data.success) {
        console.<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-string">'Worker è®¡ç®—ç»“æœ:'</span>, e.data.result);
    } <span class="hljs-keyword">else</span> {
        console.<span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">'æ‰§è¡Œå‡ºé”™:'</span>, e.data.error);
    }
};

<span class="hljs-comment">// æ‰§è¡Œç”¨æˆ·ä»£ç </span>
worker.<span class="hljs-title function_ invoke__">postMessage</span>({
    <span class="hljs-attr">code</span>: <span class="hljs-string">'Math.pow(2, 10)'</span> // ç”¨æˆ·æä¾›çš„ä»£ç 
});
</code></pre>
<h2 data-id="heading-8">çœŸå®æ¡ˆä¾‹ï¼šæ’ä»¶ç³»ç»Ÿå®‰å…¨æ”¹é€ </h2>
<p>æˆ‘ä»¬æœ€è¿‘ä¸ºä¸€å®¶é‡‘èç§‘æŠ€å®¢æˆ·é‡æ„äº†ä»–ä»¬çš„æŠ¥è¡¨æ’ä»¶ç³»ç»Ÿã€‚æ”¹é€ å‰ï¼Œç¬¬ä¸‰æ–¹æ’ä»¶ç»å¸¸å¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒï¼›æ”¹é€ åï¼Œå³ä½¿æ’ä»¶ä»£ç å­˜åœ¨é—®é¢˜ï¼Œä¹Ÿåªä¼šå½±å“è‡ªèº«è¿è¡Œã€‚</p>
<h3 data-id="heading-9">æ”¹é€ å‰çš„é—®é¢˜ä»£ç ï¼š</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è€ç³»ç»Ÿï¼šç›´æ¥æ‰§è¡Œæ’ä»¶ä»£ç </span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">runPlugin</span>(<span class="hljs-params">pluginCode</span>) {
    <span class="hljs-comment">// å±é™©ï¼æ’ä»¶å¯ä»¥è®¿é—®å’Œä¿®æ”¹å…¨å±€çŠ¶æ€</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">eval</span>(pluginCode);
}
</code></pre>
<h3 data-id="heading-10">æ”¹é€ åçš„å®‰å…¨æ–¹æ¡ˆï¼š</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PluginSandbox</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">iframe</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'iframe'</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">iframe</span>.<span class="hljs-property">sandbox</span> = <span class="hljs-string">'allow-scripts'</span>;
        <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">iframe</span>);
    }
    
    <span class="hljs-title function_">runPlugin</span>(<span class="hljs-params">pluginCode, api</span>) {
        <span class="hljs-comment">// é€šè¿‡ postMessage æä¾›æœ‰é™çš„ API</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">iframe</span>.<span class="hljs-property">contentWindow</span>.<span class="hljs-title function_">postMessage</span>({
            <span class="hljs-attr">type</span>: <span class="hljs-string">'EXECUTE'</span>,
            <span class="hljs-attr">code</span>: pluginCode,
            <span class="hljs-attr">api</span>: api
        }, <span class="hljs-string">'*'</span>);
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
            <span class="hljs-keyword">const</span> <span class="hljs-title function_">handler</span> = (<span class="hljs-params">event</span>) =&gt; {
                <span class="hljs-keyword">if</span> (event.<span class="hljs-property">data</span>.<span class="hljs-property">type</span> === <span class="hljs-string">'RESULT'</span>) {
                    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'message'</span>, handler);
                    <span class="hljs-title function_">resolve</span>(event.<span class="hljs-property">data</span>.<span class="hljs-property">result</span>);
                }
            };
            <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, handler);
        });
    }
}
</code></pre>
<h2 data-id="heading-11">ä½•æ—¶åº”è¯¥ä½¿ç”¨ Realm æŠ€æœ¯ï¼Ÿ</h2>
<p>æ ¹æ®æˆ‘ä»¬çš„é¡¹ç›®ç»éªŒï¼Œä»¥ä¸‹åœºæ™¯å¼ºçƒˆæ¨èä½¿ç”¨ Realmï¼š</p>
<ol>
<li>
<p><strong>ç”¨æˆ·ä»£ç æ‰§è¡Œ</strong>ï¼šåœ¨çº¿ä»£ç ç¼–è¾‘å™¨ã€æ•™å­¦å¹³å°</p>
</li>
<li>
<p><strong>ç¬¬ä¸‰æ–¹æ’ä»¶</strong>ï¼šCMS ç³»ç»Ÿã€ç”µå•†å¹³å°çš„æ‰©å±•åŠŸèƒ½</p>
</li>
<li>
<p><strong>A/B æµ‹è¯•</strong>ï¼šéš”ç¦»ä¸åŒç‰ˆæœ¬çš„ä»£ç é€»è¾‘</p>
</li>
<li>
<p><strong>å•å…ƒæµ‹è¯•</strong>ï¼šç¡®ä¿æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ç¯å¢ƒçº¯å‡€</p>
</li>
<li>
<p><strong>å¾®å‰ç«¯æ¶æ„</strong>ï¼šéš”ç¦»ä¸åŒå›¢é˜Ÿå¼€å‘çš„å­åº”ç”¨</p>
</li>
</ol>
<h2 data-id="heading-12">å®‰å…¨æœ€ä½³å®è·µ</h2>
<p>åœ¨å¤šä¸ªé‡‘èçº§é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬æ€»ç»“å‡ºè¿™äº›å®‰å…¨å‡†åˆ™ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// å®‰å…¨é…ç½®ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> SAFE_SANDBOX_CONFIG = [
    <span class="hljs-string">'allow-scripts'</span>,        <span class="hljs-comment">// å¿…éœ€ï¼šæ‰§è¡Œè„šæœ¬</span>
    <span class="hljs-comment">// 'allow-forms',       // è°¨æ…ï¼šè¡¨å•æäº¤</span>
    <span class="hljs-comment">// 'allow-popups',      // è°¨æ…ï¼šå¼¹å‡ºçª—å£</span>
    <span class="hljs-comment">// 'allow-same-origin', // å±é™©ï¼šåŒæºè®¿é—®</span>
    <span class="hljs-comment">// 'allow-top-navigation' // å±é™©ï¼šé¡¶çº§å¯¼èˆª</span>
];

<span class="hljs-comment">// æ°¸è¿œéªŒè¯è¾“å…¥</span>
<span class="hljs-function">function <span class="hljs-title">validateCode</span>(<span class="hljs-params">code</span>)</span> {
    <span class="hljs-keyword">const</span> blacklist = [
        <span class="hljs-string">'document.cookie'</span>,
        <span class="hljs-string">'localStorage'</span>,
        <span class="hljs-string">'XMLHttpRequest'</span>,
        <span class="hljs-string">'fetch'</span>,
        <span class="hljs-string">'window.parent'</span>
    ];
    
    <span class="hljs-keyword">return</span> !blacklist.some(<span class="hljs-keyword">unsafe</span> =&gt; code.includes(<span class="hljs-keyword">unsafe</span>));
}
</code></pre>
<h2 data-id="heading-13">æœªæ¥å±•æœ›</h2>
<p>ShadowRealm æ ‡å‡†è½åœ°åï¼ŒJavaScript ä»£ç éš”ç¦»å°†å˜å¾—æ›´åŠ ç®€å•é«˜æ•ˆã€‚æˆ‘ä»¬å›¢é˜Ÿæ­£åœ¨å¯†åˆ‡å…³æ³¨ç›¸å…³è¿›å±•ï¼Œå¹¶å·²åœ¨å‡ ä¸ªå®éªŒæ€§é¡¹ç›®ä¸­å¼€å§‹ä½¿ç”¨ polyfill ç‰ˆæœ¬ã€‚</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ§  å¯å®šåˆ¶åŒ– AIGCï¼šWeb ç”¨æˆ·ä¸ªæ€§åŒ–æ¨¡å‹è®­ç»ƒçš„æŠ€æœ¯é—¨æ§›æ­£åœ¨å¡Œç¼©ï¼]]></title>    <link>https://juejin.cn/post/7572095192418435099</link>    <guid>https://juejin.cn/post/7572095192418435099</guid>    <pubDate>2025-11-14T01:24:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572095192418435099" data-draft-id="7572301616167600137" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ§  å¯å®šåˆ¶åŒ– AIGCï¼šWeb ç”¨æˆ·ä¸ªæ€§åŒ–æ¨¡å‹è®­ç»ƒçš„æŠ€æœ¯é—¨æ§›æ­£åœ¨å¡Œç¼©ï¼"/> <meta itemprop="keywords" content="Trae,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-14T01:24:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ§  å¯å®šåˆ¶åŒ– AIGCï¼šWeb ç”¨æˆ·ä¸ªæ€§åŒ–æ¨¡å‹è®­ç»ƒçš„æŠ€æœ¯é—¨æ§›æ­£åœ¨å¡Œç¼©ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T01:24:37.000Z" title="Fri Nov 14 2025 01:24:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"â";top:8px;left:5px}.markdown-body blockquote:after{content:"â";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å‰è¨€ï¼šå½“AIè½åœ°åˆ°æ¯ä¸ªâ€œæ ‡ç­¾é¡µâ€</h2>
<p>åœ¨è¿‡å»å‡ å¹´ï¼Œäººå·¥æ™ºèƒ½ï¼ˆArtificial Intelligence Generation â€” AIGCï¼‰ä»¿ä½›ä¸€åœºç¡…åŸºæ´ªæ°´ï¼š<br/>
æœåŠ¡å™¨çƒ§ç€ GPUï¼Œç ”ç©¶å‘˜å†™ç€è®ºæ–‡ï¼Œåˆ›ä¸šå…¬å¸å–ç€ APIï¼Œè€Œç”¨æˆ·â€¦â€¦åœ¨çœ‹å›¾ç‰‡åŠ è½½ã€‚</p>
<p>ä½†ç°åœ¨ä¸åŒäº†ã€‚<br/>
éšç€æµè§ˆå™¨åº•å±‚ APIï¼ˆå¦‚ WebGPUï¼‰çš„æˆç†Ÿï¼Œæˆ‘ä»¬ç»ˆäºæœ‰æœºä¼šåœ¨<strong>æµè§ˆå™¨å†…è¿›è¡Œæ¨¡ä»¿ã€å¡‘é€ ã€å®šåˆ¶ä¸è®­ç»ƒ</strong>ã€‚<br/>
æ²¡é”™ï¼Œä½ æ²¡å¬é”™ â€”â€” ğŸ§ã€ŒWeb ç”¨æˆ·ä¹Ÿèƒ½è®­ç»ƒè‡ªå·±çš„ AIGC æ¨¡å‹ã€ã€‚</p>
<p>è¿™ä¸å†æ˜¯äº‘ç«¯é»‘ç®±ï¼Œè€Œæ˜¯ä¸€åœºâ€œ<strong>å»ä¸­å¿ƒåŒ–çš„æ¨¡å‹å®šåˆ¶é©å‘½</strong>â€ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€ä»äº‘ç«¯AIåˆ°ç”¨æˆ·ç«¯AIï¼šèŒƒå¼çš„æ»‘å¡</h2>
<p>ğŸ—ï¸ ä¼ ç»Ÿçš„ AI å·¥ä½œæµï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">Python + CUDA + GPUé›†ç¾¤ + äº‘è®­ç»ƒä»»åŠ¡
<span class="hljs-code">          â†“
     æ¨¡å‹éƒ¨ç½²åˆ°äº‘ç«¯
          â†“
      å‰ç«¯è®¿é—® API
</span></code></pre>
<p>è¿™æ˜¯é«˜è€¦åˆã€é‡è®¡ç®—ã€é‡ä¾èµ–çš„é—­ç¯ã€‚</p>
<p>è€Œç°åœ¨â€”â€”<br/>
å€ŸåŠ© <strong>WebAssemblyï¼ˆWasmï¼‰ã€WebGPU</strong> ä»¥åŠ <strong>è½»é‡ Transformer æ¶æ„é‡å†™</strong>ï¼ŒAI æ­£åœ¨ã€Œæ»‘å‘æµè§ˆå™¨ã€ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">JS + WebGPU + è¾¹ç¼˜æ¨¡å‹ + æœ¬åœ°å¾®è°ƒ
<span class="hljs-code">          â†“
   æ¨¡å‹è·‘åœ¨ä½ ç”µè„‘çš„æ˜¾å¡ä¸Š
</span></code></pre>
<p>ä½ åˆ·æ–°é¡µé¢ï¼ŒAI å°±ä¸Šç­ï¼›<br/>
ä½ å…³æ‰æ ‡ç­¾é¡µï¼ŒAI å°±ä¸‹ç­ã€‚<br/>
â€”â€” äººç”Ÿè‹¦çŸ­ï¼Œä¸å¦¨åœ¨æµè§ˆå™¨é‡Œè®­ä¸ªæ¨¡å‹æ•£æ•£å¿ƒã€‚</p>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€æŠ€æœ¯æ ¸å¿ƒï¼šå½“æµè§ˆå™¨å˜æˆè¿·ä½ å®éªŒå®¤ ğŸ§ª</h2>
<p>è®©æˆ‘ä»¬åƒç§‘å­¦å®¶ä¸€æ ·å‰–æä¸€ä¸‹<strong>Web AIGC</strong>çš„åº•å±‚ç»„æˆï¼š</p>
<h3 data-id="heading-3">1ï¸âƒ£ æ¨¡å‹åŠ è½½ä¸æƒé‡åˆ‡ç‰‡</h3>
<p>åœ¨æµè§ˆå™¨é‡Œï¼Œä½ ä¸ä¼šä¸€æ¬¡æ€§åŠ è½½å‡ åGBçš„æƒé‡ã€‚<br/>
Insteadï¼Œæˆ‘ä»¬ä½¿ç”¨<strong>åˆ†å—åŠ è½½æŠ€æœ¯</strong>ï¼ˆchunked loadingï¼‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadModelChunks</span>(<span class="hljs-params">urls</span>) {
  <span class="hljs-keyword">const</span> chunks = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(urls.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> <span class="hljs-title function_">fetch</span>(u).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.<span class="hljs-title function_">arrayBuffer</span>())));
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">mergeModelChunks</span>(chunks);
}
</code></pre>
<blockquote>
<p>âš™ï¸ æ¯ä¸ªå—ç›¸å½“äºç¥ç»ç½‘ç»œçš„è®°å¿†ç¢ç‰‡ã€‚æµè§ˆå™¨æ‹¼èµ·æ¥ï¼Œå°±æ˜¯ä¸€ä¸ªâ€œæ€è€ƒçš„å·¥å‚â€ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">2ï¸âƒ£ å¾®è°ƒï¼ˆFine-tuningï¼‰æœºåˆ¶ï¼šäººäººéƒ½æ˜¯è°ƒæ•™å¸ˆ</h3>
<p>åœ¨ä¼ ç»Ÿè®­ç»ƒä¸­ï¼Œæ¨¡å‹è°ƒå‚éœ€è¦çŸ¿å¡ã€TensorBoard å’Œæ°¸æ’çš„ bugã€‚<br/>
åœ¨ Web å±‚ï¼Œæˆ‘ä»¬æ›´è½»é‡ â€”â€”<br/>
ç”¨ <strong>LoRA</strong>ï¼ˆä½ç§©é€‚é…ï¼‰æˆ– <strong>Adapter æ¨¡å‹</strong> æŠ€æœ¯ï¼Œä½¿å¾—ç”¨æˆ·ä¸Šä¼ çš„æ•°æ®â€œè°ƒåˆ¶å‡ºâ€è‡ªå·±çš„ä¸€ç‰ˆäººæ ¼æ¨¡å‹ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fineTune</span>(<span class="hljs-params">model, userDataset</span>) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> data <span class="hljs-keyword">of</span> userDataset) {
    <span class="hljs-keyword">const</span> {input, target} = <span class="hljs-title function_">preprocess</span>(data);
    model.<span class="hljs-title function_">backward</span>(<span class="hljs-title function_">loss</span>(model.<span class="hljs-title function_">forward</span>(input), target));
  }
  <span class="hljs-keyword">return</span> model;
}
</code></pre>
<blockquote>
<p>è¿™æ®µä¼ªä»£ç çš„æ„ä¹‰æ˜¯ï¼šæµè§ˆå™¨é‡Œæ­£åœ¨â€œä¸ºä½ ç§æœ‰åœ°æ›´æ–°æ¨¡å‹å‚æ•°â€ï¼Œæ²¡æœ‰ä¸Šä¼ ä»»ä½•ç”¨æˆ·æ•°æ®ã€‚<strong>éšç§å‹å¥½ä¸”å“åº”å¼ã€‚</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-5">3ï¸âƒ£ WebGPUï¼šæŠŠ GPU å€Ÿç»™ JavaScript ğŸï¸</h3>
<p>WebGPU æ˜¯è¿™åœºé©å‘½çš„ç‡ƒæ–™ã€‚<br/>
å®ƒè®©æµè§ˆå™¨ç¬¬ä¸€æ¬¡èƒ½æ¥è¿‘åŸç”Ÿ GPU API çš„è°ƒç”¨æ€§èƒ½ã€‚</p>
<p>ç®€å•ä¾‹å­ï¼š</p>
<pre><code class="hljs language-java" lang="java">async function <span class="hljs-title function_">createComputePipeline</span><span class="hljs-params">(device)</span> {
  <span class="hljs-type">const</span> <span class="hljs-variable">shaderModule</span> <span class="hljs-operator">=</span> device.createShaderModule({
    code: `
      <span class="hljs-meta">@compute</span> <span class="hljs-meta">@workgroup_size(1)</span>
      fn <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-meta">@builtin(global_invocation_id)</span> id : vec3&lt;u32&gt;)</span> {
          <span class="hljs-comment">// æ¨¡æ‹Ÿâ€œç¥ç»å…ƒâ€çš„ä¸€æ¬¡çº¿æ€§å˜æ¢</span>
      }
    `
  });
  <span class="hljs-keyword">return</span> device.createComputePipeline({compute: {<span class="hljs-keyword">module</span>: shaderModule, entryPoint: <span class="hljs-string">"main"</span>}});
}
</code></pre>
<p>æœ‰äº†å®ƒï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥åœ¨ web ä¸Šå®ç°çŸ©é˜µè¿ç®—ã€attentionæœºåˆ¶ç”šè‡³æ˜¯ç®€å•çš„æ¨ç†ä»»åŠ¡ã€‚</p>
<hr/>
<h2 data-id="heading-6">å››ã€ç”¨æˆ·ä¸ªæ€§åŒ–ï¼šAIGC çš„ç¤¾ä¼šæŠ€æœ¯ç«å±± ğŸŒ‹</h2>
<blockquote>
<p>å½“æ¯ä¸ªäººéƒ½èƒ½åœ¨è‡ªå·±æµè§ˆå™¨é‡Œè°ƒæ¨¡å‹ï¼Œè¿™ä¸ä»…æ˜¯å·¥ç¨‹å˜é©ï¼Œæ›´æ˜¯è®¤çŸ¥ä¸Šçš„å˜é©ã€‚</p>
</blockquote>
<h3 data-id="heading-7">âœï¸ å¾®è°ƒå†…å®¹</h3>
<ul>
<li>ç”¨æˆ·ä¸Šä¼  50 å¼ è‡ªæ‹ â†’ ç”Ÿæˆä¸ªæ€§å¤´åƒï¼›</li>
<li>å¯¼å…¥è‡ªå·±å†™çš„æ–‡ç«  â†’ æ¨¡å‹ç†è§£è¯­æ°”é£æ ¼ï¼›</li>
<li>è¾“å…¥èŠå¤©å¯¹è¯ â†’ æ‰“é€ â€œæ•°å­—åˆ†èº«äººæ ¼â€ã€‚</li>
</ul>
<h3 data-id="heading-8">ğŸ§© æŠ€æœ¯æŒ‘æˆ˜</h3>
<ol>
<li><strong>ç®—åŠ›ç¢ç‰‡</strong>ï¼šä¸åŒç”¨æˆ· GPU æ€§èƒ½å·®å¼‚å·¨å¤§ï¼›</li>
<li><strong>å†…å­˜éš”ç¦»</strong>ï¼šæ¨¡å‹æƒé‡ä¸ç½‘é¡µæ²™ç›’çš„å®‰å…¨æ€§ï¼›</li>
<li><strong>éšç§æƒ â†’ æ¨¡å‹æƒå½’è°ï¼Ÿ</strong></li>
</ol>
<p>ä½†è¿™äº›æŒ‘æˆ˜ï¼Œä¹Ÿä¿ƒä½¿æˆ‘ä»¬æ€è€ƒæ›´å¥½çš„ç³»ç»Ÿè®¾è®¡ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>ç”¨ <strong>åˆ†å¸ƒå¼æµè§ˆå™¨è®­ç»ƒï¼ˆFederated Learningï¼‰</strong> æ”¹å–„æ¨¡å‹ï¼›</li>
<li>é€šè¿‡ <strong>å·®åˆ†éšç§æœºåˆ¶ï¼ˆDifferential Privacyï¼‰</strong> å±è”½ä¸ªäººä¿¡æ¯ï¼›</li>
<li>ç”¨ <strong>LoRA æƒé‡å…±äº«</strong> æ›¿ä»£å…¨æ¨¡å‹å…±äº«ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-9">äº”ã€å°ç»“ï¼šå½“AIçš„é—¨æ§›è·Œå€’ï¼Œæˆ‘ä»¬çš„åˆ›é€ åŠ›æŠ¬å¤´ âœ¨</h2>
<blockquote>
<p>ä»Šå¤©çš„æµè§ˆå™¨é‡Œè·‘çš„ä»£ç ï¼Œæ˜å¤©å°±å¯èƒ½æ˜¯ä¸€ä¸ªæ™ºèƒ½åˆ›ä½œè€…ã€‚</p>
</blockquote>
<p>å¯å®šåˆ¶åŒ– AIGC å¹¶ä¸æ˜¯â€œäººäººæˆä¸ºæ•°æ®ç§‘å­¦å®¶â€ï¼Œ<br/>
è€Œæ˜¯â€œ<strong>æµè§ˆå™¨æˆä¸ºè®¤çŸ¥å»¶ä¼¸çš„å®éªŒåœº</strong>â€ã€‚</p>
<p>å°±åƒä¸ªäººè®¡ç®—æ—¶ä»£ä»æœåŠ¡å™¨èµ°å‘ PCï¼Œ<br/>
AIGC ä¹Ÿæ­£ä»äº‘ç«¯èµ°å‘æ¯ä¸€ä¸ªç½‘é¡µã€‚<br/>
æ¨¡å‹ä¸å†é«˜é«˜åœ¨ä¸Šï¼Œè€Œæ˜¯ï¼š</p>
<blockquote>
<p>æ‰“å¼€ F12 æ§åˆ¶å°ï¼Œä½ çš„æ€æƒ³å°±åœ¨ç¼–è¯‘ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-10">å…­ã€ğŸŒ æ¦‚å¿µå›¾ï¼ˆç¤ºæ„ï¼‰</h2>
<pre><code class="hljs language-lua" lang="lua">+<span class="hljs-comment">--------------------------------------------+</span>
|               Web Browser                  |
|  +<span class="hljs-comment">-----------+     +--------------------+  |</span>
|  | WebGPU    |&lt;<span class="hljs-comment">---&gt;| JS runtime (V8)   |  |</span>
|  +<span class="hljs-comment">-----------+     +--------------------+  |</span>
|        |                       ^           |
|        v                       |           |
|   Model Loader    &lt;<span class="hljs-comment">---    User Interaction  |</span>
|        |                               â¬‡   |
|        v                               Data|
|     Fine-tuner  &lt;<span class="hljs-comment">---  Local Dataset (å®‰å…¨) |</span>
+<span class="hljs-comment">--------------------------------------------+</span>
</code></pre>
<hr/>
<h2 data-id="heading-11">ä¸ƒã€å°¾å£°ï¼šå“²å­¦æ—¶é—´ ğŸ¦‰</h2>
<blockquote>
<p>â€œæŠ€æœ¯é—¨æ§›çš„æ¶ˆå¤±ï¼Œä»æ¥ä¸æ˜¯çŸ¥è¯†çš„ä¸‹é™ï¼Œè€Œæ˜¯æ–‡æ˜çš„æ‰©å±•ã€‚â€</p>
</blockquote>
<p>AIGC çš„ä¸ªæ€§åŒ–æ—¶ä»£å‘Šè¯‰æˆ‘ä»¬ä¸€ä¸ªäº‹å®ï¼š</p>
<ul>
<li>æœªæ¥çš„ AI ä¸æ˜¯å¤§æ¨¡å‹å„æ–­çš„æœºå™¨å¸å›½ï¼›</li>
<li>è€Œæ˜¯åƒä¸‡æµè§ˆå™¨åœ¨è¾¹ç¼˜ä¸Šé—ªçƒçš„ã€Œå°ç¯å¡”ã€ã€‚</li>
</ul>
<p>åœ¨æ¯ä¸€ä¸ªæ ‡ç­¾é¡µçš„å…‰ä¸‹ï¼Œäººç±»ä¸æœºå™¨ï¼Œéƒ½åœ¨å…±åŒå­¦ä¹ ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€HarmonyOS 6ã€‘é™æ€å’ŒåŠ¨æ€æ·»åŠ åº”ç”¨å¿«æ·æ–¹å¼è¯¦è§£]]></title>    <link>https://juejin.cn/post/7572387877138776074</link>    <guid>https://juejin.cn/post/7572387877138776074</guid>    <pubDate>2025-11-14T10:00:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572387877138776074" data-draft-id="7572340344509448218" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€HarmonyOS 6ã€‘é™æ€å’ŒåŠ¨æ€æ·»åŠ åº”ç”¨å¿«æ·æ–¹å¼è¯¦è§£"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-11-14T10:00:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GeorgeGcs"/> <meta itemprop="url" content="https://juejin.cn/user/1239904847930654"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€HarmonyOS 6ã€‘é™æ€å’ŒåŠ¨æ€æ·»åŠ åº”ç”¨å¿«æ·æ–¹å¼è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1239904847930654/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GeorgeGcs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T10:00:59.000Z" title="Fri Nov 14 2025 10:00:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ã€HarmonyOS 6ã€‘é™æ€å’ŒåŠ¨æ€æ·»åŠ åº”ç”¨å¿«æ·æ–¹å¼è¯¦è§£</h2>
<h3 data-id="heading-1">ä¸€ã€å‰è¨€</h3>
<p>åœ¨åŠŸèƒ½æ—¥ç›Šå¤æ‚çš„åº”ç”¨ä¸­ï¼Œç”¨æˆ·å¾€å¾€éœ€è¦å¤šæ­¥æ“ä½œæ‰èƒ½æ‰¾åˆ°å¸¸ç”¨åŠŸèƒ½ã€‚è€Œåº”ç”¨å¿«æ·æ–¹å¼èƒ½è®©ç”¨æˆ·ä¸€é”®ç›´è¾¾æ ¸å¿ƒåŠŸèƒ½ï¼Œæ—¢æå‡æ“ä½œæ•ˆç‡ï¼Œä¹Ÿèƒ½å¢å¼ºç”¨æˆ·å¯¹åº”ç”¨çš„ç²˜æ€§ã€‚</p>
<p>æœ¬æ–‡ç»“åˆå®é™…å¼€å‘åœºæ™¯ï¼Œè¯¦ç»†åˆ†äº« HarmonyOS ä¸­ä¸¤ç§å¿«æ·æ–¹å¼çš„å®ç°æ–¹æ³•ï¼ŒåŒ…æ‹¬é™æ€å¿«æ·æ–¹å¼é…ç½®å’Œåº”ç”¨å†…åŠ¨æ€æ·»åŠ ï¼Œå…¨ç¨‹åŸºäºå• HAP åŒ…åœºæ™¯ï¼ˆå¤š HAP åŒ…é…ç½®é€»è¾‘ä¸€è‡´ï¼‰ã€‚</p>
<h3 data-id="heading-2">äºŒã€é™æ€å¿«æ·æ–¹å¼ï¼šåŸºç¡€é…ç½®ä¸å¿«é€Ÿè·³è½¬</h3>
<p>é™æ€å¿«æ·æ–¹å¼æ˜¯é€šè¿‡é…ç½®æ–‡ä»¶é¢„å…ˆå®šä¹‰çš„å¿«æ·æ–¹å¼ï¼Œç”¨æˆ·é•¿æŒ‰åº”ç”¨å›¾æ ‡å³å¯çœ‹åˆ°ã€‚ä¾‹å¦‚â€œå›å®¶å¯¼èˆªâ€â€œæ–°å»ºä¾¿ç­¾â€è¿™ç±»é«˜é¢‘å›ºå®šåŠŸèƒ½ã€‚æ•ˆæœå¦‚ä¸‹ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84d361922395428595c61710a45a87cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR2VvcmdlR2Nz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763719259&amp;x-signature=xVXFcsHC5w9nPEQfMMECUfE28As%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h5 data-id="heading-3">1ã€ åˆ›å»ºç›®æ ‡é¡µé¢å¹¶é…ç½®è·¯ç”±</h5>
<p>é¦–å…ˆåˆ›å»ºå¿«æ·æ–¹å¼å¯¹åº”çš„åŠŸèƒ½é¡µé¢ï¼ˆå¦‚â€œå›å®¶â€â€œå»å…¬å¸â€é¡µé¢ï¼‰ï¼Œé¡µé¢éœ€ç”¨ <code>@Entry</code> è£…é¥°ã€‚ç„¶ååœ¨ <code>resources/base/profile/main_pages.json</code> ä¸­æ·»åŠ é¡µé¢è·¯ç”±ï¼Œç¡®ä¿åº”ç”¨èƒ½è¯†åˆ«é¡µé¢è·¯å¾„ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"src"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"pages/Index"</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// åº”ç”¨ä¸»é¡µé¢</span>
    <span class="hljs-string">"pages/GoHouse"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// å›å®¶å¯¼èˆªé¡µé¢</span>
    <span class="hljs-string">"pages/GoCompany"</span> <span class="hljs-comment">// å»å…¬å¸å¯¼èˆªé¡µé¢</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-4">2ã€ ç¼–å†™å¿«æ·æ–¹å¼é…ç½®æ–‡ä»¶</h5>
<p>åœ¨ <code>resources/base/profile/</code> ç›®å½•ä¸‹æ–°å»º <code>shortcuts_config.json</code> æ–‡ä»¶ï¼Œå®šä¹‰å¿«æ·æ–¹å¼çš„ IDã€æ˜¾ç¤ºæ–‡æœ¬ã€å›¾æ ‡å’Œè·³è½¬ç›®æ ‡ã€‚æ¯ä¸ªå¿«æ·æ–¹å¼éœ€åŒ…å«ä»¥ä¸‹æ ¸å¿ƒå‚æ•°ï¼š</p>
<ul>
<li><code>shortcutId</code>ï¼šå”¯ä¸€æ ‡è¯†ï¼Œä¸è¶…è¿‡ 63 å­—èŠ‚</li>
<li><code>label</code>ï¼šæ˜¾ç¤ºæ–‡æœ¬ï¼ˆæ”¯æŒå­—ç¬¦ä¸²æˆ–èµ„æºç´¢å¼•ï¼‰</li>
<li><code>icon</code>ï¼šå›¾æ ‡èµ„æºç´¢å¼•</li>
<li><code>wants</code>ï¼šè·³è½¬é…ç½®ï¼ˆåŒ…åã€æ¨¡å—åã€ç»„ä»¶åã€è‡ªå®šä¹‰å‚æ•°ï¼‰</li>
</ul>
<p>ç¤ºä¾‹é…ç½®ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"shortcuts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"shortcutId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"id_company"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"label"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$string:Go_to_the_Company"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"icon"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$media:company"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"wants"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"bundleName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"com.example.desktopshortcuts"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"moduleName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"entry"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"abilityName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"EntryAbility"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"parameters"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"shortCutKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"CompanyPage"</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"shortcutId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"id_house"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"label"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$string:Go_to_House"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"icon"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$media:house"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"wants"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"bundleName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"com.example.desktopshortcuts"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"moduleName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"entry"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"abilityName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"EntryAbility"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"parameters"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"shortCutKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"HousePage"</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-5">3ã€åœ¨ module.json5 ä¸­å…³è”é…ç½®</h5>
<p>åœ¨ <code>module.json5</code> çš„ <code>abilities</code> æ ‡ç­¾ä¸‹æ·»åŠ  <code>metadata</code> é…ç½®ï¼ŒæŒ‡å®šå¿«æ·æ–¹å¼é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œè®©ç³»ç»Ÿè¯†åˆ«å¿«æ·æ–¹å¼ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"abilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"EntryAbility"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/entryability/EntryAbility.ets"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"skills"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"entities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"entity.system.home"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"actions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"ohos.want.action.home"</span><span class="hljs-punctuation">]</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"metadata"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ohos.ability.shortcuts"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"resource"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$profile:shortcuts_config"</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-6">4ã€å®ç°é¡µé¢è·³è½¬é€»è¾‘</h5>
<p>åœ¨ä¸»é¡µé¢ï¼ˆIndex.etsï¼‰ä¸­å®šä¹‰è·³è½¬æ–¹æ³•ï¼Œé€šè¿‡è¯»å– <code>wants</code> ä¸­çš„è‡ªå®šä¹‰å‚æ•° <code>shortCutKey</code>ï¼Œåˆ¤æ–­ç”¨æˆ·ç‚¹å‡»çš„å¿«æ·æ–¹å¼ï¼Œè¿›è€Œè·³è½¬åˆ°å¯¹åº”é¡µé¢ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">goToSpecifyPage</span>(<span class="hljs-params">want?: Want</span>) {
  <span class="hljs-keyword">let</span> shortCutKey = want?.<span class="hljs-property">parameters</span>?.<span class="hljs-property">shortCutKey</span>;

  <span class="hljs-keyword">if</span> (shortCutKey === <span class="hljs-string">'CompanyPage'</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getRouter</span>().<span class="hljs-title function_">pushUrl</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'pages/GoCompany'</span> })
      .<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {
        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`è·³è½¬å¤±è´¥ï¼š<span class="hljs-subst">${err.code}</span>, <span class="hljs-subst">${err.message}</span>`</span>);
      });
  }
  <span class="hljs-keyword">if</span> (shortCutKey === <span class="hljs-string">'HousePage'</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getRouter</span>().<span class="hljs-title function_">pushUrl</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'pages/GoHouse'</span> })
      .<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {
        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`è·³è½¬å¤±è´¥ï¼š<span class="hljs-subst">${err.code}</span>, <span class="hljs-subst">${err.message}</span>`</span>);
      });
  }
}
</code></pre>
<h5 data-id="heading-7">5ã€ ä¿å­˜å¹¶ä¼ é€’ Want å‚æ•°</h5>
<p>å¿«æ·æ–¹å¼è·³è½¬åˆ†ä¸ºå†·å¯åŠ¨å’Œçƒ­å¯åŠ¨ï¼Œéœ€åœ¨ <code>EntryAbility.ets</code> ä¸­é€šè¿‡ <code>AppStorage</code> ä¿å­˜ <code>want</code> å‚æ•°ï¼Œç¡®ä¿é¡µé¢èƒ½è·å–åˆ°è·³è½¬ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å†·å¯åŠ¨æ—¶ä¿å­˜å‚æ•°</span>
<span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getApplicationContext</span>().<span class="hljs-title function_">setColorMode</span>(<span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_NOT_SET</span>);
  <span class="hljs-keyword">if</span> (want?.<span class="hljs-property">parameters</span>?.<span class="hljs-property">shortCutKey</span>) {
    <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'want'</span>, want);
  }
}

<span class="hljs-comment">// çƒ­å¯åŠ¨æ—¶æ›´æ–°å‚æ•°</span>
<span class="hljs-title function_">onNewWant</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">if</span> (want?.<span class="hljs-property">parameters</span>?.<span class="hljs-property">shortCutKey</span>) {
    <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'want'</span>, want);
  }
}
</code></pre>
<h5 data-id="heading-8">6ã€ é¡µé¢æ˜¾ç¤ºæ—¶æ‰§è¡Œè·³è½¬</h5>
<p>åœ¨ä¸»é¡µé¢çš„ <code>onPageShow</code> æ–¹æ³•ä¸­ï¼Œè¯»å– <code>AppStorage</code> ä¸­ä¿å­˜çš„ <code>want</code> å‚æ•°ï¼Œè°ƒç”¨è·³è½¬æ–¹æ³•å®Œæˆå¿«æ·æ–¹å¼å“åº”ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">onPageShow</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">has</span>(<span class="hljs-string">'want'</span>)) {
    <span class="hljs-keyword">let</span> <span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'want'</span>);
    <span class="hljs-keyword">if</span> (want) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">goToSpecifyPage</span>(want);
      <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-string">'want'</span>); <span class="hljs-comment">// è·³è½¬åæ¸…é™¤å‚æ•°ï¼Œé¿å…é‡å¤è§¦å‘</span>
    }
  }
}
</code></pre>
<p>å…·ä½“è·³è½¬çš„å¤„ç†ï¼Œé€šè¿‡wantä¸­çš„å‚æ•°ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®è‡ªå·±ä¸šåŠ¡ä¹ æƒ¯è¿›è¡Œè·³è½¬å¤„ç†ï¼Œä»¥ä¸Šå¤„ç†ä¸ºå‚è€ƒã€‚</p>
<h4 data-id="heading-9">æ³¨æ„äº‹é¡¹</h4>
<p>ï¼ˆ1ï¼‰é™æ€å¿«æ·æ–¹å¼æœ€å¤šæ”¯æŒé…ç½® 4 ä¸ªï¼Œä»…èƒ½è·³è½¬è‡³ UIAbility å…¥å£é¡µé¢ï¼Œæ— æ³•ç›´æ¥è·³è½¬åˆ°éå…¥å£é¡µé¢ã€‚
ï¼ˆ2ï¼‰å¤š HAP åŒ…åœºæ™¯æ— éœ€é¢å¤–é…ç½®ï¼Œæ‰€æœ‰æ“ä½œå‡åœ¨ entry æ–‡ä»¶å¤¹ä¸‹å®Œæˆã€‚</p>
<h3 data-id="heading-10">äºŒã€åº”ç”¨å†…åŠ¨æ€æ·»åŠ å¿«æ·æ–¹å¼</h3>
<p>é™¤äº†é¢„å…ˆé…ç½®çš„é™æ€å¿«æ·æ–¹å¼ï¼Œè¿˜å¯ä»¥åœ¨åº”ç”¨å†…é€šè¿‡ä»£ç åŠ¨æ€æ·»åŠ å¿«æ·æ–¹å¼ï¼ˆå¦‚ç”¨æˆ·ç‚¹å‡»â€œæ·»åŠ åˆ°æ¡Œé¢â€æŒ‰é’®æ—¶åˆ›å»ºï¼‰ï¼Œçµæ´»æ€§æ›´é«˜ã€‚</p>
<h4 data-id="heading-11">æ ¸å¿ƒå®ç°ä»£ç </h4>
<p>åˆ›å»º <code>ShortcutsUtils</code> å·¥å…·ç±»ï¼Œå°è£…åŠ¨æ€æ·»åŠ å¿«æ·æ–¹å¼çš„é€»è¾‘ï¼ŒåŒ…å«æƒé™æ ¡éªŒã€é‡å¤åˆ¤æ–­å’Œåˆ›å»ºè¯·æ±‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.PerformanceAnalysisKit"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.BasicServicesKit"</span>;
<span class="hljs-keyword">import</span> { productViewManager } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.StoreKit"</span>;
<span class="hljs-keyword">import</span> { common, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.AbilityKit"</span>;
<span class="hljs-keyword">import</span> promptAction <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.promptAction'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShortcutsUtils</span> {
  <span class="hljs-comment">/**
   * ç‚¹å‡»æŒ‰é’®æ·»åŠ å¿«æ·æ–¹å¼
   */</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">addShortcuts</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> uiContext = <span class="hljs-title function_">getContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;
    <span class="hljs-keyword">const</span> shortcutId = <span class="hljs-string">"id_test1"</span>; <span class="hljs-comment">// éœ€ä¸ shortcuts_config.json ä¸­å®šä¹‰çš„ä¸€è‡´</span>
    <span class="hljs-keyword">const</span> labelResName = <span class="hljs-string">"shortcut"</span>; <span class="hljs-comment">// å¯¹åº” label çš„èµ„æºç´¢å¼•åç§°</span>
    <span class="hljs-keyword">const</span> iconResName = <span class="hljs-string">"aa_icon"</span>; <span class="hljs-comment">// å¯¹åº” icon çš„èµ„æºç´¢å¼•åç§°</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span> = {
      <span class="hljs-attr">bundleName</span>: <span class="hljs-string">"com.example.appgallery.kit.demo"</span>,
      <span class="hljs-attr">moduleName</span>: <span class="hljs-string">"entry"</span>,
      <span class="hljs-attr">abilityName</span>: <span class="hljs-string">"EntryAbility"</span>,
      <span class="hljs-attr">parameters</span>: {
        <span class="hljs-attr">testKey</span>: <span class="hljs-string">"testValue"</span> <span class="hljs-comment">// è‡ªå®šä¹‰å‚æ•°</span>
      }
    };

    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// æ ¡éªŒå¿«æ·æ–¹å¼æ˜¯å¦å¯æ·»åŠ ï¼ˆæ˜¯å¦å·²å­˜åœ¨ã€æ˜¯å¦æœ‰æƒé™ï¼‰</span>
      productViewManager.<span class="hljs-title function_">checkPinShortcutPermitted</span>(uiContext, shortcutId, want, labelResName, iconResName)
        .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'addShortcuts'</span>, <span class="hljs-string">`æ ¡éªŒæˆåŠŸï¼š<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(result)}</span>`</span>);
          <span class="hljs-keyword">const</span> tid = result.<span class="hljs-property">tid</span>;
          <span class="hljs-comment">// å‘èµ·æ·»åŠ å¿«æ·æ–¹å¼è¯·æ±‚</span>
          productViewManager.<span class="hljs-title function_">requestNewPinShortcut</span>(uiContext, tid)
            .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'addShortcuts'</span>, <span class="hljs-string">"å¿«æ·æ–¹å¼æ·»åŠ æˆåŠŸï¼"</span>);
            })
            .<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {
              hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'addShortcuts'</span>, <span class="hljs-string">`å¿«æ·æ–¹å¼æ·»åŠ å¤±è´¥ï¼š<span class="hljs-subst">${error.code}</span>, <span class="hljs-subst">${error.message}</span>`</span>);
            });
        })
        .<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {
          hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'addShortcuts'</span>, <span class="hljs-string">`errï¼š<span class="hljs-subst">${error.code}</span>, <span class="hljs-subst">${error.message}</span>`</span>);
          <span class="hljs-comment">// é”™è¯¯ç  1006620003 è¡¨ç¤ºå¿«æ·æ–¹å¼å·²å­˜åœ¨</span>
          <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-number">1006620003</span>) {
            promptAction.<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'æ¡Œé¢å·²å­˜åœ¨æ­¤å¿«æ·æ–¹å¼ï¼'</span> });
          }
        });
    } <span class="hljs-keyword">catch</span> (err) {
      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">`catch errï¼š<span class="hljs-subst">${err.code}</span>, <span class="hljs-subst">${err.message}</span>`</span>);
    }
  }
}
</code></pre>
<h4 data-id="heading-12">ä½¿ç”¨æ–¹å¼</h4>
<p>åœ¨åº”ç”¨é¡µé¢çš„æŒ‰é’®ç‚¹å‡»äº‹ä»¶ä¸­è°ƒç”¨å·¥å…·ç±»æ–¹æ³•ï¼Œå³å¯è§¦å‘å¿«æ·æ–¹å¼æ·»åŠ æµç¨‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ç¤ºä¾‹ï¼šæŒ‰é’®ç‚¹å‡»äº‹ä»¶</span>
<span class="hljs-title class_">Button</span>(<span class="hljs-string">'æ·»åŠ æµ‹è¯•å¿«æ·æ–¹å¼'</span>)
  .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title class_">ShortcutsUtils</span>.<span class="hljs-title function_">addShortcuts</span>();
  })
</code></pre>
<p>productViewManagerå…è®¸åº”ç”¨æ·»åŠ å¿«æ·æ–¹å¼çš„æ•°é‡ä¸ºä¸¤ä¸ªã€‚è¿™æ˜¯é¸¿è’™å®˜æ–¹çš„è®¾è®¡å¦‚æ­¤ã€‚</p>
<h3 data-id="heading-13">ä¸‰ã€ä¸¤ç§å¿«æ·æ–¹å¼çš„åŒºåˆ«ä¸é€‚ç”¨åœºæ™¯</h3>























<table><thead><tr><th>ç±»å‹</th><th>é…ç½®æ–¹å¼</th><th>çµæ´»æ€§</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>é™æ€å¿«æ·æ–¹å¼</td><td>é…ç½®æ–‡ä»¶å®šä¹‰</td><td>è¾ƒä½ï¼ˆå›ºå®šåŠŸèƒ½ï¼‰</td><td>é«˜é¢‘å›ºå®šåŠŸèƒ½ï¼Œå¦‚å¯¼èˆªã€æ–°å»ºã€å¿«é€Ÿæ‹ç…§</td></tr><tr><td>åŠ¨æ€å¿«æ·æ–¹å¼</td><td>ä»£ç åŠ¨æ€æ·»åŠ </td><td>è¾ƒé«˜ï¼ˆç”¨æˆ·è§¦å‘ï¼‰</td><td>ä¸ªæ€§åŒ–åŠŸèƒ½ï¼Œå¦‚ç”¨æˆ·è‡ªå®šä¹‰æ”¶è—ã€ä¸´æ—¶é«˜é¢‘åŠŸèƒ½</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥ Rust è¿­ä»£å™¨ï¼ˆä¸‹ï¼‰]]></title>    <link>https://juejin.cn/post/7572028313930776616</link>    <guid>https://juejin.cn/post/7572028313930776616</guid>    <pubDate>2025-11-14T00:50:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572028313930776616" data-draft-id="7570659828810285090" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥ Rust è¿­ä»£å™¨ï¼ˆä¸‹ï¼‰"/> <meta itemprop="keywords" content="Rust"/> <meta itemprop="datePublished" content="2025-11-14T00:50:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RockByte"/> <meta itemprop="url" content="https://juejin.cn/user/1046390797768519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥ Rust è¿­ä»£å™¨ï¼ˆä¸‹ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1046390797768519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RockByte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T00:50:13.000Z" title="Fri Nov 14 2025 00:50:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#5f6368;background-image:linear-gradient(90deg,rgba(240,191,213,.1) 3%,transparent 0),linear-gradient(1turn,rgba(240,191,213,.1) 3%,transparent 0);background-size:20px 20px;background-position:50%;letter-spacing:1px;word-spacing:1px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-left:50px;padding-bottom:5px;color:#5f6368}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{position:absolute;left:0;display:block;content:""}.markdown-body h1{font-size:32px;margin-bottom:5px}.markdown-body h1:before{top:0;content:"ğŸ¦„";font-size:32px}.markdown-body h2{padding-bottom:24px;border-bottom:1px solid #ececec}.markdown-body h2:before{top:0;left:8px;content:"ğŸ³";font-size:24px}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{top:-2px;left:8px;content:"ğŸ„";font-size:20px}.markdown-body h4{font-size:16px}.markdown-body h4:before{top:-2px;left:8px;content:"ğŸ¦¥";font-size:18px}.markdown-body h5{font-size:14px}.markdown-body h5:before{top:-2px;left:9px;content:"ğŸ¦©";font-size:16px}.markdown-body h6{font-size:12px;margin-top:5px}.markdown-body h6:before{top:-1px;left:10px;content:"ğŸ§";font-size:14px}.markdown-body p{line-height:1.9;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid rgba(253,121,168,.5);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#a6accd;background:#292d3e;border-radius:8px}.markdown-body a{text-decoration:none;color:#fd79a8;border-bottom:1px solid #fd79a8;padding:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(253,121,168,.1);color:#ee69a9}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body th{color:#fd79a8}.markdown-body th,.markdown-body tr:hover{background:rgba(253,121,168,.1)}.markdown-body td{min-width:120px}.markdown-body blockquote{position:relative;color:#666;padding:23px;margin:22px 0;border-left:4px solid #ee69a9;background-color:rgba(253,121,168,.1)}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;display:block;font-size:27px;color:#fd79a8;opacity:.8}.markdown-body blockquote:before{left:10px;top:0;content:"â"}.markdown-body blockquote:after{right:10px;bottom:0;content:"â"}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body strong{position:relative;color:#fd79a8}.markdown-body strong:before{content:"Â· "}.markdown-body strong:after{content:" Â·"}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#fd79a8}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#ee69a9}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a3773739559489997b02275b501de1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763686212&amp;x-signature=KNI%2BpjtjrxQ04zJSgrP01N0KAbk%3D" alt="0.png" loading="lazy"/></p>
<p>è¿™æ˜¯ã€Šæ·±å…¥ Rust è¿­ä»£å™¨ã€‹ ç³»åˆ—çš„ç¬¬ä¸‰éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†é€šè¿‡å®ä¾‹è¿›è¡Œå­¦ä¹ ã€‚æˆ‘ä»¬å°†æ¢ç´¢ä¸€äº›æœ‰ç”¨ä½†é²œä¸ºäººçŸ¥çš„è¿­ä»£å™¨ç‰¹æ€§ï¼Œä»¥åŠå®ƒä»¬åœ¨ç”¨ Rust å¼€å‘çš„å„ç§æµè¡Œå¼€æºé¡¹ç›®ä¸­çš„åº”ç”¨ã€‚</p>
<p>ä¸‹é¢æ˜¯å‰ä¸¤ç¯‡æ–‡ç« çš„é“¾æ¥ï¼Œæ–¹ä¾¿è¯»è€…è·³è½¬å¤ä¹ ä¸€ä¸‹ï¼š</p>
<ul>
<li><a href="https://juejin.cn/post/7566474134688595983" target="_blank" title="https://juejin.cn/post/7566474134688595983">æ·±å…¥ Rust è¿­ä»£å™¨ï¼ˆä¸Šï¼‰</a></li>
<li><a href="https://juejin.cn/post/7568471321954779170" target="_blank" title="https://juejin.cn/post/7568471321954779170">æ·±å…¥ Rust è¿­ä»£å™¨ï¼ˆä¸­ï¼‰</a></li>
</ul>
<h2 data-id="heading-0">è·å–è¿­ä»£å™¨</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6ae9f7705b64f4889009686c4730f56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763686212&amp;x-signature=TCxcMY%2FBR%2BmwLA0MGHy8zbDVlag%3D" alt="5.png" loading="lazy"/></p>
<p>å¦‚æœä½ è¦ä»æ•°æ®æºè·å–æ•°æ®ï¼Œä¼˜å…ˆå°è¯•æ˜¯å¦å¯ä»¥é€šè¿‡è¿­ä»£å™¨è®¿é—®ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ç¬¬ä¸€ä¸ªç¤ºä¾‹ï¼Œè€ƒè™‘ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ­£åˆ™è¡¨è¾¾å¼å¯ä»¥ä»¥è¿­ä»£å™¨çš„å½¢å¼æä¾›æœç´¢ç»“æœã€‚å½“ä½ éœ€è¦åœ¨ä¸€ä¸ªå¾ˆé•¿çš„å­—ç¬¦ä¸²ä¸­è¿›è¡Œæœç´¢ï¼ŒæŸ¥æ‰¾å¤šä¸ªåŒ¹é…é¡¹ï¼Œå¹¶ä¸”ä¸å¸Œæœ›ä¸€æ¬¡æ€§å°†æ‰€æœ‰ç»“æœåŠ è½½åˆ°å†…å­˜ä¸­æ—¶ï¼Œ<code>Regex::find_iter</code> æ–¹æ³•å°±ç‰¹åˆ«æœ‰ç”¨ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// æŸ¥æ‰¾IPåœ°å€</span>
<span class="hljs-built_in">println!</span>(<span class="hljs-string">"\næŸ¥æ‰¾IPåœ°å€:"</span>);
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">ip_re</span> = Regex::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-string">r"\b(?:\d{1,3}.){3}\d{1,3}\b"</span>).<span class="hljs-title function_ invoke__">unwrap</span>();
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">ip_text</span> = <span class="hljs-string">"æœåŠ¡å™¨åœ°å€: 192.168.1.1, å¤‡ç”¨åœ°å€: 10.0.0.1, æ— æ•ˆIP: 999.999.999.999"</span>;

<span class="hljs-keyword">for</span> <span class="hljs-variable">mat</span> <span class="hljs-keyword">in</span> ip_re.<span class="hljs-title function_ invoke__">find_iter</span>(ip_text) {
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æ‰¾åˆ°IP: '{}' at {:?}"</span>, mat.<span class="hljs-title function_ invoke__">as_str</span>(), mat.<span class="hljs-title function_ invoke__">range</span>());
}

<span class="hljs-comment">// output</span>
<span class="hljs-comment">// æŸ¥æ‰¾IPåœ°å€:</span>
<span class="hljs-comment">// æ‰¾åˆ°IP: '192.168.1.1'</span>
<span class="hljs-comment">// æ‰¾åˆ°IP: '10.0.0.1'</span>
<span class="hljs-comment">// æ‰¾åˆ°IP: '999.999.999.999'</span>
</code></pre>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ <code>ip_re</code>ï¼Œç”¨äºåœ¨å†…å®¹ä¸­è¿›è¡Œæœç´¢ï¼Œç›®çš„æ˜¯é€ä¸ªæŸ¥æ‰¾ç¬¦åˆè§„åˆ™çš„å†…å®¹ï¼Œè¿™é‡Œæ˜¯ IP åœ°å€ã€‚<code>find_iter</code> åˆ›å»ºçš„è¿­ä»£å™¨ä¼šç”Ÿæˆ <code>Match</code> ç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“ä¿å­˜ç€æ¯ä¸ªåŒ¹é…é¡¹çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬åŸå§‹å­—ç¬¦ä¸²ä¸­çš„èµ·å§‹å’Œç»“æŸç´¢å¼•ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œ<code>mat.as_str()</code> ä¼šè¿”å›åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ï¼Œ<code>mat.range()</code> ä¼šè¿”å›è¿™äº›åŒ¹é…é¡¹åœ¨åŸæ–‡ä¸­çš„èŒƒå›´ã€‚</p>
<p>å†ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ <strong>Bevy</strong> é¡¹ç›®ã€‚<strong>Bevy</strong> é‡‡ç”¨äº† <strong>ECS</strong>ï¼ˆå®ä½“ã€ç»„ä»¶ã€ç³»ç»Ÿï¼‰æ¨¡å¼ï¼Œå…¶ä¸­ç³»ç»Ÿè´Ÿè´£å¤„ç†ç»„ä»¶ã€‚ä¸ºäº†åè°ƒå„ç§ç³»ç»Ÿçš„æ‰§è¡Œï¼Œ<strong>Bevy</strong> çš„ <strong>ECS</strong> åˆ©ç”¨äº†è°ƒåº¦æœºåˆ¶ã€‚è¿™äº›è°ƒåº¦æ˜¯ä½¿ç”¨ç”± <code>petgraph</code> æ¿æ¡ç®±æ”¯æŒçš„å›¾æ¥è®¾è®¡çš„ ã€‚å›¾ä½œä¸ºå¤æ‚çš„æ•°æ®ç»“æ„ï¼Œé€šè¿‡å‡ ä¸ªè¿­ä»£å™¨æä¾›å¯¹å…¶å†…éƒ¨æ•°æ®çš„è®¿é—®ã€‚åœ¨ä¸‹é¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ä»¬ä»¥ç›¸åçš„é¡ºåºè®¿é—®å›¾çš„èŠ‚ç‚¹ã€‚ç„¶åï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬é€šè¿‡éå†å‡ºè¾¹æ¥æ¢ç´¢å…¶é‚»å±…ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">for</span> <span class="hljs-variable">a</span> <span class="hljs-keyword">in</span> topsorted.<span class="hljs-title function_ invoke__">nodes</span>().<span class="hljs-title function_ invoke__">rev</span>() {
   <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">index_a</span> = *map.<span class="hljs-title function_ invoke__">get</span>(&amp;a).<span class="hljs-title function_ invoke__">unwrap</span>();
   <span class="hljs-comment">// æŒ‰æ‹“æ‰‘é¡ºåºè¿­ä»£å®ƒä»¬çš„åç»§èŠ‚ç‚¹</span>
   <span class="hljs-keyword">for</span> <span class="hljs-variable">b</span> <span class="hljs-keyword">in</span> topsorted.<span class="hljs-title function_ invoke__">neighbors_directed</span>(a, Outgoing) {
    <span class="hljs-comment">//...</span>
</code></pre>
<p><code>nodes</code> å’Œ <code>neighbors_directed</code> æ–¹æ³•éƒ½ä¼šè¿”å›è¿­ä»£å™¨ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<strong>Bevy</strong> çš„å¼€å‘è€…å¹¶æ²¡æœ‰è¯•å›¾å°†æ‰€æœ‰ä»£ç éƒ½æ•´åˆåˆ°è¿­ä»£å™¨æµæ°´çº¿ä¸­ã€‚è€ƒè™‘åˆ°æ¯æ¬¡è¿­ä»£çš„å¤æ‚æ€§ä»¥åŠå¯èƒ½å‡ºç°çš„æ·±åº¦åµŒå¥—ï¼Œé€‰æ‹©ä½¿ç”¨æ˜¾å¼å¾ªç¯æ˜¯å¾ˆåˆç†çš„ã€‚</p>
<p>åƒå›¾è¿™æ ·çš„å¤æ‚æ•°æ®ç»“æ„ï¼Œé€šå¸¸ä¼šæä¾›å¤šä¸ªç”¨äºè®¿é—®å…¶æ•°æ®çš„è¿­ä»£å™¨ã€‚èŠ±äº›æ—¶é—´ç ”ç©¶è¿™äº›æ¥å£å¹¶æ‰¾å‡ºå¯ç”¨çš„è¿­ä»£å™¨ï¼Œå¯¹äºç¼–å†™åœ°é“çš„ Rust ä»£ç éå¸¸æœ‰å¸®åŠ©ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œè®¸å¤šæ•°æ®æ¥æºéƒ½æœ‰è¿­ä»£å™¨æ¥å£ã€‚ä¸€æ—¦è·å–äº†è¿­ä»£å™¨ï¼Œå°±å¯ä»¥å……åˆ†åˆ©ç”¨å„ç§è¿­ä»£å™¨å·¥å…·æ¥é«˜æ•ˆåœ°å¤„ç†æ•°æ®ã€‚</p>
<h2 data-id="heading-1">æ„å»ºè¿­ä»£å™¨ï¼š<code>successors</code> å’Œ <code>from_fn</code></h2>
<p>æœ‰æ—¶ï¼Œæ•°æ®æºå¯èƒ½ä¸ä¼šç›´æ¥æä¾›è¿­ä»£å™¨æ¥å£ï¼Œè€Œæ˜¯æä¾›ä¸€ä¸ªç”¨äºæ£€ç´¢ä¸‹ä¸€ä¸ªå…ƒç´ çš„å‡½æ•°æˆ–ä¸€ç§æ„é€ è¿­ä»£å™¨çš„æ–¹æ³•ã€‚æ­¤å¤–ï¼Œåœ¨æ²¡æœ‰é¢„å…ˆå­˜åœ¨çš„æ•°æ®ä¸”å¿…é¡»é€šè¿‡ç®—æ³•ç”Ÿæˆæ•°æ®çš„æƒ…å†µä¸‹ï¼Œä»ç„¶å¯ä»¥ä½¿ç”¨è¿­ä»£å™¨ã€‚</p>
<p><code>std::iter::successors</code> å‡½æ•°ä¸ºè¿™äº›åœºæ™¯æä¾›äº†ä¸€ä¸ªç»ä½³çš„è§£å†³æ–¹æ¡ˆã€‚è¯¥å‡½æ•°æ¥å—ä¸€ä¸ªåˆå§‹å…ƒç´ ä»¥åŠä¸€ä¸ªè¿”å› <code>Option</code> çš„å‡½æ•°ï¼Œ<code>Option</code> ä¸­è¦ä¹ˆåŒ…å«ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œè¦ä¹ˆåŒ…å« <code>None</code>ã€‚ä»¥è¿™ç§æ–¹å¼åˆ›å»ºçš„è¿­ä»£å™¨å¯ä»¥ä»¥å¸¸è§„æ–¹å¼ä½¿ç”¨ã€‚</p>
<p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ç®€å•çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">for</span> <span class="hljs-variable">i</span> <span class="hljs-keyword">in</span> std::iter::<span class="hljs-title function_ invoke__">successors</span>(<span class="hljs-title function_ invoke__">Some</span>(<span class="hljs-number">12345u32</span>), |&amp;n| <span class="hljs-keyword">if</span> n == <span class="hljs-number">0</span> { <span class="hljs-literal">None</span> } <span class="hljs-keyword">else</span> { <span class="hljs-title function_ invoke__">Some</span>(n / <span class="hljs-number">10</span>) }) {
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{}"</span>, i);
}

<span class="hljs-comment">// output</span>
<span class="hljs-comment">// 12345</span>
<span class="hljs-comment">// 1234</span>
<span class="hljs-comment">// 123</span>
<span class="hljs-comment">// 12</span>
<span class="hljs-comment">// 1</span>
<span class="hljs-comment">// 0</span>
</code></pre>
<p>è¯¥ä»£ç ä¸­ï¼Œ<code>successors</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ <code>Some(12345u32)</code>ï¼Œè¡¨ç¤ºè¯¥è¿­ä»£å™¨çš„åˆå§‹å€¼ï¼Œåç»­ <code>|&amp;n| if n == 0 { None } else { Some(n / 10) }</code> æ˜¯ç”Ÿæˆå€¼çš„å‡½æ•°ã€‚</p>
<p>å¦‚ç»“æœè¾“å‡ºé‚£æ ·ï¼Œä» <code>12345</code> åˆ° <code>0</code> éƒ½è¿›è¡Œäº†è¾“å‡ºã€‚</p>
<p>ä»¥æå¿«çš„é€Ÿåº¦è‘—ç§°çš„ Python ä»£ç æ£€æŸ¥å’Œæ ¼å¼åŒ–å·¥å…· <strong>Ruff</strong>ï¼Œä¹Ÿä½¿ç”¨äº† <code>successors</code>ï¼š</p>
<pre><code class="hljs language-rust" lang="rust">std::iter::<span class="hljs-title function_ invoke__">successors</span>(
   <span class="hljs-title function_ invoke__">Some</span>(AnyNodeRef::<span class="hljs-title function_ invoke__">from</span>(preceding)),
   AnyNodeRef::last_child_in_body,
)
.<span class="hljs-title function_ invoke__">take_while</span>(|last_child|...)
.<span class="hljs-title function_ invoke__">any</span>(|last_child| ...)
</code></pre>
<p>ä¸Šé¢ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¦ç¡®å®šæŸä¸ªå‰é¢çš„ä»£ç å…ƒç´ ä¹‹å‰æˆ–ä¹‹åæ˜¯å¦éœ€è¦ç©ºè¡Œã€‚æ‰€æœ‰è¿™äº›å…ƒç´ éƒ½æ˜¯æ ‘ç»“æ„çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå‡½æ•°æ¥è¯†åˆ«å­æ ‘æœ€åä¸€ä¸ªåˆ†æ”¯ä¸­çš„æœ€åä¸€ä¸ªå­å…ƒç´ ã€‚é€šè¿‡ä½¿ç”¨ <code>successors</code>ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç”±æ‰€æœ‰è¿™ç±»æœ€åå­å…ƒç´ ç»„æˆçš„æ•°æ®æµï¼Œå¹¶ä»¥å¸¸è§„æ–¹å¼å¯¹å…¶è¿›è¡Œéå†ã€‚</p>
<p><code>std::iter::successors</code> å‡½æ•°éœ€è¦ä¸€ä¸ªåˆå§‹ç§å­æ¥å¯åŠ¨ã€‚å®ƒè¿˜ä¾èµ–å‰ä¸€ä¸ªå…ƒç´ æ¥ç”Ÿæˆä¸‹ä¸€ä¸ªå…ƒç´ ã€‚æœ‰æ—¶ï¼Œç”Ÿæˆè¿™äº›å…ƒç´ çš„æ¨¡å¼å¹¶ä¸ç®€å•ï¼Œç‰¹åˆ«æ˜¯å½“æˆ‘ä»¬éœ€è¦ç»´æŠ¤ä¸€äº›çŠ¶æ€æ¥æ¨å¯¼åç»­å…ƒç´ æ—¶ã€‚<code>std::iter::from_fn</code> å‡½æ•°å°±æ˜¯ä¸“é—¨ä¸ºè¿™ç§æƒ…å†µè®¾è®¡çš„ã€‚</p>
<p>åœ¨ä¸‹é¢è¿™ä¸ªå–è‡ª <strong>Meilisearch</strong> é¡¹ç›®çš„ç¤ºä¾‹ä¸­ï¼Œ<code>std::iter::from_fn</code> å‡½æ•°ç”¨äºç”Ÿæˆä¸€ä¸ªæ— ç©·çš„éšæœºæ•°åºåˆ—ã€‚è¯¥åºåˆ—æ˜¯ä½¿ç”¨ä¸€ä¸ªéšæœºæ•°ç”Ÿæˆå™¨æ„å»ºçš„ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">rng</span> = rand::rngs::SmallRng::<span class="hljs-title function_ invoke__">from_seed</span>([<span class="hljs-number">0</span>; <span class="hljs-number">32</span>]);

<span class="hljs-keyword">for</span> <span class="hljs-variable">key</span> <span class="hljs-keyword">in</span> std::iter::<span class="hljs-title function_ invoke__">from_fn</span>(|| <span class="hljs-title function_ invoke__">Some</span>(rng.<span class="hljs-title function_ invoke__">gen_range</span>(<span class="hljs-number">0</span>..<span class="hljs-number">256</span>))).<span class="hljs-title function_ invoke__">take</span>(<span class="hljs-number">128</span>) {
    <span class="hljs-comment">//...</span>
}
</code></pre>
<p><code>from_fn</code> å‡½æ•°æä¾›äº†æå¤§çš„çµæ´»æ€§ï¼Œå¯ä»¥æ‰§è¡Œæ„é€ ä¸‹ä¸€ä¸ªå…ƒç´ æ‰€éœ€çš„ä»»ä½•æ“ä½œã€‚</p>
<p>åœ¨æ¥è‡ª <strong>InfluxDb</strong> é¡¹ç›®çš„è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä½œä¸ºå‚æ•°ä¼ é€’ç»™ <code>from_fn</code> çš„ä¸€ä¸ªå‡½æ•°åŒ…å«ä¸€ä¸ªå¾ªç¯ã€‚è¿™ä¸ªå¾ªç¯ä»ç¼“å†²åŒºè¯»å–æ•°æ®ï¼Œè§£ç æ•°æ®ï¼Œå¹¶åœ¨æ•°æ®å‡†å¤‡å¥½åè¿”å›ä¸‹ä¸€ä¸ªå…ƒç´ ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">decode_entries</span>&lt;R: BufRead&gt;(<span class="hljs-keyword">mut</span> r: R) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;<span class="hljs-type">Vec</span>&lt;ListEntry&gt;&gt; {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">decoder</span> = ListDecoder::<span class="hljs-title function_ invoke__">default</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">iter</span> = std::iter::<span class="hljs-title function_ invoke__">from_fn</span>(<span class="hljs-keyword">move</span> || {
        <span class="hljs-keyword">loop</span> {
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">buf</span> = r.<span class="hljs-title function_ invoke__">fill_buf</span>().<span class="hljs-title function_ invoke__">unwrap</span>();
            <span class="hljs-comment">// ...</span>
        }
        decoder.<span class="hljs-title function_ invoke__">flush</span>().<span class="hljs-title function_ invoke__">transpose</span>()
    });
    iter.<span class="hljs-title function_ invoke__">collect</span>()
}
</code></pre>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå°†é—­åŒ…æ•è·çš„å¯å˜å˜é‡ç§»å…¥ <code>from_fn</code> å‡½æ•°æ˜¯å¸¸è§çš„åšæ³•ã€‚æ¯å½“è¿­ä»£å™¨è¯·æ±‚ä¸‹ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨è¿™ä¸ªé—­åŒ…ã€‚æ¯æ¬¡è°ƒç”¨éƒ½ä¼šæ”¹å˜çŠ¶æ€ï¼Œå› æ­¤éœ€è¦æ‹¥æœ‰è¯¥çŠ¶æ€çš„æ‰€æœ‰æƒã€‚</p>
<h2 data-id="heading-2">åˆå¹¶æ•°æ®æµ</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52ee8072fe994840869cb25bd57d368d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763686212&amp;x-signature=3csipOhlMmgE%2BpaQtMmJP%2Foj%2Boc%3D" alt="6.png" loading="lazy"/></p>
<p>ä¸€æ—¦è·å¾—è¿­ä»£å™¨ï¼Œå®ƒå¹¶ä¸æ€»æ˜¯å¯ä»¥ç«‹å³è¿›è¡Œå…ƒç´ å¤„ç†ã€‚ä½ å¯èƒ½éœ€è¦ï¼š</p>
<ul>
<li>åœ¨å¼€å¤´æˆ–ç»“å°¾æ·»åŠ ä¸€äº›å…ƒç´ ï¼Œä»¥æ–¹ä¾¿ç®—æ³•è¿è¡Œï¼›</li>
<li>åˆå¹¶å¤šä¸ªæ•°æ®æµä»¥ä¾¿è¿›è¡Œç»Ÿä¸€å¤„ç†ï¼›</li>
<li>ç”¨æ¥è‡ªå…¶ä»–æºçš„é¢å¤–ä¿¡æ¯ä¸°å¯Œæ¯ä¸ªå…ƒç´ ã€‚</li>
</ul>
<p>åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œè¿­ä»£å™¨çš„ä¸¤ä¸ªç‰¹æ€§éå¸¸æœ‰ç”¨ï¼š <code>chain</code> å’Œ <code>zip</code> ã€‚<code>std::iter::Iterator::chain</code> æ–¹æ³•å°†ä¸¤ä¸ªè¿­ä»£å™¨è¿æ¥èµ·æ¥ï¼Œåˆ›å»ºä¸€ä¸ªå•ä¸€çš„è¿­ä»£å™¨ï¼Œè¯¥è¿­ä»£å™¨å…ˆäº§ç”Ÿç¬¬ä¸€ä¸ªè¿­ä»£å™¨ä¸­çš„å…ƒç´ ï¼Œç›´åˆ°è€—å°½ï¼Œç„¶åäº§ç”Ÿç¬¬äºŒä¸ªè¿­ä»£å™¨ä¸­çš„å…ƒç´ ã€‚<code>std::iter::Iterator::zip</code> æ–¹æ³•å°†ä¸¤ä¸ªè¿­ä»£å™¨ä¸­çš„å…ƒç´ é…å¯¹ï¼Œå½¢æˆä¸€ä¸ªå…ƒç»„è¿­ä»£å™¨ã€‚</p>
<p>æ­¤å¤–ï¼Œ <code>once</code> å’Œ <code>repeat</code> å‡½æ•°æ—¨åœ¨åˆ†åˆ«ç”Ÿæˆè¿”å›å•ä¸ªæŒ‡å®šå…ƒç´ æˆ–é‡å¤å…ƒç´ çš„æ— é™åºåˆ—çš„è¿­ä»£å™¨ã€‚å®ƒä»¬çš„å¯¹åº”å‡½æ•° <code>once_with</code> å’Œ <code>repeat_with</code> åˆ™æ ¹æ®éœ€è¦åŠ¨æ€åˆ›å»ºå…ƒç´ ã€‚å½“é€šè¿‡ <code>chain</code> æˆ– <code>zip</code> é€‚é…å™¨ä¸å…¶ä»–è¿­ä»£å™¨ç»“åˆä½¿ç”¨æ—¶ï¼Œè¿™äº›å‡½æ•°ç‰¹åˆ«æœ‰ç”¨ã€‚</p>
<p><code>chain</code>ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">iter1</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>].<span class="hljs-title function_ invoke__">into_iter</span>();
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">iter2</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>].<span class="hljs-title function_ invoke__">into_iter</span>();
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">chained</span>: <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">i32</span>&gt; = iter1.<span class="hljs-title function_ invoke__">chain</span>(iter2).<span class="hljs-title function_ invoke__">collect</span>();
<span class="hljs-built_in">println!</span>(<span class="hljs-string">"è¿æ¥: {:?}"</span>, chained);

<span class="hljs-comment">// output</span>
<span class="hljs-comment">// è¿æ¥: [1, 2, 3, 4, 5, 6]</span>
</code></pre>
<p><code>zip</code>ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">names</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-string">"Alice"</span>, <span class="hljs-string">"Bob"</span>, <span class="hljs-string">"Charlie"</span>];
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">ages</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">25</span>, <span class="hljs-number">30</span>, <span class="hljs-number">35</span>];
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">paired</span>: <span class="hljs-type">Vec</span>&lt;(&amp;&amp;<span class="hljs-type">str</span>, &amp;<span class="hljs-type">i32</span>)&gt; = names.<span class="hljs-title function_ invoke__">iter</span>().<span class="hljs-title function_ invoke__">zip</span>(ages.<span class="hljs-title function_ invoke__">iter</span>()).<span class="hljs-title function_ invoke__">collect</span>();
<span class="hljs-built_in">println!</span>(<span class="hljs-string">"é…å¯¹: {:?}"</span>, paired);

<span class="hljs-comment">// output</span>
<span class="hljs-comment">// é…å¯¹: [("Alice", 25), ("Bob", 30), ("Charlie", 35)]</span>
</code></pre>
<p><code>once</code>ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">single_value</span> = iter::<span class="hljs-title function_ invoke__">once</span>(<span class="hljs-number">42</span>);
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">once_vec</span>: <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">i32</span>&gt; = single_value.<span class="hljs-title function_ invoke__">collect</span>();
<span class="hljs-built_in">println!</span>(<span class="hljs-string">"once(42) ç»“æœ: {:?}"</span>, once_vec);

<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">start</span> = iter::<span class="hljs-title function_ invoke__">once</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">middle</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">end</span> = iter::<span class="hljs-title function_ invoke__">once</span>(<span class="hljs-number">4</span>);
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">combined</span>: <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">i32</span>&gt; = start.<span class="hljs-title function_ invoke__">chain</span>(middle).<span class="hljs-title function_ invoke__">chain</span>(end).<span class="hljs-title function_ invoke__">collect</span>();
<span class="hljs-built_in">println!</span>(<span class="hljs-string">"åœ¨ [1,2,3] å‰åæ·»åŠ å…ƒç´ : {:?}"</span>, combined);

<span class="hljs-comment">// output</span>
<span class="hljs-comment">// once(42) ç»“æœ: [42]</span>
<span class="hljs-comment">// åœ¨ [1,2,3] å‰åæ·»åŠ å…ƒç´ : [0, 1, 2, 3, 4]</span>
</code></pre>
<p><code>repeat</code>ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">repeated</span>: <span class="hljs-type">Vec</span>&lt;&amp;<span class="hljs-type">str</span>&gt; = iter::<span class="hljs-title function_ invoke__">repeat</span>(<span class="hljs-string">"hello"</span>).<span class="hljs-title function_ invoke__">take</span>(<span class="hljs-number">5</span>).<span class="hljs-title function_ invoke__">collect</span>();
<span class="hljs-built_in">println!</span>(<span class="hljs-string">"é‡å¤ 'hello' 5æ¬¡: {:?}"</span>, repeated);

<span class="hljs-comment">// output</span>
<span class="hljs-comment">// é‡å¤ 'hello' 5æ¬¡: ["hello", "hello", "hello", "hello", "hello"]</span>
</code></pre>
<p>å› ä¸º <code>repeat</code> ä¼šä¸€ç›´äº§å‡ºæ•°æ®ï¼Œæ‰€ä»¥ä¸€èˆ¬æ­é… <code>take</code> ä½¿ç”¨ï¼Œé˜²æ­¢è¿­ä»£å™¨æ— æ³•ç»“æŸã€‚</p>
<p>ç®€å•çš„ä»‹ç»å®Œç”¨æ³•ä¹‹åï¼Œè®©æˆ‘ä»¬çœ‹çœ‹çœŸå®é¡¹ç›®ä¸­çš„åº”ç”¨ã€‚</p>
<p><code>redis-rs</code> è¿™ä¸ªåº“å¦‚ä½•ä½¿ç”¨è¿™ç§ç­–ç•¥æ¥ç®¡ç†ä¸»èŠ‚ç‚¹åŠå…¶å‰¯æœ¬ä¹‹é—´çš„è®¿é—®ï¼š</p>
<pre><code class="hljs language-rust" lang="rust">std::iter::<span class="hljs-title function_ invoke__">once</span>(&amp;<span class="hljs-keyword">self</span>.primary).<span class="hljs-title function_ invoke__">chain</span>(<span class="hljs-keyword">self</span>.replicas.<span class="hljs-title function_ invoke__">iter</span>())
</code></pre>
<p>ä¸Šè¿°ä»£ç ç”Ÿæˆäº†ä¸€ä¸ªè¿­ä»£å™¨ï¼Œå®ƒå¯ä»¥æ¯«æ— å·®åˆ«åœ°æ— ç¼éå†ä¸»èŠ‚ç‚¹åŠå…¶æ‰€æœ‰å‰¯æœ¬ã€‚</p>
<p>æ¥ä¸‹æ¥çœ‹ JavaScript è¿è¡Œæ—¶ <strong>Deno</strong>ï¼Œæˆ‘ä»¬ä¼šå‘ç°å¦ä¸€ä¸ªæå…·è¯´æ˜æ€§çš„ä¾‹å­ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">self</span>
 .open_docs
 .<span class="hljs-title function_ invoke__">values</span>()
 .<span class="hljs-title function_ invoke__">chain</span>(file_system_docs.docs.<span class="hljs-title function_ invoke__">values</span>())
 .<span class="hljs-title function_ invoke__">filter_map</span>(|doc| { 
 <span class="hljs-comment">//...</span>
</code></pre>
<p>æˆ‘ä»¬æœ‰å·²æ‰“å¼€çš„æ–‡æ¡£ï¼Œä¹Ÿæœ‰å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡æ¡£ï¼Œè¿™éƒ½éœ€è¦è¿›è¡Œç»Ÿä¸€å¤„ç†ã€‚</p>
<p>è‡³äºä½¿ç”¨ <code>zip</code>ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ <strong>Deno</strong> å°† 16 å­—èŠ‚çš„è¾“å…¥å—åŠ å¯†ä¸ºåŒ¹é…çš„è¾“å‡ºå—çš„æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-title function_ invoke__">for</span> (input, output) <span class="hljs-keyword">in</span> input.<span class="hljs-title function_ invoke__">chunks</span>(<span class="hljs-number">16</span>).<span class="hljs-title function_ invoke__">zip</span>(output.<span class="hljs-title function_ invoke__">chunks_mut</span>(<span class="hljs-number">16</span>)) {
  encryptor.<span class="hljs-title function_ invoke__">encrypt_block_b2b_mut</span>(input.<span class="hljs-title function_ invoke__">into</span>(), output.<span class="hljs-title function_ invoke__">into</span>());
}
</code></pre>
<p>ä¸å¯å˜çš„è¾“å…¥å—ä¸ç›¸åº”çš„å¯å˜è¾“å‡ºå—è¿›è¡Œ <code>zip</code> æ“ä½œï¼Œè¿™æ ·åŠ å¯†å™¨å§‹ç»ˆçŸ¥é“å°†åŠ å¯†æ•°æ®æ”¾åœ¨ä½•å¤„ã€‚</p>
<p>Rust ä»£ç æ£€æŸ¥å·¥å…· <strong>Clippy</strong> ä½¿ç”¨ <code>zip</code> å’Œ <code>repeat_with</code> æ¥ç”ŸæˆæŒ‰é™åºæ’åˆ—çš„å…ƒç´ ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">i</span> = end_search_start;
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">end_begin_eq</span> = block.stmts[block.stmts.<span class="hljs-title function_ invoke__">len</span>() - end_search_start..]
    .<span class="hljs-title function_ invoke__">iter</span>()
    .<span class="hljs-title function_ invoke__">zip</span>(iter::<span class="hljs-title function_ invoke__">repeat_with</span>(<span class="hljs-keyword">move</span> || {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">x</span> = i;
        i -= <span class="hljs-number">1</span>;
        x
    }))
</code></pre>
<p>è¯·æ³¨æ„ï¼Œ<code>repeat_with</code> é—­åŒ…ä¼šè¢«å¤šæ¬¡æ‰§è¡Œï¼Œæ¯æ¬¡éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°å…ƒç´ ã€‚</p>
<p>è¿˜æœ‰ <code>zip</code> çš„å¦ä¸€ç§å˜ä½“ï¼š<code>std::iter::zip</code> å‡½æ•°ã€‚å®ƒæ¥å—ä¸¤ä¸ªå®ç°äº† <code>IntoIterator</code> ç‰¹å¾çš„å‚æ•°ï¼Œå°†å®ƒä»¬è½¬æ¢ä¸ºè¿­ä»£å™¨ï¼Œç„¶åå°†å®ƒä»¬è¿›è¡Œ <code>zip</code> æ“ä½œã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨ <strong>Ruff</strong> ä¸­ï¼Œè¿™ä¸ªå‡½æ•°ç”¨äºå¯¹å‘é‡å’Œåˆ‡ç‰‡çš„å…ƒç´ è¿›è¡Œ <code>zip</code> æ“ä½œï¼Œè€Œæ— éœ€äº‹å…ˆå¼•ç”¨ç›¸åº”çš„è¿­ä»£å™¨ï¼š</p>
<pre><code class="hljs language-rust" lang="rust">std::iter::<span class="hljs-title function_ invoke__">zip</span>(&amp;tuple.elts, args)
</code></pre>
<p><code>zip</code> é€‚é…å™¨æœ‰ä¸€ä¸ªä¼šæ¶ˆè€—è¿­ä»£å™¨çš„å¯¹åº”æ–¹æ³•ï¼Œå³ <code>Iterator::unzip</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä½œç”¨äºæˆå¯¹å…ƒç´ çš„è¿­ä»£å™¨ï¼Œå°†å…¶ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªç»„ä»¶åŒæ—¶æ”¶é›†åˆ°ä¸¤ä¸ªå•ç‹¬çš„å®¹å™¨ä¸­ã€‚</p>
<p>åœ¨ç”¨äºå¤šå¹³å°éƒ¨ç½²çš„åº”ç”¨ç¨‹åºæ¡†æ¶ <strong>Tauri</strong> çš„å®ç°ä¸­ï¼Œå¯ä»¥çœ‹åˆ°è¿™ç§ä¼ ç»Ÿçš„ç”¨ä¾‹ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> (paths, attrs): (<span class="hljs-type">Vec</span>&lt;Path&gt;, <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">Vec</span>&lt;Attribute&gt;&gt;) = command_defs
  .<span class="hljs-title function_ invoke__">into_iter</span>()
  .<span class="hljs-title function_ invoke__">map</span>(|def| (def.path, def.attrs))
  .<span class="hljs-title function_ invoke__">unzip</span>();
</code></pre>
<p>æˆ‘ä»¬æœ‰ä¸€ä¸ªç»“æ„ä½“å‘é‡ï¼Œæ¯ä¸ªç»“æ„ä½“æœ‰ä¸¤ä¸ªæˆå‘˜ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯å°†å…¶æ‹†åˆ†æˆå•ç‹¬çš„å‘é‡ã€‚å°†æ„å»ºæˆå¯¹çš„ <code>map</code> ä¸ <code>unzip</code> ç»“åˆèµ·æ¥å¯ä»¥å®Œæˆæ­¤ä»»åŠ¡ã€‚</p>
<h2 data-id="heading-3">å¤„ç†æ•°æ®æµçš„ä¸åŒéƒ¨åˆ†</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30faf236b5d043e7a193beeaf22b5729~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763686212&amp;x-signature=XJ5jZw9vCn6%2F8TE4TQzcYtlA1ak%3D" alt="7.png" loading="lazy"/></p>
<p>åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ä»£ç éµå¾ªçº¿æ€§æµç¨‹ï¼šè·å–æˆ–åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œåº”ç”¨å‡ ä¸ªå¤„ç†æ­¥éª¤ï¼Œæœ€åä½¿ç”¨è¯¥è¿­ä»£å™¨ã€‚ç„¶è€Œï¼Œæœ‰äº›æƒ…å†µä¸‹è¿™ç§çº¿æ€§æ–¹æ³•å¹¶ä¸è¶³å¤Ÿï¼Œç‰¹åˆ«æ˜¯å½“æˆ‘ä»¬å¸Œæœ›ä»¥ä¸åŒæ–¹å¼å¤„ç†æ•°æ®æµçš„ä¸åŒéƒ¨åˆ†æ—¶ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä»¥ç‰¹åˆ«çš„æ–¹å¼å¤„ç†å¼€å¤´çš„ä¸€ç»„å…ƒç´ å°±éœ€è¦ç‰¹å®šçš„æ“ä½œï¼š</p>
<ul>
<li>å°†è¿­ä»£å™¨ç»‘å®šåˆ°å±€éƒ¨å˜é‡æˆ–å­˜å‚¨åœ¨ç»“æ„ä½“çš„æˆå‘˜ä¸­ã€‚</li>
<li>ç¡®ä¿åœ¨å¤„ç†å¼€å¤´çš„ä¸€ç»„å…ƒç´ æ—¶ï¼Œä¸è½¬ç§»è¿­ä»£å™¨çš„æ‰€æœ‰æƒã€‚</li>
</ul>
<p>è™½ç„¶ç¬¬ä¸€ä¸ªæ“ä½œç›¸å¯¹ç®€å•ï¼ˆä¸è¿‡å¯èƒ½éœ€è¦å°†å˜é‡è®¾ä¸ºå¯å˜çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨æ˜¾å¼è°ƒç”¨ <code>next()</code> çš„æ—¶å€™ï¼‰ï¼Œä½†ç¬¬äºŒä¸ªæ“ä½œéœ€è¦æ›´ç»†è‡´åœ°äº†è§£å¦‚ä½•ä½¿ç”¨ <code>by_ref</code> é€‚é…å™¨ã€‚</p>
<p>è¯·çœ‹ä»¥ä¸‹ä»£ç ç‰‡æ®µï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bbcb68547ec4bee98f53e81a189992f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763686212&amp;x-signature=n6UrBsm1SBfR%2BNRTuiLssb0WF1w%3D" alt="1.webp" loading="lazy"/></p>
<p>æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸ºå…¶æ‰€æœ‰è¡Œå‡†å¤‡ä¸€ä¸ªè¿­ä»£å™¨ã€‚æˆ‘ä»¬è¯»å–ç¬¬ä¸€è¡Œ â€”â€” æ­¤æ“ä½œè¦æ±‚ <code>lines</code> å˜é‡æ˜¯å¯å˜çš„ã€‚æˆ‘ä»¬ç»§ç»­è¯»å–è¡Œï¼Œç›´åˆ°é‡åˆ°ç©ºè¡Œï¼Œç„¶åç»§ç»­è¯»å–å‰©ä½™çš„è¡Œã€‚<code>take_while</code> é€‚é…å™¨å¸¦æ¥äº†ä¸€ä¸ªé—®é¢˜ï¼Œå®ƒä¼šè·å– <code>lines</code> è¿­ä»£å™¨çš„æ‰€æœ‰æƒï¼Œä½¿æˆ‘ä»¬æ— æ³•è¿›ä¸€æ­¥ä½¿ç”¨å®ƒã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå½“é¦–æ¬¡å°†è¿­ä»£å™¨ä¸è¿­ä»£å™¨é€‚é…å™¨ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»æä¾›å¯¹è¯¥è¿­ä»£å™¨çš„å¯å˜å¼•ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">rest_of_the_first_group</span> = lines
   .<span class="hljs-title function_ invoke__">by_ref</span>()
   .<span class="hljs-title function_ invoke__">take_while</span>(|l| !l.<span class="hljs-title function_ invoke__">is_empty</span>())
   .collect::&lt;<span class="hljs-type">Vec</span>&lt;_&gt;&gt;();
</code></pre>
<p>æ³¨æ„è¿™é‡Œå¯¹ <code>by_ref</code> æ–¹æ³•çš„è°ƒç”¨ã€‚</p>
<p>ä»å®ƒçš„å®ç°å¯ä»¥çœ‹å‡ºï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯ä¼ é€’å¯å˜å¼•ç”¨ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">by_ref</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">Self</span>
<span class="hljs-keyword">where</span>
   <span class="hljs-keyword">Self</span>: <span class="hljs-built_in">Sized</span>,
{
   <span class="hljs-keyword">self</span>
}
</code></pre>
<p>æˆ‘ä»¬çœ‹ä¸€ä¸ªæ›´ç®€å•çš„ä¾‹å­ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77d4e07d6a5444ce8cb0523629b21bd8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763686212&amp;x-signature=bk05PNMIRW8BeLsso4QtYYwiqhs%3D" alt="2.png" loading="lazy"/></p>
<p>å› ä¸º <code>take</code> ä¼šæ¶ˆè€—è¿­ä»£å™¨ï¼ˆå³è·å¾—è¿­ä»£å™¨çš„æ‰€æœ‰æƒï¼‰ï¼Œæ‰€ä»¥ <code>iter</code> ä¸èƒ½å†åç»­ä½¿ç”¨ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0dc93946de04b1a9e907641a5f6e666~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763686212&amp;x-signature=IGYMaUMIOhdZnj%2BTu7ItK9JOBnQ%3D" alt="3.png" loading="lazy"/></p>
<p>åªéœ€è¦ç®€å•çš„åŠ å…¥ <code>by_ref</code>ï¼Œè¯¥é—®é¢˜ä¾¿è¿åˆƒè€Œè§£ã€‚</p>
<p>æˆ‘ä»¬çœ‹ä¸€ä¸‹çœŸå®é¡¹ç›®ä¸­çš„ä¾‹å­ï¼Œä»¥ä¸‹æ˜¯æ¥è‡ª <strong>Ruff</strong> æºä»£ç çš„ç®€åŒ–ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">lines</span> = ...

<span class="hljs-keyword">for</span> <span class="hljs-variable">line</span> <span class="hljs-keyword">in</span> lines.<span class="hljs-title function_ invoke__">by_ref</span>() {
   <span class="hljs-keyword">if</span> ... {
       ...
       <span class="hljs-keyword">break</span>;
   }
}

<span class="hljs-keyword">for</span> <span class="hljs-variable">line</span> <span class="hljs-keyword">in</span> lines {
   <span class="hljs-keyword">if</span> ... {
       ...
       <span class="hljs-keyword">break</span>;
   }
}
</code></pre>
<p>æˆ‘ä»¬å…ˆå¤„ç†ç¬¬ä¸€ç»„å…ƒç´ ï¼Œç„¶åå¤„ç†å‰©ä½™çš„å…ƒç´ ã€‚<code>by_ref</code> æ–¹æ³•ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¿ç•™å¯¹ <code>lines</code> è¿­ä»£å™¨çš„æ‰€æœ‰æƒã€‚</p>
<h2 data-id="heading-4">è°ƒè¯•ç®¡é“</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ceba4a8a136463c8c1e1102510731ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763686212&amp;x-signature=qD%2BMgLOwLRk645EkiTk1rzSm2MQ%3D" alt="8.png" loading="lazy"/></p>
<p>æˆ‘ä»¬æ¥çœ‹ä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">chars</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>, <span class="hljs-string">'C'</span>, <span class="hljs-string">'D'</span>, <span class="hljs-string">'E'</span>];
<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">ix</span> = <span class="hljs-number">0</span>;
chars
   .<span class="hljs-title function_ invoke__">iter</span>()
   .<span class="hljs-title function_ invoke__">map</span>(|&amp;ch| {
       ix += <span class="hljs-number">1</span>;
       (ix, ch)
   })
   .<span class="hljs-title function_ invoke__">rev</span>()
   .<span class="hljs-title function_ invoke__">for_each</span>(|x| <span class="hljs-built_in">println!</span>(<span class="hljs-string">"PRINT: {x:?}"</span>));
</code></pre>
<p><em>å„ä½å¯ä»¥å…ˆçŒœæµ‹ä¸€ä¸‹è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</em></p>
<p>è¦æƒ³çŸ¥é“è¿™ç§æƒ…å†µä¸‹çš„è¾“å‡ºï¼Œéœ€è¦ç†è§£æ˜ å°„ä¸­çš„å‰¯ä½œç”¨ä¸è¿­ä»£å™¨ç®¡é“ä¸­ <code>rev</code> é€‚é…å™¨çš„ä½¿ç”¨ä¹‹é—´çš„ç›¸äº’ä½œç”¨ã€‚è¿™é‡Œçš„å…³é”®æ˜¯è­¦å‘Šä½ ä¸è¦å°†æ¶‰åŠå‰¯ä½œç”¨ï¼ˆä¾‹å¦‚è¯»å–å’Œä¿®æ”¹å˜é‡ï¼‰çš„æ˜ å°„æ“ä½œä¸ <code>rev</code> é€‚é…å™¨æ··åˆä½¿ç”¨ã€‚æ— è®ºè¿­ä»£å™¨ç®¡é“ä¸­ <code>rev</code> å’Œ <code>map</code> çš„å‡ºç°é¡ºåºå¦‚ä½•ï¼Œè¾“å‡ºéƒ½æ˜¯ç›¸åŒçš„ï¼Œè¿™è¯´æ˜äº†åœ¨ç»„åˆè¿™äº›æ“ä½œæ—¶çš„å¤æ‚æ€§ä»¥åŠå¯èƒ½å‡ºç°æ„å¤–ç»“æœçš„æƒ…å†µï¼š</p>
<pre><code class="hljs language-txt" lang="txt">PRINT: (1, 'E')
PRINT: (2, 'D')
PRINT: (3, 'C')
PRINT: (4, 'B')
PRINT: (5, 'A')
</code></pre>
<p>ä¹‹æ‰€ä»¥è¾“å‡ºæ˜¯è¿™æ ·çš„ï¼Œæ ¹æœ¬åŸå› åœ¨äºè¿­ä»£å™¨å›ºæœ‰çš„æƒ°æ€§ã€‚<code>map</code> ä¸­çš„é—­åŒ…ä¼šåœ¨ <code>for_each</code> ä¸­çš„æ‰“å°æ“ä½œä¹‹å‰ç«‹å³æ‰§è¡Œã€‚åˆ°è¿™ä¸ªé˜¶æ®µï¼Œæ‰€æœ‰å…ƒç´ å·²ç»ä»¥é€†åºå‘ˆç°ã€‚å› æ­¤ï¼ŒåŸå§‹å‘é‡çš„æœ€åä¸€ä¸ªå…ƒç´ è¢«èµ‹ä»¥ <code>ix</code> çš„åˆå§‹å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“è¿è¡Œ <code>map</code> æ—¶ï¼Œå…ƒç´ å·²ç»æ˜¯é€†åºäº†ã€‚</p>
<p>è®©æˆ‘ä»¬è®°ä½è¿™äº›æ ¸å¿ƒè¦ç‚¹ï¼š</p>
<ol>
<li>æƒ°æ€§æ±‚å€¼ï¼š<code>map</code> ä¸ä¼šæå‰æ‰§è¡Œ</li>
<li><code>rev()</code> æ”¹å˜è¿­ä»£é¡ºåºï¼šä»åå¾€å‰éå†</li>
<li>å‰¯ä½œç”¨çš„é¡ºåºï¼š<code>ix += 1</code> æŒ‰ç…§ <code>rev()</code> åçš„é¡ºåºæ‰§è¡Œ</li>
<li><code>for_each</code> æ¶ˆè´¹è¿­ä»£å™¨ï¼šæŒ‰ç…§å½“å‰è¿­ä»£é¡ºåºï¼ˆå·²åè½¬ï¼‰é€ä¸ªå¤„ç†</li>
</ol>
<p>å°è¯•ä¸€æ¬¡è°ƒè¯•ä¼šå¾ˆå¿«å‘ç°è¿™ç§è¡Œä¸ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a80f4979f5b14458af1ed38ed98d0a1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763686212&amp;x-signature=jcD0yelW07A7GDJXz7n1RotbJ3k%3D" alt="4.webp" loading="lazy"/></p>
<p>å¦‚æœä½ æ›´å–œæ¬¢åˆ†æç¨‹åºè¾“å‡ºï¼Œé‚£ä¹ˆ <code>inspect</code> è¿­ä»£å™¨é€‚é…å™¨åœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯å¦ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„å·¥å…·ã€‚</p>
<pre><code class="hljs language-rust" lang="rust">chars
   .<span class="hljs-title function_ invoke__">iter</span>()
   .<span class="hljs-title function_ invoke__">inspect</span>(|ch| <span class="hljs-built_in">println!</span>(<span class="hljs-string">"INSPECT: {ch}"</span>))
   .<span class="hljs-title function_ invoke__">map</span>(|&amp;ch| {
       ix += <span class="hljs-number">1</span>;
       (ix, ch)
   })
   .<span class="hljs-title function_ invoke__">rev</span>()
   .<span class="hljs-title function_ invoke__">for_each</span>(|x| <span class="hljs-built_in">println!</span>(<span class="hljs-string">"PRINT: {x:?}"</span>));
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-txt" lang="txt">INSPECT: E
PRINT: (1, 'E')
INSPECT: D
PRINT: (2, 'D')
// ... 
</code></pre>
<p>åœ¨å…¶ä»–è¿­ä»£å™¨é€‚é…å™¨ä¹‹é—´æ”¾ç½®å¤šä¸ª <code>inspect</code> è°ƒç”¨ï¼Œå¯¹äºè·Ÿè¸ªå¤„ç†æµç¨‹ä»¥åŠæ­£ç¡®ç†è§£æ“ä½œé¡ºåºå¾ˆæœ‰å¸®åŠ©ã€‚å¦‚å‰æ‰€è¿°ï¼Œåœ¨æ›´å¤æ‚çš„åœºæ™¯ä¸­ï¼Œå°†å¤„ç†æµç¨‹åˆ’åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹çš„å‡½æ•°ï¼Œä¹Ÿæœ‰åŠ©äºæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç®¡ç†æ€§ã€‚</p>
<h2 data-id="heading-5">æ€»ç»“</h2>
<p>è¯¥ç¯‡æ–‡ç« æ¢è®¨äº†ä½¿ç”¨ Rust è¿­ä»£å™¨çš„å¾ˆå¤šåœºæ™¯ã€‚é€šè¿‡æ¥è‡ª <strong>Ruff</strong>ã€<strong>Deno</strong>ã€<strong>Bevy</strong>ã€<strong>Clippy</strong>ã€<strong>redis-rs</strong>ã€<strong>Tauri</strong>ã€<strong>Meilisearch</strong> å’Œ <strong>Bloop</strong> ç­‰å®é™…é¡¹ç›®çš„ç¤ºä¾‹ä»¥åŠç®€å•çš„è‡ªæµ‹é¡¹ç›®ï¼Œæˆ‘ä»¬äº†è§£äº†è¿­ä»£å™¨å¦‚ä½•ä¾¿åˆ©è¯¸å¦‚æ„å»ºå¯è¿­ä»£å¯¹è±¡ã€é“¾å¼æ“ä½œã€åˆå¹¶ä»¥åŠæ•°æ®è½¬æ¢ç­‰æ“ä½œã€‚</p>
<p>æˆ‘ä»¬ç€é‡ä»‹ç»äº†å¤„ç†è¿­ä»£å™¨çš„æŠ€å·§ï¼ŒåŒ…æ‹¬ä½¿ç”¨ <code>by_ref</code> æ–¹æ³•æ¥ä¿ç•™æ‰€æœ‰æƒå¹¶é¿å…è¿‡æ—©æ¶ˆè€—è¿­ä»£å™¨ã€‚</p>
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜è®¨è®ºäº†ç†è§£è¿­ä»£å™¨æƒ°æ€§ä»¥åŠä¸ºè°ƒè¯•å’Œåˆ†æè€Œåˆç†æ”¾ç½® <code>inspect</code> è°ƒç”¨çš„é‡è¦æ€§ã€‚åœ¨æ‰€æœ‰ç¤ºä¾‹ä¸­ï¼Œ<strong>RustRover</strong> çš„ä»£ç åˆ†æå’Œè°ƒè¯•å™¨å¸®åŠ©æˆ‘ä»¬ç†è§£ä»£ç å¹¶å¿«é€Ÿè§£å†³å‡ºç°çš„ä»»ä½•é—®é¢˜ã€‚</p>
<p>æ€»ä½“è€Œè¨€ï¼Œè¿™äº›æŠ€å·§èƒ½è®©æˆ‘ä»¬ä¸ºå„ç§åº”ç”¨ç¨‹åºç¼–å†™åœ°é“ä¸”é«˜æ•ˆçš„ Rust ä»£ç ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥äº†è§£RUSTè¿­ä»£å™¨ - æƒ°æ€§ã€å¯ç»„åˆçš„å¤„ç†]]></title>    <link>https://juejin.cn/post/7572095192418779163</link>    <guid>https://juejin.cn/post/7572095192418779163</guid>    <pubDate>2025-11-14T01:49:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572095192418779163" data-draft-id="7572132100360568878" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥äº†è§£RUSTè¿­ä»£å™¨ - æƒ°æ€§ã€å¯ç»„åˆçš„å¤„ç†"/> <meta itemprop="keywords" content="åç«¯,Rust"/> <meta itemprop="datePublished" content="2025-11-14T01:49:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xuejianxinokok"/> <meta itemprop="url" content="https://juejin.cn/user/2115899365524222"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥äº†è§£RUSTè¿­ä»£å™¨ - æƒ°æ€§ã€å¯ç»„åˆçš„å¤„ç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2115899365524222/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xuejianxinokok
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T01:49:21.000Z" title="Fri Nov 14 2025 01:49:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">è¿­ä»£å™¨ - æ·±å…¥äº†è§£æƒ°æ€§ã€å¯ç»„åˆçš„å¤„ç†</h2>
<p>åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨è¿­ä»£å™¨ï¼Œå°è¯•å±•ç¤ºå…¶å¤„ç†æ•°æ®çš„æƒ°æ€§æ±‚å€¼å’Œå¯ç»„åˆæ€§ã€‚</p>
<p>è¿­ä»£å™¨æ˜¯ Rust æœ€å¼ºå¤§çš„æŠ½è±¡ä¹‹ä¸€ï¼Œå®ƒæä¾›äº†ä¸€ç§é›¶æˆæœ¬çš„æ–¹å¼æ¥å¤„ç†æ•°æ®åºåˆ—ã€‚</p>
<p>å®ƒä»¬ç»“åˆäº†å‡½æ•°å¼ç¼–ç¨‹çš„ä¼˜é›…å’Œç³»ç»Ÿç¼–ç¨‹çš„æ•ˆç‡ï¼Œç†è§£å®ƒä»¬å¯¹äºç¼–å†™åœ°é“çš„ Rust ä»£ç è‡³å…³é‡è¦ã€‚</p>
<hr/>
<h3 data-id="heading-1">The Iterator Trait</h3>
<p>Rust è¿­ä»£å™¨ç³»ç»Ÿçš„æ ¸å¿ƒæ˜¯ <strong>Iterator</strong> traitï¼Œå®ƒå®šä¹‰äº†å¦‚ä½•ç”Ÿæˆä¸€ç³»åˆ—å€¼ã€‚</p>
<p>è¿™ä¸ªç‰¹æ€§å‡ºå¥‡åœ°ç®€å•ï¼Œåªéœ€è¦å®ç°ä¸€ä¸ªæ–¹æ³•ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bdb3fb261304861958b5a0085606ee1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVlamlhbnhpbm9rb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763689760&amp;x-signature=lC1aPRCdZ7P3WzeHps8o2yjpR1Y%3D" alt="" loading="lazy"/></p>
<p><strong>Item</strong> å…³è”çš„ç±»å‹æŒ‡å®šè¿­ä»£å™¨ç”Ÿæˆçš„å€¼çš„ç±»å‹ã€‚</p>
<p>è¿™æ˜¯ä¸€ç§<strong>é€šç”¨å…³è”ç±»å‹ (GAT,Generic Associated Type)</strong> çš„å½¢å¼ ï¼Œå…è®¸æ¯ä¸ªè¿­ä»£å™¨å®ç°å®šä¹‰è‡ªå·±çš„itemç±»å‹ï¼Œè€Œæ— éœ€ä½¿ç”¨è€…æ˜¾å¼æŒ‡å®šã€‚</p>
<p><code>next()</code> æ–¹æ³•æ‰æ˜¯å…³é”®æ‰€åœ¨â€”â€”å®ƒä¸ºåºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ è¿”å› <code>Some(value)</code> ï¼Œ å½“è¿­ä»£å™¨è€—å°½æ—¶è¿”å› <code>None</code> ã€‚</p>
<p>ä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰è¿­ä»£å™¨ç¤ºä¾‹å¯ä»¥æ˜¯ 0 åˆ° max çš„è®¡æ•°å™¨ã€‚</p>
<p>è®©æˆ‘ä»¬åˆ›å»ºç»“æ„ä½“å¹¶ä¸ºå…¶å®ç° Iterator traitã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0539a3d73e6e4b4a8d00d22c6847bcbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVlamlhbnhpbm9rb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763689760&amp;x-signature=ujXqq6kJejiKxKhvFGGWUOaei6g%3D" alt="" loading="lazy"/></p>
<p>å¥½äº†ï¼Œç°åœ¨å¼€å§‹ä½¿ç”¨å®ƒå§ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf1fc20835fb4b04a28c3f9b95fb612e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVlamlhbnhpbm9rb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763689760&amp;x-signature=9BxanboYkPu%2Bzsmkcs7SubLmSog%3D" alt="" loading="lazy"/></p>
<p>å¦‚ä¸Šå›¾ï¼ŒIterator ç‰¹æ€§æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æŠ½è±¡ï¼Œå®ƒä½¿æˆ‘ä»¬èƒ½å¤Ÿä»¥çµæ´»é«˜æ•ˆçš„æ–¹å¼å¤„ç†æ•°æ®åºåˆ—ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº† Iterator trait çš„åŸºç¡€çŸ¥è¯†ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ Rust çš„è¿­ä»£å™¨ç³»ç»Ÿã€‚</p>
<hr/>
<h3 data-id="heading-2">è¿­ä»£å™¨æœ‰ä½•ç‰¹æ®Šä¹‹å¤„ï¼Ÿ</h3>
<p>Rust ä¸­çš„è¿­ä»£å™¨æœ¬è´¨ä¸Šæ˜¯<strong>æƒ°æ€§çš„â€”â€”å®ƒä»¬åœ¨è¢«ä½¿ç”¨ä¹‹å‰ä»€ä¹ˆä¹Ÿä¸åš</strong>ã€‚</p>
<p><strong>è¿™ç§æƒ°æ€§ä½¿å¾—ç¼–è¯‘å™¨èƒ½å¤Ÿå°†è¿­ä»£å™¨é“¾ä¼˜åŒ–æˆç´§å‡‘ã€é«˜æ•ˆçš„å¾ªç¯ï¼Œå…¶æ€§èƒ½å¯ä¸æ‰‹å†™çš„è¿‡ç¨‹ä»£ç ç›¸åª²ç¾</strong>ã€‚</p>
<p>å½“é“¾å¼è°ƒç”¨ map()ã€filter() æˆ– fold() ç­‰æ“ä½œæ—¶ï¼ŒRust åªä¼šå¯¹æ•°æ®è¿›è¡Œ<strong>ä¸€æ¬¡éå†</strong>ï¼Œä»è€Œç¡®ä¿é«˜æ•ˆçš„å¤„ç†ã€‚</p>
<p>Rust ä¸­çš„è¿­ä»£å™¨ç”± <code>Iterator</code> trait å®šä¹‰ï¼Œè¯¥ trait åªéœ€è¦å®ç°ä¸€ä¸ªæ–¹æ³•ï¼š<code>next()</code>ã€‚æ­¤æ–¹æ³•æŒ‡å®šå¦‚ä½•æ¨è¿›è¿­ä»£å™¨å¹¶è¿”å›ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚</p>
<p>è¿™ç§ç®€æ´æ€§ä½¿å¾—ä»»ä½•ç±»å‹éƒ½èƒ½è½»æ¾å®ç°è¿­ä»£ã€‚å®ƒè¿˜èµ‹äºˆæˆ‘ä»¬çµæ´»æ€§ï¼Œå¯ä»¥æ ¹æ®éœ€è¦æŒ‡å®šè¿­ä»£çš„å†…éƒ¨é€»è¾‘ï¼Œä»è€Œå°†å…¶ä¸é¢å‘ç”¨æˆ·çš„ API è§£è€¦ã€‚</p>
<hr/>
<h3 data-id="heading-3">åˆ›å»ºè¿­ä»£å™¨çš„ä¸‰ç§æ–¹æ³•</h3>
<p>Rust æä¾›äº†ä¸‰ç§ä»é›†åˆåˆ›å»ºè¿­ä»£å™¨çš„ä¸»è¦æ–¹æ³•ï¼Œæ¯ç§æ–¹æ³•éƒ½æä¾›äº†<strong>ä¸åŒçš„æ‰€æœ‰æƒè¯­ä¹‰</strong>ã€‚</p>
<p>è¿™äº›æ–¹æ³•åœ¨å¤„ç†å€Ÿç”¨å’Œæ‰€æœ‰æƒæ–¹é¢æœ‰æ‰€ä¸åŒï¼Œå¯ä»¥æ ¹æ®ä½¿ç”¨æƒ…å†µé€‰æ‹©åˆé€‚çš„æ–¹æ³•ã€‚</p>
<blockquote>
<p><strong>iter()</strong> æ–¹æ³•å…è®¸éå†é›†åˆï¼ŒåŒæ—¶å°†æ¯ä¸ªå…ƒç´ ä½œä¸º<strong>ä¸å¯å˜å¼•ç”¨å€Ÿç”¨</strong>ã€‚</p>
<p>è¿™ç§æ–¹æ³•ç¡®ä¿åªè¯»è®¿é—®ï¼Œé˜²æ­¢åœ¨éå†è¿‡ç¨‹ä¸­æ„å¤–ä¿®æ”¹ã€‚</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f6f5d6b8fb24af6af232dbe800d5758~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVlamlhbnhpbm9rb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763689760&amp;x-signature=ad2kJSDvbPnL1%2BXQmIT9Egtem4A%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><strong>into_iter()</strong> æ–¹æ³•å…è®¸éå†é›†åˆï¼ŒåŒæ—¶ move æ¯ä¸ªå…ƒç´ çš„æ‰€æœ‰æƒ,è¿™å°±æ˜¯ <code>into</code>çš„è¯­ä¹‰ã€‚</p>
<p>è¿™ç§æ–¹æ³•å¯ä»¥é«˜æ•ˆåœ°ä½¿ç”¨é›†åˆï¼Œ<strong>é¿å…ä¸å¿…è¦çš„å…‹éš†ï¼Œå› ä¸ºå®ƒç›´æ¥å°†å…ƒç´ ç§»åŠ¨åˆ°è¿­ä»£å™¨ä¸­</strong>ã€‚</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a38492575eb449cadd66cab1370119b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVlamlhbnhpbm9rb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763689760&amp;x-signature=92rzhUU1MxSV3R%2F6IsPTYAqDDNY%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><strong>iter_mut()</strong> æ–¹æ³•å…è®¸ä½ éå†é›†åˆï¼ŒåŒæ—¶ä¸ºæ¯ä¸ªå…ƒç´ æä¾›å¯å˜å¼•ç”¨ã€‚</p>
<p>è¿™æ ·å°±å¯ä»¥åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ç›´æ¥ä¿®æ”¹å…ƒç´ ï¼Œè¿™å¯¹äºæ— éœ€åˆ›å»ºæ–°é›†åˆå³å¯è¿›è¡Œå°±åœ°æ›´æ–°éå¸¸æœ‰ç”¨ã€‚</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a75d7c134b247948adfad2eb0377669~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVlamlhbnhpbm9rb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763689760&amp;x-signature=t4Ske0RheL8%2FtmMTtaxTlb2OKuM%3D" alt="" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-4">Transforming Iterators  (è½¬æ¢è¿­ä»£å™¨)</h3>
<p>Rust ä¸­çš„è¿­ä»£å™¨æä¾›äº†å¤šç§è½¬æ¢é¡¹çš„æ–¹æ³•ï¼Œä»è€Œå®ç°äº†å¼ºå¤§çš„æ•°æ®å¤„ç†ç®¡é“ã€‚</p>
<p>ä¾‹å¦‚ï¼Œ <strong>map(fn)</strong> å’Œ <strong>filter(fn)</strong> ç­‰æ–¹æ³•å…è®¸å¼€å‘äººå‘˜å°†å‡½æ•°åº”ç”¨äºæ¯ä¸ªå…ƒç´ æˆ–é€‰æ‹©æ€§åœ°å¤„ç†æ•°æ®ï¼Œä»è€Œç®€åŒ–å¤æ‚çš„æ“ä½œè€Œæ— éœ€æ‰‹åŠ¨å¾ªç¯ã€‚</p>
<blockquote>
<p><strong>map(fn)</strong> ä¼šç”Ÿæˆä¸€ä¸ªè¿­ä»£å™¨ï¼Œè¯¥è¿­ä»£å™¨ä¼šå°†ä¼ å…¥çš„å‡½æ•°åº”ç”¨äºæ¯ä¸ªå…ƒç´ ï¼š</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f465e72d1ba4fbc8b744840912788c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVlamlhbnhpbm9rb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763689760&amp;x-signature=j0u7ZDvHwQk1ATbc6OzSh56P1tA%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><strong>filter(fn)</strong> ç”Ÿæˆä¸€ä¸ªè¿­ä»£å™¨ï¼Œç¡®ä¿åªè¿­ä»£æ»¡è¶³è°“è¯(predicate )çš„å…ƒç´ ï¼š</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ef62fb941274f38be1da1908eaa9db7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVlamlhbnhpbm9rb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763689760&amp;x-signature=R%2FId6q2vf1mebpSI31rbwgoP0AM%3D" alt="" loading="lazy"/></p>
<p>å½“ç„¶ï¼Œé€‚é…å™¨å¾ˆå®¹æ˜“ä¸²è”èµ·æ¥ï¼Œä»è€Œå¯ä»¥æ„å»ºæ›´å¤æ‚çš„ç®¡é“ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/abc07af3c88e475c8c1d7ea24aa659bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVlamlhbnhpbm9rb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763689760&amp;x-signature=Jcuu%2FeDaX0xCfy%2F9ceSYKZZT7ao%3D" alt="" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-5">Consuming Iterators  (æ¶ˆè´¹è¿­ä»£å™¨)</h3>
<p>ç”±äº Rust ä¸­çš„è¿­ä»£å™¨å…·æœ‰<strong>æƒ°æ€§</strong>ï¼Œå› æ­¤éœ€è¦å°†å…¶è½¬æ¢ä¸ºç‰¹å®šç±»å‹æ‰èƒ½äº§ç”Ÿç»“æœï¼Œè¿™é€šå¸¸ä½¿ç”¨è¯¸å¦‚ <strong>collect() ä¹‹</strong>ç±»çš„å†…ç½®æ–¹æ³•æ¥å®ç° ã€‚</p>
<p>è¿™ç§æ–¹æ³•é€šè¿‡<strong>å°†è®¡ç®—å»¶è¿Ÿåˆ°éœ€è¦æ—¶æ‰è¿›è¡Œï¼Œä»è€Œç¡®ä¿äº†é«˜æ•ˆçš„å†…å­˜ä½¿ç”¨</strong>ã€‚</p>
<blockquote>
<p><strong>collect()</strong> å°†è¿­ä»£å™¨çš„å…ƒç´ ç´¯åŠ åˆ°æŒ‡å®šç±»å‹æˆ–éšå¼ç¡®å®šçš„ç±»å‹ä¸­ã€‚</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17d9681351ff4325871674179c292f3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVlamlhbnhpbm9rb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763689760&amp;x-signature=mY3ypFE4XbQH85iqFVaweNnOagw%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><strong>fold()</strong> å‡½æ•°ä½¿ç”¨æŒ‡å®šçš„åˆå§‹å€¼å’Œç´¯åŠ å‡½æ•°å°†è¿­ä»£å™¨çš„å…ƒç´ è½¬æ¢ä¸ºç´¯åŠ å€¼ã€‚(fold æ˜¯æŠ˜å çš„æ„æ€,æ„å‘³ç€ç´¯åŠ )</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a92315b5e3743a1acde38d8e6aa4815~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVlamlhbnhpbm9rb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763689760&amp;x-signature=w2v5q4Kvac%2FNtyyn8RkzBqvp8NU%3D" alt="" loading="lazy"/></p>
<p><strong>Iterator</strong> trait åŒ…å«é¢å¤–çš„å†…ç½®æ–¹æ³•ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿé¿å…é‡æ–°å®ç°åŸºæœ¬åŠŸèƒ½ï¼Œä¾‹å¦‚æ•°å­—çš„æ±‚å’Œæˆ–ä¹˜ç§¯ï¼ˆç±»ä¼¼äºæˆ‘ä»¬ä¸Šé¢ä½¿ç”¨ <strong>fold(initial, fn)</strong> çš„å®ç°ï¼‰ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc4b5350f4214febad79ce96ff5b7fc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVlamlhbnhpbm9rb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763689760&amp;x-signature=X2OITB%2Bbv95Fho98OWjOpVouMNM%3D" alt="" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-6">Reshaping Iterators  (é‡å¡‘è¿­ä»£å™¨)</h3>
<p>æ­¤å¤–ï¼Œè¿­ä»£å™¨è¿˜æä¾›äº†å¼ºå¤§çš„é€‚é…å™¨ï¼Œå¯ä»¥<strong>ä¿®æ”¹æ•°æ®æµæœ¬èº«çš„ç»“æ„å’Œé¡ºåº</strong>ã€‚</p>
<p>è¿™äº›é€‚é…å™¨èƒ½å¤Ÿå®ç°é«˜æ•ˆçš„è½¬æ¢ï¼Œè€Œä¸ä¼šè¿‡æ—©åœ°æ¶ˆè€—åŸå§‹è¿­ä»£å™¨ã€‚</p>
<blockquote>
<p><strong>step_by() å‡½æ•°</strong>é€šè¿‡æ ¹æ®æŒ‡å®šçš„æ­¥é•¿è·³è¿‡é¡¹ç›®æ¥ä¿®æ”¹è¿­ä»£å™¨çš„éå†æ–¹å¼ã€‚
è¿™ç§æ–¹æ³•å¯ä»¥è®©ä½ é«˜æ•ˆåœ°å¤„ç†æ¯ç¬¬ n ä¸ªå…ƒç´ ã€‚</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df7e1d6db83d42de9e8612adc26a8b91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVlamlhbnhpbm9rb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763689760&amp;x-signature=isL2wazrBLlVuQdmPVKVLTJrICo%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><strong>rev()</strong> åè½¬è¿­ä»£å™¨çš„éå†æ–¹å‘ã€‚</p>
<p>è¿™ç§æ–¹æ³•ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå®ƒä¸ä¼šä¿®æ”¹åŸå§‹é›†åˆã€‚</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64286701f3114643942f08f74d6e9224~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVlamlhbnhpbm9rb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763689760&amp;x-signature=jy7wABA2OfKCsmj1OivGihmwnUc%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><strong>enumerate()</strong> æ–¹æ³•é€šè¿‡å°†æ¯ä¸ªé¡¹ç›®<strong>åŒ…è£…åœ¨ä¸€ä¸ªå…ƒç»„ä¸­æ¥ä¿®æ”¹éå†ï¼Œå…¶ä¸­é¡¹ç›®çš„ç´¢å¼•ä½äºç¬¬ä¸€ä¸ªä½ç½®</strong>ã€‚</p>
<p>è¿™æ ·ï¼Œä½ å°±å¯ä»¥åœ¨è¿­ä»£è¿‡ç¨‹ä¸­è®¿é—®ç´¢å¼•å’Œå€¼ï¼Œè¿™å¯¹äºè¯¸å¦‚ç»™é›†åˆä¸­çš„å…ƒç´ ç¼–å·ä¹‹ç±»çš„ä»»åŠ¡éå¸¸æœ‰ç”¨ã€‚</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/386262a0b6ed4b9e85ff77a09f0d8027~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVlamlhbnhpbm9rb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763689760&amp;x-signature=vfzOLJqJIA5SM%2BR%2BFuJj6oDMbnY%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><strong>zip(iterator)</strong> <strong>å°†ä¸¤ä¸ªè¿­ä»£å™¨åˆå¹¶æˆä¸€ä¸ªå…ƒç»„è¿­ä»£å™¨ï¼Œå°†æ¯ä¸ªè¿­ä»£å™¨ä¸­çš„å…ƒç´ é…å¯¹</strong>ã€‚(zip æ˜¯æ‹‰é“¾çš„æ„æ€,æ„å‘³ç€æŠŠæ‹‰é“¾2è¾¹çš„é½¿é…å¯¹)
<strong>å½“è¾ƒçŸ­çš„è¿­ä»£å™¨è€—å°½æ—¶ï¼Œè¯¥å‡½æ•°åœæ­¢è¿è¡Œ</strong>ï¼Œä»è€Œç¡®ä¿ä¸ä¼šå› é•¿åº¦ä¸åŒ¹é…è€Œå¯¼è‡´ panicã€‚</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3373a90b007b4311835ee54132351bf5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVlamlhbnhpbm9rb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763689760&amp;x-signature=gV6pYOgHfrg2BjySCjH4PkB%2BbKM%3D" alt="" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-7">ç¤ºä¾‹ï¼š</h3>
<p>æœ€åï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€äº›çš„ Deltas è¿­ä»£å™¨ç¤ºä¾‹ï¼Œå®ƒå¯ä»¥<strong>è®¡ç®—æ¯ä¸ªå…ƒç´ åˆ°å…¶ ä¸Šæ¬¡å‡ºç°ä½ç½®  çš„è·ç¦»</strong>ã€‚(Delta (Î”, Î´) æ˜¯å¸Œè…Šå­—æ¯è¡¨ä¸­çš„ç¬¬å››ä¸ªå­—æ¯ï¼Œé€šå¸¸ç”¨äºè¡¨ç¤ºå˜åŒ–æˆ–å·®å¼‚)</p>
<p>äº†è§£éœ€æ±‚åï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ¥éªŒè¯å…¶åŠŸèƒ½ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d7a194bc8a2403eb015146d05e9eaf9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVlamlhbnhpbm9rb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763689760&amp;x-signature=dyyy11fYp5RPSBry2Xd%2Fxyg2Sq0%3D" alt="" loading="lazy"/></p>
<p>ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç€æ‰‹å®ç° <code>Deltas</code>  structäº†ã€‚</p>
<p>è¯¥ç»“æ„ä½“åŒ…è£…äº†ä¸€ä¸ªä¼ é€’ç»™å®ƒçš„è¿­ä»£å™¨ï¼Œå¹¶é€šè¿‡å¯¹å…¶è°ƒç”¨ <code>.enumerate()</code> æ¥ä¿®æ”¹å®ƒ ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a204cb6f5e0c4cd8ae1aa17c249f6056~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVlamlhbnhpbm9rb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763689760&amp;x-signature=4%2FwIC5RI%2F0wu9VKyvm3PbDUFoQk%3D" alt="" loading="lazy"/></p>
<p>ç°åœ¨æˆ‘ä»¬æœ‰äº† <code>Deltas</code> structï¼Œå‰©ä¸‹çš„å”¯ä¸€ä¸€ä»¶äº‹å°±æ˜¯ä¸ºå…¶å®ç° <code>Iterator</code> traitã€‚</p>
<p><code>next()</code> æ–¹æ³•æ‰æ˜¯çœŸæ­£å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¼šä¿®æ”¹è¿­ä»£å™¨ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc8528f215ae4b9f94dec5b25d0dcea6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVlamlhbnhpbm9rb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763689760&amp;x-signature=dsQWv5Ss9xTpU76cB8%2FWCc1ALnQ%3D" alt="" loading="lazy"/></p>
<p>OKï¼æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªæƒ°æ€§è¿­ä»£å™¨ï¼Œå®ƒå¯ä»¥è®¡ç®—<strong>æ¯ä¸ªå…ƒç´ åˆ°å…¶ä¸Šä¸€æ¬¡å‡ºç°ä½ç½®çš„è·ç¦»</strong>ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œ<code>next()</code> æ–¹æ³•çš„å…·ä½“å®ç°å¯¹ç”¨æˆ·æ˜¯éšè—çš„ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ä¸ç ´åçº¦å®šçš„æƒ…å†µä¸‹ä¿®æ”¹åº•å±‚è¿­ä»£å™¨ã€‚</p>
<p>è®©æˆ‘ä»¬åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œé€šè¿‡å»æ‰ Vec è€Œæ”¹ç”¨ HashMap æ¥æé«˜è¿­ä»£å™¨çš„æ•ˆç‡ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f041ee2e618b40a28b18fadd8e783bb4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVlamlhbnhpbm9rb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763689760&amp;x-signature=pk3BES8L0BC1Ct7iYRN3OyMxE0U%3D" alt="" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-8">è¦ç‚¹æ€»ç»“</h3>
<p>Rust è¿­ä»£å™¨ä»£è¡¨äº†æˆ‘ä»¬å¤„ç†åºåˆ—æ–¹å¼çš„æ ¹æœ¬æ€§è½¬å˜ï¼Œå®ƒå°†å‡½æ•°å¼ç¼–ç¨‹çš„ä¼˜é›…ä¸ <strong>ç³»ç»Ÿç¼–ç¨‹çš„ æ€§èƒ½</strong> ç»“åˆèµ·æ¥ã€‚</p>
<p>å®ƒä»¬<strong>é»˜è®¤æ˜¯æƒ°æ€§çš„</strong> ï¼Œå¯ä»¥<strong>é«˜æ•ˆåœ°é“¾æ¥æ“ä½œï¼Œæœ€ç»ˆç¼–è¯‘æˆæœ€ä¼˜çš„æœºå™¨ä»£ç </strong>ã€‚</p>
<p>ç†è§£ <strong>iter()</strong> ã€ <strong>into_iter()</strong> å’Œ <strong>iter_mut()</strong> ä¹‹é—´çš„åŒºåˆ«å¯¹äºæ­£ç¡®ç®¡ç†<strong>æ‰€æœ‰æƒ</strong>è‡³å…³é‡è¦ã€‚</p>
<p>å€ŸåŠ© <strong>map()</strong> ã€ <strong>filter()</strong> å’Œ <strong>fold()</strong> ç­‰è¿­ä»£å™¨é€‚é…å™¨ ï¼Œå¤æ‚çš„æ•°æ®è½¬æ¢å˜å¾—ç®€æ´è€Œå¯Œæœ‰è¡¨ç°åŠ›ã€‚</p>
<p>æœ€é‡è¦çš„æ˜¯ï¼Œè¿­ä»£å™¨ä¸ä»…ä»…æ˜¯è¯­æ³•ç³–â€”â€”å®ƒä»¬æ˜¯ä¸€ç§<strong>é›¶æˆæœ¬çš„æŠ½è±¡</strong> ï¼Œé¼“åŠ±ç¼–å†™æ›´å®‰å…¨ã€æ›´æ˜“äºç»´æŠ¤çš„ä»£ç ï¼Œè€Œä¸ä¼šç‰ºç‰²æ€§èƒ½ã€‚</p>
<hr/>
<p>ç›¸å…³æ–‡ç« :</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fitsfoxstudio.substack.com%2Fp%2Fcomparison-traits-understanding-equality" target="_blank" title="https://itsfoxstudio.substack.com/p/comparison-traits-understanding-equality" ref="nofollow noopener noreferrer">Comparison Traits:ç†è§£ç›¸ç­‰æ€§å’Œæ’åº </a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[eBPFæ€§èƒ½æ­ç§˜ - XDP å’Œ JIT]]></title>    <link>https://juejin.cn/post/7572087162230833194</link>    <guid>https://juejin.cn/post/7572087162230833194</guid>    <pubDate>2025-11-14T02:05:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572087162230833194" data-draft-id="7572087162230784042" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="eBPFæ€§èƒ½æ­ç§˜ - XDP å’Œ JIT "/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-14T02:05:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="lizhongxuan"/> <meta itemprop="url" content="https://juejin.cn/user/940837683343224"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            eBPFæ€§èƒ½æ­ç§˜ - XDP å’Œ JIT 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/940837683343224/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    lizhongxuan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T02:05:29.000Z" title="Fri Nov 14 2025 02:05:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¦‚æœä½ åˆšå¼€å§‹å­¦ä¹  eBPFï¼Œä½ å¯èƒ½ç»å¸¸å¬åˆ°å®ƒâ€œæ€§èƒ½æé«˜â€ã€â€œæ¥è¿‘åŸç”Ÿâ€ã€â€œå½»åº•æ”¹å˜äº† Linux å†…æ ¸â€â€¦â€¦ ä½†ä½ æ˜¯å¦å¥½å¥‡è¿‡ï¼Œè¿™ç§â€œé­”æ³•â€ç©¶ç«Ÿä»ä½•è€Œæ¥ï¼Ÿ</p>
<p>å½“ä½ æ‰§è¡Œ <code>bpftool prog show id &lt;ä½ çš„ID&gt; --pretty</code> å¹¶çœ‹åˆ°è¾“å‡ºä¸­åŒæ—¶å‡ºç°äº† <code>xdp</code> å’Œ <code>jit</code> è¿™æ ·çš„å­—çœ¼æ—¶ï¼Œä½ å°±å·²ç»çœ‹åˆ°äº†ç­”æ¡ˆ:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">540</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"xdp"</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// çœ‹è¿™é‡Œï¼šå®ƒçš„ç±»å‹æ˜¯ XDP</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"hello"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-comment">// ...</span>
    <span class="hljs-attr">"jited"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// çœ‹è¿™é‡Œï¼šå®ƒå·²ç»è¢« JIT ç¼–è¯‘äº†</span>
    <span class="hljs-attr">"jit_len"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">72</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"xlated_len"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">64</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"load_time"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1678886400</span><span class="hljs-punctuation">,</span>
    <span class="hljs-comment">// ...</span>
    <span class="hljs-attr">"jit_insns"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>  <span class="hljs-comment">// è¿™é‡Œå°±æ˜¯ JIT ç¼–è¯‘åçš„åŸç”Ÿæœºå™¨ç ï¼ˆx86 æ±‡ç¼–ï¼‰</span>
        <span class="hljs-string">"0:   push   %rbp"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"1:   mov    %rsp,%rbp"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"2:   mov    0x8(%rdi),%rdi"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-comment">// ...</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿™ç¯‡åšå®¢å°†å¸¦ä½ æ·±å…¥äº†è§£è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚ä¸ºäº†è®©ä½ å½»åº•ç†è§£ï¼Œæˆ‘ä»¬æ¥æ‰“ä¸ªæ¯”æ–¹ï¼š</p>
<ul>
<li><strong>XDP (eXpress Data Path)</strong>ï¼šå†³å®šäº†ä½ çš„ eBPF ç¨‹åº**åœ¨å“ªé‡Œï¼ˆWhereï¼‰**è¿è¡Œã€‚</li>
<li><strong>JIT (Just-In-Time) Compiler</strong>ï¼šå†³å®šäº†ä½ çš„ eBPF ç¨‹åº**å¦‚ä½•ï¼ˆHowï¼‰**è¿è¡Œã€‚</li>
</ul>
<p>ææ‡‚äº†è¿™ä¸¤ç‚¹ï¼Œä½ å°±ææ‡‚äº† eBPF æ€§èƒ½çš„æ ¸å¿ƒç§˜å¯†ã€‚</p>
<hr/>
<h2 data-id="heading-0">ğŸ“ XDPï¼šåœ¨â€œå†…æ ¸é«˜é€Ÿå…¬è·¯â€çš„å…¥å£æ”¶è´¹ç«™</h2>
<p><code>XDP</code> çš„å…¨ç§°æ˜¯ <strong>eXpress Data Path</strong>ï¼ˆé«˜é€Ÿæ•°æ®è·¯å¾„ï¼‰ã€‚å®ƒçš„åå­—å·²ç»è¯´æ˜äº†ä¸€åˆ‡â€”â€”å®ƒå°±æ˜¯ä¸€æ¡ä¸ºç½‘ç»œåŒ…å‡†å¤‡çš„â€œç‰¹å¿«ä¸“çº¿â€ã€‚</p>
<h3 data-id="heading-1">æ­£å¸¸ï¼ˆç¼“æ…¢ï¼‰çš„ç½‘ç»œåŒ…ä¹‹æ—…</h3>
<p>æƒ³è±¡ä¸€ä¸‹ä¸€ä¸ªç½‘ç»œåŒ…è¿›å…¥ä½ æœåŠ¡å™¨çš„â€œå¸¸è§„æ—…ç¨‹â€ï¼š</p>
<ol>
<li>æ•°æ®åŒ…åˆ°è¾¾ä½ çš„<strong>ç‰©ç†ç½‘å¡ (NIC)</strong>ã€‚</li>
<li>ç½‘å¡é©±åŠ¨ç¨‹åºè¢«å”¤é†’ï¼ŒæŠŠæ•°æ®åŒ…è¯»å…¥å†…å­˜ã€‚</li>
<li>å†…æ ¸ä¸ºè¿™ä¸ªåŒ…åˆ†é…ä¸€ä¸ª<strong>æå…¶å¤æ‚ä¸”æ˜‚è´µ</strong>çš„æ•°æ®ç»“æ„ï¼Œå«åš <code>sk_buff</code> (Socket Buffer)ã€‚</li>
<li>è¿™ä¸ª <code>sk_buff</code> æ¥ç€å¼€å§‹å®ƒåœ¨å†…æ ¸ç½‘ç»œåè®®æ ˆä¸­çš„â€œæ¼«é•¿æ—…è¡Œâ€ï¼šç»è¿‡ IP å±‚ã€TCP/UDP å±‚ã€<code>iptables</code> é˜²ç«å¢™è§„åˆ™â€¦â€¦</li>
<li>æœ€åï¼Œæ•°æ®åŒ…ç»ˆäºè¢«é€è¾¾ä½ çš„åº”ç”¨ç¨‹åºï¼ˆæ¯”å¦‚ Nginxï¼‰ã€‚</li>
</ol>
<p>è¿™ä¸ªè¿‡ç¨‹è™½ç„¶åŠŸèƒ½é½å…¨ï¼Œä½†å¯¹äºæŸäº›åœºæ™¯æ¥è¯´<strong>å¤ªæ…¢äº†</strong>ã€‚</p>
<p><strong><code>sk_buff</code> åˆ†é… (å…³é”®å¼€é”€ç‚¹ï¼)</strong> ï¼šé©±åŠ¨ç¨‹åºåœ¨å†…æ ¸ä¸­åˆ†é…ä¸€ä¸ªæ ¸å¿ƒæ•°æ®ç»“æ„ <code>struct sk_buff</code> (socket buffer)ã€‚è¿™<strong>éå¸¸æ˜‚è´µ</strong>ï¼Œå› ä¸ºå®ƒæ¶‰åŠå†…å­˜åˆ†é…ã€ç¼“å­˜è¡Œæ±¡æŸ“ï¼Œå¹¶ä¸”è¿™ä¸ªç»“æ„ä½“éå¸¸åºå¤§ï¼ˆå‡ ç™¾ä¸ªå­—èŠ‚ï¼‰ï¼Œç”¨æ¥è·Ÿè¸ªæ•°æ®åŒ…çš„â€œä¸€ç”Ÿâ€ã€‚</p>
<h3 data-id="heading-2">XDP çš„â€œé«˜é€Ÿå…¬è·¯å…¥å£â€</h3>
<p>XDP å½»åº•æ”¹å˜äº†æ¸¸æˆè§„åˆ™ã€‚å®ƒå…è®¸ä½ çš„ eBPF ç¨‹åºåœ¨<strong>ç¬¬ 2 æ­¥</strong>ï¼Œå³<strong>ç½‘å¡é©±åŠ¨åˆšæŠŠæ•°æ®åŒ…è¯»è¿›æ¥ï¼Œä½†è¿˜æ²¡æœ‰åˆ›å»ºæ˜‚è´µçš„ <code>sk_buff</code> ä¹‹å‰</strong>ï¼Œå°±ç«‹å³æ‰§è¡Œã€‚</p>
<p>è¿™å°±åƒåœ¨æœºåœºçš„<strong>èˆªç«™æ¥¼å¤§é—¨å£</strong>è®¾ç½®äº†ä¸€ä¸ªå®‰æ£€ç‚¹ï¼Œè€Œä¸æ˜¯åœ¨ç™»æœºå£ã€‚</p>
<p>åœ¨è¿™ä¸ªè¶…æ—©çš„â€œå®‰æ£€ç‚¹â€ï¼Œä½ çš„ XDP ç¨‹åºæƒåŠ›å¾ˆå¤§ï¼Œä½†ä¹Ÿå¾ˆç®€å•ã€‚å®ƒå¿…é¡»ç«‹å³åšå‡ºå†³å®šï¼Œè¿”å›ä»¥ä¸‹å‡ ç§â€œè£å†³â€ä¹‹ä¸€ï¼š</p>
<ul>
<li><strong><code>XDP_DROP</code> (ä¸¢å¼ƒ)</strong>
<ul>
<li><strong>å«ä¹‰</strong>ï¼šâ€œè¿™ä¸ªåŒ…æœ‰é—®é¢˜ï¼ŒåŸåœ°ä¸¢å¼ƒã€‚â€</li>
<li><strong>ç”¨é€”</strong>ï¼š<strong>DDoS é˜²å¾¡å’Œé˜²ç«å¢™çš„ç»ˆææ­¦å™¨</strong>ã€‚ç”±äºå®ƒåœ¨å†…æ ¸åˆ†é…ä»»ä½•æ˜‚è´µèµ„æºä¹‹å‰å°±ä¸¢å¼ƒäº†æ•°æ®åŒ…ï¼Œç³»ç»Ÿå‡ ä¹ä¸èŠ±æˆæœ¬å°±èƒ½æŠµå¾¡æ´ªæ°´èˆ¬çš„æ”»å‡»ã€‚</li>
</ul>
</li>
<li><strong><code>XDP_PASS</code> (é€šè¿‡)</strong>
<ul>
<li><strong>å«ä¹‰</strong>ï¼šâ€œæˆ‘æ£€æŸ¥è¿‡äº†ï¼Œè¿™ä¸ªåŒ…æ˜¯åˆæ³•çš„ï¼Œè¯·ç»§ç»­èµ°â€˜å¸¸è§„æ—…ç¨‹â€™ï¼ˆäº¤ç»™ç¬¬ 3 æ­¥çš„å†…æ ¸åè®®æ ˆï¼‰ã€‚â€</li>
<li><strong>ç”¨é€”</strong>ï¼šç”¨äºç›‘æ§æˆ–åªè¿‡æ»¤ç‰¹å®šæµé‡ã€‚</li>
</ul>
</li>
<li><strong><code>XDP_TX</code> (å‘é€)</strong>
<ul>
<li><strong>å«ä¹‰</strong>ï¼šâ€œä¸ç”¨è¿›å†…æ ¸äº†ï¼Œï¼ˆå¯èƒ½ä¿®æ”¹ä¸€ä¸‹åŒ…å¤´ï¼‰ç›´æ¥ä»ä½ è¿›æ¥çš„è¿™ä¸ªç½‘å¡å†å‘å‡ºå»ã€‚â€</li>
<li><strong>ç”¨é€”</strong>ï¼šL4 è´Ÿè½½å‡è¡¡ï¼ˆä¾‹å¦‚ Facebook çš„ Katranï¼‰ã€‚</li>
</ul>
</li>
<li><strong><code>XDP_REDIRECT</code> (é‡å®šå‘)</strong>
<ul>
<li><strong>å«ä¹‰</strong>ï¼šâ€œæŠŠè¿™ä¸ªåŒ…è½¬å‘åˆ°å¦ä¸€ä¸ªç½‘å¡ï¼Œæˆ–å¦ä¸€ä¸ª CPU æ ¸å¿ƒã€‚â€</li>
<li><strong>ç”¨é€”</strong>ï¼šå®ç°é«˜æ€§èƒ½çš„è™šæ‹Ÿäº¤æ¢æœºå’Œè·¯ç”±å™¨ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3">XDP vs TC-eBPF</h3>
<p>XDP å¹¶ä¸æ˜¯ eBPF åœ¨ç½‘ç»œä¸­å”¯ä¸€çš„æŒ‚è½½ç‚¹ã€‚å®ƒçš„â€œå…„å¼Ÿâ€æ˜¯ <strong>TC (Traffic Control) eBPF</strong>ã€‚</p>








































<table><thead><tr><th>ç‰¹æ€§</th><th><strong>XDP (eXpress Data Path)</strong></th><th><strong>TC-eBPF (Traffic Control)</strong></th></tr></thead><tbody><tr><td><strong>æŒ‚è½½ç‚¹</strong></td><td>ç½‘å¡é©±åŠ¨ç¨‹åº (æˆ–ç¡¬ä»¶)</td><td>å†…æ ¸çš„ TC å­ç³»ç»Ÿ (åè®®æ ˆå†…éƒ¨)</td></tr><tr><td><strong>æ•°æ®ç»“æ„</strong></td><td><code>struct xdp_md</code> (åŸå§‹æ•°æ®åŒ…)</td><td><code>struct __sk_buff</code> (å®Œæ•´çš„ sk_buff)</td></tr><tr><td><strong>è¿è¡Œå‰æ</strong></td><td><strong><code>sk_buff</code> åˆ†é…å‰</strong></td><td><strong><code>sk_buff</code> åˆ†é…å</strong></td></tr><tr><td><strong>ä¸»è¦æ–¹å‘</strong></td><td><strong>Ingress (å…¥å£)</strong></td><td>Ingress (å…¥å£) å’Œ <strong>Egress (å‡ºå£)</strong></td></tr><tr><td><strong>æ€§èƒ½</strong></td><td><strong>æè‡´æ€§èƒ½</strong> (æ¯ç§’æ•°åƒä¸‡åŒ…)</td><td>é«˜æ€§èƒ½ (ä½†ä½äº XDP)</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>DDoS é˜²å¾¡, L4 è´Ÿè½½å‡è¡¡, é‡‡æ ·</td><td>å®¹å™¨ç½‘ç»œ (Cilium CNI), ç²¾ç»†çš„ç­–ç•¥æ§åˆ¶, å¸¦å®½æ•´å½¢</td></tr></tbody></table>
<p><strong>ç®€å•ç±»æ¯”</strong>ï¼š</p>
<ul>
<li><strong>XDP</strong> æ˜¯ä½ å¤§æ¥¼çš„<strong>æ€»é—¨ç¦</strong>ã€‚å®ƒåªèƒ½åœ¨å¤§æ¥¼å…¥å£æ£€æŸ¥ï¼ˆIngressï¼‰ï¼Œä½†é€Ÿåº¦æœ€å¿«ï¼Œå¯ä»¥åœ¨åäººè¿›å…¥å¤§å ‚å‰å°±å°†å…¶æ‹¦ä¸‹ã€‚</li>
<li><strong>TC</strong> æ˜¯ä½ <strong>ç”µæ¢¯å£</strong>çš„å®‰ä¿ã€‚å®ƒæ—¢èƒ½ç®¡è¿›ï¼ˆIngressï¼‰ï¼Œä¹Ÿèƒ½ç®¡å‡ºï¼ˆEgressï¼‰ã€‚å®ƒèƒ½çœ‹åˆ°æ›´ä¸°å¯Œçš„ä¿¡æ¯ï¼ˆ<code>sk_buff</code>ï¼Œæ¯”å¦‚è¿™ä¸ªäººè¦å»å‡ æ¥¼ï¼‰ï¼Œä½†å®ƒå·²ç»åœ¨å¤§å ‚é‡Œäº†ã€‚</li>
</ul>
<blockquote>
<p><strong>XDP å°ç»“ï¼š</strong> XDP æ˜¯ä¸€ä¸ª<strong>è¿è¡Œåœ°ç‚¹</strong>ã€‚å®ƒæ˜¯å†…æ ¸ä¸­æœ€æ—©ã€æœ€å¿«çš„æ•°æ®åŒ…å¤„ç†æŒ‚è½½ç‚¹ï¼Œé€šè¿‡åœ¨ç½‘ç»œåè®®æ ˆâ€œå…¥å£å¤„â€æ‰§è¡Œä»£ç ï¼Œå®ç°äº†æ— ä¸ä¼¦æ¯”çš„ç½‘ç»œæ€§èƒ½ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">ğŸ”¥ JITï¼šæŠŠâ€œé€šç”¨è“å›¾â€å˜æˆâ€œF1 å¼•æ“â€</h2>
<p>è¦ç†è§£ JITï¼Œæˆ‘ä»¬å¿…é¡»å…ˆçœ‹çœ‹ eBPF ç¨‹åºæ˜¯å¦‚ä½•è¢«åŠ è½½åˆ°å†…æ ¸çš„ï¼š</p>
<ol>
<li>
<p><strong>ç¬¬ 1 æ¬¡ç¼–è¯‘ï¼ˆåœ¨ç”¨æˆ·ç©ºé—´ï¼‰</strong>ï¼š</p>
<ul>
<li>ä½ ç”¨ C è¯­è¨€ç¼–å†™ eBPF ç¨‹åºã€‚</li>
<li>ä½¿ç”¨ <code>clang</code> (LLVM) ç¼–è¯‘å™¨ï¼Œå°† C ä»£ç ç¼–è¯‘æˆä¸€ç§<strong>é€šç”¨çš„ã€ä¸ CPU æ¶æ„æ— å…³çš„</strong>â€œeBPF å­—èŠ‚ç â€ã€‚</li>
<li>è¿™å¾ˆåƒ Java è¢«ç¼–è¯‘æˆé€šç”¨çš„ <code>.class</code> å­—èŠ‚ç ã€‚</li>
</ul>
</li>
<li>
<p><strong>åŠ è½½ä¸éªŒè¯</strong>ï¼š</p>
<ul>
<li>ä½ çš„ Python/Go/C++ ç¨‹åºï¼ˆä¾‹å¦‚ <code>bcc</code> è„šæœ¬ï¼‰è¯»å–è¿™äº›å­—èŠ‚ç ï¼Œå¹¶å°†å…¶åŠ è½½åˆ°å†…æ ¸ä¸­ã€‚</li>
<li>å†…æ ¸çš„<strong>æ ¡éªŒå™¨ (Verifier)</strong> ä¼šå¯¹å­—èŠ‚ç è¿›è¡Œä¸¥æ ¼çš„å®‰å…¨å®¡æŸ¥ï¼Œ<strong>è¯æ˜</strong>ä½ çš„ä»£ç æ˜¯å®‰å…¨çš„ï¼ˆæ¯”å¦‚ä¸ä¼šå¯¼è‡´å†…æ ¸å´©æºƒã€ä¸ä¼šæœ‰æ— é™å¾ªç¯ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>é¢ä¸´é€‰æ‹©</strong>ï¼š</p>
<ul>
<li><strong>é€‰é¡¹ A (è§£é‡Šæ‰§è¡Œ)</strong> ï¼šåƒä¸€ä¸ªç¿»è¯‘å®˜ï¼Œä¸€è¡Œä¸€è¡Œåœ°è¯»å– eBPF å­—èŠ‚ç ï¼Œç„¶åæ‰§è¡Œå¯¹åº”çš„æ“ä½œã€‚<strong>è¿™å¾ˆå®‰å…¨ï¼Œä½†å¾ˆæ…¢ã€‚</strong></li>
<li><strong>é€‰é¡¹</strong> <strong>B (JIT</strong> <strong>ç¼–è¯‘</strong> <strong>)</strong> ï¼š<strong>è¿™æ˜¯</strong> <strong>Linux</strong> <strong>å†…æ ¸çš„é»˜è®¤é€‰é¡¹</strong>ã€‚å†…æ ¸è°ƒç”¨å®ƒçš„ <strong>JIT</strong> <strong>ç¼–è¯‘å™¨</strong>ï¼Œå°†æ•´ä¸ª eBPF å­—èŠ‚ç ç¨‹åº<strong>ä¸€æ¬¡æ€§</strong>ç¿»è¯‘æˆä½ çš„ CPU (æ¯”å¦‚ x86_64 æˆ– arm64) <strong>å¯ä»¥ç›´æ¥æ‰§è¡Œçš„åŸç”Ÿæœºå™¨æŒ‡ä»¤</strong>ã€‚</li>
</ul>
</li>
</ol>
<p>OK,ä¾‹å­é€‰æ‹©ä½¿ç”¨<strong>JITç¼–è¯‘</strong>.</p>
<ol start="4">
<li><strong>ç¬¬ 2 æ¬¡ç¼–è¯‘ï¼ˆåœ¨å†…æ ¸ç©ºé—´ï¼ŒJIT ç™»åœºï¼ï¼‰</strong>ï¼š
<ul>
<li>å®‰å…¨æ ¡éªŒé€šè¿‡åï¼Œå†…æ ¸çš„ <strong>JIT ç¼–è¯‘å™¨</strong>å¯åŠ¨ã€‚</li>
<li>å®ƒä¼šæŠŠè¿™äº›<strong>é€šç”¨çš„ eBPF å­—èŠ‚ç </strong>ï¼Œâ€œå³æ—¶â€ç¿»è¯‘æˆä½ å½“å‰ CPUï¼ˆæ¯”å¦‚ <code>x86_64</code> æˆ– <code>arm64</code>ï¼‰<strong>å¯ä»¥ç›´æ¥æ‰§è¡Œçš„åŸç”Ÿæœºå™¨æŒ‡ä»¤</strong>ã€‚</li>
</ul>
</li>
</ol>
<h3 data-id="heading-5">ä¸ºä»€ä¹ˆ JIT å¦‚æ­¤é‡è¦ï¼Ÿ</h3>
<p>å¦‚æœæ²¡æœ‰ JITï¼Œå†…æ ¸å°±å¿…é¡»ä½¿ç”¨â€œè§£é‡Šå™¨â€ï¼ˆInterpreterï¼‰æ¥è¿è¡Œä½ çš„ eBPF å­—èŠ‚ç ã€‚</p>
<ul>
<li><strong>è§£é‡Šå™¨ï¼ˆæ…¢ï¼‰</strong>ï¼šå°±åƒä¸€ä¸ªç¿»è¯‘å®˜ï¼Œé€è¡Œè¯»å– eBPF å­—èŠ‚ç ï¼ˆâ€œé€šç”¨è“å›¾â€ï¼‰ï¼Œç„¶åå‘Šè¯‰ CPU è¯¥æ€ä¹ˆåšã€‚æ¯è¿è¡Œä¸€æ¬¡å°±è¦â€œç¿»è¯‘â€ä¸€æ¬¡ã€‚</li>
<li><strong>JITï¼ˆå¿«ï¼‰</strong>ï¼šå°±åƒä¸€ä¸ªé¡¶å°–å·¥ç¨‹å¸ˆï¼ŒæŠŠâ€œé€šç”¨è“å›¾â€å½»åº•æ”¹é€ æˆäº†ä¸ºä½ çš„ CPU é‡èº«å®šåšçš„â€œF1 å¼•æ“â€ï¼ˆåŸç”Ÿæœºå™¨ç ï¼‰ã€‚ä¹‹åæ¯æ¬¡è¿è¡Œï¼ŒCPU éƒ½èƒ½ç›´æ¥ç†è§£ï¼Œæ²¡æœ‰ä»»ä½•ç¿»è¯‘å¼€é”€ã€‚</li>
</ul>
<blockquote>
<p><strong>JIT å°ç»“ï¼š</strong> JIT æ˜¯ä¸€ç§<strong>è¿è¡Œæ–¹å¼</strong>ã€‚å®ƒå°† eBPF çš„â€œå¯ç§»æ¤æ€§â€å’Œâ€œå®‰å…¨æ€§â€ï¼ˆæ¥è‡ªå­—èŠ‚ç ï¼‰ä¸â€œåŸç”Ÿæ€§èƒ½â€ï¼ˆæ¥è‡ªæœºå™¨ç ï¼‰å®Œç¾ç»“åˆã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-6">ç»ˆæç»„åˆï¼šXDP + JIT = æ€§èƒ½æ€ªå…½</h2>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸¤ä¸ªæ¦‚å¿µæ‹¼åœ¨ä¸€èµ·ï¼š</p>
<ol>
<li>ä½ å†™äº†ä¸€ä¸ªç”¨äº DDoS é˜²å¾¡çš„ <strong>XDP</strong> ç¨‹åºã€‚</li>
<li>ä½ åŠ è½½å®ƒï¼Œå†…æ ¸æ ¡éªŒé€šè¿‡åï¼Œ<strong>JIT</strong> ç¼–è¯‘å™¨ä»‹å…¥ï¼ŒæŠŠå®ƒç¼–è¯‘æˆäº†ä½ æœåŠ¡å™¨ CPU çš„<strong>åŸç”Ÿæœºå™¨ç </strong>ã€‚</li>
<li>å†…æ ¸å°†è¿™æ®µ<strong>åŸç”Ÿæœºå™¨ç </strong>æŒ‚è½½åˆ°äº†ç½‘å¡é©±åŠ¨çš„ <strong>XDP</strong> æŒ‚è½½ç‚¹ä¸Šã€‚</li>
</ol>
<p><strong>ç»“æœå°±æ˜¯ï¼š</strong> å½“ä¸€ä¸ªç½‘ç»œåŒ…åˆ°è¾¾ç½‘å¡æ—¶ï¼Œä½ çš„ CPU ä¼šä»¥<strong>æœ€å¿«çš„åŸç”Ÿé€Ÿåº¦ï¼ˆJITï¼‰</strong>ï¼Œåœ¨<strong>æœ€æ—©çš„å†…æ ¸ä½ç½®ï¼ˆXDPï¼‰</strong>ï¼Œå¯¹è¿™ä¸ªåŒ…æ‰§è¡Œä½ çš„é€»è¾‘ã€‚</p>
<p>è¿™å°±æ˜¯ eBPF èƒ½ä»¥æ¯ç§’æ•°åƒä¸‡æ•°æ®åŒ…ï¼ˆMppsï¼‰çš„é€Ÿåº¦å¤„ç†æµé‡ï¼ŒåŒæ—¶ä¿æŒç³»ç»Ÿå®‰å…¨å’Œå¯ç¼–ç¨‹æ€§çš„åŸå› ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½¿ç”¨ Ollama æœ¬åœ°æ¨¡å‹ä¸ Spring AI Alibaba]]></title>    <link>https://juejin.cn/post/7572453554331451392</link>    <guid>https://juejin.cn/post/7572453554331451392</guid>    <pubDate>2025-11-15T07:33:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572453554331451392" data-draft-id="7572453554330894336" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½¿ç”¨ Ollama æœ¬åœ°æ¨¡å‹ä¸ Spring AI Alibaba"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-15T07:33:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§è±¡å¸­åœ°æŠ½çƒŸ"/> <meta itemprop="url" content="https://juejin.cn/user/3104676567599207"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½¿ç”¨ Ollama æœ¬åœ°æ¨¡å‹ä¸ Spring AI Alibaba
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3104676567599207/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§è±¡å¸­åœ°æŠ½çƒŸ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T07:33:02.000Z" title="Sat Nov 15 2025 07:33:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://juejin.cn/post/7570271574348152841" target="_blank" title="https://juejin.cn/post/7570271574348152841">Spring AI RAG ä½“éªŒé¡¹ç›®</a>ä¸­ä½¿ç”¨çš„æ˜¯é˜¿é‡Œäº‘çš„æ¨¡å‹ï¼ŒåµŒå…¥ã€æ¨ç†å’Œæ’åºè¦è°ƒç”¨é˜¿é‡Œäº‘çš„æœåŠ¡ã€‚æœ¬ä¾‹å°è¯•æœ¬åœ°æ­å»ºollamaï¼Œè·‘ä¸€äº›å¼€æºçš„æ¨¡å‹ã€‚</p>
<p>ollamaå·ç§°å¤§æ¨¡å‹é¢†åŸŸçš„dockerã€‚ç”¨æ¥åšéªŒè¯æˆ–è€…è·‘ä¸€äº›ç»è¿‡è’¸é¦/é‡åŒ–çš„è½»é‡æ¨¡å‹ã€æ­å»ºé—®ç­”æœºå™¨äººçŸ¥è¯†åº“ï¼Œå¤Ÿç”¨äº†ã€‚</p>
<p>æ•´ä½“æ­¥éª¤æ˜¯ï¼šï¼ˆ1ï¼‰å®‰è£…ollamaï¼Œç›¸å½“äºå®‰è£…docker ï¼ˆ2ï¼‰ollamaä¸­æ‹‰å–æ¨¡å‹ï¼Œç›¸å½“äºdockeræ‹‰å–é•œåƒè¿›è¡Œå¹¶è¿è¡Œ ï¼ˆ3ï¼‰éªŒè¯ollamaä¸­çš„æ¨¡å‹ï¼ˆ4ï¼‰å†™ä¸€ä¸ªspring aiåº”ç”¨ï¼Œè¯¥åº”ç”¨è°ƒç”¨ollamaä¸­è·‘çš„æ¨¡å‹ã€‚</p>
<p>æœ¬ä¾‹ä»£ç  <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzhouruibest%2Follama-rag1" target="_blank" title="https://github.com/zhouruibest/ollama-rag1" ref="nofollow noopener noreferrer">github.com/zhouruibestâ€¦</a></p>
<h2 data-id="heading-0">1. å®‰è£…ollama</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Follama.com%2F" target="_blank" title="https://ollama.com/" ref="nofollow noopener noreferrer">ollama</a>è¢«è®¾è®¡ç”¨æ¥å•æœºè¿è¡Œçš„ã€‚å¯ä»¥ç”¨åˆ°Windowä¸Šçš„æ˜¾å¡ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/039a48af52304f639dbb27b17b869b89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6LGh5bit5Zyw5oq954Of:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763796782&amp;x-signature=rndutIDSoNdCcQE4%2BA3ungEAZkY%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">2. æ‹‰å–æ¨¡å‹</h2>
<p>windows powershellä¸­</p>
<pre><code class="hljs language-sh" lang="sh">ollama pull deepseek-r1:8b
ollamaÂ pullÂ nomic-embed-text:latest
</code></pre>
<h2 data-id="heading-2">3. éªŒè¯</h2>
<p>ollamaé»˜è®¤ç›‘å¬æœ¬åœ°11434ç«¯å£ï¼Œspring aiåº”ç”¨å°±æ˜¯è®¿é—®è¿™ä¸ªåœ°å€ã€‚ç”¨curlæµ‹ä¸€ä¸‹ï¼š</p>
<pre><code class="hljs language-sh" lang="sh">curl http://localhost:11434/api/generate -d <span class="hljs-string">'{
  "model": "deepseek-r1:8b",
  "prompt": "è¯·ä»‹ç»ä¸€ä¸‹AIçš„å‘å±•å†å²"
}'</span>


curl http://localhost:11434/api/embed -d <span class="hljs-string">'{
  "model": "nomic-embed-text:latest",
  "input": "è¿™æ˜¯ä¸€æ®µéœ€è¦è½¬æ¢ä¸ºå‘é‡çš„æ–‡æœ¬"
}'</span>
</code></pre>
<p>å‘½ä»¤è¡Œä¸­æ˜¾ç¤ºä¸å‹å¥½ã€‚ä¹Ÿå¯ä»¥ç”¨Open-WebUIï¼ˆweb é¡µé¢å·¥å…·ï¼Œé•œåƒæ˜¯ ghcr.io/open-webui/open-webui:mainï¼‰ ï¼Œåœ¨é¡µé¢éªŒè¯ã€‚ è¿™é‡Œç”¨äº†å®ƒçš„å›½å†…çš„é•œåƒã€‚æ¨èä¸€ä¸ªé•œåƒåŒæ­¥ç½‘ç«™ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocker.aityp.com%2F%25E3%2580%2582" target="_blank" title="https://docker.aityp.com/%E3%80%82" ref="nofollow noopener noreferrer">docker.aityp.com/ã€‚</a></p>
<pre><code class="hljs language-bash" lang="bash">docker run -d -p 3000:8080 \
  --add-host=host.docker.internal:host-gateway \
  -e OLLAMA_BASE_URL=http://host.docker.internal:11434 \  <span class="hljs-comment"># æŒ‡å®šäº†ollamaçš„æœåŠ¡åœ°å€</span>
  swr.cn-north-4.myhuaweicloud.com/ddn-k8s/ghcr.io/open-webui/open-webui:main
</code></pre>
<h2 data-id="heading-3">4. spring ai åº”ç”¨</h2>
<p>æœ¬ä¾‹æ˜¯åœ¨ <a href="https://juejin.cn/post/7570271574348152841" target="_blank" title="https://juejin.cn/post/7570271574348152841">Spring AI RAG ä½“éªŒé¡¹ç›®</a> çš„åŸºç¡€ä¸Šæ”¹çš„ã€‚</p>
<h3 data-id="heading-4">é…ç½®</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">handbook</span>
  <span class="hljs-attr">autoconfigure:</span>
    <span class="hljs-attr">exclude:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">org.springframework.ai.autoconfigure.vectorstore.milvus.MilvusVectorStoreAutoConfiguration</span>
  <span class="hljs-attr">ai:</span>
    <span class="hljs-attr">dashscope:</span>
      <span class="hljs-attr">api-key:</span> <span class="hljs-string">${MY_APP_API_KEY}</span>        <span class="hljs-comment"># é¡¹ç›®ä¸­è¿˜æœ‰ spring-ai-alibaba-starterå¯åŠ¨å™¨ï¼Œæ–¹ä¾¿åˆ‡å›å»</span>
    <span class="hljs-attr">ollama:</span>
      <span class="hljs-attr">base-url:</span> <span class="hljs-string">http://localhost:11434</span>  <span class="hljs-comment"># Ollama æœåŠ¡åœ°å€ï¼Œé»˜è®¤æ˜¯è¿™ä¸ªç«¯å£å·</span>
      <span class="hljs-attr">chat:</span>
        <span class="hljs-attr">model:</span> <span class="hljs-string">deepseek-r1:8b</span>           <span class="hljs-comment"># æŒ‡å®šè¦ä½¿ç”¨çš„æ¨ç†æ¨¡å‹ï¼Œè¿™ä¸ª3060Tiè¿˜èƒ½è·‘èµ·æ¥</span>
      <span class="hljs-attr">embedding:</span>
        <span class="hljs-attr">model:</span> <span class="hljs-string">nomic-embed-text:latest</span>  <span class="hljs-comment"># æ–‡æœ¬åµŒå…¥æ¨¡å‹ï¼Œç»´åº¦768</span>

<span class="hljs-attr">initKnowledge:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># æ˜¯å¦åˆå§‹åŒ–åˆ°å‘é‡æ•°æ®åº“ã€‚åªè¿è¡Œå›æ¬¡å°±è¡Œ</span>
<span class="hljs-attr">milvus:</span>
  <span class="hljs-attr">host:</span> <span class="hljs-string">mydevcvm</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">19530</span>
  <span class="hljs-attr">token:</span> <span class="hljs-string">"root:Milvus"</span>
  <span class="hljs-attr">database:</span> <span class="hljs-string">"default"</span> <span class="hljs-comment"># ä½¿ç”¨é»˜è®¤çš„</span>
  <span class="hljs-attr">collection:</span> <span class="hljs-string">"ollamarag1"</span>
  <span class="hljs-attr">initializeSchema:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># milvusä¸­çš„databaseè¦å…ˆåˆ›å»ºå¥½ã€‚collectionå¯ä»¥ä¸ç”¨åˆ›å»ºï¼›è¿™ä¸ªå­—æ®µç¬¬ä¸€æ¬¡ä¸ºtrueï¼Œä»¥åè¿è¡Œä¸ºfalse</span>
</code></pre>
<h3 data-id="heading-5">å‘é‡æ•°æ®åº“</h3>
<p><code>nomic-embed-text:latest</code>Â çš„å‘é‡ç»´åº¦æ˜¯<strong>768</strong>è€Œé 1536</p>
<p>ä¸ºäº†æ–¹ä¾¿æ”¹å›å»ï¼Œé¡¹ç›®è¿˜å¼•å…¥äº† spring-ai-alibaba-starterå¯åŠ¨å™¨ å’Œç›¸å…³çš„é…ç½®ã€‚å› æ­¤ä¼šæœ‰ä¸¤ä¸ªChat Modelå’ŒEmbedding Modelï¼Œæ‰€ä»¥è¦ç”¨ <code>@Qualifier("ollamaEmbeddingModel")</code>å’Œ <code>@Qualifier("ollamaChatModel")</code>æŒ‡å®šä¸€ä¸‹ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// VectorStoreConfig.java</span>
<span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> VectorStore <span class="hljs-title function_">vectorStore</span><span class="hljs-params">(MilvusServiceClient milvusClient, <span class="hljs-meta">@Qualifier("ollamaEmbeddingModel")</span> EmbeddingModel embeddingModel)</span> {
    <span class="hljs-keyword">return</span> MilvusVectorStore.builder(milvusClient, embeddingModel) <span class="hljs-comment">//  åµŒå…¥æ¨¡å‹å®ä¾‹ï¼Œç”¨äºå°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡è¡¨ç¤º</span>
            .collectionName(collection).databaseName(database).embeddingDimension(<span class="hljs-number">768</span>) 
            .indexType(IndexType.IVF_FLAT) <span class="hljs-comment">// è®¾ç½®ä¸ºIVF_FLATï¼ˆå€’æ’æ–‡ä»¶Flatç´¢å¼•ï¼‰ï¼Œæ˜¯ä¸€ç§å¸¸ç”¨çš„è¿‘ä¼¼æœ€è¿‘é‚»æœç´¢ç´¢å¼•</span>
            .metricType(MetricType.COSINE).batchingStrategy(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TokenCountBatchingStrategy</span>()).initializeSchema(initializeSchema).build();
    }
</code></pre>
<h3 data-id="heading-6">åµŒå…¥å¹¶å­˜å‚¨å‘é‡æ•°æ®åº“</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// KnowledgeInitializer.java</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KnowledgeInitializer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ApplicationRunner</span> {
    <span class="hljs-meta">@Value("${initKnowledge}")</span>
    <span class="hljs-keyword">private</span> Boolean initKnowledge;

    <span class="hljs-meta">@Value("classpath:/docs/handbook.pdf")</span>
    <span class="hljs-keyword">private</span> Resource springAiResource;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> VectorStore vectorStore;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(KnowledgeInitializer.class);

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(ApplicationArguments args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">if</span> (!initKnowledge) {
            logger.info(<span class="hljs-string">"initKnowledge is false, skip init"</span>);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// 1. parse document</span>
        <span class="hljs-type">DocumentReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PagePdfDocumentReader</span>(springAiResource);
        List&lt;Document&gt; documents = reader.get();
        logger.info(<span class="hljs-string">"{} documents loaded"</span>, documents.size());

        <span class="hljs-comment">// 2. split trunks</span>
        List&lt;Document&gt; splitDocuments = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TokenTextSplitter</span>().apply(documents);
        logger.info(<span class="hljs-string">"{} documents split"</span>, splitDocuments.size());

        <span class="hljs-comment">// 3. create embedding and store to vector store</span>
        logger.info(<span class="hljs-string">"create embedding and save to vector store"</span>);
        vectorStore.add(splitDocuments);

    }
}
</code></pre>
<h3 data-id="heading-7">rag service</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// AIRagService</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AIRagService</span> {
    <span class="hljs-comment">// å¼•å…¥ system prompt tmpl</span>
    <span class="hljs-meta">@Value("classpath:/docs/system-qa.st")</span>
    <span class="hljs-keyword">private</span> Resource systemResource;

    <span class="hljs-comment">// æ³¨å…¥ç›¸å…³ bean å®ä¾‹</span>
    <span class="hljs-meta">@Qualifier("ollamaChatModel")</span>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ChatModel ragChatModel;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> VectorStore vectorStore;

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getPromptTemplate</span><span class="hljs-params">(Resource systemResource)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> systemResource.getContentAsString(StandardCharsets.UTF_8);
        } <span class="hljs-keyword">catch</span> (IOException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);
        }
    }

    <span class="hljs-comment">// æ–‡æœ¬è¿‡æ»¤ï¼Œå¢å¼ºå‘é‡æ£€ç´¢ç²¾åº¦    private static final String textField = "content";</span>
    <span class="hljs-comment">// ......</span>
    <span class="hljs-keyword">public</span> Flux&lt;String&gt; <span class="hljs-title function_">retrieve</span><span class="hljs-params">(String prompt)</span> {
        <span class="hljs-comment">// åŠ è½½ prompt tmpl</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">promptTemplate</span> <span class="hljs-operator">=</span> getPromptTemplate(systemResource);
        <span class="hljs-comment">// å¯ç”¨æ··åˆæœç´¢ï¼ŒåŒ…æ‹¬åµŒå…¥å’Œå…¨æ–‡æœç´¢</span>
        <span class="hljs-type">SearchRequest</span> <span class="hljs-variable">searchRequest</span> <span class="hljs-operator">=</span> SearchRequest.builder().topK(<span class="hljs-number">4</span>).similarityThresholdAll().build();
        <span class="hljs-comment">// build chatClientï¼Œå‘èµ·å¤§æ¨¡å‹æœåŠ¡è°ƒç”¨ã€‚</span>
        <span class="hljs-keyword">return</span> ChatClient.builder(ragChatModel).build().prompt().advisors(<span class="hljs-keyword">new</span> <span class="hljs-title class_">QuestionAnswerAdvisor</span>(vectorStore, searchRequest, promptTemplate)).user(prompt).stream().content();
    }
}
</code></pre>
<h3 data-id="heading-8">è®¿é—®éªŒè¯</h3>
<p>æµè§ˆå™¨åœ°å€æ è¾“å…¥ï¼š<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8080%2Frag%2F%3Fmessage%3D%25E7%258E%25B0%25E5%259C%25A8%25E6%2588%2591%25E4%25BB%25AC%25E8%25BA%25AB%25E8%25BE%25B9%25E4%25B8%2580%25E4%25BA%259B%25E8%2580%2581%25E5%25B9%25B4%25E4%25BA%25BA%25E6%2584%259F%25E6%259F%2593%25E5%2590%258E%25E7%2597%2585%25E6%2583%2585%25E5%25B0%25B1%25E5%25BE%2588%25E9%2587%258D%25EF%25BC%258C%25E9%2582%25A3%25E6%2598%25AF%25E4%25B8%258D%25E6%2598%25AF%25E8%2580%2581%25E5%25B9%25B4%25E4%25BA%25BA%25E6%2584%259F%25E6%259F%2593%25E5%2590%258E%25E4%25B8%2580%25E5%25AE%259A%25E4%25BC%259A%25E8%25B5%25B0%25E5%2590%2591%25E9%2587%258D%25E7%2597%2587%25E5%2592%258C%25E5%258D%25B1%25E9%2587%258D%25E7%2597%2587" target="_blank" title="http://localhost:8080/rag/?message=%E7%8E%B0%E5%9C%A8%E6%88%91%E4%BB%AC%E8%BA%AB%E8%BE%B9%E4%B8%80%E4%BA%9B%E8%80%81%E5%B9%B4%E4%BA%BA%E6%84%9F%E6%9F%93%E5%90%8E%E7%97%85%E6%83%85%E5%B0%B1%E5%BE%88%E9%87%8D%EF%BC%8C%E9%82%A3%E6%98%AF%E4%B8%8D%E6%98%AF%E8%80%81%E5%B9%B4%E4%BA%BA%E6%84%9F%E6%9F%93%E5%90%8E%E4%B8%80%E5%AE%9A%E4%BC%9A%E8%B5%B0%E5%90%91%E9%87%8D%E7%97%87%E5%92%8C%E5%8D%B1%E9%87%8D%E7%97%87" ref="nofollow noopener noreferrer">http://localhost:8080/rag/?message=ç°åœ¨æˆ‘ä»¬èº«è¾¹ä¸€äº›è€å¹´äººæ„ŸæŸ“åç—…æƒ…å°±å¾ˆé‡ï¼Œé‚£æ˜¯ä¸æ˜¯è€å¹´äººæ„ŸæŸ“åä¸€å®šä¼šèµ°å‘é‡ç—‡å’Œå±é‡ç—‡</a></p>
<pre><code class="hljs language-markdown" lang="markdown">è¿™æ˜¯ä¸€ä¸ªéå¸¸å…³å¿ƒçš„é—®é¢˜ï¼Œä½†ç­”æ¡ˆ<span class="hljs-strong">**å¹¶ä¸ç®€å•ï¼Œä¹Ÿä¸æ˜¯ç»å¯¹çš„â€œæ˜¯â€æˆ–â€œå¦â€**</span>ã€‚

è€å¹´äººæ„ŸæŸ“æ–°å† ç—…æ¯’åï¼Œ<span class="hljs-strong">**å‘å±•ä¸ºé‡ç—‡å’Œå±é‡ç—‡çš„é£é™©ç¡®å®æ¯”å¹´è½»å¥åº·äººç¾¤è¦é«˜å¾—å¤š**</span>ï¼Œä½†è¿™<span class="hljs-strong">**å¹¶ä¸æ„å‘³ç€æ‰€æœ‰**</span>è€å¹´äººæ„ŸæŸ“åéƒ½ä¼šå¿…ç„¶èµ°å‘é‡ç—‡å’Œå±é‡ç—‡ã€‚æ„ŸæŸ“åçš„ä¸¥é‡ç¨‹åº¦å—åˆ°å¤šç§å› ç´ çš„å½±å“ï¼Œä¸»è¦åŒ…æ‹¬ï¼š

<span class="hljs-bullet">1.</span>  <span class="hljs-strong">**å¹´é¾„**</span>ï¼šå¹´é¾„è¶Šå¤§ï¼Œé£é™©é€šå¸¸è¶Šé«˜ã€‚é«˜é¾„è€äººï¼ˆå°¤å…¶æ˜¯80å²ä»¥ä¸Šï¼‰é£é™©æœ€é«˜ã€‚
<span class="hljs-bullet">2.</span>  <span class="hljs-strong">**åŸºç¡€å¥åº·çŠ¶å†µ**</span>ï¼š<span class="hljs-strong">**åˆå¹¶ç—‡**</span>æ˜¯æœ€é‡è¦çš„é£é™©å› ç´ ã€‚æ‚£æœ‰<span class="hljs-strong">**å¿ƒè¡€ç®¡ç–¾ç—…ã€ç³–å°¿ç—…ã€æ…¢æ€§è‚ºç—…ã€å…ç–«ç¼ºé™·ã€ç™Œç—‡ã€æ…¢æ€§è‚¾ç—…ã€è‚¥èƒ–**</span>ç­‰åŸºç¡€ç–¾ç—…ï¼Œä»¥åŠ<span class="hljs-strong">**å…ç–«åŠŸèƒ½ä½ä¸‹**</span>çš„è€å¹´äººï¼Œæ„ŸæŸ“åå‘å±•ä¸ºé‡ç—‡çš„é£é™©æ˜¾è‘—å¢åŠ ã€‚
<span class="hljs-bullet">3.</span>  <span class="hljs-strong">**ç–«è‹—æ¥ç§æƒ…å†µ**</span>ï¼šå®Œæˆç–«è‹—ï¼ˆåŒ…æ‹¬åŠ å¼ºé’ˆï¼‰æ¥ç§ï¼Œç‰¹åˆ«æ˜¯æœ‰æ•ˆç–«è‹—ï¼Œå¯ä»¥æ˜¾è‘—é™ä½é‡ç—‡å’Œæ­»äº¡é£é™©ã€‚
<span class="hljs-bullet">4.</span>  <span class="hljs-strong">**æ„ŸæŸ“çš„ç—…æ¯’æ¯’æ ªå’Œå˜ç§**</span>ï¼šä¸åŒæ¯’æ ªçš„è‡´ç—…åŠ›å’Œä¼ æ’­æ€§ä¸åŒï¼Œæ„ŸæŸ“ä¸åŒæ¯’æ ªçš„é£é™©å’Œä¸¥é‡ç¨‹åº¦ä¹Ÿä¼šæœ‰æ‰€å·®å¼‚ã€‚
<span class="hljs-bullet">5.</span>  <span class="hljs-strong">**æ„ŸæŸ“æ—¶çš„èº«ä½“çŠ¶å†µå’Œå…ç–«ååº”**</span>ï¼šä¸ªä½“å¯¹ç—…æ¯’çš„ååº”ä¸åŒï¼Œæœ‰äº›è€äººå³ä½¿æœ‰åŸºç¡€ç—…ï¼Œä½†æ„ŸæŸ“æ—¶çŠ¶æ€è¾ƒå¥½ï¼Œå…ç–«ç³»ç»Ÿååº”é€‚å½“ï¼Œä¹Ÿå¯èƒ½ç›¸å¯¹è¾ƒè½»ã€‚
<span class="hljs-bullet">6.</span>  <span class="hljs-strong">**åŒ»ç–—æ”¯æŒ**</span>ï¼šåŠæ—¶çš„åŒ»ç–—å¹²é¢„ã€æ°§ç–—ã€æŠ—ç—…æ¯’è¯ç‰©ï¼ˆå¦‚Paxlovidï¼‰å’Œæœ‰æ•ˆçš„æ”¯æŒæ²»ç–—å¯ä»¥æ˜¾è‘—æ”¹å–„é¢„åï¼Œé¿å…èµ°å‘å±é‡ç—‡ã€‚

<span class="hljs-strong">**æ€»ç»“æ¥è¯´ï¼š**</span>

<span class="hljs-bullet">*</span>   è€å¹´äººæ˜¯<span class="hljs-strong">**æ„ŸæŸ“åå‘å±•ä¸ºé‡ç—‡çš„é«˜å±äººç¾¤**</span>ï¼Œè¿™æ˜¯æ¯‹åº¸ç½®ç–‘çš„ã€‚
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**ä½†æ˜¯ï¼Œä¸ªä½“å·®å¼‚å¾ˆå¤§**</span>ã€‚å¹¶éæ‰€æœ‰è€å¹´äººéƒ½ä¼šç»å†åŒæ ·çš„ä¸¥é‡ç¨‹åº¦ã€‚å¾ˆå¤šè€å¹´äººåœ¨æ„ŸæŸ“åå¯èƒ½åªæ˜¯å‡ºç°ç±»ä¼¼æ„Ÿå†’æˆ–æµæ„Ÿçš„ç—‡çŠ¶ã€‚
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**å…³é”®åœ¨äºé¢„é˜²å’Œæ—©æœŸå¹²é¢„**</span>ã€‚é€šè¿‡æ¥ç§ç–«è‹—ã€åšå¥½é˜²æŠ¤ã€ç®¡ç†åŸºç¡€ç–¾ç—…ã€ä»¥åŠåœ¨å‡ºç°ç—‡çŠ¶æ—¶åŠæ—¶å°±åŒ»ï¼Œå¯ä»¥å¤§å¤§é™ä½è€å¹´äººèµ°å‘é‡ç—‡å’Œå±é‡ç—‡çš„é£é™©ã€‚

å› æ­¤ï¼Œä¸å…¶è¯´â€œè€å¹´äººæ„ŸæŸ“åä¸€å®šä¼šèµ°å‘é‡ç—‡â€ï¼Œä¸å¦‚è¯´â€œ<span class="hljs-strong">**è€å¹´äººæ„ŸæŸ“æ–°å† ç—…æ¯’åï¼Œæœ‰å¾ˆé«˜çš„é£é™©å‘å±•ä¸ºé‡ç—‡ï¼Œç‰¹åˆ«æ˜¯é‚£äº›æœ‰åŸºç¡€ç–¾ç—…å’Œå…ç–«åŠŸèƒ½ä½ä¸‹çš„è€äºº**</span>â€ã€‚æˆ‘ä»¬éœ€è¦å¯¹è€å¹´äººç¾¤ç»™äºˆç‰¹åˆ«çš„å…³æ³¨å’Œä¿æŠ¤ã€‚
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SQL è¯­å¥å·¦è¿æ¥å³è¿æ¥å†…è¿æ¥å¦‚ä½•ä½¿ç”¨ï¼ŒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ]]></title>    <link>https://juejin.cn/post/7572485825705607177</link>    <guid>https://juejin.cn/post/7572485825705607177</guid>    <pubDate>2025-11-15T08:12:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572485825705607177" data-draft-id="7572510909445210162" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SQL è¯­å¥å·¦è¿æ¥å³è¿æ¥å†…è¿æ¥å¦‚ä½•ä½¿ç”¨ï¼ŒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2025-11-15T08:12:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜å°å‡"/> <meta itemprop="url" content="https://juejin.cn/user/2285197690931932"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SQL è¯­å¥å·¦è¿æ¥å³è¿æ¥å†…è¿æ¥å¦‚ä½•ä½¿ç”¨ï¼ŒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2285197690931932/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜å°å‡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T08:12:39.000Z" title="Sat Nov 15 2025 08:12:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>â€‹</p>
<h3 data-id="heading-0">Â æ ¸å¿ƒæ¦‚å¿µ</h3>
<p>è¿æ¥ï¼ˆJOINï¼‰ç”¨äºæ ¹æ®ä¸¤ä¸ªæˆ–å¤šä¸ªè¡¨ä¸­çš„åˆ—ä¹‹é—´çš„å…³ç³»ï¼Œä»è¿™äº›è¡¨ä¸­æŸ¥è¯¢æ•°æ®ã€‚ä¸ºäº†æ›´ç›´è§‚åœ°ç†è§£ï¼Œæˆ‘ä»¬å‡è®¾æœ‰ä¸¤ä¸ªè¡¨ï¼š</p>
<p><code>å‘˜å·¥è¡¨ (Employees)</code></p>






























<table><thead><tr><th/><th/><th/></tr></thead><tbody><tr><td>employee_id</td><td>name</td><td>department_id</td></tr><tr><td>1</td><td>å¼ ä¸‰</td><td>101</td></tr><tr><td>2</td><td>æå››</td><td>102</td></tr><tr><td>3</td><td>ç‹äº”</td><td>NULL</td></tr></tbody></table>
<p><code>éƒ¨é—¨è¡¨ (Departments)</code></p>

























<table><thead><tr><th/><th/></tr></thead><tbody><tr><td>department_id</td><td>department_name</td></tr><tr><td>101</td><td>æŠ€æœ¯éƒ¨</td></tr><tr><td>102</td><td>é”€å”®éƒ¨</td></tr><tr><td>103</td><td>å¸‚åœºéƒ¨</td></tr></tbody></table>
<h3 data-id="heading-1">å†…è¿æ¥ (INNER JOIN)</h3>
<p><strong>å®šä¹‰</strong>ï¼šåªè¿”å›ä¸¤ä¸ªè¡¨ä¸­<strong>è¿æ¥æ¡ä»¶åŒ¹é…</strong>çš„è®°å½•ã€‚</p>
<p><strong>ç»“æœ</strong>ï¼šä¸¤ä¸ªè¡¨çš„<strong>äº¤é›†</strong>éƒ¨åˆ†ã€‚</p>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šå½“ä½ åªæƒ³æŸ¥çœ‹åœ¨ä¸¤è¾¹è¡¨ä¸­éƒ½æœ‰å¯¹åº”ä¿¡æ¯çš„è®°å½•æ—¶ã€‚ä¾‹å¦‚ï¼ŒæŸ¥è¯¢æ‰€æœ‰æœ‰éƒ¨é—¨çš„å‘˜å·¥åŠå…¶éƒ¨é—¨ä¿¡æ¯ã€‚</p>
<p><strong>SQLè¯­å¥</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> 
    e.name,
    d.department_name
<span class="hljs-keyword">FROM</span> 
    Employees e
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> 
    Departments d <span class="hljs-keyword">ON</span> e.department_id <span class="hljs-operator">=</span> d.department_id;
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p><strong>æŸ¥è¯¢ç»“æœ</strong>ï¼š</p>





















<table><thead><tr><th/><th/></tr></thead><tbody><tr><td>name</td><td>department_name</td></tr><tr><td>å¼ ä¸‰</td><td>æŠ€æœ¯éƒ¨</td></tr><tr><td>æå››</td><td>é”€å”®éƒ¨</td></tr></tbody></table>
<p><strong>æ³¨æ„</strong>ï¼šå‘˜å·¥â€œç‹äº”â€çš„<code>department_id</code>ä¸ºNULLï¼Œåœ¨éƒ¨é—¨è¡¨ä¸­æ‰¾ä¸åˆ°åŒ¹é…é¡¹ï¼Œæ‰€ä»¥æ²¡æœ‰å‡ºç°ã€‚éƒ¨é—¨â€œå¸‚åœºéƒ¨â€åœ¨å‘˜å·¥è¡¨ä¸­æ²¡æœ‰å¯¹åº”çš„å‘˜å·¥ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰å‡ºç°ã€‚</p>
<h3 data-id="heading-2">å·¦å¤–è¿æ¥ (LEFT JOIN / LEFT OUTER JOIN)</h3>
<p><strong>å®šä¹‰</strong>ï¼šè¿”å›<strong>å·¦è¡¨ (FROMå­å¥ä¸­çš„è¡¨)</strong> çš„æ‰€æœ‰è®°å½•ï¼Œä»¥åŠå³è¡¨ä¸­è¿æ¥æ¡ä»¶åŒ¹é…çš„è®°å½•ã€‚å¦‚æœå³è¡¨æ²¡æœ‰åŒ¹é…çš„è®°å½•ï¼Œåˆ™ç»“æœé›†ä¸­å³è¡¨çš„éƒ¨åˆ†è¿”å›NULLã€‚</p>
<p><strong>ç»“æœ</strong>ï¼šå·¦è¡¨çš„å…¨é›† + å³è¡¨çš„åŒ¹é…éƒ¨åˆ†ã€‚</p>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šå½“ä½ éœ€è¦å·¦è¡¨çš„æ‰€æœ‰è®°å½•ï¼Œæ— è®ºå®ƒä»¬åœ¨å³è¡¨ä¸­æ˜¯å¦æœ‰å¯¹åº”é¡¹ã€‚ä¾‹å¦‚ï¼Œåˆ—å‡ºæ‰€æœ‰å‘˜å·¥ï¼Œå¹¶æ˜¾ç¤ºä»–ä»¬æ‰€åœ¨çš„éƒ¨é—¨ï¼ˆå³ä½¿æŸäº›å‘˜å·¥æ²¡æœ‰éƒ¨é—¨ï¼‰ã€‚</p>
<p><strong>SQLè¯­å¥</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> 
    e.name,
    d.department_name
<span class="hljs-keyword">FROM</span> 
    Employees e
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> 
    Departments d <span class="hljs-keyword">ON</span> e.department_id <span class="hljs-operator">=</span> d.department_id;
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p><strong>æŸ¥è¯¢ç»“æœ</strong>ï¼š</p>

























<table><thead><tr><th/><th/></tr></thead><tbody><tr><td>name</td><td>department_name</td></tr><tr><td>å¼ ä¸‰</td><td>æŠ€æœ¯éƒ¨</td></tr><tr><td>æå››</td><td>é”€å”®éƒ¨</td></tr><tr><td>ç‹äº”</td><td>NULL</td></tr></tbody></table>
<p><strong>æ³¨æ„</strong>ï¼šå‘˜å·¥â€œç‹äº”â€è¢«åŒ…å«åœ¨ç»“æœä¸­ï¼Œä½†å› ä¸ºä»–ä¸å±äºä»»ä½•éƒ¨é—¨ï¼Œæ‰€ä»¥<code>department_name</code>ä¸ºNULLã€‚</p>
<h3 data-id="heading-3">å³å¤–è¿æ¥ (RIGHT JOIN / RIGHT OUTER JOIN)</h3>
<p><strong>å®šä¹‰</strong>ï¼šä¸å·¦è¿æ¥ç›¸åã€‚è¿”å›<strong>å³è¡¨ (JOINå­å¥ä¸­çš„è¡¨)</strong> çš„æ‰€æœ‰è®°å½•ï¼Œä»¥åŠå·¦è¡¨ä¸­è¿æ¥æ¡ä»¶åŒ¹é…çš„è®°å½•ã€‚å¦‚æœå·¦è¡¨æ²¡æœ‰åŒ¹é…çš„è®°å½•ï¼Œåˆ™ç»“æœé›†ä¸­å·¦è¡¨çš„éƒ¨åˆ†è¿”å›NULLã€‚</p>
<p><strong>ç»“æœ</strong>ï¼šå³è¡¨çš„å…¨é›† + å·¦è¡¨çš„åŒ¹é…éƒ¨åˆ†ã€‚</p>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šå½“ä½ éœ€è¦å³è¡¨çš„æ‰€æœ‰è®°å½•ï¼Œæ— è®ºå®ƒä»¬åœ¨å·¦è¡¨ä¸­æ˜¯å¦æœ‰å¯¹åº”é¡¹ã€‚ä¾‹å¦‚ï¼Œåˆ—å‡ºæ‰€æœ‰éƒ¨é—¨ï¼Œå¹¶æ˜¾ç¤ºéƒ¨é—¨é‡Œçš„å‘˜å·¥ï¼ˆå³ä½¿æŸäº›éƒ¨é—¨æ²¡æœ‰å‘˜å·¥ï¼‰ã€‚</p>
<p><strong>SQLè¯­å¥</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> 
    e.name,
    d.department_name
<span class="hljs-keyword">FROM</span> 
    Employees e
<span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span> 
    Departments d <span class="hljs-keyword">ON</span> e.department_id <span class="hljs-operator">=</span> d.department_id;
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p><strong>æŸ¥è¯¢ç»“æœ</strong>ï¼š</p>

























<table><thead><tr><th/><th/></tr></thead><tbody><tr><td>name</td><td>department_name</td></tr><tr><td>å¼ ä¸‰</td><td>æŠ€æœ¯éƒ¨</td></tr><tr><td>æå››</td><td>é”€å”®éƒ¨</td></tr><tr><td>NULL</td><td>å¸‚åœºéƒ¨</td></tr></tbody></table>
<p><strong>æ³¨æ„</strong>ï¼šéƒ¨é—¨â€œå¸‚åœºéƒ¨â€è¢«åŒ…å«åœ¨ç»“æœä¸­ï¼Œä½†å› ä¸ºè¯¥éƒ¨é—¨æ²¡æœ‰å‘˜å·¥ï¼Œæ‰€ä»¥<code>name</code>ä¸ºNULLã€‚</p>
<h3 data-id="heading-4">å…¨å¤–è¿æ¥ (FULL OUTER JOIN)</h3>
<p><strong>å®šä¹‰</strong>ï¼šè¿”å›å·¦è¡¨å’Œå³è¡¨ä¸­çš„æ‰€æœ‰è®°å½•ã€‚å½“æŸä¸€è¡Œåœ¨å¦ä¸€ä¸ªè¡¨ä¸­æ²¡æœ‰åŒ¹é…è¡Œæ—¶ï¼Œå¦ä¸€ä¸ªè¡¨çš„éƒ¨åˆ†å°†è¿”å›NULLã€‚å¦‚æœè¡¨ä¹‹é—´æœ‰åŒ¹é…çš„è¡Œï¼Œåˆ™è¿”å›åŒ¹é…è¡Œã€‚</p>
<p><strong>ç»“æœ</strong>ï¼šä¸¤ä¸ªè¡¨çš„<strong>å¹¶é›†</strong>ã€‚</p>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šå½“ä½ éœ€è¦çœ‹åˆ°ä¸¤ä¸ªè¡¨çš„æ‰€æœ‰æ•°æ®ï¼Œæ— è®ºå®ƒä»¬æ˜¯å¦åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œç”Ÿæˆä¸€ä¸ªåŒ…å«æ‰€æœ‰å‘˜å·¥å’Œæ‰€æœ‰éƒ¨é—¨çš„å®Œæ•´åˆ—è¡¨ã€‚</p>
<p><strong>SQLè¯­å¥</strong>ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">-- æ³¨æ„ï¼šMySQLä¸æ”¯æŒFULL OUTER <span class="hljs-keyword">JOIN</span>ï¼Œä½†å¯ç”¨LEFT <span class="hljs-keyword">JOIN</span>å’ŒRIGHT <span class="hljs-keyword">JOIN</span>çš„UNIONæ¥å®ç°
<span class="hljs-keyword">SELECT</span> 
    e.name,
    d.department_name
<span class="hljs-keyword">FROM</span> 
    Employees e
LEFT <span class="hljs-keyword">JOIN</span> 
    Departments d <span class="hljs-keyword">ON</span> e.department_id = d.department_id

UNION

<span class="hljs-keyword">SELECT</span> 
    e.name,
    d.department_name
<span class="hljs-keyword">FROM</span> 
    Employees e
RIGHT <span class="hljs-keyword">JOIN</span> 
    Departments d <span class="hljs-keyword">ON</span> e.department_id = d.department_id;
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p><strong>æŸ¥è¯¢ç»“æœ</strong>ï¼š</p>





























<table><thead><tr><th/><th/></tr></thead><tbody><tr><td>name</td><td>department_name</td></tr><tr><td>å¼ ä¸‰</td><td>æŠ€æœ¯éƒ¨</td></tr><tr><td>æå››</td><td>é”€å”®éƒ¨</td></tr><tr><td>ç‹äº”</td><td>NULL</td></tr><tr><td>NULL</td><td>å¸‚åœºéƒ¨</td></tr></tbody></table>
<p><strong>æ³¨æ„</strong>ï¼šè¿™ä¸ªç»“æœåŒ…å«äº†å·¦è¿æ¥å’Œå³è¿æ¥çš„æ‰€æœ‰è®°å½•ã€‚</p>
<h3 data-id="heading-5">æ€»ç»“ä¸åŒºåˆ«</h3>









































<table><thead><tr><th/><th/><th/><th/></tr></thead><tbody><tr><td>è¿æ¥ç±»å‹</td><td>å…³é”®å­—</td><td>æè¿°</td><td>ç»“æœé›†ï¼ˆåŸºäºç¤ºä¾‹ï¼‰</td></tr><tr><td><strong>å†…è¿æ¥</strong></td><td><code>INNER JOIN</code></td><td>åªè¿”å›ä¸¤ä¸ªè¡¨<strong>åŒ¹é…</strong>çš„è®°å½•ã€‚</td><td>å¼ ä¸‰(æŠ€æœ¯éƒ¨), æå››(é”€å”®éƒ¨)</td></tr><tr><td><strong>å·¦è¿æ¥</strong></td><td><code>LEFT JOIN</code></td><td>è¿”å›<strong>å·¦è¡¨å…¨éƒ¨</strong>è®°å½• + <strong>å³è¡¨åŒ¹é…</strong>çš„è®°å½•ã€‚</td><td>å¼ ä¸‰(æŠ€æœ¯éƒ¨), æå››(é”€å”®éƒ¨), ç‹äº”(NULL)</td></tr><tr><td><strong>å³è¿æ¥</strong></td><td><code>RIGHT JOIN</code></td><td>è¿”å›<strong>å³è¡¨å…¨éƒ¨</strong>è®°å½• + <strong>å·¦è¡¨åŒ¹é…</strong>çš„è®°å½•ã€‚</td><td>å¼ ä¸‰(æŠ€æœ¯éƒ¨), æå››(é”€å”®éƒ¨), NULL(å¸‚åœºéƒ¨)</td></tr><tr><td><strong>å…¨å¤–è¿æ¥</strong></td><td><code>FULL OUTER JOIN</code></td><td>è¿”å›<strong>å·¦å³ä¸¤è¡¨å…¨éƒ¨</strong>è®°å½•ã€‚</td><td>å¼ ä¸‰(æŠ€æœ¯éƒ¨), æå››(é”€å”®éƒ¨), ç‹äº”(NULL), NULL(å¸‚åœºéƒ¨)</td></tr></tbody></table>
<h3 data-id="heading-6">è®°å¿†æŠ€å·§</h3>
<p>å¯ä»¥å€ŸåŠ©<strong>éŸ¦æ©å›¾ (Venn Diagram)</strong> æ¥è®°å¿†ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66db546d314b41d788e324d9e0ecfd77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5YGH:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763799234&amp;x-signature=qw26b1izjK8EM8M61YInrbqmr%2Fo%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å­¦ä¹ React-DnDï¼šæ ¸å¿ƒç»„ä»¶ä¸Hooks]]></title>    <link>https://juejin.cn/post/7572405211442135083</link>    <guid>https://juejin.cn/post/7572405211442135083</guid>    <pubDate>2025-11-15T07:37:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572405211442135083" data-draft-id="7572465262738948115" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å­¦ä¹ React-DnDï¼šæ ¸å¿ƒç»„ä»¶ä¸Hooks"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-15T07:37:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Wect"/> <meta itemprop="url" content="https://juejin.cn/user/4185164878720068"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å­¦ä¹ React-DnDï¼šæ ¸å¿ƒç»„ä»¶ä¸Hooks
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4185164878720068/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Wect
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T07:37:16.000Z" title="Sat Nov 15 2025 07:37:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»15åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸Šä¸€ç¯‡æˆ‘ä»¬å®Œæˆäº†React-DnDçš„ç¯å¢ƒæ­å»ºï¼Œé€šè¿‡å®‰è£…ä¾èµ–å’Œå…¨å±€æ³¨å…¥åç«¯ï¼Œè®©æ•´ä¸ªåº”ç”¨å…·å¤‡äº†æ‹–æ”¾èƒ½åŠ›çš„åŸºç¡€ã€‚è¿™ä¸€ç¯‡ï¼Œæˆ‘ä»¬å°†æ·±å…¥React-DnDçš„æ ¸å¿ƒâ€”â€”é‚£äº›æ”¯æ’‘èµ·æ‹–æ”¾åŠŸèƒ½çš„ç»„ä»¶å’ŒHooksã€‚ä»å…¨å±€ç®¡ç†çš„DndProviderï¼Œåˆ°å®šä¹‰æ‹–åŠ¨æºçš„useDragã€æ‹–æ”¾ç›®æ ‡çš„useDropï¼Œæ¯ä¸€ä¸ªéƒ½è‡³å…³é‡è¦ã€‚æŒæ¡å®ƒä»¬ï¼Œä½ å°±èƒ½è½»æ¾å®ç°å„ç§å¤æ‚çš„æ‹–æ”¾åœºæ™¯ã€‚</p>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œå…ˆæ˜ç¡®ä¸€ä¸ªæ ¸å¿ƒé€»è¾‘ï¼šReact-DnDé€šè¿‡â€œç»„ä»¶æä¾›ä¸Šä¸‹æ–‡ + Hooksè¿æ¥ç»„ä»¶â€çš„æ¨¡å¼å·¥ä½œã€‚DndProviderä½œä¸ºä¸Šä¸‹æ–‡æä¾›è€…ï¼Œä¸ºæ‰€æœ‰å­ç»„ä»¶ä¼ é€’æ‹–æ”¾èƒ½åŠ›ï¼›è€ŒuseDragã€useDropç­‰Hooksåˆ™è´Ÿè´£å°†æ™®é€šç»„ä»¶â€œæ”¹é€ â€ä¸ºæ‹–åŠ¨æºæˆ–æ‹–æ”¾ç›®æ ‡ï¼Œå®ç°å…·ä½“çš„äº¤äº’é€»è¾‘ã€‚ä¸‹é¢æˆ‘ä»¬é€ä¸ªæ‹†è§£ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€æ ¸å¿ƒç»„ä»¶ï¼šæ‹–æ”¾èƒ½åŠ›çš„â€œåŸºçŸ³â€</h2>
<p>React-DnDçš„ç»„ä»¶æ•°é‡ä¸å¤šï¼Œä½†æ¯ä¸€ä¸ªéƒ½æ˜¯æ„å»ºæ‹–æ”¾åŠŸèƒ½çš„å…³é”®ã€‚å…¶ä¸­DndProvideræ˜¯å¿…ç”¨ç»„ä»¶ï¼ŒDragPreviewImageåˆ™ç”¨äºä¼˜åŒ–æ‹–åŠ¨ä½“éªŒï¼Œæˆ‘ä»¬é‡ç‚¹è®²è§£è¿™ä¸¤ä¸ªã€‚</p>
<h3 data-id="heading-1">1. DndProviderï¼šæ‹–æ”¾ä¸Šä¸‹æ–‡çš„â€œæä¾›è€…â€</h3>
<p>å¦‚æœæŠŠReact-DnDçš„æ‹–æ”¾èƒ½åŠ›æ¯”ä½œâ€œæ°´ç”µâ€ï¼Œé‚£ä¹ˆDndProviderå°±æ˜¯â€œæ°´ç”µæ€»é—¸â€ã€‚å®ƒè´Ÿè´£å°†æ‹–æ”¾åç«¯çš„èƒ½åŠ›æ³¨å…¥åˆ°æ•´ä¸ªåº”ç”¨ï¼Œè®©æ‰€æœ‰å­ç»„ä»¶éƒ½èƒ½å…±äº«è¿™ä»½èƒ½åŠ›ã€‚ä¸Šä¸€ç¯‡æˆ‘ä»¬å·²ç»åœ¨å…¥å£æ–‡ä»¶ä¸­ç”¨è¿‡å®ƒï¼Œç°åœ¨æ¥æ·±å…¥ç†è§£å®ƒçš„æ ¸å¿ƒä½œç”¨å’Œé…ç½®é¡¹ã€‚</p>
<h4 data-id="heading-2">æ ¸å¿ƒä½œç”¨</h4>
<p>DndProviderçš„æœ¬è´¨æ˜¯ä¸€ä¸ªReactä¸Šä¸‹æ–‡ï¼ˆContextï¼‰çš„æä¾›è€…ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªæ‹–æ”¾ä¸Šä¸‹æ–‡ï¼Œå¹¶å°†åç«¯ï¼ˆå¦‚HTML5Backendï¼‰çš„åŠŸèƒ½ä¼ é€’ç»™æ‰€æœ‰å­ç»„ä»¶ã€‚è¿™æ ·ä¸€æ¥ï¼Œå­ç»„ä»¶é€šè¿‡useDragã€useDropç­‰Hookså°±èƒ½ç›´æ¥è·å–æ‹–æ”¾èƒ½åŠ›ï¼Œæ— éœ€å•ç‹¬é…ç½®åç«¯ã€‚</p>
<p>å¦‚æœä¸ä½¿ç”¨DndProvideråŒ…è£¹åº”ç”¨ï¼Œåç»­ç¼–å†™æ‹–åŠ¨æºæˆ–æ‹–æ”¾ç›®æ ‡æ—¶ä¼šç›´æ¥æŠ¥é”™â€”â€”ç»„ä»¶æ‰¾ä¸åˆ°æ‹–æ”¾ä¸Šä¸‹æ–‡ï¼Œå°±åƒæ²¡æ¥æ°´ç”µçš„æˆ¿å­æ— æ³•ä½¿ç”¨ç”µå™¨ä¸€æ ·ã€‚</p>
<h4 data-id="heading-3">å…³é”®é…ç½®é¡¹</h4>
<p>DndProviderçš„é…ç½®é¡¹ä¸å¤šï¼Œä½†æ¯ä¸€ä¸ªéƒ½æœ‰æ˜ç¡®çš„ç”¨é€”ï¼Œå…¶ä¸­backendæ˜¯å¿…å¡«é¡¹ï¼Œå…¶ä»–ä¸ºå¯é€‰é¡¹ã€‚</p>
<ul>
<li><strong>backendï¼ˆå¿…å¡«ï¼‰</strong> ï¼šReact-DnDçš„åç«¯å¼•æ“ï¼Œè´Ÿè´£å¤„ç†åŸç”ŸDOMäº‹ä»¶ï¼ˆå¦‚é¼ æ ‡æ‹–åŠ¨ã€æ‚¬åœï¼‰ï¼Œå¹¶å°†å…¶è½¬åŒ–ä¸ºReact-DnDèƒ½è¯†åˆ«çš„é€»è¾‘ã€‚æˆ‘ä»¬å¼€å‘PCç«¯åº”ç”¨æ—¶ï¼ŒåŸºæœ¬éƒ½ä½¿ç”¨å®˜æ–¹æä¾›çš„react-dnd-html5-backendï¼›å¦‚æœæ˜¯ç§»åŠ¨ç«¯ï¼Œåˆ™å¯ä»¥ä½¿ç”¨react-dnd-touch-backendã€‚</li>
<li><strong>contextï¼ˆå¯é€‰ï¼‰</strong> ï¼šç”¨äºé…ç½®åç«¯çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå…·ä½“ç”¨æ³•å–å†³äºä½ ä½¿ç”¨çš„åç«¯å®ç°ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½¿ç”¨é»˜è®¤é…ç½®å³å¯ï¼Œæ— éœ€é¢å¤–è®¾ç½®ã€‚</li>
<li><strong>optionsï¼ˆå¯é€‰ï¼‰</strong> ï¼šç”¨äºé…ç½®åç«¯çš„é€‰é¡¹å¯¹è±¡ï¼ŒåŒæ ·ä¾èµ–äºåç«¯å®ç°ã€‚ä¾‹å¦‚ï¼ŒæŸäº›åç«¯æ”¯æŒé…ç½®æ‹–åŠ¨çš„å»¶è¿Ÿæ—¶é—´ã€è§¦æ‘¸åé¦ˆç­‰ï¼Œéƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªå‚æ•°ä¼ é€’ã€‚</li>
</ul>
<h4 data-id="heading-4">å®æˆ˜ç¤ºä¾‹ï¼ˆå›é¡¾ä¸å¼ºåŒ–ï¼‰</h4>
<p>åœ¨å…¥å£æ–‡ä»¶src/index.jsä¸­ï¼Œæˆ‘ä»¬ç”¨DndProvideråŒ…è£¹æ•´ä¸ªAppç»„ä»¶ï¼Œå¹¶æ³¨å…¥HTML5Backendã€‚è¿™é‡Œå†å¼ºè°ƒä¸€ä¸‹æ ¸å¿ƒä»£ç çš„é€»è¾‘ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom/client'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App'</span>;
<span class="hljs-comment">// å¯¼å…¥ DndProvider å’Œ HTML5Backend</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">DndProvider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dnd'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">HTML5Backend</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dnd-html5-backend'</span>;

<span class="hljs-keyword">const</span> root = <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'root'</span>));
root.<span class="hljs-title function_">render</span>(
  <span class="hljs-comment">// ç”¨DndProvideråŒ…è£¹Appï¼Œæ³¨å…¥åç«¯</span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">DndProvider</span> <span class="hljs-attr">backend</span>=<span class="hljs-string">{HTML5Backend}</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">DndProvider</span>&gt;</span></span>
);
</code></pre>
<p>è¿™é‡Œçš„å…³é”®æ˜¯å°†HTML5Backendä½œä¸ºbackendå±æ€§ä¼ é€’ç»™DndProviderï¼Œè¿™æ ·æ•´ä¸ªåº”ç”¨çš„å­ç»„ä»¶éƒ½èƒ½ä½¿ç”¨æ‹–æ”¾èƒ½åŠ›äº†ã€‚</p>
<h3 data-id="heading-5">2. DragPreviewImageï¼šè‡ªå®šä¹‰æ‹–åŠ¨é¢„è§ˆçš„â€œå·¥å…·â€</h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‹–åŠ¨å…ƒç´ æ—¶ï¼Œæµè§ˆå™¨ä¼šç”Ÿæˆä¸€ä¸ªè¯¥å…ƒç´ çš„â€œå¿«ç…§â€ä½œä¸ºæ‹–åŠ¨é¢„è§ˆã€‚ä½†åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è‡ªå®šä¹‰é¢„è§ˆæ•ˆæœï¼ˆæ¯”å¦‚æ‹–åŠ¨æ—¶æ˜¾ç¤ºä¸€ä¸ªç®€åŒ–çš„å›¾æ ‡ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå…ƒç´ ï¼‰ï¼Œè¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°DragPreviewImageç»„ä»¶ã€‚</p>
<h4 data-id="heading-6">æ ¸å¿ƒä½œç”¨</h4>
<p>DragPreviewImageç»„ä»¶ç”¨äºå°†ä¸€å¼ HTMLå›¾åƒå…ƒç´ ï¼ˆimgï¼‰æ¸²æŸ“ä¸ºæ‹–åŠ¨æ—¶çš„é¢„è§ˆæ•ˆæœï¼Œæ›¿ä»£æµè§ˆå™¨é»˜è®¤çš„é¢„è§ˆå¿«ç…§ã€‚å®ƒéœ€è¦é…åˆuseDragé’©å­çš„æ‹–åŠ¨é¢„è§ˆè¿æ¥å™¨ä½¿ç”¨ã€‚</p>
<h4 data-id="heading-7">å…³é”®é…ç½®é¡¹</h4>
<p>DragPreviewImageåªæœ‰ä¸€ä¸ªå¿…å¡«é…ç½®é¡¹ï¼šconnectã€‚</p>
<ul>
<li><strong>connectï¼ˆå¿…å¡«ï¼‰</strong> ï¼šæ‹–åŠ¨é¢„è§ˆçš„è¿æ¥å™¨å‡½æ•°ï¼Œæ¥è‡ªuseDragé’©å­çš„è¿”å›å€¼ã€‚å®ƒçš„ä½œç”¨æ˜¯å°†è‡ªå®šä¹‰çš„é¢„è§ˆå›¾åƒä¸æ‹–åŠ¨æ“ä½œå…³è”èµ·æ¥ï¼Œè®©æµè§ˆå™¨åœ¨æ‹–åŠ¨æ—¶æ˜¾ç¤ºè¿™å¼ å›¾åƒã€‚</li>
</ul>
<h4 data-id="heading-8">å®æˆ˜ç¤ºä¾‹</h4>
<p>ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¯æ‹–åŠ¨çš„ä»»åŠ¡å¡ç‰‡ï¼Œæ‹–åŠ¨æ—¶æ˜¾ç¤ºä¸€å¼ è‡ªå®šä¹‰çš„é¢„è§ˆå›¾ç‰‡ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { useDrag } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dnd'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">DragPreviewImage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dnd'</span>;
<span class="hljs-comment">// å¯¼å…¥è‡ªå®šä¹‰é¢„è§ˆå›¾ç‰‡</span>
<span class="hljs-keyword">import</span> taskPreview <span class="hljs-keyword">from</span> <span class="hljs-string">'./task-preview.png'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">TaskCard</span>(<span class="hljs-params">{ id, title }</span>) {
  <span class="hljs-comment">// ä»useDragä¸­è·å–æ‹–åŠ¨é¢„è§ˆè¿æ¥å™¨</span>
  <span class="hljs-keyword">const</span> [, dragSourceRef, dragPreviewRef] = <span class="hljs-title function_">useDrag</span>({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'TASK'</span>,
    <span class="hljs-attr">item</span>: { id, title }
  });

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{dragSourceRef}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> <span class="hljs-attr">16</span>, <span class="hljs-attr">border:</span> '<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">ccc</span>', <span class="hljs-attr">margin:</span> <span class="hljs-attr">8</span> }}&gt;</span>
      {/* å…³è”è‡ªå®šä¹‰é¢„è§ˆå›¾ç‰‡ */}
      <span class="hljs-tag">&lt;<span class="hljs-name">DragPreviewImage</span> <span class="hljs-attr">connect</span>=<span class="hljs-string">{dragPreviewRef}</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{taskPreview}</span> /&gt;</span>
      {title}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">TaskCard</span>;
</code></pre>
<p>è¿™é‡Œçš„æ ¸å¿ƒé€»è¾‘æ˜¯ï¼šä»useDragçš„è¿”å›å€¼ä¸­è·å–dragPreviewRefï¼ˆæ‹–åŠ¨é¢„è§ˆè¿æ¥å™¨ï¼‰ï¼Œç„¶åå°†å…¶ä¼ é€’ç»™DragPreviewImageçš„connectå±æ€§ï¼ŒåŒæ—¶é€šè¿‡srcå±æ€§æŒ‡å®šè‡ªå®šä¹‰é¢„è§ˆå›¾ç‰‡çš„è·¯å¾„ã€‚è¿™æ ·ï¼Œæ‹–åŠ¨TaskCardæ—¶ï¼Œå°±ä¼šæ˜¾ç¤ºtaskPreview.pngè¿™å¼ å›¾ç‰‡ä½œä¸ºé¢„è§ˆæ•ˆæœã€‚</p>
<h2 data-id="heading-9">äºŒã€æ ¸å¿ƒHooksï¼šæ‹–æ”¾äº¤äº’çš„â€œå®ç°è€…â€</h2>
<p>å¦‚æœè¯´ç»„ä»¶æ˜¯React-DnDçš„â€œéª¨æ¶â€ï¼Œé‚£ä¹ˆHookså°±æ˜¯â€œè‚Œè‚‰â€â€”â€”å®ƒä»¬è´Ÿè´£å®ç°å…·ä½“çš„æ‹–æ”¾äº¤äº’é€»è¾‘ã€‚React-DnDæä¾›äº†å¤šä¸ªå®ç”¨Hooksï¼Œå…¶ä¸­useDragï¼ˆå®šä¹‰æ‹–åŠ¨æºï¼‰ã€useDropï¼ˆå®šä¹‰æ‹–æ”¾ç›®æ ‡ï¼‰æ˜¯æœ€å¸¸ç”¨çš„ä¸¤ä¸ªï¼ŒuseDragLayerå’ŒuseDragDropManageråˆ™ç”¨äºæ›´å¤æ‚çš„åœºæ™¯ã€‚</p>
<h3 data-id="heading-10">1. useDragï¼šè®©ç»„ä»¶æˆä¸ºâ€œæ‹–åŠ¨æºâ€</h3>
<p>useDragæ˜¯å°†æ™®é€šReactç»„ä»¶è½¬åŒ–ä¸ºâ€œæ‹–åŠ¨æºâ€çš„æ ¸å¿ƒé’©å­ã€‚é€šè¿‡å‘å®ƒä¼ é€’ä¸€ä¸ªè§„èŒƒå¯¹è±¡ï¼ˆspecï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å£°æ˜æ€§åœ°æè¿°æ‹–åŠ¨æºçš„ç±»å‹ã€æ‹–åŠ¨çš„æ•°æ®ã€æ‹–åŠ¨è¿‡ç¨‹ä¸­çš„å›è°ƒç­‰ã€‚</p>
<h4 data-id="heading-11">åŸºæœ¬ç”¨æ³•ï¼šå‚æ•°ä¸è¿”å›å€¼</h4>
<p>useDragçš„ç”¨æ³•å¯ä»¥æ€»ç»“ä¸ºâ€œä¼ å…¥specé…ç½®ï¼Œè¿”å›ä¸‰ä¸ªæ ¸å¿ƒå¯¹è±¡â€ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> [collectedProps, dragSourceRef, dragPreviewRef] = <span class="hljs-title function_">useDrag</span>(spec, deps);
</code></pre>
<h5 data-id="heading-12">å‚æ•°è¯´æ˜</h5>
<ul>
<li><strong>specï¼ˆå¿…å¡«ï¼‰</strong> ï¼šè§„èŒƒå¯¹è±¡æˆ–è¿”å›è§„èŒƒå¯¹è±¡çš„å‡½æ•°ï¼Œç”¨äºé…ç½®æ‹–åŠ¨æºçš„æ ¸å¿ƒé€»è¾‘ã€‚è¿™æ˜¯useDragçš„æ ¸å¿ƒï¼Œæˆ‘ä»¬åé¢ä¼šè¯¦ç»†æ‹†è§£å…¶æˆå‘˜ã€‚</li>
<li><strong>depsï¼ˆå¯é€‰ï¼‰</strong> ï¼šä¾èµ–å…³ç³»æ•°ç»„ï¼Œç”¨äºå¤‡å¿˜å½•åŒ–ï¼ˆç±»ä¼¼Reactçš„useMemoï¼‰ã€‚å¦‚æœspecæ˜¯å‡½æ•°ï¼Œdepsé»˜è®¤æ˜¯ç©ºæ•°ç»„ï¼›å¦‚æœspecæ˜¯å¯¹è±¡ï¼Œdepsé»˜è®¤æ˜¯åŒ…å«specçš„æ•°ç»„ã€‚å½“depsä¸­çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒuseDragä¼šé‡æ–°è®¡ç®—specé…ç½®ã€‚</li>
</ul>
<h5 data-id="heading-13">è¿”å›å€¼è¯´æ˜</h5>
<p>useDragè¿”å›ä¸€ä¸ªåŒ…å«ä¸‰ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æœ‰æ˜ç¡®çš„ç”¨é€”ï¼š</p>
<ul>
<li><strong>collectedPropsï¼ˆç´¢å¼•0ï¼‰</strong> ï¼šä»collectå‡½æ•°ä¸­æ”¶é›†çš„å±æ€§å¯¹è±¡ã€‚collectå‡½æ•°ç”¨äºä»æ‹–æ”¾ç›‘æ§å™¨ï¼ˆmonitorï¼‰ä¸­è·å–æ‹–åŠ¨çŠ¶æ€ï¼ˆå¦‚æ˜¯å¦æ­£åœ¨æ‹–åŠ¨ï¼‰ï¼Œå¹¶å°†å…¶è½¬åŒ–ä¸ºç»„ä»¶çš„propsã€‚å¦‚æœæ²¡æœ‰å®šä¹‰collectå‡½æ•°ï¼Œè¿”å›ç©ºå¯¹è±¡ã€‚</li>
<li><strong>dragSourceRefï¼ˆç´¢å¼•1ï¼‰</strong> ï¼šæ‹–åŠ¨æºçš„è¿æ¥å™¨å‡½æ•°ï¼Œå¿…é¡»ç»‘å®šåˆ°ç»„ä»¶çš„DOMå…ƒç´ ä¸Šã€‚å®ƒçš„ä½œç”¨æ˜¯å‘Šè¯‰React-DnDâ€œå“ªä¸ªå…ƒç´ æ˜¯å¯æ‹–åŠ¨çš„â€ï¼Œå¦‚æœä¸ç»‘å®šï¼Œç»„ä»¶å°†æ— æ³•è¢«æ‹–åŠ¨ã€‚</li>
<li><strong>dragPreviewRefï¼ˆç´¢å¼•2ï¼‰</strong> ï¼šæ‹–åŠ¨é¢„è§ˆçš„è¿æ¥å™¨å‡½æ•°ï¼Œç”¨äºå…³è”è‡ªå®šä¹‰çš„æ‹–åŠ¨é¢„è§ˆï¼ˆå¦‚DragPreviewImageç»„ä»¶ï¼‰ã€‚å¦‚æœä¸éœ€è¦è‡ªå®šä¹‰é¢„è§ˆï¼Œå¯ä»¥å¿½ç•¥å®ƒã€‚</li>
</ul>
<h4 data-id="heading-14">æ ¸å¿ƒï¼šspecè§„èŒƒå¯¹è±¡è¯¦è§£</h4>
<p>specå¯¹è±¡æ˜¯useDragçš„çµé­‚ï¼Œå®ƒå®šä¹‰äº†æ‹–åŠ¨æºçš„æ‰€æœ‰è¡Œä¸ºã€‚å…¶ä¸­typeå’Œitemæ˜¯å¿…å¡«é¡¹ï¼Œå…¶ä»–ä¸ºå¯é€‰é¡¹ã€‚</p>
<h5 data-id="heading-15">å¿…å¡«æˆå‘˜</h5>
<ul>
<li><strong>typeï¼ˆå¿…å¡«ï¼‰</strong> ï¼šå­—ç¬¦ä¸²æˆ–ç¬¦å·ï¼ˆSymbolï¼‰ï¼Œç”¨äºæ ‡è¯†æ‹–åŠ¨æºçš„ç±»å‹ã€‚åªæœ‰æ³¨å†Œäº†ç›¸åŒç±»å‹çš„æ‹–æ”¾ç›®æ ‡ï¼ˆuseDropï¼‰ï¼Œæ‰ä¼šå¯¹è¯¥æ‹–åŠ¨æºçš„æ‹–æ”¾æ“ä½œåšå‡ºååº”ã€‚è¿™æ˜¯React-DnDå®ç°â€œæ‹–åŠ¨æºä¸ç›®æ ‡åŒ¹é…â€çš„æ ¸å¿ƒæœºåˆ¶ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»»åŠ¡å¡ç‰‡çš„typeè®¾ä¸º'TASK'ï¼Œå°†ä»»åŠ¡åˆ—è¡¨çš„acceptè®¾ä¸º'TASK'ï¼Œè¿™æ ·ä»»åŠ¡å¡ç‰‡å°±èƒ½æ‹–æ”¾åˆ°ä»»åŠ¡åˆ—è¡¨ä¸­ã€‚</li>
<li><strong>itemï¼ˆå¿…å¡«ï¼‰</strong> ï¼šæè¿°æ‹–åŠ¨æ•°æ®çš„å¯¹è±¡ï¼Œæˆ–è¿”å›è¯¥å¯¹è±¡çš„å‡½æ•°ã€‚è¿™æ˜¯æ‹–åŠ¨æºä¼ é€’ç»™æ‹–æ”¾ç›®æ ‡çš„â€œæ ¸å¿ƒæ•°æ®â€ï¼Œä¹Ÿæ˜¯ä¸¤è€…ä¹‹é—´å”¯ä¸€çš„é€šä¿¡æ¡¥æ¢ã€‚ å¦‚æœæ˜¯å¯¹è±¡ï¼Œåº”åªåŒ…å«æ‹–æ”¾ç›®æ ‡éœ€è¦çš„æœ€å°æ•°æ®ï¼ˆå¦‚idã€åç§°ï¼‰ï¼Œé¿å…ä¼ é€’å¤æ‚å¼•ç”¨ï¼ˆæ¯”å¦‚æ•´ä¸ªç»„ä»¶å®ä¾‹ï¼‰ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ‹–åŠ¨æºå’Œç›®æ ‡è¿‡åº¦è€¦åˆã€‚</li>
<li>å¦‚æœæ˜¯å‡½æ•°ï¼Œä¼šåœ¨æ‹–åŠ¨æ“ä½œå¼€å§‹æ—¶æ‰§è¡Œï¼Œå¹¶è¿”å›ä¸Šè¿°å¯¹è±¡ã€‚å¦‚æœè¿”å›nullï¼Œæ‹–åŠ¨æ“ä½œä¼šè¢«å–æ¶ˆã€‚</li>
</ul>
<h5 data-id="heading-16">å¯é€‰æˆå‘˜ï¼ˆå›è°ƒä¸é…ç½®ï¼‰</h5>
<p><strong>end(item, monitor)ï¼ˆå¯é€‰ï¼‰</strong> ï¼šæ‹–åŠ¨æ“ä½œç»“æŸæ—¶è§¦å‘çš„å›è°ƒå‡½æ•°ï¼Œæ— è®ºæ‹–åŠ¨æ˜¯å¦æˆåŠŸï¼ˆæ¯”å¦‚æ‹–åˆ°ç›®æ ‡åé‡Šæ”¾ï¼Œæˆ–æ‹–åˆ°æ— æ•ˆåŒºåŸŸé‡Šæ”¾ï¼‰ï¼Œéƒ½ä¼šæ‰§è¡Œã€‚</p>
<ul>
<li>
<p>itemï¼šæ‹–åŠ¨çš„æ ¸å¿ƒæ•°æ®ï¼ˆä¸spec.itemä¸€è‡´ï¼‰ã€‚</p>
</li>
<li>
<p>monitorï¼šæ‹–æ”¾ç›‘æ§å™¨ï¼Œç”¨äºè·å–æ‹–åŠ¨çŠ¶æ€ï¼ˆå¦‚monitor.didDrop()å¯ä»¥åˆ¤æ–­æ‹–æ”¾æ˜¯å¦è¢«ç›®æ ‡æ¥å—ï¼Œmonitor.getDropResult()å¯ä»¥è·å–ç›®æ ‡è¿”å›çš„ç»“æœï¼‰ã€‚</p>
</li>
<li>
<p>å¸¸ç”¨åœºæ™¯ï¼šæ‹–åŠ¨ç»“æŸåæ›´æ–°æ•°æ®ï¼ˆå¦‚å°†ä»»åŠ¡ä»â€œå¾…åŠâ€åˆ—è¡¨ç§»åˆ°â€œå·²åŠâ€åˆ—è¡¨ï¼‰ã€‚</p>
</li>
</ul>
<p><strong>canDrag(monitor)ï¼ˆå¯é€‰ï¼‰</strong> ï¼šç”¨äºåˆ¤æ–­å½“å‰ç»„ä»¶æ˜¯å¦å…è®¸è¢«æ‹–åŠ¨ã€‚è¿”å›trueåˆ™å…è®¸æ‹–åŠ¨ï¼Œè¿”å›falseåˆ™ç¦æ­¢ã€‚ monitorï¼šæ‹–æ”¾ç›‘æ§å™¨ï¼Œå¯ä»¥é€šè¿‡monitor.getItem()è·å–æ‹–åŠ¨æ•°æ®ï¼Œç»“åˆç»„ä»¶propsåˆ¤æ–­æ˜¯å¦å…è®¸æ‹–åŠ¨ï¼ˆå¦‚æŸäº›ä»»åŠ¡å¡ç‰‡ä¸å…è®¸è¢«æ‹–åŠ¨ï¼‰ã€‚</p>
<p>æ³¨æ„ï¼š ä¸èƒ½åœ¨è¯¥å‡½æ•°ä¸­è°ƒç”¨monitor.canDrag()ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ­»å¾ªç¯ã€‚</p>
<p><strong>isDragging(monitor)ï¼ˆå¯é€‰ï¼‰</strong> ï¼šç”¨äºè‡ªå®šä¹‰â€œæ˜¯å¦æ­£åœ¨æ‹–åŠ¨â€çš„åˆ¤æ–­é€»è¾‘ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰å¯åŠ¨æ‹–åŠ¨çš„ç»„ä»¶ä¼šè¢«è§†ä¸ºâ€œæ­£åœ¨æ‹–åŠ¨â€ã€‚ å¸¸ç”¨åœºæ™¯ï¼šå½“æœ‰å¤šä¸ªç›¸åŒç±»å‹çš„ç»„ä»¶æ—¶ï¼ˆå¦‚å¤šä¸ªä»»åŠ¡å¡ç‰‡ï¼‰ï¼Œé€šè¿‡item.idä¸ç»„ä»¶props.idå¯¹æ¯”ï¼Œç¡®ä¿åªæœ‰å½“å‰æ‹–åŠ¨çš„ç»„ä»¶æ˜¾ç¤ºâ€œæ‹–åŠ¨ä¸­â€çš„æ ·å¼ã€‚</p>
<p>ç¤ºä¾‹ï¼šreturn monitor.getItem().id === props.id;</p>
<p><strong>collect(monitor, props)ï¼ˆå¯é€‰ï¼‰</strong> ï¼šæ”¶é›†å‡½æ•°ï¼Œç”¨äºä»ç›‘æ§å™¨ä¸­è·å–æ‹–åŠ¨çŠ¶æ€ï¼Œå¹¶è½¬åŒ–ä¸ºç»„ä»¶çš„propsã€‚è¿”å›çš„å¯¹è±¡ä¼šä½œä¸ºuseDragçš„ç¬¬ä¸€ä¸ªè¿”å›å€¼ï¼ˆcollectedPropsï¼‰ä¼ é€’ç»™ç»„ä»¶ã€‚</p>
<p>å¸¸ç”¨ç›‘æ§å™¨æ–¹æ³•ï¼šmonitor.isDragging()ï¼ˆæ˜¯å¦æ­£åœ¨æ‹–åŠ¨ï¼‰ã€monitor.getInitialClientOffset()ï¼ˆæ‹–åŠ¨å¼€å§‹æ—¶çš„é¼ æ ‡ä½ç½®ï¼‰ç­‰ã€‚</p>
<p>ç¤ºä¾‹ï¼š(monitor) =&gt; ({ isDragging: monitor.isDragging() })</p>
<h4 data-id="heading-17">useDragå®æˆ˜ï¼šå¯æ‹–åŠ¨çš„ä»»åŠ¡å¡ç‰‡</h4>
<p>ç»“åˆä¸Šé¢çš„çŸ¥è¯†ç‚¹ï¼Œæˆ‘ä»¬å®ç°ä¸€ä¸ªå®Œæ•´çš„å¯æ‹–åŠ¨ä»»åŠ¡å¡ç‰‡ç»„ä»¶ï¼ŒåŒ…å«æ‹–åŠ¨çŠ¶æ€åˆ¤æ–­ã€æ‹–åŠ¨ç»“æŸå›è°ƒç­‰åŠŸèƒ½ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// DraggableTask.jsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { useDrag } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dnd'</span>;

<span class="hljs-comment">// å®šä¹‰æ‹–åŠ¨ç±»å‹ï¼ˆå»ºè®®ç”¨Symbolé¿å…å†²çªï¼‰</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TASK_TYPE</span> = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'TASK'</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">DraggableTask</span>(<span class="hljs-params">{ id, title, onDragEnd }</span>) {
  <span class="hljs-keyword">const</span> [collectedProps, dragSourceRef] = <span class="hljs-title function_">useDrag</span>({
    <span class="hljs-comment">// æ‹–åŠ¨ç±»å‹</span>
    <span class="hljs-attr">type</span>: <span class="hljs-variable constant_">TASK_TYPE</span>,
    <span class="hljs-comment">// æ‹–åŠ¨æ•°æ®ï¼ˆåªä¼ é€’å¿…è¦çš„idå’Œtitleï¼‰</span>
    <span class="hljs-attr">item</span>: <span class="hljs-function">() =&gt;</span> ({ id, title }),
    <span class="hljs-comment">// æ‹–åŠ¨ç»“æŸå›è°ƒ</span>
    <span class="hljs-attr">end</span>: <span class="hljs-function">(<span class="hljs-params">item, monitor</span>) =&gt;</span> {
      <span class="hljs-comment">// åˆ¤æ–­æ‹–æ”¾æ˜¯å¦è¢«ç›®æ ‡æ¥å—</span>
      <span class="hljs-keyword">if</span> (monitor.<span class="hljs-title function_">didDrop</span>()) {
        <span class="hljs-comment">// è·å–ç›®æ ‡è¿”å›çš„ç»“æœï¼ˆå¦‚ç›®æ ‡åˆ—è¡¨çš„idï¼‰</span>
        <span class="hljs-keyword">const</span> dropResult = monitor.<span class="hljs-title function_">getDropResult</span>();
        <span class="hljs-comment">// è°ƒç”¨çˆ¶ç»„ä»¶æ–¹æ³•æ›´æ–°æ•°æ®</span>
        <span class="hljs-title function_">onDragEnd</span>(item.<span class="hljs-property">id</span>, dropResult.<span class="hljs-property">listId</span>);
      }
    },
    <span class="hljs-comment">// æ”¶é›†æ‹–åŠ¨çŠ¶æ€</span>
    <span class="hljs-attr">collect</span>: <span class="hljs-function">(<span class="hljs-params">monitor</span>) =&gt;</span> ({
      <span class="hljs-attr">isDragging</span>: monitor.<span class="hljs-title function_">isDragging</span>()
    }),
    <span class="hljs-comment">// åªæœ‰idä¸ºå¶æ•°çš„ä»»åŠ¡å¯ä»¥æ‹–åŠ¨ï¼ˆç¤ºä¾‹ï¼‰</span>
    <span class="hljs-attr">canDrag</span>: <span class="hljs-function">() =&gt;</span> id % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>
  });

  <span class="hljs-comment">// æ ¹æ®æ‹–åŠ¨çŠ¶æ€è®¾ç½®æ ·å¼ï¼ˆæ‹–åŠ¨æ—¶åŠé€æ˜ï¼‰</span>
  <span class="hljs-keyword">const</span> cardStyle = {
    <span class="hljs-attr">padding</span>: <span class="hljs-number">16</span>,
    <span class="hljs-attr">border</span>: <span class="hljs-string">'1px solid #ccc'</span>,
    <span class="hljs-attr">margin</span>: <span class="hljs-number">8</span>,
    <span class="hljs-attr">opacity</span>: collectedProps.<span class="hljs-property">isDragging</span> ? <span class="hljs-number">0.5</span> : <span class="hljs-number">1</span>,
    <span class="hljs-attr">cursor</span>: collectedProps.<span class="hljs-property">isDragging</span> ? <span class="hljs-string">'grabbing'</span> : <span class="hljs-string">'grab'</span>
  };

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{dragSourceRef}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{cardStyle}</span>&gt;</span>{title}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">DraggableTask</span>;
</code></pre>
<p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li>åªæœ‰idä¸ºå¶æ•°çš„ä»»åŠ¡å¡ç‰‡å¯ä»¥è¢«æ‹–åŠ¨ï¼ˆcanDragé…ç½®ï¼‰ã€‚</li>
<li>æ‹–åŠ¨æ—¶å¡ç‰‡æ˜¾ç¤ºåŠé€æ˜æ•ˆæœï¼ˆé€šè¿‡collectè·å–isDraggingçŠ¶æ€ï¼ŒåŠ¨æ€è®¾ç½®opacityï¼‰ã€‚</li>
<li>æ‹–åŠ¨ç»“æŸåï¼Œæ ¹æ®æ‹–æ”¾ç»“æœè°ƒç”¨çˆ¶ç»„ä»¶çš„onDragEndæ–¹æ³•æ›´æ–°æ•°æ®ï¼ˆendå›è°ƒï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-18">2. useDropï¼šè®©ç»„ä»¶æˆä¸ºâ€œæ‹–æ”¾ç›®æ ‡â€</h3>
<p>useDragè´Ÿè´£â€œå‘èµ·â€æ‹–æ”¾ï¼ŒuseDropåˆ™è´Ÿè´£â€œæ¥æ”¶â€æ‹–æ”¾â€”â€”å®ƒå°†æ™®é€šç»„ä»¶è½¬åŒ–ä¸ºâ€œæ‹–æ”¾ç›®æ ‡â€ï¼Œç”¨äºæ¥æ”¶æ‹–åŠ¨æºä¼ é€’çš„æ•°æ®ï¼Œå¹¶å¤„ç†æ‹–æ”¾ç›¸å…³çš„é€»è¾‘ï¼ˆå¦‚æ‚¬åœã€æ¥æ”¶æ‹–æ”¾ï¼‰ã€‚</p>
<h4 data-id="heading-19">åŸºæœ¬ç”¨æ³•ï¼šå‚æ•°ä¸è¿”å›å€¼</h4>
<p>useDropçš„ç”¨æ³•ä¸useDragç±»ä¼¼ï¼Œéƒ½æ˜¯â€œä¼ å…¥specé…ç½®ï¼Œè¿”å›æ ¸å¿ƒå¯¹è±¡â€ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> [collectedProps, dropTargetRef] = <span class="hljs-title function_">useDrop</span>(spec, deps);
</code></pre>
<h5 data-id="heading-20">å‚æ•°è¯´æ˜</h5>
<ul>
<li><strong>specï¼ˆå¿…å¡«ï¼‰</strong> ï¼šè§„èŒƒå¯¹è±¡æˆ–è¿”å›è§„èŒƒå¯¹è±¡çš„å‡½æ•°ï¼Œç”¨äºé…ç½®æ‹–æ”¾ç›®æ ‡çš„æ ¸å¿ƒé€»è¾‘ï¼Œæ˜¯useDropçš„æ ¸å¿ƒã€‚</li>
<li><strong>depsï¼ˆå¯é€‰ï¼‰</strong> ï¼šä¾èµ–å…³ç³»æ•°ç»„ï¼Œä½œç”¨ä¸useDragçš„depsä¸€è‡´ï¼Œç”¨äºå¤‡å¿˜å½•åŒ–ã€‚</li>
</ul>
<h5 data-id="heading-21">è¿”å›å€¼è¯´æ˜</h5>
<p>useDropè¿”å›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„ï¼š</p>
<ul>
<li><strong>collectedPropsï¼ˆç´¢å¼•0ï¼‰</strong> ï¼šä»collectå‡½æ•°ä¸­æ”¶é›†çš„å±æ€§å¯¹è±¡ï¼Œä¸useDragçš„collectedPropsç±»ä¼¼ï¼Œç”¨äºè·å–æ‹–æ”¾çŠ¶æ€ï¼ˆå¦‚æ˜¯å¦æœ‰å…ƒç´ æ‚¬åœåœ¨ç›®æ ‡ä¸Šï¼‰ã€‚</li>
<li><strong>dropTargetRefï¼ˆç´¢å¼•1ï¼‰</strong> ï¼šæ‹–æ”¾ç›®æ ‡çš„è¿æ¥å™¨å‡½æ•°ï¼Œå¿…é¡»ç»‘å®šåˆ°ç»„ä»¶çš„DOMå…ƒç´ ä¸Šï¼Œå‘Šè¯‰React-DnDâ€œå“ªä¸ªå…ƒç´ æ˜¯æ‹–æ”¾ç›®æ ‡â€ã€‚</li>
</ul>
<h4 data-id="heading-22">æ ¸å¿ƒï¼šspecè§„èŒƒå¯¹è±¡è¯¦è§£</h4>
<p>useDropçš„specå¯¹è±¡ä¸useDragç±»ä¼¼ï¼Œä½†æ ¸å¿ƒå…³æ³¨ç‚¹æ˜¯â€œæ¥æ”¶æ‹–æ”¾â€ï¼Œå…¶ä¸­acceptæ˜¯å¿…å¡«é¡¹ã€‚</p>
<h5 data-id="heading-23">å¿…å¡«æˆå‘˜</h5>
<ul>
<li><strong>acceptï¼ˆå¿…å¡«ï¼‰</strong> ï¼šç”¨äºæŒ‡å®šå½“å‰æ‹–æ”¾ç›®æ ‡å¯ä»¥æ¥å—çš„æ‹–åŠ¨æºç±»å‹ï¼Œä¸useDragçš„typeå¯¹åº”ã€‚å®ƒå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€ç¬¦å·ï¼Œä¹Ÿå¯ä»¥æ˜¯åŒ…å«å¤šä¸ªç±»å‹çš„æ•°ç»„ã€‚
<ul>
<li>ç¤ºä¾‹ï¼š<code>accept: TASK_TYPE</code>ï¼ˆæ¥å—ç±»å‹ä¸ºTASK_TYPEçš„æ‹–åŠ¨æºï¼‰ã€‚</li>
<li>ç¤ºä¾‹ï¼š<code>accept: [TASK_TYPE, PROJECT_TYPE]</code>ï¼ˆæ¥å—ä¸¤ç§ç±»å‹çš„æ‹–åŠ¨æºï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h5 data-id="heading-24">å¯é€‰æˆå‘˜ï¼ˆå›è°ƒä¸é…ç½®ï¼‰</h5>
<p><strong>drop(item, monitor)ï¼ˆå¯é€‰ï¼‰</strong> ï¼šå½“å…¼å®¹ç±»å‹çš„æ‹–åŠ¨æºåœ¨ç›®æ ‡ä¸Š<strong>é‡Šæ”¾æ—¶</strong>è§¦å‘çš„å›è°ƒå‡½æ•°ï¼Œæ˜¯å¤„ç†æ‹–æ”¾é€»è¾‘çš„æ ¸å¿ƒã€‚</p>
<ul>
<li>itemï¼šæ‹–åŠ¨æºä¼ é€’çš„æ ¸å¿ƒæ•°æ®ï¼ˆä¸useDragçš„spec.itemä¸€è‡´ï¼‰ã€‚</li>
<li>monitorï¼šæ‹–æ”¾ç›‘æ§å™¨ï¼Œå¯ä»¥é€šè¿‡monitor.isOver({ shallow: true })åˆ¤æ–­æ˜¯å¦æ˜¯ç›´æ¥æ‚¬åœï¼ˆè€ŒéåµŒå¥—ç›®æ ‡ï¼‰ã€‚</li>
<li>è¿”å›å€¼ï¼šå¯ä»¥è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¼šä½œä¸ºæ‹–æ”¾ç»“æœï¼Œé€šè¿‡monitor.getDropResult()ä¼ é€’ç»™æ‹–åŠ¨æºçš„endå›è°ƒã€‚</li>
<li>å¸¸ç”¨åœºæ™¯ï¼šæ¥æ”¶æ‹–åŠ¨çš„ä»»åŠ¡æ•°æ®ï¼Œå°†å…¶æ·»åŠ åˆ°å½“å‰åˆ—è¡¨ä¸­ã€‚</li>
</ul>
<p><strong>hover(item, monitor)ï¼ˆå¯é€‰ï¼‰</strong> ï¼šå½“æ‹–åŠ¨æºæ‚¬åœåœ¨ç›®æ ‡ä¸Šæ—¶<strong>æŒç»­</strong>è§¦å‘çš„å›è°ƒå‡½æ•°ï¼ˆå³ä½¿é¼ æ ‡ä¸åŠ¨ä¹Ÿä¼šè§¦å‘ï¼‰ã€‚ å¸¸ç”¨åœºæ™¯ï¼šå®ç°â€œæ‹–å…¥æ—¶é«˜äº®ç›®æ ‡â€â€œæ‹–åŠ¨æ’åºâ€ç­‰äº¤äº’ï¼ˆå¦‚åœ¨åˆ—è¡¨ä¸­æ‹–åŠ¨ä»»åŠ¡æ—¶ï¼Œè°ƒæ•´ä»»åŠ¡çš„ä½ç½®ï¼‰ã€‚</p>
<p>æ³¨æ„ï¼šå³ä½¿canDropè¿”å›falseï¼Œè¯¥å‡½æ•°ä¹Ÿä¼šè§¦å‘ï¼Œå¯ä»¥é€šè¿‡monitor.canDrop()åˆ¤æ–­å½“å‰æ˜¯å¦å…è®¸æ¥æ”¶æ‹–æ”¾ã€‚</p>
<p><strong>canDrop(item, monitor)ï¼ˆå¯é€‰ï¼‰</strong> ï¼šç”¨äºåˆ¤æ–­å½“å‰ç›®æ ‡æ˜¯å¦å…è®¸æ¥æ”¶è¯¥æ‹–åŠ¨æºçš„æ•°æ®ã€‚è¿”å›trueåˆ™å…è®¸ï¼Œè¿”å›falseåˆ™ç¦æ­¢ã€‚ ç¤ºä¾‹ï¼šæ ¹æ®æ‹–åŠ¨æºçš„idåˆ¤æ–­æ˜¯å¦å…è®¸æ¥æ”¶ï¼ˆå¦‚ç¦æ­¢å°†ä»»åŠ¡æ‹–æ”¾åˆ°è‡ªå·±æ‰€åœ¨çš„åˆ—è¡¨ï¼‰ã€‚</p>
<p>æ³¨æ„ï¼šä¸èƒ½åœ¨è¯¥å‡½æ•°ä¸­è°ƒç”¨monitor.canDrop()ã€‚</p>
<p><strong>collect(monitor, props)ï¼ˆå¯é€‰ï¼‰</strong> ï¼šæ”¶é›†å‡½æ•°ï¼Œç”¨äºä»ç›‘æ§å™¨ä¸­è·å–æ‹–æ”¾çŠ¶æ€ï¼Œè½¬åŒ–ä¸ºç»„ä»¶çš„propsã€‚ å¸¸ç”¨ç›‘æ§å™¨æ–¹æ³•ï¼šmonitor.isOver()ï¼ˆæ˜¯å¦æœ‰å…ƒç´ æ‚¬åœï¼‰ã€monitor.canDrop()ï¼ˆæ˜¯å¦å…è®¸æ¥æ”¶æ‹–æ”¾ï¼‰ç­‰ã€‚</p>
<p>ç¤ºä¾‹ï¼š(monitor) =&gt; ({ isOver: monitor.isOver(), canDrop: monitor.canDrop() })</p>
<h4 data-id="heading-25">useDropå®æˆ˜ï¼šå¯æ¥æ”¶ä»»åŠ¡çš„åˆ—è¡¨</h4>
<p>ç»“åˆuseDragçš„ä»»åŠ¡å¡ç‰‡ï¼Œæˆ‘ä»¬å®ç°ä¸€ä¸ªå¯æ¥æ”¶ä»»åŠ¡çš„åˆ—è¡¨ç»„ä»¶ï¼ŒåŒ…å«æ‚¬åœé«˜äº®ã€æ¥æ”¶ä»»åŠ¡ç­‰åŠŸèƒ½ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// TaskList.jsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { useDrop } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dnd'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-variable constant_">TASK_TYPE</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./DraggableTask'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">TaskList</span>(<span class="hljs-params">{ id, title, tasks, onAddTask }</span>) {
  <span class="hljs-keyword">const</span> [collectedProps, dropTargetRef] = <span class="hljs-title function_">useDrop</span>({
    <span class="hljs-comment">// æ¥å—TASK_TYPEç±»å‹çš„æ‹–åŠ¨æº</span>
    <span class="hljs-attr">accept</span>: <span class="hljs-variable constant_">TASK_TYPE</span>,
    <span class="hljs-comment">// æ¥æ”¶æ‹–æ”¾æ—¶çš„å›è°ƒ</span>
    <span class="hljs-attr">drop</span>: <span class="hljs-function">(<span class="hljs-params">item, monitor</span>) =&gt;</span> {
      <span class="hljs-comment">// è°ƒç”¨çˆ¶ç»„ä»¶æ–¹æ³•ï¼Œå°†ä»»åŠ¡æ·»åŠ åˆ°å½“å‰åˆ—è¡¨</span>
      <span class="hljs-title function_">onAddTask</span>(id, item);
      <span class="hljs-comment">// è¿”å›æ‹–æ”¾ç»“æœï¼Œä¼ é€’ç»™æ‹–åŠ¨æº</span>
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">listId</span>: id };
    },
    <span class="hljs-comment">// æ‚¬åœæ—¶çš„å›è°ƒ</span>
    <span class="hljs-attr">hover</span>: <span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
      <span class="hljs-comment">// å¯ä»¥åœ¨è¿™é‡Œå®ç°æ‹–åŠ¨æ’åºé€»è¾‘ï¼ˆå¦‚è°ƒæ•´ä»»åŠ¡åœ¨åˆ—è¡¨ä¸­çš„ä½ç½®ï¼‰</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ä»»åŠ¡ <span class="hljs-subst">${item.id}</span> æ‚¬åœåœ¨ <span class="hljs-subst">${title}</span> åˆ—è¡¨ä¸Š`</span>);
    },
    <span class="hljs-comment">// æ”¶é›†æ‹–æ”¾çŠ¶æ€</span>
    <span class="hljs-attr">collect</span>: <span class="hljs-function">(<span class="hljs-params">monitor</span>) =&gt;</span> ({
      <span class="hljs-attr">isOver</span>: monitor.<span class="hljs-title function_">isOver</span>(),
      <span class="hljs-attr">canDrop</span>: monitor.<span class="hljs-title function_">canDrop</span>()
    })
  });

  <span class="hljs-comment">// æ ¹æ®æ‚¬åœçŠ¶æ€å’Œæ˜¯å¦å…è®¸æ‹–æ”¾è®¾ç½®æ ·å¼</span>
  <span class="hljs-keyword">const</span> listStyle = {
    <span class="hljs-attr">padding</span>: <span class="hljs-number">16</span>,
    <span class="hljs-attr">border</span>: collectedProps.<span class="hljs-property">isOver</span> &amp;&amp; collectedProps.<span class="hljs-property">canDrop</span> 
      ? <span class="hljs-string">'2px solid #2196F3'</span> 
      : <span class="hljs-string">'1px solid #eee'</span>,
    <span class="hljs-attr">margin</span>: <span class="hljs-number">16</span>,
    <span class="hljs-attr">minHeight</span>: <span class="hljs-number">200</span>
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{dropTargetRef}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{listStyle}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>{title}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
      {tasks.map(task =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{task.id}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> <span class="hljs-attr">8</span>, <span class="hljs-attr">borderBottom:</span> '<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">eee</span>' }}&gt;</span>
          {task.title}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">TaskList</span>;
</code></pre>
<p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li>åˆ—è¡¨åªæ¥å—TASK_TYPEç±»å‹çš„æ‹–åŠ¨æºï¼ˆaccepté…ç½®ï¼‰ã€‚</li>
<li>å½“ä»»åŠ¡å¡ç‰‡æ‚¬åœåœ¨åˆ—è¡¨ä¸Šä¸”å…è®¸æ‹–æ”¾æ—¶ï¼Œåˆ—è¡¨è¾¹æ¡†å˜ä¸ºè“è‰²é«˜äº®ï¼ˆé€šè¿‡collectè·å–isOverå’ŒcanDropçŠ¶æ€ï¼‰ã€‚</li>
<li>æ¥æ”¶ä»»åŠ¡å¡ç‰‡åï¼Œè°ƒç”¨çˆ¶ç»„ä»¶çš„onAddTaskæ–¹æ³•å°†ä»»åŠ¡æ·»åŠ åˆ°å½“å‰åˆ—è¡¨ï¼Œå¹¶è¿”å›åˆ—è¡¨idç»™æ‹–åŠ¨æºã€‚</li>
</ul>
<h3 data-id="heading-26">3. å…¶ä»–å®ç”¨Hooksï¼šåº”å¯¹å¤æ‚åœºæ™¯</h3>
<p>é™¤äº†useDragå’ŒuseDropï¼ŒReact-DnDè¿˜æä¾›äº†ä¸¤ä¸ªç”¨äºå¤æ‚åœºæ™¯çš„Hooksï¼šuseDragLayerå’ŒuseDragDropManagerã€‚</p>
<h4 data-id="heading-27">useDragLayerï¼šè‡ªå®šä¹‰å…¨å±€æ‹–åŠ¨å±‚</h4>
<p>å½“éœ€è¦å®ç°è¶…è¶Šå•ä¸ªç»„ä»¶çš„æ‹–åŠ¨é¢„è§ˆï¼ˆå¦‚æ‹–åŠ¨æ—¶æ˜¾ç¤ºä¸€ä¸ªè¦†ç›–æ•´ä¸ªé¡µé¢çš„æç¤ºï¼‰æ—¶ï¼ŒuseDragLayerå°±æ´¾ä¸Šç”¨åœºäº†ã€‚å®ƒå¯ä»¥åˆ›å»ºä¸€ä¸ªç‹¬ç«‹äºæ‹–åŠ¨æºå’Œç›®æ ‡çš„â€œå…¨å±€æ‹–åŠ¨å±‚â€ï¼Œä¸å—å…¶ä»–ç»„ä»¶çš„æ ·å¼å½±å“ã€‚</p>
<h5 data-id="heading-28">æ ¸å¿ƒç”¨æ³•</h5>
<p>useDragLayeråªæ¥æ”¶ä¸€ä¸ªå¿…å¡«å‚æ•°collectï¼ˆæ”¶é›†å‡½æ•°ï¼‰ï¼Œè¿”å›ä»collectå‡½æ•°ä¸­è·å–çš„å±æ€§å¯¹è±¡ã€‚collectå‡½æ•°çš„ä½œç”¨æ˜¯ä»ç›‘æ§å™¨ä¸­è·å–æ‹–åŠ¨çŠ¶æ€ï¼Œç”¨äºæ¸²æŸ“æ‹–åŠ¨å±‚çš„å†…å®¹ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// CustomDragLayer.jsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { useDragLayer } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dnd'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">CustomDragLayer</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// æ”¶é›†æ‹–åŠ¨çŠ¶æ€</span>
  <span class="hljs-keyword">const</span> { item, isDragging } = <span class="hljs-title function_">useDragLayer</span>(<span class="hljs-function"><span class="hljs-params">monitor</span> =&gt;</span> ({
    <span class="hljs-attr">item</span>: monitor.<span class="hljs-title function_">getItem</span>(),
    <span class="hljs-attr">isDragging</span>: monitor.<span class="hljs-title function_">isDragging</span>()
  }));

  <span class="hljs-comment">// æ²¡æœ‰æ‹–åŠ¨æ—¶ä¸æ¸²æŸ“</span>
  <span class="hljs-keyword">if</span> (!isDragging) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

  <span class="hljs-comment">// æ‹–åŠ¨æ—¶æ˜¾ç¤ºè‡ªå®šä¹‰æç¤º</span>
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
      <span class="hljs-attr">position:</span> '<span class="hljs-attr">fixed</span>',
      <span class="hljs-attr">zIndex:</span> <span class="hljs-attr">9999</span>,
      <span class="hljs-attr">pointerEvents:</span> '<span class="hljs-attr">none</span>',
      <span class="hljs-attr">left:</span> <span class="hljs-attr">0</span>,
      <span class="hljs-attr">top:</span> <span class="hljs-attr">0</span>,
      <span class="hljs-attr">width:</span> '<span class="hljs-attr">100</span>%',
      <span class="hljs-attr">height:</span> '<span class="hljs-attr">100</span>%',
      <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>',
      <span class="hljs-attr">alignItems:</span> '<span class="hljs-attr">center</span>',
      <span class="hljs-attr">justifyContent:</span> '<span class="hljs-attr">center</span>'
    }}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> <span class="hljs-attr">20</span>, <span class="hljs-attr">backgroundColor:</span> '<span class="hljs-attr">rgba</span>(<span class="hljs-attr">0</span>,<span class="hljs-attr">0</span>,<span class="hljs-attr">0</span>,<span class="hljs-attr">0.7</span>)', <span class="hljs-attr">color:</span> '<span class="hljs-attr">white</span>' }}&gt;</span>
        æ­£åœ¨æ‹–åŠ¨ï¼š{item.title}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">CustomDragLayer</span>;
</code></pre>
<p>è¿™ä¸ªè‡ªå®šä¹‰æ‹–åŠ¨å±‚ä¼šåœ¨æ‹–åŠ¨æ—¶æ˜¾ç¤ºä¸€ä¸ªå±…ä¸­çš„æç¤ºæ¡†ï¼Œæ˜¾ç¤ºå½“å‰æ‹–åŠ¨çš„ä»»åŠ¡æ ‡é¢˜ï¼Œä¸”ä¸ä¼šå½±å“å…¶ä»–ç»„ä»¶çš„äº¤äº’ï¼ˆpointerEvents: 'none'ç¡®ä¿ç‚¹å‡»äº‹ä»¶èƒ½ç©¿é€åˆ°ä¸‹å±‚ç»„ä»¶ï¼‰ã€‚</p>
<h4 data-id="heading-29">useDragDropManagerï¼šè·å–æ‹–æ”¾ç®¡ç†å™¨å®ä¾‹</h4>
<p>DragDropManageræ˜¯React-DnDçš„æ ¸å¿ƒå•ä¾‹å¯¹è±¡ï¼ŒåŒ…å«äº†æ‹–æ”¾ç³»ç»Ÿçš„çŠ¶æ€ã€ç›‘æ§å™¨ã€åç«¯ç­‰æ ¸å¿ƒèµ„æºã€‚useDragDropManageré’©å­ç”¨äºè·å–è¿™ä¸ªå®ä¾‹ï¼Œä¸€èˆ¬ç”¨äºè‡ªå®šä¹‰åç«¯æˆ–é«˜çº§æ‰©å±•åœºæ™¯ï¼ˆå¦‚æ‰‹åŠ¨è§¦å‘æ‹–æ”¾äº‹ä»¶ï¼‰ã€‚</p>
<h5 data-id="heading-30">åŸºæœ¬ç”¨æ³•</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { useDragDropManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dnd'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">AdvancedComponent</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> manager = <span class="hljs-title function_">useDragDropManager</span>();
  <span class="hljs-comment">// å¯ä»¥é€šè¿‡managerè·å–ç›‘æ§å™¨ã€åç«¯ç­‰èµ„æº</span>
  <span class="hljs-keyword">const</span> monitor = manager.<span class="hljs-title function_">getMonitor</span>();

  <span class="hljs-comment">// é«˜çº§ç”¨æ³•ï¼šæ‰‹åŠ¨ç›‘å¬æ‹–åŠ¨çŠ¶æ€å˜åŒ–</span>
  <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> unsubscribe = monitor.<span class="hljs-title function_">subscribeToStateChange</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ‹–æ”¾çŠ¶æ€å˜åŒ–ï¼š'</span>, monitor.<span class="hljs-title function_">isDragging</span>());
    });
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">unsubscribe</span>();
  }, [monitor]);

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>é«˜çº§æ‰©å±•ç»„ä»¶<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p>å¯¹äºå¤§å¤šæ•°æ™®é€šå¼€å‘åœºæ™¯ï¼Œæˆ‘ä»¬å¾ˆå°‘ä¼šç›´æ¥ä½¿ç”¨useDragDropManagerï¼Œé™¤ééœ€è¦æ·±åº¦å®šåˆ¶React-DnDçš„è¡Œä¸ºã€‚</p>
<h2 data-id="heading-31">ä¸‰ã€æ€»ç»“</h2>
<p>è¿™ä¸€ç¯‡æˆ‘ä»¬æ·±å…¥è®²è§£äº†React-DnDçš„æ ¸å¿ƒç»„ä»¶å’ŒHooksï¼Œæ ¸å¿ƒè¦ç‚¹æ€»ç»“å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>ç»„ä»¶</strong>ï¼šDndProvideræ˜¯åŸºç¡€ï¼ˆæä¾›æ‹–æ”¾ä¸Šä¸‹æ–‡ï¼‰ï¼ŒDragPreviewImageç”¨äºè‡ªå®šä¹‰é¢„è§ˆã€‚</li>
<li><strong>Hooks</strong>ï¼šuseDragå®šä¹‰æ‹–åŠ¨æºï¼ŒuseDropå®šä¹‰æ‹–æ”¾ç›®æ ‡ï¼Œä¸¤è€…é€šè¿‡typeå’ŒacceptåŒ¹é…ï¼›useDragLayerç”¨äºå…¨å±€é¢„è§ˆï¼ŒuseDragDropManagerç”¨äºé«˜çº§æ‰©å±•ã€‚</li>
<li><strong>æ ¸å¿ƒé€»è¾‘</strong>ï¼šæ‹–åŠ¨æºé€šè¿‡itemä¼ é€’æ•°æ®ï¼Œæ‹–æ”¾ç›®æ ‡é€šè¿‡dropæ¥æ”¶æ•°æ®ï¼Œä¸¤è€…é€šè¿‡monitorå®ç°çŠ¶æ€é€šä¿¡ã€‚</li>
</ul>
<p>æŒæ¡äº†è¿™äº›å†…å®¹ï¼Œä½ å·²ç»èƒ½å®ç°å¤§å¤šæ•°å¸¸è§çš„æ‹–æ”¾åœºæ™¯äº†ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Rust RefCell å¤šçº¿ç¨‹è¯»ä¸ºä»€ä¹ˆä¹Ÿpanicäº†ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7572459757107003446</link>    <guid>https://juejin.cn/post/7572459757107003446</guid>    <pubDate>2025-11-15T08:36:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572459757107003446" data-draft-id="7572408522438770723" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Rust RefCell å¤šçº¿ç¨‹è¯»ä¸ºä»€ä¹ˆä¹Ÿpanicäº†ï¼Ÿ"/> <meta itemprop="keywords" content="Rust,Swift"/> <meta itemprop="datePublished" content="2025-11-15T08:36:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="éä¸“ä¸šç¨‹åºå‘˜"/> <meta itemprop="url" content="https://juejin.cn/user/1968539883540688"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Rust RefCell å¤šçº¿ç¨‹è¯»ä¸ºä»€ä¹ˆä¹Ÿpanicäº†ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1968539883540688/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    éä¸“ä¸šç¨‹åºå‘˜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T08:36:01.000Z" title="Sat Nov 15 2025 08:36:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿™æ˜¯æœ€è¿‘å®æˆ˜ä¸­é‡åˆ°çš„ä¸€ä¸ªå°çŸ¥è¯†ç‚¹ï¼Œæ²¡ç†è§£ä¹‹å‰è§‰å¾—ã€Œä¸å¯èƒ½ã€ï¼Œååº”è¿‡æ¥ä¹‹åï¼Œè§‰å¾—è‡ªå·±å¾ˆè ¢ğŸ¤£ï¼Œå€Ÿæœ¬æ–‡è®°å½•ä¸‹ã€‚</p>
<p>çœ‹ä¸€æ®µå¤ç°ä»£ç ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">MyRefCell</span>&lt;T&gt;(RefCell&lt;T&gt;);

<span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">impl</span>&lt;T&gt; <span class="hljs-built_in">Sync</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">MyRefCell</span>&lt;T&gt; {}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">shared</span> = Arc::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-title function_ invoke__">MyRefCell</span>(RefCell::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">0usize</span>)));

    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">handles</span> = <span class="hljs-type">Vec</span>::<span class="hljs-title function_ invoke__">new</span>();
    <span class="hljs-keyword">for</span> <span class="hljs-variable">i</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..<span class="hljs-number">100</span> {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">s</span> = shared.<span class="hljs-title function_ invoke__">clone</span>();
        handles.<span class="hljs-title function_ invoke__">push</span>(thread::<span class="hljs-title function_ invoke__">spawn</span>(<span class="hljs-keyword">move</span> || {
            thread::<span class="hljs-title function_ invoke__">sleep</span>(Duration::<span class="hljs-title function_ invoke__">from_millis</span>(<span class="hljs-number">10</span> * (i % <span class="hljs-number">3</span>) <span class="hljs-keyword">as</span> <span class="hljs-type">u64</span>));
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">r</span> = s.<span class="hljs-number">0</span>.<span class="hljs-title function_ invoke__">borrow</span>();
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">r</span> = s.<span class="hljs-number">0</span>.<span class="hljs-title function_ invoke__">borrow_mut</span>();
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"thread {} read {}"</span>, i, *r);
        }));
    }

    <span class="hljs-keyword">for</span> <span class="hljs-variable">h</span> <span class="hljs-keyword">in</span> handles {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">_</span> = h.<span class="hljs-title function_ invoke__">join</span>();
    }

    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"done"</span>);
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdb1d630973d4253920f3296f26817bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2e5LiT5Lia56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763800560&amp;x-signature=M8csQtTR9rxEkrcsXq1ZrsHWAeA%3D" alt="" loading="lazy"/></p>
<p><strong>â€‹å¤šçº¿ç¨‹è¯»ä¸€ä¸ªRefCellå°è£…çš„å˜é‡ï¼Œå´å‘ç”Ÿäº†panicï¼ŒåŸå› æ˜¯ï¼šâ€‹</strong>â€‹**<code>already mutably borrowed: BorrowError</code>**</p>
<p>å³ RefCellä¿®é¥°çš„å˜é‡åœ¨borrowæ—¶æ£€æµ‹åˆ°å·²ç»borrow_mutäº†ï¼Œä½†æ˜¯ä»£ç é‡Œå…¶å®<strong>æ²¡æœ‰borrow_mut</strong>çš„åœ°æ–¹ï¼Œå°±å¾ˆç¥å¥‡ã€‚</p>
<p>å¦ä¸€ä¸ªè¿·æƒ‘çš„åœ°æ–¹æ˜¯ï¼Œ<strong>å¤šçº¿ç¨‹è¯»å˜é‡å±…ç„¶ä¹Ÿæ˜¯ä¸å®‰å…¨çš„ï¼Œä¹Ÿä¼španicã€‚</strong></p>
<p>æˆ–è®¸æœ‰å°ä¼™ä¼´ä¸ç†è§£RefCellï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸‹ï¼š</p>
<p>Rustçš„å€Ÿç”¨æ£€æŸ¥ä¸€èˆ¬åœ¨ç¼–è¯‘æœŸï¼Œå³ä¸€ä¸ªå¯å˜å€Ÿç”¨ï¼ˆ<code>&amp;mut T</code>ï¼‰åŒæ—¶åªèƒ½å­˜åœ¨ä¸€ä¸ªï¼Œä¸å¯å˜å€Ÿç”¨ï¼ˆ<code>&amp;T</code>ï¼‰å’Œå¯å˜å€Ÿç”¨ä¸èƒ½å…±å­˜ï¼›ä½†åœ¨å®é™…åœºæ™¯ä¸­ï¼Œå€Ÿç”¨å…³ç³»å¾€å¾€å¾ˆéš¾åœ¨ç¼–è¯‘æœŸæ»¡è¶³ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ç”¨RefCellï¼ŒRefCellæä¾›ä¸¤ä¸ªæ“ä½œç¬¦ï¼š<code>borrow()</code>å’Œ<code>borrow_mut()</code>ï¼Œæ”¯æŒåœ¨â€‹<strong>è¿è¡Œæ—¶æ£€æŸ¥å€Ÿç”¨å…³ç³»</strong>â€‹ï¼Œå¦‚æœè¿è¡Œæ—¶è¿æ³•å€Ÿç”¨è§„åˆ™ï¼Œä¼španicã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­ï¼Œå…¶å®â€‹<strong>æ²¡æœ‰è¿åå€Ÿç”¨è§„åˆ™</strong>â€‹ï¼Œå› ä¸ºæˆ‘ä»¬åªæœ‰ä¸å¯å˜å€Ÿç”¨ï¼Œä½†è¿˜æ˜¯panicäº†ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>åŸå› åœ¨äºRefCell <code>borrow()</code> çš„â€‹<strong>åº•å±‚å®ç°ä¸æ˜¯åŸå­çš„</strong>â€‹ï¼Œçœ‹ç€æ˜¯å¤šçº¿ç¨‹è¯»ï¼Œå…¶å®å†…éƒ¨å­˜åœ¨å†™æ“ä½œï¼Œå˜æˆäº†â€‹<strong>éšè—çš„å¤šçº¿ç¨‹å†™</strong>â€‹ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ed85f258d854f608e62b3ec7d6254b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2e5LiT5Lia56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763800560&amp;x-signature=CR4KnxcSgDtIEN%2FUIjlGtibM7%2BM%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbc012ca460c4a6e8e1980076cb7e110~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2e5LiT5Lia56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763800560&amp;x-signature=LEINKxr%2BFBLaUVq08kJqi83vzOU%3D" alt="" loading="lazy"/></p>
<p>å¯ä»¥çœ‹å‡º<code>borrow()</code>å’Œ<code>borrow_mut()</code>å†…éƒ¨å®ç°å­˜åœ¨å†™æ“ä½œï¼Œå¤šçº¿ç¨‹è®¿é—®æ—¶ï¼Œflag çŠ¶æ€ç®¡ç†å¯èƒ½å‡ºé”™ï¼Œå¯¼è‡´panicã€‚</p>
<p><strong>åŒæ ·çš„é—®é¢˜ï¼Œåœ¨Swiftä¸­ï¼Œå¦‚æœæ˜¯å¤šçº¿ç¨‹è¯»ä¸€ä¸ªå˜é‡ï¼Œæ˜¯å®‰å…¨çš„å—ï¼Ÿ</strong></p>
<p>ç­”æ¡ˆæˆ‘ä»¬å°†åœ¨å…¬ä¼—å·ã€Œéä¸“ä¸šç¨‹åºå‘˜Pingã€çš„ä¸‹ä¸€æœŸæ–‡ç« æ­æ™“ï¼Œæ¬¢è¿è®¢é˜…äº¤æµï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Rust ndarray é«˜æ€§èƒ½è®¡ç®—ï¼šä»å…ƒç´ æ“ä½œåˆ°çŸ©é˜µè¿ç®—çš„ä¼˜åŒ–å®è·µ]]></title>    <link>https://juejin.cn/post/7572524368876355619</link>    <guid>https://juejin.cn/post/7572524368876355619</guid>    <pubDate>2025-11-15T08:05:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572524368876355619" data-draft-id="7572454929144365091" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Rust ndarray é«˜æ€§èƒ½è®¡ç®—ï¼šä»å…ƒç´ æ“ä½œåˆ°çŸ©é˜µè¿ç®—çš„ä¼˜åŒ–å®è·µ"/> <meta itemprop="keywords" content="Rust,äººå·¥æ™ºèƒ½,ç¬”è®°"/> <meta itemprop="datePublished" content="2025-11-15T08:05:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å—ä¹‹ä»¥è’™"/> <meta itemprop="url" content="https://juejin.cn/user/4186572019737624"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Rust ndarray é«˜æ€§èƒ½è®¡ç®—ï¼šä»å…ƒç´ æ“ä½œåˆ°çŸ©é˜µè¿ç®—çš„ä¼˜åŒ–å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4186572019737624/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å—ä¹‹ä»¥è’™
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T08:05:42.000Z" title="Sat Nov 15 2025 08:05:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Rust ndarray é«˜æ€§èƒ½è®¡ç®—ï¼šä»å…ƒç´ æ“ä½œåˆ°çŸ©é˜µè¿ç®—çš„ä¼˜åŒ–å®è·µ</h2>
<h3 data-id="heading-1">ä¸€ã€è¿­ä»£ä¸æ˜ å°„ï¼šç”¨ mapv é‡Šæ”¾å…ƒç´ çº§å¤„ç†æ½œåŠ›</h3>
<p>åœ¨ Rust çš„ <code>ndarray</code> åº“ä¸­ï¼Œè¿­ä»£ä¸æ˜ å°„æ˜¯å¯¹æ•°ç»„å…ƒç´ è¿›è¡Œæ“ä½œçš„åŸºç¡€ã€‚</p>
<p>é€šè¿‡çµæ´»è¿ç”¨è¿™äº›æ“ä½œï¼Œå¯ä»¥é«˜æ•ˆåœ°å¤„ç†æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå®ç°å„ç§å¤æ‚çš„æ•°æ®å¤„ç†ä»»åŠ¡ã€‚</p>
<h4 data-id="heading-2">1.1 mapv åŸºç¡€ï¼šé€å…ƒç´ æ˜ å°„ä¸ç±»å‹è½¬æ¢</h4>
<p><code>mapv</code>æ˜¯ <code>ndarray</code> ä¸­é«˜æ•ˆçš„å…ƒç´ çº§æ˜ å°„å·¥å…·ï¼Œæ¥æ”¶é—­åŒ…ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸åŸæ•°ç»„ç»´åº¦ç›¸åŒçš„æ–°æ•°ç»„ã€‚ä¸æƒ°æ€§çš„<code>map</code>ä¸åŒï¼Œ<code>mapv</code>ç«‹å³åˆ†é…å†…å­˜å¹¶è®¡ç®—ç»“æœï¼Œé€‚åˆéœ€è¦æ–°æ•°ç»„çš„åœºæ™¯ã€‚</p>
<pre><code class="hljs language-rust" lang="rust">
<span class="hljs-keyword">use</span> ndarray::array;

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">sensor_readings</span> = array![<span class="hljs-number">102.3</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">511.5</span>, <span class="hljs-number">1023.0f64</span>];

    <span class="hljs-comment">// ä½¿ç”¨ mapv è¿›è¡Œå½’ä¸€åŒ–</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">normalized</span> = sensor_readings.<span class="hljs-title function_ invoke__">mapv</span>(|x| x / <span class="hljs-number">1023.0</span>);

    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"åŸå§‹è¯»æ•°: \n{}"</span>, sensor_readings);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"å½’ä¸€åŒ–å: \n{}"</span>, normalized);

    <span class="hljs-comment">// ä¹Ÿå¯ä»¥æ‰§è¡Œæ›´å¤æ‚çš„æ“ä½œï¼Œæ¯”å¦‚ Sigmoid</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">activations</span> = normalized.<span class="hljs-title function_ invoke__">mapv</span>(|x| <span class="hljs-number">1.0</span> / (<span class="hljs-number">1.0</span> + (-x).<span class="hljs-title function_ invoke__">exp</span>()));
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æ¿€æ´»å€¼: \n{}"</span>, activations);
}
</code></pre>
<p><strong>è¾“å‡ºï¼š</strong></p>
<pre><code class="hljs language-shell" lang="shell">åŸå§‹è¯»æ•°:
[102.3, 0, 511.5, 1023]
å½’ä¸€åŒ–å:
[0.09999999999999999, 0, 0.5, 1]
æ¿€æ´»å€¼:
[0.5249791874789399, 0.5, 0.6224593312018546, 0.7310585786300049]
</code></pre>
<p>åœ¨å…·èº«æ™ºèƒ½åœºæ™¯ä¸­ï¼Œå½“å¤„ç†ä¼ æ„Ÿå™¨æ•°æ®æ—¶ï¼Œ<code>mapv</code>å¯ç”¨äºå¯¹ä¼ æ„Ÿå™¨è¯»æ•°è¿›è¡Œé¢„å¤„ç†ã€‚</p>
<p>æ¯”å¦‚ï¼Œå°†æ¸©åº¦ä¼ æ„Ÿå™¨çš„åŸå§‹è¯»æ•°ä»æ‘„æ°åº¦è½¬æ¢ä¸ºåæ°åº¦ï¼Œæˆ–è€…å¯¹å‹åŠ›ä¼ æ„Ÿå™¨æ•°æ®è¿›è¡Œæ ¡å‡†ã€‚</p>
<h4 data-id="heading-3">1.2 å¹¶è¡ŒåŠ é€Ÿï¼špar_mapv_inplace åº”å¯¹å¤§è§„æ¨¡æ•°æ®</h4>
<p>å€ŸåŠ© rayon åº“ï¼Œ<code>par_mapv_inplace</code>æ”¯æŒå¤šæ ¸å¹¶è¡Œå¤„ç†ï¼Œæ˜¾è‘—æå‡è®¡ç®—å¯†é›†å‹ä»»åŠ¡æ•ˆç‡ï¼ˆéœ€å¯ç”¨<code>rayon</code>ç‰¹æ€§ï¼‰ã€‚</p>
<p><code>par_mapv_inplace</code> è¢«ç§°ä¹‹ä¸º<strong>å°±åœ°å¹¶è¡Œä¿®æ”¹</strong>ï¼Œ æ˜¯ <code>ndarray</code> æä¾›çš„æœ€ç›´æ¥çš„å¹¶è¡Œ <code>map</code> æ–¹æ³•ã€‚å®ƒä¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå¹¶è¡Œåœ°ä¿®æ”¹æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œä¸è¿”å›ä»»ä½•ä¸œè¥¿ (())ã€‚</p>
<p>Cargo.tomlé…ç½®ï¼š</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[dependencies]</span>
<span class="hljs-attr">ndarray</span> = { version = <span class="hljs-string">"0.17.1"</span>, features = [<span class="hljs-string">"rayon"</span>] }
</code></pre>
<pre><code class="hljs language-rust" lang="rust">
<span class="hljs-keyword">use</span> ndarray::Array3;

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">matrix</span> =
        Array3::<span class="hljs-title function_ invoke__">from_shape_vec</span>((<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>), <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1.0f64</span>, <span class="hljs-number">2.0</span>, <span class="hljs-number">3.0</span>, <span class="hljs-number">4.0</span>, <span class="hljs-number">5.0</span>, <span class="hljs-number">6.0</span>, <span class="hljs-number">7.0</span>, <span class="hljs-number">8.0</span>]).<span class="hljs-title function_ invoke__">unwrap</span>();
    <span class="hljs-comment">// å¹¶è¡Œè®¡ç®—æ¯ä¸ªå…ƒç´ çš„å¹³æ–¹</span>
    matrix.<span class="hljs-title function_ invoke__">par_mapv_inplace</span>(|x| x.<span class="hljs-title function_ invoke__">powi</span>(<span class="hljs-number">2</span>));
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"å¹¶è¡Œè®¡ç®—å€¼: \n{}"</span>, matrix);
}
</code></pre>
<p><strong>è¾“å‡ºï¼š</strong></p>
<pre><code class="hljs language-shell" lang="shell">å¹¶è¡Œè®¡ç®—å€¼:
[[[1, 4],
  [9, 16]],

 [[25, 36],
  [49, 64]]]
</code></pre>
<h3 data-id="heading-4">äºŒã€å…ƒç´ çº§è¿ç®—ï¼šç®€æ´é«˜æ•ˆçš„é€å…ƒç´ æ“ä½œ</h3>
<p>å…ƒç´ çº§è¿ç®—æ˜¯ <code>ndarray</code> çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œå®ƒå…è®¸æˆ‘ä»¬å¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œæ“ä½œï¼Œè€Œæ— éœ€æ˜¾å¼çš„å¾ªç¯ã€‚</p>
<p>è¿™ç§å‘é‡åŒ–çš„æ“ä½œæ–¹å¼ä¸ä»…æé«˜äº†ä»£ç çš„ç®€æ´æ€§ï¼Œè¿˜æ˜¾è‘—æå‡äº†æ‰§è¡Œæ•ˆç‡ã€‚</p>
<h4 data-id="heading-5">2.1 åŸºç¡€ç®—æœ¯è¿ç®—ï¼šè¿ç®—ç¬¦ä¸å‡½æ•°åŒæ”¯æŒ</h4>
<p><code>ndarray</code> æ”¯æŒç›´æ¥ä½¿ç”¨<code>+</code>ã€<code>-</code>ã€<code>*</code>ã€<code>/</code>è¿›è¡Œå…ƒç´ çº§è¿ç®—ï¼Œæ“ä½œç®€å•ç›´è§‚ï¼Œä»£ç å¯è¯»æ€§å¼ºã€‚è¿™äº›è¿ç®—ç¬¦ä¼šè‡ªåŠ¨åº”ç”¨åˆ°æ•°ç»„çš„æ¯ä¸ªå…ƒç´ ä¸Šï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„æ•°ç»„ã€‚</p>
<p>åŒæ—¶ï¼Œ<code>ndarray</code> ä¹Ÿæä¾›äº†<code>add</code>ã€<code>sub</code>ã€<code>mul</code>ã€<code>div</code>ç­‰å‡½æ•°æ¥å®ç°ç›¸åŒçš„è¿ç®—ã€‚ä½¿ç”¨å‡½æ•°å½¢å¼å¯ä»¥åœ¨ä¸€äº›éœ€è¦æ›´çµæ´»æ“ä½œçš„åœºæ™¯ä¸­ï¼Œç¡®ä¿ç±»å‹å®‰å…¨å’Œæ›´å¥½çš„é”™è¯¯å¤„ç†ã€‚</p>
<pre><code class="hljs language-rust" lang="rust">
<span class="hljs-keyword">use</span> ndarray::array;
<span class="hljs-keyword">use</span> std::ops::Mul;

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">a</span> = array![[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]];
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">b</span> = array![[<span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>], [<span class="hljs-number">10</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span>]];

    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">a_clone</span> = a.<span class="hljs-title function_ invoke__">clone</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">b_clone</span> = b.<span class="hljs-title function_ invoke__">clone</span>();
    <span class="hljs-comment">// ä½¿ç”¨è¿ç®—ç¬¦è¿›è¡Œå…ƒç´ çº§åŠ æ³•</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">c</span> = a + b;
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"ç›¸åŠ : \n{}"</span>, c);

    <span class="hljs-comment">// ä½¿ç”¨å‡½æ•°è¿›è¡Œå…ƒç´ çº§ä¹˜æ³•</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">d</span> = a_clone.<span class="hljs-title function_ invoke__">mul</span>(&amp;b_clone);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"ç›¸ä¹˜: \n{}"</span>, d);
}
</code></pre>
<p><strong>è¾“å‡ºï¼š</strong></p>
<pre><code class="hljs language-shell" lang="shell">ç›¸åŠ :
[[8, 10, 12],
 [14, 16, 18]]
ç›¸ä¹˜:
[[7, 16, 27],
 [40, 55, 72]]
</code></pre>
<h4 data-id="heading-6">2.2 æ•°å­¦å‡½æ•°åº”ç”¨ï¼šä»åŸºç¡€åˆ°å¤æ‚è¿ç®—</h4>
<p><code>ndarray</code> æ”¯æŒ<code>sqrt</code>ã€<code>sin</code>ã€<code>cos</code>ç­‰ä¸°å¯Œçš„æ•°å­¦å‡½æ•°ï¼Œè¿™äº›å‡½æ•°å¯ä»¥ç›´æ¥ä½œç”¨äºæ•°ç»„çš„æ¯ä¸ªå…ƒç´ ï¼Œé¿å…äº†æ‰‹åŠ¨è¿­ä»£æ•°ç»„æ¥åº”ç”¨è¿™äº›å‡½æ•°çš„ç¹çè¿‡ç¨‹ã€‚</p>
<pre><code class="hljs language-rust" lang="rust">
<span class="hljs-keyword">use</span> ndarray::prelude::*;

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">a</span> = array![<span class="hljs-number">1.0</span>, <span class="hljs-number">4.0</span>, <span class="hljs-number">9.0</span>];
    <span class="hljs-comment">// è®¡ç®—æ¯ä¸ªå…ƒç´ çš„å¹³æ–¹æ ¹</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">b</span> = a.<span class="hljs-title function_ invoke__">sqrt</span>();
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"å¹³æ–¹æ ¹: \n{}"</span>, b);

    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">angles</span> = array![<span class="hljs-number">0.0</span>, std::<span class="hljs-type">f64</span>::consts::PI / <span class="hljs-number">2.0</span>, std::<span class="hljs-type">f64</span>::consts::PI];
    <span class="hljs-comment">// è®¡ç®—æ¯ä¸ªè§’åº¦çš„æ­£å¼¦å€¼</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">sines</span> = angles.<span class="hljs-title function_ invoke__">sin</span>();
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æ­£å¼¦å€¼: \n{}"</span>, sines);
}
</code></pre>
<p><strong>è¾“å‡ºï¼š</strong></p>
<pre><code class="hljs language-shell" lang="shell">å¹³æ–¹æ ¹:
[1, 2, 3]
æ­£å¼¦å€¼:
[0, 1, 0.00000000000000012246467991473532]
</code></pre>
<h3 data-id="heading-7">ä¸‰ã€å¹¿æ’­æœºåˆ¶ï¼šç»´åº¦é€‚é…çš„éšå½¢åŠ©æ‰‹</h3>
<p>åœ¨ <code>ndarray</code> çš„ä¸–ç•Œé‡Œï¼Œå¹¿æ’­æœºåˆ¶æ˜¯ä¸€ç§å¼ºå¤§è€Œåˆç¥å¥‡çš„ç‰¹æ€§ï¼Œå®ƒå…è®¸ä¸åŒå½¢çŠ¶çš„æ•°ç»„åœ¨è¿›è¡Œè¿ç®—æ—¶è‡ªåŠ¨é€‚é…ç»´åº¦ï¼Œå¤§å¤§ç®€åŒ–äº†ä»£ç çš„ç¼–å†™ã€‚</p>
<h4 data-id="heading-8">3.1 å¹¿æ’­è§„åˆ™ï¼šä»åç¼˜ç»´åº¦å¯¹é½åˆ°è‡ªåŠ¨æ‰©å±•</h4>
<p><code>ndarray</code> å¹¿æ’­éµå¾ªã€Œåç¼˜å¯¹é½ã€åŸåˆ™ï¼Œå½“ä¸¤ä¸ªæ•°ç»„è¿›è¡Œè¿ç®—æ—¶ï¼Œå¦‚æœå®ƒä»¬çš„ç»´åº¦æ•°ä¸åŒï¼Œ<code>ndarray</code> ä¼šåœ¨è¾ƒå°æ•°ç»„çš„å‰é¢è¡¥ 1ï¼Œä½¿å…¶ç»´åº¦æ•°ä¸è¾ƒå¤§æ•°ç»„ç›¸åŒã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸€ä¸ªå½¢çŠ¶ä¸º (5, 3) çš„æ•°ç»„ä¸ä¸€ä¸ªå½¢çŠ¶ä¸º (3,) çš„æ•°ç»„è¿›è¡Œå¹¿æ’­æ—¶ï¼Œå½¢çŠ¶ä¸º (3,) çš„æ•°ç»„ä¼šè¢«è§†ä¸º (1, 3)ï¼Œç„¶åå†ä¸ (5, 3) è¿›è¡Œå¯¹é½ï¼Œæœ€ç»ˆå¹¿æ’­ä¸º (5, 3)ã€‚</p>
<p>åœ¨ç»´åº¦å¯¹é½åï¼Œå•ç»´åº¦ï¼ˆé•¿åº¦ä¸º 1ï¼‰çš„ç»´åº¦ä¼šè‡ªåŠ¨å¤åˆ¶æ‰©å±•ï¼Œä»¥åŒ¹é…å¦ä¸€ä¸ªæ•°ç»„çš„ç»´åº¦ã€‚è¿™ç§æ‰©å±•æ˜¯é€»è¾‘ä¸Šçš„ï¼Œæ— éœ€æ˜¾å¼çš„æ•°æ®å¤åˆ¶ï¼Œå› æ­¤æ•ˆç‡éå¸¸é«˜ã€‚</p>
<h4 data-id="heading-9">3.2 å®æˆ˜åœºæ™¯ï¼šç¯å¢ƒå¸¸æ•°å¹¿æ’­ä¸çŠ¶æ€è®¡ç®—</h4>
<p>åœ¨å…·èº«æ™ºèƒ½çš„åº”ç”¨ä¸­ï¼Œå°†ç¯å¢ƒå¸¸æ•°å¹¿æ’­åˆ°æ‰€æœ‰çŠ¶æ€å‘é‡æ˜¯ä¸€ä¸ªå¸¸è§çš„éœ€æ±‚ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæœºå™¨äººï¼Œå®ƒåœ¨ä¸åŒçš„çŠ¶æ€ä¸‹éœ€è¦è€ƒè™‘é‡åŠ›åŠ é€Ÿåº¦çš„å½±å“ã€‚é‡åŠ›åŠ é€Ÿåº¦æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶å¹¿æ’­åˆ°æœºå™¨äººçš„æ‰€æœ‰çŠ¶æ€å‘é‡ä¸Šï¼Œä»è€Œåœ¨è®¡ç®—ä¸­è€ƒè™‘é‡åŠ›çš„ä½œç”¨ã€‚</p>
<pre><code class="hljs language-rust" lang="rust">
<span class="hljs-keyword">use</span> ndarray::array;

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-comment">// å®šä¹‰é‡åŠ›åŠ é€Ÿåº¦ (1,)</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">gravity</span> = array![<span class="hljs-number">9.81</span>]; 

    <span class="hljs-comment">// å‡è®¾æœºå™¨äººæœ‰ä¸‰ä¸ªçŠ¶æ€ï¼Œæ¯ä¸ªçŠ¶æ€åŒ…å«ä½ç½®å’Œé€Ÿåº¦ä¿¡æ¯ (3, 2, 2)</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">states</span> = array![
        [[<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>], [<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>]],
        [[<span class="hljs-number">2.0</span>, <span class="hljs-number">2.0</span>], [<span class="hljs-number">3.0</span>, <span class="hljs-number">3.0</span>]],
        [[<span class="hljs-number">4.0</span>, <span class="hljs-number">4.0</span>], [<span class="hljs-number">5.0</span>, <span class="hljs-number">5.0</span>]]
    ]; 

    <span class="hljs-comment">// å°†é‡åŠ›åŠ é€Ÿåº¦å¹¿æ’­åˆ°æ‰€æœ‰çŠ¶æ€å‘é‡ä¸Š</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">new_states</span> = states + gravity; 
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"New states:\n {:?}"</span>, new_states); 
}
</code></pre>
<p><strong>è¾“å‡ºï¼š</strong></p>
<pre><code class="hljs language-shell" lang="shell">New states:
 [[[9.81, 9.81],
  [10.81, 10.81]],

 [[11.81, 11.81],
  [12.81, 12.81]],

 [[13.81, 13.81],
  [14.81, 14.81]]], shape=[3, 2, 2], strides=[4, 2, 1], layout=Cc (0x5), const ndim=3
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>gravity</code>æ˜¯ä¸€ä¸ªå½¢çŠ¶ä¸º (1,) çš„æ•°ç»„ï¼Œ<code>states</code>æ˜¯ä¸€ä¸ªå½¢çŠ¶ä¸º (3, 2, 2) çš„æ•°ç»„ã€‚é€šè¿‡å¹¿æ’­æœºåˆ¶ï¼Œ<code>gravity</code>ä¼šè‡ªåŠ¨æ‰©å±•ä¸º (3, 2, 2) çš„å½¢çŠ¶ï¼Œä¸<code>states</code>è¿›è¡ŒåŒ¹é…ï¼Œç„¶åè¿›è¡Œå…ƒç´ çº§åŠ æ³•è¿ç®—ã€‚</p>
<h3 data-id="heading-10">å››ã€è¿æ¥ä¸å †å ï¼šçµæ´»ç»„åˆå¤šç»´æ•°æ®</h3>
<p>åœ¨å¤„ç†å¤šç»´æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦å°†å¤šä¸ªæ•°ç»„åˆå¹¶æˆä¸€ä¸ªæ›´å¤§çš„æ•°ç»„ï¼Œæˆ–è€…å°†ä¸€ä¸ªæ•°ç»„åˆ†å‰²æˆå¤šä¸ªå°æ•°ç»„ã€‚ndarray æä¾›äº†<code>stack</code>å’Œ<code>concatenate</code>å‡½æ•°æ¥æ»¡è¶³è¿™äº›éœ€æ±‚ï¼Œå®ƒä»¬åœ¨å…·èº«æ™ºèƒ½ä¸­ä¹Ÿæœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼Œæ¯”å¦‚åœ¨æ‰¹é‡ç”Ÿæˆæ§åˆ¶ä¿¡å·æ—¶ï¼Œå°±éœ€è¦å°†å¤šä¸ªæ§åˆ¶ä¿¡å·æ•°ç»„åˆå¹¶æˆä¸€ä¸ªå¤§çš„æ•°ç»„ã€‚</p>
<h4 data-id="heading-11">4.1 concatenateï¼šæ²¿ç°æœ‰è½´è¿æ¥æ•°ç»„</h4>
<p><code>concatenate</code>å‡½æ•°æ˜¯æ²¿æŒ‡å®šè½´è¿æ¥æ•°ç»„ï¼Œå®ƒå…è®¸è¾“å…¥æ•°ç»„åœ¨å…¶ä»–è½´ä¸Šçš„å½¢çŠ¶ä¸€è‡´ï¼Œåªæœ‰è¿æ¥è½´ä¸Šçš„é•¿åº¦å¯ä»¥ä¸åŒã€‚è¿™ä½¿å¾—<code>concatenate</code>åœ¨åˆå¹¶å…·æœ‰ä¸åŒé•¿åº¦ä½†ç›¸åŒç»“æ„çš„æ•°æ®æ—¶éå¸¸çµæ´»ã€‚</p>
<pre><code class="hljs language-rust" lang="rust">
<span class="hljs-keyword">use</span> ndarray::array;
<span class="hljs-keyword">use</span> ndarray::Axis;

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">a</span> = array![[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]];
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">b</span> = array![[<span class="hljs-number">5</span>, <span class="hljs-number">6</span>]];

    <span class="hljs-comment">// æ²¿è½´0è¿æ¥æ•°ç»„</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">c</span> = ndarray::<span class="hljs-title function_ invoke__">concatenate</span>(<span class="hljs-title function_ invoke__">Axis</span>(<span class="hljs-number">0</span>), &amp;[a.<span class="hljs-title function_ invoke__">view</span>(), b.<span class="hljs-title function_ invoke__">view</span>()]).<span class="hljs-title function_ invoke__">unwrap</span>();
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"concatenate axis0:\n {:?}"</span>, c);

    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">d</span> = array![[<span class="hljs-number">7</span>, <span class="hljs-number">8</span>], [<span class="hljs-number">9</span>, <span class="hljs-number">10</span>]];
    <span class="hljs-comment">// æ²¿è½´1è¿æ¥æ•°ç»„</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">e</span> = ndarray::<span class="hljs-title function_ invoke__">concatenate</span>(<span class="hljs-title function_ invoke__">Axis</span>(<span class="hljs-number">1</span>), &amp;[a.<span class="hljs-title function_ invoke__">view</span>(), d.<span class="hljs-title function_ invoke__">view</span>()]).<span class="hljs-title function_ invoke__">unwrap</span>();
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"concatenate axis1:\n {:?}"</span>, e);
}
</code></pre>
<p><strong>è¾“å‡ºï¼š</strong></p>
<pre><code class="hljs language-shell" lang="shell">concatenate axis0:
 [[1, 2],
 [3, 4],
 [5, 6]], shape=[3, 2], strides=[2, 1], layout=Cc (0x5), const ndim=2
concatenate axis1:
 [[1, 2, 7, 8],
 [3, 4, 9, 10]], shape=[2, 4], strides=[1, 2], layout=Ff (0xa), const ndim=2
</code></pre>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå½“æˆ‘ä»¬éœ€è¦å°†ä¸åŒæ—¶é—´æ®µçš„ä¼ æ„Ÿå™¨æ•°æ®è¿æ¥èµ·æ¥æ—¶ï¼Œ<code>concatenate</code>å°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p>
<p>æ¯”å¦‚ï¼Œä¸€ä¸ªæœºå™¨äººåœ¨ä¸åŒæ—¶é—´æ®µé‡‡é›†åˆ°çš„ä½ç½®æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>concatenate</code>å°†è¿™äº›æ•°æ®æŒ‰æ—¶é—´é¡ºåºè¿æ¥èµ·æ¥ï¼Œä»¥ä¾¿åˆ†ææœºå™¨äººçš„è¿åŠ¨è½¨è¿¹ã€‚</p>
<h4 data-id="heading-12">4.2 stackï¼šæ–°å¢ç»´åº¦å †å æ•°ç»„</h4>
<p><code>stack</code>å‡½æ•°ç”¨äºåœ¨æŒ‡å®šè½´ä¸Šå †å æ•°ç»„ï¼Œç”Ÿæˆä¸€ä¸ªæ›´é«˜ç»´åº¦çš„æ–°æ•°ç»„ã€‚å®ƒè¦æ±‚æ‰€æœ‰è¾“å…¥æ•°ç»„çš„å½¢çŠ¶å¿…é¡»ä¸€è‡´ï¼Œå¦åˆ™ä¼šå¯¼è‡´é”™è¯¯ã€‚é€šè¿‡<code>stack</code>ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å°†å¤šä¸ªç›¸åŒå½¢çŠ¶çš„æ•°ç»„åˆå¹¶æˆä¸€ä¸ªæ›´é«˜ç»´åº¦çš„æ•°ç»„ï¼Œè¿™åœ¨å¤„ç†å¤šä¸ªæ ·æœ¬çš„ç›¸åŒç‰¹å¾æ•°æ®æ—¶éå¸¸æœ‰ç”¨ã€‚</p>
<p>å †å  (stack) åœ¨æ¦‚å¿µä¸Šï¼Œå®Œå…¨ç­‰åŒäºä»¥ä¸‹ä¸¤æ­¥æ“ä½œï¼š</p>
<ul>
<li>
<p>â€œReshapeâ€ (å¢åŠ ç»´åº¦): å…ˆæŠŠä½ è¦å †å çš„æ¯ä¸€ä¸ªæ•°ç»„ï¼Œåœ¨ä½ æŒ‡å®šçš„ Axis ä½ç½®ä¸Šï¼Œå¢åŠ ä¸€ä¸ªå¤§å°ä¸º 1 çš„æ–°ç»´åº¦ã€‚</p>
</li>
<li>
<p>â€œConcatenateâ€ (æ‹¼æ¥): ç„¶åï¼Œæ²¿ç€é‚£ä¸ªåˆšåˆšæ–°å¢çš„ Axisï¼ŒæŠŠè¿™äº›â€œå‡ç»´â€åçš„æ•°ç»„æ‹¼æ¥èµ·æ¥ã€‚</p>
</li>
</ul>
<pre><code class="hljs language-rust" lang="rust">
<span class="hljs-keyword">use</span> ndarray::array;

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">a</span> = array![<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">b</span> = array![<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>];

    <span class="hljs-comment">// åœ¨æ–°è½´ï¼ˆè½´0ï¼‰ä¸Šå †å æ•°ç»„</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">c</span> = ndarray::<span class="hljs-title function_ invoke__">stack</span>(<span class="hljs-title function_ invoke__">Axis</span>(<span class="hljs-number">0</span>), &amp;[a.<span class="hljs-title function_ invoke__">view</span>(), b.<span class="hljs-title function_ invoke__">view</span>()]).<span class="hljs-title function_ invoke__">unwrap</span>();
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"stack axis0:\n {:?}"</span>, c);

    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">a_2d</span> = a.<span class="hljs-title function_ invoke__">insert_axis</span>(<span class="hljs-title function_ invoke__">Axis</span>(<span class="hljs-number">1</span>)); <span class="hljs-comment">// (3,1)</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">b_2d</span> = b.<span class="hljs-title function_ invoke__">insert_axis</span>(<span class="hljs-title function_ invoke__">Axis</span>(<span class="hljs-number">1</span>)); <span class="hljs-comment">// (3,1)</span>
    <span class="hljs-comment">// åœ¨è½´1ä¸Šå †å æ•°ç»„, å…ˆå‡ç»´ ï¼ˆ3ï¼Œ1ï¼‰-&gt; (3, 1, 1), ç„¶ååœ¨è½´1ä¸Šæ‹¼æ¥</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">d</span> = ndarray::<span class="hljs-title function_ invoke__">stack</span>(<span class="hljs-title function_ invoke__">Axis</span>(<span class="hljs-number">1</span>), &amp;[a_2d.<span class="hljs-title function_ invoke__">view</span>(), b_2d.<span class="hljs-title function_ invoke__">view</span>()]).<span class="hljs-title function_ invoke__">unwrap</span>();
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"stack axis1:\n {:?}"</span>, d);
}
</code></pre>
<p><strong>è¾“å‡ºï¼š</strong></p>
<pre><code class="hljs language-shell" lang="shell">stack axis0:
 [[1, 2, 3],
 [4, 5, 6]], shape=[2, 3], strides=[3, 1], layout=Cc (0x5), const ndim=2
stack axis1:
 [[[1],
  [4]],

 [[2],
  [5]],

 [[3],
  [6]]], shape=[3, 2, 1], strides=[1, 3, 1], layout=Ff (0xa), const ndim=3
</code></pre>
<h3 data-id="heading-13">äº”ã€èšåˆä¸æ²¿è½´æ“ä½œï¼šæ•°æ®é™ç»´ä¸ç»Ÿè®¡</h3>
<p>åœ¨æ•°æ®åˆ†æå’Œç§‘å­¦è®¡ç®—ä¸­ï¼Œèšåˆæ“ä½œæ˜¯å¯¹æ•°æ®è¿›è¡Œæ€»ç»“å’Œæ¦‚æ‹¬çš„é‡è¦æ‰‹æ®µã€‚<code>ndarray</code> æä¾›äº†ä¸°å¯Œçš„èšåˆå‡½æ•°ï¼Œå¦‚<code>sum</code>ã€<code>mean</code>ç­‰ï¼Œè¿™äº›å‡½æ•°å¯ä»¥å¿«é€Ÿè®¡ç®—æ•°ç»„çš„æ€»å’Œã€å¹³å‡å€¼ç­‰ç»Ÿè®¡é‡ã€‚</p>
<p>åŒæ—¶ï¼Œé€šè¿‡æŒ‡å®šè½´å‚æ•°ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ²¿ç‰¹å®šçš„ç»´åº¦è¿›è¡Œèšåˆæ“ä½œï¼Œå®ç°æ•°æ®çš„é™ç»´ä¸åˆ†æã€‚</p>
<h4 data-id="heading-14">5.1 åŸºç¡€èšåˆï¼šsumã€mean å¿«é€Ÿç»Ÿè®¡</h4>
<p><code>sum</code>å’Œ<code>mean</code>æ˜¯æœ€å¸¸ç”¨çš„èšåˆå‡½æ•°ä¹‹ä¸€ï¼Œå®ƒä»¬å¯ä»¥ç›´æ¥å¯¹æ•°ç»„è¿›è¡Œæ“ä½œï¼Œè¿”å›ä¸€ä¸ªæ ‡é‡ç»“æœï¼Œè¡¨ç¤ºæ•´ä¸ªæ•°ç»„çš„æ€»å’Œæˆ–å¹³å‡å€¼ã€‚</p>
<pre><code class="hljs language-rust" lang="rust">
<span class="hljs-keyword">use</span> ndarray::array;

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">a</span> = array![<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];

    <span class="hljs-comment">// è®¡ç®—æ•°ç»„çš„æ€»å’Œ</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">sum</span> = a.<span class="hljs-title function_ invoke__">sum</span>();
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"sum:\n {:?}"</span>, sum);

    <span class="hljs-comment">// è®¡ç®—æ•°ç»„çš„å¹³å‡å€¼</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">mean</span> = a.<span class="hljs-title function_ invoke__">mean</span>().<span class="hljs-title function_ invoke__">unwrap</span>();
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"mean:\n {:?}"</span>, mean); 
}
</code></pre>
<p><strong>è¾“å‡ºï¼š</strong></p>
<pre><code class="hljs language-shell" lang="shell">sum:
 15
mean:
 3.0
</code></pre>
<h4 data-id="heading-15">5.2 æ²¿è½´è®¡ç®—ï¼šæŒ‰ç»´åº¦èšåˆæ•°æ®</h4>
<p>é€šè¿‡<code>axis</code>å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šèšåˆæ“ä½œæ²¿å“ªä¸ªè½´è¿›è¡Œï¼Œä»è€Œå®ç°æŒ‰ç»´åº¦èšåˆæ•°æ®ã€‚åœ¨å¤„ç†å¤šç»´æ•°æ®æ—¶éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥å¿«é€Ÿè·å–ä¸åŒç»´åº¦ä¸Šçš„ç»Ÿè®¡ä¿¡æ¯ã€‚</p>
<pre><code class="hljs language-rust" lang="rust">
<span class="hljs-keyword">use</span> ndarray::array;
<span class="hljs-keyword">use</span> ndarray::Axis;

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">matrix</span> = array![[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]];

    <span class="hljs-comment">// è®¡ç®—æ¯åˆ—çš„æ€»å’Œï¼ˆè½´0ï¼‰</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">column_sums</span> = matrix.<span class="hljs-title function_ invoke__">sum_axis</span>(<span class="hljs-title function_ invoke__">Axis</span>(<span class="hljs-number">0</span>));
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"column_sums:\n {:?}"</span>, column_sums);

    <span class="hljs-comment">// è®¡ç®—æ¯è¡Œçš„å¹³å‡å€¼ï¼ˆè½´1ï¼‰</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">row_means</span> = matrix.<span class="hljs-title function_ invoke__">mean_axis</span>(<span class="hljs-title function_ invoke__">Axis</span>(<span class="hljs-number">1</span>)).<span class="hljs-title function_ invoke__">unwrap</span>();
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"row_means:\n {:?}"</span>, row_means);
}
</code></pre>
<p><strong>è¾“å‡ºï¼š</strong></p>
<pre><code class="hljs language-shell" lang="shell">column_sums:
 [5, 7, 9], shape=[3], strides=[1], layout=CFcf (0xf), const ndim=1
row_means:
 [2, 5], shape=[2], strides=[1], layout=CFcf (0xf), const ndim=1
</code></pre>
<h3 data-id="heading-16">å…­ã€çŸ©é˜µä»£æ•°ï¼šndarray-linalg ä¸çº¿æ€§ä»£æ•°åŸºç¡€</h3>
<p>åœ¨äººå·¥æ™ºèƒ½çš„ç®—æ³•å®ç°ä¸­ï¼ŒçŸ©é˜µä»£æ•°æ˜¯ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚<code>ndarray</code> åº“æœ¬èº«æä¾›äº†åŸºæœ¬çš„çŸ©é˜µä¹˜æ³•æ“ä½œï¼Œè€Œ <code>ndarray-linalg</code> åº“åˆ™è¿›ä¸€æ­¥æ‰©å±•äº†å…¶çº¿æ€§ä»£æ•°åŠŸèƒ½ï¼Œä¸ºè§£å†³å¤æ‚çš„æ•°å­¦é—®é¢˜æä¾›äº†å¼ºå¤§çš„å·¥å…·ã€‚</p>
<h4 data-id="heading-17">6.1 çŸ©é˜µä¹˜æ³•ï¼š.dot () ä¸ç»´åº¦åŒ¹é…</h4>
<p>åœ¨ <code>ndarray</code> ä¸­ï¼Œä½¿ç”¨<code>.dot()</code>æ–¹æ³•æ‰§è¡ŒçŸ©é˜µä¹˜æ³•ï¼Œå®ƒä¸¥æ ¼éµå¾ªçº¿æ€§ä»£æ•°ä¸­çš„ç»´åº¦è§„åˆ™ã€‚å¯¹äºä¸¤ä¸ªçŸ©é˜µ<code>A</code>å’Œ<code>B</code>ï¼Œåªæœ‰å½“<code>A</code>çš„åˆ—æ•°ç­‰äº<code>B</code>çš„è¡Œæ•°æ—¶ï¼ŒçŸ©é˜µä¹˜æ³•<code>A.dot(B)</code>æ‰æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<pre><code class="hljs language-rust" lang="rust">
<span class="hljs-keyword">use</span> ndarray::array;

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">a</span> = array![[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]];
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">b</span> = array![[<span class="hljs-number">5</span>, <span class="hljs-number">6</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">8</span>]];

    <span class="hljs-comment">// æ‰§è¡ŒçŸ©é˜µä¹˜æ³•</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">c</span> = a.<span class="hljs-title function_ invoke__">dot</span>(&amp;b);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"dot:\n {:?}"</span>, c);
}
</code></pre>
<p><strong>è¾“å‡ºï¼š</strong></p>
<pre><code class="hljs language-shell" lang="shell">dot:
 [[19, 22],
 [43, 50]], shape=[2, 2], strides=[2, 1], layout=Cc (0x5), const ndim=2
</code></pre>
<h4 data-id="heading-18">6.2 ndarray-linalg æ‰©å±•ï¼šç‰¹å¾å€¼ã€çŸ©é˜µåˆ†è§£</h4>
<p><code>ndarray-linalg</code>åº“ä¸º <code>ndarray</code> æä¾›äº†ä¸°å¯Œçš„çº¿æ€§ä»£æ•°æ‰©å±•ï¼ŒåŒ…æ‹¬çŸ©é˜µæ±‚é€†ã€å¥‡å¼‚å€¼åˆ†è§£ï¼ˆSVDï¼‰ã€ç‰¹å¾å€¼è®¡ç®—ç­‰é«˜çº§æ“ä½œã€‚</p>
<p>è¿™äº›åŠŸèƒ½åœ¨äººå·¥æ™ºèƒ½ä¸­å¯¹äºè§£å†³å¤æ‚çš„ä¼˜åŒ–å’Œä¼°è®¡é—®é¢˜éå¸¸å…³é”®ã€‚</p>
<p>Cargo.toml é…ç½®ï¼š</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[dependencies]</span>
<span class="hljs-attr">ndarray</span> = { version = <span class="hljs-string">"0.17.1"</span> }
<span class="hljs-attr">ndarray-linalg</span> = <span class="hljs-string">"0.18.0"</span>
</code></pre>
<p>éœ€è¦é¢å¤–å®‰è£… <code>openblas</code>ï¼Œåœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FOpenMathLib%2FOpenBLAS" target="_blank" title="https://github.com/OpenMathLib/OpenBLAS" ref="nofollow noopener noreferrer">github.com/OpenMathLibâ€¦</a></p>
<pre><code class="hljs language-rust" lang="rust">
<span class="hljs-keyword">use</span> ndarray::array;
<span class="hljs-keyword">use</span> ndarray_linalg::Inverse;

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">matrix</span> = array![
        [<span class="hljs-number">1.0</span>, <span class="hljs-number">2.0</span>],
        [<span class="hljs-number">3.0</span>, <span class="hljs-number">4.0</span>]
    ];

    <span class="hljs-comment">// æ±‚çŸ©é˜µçš„é€†</span>
    <span class="hljs-keyword">match</span> matrix.<span class="hljs-title function_ invoke__">inv</span>() {
        <span class="hljs-title function_ invoke__">Ok</span>(inverse) =&gt; {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Inverse matrix: {:?}"</span>, inverse); 
        }
        <span class="hljs-title function_ invoke__">Err</span>(e) =&gt; {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Error: {}"</span>, e); 
        }
    }
}
</code></pre>
<p><strong>è¾“å‡º</strong></p>
<pre><code class="hljs language-shell" lang="shell">Inverse matrix:
 [[-2.0, 1.0],
 [1.5, -0.5]], shape=[2, 2], strides=[2, 1], layout=Cc (0x5), const ndim=2
</code></pre>
<h3 data-id="heading-19">æ€»ç»“ï¼šndarray åŠ©åŠ›æ™ºèƒ½ç³»ç»Ÿé«˜æ•ˆè®¡ç®—</h3>
<p>Rust ndarray å‡­å€Ÿå…ƒç´ çº§æ“ä½œçš„ç®€æ´æ€§ã€å¹¿æ’­æœºåˆ¶çš„æ™ºèƒ½ç»´åº¦é€‚é…ã€çº¿æ€§ä»£æ•°çš„é«˜æ•ˆæ”¯æŒï¼Œæˆä¸ºAIä¸å…·èº«æ™ºèƒ½å¼€å‘çš„å¾—åŠ›å·¥å…·ã€‚</p>
<p>æ— è®ºæ˜¯ä¼ æ„Ÿå™¨æ•°æ®çš„å®æ—¶å¤„ç†ï¼Œè¿˜æ˜¯å¤æ‚ç®—æ³•çš„çŸ©é˜µè¿ç®—ï¼Œ<code>ndarray</code> éƒ½èƒ½åœ¨ä¿è¯å†…å­˜å®‰å…¨çš„åŒæ—¶ï¼Œæä¾›æ¥è¿‘åŸç”Ÿçš„æ€§èƒ½ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter3.38 å¸¦æ¥äº†ä»€ä¹ˆ]]></title>    <link>https://juejin.cn/post/7572301616167436297</link>    <guid>https://juejin.cn/post/7572301616167436297</guid>    <pubDate>2025-11-14T00:58:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572301616167436297" data-draft-id="7572012699626815515" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter3.38 å¸¦æ¥äº†ä»€ä¹ˆ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-14T00:58:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JarvanMo"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565845704"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter3.38 å¸¦æ¥äº†ä»€ä¹ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565845704/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JarvanMo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T00:58:42.000Z" title="Fri Nov 14 2025 00:58:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»19åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Flutter 3.38 æœ€è¿‘å‘å¸ƒäº†ï¼Œå¸¦æ¥äº†å¾ˆå¤šæ–°åŠŸèƒ½å’Œæ”¹è¿›ã€‚è¿™æ¬¡å‘å¸ƒåŒ…å«äº†æ¥è‡ª <strong>145 ä½</strong> ç‹¬ç«‹è´¡çŒ®è€…çš„ <strong>825 æ¬¡</strong> æ€»æäº¤ï¼Œå…¶ä¸­æœ‰ <strong>37 ä½</strong> æ˜¯é¦–æ¬¡è´¡çŒ®è€…ã€‚è®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹è¿™æ¬¡å‘å¸ƒçš„å†…å®¹ã€‚</p>
<h2 data-id="heading-0">Dot shorthands</h2>
<p>åœ¨ Dart 3.10 + Flutter 3.38 ä¸­å¼€å§‹é»˜è®¤æ”¯æŒ Dot shorthands ï¼Œé€šè¿‡ Dot shorthands å¯ä»¥ä½¿å¯ä»¥é€šè¿‡å…è®¸æ‚¨çœç•¥ Dart èƒ½å¤Ÿæ¨æ–­å‡ºæ¥çš„ç±»å‹ï¼Œä»è€Œå‡å°‘æ ·æ¿ä»£ç ï¼Œä¾‹å¦‚ä½¿ç”¨ .start è€Œä¸æ˜¯ MainAxisAlignment.start ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// With shorthands</span>
Column(
  mainAxisAlignment: .start,
  crossAxisAlignment: .center,
  children: [ <span class="hljs-comment">/* ... */</span> ],
),

<span class="hljs-comment">// Without shorthands</span>
Column(
  mainAxisAlignment: MainAxisAlignment.start,
  crossAxisAlignment: CrossAxisAlignment.center,
  children: [ <span class="hljs-comment">/* â€¦ */</span> ],
),
</code></pre>
<p>è¿™å¯¹äº<strong>å‘½åæ„é€ å‡½æ•°</strong>ä¹ŸåŒæ ·é€‚ç”¨ï¼Œå¦‚<code>.all</code>è€Œä¸æ˜¯<code>EdgeInsets.all</code>ï¼š</p>
<pre><code class="hljs language-dart" lang="dart">Padding(
  padding: .all(<span class="hljs-number">8.0</span>),
  child: Text(<span class="hljs-string">'Hello world'</span>),
),
</code></pre>
<h2 data-id="heading-1">ğŸ’» Web å¼€å‘é…ç½®ä¸åŠŸèƒ½å¢å¼º</h2>
<hr/>
<h3 data-id="heading-2">Web å¼€å‘é…ç½®æ–‡ä»¶</h3>
<p><code>flutter run</code> å‘½ä»¤ç°åœ¨æ”¯æŒä¸€ä¸ªç”¨äº <strong>Web è®¾ç½®çš„é…ç½®æ–‡ä»¶</strong>ã€‚æ‚¨å¯ä»¥åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ <code>web_dev_config.yaml</code> æ–‡ä»¶ä¸­æŒ‡å®š <strong>ä¸»æœº (host)ã€ç«¯å£ (port)ã€è¯ä¹¦ (certificate)</strong> å’Œ <strong>è¯·æ±‚å¤´ä¿¡æ¯ (header)</strong>ã€‚å°†æ­¤æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ï¼Œç¡®ä¿å›¢é˜Ÿä¸­çš„æ‰€æœ‰æˆå‘˜éƒ½ä½¿ç”¨ç›¸åŒçš„è®¾ç½®è¿›è¡Œè°ƒè¯•ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">host:</span> <span class="hljs-string">"0.0.0.0"</span> <span class="hljs-comment"># Defines the binding address &lt;string&gt;</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span> <span class="hljs-comment"># Specifies the port &lt;int&gt; for the development server</span>
  <span class="hljs-attr">https:</span>
    <span class="hljs-attr">cert-path:</span> <span class="hljs-string">"/path/to/cert.pem"</span> <span class="hljs-comment"># Path &lt;string&gt; to your TLS certificate</span>
    <span class="hljs-attr">cert-key-path:</span> <span class="hljs-string">"/path/to/key.pem"</span> <span class="hljs-comment"># Path &lt;string&gt; to TLS certificate key</span>
</code></pre>
<ul>
<li>æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.dev%2Fplatform-integration%2Fweb%2Fweb-dev-config-file" target="_blank" title="https://docs.flutter.dev/platform-integration/web/web-dev-config-file" ref="nofollow noopener noreferrer">è®¾ç½® Web å¼€å‘é…ç½®æ–‡ä»¶</a>ã€‚</li>
</ul>
<h3 data-id="heading-3">Web å¼€å‘ä»£ç†è®¾ç½®</h3>
<p>é™¤äº†ç°æœ‰çš„å‘½ä»¤è¡Œæ ‡å¿—å¤–ï¼ŒWeb å¼€å‘é…ç½®æ–‡ä»¶ç°åœ¨è¿˜æ”¯æŒæ–°çš„<strong>ä»£ç†è®¾ç½® (proxy settings)</strong>ã€‚</p>
<ul>
<li>ä»£ç†è®¾ç½®å…è®¸å°†ç‰¹å®šè·¯å¾„çš„è¯·æ±‚è½¬å‘åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨ã€‚è¿™ä½¿å¾—å¼€å‘è¿æ¥åˆ°åŒä¸€ä¸»æœºä¸ŠåŠ¨æ€ç«¯ç‚¹çš„ Web å®¢æˆ·ç«¯æ›´åŠ å®¹æ˜“ã€‚</li>
</ul>
<pre><code class="hljs language-dart" lang="dart">server:
  proxy:
    - target: <span class="hljs-string">"http://localhost:5000/"</span> # Base URL &lt;string&gt; of your backend
      prefix: <span class="hljs-string">"/users/"</span> # Path &lt;string&gt;
    - target: <span class="hljs-string">"http://localhost:3000/"</span>
      prefix: <span class="hljs-string">"/data/"</span>
      replace: <span class="hljs-string">"/report/"</span> # Replacement &lt;string&gt; of path <span class="hljs-keyword">in</span> redirected URL (optional)
    - target: <span class="hljs-string">"http://localhost:4000/"</span>
      prefix: <span class="hljs-string">"/products/"</span>
      replace: <span class="hljs-string">""</span>
</code></pre>
<ul>
<li>æœ‰å…³ä»£ç†è®¾ç½®çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¹Ÿè¯·å‚é˜…<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.dev%2Fplatform-integration%2Fweb%2Fweb-dev-config-file" target="_blank" title="https://docs.flutter.dev/platform-integration/web/web-dev-config-file" ref="nofollow noopener noreferrer">è®¾ç½® Web å¼€å‘é…ç½®æ–‡ä»¶</a>ã€‚</li>
</ul>
<h3 data-id="heading-4">Web ä¸Šçš„çƒ­é‡è½½æ‰©å±•æ”¯æŒ</h3>
<ul>
<li>å½“ä½¿ç”¨ <code>-d web-server</code> è¿è¡Œå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Flutter åº”ç”¨é“¾æ¥æ—¶ï¼Œ<strong>æœ‰çŠ¶æ€çƒ­é‡è½½ (Stateful hot reload)</strong> ç°åœ¨<strong>é»˜è®¤å¯ç”¨</strong>ã€‚è¿™ç”šè‡³å¯ä»¥åŒæ—¶è¿æ¥å¤šä¸ªæµè§ˆå™¨ã€‚</li>
<li>ä¸ <code>-d chrome</code> ä¸€æ ·ï¼Œæ­¤åŠŸèƒ½å¯ä»¥ä½¿ç”¨ <code>--no-web-experimental-hot-reload</code> æ ‡å¿—ä¸´æ—¶ç¦ç”¨ã€‚ä½†æ­¤ç¦ç”¨åŠŸèƒ½å°†åœ¨æœªæ¥ç‰ˆæœ¬ä¸­ç§»é™¤ï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨åœ¨å¼€å‘å·¥ä½œæµç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ä½¿ç”¨ Dart çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdart-lang%2Fsdk%2Fissues%2Fnew%3Ftemplate%3D5_web_hot_reload.yml" target="_blank" title="https://github.com/dart-lang/sdk/issues/new?template=5_web_hot_reload.yml" ref="nofollow noopener noreferrer">web çƒ­é‡è½½é—®é¢˜æ¨¡æ¿</a> æäº¤ Bugã€‚</li>
<li>æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.dev%2Fplatform-integration%2Fweb%2Fbuilding%23hot-reload-web" target="_blank" title="https://docs.flutter.dev/platform-integration/web/building#hot-reload-web" ref="nofollow noopener noreferrer">Web ä¸Šçš„çƒ­é‡è½½æ–‡æ¡£</a>ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-5">ğŸ—ï¸ Frameworkæ›´æ–°</h2>
<p>æœ¬æ¬¡å‘å¸ƒåŒ…å«äº†Frameworkä¸­çš„è®¸å¤šå¼ºå¤§çš„æ–°åŠŸèƒ½å’Œæ”¹è¿›ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿå¯¹é«˜çº§ UIã€å¯¼èˆªå’Œå¹³å°äº¤äº’æœ‰æ›´ç²¾ç»†çš„æ§åˆ¶ã€‚</p>
<h3 data-id="heading-6">å¼ºå¤§çš„ UI æµ®å±‚æ§åˆ¶</h3>
<p>å¼€å‘è€…åœ¨ä½¿ç”¨ <strong><code>OverlayPortal</code></strong> åˆ›å»ºå¼¹å‡ºçª—å£ã€å¯¹è¯æ¡†å’Œå…¶ä»–æµ®åŠ¨ UI å…ƒç´ æ—¶ï¼Œç°åœ¨æ‹¥æœ‰æ›´å¤§çš„èƒ½åŠ›ã€‚</p>
<ul>
<li>é€šè¿‡ <code>OverlayPortal.overlayChildLayoutBuilder</code> (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F174239" target="_blank" title="https://github.com/flutter/flutter/pull/174239" ref="nofollow noopener noreferrer">#174239</a>)ï¼Œç°åœ¨å¯ä»¥åœ¨ Widget æ ‘ä¸­ä»»ä½•å‘ä¸Šçš„ <strong><code>Overlay</code></strong> ä¸­æ¸²æŸ“å­ Widgetï¼Œè¿™ä½¿å¾—æ˜¾ç¤ºåº”ç”¨èŒƒå›´çš„é€šçŸ¥æˆ–éœ€è¦è·³å‡ºå…¶çˆ¶ Widget å¸ƒå±€é™åˆ¶çš„ UI å˜å¾—æ›´å®¹æ˜“ã€‚è¿™å¯ä»¥æ›´çµæ´»åœ°æ˜¾ç¤ºå¼¹å‡ºã€å¯¹è¯æ¡†ã€é€šçŸ¥ç­‰ UI ï¼Œä¾‹å¦‚ï¼š</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_OverlayPortalExampleState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">OverlayPortalExample</span>&gt; </span>{
  <span class="hljs-keyword">final</span> OverlayPortalController _controller = OverlayPortalController();
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(title: Text(<span class="hljs-string">'OverlayPortal'</span>)),
      body: Center(
        child: OverlayPortal.overlayChildLayoutBuilder(
          controller: _controller,
          <span class="hljs-comment">/// <span class="markdown"><span class="hljs-strong">****</span>å¯ä»¥é…ç½® root<span class="hljs-strong">****</span></span></span>
          overlayLocation: OverlayChildLocation.rootOverlay,
          child: ElevatedButton(
            onPressed: () =&gt; _controller.toggle(),
            child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'ç‚¹æˆ‘æ˜¾ç¤ºæµ®å±‚'</span>),
          ),
          overlayChildBuilder: (context, info) {
            <span class="hljs-keyword">return</span> Material(
              elevation: <span class="hljs-number">6</span>,
              color: Colors.white,
              shape: RoundedRectangleBorder(
                borderRadius: BorderRadius.circular(<span class="hljs-number">8</span>),
              ),
              child: Container(
                padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">16</span>),
                child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'è¿™æ˜¯ä¸€ä¸ªæµ®å±‚'</span>),
              ),
            );
          },
        ),
      ),
    );
  }
}
</code></pre>
<ul>
<li>åº•å±‚æ–¹æ³• <code>Overlay.of</code> ä¹Ÿå¾—åˆ°äº†å¢å¼ºï¼Œä½¿å…¶æ›´åŠ å¥å£®å’Œé«˜æ•ˆ (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F174315" target="_blank" title="https://github.com/flutter/flutter/pull/174315" ref="nofollow noopener noreferrer">#174315</a>)ã€‚</li>
</ul>
<h3 data-id="heading-7">ç°ä»£åŒ– Android å¯¼èˆªä½“éªŒ</h3>
<ul>
<li>ä¸ºäº†æä¾›æ›´ç°ä»£çš„ Android å¯¼èˆªä½“éªŒï¼Œ<strong>é¢„æµ‹æ€§è¿”å›æ‰‹åŠ¿è·¯ç”±è¿‡æ¸¡ (predictive back route transitions)</strong> ç°åœ¨åœ¨ <strong><code>MaterialApp</code></strong> ä¸­<strong>é»˜è®¤å¯ç”¨</strong> (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F173860" target="_blank" title="https://github.com/flutter/flutter/pull/173860" ref="nofollow noopener noreferrer">#173860</a>)ã€‚å½“ç”¨æˆ·æ‰§è¡Œè¿”å›æ‰‹åŠ¿æ—¶ï¼Œä»–ä»¬ä¼šçœ‹åˆ°ä¸»å±å¹•çš„é¢„è§ˆï¼Œå½“å‰è·¯ç”±åˆ™éšä¹‹åŠ¨ç”»ç§»å‡ºã€‚</li>
<li>æ­¤å¤–ï¼Œé»˜è®¤çš„é¡µé¢è¿‡æ¸¡æ•ˆæœå·²ä» <a href="https://link.juejin.cn?target=https%3A%2F%2Fmain-api.flutter.dev%2Fflutter%2Fmaterial%2FFadeForwardsPageTransitionsBuilder-class.html" target="_blank" title="https://main-api.flutter.dev/flutter/material/FadeForwardsPageTransitionsBuilder-class.html" ref="nofollow noopener noreferrer">ZoomPageTransitionsBuilder</a> æ›´æ–°ä¸º <a href="https://link.juejin.cn?target=https%3A%2F%2Fmain-api.flutter.dev%2Fflutter%2Fmaterial%2FZoomPageTransitionsBuilder-class.html" target="_blank" title="https://main-api.flutter.dev/flutter/material/ZoomPageTransitionsBuilder-class.html" ref="nofollow noopener noreferrer">FadeForwardsPageTransitionsBuilder</a>ï¼Œä»¥åæ˜ åŸç”Ÿçš„è¡Œä¸ºã€‚</li>
</ul>
<h3 data-id="heading-8">æ¡Œé¢é›†æˆæ·±åŒ–</h3>
<ul>
<li>åœ¨ <strong>Windows</strong> ä¸Šï¼Œå¼€å‘è€…ç°åœ¨å¯ä»¥è®¿é—®å·²è¿æ¥æ˜¾ç¤ºå™¨çš„åˆ—è¡¨ï¼Œå¹¶æŸ¥è¯¢æ¯ä¸ªæ˜¾ç¤ºå™¨çš„è¯¦ç»†å±æ€§ï¼Œä¾‹å¦‚<strong>åˆ†è¾¨ç‡ã€åˆ·æ–°ç‡å’Œç‰©ç†å°ºå¯¸</strong> (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F164460" target="_blank" title="https://github.com/flutter/flutter/pull/164460" ref="nofollow noopener noreferrer">#164460</a>)ã€‚è¿™ä½¿å¾—åˆ›å»ºå…·æœ‰å¤æ‚çª—å£ç®¡ç†åŠŸèƒ½çš„åº”ç”¨ç¨‹åºæˆä¸ºå¯èƒ½ã€‚</li>
</ul>
<h3 data-id="heading-9">æ¡†æ¶ç¨³å®šæ€§ä¸ Web UI ä¼˜åŒ–</h3>
<ul>
<li>æ¡†æ¶æœ¬èº«ç°åœ¨æ›´å…·å¼¹æ€§ã€‚Widget ç”Ÿå‘½å‘¨æœŸå›è°ƒï¼ˆä¾‹å¦‚ <code>didUpdateWidget</code>ï¼‰ä¸­å‘ç”Ÿçš„é”™è¯¯ç°åœ¨å¾—åˆ°æ›´ä¼˜é›…çš„å¤„ç†ï¼Œé˜²æ­¢å®ƒä»¬åœ¨å…ƒç´ æ ‘ä¸­å¼•å‘è¿é”æ•…éšœ (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F173148" target="_blank" title="https://github.com/flutter/flutter/pull/173148" ref="nofollow noopener noreferrer">#173148</a>)ã€‚</li>
<li><strong><code>ResizeImage</code></strong> ç°åœ¨æ­£ç¡®åœ°å®ç°äº†ç›¸ç­‰æ€§ (equality)ï¼Œç¡®ä¿ç›¸åŒçš„ <code>ResizeImage</code> æä¾›è€…è¢«è§†ä¸ºç›¸åŒï¼Œä»è€Œä½¿å›¾åƒç¼“å­˜å’Œæ¯”è¾ƒæ›´å…·å¯é¢„æµ‹æ€§ (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F172643" target="_blank" title="https://github.com/flutter/flutter/pull/172643" ref="nofollow noopener noreferrer">#172643</a>)ã€‚</li>
<li>åœ¨ Web ä¸Šï¼ŒUI ä¼˜åŒ–ä»åœ¨ç»§ç»­ï¼š<strong><code>RSuperellipse</code></strong> çš„ä¸€ä¸ª Bug å·²ä¿®å¤ï¼Œé˜²æ­¢è§’åŠå¾„å¤§äº Widget æœ¬èº«æ—¶å‡ºç°æ¸²æŸ“é”™è¯¯ï¼›åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒå°†æŒ‰é¢„æœŸè¢«å¤„ç†ä»¥ç”Ÿæˆ<strong>è¯ä¸¸å½¢çŠ¶ (pill shape)</strong> (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F172254" target="_blank" title="https://github.com/flutter/flutter/pull/172254" ref="nofollow noopener noreferrer">#172254</a>)ã€‚</li>
</ul>
<h3 data-id="heading-10">å›½é™…åŒ–æ”¯æŒå¢å¼º</h3>
<ul>
<li>æ£€æµ‹æµè§ˆå™¨é¦–é€‰åŒºåŸŸè®¾ç½® (locale) çš„åŠŸèƒ½ç°åœ¨æ›´å¯é ã€‚å¼•æ“ç°åœ¨ä½¿ç”¨æ ‡å‡†çš„ <strong><code>Intl.Locale</code> Web API</strong> æ¥è§£ææµè§ˆå™¨è¯­è¨€ï¼Œå–ä»£äº†å…ˆå‰æ‰‹åŠ¨ä¸”æ›´è„†å¼±çš„å®ç° (#172964)ã€‚è¿™ä¸€å˜åŒ–ä¸ºå…¨çƒç”¨æˆ·å¸¦æ¥äº†æ›´å¯é çš„åŒºåŸŸè®¾ç½®æ£€æµ‹å’Œæ›´å¥½çš„ä½“éªŒã€‚</li>
</ul>
<h3 data-id="heading-11">Android ç‰¹å®š Bug ä¿®å¤</h3>
<ul>
<li>ä¸€ä¸ªä¸»è¦å½±å“å¸¦æœ‰ç¡¬ä»¶é”®ç›˜çš„ <strong>Samsung è®¾å¤‡</strong>çš„ Android ç‰¹å®š Bug (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F171973" target="_blank" title="https://github.com/flutter/flutter/pull/171973" ref="nofollow noopener noreferrer">#171973</a>) å·²è§£å†³ã€‚
<ul>
<li>æ­¤å‰ï¼Œç”¨æˆ·ä¸ <code>TextField</code> äº¤äº’åï¼ŒAndroid è¾“å…¥æ³•ç¼–è¾‘å™¨ (IME) å¯èƒ½ä¼šé™·å…¥é™ˆæ—§çŠ¶æ€ã€‚è¿™å¯¼è‡´ IME é”™è¯¯åœ°æ‹¦æˆª â€œEnterâ€ æˆ– â€œSpaceâ€ é”®ï¼Œé˜»æ­¢éæ–‡æœ¬ Widgetï¼ˆå¦‚ <code>Checkbox</code> æˆ– <code>Radio</code> æŒ‰é’®ï¼‰æ¥æ”¶äº‹ä»¶ã€‚</li>
<li>ä¿®å¤ç¡®ä¿åœ¨æ–‡æœ¬è¿æ¥å…³é—­æ—¶ï¼Œ<strong><code>InputMethodManager</code></strong> æ­£ç¡®é‡ç½®ï¼Œæ¸…é™¤ IME çš„é™ˆæ—§çŠ¶æ€ï¼Œå¹¶æ¢å¤ç”¨æˆ·å¯é¢„æµ‹çš„ç¡¬ä»¶é”®ç›˜äº¤äº’ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-12">ğŸ¨ Material å’Œ Cupertino æ›´æ–°</h2>
<p>Material å’Œ Cupertino åº“æŒç»­å‘å±•ï¼Œä¾§é‡äº API ä¸€è‡´æ€§å’Œä¼˜åŒ–çš„ç”¨æˆ·ä½“éªŒã€‚æœ¬æ¬¡å‘å¸ƒå¸¦æ¥äº†é‡å¤§çš„ API è¿ç§»ã€æ–°çš„ Widget åŠŸèƒ½å’Œä¼—å¤šæ”¹è¿›ï¼Œä½¿æ„å»ºç¾è§‚ã€å®ç”¨çš„ UI æ›´åŠ ç®€å•ã€‚</p>
<h3 data-id="heading-13"><code>WidgetState</code> è¿ç§»</h3>
<ul>
<li>åœ¨å¼ƒç”¨ <code>MaterialState</code> çš„åŸºç¡€ä¸Šï¼Œæœ¬æ¬¡å‘å¸ƒç»§ç»­å‘æ›´ç»Ÿä¸€çš„ <strong><code>WidgetState</code></strong> è¿›è¡Œå†…éƒ¨è¿ç§»ã€‚</li>
<li>è¿™æä¾›äº†ä¸€ç§ä¸€è‡´ã€å¯Œæœ‰è¡¨ç°åŠ›çš„æ–¹å¼æ¥å®šä¹‰ Widget åœ¨ä¸åŒäº¤äº’çŠ¶æ€ï¼ˆä¾‹å¦‚ï¼šæŒ‰ä¸‹ã€æ‚¬åœæˆ–ç¦ç”¨ï¼‰ä¸‹çš„å¤–è§‚ï¼Œå¯¹ç°æœ‰åº”ç”¨ç¨‹åº<strong>æ— éœ€æ›´æ”¹</strong>ã€‚</li>
<li>æ­¤è¿ç§»å·²åº”ç”¨äºå„ç§ Widget åŠå…¶ä¸»é¢˜ï¼ŒåŒ…æ‹¬ <code>IconButton</code>ã€<code>ElevatedButton</code>ã€<code>Checkbox</code> å’Œ <code>Switch</code> (#173893)ã€‚</li>
<li>æ–°çš„ API è¿˜å¢åŠ äº†åŠŸèƒ½å’Œçµæ´»æ€§ï¼›ä¾‹å¦‚ï¼Œ<code>IconButton</code> ç°åœ¨åŒ…å«ä¸€ä¸ª <strong><code>statesController</code></strong> å±æ€§ (#169821)ï¼Œå…è®¸é€šè¿‡ç¼–ç¨‹æ–¹å¼æ§åˆ¶å…¶è§†è§‰çŠ¶æ€ï¼Œä¸ºæ›´è‡ªå®šä¹‰å’Œäº¤äº’å¼çš„è®¾è®¡æ‰“å¼€äº†å¤§é—¨ã€‚</li>
</ul>
<h3 data-id="heading-14">æ–°åŠŸèƒ½å’Œä¾¿æ· API</h3>
<ul>
<li><strong><code>Badge.count</code></strong> æ„é€ å‡½æ•°ç°åœ¨åŒ…å«ä¸€ä¸ª <strong><code>maxCount</code></strong> å‚æ•° (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F171054" target="_blank" title="https://github.com/flutter/flutter/pull/171054" ref="nofollow noopener noreferrer">#171054</a>)ï¼Œå¯ä»¥è½»æ¾é™åˆ¶æ˜¾ç¤ºè®¡æ•°ï¼ˆä¾‹å¦‚ï¼Œæ˜¾ç¤º â€œ99+â€ è€Œä¸æ˜¯ â€œ100â€ï¼‰ã€‚</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28bf755e0f414bdf9f11612cfc115acf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763686722&amp;x-signature=ufG%2FNaMxdlCl%2BLYsnjl5uA85IDs%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-15">ğŸ‘† æ‰‹åŠ¿æ§åˆ¶ä¸å¹³å°ä¼˜åŒ–</h2>
<hr/>
<h3 data-id="heading-16">Material å’Œ Cupertino ç»„ä»¶æ”¹è¿›</h3>
<ul>
<li>ä¸ºäº†æ›´ç²¾ç»†çš„<strong>æ‰‹åŠ¿æ§åˆ¶</strong>ï¼Œ<code>InkWell</code> Widget ç°åœ¨æ–°å¢äº†ä¸€ä¸ª <strong><code>onLongPressUp</code></strong> å›è°ƒ (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F173221" target="_blank" title="https://github.com/flutter/flutter/pull/173221" ref="nofollow noopener noreferrer">#173221</a>)ï¼Œè¿™å¯¹äºè§¦å‘ä»…åœ¨ç”¨æˆ·æŠ¬èµ·æ‰‹æŒ‡æ—¶æ‰å®Œæˆçš„åŠ¨ä½œéå¸¸æœ‰ç”¨ã€‚</li>
<li><strong>Cupertino åº“</strong>ç»§ç»­è‡´åŠ›äºæé«˜ iOS çš„ä¿çœŸåº¦ï¼š
<ul>
<li><code>CupertinoSlidingSegmentedControl</code> å¢åŠ äº†ä¸€ä¸ª <strong><code>isMomentary</code></strong> å±æ€§ (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F164262" target="_blank" title="https://github.com/flutter/flutter/pull/164262" ref="nofollow noopener noreferrer">#164262</a>)ï¼Œå…è®¸æ§ä»¶è§¦å‘åŠ¨ä½œè€Œæ— éœ€æŒä¹…ä¿æŒé€‰æ‹©çŠ¶æ€ã€‚</li>
<li>ä¸ºäº†æ›´å¥½åœ°åŒ¹é…åŸç”Ÿ iOS è¡Œä¸ºï¼Œ<code>CupertinoSheet</code> åœ¨å®Œå…¨å±•å¼€æ—¶å‘ä¸Šæ‹–åŠ¨æ—¶ï¼Œç°åœ¨å…·æœ‰ä¸€ä¸ªå¾®å¦™çš„ <strong>â€œæ‹‰ä¼¸â€æ•ˆæœ (subtle â€œstretchâ€ effect)</strong> (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F168547" target="_blank" title="https://github.com/flutter/flutter/pull/168547" ref="nofollow noopener noreferrer">#168547</a>)ã€‚</li>
</ul>
</li>
<li>æ ¸å¿ƒç»„ä»¶çš„è¡Œä¸ºä¹Ÿå¾—åˆ°äº†å®Œå–„ï¼š
<ul>
<li>ä¿®å¤äº† <code>DropdownMenuFormField</code>ï¼Œä½¿å…¶åœ¨è¡¨å•é‡ç½®æ—¶èƒ½æ­£ç¡®æ¸…ç©ºå…¶æ–‡æœ¬å­—æ®µ (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F174937" target="_blank" title="https://github.com/flutter/flutter/pull/174937" ref="nofollow noopener noreferrer">#174937</a>)ã€‚</li>
<li>å¯¹ <code>SegmentedButton</code> è¿›è¡Œäº†æ›´æ–°ï¼Œä»¥æ”¹è¿›ç„¦ç‚¹å¤„ç† (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F173953" target="_blank" title="https://github.com/flutter/flutter/pull/173953" ref="nofollow noopener noreferrer">#173953</a>) å¹¶ç¡®ä¿å…¶è¾¹æ¡†æ­£ç¡®åæ˜  Widget çš„çŠ¶æ€ (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F172754" target="_blank" title="https://github.com/flutter/flutter/pull/172754" ref="nofollow noopener noreferrer">#172754</a>)ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-17">ğŸ”— Material ä¸ Cupertino è§£è€¦ï¼ˆDecouplingï¼‰è§„åˆ’</h2>
<p>æˆ‘ä»¬ä¸€ç›´åœ¨è§„åˆ’å°† <strong>Material å’Œ Cupertino åº“ä»æ¡†æ¶ä¸­è§£è€¦</strong>ã€‚ä»¥ä¸‹æ˜¯å…³äºæœ€è¿‘å‘å¸ƒçš„è®¾è®¡æ–‡æ¡£çš„ä¸€äº›è®¨è®ºï¼š</p>






























<table><thead><tr><th align="left">ä¸»é¢˜</th><th align="left">çŠ¶æ€</th><th align="left">è¯¦æƒ…</th></tr></thead><tbody><tr><td align="left">æ”¹è¿› <code>flutter/packages</code> çš„å‘å¸ƒæµç¨‹ (åŒ…å«è§£è€¦åçš„ Material å’Œ Cupertino)</td><td align="left"><strong>å·²å†³å®š</strong></td><td align="left"><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.google.com%2Fdocument%2Fu%2F1%2Fd%2F18kjoP-4LAXEllugVOQRg6vZELyD6MuxlKilLD4lFxSY%2Fedit" target="_blank" title="https://docs.google.com/document/u/1/d/18kjoP-4LAXEllugVOQRg6vZELyD6MuxlKilLD4lFxSY/edit" ref="nofollow noopener noreferrer">First-Party Package Release Strategy</a> <br/> <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.google.com%2Fdocument%2Fd%2F1jUoFaawutbYsCI5oY3pDP_l-xpv6FhDKlcI1-EoT02s%2Fedit%3Ftab%3Dt.0" target="_blank" title="https://docs.google.com/document/d/1jUoFaawutbYsCI5oY3pDP_l-xpv6FhDKlcI1-EoT02s/edit?tab=t.0" ref="nofollow noopener noreferrer">Batch Release One Pager (PUBLICLY SHARED)</a></td></tr><tr><td align="left">é¢œè‰²å’Œç‚¹é€Ÿè®° (<code>Colors</code> and dot shorthands)</td><td align="left"><strong>å·²å†³å®š</strong></td><td align="left"><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.google.com%2Fdocument%2Fd%2F1y38TN9AUTyd0eTbu4kx4FiNgfsLDPvWvi92Fv5HWFjQ%2Fedit%3Ftab%3Dt.0%23heading%3Dh.pub7jnop54q0" target="_blank" title="https://docs.google.com/document/d/1y38TN9AUTyd0eTbu4kx4FiNgfsLDPvWvi92Fv5HWFjQ/edit?tab=t.0#heading=h.pub7jnop54q0" ref="nofollow noopener noreferrer">A Basic Color Set for Flutter (PUBLICLY SHARED)</a></td></tr><tr><td align="left">è§£è€¦æµ‹è¯• (Decoupling tests)</td><td align="left"><strong>è¿›è¡Œä¸­</strong></td><td align="left"><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.google.com%2Fdocument%2Fd%2F1UHxALQqCbmgjnM1RNV9xE2pK3IGyx-UktGX1D7hYCjs%2Fedit%3Ftab%3Dt.0" target="_blank" title="https://docs.google.com/document/d/1UHxALQqCbmgjnM1RNV9xE2pK3IGyx-UktGX1D7hYCjs/edit?tab=t.0" ref="nofollow noopener noreferrer">Decoupling Framework Tests (PUBLICLY SHARED)</a> <br/> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fissues%2F177028" target="_blank" title="https://github.com/flutter/flutter/issues/177028" ref="nofollow noopener noreferrer">Issue #177028</a></td></tr><tr><td align="left">æ–‡æœ¬ (Text)</td><td align="left"><strong>è®¨è®ºä¸­</strong></td><td align="left"><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.google.com%2Fdocument%2Fd%2F1X50eQ-T-XW4B8-P1V21fJ0z2N_8s-gE8T_t7Q4tQ5y4%2Fedit" target="_blank" title="https://docs.google.com/document/d/1X50eQ-T-XW4B8-P1V21fJ0z2N_8s-gE8T_t7Q4tQ5y4/edit" ref="nofollow noopener noreferrer">Flutter Decoupling Design From Text (PUBLICLY SHARED)</a></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-18">ğŸ“œ æ»šåŠ¨ (Scrolling): æ›´å¥å£®å’Œå¯é¢„æµ‹çš„ Slivers</h2>
<p>æœ¬æ¬¡å‘å¸ƒå¸¦æ¥äº†å¤šé¡¹ä¿®å¤ï¼Œä½¿å¾—æ„å»ºå¤æ‚çš„æ»šåŠ¨å¸ƒå±€ï¼ˆå°¤å…¶æ˜¯ä½¿ç”¨ <strong><code>SliverMainAxisGroup</code></strong> å’Œ <strong><code>SliverCrossAxisGroup</code></strong> çš„å¸ƒå±€ï¼‰æ›´åŠ <strong>å¥å£®å’Œå¯é¢„æµ‹</strong>ã€‚</p>
<ul>
<li>å¼€å‘è€…åœ¨ä½¿ç”¨è¿™äº› Widget å¯¹å¤šä¸ª Slivers è¿›è¡Œåˆ†ç»„æ—¶ï¼Œä¼šå‘ç°<strong>æ‰‹åŠ¿å¤„ç†ç°åœ¨æ›´å¯é </strong>ã€‚å¯¹è¿™äº›ç»„å†… Slivers ä¸Šçš„ç‚¹å‡»å’Œå…¶ä»–æŒ‡é’ˆäº‹ä»¶çš„å‘½ä¸­æµ‹è¯•ç°åœ¨è®¡ç®—æ­£ç¡®ï¼Œç¡®ä¿ç”¨æˆ·äº¤äº’æŒ‰é¢„æœŸè¿›è¡Œ (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F174265" target="_blank" title="https://github.com/flutter/flutter/pull/174265" ref="nofollow noopener noreferrer">#174265</a>)ã€‚</li>
<li>å…¶ä»–å‡ é¡¹ä¿®å¤æœ‰åŠ©äº <strong><code>SliverMainAxisGroup</code></strong> å†…æ›´ç²¾ç¡®çš„æ»šåŠ¨è¡Œä¸ºï¼š
<ul>
<li>è§£å†³äº†ä½¿ç”¨å›ºå®šå¤´éƒ¨ (pinned header) æ—¶çš„<strong>è¿‡åº¦æ»šåŠ¨é—®é¢˜</strong> (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F173349" target="_blank" title="https://github.com/flutter/flutter/pull/173349" ref="nofollow noopener noreferrer">#173349</a>)ã€‚</li>
<li>è°ƒç”¨ <strong><code>showOnScreen</code></strong> ä»¥æ˜¾ç¤ºä¸€ä¸ª Sliver ç°åœ¨å¯ä»¥æ­£å¸¸å·¥ä½œ (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F171339" target="_blank" title="https://github.com/flutter/flutter/pull/171339" ref="nofollow noopener noreferrer">#171339</a>)ã€‚</li>
<li>å†…éƒ¨æ»šåŠ¨åç§»é‡çš„è®¡ç®—æ›´ç²¾ç¡® (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F174369" target="_blank" title="https://github.com/flutter/flutter/pull/174369" ref="nofollow noopener noreferrer">#174369</a>)ã€‚</li>
</ul>
</li>
<li>å¯¹äºæ„å»ºè‡ªå®šä¹‰æ»šåŠ¨è§†å›¾çš„å¼€å‘è€…ï¼Œæ–°çš„ <strong><code>SliverGrid.list</code></strong> æ„é€ å‡½æ•° (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F173925" target="_blank" title="https://github.com/flutter/flutter/pull/173925" ref="nofollow noopener noreferrer">#173925</a>) æä¾›äº†ä¸€ç§ä»ç®€å•å­ Widget åˆ—è¡¨åˆ›å»ºç½‘æ ¼çš„æ›´æ¸…æ™°æ–¹æ³•ã€‚</li>
<li>æœ¬æ¬¡å‘å¸ƒè¿˜æ”¹è¿›äº†å¤æ‚å¸ƒå±€ä¸­é”®ç›˜å’Œ D-pad ç”¨æˆ·çš„<strong>ç„¦ç‚¹å¯¼èˆª</strong>ã€‚åœ¨å…·æœ‰ä¸åŒæ»šåŠ¨è½´çš„åµŒå¥—æ»šåŠ¨è§†å›¾ä¸­ï¼ˆä¾‹å¦‚å‚ç›´åˆ—è¡¨ä¸­çš„æ°´å¹³è½®æ’­å›¾ï¼‰ï¼Œå®šå‘ç„¦ç‚¹å¯¼èˆªç°åœ¨æ›´å¯é¢„æµ‹ï¼Œé˜²æ­¢ç„¦ç‚¹æ„å¤–åœ°åœ¨ä¸åŒéƒ¨åˆ†ä¹‹é—´è·³è½¬ (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F172875" target="_blank" title="https://github.com/flutter/flutter/pull/172875" ref="nofollow noopener noreferrer">#172875</a>)ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-19">â™¿ Accessibility: ä¸ºæ‰€æœ‰ç”¨æˆ·æä¾›æ›´åŒ…å®¹çš„ä½“éªŒ</h2>
<p>ä½¿åº”ç”¨ç¨‹åºå¯¹æ‰€æœ‰ç”¨æˆ·éƒ½å¯è®¿é—®æ˜¯ Flutter æ¡†æ¶çš„åŸºçŸ³ã€‚æœ¬æ¬¡å‘å¸ƒé€šè¿‡æä¾›æ›´å¤šçš„<strong>ç¼–ç¨‹æ§åˆ¶</strong>ã€<strong>æ”¹å–„å›½é™…ç”¨æˆ·çš„ä½“éªŒ</strong>ä»¥åŠ<strong>ä¼˜åŒ–æ ¸å¿ƒ Widget çš„è¾…åŠ©åŠŸèƒ½</strong>ï¼Œç»§ç»­å±¥è¡Œè¿™ä¸€æ‰¿è¯ºã€‚</p>
<ul>
<li>å¯¹äºæ„å»ºå¤æ‚åº”ç”¨çš„å¼€å‘è€…ï¼Œæœ¬æ¬¡å‘å¸ƒå¼•å…¥äº†é€šè¿‡ä½¿ç”¨ <strong><code>WidgetsFlutterBinding.instance.ensureSemantics</code></strong> æ¥<strong>åœ¨ iOS ä¸Šé»˜è®¤å¼€å¯è¾…åŠ©åŠŸèƒ½</strong>çš„èƒ½åŠ› (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F174163" target="_blank" title="https://github.com/flutter/flutter/pull/174163" ref="nofollow noopener noreferrer">#174163</a>)ã€‚</li>
<li>è°ƒè¯•è¾…åŠ©åŠŸèƒ½é—®é¢˜ç°åœ¨æ›´å®¹æ˜“äº†ï¼Œå› ä¸º <strong><code>debugDumpSemanticsTree</code></strong> åŒ…å«äº†é¢å¤–çš„<strong>æ–‡æœ¬è¾“å…¥éªŒè¯ç»“æœä¿¡æ¯</strong>ï¼Œæœ‰åŠ©äºæ›´å¿«åœ°è¯Šæ–­é—®é¢˜ (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F174677" target="_blank" title="https://github.com/flutter/flutter/pull/174677" ref="nofollow noopener noreferrer">#174677</a>)ã€‚</li>
<li>å¯¹äºåŸºäº Sliver çš„æ»šåŠ¨è§†å›¾ä¸­çš„é«˜çº§è¾…åŠ©åŠŸèƒ½ï¼Œç°åœ¨å¯ä»¥ä½¿ç”¨æ–°çš„ <strong><code>SliverSemantics</code></strong> Widget (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F167300" target="_blank" title="https://github.com/flutter/flutter/pull/167300" ref="nofollow noopener noreferrer">#167300</a>)ã€‚
<ul>
<li>å°±åƒç°æœ‰çš„ <code>Semantics</code> Widget ä¸€æ ·ï¼Œå¼€å‘è€…å¯ä»¥åœ¨ <code>CustomScrollView</code> ä¸­ä½¿ç”¨ <code>SliverSemantics</code> æ¥ç”¨ç‰¹å®šçš„è¯­ä¹‰ä¿¡æ¯<strong>æ³¨è§£ (annotate)</strong> Sliver æ ‘çš„ä¸€éƒ¨åˆ†ã€‚</li>
<li>è¿™å¯¹äºä¸ºå±å¹•é˜…è¯»å™¨æ³¨è§£å¤´éƒ¨ã€åˆ†é…è¯­ä¹‰è§’è‰²å’Œæ·»åŠ æè¿°æ€§æ ‡ç­¾ç‰¹åˆ«æœ‰ç”¨ï¼Œä¸ºç”¨æˆ·æä¾›æ›´æ˜“ç†è§£å’Œå¯è®¿é—®çš„ä½“éªŒã€‚</li>
</ul>
</li>
<li>æ ¸å¿ƒ Widget çš„è¾…åŠ©åŠŸèƒ½ä¹Ÿåœ¨ç»§ç»­å®Œå–„ï¼š
<ul>
<li><strong><code>CupertinoExpansionTile</code></strong> ç°åœ¨<strong>é»˜è®¤å¯è®¿é—®</strong> (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F174480" target="_blank" title="https://github.com/flutter/flutter/pull/174480" ref="nofollow noopener noreferrer">#174480</a>)ã€‚</li>
<li><strong><code>AutoComplete</code></strong> Widget ç°åœ¨ä¼šå‘ç”¨æˆ·<strong>å®£å¸ƒæœç´¢ç»“æœçš„çŠ¶æ€</strong> (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F173480" target="_blank" title="https://github.com/flutter/flutter/pull/173480" ref="nofollow noopener noreferrer">#173480</a>)ã€‚</li>
<li>å…¶ä»–æ”¹è¿›ï¼Œä¾‹å¦‚ <strong><code>TimePicker</code></strong> ä¸­æ›´å¤§çš„è§¦æ‘¸ç›®æ ‡ (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F170060" target="_blank" title="https://github.com/flutter/flutter/pull/170060" ref="nofollow noopener noreferrer">#170060</a>)ï¼Œæœ‰åŠ©äºæä¾›æ›´æ˜“äºè®¿é—®çš„å¼€ç®±å³ç”¨ä½“éªŒã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-20">ğŸ iOS å¹³å°æ”¯æŒä¸è¿ç§»</h2>
<h3 data-id="heading-21">å¹³å°æ”¯æŒ</h3>
<p>æˆ‘ä»¬å¾ˆé«˜å…´åœ°ç¡®è®¤ Flutter <strong>å®Œå…¨æ”¯æŒæœ€æ–°çš„å¹³å°ç‰ˆæœ¬</strong>ï¼š<strong>iOS 26ã€Xcode 26 å’Œ macOS 26</strong>ï¼ˆå‡äº 9 æœˆå‘å¸ƒï¼‰ã€‚è¿™ç¡®ä¿æ‚¨å¯ä»¥ç«‹å³åœ¨ Apple æœ€æ–°çš„æ“ä½œç³»ç»Ÿå’Œå·¥å…·é“¾ä¸Šå¼€å§‹å¼€å‘å’Œæµ‹è¯•æ‚¨çš„åº”ç”¨ã€‚</p>
<h3 data-id="heading-22">éƒ¨ç½²æµç¨‹æ”¹è¿›</h3>
<p>æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼ŒFlutter åœ¨ä¸Šä¸€ä¸ªç‰ˆæœ¬ä¸­ä¸º iOS å¼€å‘è€…å¸¦æ¥äº†é‡å¤§çš„<strong>ç”Ÿæ´»è´¨é‡æ”¹è¿› (quality-of-life improvement)</strong>ï¼Œè§£å†³äº†é•¿æœŸå›°æ‰°ç”¨æˆ·çš„ä¸€ä¸ªé—®é¢˜ï¼šä½¿ç”¨ <code>flutter run</code> åœ¨çœŸæœºä¸Šè¿è¡Œ Flutter åº”ç”¨æ—¶ï¼Œè¦æ±‚ Xcode åº”ç”¨ç¨‹åº<strong>è‡ªåŠ¨å¯åŠ¨</strong>ã€‚</p>
<ul>
<li>æˆ‘ä»¬å¼•å…¥äº†ä¸€ç§æ–°çš„éƒ¨ç½²æ–¹æ³•ï¼Œä½¿ç”¨ <strong>Xcode 26 å‘½ä»¤è¡Œå·¥å…· <code>devicectl</code></strong> è¿›è¡Œåº”ç”¨ç¨‹åºå®‰è£…ã€å¯åŠ¨å’Œè°ƒè¯•ã€‚</li>
<li>è¿™ä¸€è½¬å˜<strong>æ¶ˆé™¤äº†åœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­è°ƒç”¨ Xcode åº”ç”¨ç¨‹åºçš„éœ€è¦</strong>ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä»…ä¾èµ–äºå‘½ä»¤è¡Œ Xcode æ„å»ºå·¥å…·ã€‚</li>
<li>æ­¤å‰ï¼Œæ­¤åŠŸèƒ½ä¾èµ–äº Xcode è‡ªåŠ¨åŒ–ï¼Œä½†åœ¨ Xcode 26 ä¸Šå˜å¾—ä¸ç¨³å®šå’Œä¸å¯é ï¼Œå°¤å…¶æ˜¯åœ¨è¿ç»­æ‰§è¡Œå‘½ä»¤æ—¶ã€‚å¦‚æœæ‚¨ç°åœ¨æ­£åœ¨ä¸ºæœ€æ–°çš„ Apple ç‰ˆæœ¬è¿›è¡Œå¼€å‘ï¼Œæˆ‘ä»¬<strong>å¼ºçƒˆå»ºè®®</strong>æ‚¨å°† Flutter æ›´æ–°åˆ° <strong>3.38 æˆ–æ›´é«˜ç‰ˆæœ¬</strong>ã€‚</li>
<li>å¦‚æœæ‚¨é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ <code>flutter config --no-enable-lldb-debugging</code> ç¦ç”¨æ­¤éƒ¨ç½²æ–¹æ³•ï¼Œå¹¶<strong>æäº¤é—®é¢˜</strong>è®©æˆ‘ä»¬çŸ¥é“ï¼</li>
</ul>
<h3 data-id="heading-23"><code>UIScene</code> ç”Ÿå‘½å‘¨æœŸè¿ç§»</h3>
<p>Flutter 3.38 åŒ…å«äº†å¯¹ Apple å¼ºåˆ¶è¦æ±‚çš„ <strong><code>UIScene</code> ç”Ÿå‘½å‘¨æœŸ</strong>çš„å…³é”®æ”¯æŒã€‚</p>
<ul>
<li>è¿™æ˜¯ç»§ Apple åœ¨ WWDC25 ä¸Šå®£å¸ƒ**â€œåœ¨ iOS 26 ä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œä»»ä½•ä½¿ç”¨æœ€æ–° SDK æ„å»ºçš„ UIKit åº”ç”¨éƒ½å°†è¢«è¦æ±‚ä½¿ç”¨ <code>UIScene</code> ç”Ÿå‘½å‘¨æœŸï¼Œå¦åˆ™å°†æ— æ³•å¯åŠ¨â€**ä¹‹åï¼Œä¸€é¡¹å…³é”®çš„ã€<strong>å‰ç»æ€§çš„æ›´æ–°</strong>ã€‚</li>
<li>ä¸ºäº†ç¡®ä¿æ‚¨çš„ iOS Flutter åº”ç”¨ç¨‹åºåœ¨æœªæ¥çš„ iOS ç‰ˆæœ¬ä¸Šä¿æŒå…¼å®¹å¹¶æˆåŠŸå¯åŠ¨ï¼Œ<strong>éœ€è¦è¿›è¡Œè¿ç§»</strong>ã€‚</li>
</ul>
<h3 data-id="heading-24">ğŸ“± è¿ç§» Flutter åº”ç”¨</h3>
<p>æ‰€æœ‰ç°æœ‰çš„ iOS Flutter åº”ç”¨éƒ½å¿…é¡»è¿ç§»åˆ°æ–°çš„ç”Ÿå‘½å‘¨æœŸã€‚æ‚¨æœ‰ä¸¤ç§é€”å¾„å®Œæˆæ­¤è¿ç§»ï¼š</p>
<ol>
<li><strong>æ‰‹åŠ¨è¿ç§»ï¼š</strong> éµå¾ª Flutter ç½‘ç«™ä¸Šæä¾›çš„<strong>æ‰‹åŠ¨è¿ç§»è¯´æ˜</strong>ã€‚</li>
<li><strong>è‡ªåŠ¨è¿ç§»ï¼ˆå®éªŒæ€§ï¼‰ï¼š</strong> å¯ç”¨ä¸€ä¸ªå®éªŒæ€§åŠŸèƒ½æ¥è‡ªåŠ¨å¤„ç†è¿ç§»ã€‚æ­¤åŠŸèƒ½å°†åœ¨æœªæ¥ç‰ˆæœ¬ä¸­é»˜è®¤å¯ç”¨ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
flutter config --enable-ios-scene-lifecycle-migration</li>
</ol>
<h3 data-id="heading-25">è¿ç§» Flutter æ’ä»¶</h3>
<p>ä¾èµ–äº<strong>åº”ç”¨ç”Ÿå‘½å‘¨æœŸäº‹ä»¶</strong>çš„ Flutter æ’ä»¶<strong>å¿…é¡»</strong>æ›´æ–°ä»¥ä½¿ç”¨ <code>UIScene</code> ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚æ’ä»¶å¼€å‘è€…åº”å‚è€ƒ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.dev%2Frelease%2Fbreaking-changes%2Fuiscenedelegate%23migration-guide-for-flutter-plugins" target="_blank" title="https://docs.flutter.dev/release/breaking-changes/uiscenedelegate#migration-guide-for-flutter-plugins" ref="nofollow noopener noreferrer">è¿ç§»æŒ‡å—</a>ã€‚å°šæœªè¿ç§»çš„æ’ä»¶å°†åœ¨æœªæ¥ç‰ˆæœ¬ä¸­æ˜¾ç¤ºè­¦å‘Šã€‚</p>
<h3 data-id="heading-26">è¿ç§»åµŒå…¥å¼ Flutter (å¯é€‰)</h3>
<p>å¯¹äºå°† Flutter åµŒå…¥åˆ°åŸç”Ÿå®¿ä¸»åº”ç”¨ç¨‹åºçš„é¡¹ç›®ï¼Œè¿ç§»æ˜¯<strong>å¯é€‰ä½†å¼ºçƒˆæ¨è</strong>çš„ã€‚é‡‡ç”¨ Flutter æ–°çš„ <code>UIScene</code> APIï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.dev%2Frelease%2Fbreaking-changes%2Fuiscenedelegate%23migration-guide-for-adding-flutter-to-existing-app-add-to-app" target="_blank" title="https://docs.flutter.dev/release/breaking-changes/uiscenedelegate#migration-guide-for-adding-flutter-to-existing-app-add-to-app" ref="nofollow noopener noreferrer">ä½¿ç”¨æ·»åŠ åˆ°åº”ç”¨è¿ç§»æŒ‡å—</a>ï¼‰å¯ä¸ºæ‚¨çš„æ’ä»¶å¯ç”¨åœºæ™¯ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œç¡®ä¿ä¸ Flutter ç”Ÿæ€ç³»ç»Ÿçš„å…¼å®¹æ€§ã€‚</p>
<hr/>
<h2 data-id="heading-27">ğŸ¤– Android å¹³å°æ›´æ–°</h2>
<hr/>
<h3 data-id="heading-28">16KB é¡µé¢å¤§å°å…¼å®¹æ€§</h3>
<p>å‡çº§åˆ° Flutter 3.38 æ˜¯ä¸º <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fguide%2Fpractices%2Fpage-sizes" target="_blank" title="https://developer.android.com/guide/practices/page-sizes" ref="nofollow noopener noreferrer">Google Play 16 KB é¡µé¢å¤§å°å…¼å®¹æ€§è¦æ±‚</a>åšå‡†å¤‡çš„å…³é”®æ­¥éª¤ã€‚</p>
<ul>
<li>ä» <strong>2025 å¹´ 11 æœˆ 1 æ—¥</strong>èµ·ï¼Œé¢å‘ Android 15 åŠæ›´é«˜ç‰ˆæœ¬çš„åº”ç”¨å¿…é¡»æ”¯æŒ 16 KB é¡µé¢ã€‚</li>
<li>è¿™ä¸€å˜åŒ–ç¡®ä¿æ‚¨çš„åº”ç”¨åœ¨é«˜å†…å­˜è®¾å¤‡ä¸Šæ­£ç¡®è¿è¡Œï¼Œå¹¶æä¾›é«˜è¾¾ <strong>30% æ›´å¿«çš„å¯åŠ¨é€Ÿåº¦</strong>ç­‰æ€§èƒ½ä¼˜åŠ¿ã€‚</li>
<li>Flutter 3.38 å°†é»˜è®¤çš„ Android <code>ndkVersion</code> æ›´æ–°ä¸º <strong>NDK r28</strong>ï¼Œè¿™æ˜¯åŸç”Ÿä»£ç å®ç° 16 KB æ”¯æŒæ‰€éœ€æ­£ç¡®å¯¹é½çš„<strong>æœ€ä½è¦æ±‚</strong>ã€‚</li>
</ul>
<h3 data-id="heading-29">å†…å­˜æ³„æ¼ä¿®å¤</h3>
<p>Flutter 3.38 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fissues%2F173770" target="_blank" title="https://github.com/flutter/flutter/issues/173770" ref="nofollow noopener noreferrer">ä¿®å¤</a>äº†ä¸€ä¸ªå½±å“æ‰€æœ‰ Android ä¸Šçš„ Flutter åº”ç”¨çš„<strong>é‡è¦å†…å­˜æ³„æ¼é—®é¢˜</strong>ã€‚æ­¤é—®é¢˜ï¼ˆåœ¨ 3.29.0 ä¸­å¼•å…¥ï¼‰å‘ç”Ÿåœ¨ <strong>Activities å› å¼€å‘è€…è®¾ç½®æˆ–ç³»ç»Ÿä½å†…å­˜è€Œè¢«é”€æ¯æ—¶</strong>ã€‚</p>
<h3 data-id="heading-30">Android ä¾èµ–é¡¹æ›´æ–°</h3>
<p>ç¡®å®šé€‚ç”¨äºæ‚¨çš„åº”ç”¨çš„ Android ä¾èµ–é¡¹ï¼ˆåŒ…æ‹¬ Gradleã€Android Gradle Plugin (AGP)ã€Kotlin Gradle Plugin (KGP)ã€Java ç­‰ï¼‰çš„æ­£ç¡®ç‰ˆæœ¬ç»„åˆé€šå¸¸æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚å¯¹äº Flutter 3.38 ç‰ˆæœ¬ï¼Œæˆ‘ä»¬åœ¨æŒç»­é›†æˆ (CI) ç¯å¢ƒä¸­æµ‹è¯•å¹¶ç¡®è®¤äº†ä¸ä»¥ä¸‹ Android ä¾èµ–é¡¹çš„å…¼å®¹æ€§ï¼š</p>
<ul>
<li><strong>Java 17ï¼š</strong> Flutter 3.38 ä¸­è¿›è¡Œ Android å¼€å‘æ‰€éœ€çš„<strong>æœ€ä½ç‰ˆæœ¬</strong>ã€‚</li>
<li><strong>KGP 2.2.20ï¼š</strong> å·¥å…·é“¾<strong>å·²çŸ¥å’Œæ”¯æŒçš„æœ€å¤§</strong> Kotlin Gradle Plugin ç‰ˆæœ¬ã€‚</li>
<li><strong>AGP 8.11.1ï¼š</strong> ä¸ KGP 2.2.20 <strong>å…¼å®¹çš„æœ€æ–°</strong> Android Gradle Plugin ç‰ˆæœ¬ã€‚</li>
<li><strong>Gradle 8.14ï¼š</strong> æ­¤ç‰ˆæœ¬é€‚ç”¨äºæ‰€é€‰çš„ Javaã€KGP å’Œ AGP ç‰ˆæœ¬ã€‚è¯·æ³¨æ„ï¼ŒGradle <strong>8.13</strong> æ˜¯ AGP 8.11.1 æ‰€éœ€çš„<strong>æœ€ä½ç‰ˆæœ¬</strong>ã€‚</li>
</ul>
<p>ä¸ºç¡®ä¿æ‚¨çš„åº”ç”¨åœ¨ Flutter ç‰ˆæœ¬ä¹‹é—´æ— ç¼è¿‡æ¸¡ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨åœ¨æ„å»ºæ–‡ä»¶ä¸­ä½¿ç”¨ Flutter SDK æä¾›çš„ API çº§åˆ«å˜é‡ã€‚æ­¤ç‰ˆæœ¬çš„é…ç½®å€¼ä¸ºï¼š</p>
<ul>
<li><code>flutter.compileSdkVersion</code> (<strong>API 36</strong>)</li>
<li><code>flutter.targetSdkVersion</code> (<strong>API 36</strong>)</li>
<li><code>flutter.minSdkVersion</code> (<strong>API 24</strong>) æˆ–æ›´é«˜ç‰ˆæœ¬</li>
</ul>
<hr/>
<h2 data-id="heading-31">âš™ï¸ å¼•æ“ï¼ˆEngineï¼‰æ›´æ–°</h2>
<hr/>
<h3 data-id="heading-32">æ€§èƒ½å åŠ å±‚ (Performance overlay)</h3>
<p>æ€§èƒ½å åŠ å±‚å·²é‡æ„ä»¥æé«˜æ•ˆç‡ï¼Œ<strong>å‡å°‘äº†å…¶åœ¨ Skia å’Œ Impeller åç«¯ä¸Šçš„æ¸²æŸ“æ—¶é—´</strong> (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fissues%2F176364" target="_blank" title="https://github.com/flutter/flutter/issues/176364" ref="nofollow noopener noreferrer">#176364</a>)ã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥è·å¾—æ›´å‡†ç¡®çš„æ€§èƒ½æ•°æ®ï¼Œä¸”å¼€é”€æ›´å°ã€‚</p>
<h3 data-id="heading-33">Vulkan å’Œ OpenGL ES</h3>
<p>å¯¹ <strong>Vulkan</strong> å’Œ <strong>OpenGL ES</strong> åç«¯è¿›è¡Œäº†å¤§é‡ä¿®å¤å’Œæ”¹è¿›ï¼Œæé«˜äº†åœ¨æ›´å¹¿æ³›è®¾å¤‡ä¸Šçš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚è¿™åŒ…æ‹¬æ›´å¥½åœ°å¤„ç†<strong>ç®¡çº¿ç¼“å­˜</strong> (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fissues%2F176322" target="_blank" title="https://github.com/flutter/flutter/issues/176322" ref="nofollow noopener noreferrer">#176322</a>)ã€<strong>å›´æ ç­‰å¾…å™¨</strong> (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fissues%2F173085" target="_blank" title="https://github.com/flutter/flutter/issues/173085" ref="nofollow noopener noreferrer">#173085</a>) å’Œ<strong>å›¾åƒå¸ƒå±€è½¬æ¢</strong> (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fissues%2F173884" target="_blank" title="https://github.com/flutter/flutter/issues/173884" ref="nofollow noopener noreferrer">#173884</a>)ã€‚</p>
<h3 data-id="heading-34">æ¸²æŸ“å™¨ç»Ÿä¸€</h3>
<p>ç»§ç»­åŠªåŠ›ç»Ÿä¸€ <strong>CanvasKit</strong> å’Œ <strong>Skwasm</strong> æ¸²æŸ“å™¨ã€‚æœ¬æ¬¡å‘å¸ƒåŒ…æ‹¬å¤§é‡çš„é‡æ„ï¼Œä»¥åœ¨è¿™ä¸¤è€…ä¹‹é—´<strong>å…±äº«æ›´å¤šä»£ç </strong>ï¼Œè¿™å°†æœ‰åŠ©äºæœªæ¥å¸¦æ¥æ›´ä¸€è‡´çš„ä½“éªŒå’Œæ›´å¿«çš„å¼€å‘é€Ÿåº¦ (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fissues%2F174588" target="_blank" title="https://github.com/flutter/flutter/issues/174588" ref="nofollow noopener noreferrer">#174588</a>)ã€‚</p>
<h3 data-id="heading-35">çº¿ç¨‹åˆå¹¶</h3>
<blockquote>
<p><strong>æ³¨æ„âš ï¸æ³¨æ„âš ï¸æ³¨æ„âš ï¸</strong>
ä» iOS å’Œ Android ä¸­ç§»é™¤äº†é€€å‡ºçº¿ç¨‹åˆå¹¶çš„èƒ½åŠ›**ï¼ˆå³ä¸å†æ”¯æŒå¯é€‰é€€å‡ºï¼‰ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-36">ğŸ› ï¸ DevTools å’Œ IDEs</h2>
<hr/>
<h3 data-id="heading-37">å®éªŒæ€§ Widget é¢„è§ˆ - æ›´æ–°</h3>
<p>Flutter 3.35 å¼•å…¥äº† <strong>Widget é¢„è§ˆ</strong>ï¼Œè¿™æ˜¯ä¸€é¡¹å‡†å¤‡å¥½æ¥å—ç¤¾åŒºæ—©æœŸåé¦ˆçš„å®éªŒæ€§åŠŸèƒ½ã€‚Flutter 3.38 ç‰ˆæœ¬å¸¦æ¥äº†å¯¹ Widget é¢„è§ˆçš„é‡å¤§æ”¹è¿›ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>IDE é›†æˆï¼š</strong> <strong>VSCode</strong> å’Œ <strong>IntelliJ / Android Studio</strong> æ’ä»¶éƒ½å·²æ›´æ–°ï¼Œåˆæ­¥æ”¯æŒ Widget é¢„è§ˆã€‚æ‚¨ç°åœ¨å¯ä»¥ç›´æ¥åœ¨ <strong>IDE å†…</strong>æŸ¥çœ‹é¢„è§ˆï¼Œä»¥è·å¾—æ›´æ— ç¼çš„å¼€å‘ä½“éªŒã€‚</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d728ba17e06442bb38420bcbcd48bf6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763686722&amp;x-signature=CNHXJHMSJzzzHiKxeU4Cu8cyyik%3D" alt="image.png" loading="lazy"/>
å½“åœ¨ IDE ä¸­ä½¿ç”¨æ—¶ï¼Œ<strong>Widget é¢„è§ˆç¯å¢ƒ</strong>é»˜è®¤é…ç½®ä¸ºæ ¹æ®<strong>å½“å‰é€‰å®šçš„æºæ–‡ä»¶</strong>æ¥è¿‡æ»¤æ˜¾ç¤ºçš„é¢„è§ˆï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3f9fbbbb8834d3ca2afe558476acfe4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763686722&amp;x-signature=Cxfo6TyPibXKDUOGxg29AGpuu2A%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>
<p><strong>Widget é¢„è§ˆç¯å¢ƒä¸»é¢˜å’Œæ§åˆ¶æ”¹è¿›</strong>ï¼š Widget é¢„è§ˆç¯å¢ƒç°åœ¨æ”¯æŒæµ…è‰²å’Œæ·±è‰²æ¨¡å¼ï¼Œä»¥åŠè‡ªå®šä¹‰ IDE é…è‰²æ–¹æ¡ˆï¼Œä»¥åŒ¹é…æ‚¨çš„å¼€å‘ç¯å¢ƒã€‚Widget é¢„è§ˆç¯å¢ƒä¸­çš„æ§ä»¶ä¹Ÿå·²è°ƒæ•´ä¸ºå ç”¨æ›´å°‘çš„ç©ºé—´ï¼Œä¸ºæ¸²æŸ“é¢„è§ˆç•™å‡ºæ›´å¤šå¯ç”¨ç©ºé—´ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f07d7d59d214f9a90393a0dbcaafaec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763686722&amp;x-signature=QCgBsxiAD0%2FNZXQHBSnSHAbAhe8%3D" alt="image.png" loading="lazy"/></p>
</li>
<li>
<p><strong>é¢„è§ˆå¯æ‰©å±•æ€§ï¼š</strong> <strong><code>Preview</code> æ ‡æ³¨ç±»</strong>ä¸å†è¢«æ ‡è®°ä¸º <strong><code>final</code></strong>ï¼Œç°åœ¨å¯ä»¥è¢«æ‰©å±•ä»¥åˆ›å»º<strong>è‡ªå®šä¹‰ <code>Preview</code> æ ‡æ³¨</strong>ï¼Œä»è€Œå‡å°‘å¸¸è§é¢„è§ˆç±»å‹çš„æ ·æ¿ä»£ç ã€‚</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8009e1453ad2481c98931ee35fdf0a2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763686722&amp;x-signature=NxQhzN9ddQLYdOeQMtPdfaQTunY%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>å¤šé‡é¢„è§ˆæ”¯æŒ (MultiPreview support):</strong> ä¸€ä¸ªæ–°çš„ <strong><code>MultiPreview</code> åŸºç±»</strong>å…è®¸æ‚¨ä»å•ä¸ªè‡ªå®šä¹‰æ ‡æ³¨ä¸­åˆ›å»º<strong>å¤šä¸ªé¢„è§ˆå˜ä½“</strong>ã€‚</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67be286c177c40c9ad637261cf5775d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763686722&amp;x-signature=CsfEfKGAawm7Jl1EIVZCAcR%2BnxE%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>é¢„è§ˆåˆ†ç»„ï¼ˆPreview groupsï¼‰ï¼š</strong> <code>Preview</code> ç±»ä¸­æ–°å¢äº†ä¸€ä¸ª <strong><code>group</code> å‚æ•°</strong>ï¼Œå…è®¸å°†ç›¸å…³çš„é¢„è§ˆè¿›è¡Œ<strong>åˆ†ç»„</strong>ã€‚</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05e5021b6af047f3ad60336207db8307~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763686722&amp;x-signature=aVA4U39pAy1kCgWYoADbwDhz34c%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>
<p><strong>å‡å°‘ <code>@Preview</code> æ ‡æ³¨å‚æ•°é™åˆ¶ï¼š</strong></p>
<ul>
<li><strong>ç§æœ‰å¸¸é‡</strong>ç°åœ¨è¢«æ”¯æŒä½œä¸º <code>@Preview</code> æ ‡æ³¨çš„å‚æ•°ã€‚</li>
<li><strong>å‡½æ•°å‚æ•°</strong>ï¼ˆå¦‚ <code>wrapper</code> å’Œ <code>theme</code>ï¼‰ä»ç„¶è¦æ±‚å…·æœ‰å…¬å…±çš„ã€é™æ€å¯è®¿é—®çš„åç§°ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-38">ğŸš§ Widget é¢„è§ˆï¼ˆå®éªŒæ€§ï¼‰- æœªæ¥è®¡åˆ’ä¸åé¦ˆ</h2>
<p>Widget é¢„è§ˆä»ç„¶æ˜¯ä¸€ä¸ª<strong>å®éªŒæ€§åŠŸèƒ½</strong>ï¼Œæ‚¨çš„åé¦ˆå¯¹äºå¡‘é€ å…¶æœªæ¥è‡³å…³é‡è¦ã€‚API å’Œç”¨æˆ·ä½“éªŒå°šæœªç¨³å®šï¼Œå°†æ ¹æ®æˆ‘ä»¬ä»æ‚¨é‚£é‡Œè·å¾—çš„å­¦ä¹ è¿›è¡Œæ›´æ”¹ã€‚</p>
<p>åŸºäºæ—©æœŸçš„åé¦ˆï¼Œè®¡åˆ’è¿›è¡Œæ›´å¤šå¢å¼ºï¼Œä»¥æ”¹è¿› Widget é¢„è§ˆä½“éªŒï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>Flutter DevTools Widget Inspector æ”¯æŒï¼š</strong> Widget Inspector æ­£åœ¨æ›´æ–°ï¼Œä»¥æ”¯æŒåœ¨ Widget é¢„è§ˆç¯å¢ƒä¸­<strong>æ£€æŸ¥é¢„è§ˆ</strong>ã€‚æˆ‘ä»¬è®¡åˆ’å°† Inspector ç›´æ¥åµŒå…¥åˆ° Widget é¢„è§ˆå™¨ä¸­ï¼Œä½¿å…¶æ— è®ºåœ¨ä½•ç§å¼€å‘ç¯å¢ƒä¸­éƒ½æ˜“äºè®¿é—®ã€‚</li>
<li><strong>IDE ä¸­çš„å¤šé¡¹ç›®æ”¯æŒï¼š</strong> Widget é¢„è§ˆå™¨ç›®å‰ä»…æ”¯æŒæ˜¾ç¤ºåŒ…å«åœ¨<strong>å•ä¸ªé¡¹ç›®æˆ– Pub å·¥ä½œåŒº</strong>ä¸­çš„é¢„è§ˆã€‚æˆ‘ä»¬æ­£åœ¨ç§¯æç ”ç©¶æ”¯æŒå…·æœ‰å¤šä¸ª Flutter é¡¹ç›®çš„ IDE ä¼šè¯çš„é€‰é¡¹ï¼ˆé—®é¢˜ [#173550]ï¼‰ã€‚</li>
<li><strong>å¯åŠ¨æ€§èƒ½æ”¹è¿›ï¼š</strong> æ­£åœ¨è°ƒæŸ¥æ€§èƒ½æ”¹è¿›çš„æœºä¼šï¼Œä»¥å‡å°‘åˆå§‹å¯åŠ¨æ—¶é—´ï¼ŒåŒ…æ‹¬ï¼š
<ul>
<li>åœ¨é¦–æ¬¡è¿è¡Œå<strong>å¯åŠ¨é¢„ç¼–è¯‘çš„ Widget é¢„è§ˆç¯å¢ƒ</strong>ã€‚</li>
<li><strong>å¹¶è¡ŒåŒ–é¢„è§ˆæ£€æµ‹é€»è¾‘</strong>ï¼Œä»¥æ›´å¥½åœ°å¤„ç†å¤§å‹é¡¹ç›®ã€‚</li>
</ul>
</li>
</ul>
<p><strong>å¼€å§‹ä½¿ç”¨ï¼š</strong></p>
<ul>
<li><strong>é˜…è¯»æ–‡æ¡£ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.dev%2Ftools%2Fwidget-previewer" target="_blank" title="https://docs.flutter.dev/tools/widget-previewer" ref="nofollow noopener noreferrer">Flutter Widget Previews å…¥é—¨ (å®éªŒæ€§)</a></li>
<li><strong>æä¾›åé¦ˆï¼š</strong> åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fissues%2Fnew%2Fchoose" target="_blank" title="https://github.com/flutter/flutter/issues/new/choose" ref="nofollow noopener noreferrer">Flutter GitHub ä»“åº“</a>ä¸­æäº¤é—®é¢˜å’ŒåŠŸèƒ½è¯·æ±‚ã€‚</li>
<li><strong>äº†è§£æ›´å¤šï¼š</strong> è¦è¿›è¡ŒæŠ€æœ¯æ·±å…¥æ¢è®¨ï¼Œè¯·å‚é˜… <a href="https://link.juejin.cn?target=https%3A%2F%2Fflutter.dev%2Fgo%2Fwidget-previews-architecture" target="_blank" title="https://flutter.dev/go/widget-previews-architecture" ref="nofollow noopener noreferrer">Flutter Widget Previews æ¶æ„æ–‡æ¡£</a>ã€‚</li>
</ul>
<blockquote>
<p><strong>é‡è¦æç¤ºï¼š</strong> å­˜åœ¨ä¸€ä¸ªå·²çŸ¥é—®é¢˜ï¼Œå³åœ¨æ‰§è¡Œ <code>flutter pub get</code> åï¼ŒWidget é¢„è§ˆå™¨å¯èƒ½ä¼šå´©æºƒæˆ–åœæ­¢æ›´æ–°ã€‚å¦‚æœæ‚¨é‡åˆ°æ­¤é—®é¢˜ï¼Œè¯·åœ¨æ‚¨çš„é¡¹ç›®ä¸­è¿è¡Œ <code>flutter pub get</code> å¹¶<strong>é‡å¯æ‚¨çš„ IDE</strong>ã€‚è¯¦è§ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fissues%2F178317" target="_blank" title="https://github.com/flutter/flutter/issues/178317" ref="nofollow noopener noreferrer">#178317</a>ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-39">ğŸ’» DevTools æ›´æ–°</h2>
<p>Flutter 3.38 åŒ…å«äº†å¯¹ç”¨æˆ·åœ¨ 2025 å¹´ DevTools ç”¨æˆ·è°ƒæŸ¥ä¸­æå‡ºçš„<strong>ä¸€äº›ä¸»è¦ç—›ç‚¹</strong>çš„ä¿®å¤ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>ç½‘ç»œé¢æ¿ (Network Panel) æ”¹è¿›ï¼š</strong>
<ul>
<li>ä½¿äººæ›´å®¹æ˜“ç†è§£é¢æ¿<strong>ä½•æ—¶æ­£åœ¨è®°å½•ç½‘ç»œæµé‡</strong>ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fdevtools%2Fpull%2F9495" target="_blank" title="https://github.com/flutter/devtools/pull/9495" ref="nofollow noopener noreferrer">#9495</a>)</li>
<li>ä¿®å¤äº†<strong>å¤åˆ¶ç²˜è´´ç½‘ç»œè¯·æ±‚</strong>çš„é—®é¢˜ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fdevtools%2Fpull%2F9472" target="_blank" title="https://github.com/flutter/devtools/pull/9472" ref="nofollow noopener noreferrer">#9472</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fdevtools%2Fpull%2F9482" target="_blank" title="https://github.com/flutter/devtools/pull/9482" ref="nofollow noopener noreferrer">#9482</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fdevtools%2Fpull%2F9485" target="_blank" title="https://github.com/flutter/devtools/pull/9485" ref="nofollow noopener noreferrer">#9485</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fdevtools%2Fpull%2F8588" target="_blank" title="https://github.com/flutter/devtools/pull/8588" ref="nofollow noopener noreferrer">#8588</a>)</li>
</ul>
</li>
<li><strong>Flutter Inspector ä¿®å¤ï¼š</strong>
<ul>
<li>ä¿®å¤äº†ä¸€ä¸ªé”™è¯¯ï¼Œå³é€‰æ‹©ä¸€ä¸ª Widget æœ‰æ—¶ä¼šæ‰“å¼€<strong>åº•å±‚çš„æ¡†æ¶æºä»£ç </strong>è€Œä¸æ˜¯ç”¨æˆ·çš„æºä»£ç ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fissues%2F176530" target="_blank" title="https://github.com/flutter/flutter/issues/176530" ref="nofollow noopener noreferrer">#176530</a>)</li>
<li>ä¿®å¤äº†ä¸€ä¸ªå¶å°”é˜»æ­¢ä¸ Inspector é¢æ¿<strong>é¡¶éƒ¨æŒ‰é’®äº¤äº’</strong>çš„é”™è¯¯ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fdevtools%2Fpull%2F9327" target="_blank" title="https://github.com/flutter/devtools/pull/9327" ref="nofollow noopener noreferrer">#9327</a>)</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-40">ğŸš« å¼ƒç”¨å’Œç ´åæ€§æ›´æ”¹</h2>
<p>æœ¬æ¬¡å‘å¸ƒåŒ…æ‹¬å‡ é¡¹é‡è¦çš„<strong>å¼ƒç”¨</strong>å’Œ<strong>ç ´åæ€§æ›´æ”¹</strong>ï¼Œä½œä¸ºæŒç»­ç°ä»£åŒ–å’Œæ”¹è¿› Flutter æ¡†æ¶åŠªåŠ›çš„ä¸€éƒ¨åˆ†ã€‚</p>
<ul>
<li><strong>æ„å»ºå’Œå·¥å…·é“¾å…³é”®æ›´æ”¹ï¼š</strong> å¯èƒ½ä¼šå½±å“è‡ªå®šä¹‰æ„å»ºè„šæœ¬ã€‚
<ul>
<li>Flutter SDK æ ¹ç›®å½•ä¸‹çš„ <strong><code>version</code> æ–‡ä»¶å·²è¢«ç§»é™¤</strong>ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä½äº <code>bin/cache</code> ä¸­çš„æ–°æ–‡ä»¶ <strong><code>flutter.version.json</code></strong> (#172793)ã€‚</li>
<li>æ­¤å¤–ï¼Œ<strong><code>AssetManifest.json</code> æ–‡ä»¶ä¸å†é»˜è®¤ç”Ÿæˆ</strong> (#172594)ã€‚</li>
</ul>
</li>
<li><strong>å…¶ä»–å€¼å¾—æ³¨æ„çš„æ›´æ”¹åŒ…æ‹¬ï¼š</strong>
<ul>
<li>ä¸ºäº†æ›´å¯é¢„æµ‹çš„è¡Œä¸ºï¼ŒåŒ…å« <strong>Actionï¼ˆæ“ä½œï¼‰çš„ <code>SnackBar</code> å°†ä¸å†è‡ªåŠ¨å…³é—­</strong> (#173084)ã€‚</li>
<li><strong><code>OverlayPortal.targetsRootOverlay</code> æ„é€ å‡½æ•°å·²å¼ƒç”¨</strong>ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æ›´çµæ´»çš„ <code>OverlayPortal(overlayLocation: OverlayChildLocation.rootOverlay)</code>ã€‚</li>
<li><code>CupertinoDynamicColor</code> ä¸Šçš„å‡ ä¸ªå±æ€§ï¼ˆä¾‹å¦‚ <code>withAlpha</code> å’Œ <code>withOpacity</code>ï¼‰ç°å·²<strong>å¼ƒç”¨</strong>ï¼Œæ¨èä½¿ç”¨æ ‡å‡†çš„ <code>Color</code> æ–¹æ³• (#171160)ã€‚</li>
<li>Flutter 3.38 è¦æ±‚ <strong>Java 17 ä½œä¸º Android çš„æœ€ä½ç‰ˆæœ¬</strong>ï¼Œä¸ <code>Gradle 8.14</code>ï¼ˆ2025 å¹´ 7 æœˆå‘å¸ƒï¼‰çš„æœ€ä½è¦æ±‚ç›¸åŒ¹é…ã€‚</li>
</ul>
</li>
</ul>
<p>æœ‰å…³è¿™äº›å’Œå…¶ä»–æ›´æ”¹çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯å’Œè¿ç§»æŒ‡å—ï¼Œè¯·æŸ¥é˜…<strong>ç ´åæ€§æ›´æ”¹é¡µé¢</strong>ã€‚</p>
<h2 data-id="heading-41">ç»“æŸè¯­</h2>
<p>Flutter 3.38 ä¸“æ³¨äºè®©æ‚¨çš„æ—¥å¸¸å¼€å‘<strong>æ›´å¿«ã€æ›´æ„‰å¿«</strong>ã€‚è¿™äº›å¢å¼ºåŠŸèƒ½æ—¨åœ¨ç®€åŒ–æ‚¨çš„æ„å»ºæ–¹å¼ã€‚æˆ‘ä»¬éå¸¸æ„Ÿè°¢ä¸ºæœ¬æ¬¡å‘å¸ƒåšå‡ºè´¡çŒ®çš„æ¯ä¸€ä½ç¤¾åŒºæˆå‘˜çš„è¾›å‹¤å·¥ä½œå’Œåé¦ˆã€‚</p>
<p>è¦è·å–æ‰€æœ‰æ›´æ”¹çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·åŠ¡å¿…æŸ¥çœ‹è¯¦ç»†çš„<strong>ç ´åæ€§æ›´æ”¹å’Œå‘å¸ƒè¯´æ˜</strong>ã€‚è¦å…è´¹æå‡æ‚¨çš„ç”Ÿäº§åŠ›ï¼Œåªéœ€è¿è¡Œ <code>flutter upgrade</code>ï¼</p>
<p>æ‚¨å·²ç»ä½¿ç”¨ä¸Šäº†flutter 3.38äº†å‘¢è¿˜æ˜¯æ‰“ç®—ç»§ç»­ç­‰ç­‰ï¼Ÿåæ­£æˆ‘å…ˆç”¨ä¸ºæ•¬ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[qinkunçš„ç¼“å­˜æœºåˆ¶ä¹Ÿæœ‰å¼Šç«¯ï¼Œå»ºè®®å®˜æ–¹åŠ ä¸ªå‚æ•°æ§åˆ¶]]></title>    <link>https://juejin.cn/post/7572141390857437184</link>    <guid>https://juejin.cn/post/7572141390857437184</guid>    <pubDate>2025-11-14T05:54:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572141390857437184" data-draft-id="7572141390857355264" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="qinkunçš„ç¼“å­˜æœºåˆ¶ä¹Ÿæœ‰å¼Šç«¯ï¼Œå»ºè®®å®˜æ–¹åŠ ä¸ªå‚æ•°æ§åˆ¶"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-14T05:54:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çŸ³å°çŸ³Orz"/> <meta itemprop="url" content="https://juejin.cn/user/660148845294712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            qinkunçš„ç¼“å­˜æœºåˆ¶ä¹Ÿæœ‰å¼Šç«¯ï¼Œå»ºè®®å®˜æ–¹åŠ ä¸ªå‚æ•°æ§åˆ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/660148845294712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çŸ³å°çŸ³Orz
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T05:54:49.000Z" title="Fri Nov 14 2025 05:54:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    37
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>å…¬å¸å‰ç«¯åŸºäºqiankunæ¶æ„ï¼Œä¸»åº”ç”¨é€šè¿‡qiankunåŠ è½½å­åº”ç”¨ï¼Œå­åº”ç”¨ä¹Ÿå¯èƒ½é€šè¿‡qiankunç»§ç»­åŠ è½½å­åº”ç”¨ï¼Œåå¤å¥—å¨ƒã€‚ç»è¿‡æµ‹è¯•ï¼Œä¸æ–­æ‰“å¼€å­åº”ç”¨åï¼Œä¼šå¯¼è‡´å†…å­˜ä¸æ–­ä¸Šä¸Šã€‚é€šè¿‡<strong>å¿«ç…§åˆ†æ</strong>ï¼Œå‘ç°å†…å­˜å‡é«˜çš„å…ƒå‡¶æ˜¯qiankunå†…ç½®çš„# <code>import-html-entry</code>ã€‚</p>
<h2 data-id="heading-0"><code>import-html-entry</code> çš„ä½œç”¨æ˜¯ä»€ä¹ˆ</h2>
<p><code>import-html-entry</code> æ˜¯ qiankun / single-spa å¾®å‰ç«¯ç”Ÿæ€çš„æ ¸å¿ƒæ¨¡å—ä¹‹ä¸€ï¼Œç”¨æ¥ï¼š</p>
<p>åŠ è½½è¿œç¨‹ HTML å…¥å£æ–‡ä»¶ï¼ˆentry HTMLï¼‰ï¼Œå¹¶æå–å‡ºå…¶ä¸­çš„ <strong>JS / CSS / é™æ€èµ„æº</strong>ï¼Œç„¶åæŒ‰éœ€æ‰§è¡Œæˆ–æ³¨å…¥ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { importEntry } <span class="hljs-keyword">from</span> <span class="hljs-string">'import-html-entry'</span>;

<span class="hljs-keyword">const</span> { execScripts } = <span class="hljs-keyword">await</span> importEntry(<span class="hljs-string">'https://wwww.çŸ³å°çŸ³.com/'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-built_in">exports</span> = <span class="hljs-keyword">await</span> <span class="hljs-title function_">execScripts</span>(<span class="hljs-variable language_">window</span>);
</code></pre>
<p>ç®€å•æ¥è¯´ï¼Œ<code>import-html-entry</code> è´Ÿè´£åšä¸‰ä»¶äº‹ï¼š</p>
<p><strong>ä¸‹è½½è¿œç¨‹ HTML æ–‡ä»¶</strong></p>
<ul>
<li>ä½¿ç”¨ <code>fetch(url)</code> è¯·æ±‚è¿œç¨‹ HTMLã€‚</li>
<li>è§£æ HTML ä¸­çš„ <code>&lt;script&gt;</code> ä¸ <code>&lt;link&gt;</code> æ ‡ç­¾ã€‚</li>
</ul>
<p><strong>æå–èµ„æºå¹¶ç¼“å­˜</strong></p>
<ul>
<li>æå–è„šæœ¬ä¸æ ·å¼èµ„æº URLã€‚</li>
<li>é€šè¿‡è‡ªå®šä¹‰é€»è¾‘åŠ è½½ï¼ˆå¹¶ç¼“å­˜ï¼‰å¤–éƒ¨è„šæœ¬ä¸æ ·å¼å†…å®¹ã€‚</li>
<li>å°† <code>&lt;link&gt;</code> æ›¿æ¢ä¸ºå†…è” <code>&lt;style&gt;</code>ï¼Œæå‡åŠ è½½æ€§èƒ½ã€‚</li>
</ul>
<p><strong>æ‰§è¡Œè„šæœ¬</strong></p>
<ul>
<li>é€šè¿‡ <code>eval</code> åœ¨éš”ç¦»ä½œç”¨åŸŸä¸­æ‰§è¡Œ JSï¼ˆé˜²æ­¢æ±¡æŸ“ä¸»åº”ç”¨çš„ windowï¼‰ã€‚</li>
<li>æ”¯æŒ <code>proxy</code> ä»£ç†å¯¹è±¡ï¼ˆqiankun æ²™ç®±æ ¸å¿ƒï¼‰ã€‚</li>
<li>æ”¯æŒåŒæ­¥ã€å¼‚æ­¥è„šæœ¬çš„åŠ è½½ä¸æ‰§è¡Œé¡ºåºã€‚</li>
</ul>
<h2 data-id="heading-1">æ ¸å¿ƒæºç </h2>
<p>å®ƒçš„ æºç ä¸­åŒ…å«è¿™äº›å…³é”®å‡½æ•°ï¼š</p>





































<table><thead><tr><th>å‡½æ•°å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>importHTML(url, opts)</code></td><td>ä¸»å…¥å£ï¼ŒåŠ è½½è¿œç¨‹ HTML</td></tr><tr><td><code>processTpl</code></td><td>è§£æ HTML æ¨¡æ¿ï¼Œæå– script/link</td></tr><tr><td><code>_getExternalScripts</code></td><td>åŠ è½½å¹¶ç¼“å­˜ JS</td></tr><tr><td><code>_getExternalStyleSheets</code></td><td>åŠ è½½å¹¶ç¼“å­˜ CSS</td></tr><tr><td><code>_execScripts</code></td><td>æŒ‰é¡ºåºæ‰§è¡Œè„šæœ¬</td></tr><tr><td><code>getExecutableScript</code></td><td>åŒ…è£…è„šæœ¬ä¸ºæ²™ç®±å¯æ‰§è¡Œä»£ç </td></tr><tr><td><code>evalCode</code></td><td>å®é™…æ‰§è¡Œè„šæœ¬ï¼ˆå¸¦ç¼“å­˜ï¼‰</td></tr></tbody></table>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d15c7fdf3934c71b9dd3ec6df5a8d9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-z5bCP55-zT3J6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710132&amp;x-signature=zXynr25cjT9elBT4AowH2Iu2TwA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">ç¼“å­˜æœºåˆ¶</h2>
<p><code>import-html-entry</code> å†…éƒ¨ç»´æŠ¤äº†å››ä¸ªå…¨å±€ç¼“å­˜å¯¹è±¡ï¼Œ è¿™äº›ç¼“å­˜çš„ç›®çš„æ˜¯ <strong>åœ¨åŒä¸€ä¸ªæµè§ˆå™¨ä¼šè¯ä¸­</strong>ï¼Œå½“å¤šä¸ªå­åº”ç”¨æˆ–åŒä¸€ä¸ªå­åº”ç”¨å¤šæ¬¡åŠ è½½åŒä¸€ä¸ª URL æ—¶ï¼Œé¿å…é‡å¤ç½‘ç»œè¯·æ±‚ï¼Œä»è€ŒåŠ å¿«å¾®å‰ç«¯åŠ è½½é€Ÿåº¦ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> styleCache = {};    <span class="hljs-comment">// æ ·å¼å­—ç¬¦ç¼“å­˜</span>
<span class="hljs-keyword">var</span> scriptCache = {};   <span class="hljs-comment">// jså­—ç¬¦ç¼“å­˜</span>
<span class="hljs-keyword">var</span> embedHTMLCache = {};<span class="hljs-comment">// htmlå­—ç¬¦ç¼“å­˜</span>
<span class="hljs-keyword">var</span> evalCache = {};     <span class="hljs-comment">// ç¼–è¯‘åçš„è„šæœ¬ç¼“å­˜</span>
</code></pre>
<p>styleCacheå¯¹åº”æºç ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/defb9b5ef19e454bafcf764484954996~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-z5bCP55-zT3J6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710132&amp;x-signature=sxBkGYTWeMxzD1rtth6Kuodgz84%3D" alt="" loading="lazy"/></p>
<p>scriptCacheå¯¹åº”æºç ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fbad9bdf25c47fc9a6749bde4708b57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-z5bCP55-zT3J6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710132&amp;x-signature=vl9BHtCQ7sdnzsmUfhpffyGxViE%3D" alt="" loading="lazy"/></p>
<p>embedHTMLCacheå¯¹åº”æºç ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edb39ab801534a1995e5463272564844~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-z5bCP55-zT3J6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710132&amp;x-signature=gx8ne3rFE7Cgx5fDaue1zdIBieo%3D" alt="" loading="lazy"/></p>
<p>evalCacheå¯¹åº”æºç ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b4a81fc3e804d7f9381634ff94d55ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-z5bCP55-zT3J6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710132&amp;x-signature=9Dd%2BhxqLI1kxuemkaG815qsq4%2Bs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">ç¼“å­˜æœºåˆ¶åœ¨å­åº”ç”¨å¤šå¼€é¢‘ç¹é”€æ¯åˆ›å»ºåœºæ™¯ä¸­çš„å¼Šç«¯</h2>
<p>åœ¨å•å®ä¾‹çš„ <strong>qiankun æ¶æ„</strong> ä¸­ï¼Œ<code>import-html-entry</code> çš„ç¼“å­˜ä»…ä¼šå­˜åœ¨ä¸€ä»½ï¼Œå¯¹å†…å­˜çš„å ç”¨å½±å“æœ‰é™ï¼Œç¼“å­˜å¸¦æ¥çš„æ€§èƒ½æ”¶ç›Šç›¸å¯¹è¾ƒé«˜ã€‚<br/>
ä½†å¦‚æœç³»ç»Ÿå­˜åœ¨å¤§é‡qiankunåŠ è½½å­åº”ç”¨çš„åœºæ™¯ï¼Œæ¯”å¦‚è¦é¢‘ç¹æ‰“å¼€è‹¥å¹²å­åº”ç”¨ï¼ˆç±»ä¼¼äºèœå•ï¼‰ï¼Œå­åº”ç”¨éœ€è¦é¢‘ç¹æ‰“å¼€é”€æ¯ï¼ˆtabåˆ‡æ¢ç­‰ï¼‰ï¼ŒåŒæ—¶å…¶å†…éƒ¨çš„éƒ¨åˆ†åŠŸèƒ½æ¨¡å—åˆä¼šå†æ¬¡é€šè¿‡ <code>qiankun</code> åŠ¨æ€åŠ è½½å­åº”ç”¨ã€‚è¿™ç§åµŒå¥—åŠ è½½ç»“æ„ä¼šå¯¼è‡´ <code>import-html-entry</code> åœ¨å¤šä¸ªå±‚çº§é‡å¤ç¼“å­˜èµ„æºï¼Œå³ä½¿èµ„æºå†…å®¹ç›¸åŒï¼Œä¹Ÿä¼šè¢«å¤šæ¬¡å­˜å‚¨ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8dd52ac49dc84c40bc67d7d4d21ba135~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-z5bCP55-zT3J6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710132&amp;x-signature=m5wBawS8ny0QZ5wLlQseUMx%2BFwY%3D" alt="" loading="lazy"/></p>
<p>å› æ­¤ï¼Œå­åº”ç”¨çš„é¢‘ç¹æ‰“å¼€ä¸å¸è½½ï¼Œä¼šå¯¼è‡´å†…å­˜å ç”¨æŒç»­å¢é•¿ï¼Œä»è€Œå¼•å‘æ˜æ˜¾çš„æ€§èƒ½ä¸‹é™ï¼ˆå›½äº§CPUå¯èƒ½æ›´æ˜æ˜¾ï¼‰ã€‚</p>
<p>å› æ­¤ï¼Œ<strong>ç§»é™¤æˆ–ç¦ç”¨</strong> <code>import-html-entry</code> <strong>çš„ç¼“å­˜æœºåˆ¶</strong>ï¼Œèƒ½æå¤§ç¼“è§£å†…å­˜æ³„æ¼é—®é¢˜ï¼Œ<strong>æå‡ç³»ç»Ÿåœ¨å¤æ‚åœºæ™¯ä¸‹çš„è¿è¡Œæ€§èƒ½ä¸ç¨³å®šæ€§</strong>ã€‚</p>
<h2 data-id="heading-4">ä¼˜åŒ–æ–¹æ¡ˆ</h2>



































<table><thead><tr><th>ç¼“å­˜å</th><th>ç¼“å­˜å†…å®¹</th><th>ç¼“å­˜ç›®çš„</th><th>ç¦ç”¨å½±å“</th></tr></thead><tbody><tr><td><strong>styleCache</strong></td><td>æ¯ä¸ª CSS é“¾æ¥çš„å†…å®¹ï¼ˆæ–‡æœ¬ï¼‰</td><td>é¿å…é‡å¤è¯·æ±‚ç›¸åŒæ ·å¼æ–‡ä»¶</td><td>æ¯æ¬¡é‡æ–°è¯·æ±‚ CSSï¼ˆä½†æµè§ˆå™¨ä¼šå‘½ä¸­åå•†ç¼“å­˜ï¼Œå½±å“æå°ï¼‰</td></tr><tr><td><strong>scriptCache</strong></td><td>æ¯ä¸ª JS é“¾æ¥çš„å†…å®¹ï¼ˆæ–‡æœ¬ï¼‰</td><td>é¿å…é‡å¤è¯·æ±‚ç›¸åŒè„šæœ¬æ–‡ä»¶</td><td>æ¯æ¬¡é‡æ–°è¯·æ±‚ JSï¼ˆå‘½ä¸­æµè§ˆå™¨ç¼“å­˜ï¼Œå½±å“è¾ƒå°ï¼‰</td></tr><tr><td><strong>embedHTMLCache</strong></td><td>æ•´ä¸ª HTML æ¨¡æ¿å­—ç¬¦ä¸²</td><td>é¿å…é‡å¤è¯·æ±‚å…¥å£ HTML æ–‡ä»¶</td><td>æ¯æ¬¡é‡æ–°è¯·æ±‚å…¥å£æ–‡ä»¶ï¼Œæ€§èƒ½ç•¥é™</td></tr><tr><td><strong>evalCache</strong></td><td>æ¯ä¸ªè„šæœ¬çš„å·²ç¼–è¯‘å‡½æ•° <code>(function(){...})</code></td><td><strong>é¿å…å¤šæ¬¡ eval ç¼–è¯‘åŒä¸€è„šæœ¬å­—ç¬¦ä¸²</strong>ï¼Œæå‡è¿è¡Œæ€§èƒ½</td><td>æ¯æ¬¡éƒ½é‡æ–° eval è§£æ JS å­—ç¬¦ä¸²ï¼Œä¼šç•¥å¾®å½±å“æ€§èƒ½ï¼ˆCPU è´Ÿæ‹…ï¼‰</td></tr></tbody></table>
<p>æµè§ˆå™¨è‡ªå¸¦çš„åå•†ç¼“å­˜å·²èƒ½é«˜æ•ˆå¤ç”¨ HTMLã€JSã€CSS èµ„æºï¼Œå› æ­¤ç¦ç”¨ <code>import-html-entry</code> çš„ç¼“å­˜é€»è¾‘å‡ ä¹ä¸å½±å“åŠ è½½æ€§èƒ½ã€‚<br/>
<code>evalCache</code> çš„ç§»é™¤å¯èƒ½çŸ­æš‚å¢åŠ  CPU å¼€é”€é™ä½æ€§èƒ½ï¼Œä½†æ•´ä½“å½±å“å¯èƒ½è¾ƒå°ï¼Œéœ€è¦ç»¼åˆè¯„ä¼°ã€‚</p>
<p><strong>é€šè¿‡åœ¨ qiankun é›†æˆå±‚ä¸­ç§»é™¤å¤šä½™ç¼“å­˜ï¼Œå¯æœ‰æ•ˆé™ä½å†…å­˜å ç”¨ï¼Œç¼“è§£æ³„æ¼é—®é¢˜ï¼Œå¹¶æ˜¾è‘—æå‡ç³»ç»Ÿæ€§èƒ½ä¸ç¨³å®šæ€§ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è¿˜åœ¨æ­»ç£•æ¨¡æ¿è¯­æ³•ï¼ŸVueæ¸²æŸ“å‡½æ•°+JSXè®©ä½ å¼€å‘æ•ˆç‡ç¿»å€ï¼]]></title>    <link>https://juejin.cn/post/7572087162230194218</link>    <guid>https://juejin.cn/post/7572087162230194218</guid>    <pubDate>2025-11-13T23:28:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572087162230194218" data-draft-id="7572087162230177834" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è¿˜åœ¨æ­»ç£•æ¨¡æ¿è¯­æ³•ï¼ŸVueæ¸²æŸ“å‡½æ•°+JSXè®©ä½ å¼€å‘æ•ˆç‡ç¿»å€ï¼"/> <meta itemprop="keywords" content="Vue.js,JavaScript,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-13T23:28:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‰¯å±±æœ‰é£æ¥"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è¿˜åœ¨æ­»ç£•æ¨¡æ¿è¯­æ³•ï¼ŸVueæ¸²æŸ“å‡½æ•°+JSXè®©ä½ å¼€å‘æ•ˆç‡ç¿»å€ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‰¯å±±æœ‰é£æ¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-13T23:28:49.000Z" title="Thu Nov 13 2025 23:28:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    30
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼€ç¯‡ï¼šè¢«æ¨¡æ¿é™åˆ¶çš„çƒ¦æ¼æ—¶åˆ»</h2>
<p>ä½ æ˜¯ä¸æ˜¯ä¹Ÿé‡åˆ°è¿‡è¿™æ ·çš„åœºæ™¯ï¼Ÿäº§å“ç»ç†æ‹¿ç€è®¾è®¡ç¨¿è¿‡æ¥ï¼Œè¯´è¦åšä¸€ä¸ªè¶…çº§çµæ´»çš„åŠ¨æ€è¡¨å•ï¼Œæ¯ä¸ªå­—æ®µçš„ç±»å‹ã€éªŒè¯è§„åˆ™ã€å¸ƒå±€æ–¹å¼éƒ½å¯èƒ½éšæ—¶å˜åŒ–ã€‚ä½ çœ‹ç€é‚£å¤æ‚çš„æ¡ä»¶æ¸²æŸ“ï¼Œå¿ƒé‡Œé»˜é»˜è®¡ç®—ç€è¦å†™å¤šå°‘v-ifã€v-switchï¼Œè¿˜æœ‰é‚£äº›åµŒå¥—å¾ˆæ·±çš„ç»„ä»¶ç»“æ„ï¼Œå…‰æ˜¯æƒ³æƒ³å°±å¤´å¤§ã€‚</p>
<p>æˆ–è€…ï¼Œä½ éœ€è¦å°è£…ä¸€ä¸ªé«˜åº¦å¯å¤ç”¨çš„ä¸šåŠ¡ç»„ä»¶ï¼Œä½†ä½¿ç”¨æ¨¡æ¿æ—¶æ€»è§‰å¾—æœ‰äº›é€»è¾‘è¡¨è¾¾èµ·æ¥ä¸å¤Ÿç›´æ¥ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†åŠ¨æ€ç»„ä»¶ã€é€’å½’ç»„ä»¶è¿™äº›é«˜çº§ç”¨æ³•æ—¶ï¼Œæ¨¡æ¿è¯­æ³•æ˜¾å¾—æœ‰ç‚¹åŠ›ä¸ä»å¿ƒã€‚</p>
<p>åˆ«æ‹…å¿ƒï¼Œä»Šå¤©æˆ‘è¦è·Ÿä½ åˆ†äº«çš„Vueæ¸²æŸ“å‡½æ•°å’ŒJSXï¼Œå°±æ˜¯ä¸“é—¨ä¸ºè§£å†³è¿™äº›é—®é¢˜è€Œç”Ÿçš„åˆ©å™¨ã€‚å®ƒä»¬èƒ½è®©ä½ åœ¨Vueå¼€å‘ä¸­æ‹¥æœ‰æ›´å¤§çš„çµæ´»æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨é‚£äº›æ¨¡æ¿éš¾ä»¥åº”å¯¹çš„åŠ¨æ€åœºæ™¯é‡Œã€‚</p>
<p>å­¦å®Œä»Šå¤©çš„å†…å®¹ï¼Œä½ ä¼šæŒæ¡å¦‚ä½•ç”¨JSXå†™å‡ºæ›´ç®€æ´ç›´è§‚çš„ç»„ä»¶ä»£ç ï¼Œç†è§£æ¸²æŸ“å‡½æ•°çš„å·¥ä½œåŸç†ï¼Œè¿˜èƒ½åœ¨å®é™…é¡¹ç›®ä¸­çµæ´»è¿ç”¨è¿™äº›æŠ€æœ¯è§£å†³å¤æ‚é—®é¢˜ã€‚</p>
<h2 data-id="heading-1">ä¸ºä»€ä¹ˆéœ€è¦è¶…è¶Šæ¨¡æ¿ï¼Ÿ</h2>
<p>å…ˆæ¥è¯´è¯´æ¨¡æ¿çš„å±€é™æ€§ã€‚Vueçš„æ¨¡æ¿è¯­æ³•ç¡®å®å¾ˆå‹å¥½ï¼Œå£°æ˜å¼ã€æ˜“ä¸Šæ‰‹ï¼Œä½†åœ¨å¤„ç†ç‰¹åˆ«å¤æ‚çš„åŠ¨æ€é€»è¾‘æ—¶ï¼Œæ¨¡æ¿ä¼šå˜å¾—å†—é•¿ä¸”éš¾ä»¥ç»´æŠ¤ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹è¿™æ ·çš„éœ€æ±‚ï¼šæ ¹æ®åç«¯è¿”å›çš„é…ç½®å¯¹è±¡ï¼ŒåŠ¨æ€æ¸²æŸ“ä¸€ä¸ªå®Œæ•´çš„é¡µé¢ç»“æ„ã€‚é…ç½®é‡Œå¯èƒ½åŒ…å«æŒ‰é’®ã€è¾“å…¥æ¡†ã€è¡¨æ ¼ç­‰å„ç§ç»„ä»¶ï¼Œè¿˜æœ‰å®ƒä»¬ä¹‹é—´çš„åµŒå¥—å…³ç³»ã€‚ç”¨æ¨¡æ¿çš„è¯ï¼Œä½ å¯èƒ½è¦å†™ä¸€å¤§å †v-ifå’ŒåŠ¨æ€ç»„ä»¶ï¼Œä»£ç å¯è¯»æ€§ç›´çº¿ä¸‹é™ã€‚</p>
<p>è¿™æ—¶å€™æ¸²æŸ“å‡½æ•°å’ŒJSXçš„ä¼˜åŠ¿å°±ä½“ç°å‡ºæ¥äº†ã€‚å®ƒä»¬æœ¬è´¨ä¸Šéƒ½æ˜¯JavaScriptï¼Œèƒ½å¤Ÿåˆ©ç”¨JSå®Œæ•´çš„ç¼–ç¨‹èƒ½åŠ›æ¥è¡¨è¾¾ç»„ä»¶ç»“æ„ã€‚å¾ªç¯ã€æ¡ä»¶åˆ¤æ–­ã€é€’å½’ï¼Œè¿™äº›åœ¨JSé‡Œéƒ½å¾ˆè‡ªç„¶ï¼Œä½†åœ¨æ¨¡æ¿é‡Œå°±éœ€è¦å„ç§æŒ‡ä»¤é…åˆã€‚</p>
<p>ä¸è¿‡è¦è¯´æ˜çš„æ˜¯ï¼Œæˆ‘å¹¶ä¸æ˜¯è¯´æ¨¡æ¿ä¸å¥½ã€‚åœ¨å¤§å¤šæ•°å¸¸è§„åœºæ™¯ä¸‹ï¼Œæ¨¡æ¿ä¾ç„¶æ˜¯æœ€ä½³é€‰æ‹©ã€‚åªæœ‰åœ¨çœŸæ­£éœ€è¦æ›´å¤§çµæ´»æ€§çš„åŠ¨æ€åœºæ™¯ä¸­ï¼Œæ‰éœ€è¦è€ƒè™‘ä½¿ç”¨æ¸²æŸ“å‡½æ•°æˆ–JSXã€‚</p>
<h2 data-id="heading-2">åˆè¯†æ¸²æŸ“å‡½æ•°ï¼šç”¨JavaScriptæè¿°UI</h2>
<p>å…ˆæ¥çœ‹ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ã€‚å¹³æ—¶æˆ‘ä»¬ç”¨æ¨¡æ¿å†™ä¸€ä¸ªæŒ‰é’®ç»„ä»¶å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"['btn', `btn-${type}`]"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleClick"</span>&gt;</span>
    {{ text }}
  <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p>å¦‚æœç”¨æ¸²æŸ“å‡½æ•°æ¥å†™ï¼Œä¼šæ˜¯è¿™æ ·ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">props</span>: [<span class="hljs-string">'type'</span>, <span class="hljs-string">'text'</span>],
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.$emit(<span class="hljs-string">'click'</span>)
    }
  },
  <span class="hljs-title function_">render</span>(<span class="hljs-params">h</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">h</span>(
      <span class="hljs-string">'button'</span>,
      {
        <span class="hljs-attr">class</span>: [<span class="hljs-string">'btn'</span>, <span class="hljs-string">`btn-<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.type}</span>`</span>],
        <span class="hljs-attr">on</span>: {
          <span class="hljs-attr">click</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleClick</span>
        }
      },
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span>
    )
  }
}
</code></pre>
<p>è¿™é‡Œçš„<code>h</code>å‡½æ•°æ˜¯åˆ›å»ºè™šæ‹ŸDOMèŠ‚ç‚¹çš„å·¥å…·ï¼Œå®ƒæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼šæ ‡ç­¾åã€æ•°æ®å¯¹è±¡ã€å­èŠ‚ç‚¹ã€‚æ•°æ®å¯¹è±¡å¯ä»¥åŒ…å«classã€styleã€propsã€onç­‰å±æ€§ã€‚</p>
<p>å¯èƒ½ä½ ä¼šè§‰å¾—ï¼Œè¿™çœ‹èµ·æ¥æ¯”æ¨¡æ¿å¤æ‚å•Šï¼Ÿåˆ«æ€¥ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå…¥é—¨ç¤ºä¾‹ã€‚å½“é€»è¾‘å˜å¾—å¤æ‚æ—¶ï¼Œæ¸²æŸ“å‡½æ•°çš„ä¼˜åŠ¿æ‰ä¼šçœŸæ­£æ˜¾ç°ã€‚</p>
<h2 data-id="heading-3">JSXï¼šæ›´ç›´è§‚çš„å†™æ³•</h2>
<p>å¦‚æœä½ è§‰å¾—ä¸Šé¢çš„æ¸²æŸ“å‡½æ•°å†™æ³•è¿˜æ˜¯æœ‰äº›æŠ½è±¡ï¼Œé‚£ä¹ˆJSXå¯èƒ½ä¼šè®©ä½ çœ¼å‰ä¸€äº®ã€‚JSXæ˜¯ä¸€ç§JavaScriptçš„è¯­æ³•æ‰©å±•ï¼Œå®ƒè®©æˆ‘ä»¬èƒ½åœ¨JSä¸­å†™ç±»ä¼¼HTMLçš„ç»“æ„ã€‚</p>
<p>åŒæ ·çš„æŒ‰é’®ç»„ä»¶ï¼Œç”¨JSXæ¥å†™ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">props</span>: [<span class="hljs-string">'type'</span>, <span class="hljs-string">'text'</span>],
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.$emit(<span class="hljs-string">'click'</span>)
    }
  },
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
        <span class="hljs-attr">class</span>=<span class="hljs-string">{[</span>'<span class="hljs-attr">btn</span>', `<span class="hljs-attr">btn-</span>${<span class="hljs-attr">this.type</span>}`]}
        <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.handleClick}</span>
      &gt;</span>
        {this.text}
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
    )
  }
}
</code></pre>
<p>æ˜¯ä¸æ˜¯æ„Ÿè§‰äº²åˆ‡å¤šäº†ï¼ŸJSXè®©æ¸²æŸ“å‡½æ•°çš„å†™æ³•æ›´åŠ ç›´è§‚ï¼Œç‰¹åˆ«æ˜¯å¯¹äºæœ‰Reactç»éªŒçš„å¼€å‘è€…æ¥è¯´ï¼Œå‡ ä¹å¯ä»¥æ— ç¼åˆ‡æ¢ã€‚</p>
<p>è¦åœ¨Vueé¡¹ç›®ä¸­ä½¿ç”¨JSXï¼Œä½ éœ€è¦é…ç½®ç›¸åº”çš„Babelæ’ä»¶ã€‚ç°åœ¨ä¸»æµçš„Vueè„šæ‰‹æ¶å·¥å…·éƒ½æ”¯æŒè¿™ä¸ªåŠŸèƒ½ï¼Œé…ç½®èµ·æ¥ä¹Ÿå¾ˆç®€å•ã€‚</p>
<h2 data-id="heading-4">åŠ¨æ€åœºæ™¯å®æˆ˜ï¼šå¯é…ç½®è¡¨å•æ¸²æŸ“å™¨</h2>
<p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªçœŸå®çš„ä¸šåŠ¡åœºæ™¯ã€‚å‡è®¾æˆ‘ä»¬è¦åšä¸€ä¸ªåŠ¨æ€è¡¨å•æ¸²æŸ“å™¨ï¼Œæ ¹æ®JSONé…ç½®æ¥æ¸²æŸ“ä¸åŒçš„è¡¨å•å­—æ®µã€‚</p>
<p>é¦–å…ˆå®šä¹‰é…ç½®ç»“æ„ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> formConfig = [
  {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'input'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'username'</span>,
    <span class="hljs-attr">label</span>: <span class="hljs-string">'ç”¨æˆ·å'</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'è¯·è¾“å…¥ç”¨æˆ·å'</span>
  },
  {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'select'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'gender'</span>,
    <span class="hljs-attr">label</span>: <span class="hljs-string">'æ€§åˆ«'</span>,
    <span class="hljs-attr">options</span>: [
      { <span class="hljs-attr">label</span>: <span class="hljs-string">'ç”·'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'male'</span> },
      { <span class="hljs-attr">label</span>: <span class="hljs-string">'å¥³'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'female'</span> }
    ]
  },
  {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'checkbox'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'hobbies'</span>,
    <span class="hljs-attr">label</span>: <span class="hljs-string">'å…´è¶£çˆ±å¥½'</span>,
    <span class="hljs-attr">options</span>: [
      { <span class="hljs-attr">label</span>: <span class="hljs-string">'è¯»ä¹¦'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'reading'</span> },
      { <span class="hljs-attr">label</span>: <span class="hljs-string">'è¿åŠ¨'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'sports'</span> }
    ]
  }
]
</code></pre>
<p>å¦‚æœç”¨æ¨¡æ¿æ¥å®ç°ï¼Œå¯èƒ½ä¼šæ˜¯è¿™æ ·ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-renderer"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"field in config"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"field.name"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>{{ field.label }}<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
        <span class="hljs-attr">v-if</span>=<span class="hljs-string">"field.type === 'input'"</span>
        <span class="hljs-attr">:type</span>=<span class="hljs-string">"field.type"</span>
        <span class="hljs-attr">:name</span>=<span class="hljs-string">"field.name"</span>
        <span class="hljs-attr">:required</span>=<span class="hljs-string">"field.required"</span>
        <span class="hljs-attr">:placeholder</span>=<span class="hljs-string">"field.placeholder"</span>
        <span class="hljs-attr">v-model</span>=<span class="hljs-string">"formData[field.name]"</span>
      &gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">select</span>
        <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"field.type === 'select'"</span>
        <span class="hljs-attr">:name</span>=<span class="hljs-string">"field.name"</span>
        <span class="hljs-attr">v-model</span>=<span class="hljs-string">"formData[field.name]"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">option</span>
          <span class="hljs-attr">v-for</span>=<span class="hljs-string">"option in field.options"</span>
          <span class="hljs-attr">:key</span>=<span class="hljs-string">"option.value"</span>
          <span class="hljs-attr">:value</span>=<span class="hljs-string">"option.value"</span>
        &gt;</span>
          {{ option.label }}
        <span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"field.type === 'checkbox'"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">label</span>
          <span class="hljs-attr">v-for</span>=<span class="hljs-string">"option in field.options"</span>
          <span class="hljs-attr">:key</span>=<span class="hljs-string">"option.value"</span>
        &gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
            <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span>
            <span class="hljs-attr">:value</span>=<span class="hljs-string">"option.value"</span>
            <span class="hljs-attr">v-model</span>=<span class="hljs-string">"formData[field.name]"</span>
          &gt;</span>
          {{ option.label }}
        <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ¨¡æ¿é‡Œæœ‰å¾ˆå¤šæ¡ä»¶åˆ¤æ–­ï¼Œä»£ç ç»“æ„æ¯”è¾ƒå¤æ‚ã€‚ç°åœ¨æ¥çœ‹çœ‹ç”¨JSXå¦‚ä½•å®ç°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">props</span>: [<span class="hljs-string">'config'</span>],
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">formData</span>: {}
    }
  },
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">renderField</span> = (<span class="hljs-params">field</span>) =&gt; {
      <span class="hljs-keyword">const</span> commonProps = {
        <span class="hljs-attr">name</span>: field.<span class="hljs-property">name</span>,
        <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">formData</span>[field.<span class="hljs-property">name</span>],
        <span class="hljs-attr">onInput</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">formData</span>[field.<span class="hljs-property">name</span>] = value
        }
      }

      <span class="hljs-keyword">switch</span> (field.<span class="hljs-property">type</span>) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'input'</span>:
          <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span>
              {<span class="hljs-attr">...commonProps</span>}
              <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>
              <span class="hljs-attr">required</span>=<span class="hljs-string">{field.required}</span>
              <span class="hljs-attr">placeholder</span>=<span class="hljs-string">{field.placeholder}</span>
            /&gt;</span></span>
          )
        
        <span class="hljs-keyword">case</span> <span class="hljs-string">'select'</span>:
          <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> {<span class="hljs-attr">...commonProps</span>}&gt;</span>
              {field.options.map(option =&gt; (
                <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{option.value}</span>&gt;</span>
                  {option.label}
                <span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
              ))}
            <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span>
          )
        
        <span class="hljs-keyword">case</span> <span class="hljs-string">'checkbox'</span>:
          <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
              {field.options.map(option =&gt; (
                <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
                    <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span>
                    <span class="hljs-attr">value</span>=<span class="hljs-string">{option.value}</span>
                    <span class="hljs-attr">checked</span>=<span class="hljs-string">{this.formData[field.name]?.includes(option.value)}</span>
                    <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> {
                      const values = this.formData[field.name] || []
                      if (e.target.checked) {
                        this.formData[field.name] = [...values, option.value]
                      } else {
                        this.formData[field.name] = values.filter(v =&gt; v !== option.value)
                      }
                    }}
                  /&gt;
                  {option.label}
                <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
              ))}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
          )
        
        <span class="hljs-attr">default</span>:
          <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
      }
    }

    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-renderer"</span>&gt;</span>
        {this.config.map(field =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{field.name}</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>{field.label}<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
            {renderField(field)}
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
  }
}
</code></pre>
<p>ç”¨JSXå®ç°çš„ä»£ç ç»“æ„æ›´æ¸…æ™°ï¼Œé€»è¾‘æ›´é›†ä¸­ã€‚ç‰¹åˆ«æ˜¯å½“è¡¨å•å­—æ®µç±»å‹å¢å¤šæ—¶ï¼Œåªéœ€è¦åœ¨switchè¯­å¥ä¸­æ·»åŠ æ–°çš„caseå³å¯ï¼Œæ‰©å±•æ€§æ›´å¥½ã€‚</p>
<h2 data-id="heading-5">é«˜çº§æŠ€å·§ï¼šé€’å½’ç»„ä»¶ä¸åŠ¨æ€ç»„ä»¶</h2>
<p>æ¸²æŸ“å‡½æ•°å’ŒJSXåœ¨å¤„ç†é€’å½’ç»„ä»¶å’ŒåŠ¨æ€ç»„ä»¶æ—¶å°¤å…¶å¼ºå¤§ã€‚æ¯”å¦‚æˆ‘ä»¬è¦å®ç°ä¸€ä¸ªæ— é™çº§åµŒå¥—çš„æ ‘å½¢ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'TreeNode'</span>,
  <span class="hljs-attr">props</span>: {
    <span class="hljs-attr">node</span>: <span class="hljs-title class_">Object</span>
  },
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">renderNode</span> = (<span class="hljs-params">node</span>) =&gt; {
      <span class="hljs-comment">// å¦‚æœæœ‰å­èŠ‚ç‚¹ï¼Œé€’å½’æ¸²æŸ“</span>
      <span class="hljs-keyword">if</span> (node.<span class="hljs-property">children</span> &amp;&amp; node.<span class="hljs-property">children</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> (
          <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tree-node"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"node-content"</span>&gt;</span>{node.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"children"</span>&gt;</span>
              {node.children.map(child =&gt; (
                <span class="hljs-tag">&lt;<span class="hljs-name">TreeNode</span> <span class="hljs-attr">node</span>=<span class="hljs-string">{child}</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{child.id}</span> /&gt;</span>
              ))}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        )
      }
      
      <span class="hljs-comment">// å¶å­èŠ‚ç‚¹</span>
      <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tree-node leaf"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"node-content"</span>&gt;</span>{node.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
      )
    }

    <span class="hljs-keyword">return</span> <span class="hljs-title function_">renderNode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>)
  }
}
</code></pre>
<p>åœ¨JSXä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ç»„ä»¶åæ¥å¼•ç”¨å½“å‰ç»„ä»¶ï¼Œå®ç°é€’å½’æ¸²æŸ“ã€‚è¿™åœ¨æ¨¡æ¿ä¸­è™½ç„¶ä¹Ÿèƒ½å®ç°ï¼Œä½†å†™èµ·æ¥ä¼šæ¯”è¾ƒåˆ«æ‰­ã€‚</p>
<p>å†çœ‹åŠ¨æ€ç»„ä»¶çš„ä¾‹å­ã€‚å‡è®¾æˆ‘ä»¬éœ€è¦æ ¹æ®æ•°æ®ç±»å‹åŠ¨æ€é€‰æ‹©ä¸åŒçš„å±•ç¤ºç»„ä»¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> componentMap = {
  <span class="hljs-attr">text</span>: <span class="hljs-title class_">TextDisplay</span>,
  <span class="hljs-attr">image</span>: <span class="hljs-title class_">ImageDisplay</span>,
  <span class="hljs-attr">video</span>: <span class="hljs-title class_">VideoDisplay</span>,
  <span class="hljs-attr">chart</span>: <span class="hljs-title class_">ChartDisplay</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">props</span>: [<span class="hljs-string">'data'</span>],
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> <span class="hljs-title class_">DynamicComponent</span> = componentMap[<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">type</span>]
    
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">DynamicComponent</span>) {
      <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>æœªçŸ¥æ•°æ®ç±»å‹<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    }

    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">DynamicComponent</span> 
        <span class="hljs-attr">data</span>=<span class="hljs-string">{this.data}</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"data-display"</span>
      /&gt;</span></span>
    )
  }
}
</code></pre>
<p>è¿™ç§åŠ¨æ€ç»„ä»¶çš„é€‰æ‹©é€»è¾‘åœ¨JSXä¸­è¡¨è¾¾å¾—éå¸¸è‡ªç„¶ï¼Œå¦‚æœè¦ç”¨æ¨¡æ¿çš„è¯ï¼Œéœ€è¦é…åˆ<code>&lt;component :is="componentType"&gt;</code>è¯­æ³•ï¼Œä½†åœ¨å¤æ‚é€»è¾‘ä¸‹ä¸å¦‚JSXç›´è§‚ã€‚</p>
<h2 data-id="heading-6">æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ</h2>
<p>ä½¿ç”¨æ¸²æŸ“å‡½æ•°å’ŒJSXæ—¶ï¼Œæœ‰å‡ ä¸ªæ€§èƒ½ä¼˜åŒ–çš„è¦ç‚¹éœ€è¦æ³¨æ„ã€‚</p>
<p>é¦–å…ˆæ˜¯æ­£ç¡®çš„ä½¿ç”¨keyã€‚åœ¨å¾ªç¯æ¸²æŸ“å…ƒç´ æ—¶ï¼Œä¸€å®šè¦æä¾›ç¨³å®šä¸”å”¯ä¸€çš„keyï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {this.items.map(item =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span>&gt;</span>{item.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p>å…¶æ¬¡æ˜¯é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ã€‚åœ¨å¤æ‚çš„æ¸²æŸ“å‡½æ•°ä¸­ï¼Œå¯ä»¥åˆç†ä½¿ç”¨è®¡ç®—å±æ€§å’Œæ–¹æ³•æ¥ç¼“å­˜ä¸€äº›ä¸­é—´ç»“æœï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">props</span>: [<span class="hljs-string">'items'</span>],
  <span class="hljs-attr">computed</span>: {
    <span class="hljs-title function_">processedItems</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// å¤æ‚çš„å¤„ç†é€»è¾‘æ”¾åœ¨è®¡ç®—å±æ€§ä¸­</span>
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({
        ...item,
        <span class="hljs-attr">processed</span>: <span class="hljs-literal">true</span>
      }))
    }
  },
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        {this.processedItems.map(item =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span>&gt;</span>{item.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
  }
}
</code></pre>
<p>å¦å¤–ï¼Œåœ¨JSXä¸­æ­£ç¡®ä½¿ç”¨æ’æ§½ã€‚Vueçš„æ’æ§½åœ¨JSXä¸­æœ‰å¯¹åº”çš„å†™æ³•ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å®šä¹‰å¸¦æ’æ§½çš„ç»„ä»¶</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-header"</span>&gt;</span>
          {this.$slots.header}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-body"</span>&gt;</span>
          {this.$slots.default}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-footer"</span>&gt;</span>
          {this.$slots.footer}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
  }
}

<span class="hljs-comment">// ä½¿ç”¨å¸¦æ’æ§½çš„ç»„ä»¶</span>
<span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Card</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"header"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>è¿™é‡Œæ˜¯ä¸»è¦å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"footer"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>ç¡®å®š<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span></span>
  )
}
</code></pre>
<h2 data-id="heading-7">ä¸Composition APIçš„å®Œç¾ç»“åˆ</h2>
<p>åœ¨Vue 3çš„Composition APIä¸­ï¼Œæ¸²æŸ“å‡½æ•°å’ŒJSXçš„é…åˆæ›´åŠ é»˜å¥‘ã€‚æˆ‘ä»¬å¯ä»¥åœ¨setupå‡½æ•°ä¸­ç›´æ¥è¿”å›æ¸²æŸ“å‡½æ•°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { ref, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">props</span>: [<span class="hljs-string">'items'</span>],
  <span class="hljs-title function_">setup</span>(<span class="hljs-params">props</span>) {
    <span class="hljs-keyword">const</span> searchQuery = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)
    
    <span class="hljs-keyword">const</span> filteredItems = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">return</span> props.<span class="hljs-property">items</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span>
        item.<span class="hljs-property">name</span>.<span class="hljs-title function_">includes</span>(searchQuery.<span class="hljs-property">value</span>)
      )
    })
    
    <span class="hljs-comment">// ç›´æ¥è¿”å›æ¸²æŸ“å‡½æ•°</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> 
          <span class="hljs-attr">vModel</span>=<span class="hljs-string">{searchQuery.value}</span>
          <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"æœç´¢..."</span>
        /&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
          {filteredItems.value.map(item =&gt; (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span>&gt;</span>{item.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          ))}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
  }
}
</code></pre>
<p>è¿™ç§å†™æ³•è®©é€»è¾‘å’ŒUIæ›´åŠ ç´§å¯†åœ°ç»“åˆåœ¨ä¸€èµ·ï¼Œä»£ç çš„ç»„ç»‡æ–¹å¼æ›´åŠ çµæ´»ã€‚</p>
<h2 data-id="heading-8">å®æˆ˜ï¼šå°è£…ä¸€ä¸ªé«˜çº§è¡¨æ ¼ç»„ä»¶</h2>
<p>è®©æˆ‘ä»¬ç”¨JSXå°è£…ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„é«˜çº§è¡¨æ ¼ç»„ä»¶ï¼Œæ”¯æŒåŠ¨æ€åˆ—ã€æ’åºã€ç­›é€‰ç­‰åŠŸèƒ½ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">props</span>: {
    <span class="hljs-attr">data</span>: <span class="hljs-title class_">Array</span>,
    <span class="hljs-attr">columns</span>: <span class="hljs-title class_">Array</span>,
    <span class="hljs-attr">sortable</span>: <span class="hljs-title class_">Boolean</span>
  },
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">sortKey</span>: <span class="hljs-string">''</span>,
      <span class="hljs-attr">sortOrder</span>: <span class="hljs-string">'asc'</span>,
      <span class="hljs-attr">filters</span>: {}
    }
  },
  <span class="hljs-attr">computed</span>: {
    <span class="hljs-title function_">processedData</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">let</span> result = [...<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>]
      
      <span class="hljs-comment">// åº”ç”¨ç­›é€‰</span>
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">filters</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (value) {
          result = result.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> 
            <span class="hljs-title class_">String</span>(item[key]).<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">includes</span>(value.<span class="hljs-title function_">toLowerCase</span>())
          )
        }
      })
      
      <span class="hljs-comment">// åº”ç”¨æ’åº</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">sortKey</span>) {
        result.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> {
          <span class="hljs-keyword">const</span> aVal = a[<span class="hljs-variable language_">this</span>.<span class="hljs-property">sortKey</span>]
          <span class="hljs-keyword">const</span> bVal = b[<span class="hljs-variable language_">this</span>.<span class="hljs-property">sortKey</span>]
          <span class="hljs-keyword">const</span> modifier = <span class="hljs-variable language_">this</span>.<span class="hljs-property">sortOrder</span> === <span class="hljs-string">'asc'</span> ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>
          
          <span class="hljs-keyword">if</span> (aVal &lt; bVal) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span> * modifier
          <span class="hljs-keyword">if</span> (aVal &gt; bVal) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> * modifier
          <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
        })
      }
      
      <span class="hljs-keyword">return</span> result
    }
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">handleSort</span>(<span class="hljs-params">key</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">sortKey</span> === key) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sortOrder</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">sortOrder</span> === <span class="hljs-string">'asc'</span> ? <span class="hljs-string">'desc'</span> : <span class="hljs-string">'asc'</span>
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sortKey</span> = key
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sortOrder</span> = <span class="hljs-string">'asc'</span>
      }
    },
    
    <span class="hljs-title function_">handleFilter</span>(<span class="hljs-params">key, value</span>) {
      <span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">filters</span>, key, value)
    }
  },
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"advanced-table"</span>&gt;</span>
        {/* è¡¨å¤´ */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"table-header"</span>&gt;</span>
          {this.columns.map(column =&gt; (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header-cell"</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{column.key}</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{column.title}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
              
              {/* æ’åºæŒ‰é’® */}
              {this.sortable &amp;&amp; (
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
                  <span class="hljs-attr">class</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">sort-btn</span> ${<span class="hljs-attr">this.sortKey</span> === <span class="hljs-string">column.key</span> ? '<span class="hljs-attr">active</span>' <span class="hljs-attr">:</span> ''}`}
                  <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> this.handleSort(column.key)}
                &gt;
                  {this.sortKey === column.key &amp;&amp; this.sortOrder === 'asc' ? 'â†‘' : 'â†“'}
                <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
              )}
              
              {/* ç­›é€‰è¾“å…¥æ¡† */}
              <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
                <span class="hljs-attr">class</span>=<span class="hljs-string">"filter-input"</span>
                <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"ç­›é€‰..."</span>
                <span class="hljs-attr">value</span>=<span class="hljs-string">{this.filters[column.key]</span> || ''}
                <span class="hljs-attr">onInput</span>=<span class="hljs-string">{(e)</span> =&gt;</span> this.handleFilter(column.key, e.target.value)}
              /&gt;
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          ))}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        {/* è¡¨æ ¼å†…å®¹ */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"table-body"</span>&gt;</span>
          {this.processedData.map((row, index) =&gt; (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"table-row"</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{index}</span>&gt;</span>
              {this.columns.map(column =&gt; (
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"table-cell"</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{column.key}</span>&gt;</span>
                  {column.render ? column.render(row) : row[column.key]}
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
              ))}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          ))}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
  }
}
</code></pre>
<p>è¿™ä¸ªè¡¨æ ¼ç»„ä»¶å±•ç¤ºäº†JSXåœ¨å¤æ‚ç»„ä»¶å°è£…ä¸­çš„å¼ºå¤§èƒ½åŠ›ã€‚æˆ‘ä»¬å¯ä»¥å¾ˆçµæ´»åœ°æ§åˆ¶æ¸²æŸ“é€»è¾‘ï¼Œå®ç°å„ç§åŠ¨æ€åŠŸèƒ½ã€‚</p>
<h2 data-id="heading-9">ä»€ä¹ˆæ—¶å€™è¯¥ç”¨ï¼Œä»€ä¹ˆæ—¶å€™ä¸è¯¥ç”¨</h2>
<p>è™½ç„¶æ¸²æŸ“å‡½æ•°å’ŒJSXå¾ˆå¼ºå¤§ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰åœºæ™¯éƒ½é€‚åˆä½¿ç”¨ã€‚è¿™é‡Œç»™ä½ ä¸€äº›å®ç”¨çš„å»ºè®®ï¼š</p>
<p><strong>æ¨èä½¿ç”¨æ¸²æŸ“å‡½æ•°/JSXçš„åœºæ™¯ï¼š</strong></p>
<ul>
<li>éœ€è¦é«˜åº¦åŠ¨æ€çš„ç»„ä»¶ç»“æ„</li>
<li>å¤æ‚çš„æ¡ä»¶æ¸²æŸ“é€»è¾‘</li>
<li>é€’å½’ç»„ä»¶</li>
<li>åŸºäºè¿è¡Œæ—¶æ¡ä»¶åŠ¨æ€é€‰æ‹©ç»„ä»¶</li>
<li>éœ€è¦æ›´å¤§ç¼–ç¨‹çµæ´»æ€§çš„é«˜çº§ç»„ä»¶åº“</li>
</ul>
<p><strong>ä¸æ¨èä½¿ç”¨çš„åœºæ™¯ï¼š</strong></p>
<ul>
<li>ç®€å•çš„é™æ€å¸ƒå±€</li>
<li>å›¢é˜Ÿå¯¹JSXä¸ç†Ÿæ‚‰</li>
<li>éœ€è¦è®¾è®¡å¸ˆæˆ–éæŠ€æœ¯äººå‘˜å‚ä¸æ¨¡æ¿ä¿®æ”¹</li>
<li>å·²ç»ç”¨æ¨¡æ¿å†™å¾—å¾ˆå¥½çš„å¸¸è§„ä¸šåŠ¡ç»„ä»¶</li>
</ul>
<p>è®°ä½ï¼ŒæŠ€æœ¯é€‰å‹çš„æ ¸å¿ƒæ˜¯é€‰æ‹©åˆé€‚çš„å·¥å…·è§£å†³é—®é¢˜ï¼Œè€Œä¸æ˜¯è¿½æ±‚æœ€æ–°æœ€æ½®çš„æŠ€æœ¯ã€‚</p>
<h2 data-id="heading-10">ä»æ¨¡æ¿å¹³æ»‘è¿ç§»åˆ°JSX</h2>
<p>å¦‚æœä½ å†³å®šåœ¨é¡¹ç›®ä¸­å°è¯•JSXï¼Œè¿™é‡Œæœ‰ä¸€äº›å¹³æ»‘è¿ç§»çš„å»ºè®®ï¼š</p>
<p>é¦–å…ˆï¼Œå¯ä»¥ä»ä¸€äº›ç®€å•çš„ç»„ä»¶å¼€å§‹å°è¯•ã€‚æ¯”å¦‚å…ˆæ‰¾ä¸€ä¸ªé€»è¾‘æ¯”è¾ƒå¤æ‚çš„ç»„ä»¶ï¼Œç”¨JSXé‡å†™ï¼Œæ„Ÿå—ä¸€ä¸‹å·®å¼‚ã€‚</p>
<p>å…¶æ¬¡ï¼Œå……åˆ†åˆ©ç”¨Vue Devtoolsã€‚JSXç»„ä»¶åœ¨Devtoolsä¸­çš„è°ƒè¯•ä½“éªŒå’Œæ¨¡æ¿ç»„ä»¶åŸºæœ¬ä¸€è‡´ï¼Œä½ å¯ä»¥æ­£å¸¸æŸ¥çœ‹ç»„ä»¶å±‚æ¬¡ã€propsã€çŠ¶æ€ç­‰ä¿¡æ¯ã€‚</p>
<p>å¦å¤–ï¼Œå»ºç«‹å›¢é˜Ÿçš„ä»£ç è§„èŒƒã€‚JSXç»™äº†æˆ‘ä»¬æ›´å¤§çš„çµæ´»æ€§ï¼Œä½†ä¹Ÿéœ€è¦ç›¸åº”çš„è§„èŒƒæ¥ä¿è¯ä»£ç è´¨é‡ã€‚æ¯”å¦‚è§„å®šä½•æ—¶ä½¿ç”¨JSXã€ä»£ç ç»„ç»‡æ–¹å¼ç­‰ã€‚</p>
<p>æœ€åï¼Œè®°ä½æ¨¡æ¿å’ŒJSXå¯ä»¥å…±å­˜ã€‚ä½ ä¸éœ€è¦ä¸€æ¬¡æ€§é‡å†™æ‰€æœ‰ç»„ä»¶ï¼Œå¯ä»¥åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­æ··åˆä½¿ç”¨ï¼Œæ ¹æ®æ¯ä¸ªç»„ä»¶çš„ç‰¹æ€§é€‰æ‹©åˆé€‚çš„æŠ€æœ¯ã€‚</p>
<h2 data-id="heading-11">ç»“å°¾ï¼šæ‹¥æŠ±æ›´çµæ´»çš„Vueå¼€å‘æ–¹å¼</h2>
<p>ä»Šå¤©æˆ‘ä»¬æ·±å…¥æ¢è®¨äº†Vueæ¸²æŸ“å‡½æ•°å’ŒJSXåœ¨åŠ¨æ€åœºæ™¯ä¸­çš„åº”ç”¨ã€‚ä»åŸºç¡€çš„è¯­æ³•åˆ°é«˜çº§çš„å®æˆ˜æŠ€å·§ï¼Œç›¸ä¿¡ä½ å·²ç»æ„Ÿå—åˆ°äº†è¿™ç§å¼€å‘æ–¹å¼çš„é­…åŠ›ã€‚</p>
<p>è®°ä½ï¼Œæ¨¡æ¿ã€æ¸²æŸ“å‡½æ•°ã€JSXéƒ½æ˜¯Vueç”Ÿæ€ä¸­çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒä»¬å„æœ‰é€‚ç”¨çš„åœºæ™¯ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯æŒæ¡å„ç§å·¥å…·ï¼Œç„¶ååœ¨åˆé€‚çš„åœºæ™¯é€‰æ‹©åˆé€‚çš„æŠ€æœ¯ã€‚</p>
<p>JSXå’Œæ¸²æŸ“å‡½æ•°ä¸æ˜¯è¦å–ä»£æ¨¡æ¿ï¼Œè€Œæ˜¯ä¸ºæˆ‘ä»¬æä¾›äº†å¦ä¸€ç§è§£å†³é—®é¢˜çš„æ€è·¯ã€‚å½“æ¨¡æ¿é‡åˆ°ç“¶é¢ˆæ—¶ï¼ŒçŸ¥é“è¿˜æœ‰è¿™æ ·ä¸€æ¡è·¯å¯ä»¥èµ°ï¼Œè¿™æ‰æ˜¯æœ€é‡è¦çš„ã€‚</p>
<p>ç°åœ¨ï¼Œä½ æ˜¯å¦å·²ç»åœ¨æƒ³è‡ªå·±çš„å“ªä¸ªé¡¹ç›®å¯ä»¥ç”¨ä¸Šè¿™äº›æŠ€æœ¯äº†ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„æƒ³æ³•å’Œé—®é¢˜ï¼Œæˆ‘ä»¬ä¸€èµ·æ¢è®¨Vueå¼€å‘çš„æ›´å¤šå¯èƒ½æ€§ï¼</p>
<p>ä¸‹æ¬¡å†è§ï¼Œå¸Œæœ›ä½ å·²ç»å‡†å¤‡å¥½ç”¨æ›´çµæ´»çš„æ–¹å¼ç¼–å†™Vueç»„ä»¶äº†ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HTML&CSS&JSï¼šèµ›åšæœ¨é±¼]]></title>    <link>https://juejin.cn/post/7572087162230751274</link>    <guid>https://juejin.cn/post/7572087162230751274</guid>    <pubDate>2025-11-14T01:55:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572087162230751274" data-draft-id="7572039006530158628" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HTML&amp;CSS&amp;JSï¼šèµ›åšæœ¨é±¼"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,CSS"/> <meta itemprop="datePublished" content="2025-11-14T01:55:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯Hardy"/> <meta itemprop="url" content="https://juejin.cn/user/4222572710333816"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HTML&amp;CSS&amp;JSï¼šèµ›åšæœ¨é±¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4222572710333816/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯Hardy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T01:55:56.000Z" title="Fri Nov 14 2025 01:55:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ç”¨ HTML + CSS + JS æ‰“é€ ä¸€ä¸ªç¦…æ„åè¶³çš„äº’åŠ¨å°åº”ç”¨â€”â€”èµ›åšæœ¨é±¼ï¼Œ æœ¬æ–‡å°†æ‹†è§£å…¶æ ¸å¿ƒå®ç°é€»è¾‘ï¼Œå¸¦ä½ ä» 0 åˆ° 1 ç†è§£ â€œæ•²æœ¨é±¼â€ èƒŒåçš„æŠ€æœ¯ç»†èŠ‚ã€‚</p>
<hr/>
<p><em>å¤§å®¶å¤åˆ¶ä»£ç æ—¶ï¼Œå¯èƒ½ä¼šå› æ ¼å¼è½¬æ¢å‡ºç°é”™ä¹±ï¼Œå¯¼è‡´æ ·å¼å¤±æ•ˆã€‚å»ºè®®å…ˆå°‘é‡å¤åˆ¶ä»£ç è¿›è¡Œæµ‹è¯•ï¼Œè‹¥æœªèƒ½è§£å†³é—®é¢˜ï¼Œç§ä¿¡å›å¤æºç ä¸¤å­—ï¼Œæˆ‘ä¼šå‘é€å®Œæ•´çš„å‹ç¼©åŒ…ç»™ä½ ã€‚</em></p>
<h2 data-id="heading-0">æ¼”ç¤ºæ•ˆæœ</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/703f4fd06e564ce6b23921cd28061eff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uvSGFyZHk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763690156&amp;x-signature=0%2F%2FXjvad3gBM0YDFnAwIWDaLgtg%3D" alt="æ¼”ç¤ºæ•ˆæœ" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/517eb4d61f4a4044a48d85980ddb1764~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uvSGFyZHk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763690156&amp;x-signature=HZAGS0yG4w1CEpn6VGhbhbDlElg%3D" alt="æ¼”ç¤ºæ•ˆæœ" loading="lazy"/></p>
<h2 data-id="heading-1">HTML&amp;CSS</h2>
<pre><code class="hljs language-html" lang="html">
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>èµ›åšæœ¨é±¼<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">body</span> {
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#121212</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#FFFFFF</span>;
            <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Kaiti SC'</span>, <span class="hljs-string">'PingFang SC'</span>, sans-serif;
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">flex-direction</span>: column;
            <span class="hljs-attribute">align-items</span>: center;
            <span class="hljs-attribute">justify-content</span>: center;
            <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100vh</span>;
            <span class="hljs-attribute">overflow</span>: hidden;
        }

        <span class="hljs-selector-class">.title-container</span> {
            <span class="hljs-attribute">text-align</span>: center;
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
        }

        <span class="hljs-selector-class">.main-title</span> {
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#FFFFFF</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">6vw</span>;
            <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Kaiti SC'</span>, sans-serif;
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">180deg</span>,
                <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">176</span>, <span class="hljs-number">103</span>, <span class="hljs-number">0.05</span>) <span class="hljs-number">0%</span>,
                <span class="hljs-built_in">rgba</span>(<span class="hljs-number">115</span>, <span class="hljs-number">55</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.02</span>) <span class="hljs-number">100%</span>);
            <span class="hljs-attribute">background-clip</span>: text;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1</span>;
        }

        <span class="hljs-selector-class">.score-container</span> {
            <span class="hljs-attribute">text-align</span>: center;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">20px</span> <span class="hljs-number">0</span>;
        }

        <span class="hljs-selector-class">.score</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">10vh</span>;
            <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'PingFang SC'</span>, sans-serif;
            <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">900</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
        }

        <span class="hljs-selector-class">.description</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">5vh</span>;
            <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'PingFang SC'</span>, sans-serif;
            <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">10px</span>;
        }

        <span class="hljs-selector-class">.wooden-fish-container</span> {
            <span class="hljs-attribute">position</span>: relative;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">250px</span>;
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">justify-content</span>: center;
            <span class="hljs-attribute">align-items</span>: center;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">30px</span> <span class="hljs-number">0</span>;
        }

        <span class="hljs-selector-class">.wooden-fish</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">284px</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">236px</span>;
            <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.1s</span> ease;
        }

        <span class="hljs-selector-class">.mallet</span> {
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">top</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">right</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">119px</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">69px</span>;
            <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.1s</span> ease;
            <span class="hljs-attribute">z-index</span>: <span class="hljs-number">10</span>;
        }

        <span class="hljs-selector-class">.floating-text</span> {
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">top</span>: -<span class="hljs-number">50px</span>;
            <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;
            <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(-<span class="hljs-number">50%</span>);
            <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'PingFang SC'</span>, sans-serif;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5em</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#FFFFFF</span>;
            <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">pointer-events</span>: none;
            <span class="hljs-attribute">animation</span>: floatUp <span class="hljs-number">0.4s</span> ease-out forwards;
        }

        <span class="hljs-keyword">@keyframes</span> floatUp {
            <span class="hljs-number">0%</span> {
                <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
                <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(-<span class="hljs-number">50%</span>) <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>);
            }
            <span class="hljs-number">100%</span> {
                <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
                <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(-<span class="hljs-number">50%</span>) <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">60px</span>);
            }
        }

        <span class="hljs-selector-class">.bottom-text</span> {
            <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Kaiti SC'</span>, sans-serif;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.2em</span>;
            <span class="hljs-attribute">text-align</span>: center;
            <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">30px</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"main-title"</span>&gt;</span>èµ›åšæœ¨é±¼<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"score-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"score"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"score"</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"description"</span>&gt;</span>åŠŸå¾·<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"wooden-fish-container"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"fishContainer"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://img.alicdn.com/imgextra/i3/O1CN012CO0YU1VSfNs506ZS_!!6000000002652-2-tps-284-236.png"</span>
             <span class="hljs-attr">alt</span>=<span class="hljs-string">"æœ¨é±¼"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"wooden-fish"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"woodenFish"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://img.alicdn.com/imgextra/i1/O1CN01tKb5Et1aSjWRjCHK3_!!6000000003329-2-tps-119-69.png"</span>
             <span class="hljs-attr">alt</span>=<span class="hljs-string">"é”¤å­"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mallet"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"mallet"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bottom-text"</span>&gt;</span>è½»æ•²æœ¨é±¼ï¼Œç»†æ‚Ÿèµ›åšçœŸç»ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">audio</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"clickSound"</span> <span class="hljs-attr">preload</span>=<span class="hljs-string">"auto"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://qianwen.alicdn.com/resource/qiaomuyu.mp3"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"audio/mpeg"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">audio</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">let</span> score = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">const</span> scoreElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'score'</span>);
        <span class="hljs-keyword">const</span> woodenFish = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'woodenFish'</span>);
        <span class="hljs-keyword">const</span> mallet = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'mallet'</span>);
        <span class="hljs-keyword">const</span> fishContainer = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'fishContainer'</span>);
        <span class="hljs-keyword">const</span> clickSound = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'clickSound'</span>);

        fishContainer.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
            <span class="hljs-comment">// æ’­æ”¾éŸ³æ•ˆ</span>
            clickSound.<span class="hljs-property">currentTime</span> = <span class="hljs-number">0</span>;
            clickSound.<span class="hljs-title function_">play</span>();

            <span class="hljs-comment">// é”¤å­æ—‹è½¬åŠ¨ç”»</span>
            mallet.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">'rotate(-25deg)'</span>;
            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                mallet.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">'rotate(0deg)'</span>;
            }, <span class="hljs-number">100</span>);

            <span class="hljs-comment">// æœ¨é±¼æ”¾å¤§åŠ¨ç”»</span>
            woodenFish.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">'scale(1.1)'</span>;
            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                woodenFish.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">'scale(1)'</span>;
            }, <span class="hljs-number">100</span>);

            <span class="hljs-comment">// å¢åŠ åˆ†æ•°</span>
            score++;
            scoreElement.<span class="hljs-property">textContent</span> = score;

            <span class="hljs-comment">// åˆ›å»ºæ¼‚æµ®æ–‡å­—</span>
            <span class="hljs-keyword">const</span> floatingText = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
            floatingText.<span class="hljs-property">className</span> = <span class="hljs-string">'floating-text'</span>;
            floatingText.<span class="hljs-property">textContent</span> = <span class="hljs-string">'åŠŸå¾·+1'</span>;
            fishContainer.<span class="hljs-title function_">appendChild</span>(floatingText);

            <span class="hljs-comment">// ç§»é™¤æ¼‚æµ®æ–‡å­—</span>
            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                floatingText.<span class="hljs-title function_">remove</span>();
            }, <span class="hljs-number">400</span>);
        });
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>




</code></pre>
<h2 data-id="heading-2">HTML</h2>
<ul>
<li>title-containerï¼šæ ‡é¢˜å®¹å™¨ï¼šæ‰¿è½½ â€œèµ›åšæœ¨é±¼â€ ä¸»æ ‡é¢˜ï¼Œé€šè¿‡å±…ä¸­å¸ƒå±€çªå‡ºè§†è§‰æ ¸å¿ƒ</li>
<li>score-containerï¼šåˆ†æ•°å±•ç¤ºåŒºï¼šåŒ…å« â€œåŠŸå¾·æ•°â€ å’Œ â€œåŠŸå¾·â€ æè¿°ï¼Œæ˜¯ç”¨æˆ·äº¤äº’çš„æ ¸å¿ƒåé¦ˆè½½ä½“</li>
<li>wooden-fish-containerï¼šäº¤äº’æ ¸å¿ƒå®¹å™¨</li>
<li>wooden-fishï¼šæœ¨é±¼å›¾ç‰‡ï¼šé€šè¿‡ CDN å¼•å…¥èµ„æºï¼Œæ— éœ€æœ¬åœ°å­˜å‚¨ï¼Œæ˜¯ç‚¹å‡»äº¤äº’çš„è§†è§‰æ ¸å¿ƒ</li>
<li>malletï¼šé”¤å­å›¾ç‰‡ï¼šç»å¯¹å®šä½åœ¨æœ¨é±¼å³ä¸Šæ–¹ï¼Œç‚¹å‡»æ—¶é€šè¿‡æ—‹è½¬åŠ¨ç”»æ¨¡æ‹Ÿ â€œæ•²å‡»â€ åŠ¨ä½œ</li>
<li>clickSoundï¼šéŸ³æ•ˆè½½ä½“ï¼šé¢„åŠ è½½æœ¨é±¼æ•²å‡»éŸ³æ•ˆï¼ˆpreload="auto"ï¼‰ï¼Œç‚¹å‡»æ—¶è§¦å‘æ’­æ”¾ï¼Œå¢å¼ºæ²‰æµ¸æ„Ÿ</li>
<li>floating-textï¼šåŠ¨æ€ç”Ÿæˆå…ƒç´ ï¼šç‚¹å‡»æ—¶åˆ›å»º â€œåŠŸå¾· + 1â€ æ¼‚æµ®æ–‡å­—ï¼Œå®Œæˆäº¤äº’åé¦ˆé—­ç¯</li>
</ul>
<h2 data-id="heading-3">CSS</h2>
<ul>
<li>.malletï¼šç‚¹å‡»æ—¶é”¤å­ç»•å³ä¸Šè§’æ—‹è½¬ 25 åº¦ï¼Œæ¨¡æ‹Ÿ â€œæ•²ä¸‹å»â€ çš„åŠ¨ä½œï¼Œ100 æ¯«ç§’å¿«é€Ÿå›å¼¹</li>
<li>.wooden-fishï¼šç‚¹å‡»æ—¶æœ¨é±¼è½»å¾®æ”¾å¤§ 1.1 å€ï¼Œæ¨¡æ‹Ÿ â€œè¢«æ•²å‡»åçš„éœ‡åŠ¨â€ï¼Œä¸é”¤å­åŠ¨ä½œåŒæ­¥ï¼š</li>
<li>.floating-textï¼šè‡ªåŠ¨å‘ä¸Šæ·¡å‡ºï¼Œè¥é€ â€œåŠŸå¾·å‡å¤©â€çš„è§†è§‰æ•ˆæœã€‚</li>
</ul>
<h2 data-id="heading-4">JavaScript</h2>
<ol>
<li>åˆå§‹åŒ–å˜é‡ï¼šè·å– DOM å…ƒç´ ä¸çŠ¶æ€</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> score = <span class="hljs-number">0</span>; <span class="hljs-comment">// åŠŸå¾·æ•°åˆå§‹å€¼</span>
<span class="hljs-keyword">const</span> scoreElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'score'</span>); <span class="hljs-comment">// åˆ†æ•°æ˜¾ç¤ºå…ƒç´ </span>
<span class="hljs-keyword">const</span> woodenFish = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'woodenFish'</span>); <span class="hljs-comment">// æœ¨é±¼å…ƒç´ </span>
<span class="hljs-keyword">const</span> mallet = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'mallet'</span>); <span class="hljs-comment">// é”¤å­å…ƒç´ </span>
<span class="hljs-keyword">const</span> fishContainer = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'fishContainer'</span>); <span class="hljs-comment">// äº¤äº’å®¹å™¨</span>
<span class="hljs-keyword">const</span> clickSound = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'clickSound'</span>); <span class="hljs-comment">// éŸ³æ•ˆå…ƒç´ </span>
</code></pre>
<p>é€šè¿‡ getElementById è·å–æ ¸å¿ƒäº¤äº’å…ƒç´ ï¼Œæå‰å®šä¹‰åŠŸå¾·æ•°çŠ¶æ€ã€‚</p>
<ol start="2">
<li>æ ¸å¿ƒäº¤äº’ï¼šç‚¹å‡»äº‹ä»¶å¤„ç†</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript">fishContainer.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
    <span class="hljs-comment">// 1. æ’­æ”¾æ•²å‡»éŸ³æ•ˆï¼ˆæ¯æ¬¡ç‚¹å‡»ä»å¤´æ’­æ”¾ï¼Œæ”¯æŒè¿ç»­æ•²å‡»ï¼‰</span>
    clickSound.<span class="hljs-property">currentTime</span> = <span class="hljs-number">0</span>;
    clickSound.<span class="hljs-title function_">play</span>();

    <span class="hljs-comment">// 2. é”¤å­æ—‹è½¬åŠ¨ç”»ï¼šæ•²ä¸‹â†’å›å¼¹</span>
    mallet.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">'rotate(-25deg)'</span>;
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        mallet.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">'rotate(0deg)'</span>;
    }, <span class="hljs-number">100</span>);

    <span class="hljs-comment">// 3. æœ¨é±¼ç¼©æ”¾åŠ¨ç”»ï¼šæ”¾å¤§â†’è¿˜åŸ</span>
    woodenFish.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">'scale(1.1)'</span>;
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        woodenFish.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">'scale(1)'</span>;
    }, <span class="hljs-number">100</span>);

    <span class="hljs-comment">// 4. åŠŸå¾·æ•°ç´¯åŠ ä¸æ›´æ–°</span>
    score++;
    scoreElement.<span class="hljs-property">textContent</span> = score;

    <span class="hljs-comment">// 5. ç”Ÿæˆâ€œåŠŸå¾·+1â€æ¼‚æµ®æ–‡å­—</span>
    <span class="hljs-keyword">const</span> floatingText = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
    floatingText.<span class="hljs-property">className</span> = <span class="hljs-string">'floating-text'</span>;
    floatingText.<span class="hljs-property">textContent</span> = <span class="hljs-string">'åŠŸå¾·+1'</span>;
    fishContainer.<span class="hljs-title function_">appendChild</span>(floatingText);

    <span class="hljs-comment">// 6. åŠ¨ç”»ç»“æŸåç§»é™¤æ–‡å­—ï¼ˆé¿å…DOMå †ç§¯ï¼‰</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        floatingText.<span class="hljs-title function_">remove</span>();
    }, <span class="hljs-number">400</span>);
});
</code></pre>
<ol start="3">
<li>å…³é”®æŠ€æœ¯ç‚¹æ‹†è§£</li>
</ol>
<p><strong>éŸ³æ•ˆé‡ç½®</strong>ï¼šclickSound.currentTime = 0 ç¡®ä¿è¿ç»­ç‚¹å‡»æ—¶éŸ³æ•ˆä¸å åŠ ï¼Œæ¯æ¬¡éƒ½æ˜¯å®Œæ•´çš„ â€œæ•²å‡»å£°â€ï¼›</p>
<p><strong>åŠ¨ç”»åŒæ­¥</strong>ï¼šé”¤å­æ—‹è½¬å’Œæœ¨é±¼ç¼©æ”¾çš„è¿‡æ¸¡æ—¶é•¿ï¼ˆ0.1sï¼‰ä¸å®šæ—¶å™¨å»¶è¿Ÿï¼ˆ100msï¼‰ä¸€è‡´ï¼ŒåŠ¨ä½œåè°ƒï¼›</p>
<p><strong>DOM ä¼˜åŒ–</strong>ï¼šæ¼‚æµ®æ–‡å­—åŠ¨ç”»ç»“æŸåé€šè¿‡ remove()ç§»é™¤ï¼Œé¿å…é¡µé¢ DOM å…ƒç´ è¿‡å¤šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼›</p>
<p><strong>æ— ä¾èµ–è®¾è®¡</strong>ï¼šä¸ä½¿ç”¨ä»»ä½•æ¡†æ¶ï¼Œä»…åŸç”Ÿ APIï¼Œå…¼å®¹æ€§è¦†ç›–æ‰€æœ‰ç°ä»£æµè§ˆå™¨ã€‚</p>
<hr/>
<p><em>å„ä½äº’è”ç½‘æ­å­ï¼Œè¦æ˜¯è¿™ç¯‡æ–‡ç« æˆåŠŸå¼•èµ·äº†ä½ çš„æ³¨æ„ï¼Œåˆ«çŠ¹è±«ï¼Œ<strong>å…³æ³¨ã€ç‚¹èµã€è¯„è®ºã€åˆ†äº«èµ°ä¸€æ³¢</strong>ï¼Œè®©æˆ‘ä»¬æŠŠè¿™ä»½é»˜å¥‘å»¶ç»­ä¸‹å»ï¼Œä¸€èµ·åœ¨çŸ¥è¯†çš„æµ·æ´‹é‡Œä¹˜é£ç ´æµªï¼</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é«˜å¹¶å‘è®¢å•å»é‡ï¼šå¸ƒéš†è¿‡æ»¤å™¨è¿‡æ»¤å·²å­˜åœ¨è®¢å•å·çš„å®æˆ˜æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7572048000301252649</link>    <guid>https://juejin.cn/post/7572048000301252649</guid>    <pubDate>2025-11-14T02:35:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572048000301252649" data-draft-id="7572052559822372870" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é«˜å¹¶å‘è®¢å•å»é‡ï¼šå¸ƒéš†è¿‡æ»¤å™¨è¿‡æ»¤å·²å­˜åœ¨è®¢å•å·çš„å®æˆ˜æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="åç«¯,åˆ†å¸ƒå¼"/> <meta itemprop="datePublished" content="2025-11-14T02:35:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å›å®¶è·¯ä¸Šç»•äº†å¼¯"/> <meta itemprop="url" content="https://juejin.cn/user/536217404587134"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é«˜å¹¶å‘è®¢å•å»é‡ï¼šå¸ƒéš†è¿‡æ»¤å™¨è¿‡æ»¤å·²å­˜åœ¨è®¢å•å·çš„å®æˆ˜æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/536217404587134/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å›å®¶è·¯ä¸Šç»•äº†å¼¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T02:35:03.000Z" title="Fri Nov 14 2025 02:35:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»14åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">é«˜å¹¶å‘è®¢å•å»é‡ï¼šå¸ƒéš†è¿‡æ»¤å™¨è¿‡æ»¤å·²å­˜åœ¨è®¢å•å·çš„å®æˆ˜æ–¹æ¡ˆ</h2>
<p>åœ¨ç”µå•†ç§’æ€ã€æ”¯ä»˜äº¤æ˜“ã€ç‰©æµä¸‹å•ç­‰åœºæ™¯ä¸­ï¼Œâ€œåˆ¤æ–­è®¢å•å·æ˜¯å¦å·²å­˜åœ¨â€ æ˜¯é«˜é¢‘æ“ä½œ â€”â€” æ¯”å¦‚é˜²æ­¢ç”¨æˆ·é‡å¤æäº¤è®¢å•ã€é¿å…åˆ†å¸ƒå¼ç³»ç»Ÿç”Ÿæˆé‡å¤è®¢å• IDã€æ‹¦æˆªç¼“å­˜ç©¿é€æŸ¥è¯¢ã€‚ä½†å½“è®¢å•é‡çªç ´äº¿çº§æ—¶ï¼Œä¼ ç»Ÿæ–¹æ¡ˆï¼ˆæŸ¥æ•°æ®åº“ã€æŸ¥ Redis Setï¼‰ä¼šå›  â€œå†…å­˜å ç”¨å¤§â€â€œæŸ¥è¯¢æ…¢â€ å¤±æ•ˆï¼Œè€Œå¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰å‡­å€Ÿ â€œä½å†…å­˜ã€é«˜ååã€O (1) æŸ¥è¯¢â€ çš„ç‰¹æ€§ï¼Œæˆä¸ºè¿™ç±»åœºæ™¯çš„æœ€ä¼˜è§£ã€‚</p>
<p>æœ¬æ–‡å°†ä» â€œåŸç†â†’é€‚é…â†’å®ç°â†’è½åœ°â€ å››å±‚ï¼Œå®Œæ•´è®²è§£å¦‚ä½•ç”¨å¸ƒéš†è¿‡æ»¤å™¨è§£å†³è®¢å•å·å»é‡é—®é¢˜ï¼Œå°¤å…¶èšç„¦è®¢å•åœºæ™¯çš„ç‰¹æ®Šéœ€æ±‚ä¸é¿å‘ç‚¹ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€å…ˆææ‡‚ï¼šä¸ºä»€ä¹ˆè®¢å•åœºæ™¯éœ€è¦å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿ</h3>
<p>åœ¨è®²å®ç°å‰ï¼Œå…ˆæ˜ç¡®ä¼ ç»Ÿæ–¹æ¡ˆçš„ç—›ç‚¹ä¸å¸ƒéš†è¿‡æ»¤å™¨çš„ä¼˜åŠ¿ï¼Œé¿å… â€œä¸ºäº†ç”¨æŠ€æœ¯è€Œç”¨æŠ€æœ¯â€ã€‚</p>
<h4 data-id="heading-2">1. ä¼ ç»Ÿè®¢å•å·åˆ¤é‡æ–¹æ¡ˆçš„ç“¶é¢ˆ</h4>

























<table><thead><tr><th>æ–¹æ¡ˆ</th><th>å®ç°é€»è¾‘</th><th>äº¿çº§è®¢å•åœºæ™¯çš„ç—›ç‚¹</th></tr></thead><tbody><tr><td>æ•°æ®åº“å”¯ä¸€ç´¢å¼•</td><td>è®¢å•è¡¨åŠ order_idå”¯ä¸€ç´¢å¼•ï¼Œæ’å…¥æ—¶åˆ¤æ–­æ˜¯å¦å†²çª</td><td>å†™å…¥æ—¶éœ€ç£ç›˜ IOï¼Œé«˜å¹¶å‘ä¸‹é”ç­‰å¾…ä¸¥é‡ï¼Œæ’å…¥å»¶è¿Ÿè¶… 100ms</td></tr><tr><td>Redis Set</td><td>å°†å·²å­˜åœ¨è®¢å•å·å­˜å…¥ Redis Setï¼Œåˆ¤æ–­ç”¨SISMEMBER</td><td>äº¿çº§è®¢å•å·éœ€å ç”¨çº¦ 1GB å†…å­˜ï¼ˆæ¯ä¸ª String è®¢å•å·æŒ‰ 16 å­—èŠ‚ç®—ï¼‰ï¼Œæˆæœ¬é«˜</td></tr><tr><td>æœ¬åœ° HashMap</td><td>å•æœºå†…å­˜å­˜å‚¨è®¢å•å·ï¼Œåˆ¤æ–­containsKey</td><td>åˆ†å¸ƒå¼åœºæ™¯ä¸‹æ— æ³•å…±äº«æ•°æ®ï¼ŒèŠ‚ç‚¹é—´æ•°æ®ä¸ä¸€è‡´</td></tr></tbody></table>
<h4 data-id="heading-3">2. å¸ƒéš†è¿‡æ»¤å™¨çš„æ ¸å¿ƒä¼˜åŠ¿ï¼ˆé€‚é…è®¢å•åœºæ™¯ï¼‰</h4>
<p>å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§ â€œç©ºé—´é«˜æ•ˆçš„æ¦‚ç‡å‹æ•°æ®ç»“æ„â€ï¼Œæ ¸å¿ƒä¼˜åŠ¿æ°å¥½åŒ¹é…è®¢å•å·åˆ¤é‡éœ€æ±‚ï¼š</p>
<ul>
<li><strong>è¶…ä½æˆæœ¬å†…å­˜</strong>ï¼šå­˜å‚¨äº¿çº§è®¢å•å·ä»…éœ€çº¦ 100MB å†…å­˜ï¼ˆä¼ ç»Ÿ Redis Set éœ€ 1GB+ï¼‰ï¼Œé™ä½ 90% å†…å­˜å ç”¨ï¼›</li>
</ul>

<ul>
<li><strong>æè‡´æŸ¥è¯¢æ€§èƒ½</strong>ï¼šåˆ¤æ–­è®¢å•å·æ˜¯å¦å­˜åœ¨ä»…éœ€ 3-5 æ¬¡å“ˆå¸Œè®¡ç®—ï¼Œè€—æ—¶ &lt; 1msï¼Œæ”¯æ’‘ç™¾ä¸‡ QPSï¼›</li>
</ul>

<ul>
<li><strong>æ”¯æŒæµ·é‡æ•°æ®</strong>ï¼šç†è®ºä¸Šå¯å­˜å‚¨æ— é™é‡æ•°æ®ï¼ˆä»…å—ä½æ•°ç»„å¤§å°é™åˆ¶ï¼‰ï¼Œæ— éœ€åˆ†åº“åˆ†è¡¨ï¼›</li>
</ul>

<ul>
<li><strong>å¤©ç„¶é˜²ç¼“å­˜ç©¿é€</strong>ï¼šå¯¹ â€œä¸å­˜åœ¨çš„è®¢å•å·â€ ç›´æ¥åœ¨è¿‡æ»¤å™¨å±‚æ‹¦æˆªï¼Œé¿å…ç©¿é€åˆ°æ•°æ®åº“ã€‚</li>
</ul>
<p><strong>æ³¨æ„</strong>ï¼šå¸ƒéš†è¿‡æ»¤å™¨æœ‰ â€œè¯¯åˆ¤ç‡â€ï¼ˆåˆ¤æ–­ä¸ºå­˜åœ¨çš„è®¢å•å·ï¼Œå®é™…å¯èƒ½ä¸å­˜åœ¨ï¼‰ï¼Œä½†æ—  â€œæ¼åˆ¤ç‡â€ï¼ˆåˆ¤æ–­ä¸ºä¸å­˜åœ¨çš„è®¢å•å·ï¼Œå®é™…ä¸€å®šä¸å­˜åœ¨ï¼‰â€”â€” è¿™å¯¹è®¢å•åœºæ™¯å®Œå…¨å¯æ§ï¼ˆè¯¯åˆ¤å¯é€šè¿‡æ•°æ®åº“äºŒæ¬¡æ ¡éªŒè§£å†³ï¼‰ã€‚</p>
<h3 data-id="heading-4">äºŒã€å¸ƒéš†è¿‡æ»¤å™¨åŸç†ï¼š3 åˆ†é’Ÿçœ‹æ‡‚æ ¸å¿ƒé€»è¾‘</h3>
<p>å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†å¾ˆç®€å•ï¼Œæ ¸å¿ƒæ˜¯ â€œ<strong>å¤šå“ˆå¸Œå‡½æ•° + ä½æ•°ç»„</strong>â€ï¼Œç”¨ â€œæ¦‚ç‡æ¢ç©ºé—´â€ï¼š</p>
<h4 data-id="heading-5">1. æ ¸å¿ƒç»“æ„</h4>
<ul>
<li><strong>ä½æ•°ç»„ï¼ˆBit Arrayï¼‰</strong> ï¼šåˆå§‹æ—¶æ‰€æœ‰ä½éƒ½æ˜¯ 0ï¼ˆæ¯”å¦‚é•¿åº¦ä¸º 10 çš„ä½æ•°ç»„ï¼š[0,0,0,0,0,0,0,0,0,0]ï¼‰ï¼›</li>
</ul>

<ul>
<li><strong>å¤šä¸ªå“ˆå¸Œå‡½æ•°ï¼ˆHash Functionï¼‰</strong> ï¼šæ¯”å¦‚ 3 ä¸ªç‹¬ç«‹çš„å“ˆå¸Œå‡½æ•°ï¼ˆh1, h2, h3ï¼‰ï¼Œæ¯ä¸ªå‡½æ•°èƒ½å°†è®¢å•å·æ˜ å°„ä¸ºä½æ•°ç»„çš„ä¸€ä¸ªç´¢å¼•ã€‚</li>
</ul>
<h4 data-id="heading-6">2. ä¸¤ä¸ªæ ¸å¿ƒæ“ä½œ</h4>
<h5 data-id="heading-7">ï¼ˆ1ï¼‰æ·»åŠ è®¢å•å·ï¼ˆAddï¼‰</h5>
<p>ä»¥è®¢å•å·ORDER123ä¸ºä¾‹ï¼š</p>
<ol>
<li>ç”¨ 3 ä¸ªå“ˆå¸Œå‡½æ•°åˆ†åˆ«è®¡ç®—ORDER123çš„å“ˆå¸Œå€¼ï¼Œæ˜ å°„ä¸ºä½æ•°ç»„çš„ 3 ä¸ªç´¢å¼•ï¼ˆå¦‚ h1=2, h2=5, h3=7ï¼‰ï¼›</li>
</ol>

<ol start="2">
<li>å°†ä½æ•°ç»„ä¸­è¿™ 3 ä¸ªç´¢å¼•çš„ä½ä» 0 è®¾ä¸º 1ï¼ˆæ­¤æ—¶æ•°ç»„å˜ä¸ºï¼š[0,0,1,0,0,1,0,1,0,0]ï¼‰ã€‚</li>
</ol>
<h5 data-id="heading-8">ï¼ˆ2ï¼‰åˆ¤æ–­è®¢å•å·æ˜¯å¦å­˜åœ¨ï¼ˆContainsï¼‰</h5>
<p>åŒæ ·ä»¥ORDER123ä¸ºä¾‹ï¼š</p>
<ol>
<li>ç”¨ç›¸åŒçš„ 3 ä¸ªå“ˆå¸Œå‡½æ•°è®¡ç®—ç´¢å¼•ï¼ˆh1=2, h2=5, h3=7ï¼‰ï¼›</li>
</ol>

<ol start="2">
<li>æ£€æŸ¥ä½æ•°ç»„ä¸­è¿™ 3 ä¸ªç´¢å¼•çš„ä½æ˜¯å¦<strong>å…¨éƒ¨ä¸º 1</strong>ï¼š</li>
</ol>
<ul>
<li>
<ul>
<li>å…¨éƒ¨ä¸º 1ï¼šåˆ¤æ–­ â€œå¯èƒ½å­˜åœ¨â€ï¼ˆæœ‰ä¸€å®šè¯¯åˆ¤ç‡ï¼‰ï¼›</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>è‡³å°‘ä¸€ä¸ªä¸º 0ï¼šåˆ¤æ–­ â€œä¸€å®šä¸å­˜åœ¨â€ï¼ˆæ— æ¼åˆ¤ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-9">3. è®¢å•åœºæ™¯å…³é”®ç‰¹æ€§è§£è¯»</h4>
<ul>
<li><strong>è¯¯åˆ¤ç‡</strong>ï¼šå› ä¸åŒè®¢å•å·å¯èƒ½æ˜ å°„åˆ°ç›¸åŒçš„ç´¢å¼•ä½ï¼ˆå“ˆå¸Œç¢°æ’ï¼‰ï¼Œå¯¼è‡´ â€œä¸å­˜åœ¨çš„è®¢å•å·è¢«åˆ¤æ–­ä¸ºå­˜åœ¨â€ã€‚è¯¯åˆ¤ç‡å¯é€šè¿‡ â€œå¢å¤§ä½æ•°ç»„é•¿åº¦â€â€œå¢åŠ å“ˆå¸Œå‡½æ•°æ•°é‡â€ é™ä½ï¼ˆå¦‚äº¿çº§è®¢å•å·ï¼Œè¯¯åˆ¤ç‡å¯æ§åˆ¶åœ¨ 0.1% ä»¥ä¸‹ï¼‰ï¼›</li>
</ul>

<ul>
<li><strong>ä¸æ”¯æŒåˆ é™¤</strong>ï¼šä½æ•°ç»„çš„ä½æ˜¯ â€œ0â†’1â€ çš„å•å‘æ“ä½œï¼Œæ— æ³•åˆ é™¤ï¼ˆåˆ é™¤ä¼šå½±å“å…¶ä»–è®¢å•å·çš„åˆ¤æ–­ï¼‰â€”â€” è¿™å¯¹è®¢å•åœºæ™¯å½±å“ä¸å¤§ï¼ˆè®¢å•å·ä¸€æ—¦ç”Ÿæˆï¼Œå¾ˆå°‘éœ€è¦ â€œä»åˆ¤é‡æ± ä¸­åˆ é™¤â€ï¼‰ï¼›</li>
</ul>

<ul>
<li><strong>æ— æ¼åˆ¤ç‡</strong>ï¼šåªè¦è®¢å•å·æœªæ·»åŠ è¿‡ï¼Œå…¶æ˜ å°„çš„ç´¢å¼•ä½å¿…æœ‰è‡³å°‘ä¸€ä¸ªä¸º 0ï¼Œç¡®ä¿ â€œä¸å­˜åœ¨çš„è®¢å•å·ä¸€å®šè¢«æ‹¦æˆªâ€ã€‚</li>
</ul>
<h3 data-id="heading-10">ä¸‰ã€è®¢å•å·åœºæ™¯å¸ƒéš†è¿‡æ»¤å™¨è®¾è®¡ï¼šå‚æ•°ä¸é€‚é…</h3>
<p>å¸ƒéš†è¿‡æ»¤å™¨çš„æ€§èƒ½ä¸è¯¯åˆ¤ç‡å®Œå…¨ä¾èµ–å‚æ•°è®¾è®¡ï¼Œéœ€ç»“åˆè®¢å•å·çš„ä¸šåŠ¡ç‰¹æ€§ï¼ˆå¦‚è®¢å•å·æ ¼å¼ã€é¢„è®¡æ•°é‡ã€è¯¯åˆ¤å®¹å¿åº¦ï¼‰å®šåˆ¶ã€‚</p>
<h4 data-id="heading-11">1. è®¢å•å·ç‰¹æ€§åˆ†æ</h4>
<ul>
<li><strong>å”¯ä¸€æ€§</strong>ï¼šè®¢å•å·å…¨å±€å”¯ä¸€ï¼ˆå¦‚20251115123456789ï¼Œ18 ä½æ•°å­— + æ—¶é—´æˆ³ï¼‰ï¼›</li>
</ul>

<ul>
<li><strong>æ•°é‡è§„æ¨¡</strong>ï¼šé¢„è®¡ 1 å¹´å†…ç”Ÿæˆ 1 äº¿ä¸ªè®¢å•ï¼ˆéœ€æŒ‰ 2 äº¿é¢„ç•™ï¼Œé¿å…ä½æ•°ç»„è¿‡æ—©æ»¡ï¼‰ï¼›</li>
</ul>

<ul>
<li><strong>è¯¯åˆ¤å®¹å¿åº¦</strong>ï¼šè¯¯åˆ¤ç‡â‰¤0.1%ï¼ˆè¯¯åˆ¤ä¼šå¯¼è‡´ â€œä¸å­˜åœ¨çš„è®¢å•å·è¢«æ‹¦æˆªâ€ï¼Œå½±å“ç”¨æˆ·ä½“éªŒï¼Œéœ€ä¸¥æ ¼æ§åˆ¶ï¼‰ï¼›</li>
</ul>

<ul>
<li><strong>æŸ¥è¯¢é¢‘ç‡</strong>ï¼šæ¯ç§’æŸ¥è¯¢ 10 ä¸‡æ¬¡ï¼ˆç§’æ€åœºæ™¯å¯èƒ½è¾¾ç™¾ä¸‡ QPSï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-12">2. æ ¸å¿ƒå‚æ•°è®¡ç®—ï¼ˆå…³é”®ï¼ï¼‰</h4>
<p>å¸ƒéš†è¿‡æ»¤å™¨çš„æ ¸å¿ƒå‚æ•°æœ‰ 3 ä¸ªï¼š<strong>ä½æ•°ç»„é•¿åº¦ï¼ˆmï¼‰</strong> ã€<strong>å“ˆå¸Œå‡½æ•°æ•°é‡ï¼ˆkï¼‰</strong> ã€<strong>é¢„è®¡å…ƒç´ æ•°é‡ï¼ˆnï¼‰</strong> ã€<strong>è¯¯åˆ¤ç‡ï¼ˆpï¼‰</strong> ã€‚å››è€…æ»¡è¶³ä»¥ä¸‹å…¬å¼ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">m</span> = - (n * ln p) / (ln <span class="hljs-number">2</span>)^<span class="hljs-number">2</span>  ï¼ˆä½æ•°ç»„é•¿åº¦ï¼‰
<span class="hljs-attr">k</span> = (m / n) * ln <span class="hljs-number">2</span>            ï¼ˆå“ˆå¸Œå‡½æ•°æ•°é‡ï¼‰
</code></pre>
<h5 data-id="heading-13">è®¢å•åœºæ™¯å‚æ•°è®¡ç®—ç¤ºä¾‹ï¼ˆn=2 äº¿ï¼Œp=0.1%ï¼‰ï¼š</h5>
<ul>
<li>ä»£å…¥å…¬å¼è®¡ç®—ï¼š</li>
</ul>

<ul>
<li>
<ul>
<li>m â‰ˆ - (2e8 * ln 0.001) / (ln 2)^2 â‰ˆ 2.88e9 ä½ â†’ çº¦ 360MBï¼ˆ1GB=8e9 ä½ï¼‰ï¼›</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>k â‰ˆ (2.88e9 / 2e8) * 0.693 â‰ˆ 10 ä¸ªå“ˆå¸Œå‡½æ•°ã€‚</li>
</ul>
</li>
</ul>
<h5 data-id="heading-14">ç»“è®ºï¼š</h5>
<p>ç”¨ â€œ360MB ä½æ•°ç»„ + 10 ä¸ªå“ˆå¸Œå‡½æ•°â€ï¼Œå¯å­˜å‚¨ 2 äº¿ä¸ªè®¢å•å·ï¼Œè¯¯åˆ¤ç‡æ§åˆ¶åœ¨ 0.1% ä»¥ä¸‹ â€”â€” å®Œå…¨æ»¡è¶³è®¢å•åœºæ™¯éœ€æ±‚ï¼Œä¸”å†…å­˜æˆæœ¬æä½ã€‚</p>
<h4 data-id="heading-15">3. è®¢å•å·é€‚é…ï¼šå“ˆå¸Œå‡½æ•°é€‰æ‹©</h4>
<p>è®¢å•å·é€šå¸¸æ˜¯å­—ç¬¦ä¸²æˆ–é•¿æ•´æ•°ï¼Œéœ€é€‰æ‹© â€œåˆ†å¸ƒå‡åŒ€ã€ç¢°æ’ç‡ä½â€ çš„å“ˆå¸Œå‡½æ•°ï¼Œé¿å…å› å“ˆå¸Œå‡½æ•°ä¸ä½³å¯¼è‡´è¯¯åˆ¤ç‡å‡é«˜ã€‚æ¨èé€‰æ‹©ï¼š</p>
<ul>
<li><strong>MurmurHash3</strong>ï¼šé€Ÿåº¦å¿«ã€åˆ†å¸ƒå‡åŒ€ï¼Œæ”¯æŒ 32 ä½ / 64 ä½å“ˆå¸Œå€¼ï¼ˆé€‚åˆå­—ç¬¦ä¸²å‹è®¢å•å·ï¼‰ï¼›</li>
</ul>

<ul>
<li><strong>CRC32</strong>ï¼šè®¡ç®—å¿«ï¼Œé€‚åˆçŸ­è®¢å•å·ï¼ˆå¦‚ 16 ä½ä»¥å†…ï¼‰ï¼›</li>
</ul>

<ul>
<li><strong>ç»„åˆå“ˆå¸Œ</strong>ï¼šç”¨å¤šä¸ªä¸åŒç±»å‹çš„å“ˆå¸Œå‡½æ•°ï¼ˆå¦‚ MurmurHash3+CRC32ï¼‰ï¼Œè¿›ä¸€æ­¥é™ä½ç¢°æ’ç‡ã€‚</li>
</ul>
<p><strong>æ³¨æ„</strong>ï¼šæ·»åŠ ä¸æŸ¥è¯¢å¿…é¡»ä½¿ç”¨<strong>å®Œå…¨ç›¸åŒçš„å“ˆå¸Œå‡½æ•°</strong>ï¼Œå¦åˆ™ä¼šå¯¼è‡´åˆ¤æ–­ç»“æœé”™è¯¯ã€‚</p>
<h3 data-id="heading-16">å››ã€å®ç°æ–¹æ¡ˆï¼šå•æœºä¸åˆ†å¸ƒå¼ï¼ˆé™„ä»£ç ï¼‰</h3>
<p>è®¢å•ç³»ç»Ÿåˆ†ä¸º â€œå•æœºâ€ å’Œ â€œåˆ†å¸ƒå¼â€ åœºæ™¯ï¼Œå¸ƒéš†è¿‡æ»¤å™¨çš„å®ç°æ–¹æ¡ˆä¸åŒï¼Œéœ€åˆ†åˆ«é€‚é…ã€‚</p>
<h4 data-id="heading-17">1. å•æœºåœºæ™¯ï¼šGuava BloomFilterï¼ˆå¿«é€Ÿè½åœ°ï¼‰</h4>
<p>é€‚åˆ â€œå•æœåŠ¡ã€è®¢å•é‡â‰¤1 äº¿â€ çš„åœºæ™¯ï¼ˆå¦‚å°å‹ç”µå•†ã€å†…éƒ¨è®¢å•ç³»ç»Ÿï¼‰ï¼Œç›´æ¥ç”¨ Google Guava çš„ BloomFilter å®ç°ï¼Œæ— éœ€é¢å¤–éƒ¨ç½²ç»„ä»¶ã€‚</p>
<h5 data-id="heading-18">ï¼ˆ1ï¼‰ä¾èµ–å¼•å…¥ï¼ˆMavenï¼‰</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.guava<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>guava<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>32.1.3-jre<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <span class="hljs-comment">&lt;!-- é€‰æ‹©æœ€æ–°ç¨³å®šç‰ˆ --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h5 data-id="heading-19">ï¼ˆ2ï¼‰æ ¸å¿ƒä»£ç å®ç°ï¼ˆè®¢å•å·åˆ¤é‡ï¼‰</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> com.google.common.base.Charsets;
<span class="hljs-keyword">import</span> com.google.common.hash.BloomFilter;
<span class="hljs-keyword">import</span> com.google.common.hash.Funnel;
<span class="hljs-keyword">import</span> com.google.common.hash.HashFunction;
<span class="hljs-keyword">import</span> com.google.common.hash.Hashing;
<span class="hljs-keyword">import</span> java.util.concurrent.ConcurrentHashMap;
<span class="hljs-comment">/**
 * å•æœºç‰ˆè®¢å•å·å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆGuavaå®ç°ï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderBloomFilter</span> {
    <span class="hljs-comment">// å¸ƒéš†è¿‡æ»¤å™¨å®ä¾‹ï¼ˆå•ä¾‹ï¼Œé¿å…é‡å¤åˆ›å»ºï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> BloomFilter&lt;<span class="hljs-type">String</span>&gt; ORDER_BLOOM_FILTER;
    
    <span class="hljs-comment">// è®¢å•å·æ¼æ–—ï¼ˆå®šä¹‰å¦‚ä½•å°†è®¢å•å·è½¬æ¢ä¸ºå“ˆå¸Œè¾“å…¥ï¼Œéœ€ä¸å“ˆå¸Œå‡½æ•°åŒ¹é…ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> Funnel&lt;<span class="hljs-type">String</span>&gt; ORDER_FUNNEL = (orderId, into) -&gt; into.<span class="hljs-built_in">putString</span>(orderId, Charsets.UTF_8);
    
    <span class="hljs-comment">// é™æ€åˆå§‹åŒ–ï¼šæŒ‰å‚æ•°åˆ›å»ºå¸ƒéš†è¿‡æ»¤å™¨</span>
    <span class="hljs-type">static</span> {
        <span class="hljs-type">long</span> expectedInsertions = <span class="hljs-number">200</span>_000_000; <span class="hljs-comment">// é¢„è®¡æ’å…¥2äº¿ä¸ªè®¢å•å·</span>
        <span class="hljs-type">double</span> fpp = <span class="hljs-number">0.001</span>; <span class="hljs-comment">// è¯¯åˆ¤ç‡0.1%</span>
        <span class="hljs-comment">// åˆ›å»ºå¸ƒéš†è¿‡æ»¤å™¨ï¼ˆä½¿ç”¨MurmurHash3å“ˆå¸Œå‡½æ•°ï¼‰</span>
        ORDER_BLOOM_FILTER = BloomFilter.<span class="hljs-built_in">create</span>(ORDER_FUNNEL, expectedInsertions, fpp);
    }
    
    <span class="hljs-comment">// ç¦æ­¢å¤–éƒ¨å®ä¾‹åŒ–</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">OrderBloomFilter</span><span class="hljs-params">()</span> </span>{}
    
    <span class="hljs-comment">/**
     * æ·»åŠ è®¢å•å·åˆ°å¸ƒéš†è¿‡æ»¤å™¨
     * @param orderId è®¢å•å·
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">addOrderId</span><span class="hljs-params">(<span class="hljs-type">String</span> orderId)</span> </span>{
        <span class="hljs-keyword">if</span> (orderId == null || orderId.<span class="hljs-built_in">isEmpty</span>()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">IllegalArgumentException</span>(<span class="hljs-string">"è®¢å•å·ä¸èƒ½ä¸ºç©º"</span>);
        }
        ORDER_BLOOM_FILTER.<span class="hljs-built_in">put</span>(orderId);
    }
    
    <span class="hljs-comment">/**
     * åˆ¤æ–­è®¢å•å·æ˜¯å¦å¯èƒ½å­˜åœ¨ï¼ˆtrue=å¯èƒ½å­˜åœ¨ï¼Œfalse=ä¸€å®šä¸å­˜åœ¨ï¼‰
     * @param orderId è®¢å•å·
     * @return å­˜åœ¨æ€§åˆ¤æ–­
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title">mightContainOrderId</span><span class="hljs-params">(<span class="hljs-type">String</span> orderId)</span> </span>{
        <span class="hljs-keyword">if</span> (orderId == null || orderId.<span class="hljs-built_in">isEmpty</span>()) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-keyword">return</span> ORDER_BLOOM_FILTER.<span class="hljs-built_in">mightContain</span>(orderId);
    }
    
    <span class="hljs-comment">// æµ‹è¯•ç¤ºä¾‹</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>{
        <span class="hljs-type">String</span> orderId1 = <span class="hljs-string">"20251115123456789"</span>;
        <span class="hljs-type">String</span> orderId2 = <span class="hljs-string">"20251115987654321"</span>;
        
        <span class="hljs-comment">// æ·»åŠ orderId1</span>
        OrderBloomFilter.<span class="hljs-built_in">addOrderId</span>(orderId1);
        
        <span class="hljs-comment">// åˆ¤æ–­å­˜åœ¨æ€§</span>
        System.out.<span class="hljs-built_in">println</span>(OrderBloomFilter.<span class="hljs-built_in">mightContainOrderId</span>(orderId1)); <span class="hljs-comment">// trueï¼ˆå­˜åœ¨ï¼‰</span>
        System.out.<span class="hljs-built_in">println</span>(OrderBloomFilter.<span class="hljs-built_in">mightContainOrderId</span>(orderId2)); <span class="hljs-comment">// falseï¼ˆä¸å­˜åœ¨ï¼‰</span>
    }
}
</code></pre>
<h5 data-id="heading-20">ï¼ˆ3ï¼‰è®¢å•åˆ¤é‡æµç¨‹æ•´åˆ</h5>
<p>å°†å¸ƒéš†è¿‡æ»¤å™¨åµŒå…¥è®¢å•åˆ›å»ºæµç¨‹ï¼Œå®ç° â€œå…ˆè¿‡æ»¤ï¼Œå†æ ¡éªŒâ€ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/**
 * è®¢å•æœåŠ¡ï¼ˆæ•´åˆå¸ƒéš†è¿‡æ»¤å™¨ï¼‰
 */</span>
<span class="hljs-keyword">@Service</span>
public class OrderService {
    <span class="hljs-keyword">@Autowired</span>
    private OrderMapper orderMapper; <span class="hljs-comment">// è®¢å•æ•°æ®åº“DAO</span>
    
    <span class="hljs-comment">/**
     * åˆ›å»ºè®¢å•ï¼ˆå…ˆå¸ƒéš†è¿‡æ»¤å™¨è¿‡æ»¤ï¼Œå†æ•°æ®åº“æ ¡éªŒï¼‰
     */</span>
    public String <span class="hljs-built_in">createOrder</span>(OrderDTO orderDTO) {
        String orderId = <span class="hljs-built_in">generateOrderId</span>(); <span class="hljs-comment">// ç”Ÿæˆè®¢å•å·</span>
        
        <span class="hljs-comment">// æ­¥éª¤1ï¼šå¸ƒéš†è¿‡æ»¤å™¨å¿«é€Ÿåˆ¤æ–­</span>
        if (OrderBloomFilter.mightContainOrderId(orderId)) {
            <span class="hljs-comment">// æ­¥éª¤2ï¼šå¯èƒ½å­˜åœ¨ï¼ŒæŸ¥æ•°æ®åº“äºŒæ¬¡æ ¡éªŒï¼ˆè§£å†³è¯¯åˆ¤ï¼‰</span>
            OrderDO existOrder = orderMapper<span class="hljs-selector-class">.selectByOrderId</span>(orderId);
            if (existOrder != null) {
                throw new <span class="hljs-built_in">BusinessException</span>("è®¢å•å·å·²å­˜åœ¨ï¼Œè¯·å‹¿é‡å¤æäº¤");
            }
        }
        
        <span class="hljs-comment">// æ­¥éª¤3ï¼šè®¢å•ä¸å­˜åœ¨ï¼Œåˆ›å»ºè®¢å•</span>
        OrderDO orderDO = <span class="hljs-built_in">convertToOrderDO</span>(orderDTO, orderId);
        orderMapper<span class="hljs-selector-class">.insert</span>(orderDO);
        
        <span class="hljs-comment">// æ­¥éª¤4ï¼šå°†æ–°è®¢å•å·æ·»åŠ åˆ°å¸ƒéš†è¿‡æ»¤å™¨</span>
        OrderBloomFilter<span class="hljs-selector-class">.addOrderId</span>(orderId);
        
        return orderId;
    }
    
    <span class="hljs-comment">// ç”Ÿæˆè®¢å•å·ï¼ˆæ—¶é—´æˆ³+éšæœºæ•°ï¼Œç¡®ä¿å”¯ä¸€ï¼‰</span>
    private String <span class="hljs-built_in">generateOrderId</span>() {
        return new <span class="hljs-built_in">SimpleDateFormat</span>("yyyyMMddHHmmss")<span class="hljs-selector-class">.format</span>(new Date()) 
                + RandomUtils<span class="hljs-selector-class">.nextInt</span>(<span class="hljs-number">1000</span>, <span class="hljs-number">9999</span>);
    }
}
</code></pre>
<h4 data-id="heading-21">2. åˆ†å¸ƒå¼åœºæ™¯ï¼šRedis å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆé«˜å¯ç”¨ï¼‰</h4>
<p>é€‚åˆ â€œå¤šæœåŠ¡ã€åˆ†å¸ƒå¼è®¢å•ç³»ç»Ÿâ€ï¼ˆå¦‚å¤§å‹ç”µå•†ã€æ”¯ä»˜å¹³å°ï¼‰ï¼Œéœ€ç”¨ Redis å¸ƒéš†è¿‡æ»¤å™¨å®ç° â€œè·¨æœåŠ¡æ•°æ®å…±äº«â€ï¼ˆRedis Cluster æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²ï¼Œé¿å…å•ç‚¹æ•…éšœï¼‰ã€‚</p>
<p>Redis 4.0 + é€šè¿‡redisbloomæ¨¡å—æ”¯æŒå¸ƒéš†è¿‡æ»¤å™¨ï¼Œæä¾›BF.ADDï¼ˆæ·»åŠ ï¼‰ã€BF.EXISTSï¼ˆåˆ¤æ–­ï¼‰ã€BF.RESERVEï¼ˆåˆå§‹åŒ–ï¼‰ç­‰å‘½ä»¤ã€‚</p>
<h5 data-id="heading-22">ï¼ˆ1ï¼‰Redis å¸ƒéš†è¿‡æ»¤å™¨åˆå§‹åŒ–ï¼ˆå…³é”®å‚æ•°ï¼‰</h5>
<p>å…ˆé€šè¿‡BF.RESERVEå‘½ä»¤åˆå§‹åŒ–è¿‡æ»¤å™¨ï¼ˆæŒ‰è®¢å•åœºæ™¯å‚æ•°ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># BF.RESERVE key error_rate capacity [EXPANSION expansion]</span>
<span class="hljs-comment"># key=order_bloom_filterï¼Œerror_rate=0.001ï¼ˆè¯¯åˆ¤ç‡ï¼‰ï¼Œcapacity=200000000ï¼ˆé¢„è®¡2äº¿è®¢å•ï¼‰</span>
BF.RESERVE order_bloom_filter 0.001 200000000
</code></pre>
<ul>
<li>EXPANSIONï¼šå¯é€‰å‚æ•°ï¼Œå½“ä½æ•°ç»„æ»¡æ—¶ï¼Œæ–°æ‰©å±•çš„ä½æ•°ç»„å¤§å°æ˜¯åŸæ•°ç»„çš„å€æ•°ï¼ˆé»˜è®¤ 2ï¼‰ï¼Œé¿å…é¢‘ç¹æ‰©å®¹ã€‚</li>
</ul>
<h5 data-id="heading-23">ï¼ˆ2ï¼‰Java ä»£ç å®ç°ï¼ˆSpring Boot æ•´åˆï¼‰</h5>
<p>å¼•å…¥ Redis ä¾èµ–ï¼Œç”¨RedisTemplateè°ƒç”¨ Redis å¸ƒéš†è¿‡æ»¤å™¨å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> javax.annotation.Resource;
<span class="hljs-comment">/**
 * åˆ†å¸ƒå¼è®¢å•å·å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆRediså®ç°ï¼‰
 */</span>
@Component
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisOrderBloomFilter</span> {
    <span class="hljs-comment">// Rediså¸ƒéš†è¿‡æ»¤å™¨key</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> ORDER_BLOOM_KEY = <span class="hljs-string">"order:bloom:filter"</span>;
    <span class="hljs-comment">// è¯¯åˆ¤ç‡ï¼ˆä¸Redisåˆå§‹åŒ–æ—¶ä¸€è‡´ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> ERROR_RATE = <span class="hljs-number">0.001</span>;
    <span class="hljs-comment">// é¢„è®¡è®¢å•æ•°é‡ï¼ˆä¸Redisåˆå§‹åŒ–æ—¶ä¸€è‡´ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> EXPECTED_ORDER_COUNT = <span class="hljs-number">200</span>_000_000;
    
    @Resource
    <span class="hljs-keyword">private</span> RedisTemplate&lt;<span class="hljs-type">String</span>, <span class="hljs-type">String</span>&gt; redisTemplate;
    
    <span class="hljs-comment">/**
     * åˆå§‹åŒ–Rediså¸ƒéš†è¿‡æ»¤å™¨ï¼ˆé¡¹ç›®å¯åŠ¨æ—¶æ‰§è¡Œä¸€æ¬¡ï¼‰
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">initBloomFilter</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// åˆ¤æ–­è¿‡æ»¤å™¨æ˜¯å¦å·²å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆå§‹åŒ–</span>
        Boolean exists = redisTemplate.<span class="hljs-built_in">hasKey</span>(ORDER_BLOOM_KEY);
        <span class="hljs-keyword">if</span> (Boolean.FALSE.<span class="hljs-built_in">equals</span>(exists)) {
            <span class="hljs-comment">// è°ƒç”¨BF.RESERVEå‘½ä»¤åˆå§‹åŒ–</span>
            redisTemplate.<span class="hljs-built_in">execute</span>((connection) -&gt; {
                <span class="hljs-type">byte</span>[] key = ORDER_BLOOM_KEY.<span class="hljs-built_in">getBytes</span>();
                <span class="hljs-keyword">return</span> connection.<span class="hljs-built_in">execute</span>(<span class="hljs-string">"BF.RESERVE"</span>, 
                        key, 
                        <span class="hljs-type">String</span>.<span class="hljs-built_in">valueOf</span>(ERROR_RATE).<span class="hljs-built_in">getBytes</span>(), 
                        <span class="hljs-type">String</span>.<span class="hljs-built_in">valueOf</span>(EXPECTED_ORDER_COUNT).<span class="hljs-built_in">getBytes</span>());
            }, <span class="hljs-literal">true</span>);
        }
    }
    
    <span class="hljs-comment">/**
     * æ·»åŠ è®¢å•å·åˆ°Rediså¸ƒéš†è¿‡æ»¤å™¨
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">addOrderId</span><span class="hljs-params">(<span class="hljs-type">String</span> orderId)</span> </span>{
        <span class="hljs-keyword">if</span> (orderId == null || orderId.<span class="hljs-built_in">isEmpty</span>()) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-comment">// è°ƒç”¨BF.ADDå‘½ä»¤æ·»åŠ </span>
        redisTemplate.<span class="hljs-built_in">execute</span>((connection) -&gt; {
            <span class="hljs-type">byte</span>[] key = ORDER_BLOOM_KEY.<span class="hljs-built_in">getBytes</span>();
            <span class="hljs-type">byte</span>[] value = orderId.<span class="hljs-built_in">getBytes</span>();
            <span class="hljs-keyword">return</span> connection.<span class="hljs-built_in">execute</span>(<span class="hljs-string">"BF.ADD"</span>, key, value);
        }, <span class="hljs-literal">true</span>);
    }
    
    <span class="hljs-comment">/**
     * åˆ¤æ–­è®¢å•å·æ˜¯å¦å¯èƒ½å­˜åœ¨
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title">mightContainOrderId</span><span class="hljs-params">(<span class="hljs-type">String</span> orderId)</span> </span>{
        <span class="hljs-keyword">if</span> (orderId == null || orderId.<span class="hljs-built_in">isEmpty</span>()) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-comment">// è°ƒç”¨BF.EXISTSå‘½ä»¤åˆ¤æ–­</span>
        <span class="hljs-keyword">return</span> (Boolean) redisTemplate.<span class="hljs-built_in">execute</span>((connection) -&gt; {
            <span class="hljs-type">byte</span>[] key = ORDER_BLOOM_KEY.<span class="hljs-built_in">getBytes</span>();
            <span class="hljs-type">byte</span>[] value = orderId.<span class="hljs-built_in">getBytes</span>();
            <span class="hljs-keyword">return</span> connection.<span class="hljs-built_in">execute</span>(<span class="hljs-string">"BF.EXISTS"</span>, key, value);
        }, <span class="hljs-literal">true</span>);
    }
}
</code></pre>
<h5 data-id="heading-24">ï¼ˆ3ï¼‰åˆ†å¸ƒå¼è®¢å•åˆ¤é‡æµç¨‹</h5>
<p>ä¸å•æœºåœºæ™¯ç±»ä¼¼ï¼Œä½†éœ€æ³¨æ„ â€œåˆ†å¸ƒå¼ä¸€è‡´æ€§â€ï¼ˆå¤šæœåŠ¡åŒæ—¶æ·»åŠ è®¢å•å·ï¼Œéœ€ç¡®ä¿ Redis æ“ä½œåŸå­æ€§ï¼‰ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Service</span>
public class DistributedOrderService {
    <span class="hljs-keyword">@Autowired</span>
    private OrderMapper orderMapper;
    
    <span class="hljs-keyword">@Autowired</span>
    private RedisOrderBloomFilter redisOrderBloomFilter;
    
    <span class="hljs-keyword">@Autowired</span>
    private RedissonClient redissonClient; <span class="hljs-comment">// åˆ†å¸ƒå¼é”ï¼Œç¡®ä¿è®¢å•åˆ›å»ºåŸå­æ€§</span>
    
    public String <span class="hljs-built_in">createOrder</span>(OrderDTO orderDTO) {
        String orderId = <span class="hljs-built_in">generateOrderId</span>();
        <span class="hljs-comment">// åˆ†å¸ƒå¼é”ï¼šé¿å…åŒä¸€è®¢å•å·è¢«å¤šä¸ªæœåŠ¡åŒæ—¶åˆ›å»ºï¼ˆåŒé‡ä¿é™©ï¼‰</span>
        RLock lock = redissonClient<span class="hljs-selector-class">.getLock</span>("order:create:" + orderId);
        lock<span class="hljs-selector-class">.lock</span>(<span class="hljs-number">5</span>, TimeUnit.SECONDS); <span class="hljs-comment">// é”è¶…æ—¶5ç§’</span>
        
        try {
            <span class="hljs-comment">// æ­¥éª¤1ï¼šRediså¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­</span>
            if (redisOrderBloomFilter.mightContainOrderId(orderId)) {
                <span class="hljs-comment">// æ­¥éª¤2ï¼šæ•°æ®åº“äºŒæ¬¡æ ¡éªŒ</span>
                OrderDO existOrder = orderMapper<span class="hljs-selector-class">.selectByOrderId</span>(orderId);
                if (existOrder != null) {
                    throw new <span class="hljs-built_in">BusinessException</span>("è®¢å•å·å·²å­˜åœ¨");
                }
            }
            
            <span class="hljs-comment">// æ­¥éª¤3ï¼šåˆ›å»ºè®¢å•</span>
            OrderDO orderDO = <span class="hljs-built_in">convertToOrderDO</span>(orderDTO, orderId);
            orderMapper<span class="hljs-selector-class">.insert</span>(orderDO);
            
            <span class="hljs-comment">// æ­¥éª¤4ï¼šæ·»åŠ åˆ°Rediså¸ƒéš†è¿‡æ»¤å™¨ï¼ˆRedisæ“ä½œæ˜¯åŸå­çš„ï¼‰</span>
            redisOrderBloomFilter<span class="hljs-selector-class">.addOrderId</span>(orderId);
            
            return orderId;
        } finally {
            lock<span class="hljs-selector-class">.unlock</span>(); <span class="hljs-comment">// é‡Šæ”¾é”</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-25">äº”ã€å·¥ç¨‹è½åœ°é¿å‘ï¼šè®¢å•åœºæ™¯ç‰¹æ®Šé—®é¢˜è§£å†³</h3>
<p>å¸ƒéš†è¿‡æ»¤å™¨åœ¨è®¢å•åœºæ™¯çš„è½åœ°ä¸­ï¼Œä¼šé‡åˆ° â€œè¯¯åˆ¤å½±å“â€â€œæ•°æ®æŒä¹…åŒ–â€â€œè¿‡æœŸè®¢å•å¤„ç†â€ ç­‰é—®é¢˜ï¼Œéœ€é’ˆå¯¹æ€§è§£å†³ã€‚</p>
<h4 data-id="heading-26">1. è¯¯åˆ¤ç‡æ§åˆ¶ï¼šé¿å…å½±å“ç”¨æˆ·ä½“éªŒ</h4>
<p>è¯¯åˆ¤ä¼šå¯¼è‡´ â€œä¸å­˜åœ¨çš„è®¢å•å·è¢«åˆ¤æ–­ä¸ºå­˜åœ¨â€ï¼Œè¿›è€Œè§¦å‘æ•°æ®åº“æ ¡éªŒ â€”â€” è™½ç„¶ä¸å½±å“æ­£ç¡®æ€§ï¼Œä½†ä¼šå¢åŠ æ•°æ®åº“å‹åŠ›ã€‚è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li><strong>å‚æ•°ç²¾ç»†åŒ–</strong>ï¼šæŒ‰ â€œé¢„è®¡è®¢å•é‡çš„ 2 å€â€ è®¾è®¡ä½æ•°ç»„ï¼ˆé¿å…ä½æ•°ç»„è¿‡æ—©æ»¡ï¼Œå¯¼è‡´è¯¯åˆ¤ç‡å‡é«˜ï¼‰ï¼›</li>
</ul>

<ul>
<li><strong>åˆ†å±‚æ ¡éªŒ</strong>ï¼šå¯¹ â€œé«˜é¢‘æŸ¥è¯¢çš„è®¢å•å·â€ï¼ˆå¦‚æœ€è¿‘ 1 å¤©çš„è®¢å•ï¼‰ï¼Œé¢å¤–å­˜å…¥ Redis Setï¼Œä¼˜å…ˆæŸ¥ Redis Setï¼Œå†æŸ¥å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆé™ä½æ•°æ®åº“æ ¡éªŒé¢‘ç‡ï¼‰ï¼›</li>
</ul>

<ul>
<li><strong>è¯¯åˆ¤ç›‘æ§</strong>ï¼šç»Ÿè®¡ â€œå¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­å­˜åœ¨ï¼Œä½†æ•°æ®åº“å®é™…ä¸å­˜åœ¨â€ çš„æ¬¡æ•°ï¼ˆè¯¯åˆ¤æ¬¡æ•°ï¼‰ï¼Œå½“è¯¯åˆ¤ç‡è¶…è¿‡é˜ˆå€¼ï¼ˆå¦‚ 0.5%ï¼‰æ—¶ï¼Œè§¦å‘å‘Šè­¦å¹¶æ‰©å®¹ä½æ•°ç»„ã€‚</li>
</ul>
<h4 data-id="heading-27">2. æ•°æ®æŒä¹…åŒ–ï¼šé¿å… Redis é‡å¯ä¸¢å¤±</h4>
<p>Redis å¸ƒéš†è¿‡æ»¤å™¨çš„æ•°æ®é»˜è®¤å­˜åœ¨å†…å­˜ä¸­ï¼ŒRedis é‡å¯åä¼šä¸¢å¤± â€”â€” å¯¼è‡´ â€œå·²å­˜åœ¨çš„è®¢å•å·è¢«åˆ¤æ–­ä¸ºä¸å­˜åœ¨â€ï¼Œå¼•å‘é‡å¤åˆ›å»ºã€‚è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li><strong>Redis æŒä¹…åŒ–</strong>ï¼šå¼€å¯ Redis çš„ RDBï¼ˆå®šæ—¶å¿«ç…§ï¼‰+ AOFï¼ˆæ—¥å¿—ï¼‰æŒä¹…åŒ–ï¼Œç¡®ä¿ Redis é‡å¯åæ•°æ®æ¢å¤ï¼›</li>
</ul>

<ul>
<li><strong>å†·åŠ è½½</strong>ï¼šé¡¹ç›®å¯åŠ¨æ—¶ï¼Œä»æ•°æ®åº“è¯»å– â€œæ‰€æœ‰å·²å­˜åœ¨çš„è®¢å•å·â€ï¼Œæ‰¹é‡æ·»åŠ åˆ°å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆæ³¨æ„ï¼šäº¿çº§è®¢å•å·å†·åŠ è½½éœ€åˆ†æ‰¹å¤„ç†ï¼Œé¿å…é˜»å¡æœåŠ¡å¯åŠ¨ï¼‰ï¼›</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">// å†·åŠ è½½ç¤ºä¾‹ï¼ˆåˆ†æ‰¹è¯»å–ï¼Œæ¯æ¬¡1000æ¡ï¼‰
public void loadHistoryOrderIds() {
    long <span class="hljs-attr">total</span> = orderMapper.countAll()<span class="hljs-comment">;</span>
    long <span class="hljs-attr">batchSize</span> = <span class="hljs-number">1000</span><span class="hljs-comment">;</span>
    long <span class="hljs-attr">batchNum</span> = (total + batchSize - <span class="hljs-number">1</span>) / batchSize<span class="hljs-comment">;</span>
    
    for (long <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; batchNum; i++) {</span>
        List&lt;String&gt; <span class="hljs-attr">orderIds</span> = orderMapper.selectOrderIdByPage(i * batchSize, batchSize)<span class="hljs-comment">;</span>
        for (String orderId : orderIds) {
            redisOrderBloomFilter.addOrderId(orderId)<span class="hljs-comment">;</span>
        }
        // æ¯æ‰¹åŠ è½½åä¼‘çœ 100msï¼Œé¿å…å‹å®Redis
        try {
            Thread.sleep(100)<span class="hljs-comment">;</span>
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt()<span class="hljs-comment">;</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-28">3. è¿‡æœŸè®¢å•å¤„ç†ï¼šé¿å…ä½æ•°ç»„è†¨èƒ€</h4>
<p>è®¢å•å·ä¸€æ—¦ç”Ÿæˆï¼Œå¾ˆå°‘éœ€è¦åˆ é™¤ï¼Œä½† â€œè¶…æœŸæœªæ”¯ä»˜çš„è®¢å•â€ï¼ˆå¦‚ 24 å°æ—¶æœªæ”¯ä»˜è‡ªåŠ¨å–æ¶ˆï¼‰æ˜¯å¦éœ€è¦ä»å¸ƒéš†è¿‡æ»¤å™¨ä¸­åˆ é™¤ï¼Ÿâ€”â€” å› å¸ƒéš†è¿‡æ»¤å™¨ä¸æ”¯æŒåˆ é™¤ï¼Œè§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li><strong>åˆ†æ—¶æ®µå¸ƒéš†è¿‡æ»¤å™¨</strong>ï¼šæŒ‰ â€œå¤©â€ åˆ›å»ºå¸ƒéš†è¿‡æ»¤å™¨ï¼ˆå¦‚order:bloom:filter:20251115ï¼‰ï¼Œåªä¿ç•™æœ€è¿‘ 30 å¤©çš„è®¢å•å·ï¼›</li>
</ul>

<ul>
<li><strong>æŸ¥è¯¢æ—¶å¤šè¿‡æ»¤å™¨åˆ¤æ–­</strong>ï¼šåˆ¤æ–­è®¢å•å·æ˜¯å¦å­˜åœ¨æ—¶ï¼ŒæŸ¥è¯¢ â€œå½“å¤© + è¿‘ 30 å¤©â€ çš„æ‰€æœ‰è¿‡æ»¤å™¨ï¼Œåªè¦æœ‰ä¸€ä¸ªè¿‡æ»¤å™¨åˆ¤æ–­ â€œå¯èƒ½å­˜åœ¨â€ï¼Œå°±è¿›è¡Œæ•°æ®åº“æ ¡éªŒï¼›</li>
</ul>

<ul>
<li><strong>è¿‡æœŸè¿‡æ»¤å™¨æ¸…ç†</strong>ï¼šæ¯å¤©å‡Œæ™¨åˆ é™¤ â€œ30 å¤©å‰â€ çš„è¿‡æ»¤å™¨ï¼ˆå¦‚DEL order:bloom:filter:20251015ï¼‰ï¼Œé¿å… Redis å†…å­˜è†¨èƒ€ã€‚</li>
</ul>
<h4 data-id="heading-29">4. é«˜å¹¶å‘å®‰å…¨ï¼šé¿å…ç«æ€æ¡ä»¶</h4>
<p>åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œå¤šä¸ªæœåŠ¡åŒæ—¶åˆ›å»ºåŒä¸€è®¢å•å·ï¼Œå¯èƒ½å¯¼è‡´ â€œå¸ƒéš†è¿‡æ»¤å™¨æœªæ·»åŠ ï¼Œä½†æ•°æ®åº“å·²æ’å…¥â€ï¼ˆç«æ€æ¡ä»¶ï¼‰ã€‚è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li><strong>åˆ†å¸ƒå¼é”</strong>ï¼šå¦‚å‰æ–‡ä»£ç ï¼Œç”¨ Redisson åˆ†å¸ƒå¼é”é”å®š â€œè®¢å•å·â€ï¼Œç¡®ä¿åŒä¸€è®¢å•å·çš„åˆ›å»ºæ“ä½œä¸²è¡Œæ‰§è¡Œï¼›</li>
</ul>

<ul>
<li><strong>æ•°æ®åº“å”¯ä¸€ç´¢å¼•</strong>ï¼šåœ¨order_idå­—æ®µåŠ å”¯ä¸€ç´¢å¼•ï¼Œå³ä½¿å¸ƒéš†è¿‡æ»¤å™¨å¤±æ•ˆï¼Œæ•°æ®åº“ä¹Ÿèƒ½æ‹¦æˆªé‡å¤æ’å…¥ï¼ˆæœ€åä¸€é“é˜²çº¿ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-30">å…­ã€æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹å»ºè®®</h3>

































<table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ–¹æ¡ˆ</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>å•æœº / å°è®¢å•é‡</td><td>Guava BloomFilter</td><td>æ— é¢å¤–ä¾èµ–ï¼Œéƒ¨ç½²ç®€å•ï¼Œå»¶è¿Ÿä½</td><td>ä¸æ”¯æŒåˆ†å¸ƒå¼ï¼Œå†…å­˜å—é™</td><td>å†…éƒ¨ç³»ç»Ÿã€è®¢å•é‡â‰¤1 äº¿</td></tr><tr><td>åˆ†å¸ƒå¼ / å¤§è®¢å•é‡</td><td>Redis å¸ƒéš†è¿‡æ»¤å™¨</td><td>åˆ†å¸ƒå¼å…±äº«ï¼Œé«˜å¯ç”¨ï¼Œæ”¯æŒæµ·é‡æ•°æ®</td><td>ä¾èµ– Redisï¼Œå»¶è¿Ÿç•¥é«˜ï¼ˆ~1msï¼‰</td><td>ç”µå•†ã€æ”¯ä»˜å¹³å°ã€è®¢å•é‡â‰¥1 äº¿</td></tr><tr><td>è¶…å¤§è§„æ¨¡ / ä½å»¶è¿Ÿ</td><td>Redis å¸ƒéš† Filter + æœ¬åœ°ç¼“å­˜</td><td>å…¼é¡¾åˆ†å¸ƒå¼ä¸ä½å»¶è¿Ÿ</td><td>å®ç°å¤æ‚ï¼Œéœ€åŒæ­¥æœ¬åœ°ä¸ Redis</td><td>ç§’æ€ã€é«˜é¢‘ä¸‹å•åœºæ™¯</td></tr></tbody></table>
<h3 data-id="heading-31">æ€»ç»“</h3>
<p>ç”¨å¸ƒéš†è¿‡æ»¤å™¨è¿‡æ»¤å·²å­˜åœ¨è®¢å•å·çš„æ ¸å¿ƒæ˜¯ â€œ<strong>ç”¨æ¦‚ç‡æ¢ç©ºé—´ï¼Œç”¨äºŒæ¬¡æ ¡éªŒè¡¥è¯¯åˆ¤</strong>â€ï¼š</p>
<ul>
<li>åŸç†ä¸Šï¼Œé€šè¿‡ â€œå¤šå“ˆå¸Œå‡½æ•° + ä½æ•°ç»„â€ å®ç°é«˜æ•ˆåˆ¤é‡ï¼Œæ— æ¼åˆ¤ã€ä½å†…å­˜ï¼›</li>
</ul>

<ul>
<li>å®ç°ä¸Šï¼Œå•æœºç”¨ Guava å¿«é€Ÿè½åœ°ï¼Œåˆ†å¸ƒå¼ç”¨ Redis å¸ƒéš†è¿‡æ»¤å™¨ä¿è¯å…±äº«ï¼›</li>
</ul>

<ul>
<li>è½åœ°æ—¶ï¼Œé‡ç‚¹è§£å†³ â€œè¯¯åˆ¤ç‡æ§åˆ¶â€â€œæ•°æ®æŒä¹…åŒ–â€â€œåˆ†å¸ƒå¼å®‰å…¨â€ ä¸‰å¤§é—®é¢˜ï¼Œç»“åˆæ•°æ®åº“å”¯ä¸€ç´¢å¼•åšæœ€åé˜²çº¿ã€‚</li>
</ul>
<p>å¯¹è®¢å•åœºæ™¯è€Œè¨€ï¼Œå¸ƒéš†è¿‡æ»¤å™¨ä¸æ˜¯ â€œæ›¿ä»£æ•°æ®åº“ / Redisâ€ï¼Œè€Œæ˜¯ â€œå‰ç½®è¿‡æ»¤å±‚â€â€”â€” é€šè¿‡æ‹¦æˆª 99.9% çš„ â€œä¸å­˜åœ¨è®¢å•å·æŸ¥è¯¢â€ï¼Œå¤§å¹…é™ä½æ•°æ®åº“å‹åŠ›ï¼Œæ”¯æ’‘é«˜å¹¶å‘è®¢å•åˆ›å»ºã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vite 5.x å¼€å‘æ¨¡å¼å¯åŠ¨æµç¨‹åˆ†æ]]></title>    <link>https://juejin.cn/post/7572459217811243071</link>    <guid>https://juejin.cn/post/7572459217811243071</guid>    <pubDate>2025-11-15T06:42:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572459217811243071" data-draft-id="7572485825705263113" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vite 5.x å¼€å‘æ¨¡å¼å¯åŠ¨æµç¨‹åˆ†æ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-15T06:42:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ‹¿ä¸æ‹¿é“19"/> <meta itemprop="url" content="https://juejin.cn/user/3417747845299064"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vite 5.x å¼€å‘æ¨¡å¼å¯åŠ¨æµç¨‹åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3417747845299064/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ‹¿ä¸æ‹¿é“19
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T06:42:33.000Z" title="Sat Nov 15 2025 06:42:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»28åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vite 5.x å¼€å‘æ¨¡å¼å¯åŠ¨æµç¨‹åˆ†æ</h2>
<p>Vite ä½œä¸ºæ–°ä¸€ä»£å‰ç«¯æ„å»ºå·¥å…·ï¼Œå…¶æ ¸å¿ƒä¼˜åŠ¿åœ¨äºå¼€å‘æ¨¡å¼ä¸‹çš„<strong>æé€Ÿå¯åŠ¨</strong>å’Œ<strong>çƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰<strong>èƒ½åŠ›ã€‚ä¸ Webpack ç­‰ä¼ ç»Ÿæ„å»ºå·¥å…·çš„â€œå…ˆæ‰“åŒ…å†å¯åŠ¨â€æ¨¡å¼ä¸åŒï¼ŒVite åŸºäº ES æ¨¡å—ï¼ˆESMï¼‰çš„åŸç”Ÿæ”¯æŒï¼Œé‡‡ç”¨â€œæŒ‰éœ€ç¼–è¯‘â€ç­–ç•¥ï¼Œå¤§å¹…æå‡å¼€å‘ä½“éªŒã€‚æœ¬æ–‡å°†è¯¦ç»†æ‹†è§£ Vite 5.x ç‰ˆæœ¬åœ¨å¼€å‘æ¨¡å¼ä¸‹çš„</strong>é¦–æ¬¡å¯åŠ¨æµç¨‹</strong>å’Œ<strong>ä»£ç æ›´æ–°æµç¨‹</strong> <strong>ã€‚</strong></p>
<h3 data-id="heading-1">ä¸€ã€æ ¸å¿ƒå‰ç½®çŸ¥è¯†</h3>
<p>åœ¨åˆ†ææµç¨‹å‰ï¼Œéœ€æ˜ç¡® Vite å¼€å‘æ¨¡å¼çš„ä¸¤ä¸ªæ ¸å¿ƒè®¾è®¡ï¼š</p>
<ol>
<li>
<p><strong>åŸç”Ÿ ESM æ”¯æŒ</strong>ï¼šç°ä»£æµè§ˆå™¨å·²åŸç”Ÿæ”¯æŒ <code>import</code>/<code>export</code>ï¼ŒVite ç›´æ¥å°†é¡¹ç›®æºç ä»¥ ESM æ ¼å¼äº¤ç»™æµè§ˆå™¨ï¼Œé¿å…ä¼ ç»Ÿæ„å»ºå·¥å…·çš„å…¨é‡æ‰“åŒ…è¿‡ç¨‹ã€‚</p>
</li>
<li>
<p><strong>æŒ‰éœ€ç¼–è¯‘</strong>ï¼šä»…å½“æµè§ˆå™¨è¯·æ±‚æŸä¸ªæ¨¡å—æ—¶ï¼ŒVite æ‰ä¼šå¯¹è¯¥æ¨¡å—è¿›è¡Œç¼–è¯‘ï¼ˆå¦‚ TypeScript è½¬ JSã€Sass è½¬ CSS ç­‰ï¼‰ï¼Œè€Œéå¯åŠ¨æ—¶ç¼–è¯‘æ‰€æœ‰æ–‡ä»¶ã€‚</p>
</li>
<li>
<p><strong>ä¾èµ–é¢„æ„å»º</strong>ï¼šå¯¹ç¬¬ä¸‰æ–¹ä¾èµ–ï¼ˆå¦‚ <code>node_modules</code> ä¸­çš„åŒ…ï¼‰è¿›è¡Œé¢„æ„å»ºï¼Œå°†é ESM æ ¼å¼çš„ä¾èµ–è½¬ä¸º ESM æ ¼å¼ï¼Œå¹¶åˆå¹¶é‡å¤ä¾èµ–ï¼Œå‡å°‘è¯·æ±‚æ¬¡æ•°ã€‚</p>
</li>
</ol>
<h3 data-id="heading-2">äºŒã€é¦–æ¬¡å¯åŠ¨æµç¨‹ï¼ˆå¼€å‘æ¨¡å¼ï¼‰</h3>
<p>é¦–æ¬¡å¯åŠ¨æ˜¯æŒ‡é¡¹ç›®ä»â€œæœªè¿è¡Œâ€åˆ°â€œæµè§ˆå™¨å¯è®¿é—®â€çš„å®Œæ•´è¿‡ç¨‹ï¼Œæ ¸å¿ƒåˆ†ä¸ºã€Œä¾èµ–é¢„æ„å»ºã€ã€ŒæœåŠ¡å¯åŠ¨ã€ã€Œé¡µé¢è¯·æ±‚ä¸æ¨¡å—ç¼–è¯‘ã€ä¸‰ä¸ªé˜¶æ®µï¼Œå…± 8 ä¸ªå…³é”®æ­¥éª¤ã€‚ä»¥ä¸‹ä»¥ Vue 3 + TypeScript é¡¹ç›®ï¼ˆåˆå§‹åŒ–å‘½ä»¤ï¼š<code>npm create vite@latest my-vue-app -- --template vue-ts</code>ï¼‰ä¸ºä¾‹è¿›è¡Œè¯´æ˜ã€‚</p>
<h4 data-id="heading-3">é˜¶æ®µ 1ï¼šä¾èµ–é¢„æ„å»ºï¼ˆå¯åŠ¨å‰çš„å‡†å¤‡ï¼‰</h4>
<p>ä¾èµ–é¢„æ„å»ºæ˜¯ Vite é¦–æ¬¡å¯åŠ¨çš„æ ¸å¿ƒä¼˜åŒ–æ­¥éª¤ï¼Œç›®çš„æ˜¯è§£å†³ç¬¬ä¸‰æ–¹ä¾èµ–çš„å…¼å®¹æ€§å’Œæ€§èƒ½é—®é¢˜ï¼Œä»…åœ¨é¦–æ¬¡å¯åŠ¨æˆ–ä¾èµ–å˜åŠ¨æ—¶æ‰§è¡Œã€‚</p>
<h5 data-id="heading-4">æ­¥éª¤ 1ï¼šè§£æä¾èµ–å›¾è°±</h5>
<p>Vite å¯åŠ¨æ—¶ä¼šå…ˆè¯»å–é¡¹ç›®æ ¹ç›®å½•çš„ <code>package.json</code>ï¼Œè¯†åˆ« <code>dependencies</code> ä¸­çš„ç¬¬ä¸‰æ–¹ä¾èµ–ï¼ˆå¦‚ <code>vue</code>ã€<code>@vue/compiler-sfc</code> ç­‰ï¼‰ï¼Œå¹¶é€šè¿‡ <code>esbuild</code> å¿«é€Ÿè§£æè¿™äº›ä¾èµ–çš„ä¾èµ–å›¾è°±ï¼ˆå³ä¾èµ–çš„ä¾èµ–ï¼Œå¦‚ <code>vue</code> ä¾èµ–çš„ <code>@vue/runtime-core</code>ï¼‰ã€‚è§£æå®Œæˆåï¼Œä¼šç”Ÿæˆä¾èµ–å…³ç³»æ•°æ®å¹¶æš‚å­˜äºå†…å­˜ï¼ŒåŒæ—¶ä¸ºåç»­é¢„æ„å»ºäº§ç‰©ç”Ÿæˆæä¾›ä¾æ®ï¼Œæœ€ç»ˆä½“ç°åœ¨é¢„æ„å»ºé˜¶æ®µè¾“å‡ºçš„ <code>node_modules/.vite/_metadata.json</code> ç¼“å­˜æ–‡ä»¶ä¸­ã€‚</p>
<p><strong>ç¤º</strong> <strong>ä¾‹</strong>ï¼šåœ¨ Vue 3 é¡¹ç›®ä¸­ï¼ŒVite ä¼šè§£æå‡º <code>vue</code> åŠå…¶å…³è”çš„è¿è¡Œæ—¶ã€ç¼–è¯‘å™¨ç­‰å­ä¾èµ–ï¼Œå½¢æˆå®Œæ•´çš„ä¾èµ–é“¾ã€‚è¯¥ä¾èµ–é“¾ä¿¡æ¯ä¼šè¢«è®°å½•åˆ° <code>_metadata.json</code> çš„ <code>dependencyGraph</code> å­—æ®µä¸­ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json">
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"5.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencyGraph"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"imports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"@vue/runtime-core"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"@vue/runtime-dom"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"createApp"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"ref"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"reactive"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"file"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node_modules/.vite/deps/vue.js"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vue-router"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"imports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"vue"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"createRouter"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"file"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node_modules/.vite/deps/vue-router.js"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"optimized"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"src"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node_modules/vue/dist/vue.runtime.esm-bundler.js"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"file"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node_modules/.vite/deps/vue.js"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1a2b3c"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¯¥ç¼“å­˜æ–‡ä»¶ä¸­çš„ä¾èµ–å›¾è°±ä¿¡æ¯ï¼Œä¼šç”¨äºåç»­å¯åŠ¨æ—¶å¿«é€Ÿæ ¡éªŒä¾èµ–æ˜¯å¦å˜åŠ¨ï¼ˆå¦‚å­ä¾èµ–ç‰ˆæœ¬æ›´æ–°ä¼šå¯¼è‡´ <code>dependencyGraph</code> å˜åŒ–ï¼‰ï¼Œä»è€Œå†³å®šæ˜¯å¦éœ€è¦é‡æ–°æ‰§è¡Œé¢„æ„å»ºã€‚</p>
<h5 data-id="heading-5">æ­¥éª¤ 2ï¼šé¢„æ„å»ºé ESM ä¾èµ–</h5>
<p>éƒ¨åˆ†ç¬¬ä¸‰æ–¹ä¾èµ–ï¼ˆå¦‚ä¸€äº›è€çš„ npm åŒ…ï¼‰ä»é‡‡ç”¨ CommonJS æ ¼å¼ï¼ˆ<code>module.exports</code>/<code>require</code>ï¼‰ï¼Œæµè§ˆå™¨æ— æ³•ç›´æ¥è¯†åˆ«ã€‚Vite ä¼šé€šè¿‡ <code>esbuild</code> å°†è¿™äº›é ESM ä¾èµ–è½¬ä¸º ESM æ ¼å¼ã€‚</p>
<p><strong>ç¤º</strong> <strong>ä¾‹</strong>ï¼šè‹¥é¡¹ç›®ä¸­å¼•å…¥äº†é‡‡ç”¨ CommonJS æ ¼å¼çš„ <code>lodash@4.17.21</code>ï¼ŒVite ä¼šå°†å…¶ç¼–è¯‘ä¸º ESM æ ¼å¼ï¼Œç”Ÿæˆå¯è¢«æµè§ˆå™¨ç›´æ¥å¯¼å…¥çš„ä»£ç ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-comment">// ç¼–è¯‘å‰ï¼ˆCommonJSï¼‰</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">debounce</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">func, wait</span>) { ... }
};

<span class="hljs-comment">// ç¼–è¯‘åï¼ˆESMï¼‰</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">func, wait</span>) { ... };
</code></pre>
<h5 data-id="heading-6">æ­¥éª¤ 3ï¼šç”Ÿæˆé¢„æ„å»ºäº§ç‰©</h5>
<p>é¢„æ„å»ºåçš„ä¾èµ–äº§ç‰©ä¼šè¢«å­˜å…¥é¡¹ç›®æ ¹ç›®å½•çš„ <code>node_modules/.vite/deps</code> ç›®å½•ä¸­ï¼ˆVite 2.x ä¸º <code>node_modules/.vite</code>ï¼ŒVite 3.x åŠä»¥ä¸Šç‰ˆæœ¬ç»Ÿä¸€è¿ç§»è‡³ <code>deps</code> å­ç›®å½•ï¼‰ï¼ŒåŒæ—¶ç”Ÿæˆ <code>node_modules/.vite/_metadata.json</code> ç¼“å­˜æ–‡ä»¶ï¼ˆæ›¿ä»£æ—§ç‰ˆæœ¬çš„ <code>deps_cache.json</code>ï¼‰ï¼Œç”¨äºåç»­å¯åŠ¨æ—¶åˆ¤æ–­ä¾èµ–æ˜¯å¦å˜åŠ¨ï¼ˆè‹¥æœªå˜åŠ¨åˆ™è·³è¿‡é¢„æ„å»ºï¼‰ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š<code>node_modules/.vite/</code> <code>deps/</code> <code>vue.js</code> å³ä¸º <code>vue</code> é¢„æ„å»ºåçš„ ESM äº§ç‰©ï¼Œå¯ç›´æ¥è¢«æµè§ˆå™¨å¯¼å…¥ã€‚</p>
<h5 data-id="heading-7">æ­¥éª¤ 4ï¼šåˆå¹¶é‡å¤ä¾èµ–ï¼ˆ deduplication ï¼‰</h5>
<p>è‹¥å¤šä¸ªä¾èµ–åŒæ—¶ä¾èµ–æŸä¸ªå­ä¾èµ–ï¼ˆå¦‚ <code>vue-router</code> å’Œ <code>pinia</code> éƒ½ä¾èµ– <code>vue</code>ï¼‰ï¼ŒVite ä¼šå°†é‡å¤çš„å­ä¾èµ–åˆå¹¶ä¸ºä¸€ä¸ªæ¨¡å—ï¼Œé¿å…æµè§ˆå™¨é‡å¤è¯·æ±‚ã€‚</p>
<p><strong>ç¤º</strong> <strong>ä¾‹</strong>ï¼š<code>vue-router@4</code> å’Œ <code>pinia@2</code> å‡ä¾èµ– <code>vue@3</code>ï¼Œé¢„æ„å»ºæ—¶ä¼šå°† <code>vue</code> æŠ½ç¦»ä¸ºå•ç‹¬æ¨¡å—ï¼Œä¾›ä¸¤è€…å…±åŒå¼•ç”¨ã€‚å…·ä½“å¼•ç”¨é€»è¾‘å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// 1. é¢„æ„å»ºå‰ï¼švue-router å’Œ pinia å„è‡ªå†…éƒ¨å¼•ç”¨ vue</span>
<span class="hljs-comment">// vue-router å†…éƒ¨ä»£ç ï¼ˆç®€åŒ–ï¼‰</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./node_modules/vue/dist/vue.runtime.esm-bundler.js'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createRouter</span>(<span class="hljs-params"/>) { <span class="hljs-comment">/* ä¾èµ– Vue å®ç°é€»è¾‘ */</span> }

<span class="hljs-comment">// pinia å†…éƒ¨ä»£ç ï¼ˆç®€åŒ–ï¼‰</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./node_modules/vue/dist/vue.runtime.esm-bundler.js'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createPinia</span>(<span class="hljs-params"/>) { <span class="hljs-comment">/* ä¾èµ– Vue å®ç°é€»è¾‘ */</span> }

<span class="hljs-comment">// 2. é¢„æ„å»ºåï¼šåˆå¹¶ä¸ºå…±åŒå¼•ç”¨é¢„æ„å»ºçš„ vue æ¨¡å—</span>
<span class="hljs-comment">// é¢„æ„å»ºäº§ç‰©ï¼šnode_modules/.vite/deps/vue.jsï¼ˆå•ç‹¬æ¨¡å—ï¼ŒVite 5.x è·¯å¾„ï¼‰</span>
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// é¢„æ„å»ºå vue-router äº§ç‰©ï¼ˆç®€åŒ–ï¼‰</span>
<span class="hljs-keyword">import</span> { ref, reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'/node_modules/.vite/deps/vue.js?v=1a2b3c'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createRouter</span>(<span class="hljs-params"/>) { <span class="hljs-comment">/* ä¾èµ–å…±äº«çš„ Vue API å®ç°é€»è¾‘ */</span> }

<span class="hljs-comment">// é¢„æ„å»ºå pinia äº§ç‰©ï¼ˆç®€åŒ–ï¼‰</span>
<span class="hljs-keyword">import</span> { ref, reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'/node_modules/.vite/deps/vue.js?v=1a2b3c'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createPinia</span>(<span class="hljs-params"/>) { <span class="hljs-comment">/* ä¾èµ–å…±äº«çš„ Vue API å®ç°é€»è¾‘ */</span> }
</code></pre>
<p>é€šè¿‡åˆå¹¶ï¼Œæµè§ˆå™¨ä»…éœ€è¯·æ±‚ä¸€æ¬¡ <code>/node_modules/.vite/deps/vue.js</code> å³å¯æ»¡è¶³ä¸¤ä¸ªä¾èµ–çš„éœ€æ±‚ï¼Œé¿å…äº†é‡å¤è¯·æ±‚å¯¼è‡´çš„æ€§èƒ½æŸè€—ã€‚</p>
<h5 data-id="heading-8"/>
<h4 data-id="heading-9">é˜¶æ®µ 2ï¼šå¼€å‘æœåŠ¡å™¨å¯åŠ¨</h4>
<p>ä¾èµ–é¢„æ„å»ºå®Œæˆåï¼ŒVite ä¼šå¯åŠ¨ä¸€ä¸ªåŸºäº <code>connect</code> çš„å¼€å‘æœåŠ¡å™¨ï¼Œç”¨äºå¤„ç†æµè§ˆå™¨çš„è¯·æ±‚ã€æä¾›æ¨¡å—ç¼–è¯‘æœåŠ¡å’Œ HMR æ”¯æŒã€‚</p>
<h5 data-id="heading-10">æ­¥éª¤ 5ï¼šåˆå§‹åŒ–æœåŠ¡å™¨é…ç½®</h5>
<p>Vite è¯»å–é¡¹ç›®ä¸­çš„ <code>vite.config.ts</code>ï¼ˆæˆ– <code>.js</code>ï¼‰é…ç½®æ–‡ä»¶ï¼Œåˆå§‹åŒ–æœåŠ¡å™¨å‚æ•°ï¼Œå¦‚ç«¯å£ï¼ˆé»˜è®¤ 5173ï¼‰ã€ä»£ç†ï¼ˆ<code>server.proxy</code>ï¼‰ã€è·¨åŸŸï¼ˆ<code>server.cors</code>ï¼‰ç­‰ã€‚</p>
<p><strong>ç¤º</strong> <strong>ä¾‹</strong>ï¼šè‹¥é…ç½®äº†ä»£ç†è§£å†³è·¨åŸŸé—®é¢˜ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vue</span>()],
  <span class="hljs-attr">server</span>: {
    <span class="hljs-attr">proxy</span>: {
      <span class="hljs-string">'/api'</span>: {
        <span class="hljs-attr">target</span>: <span class="hljs-string">'http://localhost:3000'</span>, <span class="hljs-comment">// åç«¯æœåŠ¡åœ°å€</span>
        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">rewrite</span>: <span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> path.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^\/api/</span>, <span class="hljs-string">''</span>)
      }
    }
  }
});
</code></pre>
<p>Vite ä¼šå°†æœåŠ¡å™¨çš„ <code>/api</code> è·¯å¾„è¯·æ±‚ä»£ç†åˆ° <code>http://localhost:3000</code>ã€‚</p>
<h5 data-id="heading-11">æ­¥éª¤ 6ï¼šå¯åŠ¨æœåŠ¡å™¨å¹¶ç›‘å¬ç«¯å£</h5>
<p>åŸºäº <code>connect</code> å¯åŠ¨ HTTP æœåŠ¡å™¨ï¼Œç›‘å¬é…ç½®çš„ç«¯å£ï¼ˆé»˜è®¤ 5173ï¼‰ï¼ŒåŒæ—¶æ³¨å†Œä¸€ç³»åˆ—æ ¸å¿ƒä¸­é—´ä»¶ã€‚ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œä¸­é—´ä»¶æ˜¯<strong>æ‹¦æˆªå¹¶å¤„ç† HTTP è¯·æ±‚çš„â€œç®¡é“å¼â€å‡½æ•°</strong>â€”â€”æµè§ˆå™¨çš„è¯·æ±‚ä¼šæŒ‰é¡ºåºæµç»å„ä¸ªä¸­é—´ä»¶ï¼Œæ¯ä¸ªä¸­é—´ä»¶å®Œæˆç‰¹å®šèŒè´£ï¼ˆå¦‚ç¼–è¯‘ã€ç¼“å­˜ã€ä»£ç†ï¼‰åï¼Œè¦ä¹ˆå°†è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œè¦ä¹ˆç›´æ¥è¿”å›å“åº”ç»“æœï¼Œç±»ä¼¼å·¥å‚æµæ°´çº¿ä¸­â€œå„å¸å…¶èŒã€ä¾æ¬¡å¤„ç†â€çš„å·¥åºã€‚å…¶æ ¸å¿ƒç‰¹æ€§æ˜¯â€œèŒè´£å•ä¸€â€å’Œâ€œé¡ºåºæ‰§è¡Œâ€ï¼Œé€šè¿‡ç»„åˆä¸åŒä¸­é—´ä»¶å®ç°å¤æ‚çš„è¯·æ±‚å¤„ç†é€»è¾‘ï¼Œä¹Ÿè®©åŠŸèƒ½æ‰©å±•æ›´çµæ´»ï¼ˆå¦‚æ–°å¢é¢„å¤„ç†è¯­æ³•æ”¯æŒæ—¶ï¼Œä»…éœ€æ·»åŠ å¯¹åº”ç¼–è¯‘ä¸­é—´ä»¶ï¼‰ã€‚</p>
<p>ä¸ºæ›´ç›´è§‚ç†è§£ä¸­é—´ä»¶çš„â€œç®¡é“å¼â€å·¥ä½œé€»è¾‘ï¼Œä»¥ä¸‹é€šè¿‡æ¨¡æ‹Ÿ Vite æ ¸å¿ƒä¸­é—´ä»¶çš„ç®€åŒ–ä»£ç ï¼Œå±•ç¤ºè¯·æ±‚ä»æ¥æ”¶è‡³å“åº”çš„æµè½¬è¿‡ç¨‹ï¼ˆåŸºäº connect ä¸­é—´ä»¶æœºåˆ¶ï¼‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ¨¡æ‹Ÿ Vite å¼€å‘æœåŠ¡å™¨ä¸­é—´ä»¶ç®¡é“ï¼ˆç®€åŒ–ç‰ˆï¼‰</span>
<span class="hljs-keyword">import</span> connect <span class="hljs-keyword">from</span> <span class="hljs-string">'connect'</span>;
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">connect</span>(); <span class="hljs-comment">// åˆ›å»º connect æœåŠ¡å™¨å®ä¾‹</span>

<span class="hljs-comment">// 1. æ—¥å¿—ä¸­é—´ä»¶ï¼ˆæ¨¡æ‹Ÿè¯·æ±‚å…¥å£è®°å½•ï¼‰</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[è¯·æ±‚æ¥æ”¶] <span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toLocaleTimeString()}</span> - <span class="hljs-subst">${req.url}</span>`</span>);
  <span class="hljs-title function_">next</span>(); <span class="hljs-comment">// è°ƒç”¨ next() ä¼ é€’ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶</span>
});

<span class="hljs-comment">// 2. é™æ€èµ„æºä¸­é—´ä»¶ï¼ˆæ¨¡æ‹Ÿå¤„ç†å›¾ç‰‡ç­‰é™æ€èµ„æºï¼‰</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> staticExts = [<span class="hljs-string">'.png'</span>, <span class="hljs-string">'.jpg'</span>, <span class="hljs-string">'.svg'</span>];
  <span class="hljs-keyword">const</span> isStatic = staticExts.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">ext</span> =&gt;</span> req.<span class="hljs-property">url</span>.<span class="hljs-title function_">endsWith</span>(ext));
  <span class="hljs-keyword">if</span> (isStatic) {
    <span class="hljs-comment">// æ¨¡æ‹Ÿè¯»å–é™æ€æ–‡ä»¶å¹¶è¿”å›</span>
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'image/svg+xml'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'&lt;svg width="100" height="100"&gt;&lt;circle cx="50" cy="50" r="40" fill="#42b983"/&gt;&lt;/svg&gt;'</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_">next</span>(); <span class="hljs-comment">// éé™æ€èµ„æºï¼Œä¼ é€’ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶</span>
  }
});

<span class="hljs-comment">// 3. æ¨¡å—ç¼–è¯‘ä¸­é—´ä»¶ï¼ˆæ¨¡æ‹Ÿå¤„ç† .vue æ¨¡å—ï¼‰</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">url</span>.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.vue'</span>)) {
    <span class="hljs-comment">// æ¨¡æ‹Ÿ Vue ç»„ä»¶ç¼–è¯‘ï¼šæ¨¡æ¿è½¬æ¸²æŸ“å‡½æ•° + è„šæœ¬å¤„ç†</span>
    <span class="hljs-keyword">const</span> componentName = req.<span class="hljs-property">url</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>).<span class="hljs-title function_">pop</span>().<span class="hljs-title function_">replace</span>(<span class="hljs-string">'.vue'</span>, <span class="hljs-string">''</span>);
    <span class="hljs-keyword">const</span> compiledCode = <span class="hljs-string">`
      import { h } from '/node_modules/.vite/deps/vue.js';
      export default {
        name: '<span class="hljs-subst">${componentName}</span>',
        render() { return h('div', 'ç¼–è¯‘åçš„<span class="hljs-subst">${componentName}</span>ç»„ä»¶'); }
      }
    `</span>;
    <span class="hljs-comment">// è¿”å›ç¼–è¯‘åçš„ ESM ä»£ç </span>
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/javascript'</span> });
    res.<span class="hljs-title function_">end</span>(compiledCode);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_">next</span>(); <span class="hljs-comment">// é .vue æ¨¡å—ï¼Œä¼ é€’ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶</span>
  }
});

<span class="hljs-comment">// 4. é”™è¯¯å¤„ç†ä¸­é—´ä»¶ï¼ˆæ•è·åç»­ä¸­é—´ä»¶æŠ›å‡ºçš„é”™è¯¯ï¼‰</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">err, req, res, next</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`[è¯·æ±‚é”™è¯¯] <span class="hljs-subst">${err.message}</span>`</span>);
  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">500</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span> });
  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">`æœåŠ¡å™¨é”™è¯¯ï¼š<span class="hljs-subst">${err.message}</span>`</span>);
});

<span class="hljs-comment">// å¯åŠ¨æœåŠ¡å™¨</span>
app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">5173</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å¼€å‘æœåŠ¡å™¨å¯åŠ¨ï¼šhttp://localhost:5173'</span>);
});
</code></pre>
<p>ä¸Šè¿°ä»£ç æ ¸å¿ƒé€»è¾‘ä¸ Vite å®é™…ä¸­é—´ä»¶æœºåˆ¶ä¸€è‡´ï¼š</p>
<ul>
<li>
<p>é€šè¿‡ <code>app.use()</code> æŒ‰é¡ºåºæ³¨å†Œä¸­é—´ä»¶ï¼Œè¯·æ±‚ä¼šä¾æ¬¡æµç»æ—¥å¿—â†’é™æ€èµ„æºâ†’æ¨¡å—ç¼–è¯‘ä¸­é—´ä»¶ï¼›</p>
</li>
<li>
<p>æ¯ä¸ªä¸­é—´ä»¶é€šè¿‡ <code>next()</code> ä¼ é€’è¯·æ±‚ï¼Œè‹¥èƒ½å¤„ç†å½“å‰è¯·æ±‚ï¼ˆå¦‚é™æ€èµ„æºä¸­é—´ä»¶å¤„ç† .svg è¯·æ±‚ï¼‰åˆ™ç›´æ¥è¿”å›å“åº”ï¼›</p>
</li>
<li>
<p>é”™è¯¯å¤„ç†ä¸­é—´ä»¶é€šè¿‡ç‰¹æ®Šçš„å››å‚æ•°å‡½æ•°å®šä¹‰ï¼Œå¯æ•è·å‰åºä¸­é—´ä»¶æŠ›å‡ºçš„å¼‚å¸¸å¹¶ç»Ÿä¸€å¤„ç†ã€‚</p>
</li>
</ul>
<p>æ ¸å¿ƒä¸­é—´ä»¶åŠå…¶ä½œç”¨å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p><strong>HMR ä¸­é—´ä»¶ï¼ˆçƒ­æ›´æ–°ä¸­é—´ä»¶ï¼‰</strong>ï¼šæ ¸å¿ƒä½œç”¨æ˜¯å»ºç«‹å¹¶ç»´æŠ¤ WebSocket é•¿è¿æ¥ï¼Œå®æ—¶å‘æµè§ˆå™¨æ¨é€æ–‡ä»¶å˜æ›´é€šçŸ¥ï¼ˆå¦‚ä»£ç ä¿®æ”¹ã€æ–°å¢æ–‡ä»¶ï¼‰ï¼ŒåŒæ—¶æ¥æ”¶æµè§ˆå™¨çš„ HMR çŠ¶æ€åé¦ˆï¼›å½“æ£€æµ‹åˆ°æ— æ³•çƒ­æ›´æ–°çš„åœºæ™¯æ—¶ï¼Œè§¦å‘å…¨é¡µåˆ·æ–°é€»è¾‘ã€‚</p>
</li>
<li>
<p><strong>æ¨¡å—ç¼–è¯‘ä¸­é—´ä»¶</strong>ï¼šå¼€å‘æ¨¡å¼çš„æ ¸å¿ƒä¸­é—´ä»¶ï¼Œè´Ÿè´£æ‹¦æˆªæµè§ˆå™¨å¯¹æ¨¡å—çš„è¯·æ±‚ï¼ˆå¦‚ .tsã€.vueã€.scss æ–‡ä»¶ï¼‰ï¼Œè°ƒç”¨å¯¹åº”å¤„ç†å™¨ï¼ˆå¦‚ esbuildã€@vitejs/plugin-vueï¼‰å®Œæˆç¼–è¯‘ã€è½¬è¯‘å’Œè·¯å¾„é‡å†™ï¼Œå°†å¤„ç†åçš„ ESM ä»£ç æˆ– CSS å†…å®¹è¿”å›ç»™æµè§ˆå™¨ï¼›åŒæ—¶ä¼šç¼“å­˜ç¼–è¯‘ç»“æœåˆ°å†…å­˜ï¼Œæå‡é‡å¤è¯·æ±‚çš„å“åº”é€Ÿåº¦ã€‚</p>
</li>
<li>
<p><strong>é™æ€èµ„æºä¸­é—´ä»¶</strong>ï¼šå¤„ç†å›¾ç‰‡ã€å­—ä½“ã€JSON ç­‰é™æ€èµ„æºçš„è¯·æ±‚ï¼Œç›´æ¥è¯»å–é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„é™æ€æ–‡ä»¶å¹¶è¿”å›ï¼›æ”¯æŒå¯¹å°èµ„æºï¼ˆå¦‚å°äº 4KB çš„å›¾ç‰‡ï¼‰è‡ªåŠ¨è½¬ä¸º Base64 ç¼–ç ï¼Œå‡å°‘ HTTP è¯·æ±‚æ¬¡æ•°ã€‚</p>
</li>
<li>
<p><strong>HTML å¤„ç†ä¸­é—´ä»¶</strong>ï¼šä¸“é—¨å¤„ç†å…¥å£ HTML æ–‡ä»¶ï¼ˆindex.htmlï¼‰çš„è¯·æ±‚ï¼Œå®Œæˆè„šæœ¬æ ‡ç­¾æ”¹é€ ï¼ˆè¡¥å…… type="module"ã€æ³¨å…¥ /@vite/clientï¼‰ã€ç¯å¢ƒå˜é‡æ³¨å…¥ç­‰æ“ä½œï¼Œç¡®ä¿è¿”å›çš„ HTML èƒ½æ­£ç¡®è§¦å‘åç»­æ¨¡å—è¯·æ±‚ã€‚</p>
</li>
<li>
<p><strong>ä»£ç†ä¸­é—´ä»¶</strong>ï¼šæ ¹æ® vite.config.ts ä¸­çš„ server.proxy é…ç½®ï¼Œå°†ç‰¹å®šè·¯å¾„çš„è¯·æ±‚ï¼ˆå¦‚ /apiï¼‰è½¬å‘åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼ˆå¦‚åç«¯å¼€å‘æœåŠ¡ï¼‰ï¼Œå¹¶å¤„ç†è·¨åŸŸç›¸å…³çš„è¯·æ±‚å¤´ï¼ˆå¦‚ changeOriginï¼‰ï¼Œè§£å†³å‰ç«¯å¼€å‘ä¸­çš„è·¨åŸŸé—®é¢˜ã€‚</p>
</li>
<li>
<p><strong>ç¼“å­˜æ§åˆ¶ä¸­é—´ä»¶</strong>ï¼šä¸ºä¸åŒç±»å‹çš„å“åº”è®¾ç½®åˆç†çš„ç¼“å­˜ç­–ç•¥ï¼Œä¾‹å¦‚å¯¹é¢„æ„å»ºäº§ç‰©ï¼ˆnode_modules/.vite/deps ä¸‹çš„æ–‡ä»¶ï¼‰æ·»åŠ å¼ºç¼“å­˜å¤´ï¼Œå¯¹æºç ç¼–è¯‘åçš„æ¨¡å—æ·»åŠ åå•†ç¼“å­˜å¤´ï¼Œå¹³è¡¡ç¼“å­˜æ•ˆç‡ä¸æ›´æ–°åŠæ—¶æ€§ã€‚</p>
</li>
<li>
<p><strong>é”™è¯¯å¤„ç†ä¸­é—´ä»¶</strong>ï¼šæ•è·è¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­çš„å¼‚å¸¸ï¼ˆå¦‚æ¨¡å—ç¼–è¯‘å¤±è´¥ã€æ–‡ä»¶ä¸å­˜åœ¨ï¼‰ï¼Œå°†é”™è¯¯ä¿¡æ¯æ ¼å¼åŒ–ï¼ˆå¦‚è½¬ä¸ºå‹å¥½çš„é¡µé¢çº§é”™è¯¯æç¤ºæˆ–æ§åˆ¶å°æ—¥å¿—ï¼‰åè¿”å›ç»™æµè§ˆå™¨ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½é—®é¢˜ã€‚</p>
</li>
</ul>
<p>è¿™äº›ä¸­é—´ä»¶æŒ‰â€œè¯·æ±‚æ¥æ”¶â†’ç¼“å­˜æ ¡éªŒâ†’é™æ€èµ„æºåˆ¤æ–­â†’æ¨¡å—ç¼–è¯‘/ä»£ç†è½¬å‘â†’çƒ­æ›´æ–°é€šçŸ¥â†’å“åº”è¿”å›â€çš„æµç¨‹ååŒå·¥ä½œï¼Œç¡®ä¿å¼€å‘æ¨¡å¼ä¸‹çš„è¯·æ±‚å¤„ç†é«˜æ•ˆä¸”å¯é ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼šå¯åŠ¨æˆåŠŸåï¼Œç»ˆç«¯ä¼šè¾“å‡ºä»¥ä¸‹ä¿¡æ¯ï¼Œæç¤ºæœåŠ¡å™¨å·²å°±ç»ªï¼Œæ‰€æœ‰ä¸­é—´ä»¶å‡å·²å®Œæˆåˆå§‹åŒ–ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">  VITE v5.0.0 ready <span class="hljs-keyword">in</span> 300 ms

  âœ  Local:   http://localhost:5173/
  âœ  Network: use --host to expose
  âœ  press h + enter to show <span class="hljs-built_in">help</span>
</code></pre>
<h4 data-id="heading-12">é˜¶æ®µ 3ï¼šé¡µé¢è¯·æ±‚ä¸æ¨¡å—ç¼–è¯‘</h4>
<p>æœåŠ¡å™¨å¯åŠ¨åï¼Œéœ€ç­‰å¾…ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è®¿é—®åœ°å€ï¼ˆå¦‚ <code>http://localhost:5173</code>ï¼‰ï¼Œæ‰ä¼šè§¦å‘åç»­çš„é¡µé¢æ¸²æŸ“å’Œæ¨¡å—ç¼–è¯‘æµç¨‹ï¼ˆæŒ‰éœ€ç¼–è¯‘çš„æ ¸å¿ƒä½“ç°ï¼‰ã€‚</p>
<h5 data-id="heading-13">æ­¥éª¤ 7ï¼šå¤„ç†å…¥å£ HTML è¯·æ±‚</h5>
<p>å½“ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è®¿é—®æœåŠ¡å™¨åœ°å€æ—¶ï¼Œæµè§ˆå™¨é¦–å…ˆè¯·æ±‚é¡¹ç›®çš„å…¥å£ HTML æ–‡ä»¶ï¼ˆé»˜è®¤æ˜¯ <code>index.html</code>ï¼‰ã€‚Vite ä¼šè¯»å–æ ¹ç›®å½•çš„ <code>index.html</code>ï¼Œå¹¶å¯¹å…¶ä¸­çš„ <code>script</code> æ ‡ç­¾è¿›è¡Œæ”¹é€ ï¼šå°†æŒ‡å‘æºç çš„ <code>src</code> è·¯å¾„æ”¹ä¸ºæœåŠ¡å™¨å¯è¯†åˆ«çš„ç»å¯¹è·¯å¾„ï¼Œç¡®ä¿æœªæ·»åŠ  <code>type="module"</code> æ ‡è¯†æ—¶è‡ªåŠ¨è¡¥å……ï¼ˆå› åŸç”Ÿ ESM éœ€è¯¥æ ‡è¯†æ‰èƒ½è¢«æµè§ˆå™¨è§£æï¼‰ï¼ŒåŒæ—¶æ³¨å…¥çƒ­æ›´æ–°ç›¸å…³çš„å®¢æˆ·ç«¯è„šæœ¬ï¼ˆ<code>/@vite/client</code>ï¼‰ï¼Œä¸ºåç»­ HMR åŠŸèƒ½åšå‡†å¤‡ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼šé¡¹ç›®æ ¹ç›®å½•åŸå§‹ <code>index.html</code> å†…å®¹ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"icon"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/svg+xml"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/vite.svg"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Vite + Vue + TS<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/src/main.ts"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><strong>ç¤ºä¾‹</strong>ï¼šVite å¤„ç†åè¿”å›ç»™æµè§ˆå™¨çš„ HTML å†…å®¹ï¼ˆå…³é”®æ”¹é€ å¤„æ ‡çº¢ï¼‰ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"icon"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/svg+xml"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/vite.svg"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Vite + Vue + TS<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/@vite/client"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/src/main.ts"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h5 data-id="heading-14">æ­¥éª¤ 8ï¼šç¼–è¯‘å…¥å£æ¨¡å—å¹¶å¤„ç†ä¾èµ–è·¯å¾„</h5>
<p>å½“æµè§ˆå™¨é€šè¿‡å¤„ç†åçš„ <code>index.html</code> å‘èµ·å…¥å£æ¨¡å—è¯·æ±‚ï¼ˆå¦‚ <code>/src/main.ts</code>ï¼‰æ—¶ï¼ŒVite çš„æ¨¡å—ç¼–è¯‘ä¸­é—´ä»¶ä¼šæ‹¦æˆªè¯¥è¯·æ±‚ï¼ŒæŒ‰â€œç±»å‹è¯†åˆ«â†’è¯­æ³•è½¬è¯‘â†’è·¯å¾„é‡å†™â†’è¿”å›ç»“æœâ€çš„å®Œæ•´æµç¨‹å¤„ç†ï¼Œæ ¸å¿ƒä¾æ‰˜ <code>esbuild</code> å®ç°æ¯«ç§’çº§ç¼–è¯‘ã€‚</p>
<h6 data-id="heading-15">1. æ¨¡å—ç±»å‹è¯†åˆ«ä¸å¤„ç†é€»è¾‘åŒ¹é…</h6>
<p>Vite é€šè¿‡è¯·æ±‚è·¯å¾„çš„åç¼€ï¼ˆå¦‚ <code>.ts</code>ï¼‰å¿«é€Ÿè¯†åˆ«æ¨¡å—ç±»å‹ï¼Œè‡ªåŠ¨åŒ¹é…é¢„è®¾å¤„ç†é€»è¾‘ï¼šTypeScript æ¨¡å—é»˜è®¤ä½¿ç”¨å†…ç½® <code>esbuild</code> è½¬è¯‘å™¨ï¼ŒVue ç»„ä»¶ä¾èµ– <code>@vitejs/plugin-vue</code>ï¼Œæ ·å¼æ–‡ä»¶åˆ™æ ¹æ®åç¼€åŒ¹é… Sass/LESS ç­‰é¢„å¤„ç†æ’ä»¶ï¼ˆè‹¥å·²é…ç½®ï¼‰ã€‚</p>
<h6 data-id="heading-16">2. è¯­æ³•è½¬è¯‘ä¸ä¾èµ–è·¯å¾„é‡å†™</h6>
<p>è¿™æ˜¯å…¥å£æ¨¡å—ç¼–è¯‘çš„æ ¸å¿ƒç¯èŠ‚ï¼Œé’ˆå¯¹ TypeScript æ¨¡å—ä¸»è¦å®Œæˆä¸¤é¡¹å·¥ä½œï¼š</p>
<ul>
<li>
<p><strong>è¯­æ³•è½¬è¯‘</strong>ï¼š<code>esbuild</code> ä»…å¯¹ TypeScript è¿›è¡Œè¯­æ³•å±‚é¢è½¬è¯‘ï¼Œå‰”é™¤ç±»å‹æ³¨è§£ã€æ¥å£å®šä¹‰ç­‰ TS ç‰¹æœ‰è¯­æ³•ï¼Œä¿ç•™ ES6+ è¯­æ³•ï¼ˆç°ä»£æµè§ˆå™¨å·²åŸç”Ÿæ”¯æŒï¼‰ï¼Œä¸æ‰§è¡Œç±»å‹æ£€æŸ¥ï¼ˆç±»å‹æ ¡éªŒäº¤ç»™ IDE æˆ– <code>tsc --noEmit</code> å•ç‹¬æ‰§è¡Œï¼Œæå‡ç¼–è¯‘é€Ÿåº¦ï¼‰ï¼›</p>
</li>
<li>
<p><strong>ä¾èµ–è·¯å¾„é‡å†™</strong>ï¼šå°†æºç ä¸­ç¬¬ä¸‰æ–¹ä¾èµ–çš„ç®€æ´è·¯å¾„ï¼ˆå¦‚ <code>import { createApp } from 'vue'</code>ï¼‰é‡å†™ä¸ºé¢„æ„å»ºäº§ç‰©çš„ç»å¯¹è·¯å¾„ï¼ˆå¦‚ <code>/node_modules/.vite/vue.js?v=1a2b3c</code>ï¼‰ï¼Œæ—¢é¿å…æµè§ˆå™¨ç›´æ¥è®¿é—® <code>node_modules</code> ç›®å½•çš„æƒé™é—®é¢˜ï¼Œåˆé€šè¿‡ <code>v=1a2b3c</code> è¿™ç±»ç¼“å­˜æ ‡è¯†å®ç°åç»­æ›´æ–°çš„ç¼“å­˜å¤±æ•ˆæ§åˆ¶ã€‚</p>
</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼šmain.ts ç¼–è¯‘å‰åå¯¹æ¯”</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ç¼–è¯‘å‰ï¼ˆé¡¹ç›®æºç ï¼šsrc/main.tsï¼‰</span>
<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./style.css'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>

<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>).<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)

<span class="hljs-comment">// ç¼–è¯‘åï¼ˆVite è¿”å›ç»™æµè§ˆå™¨çš„ ESM ä»£ç ï¼‰</span>
<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'/node_modules/.vite/vue.js?v=1a2b3c'</span> <span class="hljs-comment">// é‡å†™é¢„æ„å»ºäº§ç‰©è·¯å¾„</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./style.css'</span> <span class="hljs-comment">// ç›¸å¯¹è·¯å¾„ä¿ç•™ï¼Œå°†è§¦å‘åç»­æ ·å¼è¯·æ±‚</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span> <span class="hljs-comment">// Vue ç»„ä»¶è·¯å¾„ï¼Œå°†è§¦å‘åç»­ç»„ä»¶è¯·æ±‚</span>

<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>).<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<h6 data-id="heading-17">3. ç»“æœè¿”å›ä¸ä¾èµ–è¯·æ±‚è§¦å‘</h6>
<p>Vite å°†ç¼–è¯‘åçš„ ESM ä»£ç é€šè¿‡ HTTP å“åº”è¿”å›ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨è§£æè¯¥ä»£ç æ—¶ï¼Œä¼šç«‹å³è¯†åˆ«åˆ° <code>./style.css</code> å’Œ <code>./App.vue</code> ä¸¤ä¸ªæœªåŠ è½½çš„ä¾èµ–ï¼Œè‡ªåŠ¨å‘ Vite æœåŠ¡å™¨å‘èµ·æ–°çš„è¯·æ±‚ï¼Œç”±æ­¤è¿›å…¥ä¾èµ–æ¨¡å—çš„é€’å½’ç¼–è¯‘æµç¨‹ã€‚</p>
<h5 data-id="heading-18">æ­¥éª¤ 9ï¼šé€’å½’ç¼–è¯‘ä¾èµ–æ¨¡å—ï¼ˆæŒ‰éœ€ç¼–è¯‘æ ¸å¿ƒä½“ç°ï¼‰</h5>
<p>Vite çš„â€œæŒ‰éœ€ç¼–è¯‘â€æ ¸å¿ƒå°±ä½“ç°åœ¨é€’å½’å¤„ç†ä¾èµ–è¯·æ±‚çš„è¿‡ç¨‹ä¸­â€”â€”ä»…å½“æµè§ˆå™¨è¯·æ±‚æŸä¸ªä¾èµ–æ—¶æ‰å¯¹å…¶ç¼–è¯‘ï¼Œè€Œéå¯åŠ¨æ—¶å…¨é‡ç¼–è¯‘æ‰€æœ‰æ–‡ä»¶ã€‚ä»¥ä¸‹é’ˆå¯¹å‰ç«¯é¡¹ç›®ä¸­æœ€å¸¸è§çš„ä¸¤ç±»ä¾èµ–æ¨¡å—ï¼Œè¯¦ç»†è¯´æ˜ç¼–è¯‘æµç¨‹ï¼š</p>
<h6 data-id="heading-19">1. Vue å•æ–‡ä»¶ç»„ä»¶ï¼ˆSFCï¼‰ç¼–è¯‘ï¼ˆä»¥ App.vue ä¸ºä¾‹ï¼‰</h6>
<p>å½“æµè§ˆå™¨è¯·æ±‚ <code>/src/App.vue</code> æ—¶ï¼Œ<code>@vitejs/plugin-vue</code> æ’ä»¶ä¼šä¸»å¯¼ç¼–è¯‘è¿‡ç¨‹ï¼Œå°† SFC æ‹†åˆ†ä¸ºæ¨¡æ¿ã€è„šæœ¬ã€æ ·å¼ä¸‰éƒ¨åˆ†åˆ†åˆ«å¤„ç†åå†ç»„åˆä¸º ESM æ¨¡å—ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- ç¼–è¯‘å‰ï¼ˆé¡¹ç›®æºç ï¼šsrc/App.vueï¼‰ --&gt;
&lt;script setup lang="ts"&gt;
import HelloWorld from './components/HelloWorld.vue'
&lt;/script&gt;

&lt;template&gt;
  &lt;div class="app"&gt;
    &lt;HelloWorld msg="Hello Vite + Vue" /&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;style scoped&gt;
.app {
  text-align: center;
  padding: 2rem;
  background: #f5f5f5;
}
&lt;/style&gt;
</code></pre>
<p><strong>ç¼–è¯‘æ ¸å¿ƒæ­¥éª¤</strong>ï¼š</p>
<ol>
<li>
<p><strong>æ¨¡æ¿ç¼–è¯‘</strong>ï¼šå°†<code>&lt;template&gt;</code>æ ‡ç­¾ä¸­çš„HTMLç»“æ„è½¬ä¸ºVueå¯æ‰§è¡Œçš„æ¸²æŸ“å‡½æ•°ï¼ˆrenderå‡½æ•°ï¼‰ï¼Œä¾‹å¦‚ä¸Šè¿°æ¨¡æ¿ä¼šè½¬ä¸º<code>() =&gt; h('div', { class: 'app' }, [h(HelloWorld, { msg: 'Hello Vite + Vue' })])</code>ï¼›</p>
</li>
<li>
<p><strong>è„šæœ¬ç¼–è¯‘</strong>ï¼šå¯¹<code>&lt;script setup lang="ts"&gt;</code>è¯­æ³•ç³–è¿›è¡Œè§£ç³–å¤„ç†ï¼Œè½¬ä¸ºæ™®é€šESMå¯¼å‡ºæ ¼å¼ï¼ŒåŒæ—¶é‡å†™HelloWorldç»„ä»¶çš„å¼•å…¥è·¯å¾„ï¼›</p>
</li>
<li>
<p><strong>æ ·å¼ç¼–è¯‘</strong>ï¼šä¸º<code>&lt;style scoped&gt;</code>ä¸­çš„æ ·å¼è§„åˆ™æ·»åŠ ä½œç”¨åŸŸå“ˆå¸Œï¼ˆå¦‚.appè½¬ä¸º.app_123abcï¼‰ï¼Œé¿å…ç»„ä»¶é—´æ ·å¼æ±¡æŸ“ï¼ŒåŒæ—¶ç”Ÿæˆç‹¬ç«‹çš„æ ·å¼è¯·æ±‚è·¯å¾„ï¼ˆå¦‚<code>/src/App.vue?v=1a2b3c&amp;type=style&amp;scoped</code>ï¼‰ï¼›</p>
</li>
<li>
<p><strong>ç»„åˆå¯¼å‡º</strong>ï¼šå°†ç¼–è¯‘åçš„æ¨¡æ¿ï¼ˆæ¸²æŸ“å‡½æ•°ï¼‰ã€è„šæœ¬ï¼ˆç»„ä»¶é€»è¾‘ï¼‰ã€æ ·å¼ï¼ˆè¯·æ±‚è·¯å¾„ï¼‰æ•´åˆä¸ºä¸€ä¸ªESMæ¨¡å—ï¼Œè¿”å›ç»™æµè§ˆå™¨å¹¶è§¦å‘<code>HelloWorld.vue</code>å’Œæ ·å¼æ–‡ä»¶çš„åç»­è¯·æ±‚ã€‚</p>
</li>
</ol>
<p><strong>ç¼–è¯‘åç®€åŒ–ä»£ç </strong> <strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-comment">// å¯¼å…¥é¢„æ„å»ºä¾èµ–å’Œå­ç»„ä»¶</span>
<span class="hljs-keyword">import</span> { defineComponent, h } <span class="hljs-keyword">from</span> <span class="hljs-string">'/node_modules/.vite/vue.js?v=1a2b3c'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">HelloWorld</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/HelloWorld.vue'</span>
<span class="hljs-comment">// å¼•å…¥ç¼–è¯‘åçš„ä½œç”¨åŸŸæ ·å¼</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'/src/App.vue?v=1a2b3c&amp;type=style&amp;scoped'</span>

<span class="hljs-comment">// æ¨¡æ¿è½¬è¯‘åçš„æ¸²æŸ“å‡½æ•°</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">render</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-title function_">h</span>(<span class="hljs-string">'div'</span>, { <span class="hljs-attr">class</span>: <span class="hljs-string">'app_123abc'</span> }, [
  <span class="hljs-title function_">h</span>(<span class="hljs-title class_">HelloWorld</span>, { <span class="hljs-attr">msg</span>: <span class="hljs-string">'Hello Vite + Vue'</span> })
])

<span class="hljs-comment">// ç»„åˆä¸º Vue ç»„ä»¶å¹¶å¯¼å‡º</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineComponent</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'App'</span>,
  <span class="hljs-attr">components</span>: { <span class="hljs-title class_">HelloWorld</span> },
  render
})
</code></pre>
<h6 data-id="heading-20">2. æ ·å¼æ–‡ä»¶ç¼–è¯‘ï¼ˆä»¥ style.css ä¸ºä¾‹ï¼‰</h6>
<p>å½“æµè§ˆå™¨è¯·æ±‚æ ·å¼æ–‡ä»¶æ—¶ï¼ŒVite ä¼šæ ¹æ®æ–‡ä»¶ç±»å‹æ‰§è¡Œå¯¹åº”å¤„ç†ï¼Œæ™®é€š CSS å’Œ SCSS/LESS ç­‰é¢„å¤„ç†æ–‡ä»¶çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>è‹¥ä¸ºæ™®é€šCSSæ–‡ä»¶ï¼Œç›´æ¥è¯»å–æ–‡ä»¶å†…å®¹ï¼Œæ·»åŠ å¿…è¦çš„æµè§ˆå™¨å‰ç¼€ï¼ˆè‹¥é…ç½®autoprefixerï¼‰åè¿”å›ï¼›</p>
</li>
<li>
<p>è‹¥ä¸ºSass/LESSç­‰é¢„å¤„ç†æ–‡ä»¶ï¼Œå…ˆå®‰è£…å¯¹åº”æ’ä»¶ï¼ˆå¦‚SCSSéœ€å®‰è£…<code>sass</code>å’Œ<code>vite-plugin-sass</code>ï¼‰ï¼Œæ’ä»¶ä¼šå°†é¢„å¤„ç†è¯­æ³•ç¼–è¯‘ä¸ºæ™®é€šCSSåè¿”å›ï¼›</p>
</li>
<li>
<p>æœ€ç»ˆæµè§ˆå™¨ä¼šå°†è¿”å›çš„CSSå†…å®¹é€šè¿‡<code>&lt;style&gt;</code>æ ‡ç­¾æ³¨å…¥é¡µé¢ï¼Œæ— éœ€åƒä¼ ç»Ÿæ„å»ºå·¥å…·é‚£æ ·æ‰“åŒ…ä¸ºå•ç‹¬çš„CSSæ–‡ä»¶ã€‚</p>
</li>
</ul>
<p><strong>ç¤ºä¾‹1ï¼šæ™®é€šCSSæ–‡ä»¶ç¼–è¯‘ä¸æ³¨å…¥</strong></p>
<pre><code class="hljs language-css" lang="css">// ç¼–è¯‘å‰ï¼ˆé¡¹ç›®æºç ï¼š<span class="hljs-attribute">src</span>/style<span class="hljs-selector-class">.css</span>ï¼‰
<span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Inter'</span>, sans-serif;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
}

// ç¼–è¯‘åè¿”å›çš„ CSS å†…å®¹
<span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Inter'</span>, sans-serif;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
}

// æµè§ˆå™¨è‡ªåŠ¨æ³¨å…¥é¡µé¢çš„ DOM ç»“æ„
&lt;style&gt;
<span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Inter'</span>, sans-serif;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
}
&lt;/style&gt;
</code></pre>
<p><strong>ç¤ºä¾‹2ï¼šSCSSæ–‡ä»¶ç¼–è¯‘ä¸æ³¨å…¥ï¼ˆéœ€æå‰é…ç½®ï¼‰</strong></p>
<p>é¦–å…ˆéœ€å®‰è£…ä¾èµ–ï¼š<code>npm install sass vite-plugin-sass --save-dev</code>ï¼Œå¹¶åœ¨<code>vite.config.ts</code>ä¸­é…ç½®æ’ä»¶ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>;
<span class="hljs-keyword">import</span> sass <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-sass'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vue</span>(), <span class="hljs-title function_">sass</span>()]
});
</code></pre>
<p>SCSSæ–‡ä»¶ç¼–è¯‘æµç¨‹ï¼š</p>
<pre><code class="hljs language-css" lang="css">// ç¼–è¯‘å‰ï¼ˆé¡¹ç›®æºç ï¼š<span class="hljs-attribute">src</span>/style<span class="hljs-selector-class">.scss</span>ï¼Œå«å˜é‡å’ŒåµŒå¥—è¯­æ³•ï¼‰
$primary-<span class="hljs-attribute">color</span>: <span class="hljs-number">#42b983</span>;
$<span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;

<span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Inter'</span>, sans-serif;
  <span class="hljs-attribute">font-size</span>: $font-size;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;

  <span class="hljs-selector-class">.app-container</span> {
    <span class="hljs-attribute">background</span>: $primary-color;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">2rem</span>;
  }
}

// ç¼–è¯‘åè¿”å›çš„ CSS å†…å®¹ï¼ˆé¢„å¤„ç†è¯­æ³•è§£æå®Œæˆï¼‰
<span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Inter'</span>, sans-serif;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
}
<span class="hljs-selector-tag">body</span> <span class="hljs-selector-class">.app-container</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#42b983</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">2rem</span>;
}

// æµè§ˆå™¨è‡ªåŠ¨æ³¨å…¥é¡µé¢çš„ DOM ç»“æ„
&lt;style&gt;
<span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Inter'</span>, sans-serif;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
}
<span class="hljs-selector-tag">body</span> <span class="hljs-selector-class">.app-container</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#42b983</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">2rem</span>;
}
&lt;/style&gt;
</code></pre>
<h5 data-id="heading-21">æ­¥éª¤ 10ï¼šæ‰€æœ‰æ¨¡å—åŠ è½½å®Œæˆå¹¶æ¸²æŸ“é¡µé¢</h5>
<p>éšç€ä¾èµ–æ¨¡å—çš„é€’å½’ç¼–è¯‘å’ŒåŠ è½½ï¼Œæµè§ˆå™¨ä¼šé€æ­¥è·å–é¡µé¢æ¸²æŸ“æ‰€éœ€çš„å…¨éƒ¨èµ„æºï¼ˆTS/JS æ¨¡å—ã€Vue ç»„ä»¶ã€æ ·å¼æ–‡ä»¶ã€é™æ€èµ„æºç­‰ï¼‰ï¼Œæœ€ç»ˆæ‰§è¡Œå…¥å£æ¨¡å—çš„æ¸²æŸ“é€»è¾‘ï¼Œå®Œæˆé¡µé¢æ„å»ºã€‚æ•´ä¸ªæµç¨‹çš„æ”¶å°¾ç¯èŠ‚å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p><strong>åº”ç”¨å®ä¾‹åŒ–</strong>ï¼šæµè§ˆå™¨æ‰§è¡Œå…¥å£æ¨¡å—ä¸­çš„<code>createApp(App).mount('#app')</code>ä»£ç ï¼ŒåŸºäºç¼–è¯‘åçš„Vueæ ¹ç»„ä»¶Appåˆ›å»ºåº”ç”¨å®ä¾‹ï¼›</p>
</li>
<li>
<p><strong>è™šæ‹ŸDOMæŒ‚è½½</strong>ï¼šVueæ¡†æ¶é€šè¿‡ç»„ä»¶çš„æ¸²æŸ“å‡½æ•°ç”Ÿæˆè™šæ‹ŸDOMï¼Œå†å°†è™šæ‹ŸDOMè½¬æ¢ä¸ºçœŸå®DOMå¹¶æŒ‚è½½åˆ°é¡µé¢çš„#appèŠ‚ç‚¹ï¼›</p>
</li>
<li>
<p><strong>èµ„æºå…¨å±€å°±ç»ª</strong>ï¼šæ‰€æœ‰æ ·å¼é€šè¿‡<code>&lt;style&gt;</code>æ ‡ç­¾æ³¨å…¥ç”Ÿæ•ˆï¼Œå›¾ç‰‡ã€å­—ä½“ç­‰é™æ€èµ„æºé€šè¿‡ç›´æ¥è¯·æ±‚åŠ è½½å®Œæˆï¼Œé¡µé¢å‘ˆç°æœ€ç»ˆæ•ˆæœï¼›</p>
</li>
<li>
<p><strong>HMRå®¢æˆ·ç«¯åˆå§‹åŒ–</strong>ï¼šæ­¤å‰æ³¨å…¥çš„<code>/@vite/client</code>è„šæœ¬å®Œæˆåˆå§‹åŒ–ï¼Œé€šè¿‡WebSocketä¸Viteå¼€å‘æœåŠ¡å™¨å»ºç«‹é•¿è¿æ¥ï¼Œéšæ—¶ç­‰å¾…åç»­ä»£ç æ›´æ–°çš„é€šçŸ¥ã€‚</p>
</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼šå¯åŠ¨å®Œæˆçš„æ ‡è¯†</strong>ï¼š</p>
<ul>
<li>
<p>æµè§ˆå™¨æ§åˆ¶å°ä¼šè¾“å‡º Vite HMR å®¢æˆ·ç«¯çš„åˆå§‹åŒ–æ—¥å¿—ï¼š<code>[vite] connected.</code>ï¼›</p>
</li>
<li>
<p>ç»ˆç«¯ä¼šæ˜¾ç¤ºæµè§ˆå™¨è¿æ¥æˆåŠŸçš„æç¤ºï¼š<code>âœ  Local:   http://localhost:5173/</code>ï¼Œæ­¤æ—¶å¼€å‘ç¯å¢ƒæ­£å¼å°±ç»ªï¼Œæ”¯æŒä»£ç çƒ­æ›´æ–°ã€‚</p>
</li>
</ul>
<h3 data-id="heading-22">ä¸‰ã€ä»£ç æ›´æ–°æµç¨‹ï¼ˆçƒ­æ¨¡å—æ›¿æ¢ HMRï¼‰</h3>
<p>é¦–æ¬¡å¯åŠ¨åï¼Œå¼€å‘è€…ä¿®æ”¹ä»£ç æ—¶ï¼ŒVite ä¸ä¼šé‡å¯å¼€å‘æœåŠ¡å™¨æˆ–åˆ·æ–°æ•´ä¸ªé¡µé¢ï¼Œè€Œæ˜¯é€šè¿‡ã€Œçƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰ã€æœºåˆ¶ä»…æ›´æ–°ä¿®æ”¹çš„æ¨¡å—ï¼Œå®ç°æ¯«ç§’çº§æ›´æ–°å“åº”ã€‚å…¶æ ¸å¿ƒåŸç†æ˜¯é€šè¿‡ WebSocket å»ºç«‹æœåŠ¡å™¨ä¸æµè§ˆå™¨çš„é•¿è¿æ¥ï¼Œå®æ—¶æ¨é€æ¨¡å—å˜æ›´ä¿¡æ¯ï¼Œé¿å…å…¨é¡µåˆ·æ–°å¯¼è‡´çš„å¼€å‘çŠ¶æ€ä¸¢å¤±ã€‚</p>
<p>ä»¥ä¸‹å°†ä¿®æ”¹ <code>src/components/HelloWorld.vue</code> ä¸­çš„æ–‡æœ¬å†…å®¹ï¼ˆå°† <code>msg</code> å±æ€§å€¼ä» <code>Hello Vite + Vue</code> æ”¹ä¸º <code>Hello Vite 5.x + Vue 3</code>ï¼‰ä¸ºä¾‹</p>
<ol>
<li>ï¼ˆä¿®æ”¹å‰ï¼‰</li>
</ol>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
  const msg = 'Hello Vite + Vue';
&lt;/script&gt;

&lt;template&gt;
  &lt;h1&gt;{{ msg }}&lt;/h1&gt; 
&lt;/template&gt;
</code></pre>
<ol start="2">
<li>ä¿®æ”¹ç»„ä»¶çš„msgå€¼ï¼ˆè§¦å‘çƒ­æ›´æ–°ï¼‰</li>
</ol>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
    // msgå€¼ä¿®æ”¹ä¸ºæ–°å†…å®¹
    const msg = 'Hello Vite 5.x + Vue 3';
&lt;/script&gt;

&lt;template&gt;
  &lt;h1&gt;{{ msg }}&lt;/h1&gt; 
&lt;/template&gt;
</code></pre>
<p>æ‹†è§£ä»£ç æ›´æ–°çš„ 5 ä¸ªå…³é”®æ­¥éª¤ï¼š</p>
<h5 data-id="heading-23">æ­¥éª¤ 1ï¼šæ–‡ä»¶å˜æ›´ç›‘å¬</h5>
<p>Vite å¯åŠ¨åä¼šé€šè¿‡ <code>chokidar</code> åº“ï¼ˆé«˜æ•ˆçš„æ–‡ä»¶ç›‘å¬å·¥å…·ï¼‰å®æ—¶ç›‘å¬é¡¹ç›®æºç ç›®å½•ï¼ˆé»˜è®¤æ˜¯ <code>src</code> ç›®å½•ï¼‰çš„æ–‡ä»¶å˜åŒ–ï¼ŒåŒ…æ‹¬æ–‡ä»¶çš„ä¿®æ”¹ã€æ–°å¢ã€åˆ é™¤ä»¥åŠé‡å‘½åç­‰æ“ä½œã€‚å½“å¼€å‘è€…ä¿®æ”¹ <code>HelloWorld.vue</code> å¹¶ä¿å­˜åï¼Œ<code>chokidar</code> ä¼šç«‹å³æ•è·åˆ°è¯¥æ–‡ä»¶çš„ä¿®æ”¹äº‹ä»¶ï¼Œå¹¶å°†æ–‡ä»¶è·¯å¾„ç­‰ä¿¡æ¯ä¼ é€’ç»™ Vite æ ¸å¿ƒå¤„ç†é€»è¾‘ã€‚</p>
<h5 data-id="heading-24">æ­¥éª¤ 2ï¼šå˜æ›´æ¨¡å—å®šä½ä¸é‡æ–°ç¼–è¯‘</h5>
<p>Vite æ”¶åˆ°æ–‡ä»¶å˜æ›´äº‹ä»¶åï¼Œä¼šæ ¹æ®æ–‡ä»¶è·¯å¾„å¿«é€Ÿå®šä½åˆ°å¯¹åº”çš„æ¨¡å—ï¼ˆå³ <code>HelloWorld.vue</code>ï¼‰ï¼Œå¹¶è§¦å‘è¯¥æ¨¡å—çš„é‡æ–°ç¼–è¯‘æµç¨‹ã€‚é‡æ–°ç¼–è¯‘çš„é€»è¾‘ä¸é¦–æ¬¡å¯åŠ¨æ—¶çš„æ¨¡å—ç¼–è¯‘å®Œå…¨ä¸€è‡´ï¼šå¯¹äº Vue ç»„ä»¶ï¼Œ<code>@vitejs/plugin-vue</code> ä¼šé‡æ–°æ‹†è§£ SFC å¹¶ç¼–è¯‘æ¨¡æ¿ã€è„šæœ¬ã€æ ·å¼ï¼›å¯¹äº TypeScript æˆ–æ ·å¼æ–‡ä»¶ï¼Œä¹Ÿä¼šæ‰§è¡Œä¸é¦–æ¬¡ç¼–è¯‘ç›¸åŒçš„è½¬è¯‘å’Œå¤„ç†é€»è¾‘ï¼Œç¡®ä¿è¾“å‡ºçš„æ¨¡å—ä»£ç ä¸å½“å‰æºç ä¸€è‡´ã€‚</p>
<p><strong>ç¤º</strong> <strong>ä¾‹</strong>ï¼šé‡æ–°ç¼–è¯‘ <code>HelloWorld.vue</code> åï¼Œæ¨¡æ¿ä¸­çš„ <code>msg</code> å†…å®¹ä¼šæ›´æ–°ä¸º <code>Hello Vite 5.x + Vue 3</code>ï¼Œå¯¹åº”çš„æ¸²æŸ“å‡½æ•°ä¹Ÿä¼šåŒæ­¥ä¿®æ”¹ã€‚</p>
<h5 data-id="heading-25">æ­¥éª¤ 3ï¼šç”Ÿæˆæ¨¡å—å˜æ›´æ ‡è¯†ï¼ˆhashï¼‰</h5>
<p>ä¸ºäº†è®©æµè§ˆå™¨èƒ½å¤Ÿå‡†ç¡®è¯†åˆ«æ¨¡å—æ˜¯å¦å‘ç”Ÿæ›´æ–°ï¼ŒVite ä¼šä¸ºé‡æ–°ç¼–è¯‘åçš„æ¨¡å—ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„å“ˆå¸Œï¼ˆhashï¼‰æ ‡è¯†ã€‚è¯¥å“ˆå¸Œå€¼åŸºäºæ¨¡å—çš„å†…å®¹è®¡ç®—å¾—å‡ºï¼Œåªè¦æ¨¡å—å†…å®¹å‘ç”Ÿå˜åŒ–ï¼Œå“ˆå¸Œå€¼å°±ä¼šéšä¹‹æ”¹å˜ã€‚åŒæ—¶ï¼ŒVite ä¼šæ›´æ–°å†…å­˜ä¸­çš„æ¨¡å—æ˜ å°„è¡¨ï¼Œå°†æ–°çš„å“ˆå¸Œå€¼ä¸æ¨¡å—è·¯å¾„å…³è”ï¼Œä¾¿äºåç»­æµè§ˆå™¨è¯·æ±‚æ—¶çš„èº«ä»½æ ¡éªŒã€‚</p>
<p><strong>ç¤º</strong> <strong>ä¾‹</strong>ï¼šä¿®æ”¹åçš„ <code>HelloWorld.vue</code> å¯¹åº”çš„è¯·æ±‚è·¯å¾„ä¼šå˜ä¸º <code>/src/components/HelloWorld.vue?hash=abc123</code>ï¼Œå…¶ä¸­ <code>abc123</code> å°±æ˜¯æ–°çš„å“ˆå¸Œæ ‡è¯†ã€‚</p>
<h5 data-id="heading-26">æ­¥éª¤ 4ï¼šWebSocket æ¨é€å˜æ›´é€šçŸ¥</h5>
<p>Vite å¼€å‘æœåŠ¡å™¨é€šè¿‡ WebSocket é•¿è¿æ¥å‘æµè§ˆå™¨ç«¯çš„ HMR å®¢æˆ·ç«¯æ¨é€æ¨¡å—å˜æ›´é€šçŸ¥ã€‚é€šçŸ¥ä¿¡æ¯æ˜¯ä¸€ä¸ªç»“æ„åŒ–çš„ JSON æ•°æ®ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹æ ¸å¿ƒå­—æ®µï¼š</p>
<ul>
<li>
<p><code>type</code>ï¼šæ›´æ–°ç±»å‹ï¼Œå¦‚ <code>update</code> è¡¨ç¤ºæ¨¡å—æ›´æ–°ã€<code>delete</code> è¡¨ç¤ºæ¨¡å—åˆ é™¤ï¼›</p>
</li>
<li>
<p><code>updates</code>ï¼šå˜æ›´æ¨¡å—åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ åŒ…å«æ¨¡å—è·¯å¾„ï¼ˆ<code>path</code>ï¼‰ã€æ–°å“ˆå¸Œå€¼ï¼ˆ<code>hash</code>ï¼‰ä»¥åŠå¯æ¥å—æ›´æ–°çš„æ¨¡å—è·¯å¾„ï¼ˆ<code>acceptedPath</code>ï¼‰ç­‰ä¿¡æ¯ã€‚</p>
</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼šæ¨é€çš„å˜æ›´é€šçŸ¥æ•°æ®ï¼ˆç®€åŒ–ç‰ˆï¼‰</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"update"</span>,
  <span class="hljs-string">"updates"</span>: [
    {
      <span class="hljs-string">"path"</span>: <span class="hljs-string">"/src/components/HelloWorld.vue"</span>,
      <span class="hljs-string">"hash"</span>: <span class="hljs-string">"abc123"</span>,
      <span class="hljs-string">"acceptedPath"</span>: <span class="hljs-string">"/src/components/HelloWorld.vue"</span>,
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"js"</span>
    }
  ]
}
</code></pre>
<h5 data-id="heading-27">æ­¥éª¤ 5ï¼šæµè§ˆå™¨æ‰§è¡Œçƒ­æ›¿æ¢é€»è¾‘</h5>
<p>æµè§ˆå™¨ç«¯çš„ Vite HMR å®¢æˆ·ç«¯ï¼ˆå³ <code>/@vite/client</code> è„šæœ¬ï¼‰æ”¶åˆ° WebSocket æ¨é€çš„å˜æ›´é€šçŸ¥åï¼Œä¼šæŒ‰ä»¥ä¸‹æµç¨‹æ‰§è¡Œçƒ­æ¨¡å—æ›¿æ¢ï¼š</p>
<ol>
<li>
<p><strong>è¯·æ±‚æ–°æ¨¡å—ä»£ç </strong>ï¼šæ ¹æ®é€šçŸ¥ä¸­çš„æ¨¡å—è·¯å¾„å’Œæ–°å“ˆå¸Œå€¼ï¼Œå‘ Vite æœåŠ¡å™¨å‘èµ·æ–°æ¨¡å—çš„è¯·æ±‚ï¼ˆå¦‚ <code>GET /src/components/HelloWorld.vue?hash=abc123</code>ï¼‰ï¼Œè·å–é‡æ–°ç¼–è¯‘åçš„æ¨¡å—ä»£ç ï¼›</p>
</li>
<li>
<p><strong>æ¨¡å—æ›¿æ¢ä¸çŠ¶æ€ä¿ç•™</strong>ï¼šç”±å¯¹åº”çš„æ¡†æ¶æ’ä»¶ï¼ˆå¦‚ <code>@vitejs/plugin-vue</code>ï¼‰æä¾›çƒ­æ›¿æ¢é€»è¾‘ï¼Œå°†é¡µé¢ä¸­çš„æ—§æ¨¡å—å®ä¾‹æ›¿æ¢ä¸ºæ–°æ¨¡å—å®ä¾‹ã€‚å¯¹äº Vue ç»„ä»¶ï¼Œä¼šé”€æ¯æ—§çš„ç»„ä»¶å®ä¾‹ï¼Œåˆ›å»ºæ–°çš„ç»„ä»¶å®ä¾‹å¹¶é‡æ–°æ¸²æŸ“å¯¹åº”çš„ DOM èŠ‚ç‚¹ï¼ŒåŒæ—¶å°½å¯èƒ½ä¿ç•™ç»„ä»¶çš„å±€éƒ¨çŠ¶æ€ï¼ˆå¦‚è¾“å…¥æ¡†ä¸­çš„å†…å®¹ï¼‰ï¼›</p>
</li>
<li>
<p><strong>å¤±è´¥é™çº§å¤„ç†</strong>ï¼šè‹¥æ¨¡å—æ›¿æ¢å¤±è´¥ï¼ˆå¦‚ä¿®æ”¹äº†å…¥å£æ–‡ä»¶ <code>main.ts</code> è¿™ç±»æ— æ³•å•ç‹¬çƒ­æ›´æ–°çš„æ¨¡å—ï¼Œæˆ–æ’ä»¶æœªæä¾›å¯¹åº”çš„çƒ­æ›¿æ¢é€»è¾‘ï¼‰ï¼ŒHMR å®¢æˆ·ç«¯ä¼šè‡ªåŠ¨é™çº§ä¸ºå…¨é¡µåˆ·æ–°ï¼Œç¡®ä¿é¡µé¢å†…å®¹ä¸æºç ä¸€è‡´ã€‚</p>
</li>
</ol>
<p><strong>ç¤º</strong> <strong>ä¾‹</strong>ï¼šæµè§ˆå™¨è·å–æ–°çš„ <code>HelloWorld.vue</code> æ¨¡å—åï¼Œ<code>@vitejs/plugin-vue</code> çš„çƒ­æ›¿æ¢é€»è¾‘ä¼šä»…é‡æ¸²æŸ“ <code>HelloWorld</code> ç»„ä»¶å¯¹åº”çš„ DOM èŠ‚ç‚¹ï¼Œé¡µé¢ä¸Šçš„æ–‡æœ¬ä¼šä» <code>Hello Vite + Vue</code> å˜ä¸º <code>Hello Vite 5.x + Vue 3</code>ï¼Œè€Œé¡µé¢ä¸­å…¶ä»–ç»„ä»¶çš„çŠ¶æ€ï¼ˆå¦‚é¡¶éƒ¨å¯¼èˆªæ çš„é€‰ä¸­çŠ¶æ€ã€è¾“å…¥æ¡†ä¸­çš„å†…å®¹ï¼‰ä¸ä¼šå—åˆ°ä»»ä½•å½±å“ã€‚</p>
<h3 data-id="heading-28">å››ã€Vite 5.x å¼€å‘æ¨¡å¼å…³é”®ä¼˜åŒ–ç‚¹æ€»ç»“</h3>
<p>Vite 5.x å¼€å‘æ¨¡å¼çš„æé€Ÿä½“éªŒå¾—ç›Šäºå…¶åº•å±‚çš„å››å¤§æ ¸å¿ƒä¼˜åŒ–è®¾è®¡ï¼Œè¿™äº›è®¾è®¡ä¹Ÿæ˜¯å…¶ä¸ä¼ ç»Ÿæ„å»ºå·¥å…·ï¼ˆå¦‚ Webpackï¼‰çš„æ ¸å¿ƒå·®å¼‚ï¼š</p>
<ol>
<li>
<p><strong>ä¾èµ–é¢„æ„å»º + esbuild åŠ é€Ÿ</strong>ï¼šåˆ©ç”¨ esbuild çš„æé€Ÿç¼–è¯‘èƒ½åŠ›ï¼ˆæ¯”ä¼ ç»Ÿ JS è½¬è¯‘å™¨å¿« 10-100 å€ï¼‰ï¼Œå°†ç¬¬ä¸‰æ–¹ä¾èµ–è½¬ä¸º ESM æ ¼å¼å¹¶åˆå¹¶é‡å¤ä¾èµ–ï¼Œå‡å°‘é¦–æ¬¡å¯åŠ¨æ—¶çš„ç¼–è¯‘è€—æ—¶ï¼›åŒæ—¶é€šè¿‡ç¼“å­˜æœºåˆ¶ï¼ŒäºŒæ¬¡å¯åŠ¨æ—¶ç›´æ¥å¤ç”¨é¢„æ„å»ºäº§ç‰©ï¼Œè·³è¿‡é‡å¤å·¥ä½œã€‚</p>
</li>
<li>
<p><strong>æŒ‰éœ€ç¼–è¯‘å‡å°‘æ— æ•ˆå·¥ä½œ</strong>ï¼šä»…åœ¨æµè§ˆå™¨è¯·æ±‚æ¨¡å—æ—¶æ‰æ‰§è¡Œç¼–è¯‘ï¼Œé¿å…ä¼ ç»Ÿå·¥å…·â€œå¯åŠ¨æ—¶å…¨é‡æ‰“åŒ…â€çš„æ— æ•ˆå·¥ä½œï¼Œå°¤å…¶å¯¹äºå¤§å‹é¡¹ç›®ï¼Œé¦–æ¬¡å¯åŠ¨é€Ÿåº¦æå‡æä¸ºæ˜æ˜¾ã€‚</p>
</li>
<li>
<p><strong>HMR ç²¾å‡†æ›´æ–°ä¿ç•™å¼€å‘çŠ¶æ€</strong>ï¼šé€šè¿‡ WebSocket å®æ—¶æ¨é€å˜æ›´ï¼Œä»…æ›´æ–°ä¿®æ”¹çš„æ¨¡å—è€Œéå…¨é¡µåˆ·æ–°ï¼Œæ—¢æå‡äº†æ›´æ–°é€Ÿåº¦ï¼Œåˆä¿ç•™äº†å¼€å‘è€…çš„å·¥ä½œçŠ¶æ€ï¼ˆå¦‚è¡¨å•è¾“å…¥ã€ç»„ä»¶çŠ¶æ€ï¼‰ï¼Œå¤§å¹…æå‡å¼€å‘æ•ˆç‡ã€‚</p>
</li>
<li>
<p><strong>å†…å­˜ç¼“å­˜å¤ç”¨ç¼–è¯‘ç»“æœ</strong>ï¼šæ‰€æœ‰ç¼–è¯‘åçš„æ¨¡å—éƒ½ä¼šç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œå½“æµè§ˆå™¨å†æ¬¡è¯·æ±‚åŒä¸€æ¨¡å—æ—¶ï¼ˆå¦‚é¡µé¢åˆ·æ–°åï¼‰ï¼ŒVite ç›´æ¥ä»å†…å­˜ä¸­è¿”å›ç¼–è¯‘ç»“æœï¼Œæ— éœ€é‡å¤ç¼–è¯‘ï¼Œè¿›ä¸€æ­¥å‡å°‘å“åº”æ—¶é—´ã€‚</p>
</li>
</ol>
<h3 data-id="heading-29">äº”ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆï¼ˆå†…å®¹ç”±AIç”Ÿæˆï¼‰</h3>
<h4 data-id="heading-30">1. é¦–æ¬¡å¯åŠ¨æ¯”äºŒæ¬¡å¯åŠ¨æ…¢å¾ˆå¤šï¼Ÿ</h4>
<p><strong>åŸå› </strong>ï¼šé¦–æ¬¡å¯åŠ¨éœ€è¦æ‰§è¡Œä¾èµ–é¢„æ„å»ºæµç¨‹ï¼Œå°†ç¬¬ä¸‰æ–¹ä¾èµ–è½¬ä¸º ESM å¹¶ç”Ÿæˆç¼“å­˜ï¼›äºŒæ¬¡å¯åŠ¨æ—¶ï¼ŒVite ä¼šè¯»å– <code>node_modules/.vite</code> ç›®å½•ä¸­çš„ç¼“å­˜æ–‡ä»¶ï¼Œè·³è¿‡é¢„æ„å»ºæ­¥éª¤ï¼Œå› æ­¤å¯åŠ¨é€Ÿåº¦æ›´å¿«ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šè¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œæ— éœ€ç‰¹æ®Šå¤„ç†ã€‚è‹¥éœ€å¼ºåˆ¶é‡æ–°æ‰§è¡Œé¢„æ„å»ºï¼Œå¯åˆ é™¤ <code>node_modules/.vite</code> ç›®å½•ï¼Œæˆ–æ‰§è¡Œå‘½ä»¤ <code>npx vite --force</code>ã€‚</p>
<h4 data-id="heading-31">2. HMR çƒ­æ›´æ–°å¤±æ•ˆï¼Œä¿®æ”¹ä»£ç åé¡µé¢æ— ååº”ï¼Ÿ</h4>
<p><strong>å¯èƒ½åŸå› </strong>ï¼š</p>
<ul>
<li>
<p>ä¿®æ”¹äº†æ— æ³•å•ç‹¬çƒ­æ›´æ–°çš„æ¨¡å—ï¼Œå¦‚å…¥å£æ–‡ä»¶ <code>main.ts</code>ã€å…¨å±€çŠ¶æ€ç®¡ç†æ–‡ä»¶ç­‰ï¼›</p>
</li>
<li>
<p>æ¡†æ¶æ’ä»¶ç‰ˆæœ¬ä¸ Vite 5.x ä¸å…¼å®¹ï¼ˆå¦‚ <code>@vitejs/plugin-vue</code> ç‰ˆæœ¬è¿‡ä½ï¼‰ï¼›</p>
</li>
<li>
<p>WebSocket è¿æ¥å¤±è´¥ï¼ˆå¦‚ç«¯å£è¢«å ç”¨ã€ç½‘ç»œç¯å¢ƒé™åˆ¶ï¼‰ã€‚</p>
</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>
<p>æ£€æŸ¥ä¿®æ”¹çš„æ¨¡å—æ˜¯å¦ä¸ºå¯çƒ­æ›´æ–°æ¨¡å—ï¼Œå…¥å£æ–‡ä»¶ç­‰æ ¸å¿ƒæ¨¡å—ä¿®æ”¹åéœ€æ‰‹åŠ¨åˆ·æ–°é¡µé¢ï¼›</p>
</li>
<li>
<p>å‡çº§æ¡†æ¶æ’ä»¶è‡³ä¸ Vite 5.x å…¼å®¹çš„ç‰ˆæœ¬ï¼ˆå¦‚ <code>@vitejs/plugin-vue@5.x</code>ï¼‰ï¼›</p>
</li>
<li>
<p>æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ WebSocket è¿æ¥å¤±è´¥çš„é”™è¯¯ï¼Œå°è¯•é‡å¯æœåŠ¡å™¨æˆ–æ›´æ¢ç«¯å£ï¼ˆé€šè¿‡ <code>vite.config.ts</code> çš„ <code>server.port</code> é…ç½®ï¼‰ã€‚</p>
</li>
</ul>
<h4 data-id="heading-32">3. å¼€å‘æ¨¡å¼ä¸‹ TypeScript ç±»å‹é”™è¯¯æœªè¢«æ£€æµ‹åˆ°ï¼Ÿ</h4>
<p><strong>åŸå› </strong>ï¼šVite å¼€å‘æ¨¡å¼ä¸‹çš„ TypeScript è½¬è¯‘ä»…åšè¯­æ³•è½¬è¯‘ï¼Œä¸æ‰§è¡Œç±»å‹æ£€æŸ¥ï¼Œç›®çš„æ˜¯æå‡ç¼–è¯‘é€Ÿåº¦ã€‚ç±»å‹æ£€æŸ¥å·¥ä½œé»˜è®¤ç”± IDEï¼ˆå¦‚ VS Codeï¼‰å®æ—¶æ‰§è¡Œã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šåœ¨ <code>package.json</code> ä¸­æ·»åŠ ç±»å‹æ£€æŸ¥è„šæœ¬ï¼š<code>"type-check": "tsc --noEmit"</code>ï¼Œå¼€å‘è¿‡ç¨‹ä¸­å¯é€šè¿‡ <code>npm run type-check</code> æ‰‹åŠ¨æ‰§è¡Œç±»å‹æ£€æŸ¥ï¼Œæˆ–åœ¨ CI/CD æµç¨‹ä¸­åŠ å…¥è¯¥æ­¥éª¤ç¡®ä¿ä»£ç ç±»å‹æ­£ç¡®ã€‚</p>
<h3 data-id="heading-33">å…­ã€å¯¹æŒ‰éœ€åŠ è½½çš„ç†è§£è¡¥å……ï¼šæ— éœ€åŠ è½½ä¸å»¶è¿ŸåŠ è½½åœºæ™¯</h3>
<p>åŸºäº Vite ã€ŒæŒ‰éœ€ç¼–è¯‘+åŠ¨æ€å¼•å…¥ã€çš„æ ¸å¿ƒè®¾è®¡ï¼Œé¦–æ¬¡å¯åŠ¨æ—¶å­˜åœ¨å¤§é‡æ— éœ€åŠ è½½çš„æ–‡ä»¶ï¼Œéƒ¨åˆ†æ–‡ä»¶ä¼šåœ¨åç»­ä»£ç æ›´æ–°æ—¶å› å¼•ç”¨å…³ç³»æ¿€æ´»è€Œè¢«é¦–æ¬¡åŠ è½½ï¼ŒåŒ…å«ä¸¤ç±»æ ¸å¿ƒåœºæ™¯ã€‚</p>
<h4 data-id="heading-34">1. é¦–æ¬¡å¯åŠ¨æ— éœ€åŠ è½½çš„æ–‡ä»¶åœºæ™¯</h4>
<p>é¦–æ¬¡å¯åŠ¨ä»…åŠ è½½é¡µé¢åˆå§‹æ¸²æŸ“å¿…éœ€çš„èµ„æºï¼Œæœªè¢«ä¾èµ–æˆ–éæ¸²æŸ“ç›¸å…³çš„æ–‡ä»¶å‡ä¸ä¼šè§¦å‘åŠ è½½ï¼Œå…·ä½“åˆ†ä¸ºä¸‰ç±»åœºæ™¯ï¼š</p>
<h5 data-id="heading-35">1.1 æœªè¢«ä»»ä½•æ¨¡å—å¼•å…¥çš„æºç æ–‡ä»¶</h5>
<p>é¡¹ç›® <code>src</code> ç›®å½•ä¸­å­˜åœ¨ä½†æœªè¢«å…¥å£æ¨¡å—æˆ–ä¾èµ–é“¾å…³è”çš„æ–‡ä»¶ï¼Œå®Œå…¨ä¸ä¼šè§¦å‘è¯·æ±‚å’Œç¼–è¯‘ï¼Œæ˜¯æœ€å¸¸è§çš„æ— éœ€åŠ è½½åœºæ™¯ï¼š</p>
<ul>
<li>
<p><strong>ç‹¬ç«‹æœªå¼•ç”¨ç»„ä»¶</strong>ï¼šæ–°å»ºçš„ <code>src/components/UnusedComponent.vue</code> æœªåœ¨ <code>App.vue</code> æˆ–å…¶ä»–ä¸šåŠ¡ç»„ä»¶ä¸­é€šè¿‡ <code>import</code> å¼•å…¥ï¼Œæµè§ˆå™¨æ— è¯·æ±‚ï¼ŒVite ä¸ç¼–è¯‘ï¼›</p>
</li>
<li>
<p><strong>å†—ä½™å·¥å…·å‡½æ•°</strong>ï¼š<code>src/utils/legacy-utils.ts</code> åŒ…å«å†å²å·¥å…·å‡½æ•°ï¼Œä½†æ‰€æœ‰ä¸šåŠ¡ä»£ç å‡æœªè°ƒç”¨ï¼Œå¤„äºâ€œå®šä¹‰æœªä½¿ç”¨â€çŠ¶æ€ï¼›</p>
</li>
<li>
<p><strong>æœªæ³¨å†Œè·¯ç”±ç»„ä»¶</strong>ï¼šè·¯ç”±é…ç½®æ–‡ä»¶ä¸­æœªæ³¨å†Œçš„é¡µé¢ç»„ä»¶ï¼ˆå¦‚ <code>src/views/TestPage.vue</code> æœªåŠ å…¥ <code>routes</code> æ•°ç»„ï¼‰ï¼Œå³ä½¿å­˜åœ¨ä¹Ÿä¸ä¼šè¢«åŠ è½½ã€‚</p>
</li>
</ul>
<h5 data-id="heading-36">1.2 å·²é¢„æ„å»ºä½†æœªå¼•å…¥çš„ç¬¬ä¸‰æ–¹ä¾èµ–</h5>
<p>é¦–æ¬¡å¯åŠ¨æ—¶ Vite ä¼šå¯¹ <code>package.json</code> ä¸­ <code>dependencies</code> æ‰€æœ‰ç¬¬ä¸‰æ–¹ä¾èµ–æ‰§è¡Œé¢„æ„å»ºï¼Œä½†ä»…å½“æºç å®é™…å¼•å…¥æ—¶æ‰ä¼šè¢«æµè§ˆå™¨è¯·æ±‚ï¼š</p>
<ul>
<li>
<p><strong>å®‰è£…åæœªä½¿ç”¨çš„ä¾èµ–</strong>ï¼šé€šè¿‡ <code>npm install axios</code> å®‰è£…åï¼Œæœªåœ¨ä»»ä½•æºç ä¸­å†™ <code>import axios from 'axios'</code>ï¼Œå…¶é¢„æ„å»ºäº§ç‰© <code>node_modules/.vite/deps/axios.js</code> ä¸ä¼šè¢«è¯·æ±‚ï¼›</p>
</li>
<li>
<p><strong>æŒ‰éœ€å¼•å…¥åº“çš„æœªä½¿ç”¨éƒ¨åˆ†</strong>ï¼šä½¿ç”¨ <code>lodash-es</code> æ—¶ä»…å¼•å…¥ <code>import debounce from 'lodash-es/debounce'</code>ï¼Œåˆ™ <code>lodash-es</code> å…¶ä»–å‡½æ•°ï¼ˆå¦‚ <code>throttle</code>ï¼‰çš„é¢„æ„å»ºç›¸å…³ä»£ç ä¸ä¼šè¢«åŠ è½½ã€‚</p>
</li>
</ul>
<h5 data-id="heading-37">1.3 éæ¸²æŸ“ç›¸å…³çš„é…ç½®ä¸è¾…åŠ©æ–‡ä»¶</h5>
<p>é¡¹ç›®æ ¹ç›®å½•æˆ–å­ç›®å½•ä¸­ç”¨äºé…ç½®ã€æ–‡æ¡£ã€æ„å»ºç­‰ç›®çš„çš„æ–‡ä»¶ï¼Œä»…åœ¨ Vite å¯åŠ¨æ—¶è¢«è¯»å–é…ç½®æˆ–å®Œå…¨ä¸å‚ä¸å¼€å‘æµç¨‹ï¼Œä¸ä¼šè¢«æµè§ˆå™¨è¯·æ±‚ï¼š</p>
<ul>
<li>
<p><strong>é…ç½®æ–‡ä»¶</strong>ï¼š<code>vite.config.ts</code>ã€<code>tsconfig.json</code>ã€<code>.eslintrc.js</code> ç­‰ï¼Œä»…åœ¨ Vite åˆå§‹åŒ–æ—¶è§£æé…ç½®ï¼Œä¸è¿›å…¥æµè§ˆå™¨æ¸²æŸ“æµç¨‹ï¼›</p>
</li>
<li>
<p><strong>æ–‡æ¡£ä¸æ—¥å¿—</strong>ï¼š<code>README.md</code>ã€<code>CHANGELOG.md</code> åŠ <code>logs/</code> ç›®å½•ä¸‹çš„æ—¥å¿—æ–‡ä»¶ï¼Œä¸å‰ç«¯æ¸²æŸ“å®Œå…¨æ— å…³ï¼›</p>
</li>
<li>
<p><strong>æ„å»ºäº§ç‰©ä¸ç¼“å­˜</strong>ï¼š<code>dist/</code> ç›®å½•ï¼ˆæ„å»ºäº§ç‰©ï¼‰ã€<code>node_modules/.vite/cache/</code> ç›®å½•ï¼ˆé¢„æ„å»ºç¼“å­˜ï¼‰ï¼Œä»…åœ¨æ„å»ºæˆ–é¢„æ„å»ºæ—¶ä½¿ç”¨ï¼Œä¸è¢«æµè§ˆå™¨è¯·æ±‚ã€‚</p>
</li>
</ul>
<h4 data-id="heading-38">2. é¦–æ¬¡å¯åŠ¨æœªåŠ è½½ã€ä»£ç æ›´æ–°æ—¶åŠ è½½çš„åœºæ™¯</h4>
<p>è¿™ç±»æ–‡ä»¶æœ¬èº«å­˜åœ¨ä¸”å¼•ç”¨å…³ç³»/å†…å®¹æœªå˜ï¼Œä½†å› é¦–æ¬¡å¯åŠ¨æ—¶æœªæ»¡è¶³åŠ è½½æ¡ä»¶ï¼Œåœ¨åç»­ä»£ç æ›´æ–°è§¦å‘å¼•ç”¨å…³ç³»æ¿€æ´»åæ‰è¢«é¦–æ¬¡åŠ è½½ï¼Œæ ¸å¿ƒé©±åŠ¨åŠ›æ˜¯â€œåŠ¨æ€å¼•å…¥â€å’Œâ€œæ¡ä»¶æ¿€æ´»â€ï¼š</p>
<h5 data-id="heading-39">2.1 è·¯ç”±æ‡’åŠ è½½çš„éåˆå§‹é¡µé¢</h5>
<p>Vue Routerã€React Router ç­‰æ”¯æŒçš„è·¯ç”±æ‡’åŠ è½½ï¼Œæ˜¯æœ€å…¸å‹çš„å»¶è¿ŸåŠ è½½åœºæ™¯ï¼Œé¦–æ¬¡å¯åŠ¨ä»…åŠ è½½é¦–é¡µè·¯ç”±ï¼Œå…¶ä»–è·¯ç”±ç»„ä»¶åœ¨ä»£ç æ›´æ–°æ¿€æ´»è·³è½¬ååŠ è½½ï¼š</p>
<ol>
<li>
<p><strong>é¦–æ¬¡å¯åŠ¨æœªåŠ è½½</strong>ï¼šè·¯ç”±é…ç½®ä¸­é€šè¿‡ <code>() =&gt; import()</code> å®šä¹‰éé¦–é¡µè·¯ç”±ï¼Œé¦–æ¬¡å¯åŠ¨ä»…åŠ è½½ <code>/</code> å¯¹åº”ç»„ä»¶ï¼Œå…¶ä»–è·¯ç”±ç»„ä»¶æœªè¢«è¯·æ±‚ï¼š<code>// è·¯ç”±é…ç½®ï¼ˆé¦–æ¬¡å¯åŠ¨ä»…åŠ è½½ Home.vueï¼‰</code></p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">const</span> routes = [
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>, <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./Home.vue'</span>) }, <span class="hljs-comment">// åˆå§‹åŠ è½½</span>
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/about'</span>, <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./About.vue'</span>) } <span class="hljs-comment">// é¦–æ¬¡æœªåŠ è½½</span>
];
</code></pre>
</li>
<li>
<p><strong>ä»£ç æ›´æ–°è§¦å‘åŠ è½½</strong>ï¼šä¿®æ”¹ <code>Home.vue</code> æ–°å¢â€œå…³äºé¡µâ€è·³è½¬æŒ‰é’®ï¼ˆä»…æ›´æ–°é¡µé¢å†…å®¹ï¼Œ<code>About.vue</code> å¼•ç”¨å…³ç³»å’Œå†…å®¹ä¸å˜ï¼‰ï¼š</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
 &lt;!-- <span class="hljs-title class_">Home</span>.<span class="hljs-property">vue</span> ä»£ç æ›´æ–°ï¼šæ–°å¢è·³è½¬æŒ‰é’® --&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>é¦–é¡µ<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/about"</span>&gt;</span>å»å…³äºé¡µ<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span> <span class="hljs-comment">&lt;!-- æ–°å¢è·³è½¬ --&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
</code></pre>
<p>Vite è§¦å‘ HMR æ›´æ–° <code>Home.vue</code> åï¼Œç”¨æˆ·ç‚¹å‡»è·³è½¬æŒ‰é’®æ—¶ï¼Œæµè§ˆå™¨ä¼šé¦–æ¬¡è¯·æ±‚ <code>About.vue</code> å¹¶å®Œæˆç¼–è¯‘åŠ è½½ã€‚</p>
</li>
</ol>
<h5 data-id="heading-40">2.2 æ¡ä»¶æ¸²æŸ“è§¦å‘çš„åŠ¨æ€å¼•å…¥ç»„ä»¶</h5>
<p>é¦–æ¬¡å¯åŠ¨æ—¶ä¸æ»¡è¶³æ¸²æŸ“æ¡ä»¶çš„ç»„ä»¶ï¼Œé€šè¿‡åŠ¨æ€å¼•å…¥æ–¹å¼å®šä¹‰ï¼Œåœ¨ä»£ç æ›´æ–°è°ƒæ•´æ¡ä»¶åè¢«æ¿€æ´»åŠ è½½ï¼š</p>
<ol>
<li>
<p><strong>é¦–æ¬¡å¯åŠ¨æœªåŠ è½½</strong>ï¼š<code>App.vue</code> ä¸­é€šè¿‡æ¡ä»¶åˆ¤æ–­åŠ¨æ€å¼•å…¥å¼¹çª—ç»„ä»¶ï¼Œé¦–æ¬¡å¯åŠ¨æ—¶ <code>showModal</code> ä¸º <code>false</code>ï¼Œ<code>Modal.vue</code> æœªè¢«è¯·æ±‚ï¼š<code>&lt;script setup&gt;</code></p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">const</span> showModal = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>); <span class="hljs-comment">// åˆå§‹ä¸ºfalseï¼Œä¸è§¦å‘å¼•å…¥</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">openModal</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  showModal.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">const</span> { <span class="hljs-attr">default</span>: <span class="hljs-title class_">Modal</span> } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./components/Modal.vue'</span>); <span class="hljs-comment">// åŠ¨æ€å¼•å…¥</span>
  <span class="hljs-comment">// æ¸²æŸ“å¼¹çª—é€»è¾‘</span>
};
&lt;/script&gt;
</code></pre>
</li>
<li>
<p><strong>ä»£ç æ›´æ–°è§¦å‘åŠ è½½</strong>ï¼šä¿®æ”¹ <code>App.vue</code> æ–°å¢â€œæ‰“å¼€å¼¹çª—â€æŒ‰é’®ï¼ˆæ— éœ€ä¿®æ”¹ <code>Modal.vue</code>ï¼‰ï¼Œç”¨æˆ·ç‚¹å‡»æŒ‰é’®å <code>showModal</code> å˜ä¸º <code>true</code>ï¼Œè§¦å‘ <code>Modal.vue</code> é¦–æ¬¡è¯·æ±‚å’ŒåŠ è½½ã€‚</p>
</li>
</ol>
<h5 data-id="heading-41">2.3 ç»„ä»¶åº“æŒ‰éœ€å¼•å…¥çš„æ–°å¢ç»„ä»¶</h5>
<p>ä½¿ç”¨ Element Plusã€Ant Design Vue ç­‰æ”¯æŒæŒ‰éœ€å¼•å…¥çš„ç»„ä»¶åº“æ—¶ï¼Œé¦–æ¬¡å¯åŠ¨ä»…åŠ è½½å·²ä½¿ç”¨ç»„ä»¶ï¼Œä»£ç æ›´æ–°æ–°å¢ç»„ä»¶å¼•ç”¨åè§¦å‘æœªåŠ è½½ç»„ä»¶çš„åŠ è½½ï¼š</p>
<ol>
<li>
<p><strong>é¦–æ¬¡å¯åŠ¨æœªåŠ è½½</strong>ï¼šé¦–æ¬¡å¯åŠ¨ä»…ä½¿ç”¨ <code>ElButton</code>ï¼ŒæŒ‰éœ€å¼•å…¥æ’ä»¶ä»…ç¼–è¯‘åŠ è½½ <code>ElButton</code> ç›¸å…³ä»£ç ï¼Œ<code>ElTable</code> ç­‰æœªä½¿ç”¨ç»„ä»¶æœªè¢«åŠ è½½ï¼›</p>
</li>
<li>
<p><strong>ä»£ç æ›´æ–°è§¦å‘åŠ è½½</strong>ï¼šä¿®æ”¹ <code>TablePage.vue</code> æ–°å¢ <code>&lt;ElTable&gt;</code> ç»„ä»¶å¹¶è¡¥å……å¼•å…¥ä»£ç  <code>import { ElTable } from 'element-plus'</code>ï¼ŒVite ä¼šåœ¨ HMR æ—¶è¯†åˆ«æ–°å¢å¼•ç”¨ï¼Œè§¦å‘ <code>ElTable</code> åŠå…¶ä¾èµ–çš„é¦–æ¬¡åŠ è½½ï¼ˆç»„ä»¶åº“æœ¬èº«å†…å®¹æœªå˜ï¼Œä»…å¼•ç”¨å…³ç³»æ¿€æ´»ï¼‰ã€‚</p>
</li>
</ol>
<h4 data-id="heading-42">3. æ ¸å¿ƒç»“è®º</h4>
<p>Vite å¼€å‘æ¨¡å¼çš„åŠ è½½é€»è¾‘å§‹ç»ˆå›´ç»•ã€ŒæŒ‰éœ€ã€æ ¸å¿ƒï¼šé¦–æ¬¡å¯åŠ¨ä»…ä¸ºâ€œåˆå§‹æ¸²æŸ“â€æœåŠ¡ï¼Œæœªè¢«ä¾èµ–çš„æ–‡ä»¶å‡æ— éœ€åŠ è½½ï¼›è€Œåç»­ä»£ç æ›´æ–°æ—¶ï¼Œåªè¦é€šè¿‡ä¿®æ”¹ä»£ç æ¿€æ´»äº†æ–°çš„å¼•ç”¨å…³ç³»ï¼ˆå¦‚æ–°å¢è·³è½¬ã€è°ƒæ•´æ¸²æŸ“æ¡ä»¶ï¼‰ï¼Œå³ä½¿æ–‡ä»¶æœ¬èº«å†…å®¹æœªå˜ï¼Œä¹Ÿä¼šè¢«é¦–æ¬¡åŠ è½½ã€‚è¿™ä¸€ç‰¹æ€§æ—¢ä¿è¯äº†é¦–æ¬¡å¯åŠ¨çš„æé€Ÿä½“éªŒï¼Œåˆå…¼é¡¾äº†å¼€å‘è¿‡ç¨‹ä¸­åŠ¨æ€æ‰©å±•çš„çµæ´»æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nacos æºç æ·±åº¦ç•…æ¸¸ï¼šNacos é…ç½®åŒæ­¥è¯¦è§£ï¼ˆä¸Šï¼‰]]></title>    <link>https://juejin.cn/post/7572485825705558025</link>    <guid>https://juejin.cn/post/7572485825705558025</guid>    <pubDate>2025-11-15T07:57:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572485825705558025" data-draft-id="7564725862025986100" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Nacos æºç æ·±åº¦ç•…æ¸¸ï¼šNacos é…ç½®åŒæ­¥è¯¦è§£ï¼ˆä¸Šï¼‰"/> <meta itemprop="keywords" content="åç«¯,GitHub,åˆ†å¸ƒå¼"/> <meta itemprop="datePublished" content="2025-11-15T07:57:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ–¹åœ†æƒ³å½“å›¾çµ"/> <meta itemprop="url" content="https://juejin.cn/user/386633160473101"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Nacos æºç æ·±åº¦ç•…æ¸¸ï¼šNacos é…ç½®åŒæ­¥è¯¦è§£ï¼ˆä¸Šï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/386633160473101/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ–¹åœ†æƒ³å½“å›¾çµ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T07:57:14.000Z" title="Sat Nov 15 2025 07:57:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»31åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ <strong>æ–¹åœ†</strong>ã€‚æœ€è¿‘å­¦ä¹ äº†ä¸€ä¸‹ Nacos æºç ï¼Œé¡ºä¾¿ä¸º Nacos å¼€æºé¡¹ç›®æäº¤äº† 10+ ä¸ª PRï¼Œæˆä¸ºäº† Nacos é¡¹ç›®çš„ Contributorã€‚Nacos æ˜¯ä¸€ä¸ªéå¸¸æ´»è·ƒä¸”åŒ…å®¹çš„ç¤¾åŒºï¼Œå¤§å®¶å¯ä»¥åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falibaba%2Fnacos" target="_blank" title="https://github.com/alibaba/nacos" ref="nofollow noopener noreferrer">Github-Nacos</a> å…³æ³¨å¹¶è®¤é¢† ISSUEã€‚æœ¬ç¯‡æ–‡ç« åŸºäº Nacos çš„ 3.1.0 ç‰ˆæœ¬ï¼Œå‡†å¤‡è¯¦ç»†è§£é‡Šä¸€ä¸‹ Nacos å¯¹é…ç½®ç®¡ç†çš„æ ¸å¿ƒæµç¨‹ï¼Œæ–¹ä¾¿ä¹‹åäº†è§£å’Œå­¦ä¹  Nacos çš„åŒå­¦ã€‚</p>
<p>æœ¬æ–‡å°†ä¸»è¦åˆ†æˆä¸¤å¤§éƒ¨åˆ†ï¼š</p>
<ol>
<li>å½“é…ç½®å‘ç”Ÿå˜æ›´æ—¶ï¼ŒNacos Server æœåŠ¡ç«¯æ˜¯å¦‚ä½•ä¿è¯é…ç½®æ•°æ®çš„ä¸€è‡´æ€§çš„ï¼Œåœ¨è¿™ä¸ªå°èŠ‚å†…æˆ‘ä»¬ä¼šè®¨è®ºä¸¤ç§æƒ…å†µï¼Œåˆ†åˆ«å…³äº Nacos Server çš„å•æœºéƒ¨ç½²å’Œé›†ç¾¤éƒ¨ç½²</li>
<li>å½“é…ç½®å‘ç”Ÿå˜æ›´æ—¶ï¼ŒNacos Client å®¢æˆ·ç«¯æ˜¯å¦‚ä½•ä¿è¯åŠæ—¶æ›´æ–°é…ç½®ï¼Œå¹¶ä¿è¯é…ç½®å†…å®¹æ˜¯æœ€æ–°çš„</li>
</ol>
<p>åœ¨æ¯ä¸ªéƒ¨åˆ†æˆ‘éƒ½ä¼šåœ¨è®²è§£æºç å‰å°†å…·ä½“çš„é€»è¾‘ä½¿ç”¨å›¾ç¤ºæ•´ç†å‡ºæ¥ï¼Œæ–¹ä¾¿æƒ³ç†è§£åŸç†è€Œä¸æƒ³çœ‹æºç çš„åŒå­¦ï¼ŒåŒæ—¶ä¹Ÿèƒ½è®©æƒ³çœ‹æºç çš„åŒå­¦å¿«é€Ÿå…¥æ‰‹ã€‚å¦‚æœå¤§å®¶å¯¹ Nacos æ„Ÿå…´è¶£ï¼Œå¯ä»¥å°†æºç  clone ä¸‹æ¥ï¼ŒDebug è°ƒè¯•æ•´ä¸ªæµç¨‹ï¼Œè¿™æ ·å­¦ä¹ å’Œç†è§£çš„æ•ˆæœæ›´ä½³ã€‚</p>
<h3 data-id="heading-0">Nacos Server æœåŠ¡ç«¯</h3>
<p>å½“æˆ‘ä»¬åœ¨ Nacos æ§åˆ¶å°å˜æ›´é…ç½®æ—¶ï¼Œä¸è®ºæ˜¯å•æœºéƒ¨ç½²è¿˜æ˜¯é›†ç¾¤éƒ¨ç½²éƒ½ä¼šç»è¿‡ä»¥ä¸‹é€»è¾‘ï¼Œè¯·æ±‚ä¼šç”± <code>ConsoleConfigController</code> æ¥æ‰¿æ¥ï¼Œè°ƒç”¨å…¶ä¸­çš„ <code>publishConfig</code> å‘å¸ƒé…ç½®çš„æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@NacosApi</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/v3/console/cs/config")</span>
<span class="hljs-meta">@ExtractorManager</span>.Extractor(httpExtractor = ConfigDefaultHttpParamExtractor.class)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsoleConfigController</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConfigProxy configProxy;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ConsoleConfigController</span><span class="hljs-params">(ConfigProxy configProxy)</span> {
        <span class="hljs-built_in">this</span>.configProxy = configProxy;
    }
    
    <span class="hljs-meta">@PostMapping()</span>
    <span class="hljs-meta">@Secured(action = ActionTypes.WRITE, signType = SignType.CONFIG, apiType = ApiType.CONSOLE_API)</span>
    <span class="hljs-keyword">public</span> Result&lt;Boolean&gt; <span class="hljs-title function_">publishConfig</span><span class="hljs-params">(HttpServletRequest request, ConfigFormV3 configForm)</span> <span class="hljs-keyword">throws</span> NacosException {
        <span class="hljs-comment">// check required </span>
        configForm.validateWithContent();
        <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">namespaceTransferred</span> <span class="hljs-operator">=</span> NamespaceUtil.isNeedTransferNamespace(configForm.getNamespaceId());
        configForm.setNamespaceId(NamespaceUtil.processNamespaceParameter(configForm.getNamespaceId()));

        <span class="hljs-comment">// check param</span>
        ParamUtils.checkParam(configForm.getDataId(), configForm.getGroup(), <span class="hljs-string">"datumId"</span>, configForm.getContent());
        ParamUtils.checkParamV2(configForm.getTag());

        <span class="hljs-keyword">if</span> (StringUtils.isBlank(configForm.getSrcUser())) {
            configForm.setSrcUser(RequestUtil.getSrcUserName(request));
        }
        <span class="hljs-keyword">if</span> (!ConfigType.isValidType(configForm.getType())) {
            configForm.setType(ConfigType.getDefaultType().getType());
        }

        <span class="hljs-type">ConfigRequestInfo</span> <span class="hljs-variable">configRequestInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigRequestInfo</span>();
        configRequestInfo.setSrcIp(RequestUtil.getRemoteIp(request));
        configRequestInfo.setRequestIpApp(RequestUtil.getAppName(request));
        configRequestInfo.setBetaIps(request.getHeader(<span class="hljs-string">"betaIps"</span>));
        configRequestInfo.setCasMd5(request.getHeader(<span class="hljs-string">"casMd5"</span>));
        configRequestInfo.setNamespaceTransferred(namespaceTransferred);

        <span class="hljs-keyword">return</span> Result.success(configProxy.publishConfig(configForm, configRequestInfo));
    }
}
</code></pre>
<p>Controller ä¸­å¹¶æ²¡æœ‰å€¼å¾—ç‰¹åˆ«å…³æ³¨çš„é€»è¾‘ï¼ŒåŒ…å«å¿…è¦çš„å‚æ•°æ ¡éªŒå’Œæ‰§è¡Œ <code>ConfigProxy#publishConfig</code> æ–¹æ³•ï¼Œåè€…ä»å‘½åæ¥çœ‹ï¼ŒåŒ…å«äº† <code>Proxy</code> å­—æ ·ï¼Œæš—ç¤ºå®ƒæ˜¯ä¸€ä¸ªä»£ç†ç±»ï¼Œå…·ä½“çš„å®ç°é€»è¾‘å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigProxy</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConfigHandler configHandler;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ConfigProxy</span><span class="hljs-params">(ConfigHandler configHandler)</span> {
        <span class="hljs-built_in">this</span>.configHandler = configHandler;
    }

    <span class="hljs-comment">/**
     * Add or update configuration.
     */</span>
    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">publishConfig</span><span class="hljs-params">(ConfigForm configForm, ConfigRequestInfo configRequestInfo)</span> <span class="hljs-keyword">throws</span> NacosException {
        <span class="hljs-keyword">return</span> configHandler.publishConfig(configForm, configRequestInfo);
    }
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>å¯ä»¥å‘ç°å®ƒä½¿ç”¨äº† <strong>é™æ€ä»£ç†æ¨¡å¼</strong>ï¼Œå¹¶æ²¡æœ‰åšå‘å¸ƒé…ç½®çš„é€»è¾‘ï¼Œè€Œæ˜¯æ³¨å…¥äº† <code>ConfigHandler</code> ç±»ï¼Œå¹¶è°ƒç”¨å…¶ <code>publishConfig</code> æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒä»£ç†äº†ä»€ä¹ˆå‘¢ï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f12b493d78b4519949c6ae2735dffc7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pa55ZyG5oOz5b2T5Zu-54G1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763798468&amp;x-signature=GngJAxAtRBhQeebnwctOJ6diQiM%3D" alt="img_1.png" loading="lazy"/></p>
<p><code>ConfigHandler</code> æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒæœ‰å¤šä¸ªå®ç°ç±»ï¼Œå½“åœ¨ Nacos ä¸­é‡‡ç”¨ä¸åŒçš„é…ç½®æ—¶ï¼Œä¼šæ³¨å…¥ä¸åŒçš„å®ç°ç±»ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†ä»£ç†æ“ä½œå®é™…ä¸Šæ ¹æ®ä¸åŒçš„é…ç½®æ¥é€‰æ‹©ä¸åŒçš„ç­–ç•¥ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ä»…å…³æ³¨ <code>ConfigInnerHandler</code> å®ç°ç­–ç•¥ï¼Œå®ƒä¼šæ‰§è¡Œåˆ° <code>ConfigOperationService#publishConfig</code> å‘å¸ƒé…ç½®çš„æ ¸å¿ƒé€»è¾‘ã€‚è¿™ä¸ªæ–¹æ³•çš„é€»è¾‘è™½ç„¶å¾ˆé•¿ï¼Œä½†æ˜¯å…¶ä¸­å€¼å¾—å…³æ³¨çš„å†…å®¹æˆ‘å·²ç»ç”¨åºå·æ ‡æ³¨äº†ï¼Œåˆ†åˆ«ä¸º â€œå†™å…¥æ•°æ®åº“çš„é€»è¾‘â€ å’Œ â€œå‘å¸ƒ <code>ConfigDataChangeEvent</code> é…ç½®å˜æ›´äº‹ä»¶â€ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigOperationService</span> {

    <span class="hljs-keyword">private</span> ConfigInfoPersistService configInfoPersistService;

    <span class="hljs-keyword">private</span> ConfigInfoGrayPersistService configInfoGrayPersistService;

    <span class="hljs-keyword">private</span> ConfigMigrateService configMigrateService;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">LOGGER</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ConfigOperationService.class);

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ConfigOperationService</span><span class="hljs-params">(ConfigInfoPersistService configInfoPersistService,
                                  ConfigInfoGrayPersistService configInfoGrayPersistService,
                                  ConfigMigrateService configMigrateService)</span> {
        <span class="hljs-built_in">this</span>.configInfoPersistService = configInfoPersistService;
        <span class="hljs-built_in">this</span>.configInfoGrayPersistService = configInfoGrayPersistService;
        <span class="hljs-built_in">this</span>.configMigrateService = configMigrateService;
    }
    
    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">publishConfig</span><span class="hljs-params">(ConfigForm configForm, ConfigRequestInfo configRequestInfo, String encryptedDataKey)</span> <span class="hljs-keyword">throws</span> NacosException {
        Map&lt;String, Object&gt; configAdvanceInfo = getConfigAdvanceInfo(configForm);
        ParamUtils.checkParam(configAdvanceInfo);

        configForm.setEncryptedDataKey(encryptedDataKey);
        <span class="hljs-type">ConfigInfo</span> <span class="hljs-variable">configInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigInfo</span>(configForm.getDataId(), configForm.getGroup(),
                configForm.getNamespaceId(), configForm.getAppName(), configForm.getContent());
        <span class="hljs-comment">// set old md5</span>
        <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(configRequestInfo.getCasMd5())) {
            configInfo.setMd5(configRequestInfo.getCasMd5());
        }
        configInfo.setType(configForm.getType());
        configInfo.setEncryptedDataKey(encryptedDataKey);

        <span class="hljs-comment">// 1. å†™å…¥æ•°æ®åº“çš„é€»è¾‘ï¼šåŒºåˆ†äº† md5 æ˜¯å¦ä¸ºç©º</span>
        <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(configRequestInfo.getCasMd5())) {
            <span class="hljs-comment">// éç©ºä¼šæ‰§è¡Œ CAS æ¯”è¾ƒå¹¶äº¤æ¢çš„æ“ä½œ</span>
            configOperateResult = configInfoPersistService.insertOrUpdateCas(configRequestInfo.getSrcIp(),
                    configForm.getSrcUser(), configInfo, configAdvanceInfo);
            <span class="hljs-keyword">if</span> (!configOperateResult.isSuccess()) {
                LOGGER.warn(
                        <span class="hljs-string">"[cas-publish-config-fail] srcIp = {}, dataId= {}, casMd5 = {}, msg = server md5 may have changed."</span>,
                        configRequestInfo.getSrcIp(), configForm.getDataId(), configRequestInfo.getCasMd5());
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NacosApiException</span>(HttpStatus.INTERNAL_SERVER_ERROR.value(), ErrorCode.RESOURCE_CONFLICT,
                        <span class="hljs-string">"Cas publish fail, server md5 may have changed."</span>);
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (configRequestInfo.getUpdateForExist()) {
                configOperateResult = configInfoPersistService.insertOrUpdate(configRequestInfo.getSrcIp(),
                        configForm.getSrcUser(), configInfo, configAdvanceInfo);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">try</span> {
                    configOperateResult = configInfoPersistService.addConfigInfo(configRequestInfo.getSrcIp(),
                            configForm.getSrcUser(), configInfo, configAdvanceInfo);
                } <span class="hljs-keyword">catch</span> (DataIntegrityViolationException ive) {
                    configOperateResult = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigOperateResult</span>(<span class="hljs-literal">false</span>);
                }
            }
        }
        
        <span class="hljs-keyword">if</span> (!configOperateResult.isSuccess()) {
            LOGGER.warn(<span class="hljs-string">"[publish-config-failed] config already exists. dataId: {}, group: {}, namespaceId: {}"</span>,
                    configForm.getDataId(), configForm.getGroup(), configForm.getNamespaceId());
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigAlreadyExistsException</span>(
                    String.format(<span class="hljs-string">"config already exist, dataId: %s, group: %s, namespaceId: %s"</span>,
                            configForm.getDataId(), configForm.getGroup(), configForm.getNamespaceId()));
        }
        
        <span class="hljs-comment">// 2. å‘å¸ƒ ConfigDataChangeEvent é…ç½®å˜æ›´äº‹ä»¶</span>
        ConfigChangePublisher.notifyConfigChange(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigDataChangeEvent</span>(configForm.getDataId(), configForm.getGroup(), configForm.getNamespaceId(),
                        configOperateResult.getLastModified()));
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ ¹æ® â€œå•æœºéƒ¨ç½²ï¼Œé‡‡ç”¨ MySQL æ•°æ®åº“â€ å’Œ â€œé›†ç¾¤éƒ¨ç½²ï¼Œé‡‡ç”¨å†…åµŒ Derby æ•°æ®åº“â€ æ¥è®¨è®ºå…·ä½“çš„é€»è¾‘ã€‚</p>
<h4 data-id="heading-1">å•æœºéƒ¨ç½²ï¼Œé‡‡ç”¨ MySQL æ•°æ®åº“</h4>
<p>åœ¨å•æœºéƒ¨ç½²å¹¶é‡‡ç”¨ MySQL æ•°æ®åº“æ—¶ï¼ŒNacos æœåŠ¡ç«¯åœ¨é…ç½®å˜æ›´åæ‰§è¡Œé€»è¾‘çš„æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/983300874378498da832018857209668~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pa55ZyG5oOz5b2T5Zu-54G1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763798468&amp;x-signature=O2EnBH8g6rHICDjwAvsCIsNuw6U%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨æ§åˆ¶å°å˜æ›´é…ç½®åï¼Œä¼šå…ˆå†™å…¥ MySQL æ•°æ®åº“ï¼Œå†™å…¥æˆåŠŸç»§ç»­æ‰§è¡Œï¼Œå¦‚æœå†™å…¥å¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œæ§åˆ¶å°ä¼šæç¤ºé…ç½®å†™å…¥å¤±è´¥ï¼Œå°±ä¸å†æ‰§è¡Œåç»­çš„é€»è¾‘äº†ã€‚</p>
<p>åœ¨å†™å…¥ MySQL æ•°æ®åº“æˆåŠŸåï¼Œä¼šè§¦å‘ <code>ConfigDataChangeEvent</code> é…ç½®å‘ç”Ÿå˜æ›´çš„äº‹ä»¶ï¼Œç”± <code>DumpService</code> ç›‘å¬å¹¶æ¶ˆè´¹ã€‚æ¶ˆè´¹è¿™ä¸ªäº‹ä»¶æ—¶ï¼Œä¼šåˆ›å»º <code>DumpTask</code> ä»»åŠ¡ï¼Œè¿™ä¸ªä»»åŠ¡çš„ä½œç”¨æœ‰ä¸¤ä¸ªï¼šå°†é…ç½®ä¿¡æ¯ <strong>å†™å…¥æœ¬åœ°ç£ç›˜æ–‡ä»¶</strong> å’Œ <strong>å†™å…¥æœåŠ¡ JVM å†…å­˜</strong>ï¼Œè¿™æ · <strong>å³ä½¿åœ¨ MySQL æ•°æ®åº“å‘ç”Ÿå®•æœºæ—¶ï¼Œå®¢æˆ·ç«¯ä¹Ÿèƒ½æ­£å¸¸è¯»å–é…ç½®ä¿¡æ¯</strong>ï¼Œå†™å…¥æœ¬åœ°ç£ç›˜ç›¸å½“äºåšäº†æ•°æ®åº“çš„å®¹ç¾ã€‚<code>DumpTask</code> è¢«åˆ›å»ºåä¼šè¢«ä¿å­˜åœ¨ä¸€ä¸ª <code>ConcurrentHashMap</code> ä¸­ï¼Œç”±ä¸€ä¸ª <code>ScheduledExecutorService</code> å®šæ—¶ 100ms æ‰§è¡Œçš„çº¿ç¨‹æ± å®šæœŸå¤„ç†ä»»åŠ¡ï¼Œ<strong>å¦‚æœä»»åŠ¡åœ¨æ‰§è¡Œæ—¶å¤±è´¥ï¼Œéƒ½ä¼šè¢«é‡æ–°æ·»åŠ åˆ° <code>ConcurrentHashMap</code> ä¸­ï¼Œæ— é™æ¬¡é‡è¯•å¤„ç†</strong>ã€‚</p>
<p><code>DumpTask</code> å¤„ç†å®Œæˆåï¼Œä¼šå†æ¬¡å‘å‡º <code>LocalDataChangeEvent</code> æœ¬åœ°ç¼“å­˜å˜æ›´äº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶ç”± <code>RpcConfigChangeNotifier</code> ç›‘å¬å¹¶æ¶ˆè´¹ã€‚<code>RpcConfigChangeNotifier</code> å¤„ç†è¿™ä¸ªäº‹ä»¶æ—¶ä¼šåˆ›å»º <code>RpcPushTask</code> ä¸ºå®¢æˆ·ç«¯æ¨é€é…ç½®å˜æ›´çš„ä»»åŠ¡ï¼Œè¿™ä¸ªä»»åŠ¡åŒæ ·ä¼šè¢«æ·»åŠ åˆ°å¦ä¸€ä¸ª <code>ScheduledExecutorService</code> ä¸­å»æ‰§è¡Œï¼Œä½†æ˜¯å¼‚æ­¥æ¨é€å˜æ›´çš„ä»»åŠ¡ä¸ä¼šæ— é™é‡è¯•ï¼Œæœ€å¤šåªä¼šé‡è¯• 3 æ¬¡ã€‚åœ¨è¿™é‡Œå¤§å®¶å¯èƒ½ä¼šæœ‰ç–‘é—®ï¼šå¦‚æœé‡è¯•è¶…è¿‡ 3 æ¬¡æ²¡æœ‰æˆåŠŸï¼Œé‚£ä¹ˆ Nacos å®¢æˆ·ç«¯è¯¥å¦‚ä½•è·å–åˆ°æœ€æ–°çš„é…ç½®å˜æ›´å‘¢ï¼Ÿå…¶å® Nacos å®¢æˆ·ç«¯ä¸åªæ˜¯é€šè¿‡ Nacos æœåŠ¡ç«¯æ¨é€è·å–é…ç½®å˜æ›´ï¼Œè€Œä¸”è¿˜èƒ½é€šè¿‡ä¸»åŠ¨ä» Nacos æœåŠ¡ç«¯æ‹‰å–è·å–é…ç½®å˜æ›´ï¼Œè¿™ä¸ªé€»è¾‘åœ¨åç»­çš„å†…å®¹ä¸­è§£é‡Šã€‚</p>
<p>ä»¥ä¸Šä¾¿æ˜¯ Nacos æœåŠ¡ç«¯åœ¨å•æœºéƒ¨ç½²å¹¶é‡‡ç”¨ MySQL æ•°æ®åº“æ—¶ä¸»è¦çš„é€»è¾‘æµç¨‹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ·±å…¥åˆ†æå…·ä½“çš„æºç ã€‚</p>
<hr/>
<p>åœ¨ â€œå†™å…¥æ•°æ®åº“çš„é€»è¾‘â€ ä¸­ï¼ŒNacos åŒºåˆ†äº† MD5 æ˜¯å¦ä¸ºç©ºçš„ä¸¤ç§æƒ…å†µï¼ŒMD5 åœ¨ Nacos è¡¨ç¤ºçš„æ˜¯ä»€ä¹ˆå«ä¹‰å‘¢ï¼ŸNacos ä¸­çš„æ¯é¡¹é…ç½®éƒ½ä¼šæ ¹æ®å…¶ <strong>é…ç½®çš„å†…å®¹</strong> è®¡ç®—å‡º MD5 å€¼ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå› ä¸º MD5 åŠ å¯†åè¾“å‡ºé•¿åº¦å›ºå®šï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®é…ç½®çš„ MD5 å€¼å¿«é€Ÿåˆ¤æ–­é…ç½®å†…å®¹æ˜¯å¦å‘ç”Ÿå˜æ›´ã€‚</p>
<blockquote>
<p>MD5ï¼ˆMessage Digest Algorithm 5ï¼‰æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å¯†ç æ•£åˆ—å‡½æ•°ï¼Œå¯ä»¥äº§ç”Ÿå‡ºä¸€ä¸ª128ä½ï¼ˆ16å­—èŠ‚ï¼‰çš„æ•£åˆ—å€¼ï¼ˆhash valueï¼‰ï¼Œç”¨æ¥ç¡®ä¿ä¿¡æ¯ä¼ è¾“å®Œæ•´ä¸€è‡´ã€‚ä¸è¿‡ç°åœ¨æ›´æ¨èä½¿ç”¨ SHA-256 æˆ–æ›´æ–°çš„æ•£åˆ—ç®—æ³•æ¥æ›¿ä»£ MD5ã€‚</p>
</blockquote>
<p>Nacos åœ¨å‘å¸ƒé…ç½®æ—¶ï¼Œå¦‚æœ MD5 å€¼ä¸ä¸ºç©ºåˆ™è°ƒç”¨ <code>ConfigInfoPersistService#insertOrUpdateCas</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä½¿ç”¨äº† <strong>CAS</strong> æ“ä½œï¼Œåœ¨æ‰§è¡Œ UPDATE SQL æ—¶ä¼šå…ˆåˆ¤æ–­æ•°æ®åº“ä¸­é…ç½®çš„ MD5 å€¼æ˜¯å¦ä¸è¯·æ±‚ä¸­çš„ MD5 å€¼ç›¸åŒï¼Œå¦‚æœç›¸åŒåˆ™æ‰§è¡Œæ›´æ–°æ“ä½œï¼Œå¦åˆ™ä¸æ‰§è¡Œæ›´æ–°æ“ä½œï¼Œè¿™æ ·èƒ½å¤Ÿé¿å…å¤šäººåœ¨æ§åˆ¶å°åŒæ—¶ä¿®æ”¹é…ç½®é€ æˆçš„å¹¶å‘å†™å…¥é—®é¢˜ã€‚</p>
<p>å¦‚æœ MD5 å€¼ä¸ºç©ºçš„è¯ï¼Œé‚£ä¹ˆç›´æ¥è°ƒç”¨ <code>ConfigInfoPersistService#insertOrUpdate</code> æ–¹æ³•ï¼Œç›´æ¥è½åº“ã€‚</p>
<p>åœ¨æ•°æ®åº“æ“ä½œå®Œæˆåï¼Œ<strong>é…ç½®å˜æ›´å·²ç»åœ¨ä¿å­˜åœ¨æ•°æ®åº“äº†</strong>ï¼Œä¹‹åä¼šå‘å¸ƒ <code>ConfigDataChangeEvent</code> é…ç½®å˜æ›´äº‹ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥å¤„ç†çš„æ“ä½œï¼Œåœ¨å•æœºéƒ¨ç½²æ¨¡å¼ä¸‹ï¼Œéœ€è¦å…³æ³¨ <code>DumpService</code> å¯¹è¿™ä¸ªäº‹ä»¶çš„æ¶ˆè´¹ï¼Œå®ƒä¼šæ‰§è¡Œ <code>DumpService#handleConfigDataChange</code> æ–¹æ³•ï¼Œå°†é…ç½®å˜æ›´äº‹ä»¶è½¬æ¢ä¸ºé…ç½®è½¬å‚¨ä»»åŠ¡ <code>DumpTask</code>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ç›‘å¬å¹¶å¤„ç† ConfigDataChangeEvent äº‹ä»¶
 * å°† ConfigDataChangeEvent è½¬æ¢ä¸º DumpRequestï¼Œäº¤ç»™ DumpProcessor å¤„ç†
 * ä½œç”¨ï¼šå°†é…ç½®å˜æ›´äº‹ä»¶è½¬æ¢ä¸ºé…ç½®è½¬å‚¨ä»»åŠ¡ï¼Œæ›´æ–°æœ¬åœ°ç¼“å­˜
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DumpService</span> {

    <span class="hljs-keyword">private</span> TaskManager dumpTaskMgr;
    
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleConfigDataChange</span><span class="hljs-params">(Event event)</span> {
        <span class="hljs-comment">// Generate ConfigDataChangeEvent concurrently</span>
        <span class="hljs-keyword">if</span> (event <span class="hljs-keyword">instanceof</span> ConfigDataChangeEvent) {
            <span class="hljs-type">ConfigDataChangeEvent</span> <span class="hljs-variable">evt</span> <span class="hljs-operator">=</span> (ConfigDataChangeEvent) event;
            <span class="hljs-type">DumpRequest</span> <span class="hljs-variable">dumpRequest</span> <span class="hljs-operator">=</span> DumpRequest.create(evt.dataId, evt.group, evt.tenant, evt.lastModifiedTs,
                    NetUtils.localIp());
            dumpRequest.setGrayName(evt.grayName);
            <span class="hljs-comment">// æ‰§è¡Œ dump è½¬å‚¨æ“ä½œï¼Œç”± DumpProcessor å¤„ç†</span>
            DumpService.<span class="hljs-built_in">this</span>.dump(dumpRequest);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dump</span><span class="hljs-params">(DumpRequest dumpRequest)</span> {
        dumpFormal(dumpRequest.getDataId(), dumpRequest.getGroup(), dumpRequest.getTenant(),
                    dumpRequest.getLastModifiedTs(), dumpRequest.getSourceIp());
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dumpFormal</span><span class="hljs-params">(String dataId, String group, String tenant, <span class="hljs-type">long</span> lastModified, String handleIp)</span> {
        <span class="hljs-comment">// ç”Ÿæˆ Task çš„ Key å€¼ï¼Œæ ¼å¼ä¸ºï¼šdataId+group+tenant </span>
        <span class="hljs-comment">// eg: default_config+DEFAULT_GROUP+public å…¶ä¸­ default_config ä¸ºé…ç½®çš„åç§°ï¼ŒDEFAULT_GROUP ä¸ºåˆ†ç»„IDï¼Œpublic ä¸ºå‘½åç©ºé—´ID</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">groupKey</span> <span class="hljs-operator">=</span> GroupKey2.getKey(dataId, group, tenant);
        <span class="hljs-type">String</span> <span class="hljs-variable">taskKey</span> <span class="hljs-operator">=</span> groupKey;
        <span class="hljs-comment">// ç”Ÿæˆè½¬å‚¨ä»»åŠ¡ DumpTask</span>
        dumpTaskMgr.addTask(taskKey, <span class="hljs-keyword">new</span> <span class="hljs-title class_">DumpTask</span>(groupKey, <span class="hljs-literal">null</span>, lastModified, handleIp));
        DUMP_LOG.info(<span class="hljs-string">"[dump] add formal task. groupKey={}"</span>, groupKey);

    }
}
</code></pre>
<p>è°ƒç”¨ <code>TaskManager#addTask</code> æ–¹æ³•æ·»åŠ é…ç½®è½¬å‚¨ä»»åŠ¡ <code>DumpTask</code>ï¼Œæœ€ç»ˆä¼šæ‰§è¡Œä»¥ä¸‹é€»è¾‘ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NacosDelayTaskExecuteEngine</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractNacosTaskExecuteEngine</span>&lt;AbstractDelayTask&gt; {

    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();

    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;Object, AbstractDelayTask&gt; tasks;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addTask</span><span class="hljs-params">(Object key, AbstractDelayTask newTask)</span> {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">AbstractDelayTask</span> <span class="hljs-variable">existTask</span> <span class="hljs-operator">=</span> tasks.get(key);
            <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != existTask) {
                newTask.merge(existTask);
            }
            tasks.put(key, newTask);
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
}
</code></pre>
<p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<ol>
<li><code>ReentrantLock lock</code> å˜é‡ï¼šåœ¨å‘ <code>ConcurrentHashMap&lt;Object, AbstractDelayTask&gt; tasks</code> æ·»åŠ ä»»åŠ¡æ—¶æ‰§è¡Œäº†åŠ é”æ“ä½œ</li>
<li><code>ConcurrentHashMap&lt;Object, AbstractDelayTask&gt; tasks</code> å˜é‡ï¼šè¯¥å˜é‡æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œä½†æ˜¯ä»ç„¶åœ¨æ“ä½œå‰æ‰§è¡Œäº†åŠ é”æ“ä½œ</li>
</ol>
<p>å› ä¸º <code>AbstractDelayTask#merge</code> æ–¹æ³•å¹¶ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œå¤šçº¿ç¨‹æ“ä½œæ—¶å¯èƒ½å‘ç”ŸæœªçŸ¥çš„æƒ…å†µï¼Œæ‰€ä»¥ä¾¿éœ€è¦æ³¨æ„ä»¥ä¸Šä¸¤ç‚¹ã€‚ç°åœ¨ï¼Œè½¬å‚¨ä»»åŠ¡ <code>DumpTask</code> å·²ç»è¢«æ·»åŠ åˆ° <code>ConcurrentHashMap&lt;Object, AbstractDelayTask&gt; tasks</code> ä¸­äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªä»»åŠ¡æ˜¯å¦‚ä½•è¢«æ‰§è¡Œçš„å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ <code>NacosDelayTaskExecuteEngine</code> çš„æ„é€ æ–¹æ³•ï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­åˆ›å»ºäº† <code>ScheduledExecutorService processingExecutor</code> å˜é‡ç”¨äºå®šæœŸï¼ˆ100msï¼‰æ‰§è¡Œ <code>ProcessRunnable</code> ä»»åŠ¡ï¼Œ<code>ProcessRunnable</code> æ˜¯é™æ€å†…éƒ¨ç±»ï¼Œè°ƒç”¨ <code>processTasks</code> æ–¹æ³•æ¥å¤„ç†ä»»åŠ¡ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NacosDelayTaskExecuteEngine</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractNacosTaskExecuteEngine</span>&lt;AbstractDelayTask&gt; {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ScheduledExecutorService processingExecutor;

    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;Object, AbstractDelayTask&gt; tasks;

    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    
    <span class="hljs-comment">// processInterval å¤„ç†é—´éš”é»˜è®¤å€¼ä¸º 100ms</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">NacosDelayTaskExecuteEngine</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> initCapacity, Logger logger, <span class="hljs-type">long</span> processInterval)</span> {
        <span class="hljs-built_in">super</span>(logger);
        tasks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;(initCapacity);
        processingExecutor = ExecutorFactory.newSingleScheduledExecutorService(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NameThreadFactory</span>(name));
        processingExecutor.scheduleWithFixedDelay(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ProcessRunnable</span>(), processInterval, processInterval, TimeUnit.MILLISECONDS);
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProcessRunnable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">try</span> {
                processTasks();
            } <span class="hljs-keyword">catch</span> (Throwable e) {
                getEngineLog().error(e.toString(), e);
            }
        }
    }

    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processTasks</span><span class="hljs-params">()</span> {
        Collection&lt;Object&gt; keys = getAllTaskKeys();
        <span class="hljs-keyword">for</span> (Object taskKey : keys) {
            <span class="hljs-comment">// é€ä¸ªåˆ é™¤è€Œä¸æ˜¯åœ¨ä¸Šé¢ç»Ÿä¸€åˆ é™¤ï¼Œåˆ é™¤çš„æ—¶å€™è€Œä¸”åŠ äº†é”ï¼Œè¿™æ ·å³ä½¿è¢«å¤šä¸ªçº¿ç¨‹æ‹¿åˆ°å¤šä¸ª Keyï¼Œä¹Ÿèƒ½é€šè¿‡åŠ é”é¿å…æ‰§è¡Œé‡å¤çš„ä»»åŠ¡</span>
            <span class="hljs-type">AbstractDelayTask</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> removeTask(taskKey);
            <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == task) {
                <span class="hljs-keyword">continue</span>;
            }
            <span class="hljs-comment">// æ­¤å¤„ä½¿ç”¨äº†ç­–ç•¥æ¨¡å¼ï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒçš„ key æ¥å®šä¹‰ä¸åŒçš„å¤„ç†ç­–ç•¥ï¼Œè¿™é‡Œé»˜è®¤ä½¿ç”¨äº† DumpProcessor</span>
            <span class="hljs-type">NacosTaskProcessor</span> <span class="hljs-variable">processor</span> <span class="hljs-operator">=</span> getProcessor(taskKey);
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// å¤„ç†å¤±è´¥æˆ–è€…æŠ›å‡ºå¼‚å¸¸éƒ½ä¼šé‡è¯•</span>
                <span class="hljs-keyword">if</span> (!processor.process(task)) {
                    retryFailedTask(taskKey, task);
                }
            } <span class="hljs-keyword">catch</span> (Throwable e) {
                getEngineLog().error(<span class="hljs-string">"Nacos task execute error "</span>, e);
                retryFailedTask(taskKey, task);
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">retryFailedTask</span><span class="hljs-params">(Object key, AbstractDelayTask task)</span> {
        task.setLastProcessTime(System.currentTimeMillis());
        <span class="hljs-comment">// é‡æ–°è°ƒç”¨ä¸Šæ–‡ä¸­çš„ NacosDelayTaskExecuteEngine#addTask æ–¹æ³•</span>
        addTask(key, task);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Collection&lt;Object&gt; <span class="hljs-title function_">getAllTaskKeys</span><span class="hljs-params">()</span> {
        Collection&lt;Object&gt; keys = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// å°† DumpService æ‰§è¡Œæ—¶æ·»åŠ çš„ Key åœ¨è¿™é‡Œè·å–ï¼Œä½†æ²¡æœ‰åˆ é™¤æ“ä½œï¼Œè€Œæ˜¯åœ¨åç»­çš„æ­¥éª¤ä¸­éå†ä¸€ä¸ªåŠ é”åˆ é™¤ä¸€ä¸ª</span>
            keys.addAll(tasks.keySet());
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
        <span class="hljs-keyword">return</span> keys;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> AbstractDelayTask <span class="hljs-title function_">removeTask</span><span class="hljs-params">(Object key)</span> {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">AbstractDelayTask</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> tasks.get(key);
            <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != task &amp;&amp; task.shouldProcess()) {
                <span class="hljs-keyword">return</span> tasks.remove(key);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
            }
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
}
</code></pre>
<p>åœ¨ä¸Šè¿°é€»è¾‘ä¸­ï¼Œ<code>getAllTaskKeys</code> å’Œ <code>removeTask</code> æ–¹æ³•ä¸­ä»ç„¶ä½¿ç”¨äº† <code>ReentrantLock</code> åŠ é”ï¼Œä½†æ˜¯åœ¨è¿™ä¸¤ä¸ªæ–¹æ³•ä¸­éƒ½æ˜¯è¯»æ“ä½œï¼Œè€Œä¸”æ˜¯å®šæ—¶çº¿ç¨‹æ± å®šæœŸæ‰§è¡Œï¼Œå‘ç”Ÿå¹¶å‘é—®é¢˜çš„æ¦‚ç‡éå¸¸å°ï¼Œå®é™…ä¸Šæˆ‘è®¤ä¸ºå¯ä»¥é‡‡ç”¨ä¸åŠ é”çš„æ–¹æ¡ˆï¼Œæˆ–è€…å¯ä»¥è€ƒè™‘å°† <code>ConcurrentHashMap</code> æ¢æˆ <code>ConcurrentLinkedDeque</code> é˜Ÿåˆ—ï¼Œä»»åŠ¡åœ¨é˜Ÿåˆ—å°¾éƒ¨æ·»åŠ ï¼Œæ¯æ¬¡çº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡æ—¶ç›´æ¥å°†é˜Ÿåˆ—å¤´éƒ¨çš„ä»»åŠ¡å–å‡ºï¼Œ<strong>æ‰§è¡Œå¤±è´¥æˆ–è€…ä¸æ»¡è¶³æ‰§è¡Œæ¡ä»¶å†å°†å®ƒæ”¾å›åˆ°é˜Ÿåˆ—ä¸­</strong>ã€‚ä¸è¿‡ï¼Œè¿™ç§å¼‚æ­¥æ‰§è¡Œä»»åŠ¡çš„å¤šçº¿ç¨‹è®¾è®¡é‡‡ç”¨çš„æ˜¯ <strong>â€œç”Ÿäº§è€…æ¶ˆè´¹è€…â€æ¨¡å¼</strong>ï¼Œè¿™ç§è®¾è®¡æ–¹æ³•è¿˜æ˜¯éå¸¸å€¼å¾—å­¦ä¹ çš„ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹ <code>DumpProcessor#process</code> æ–¹æ³•ä¸­ï¼Œåˆ°åº•æ‰§è¡Œäº†ä»€ä¹ˆé€»è¾‘ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯å‚æ•°èµ‹å€¼ï¼Œé‡ç‚¹æ˜¯ <strong>ä»æ•°æ®åº“ä¸­å°†é…ç½®æŸ¥è¯¢å‡ºæ¥</strong> åï¼Œæ‰§è¡Œäº† <code>DumpConfigHandler#configDump</code> æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DumpProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NacosTaskProcessor</span> {

    <span class="hljs-keyword">final</span> ConfigInfoPersistService configInfoPersistService;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">process</span><span class="hljs-params">(NacosTask task)</span> {
        <span class="hljs-type">DumpTask</span> <span class="hljs-variable">dumpTask</span> <span class="hljs-operator">=</span> (DumpTask) task;
        String[] pair = GroupKey2.parseKey(dumpTask.getGroupKey());
        <span class="hljs-type">String</span> <span class="hljs-variable">dataId</span> <span class="hljs-operator">=</span> pair[<span class="hljs-number">0</span>];
        <span class="hljs-type">String</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> pair[<span class="hljs-number">1</span>];
        <span class="hljs-type">String</span> <span class="hljs-variable">tenant</span> <span class="hljs-operator">=</span> pair[<span class="hljs-number">2</span>];
        <span class="hljs-type">long</span> <span class="hljs-variable">lastModifiedOut</span> <span class="hljs-operator">=</span> dumpTask.getLastModified();
        <span class="hljs-type">String</span> <span class="hljs-variable">handleIp</span> <span class="hljs-operator">=</span> dumpTask.getHandleIp();
        <span class="hljs-type">String</span> <span class="hljs-variable">grayName</span> <span class="hljs-operator">=</span> dumpTask.getGrayName();

        ConfigDumpEvent.<span class="hljs-type">ConfigDumpEventBuilder</span> <span class="hljs-variable">build</span> <span class="hljs-operator">=</span> ConfigDumpEvent.builder().namespaceId(tenant).dataId(dataId)
                .group(group).grayName(grayName).handleIp(handleIp);
        <span class="hljs-type">String</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> <span class="hljs-string">"formal"</span>;
        
        <span class="hljs-comment">// ä»æ•°æ®åº“è¯»å–é…ç½®ä¿¡æ¯ï¼Œæ„å»º ConfigDumpEvent äº‹ä»¶</span>
        <span class="hljs-type">ConfigInfoWrapper</span> <span class="hljs-variable">cf</span> <span class="hljs-operator">=</span> configInfoPersistService.findConfigInfo(dataId, group, tenant);
        build.remove(Objects.isNull(cf));
        build.content(Objects.isNull(cf) ? <span class="hljs-literal">null</span> : cf.getContent());
        build.type(Objects.isNull(cf) ? <span class="hljs-literal">null</span> : cf.getType());
        build.encryptedDataKey(Objects.isNull(cf) ? <span class="hljs-literal">null</span> : cf.getEncryptedDataKey());
        build.lastModifiedTs(Objects.isNull(cf) ? lastModifiedOut : cf.getLastModified());
        <span class="hljs-keyword">return</span> DumpConfigHandler.configDump(build.build());
    }
}
</code></pre>
<p>ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œçœç•¥ä¸€ç³»åˆ—ä¸é‡è¦çš„æºç ï¼Œæœ€ç»ˆä¼šæ‰§è¡Œåˆ° <code>ConfigCacheService#dumpWithMd5</code> æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä¿®æ”¹ç¼“å­˜å‰ä¼šæ·»åŠ å†™é” <code>tryWriteLock</code>ï¼Œæ·»åŠ å†™é”æˆåŠŸåæ‰èƒ½ç»§ç»­å¤„ç†ï¼Œåç»­å¤„ç†é€»è¾‘ä¸­æœ‰ä¸¤æ­¥æ¯”è¾ƒé‡è¦ï¼š<strong>â€œå†™å…¥åˆ°æœ¬åœ°æ–‡ä»¶â€</strong> å’Œ <strong>â€œæ›´æ–° JVM æœ¬åœ°ç¼“å­˜å¯¹è±¡â€</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigCacheService</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">dumpWithMd5</span><span class="hljs-params">(String dataId, String group, String tenant, String content, String md5,
                                      <span class="hljs-type">long</span> lastModifiedTs, String type, String encryptedDataKey)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">groupKey</span> <span class="hljs-operator">=</span> GroupKey2.getKey(dataId, group, tenant);
        <span class="hljs-type">CacheItem</span> <span class="hljs-variable">ci</span> <span class="hljs-operator">=</span> makeSure(groupKey, encryptedDataKey);
        ci.setType(type);
        <span class="hljs-comment">// å¯¹æŸä¸ªç¼“å­˜çš„æ“ä½œæ·»åŠ äº†å†™é”</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">lockResult</span> <span class="hljs-operator">=</span> tryWriteLock(groupKey);

        <span class="hljs-keyword">if</span> (lockResult &lt; <span class="hljs-number">0</span>) {
            DUMP_LOG.warn(<span class="hljs-string">"[dump-error] write lock failed. {}"</span>, groupKey);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ ¡éªŒä¿®æ”¹æ—¶é—´</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">lastModifiedOutDated</span> <span class="hljs-operator">=</span> lastModifiedTs &lt; ConfigCacheService.getLastModifiedTs(groupKey);
            <span class="hljs-keyword">if</span> (lastModifiedOutDated) {
                DUMP_LOG.warn(<span class="hljs-string">"[dump-ignore] timestamp is outdated,groupKey={}"</span>, groupKey);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }

            <span class="hljs-type">boolean</span> <span class="hljs-variable">newLastModified</span> <span class="hljs-operator">=</span> lastModifiedTs &gt; ConfigCacheService.getLastModifiedTs(groupKey);

            <span class="hljs-keyword">if</span> (md5 == <span class="hljs-literal">null</span>) {
                md5 = MD5Utils.md5Hex(content, PERSIST_ENCODE);
            }

            <span class="hljs-comment">// 1. å†™å…¥åˆ°æœ¬åœ°æ–‡ä»¶ä¸­</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">localContentMd5</span> <span class="hljs-operator">=</span> ConfigCacheService.getContentMd5(groupKey);
            <span class="hljs-type">boolean</span> <span class="hljs-variable">md5Changed</span> <span class="hljs-operator">=</span> !md5.equals(localContentMd5);
            <span class="hljs-keyword">if</span> (md5Changed) {
                DUMP_LOG.info(<span class="hljs-string">"[dump] md5 changed, save to disk cache ,groupKey={}, newMd5={},oldMd5={}"</span>, groupKey, md5, localContentMd5);
                ConfigDiskServiceFactory.getInstance().saveToDisk(dataId, group, tenant, content);
            } <span class="hljs-keyword">else</span> {
                DUMP_LOG.warn(<span class="hljs-string">"[dump-ignore] ignore to save to disk cache. md5 consistent,groupKey={}, md5={}"</span>, groupKey, md5);
            }

            <span class="hljs-comment">// 2. æ›´æ–° JVM æœ¬åœ°ç¼“å­˜å¯¹è±¡ CacheItem</span>
            <span class="hljs-keyword">if</span> (md5Changed) {
                DUMP_LOG.info(
                        <span class="hljs-string">"[dump] md5 changed, update md5 and timestamp in jvm cache ,groupKey={}, newMd5={},oldMd5={},lastModifiedTs={}"</span>,
                        groupKey, md5, localContentMd5, lastModifiedTs);
                updateMd5(groupKey, md5, content, lastModifiedTs, encryptedDataKey);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (newLastModified) {
                DUMP_LOG.info(
                        <span class="hljs-string">"[dump] md5 consistent ,timestamp changed, update timestamp only in jvm cache ,groupKey={},lastModifiedTs={}"</span>,
                        groupKey, lastModifiedTs);
                updateTimeStamp(groupKey, lastModifiedTs, encryptedDataKey);
            } <span class="hljs-keyword">else</span> {
                DUMP_LOG.warn(
                        <span class="hljs-string">"[dump-ignore] ignore to save to jvm cache. md5 consistent and no new timestamp changed.groupKey={}"</span>,
                        groupKey);
            }

            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">catch</span> (IOException ioe) {
            DUMP_LOG.error(<span class="hljs-string">"[dump-exception] save disk error. "</span> + groupKey + <span class="hljs-string">", "</span> + ioe);
            <span class="hljs-keyword">if</span> (ioe.getMessage() != <span class="hljs-literal">null</span>) {
                <span class="hljs-type">String</span> <span class="hljs-variable">errMsg</span> <span class="hljs-operator">=</span> ioe.getMessage();
                <span class="hljs-keyword">if</span> (errMsg.contains(NO_SPACE_CN) || errMsg.contains(NO_SPACE_EN) || errMsg.contains(DISK_QUOTA_CN)
                        || errMsg.contains(DISK_QUOTA_EN)) {
                    <span class="hljs-comment">// Protect from disk full.</span>
                    FATAL_LOG.error(<span class="hljs-string">"Local Disk Full,Exit"</span>, ioe);
                    EnvUtil.systemExit();
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        } <span class="hljs-keyword">finally</span> {
            releaseWriteLock(groupKey);
        }
    }
    
}
</code></pre>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ â€œå†™å…¥åˆ°æœ¬åœ°æ–‡ä»¶â€ çš„é€»è¾‘ï¼Œå®ƒæœ€ç»ˆä¼šæ‰§è¡Œåˆ° <code>ConfigDiskService#saveToDisk</code> æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigRawDiskService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ConfigDiskService</span> {
    
    <span class="hljs-comment">// å°†é…ç½®ä¿¡æ¯å†™å…¥ç£ç›˜æ–‡ä»¶</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveToDisk</span><span class="hljs-params">(String dataId, String group, String tenant, String content)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">File</span> <span class="hljs-variable">targetFile</span> <span class="hljs-operator">=</span> targetFile(dataId, group, tenant);
        FileUtils.writeStringToFile(targetFile, content, ENCODE_UTF8);
    }
}
</code></pre>
<p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œå®ƒä¼šå°†é…ç½®ä¿¡æ¯å†™å…¥ç£ç›˜æ–‡ä»¶ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š<strong>Nacos é…ç½®å˜æ›´åï¼Œä¼šå¼‚æ­¥å°†é…ç½®ä¿¡æ¯å†™å…¥ç£ç›˜æ–‡ä»¶</strong>ã€‚è¿™ä¸ªæ–‡ä»¶ä½•æ—¶è¢«è¯»å–æˆ‘ä»¬å…ˆä¸å…³æ³¨ï¼Œæˆ‘ä»¬å…ˆæ¥è€ƒè™‘ä¸€ä¸‹ï¼Œå¦‚æœé…ç½®å˜æ›´åœ¨å†™å…¥æ•°æ®åº“æˆåŠŸåï¼ŒæœåŠ¡ç«‹å³å®•æœºï¼Œä¹Ÿå°±æ˜¯è¯´ç£ç›˜æ–‡ä»¶è¿˜æ²¡æœ‰æ¥å¾—åŠå†™å…¥ï¼Œé‚£ä¹ˆç£ç›˜æ–‡ä»¶çš„æ•°æ®è¯¥å¦‚ä½•å’Œæ•°æ®åº“æ•°æ®ä¿æŒä¸€è‡´å‘¢ï¼Ÿ</p>
<p>Nacos å€ŸåŠ© <code>@PostConstruct</code> æ³¨è§£ï¼Œåœ¨æœåŠ¡å¯åŠ¨æ—¶ï¼Œä¼šæ‰§è¡Œ <code>DumpService#dumpOperate</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„æºç å°±ä¸åœ¨è¿™é‡Œè´´äº†ï¼Œå®ƒæœ€ç»ˆä¼šæ‰§è¡Œåˆ° <code>DumpAllProcessor#process</code> æ–¹æ³•ï¼Œåˆ†é¡µæŸ¥è¯¢å‡ºæ‰€æœ‰çš„é…ç½®ä¿¡æ¯ï¼Œé€ä¸€å¼‚æ­¥å†™å…¥æœ¬åœ°ç£ç›˜æ–‡ä»¶ä¸­ï¼Œè¿™æ ·å°±ä¿è¯äº†ç£ç›˜æ–‡ä»¶å’Œæ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ â€œæ›´æ–° JVM æœ¬åœ°ç¼“å­˜å¯¹è±¡â€ çš„é€»è¾‘ï¼Œè¿™æ®µé€»è¾‘å¹¶ä¸å¤æ‚ï¼Œé¦–å…ˆå®ƒéœ€è¦ä¿è¯åœ¨ JVM æœ¬åœ°ç¼“å­˜ä¸­åˆ›å»ºäº† <code>CacheItem</code> æœ¬åœ°ç¼“å­˜å¯¹è±¡ï¼Œç„¶ååˆ›å»º <code>ConfigCache</code> å¯¹è±¡è®°å½•å¿…è¦çš„ä¿¡æ¯ï¼Œæ³¨æ„åœ¨è¿™æ®µé€»è¾‘ä¸­ï¼Œå¹¶æ²¡æœ‰ä¸ºé…ç½®çš„å†…å®¹ <code>content</code> å®šä¹‰å­—æ®µä¿å­˜ï¼Œè¿™äº›é€»è¾‘å®Œæˆåï¼Œå‘é€äº† <code>LocalDataChangeEvent</code> äº‹ä»¶ï¼š</p>
<blockquote>
<p>å‘é€ <code>LocalDataChangeEvent</code> äº‹ä»¶çš„é€»è¾‘æ¯”è¾ƒéšè”½ï¼Œå°±åƒåˆ†å¸ƒå¼äº‹åŠ¡ä¸­ååŒå¼ Saga çš„è®¾è®¡æ¨¡å¼ï¼ˆå‚è§ã€Šå¾®æœåŠ¡è®¾è®¡æ¨¡å¼ã€‹ï¼‰ï¼Œä¸€ä¸ªäº‹ä»¶å¤„ç†å®Œæˆå†å»å¤„ç†ä¸‹ä¸€ä¸ªäº‹ä»¶ï¼Œè¿™ä½¿å¾—ä»£ç çš„å¤æ‚åº¦å¢åŠ ã€‚</p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigCacheService</span> {

    <span class="hljs-comment">/**
     * groupKey -&gt; cacheItem.
     */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;String, CacheItem&gt; CACHE = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateMd5</span><span class="hljs-params">(String groupKey, String md5, String content, <span class="hljs-type">long</span> lastModifiedTs, String encryptedDataKey)</span> {
        <span class="hljs-type">CacheItem</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> makeSure(groupKey, encryptedDataKey);
        <span class="hljs-type">ConfigCache</span> <span class="hljs-variable">configCache</span> <span class="hljs-operator">=</span> cache.getConfigCache();
        <span class="hljs-keyword">if</span> (configCache.getMd5() == <span class="hljs-literal">null</span> || !configCache.getMd5().equals(md5)) {
            configCache.setMd5(md5);
            configCache.setLastModifiedTs(lastModifiedTs);
            configCache.setEncryptedDataKey(encryptedDataKey);
            ConfigCachePostProcessorDelegate.getInstance().postProcess(configCache, content);
            <span class="hljs-comment">// æ›´æ–°æœ¬åœ° JVM ç¼“å­˜åï¼Œå‘å¸ƒ LocalDataChangeEvent äº‹ä»¶</span>
            NotifyCenter.publishEvent(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalDataChangeEvent</span>(groupKey));
        }
    }

    <span class="hljs-keyword">static</span> CacheItem <span class="hljs-title function_">makeSure</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String groupKey, <span class="hljs-keyword">final</span> String encryptedDataKey)</span> {
        <span class="hljs-type">CacheItem</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> CACHE.get(groupKey);
        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != item) {
            <span class="hljs-keyword">return</span> item;
        }
        <span class="hljs-type">CacheItem</span> <span class="hljs-variable">tmp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheItem</span>(groupKey, encryptedDataKey);
        item = CACHE.putIfAbsent(groupKey, tmp);
        <span class="hljs-keyword">return</span> (<span class="hljs-literal">null</span> == item) ? tmp : item;
    }
}
</code></pre>
<p>ç°åœ¨ï¼Œé…ç½®å˜æ›´å·²ç»æˆåŠŸå†™å…¥æ•°æ®åº“ã€ç£ç›˜æ–‡ä»¶å’Œ JVM å†…å­˜ï¼Œä¿è¯äº†åœ¨ Nacos Server ç«¯é…ç½®æ•°æ®çš„ä¸€è‡´æ€§ã€‚æ¥ä¸‹æ¥ä¾¿æ˜¯ç”± Nacos Server æ¨é€ç»™ Nacos Client çš„æµç¨‹ï¼Œè¿™ä¸ªé€»è¾‘ä¾¿æ˜¯åœ¨ <code>LocalDataChangeEvent</code> äº‹ä»¶çš„å¤„ç†é€»è¾‘ä¸­å®Œæˆçš„ï¼Œ<code>RpcConfigChangeNotifier#onEvent</code> æ–¹æ³•ä¼šç›‘å¬ <code>LocalDataChangeEvent</code> äº‹ä»¶ï¼Œå¹¶æ‰§è¡Œ <code>configDataChanged</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬åˆ†æ®µæ¥çœ‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RpcConfigChangeNotifier</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Subscriber</span>&lt;LocalDataChangeEvent&gt; {

    <span class="hljs-meta">@Autowired</span>
    ConfigChangeListenContext configChangeListenContext;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ConnectionManager connectionManager;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onEvent</span><span class="hljs-params">(LocalDataChangeEvent event)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">groupKey</span> <span class="hljs-operator">=</span> event.groupKey;

        String[] strings = GroupKey.parseKey(groupKey);
        <span class="hljs-type">String</span> <span class="hljs-variable">dataId</span> <span class="hljs-operator">=</span> strings[<span class="hljs-number">0</span>];
        <span class="hljs-type">String</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> strings[<span class="hljs-number">1</span>];
        <span class="hljs-type">String</span> <span class="hljs-variable">tenant</span> <span class="hljs-operator">=</span> strings.length &gt; <span class="hljs-number">2</span> ? strings[<span class="hljs-number">2</span>] : <span class="hljs-string">""</span>;

        <span class="hljs-comment">// ç›‘å¬LocalDataChangeEventäº‹ä»¶ï¼Œé€šè¿‡ gRPC åŒå‘æµæ¨é€é…ç½®å˜æ›´é€šçŸ¥åˆ°å®¢æˆ·ç«¯</span>
        configDataChanged(groupKey, dataId, group, tenant);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configDataChanged</span><span class="hljs-params">(String groupKey, String dataId, String group, String tenant)</span> {
        <span class="hljs-comment">// è·å–æ‰€æœ‰ç›‘å¬è¯¥é…ç½®çš„å®¢æˆ·ç«¯è¿æ¥</span>
        Set&lt;String&gt; listeners = configChangeListenContext.getListeners(groupKey);
        <span class="hljs-keyword">if</span> (CollectionUtils.isEmpty(listeners)) {
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-type">int</span> <span class="hljs-variable">notifyClientCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> String client : listeners) {
            <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> connectionManager.getConnection(client);
            <span class="hljs-keyword">if</span> (connection == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">continue</span>;
            }
            <span class="hljs-type">boolean</span> <span class="hljs-variable">ifNamespaceTransfer</span> <span class="hljs-operator">=</span> configChangeListenContext.getConfigListenState(client, groupKey).isNamespaceTransfer();
            <span class="hljs-keyword">if</span> (ifNamespaceTransfer) {
                tenant = <span class="hljs-literal">null</span>;
            }
            <span class="hljs-type">ConnectionMeta</span> <span class="hljs-variable">metaInfo</span> <span class="hljs-operator">=</span> connection.getMetaInfo();
            <span class="hljs-type">String</span> <span class="hljs-variable">clientIp</span> <span class="hljs-operator">=</span> metaInfo.getClientIp();

            <span class="hljs-comment">// æ„å»º ConfigChangeNotifyRequest è¯·æ±‚ï¼ŒåŒ…å«å˜æ›´çš„é…ç½®ä¿¡æ¯</span>
            <span class="hljs-type">ConfigChangeNotifyRequest</span> <span class="hljs-variable">notifyRequest</span> <span class="hljs-operator">=</span> ConfigChangeNotifyRequest.build(dataId, group, tenant);

            <span class="hljs-comment">// åˆ›å»º RpcPushTask å¼‚æ­¥æ¨é€ä»»åŠ¡ï¼Œæ”¯æŒé‡è¯•æœºåˆ¶</span>
            <span class="hljs-type">RpcPushTask</span> <span class="hljs-variable">rpcPushRetryTask</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RpcPushTask</span>(notifyRequest,
                    ConfigCommonConfig.getInstance().getMaxPushRetryTimes(), client, clientIp, metaInfo.getAppName());
            <span class="hljs-comment">// å¼‚æ­¥æ¨é€é€šçŸ¥</span>
            push(rpcPushRetryTask, connectionManager);
            notifyClientCount++;
        }
    }

    <span class="hljs-comment">// å¤„ç†æ¨é€ä»»åŠ¡é‡è¯•é€»è¾‘ï¼Œæ”¯æŒå»¶è¿Ÿé‡è¯•å’Œè¿æ¥ç®¡ç†</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">push</span><span class="hljs-params">(RpcPushTask retryTask, ConnectionManager connectionManager)</span> {
        <span class="hljs-type">ConfigChangeNotifyRequest</span> <span class="hljs-variable">notifyRequest</span> <span class="hljs-operator">=</span> retryTask.getNotifyRequest();
        <span class="hljs-keyword">if</span> (retryTask.isOverTimes()) {
            <span class="hljs-comment">// é‡è¯•æ¬¡æ•°è¶…é™ï¼Œæ³¨é”€å®¢æˆ·ç«¯è¿æ¥</span>
            connectionManager.unregister(retryTask.getConnectionId());
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (connectionManager.getConnection(retryTask.getConnectionId()) != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// å®¢æˆ·ç«¯è¿æ¥å­˜åœ¨ï¼Œå»¶è¿Ÿé‡è¯•æ¨é€ï¼ˆé¦–æ¬¡å»¶è¿Ÿ0sï¼Œç¬¬äºŒæ¬¡2sï¼Œç¬¬ä¸‰æ¬¡4sï¼‰ï¼Œ</span>
            <span class="hljs-comment">// æœ¬è´¨ä¸Šæ‰§è¡Œçš„æ˜¯ ScheduledExecutorService#schedule(Runnable command, long delay, TimeUnit unit); æ–¹æ³•</span>
            ConfigExecutor.scheduleClientConfigNotifier(retryTask, retryTask.getTryTimes() * <span class="hljs-number">2</span>, TimeUnit.SECONDS);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// å®¢æˆ·ç«¯å·²ç¦»çº¿ï¼Œå¿½ç•¥æ¨é€ä»»åŠ¡</span>
        }
    }
}
</code></pre>
<p>åœ¨ <code>configDataChanged</code> æ–¹æ³•ä¸­ï¼Œä¼šå…ˆè·å–å½“å‰è¿æ¥åˆ° Nacos Server çš„ æ‰€æœ‰è®¢é˜…æŸä¸ªé…ç½® <code>groupKey</code> çš„ Nacos Client è¿æ¥ï¼Œåˆ›å»º <code>RpcPushTask</code> å¼‚æ­¥æ¨é€ä»»åŠ¡ï¼Œå¹¶è°ƒç”¨ <code>push</code> æ–¹æ³•å¼‚æ­¥æ¨é€é…ç½®å˜æ›´é€šçŸ¥ï¼Œæ³¨æ„è¿™é‡Œæ‰§è¡Œé…ç½®æ¨é€ä»»åŠ¡æ—¶ï¼Œä½¿ç”¨çš„æ˜¯ <code>ScheduledExecutorService#schedule</code> å®ƒä¼šæ ¹æ®é‡è¯•æ¬¡æ•°æŒ‡å®šå»¶è¿Ÿæ¨é€æ—¶é—´ï¼Œé¦–æ¬¡æ¨é€æ˜¯ä¸å»¶è¿Ÿçš„ï¼Œå¦‚æœè¶…è¿‡é‡è¯•æ¬¡æ•°ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯æ— æ³•å“åº”ï¼Œåˆ™æ³¨é”€å®¢æˆ·ç«¯è¿æ¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹ <code>RpcPushTask</code> çš„é€»è¾‘ï¼Œå®ƒæ˜¯ <code>RpcConfigChangeNotifier</code> çš„å†…éƒ¨ç±»ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RpcConfigChangeNotifier</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Subscriber</span>&lt;LocalDataChangeEvent&gt; {
    
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">RpcPushTask</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {

        ConfigChangeNotifyRequest notifyRequest;

        <span class="hljs-type">int</span> maxRetryTimes;

        <span class="hljs-type">int</span> <span class="hljs-variable">tryTimes</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

        String connectionId;

        String clientIp;

        String appName;

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">RpcPushTask</span><span class="hljs-params">(ConfigChangeNotifyRequest notifyRequest, <span class="hljs-type">int</span> maxRetryTimes, String connectionId,
                           String clientIp, String appName)</span> {
            <span class="hljs-built_in">this</span>.notifyRequest = notifyRequest;
            <span class="hljs-built_in">this</span>.maxRetryTimes = maxRetryTimes;
            <span class="hljs-built_in">this</span>.connectionId = connectionId;
            <span class="hljs-built_in">this</span>.clientIp = clientIp;
            <span class="hljs-built_in">this</span>.appName = appName;
        }

        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isOverTimes</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> maxRetryTimes &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-built_in">this</span>.tryTimes &gt;= maxRetryTimes;
        }

        <span class="hljs-comment">// å¼‚æ­¥æ‰§è¡Œé…ç½®æ¨é€ä»»åŠ¡</span>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
            <span class="hljs-comment">// ç´¯åŠ æ¨é€é…ç½®çš„é‡è¯•æ¬¡æ•°</span>
            tryTimes++;
            <span class="hljs-type">TpsCheckRequest</span> <span class="hljs-variable">tpsCheckRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TpsCheckRequest</span>();

            tpsCheckRequest.setPointName(POINT_CONFIG_PUSH);
            <span class="hljs-keyword">if</span> (!tpsControlManager.check(tpsCheckRequest).isSuccess()) {
                <span class="hljs-comment">// TPSé™æµæ£€æŸ¥å¤±è´¥ï¼Œå»¶è¿Ÿé‡è¯•æ¨é€ä»»åŠ¡</span>
                push(<span class="hljs-built_in">this</span>, connectionManager);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// TPSæ£€æŸ¥é€šè¿‡ï¼Œé€šè¿‡ gRPC åŒå‘æµæ¨é€é…ç½®å˜æ›´é€šçŸ¥åˆ°å®¢æˆ·ç«¯</span>
                rpcPushService.pushWithCallback(connectionId, notifyRequest,
                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">RpcPushCallback</span>(<span class="hljs-built_in">this</span>, tpsControlManager, connectionManager),
                        ConfigExecutor.getClientConfigNotifierServiceExecutor());
            }
        }
    }
}
</code></pre>
<p><code>RpcPushTask#run</code> æ–¹æ³•ä¸­ä¼šå…ˆæ£€æŸ¥é™æµé…ç½®ï¼Œå¦‚æœé™æµæ£€æŸ¥é€šè¿‡ä¼šé€šè¿‡ gRPC æ¨é€é…ç½®å˜æ›´åˆ° Nacos Clientï¼Œå€ŸåŠ©çš„æ˜¯ gRPC çš„åŒå‘æµæ¥å£ï¼Œå¹¶æ ¹æ®ç»“æœè°ƒç”¨ <code>RpcPushCallback</code> ä¸­çš„å›è°ƒæ–¹æ³•ï¼Œ<code>RpcPushCallback</code> æ˜¯ <code>RpcConfigChangeNotifier</code> çš„å†…éƒ¨ç±»ã€‚å¦‚æœé…ç½®æ¨é€æˆåŠŸä¼šè®°å½•æ¨é€æˆåŠŸç»Ÿè®¡ï¼Œå¦åˆ™è°ƒç”¨ <code>RpcConfigChangeNotifier#push</code> æ–¹æ³•é‡è¯•æ¨é€é…ç½®ï¼Œå¦‚æœè¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆ3æ¬¡ï¼‰åˆ™æ³¨é”€æ‰å®¢æˆ·ç«¯ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RpcConfigChangeNotifier</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Subscriber</span>&lt;LocalDataChangeEvent&gt; {
    
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RpcPushCallback</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractPushCallBack</span> {

        RpcPushTask rpcPushTask;

        TpsControlManager tpsControlManager;

        ConnectionManager connectionManager;

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">RpcPushCallback</span><span class="hljs-params">(RpcPushTask rpcPushTask, TpsControlManager tpsControlManager,
                               ConnectionManager connectionManager)</span> {
            <span class="hljs-built_in">super</span>(<span class="hljs-number">3000L</span>);
            <span class="hljs-built_in">this</span>.rpcPushTask = rpcPushTask;
            <span class="hljs-built_in">this</span>.tpsControlManager = tpsControlManager;
            <span class="hljs-built_in">this</span>.connectionManager = connectionManager;
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">()</span> {
            <span class="hljs-comment">// å®¢æˆ·ç«¯æˆåŠŸæ¥æ”¶é…ç½®å˜æ›´é€šçŸ¥ï¼Œè®°å½•æ¨é€æˆåŠŸç»Ÿè®¡</span>
            <span class="hljs-type">TpsCheckRequest</span> <span class="hljs-variable">tpsCheckRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TpsCheckRequest</span>();
            tpsCheckRequest.setPointName(POINT_CONFIG_PUSH_SUCCESS);
            tpsControlManager.check(tpsCheckRequest);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFail</span><span class="hljs-params">(Throwable e)</span> {
            <span class="hljs-comment">// æ¨é€å¤±è´¥ï¼Œè®°å½•å¤±è´¥ç»Ÿè®¡å¹¶è¿›è¡Œé‡è¯•</span>
            <span class="hljs-type">TpsCheckRequest</span> <span class="hljs-variable">tpsCheckRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TpsCheckRequest</span>();
            tpsCheckRequest.setPointName(POINT_CONFIG_PUSH_FAIL);
            tpsControlManager.check(tpsCheckRequest);
            Loggers.REMOTE_PUSH.warn(<span class="hljs-string">"Push fail, dataId={}, group={}, tenant={}, clientId={}"</span>,
                    rpcPushTask.getNotifyRequest().getDataId(), rpcPushTask.getNotifyRequest().getGroup(),
                    rpcPushTask.getNotifyRequest().getTenant(), rpcPushTask.getConnectionId(), e);
            push(rpcPushTask, connectionManager);
        }
    }
}
</code></pre>
<p>æ³¨æ„ï¼Œ<code>RpcPushTask</code> åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­éƒ½æ˜¯æ²¡æœ‰è¢«æŒä¹…åŒ–çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€æ—¦åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”ŸæœåŠ¡å®•æœºï¼Œè¿™äº›ä»»åŠ¡ä¹Ÿä¼šä¸¢å¤±ï¼Œæ²¡æœ‰åŠæ³•é‡æ–°æ‹‰èµ·å‘è®¢é˜…é…ç½®çš„å®¢æˆ·ç«¯æ¨é€ï¼Œè¿™æ ·ä¼šä¸ä¼šå¯¼è‡´å®¢æˆ·ç«¯æ— æ³•æ”¶åˆ°é…ç½®å˜æ›´é€šçŸ¥å‘¢ï¼Ÿå®é™…ä¸Šæ˜¯ä¸ä¼šçš„ï¼Œé…ç½®å˜æ›´é™¤äº†æœåŠ¡ç«¯ä¼šä¸»åŠ¨æ¨é€ä»¥å¤–ï¼Œå®¢æˆ·ç«¯è¿˜å­˜åœ¨ä¸»åŠ¨æ‹‰å–çš„æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´ <strong>é…ç½®åŒæ­¥æ˜¯æ¨ã€æ‹‰ç»“åˆçš„</strong>ï¼Œä¿è¯å®¢æˆ·ç«¯èƒ½å¤ŸåŠæ—¶æ„ŸçŸ¥åˆ°é…ç½®å˜æ›´ï¼Œå®¢æˆ·ç«¯çš„å…·ä½“é€»è¾‘æˆ‘ä»¬åœ¨åæ–‡ä¸­å†è§£é‡Šã€‚</p>
<p>ä»¥ä¸Šæˆ‘ä»¬è®²è§£äº† Nacos Server å•æœºé‡‡ç”¨ MySQL æ•°æ®åº“éƒ¨ç½²æ—¶ï¼Œä¿è¯é…ç½®å˜æ›´é«˜å¯ç”¨çš„æœºåˆ¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†çœ‹ä¸€ä¸‹å½“é›†ç¾¤éƒ¨ç½²å¹¶ä½¿ç”¨å†…åµŒ Derby æ•°æ®åº“æ—¶ï¼Œä¿è¯é…ç½®å˜æ›´é«˜å¯ç”¨çš„å®ç°ã€‚</p>
<h4 data-id="heading-2">é›†ç¾¤éƒ¨ç½²ï¼Œé‡‡ç”¨å†…åµŒ Derby æ•°æ®åº“</h4>
<p>Nacos Server åœ¨é›†ç¾¤æ¨¡å¼éƒ¨ç½²æ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ MySQL æ•°æ®åº“ï¼Œä¸è¿‡å› ä¸ºé›†ç¾¤æ¨¡å¼ä½¿ç”¨ MySQL æ•°æ®åº“ä¸å•æœºæ¨¡å¼ä½¿ç”¨ MySQL æ•°æ®åº“å¯¹æ•°æ®ä¸€è‡´æ€§çš„ä¿è¯æ²¡æœ‰åŒºåˆ«ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä¸å†è®¨è®ºè¿™ç§æƒ…å†µäº†ã€‚å€¼å¾—è®¨è®ºçš„æ˜¯ï¼šåœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼ŒNacos Server è¿˜æ”¯æŒä½¿ç”¨å†…åµŒæ•°æ®åº“ Derby éƒ¨ç½²ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼ŒNacos é‡‡ç”¨äº† Raft ç®—æ³•ä¿è¯äº†é›†ç¾¤çš„å¼ºä¸€è‡´æ€§ï¼ŒRaft ç®—æ³•çš„å®ç°å®ƒä½¿ç”¨çš„æ˜¯ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.sofastack.tech%2Fprojects%2Fsofa-jraft%2Foverview%2F" target="_blank" title="https://www.sofastack.tech/projects/sofa-jraft/overview/" ref="nofollow noopener noreferrer">å¼€æºé¡¹ç›® JRaft</a>ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šå…·ä½“è®²è§£ Raft ç®—æ³•çš„æµç¨‹ï¼Œå¦‚æœå¤§å®¶æ„Ÿå…´è¶£å¯ä»¥å‚è€ƒæ–‡ç«  <a href="https://juejin.cn/post/7544003305972088878" target="_blank" title="https://juejin.cn/post/7544003305972088878">æ·±å…¥ç†è§£åˆ†å¸ƒå¼å…±è¯†ç®—æ³• Raft</a>ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b3ead27e7f74c35b81d73b6b9f2f32b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pa55ZyG5oOz5b2T5Zu-54G1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763798468&amp;x-signature=xJTP5OB3SUsFHMDUO1dSn4GlaKc%3D" alt="image.png" loading="lazy"/></p>
<p>Nacos åœ¨é›†ç¾¤éƒ¨ç½²æ—¶ï¼Œåœ¨æ§åˆ¶å°è¿›è¡Œé…ç½®å˜æ›´åï¼Œ<strong>è¯·æ±‚åªä¼šæ‰“åˆ°å…¶ä¸­ä¸€å°æœåŠ¡ä¸Š</strong>ï¼Œåœ¨è¿™ä¸€å°æœåŠ¡ä¸Šä¼šè§¦å‘ JRaft ç®—æ³•æ¥å®Œæˆå„ä¸ªæœåŠ¡å†…çš„ Derby æ•°æ®çš„å†™å…¥ï¼ŒåŒæ ·åœ°ï¼Œä¸å†™å…¥ MySQL çš„æµç¨‹ä¸€è‡´ï¼Œåªæœ‰åœ¨ JRaft å†™å…¥æ‰§è¡ŒæˆåŠŸåæ‰èƒ½ç»§ç»­å¤„ç†ã€‚</p>
<p>åœ¨æ¥æ”¶åˆ°è¯·æ±‚çš„è¿™å°æœåŠ¡ä¸Šï¼Œå®ƒä¼šåƒå•æœºæ¨¡å¼ä¸€æ ·å‘é€ <code>ConfigDataChangeEvent</code> äº‹ä»¶ï¼Œè§¦å‘æ–‡ä»¶è½¬å­˜çš„æ“ä½œï¼Œå› ä¸ºè¿™éƒ¨åˆ†å†…å®¹æ˜¯é‡å¤çš„å°±ä¸å†èµ˜è¿°äº†ã€‚é›†ç¾¤æ¨¡å¼ä¸å•æœºæ¨¡å¼ä¸åŒçš„æ˜¯è¿˜æœ‰ä¸€ä¸ª <code>AsyncNotifyService</code> æœåŠ¡ä¼šç›‘å¬æ¶ˆè´¹ <code>ConfigDataChangeEvent</code> äº‹ä»¶ã€‚<code>AsyncNotifyService</code> çš„åŠŸèƒ½æ˜¯ <strong>é€šçŸ¥é›†ç¾¤å†…å…¶ä»–èŠ‚ç‚¹è§¦å‘æ–‡ä»¶è½¬å­˜çš„æ“ä½œ</strong>ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œå®ƒä¼šå°†é€šçŸ¥é›†ç¾¤å†…æ¯ä¸ªèŠ‚ç‚¹çš„è¯·æ±‚å°è£…æˆ <code>NotifySingleRpcTask</code>ï¼Œåˆ›å»ºæ‰€æœ‰èŠ‚ç‚¹çš„é€šçŸ¥ä»»åŠ¡åï¼Œæ‰“åŒ…åˆ›å»º <code>AsyncRpcTask</code> ä»»åŠ¡ï¼Œè¿™ä¸ªä»»åŠ¡ä¼šè¢«æ·»åŠ åˆ° <code>ScheduledExecutorService</code> çº¿ç¨‹æ± ä¸­ï¼Œç”±çº¿ç¨‹æ± å¼‚æ­¥å»¶æ—¶å¤„ç†ï¼Œå¦‚æœå‘ç”Ÿå¤„ç†å¤±è´¥çš„æƒ…å†µï¼Œä¼šé‡æ–°æäº¤åˆ°çº¿ç¨‹æ± ä¸­ï¼Œä½œä¸ºæ–°çš„ä»»åŠ¡è¿›è¡Œå¤„ç†ï¼Œä»¥æ­¤æ¥ä¿è¯é€šçŸ¥ä»»åŠ¡çš„å¤„ç†æˆåŠŸã€‚</p>
<p>ä»¥ä¸Šå°±æ˜¯ Nacos åœ¨é›†ç¾¤æ¨¡å¼ä¸‹é‡‡ç”¨ Derby æ•°æ®åº“æ—¶é…ç½®å˜æ›´çš„å¤„ç†æµç¨‹ï¼Œä¸‹é¢çš„å†…å®¹æˆ‘ä»¬æ ¹æ®æºç æ¥åˆ†æï¼šå½“åœ¨ Nacos æ§åˆ¶å°å¯¹é…ç½®è¿›è¡Œä¿®æ”¹æ—¶ï¼ŒNacos æ˜¯å¦‚ä½•å€ŸåŠ© JRaft ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„ã€‚</p>
<hr/>
<p>åŒæ ·åœ°ï¼Œ<code>ConsoleConfigController#publishConfig</code> æ–¹æ³•æ˜¯åœ¨ Nacos æ§åˆ¶å°ä¿®æ”¹é…ç½®çš„å…¥å£ï¼Œæ‰¿æ¥é…ç½®å˜æ›´çš„ POST è¯·æ±‚ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@NacosApi</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/v3/console/cs/config")</span>
<span class="hljs-meta">@ExtractorManager</span>.Extractor(httpExtractor = ConfigDefaultHttpParamExtractor.class)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsoleConfigController</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConfigProxy configProxy;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ConsoleConfigController</span><span class="hljs-params">(ConfigProxy configProxy)</span> {
        <span class="hljs-built_in">this</span>.configProxy = configProxy;
    }
    
    <span class="hljs-meta">@PostMapping()</span>
    <span class="hljs-meta">@Secured(action = ActionTypes.WRITE, signType = SignType.CONFIG, apiType = ApiType.CONSOLE_API)</span>
    <span class="hljs-keyword">public</span> Result&lt;Boolean&gt; <span class="hljs-title function_">publishConfig</span><span class="hljs-params">(HttpServletRequest request, ConfigFormV3 configForm)</span> <span class="hljs-keyword">throws</span> NacosException {
        <span class="hljs-comment">// ...</span>

        <span class="hljs-keyword">return</span> Result.success(configProxy.publishConfig(configForm, configRequestInfo));
    }
}
</code></pre>
<p>å› ä¸º Nacos Server å¯åŠ¨æ—¶é…ç½®å†…åµŒï¼ˆEmbeddedï¼‰æ•°æ®åº“ Derbyï¼Œæ‰€ä»¥å®ƒä¼šæ‰§è¡Œåˆ° <code>EmbeddedConfigInfoPersistServiceImpl</code> ç›¸å…³çš„æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä»¥å…¶ä¸­çš„ <code>EmbeddedConfigInfoPersistServiceImpl#updateConfigInfoCas</code> æ–¹æ³•ä¸ºä¾‹ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­æœ‰ä¸€ä¸ªç§æœ‰æ–¹æ³• <code>updateConfigInfoAtomicCas</code> ç‰¹åˆ«å…³é”®ï¼Œå®ƒä¸»è¦åœ¨è¿™é‡Œå°è£… SQL çš„å‚æ•°ï¼Œå¹¶ç”Ÿæˆä¸€æ¡ SQL å¹¶ä¸ç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯å°è£…åˆ°ä¸Šä¸‹æ–‡ <code>EmbeddedStorageContextHolder</code> ä¸­ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service("embeddedConfigInfoPersistServiceImpl")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmbeddedConfigInfoPersistServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ConfigInfoPersistService</span> {

    <span class="hljs-keyword">private</span> ConfigOperateResult <span class="hljs-title function_">updateConfigInfoAtomicCas</span><span class="hljs-params">(<span class="hljs-keyword">final</span> ConfigInfo configInfo, <span class="hljs-keyword">final</span> String srcIp,
                                                          <span class="hljs-keyword">final</span> String srcUser, Map&lt;String, Object&gt; configAdvanceInfo)</span> {
        <span class="hljs-comment">// å¤„ç† SQL çš„å…¥å‚</span>
        <span class="hljs-type">MapperContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MapperContext</span>();
        context.putUpdateParameter(FieldConstant.CONTENT, configInfo.getContent());
        <span class="hljs-comment">// ...</span>
        <span class="hljs-comment">// ç”Ÿæˆ SQL è€Œä¸æ‰§è¡Œï¼ˆConfigInfoMapper#updateConfigInfoAtomicCas åœ¨æ¥å£ä¸­å®šä¹‰çš„ default æ–¹æ³•ï¼‰</span>
        <span class="hljs-type">MapperResult</span> <span class="hljs-variable">mapperResult</span> <span class="hljs-operator">=</span> configInfoMapper.updateConfigInfoAtomicCas(context);

        <span class="hljs-comment">// ä¿å­˜åœ¨ä¸Šä¸‹æ–‡ä¸­</span>
        EmbeddedStorageContextHolder.addSqlContext(Boolean.TRUE, mapperResult.getSql(),
                mapperResult.getParamList().toArray());
        <span class="hljs-keyword">return</span> getConfigInfoOperateResult(configInfo.getDataId(), configInfo.getGroup(), tenantTmp);
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ConfigInfoMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Mapper</span> {
    <span class="hljs-keyword">default</span> MapperResult <span class="hljs-title function_">updateConfigInfoAtomicCas</span><span class="hljs-params">(MapperContext context)</span> {
        List&lt;Object&gt; paramList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-comment">// å°è£… set ä¸­çš„å‚æ•°</span>
        paramList.add(context.getUpdateParameter(FieldConstant.CONTENT));
        <span class="hljs-comment">// ...</span>
        <span class="hljs-comment">// å°è£… where ä¸­çš„å‚æ•°</span>
        paramList.add(context.getWhereParameter(FieldConstant.MD5));
        <span class="hljs-comment">// ...</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"UPDATE config_info SET "</span> + <span class="hljs-string">"content=?, md5=?, src_ip=?, src_user=?, gmt_modified="</span>
                + getFunction(<span class="hljs-string">"NOW()"</span>)
                + <span class="hljs-string">", app_name=?, c_desc=?, c_use=?, effect=?, type=?, c_schema=?, encrypted_data_key=? "</span>
                + <span class="hljs-string">"WHERE data_id=? AND group_id=? AND tenant_id=? AND (md5=? OR md5 IS NULL OR md5='')"</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MapperResult</span>(sql, paramList);
    }
}
</code></pre>
<p>åœ¨è¿™é‡Œæœ‰ä¸¤ä¸ªç‚¹å€¼å¾—æ³¨æ„ï¼š</p>
<ol>
<li>ç”Ÿæˆ Update SQL è€Œä¸æ‰§è¡Œï¼Œå´æ”¾åœ¨äº†ä¸Šä¸‹æ–‡ <code>EmbeddedStorageContextHolder</code> ä¸­ï¼Œå®ƒæ˜¯ä¸€ä¸ª <code>ThreadLocal</code> å¯¹è±¡</li>
<li>ç”Ÿæˆçš„ SQL ä½¿ç”¨ CAS çš„ç­–ç•¥ï¼Œåœ¨ WHERE æ¡ä»¶ä¸­å®ƒä¼šå°†å‰ç«¯æ§åˆ¶å°é…ç½®çš„ MD5 å€¼ä½œä¸ºæ¡ä»¶ä¼ å…¥ï¼Œé˜²æ­¢å¹¶å‘ä¿®æ”¹é…ç½®æ—¶çš„è„å†™é—®é¢˜</li>
</ol>
<p>ç°åœ¨æ—¢ç„¶å·²ç»å°†å˜æ›´ Derby æ•°æ®åº“ Update SQL ä¿å­˜åœ¨äº†ä¸Šä¸‹æ–‡ä¸­ï¼Œæ¥ä¸‹æ¥å°±æ˜¯çœ‹å®ƒä»€ä¹ˆæ—¶å€™è¢«æ‰§è¡Œäº†ï¼Œå®ƒä¼šç»§ç»­æ‰§è¡Œ <code>DatabaseOperate#blockUpdate</code> æ–¹æ³•ï¼Œä»å®ƒçš„å‘½åä¸­ä¹Ÿèƒ½å‘ç°å®ƒæ˜¯åŒæ­¥é˜»å¡æ‰§è¡Œçš„é€»è¾‘ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DatabaseOperate</span> {
    <span class="hljs-comment">// ...</span>
    
    <span class="hljs-comment">// é˜»å¡æ›´æ–°é€»è¾‘</span>
    <span class="hljs-keyword">default</span> Boolean <span class="hljs-title function_">blockUpdate</span><span class="hljs-params">(BiConsumer&lt;Boolean, Throwable&gt; consumer)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// åœ¨ä¸Šä¸‹æ–‡ä¸­è·å– SQL</span>
            <span class="hljs-keyword">return</span> update(EmbeddedStorageContextHolder.getCurrentSqlContext(), consumer);
        } <span class="hljs-keyword">finally</span> {
            EmbeddedStorageContextHolder.cleanAllContext();
        }
    }

}
</code></pre>
<p>å®ƒæ˜¯ä¸€ä¸ª <code>default</code> æ–¹æ³•ï¼Œä¼šè°ƒç”¨ <code>DistributedDatabaseOperateImpl#update</code> æ–¹æ³•ï¼Œå®ƒä¼šå°† SQL å°è£…åœ¨ <code>WriteRequest</code> ä¸­ï¼Œè°ƒç”¨å°è£…å¥½çš„ Raft åè®®çš„ <code>write</code> æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DistributedDatabaseOperateImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RequestProcessor4CP</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BaseDatabaseOperate</span> {

    <span class="hljs-keyword">private</span> CPProtocol protocol;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">update</span><span class="hljs-params">(List&lt;ModifyRequest&gt; sqlContext, BiConsumer&lt;Boolean, Throwable&gt; consumer)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span>
                    System.currentTimeMillis() + <span class="hljs-string">"-"</span> + group() + <span class="hljs-string">"-"</span> + memberManager.getSelf().getAddress() + <span class="hljs-string">"-"</span>
                            + MD5Utils.md5Hex(sqlContext.toString(), PersistenceConstant.DEFAULT_ENCODE);
            <span class="hljs-type">WriteRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> WriteRequest.newBuilder().setGroup(group()).setKey(key)
                    <span class="hljs-comment">// å°† SQL åºåˆ—åŒ–æˆå­—èŠ‚æ•°ç»„ä¿å­˜åœ¨ WriteRequest ä¸­</span>
                    .setData(ByteString.copyFrom(serializer.serialize(sqlContext)))
                    .putAllExtendInfo(EmbeddedStorageContextHolder.getCurrentExtendInfo())
                    .setType(sqlContext.getClass().getCanonicalName()).build();
            
            <span class="hljs-keyword">if</span> (Objects.isNull(consumer)) {
                <span class="hljs-comment">// é‡è¦ï¼šraft åè®® write å¼€å§‹æ‰§è¡Œï¼ŒåŒæ­¥é˜»å¡è°ƒç”¨</span>
                <span class="hljs-type">Response</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.protocol.write(request);
                <span class="hljs-keyword">if</span> (response.getSuccess()) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
                LOGGER.error(<span class="hljs-string">"execute sql modify operation failed : {}"</span>, response.getErrMsg());
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// ...</span>
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">catch</span> (TimeoutException e) {
            LOGGER.error(<span class="hljs-string">"An timeout exception occurred during the update operation"</span>);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NacosRuntimeException</span>(NacosException.SERVER_ERROR, e.toString());
        } <span class="hljs-keyword">catch</span> (Throwable e) {
            LOGGER.error(<span class="hljs-string">"An exception occurred during the update operation : {}"</span>, e);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NacosRuntimeException</span>(NacosException.SERVER_ERROR, e.toString());
        }
    }
}
</code></pre>
<p>å…¶ä¸­ <code>Response response = this.protocol.write(request);</code> é€»è¾‘ä¸ºæ‰§è¡Œ Raft ç®—æ³•çš„å†™æµç¨‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JRaftProtocol</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractConsistencyProtocol</span>&lt;RaftConfig, RequestProcessor4CP&gt;
        <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CPProtocol</span>&lt;RaftConfig, RequestProcessor4CP&gt; {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Response <span class="hljs-title function_">write</span><span class="hljs-params">(WriteRequest request)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// ä¾é  CompletableFuture å®ç°é˜»å¡åŒæ­¥è°ƒç”¨</span>
        CompletableFuture&lt;Response&gt; future = writeAsync(request);
        <span class="hljs-keyword">return</span> future.get(<span class="hljs-number">10_000L</span>, TimeUnit.MILLISECONDS);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> CompletableFuture&lt;Response&gt; <span class="hljs-title function_">writeAsync</span><span class="hljs-params">(WriteRequest request)</span> {
        <span class="hljs-keyword">return</span> raftServer.commit(request.getGroup(), request, <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompletableFuture</span>&lt;&gt;());
    }
}
</code></pre>
<p>åœ¨è¿™æ®µé€»è¾‘ä¸­ä¾é  <code>CompletableFuture</code> å®ç°äº†åŒæ­¥é˜»å¡çš„å†™è°ƒç”¨ã€‚<code>JRaftServer#commit</code> æ–¹æ³•æ˜¯å¤„ç† Raft ç®—æ³•ä¸­å†™è¯·æ±‚çš„æµç¨‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JRaftServer</span> {
    <span class="hljs-comment">/**
     * [raft] å¤„ç†å†™è¯·æ±‚ï¼Œæ‰€æœ‰å†™æ“ä½œå¿…é¡»é€šè¿‡ Leader èŠ‚ç‚¹å¤„ç†
     */</span>
    <span class="hljs-keyword">public</span> CompletableFuture&lt;Response&gt; <span class="hljs-title function_">commit</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String group, <span class="hljs-keyword">final</span> Message data,
                                              <span class="hljs-keyword">final</span> CompletableFuture&lt;Response&gt; future)</span> {
        LoggerUtils.printIfDebugEnabled(Loggers.RAFT, <span class="hljs-string">"data requested this time : {}"</span>, data);
        <span class="hljs-keyword">final</span> <span class="hljs-type">RaftGroupTuple</span> <span class="hljs-variable">tuple</span> <span class="hljs-operator">=</span> findTupleByGroup(group);
        <span class="hljs-keyword">if</span> (tuple == <span class="hljs-literal">null</span>) {
            future.completeExceptionally(<span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"No corresponding Raft Group found : "</span> + group));
            <span class="hljs-keyword">return</span> future;
        }

        <span class="hljs-type">FailoverClosureImpl</span> <span class="hljs-variable">closure</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FailoverClosureImpl</span>(future);

        <span class="hljs-keyword">final</span> <span class="hljs-type">Node</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> tuple.node;
        <span class="hljs-keyword">if</span> (node.isLeader()) {
            <span class="hljs-comment">// å½“å‰èŠ‚ç‚¹æ˜¯ Leaderï¼Œç›´æ¥åº”ç”¨å†™æ“ä½œåˆ°çŠ¶æ€æœº</span>
            applyOperation(node, data, closure);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// å½“å‰èŠ‚ç‚¹ä¸æ˜¯ Leaderï¼Œå°†è¯·æ±‚è½¬å‘ç»™ Leader å¤„ç†</span>
            invokeToLeader(group, data, rpcRequestTimeoutMs, closure);
        }
        <span class="hljs-keyword">return</span> future;
    }
}
</code></pre>
<p>å¦‚æœæ˜¯ Leader èŠ‚ç‚¹çš„è¯ï¼Œç›´æ¥æ“ä½œæ—¥å¿—å†™å…¥ï¼Œåœ¨è¿™é‡Œçš„é€»è¾‘éƒ½æ˜¯ä¸ JRaft æ¡†æ¶ç›¸å…³äº†ï¼Œä¸è¿‡æˆ‘ä»¬åªéœ€è¦å…³æ³¨ä¸ Raft ç®—æ³•æœ‰å…³çš„æµç¨‹ï¼Œæ³¨æ„æ³¨é‡Šä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JRaftServer</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyOperation</span><span class="hljs-params">(Node node, Message data, FailoverClosure closure)</span> {
        <span class="hljs-comment">// Task æ˜¯ç”¨æˆ·ä½¿ç”¨ jraft æœ€æ ¸å¿ƒçš„ç±»ä¹‹ä¸€ï¼Œç”¨äºå‘ä¸€ä¸ª raft é›†ç¾¤æäº¤ä¸€ä¸ªä»»åŠ¡ï¼Œè¿™ä¸ªä»»åŠ¡æäº¤åˆ° leaderï¼Œå¹¶å¤åˆ¶åˆ°å…¶ä»– follower èŠ‚ç‚¹</span>
        <span class="hljs-comment">// é€šä¿—çš„ç†è§£ä¸ºè®© Leader èŠ‚ç‚¹è®°å½• log æ—¥å¿—ï¼Œå¹¶åŒæ­¥åˆ°å…¶ä»– Follower èŠ‚ç‚¹</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">Task</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Task</span>();
        <span class="hljs-comment">// done è¡¨ç¤ºä»»åŠ¡çš„å›è°ƒæ–¹æ³•ï¼Œåœ¨ä»»åŠ¡å®Œæˆçš„æ—¶å€™ï¼Œå³ apply çš„æ—¶å€™ï¼Œé€šçŸ¥æ­¤å›è°ƒå¯¹è±¡ï¼Œæ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ã€‚</span>
        task.setDone(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NacosClosure</span>(data, status -&gt; {
            NacosClosure.<span class="hljs-type">NacosStatus</span> <span class="hljs-variable">nacosStatus</span> <span class="hljs-operator">=</span> (NacosClosure.NacosStatus) status;
            closure.setThrowable(nacosStatus.getThrowable());
            closure.setResponse(nacosStatus.getResponse());
            closure.run(nacosStatus);
        }));

        <span class="hljs-comment">// add request type field at the head of task data.</span>
        <span class="hljs-type">byte</span>[] requestTypeFieldBytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">2</span>];
        requestTypeFieldBytes[<span class="hljs-number">0</span>] = ProtoMessageUtil.REQUEST_TYPE_FIELD_TAG;
        <span class="hljs-keyword">if</span> (data <span class="hljs-keyword">instanceof</span> ReadRequest) {
            requestTypeFieldBytes[<span class="hljs-number">1</span>] = ProtoMessageUtil.REQUEST_TYPE_READ;
        } <span class="hljs-keyword">else</span> {
            requestTypeFieldBytes[<span class="hljs-number">1</span>] = ProtoMessageUtil.REQUEST_TYPE_WRITE;
        }

        <span class="hljs-comment">// data ä»»åŠ¡çš„æ•°æ®ï¼Œåœ¨æœ¬æ¬¡é€»è¾‘ä¸­æ˜¯å˜æ›´é…ç½®çš„ SQLï¼Œç”¨æˆ·åº”å½“å°†è¦å¤åˆ¶çš„ä¸šåŠ¡æ•°æ®é€šè¿‡ä¸€å®šåºåˆ—åŒ–æ–¹å¼ï¼ˆæ¯”å¦‚ java/hessian2) åºåˆ—åŒ–æˆä¸€ä¸ª ByteBufferï¼Œæ”¾åˆ° task é‡Œ</span>
        <span class="hljs-type">byte</span>[] dataBytes = data.toByteArray();
        task.setData((ByteBuffer) ByteBuffer.allocate(requestTypeFieldBytes.length + dataBytes.length)
                .put(requestTypeFieldBytes).put(dataBytes).position(<span class="hljs-number">0</span>));
        <span class="hljs-comment">// ä½¿ç”¨ node æäº¤ä»»åŠ¡ï¼Œnode å¯ä»¥ä¸ºæ˜¯ Raft é›†ç¾¤çš„ Leader èŠ‚ç‚¹ï¼Œæ“ä½œ apply æ–¹æ³•ä¹‹åè¡¨ç¤ºå°†æ—¥å¿—è®°å½•ä¸‹æ¥å¹¶ç»™å…¶ä»– Follower èŠ‚ç‚¹åŒæ­¥</span>
        node.apply(task);
    }
}
</code></pre>
<p>å½“åœ¨ Raft é›†ç¾¤ä¸­æœ‰è¶…è¿‡åŠæ•°èŠ‚ç‚¹å·²ç»å°†æœ¬æ¬¡ä»»åŠ¡çš„æ—¥å¿—æŒä¹…åŒ–åï¼Œå®ƒä¼šè‡ªåŠ¨è°ƒç”¨ <code>StateMachineAdapter#onApply</code> æ–¹æ³•ï¼Œè¡¨ç¤ºå°†æ—¥å¿—åº”ç”¨åˆ°çŠ¶æ€æœºï¼Œå³ä½¿å†™è¯·æ±‚ç”Ÿæ•ˆï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">NacosStateMachine</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">StateMachineAdapter</span> {
    
    <span class="hljs-comment">/**
     * æœ€æ ¸å¿ƒçš„æ–¹æ³•ï¼Œåº”ç”¨ä»»åŠ¡åˆ—è¡¨åº”ç”¨åˆ°çŠ¶æ€æœºï¼Œä»»åŠ¡å°†æŒ‰ç…§æäº¤é¡ºåºåº”ç”¨ã€‚
     * è¯·æ³¨æ„ï¼Œå½“è¿™ä¸ªæ–¹æ³•è¿”å›çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºè¿™ä¸€æ‰¹ä»»åŠ¡éƒ½å·²ç»æˆåŠŸåº”ç”¨åˆ°çŠ¶æ€æœºä¸Šï¼Œå¦‚æœä½ æ²¡æœ‰å®Œå…¨åº”ç”¨ï¼ˆæ¯”å¦‚é”™è¯¯ã€å¼‚å¸¸ï¼‰ï¼Œ
     * å°†ä¼šè¢«å½“åšä¸€ä¸ª critical çº§åˆ«çš„é”™è¯¯ï¼ŒæŠ¥å‘Šç»™çŠ¶æ€æœºçš„ StateMachineAdapter#onError æ–¹æ³•ï¼Œé”™è¯¯ç±»å‹ä¸º ERROR_TYPE_STATE_MACHINE
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onApply</span><span class="hljs-params">(Iterator iter)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">applied</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        Message message;
        <span class="hljs-type">NacosClosure</span> <span class="hljs-variable">closure</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// éå†å¤„ç†æœ¬æ¬¡åº”ç”¨çš„ä»»åŠ¡ï¼ˆæ—¥å¿—ï¼‰</span>
            <span class="hljs-keyword">while</span> (iter.hasNext()) {
                <span class="hljs-comment">// ç»“æœé€šè¿‡ Status å‘ŠçŸ¥ï¼ŒStatus#isOk() å‘Šè¯‰ä½ æˆåŠŸè¿˜æ˜¯å¤±è´¥</span>
                <span class="hljs-type">Status</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> Status.OK();
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// å¦‚æœ task æ²¡æœ‰è®¾ç½® closureï¼Œé‚£ä¹ˆ done ä¼šæ˜¯ nullï¼Œ</span>
                    <span class="hljs-comment">// å¦å¤–åœ¨ follower èŠ‚ç‚¹ä¸Šï¼Œdone ä¹Ÿæ˜¯ nullï¼Œå› ä¸º done ä¸ä¼šè¢«å¤åˆ¶åˆ°é™¤äº† leader èŠ‚ç‚¹ä¹‹å¤–çš„å…¶ä»– raft èŠ‚ç‚¹</span>
                    <span class="hljs-keyword">if</span> (iter.done() != <span class="hljs-literal">null</span>) {
                        <span class="hljs-comment">// è·å–å›è°ƒå‡½æ•°</span>
                        closure = (NacosClosure) iter.done();
                        <span class="hljs-comment">// ä» Leader èŠ‚ç‚¹çš„æ—¥å¿—æ¡ç›®ä¸­è·å–æ¶ˆæ¯</span>
                        message = closure.getMessage();
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-comment">// ä» Follower èŠ‚ç‚¹å¤åˆ¶çš„æ—¥å¿—æ¡ç›®ä¸­è§£ææ¶ˆæ¯</span>
                        <span class="hljs-keyword">final</span> <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> iter.getData();
                        <span class="hljs-comment">// è§£ææˆ SQL</span>
                        message = ProtoMessageUtil.parse(data.array());
                        <span class="hljs-keyword">if</span> (message <span class="hljs-keyword">instanceof</span> ReadRequest) {
                            <span class="hljs-comment">// Follower èŠ‚ç‚¹å¿½ç•¥è¯»è¯·æ±‚ï¼Œåªå¤„ç†å†™è¯·æ±‚</span>
                            applied++;
                            index++;
                            iter.next();
                            <span class="hljs-keyword">continue</span>;
                        }
                    }

                    LoggerUtils.printIfDebugEnabled(Loggers.RAFT, <span class="hljs-string">"receive log : {}"</span>, message);

                    <span class="hljs-comment">// åº”ç”¨å†™è¯·æ±‚åˆ°ä¸šåŠ¡çŠ¶æ€æœºï¼Œå®ç°æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨</span>
                    <span class="hljs-keyword">if</span> (message <span class="hljs-keyword">instanceof</span> WriteRequest) {
                        <span class="hljs-comment">// ä½¿ Update SQL æ‰§è¡Œå¹¶ç”Ÿæ•ˆï¼Œåœ¨ Response ä¸­è¿”å›æ‰§è¡Œç»“æœ</span>
                        <span class="hljs-type">Response</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> processor.onApply((WriteRequest) message);
                        <span class="hljs-comment">// å¯¹ç»“æœçš„åç½®å¤„ç†</span>
                        postProcessor(response, closure);
                    }

                    <span class="hljs-comment">// å¤„ç†è¯»è¯·æ±‚ï¼ˆä»…åœ¨ Leader èŠ‚ç‚¹ï¼‰</span>
                    <span class="hljs-keyword">if</span> (message <span class="hljs-keyword">instanceof</span> ReadRequest) {
                        <span class="hljs-type">Response</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> processor.onRequest((ReadRequest) message);
                        postProcessor(response, closure);
                    }
                } <span class="hljs-keyword">catch</span> (Throwable e) {
                    index++;
                    status.setError(RaftError.UNKNOWN, e.toString());
                    Optional.ofNullable(closure).ifPresent(closure1 -&gt; closure1.setThrowable(e));
                    <span class="hljs-keyword">throw</span> e;
                } <span class="hljs-keyword">finally</span> {
                    Optional.ofNullable(closure).ifPresent(closure1 -&gt; closure1.run(status));
                }

                applied++;
                index++;
                iter.next();
            }
        } <span class="hljs-keyword">catch</span> (Throwable t) {
            <span class="hljs-comment">// çŠ¶æ€æœºåº”ç”¨å¤±è´¥æ—¶è¿›è¡Œå›æ»šï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§</span>
            Loggers.RAFT.error(<span class="hljs-string">"processor : {}, stateMachine meet critical error: {}."</span>, processor, t);
            iter.setErrorAndRollback(index - applied,
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Status</span>(RaftError.ESTATEMACHINE, <span class="hljs-string">"StateMachine meet critical error: %s."</span>,
                            ExceptionUtil.getStackTrace(t)));
        }
    }
}
</code></pre>
<p>å› ä¸ºå°†ä»»åŠ¡åº”ç”¨åˆ°çŠ¶æ€æœºæ—¶ä¼šåœ¨ Leader å’Œ Follower èŠ‚ç‚¹éƒ½æ‰§è¡Œï¼Œæ‰€ä»¥ä»¥ä¸Šé€»è¾‘ä¼šåŒ…å«é’ˆå¯¹ Leader èŠ‚ç‚¹å’Œ Follower èŠ‚ç‚¹çš„æ‰§è¡Œé€»è¾‘ã€‚å®ƒä¼šåœ¨ <code>Response response = processor.onApply((WriteRequest) message);</code> é€»è¾‘ä¸­å®Œæˆ Update SQL çš„æ‰§è¡Œï¼Œå¦‚ä¸‹ <code>DistributedDatabaseOperateImpl#onApply</code> æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Conditional(ConditionDistributedEmbedStorage.class)</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DistributedDatabaseOperateImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RequestProcessor4CP</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BaseDatabaseOperate</span> {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Response <span class="hljs-title function_">onApply</span><span class="hljs-params">(WriteRequest log)</span> {
        LoggerUtils.printIfDebugEnabled(LOGGER, <span class="hljs-string">"onApply info : log : {}"</span>, log);
        <span class="hljs-keyword">final</span> <span class="hljs-type">ByteString</span> <span class="hljs-variable">byteString</span> <span class="hljs-operator">=</span> log.getData();
        Preconditions.checkArgument(byteString != <span class="hljs-literal">null</span>, <span class="hljs-string">"Log.getData() must not null"</span>);
        <span class="hljs-keyword">final</span> <span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> readLock;
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// å°†ä»»åŠ¡ä¸­çš„æ•°æ®è½¬æ¢æˆæœ¬æ¬¡ä¿®æ”¹é…ç½®è¦æ‰§è¡Œçš„ SQL</span>
            List&lt;ModifyRequest&gt; sqlContext = serializer.deserialize(byteString.toByteArray(), List.class);
            sqlLimiter.doLimitForModifyRequest(sqlContext);
            <span class="hljs-type">boolean</span> <span class="hljs-variable">isOk</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
            <span class="hljs-comment">// åŒºåˆ†å¯¼å…¥å’Œéå¯¼å…¥é€»è¾‘</span>
            <span class="hljs-keyword">if</span> (log.containsExtendInfo(DATA_IMPORT_KEY)) {
                isOk = doDataImport(jdbcTemplate, sqlContext);
            } <span class="hljs-keyword">else</span> {
                sqlContext.sort(Comparator.comparingInt(ModifyRequest::getExecuteNo));
                <span class="hljs-comment">// æ‰§è¡Œä¿®æ”¹ SQL</span>
                isOk = update(transactionTemplate, jdbcTemplate, sqlContext);
                PersistenceExecutor.executeEmbeddedDump(() -&gt; {
                    <span class="hljs-keyword">for</span> (EmbeddedApplyHook each : EmbeddedApplyHookHolder.getInstance().getAllHooks()) {
                        each.afterApply(log);
                    }
                });
            }

            <span class="hljs-keyword">return</span> Response.newBuilder().setSuccess(isOk).build();
        } <span class="hljs-keyword">catch</span> (BadSqlGrammarException | DataIntegrityViolationException e) {
            <span class="hljs-keyword">return</span> Response.newBuilder().setSuccess(<span class="hljs-literal">false</span>).setErrMsg(e.toString()).build();
        } <span class="hljs-keyword">catch</span> (DataAccessException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConsistencyException</span>(e.toString());
        } <span class="hljs-keyword">catch</span> (Exception e) {
            LoggerUtils.printIfWarnEnabled(LOGGER, <span class="hljs-string">"onApply warn : log : {}"</span>, log, e);
            <span class="hljs-keyword">return</span> Response.newBuilder().setSuccess(<span class="hljs-literal">false</span>).setErrMsg(e.toString()).build();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
}
</code></pre>
<p>æ‰§è¡Œå®Œæˆåï¼Œé€šè¿‡ <code>Response</code> å¯¹è±¡æ¥åˆ¤æ–­æ‰§è¡ŒæˆåŠŸè¿˜æ˜¯æ‰§è¡Œå¤±è´¥ï¼Œ<code>postProcessor</code> æ–¹æ³•è´Ÿè´£åç½®å¤„ç†ï¼Œæœ€ç»ˆå›è°ƒçš„é€»è¾‘å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FailoverClosureImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FailoverClosure</span> {
    
    <span class="hljs-comment">// ...</span>
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CompletableFuture&lt;Response&gt; future;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(Status status)</span> {
        <span class="hljs-comment">// è°ƒç”¨ CompletableFuture#complete æ–¹æ³•æ ‡è®°ä»»åŠ¡å®Œæˆï¼ŒåŒæ­¥é˜»å¡è°ƒç”¨æ¢å¤ï¼Œå¹¶è¿”å›ç»“æœå€¼</span>
        <span class="hljs-keyword">if</span> (status.isOk()) {
            future.complete(data);
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">final</span> <span class="hljs-type">Throwable</span> <span class="hljs-variable">throwable</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.throwable;
        future.completeExceptionally(Objects.nonNull(throwable) ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConsistencyException</span>(throwable.getMessage())
                : <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConsistencyException</span>(<span class="hljs-string">"operation failure"</span>));
    }
    
}
</code></pre>
<p>å…¶ä¸­ <code>future</code> å­—æ®µä¸ºåœ¨æ‰§è¡Œ Raft çš„å†™è¯·æ±‚æ—¶ä¿è¯åŒæ­¥é˜»å¡è°ƒç”¨çš„ <code>CompletableFuture</code>ï¼Œå¦‚æœæ‰§è¡ŒæˆåŠŸè°ƒç”¨ <code>CompletableFuture#complete</code> æ–¹æ³•ä¾¿èƒ½è®©åœæ­¢é˜»å¡å¹¶è¿”å›ç»“æœï¼Œä»¥ä¸Šä¾¿æ˜¯åœ¨ Nacos é›†ç¾¤ä¸­æ‰§è¡Œå†™è¯·æ±‚çš„æµç¨‹ã€‚åœ¨ Nacos æºç çš„ <code>DistributedDatabaseOperateImpl</code> ç±»ä¸Šæœ‰ä»¥ä¸‹æµç¨‹å›¾æ³¨é‡Šèƒ½éå¸¸æ¸…æ™°çš„åæ˜ æ•´ä¸ªæµç¨‹ï¼š</p>
<ol>
<li>ç”¨æˆ· <code>user</code> æ‰§è¡Œé…ç½®å˜æ›´æ—¶æ‰§è¡Œ <code>publishConfig</code> çš„é€»è¾‘ï¼Œè¦æ‰§è¡Œçš„ SQL ä¼šè¢«ä¿å­˜åœ¨ä¸Šä¸‹æ–‡ <code>SqlContextUtils</code> ä¸­</li>
<li>å¯¹æ•°æ®åº“çš„æ“ä½œéƒ½ä¼šè¢«æäº¤åˆ° JRaft åè®®çŠ¶æ€æœº <code>JRaftProtocol</code> ä¸­æ‰§è¡Œï¼Œåº”ç”¨ <code>onApply</code> åˆ°çŠ¶æ€æœºæ—¶ä¼šä»ä¸Šä¸‹æ–‡ <code>SqlContextUtils</code> ä¸­è·å– SQL å¹¶æ‰§è¡Œ</li>
<li>åŒæ­¥é˜»å¡è¿”å›ç”¨æˆ· <code>user</code> ç»“æœ</li>
</ol>
<pre><code class="hljs language-text" lang="text">                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”Œâ”€â”€â–¶â”‚   PersistService   â”‚
               â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚              â”‚           â”‚                 â”‚
               â”‚              â”‚           â”‚                 â”‚
               â”‚              â”‚           â”‚                 â”‚
               â”‚              â”‚           â”‚                 â”‚
               â”‚              â”‚           â”‚                 â”‚
               â”‚              â”‚           â”‚                 â”‚
               â”‚              â”‚           â”‚                 â”‚
               â”‚              â”‚           â”‚                 â–¼
               â”‚              â”‚           â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          save sql
               â”‚              â–¼           â”‚      â”‚     saveConfig     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€contextâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
               â”‚     â”‚ publishConfig  â”‚â”€â”€â”€â”˜                 â”‚                                        â”‚
               â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚                                        â”‚
               â”‚                                            â–¼                                        â–¼
               â”‚                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    save sql    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚                               â”‚ saveConfigTagRelations  â”‚â”€â”€â”€â”€contextâ”€â”€â”€â”€â–¶â”‚  SqlContextUtils   â”‚â—€â”€â”
        publish config                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
               â”‚                                            â”‚                                        â–²            â”‚
               â”‚                                            â”‚                                        â”‚            â”‚
               â”‚                                            â–¼                                        â”‚            â”‚
               â”‚                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         save sql           â”‚            â”‚
            â”Œâ”€â”€â”€â”€â”                              â”‚   saveConfigHistory   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€contextâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
            â”‚userâ”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
            â””â”€â”€â”€â”€â”˜                                                                                                â”‚
               â–²                                                                                                  â”‚
               â”‚                                           â”Œ1:getCurrentSqlContextsâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                                           â”‚
               â”‚                                           â”‚
               â”‚                                           â”‚
               â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚           â”‚ JdbcTemplate  â”‚â—€â”€â”€â”€â”‚   DatabaseOperate   â”‚â”€â”€â”€â”
       4:execute result    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
               â”‚                   â”‚                       â–²              â”‚
               â”‚                   â”‚                       â”‚              â”‚
               â”‚                   â”‚                  3:onApply         2:submit(List&lt;ModifyRequest&gt;)
               â”‚                   â”‚                       â”‚              â”‚
               â”‚                   â–¼                       â”‚              â”‚
               â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚              â”‚
               â”‚           â”‚ Apache Derby â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
               â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚     JRaftProtocol     â”‚â—€â”€â”˜
               â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                                           â”‚
               â”‚                                           â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>å½“ Raft çš„æµç¨‹æ‰§è¡Œå®Œæˆåï¼Œä¼šå›åˆ°åœ¨æ–‡ç« å¼€å¤´æˆ‘ä»¬æåˆ°çš„ <code>ConfigOperationService#publishConfig</code> æ–¹æ³•ä¸­ï¼Œåœ¨å•æœºéƒ¨ç½²çš„æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬æåˆ°è¿‡ï¼šNacos ä¼šè§¦å‘ <code>ConfigDataChangeEvent</code> äº‹ä»¶æ¥è§¦å‘ <code>DumpTask</code> æ¥å°†é…ç½®ä¿¡æ¯å†™å…¥åˆ°æœ¬åœ°ç£ç›˜æ–‡ä»¶å’Œ JVM ç¼“å­˜ä¸­ï¼Œå¹¶åœ¨éšåè§¦å‘ <code>LocalDataChangeEvent</code> äº‹ä»¶é€šçŸ¥è¿æ¥åˆ°è¯¥å•æœºä¸Šæ‰€æœ‰çš„ Nacos Client ä¿è¯é…ç½®å˜æ›´çš„é€šçŸ¥ã€‚ç°åœ¨æˆ‘ä»¬æ¥è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼šå½“æˆ‘ä»¬åœ¨æ§åˆ¶å°ä¿®æ”¹é…ç½®ä¿¡æ¯æ—¶ï¼Œé…ç½®å˜æ›´çš„è¯·æ±‚åªä¼šæ‰“åˆ° Nacos é›†ç¾¤çš„æŸä¸€å°æœåŠ¡ä¸Šï¼Œåœ¨è¿™ä¸€å°æœåŠ¡ä¸Šä¼šæ‰§è¡Œ Dump æ–‡ä»¶çš„æ“ä½œå¹¶é€šçŸ¥è¿æ¥åˆ°è¯¥å°æœåŠ¡å™¨ä¸Šçš„ Nacos Client é…ç½®å˜æ›´ï¼Œé‚£ <strong>é›†ç¾¤ä¸­å…¶ä»–èŠ‚ç‚¹æ˜¯ä¸æ˜¯ä¹Ÿéœ€è¦é€šçŸ¥è¿æ¥åˆ°æœ¬èº«çš„ Nacos Client é…ç½®å˜æ›´</strong> å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚</p>
<p>åœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œ<code>ConfigDataChangeEvent</code> äº‹ä»¶ä¼šè¢« <code>AsyncNotifyService</code> æ¶ˆè´¹ï¼Œå…¶ä¸­çš„ <code>AsyncNotifyService#handleConfigDataChangeEvent</code> æ–¹æ³•ä¼šå¤„ç† <code>ConfigDataChangeEvent</code> äº‹ä»¶æ¥å®Œæˆé€šçŸ¥é›†ç¾¤å†…å…¶ä»–èŠ‚ç‚¹é…ç½®å‘ç”Ÿå˜æ›´çš„æ“ä½œï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncNotifyService</span> {

    <span class="hljs-keyword">private</span> ServerMemberManager memberManager;
    
    <span class="hljs-comment">// å¤„ç† ConfigDataChangeEvent äº‹ä»¶</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleConfigDataChangeEvent</span><span class="hljs-params">(Event event)</span> {
        <span class="hljs-keyword">if</span> (event <span class="hljs-keyword">instanceof</span> ConfigDataChangeEvent) {
            <span class="hljs-type">ConfigDataChangeEvent</span> <span class="hljs-variable">evt</span> <span class="hljs-operator">=</span> (ConfigDataChangeEvent) event;

            MetricsMonitor.incrementConfigChangeCount(evt.tenant, evt.group, evt.dataId);
            <span class="hljs-comment">// é›†ç¾¤ä¸­é™¤äº†è‡ªå·±çš„æ‰€æœ‰èŠ‚ç‚¹</span>
            Collection&lt;Member&gt; ipList = memberManager.allMembersWithoutSelf();

            Queue&lt;NotifySingleRpcTask&gt; rpcQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();

            <span class="hljs-keyword">for</span> (Member member : ipList) {
                <span class="hljs-comment">// ç”Ÿæˆé€šçŸ¥å…¶ä»–èŠ‚ç‚¹æ•°æ®å˜æ›´çš„ä»»åŠ¡ï¼ŒåŒ…å«é…ç½®ä¿¡æ¯å’ŒèŠ‚ç‚¹IPä¿¡æ¯</span>
                <span class="hljs-type">NotifySingleRpcTask</span> <span class="hljs-variable">notifySingleRpcTask</span> <span class="hljs-operator">=</span> generateTask(evt, member);
                <span class="hljs-comment">// åŠ å…¥é˜Ÿåˆ—</span>
                rpcQueue.add(notifySingleRpcTask);
            }
            <span class="hljs-comment">// å¼‚æ­¥æ‰§è¡Œä»»åŠ¡</span>
            <span class="hljs-keyword">if</span> (!rpcQueue.isEmpty()) {
                ConfigExecutor.executeAsyncNotify(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncRpcTask</span>(rpcQueue));
            }
        }
    }   
}
</code></pre>
<p>å®ƒä¼šå°†å˜æ›´çš„é…ç½®å’Œè¦é€šçŸ¥çš„èŠ‚ç‚¹ä¿¡æ¯å°è£…æˆä¸€ä¸ªä¸ª <code>NotifySingleRpcTask</code> å¼‚æ­¥ä»»åŠ¡ï¼Œå¹¶æ”¾åœ¨é˜Ÿåˆ— <code>Queue&lt;NotifySingleRpcTask&gt;</code> ä¸­ï¼Œéšåä½¿ç”¨çº¿ç¨‹æ± å¼‚æ­¥æ‰§è¡Œ <code>ConfigExecutor#executeAsyncNotify</code> é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„ä»»åŠ¡ã€‚<code>AsyncRpcTask</code> æ˜¯åœ¨ <code>AsyncNotifyService</code> å°è£…çš„å†…éƒ¨ç±»ï¼Œæ‰§è¡Œé€šçŸ¥çš„é€»è¾‘ä¸º <code>AsyncNotifyService#executeAsyncRpcTask</code> æ–¹æ³•ï¼Œå€ŸåŠ© gRPC é€šçŸ¥å…¶ä»–èŠ‚ç‚¹ï¼Œå¹¶åœ¨å¤±è´¥åé‡è¯•ï¼Œè¯·å…³æ³¨ä»¥ä¸‹é€»è¾‘çš„æ³¨é‡Šä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncNotifyService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MIN_RETRY_INTERVAL</span> <span class="hljs-operator">=</span> <span class="hljs-number">500</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">INCREASE_STEPS</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_COUNT</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ConfigClusterRpcClientProxy configClusterRpcClientProxy;

    <span class="hljs-keyword">private</span> ServerMemberManager memberManager;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncRpcTask</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {

        <span class="hljs-keyword">private</span> Queue&lt;NotifySingleRpcTask&gt; queue;

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">AsyncRpcTask</span><span class="hljs-params">(Queue&lt;NotifySingleRpcTask&gt; queue)</span> {
            <span class="hljs-built_in">this</span>.queue = queue;
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
            <span class="hljs-comment">// å¤„ç†é€šçŸ¥å…¶ä»–èŠ‚ç‚¹é…ç½®å˜æ›´çš„ä»»åŠ¡</span>
            executeAsyncRpcTask(queue);
        }
    }
    
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeAsyncRpcTask</span><span class="hljs-params">(Queue&lt;NotifySingleRpcTask&gt; queue)</span> {
        <span class="hljs-keyword">while</span> (!queue.isEmpty()) {
            <span class="hljs-type">NotifySingleRpcTask</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> queue.poll();

            <span class="hljs-type">ConfigChangeClusterSyncRequest</span> <span class="hljs-variable">syncRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigChangeClusterSyncRequest</span>();
            syncRequest.setDataId(task.getDataId());
            syncRequest.setTenant(task.getTenant());
            syncRequest.setGroup(task.getGroup());
            syncRequest.setLastModified(task.getLastModified());
            syncRequest.setGrayName(task.getGrayName());
            syncRequest.setBeta(task.isBeta());
            syncRequest.setTag(task.getTag());
            <span class="hljs-type">Member</span> <span class="hljs-variable">member</span> <span class="hljs-operator">=</span> task.member;

            <span class="hljs-type">String</span> <span class="hljs-variable">event</span> <span class="hljs-operator">=</span> getNotifyEvent(task);
            <span class="hljs-keyword">if</span> (memberManager.hasMember(member.getAddress())) {
                <span class="hljs-comment">// å°†å¯èƒ½ä¸‹çº¿çš„æœåŠ¡æ”¾å…¥å¼‚æ­¥é˜Ÿåˆ—å»¶è¿Ÿæ‰§è¡Œï¼Œå¥åº·çš„æœåŠ¡å™¨ç›´æ¥é€šçŸ¥</span>
                <span class="hljs-type">boolean</span> <span class="hljs-variable">unHealthNeedDelay</span> <span class="hljs-operator">=</span> isUnHealthy(member.getAddress());
                <span class="hljs-keyword">if</span> (unHealthNeedDelay) {
                    ConfigTraceService.logNotifyEvent(task.getDataId(), task.getGroup(), task.getTenant(), <span class="hljs-literal">null</span>,
                            task.getLastModified(), InetUtils.getSelfIP(), event,
                            ConfigTraceService.NOTIFY_TYPE_UNHEALTH, <span class="hljs-number">0</span>, member.getAddress());
                    asyncTaskExecute(task);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-comment">// gRPC é€šçŸ¥é…ç½®å‘ç”Ÿå˜æ›´</span>
                        configClusterRpcClientProxy.syncConfigChange(member, syncRequest,
                                <span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncRpcNotifyCallBack</span>(AsyncNotifyService.<span class="hljs-built_in">this</span>, task));
                    } <span class="hljs-keyword">catch</span> (Exception e) {
                        <span class="hljs-comment">// æ— é™é‡è¯•ï¼Œç›´åˆ°é‡è¯•æˆåŠŸæˆ–æœåŠ¡åœæ­¢</span>
                        MetricsMonitor.getConfigNotifyException().increment();
                        asyncTaskExecute(task);
                    }
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">//No nothing if  member has offline.</span>
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">asyncTaskExecute</span><span class="hljs-params">(NotifySingleRpcTask task)</span> {
        <span class="hljs-comment">// è·å–é‡è¯•å»¶è¿Ÿæ—¶é—´</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">delay</span> <span class="hljs-operator">=</span> getDelayTime(task);
        Queue&lt;NotifySingleRpcTask&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();
        queue.add(task);
        <span class="hljs-comment">// å€ŸåŠ© ScheduledExecutorService çº¿ç¨‹æ± å»¶è¿Ÿæ‰§è¡Œçš„ä»»åŠ¡</span>
        <span class="hljs-type">AsyncRpcTask</span> <span class="hljs-variable">asyncTask</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncRpcTask</span>(queue);
        ConfigExecutor.scheduleAsyncNotify(asyncTask, delay, TimeUnit.MILLISECONDS);
    }

    <span class="hljs-comment">// æ‰§è¡Œå¤±è´¥åè·å–å»¶è¿Ÿæ‰§è¡Œçš„æ—¶é—´</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getDelayTime</span><span class="hljs-params">(NotifySingleRpcTask task)</span> {
        <span class="hljs-comment">// å¤±è´¥æ¬¡æ•°</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">failCount</span> <span class="hljs-operator">=</span> task.getFailCount();
        <span class="hljs-comment">// æŒ‡æ•°çº§è®¡ç®—é‡è¯•é—´éš”</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">delay</span> <span class="hljs-operator">=</span> MIN_RETRY_INTERVAL + failCount * failCount * INCREASE_STEPS;
        <span class="hljs-comment">// æœ€å¤§é‡è¯•æ¬¡æ•°é™åˆ¶ï¼Œè¶…è¿‡åä»ç„¶ç»§ç»­é‡è¯•ï¼Œåªæ˜¯é™åˆ¶äº†é‡è¯•é—´éš”çš„æŒ‡æ•°çˆ†ç‚¸</span>
        <span class="hljs-keyword">if</span> (failCount &lt;= MAX_COUNT) {
            task.setFailCount(failCount + <span class="hljs-number">1</span>);
        }
        <span class="hljs-keyword">return</span> delay;
    }
    
}
</code></pre>
<p>é›†ç¾¤ä¸­å…¶ä»–èŠ‚ç‚¹åœ¨æ”¶åˆ° <code>ConfigChangeClusterSyncRequest</code> è¯·æ±‚åï¼Œä¼šåœ¨ <code>ConfigChangeClusterSyncRequestHandler</code> ç±»ä¸­å¤„ç†ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@InvokeSource(source = {RemoteConstants.LABEL_SOURCE_CLUSTER})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigChangeClusterSyncRequestHandler</span>
        <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RequestHandler</span>&lt;ConfigChangeClusterSyncRequest, ConfigChangeClusterSyncResponse&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DumpService dumpService;

    <span class="hljs-keyword">private</span> ConfigMigrateService configMigrateService;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ConfigChangeClusterSyncRequestHandler</span><span class="hljs-params">(DumpService dumpService,
                                                 ConfigMigrateService configMigrateService)</span> {
        <span class="hljs-built_in">this</span>.dumpService = dumpService;
        <span class="hljs-built_in">this</span>.configMigrateService = configMigrateService;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@NamespaceValidation</span>
    <span class="hljs-meta">@TpsControl(pointName = "ClusterConfigChangeNotify")</span>
    <span class="hljs-meta">@ExtractorManager</span>.Extractor(rpcExtractor = ConfigRequestParamExtractor.class)
    <span class="hljs-meta">@Secured(signType = SignType.CONFIG, apiType = ApiType.INNER_API)</span>
    <span class="hljs-keyword">public</span> ConfigChangeClusterSyncResponse <span class="hljs-title function_">handle</span><span class="hljs-params">(ConfigChangeClusterSyncRequest configChangeSyncRequest,
                                                  RequestMeta meta)</span> <span class="hljs-keyword">throws</span> NacosException {
        <span class="hljs-comment">// å‚æ•°æ ¡éªŒ</span>
        checkCompatity(configChangeSyncRequest, meta);
        ParamUtils.checkParam(configChangeSyncRequest.getTag());
        
        <span class="hljs-comment">// æ‰§è¡Œ Dump æ“ä½œ</span>
        <span class="hljs-type">DumpRequest</span> <span class="hljs-variable">dumpRequest</span> <span class="hljs-operator">=</span> DumpRequest.create(configChangeSyncRequest.getDataId(),
                configChangeSyncRequest.getGroup(), configChangeSyncRequest.getTenant(),
                configChangeSyncRequest.getLastModified(), meta.getClientIp());
        dumpRequest.setGrayName(configChangeSyncRequest.getGrayName());
        dumpService.dump(dumpRequest);
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigChangeClusterSyncResponse</span>();
    }
    
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>å®ƒçš„é€»è¾‘éå¸¸ç®€å•ï¼Œæ¥å—åˆ°è¯·æ±‚åï¼Œæ‰§è¡Œæ–‡ä»¶ Dump æ“ä½œå¹¶é€šçŸ¥è¿æ¥åˆ°æœåŠ¡æœ¬èº«çš„æ‰€æœ‰ Nacos Client å®¢æˆ·ç«¯é…ç½®å‘ç”Ÿå˜æ›´ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹åœ¨ Nacos Server ç«¯é€šè¿‡æ§åˆ¶å°æŸ¥è¯¢é…ç½®æ•°æ®æ—¶ï¼Œè¯»å– Derby æ•°æ®åº“æ˜¯å¦‚ä½•è¯»å–çš„ã€‚åœ¨å¼€å§‹å…·ä½“çš„é€»è¾‘å‰ï¼Œå…ˆç»™å¤§å®¶ç•™ä¸€ä¸ªé—®é¢˜ï¼šåœ¨é›†ç¾¤æ¨¡å¼éƒ¨ç½²æ—¶ï¼Œæ¯ä¸ªé›†ç¾¤å®ä¾‹éƒ½æœ‰ä¸€ä»½é…ç½®æ•°æ®çš„å‰¯æœ¬ï¼Œå½“è¯·æ±‚æ‰“åˆ°ä¸åŒçš„å®ä¾‹æ—¶ï¼Œå¦‚æœå­˜åœ¨å®ä¾‹æœªå®Œæˆæœ€æ–°é…ç½®æ•°æ®çš„å†™å…¥ï¼Œä¼šä¸ä¼šå­˜åœ¨å¤šæ¬¡è¯·æ±‚ä¸ä¸€è‡´çš„æƒ…å†µå‘¢ï¼Ÿ</p>
<h5 data-id="heading-3">åœ¨ Nacos Server ç«¯é€šè¿‡æ§åˆ¶å°è¯»å–é…ç½®æ•°æ®</h5>
<p>åœ¨ Nacos é›†ç¾¤æ¨¡å¼ä¸‹ä½¿ç”¨å†…åµŒ Derby æ•°æ®åº“æ—¶éµå¾ª Raft ç®—æ³•ï¼Œå¦‚æœè¦æŸ¥è¯¢é…ç½®ä¿¡æ¯æ—¶å®ƒé‡‡ç”¨çš„æ˜¯ <strong>ReadIndex Read å®ç°çº¿æ€§ä¸€è‡´æ€§è¯»</strong>ï¼Œæˆ‘ä»¬ç›´æ¥ç•¥è¿‡éæ ¸å¿ƒä»£ç ï¼Œåˆ†æä¸ Raft ç›¸å…³çš„æºç éƒ¨åˆ†ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JRaftServer</span> {
    <span class="hljs-comment">/**
     * [raft] å¤„ç†è¯»è¯·æ±‚ï¼Œä½¿ç”¨ ReadIndex æœºåˆ¶ä¿è¯çº¿æ€§ä¸€è‡´æ€§è¯»
     */</span>
    CompletableFuture&lt;Response&gt; <span class="hljs-title function_">get</span><span class="hljs-params">(<span class="hljs-keyword">final</span> ReadRequest request)</span> {
        <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> request.getGroup();
        CompletableFuture&lt;Response&gt; future = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompletableFuture</span>&lt;&gt;();
        <span class="hljs-keyword">final</span> <span class="hljs-type">RaftGroupTuple</span> <span class="hljs-variable">tuple</span> <span class="hljs-operator">=</span> findTupleByGroup(group);
        <span class="hljs-keyword">if</span> (Objects.isNull(tuple)) {
            future.completeExceptionally(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NoSuchRaftGroupException</span>(group));
            <span class="hljs-keyword">return</span> future;
        }
        <span class="hljs-keyword">final</span> <span class="hljs-type">Node</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> tuple.node;
        <span class="hljs-keyword">final</span> <span class="hljs-type">RequestProcessor</span> <span class="hljs-variable">processor</span> <span class="hljs-operator">=</span> tuple.processor;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// ä½¿ç”¨ ReadIndex Read æœºåˆ¶ç¡®ä¿è¯»å–åˆ°çš„æ•°æ®æ˜¯æœ€æ–°çš„å·²æäº¤æ•°æ®</span>
            <span class="hljs-comment">// å…¶ä¸­ requestContext ï¼ˆç¬¬ä¸€ä¸ªå…¥å‚ï¼‰æä¾›ç»™ç”¨æˆ·ä½œä¸ºè¯·æ±‚çš„é™„åŠ ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥åœ¨ closure é‡Œå†æ¬¡æ‹¿åˆ°ç»§ç»­å¤„ç†</span>
            node.readIndex(BytesUtil.EMPTY_BYTES, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReadIndexClosure</span>() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(Status status, <span class="hljs-type">long</span> index, <span class="hljs-type">byte</span>[] reqCtx)</span> {
                    <span class="hljs-comment">// ReadIndex æˆåŠŸï¼Œä¼ å…¥çš„ closure å°†è¢«è°ƒç”¨ï¼Œå¯ä»¥å®‰å…¨åœ°ä»æœ¬åœ°çŠ¶æ€æœºè¯»å–æ•°æ®</span>
                    <span class="hljs-keyword">if</span> (status.isOk()) {
                        <span class="hljs-keyword">try</span> {
                            <span class="hljs-type">Response</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> processor.onRequest(request);
                            future.complete(response);
                        } <span class="hljs-keyword">catch</span> (Throwable t) {
                            MetricsMonitor.raftReadIndexFailed();
                            future.completeExceptionally(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConsistencyException</span>(
                                    <span class="hljs-string">"The conformance protocol is temporarily unavailable for reading"</span>, t));
                        }
                        <span class="hljs-keyword">return</span>;
                    }
                    MetricsMonitor.raftReadIndexFailed();
                    Loggers.RAFT.error(<span class="hljs-string">"ReadIndex has error : {}, go to Leader read."</span>, status.getErrorMsg());
                    MetricsMonitor.raftReadFromLeader();
                    <span class="hljs-comment">// ReadIndex å¤±è´¥ï¼Œé™çº§åˆ° Leader è¯»å–ä¿è¯ä¸€è‡´æ€§</span>
                    readFromLeader(request, future);
                }
            });
            <span class="hljs-keyword">return</span> future;
        } <span class="hljs-keyword">catch</span> (Throwable e) {
            <span class="hljs-comment">// ReadIndex å¼‚å¸¸ï¼Œç›´æ¥ä» Leader è¯»å–</span>
            MetricsMonitor.raftReadFromLeader();
            Loggers.RAFT.warn(<span class="hljs-string">"Raft linear read failed, go to Leader read logic : {}"</span>, e.toString());
            <span class="hljs-comment">// run raft read</span>
            readFromLeader(request, future);
            <span class="hljs-keyword">return</span> future;
        }
    }

    <span class="hljs-comment">// raft log process</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readFromLeader</span><span class="hljs-params">(<span class="hljs-keyword">final</span> ReadRequest request, <span class="hljs-keyword">final</span> CompletableFuture&lt;Response&gt; future)</span> {
        commit(request.getGroup(), request, future);
    }
}
</code></pre>
<p>è¿™éƒ¨åˆ†æºç æ¯”è¾ƒç®€å•ï¼Œå› ä¸º JRaft æ¡†æ¶å°† ReadIndex Read çš„å®ç°å°è£…èµ·æ¥äº†ï¼Œå¼€æ”¾å‡ºäº† <code>readIndex</code> æ–¹æ³•æ¥ç›´æ¥å¤ç”¨ï¼Œæ³¨æ„å¦‚æœåœ¨ ReadIndex æ—¶å¤±è´¥ï¼Œä¼šèµ° Raft Log æµç¨‹æ¥å¤„ç†è¯»è¯·æ±‚ï¼Œè¿™ä¸ªå¼€é”€å°±ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¤§äº†ã€‚å¦‚æœå¤§å®¶å¯¹ Raft ç®—æ³•ä¸äº†è§£ï¼Œå¯ä»¥é˜…è¯»å‚è€ƒ <a href="https://juejin.cn/post/7544003305972088878" target="_blank" title="https://juejin.cn/post/7544003305972088878">æ·±å…¥ç†è§£åˆ†å¸ƒå¼å…±è¯†ç®—æ³• Raft</a>ã€‚</p>
<p>è‡³æ­¤ï¼Œå˜æ›´é…ç½®å Nacos Server ç«¯å¯¹é…ç½®æ•°æ®ä¸€è‡´æ€§çš„ä¿è¯ç›¸å…³çš„æºç é€»è¾‘å°±å·²ç»è®²è§£å®Œäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦çœ‹çœ‹ Nacos Client æ˜¯å¦‚ä½•æ¥æ”¶é…ç½®å˜æ›´å¹¶æ›´æ–°é…ç½®ä¿¡æ¯çš„ã€‚</p>
<p>ç”±äºç¤¾åŒºæœ€å¤§å­—æ•°é™åˆ¶ï¼Œè¯·çœ‹ä¸‹ç¯‡ï¼š<a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"> Nacos æºç æ·±åº¦ç•…æ¸¸ï¼šNacos é…ç½®åŒæ­¥è¯¦è§£ï¼ˆä¸‹ï¼‰</a>ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nacos æºç æ·±åº¦ç•…æ¸¸ï¼šNacos é…ç½®åŒæ­¥è¯¦è§£ï¼ˆä¸‹ï¼‰]]></title>    <link>https://juejin.cn/post/7572497847770202139</link>    <guid>https://juejin.cn/post/7572497847770202139</guid>    <pubDate>2025-11-15T08:00:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572497847770202139" data-draft-id="7564694695571636239" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Nacos æºç æ·±åº¦ç•…æ¸¸ï¼šNacos é…ç½®åŒæ­¥è¯¦è§£ï¼ˆä¸‹ï¼‰"/> <meta itemprop="keywords" content="åç«¯,GitHub,åˆ†å¸ƒå¼"/> <meta itemprop="datePublished" content="2025-11-15T08:00:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ–¹åœ†æƒ³å½“å›¾çµ"/> <meta itemprop="url" content="https://juejin.cn/user/386633160473101"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Nacos æºç æ·±åº¦ç•…æ¸¸ï¼šNacos é…ç½®åŒæ­¥è¯¦è§£ï¼ˆä¸‹ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/386633160473101/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ–¹åœ†æƒ³å½“å›¾çµ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T08:00:48.000Z" title="Sat Nov 15 2025 08:00:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»19åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Nacos Client å®¢æˆ·ç«¯</h3>
<p>åœ¨ä¸Šæ–‡ <a href="https://juejin.cn/post/7572485825705558025" target="_blank" title="https://juejin.cn/post/7572485825705558025"> Nacos æºç æ·±åº¦ç•…æ¸¸ï¼šNacos é…ç½®åŒæ­¥è¯¦è§£ï¼ˆä¸Šï¼‰</a> ä¸­äº†è§£åˆ°ï¼Œå½“é…ç½®å‘ç”Ÿå˜æ›´æ—¶ï¼ŒNacos Server æœåŠ¡ç«¯ä¼šä¸»åŠ¨é€šçŸ¥ Nacos Client å˜æ›´é…ç½®çš„å†…å®¹ï¼Œå¹¶ä¸”åœ¨é€šçŸ¥å¤±è´¥å Nacos Client æœ‰ä¸»åŠ¨æ‹‰å–å˜æ›´é…ç½®çš„æœºåˆ¶ä¿è¯é…ç½®çš„åŠæ—¶æ›´æ–°ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ Nacos Client å¤„ç†é…ç½®ç›¸å…³çš„æµç¨‹å›¾ï¼Œä¹‹åå†æ·±å…¥åˆ°æºç ä¹‹ä¸­ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0327bdcdff714748bc575844eacf5e6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pa55ZyG5oOz5b2T5Zu-54G1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763798539&amp;x-signature=F9rsOKeZJyCVWrxGzW5%2FI6jdnnI%3D" alt="nacos-client.png" loading="lazy"/></p>
<p>Nacos Client åœ¨æ¥æ”¶åˆ° Nacos Server å‘é€çš„é…ç½®å˜æ›´è¯·æ±‚ <code>ConfigChangeNotifyRequest</code> åï¼Œä¼šæ›´æ–°ä¿å­˜åœ¨å†…å­˜ä¸­çš„ <code>CacheData</code> é…ç½®å¯¹è±¡çš„æ ‡å¿—ä½ï¼Œåˆ†åˆ«è¡¨ç¤ºæ”¶åˆ°äº†é…ç½®å˜æ›´è¯·æ±‚å’Œä¸æœåŠ¡ç«¯é…ç½®å†…å®¹ä¸ä¸€è‡´ï¼Œæ³¨æ„ <strong>æ­¤æ—¶å¹¶æ²¡æœ‰æ›´æ–°é…ç½®çš„å†…å®¹</strong>ï¼Œéšåä¼šåœ¨é˜»å¡é˜Ÿåˆ—ä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ ã€‚å®¢æˆ·ç«¯åœ¨å¯åŠ¨æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ª <strong>å•çº¿ç¨‹çš„çº¿ç¨‹æ± å¹¶æäº¤ä¸€ä¸ªå¿™ä»»åŠ¡</strong>ï¼ˆ<code>while (true)</code>ï¼‰ï¼Œé¦–å…ˆè¿™ä¸ªä»»åŠ¡ä¼šæ£€æŸ¥é˜»å¡é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰å…ƒç´ ï¼Œå¦‚æœæœ‰å…ƒç´ çš„è¯ç«‹å³å¤„ç†åŒæ­¥é…ç½®çš„ä»»åŠ¡ï¼Œå¦åˆ™é˜»å¡ 5 ç§’åä¸»åŠ¨åŒæ­¥é…ç½®ï¼Œ<strong>è¿™ä¹Ÿå°±æ˜¯ Nacos Client çš„ä¸»åŠ¨æ‹‰å–é…ç½®å†…å®¹çš„æœºåˆ¶</strong>ã€‚åœ¨æ‰§è¡ŒåŒæ­¥é…ç½®çš„ä»»åŠ¡æ—¶ï¼Œä¼šæœ‰ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li><code>checkLocalConfig</code>: æ£€æŸ¥æœ¬åœ°é…ç½®æ–‡ä»¶ï¼ˆæ•…éšœè½¬ç§»æ–‡ä»¶ï¼‰ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š<strong>Nacos Client çš„é…ç½®æ•…éšœè½¬ç§»æ–‡ä»¶å¹¶ä¸æ˜¯ç”±å®¢æˆ·ç«¯ç¨‹åºè‡ªåŠ¨åˆ›å»ºå’Œå†™å…¥çš„ï¼Œè€Œæ˜¯éœ€è¦ç”¨æˆ·æ‰‹åŠ¨ç»´æŠ¤çš„åº”æ€¥æœºåˆ¶</strong>ï¼Œè¿™æ ·èƒ½é¿å…é…ç½®çš„æ··ä¹±ï¼Œåˆæä¾›äº†åº”æ€¥çš„æœºåˆ¶</li>
<li><code>checkListenerMd5</code>: æ£€æŸ¥é…ç½®çš„å˜æ›´æƒ…å†µï¼Œå¦‚æœæœ‰é…ç½®å†…å®¹å‘ç”Ÿå˜æ›´ï¼Œåˆ™é€šçŸ¥è®¢é˜…äº†è¿™äº›é…ç½®çš„ç›‘å¬å™¨</li>
<li><code>checkListenCache</code>: é€šè¿‡ gRPC è¯·æ±‚æ¥å£è·å–å“ªäº›é…ç½®å‘ç”Ÿäº†å˜æ›´å¹¶è·å–å¯¹åº”çš„é…ç½®å†…å®¹ï¼Œæ›´æ–°åˆ°æœ¬åœ°ç¼“å­˜å¯¹è±¡ <code>CacheData</code> ä¸­ï¼Œå¹¶é‡ç½®æ ‡å¿—ä½ï¼Œéšåå›è°ƒè®¢é˜…äº†è¿™äº›é…ç½®çš„ç›‘å¬å™¨</li>
<li><code>checkRemoveListenCache</code>: å°†å·²ç»å¤±æ•ˆçš„é…ç½®ç§»é™¤</li>
<li><code>notifyListenConfig</code>: å¦‚æœå‘ç”Ÿé…ç½®å˜æ›´ï¼Œåˆ™å†è§¦å‘ä¸€æ¬¡åŒæ­¥é…ç½®çš„ä»»åŠ¡</li>
</ol>
<p>Nacos Client å®¢æˆ·ç«¯å¤„ç†é…ç½®å˜æ›´çš„é€»è¾‘å¹¶ä¸å¤æ‚ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ¯æ¬¡ Nacos Client å‘ Nacos Server è¯»å–çš„æ—¶å€™éƒ½ä¼šèµ°ç¼“å­˜ï¼ˆç£ç›˜æ–‡ä»¶å’Œå†…å­˜å¯¹è±¡ï¼‰ï¼Œå› æ­¤ <strong>Nacos Client å’Œ Nacos Server ä¹‹é—´çš„éµå¾ªçš„æ˜¯ AP å®šç†</strong>ï¼Œéµå¾ªæ•°æ®çš„ <strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ï¼Œé€šè¿‡ Nacos Client çš„å®šæœŸé‡è¯•æ¥ä¿è¯é…ç½®æ•°æ®çš„æ›´æ–°ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ <strong>èƒ½å¤Ÿé¿å…æ•°æ®åº“æˆä¸ºæ€§èƒ½ç“¶é¢ˆ</strong>ã€‚</p>
<p>Nacos Client çš„ä¸»è¦æµç¨‹å¦‚ä¸Šæ‰€è¿°ï¼Œæ¥ä¸‹æ¥ä¸ºæºç å†…å®¹è§£æã€‚</p>
<hr/>
<p>åœ¨ Nacos Client å¯åŠ¨æ—¶ï¼Œå®ƒä¼šæ‰§è¡Œ <code>ConfigRpcTransportClient#initRpcClientHandler</code> æ–¹æ³•æ¥æ³¨å†Œé…ç½®å˜æ›´çš„å¤„ç†å™¨ï¼Œè¿™æ ·åœ¨æ¥æ”¶åˆ°æœåŠ¡ç«¯æ¨é€é…ç½®å˜æ›´çš„è¯·æ±‚æ—¶ï¼Œä¼šæ‰§è¡Œ <code>ConfigRpcTransportClient#handleConfigChangeNotifyRequest</code> æ–¹æ³•æ¥å¤„ç†è¯·æ±‚ï¼Œå¤„ç†é€»è¾‘å¹¶ä¸å¤æ‚ï¼Œå®ƒä¼šæ ¹æ®é…ç½®ä¿¡æ¯çš„å”¯ä¸€æ ‡è¯†æ¥æŸ¥è¯¢é…ç½®ä¿¡æ¯çš„ç¼“å­˜æ•°æ®ï¼Œè·å–æˆåŠŸåä¼šåªæ˜¯å¯¹ç¼“å­˜è¿›è¡Œæ‰“æ ‡ï¼Œè€Œæ²¡æœ‰ç›´æ¥ä¿®æ”¹å†…å­˜æ•°æ®ï¼Œå¹¶ä¸”å‘ <code>BlockingQueue&lt;Object&gt; listenExecutebell</code> é˜»å¡é˜Ÿåˆ—å¯¹è±¡ä¸­æ·»åŠ äº†ä¸€ä¸ªå…ƒç´ ï¼Œéšåå¤„ç†æœåŠ¡ç«¯è¯·æ±‚çš„æµç¨‹å°±ç»“æŸäº†ï¼Œä½†æ˜¯æ­¤æ—¶è¿˜å¹¶æ²¡æœ‰å®Œæˆé…ç½®å†…å®¹çš„å˜æ›´ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClientWorker</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Closeable</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigRpcTransportClient</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ConfigTransportClient</span> {

        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BlockingQueue&lt;Object&gt; listenExecutebell = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">1</span>);
        
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initRpcClientHandler</span><span class="hljs-params">(<span class="hljs-keyword">final</span> RpcClient rpcClientInner)</span> {
            <span class="hljs-comment">// æ³¨å†Œ é…ç½®å˜æ›´ æˆ– é…ç½®é‡åŒæ­¥å¤„ç†å™¨</span>
            rpcClientInner.registerServerRequestHandler((request, connection) -&gt; {
                <span class="hljs-comment">// config change notify</span>
                <span class="hljs-keyword">if</span> (request <span class="hljs-keyword">instanceof</span> ConfigChangeNotifyRequest) {
                    <span class="hljs-comment">// å®¢æˆ·ç«¯å¤„ç†æœåŠ¡ç«¯æ¨é€çš„é…ç½®å˜æ›´é€šçŸ¥è¯·æ±‚</span>
                    <span class="hljs-keyword">return</span> handleConfigChangeNotifyRequest((ConfigChangeNotifyRequest) request,
                            rpcClientInner.getName());
                }
                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
            });
            
            <span class="hljs-comment">// ...</span>
        }

        ConfigChangeNotifyResponse <span class="hljs-title function_">handleConfigChangeNotifyRequest</span><span class="hljs-params">(ConfigChangeNotifyRequest configChangeNotifyRequest,
                                                                   String clientName)</span> {
            <span class="hljs-comment">// æ„å»ºé…ç½®å”¯ä¸€æ ‡è¯†ï¼ŒæŸ¥æ‰¾å¯¹åº”çš„æœ¬åœ°ç¼“å­˜æ•°æ®</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">groupKey</span> <span class="hljs-operator">=</span> GroupKey.getKeyTenant(configChangeNotifyRequest.getDataId(),
                    configChangeNotifyRequest.getGroup(), configChangeNotifyRequest.getTenant());

            <span class="hljs-comment">// è·å–å¯¹åº”çš„ç¼“å­˜æ•°æ®</span>
            <span class="hljs-type">CacheData</span> <span class="hljs-variable">cacheData</span> <span class="hljs-operator">=</span> cacheMap.get().get(groupKey);
            <span class="hljs-keyword">if</span> (cacheData != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">synchronized</span> (cacheData) {
                    <span class="hljs-comment">// æ ‡è®°é…ç½®çŠ¶æ€å˜æ›´ï¼Œè§¦å‘é…ç½®æ‹‰å–å’Œç›‘å¬å™¨é€šçŸ¥</span>
                    cacheData.getReceiveNotifyChanged().set(<span class="hljs-literal">true</span>);
                    <span class="hljs-comment">// æ ‡è®°ä¸æœåŠ¡ç«¯ä¸ä¸€è‡´</span>
                    cacheData.setConsistentWithServer(<span class="hljs-literal">false</span>);
                    <span class="hljs-comment">// é‡è¦ï¼šç«‹å³è§¦å‘ç›‘å¬é…ç½®æ£€æŸ¥</span>
                    notifyListenConfig();
                }

            }
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigChangeNotifyResponse</span>();
        }

        <span class="hljs-comment">// å½“æœ‰æ–°çš„ç›‘å¬å™¨æ·»åŠ æˆ–é…ç½®å˜æ›´æ—¶æˆ–å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨ startInternal ä¸­çš„å¾ªç¯å°±ä¼šè¢«å”¤é†’</span>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyListenConfig</span><span class="hljs-params">()</span> {
            <span class="hljs-comment">// å‘é˜»å¡é˜Ÿåˆ—ä¸­æ”¾å…¥ä¸€ä¸ªå…ƒç´ ï¼Œå”¤é†’ startInternal ä¸­çš„å¾ªç¯</span>
            listenExecutebell.offer(bellItem);
        }
    }
    
}
</code></pre>
<p>é‚£ä¹ˆé…ç½®çš„å†…å®¹ä½•æ—¶å˜æ›´å‘¢ï¼Ÿå‘é˜»å¡é˜Ÿåˆ— <code>BlockingQueue&lt;Object&gt; listenExecutebell</code> ä¸­æ·»åŠ å…ƒç´ çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿçœ‹æ¥ä¸‹æ¥çš„æºç ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClientWorker</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Closeable</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigRpcTransportClient</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ConfigTransportClient</span> {

        <span class="hljs-keyword">private</span> ExecutorService listenExecutor;

        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BlockingQueue&lt;Object&gt; listenExecutebell = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">1</span>);
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startInternal</span><span class="hljs-params">()</span> {
            listenExecutor =
                    Executors.newSingleThreadExecutor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NameThreadFactory</span>(<span class="hljs-string">"com.alibaba.nacos.client.listen-executor"</span>));
            listenExecutor.submit(() -&gt; {
                <span class="hljs-comment">// å¿™ä»»åŠ¡</span>
                <span class="hljs-keyword">while</span> (!listenExecutor.isShutdown() &amp;&amp; !listenExecutor.isTerminated()) {
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-comment">// é˜»å¡ç­‰å¾…é€šçŸ¥ï¼Œæœ€å¤šç­‰å¾…5ç§’</span>
                        listenExecutebell.poll(<span class="hljs-number">5L</span>, TimeUnit.SECONDS);
                        <span class="hljs-keyword">if</span> (listenExecutor.isShutdown() || listenExecutor.isTerminated()) {
                            <span class="hljs-keyword">continue</span>;
                        }
                        <span class="hljs-comment">// æ‰§è¡Œé…ç½®ç›‘å¬æ£€æŸ¥</span>
                        executeConfigListen();
                    } <span class="hljs-keyword">catch</span> (Throwable e) {
                        LOGGER.error(<span class="hljs-string">"[rpc listen execute] [rpc listen] exception"</span>, e);
                        <span class="hljs-keyword">try</span> {
                            Thread.sleep(<span class="hljs-number">50L</span>);
                        } <span class="hljs-keyword">catch</span> (InterruptedException interruptedException) {
                            <span class="hljs-comment">// ignore</span>
                        }
                        <span class="hljs-comment">// å‡ºç°å¼‚å¸¸æ—¶é‡æ–°é€šçŸ¥ç›‘å¬é…ç½®</span>
                        notifyListenConfig();
                    }
                }
            });
        }
    }

}
</code></pre>
<p>åœ¨ Nacos Client å¯åŠ¨æ—¶ä¼šè°ƒç”¨ <code>ConfigRpcTransportClient#startInternal</code> æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ª <code>ExecutorService listenExecutor</code> çº¿ç¨‹æ± ï¼ˆè¿™æ®µé€»è¾‘æ˜¯æˆ‘åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falibaba%2Fnacos%2Fcommit%2F39a55482912c52e373009f652635d4588fb8d860" target="_blank" title="https://github.com/alibaba/nacos/commit/39a55482912c52e373009f652635d4588fb8d860" ref="nofollow noopener noreferrer">ISSUE #13822</a> ä¸­ä¿®æ”¹è¿‡åçš„ï¼‰ï¼Œè¿™ä¸ªçº¿ç¨‹æ± åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹ä¼šå¤„ç†ä¸€ä¸ªâ€œå¿™â€ä»»åŠ¡ï¼šå¾ªç¯æ£€æŸ¥é…ç½®æ˜¯å¦å‘ç”Ÿå˜æ›´ï¼Œç›´åˆ°çº¿ç¨‹æ± å…³é—­ã€‚<code>BlockingQueue&lt;Object&gt; listenExecutebell</code> æ˜¯é˜»å¡é˜Ÿåˆ—ï¼Œå½“é…ç½®å˜æ›´æ—¶æ·»åŠ å…ƒç´ ï¼Œä¼šç«‹å³è§¦å‘ <code>executeConfigListen</code> é…ç½®æ£€æŸ¥çš„é€»è¾‘ï¼Œå¦åˆ™ä¼š <strong>é˜»å¡ç­‰å¾… 5 ç§’ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿åœ¨é…ç½®æ²¡æœ‰å‘ç”Ÿå˜æ›´çš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¼šè§¦å‘é…ç½®çš„æ£€æŸ¥æ“ä½œ</strong>ã€‚ç°åœ¨æˆ‘ä»¬æ˜ç™½äº†é˜»å¡é˜Ÿåˆ— <code>BlockingQueue&lt;Object&gt; listenExecutebell</code> çš„ä½œç”¨ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­çœ‹ä¸€ä¸‹ <code>executeConfigListen</code> æ‰§è¡Œé…ç½®æ£€æŸ¥çš„é€»è¾‘ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClientWorker</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Closeable</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigRpcTransportClient</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ConfigTransportClient</span> {

        <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">lastAllSyncTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();

        <span class="hljs-comment">/**
         * 3 minutes to check all listen cache keys.
         */</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">ALL_SYNC_INTERNAL</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000L</span>;
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeConfigListen</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> NacosException {
            <span class="hljs-comment">// æŒ‰ taskId åˆ†ç»„ç›‘å¬ç¼“å­˜å’Œç§»é™¤ç›‘å¬ç¼“å­˜</span>
            Map&lt;String, List&lt;CacheData&gt;&gt; listenCachesMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(<span class="hljs-number">16</span>);
            Map&lt;String, List&lt;CacheData&gt;&gt; removeListenCachesMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(<span class="hljs-number">16</span>);
            <span class="hljs-type">long</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
            <span class="hljs-comment">// æ¯3åˆ†é’Ÿè¿›è¡Œä¸€æ¬¡å…¨é‡åŒæ­¥æ£€æŸ¥</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">needAllSync</span> <span class="hljs-operator">=</span> now - lastAllSyncTime &gt;= ALL_SYNC_INTERNAL;
            <span class="hljs-comment">// éå†æ‰€æœ‰ç¼“å­˜é…ç½®ï¼ŒæŒ‰çŠ¶æ€åˆ†ç±»</span>
            <span class="hljs-keyword">for</span> (CacheData cache : cacheMap.get().values()) {
                <span class="hljs-keyword">synchronized</span> (cache) {
                    <span class="hljs-comment">// 1. æ£€æŸ¥æœ¬åœ°é…ç½®ï¼ˆæ•…éšœè½¬ç§»æ–‡ä»¶ï¼‰</span>
                    checkLocalConfig(cache);

                    <span class="hljs-comment">// è¿™ä¸ªå˜é‡åœ¨æ”¶åˆ°æœåŠ¡ç«¯æ¨é€é…ç½®å˜æ›´çš„è¯·æ±‚æ—¶ä¼šè¢«ä¿®æ”¹ä¸º falseï¼Œå¦åˆ™ä¸º true</span>
                    <span class="hljs-keyword">if</span> (cache.isConsistentWithServer()) {
                        <span class="hljs-comment">// 2. æ£€æŸ¥é…ç½®å˜æ›´ï¼Œå¦‚æœå‘ç”Ÿå˜æ›´ä¾¿é€šçŸ¥å„ä¸ªç›‘å¬å™¨</span>
                        cache.checkListenerMd5();
                        <span class="hljs-comment">// å¦‚æœä¸æœåŠ¡ç«¯é…ç½®ä¸€è‡´ä¸”ä¸éœ€è¦å…¨é‡åŒæ­¥ï¼Œåˆ™è·³è¿‡è¿™ä¸ªé…ç½®ç¼“å­˜æ¥ä¸‹æ¥çš„é€»è¾‘</span>
                        <span class="hljs-keyword">if</span> (!needAllSync) {
                            <span class="hljs-keyword">continue</span>;
                        }
                    }

                    <span class="hljs-comment">// å¦‚æœä½¿ç”¨æœ¬åœ°é…ç½®ä¿¡æ¯ï¼Œè·³è¿‡å¤„ç†</span>
                    <span class="hljs-keyword">if</span> (cache.isUseLocalConfigInfo()) {
                        <span class="hljs-keyword">continue</span>;
                    }

                    <span class="hljs-comment">// æ ¹æ®ç¼“å­˜çŠ¶æ€åˆ†ç±»å¤„ç†</span>
                    <span class="hljs-keyword">if</span> (!cache.isDiscard()) {
                        <span class="hljs-comment">// éœ€è¦ç›‘å¬çš„é…ç½®</span>
                        List&lt;CacheData&gt; cacheDatas = listenCachesMap.computeIfAbsent(String.valueOf(cache.getTaskId()),
                                k -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;());
                        cacheDatas.add(cache);
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-comment">// éœ€è¦ç§»é™¤ç›‘å¬çš„é…ç½®</span>
                        List&lt;CacheData&gt; cacheDatas = removeListenCachesMap.computeIfAbsent(
                                String.valueOf(cache.getTaskId()), k -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;());
                        cacheDatas.add(cache);
                    }
                }

            }

            <span class="hljs-comment">// 3. æ‰§è¡Œç›‘å¬æ£€æŸ¥ï¼Œè¿”å›æ˜¯å¦æœ‰å˜æ›´ï¼Œæ‰§è¡Œæ—¶ä¼šä»æœåŠ¡ç«¯æŸ¥è¯¢æœ€æ–°é…ç½®å†…å®¹å¹¶è§¦å‘ç›‘å¬å™¨å›è°ƒ</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">hasChangedKeys</span> <span class="hljs-operator">=</span> checkListenCache(listenCachesMap);

            <span class="hljs-comment">// 4. æ‰§è¡Œç§»é™¤ discard çš„é…ç½®</span>
            checkRemoveListenCache(removeListenCachesMap);

            <span class="hljs-keyword">if</span> (needAllSync) {
                lastAllSyncTime = now;
            }

            <span class="hljs-comment">// 5. å¦‚æœæœ‰å˜æ›´ï¼Œé‡æ–°é€šçŸ¥ç›‘å¬é…ç½®ï¼ˆå½¢æˆå¾ªç¯ï¼‰ï¼Œå†ç«‹å³å¤„ç†ä¸€éä¸Šè¿°é€»è¾‘</span>
            <span class="hljs-keyword">if</span> (hasChangedKeys) {
                notifyListenConfig();
            }
        }

        <span class="hljs-comment">/**
         * Checks and handles local configuration for a given CacheData object. This method evaluates the use of
         * failover files for local configuration storage and updates the CacheData accordingly.
         * ç”¨äºå¤„ç†æœ¬åœ°é…ç½®æ•…éšœè½¬ç§»ï¼ˆfailoverï¼‰æœºåˆ¶ï¼Œç”¨äº Nacos çš„é«˜å¯ç”¨åœºæ™¯ï¼Œå½“å®¢æˆ·ç«¯æ— æ³•è¿æ¥åˆ° Nacos æœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥é€šè¿‡æœ¬åœ°æ•…éšœè½¬ç§»æ–‡ä»¶ç»§ç»­æä¾›é…ç½®æœåŠ¡ï¼Œç¡®ä¿åº”ç”¨ç¨‹åºçš„æ­£å¸¸è¿è¡Œ
         *
         * <span class="hljs-doctag">@param</span> cacheData The CacheData object to be processed.
         */</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkLocalConfig</span><span class="hljs-params">(CacheData cacheData)</span> {
            <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">dataId</span> <span class="hljs-operator">=</span> cacheData.dataId;
            <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> cacheData.group;
            <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">tenant</span> <span class="hljs-operator">=</span> cacheData.tenant;
            <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">envName</span> <span class="hljs-operator">=</span> cacheData.envName;

            <span class="hljs-comment">// Check if a failover file exists for the specified dataId, group, and tenant.</span>
            <span class="hljs-comment">// æ ¡éªŒæ•…éšœè½¬ç§»æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span>
            <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> LocalConfigInfoProcessor.getFailoverFile(envName, dataId, group, tenant);

            <span class="hljs-comment">// If not using local config info and a failover file exists, load and use it.</span>
            <span class="hljs-comment">// å¦‚æœæœªä½¿ç”¨æœ¬åœ°é…ç½®ä¿¡æ¯ä¸”æ•…éšœè½¬ç§»æ–‡ä»¶å­˜åœ¨ï¼ŒåŠ è½½å¹¶ä½¿ç”¨å®ƒã€‚</span>
            <span class="hljs-keyword">if</span> (!cacheData.isUseLocalConfigInfo() &amp;&amp; file.exists()) {
                <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> LocalConfigInfoProcessor.getFailover(envName, dataId, group, tenant);
                <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">md5</span> <span class="hljs-operator">=</span> MD5Utils.md5Hex(content, Constants.ENCODE);
                <span class="hljs-comment">// å˜æ›´ä¸ºä½¿ç”¨æœ¬åœ°é…ç½®</span>
                cacheData.setUseLocalConfigInfo(<span class="hljs-literal">true</span>);
                cacheData.setLocalConfigInfoVersion(file.lastModified());
                cacheData.setContent(content);
                LOGGER.warn(<span class="hljs-string">"[{}] [failover-change] failover file created. dataId={}, group={}, tenant={}, md5={}"</span>,
                        envName, dataId, group, tenant, md5);
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-comment">// If use local config info, but the failover file is deleted, switch back to server config.</span>
            <span class="hljs-comment">// å¦‚æœä½¿ç”¨æœ¬åœ°é…ç½®ä¿¡æ¯ï¼Œä½†æ•…éšœè½¬ç§»æ–‡ä»¶è¢«åˆ é™¤ï¼Œåˆ™åˆ‡æ¢å›æœåŠ¡å™¨é…ç½®</span>
            <span class="hljs-keyword">if</span> (cacheData.isUseLocalConfigInfo() &amp;&amp; !file.exists()) {
                cacheData.setUseLocalConfigInfo(<span class="hljs-literal">false</span>);
                LOGGER.warn(<span class="hljs-string">"[{}] [failover-change] failover file deleted. dataId={}, group={}, tenant={}"</span>, envName,
                        dataId, group, tenant);
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-comment">// When the failover file content changes, indicating a change in local configuration.</span>
            <span class="hljs-comment">// ä½¿ç”¨æœ¬åœ°é…ç½®ï¼Œæ–‡ä»¶å­˜åœ¨ä¸”æ–‡ä»¶ä¿®æ”¹æ—¶é—´å‘ç”Ÿå˜æ›´ï¼Œè¡¨ç¤ºæœ¬åœ°é…ç½®å‘ç”Ÿäº†å˜åŒ–ï¼Œéœ€è¦æ›´æ–°æœ¬åœ°é…ç½®ä¿¡æ¯</span>
            <span class="hljs-keyword">if</span> (cacheData.isUseLocalConfigInfo() &amp;&amp; file.exists()
                    &amp;&amp; cacheData.getLocalConfigInfoVersion() != file.lastModified()) {
                <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> LocalConfigInfoProcessor.getFailover(envName, dataId, group, tenant);
                <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">md5</span> <span class="hljs-operator">=</span> MD5Utils.md5Hex(content, Constants.ENCODE);
                cacheData.setUseLocalConfigInfo(<span class="hljs-literal">true</span>);
                cacheData.setLocalConfigInfoVersion(file.lastModified());
                cacheData.setContent(content);
                LOGGER.warn(<span class="hljs-string">"[{}] [failover-change] failover file changed. dataId={}, group={}, tenant={}, md5={}"</span>,
                        envName, dataId, group, tenant, md5);
            }
        }
    }

}
</code></pre>
<p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œç¬¬ä¸€ä¸ªå…³æ³¨ç‚¹æ˜¯ <code>checkLocalConfig</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äº <strong>å¤„ç†æœ¬åœ°é…ç½®æ•…éšœè½¬ç§»ï¼ˆfailoverï¼‰</strong>ï¼Œç”¨äº Nacos çš„ <strong>é«˜å¯ç”¨</strong> åœºæ™¯ï¼Œå½“å®¢æˆ·ç«¯æ— æ³•è¿æ¥åˆ° Nacos æœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥é€šè¿‡æœ¬åœ°æ•…éšœè½¬ç§»æ–‡ä»¶ç»§ç»­æä¾›é…ç½®æœåŠ¡ï¼Œç¡®ä¿åº”ç”¨ç¨‹åºçš„æ­£å¸¸è¿è¡Œï¼Œå…·ä½“å¯ä»¥å…³æ³¨æ³¨é‡Šä¿¡æ¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<strong>Nacos Client çš„é…ç½®æ•…éšœè½¬ç§»æ–‡ä»¶å¹¶ä¸æ˜¯ç”±å®¢æˆ·ç«¯ç¨‹åºè‡ªåŠ¨åˆ›å»ºå’Œå†™å…¥çš„ï¼Œè€Œæ˜¯éœ€è¦ç”¨æˆ·æ‰‹åŠ¨ç»´æŠ¤çš„åº”æ€¥æœºåˆ¶</strong>ï¼Œè¿™æ ·èƒ½é¿å…é…ç½®çš„æ··ä¹±ï¼Œåˆæä¾›äº†åº”æ€¥çš„æœºåˆ¶ã€‚</p>
<p><code>CacheData#isConsistentWithServer</code> åœ¨æ¥æ”¶åˆ°æœåŠ¡ç«¯æ¨é€é…ç½®å˜æ›´æ—¶ä¼šè¢«ä¿®æ”¹ä¸º falseï¼Œè¡¨ç¤ºä¸æœåŠ¡ç«¯é…ç½®ä¿¡æ¯ä¸ä¸€è‡´ï¼Œä¸ä¸€è‡´çš„è¯å®ƒä¼šæ‰§è¡Œ <code>CacheData#checkListenerMd5</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯æ£€æŸ¥å†…å­˜ä¸­é…ç½®ä¿¡æ¯çš„ MD5 å€¼ä¸â€œç›‘å¬å™¨â€ä¸­è®°å½•çš„ MD5 å€¼æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´çš„è¯ï¼Œåˆ™â€œå®‰å…¨åœ°â€é€šçŸ¥å„ä¸ªç›‘å¬å™¨ï¼š</p>
<blockquote>
<p>ç›‘å¬å™¨ <code>ManagerListenerWrap</code>ï¼šæ˜¯æŒ‡ç”¨æˆ·åˆ›å»ºçš„è®¢é˜…å„ä¸ªé…ç½®ä¿¡æ¯çš„ç›‘å¬å™¨</p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheData</span> {

    <span class="hljs-comment">/**
     * ç›‘å¬å™¨åˆ—è¡¨.
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CopyOnWriteArrayList&lt;ManagerListenerWrap&gt; listeners;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> String md5;
    
    <span class="hljs-comment">/**
     * æ£€æŸ¥é…ç½®æ˜¯å¦å‘ç”Ÿå˜æ›´ï¼Œéå†æ‰€æœ‰ç›‘å¬å™¨ï¼Œæ£€æŸ¥MD5æ˜¯å¦å˜æ›´ï¼Œè‹¥å˜æ›´åˆ™è°ƒç”¨ safeNotifyListener è§¦å‘ç”¨æˆ·ç›‘å¬å™¨
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkListenerMd5</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">for</span> (ManagerListenerWrap wrap : listeners) {
            <span class="hljs-comment">// é…ç½®å‘ç”Ÿå˜æ›´ï¼Œè§¦å‘ç›‘å¬å™¨</span>
            <span class="hljs-keyword">if</span> (!md5.equals(wrap.lastCallMd5)) {
                safeNotifyListener(dataId, group, content, type, md5, encryptedDataKey, wrap);
            }
        }
    }

    <span class="hljs-comment">// å®‰å…¨åœ°é€šçŸ¥ç›‘å¬å™¨ï¼Œè°ƒç”¨ç”¨æˆ·çš„ receiveConfigInfo æ–¹æ³•ï¼Œå®Œæˆé…ç½®å˜æ›´é€šçŸ¥</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">safeNotifyListener</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String dataId, <span class="hljs-keyword">final</span> String group, <span class="hljs-keyword">final</span> String content, <span class="hljs-keyword">final</span> String type,
                                    <span class="hljs-keyword">final</span> String md5, <span class="hljs-keyword">final</span> String encryptedDataKey, <span class="hljs-keyword">final</span> ManagerListenerWrap listenerWrap)</span> {
        <span class="hljs-keyword">final</span> <span class="hljs-type">Listener</span> <span class="hljs-variable">listener</span> <span class="hljs-operator">=</span> listenerWrap.listener;
        <span class="hljs-comment">// é˜²æ­¢é‡å¤é€šçŸ¥</span>
        <span class="hljs-keyword">if</span> (listenerWrap.inNotifying) {
            LOGGER.warn(
                    <span class="hljs-string">"[{}] [notify-currentSkip] dataId={}, group={},tenant={}, md5={}, listener={}, listener is not finish yet,will try next time."</span>,
                    envName, dataId, group, tenant, md5, listener);
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-comment">// åˆ›å»ºé€šçŸ¥ä»»åŠ¡</span>
        <span class="hljs-type">NotifyTask</span> <span class="hljs-variable">job</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NotifyTask</span>() {

            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
                <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">myClassLoader</span> <span class="hljs-operator">=</span> Thread.currentThread().getContextClassLoader();
                <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">appClassLoader</span> <span class="hljs-operator">=</span> listener.getClass().getClassLoader();
                ScheduledFuture&lt;?&gt; timeSchedule = <span class="hljs-literal">null</span>;

                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// ä¸º AbstractSharedListener å…±äº«ç›‘å¬å™¨å¡«å……ä¸Šä¸‹æ–‡ä¿¡æ¯</span>
                    <span class="hljs-keyword">if</span> (listener <span class="hljs-keyword">instanceof</span> AbstractSharedListener) {
                        <span class="hljs-type">AbstractSharedListener</span> <span class="hljs-variable">adapter</span> <span class="hljs-operator">=</span> (AbstractSharedListener) listener;
                        adapter.fillContext(dataId, group);
                        LOGGER.info(<span class="hljs-string">"[{}] [notify-context] dataId={}, group={},tenant={}, md5={}"</span>, envName, dataId,
                                group, tenant, md5);
                    }
                    <span class="hljs-comment">// Before executing the callback, set the thread classloader to the classloader of</span>
                    <span class="hljs-comment">// the specific webapp to avoid exceptions or misuses when calling the spi interface in</span>
                    <span class="hljs-comment">// the callback method (this problem occurs only in multi-application deployment).</span>
                    <span class="hljs-comment">// åœ¨æ‰§è¡Œå›è°ƒä¹‹å‰ï¼Œå°†çº¿ç¨‹ç±»åŠ è½½å™¨è®¾ç½®ä¸ºç‰¹å®šwebappçš„ç±»åŠ è½½å™¨ï¼Œä»¥é¿å…åœ¨å›è°ƒæ–¹æ³•ä¸­è°ƒç”¨spiæ¥å£æ—¶å‡ºç°å¼‚å¸¸æˆ–è¯¯ç”¨ï¼ˆæ­¤é—®é¢˜ä»…åœ¨å¤šåº”ç”¨ç¨‹åºéƒ¨ç½²ä¸­å‘ç”Ÿï¼‰</span>
                    Thread.currentThread().setContextClassLoader(appClassLoader);

                    <span class="hljs-type">ConfigResponse</span> <span class="hljs-variable">cr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigResponse</span>();
                    cr.setDataId(dataId);
                    cr.setGroup(group);
                    cr.setContent(content);
                    cr.setEncryptedDataKey(encryptedDataKey);
                    configFilterChainManager.doFilter(<span class="hljs-literal">null</span>, cr);
                    <span class="hljs-type">String</span> <span class="hljs-variable">contentTmp</span> <span class="hljs-operator">=</span> cr.getContent();
                    <span class="hljs-comment">// å»¶æœŸ 60s æ‰§è¡Œè¶…æ—¶å‘Šè­¦WARNä»»åŠ¡</span>
                    timeSchedule = getNotifyBlockMonitor().schedule(
                            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LongNotifyHandler</span>(listener.getClass().getSimpleName(), dataId, group, tenant, md5,
                                    notifyWarnTimeout, Thread.currentThread()), notifyWarnTimeout,
                            TimeUnit.MILLISECONDS);
                    listenerWrap.inNotifying = <span class="hljs-literal">true</span>;
                    <span class="hljs-comment">// å›è°ƒç›‘å¬å™¨çš„æ–¹æ³•ï¼Œå‘ŠçŸ¥ç”¨æˆ·æ¥æ”¶åˆ°çš„é…ç½®ä¿¡æ¯</span>
                    listener.receiveConfigInfo(contentTmp);
                    <span class="hljs-comment">// compare lastContent and content</span>
                    <span class="hljs-keyword">if</span> (listener <span class="hljs-keyword">instanceof</span> AbstractConfigChangeListener) {
                        <span class="hljs-comment">// å˜æ›´ç›‘å¬å™¨ AbstractConfigChangeListener ç›¸å…³é€»è¾‘ï¼šå˜æ›´é…ç½®ä¿¡æ¯å¹¶è§¦å‘å˜æ›´äº‹ä»¶</span>
                        Map&lt;String, ConfigChangeItem&gt; data = ConfigChangeHandler.getInstance()
                                .parseChangeData(listenerWrap.lastContent, contentTmp, type);
                        <span class="hljs-type">ConfigChangeEvent</span> <span class="hljs-variable">event</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigChangeEvent</span>(data);
                        ((AbstractConfigChangeListener) listener).receiveConfigChange(event);
                        listenerWrap.lastContent = contentTmp;
                    }

                    <span class="hljs-comment">// å˜æ›´ MD5 ä¿¡æ¯</span>
                    listenerWrap.lastCallMd5 = md5;
                    LOGGER.info(
                            <span class="hljs-string">"[{}] [notify-ok] dataId={}, group={},tenant={}, md5={}, listener={} ,job run cost={} millis."</span>,
                            envName, dataId, group, tenant, md5, listener, (System.currentTimeMillis() - start));
                } <span class="hljs-keyword">catch</span> (NacosException ex) {
                    LOGGER.error(
                            <span class="hljs-string">"[{}] [notify-error] dataId={}, group={},tenant={},md5={}, listener={} errCode={} errMsg={},stackTrace :{}"</span>,
                            envName, dataId, group, tenant, md5, listener, ex.getErrCode(), ex.getErrMsg(),
                            getTrace(ex.getStackTrace(), <span class="hljs-number">3</span>));
                } <span class="hljs-keyword">catch</span> (Throwable t) {
                    LOGGER.error(<span class="hljs-string">"[{}] [notify-error] dataId={}, group={},tenant={}, md5={}, listener={} tx={}"</span>,
                            envName, dataId, group, tenant, md5, listener, getTrace(t.getStackTrace(), <span class="hljs-number">3</span>));
                } <span class="hljs-keyword">finally</span> {
                    listenerWrap.inNotifying = <span class="hljs-literal">false</span>;
                    Thread.currentThread().setContextClassLoader(myClassLoader);
                    <span class="hljs-comment">// åŠæ—¶é€šçŸ¥å®Œæˆå°±å–æ¶ˆå®šæ—¶ä»»åŠ¡</span>
                    <span class="hljs-keyword">if</span> (timeSchedule != <span class="hljs-literal">null</span>) {
                        timeSchedule.cancel(<span class="hljs-literal">true</span>);
                    }
                }
            }
        };

        <span class="hljs-comment">// æ‰§è¡Œä»»åŠ¡ï¼šå¦‚æœé…ç½®äº†çº¿ç¨‹æ± ï¼Œåˆ™å¼‚æ­¥æ‰§è¡Œï¼Œå¦åˆ™åŒæ­¥æ‰§è¡Œ</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != listener.getExecutor()) {
                LOGGER.info(
                        <span class="hljs-string">"[{}] [notify-listener] task submitted to user executor, dataId={}, group={},tenant={}, md5={}, listener={} "</span>,
                        envName, dataId, group, tenant, md5, listener);
                job.async = <span class="hljs-literal">true</span>;
                listener.getExecutor().execute(job);
            } <span class="hljs-keyword">else</span> {
                LOGGER.info(
                        <span class="hljs-string">"[{}] [notify-listener] task execute in nacos thread, dataId={}, group={},tenant={}, md5={}, listener={} "</span>,
                        envName, dataId, group, tenant, md5, listener);
                job.run();
            }
        } <span class="hljs-keyword">catch</span> (Throwable t) {
            LOGGER.error(<span class="hljs-string">"[{}] [notify-listener-error] dataId={}, group={},tenant={}, md5={}, listener={} throwable={}"</span>,
                    envName, dataId, group, tenant, md5, listener, t.getCause());
        }
    }

}
</code></pre>
<p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæºç è™½ç„¶å¾ˆå¤šï¼Œä½†æ˜¯å¹¶ä¸å¤æ‚ï¼Œä¸»è¦å…³æ³¨ä¸¤é¡¹å†…å®¹ï¼š</p>
<ol>
<li>é’ˆå¯¹å‘ç”Ÿå˜æ›´çš„é…ç½®ä¼šåˆ›å»º <code>NotifyTask</code> ä»»åŠ¡ï¼Œç”¨äºç›‘å¬å™¨æ–¹æ³• <code>receiveConfigInfo</code> å‘ŠçŸ¥å˜æ›´åçš„é…ç½®ä¿¡æ¯ï¼Œä¸ºäº†æ–¹ä¾¿å¤§å®¶ç†è§£ï¼Œä»¥å¦‚ä¸‹ç›‘å¬å™¨ä¸ºä¾‹ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-meta">@Test</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException, NacosException {
    <span class="hljs-comment">// åˆ›å»º NacosConfigService å®¢æˆ·ç«¯</span>
    <span class="hljs-type">Properties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
    properties.put(PropertyKeyConst.SERVER_ADDR, <span class="hljs-string">"127.0.0.1:8850"</span>);
    properties.put(PropertyKeyConst.CONFIG_LONG_POLL_TIMEOUT, <span class="hljs-string">"20000"</span>);
    properties.put(PropertyKeyConst.CONFIG_RETRY_TIME, <span class="hljs-string">"3000"</span>);
    properties.put(PropertyKeyConst.MAX_RETRY, <span class="hljs-string">"5"</span>);
    <span class="hljs-type">ConfigService</span> <span class="hljs-variable">configService</span> <span class="hljs-operator">=</span> NacosFactory.createConfigService(properties);

    <span class="hljs-comment">// æ·»åŠ ç›‘å¬å™¨</span>
    configService.addListener(<span class="hljs-string">"default_value"</span>, <span class="hljs-string">"DEFAULT_GROUP"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Listener</span>() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> Executor <span class="hljs-title function_">getExecutor</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-comment">// ç›‘å¬å™¨çš„å›è°ƒæ–¹æ³•</span>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">receiveConfigInfo</span><span class="hljs-params">(String configInfo)</span> {
            System.out.println(configInfo);
        }
    });
}
</code></pre>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·å¯ä»¥è‡ªè¡Œåˆ›å»ºå„ä¸ªä¸åŒçš„é…ç½®çš„ç›‘å¬å™¨ï¼Œå½“é…ç½®å‘ç”Ÿå˜æ›´æ—¶ï¼Œä¾¿èƒ½ä» <code>receiveConfigInfo</code> æ–¹æ³•ä¸­è·å–åˆ°å˜æ›´åçš„é…ç½®</p>
<ol start="2">
<li>åœ¨ <code>NotifyTask</code> ä¸­åˆ›å»ºäº† <code>LongNotifyHandler</code> ä»»åŠ¡ï¼Œè¿™ä¸ªä»»åŠ¡ä¼šè¢«å»¶æœŸ 60s æ‰§è¡Œï¼ŒåŒæ—¶ <code>NotifyTask</code> ä»»åŠ¡çš„ <code>finally</code> ä»£ç å—ä¸­æœ‰ <code>LongNotifyHandler</code> ä»»åŠ¡çš„å–æ¶ˆé€»è¾‘ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š<code>NotifyTask</code> ä»»åŠ¡åªè¦æ‰§è¡Œçš„è¶³å¤Ÿå¿«ï¼ˆ60sä»¥å†…ï¼‰ï¼Œè¿™ä¸ªä»»åŠ¡å°†ä¼šè¢«å–æ¶ˆï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹ <code>LongNotifyHandler</code> ä»»åŠ¡çš„é€»è¾‘ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheData</span> {
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">LongNotifyHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">blockTrace</span> <span class="hljs-operator">=</span> getTrace(thread.getStackTrace(), <span class="hljs-number">5</span>);
            LOGGER.warn(<span class="hljs-string">"[{}] [notify-block-monitor] dataId={}, group={},tenant={}, md5={}, "</span>
                            + <span class="hljs-string">"receiveConfigInfo execute over {} millsï¼Œthread trace block : {}"</span>, envName, dataId, group, tenant,
                    md5, timeoutMills, blockTrace);
            NotifyCenter.publishEvent(
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChangeNotifyBlockEvent</span>(<span class="hljs-built_in">this</span>.listenerClass, dataId, group, tenant, <span class="hljs-built_in">this</span>.startTime,
                            System.currentTimeMillis(), blockTrace));
        }
    }
}
</code></pre>
<p>å‘ç°å®ƒä¼šæ‰“å°ä¸€è¡Œå‘Šè­¦æ—¥å¿—ï¼Œæç¤ºæŸä¸ªé…ç½®çš„ç›‘å¬å™¨é€šçŸ¥è¢«é˜»å¡äº†ï¼Œå¹¶ä¸”ä¼šè§¦å‘ä¸€ä¸ª <code>ChangeNotifyBlockEvent</code> äº‹ä»¶ï¼ˆä½†æ˜¯è¿™ä¸ªäº‹ä»¶è¿˜æ²¡æœ‰ç‰¹å®šçš„æ¶ˆè´¹è€…ï¼‰ï¼Œåœ¨æ—¥å¸¸å¼€å‘ä¸­å¯ä»¥å‚è€ƒè¿™ç§å‘Šè­¦æœºåˆ¶çš„å†™æ³•ã€‚</p>
<hr/>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†å›åˆ° <code>ClientWorker#executeConfigListen</code> çš„é€»è¾‘ä¸­ï¼Œæ‰§è¡Œå®Œ <code>CacheData#checkListenerMd5</code> æ–¹æ³•åä¼šæ£€æŸ¥æ˜¯å¦ä½¿ç”¨æœ¬åœ°æ•…éšœè½¬ç§»é…ç½®æ–‡ä»¶ï¼Œå¦‚æœä½¿ç”¨çš„è¯å°±ä¸å†å¤„ç†åç»­é€»è¾‘ï¼Œå¦åˆ™ä¼šå°† CacheData æ ¹æ®æ˜¯å¦å¤±æ•ˆçš„çŠ¶æ€è¿›è¡Œåˆ†ç»„ï¼Œå¹¶å¯¹ä»ç„¶æœ‰æ•ˆçš„é…ç½®è¿›è¡Œå¤„ç†ï¼Œæ‰§è¡Œ <code>ConfigRpcTransportClient#checkListenCache</code> æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigRpcTransportClient</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ConfigTransportClient</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkListenCache</span><span class="hljs-params">(Map&lt;String, List&lt;CacheData&gt;&gt; listenCachesMap)</span> <span class="hljs-keyword">throws</span> NacosException {
        <span class="hljs-comment">// ä½¿ç”¨åŸå­å¸ƒå°”å€¼è®°å½•æ˜¯å¦æœ‰é…ç½®å‘ç”Ÿå˜æ›´ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicBoolean</span> <span class="hljs-variable">hasChangedKeys</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicBoolean</span>(<span class="hljs-literal">false</span>);

        <span class="hljs-comment">// å¦‚æœæ²¡æœ‰éœ€è¦ç›‘å¬çš„ç¼“å­˜ï¼Œç›´æ¥è¿”å›false</span>
        <span class="hljs-keyword">if</span> (!listenCachesMap.isEmpty()) {
            List&lt;Future&gt; listenFutures = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
            <span class="hljs-keyword">for</span> (Map.Entry&lt;String, List&lt;CacheData&gt;&gt; entry : listenCachesMap.entrySet()) {
                <span class="hljs-type">String</span> <span class="hljs-variable">taskId</span> <span class="hljs-operator">=</span> entry.getKey();
                <span class="hljs-comment">// ä¸ºæ¯ä¸ª taskId åˆ›å»ºä¸€ä¸ª RpcClient å®¢æˆ·ç«¯</span>
                <span class="hljs-type">RpcClient</span> <span class="hljs-variable">rpcClient</span> <span class="hljs-operator">=</span> ensureRpcClient(taskId);
                <span class="hljs-comment">// æ¯ä¸ª taskId ä¸“é—¨åˆ†é…ä¸€ä¸ªçº¿ç¨‹æ•°ä¸º 1 çš„çº¿ç¨‹æ± </span>
                <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executorService</span> <span class="hljs-operator">=</span> ensureSyncExecutor(taskId);
                <span class="hljs-type">Future</span> <span class="hljs-variable">future</span> <span class="hljs-operator">=</span> executorService.submit(() -&gt; {
                    List&lt;CacheData&gt; listenCaches = entry.getValue();
                    <span class="hljs-comment">// é‡ç½®é€šçŸ¥å˜æ›´æ ‡è¯†</span>
                    <span class="hljs-keyword">for</span> (CacheData cacheData : listenCaches) {
                        cacheData.getReceiveNotifyChanged().set(<span class="hljs-literal">false</span>);
                    }
                    <span class="hljs-comment">// å°†å¤šä¸ªé…ç½®çš„ç›‘å¬è¯·æ±‚åˆå¹¶ä¸ºä¸€ä¸ªæ‰¹é‡è¯·æ±‚ï¼Œæé«˜ç½‘ç»œæ•ˆç‡</span>
                    <span class="hljs-type">ConfigBatchListenRequest</span> <span class="hljs-variable">configChangeListenRequest</span> <span class="hljs-operator">=</span> buildConfigRequest(listenCaches);
                    configChangeListenRequest.setListen(<span class="hljs-literal">true</span>);
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-comment">// å‘ Nacos æœåŠ¡ç«¯å‘é€æ‰¹é‡ç›‘å¬è¯·æ±‚ï¼Œæ£€æŸ¥é…ç½®æ˜¯å¦æœ‰å˜æ›´</span>
                        <span class="hljs-type">ConfigChangeBatchListenResponse</span> <span class="hljs-variable">listenResponse</span> <span class="hljs-operator">=</span> (ConfigChangeBatchListenResponse) requestProxy(
                                rpcClient, configChangeListenRequest);
                        <span class="hljs-keyword">if</span> (listenResponse != <span class="hljs-literal">null</span> &amp;&amp; listenResponse.isSuccess()) {
                            Set&lt;String&gt; changeKeys = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();

                            List&lt;ConfigChangeBatchListenResponse.ConfigContext&gt; changedConfigs = listenResponse.getChangedConfigs();
                            <span class="hljs-comment">// è·å–æœåŠ¡ç«¯è¿”å›çš„å˜æ›´é…ç½®åˆ—è¡¨ï¼Œå¹¶é€šçŸ¥ç›‘å¬è€…</span>
                            <span class="hljs-keyword">if</span> (!CollectionUtils.isEmpty(changedConfigs)) {
                                hasChangedKeys.set(<span class="hljs-literal">true</span>);
                                <span class="hljs-keyword">for</span> (ConfigChangeBatchListenResponse.ConfigContext changeConfig : changedConfigs) {
                                    <span class="hljs-comment">// æ„å»ºé…ç½®çš„å”¯ä¸€æ ‡è¯†keyï¼šdataId+group+tenant</span>
                                    <span class="hljs-type">String</span> <span class="hljs-variable">changeKey</span> <span class="hljs-operator">=</span> GroupKey.getKeyTenant(changeConfig.getDataId(),
                                            changeConfig.getGroup(), changeConfig.getTenant());
                                    changeKeys.add(changeKey);
                                    <span class="hljs-comment">// æ£€æŸ¥é…ç½®æ˜¯å¦å¤„äºåˆå§‹åŒ–çŠ¶æ€ï¼Œåˆå§‹åŒ–çŠ¶æ€çš„é…ç½®ä¸éœ€è¦é€šçŸ¥ç›‘å¬å™¨ï¼Œé¿å…é‡å¤é€šçŸ¥</span>
                                    <span class="hljs-type">boolean</span> <span class="hljs-variable">isInitializing</span> <span class="hljs-operator">=</span> cacheMap.get().get(changeKey).isInitializing();
                                    <span class="hljs-comment">// åˆ·æ–°é…ç½®å†…å®¹å¹¶æ£€æŸ¥MD5ï¼Œè§¦å‘ç›‘å¬å™¨å›è°ƒ</span>
                                    refreshContentAndCheck(rpcClient, changeKey, !isInitializing);
                                }

                            }

                            <span class="hljs-comment">// ReceiveNotifyChanged å·²ç»åœ¨æ–¹æ³•å¼€å§‹æ—¶è¢«é‡ç½®ä¸º falseï¼Œè¿™æ®µé€»è¾‘è§£å†³çš„æ˜¯è¢«é‡ç½®ä¸º false ä¹‹åï¼Œ</span>
                            <span class="hljs-comment">// å¦‚æœè¿™æœŸé—´ä»æœ‰é…ç½®å˜æ›´åŒæ­¥åˆ° Nacos Client æ—¶èƒ½ä¸€å¹¶å¤„ç†</span>
                            <span class="hljs-keyword">for</span> (CacheData cacheData : listenCaches) {
                                <span class="hljs-keyword">if</span> (cacheData.getReceiveNotifyChanged().get()) {
                                    <span class="hljs-type">String</span> <span class="hljs-variable">changeKey</span> <span class="hljs-operator">=</span> GroupKey.getKeyTenant(cacheData.dataId, cacheData.group,
                                            cacheData.getTenant());
                                    <span class="hljs-keyword">if</span> (!changeKeys.contains(changeKey)) {
                                        <span class="hljs-type">boolean</span> <span class="hljs-variable">isInitializing</span> <span class="hljs-operator">=</span> cacheMap.get().get(changeKey).isInitializing();
                                        refreshContentAndCheck(rpcClient, changeKey, !isInitializing);
                                    }
                                }
                            }

                            <span class="hljs-comment">// è‹¥ä»æœåŠ¡ç«¯æœªè·å–åˆ°å˜æ›´çš„é…ç½®ï¼Œæ ‡è®°ä¸ºä¸æœåŠ¡ç«¯ä¸€è‡´</span>
                            <span class="hljs-keyword">for</span> (CacheData cacheData : listenCaches) {
                                cacheData.setInitializing(<span class="hljs-literal">false</span>);
                                <span class="hljs-type">String</span> <span class="hljs-variable">groupKey</span> <span class="hljs-operator">=</span> GroupKey.getKeyTenant(cacheData.dataId, cacheData.group,
                                        cacheData.getTenant());
                                <span class="hljs-keyword">if</span> (!changeKeys.contains(groupKey)) {
                                    <span class="hljs-keyword">synchronized</span> (cacheData) {
                                        <span class="hljs-keyword">if</span> (!cacheData.getReceiveNotifyChanged().get()) {
                                            cacheData.setConsistentWithServer(<span class="hljs-literal">true</span>);
                                        }
                                    }
                                }
                            }

                        }
                    } <span class="hljs-keyword">catch</span> (Throwable e) {
                        <span class="hljs-comment">// å‘ç”Ÿå¼‚å¸¸çš„è¯è¿›è¡Œé‡è¯•</span>
                        LOGGER.error(<span class="hljs-string">"Execute listen config change error "</span>, e);
                        <span class="hljs-keyword">try</span> {
                            Thread.sleep(<span class="hljs-number">50L</span>);
                        } <span class="hljs-keyword">catch</span> (InterruptedException interruptedException) {
                            <span class="hljs-comment">//ignore</span>
                        }
                        <span class="hljs-comment">// é‡æ–°è§¦å‘ç›‘å¬æ£€æŸ¥</span>
                        notifyListenConfig();
                    }
                });
                <span class="hljs-comment">// å°†å¼‚æ­¥ä»»åŠ¡æ·»åŠ åˆ°Futureåˆ—è¡¨ä¸­</span>
                listenFutures.add(future);
            }
            <span class="hljs-comment">// é˜»å¡ç­‰å¾…ä»»åŠ¡å®Œæˆ</span>
            <span class="hljs-keyword">for</span> (Future future : listenFutures) {
                <span class="hljs-keyword">try</span> {
                    future.get();
                } <span class="hljs-keyword">catch</span> (Throwable throwable) {
                    LOGGER.error(<span class="hljs-string">"Async listen config change error "</span>, throwable);
                }
            }

        }
        <span class="hljs-keyword">return</span> hasChangedKeys.get();
    }
}
</code></pre>
<p>è¿™æ˜¯ä¸€ä¸ªåŒæ­¥è°ƒç”¨çš„æ–¹æ³•ï¼Œè™½ç„¶æ¯”è¾ƒé•¿ä½†æ˜¯é€»è¾‘ä¸Šå¹¶ä¸éš¾ï¼Œé¦–å…ˆå®ƒä¼šå°†é…ç½®æŒ‰ç…§â€œä»»åŠ¡â€çš„ç»´åº¦åˆ†ç»„ã€åˆå¹¶ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å¯¹ Nacos Server æœåŠ¡ç«¯çš„è¯·æ±‚æ•°é‡ï¼Œåˆå¹¶å®Œæˆåï¼Œæ¯ä¸ªä»»åŠ¡éƒ½åˆ†é…ä¸€ä¸ªçº¿ç¨‹æ± å»å¤„ç†ï¼Œå¤„ç†æ—¶ä¼šå…ˆæŸ¥è¯¢æœåŠ¡ç«¯æœ‰å“ªäº›é…ç½®å‘ç”Ÿäº†å˜æ›´ï¼Œè·å–åˆ°å˜æ›´çš„é…ç½®åå†é€ä¸€å¤„ç†ï¼Œè°ƒç”¨ <code>ConfigRpcTransportClient#refreshContentAndCheck</code> æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigRpcTransportClient</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ConfigTransportClient</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">refreshContentAndCheck</span><span class="hljs-params">(RpcClient rpcClient, String groupKey, <span class="hljs-type">boolean</span> notify)</span> {
        <span class="hljs-keyword">if</span> (cacheMap.get() != <span class="hljs-literal">null</span> &amp;&amp; cacheMap.get().containsKey(groupKey)) {
            <span class="hljs-type">CacheData</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> cacheMap.get().get(groupKey);
            refreshContentAndCheck(rpcClient, cache, notify);
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">refreshContentAndCheck</span><span class="hljs-params">(RpcClient rpcClient, CacheData cacheData, <span class="hljs-type">boolean</span> notify)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// å‘æœåŠ¡ç«¯æŸ¥è¯¢æœ€æ–°çš„é…ç½®å†…å®¹ï¼Œå¹¶å†™å…¥ CacheData ä¸­ï¼Œå¹¶ä¸”è®°å½•åœ¨äº†æœ¬åœ°æ–‡ä»¶ä¸­</span>
            <span class="hljs-type">ConfigResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.queryConfigInner(rpcClient, cacheData.dataId, cacheData.group,
                    cacheData.tenant, requestTimeout, notify);
            cacheData.setEncryptedDataKey(response.getEncryptedDataKey());
            cacheData.setContent(response.getContent());
            <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != response.getConfigType()) {
                cacheData.setType(response.getConfigType());
            }
            <span class="hljs-keyword">if</span> (notify) {
                LOGGER.info(<span class="hljs-string">"[{}] [data-received] dataId={}, group={}, tenant={}, md5={}, type={}"</span>, agent.getName(),
                        cacheData.dataId, cacheData.group, cacheData.tenant, cacheData.getMd5(),
                        response.getConfigType());
            }
            <span class="hljs-comment">// æ£€æŸ¥é…ç½® MD5 å˜åŒ–å¹¶è§¦å‘ç›‘å¬å™¨å›è°ƒé€šçŸ¥åº”ç”¨ç¨‹åº</span>
            cacheData.checkListenerMd5();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            LOGGER.error(<span class="hljs-string">"refresh content and check md5 fail ,dataId={},group={},tenant={} "</span>, cacheData.dataId,
                    cacheData.group, cacheData.tenant, e);
        }
    }
}
</code></pre>
<p>åœ¨å…¶ä¸­çš„ <code>ConfigRpcTransportClient#refreshContentAndCheck</code> æ–¹æ³•ä¸­ä¼š<strong>å‘ Nacos æœåŠ¡ç«¯æŸ¥è¯¢é…ç½®ä¿¡æ¯ï¼Œå†å®Œæˆæœ¬åœ°é…ç½®çš„å†™å…¥</strong>ï¼Œéšåæ‰§è¡Œ <code>CacheData#checkListenerMd5</code> æ–¹æ³•å®Œæˆç›‘å¬å™¨çš„é€šçŸ¥å›è°ƒã€‚åœ¨è¿™é‡Œæˆ‘æœ‰ä¸€ä¸ªç–‘é—®ï¼šä¸ºä»€ä¹ˆä¸åœ¨æ‰¹é‡æŸ¥è¯¢å“ªäº›é…ç½®å‘ç”Ÿå˜æ›´æ—¶ä¸€å¹¶å°†é…ç½®çš„å†…å®¹è¿”å›å‘¢ï¼Ÿè¿™æ ·çš„ç½‘ç»œå¼€é”€æ˜¯ä¸æ˜¯ä¼šæ›´å°ä¸€äº›ï¼Ÿ</p>
<blockquote>
<p>åæ¥æˆ‘æƒ³äº†æƒ³ï¼Œç†è®ºä¸Šå¯è¡Œï¼Œä¸è¿‡å› ä¸ºæ¯æ¬¡è¯·æ±‚éƒ½æ˜¯è¯·æ±‚åˆ° Nacos Server çš„å†…å­˜ï¼Œæ‰€ä»¥å¤šæ¬¡è¯·æ±‚ä¹Ÿä¸ä¼šç»™ Nacos Server é€ æˆå¤ªå¤§çš„å‹åŠ›ï¼Œç½‘ç»œå¼€é”€ä¹Ÿä¸å¤§</p>
</blockquote>
<p><code>ConfigRpcTransportClient#checkListenCache</code> æ–¹æ³•å¦‚æœåœ¨æ‰§è¡Œä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆä¼šåœ¨ <code>catch</code> ä»£ç å—ä¸­æ‰§è¡Œ <code>ConfigRpcTransportClient#notifyListenConfig</code> æ–¹æ³•ç«‹å³å‘èµ·é…ç½®ä¸»åŠ¨æ‹‰å–çš„æ“ä½œï¼Œ<strong>é¿å…é…ç½®å†…å®¹æ›´æ–°ä¸åŠæ—¶</strong>ã€‚å†å›åˆ° <code>ClientWorker#executeConfigListen</code> çš„é€»è¾‘ä¸­ï¼Œå¦‚æœ <code>ConfigRpcTransportClient#checkListenCache</code> æ–¹æ³•è¿”å› true è¡¨ç¤ºæœ‰é…ç½®å‘ç”Ÿå˜æ›´ï¼ŒåŒæ ·åœ°ä¹Ÿä¼šæ‰§è¡Œä¸€æ¬¡ <code>ConfigRpcTransportClient#notifyListenConfig</code> æ–¹æ³•ï¼Œè¿™ä¹ˆåšçš„åŸå› å¯èƒ½æ˜¯å½“æœ‰é…ç½®å‘ç”Ÿå˜æ›´æ—¶ï¼Œç”¨æˆ·å¯èƒ½åœ¨è¿™æœŸé—´é™†ç»­ä¿®æ”¹äº†å¤šä¸ªé…ç½®ï¼Œå†æ¬¡è§¦å‘é…ç½®æ‹‰å–æ“ä½œå‡å°‘é…ç½®åŒæ­¥çš„å»¶æ—¶ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»å¯¹ Nacos Client å¤„ç† Nacos Server æ¨é€é…ç½®å˜æ›´çš„å¤„ç†å’Œä¸»åŠ¨åŒæ­¥é…ç½®å˜æ›´çš„é€»è¾‘æ¯”è¾ƒäº†è§£äº†ï¼Œç°åœ¨æˆ‘ä»¬è¿˜è¦æ³¨æ„ä¸‹ Nacos Client åœ¨åŒæ­¥é…ç½®è¿‡ç¨‹ä¸­ä¸ Nacos Server çš„ä¸¤æ¬¡äº¤äº’ï¼š<strong>æ‰¹é‡æŸ¥è¯¢é…ç½®ä¿¡æ¯æ˜¯å¦å‘ç”Ÿå˜æ›´</strong> å’Œ <strong>æŸ¥è¯¢å•ä¸ªé…ç½®çš„å†…å®¹</strong>ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹æ‰¹é‡æŸ¥è¯¢é…ç½®ä¿¡æ¯æ—¶ï¼ŒæœåŠ¡ç«¯çš„å¤„ç†é€»è¾‘ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigChangeBatchListenRequestHandler</span>
        <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RequestHandler</span>&lt;ConfigBatchListenRequest, ConfigChangeBatchListenResponse&gt; {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ConfigChangeListenContext configChangeListenContext;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@NamespaceValidation</span>
    <span class="hljs-meta">@TpsControl(pointName = "ConfigListen")</span>
    <span class="hljs-meta">@Secured(action = ActionTypes.READ, signType = SignType.CONFIG)</span>
    <span class="hljs-meta">@ExtractorManager</span>.Extractor(rpcExtractor = ConfigBatchListenRequestParamExtractor.class)
    <span class="hljs-keyword">public</span> ConfigChangeBatchListenResponse <span class="hljs-title function_">handle</span><span class="hljs-params">(ConfigBatchListenRequest configChangeListenRequest, RequestMeta meta)</span>
            <span class="hljs-keyword">throws</span> NacosException {
        <span class="hljs-comment">// è·å–è¿æ¥IDï¼Œç”¨äºæ ‡è¯†å®¢æˆ·ç«¯è¿æ¥</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">connectionId</span> <span class="hljs-operator">=</span> StringPool.get(meta.getConnectionId());
        <span class="hljs-type">String</span> <span class="hljs-variable">tag</span> <span class="hljs-operator">=</span> configChangeListenRequest.getHeader(Constants.VIPSERVER_TAG);
        ParamUtils.checkParam(tag);
        <span class="hljs-type">ConfigChangeBatchListenResponse</span> <span class="hljs-variable">configChangeBatchListenResponse</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigChangeBatchListenResponse</span>();
        <span class="hljs-comment">// å¤„ç†æ‰¹é‡ç›‘å¬è¯·æ±‚ä¸­çš„æ¯ä¸ªé…ç½®é¡¹</span>
        <span class="hljs-keyword">for</span> (ConfigBatchListenRequest.ConfigListenContext listenContext : configChangeListenRequest.getConfigListenContexts()) {
            <span class="hljs-type">boolean</span> <span class="hljs-variable">isNeedTransferNamespace</span> <span class="hljs-operator">=</span> NamespaceUtil.isNeedTransferNamespace(listenContext.getTenant());
            <span class="hljs-type">String</span> <span class="hljs-variable">namespaceId</span> <span class="hljs-operator">=</span> NamespaceUtil.processNamespaceParameter(listenContext.getTenant());
            <span class="hljs-type">String</span> <span class="hljs-variable">groupKey</span> <span class="hljs-operator">=</span> GroupKey2.getKey(listenContext.getDataId(), listenContext.getGroup(), namespaceId);
            groupKey = StringPool.get(groupKey);
            
            <span class="hljs-type">String</span> <span class="hljs-variable">md5</span> <span class="hljs-operator">=</span> StringPool.get(listenContext.getMd5());
            
            <span class="hljs-keyword">if</span> (configChangeListenRequest.isListen()) {
                <span class="hljs-comment">// æ·»åŠ ç›‘å¬ï¼šå°†å®¢æˆ·ç«¯è¿æ¥ä¸é…ç½®é¡¹å…³è”</span>
                configChangeListenContext.addListen(groupKey, md5, connectionId, isNeedTransferNamespace);
                <span class="hljs-comment">// æ£€æŸ¥é…ç½®æ˜¯å¦å·²ç»å‘ç”Ÿå˜æ›´</span>
                <span class="hljs-type">boolean</span> <span class="hljs-variable">isUptoDate</span> <span class="hljs-operator">=</span> ConfigCacheService.isUptodate(groupKey, md5, meta.getClientIp(), tag,
                        meta.getAppLabels());
                <span class="hljs-comment">// å¦‚æœé…ç½®å·²å˜æ›´ï¼Œæ·»åŠ å˜æ›´çš„é…ç½®ä¿¡æ¯</span>
                <span class="hljs-keyword">if</span> (!isUptoDate) {
                    configChangeBatchListenResponse.addChangeConfig(listenContext.getDataId(), listenContext.getGroup(),
                            listenContext.getTenant());
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// ç§»é™¤ç›‘å¬ï¼šå–æ¶ˆå®¢æˆ·ç«¯è¿æ¥ä¸é…ç½®é¡¹çš„å…³è”</span>
                configChangeListenContext.removeListen(groupKey, connectionId);
            }
        }
        
        <span class="hljs-keyword">return</span> configChangeBatchListenResponse;
        
    }
    
}
</code></pre>
<p>å…¶ä¸­è¾ƒä¸ºå…³é”®çš„é€»è¾‘æ˜¯æ£€æŸ¥é…ç½®æ˜¯å¦å‘ç”Ÿå˜æ›´çš„ <code>ConfigCacheService#isUptodate</code> æ–¹æ³•ï¼Œå¯è§æ¯”è¾ƒé…ç½®æ˜¯å¦å‘ç”Ÿå˜æ›´çš„ MD5 å€¼æ˜¯ä»æœ¬åœ°ç¼“å­˜å¯¹è±¡ <code>CacheItem</code> ä¸­è·å–çš„ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigCacheService</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isUptodate</span><span class="hljs-params">(String groupKey, String md5, String ip, String tag,
                                     Map&lt;String, String&gt; appLabels)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">serverMd5</span> <span class="hljs-operator">=</span> ConfigCacheService.getContentMd5(groupKey, ip, tag, appLabels);
        <span class="hljs-keyword">return</span> StringUtils.equals(md5, serverMd5);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getContentMd5</span><span class="hljs-params">(String groupKey, String ip, String tag, Map&lt;String, String&gt; connLabels)</span> {
        <span class="hljs-comment">// JVM æœ¬åœ°å†…å­˜å¯¹è±¡</span>
        <span class="hljs-type">CacheItem</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> CACHE.get(groupKey);
        <span class="hljs-keyword">if</span> (item == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> NULL;
        }
        <span class="hljs-keyword">if</span> (connLabels == <span class="hljs-literal">null</span> &amp;&amp; StringUtils.isNotBlank(ip)) {
            connLabels = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(<span class="hljs-number">4</span>);
        }
        <span class="hljs-keyword">if</span> (connLabels == <span class="hljs-literal">null</span> &amp;&amp; StringUtils.isNotBlank(tag)) {
            connLabels = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(<span class="hljs-number">4</span>);
        }

        <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(ip)) {
            connLabels.put(CLIENT_IP, ip);
        }
        <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(tag)) {
            connLabels.put(VIPSERVER_TAG, tag);
        }
        <span class="hljs-keyword">if</span> (item.getSortConfigGrays() != <span class="hljs-literal">null</span> &amp;&amp; connLabels != <span class="hljs-literal">null</span> &amp;&amp; !connLabels.isEmpty()) {
            <span class="hljs-keyword">for</span> (ConfigCacheGray entry : item.getSortConfigGrays()) {
                <span class="hljs-keyword">if</span> (entry.match(connLabels)) {
                    <span class="hljs-keyword">return</span> entry.getMd5();
                }
            }
        }
        <span class="hljs-type">String</span> <span class="hljs-variable">md5</span> <span class="hljs-operator">=</span> item.getConfigCache().getMd5();
        <span class="hljs-keyword">return</span> md5 == <span class="hljs-literal">null</span> ? NULL : md5;
    }
}
</code></pre>
<p>è¿™æ ·åšä¼šæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿåœ¨ä¸Šæ–‡è®²è§£ Nacos Server å˜æ›´é…ç½®çš„é€»è¾‘ä¸­ï¼Œæˆ‘ä»¬äº†è§£åˆ°æ•°æ®åº“å˜æ›´æ˜¯åŒæ­¥çš„ï¼Œä½†æ˜¯å†…å­˜å’ŒæœåŠ¡ç«¯æœ¬åœ° Dump æ–‡ä»¶å˜æ›´æ˜¯å¼‚æ­¥çš„ï¼Œè¿™æ ·å°±å¯èƒ½å­˜åœ¨èŠ‚ç‚¹æœªå®Œæˆç¼“å­˜æ›´æ–°çš„åœºæ™¯ï¼Œå¯èƒ½é€ æˆæŸ¥è¯¢æ—¶å®é™…é…ç½®å˜äº†ï¼ˆæ•°æ®åº“å˜æ›´ï¼‰ä½†é€šè¿‡æ¥å£æŸ¥è¯¢ç»“æœæ˜¾ç¤ºé…ç½®æ²¡å˜çš„æƒ…å†µï¼Œæ‰€ä»¥åœ¨ Nacos Client è¶…æ—¶è‡ªåŠ¨é…ç½®åŒæ­¥çš„é€»è¾‘ä¹Ÿæ˜¯èƒ½ç†è§£çš„äº†ï¼Œè¿™ä¹Ÿåæ˜ äº† Nacos Client åŒæ­¥é…ç½®éµå¾ªçš„æ˜¯æ•°æ®çš„ <strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ã€‚</p>
<p>å…¶æ¬¡ï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹ Nacos Client å‘ Nacos Server æŸ¥è¯¢å•ä¸ªé…ç½®çš„åœºæ™¯ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigQueryRequestHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RequestHandler</span>&lt;ConfigQueryRequest, ConfigQueryResponse&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">LOGGER</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ConfigQueryRequestHandler.class);

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConfigQueryChainService configQueryChainService;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ConfigQueryRequestHandler</span><span class="hljs-params">(ConfigQueryChainService configQueryChainService)</span> {
        <span class="hljs-built_in">this</span>.configQueryChainService = configQueryChainService;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@NamespaceValidation</span>
    <span class="hljs-meta">@TpsControl(pointName = "ConfigQuery")</span>
    <span class="hljs-meta">@Secured(action = ActionTypes.READ, signType = SignType.CONFIG)</span>
    <span class="hljs-meta">@ExtractorManager</span>.Extractor(rpcExtractor = ConfigRequestParamExtractor.class)
    <span class="hljs-keyword">public</span> ConfigQueryResponse <span class="hljs-title function_">handle</span><span class="hljs-params">(ConfigQueryRequest request, RequestMeta meta)</span> <span class="hljs-keyword">throws</span> NacosException {
        <span class="hljs-keyword">try</span> {
            request.setTenant(NamespaceUtil.processNamespaceParameter(request.getTenant()));
            <span class="hljs-type">String</span> <span class="hljs-variable">dataId</span> <span class="hljs-operator">=</span> request.getDataId();
            <span class="hljs-type">String</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> request.getGroup();
            <span class="hljs-type">String</span> <span class="hljs-variable">tenant</span> <span class="hljs-operator">=</span> request.getTenant();
            <span class="hljs-type">String</span> <span class="hljs-variable">groupKey</span> <span class="hljs-operator">=</span> GroupKey2.getKey(dataId, group, tenant);
            <span class="hljs-type">boolean</span> <span class="hljs-variable">notify</span> <span class="hljs-operator">=</span> request.isNotify();

            <span class="hljs-type">String</span> <span class="hljs-variable">requestIpApp</span> <span class="hljs-operator">=</span> meta.getLabels().get(CLIENT_APPNAME_HEADER);
            <span class="hljs-type">String</span> <span class="hljs-variable">clientIp</span> <span class="hljs-operator">=</span> meta.getClientIp();

            <span class="hljs-type">ConfigQueryChainRequest</span> <span class="hljs-variable">chainRequest</span> <span class="hljs-operator">=</span> ConfigChainRequestExtractorService.getExtractor().extract(request, meta);
            <span class="hljs-comment">// æ‰§è¡ŒæŸ¥è¯¢é€»è¾‘</span>
            <span class="hljs-type">ConfigQueryChainResponse</span> <span class="hljs-variable">chainResponse</span> <span class="hljs-operator">=</span> configQueryChainService.handle(chainRequest);

            <span class="hljs-keyword">if</span> (ResponseCode.FAIL.getCode() == chainResponse.getResultCode()) {
                <span class="hljs-keyword">return</span> ConfigQueryResponse.buildFailResponse(ResponseCode.FAIL.getCode(), chainResponse.getMessage());
            }
            <span class="hljs-keyword">if</span> (chainResponse.getStatus() == ConfigQueryChainResponse.ConfigQueryStatus.CONFIG_NOT_FOUND) {
                <span class="hljs-keyword">return</span> handlerConfigNotFound(request.getDataId(), request.getGroup(), request.getTenant(), requestIpApp,
                        clientIp, notify);
            }
            <span class="hljs-keyword">if</span> (chainResponse.getStatus() == ConfigQueryChainResponse.ConfigQueryStatus.CONFIG_QUERY_CONFLICT) {
                <span class="hljs-keyword">return</span> handlerConfigConflict(clientIp, groupKey);
            }

            <span class="hljs-type">ConfigQueryResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigQueryResponse</span>();
            response.setMd5(chainResponse.getMd5());
            response.setEncryptedDataKey(chainResponse.getEncryptedDataKey());
            response.setContent(chainResponse.getContent());
            response.setContentType(chainResponse.getConfigType());
            response.setLastModified(chainResponse.getLastModified());
            <span class="hljs-comment">// ...</span>

            <span class="hljs-keyword">return</span> response;

        } <span class="hljs-keyword">catch</span> (Exception e) {
            LOGGER.error(<span class="hljs-string">"Failed to handle grpc configuration query"</span>, e);
            <span class="hljs-keyword">return</span> ConfigQueryResponse.buildFailResponse(ResponseCode.FAIL.getCode(), e.getMessage());
        }
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FormalHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractConfigQueryHandler</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FORMAL_HANDLER</span> <span class="hljs-operator">=</span> <span class="hljs-string">"formalHandler"</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> FORMAL_HANDLER;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> ConfigQueryChainResponse <span class="hljs-title function_">handle</span><span class="hljs-params">(ConfigQueryChainRequest request)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">ConfigQueryChainResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigQueryChainResponse</span>();

        <span class="hljs-type">String</span> <span class="hljs-variable">dataId</span> <span class="hljs-operator">=</span> request.getDataId();
        <span class="hljs-type">String</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> request.getGroup();
        <span class="hljs-type">String</span> <span class="hljs-variable">tenant</span> <span class="hljs-operator">=</span> request.getTenant();

        <span class="hljs-comment">// MD5 å€¼æ¥è‡ª JVM ç¼“å­˜å¯¹è±¡</span>
        <span class="hljs-type">CacheItem</span> <span class="hljs-variable">cacheItem</span> <span class="hljs-operator">=</span> ConfigChainEntryHandler.getThreadLocalCacheItem();
        <span class="hljs-type">String</span> <span class="hljs-variable">md5</span> <span class="hljs-operator">=</span> cacheItem.getConfigCache().getMd5();
        <span class="hljs-comment">// é…ç½®çš„å†…å®¹ Content æ¥è‡ªç£ç›˜æ–‡ä»¶</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> ConfigDiskServiceFactory.getInstance().getContent(dataId, group, tenant);
        <span class="hljs-keyword">if</span> (StringUtils.isBlank(content)) {
            response.setStatus(ConfigQueryChainResponse.ConfigQueryStatus.CONFIG_NOT_FOUND);
            <span class="hljs-keyword">return</span> response;
        }
        <span class="hljs-type">long</span> <span class="hljs-variable">lastModified</span> <span class="hljs-operator">=</span> cacheItem.getConfigCache().getLastModifiedTs();
        <span class="hljs-type">String</span> <span class="hljs-variable">encryptedDataKey</span> <span class="hljs-operator">=</span> cacheItem.getConfigCache().getEncryptedDataKey();
        <span class="hljs-type">String</span> <span class="hljs-variable">configType</span> <span class="hljs-operator">=</span> cacheItem.getType();
        response.setContent(content);
        response.setMd5(md5);
        response.setLastModified(lastModified);
        response.setEncryptedDataKey(encryptedDataKey);
        response.setConfigType(configType);
        response.setStatus(ConfigQueryChainResponse.ConfigQueryStatus.CONFIG_FOUND_FORMAL);

        <span class="hljs-keyword">return</span> response;
    }
}
</code></pre>
<p>åœ¨è¿™æ®µé€»è¾‘ä¸­é‡ç‚¹å…³æ³¨é…ç½®ä¿¡æ¯è¯»å–ï¼Œå¯ä»¥å‘ç°é…ç½®çš„å†…å®¹æ¥è‡ªç£ç›˜æ–‡ä»¶ï¼Œé…ç½®çš„ MD5 å€¼æ¥è‡ª JVM çš„å†…å­˜ç¼“å­˜å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ Nacos Client å•æ¬¡æŸ¥è¯¢ Nacos Server æŸä¸ªé…ç½®çš„å†…å®¹åŒæ ·ä¹Ÿæ˜¯ä¸ç»è¿‡æ•°æ®åº“çš„ï¼Œé‚£ä¹ˆè¿™å°± <strong>å¯èƒ½å­˜åœ¨æŸ¥è¯¢ç»“æœä¸æ•°æ®åº“ä¸­å®é™…çš„é…ç½®ä¿¡æ¯å­˜åœ¨å·®å¼‚çš„æƒ…å†µ</strong>ã€‚å¾ˆæ˜¾ç„¶ï¼Œåœ¨ Nacos Server ä¸Šè¿›è¡Œ<strong>é…ç½®çš„å‘å¸ƒéµå¾ª CP å®šç†ä¿è¯çº¿æ€§ä¸€è‡´æ€§</strong>ï¼Œä½†æ˜¯ Nacos Client æ¥è¯»å–çš„æ—¶å€™ä¼šèµ°ç¼“å­˜ï¼Œå› æ­¤ <strong>Nacos Client å’Œ Nacos Server ä¹‹é—´çš„éµå¾ªçš„æ˜¯ AP å®šç†</strong>ï¼Œéµå¾ªæ•°æ®çš„ <strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ï¼Œé€šè¿‡ Nacos Client çš„å®šæœŸé‡è¯•æ¥ä¿è¯é…ç½®æ•°æ®çš„æ›´æ–°ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ <strong>èƒ½å¤Ÿé¿å…æ•°æ®åº“æˆä¸ºæ€§èƒ½ç“¶é¢ˆ</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-1">å·¨äººçš„è‚©è†€</h3>
<ul>
<li><a href="https://juejin.cn/post/7544003305972088878" target="_blank" title="https://juejin.cn/post/7544003305972088878">æ˜é‡‘ - æ·±å…¥ç†è§£åˆ†å¸ƒå¼å…±è¯†ç®—æ³• Raft</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»åŸç†åˆ°å®è·µï¼Œåƒé€ Lit å“åº”å¼ç³»ç»Ÿçš„æ ¸å¿ƒé€»è¾‘]]></title>    <link>https://juejin.cn/post/7572502156486459418</link>    <guid>https://juejin.cn/post/7572502156486459418</guid>    <pubDate>2025-11-15T06:30:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572502156486459418" data-draft-id="7572437226023747594" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»åŸç†åˆ°å®è·µï¼Œåƒé€ Lit å“åº”å¼ç³»ç»Ÿçš„æ ¸å¿ƒé€»è¾‘"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-15T06:30:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç å†œå¼ "/> <meta itemprop="url" content="https://juejin.cn/user/2168666743636654"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»åŸç†åˆ°å®è·µï¼Œåƒé€ Lit å“åº”å¼ç³»ç»Ÿçš„æ ¸å¿ƒé€»è¾‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2168666743636654/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç å†œå¼ 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T06:30:54.000Z" title="Sat Nov 15 2025 06:30:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆ Lit çš„å“åº”å¼ â€œè½»è€Œå¼ºâ€ï¼Ÿ</h2>
<p>åœ¨å‰ç«¯æ¡†æ¶æ—ç«‹çš„å½“ä¸‹ï¼Œå“åº”å¼ç³»ç»Ÿæ—©å·²ä¸æ˜¯æ–°é²œæ¦‚å¿µã€‚Vue çš„<code>reactive</code>ã€React çš„<code>useState</code>ï¼Œéƒ½é€šè¿‡æŠ½è±¡å°è£…è®©å¼€å‘è€…æ‘†è„±äº†æ‰‹åŠ¨æ“ä½œ DOM çš„ç¹çã€‚ä½† Lit çš„å“åº”å¼å´èµ°å‡ºäº†ä¸€æ¡å·®å¼‚åŒ–è·¯çº¿ â€”â€”<strong>åŸºäºåŸç”Ÿ JavaScriptï¼Œæ— é¢å¤–ä¾èµ–ï¼Œå´èƒ½å®ç°é«˜æ•ˆçš„çŠ¶æ€é©±åŠ¨è§†å›¾æ›´æ–°</strong>ã€‚</p>
<p>æˆ‘åœ¨ 4 å¹´å‰ç«¯å¼€å‘ä¸­ï¼Œæ›¾ç”¨ Vueã€React æ­å»ºè¿‡å¤šä¸ªä¸­åå°é¡¹ç›®ï¼Œä¹Ÿè¸©è¿‡ä¸å°‘æ€§èƒ½å‘ï¼šå¤§å‹åˆ—è¡¨æ¸²æŸ“æ—¶çš„å¡é¡¿ã€å¤æ‚çŠ¶æ€ä¾èµ–å¯¼è‡´çš„æ›´æ–°æ··ä¹±ã€æ¡†æ¶æ‰“åŒ…åä½“ç§¯è¿‡å¤§å½±å“é¦–å±åŠ è½½ã€‚ç›´åˆ°æ¥è§¦ Litï¼Œæ‰å‘ç°å®ƒçš„å“åº”å¼è®¾è®¡æ°å¥½è§£å†³äº†è¿™äº›ç—›ç‚¹ã€‚</p>
<p>Lit çš„å“åº”å¼æ ¸å¿ƒä½“ç§¯ä»…å‡  KBï¼Œå´èƒ½å®ç° â€œç²¾å‡†æ›´æ–°â€â€”â€” åªæœ‰çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œä¸”ä»…æ›´æ–°å˜åŒ–çš„ DOM èŠ‚ç‚¹ã€‚è¿™èƒŒåçš„å…³é”®ï¼Œåœ¨äºå®ƒæ²¡æœ‰å¼•å…¥å¤æ‚çš„è™šæ‹Ÿ DOMï¼Œè€Œæ˜¯åŸºäºåŸç”Ÿ<code>Proxy</code>å’Œ â€œå±æ€§è®¿é—®è¿½è¸ªâ€ æœºåˆ¶ï¼Œè®©çŠ¶æ€ä¸è§†å›¾çš„ç»‘å®šæ›´ç›´æ¥ã€æ›´é«˜æ•ˆã€‚</p>
<p>æ›´é‡è¦çš„æ˜¯ï¼ŒLit çš„å“åº”å¼ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ runtimeï¼Œç»„ä»¶ç¼–è¯‘åå¯ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œæ—¢èƒ½ç‹¬ç«‹ä½¿ç”¨ï¼Œä¹Ÿèƒ½åµŒå…¥å…¶ä»–æ¡†æ¶ã€‚è¿™ç§çµæ´»æ€§ï¼Œè®©å®ƒåœ¨è·¨é¡¹ç›®ç»„ä»¶å¤ç”¨ã€è®¾è®¡ç³»ç»Ÿæ­å»ºç­‰åœºæ™¯ä¸­æå…·ä¼˜åŠ¿ã€‚ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œæˆ‘å†³å®šæ·±å…¥æ‹†è§£ Lit å“åº”å¼çš„åº•å±‚é€»è¾‘ï¼Œå¸®å¤§å®¶ä¸ä»… â€œä¼šç”¨â€ï¼Œæ›´èƒ½ â€œåƒé€â€ã€‚</p>
<h2 data-id="heading-1">äºŒã€Lit å“åº”å¼çš„åº•å±‚åŸç†ï¼š3 ä¸ªæ ¸å¿ƒæœºåˆ¶</h2>
<p>è¦æŒæ¡ Lit çš„å“åº”å¼ï¼Œä¸èƒ½åªåœç•™åœ¨ API è°ƒç”¨å±‚é¢ã€‚æˆ‘é€šè¿‡é˜…è¯» Lit æºç ï¼ˆv3.0 ç‰ˆæœ¬ï¼‰ã€è°ƒè¯•ç»„ä»¶æ›´æ–°æµç¨‹ï¼Œæ€»ç»“å‡ºå…¶æ ¸å¿ƒä¾èµ– 3 ä¸ªå…³é”®æœºåˆ¶ï¼š<strong>çŠ¶æ€è¿½è¸ªã€ä¾èµ–æ”¶é›†ã€ç²¾å‡†æ›´æ–°</strong>ã€‚</p>
<h3 data-id="heading-2">1. çŠ¶æ€è¿½è¸ªï¼šåŸºäº Proxy çš„ â€œå±æ€§è®¿é—®ç›‘å¬â€</h3>
<p>Lit çš„å“åº”å¼çŠ¶æ€é€šè¿‡<code>@state()</code>è£…é¥°å™¨æˆ–<code>createSignal</code>å‡½æ•°åˆ›å»ºï¼Œå…¶æœ¬è´¨æ˜¯å¯¹åŸå§‹æ•°æ®çš„ Proxy ä»£ç†ã€‚ä¸ Vue 3 çš„<code>reactive</code>ç±»ä¼¼ï¼Œä½† Lit çš„ Proxy å°è£…æ›´è½»é‡ï¼Œä»…èšç„¦ â€œå±æ€§è®¿é—®â€ å’Œ â€œçŠ¶æ€ä¿®æ”¹â€ ä¸¤ä¸ªæ ¸å¿ƒåœºæ™¯ã€‚</p>
<p>å½“ä½ åœ¨ç»„ä»¶ä¸­å®šä¹‰å¦‚ä¸‹çŠ¶æ€æ—¶ï¼š</p>
<p>javascript</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">LitElement</span>, html, state } <span class="hljs-keyword">from</span> <span class="hljs-string">'lit'</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">LitElement</span> {
  <span class="hljs-meta">@state</span>() user = { <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">28</span> };
  <span class="hljs-meta">@state</span>() count = <span class="hljs-number">0</span>;

  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> html`<span class="xml">
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>å§“åï¼š</span><span class="hljs-subst">${<span class="hljs-variable language_">this</span>.user.name}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>å¹´é¾„ï¼š</span><span class="hljs-subst">${<span class="hljs-variable language_">this</span>.user.age}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>è®¡æ•°ï¼š</span><span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=</span></span><span class="hljs-subst">${() =&gt; <span class="hljs-variable language_">this</span>.count++}</span><span class="xml"><span class="hljs-tag">&gt;</span>ç‚¹å‡»+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    `</span>;
  }
}
</code></pre>
<p><code>@state()</code>ä¼šå°†<code>user</code>å’Œ<code>count</code>è½¬åŒ–ä¸º Proxy å¯¹è±¡ã€‚å½“ç»„ä»¶é¦–æ¬¡æ‰§è¡Œ<code>render</code>å‡½æ•°æ—¶ï¼Œè®¿é—®<code>this.user.name</code>ã€<code>this.count</code>ç­‰å±æ€§çš„è¿‡ç¨‹ï¼Œä¼šè¢« Proxy æ‹¦æˆªå¹¶è®°å½• â€”â€” è¿™ä¸€æ­¥å°±æ˜¯ â€œå±æ€§è®¿é—®è¿½è¸ªâ€ã€‚</p>
<p>Lit å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª â€œå½“å‰æœ‰æ•ˆæ›´æ–°ä¸Šä¸‹æ–‡â€ï¼ˆcurrentUpdateContextï¼‰ï¼Œå½“å±æ€§è¢«è®¿é—®æ—¶ï¼Œä¼šå°†è¯¥å±æ€§ä¸å½“å‰ç»„ä»¶çš„æ›´æ–°å‡½æ•°å…³è”èµ·æ¥ã€‚ç®€å•è¯´ï¼š<strong>ç»„ä»¶æ¸²æŸ“æ—¶ï¼Œå“ªäº›å±æ€§è¢«ç”¨åˆ°äº†ï¼ŒLit å°±ä¼šè®°ä½ â€œè¿™ä¸ªå±æ€§å˜åŒ–æ—¶ï¼Œéœ€è¦é‡æ–°æ‰§è¡Œæ¸²æŸ“â€</strong>ã€‚</p>
<h3 data-id="heading-3">2. ä¾èµ–æ”¶é›†ï¼šå»ºç«‹ â€œçŠ¶æ€ - ç»„ä»¶â€ çš„æ˜ å°„å…³ç³»</h3>
<p>ä¾èµ–æ”¶é›†æ˜¯å“åº”å¼ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œå®ƒå†³å®šäº† â€œçŠ¶æ€å˜åŒ–æ—¶ï¼Œè¯¥é€šçŸ¥å“ªäº›ç»„ä»¶æ›´æ–°â€ã€‚Lit çš„ä¾èµ–æ”¶é›†æœºåˆ¶éå¸¸ç®€æ´ï¼Œæ ¸å¿ƒæ˜¯ä¸€ä¸ª â€œä¾èµ–æ˜ å°„è¡¨â€ï¼ˆdepsMapï¼‰ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p>
<p>javascript</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç®€åŒ–åçš„ä¾èµ–æ˜ å°„è¡¨ç»“æ„</span>
<span class="hljs-keyword">const</span> depsMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>([
  <span class="hljs-comment">// key: å“åº”å¼çŠ¶æ€å¯¹è±¡ï¼ˆå¦‚userï¼‰</span>
  [userProxy, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([
    <span class="hljs-comment">// key: å±æ€§åï¼ˆå¦‚nameï¼‰</span>
    [<span class="hljs-string">'name'</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([
      <span class="hljs-comment">// value: ä¾èµ–è¯¥å±æ€§çš„ç»„ä»¶æ›´æ–°å‡½æ•°</span>
      componentUpdateFn1,
      componentUpdateFn2
    ])]
  ])]
]);
</code></pre>
<p>å½“ç»„ä»¶æ¸²æŸ“æ—¶ï¼Œæ¯è®¿é—®ä¸€ä¸ªå“åº”å¼å±æ€§ï¼ŒLit éƒ½ä¼šæ‰§è¡Œä¸‰æ­¥æ“ä½œï¼š</p>
<ol>
<li>æ£€æŸ¥å½“å‰æ˜¯å¦å­˜åœ¨ â€œæ›´æ–°ä¸Šä¸‹æ–‡â€ï¼ˆå³ç»„ä»¶æ˜¯å¦åœ¨æ¸²æŸ“ä¸­ï¼‰ï¼›</li>
<li>è‹¥å­˜åœ¨ï¼Œä»ä¾èµ–æ˜ å°„è¡¨ä¸­æ‰¾åˆ°è¯¥å±æ€§å¯¹åº”çš„ä¾èµ–é›†åˆï¼›</li>
<li>å°†å½“å‰ç»„ä»¶çš„æ›´æ–°å‡½æ•°åŠ å…¥ä¾èµ–é›†åˆã€‚</li>
</ol>
<p>è¿™ä¸ªè¿‡ç¨‹å°±åƒ â€œè®¢é˜… - å‘å¸ƒâ€ æ¨¡å¼ï¼šå“åº”å¼å±æ€§æ˜¯ â€œå‘å¸ƒè€…â€ï¼Œç»„ä»¶æ›´æ–°å‡½æ•°æ˜¯ â€œè®¢é˜…è€…â€ã€‚ä¾èµ–æ”¶é›†å®Œæˆåï¼Œå½“å±æ€§å‘ç”Ÿå˜åŒ–ï¼Œæ‰€æœ‰è®¢é˜…å®ƒçš„æ›´æ–°å‡½æ•°éƒ½ä¼šè¢«è§¦å‘ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸ªå®¹æ˜“è¢«å¿½ç•¥çš„ç»†èŠ‚ï¼šLit çš„ä¾èµ–æ”¶é›†æ˜¯ â€œæ‡’æ”¶é›†â€ çš„ â€”â€” åªæœ‰å±æ€§è¢«å®é™…è®¿é—®æ—¶ï¼Œæ‰ä¼šå»ºç«‹ä¾èµ–å…³ç³»ã€‚å¦‚æœæŸä¸ªçŠ¶æ€å®šä¹‰åä»æœªåœ¨<code>render</code>ä¸­ä½¿ç”¨ï¼Œå³ä½¿ä¿®æ”¹å®ƒï¼Œä¹Ÿä¸ä¼šè§¦å‘ç»„ä»¶æ›´æ–°ã€‚è¿™ç§è®¾è®¡é¿å…äº†æ— æ•ˆçš„æ›´æ–°å¼€é”€ï¼Œæå‡äº†æ€§èƒ½ã€‚</p>
<h3 data-id="heading-4">3. ç²¾å‡†æ›´æ–°ï¼šè·³è¿‡è™šæ‹Ÿ DOMï¼Œç›´æ¥æ“ä½œçœŸå® DOM</h3>
<p>è¿™æ˜¯ Lit å“åº”å¼æœ€å…·ç‰¹è‰²çš„ä¸€ç‚¹ã€‚ä¸ Reactã€Vue é€šè¿‡è™šæ‹Ÿ DOM å¯¹æ¯”å·®å¼‚æ¥æ›´æ–°è§†å›¾ä¸åŒï¼ŒLit é‡‡ç”¨ â€œæ¨¡æ¿å­—é¢é‡ + DOM å·®å¼‚æ ‡è®°â€ çš„æ–¹å¼ï¼Œå®ç°æ›´é«˜æ•ˆçš„çœŸå® DOM æ›´æ–°ã€‚</p>
<p>å½“å“åº”å¼çŠ¶æ€å˜åŒ–æ—¶ï¼ŒLit ä¼šæ‰§è¡Œä»¥ä¸‹æµç¨‹ï¼š</p>
<ol>
<li>çŠ¶æ€ä¿®æ”¹è§¦å‘ Proxy çš„<code>set</code>æ‹¦æˆªå™¨ï¼›</li>
<li>ä»ä¾èµ–æ˜ å°„è¡¨ä¸­å–å‡ºè¯¥å±æ€§å¯¹åº”çš„æ‰€æœ‰æ›´æ–°å‡½æ•°ï¼Œæ‰§è¡Œè¿™äº›å‡½æ•°é‡æ–°ç”Ÿæˆç»„ä»¶æ¨¡æ¿ï¼›</li>
<li>Lit çš„æ¨¡æ¿ç¼–è¯‘å™¨ä¼šå¯¹æ¯”æ–°æ—§æ¨¡æ¿çš„å·®å¼‚ï¼Œä»…æ ‡è®°å˜åŒ–çš„ DOM èŠ‚ç‚¹ï¼ˆå¦‚æ–‡æœ¬å†…å®¹ã€å±æ€§å€¼ï¼‰ï¼›</li>
<li>ç›´æ¥æ“ä½œçœŸå® DOMï¼Œåªæ›´æ–°æ ‡è®°çš„å·®å¼‚èŠ‚ç‚¹ï¼Œæ— éœ€æ•´ä½“é‡æ–°æ¸²æŸ“ã€‚</li>
</ol>
<p>ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœåªä¿®æ”¹<code>this.count</code>ï¼ŒLit ä¼šé‡æ–°ç”Ÿæˆæ¨¡æ¿ï¼Œä½†ä»…å¯¹æ¯”å‡º â€œè®¡æ•°â€ å¯¹åº”çš„æ–‡æœ¬èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼Œéšåç›´æ¥æ›´æ–°è¯¥èŠ‚ç‚¹çš„<code>textContent</code>ï¼Œè€Œä¸ä¼šè§¦ç¢°<code>user</code>ç›¸å…³çš„ DOM èŠ‚ç‚¹ã€‚</p>
<p>è¿™ç§ â€œç²¾å‡†æ›´æ–°â€ æœºåˆ¶ï¼Œè®© Lit ç»„ä»¶çš„æ¸²æŸ“æ€§èƒ½è¿œè¶…è®¸å¤šæ¡†æ¶ã€‚æˆ‘æ›¾åšè¿‡ä¸€ä¸ªæµ‹è¯•ï¼šåœ¨åŒæ ·æ¸²æŸ“ 1000 æ¡åˆ—è¡¨æ•°æ®çš„åœºæ™¯ä¸‹ï¼ŒLit ç»„ä»¶çš„é¦–æ¬¡æ¸²æŸ“æ—¶é—´æ¯” React ç»„ä»¶å¿« 30%ï¼Œæ›´æ–°æ—¶é—´å¿« 50%ï¼ˆæ•°æ®åŸºäº Chrome æµè§ˆå™¨æ€§èƒ½é¢æ¿æµ‹è¯•ï¼‰ã€‚</p>
<h2 data-id="heading-5">ä¸‰ã€å®æˆ˜é¿å‘ï¼šLit å“åº”å¼çš„ 5 ä¸ªå…³é”®æŠ€å·§</h2>
<p>ç†è§£åŸç†åï¼Œæ›´é‡è¦çš„æ˜¯åœ¨å®æˆ˜ä¸­çµæ´»è¿ç”¨ã€‚ç»“åˆæˆ‘åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ Lit çš„ç»éªŒï¼Œæ€»ç»“äº† 5 ä¸ªé«˜é¢‘åœºæ™¯çš„é¿å‘æŠ€å·§ï¼Œå¸®ä½ é¿å¼€ 90% çš„ä½¿ç”¨è¯¯åŒºã€‚</p>
<h3 data-id="heading-6">1. å¤æ‚å¯¹è±¡çŠ¶æ€ï¼šé¿å… â€œæ·±å±‚å±æ€§æ›´æ–°ä¸è§¦å‘æ¸²æŸ“â€</h3>
<p>Lit çš„<code>@state()</code>å¯¹å¤æ‚å¯¹è±¡çš„å“åº”å¼æ”¯æŒæ˜¯ â€œæµ…å±‚â€ çš„å—ï¼Ÿå¾ˆå¤šå¼€å‘è€…ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼šä¿®æ”¹å¯¹è±¡çš„æ·±å±‚å±æ€§æ—¶ï¼Œç»„ä»¶æ²¡æœ‰è§¦å‘æ›´æ–°ã€‚æ¯”å¦‚ï¼š</p>
<p>javascript</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-ini" lang="ini">// é”™è¯¯ç¤ºä¾‹ï¼šä¿®æ”¹æ·±å±‚å±æ€§ï¼Œæœªè§¦å‘æ›´æ–°
<span class="hljs-attr">this.user.address.city</span> = <span class="hljs-string">'åŒ—äº¬'</span><span class="hljs-comment">;</span>
</code></pre>
<p>è¿™ä¸æ˜¯ Lit çš„ç¼ºé™·ï¼Œè€Œæ˜¯ Proxy çš„ç‰¹æ€§ â€”â€” é»˜è®¤æƒ…å†µä¸‹ï¼ŒProxy åªèƒ½ç›‘å¬å¯¹è±¡çš„ç¬¬ä¸€å±‚å±æ€§å˜åŒ–ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆï¼š</p>
<p>æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨<code>@state()</code>è£…é¥°å™¨æ—¶ï¼Œç¡®ä¿å¯¹è±¡çš„æ·±å±‚å±æ€§ä¿®æ”¹æ—¶ï¼Œè§¦å‘é¡¶å±‚å±æ€§çš„ setterï¼š</p>
<p>javascript</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æ­£ç¡®ç¤ºä¾‹ï¼šé‡æ–°èµ‹å€¼é¡¶å±‚å±æ€§</span>
<span class="hljs-keyword">this</span>.user = { ...<span class="hljs-keyword">this</span>.user, address: { ...<span class="hljs-keyword">this</span>.user.address, city: <span class="hljs-string">'åŒ—äº¬'</span> } };
</code></pre>
<p>æ–¹æ¡ˆäºŒï¼šå¯¹äºéœ€è¦é¢‘ç¹ä¿®æ”¹çš„å¤æ‚å¯¹è±¡ï¼Œä½¿ç”¨<code>createDeepSignal</code>ï¼ˆLit v3.0 + æ–°å¢ APIï¼‰ï¼Œå®ƒä¼šé€’å½’ä»£ç†å¯¹è±¡çš„æ‰€æœ‰å±‚çº§å±æ€§ï¼š</p>
<p>javascript</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">import</span> { createDeepSignal } from 'lit/decorators/signal.js';

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">LitElement</span> </span>{
  user = createDeepSignal({ name: 'å¼ ä¸‰', address: { city: 'ä¸Šæµ·' } });

  <span class="hljs-comment">// ç›´æ¥ä¿®æ”¹æ·±å±‚å±æ€§ï¼Œä¼šè§¦å‘æ›´æ–°</span>
  updateCity() {
    <span class="hljs-keyword">this</span>.user.value.address.city = 'åŒ—äº¬';
  }
}
</code></pre>
<h3 data-id="heading-7">2. æ•°ç»„çŠ¶æ€ï¼šé¿å… â€œç›´æ¥ä¿®æ”¹æ•°ç»„ä¸è§¦å‘æ›´æ–°â€</h3>
<p>ä¸å¯¹è±¡ç±»ä¼¼ï¼Œç›´æ¥ä¿®æ”¹æ•°ç»„çš„å…ƒç´ æˆ–é•¿åº¦ï¼ˆå¦‚<code>push</code>ã€<code>splice</code>ã€<code>arr[0] = xxx</code>ï¼‰ï¼Œé»˜è®¤ä¸ä¼šè§¦å‘ Lit çš„å“åº”å¼æ›´æ–°ã€‚è¿™æ˜¯å› ä¸ºæ•°ç»„çš„è¿™äº›æ“ä½œä¸ä¼šè§¦å‘ Proxy çš„<code>set</code>æ‹¦æˆªå™¨ï¼ˆé’ˆå¯¹æ•°ç»„çš„ç´¢å¼•æˆ–<code>length</code>å±æ€§ï¼‰ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ä¸ªï¼š</p>
<ul>
<li>
<p>å¯¹äºç®€å•æ•°ç»„ï¼Œä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦åˆ›å»ºæ–°æ•°ç»„ï¼š</p>
<p>javascript</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æ­£ç¡®ç¤ºä¾‹ï¼šæ·»åŠ å…ƒç´ </span>
<span class="hljs-keyword">this</span>.list = [...<span class="hljs-keyword">this</span>.list, newItem];
<span class="hljs-comment">// æ­£ç¡®ç¤ºä¾‹ï¼šä¿®æ”¹å…ƒç´ </span>
<span class="hljs-keyword">this</span>.list = <span class="hljs-keyword">this</span>.list.map((item, index) =&gt; index === <span class="hljs-number">0</span> ? newItem : item);
</code></pre>
</li>
<li>
<p>å¯¹äºå¤æ‚æ•°ç»„ï¼Œä½¿ç”¨<code>createSignal</code>ç»“åˆä¸å¯å˜æ•°æ®å¤„ç†ï¼š</p>
<p>javascript</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">import</span> { createSignal } from 'lit/decorators/signal.js';

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">LitElement</span> </span>{
  list = createSignal([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);

  addItem() {
    <span class="hljs-comment">// åŸºäºåŸæ•°ç»„åˆ›å»ºæ–°æ•°ç»„ï¼Œè§¦å‘æ›´æ–°</span>
    <span class="hljs-keyword">this</span>.list.set([...<span class="hljs-keyword">this</span>.list.value, <span class="hljs-number">4</span>]);
  }
}
</code></pre>
</li>
</ul>
<h3 data-id="heading-8">3. çŠ¶æ€ä¾èµ–ï¼šä½¿ç”¨computedå¤„ç†è¡ç”ŸçŠ¶æ€</h3>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ° â€œåŸºäºå¤šä¸ªçŠ¶æ€è®¡ç®—è¡ç”ŸçŠ¶æ€â€ çš„åœºæ™¯ã€‚æ¯”å¦‚ï¼Œæ ¹æ®<code>user</code>çš„<code>age</code>å’Œ<code>isStudent</code>çŠ¶æ€ï¼Œè®¡ç®—æ˜¯å¦äº«å—ä¼˜æƒ ï¼š</p>
<p>javascript</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é”™è¯¯ç¤ºä¾‹ï¼šç›´æ¥åœ¨renderä¸­è®¡ç®—ï¼Œå¯èƒ½å¯¼è‡´é‡å¤è®¡ç®—</span>
<span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> hasDiscount = <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">age</span> &lt; <span class="hljs-number">25</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">isStudent</span>;
  <span class="hljs-keyword">return</span> html`<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>æ˜¯å¦ä¼˜æƒ ï¼š</span><span class="hljs-subst">${hasDiscount ? <span class="hljs-string">'æ˜¯'</span> : <span class="hljs-string">'å¦'</span>}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>`</span>;
}
</code></pre>
<p>è¿™ç§å†™æ³•çš„é—®é¢˜æ˜¯ï¼šæ¯æ¬¡ç»„ä»¶æ›´æ–°æ—¶ï¼Œ<code>hasDiscount</code>éƒ½ä¼šé‡æ–°è®¡ç®—ï¼Œå³ä½¿ä¾èµ–çš„çŠ¶æ€æ²¡æœ‰å˜åŒ–ã€‚Lit æä¾›äº†<code>computed</code>å‡½æ•°ï¼Œä¸“é—¨å¤„ç†è¡ç”ŸçŠ¶æ€ï¼Œä¸”å…·å¤‡ç¼“å­˜ç‰¹æ€§ â€”â€” åªæœ‰ä¾èµ–çš„çŠ¶æ€å˜åŒ–æ—¶ï¼Œæ‰ä¼šé‡æ–°è®¡ç®—ã€‚</p>
<p>javascript</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> { computed } from <span class="hljs-string">'lit/decorators/computed.js'</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyComponent</span> <span class="hljs-title">extends</span> <span class="hljs-title">LitElement</span> {
  <span class="hljs-meta">@state()</span> user = { age: <span class="hljs-number">22</span>, isStudent: <span class="hljs-literal">true</span> };

  <span class="hljs-comment">// æ­£ç¡®ç¤ºä¾‹ï¼šä½¿ç”¨computedç¼“å­˜è¡ç”ŸçŠ¶æ€</span>
  <span class="hljs-meta">@computed()</span>
  <span class="hljs-keyword">get</span> hasDiscount() {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.user.age &lt; <span class="hljs-number">25</span> &amp;&amp; <span class="hljs-keyword">this</span>.user.isStudent;
  }

  render() {
    <span class="hljs-keyword">return</span> html`&lt;div&gt;æ˜¯å¦ä¼˜æƒ ï¼š${<span class="hljs-keyword">this</span>.hasDiscount ? <span class="hljs-string">'æ˜¯'</span> : <span class="hljs-string">'å¦'</span>}&lt;/div&gt;`;
  }
}
</code></pre>
<p><code>computed</code>å‡½æ•°ä¼šè‡ªåŠ¨æ”¶é›†ä¾èµ–çš„å“åº”å¼çŠ¶æ€ï¼Œå½“<code>user.age</code>æˆ–<code>user.isStudent</code>å˜åŒ–æ—¶ï¼Œæ‰ä¼šé‡æ–°è®¡ç®—<code>hasDiscount</code>çš„å€¼ï¼Œé¿å…æ— æ•ˆè®¡ç®—ã€‚</p>
<h3 data-id="heading-9">4. æ‰¹é‡æ›´æ–°ï¼šä½¿ç”¨requestUpdateé¿å…å¤šæ¬¡æ¸²æŸ“</h3>
<p>å¦‚æœä¸€æ¬¡æ“ä½œä¸­éœ€è¦ä¿®æ”¹å¤šä¸ªçŠ¶æ€ï¼Œç›´æ¥ä¿®æ”¹å¯èƒ½ä¼šè§¦å‘å¤šæ¬¡ç»„ä»¶æ›´æ–°ã€‚æ¯”å¦‚ï¼š</p>
<p>javascript</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å¯èƒ½è§¦å‘ä¸¤æ¬¡æ¸²æŸ“</span>
<span class="hljs-keyword">this</span>.count++;
<span class="hljs-keyword">this</span>.user.name = <span class="hljs-string">'æå››'</span>;
</code></pre>
<p>è™½ç„¶ Lit å†…éƒ¨æœ‰ä¸€å®šçš„æ›´æ–°åˆå¹¶æœºåˆ¶ï¼Œä½†åœ¨å¤æ‚åœºæ™¯ä¸‹ï¼Œä»å¯èƒ½å‡ºç°å¤šæ¬¡æ¸²æŸ“çš„æƒ…å†µã€‚æ­¤æ—¶å¯ä»¥ä½¿ç”¨<code>requestUpdate</code>æ–¹æ³•ï¼Œæ‰‹åŠ¨æ‰¹é‡å¤„ç†çŠ¶æ€æ›´æ–°ï¼Œç¡®ä¿åªè§¦å‘ä¸€æ¬¡æ¸²æŸ“ï¼š</p>
<p>javascript</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æ­£ç¡®ç¤ºä¾‹ï¼šæ‰¹é‡æ›´æ–°ï¼Œä»…è§¦å‘ä¸€æ¬¡æ¸²æŸ“</span>
<span class="hljs-keyword">this</span>.requestUpdate(() =&gt; {
  <span class="hljs-keyword">this</span>.count++;
  <span class="hljs-keyword">this</span>.user = { ...<span class="hljs-keyword">this</span>.user, name: <span class="hljs-string">'æå››'</span> };
});
</code></pre>
<p><code>requestUpdate</code>çš„å›è°ƒå‡½æ•°ä¸­ï¼Œæ‰€æœ‰çŠ¶æ€ä¿®æ”¹éƒ½ä¼šè¢«åˆå¹¶ï¼Œå›è°ƒæ‰§è¡Œå®Œæˆåï¼Œæ‰ä¼šè§¦å‘ç»„ä»¶çš„ä¸€æ¬¡é‡æ–°æ¸²æŸ“ï¼Œæå‡æ€§èƒ½ã€‚</p>
<h3 data-id="heading-10">5. çŠ¶æ€å…±äº«ï¼šè·¨ç»„ä»¶é€šä¿¡çš„ 3 ç§æ–¹æ¡ˆ</h3>
<p>åœ¨ä¸­å¤§å‹é¡¹ç›®ä¸­ï¼Œä¸å¯é¿å…ä¼šé‡åˆ°è·¨ç»„ä»¶çŠ¶æ€å…±äº«çš„éœ€æ±‚ã€‚Lit æ²¡æœ‰å†…ç½®çš„å…¨å±€çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œä½†ç»“åˆå…¶å“åº”å¼ç‰¹æ€§ï¼Œæœ‰ 3 ç§å®ç”¨æ–¹æ¡ˆï¼š</p>
<p>æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ â€œçˆ¶ä¼ å­ + å­ä¼ çˆ¶â€ çš„ä¼ ç»Ÿæ–¹å¼ï¼Œé€‚ç”¨äºçˆ¶å­ç»„ä»¶é€šä¿¡ï¼š</p>
<p>javascript</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-comment">// çˆ¶ç»„ä»¶</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ParentComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">LitElement</span> </span>{
  <span class="hljs-meta">@state</span>() count = <span class="hljs-number">0</span>;

  updateCount(newCount) {
    <span class="hljs-keyword">this</span>.count = newCount;
  }

  render() {
    <span class="hljs-keyword">return</span> html`&lt;child-component .count=${<span class="hljs-keyword">this</span>.count} <span class="hljs-meta">@count</span>-change=${(e) =&gt; <span class="hljs-keyword">this</span>.updateCount(e.detail)}&gt;&lt;/child-component&gt;`;
  }
}

<span class="hljs-comment">// å­ç»„ä»¶</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChildComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">LitElement</span> </span>{
  <span class="hljs-meta">@property</span>() count = <span class="hljs-number">0</span>;

  handleClick() {
    <span class="hljs-keyword">this</span>.dispatchEvent(<span class="hljs-keyword">new</span> <span class="hljs-type">CustomEvent</span>('count-change', { detail: <span class="hljs-keyword">this</span>.count + <span class="hljs-number">1</span> }));
  }

  render() {
    <span class="hljs-keyword">return</span> html`&lt;button <span class="hljs-meta">@click</span>=${<span class="hljs-keyword">this</span>.handleClick}&gt;${<span class="hljs-keyword">this</span>.count}&lt;/button&gt;`;
  }
}
</code></pre>
<p>æ–¹æ¡ˆäºŒï¼šä½¿ç”¨<code>createContext</code>åˆ›å»ºå…¨å±€ä¸Šä¸‹æ–‡ï¼Œé€‚ç”¨äºè·¨å±‚çº§ç»„ä»¶é€šä¿¡ï¼š</p>
<p>javascript</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// context.js</span>
<span class="hljs-keyword">import</span> { createContext } <span class="hljs-keyword">from</span> <span class="hljs-string">'lit'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">CountContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-number">0</span>);

<span class="hljs-comment">// æ ¹ç»„ä»¶</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CountContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./context.js'</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">RootComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">LitElement</span> {
  <span class="hljs-meta">@state</span>() count = <span class="hljs-number">0</span>;

  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> html`<span class="xml">
      <span class="hljs-tag">&lt;<span class="hljs-name">CountContext.Provider</span> <span class="hljs-attr">value</span>=</span></span><span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span><span class="xml"><span class="hljs-tag">&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">child-component</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">child-component</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">CountContext.Provider</span>&gt;</span>
    `</span>;
  }
}

<span class="hljs-comment">// å­ç»„ä»¶ï¼ˆä»»æ„å±‚çº§ï¼‰</span>
<span class="hljs-keyword">import</span> { useContext } <span class="hljs-keyword">from</span> <span class="hljs-string">'lit'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CountContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./context.js'</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">LitElement</span> {
  count = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">CountContext</span>);

  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> html`<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>å…¨å±€è®¡æ•°ï¼š</span><span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>`</span>;
  }
}
</code></pre>
<p>æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨å¤–éƒ¨å“åº”å¼çŠ¶æ€ï¼Œé€‚ç”¨äºå…¨å±€å…±äº«çŠ¶æ€ï¼ˆå¦‚ç”¨æˆ·ä¿¡æ¯ï¼‰ï¼š</p>
<p>javascript</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// globalState.js</span>
<span class="hljs-keyword">import</span> { createSignal } <span class="hljs-keyword">from</span> <span class="hljs-string">'lit/decorators/signal.js'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> userState = <span class="hljs-title function_">createSignal</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'admin'</span> });

<span class="hljs-comment">// ä»»æ„ç»„ä»¶</span>
<span class="hljs-keyword">import</span> { userState } <span class="hljs-keyword">from</span> <span class="hljs-string">'./globalState.js'</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AnyComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">LitElement</span> {
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> html`<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>ç”¨æˆ·åï¼š</span><span class="hljs-subst">${userState.value.name}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>`</span>;
  }
}

<span class="hljs-comment">// ä¿®æ”¹å…¨å±€çŠ¶æ€ï¼ˆä»»æ„ç»„ä»¶ä¸­ï¼‰</span>
userState.<span class="hljs-title function_">set</span>({ ...userState.<span class="hljs-property">value</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'æå››'</span> });
</code></pre>
<p>è¿™ç§æ–¹æ¡ˆæ— éœ€ä¸Šä¸‹æ–‡åµŒå¥—ï¼Œçµæ´»åº¦é«˜ï¼Œä¸”ä¿®æ”¹çŠ¶æ€åï¼Œæ‰€æœ‰ä½¿ç”¨è¯¥çŠ¶æ€çš„ç»„ä»¶éƒ½ä¼šè‡ªåŠ¨æ›´æ–°ã€‚</p>
<h2 data-id="heading-11">å››ã€åŸç†å»¶ä¼¸ï¼šLit å“åº”å¼ä¸å…¶ä»–æ¡†æ¶çš„æ ¸å¿ƒå·®å¼‚</h2>
<p>é€šè¿‡å‰é¢çš„åˆ†æï¼Œæˆ‘ä»¬å·²ç»æŒæ¡äº† Lit å“åº”å¼çš„æ ¸å¿ƒé€»è¾‘ã€‚ä½†è¦çœŸæ­£ç†è§£å®ƒçš„ä¼˜åŠ¿ï¼Œè¿˜éœ€è¦ä¸ Vueã€React çš„å“åº”å¼ç³»ç»Ÿåšå¯¹æ¯”ï¼Œçœ‹æ¸…èƒŒåçš„è®¾è®¡æ€è·¯å·®å¼‚ã€‚</p>
<h3 data-id="heading-12">1. ä¸ Vue 3 å“åº”å¼çš„å·®å¼‚</h3>
<p>Vue 3 çš„å“åº”å¼åŒæ ·åŸºäº Proxyï¼Œä½†ä¸¤è€…çš„è®¾è®¡ç›®æ ‡ä¸åŒï¼š</p>
<ul>
<li>Vue çš„å“åº”å¼æ›´ â€œå…¨èƒ½â€ï¼Œæ”¯æŒæ·±å±‚ä»£ç†ã€æ•°ç»„å˜å¼‚æ–¹æ³•ï¼ˆå¦‚<code>push</code>ï¼‰ã€ä¾èµ–è‡ªåŠ¨æ”¶é›†ç­‰ï¼Œå°è£…ç¨‹åº¦é«˜ï¼Œå¼€å‘è€…æ— éœ€å…³æ³¨åº•å±‚å®ç°ï¼›</li>
<li>Lit çš„å“åº”å¼æ›´ â€œè½»é‡åŒ–â€ï¼Œé»˜è®¤åªæ”¯æŒæµ…å±‚ä»£ç†ï¼Œæ•°ç»„å˜å¼‚æ–¹æ³•éœ€è¦æ‰‹åŠ¨å¤„ç†ï¼Œä½†å…¶æ ¸å¿ƒé€»è¾‘æ›´ç®€æ´ï¼Œæ— é¢å¤– runtime å¼€é”€ï¼Œç»„ä»¶å…¼å®¹æ€§æ›´å¼ºã€‚</li>
</ul>
<p>é€‚ç”¨åœºæ™¯ï¼šå¦‚æœæ˜¯çº¯ Vue é¡¹ç›®ï¼Œä½¿ç”¨ Vue è‡ªå¸¦çš„å“åº”å¼æ›´é«˜æ•ˆï¼›å¦‚æœéœ€è¦è·¨æ¡†æ¶å¤ç”¨ç»„ä»¶ï¼ŒLit çš„å“åº”å¼æ›´æœ‰ä¼˜åŠ¿ã€‚</p>
<h3 data-id="heading-13">2. ä¸ React å“åº”å¼çš„å·®å¼‚</h3>
<p>React çš„å“åº”å¼åŸºäº â€œçŠ¶æ€æ›´æ–°è§¦å‘é‡æ–°æ¸²æŸ“â€ï¼Œæ ¸å¿ƒæ˜¯è™šæ‹Ÿ DOM å¯¹æ¯”ï¼š</p>
<ul>
<li>React çš„<code>useState</code>ä¸è¿½è¸ªçŠ¶æ€çš„å…·ä½“å˜åŒ–ï¼Œåªè¦è°ƒç”¨<code>setState</code>ï¼Œå°±ä¼šè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼ˆé™¤éä½¿ç”¨<code>React.memo</code>ã€<code>useMemo</code>ä¼˜åŒ–ï¼‰ï¼›</li>
<li>Lit çš„å“åº”å¼ç²¾å‡†è¿½è¸ªå±æ€§è®¿é—®ï¼Œåªæœ‰è¢«æ¸²æŸ“ä½¿ç”¨çš„çŠ¶æ€å˜åŒ–æ—¶ï¼Œæ‰ä¼šè§¦å‘æ›´æ–°ï¼Œä¸”ç›´æ¥æ“ä½œçœŸå® DOMï¼Œæ— éœ€è™šæ‹Ÿ DOM å¯¹æ¯”ã€‚</li>
</ul>
<p>æ€§èƒ½å·®å¼‚ï¼šåœ¨å°å‹ç»„ä»¶ã€ç®€å•çŠ¶æ€åœºæ™¯ä¸‹ï¼Œä¸¤è€…æ€§èƒ½å·®è·ä¸å¤§ï¼›ä½†åœ¨å¤§å‹åˆ—è¡¨ã€å¤æ‚çŠ¶æ€ä¾èµ–åœºæ™¯ä¸‹ï¼ŒLit çš„ç²¾å‡†æ›´æ–°æœºåˆ¶èƒ½æ˜¾è‘—æå‡æ€§èƒ½ã€‚</p>
<h2 data-id="heading-14">äº”ã€æ€»ç»“ï¼šæŒæ¡ Lit å“åº”å¼çš„ 3 ä¸ªå…³é”®</h2>
<p>Lit çš„å“åº”å¼ç³»ç»Ÿçœ‹ä¼¼ç®€å•ï¼Œå®åˆ™è•´å«ç€ â€œè½»é‡ã€é«˜æ•ˆã€å…¼å®¹â€ çš„è®¾è®¡å“²å­¦ã€‚é€šè¿‡æœ¬æ–‡çš„æ‹†è§£ï¼Œå¸Œæœ›èƒ½å¸®ä½ å»ºç«‹èµ·å®Œæ•´çš„çŸ¥è¯†ä½“ç³»ï¼š</p>
<ol>
<li>æ ¸å¿ƒé€»è¾‘ï¼šè®°ä½ â€œçŠ¶æ€è¿½è¸ª - ä¾èµ–æ”¶é›† - ç²¾å‡†æ›´æ–°â€ ä¸‰æ­¥æµç¨‹ï¼Œç†è§£ Proxy åœ¨å…¶ä¸­çš„ä½œç”¨ï¼›</li>
<li>å®æˆ˜æŠ€å·§ï¼šæŒæ¡å¤æ‚å¯¹è±¡ / æ•°ç»„çš„æ›´æ–°æ–¹å¼ã€<code>computed</code>è¡ç”ŸçŠ¶æ€ã€æ‰¹é‡æ›´æ–°ã€è·¨ç»„ä»¶é€šä¿¡ç­‰é«˜é¢‘åœºæ™¯çš„è§£å†³æ–¹æ¡ˆï¼›</li>
<li>å·®å¼‚è®¤çŸ¥ï¼šæ˜ç¡® Lit ä¸å…¶ä»–æ¡†æ¶å“åº”å¼çš„åŒºåˆ«ï¼Œæ ¹æ®é¡¹ç›®åœºæ™¯é€‰æ‹©åˆé€‚çš„æŠ€æœ¯æ–¹æ¡ˆã€‚</li>
</ol>
<p>Lit çš„å“åº”å¼æ˜¯å…¶ç»„ä»¶åŒ–å¼€å‘çš„åŸºç¡€ï¼Œåƒé€è¿™éƒ¨åˆ†å†…å®¹ï¼Œåç»­å­¦ä¹ ç»„ä»¶å°è£…ã€æ€§èƒ½ä¼˜åŒ–ã€å·¥ç¨‹åŒ–é…ç½®ç­‰çŸ¥è¯†éƒ½ä¼šäº‹åŠåŠŸå€ã€‚åœ¨æ¥ä¸‹æ¥çš„å°å†Œå†…å®¹ä¸­ï¼Œæˆ‘ä¼šç»“åˆæ›´å¤šå®æˆ˜é¡¹ç›®ï¼Œå¸¦ä½ æ·±å…¥ Lit çš„ç»„ä»¶å¼€å‘ã€å·¥ç¨‹åŒ–è½åœ°ç­‰æ ¸å¿ƒåœºæ™¯ï¼Œè®©ä½ çœŸæ­£èƒ½ç”¨ Lit æ­å»ºå‡ºé«˜æ•ˆã€å¯å¤ç”¨çš„å‰ç«¯ç³»ç»Ÿã€‚</p>
<p>å¦‚æœæƒ³æå‰æŸ¥çœ‹ Lit å®˜æ–¹å¯¹å“åº”å¼çš„è¯¦ç»†è¯´æ˜ï¼Œå¯ä»¥å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Flit.dev%2Fdocs%2Freactivity%2F" target="_blank" title="https://lit.dev/docs/reactivity/" ref="nofollow noopener noreferrer">Lit å“åº”å¼æ–‡æ¡£</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[objectå’Œmap å’Œ WeakMap çš„åŒºåˆ«]]></title>    <link>https://juejin.cn/post/7572459217811210303</link>    <guid>https://juejin.cn/post/7572459217811210303</guid>    <pubDate>2025-11-15T06:31:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572459217811210303" data-draft-id="7572396000545128511" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="objectå’Œmap å’Œ WeakMap çš„åŒºåˆ«"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-15T06:31:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="jump680"/> <meta itemprop="url" content="https://juejin.cn/user/3631047185561411"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            objectå’Œmap å’Œ WeakMap çš„åŒºåˆ«
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3631047185561411/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    jump680
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T06:31:43.000Z" title="Sat Nov 15 2025 06:31:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">object å’Œ mapçš„åŒºåˆ«</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/521d61187bdb41c084b96629ccb963b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAganVtcDY4MA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763793423&amp;x-signature=GsARTaSv2smjhmhsi01mBwKhMlg%3D" alt="PixPin_2025-11-15_00-40-56.png" loading="lazy"/>
<strong>é€‰æ‹©Â ObjectÂ çš„åœºæ™¯ï¼š</strong></p>
<ol>
<li><strong>ç®€å•çš„ç»“æ„åŒ–æ•°æ®/è®°å½•</strong>ï¼šå½“ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªç»“æ„å›ºå®šçš„â€œä¸œè¥¿â€ï¼Œå¹¶ä¸”å±æ€§åæ˜¯ç®€å•ã€å·²çŸ¥çš„å­—ç¬¦ä¸²æ—¶ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç”¨æˆ·å¯¹è±¡Â const user = { name: 'John', email: '...' }ã€‚</li>
<li><strong>JSON æ“ä½œ</strong>ï¼šå½“æ•°æ®éœ€è¦é€šè¿‡Â JSON.stringify()Â æˆ–Â JSON.parse()Â è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–æ—¶ï¼Œå¿…é¡»ä½¿ç”¨Â Objectï¼Œå› ä¸º JSON åªæ”¯æŒå­—ç¬¦ä¸²é”®ã€‚</li>
<li><strong>è¡¨ç¤ºä¸€ä¸ªå®ä½“</strong>ï¼šå½“ä»£ç çš„æ„å›¾æ˜¯æè¿°ä¸€ä¸ªå…·ä½“äº‹ç‰©çš„å±æ€§æ—¶ã€‚</li>
</ol>
<p>ObjectÂ å½“ä½œä¸€ä¸ªâ€œè®°å½• (Record)â€æˆ–â€œç»“æ„ä½“ (Struct)â€ï¼ŒæŠŠÂ MapÂ å½“ä½œä¸€ä¸ªçœŸæ­£çš„â€œå­—å…¸ (Dictionary)â€æˆ–â€œå“ˆå¸Œè¡¨ (Hash Map)â€ã€‚</p>
<p>mapçš„keyå¯ä»¥æ˜¯<code>ä»»ä½•ç±»å‹</code>ï¼Œ<code>map</code>å¯¹å®ƒçš„<code>key</code>æ˜¯<code>å¼ºå¼•ç”¨</code>çš„å…³ç³»ã€‚ä¹Ÿå°±æ˜¯å³ä½¿<code>å¯¹è±¡ç±»å‹ç½®ç©º</code>ï¼Œå¯¹è±¡ç±»å‹ä¾ç„¶ä¼šè¢«mapå¼•ç”¨ã€‚å¯¼è‡´æ— æ³•è¢«å›æ”¶ã€‚(<code>å¼•ç”¨è®¡æ•°å™¨</code>ä¸ä¸ºé›¶ï¼Œ<code>æ— æ³•è¢«å›æ”¶</code>)</p>
<p>WeakMapÂ æ˜¯ JavaScript (ES6) ä¸­å¼•å…¥çš„ä¸€ç§æ–°çš„é›†åˆç±»å‹ã€‚è¦ç†è§£å®ƒçš„æ ¸å¿ƒä½œç”¨ï¼Œå…³é”®åœ¨äºç†è§£ä¸¤ä¸ªè¯ï¼šâ€œMapâ€ å’Œ â€œWeakâ€ï¼ˆå¼±å¼•ç”¨ï¼‰ã€‚</p>
<hr/>
<h4 data-id="heading-1">1. é¦–å…ˆï¼Œå®ƒæ˜¯ä¸€ä¸ª Map</h4>
<p>å’Œæ™®é€šçš„Â MapÂ ä¸€æ ·ï¼ŒWeakMapÂ ä¹Ÿæ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆkey-valueï¼‰çš„é›†åˆã€‚ä½ å¯ä»¥ç”¨Â set(key, value)Â æ¥æ·»åŠ æ•°æ®ï¼Œç”¨Â get(key)Â æ¥è·å–æ•°æ®ï¼Œç”¨Â has(key)Â æ¥æ£€æŸ¥æ˜¯å¦å­˜åœ¨ï¼Œç”¨Â delete(key)Â æ¥åˆ é™¤ã€‚</p>
<p>codeJavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> wm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();
<span class="hljs-keyword">const</span> obj = {};

<span class="hljs-comment">// è®¾ç½®é”®å€¼å¯¹</span>
wm.<span class="hljs-title function_">set</span>(obj, <span class="hljs-string">'ä¸€äº›ä¸objç›¸å…³çš„æ•°æ®'</span>);

<span class="hljs-comment">// è·å–å€¼</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(wm.<span class="hljs-title function_">get</span>(obj)); <span class="hljs-comment">// 'ä¸€äº›ä¸objç›¸å…³çš„æ•°æ®'</span>

<span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦å­˜åœ¨</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(wm.<span class="hljs-title function_">has</span>(obj)); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// åˆ é™¤</span>
wm.<span class="hljs-title function_">delete</span>(obj);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(wm.<span class="hljs-title function_">has</span>(obj)); <span class="hljs-comment">// false</span>
</code></pre>
<p>ä½†æ˜¯ï¼ŒWeakMapÂ å’ŒÂ MapÂ æœ‰å‡ ä¸ªå…³é”®çš„åŒºåˆ«ï¼Œè¿™äº›åŒºåˆ«æ­£æ˜¯Â WeakMapÂ ä»·å€¼çš„ä½“ç°ã€‚</p>
<hr/>
<h4 data-id="heading-2">2. æ ¸å¿ƒç‰¹æ€§ï¼šâ€œWeakâ€ï¼ˆå¼±å¼•ç”¨ï¼‰</h4>
<p>è¿™æ˜¯Â WeakMapÂ æœ€é‡è¦ã€æœ€æ ¸å¿ƒçš„æ¦‚å¿µã€‚è¦ç†è§£â€œå¼±å¼•ç”¨â€ï¼Œæˆ‘ä»¬å…ˆè¦æ˜ç™½ä»€ä¹ˆæ˜¯â€œå¼ºå¼•ç”¨â€ã€‚</p>
<h5 data-id="heading-3">å¼ºå¼•ç”¨ (Strong Reference)</h5>
<p>åœ¨ JavaScript ä¸­ï¼Œæˆ‘ä»¬å¹³æ—¶ä½¿ç”¨çš„éƒ½æ˜¯å¼ºå¼•ç”¨ã€‚æ¯”å¦‚ï¼š</p>
<p>codeJavaScript</p>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">obj</span> = { name: <span class="hljs-string">'Alice'</span> }<span class="hljs-comment">; // å˜é‡ obj å¯¹ { name: 'Alice' } è¿™ä¸ªå¯¹è±¡æ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨</span>
let <span class="hljs-attr">anotherObj</span> = obj<span class="hljs-comment">;       // å˜é‡ anotherObj ä¹Ÿå¯¹è¿™ä¸ªå¯¹è±¡äº§ç”Ÿäº†ä¸€ä¸ªå¼ºå¼•ç”¨</span>
</code></pre>
<p>åªè¦è‡³å°‘è¿˜æœ‰ä¸€ä¸ªå¼ºå¼•ç”¨æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆGarbage Collection, GCï¼‰å°±<strong>ä¸ä¼š</strong>å›æ”¶è¿™ä¸ªå¯¹è±¡ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå³ä½¿æˆ‘ä»¬è®¾ç½®Â obj = nullï¼ŒanotherObjÂ ä»ç„¶å¼•ç”¨ç€é‚£ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥å®ƒä¸ä¼šè¢«å›æ”¶ã€‚</p>
<h5 data-id="heading-4">å¼±å¼•ç”¨ (Weak Reference)</h5>
<p>å¼±å¼•ç”¨åˆ™ä¸åŒã€‚<strong>ä¸€ä¸ª<code>å¼±å¼•ç”¨</code>å¹¶<code>ä¸ä¼šé˜»æ­¢</code>åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶å®ƒæ‰€<code>å¼•ç”¨çš„å¯¹è±¡</code>ã€‚</strong></p>
<p><code>WeakMap</code>Â å¯¹å®ƒçš„**é”®ï¼ˆ<code>key</code>ï¼‰**å°±æ˜¯<code>å¼±å¼•ç”¨</code>ã€‚</p>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªÂ MapÂ å’ŒÂ WeakMapÂ çš„å¯¹æ¯”æ¥ç†è§£è¿™ä¸€ç‚¹ï¼š</p>
<p><strong>ä½¿ç”¨Â MapÂ (å¼ºå¼•ç”¨) çš„æƒ…å†µï¼š</strong></p>
<p>codeJavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> myMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
<span class="hljs-keyword">let</span> keyObject = { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span> };

myMap.<span class="hljs-title function_">set</span>(keyObject, <span class="hljs-string">"ä¸€äº›å…ƒæ•°æ®"</span>);

<span class="hljs-comment">// ç°åœ¨ï¼ŒmyMap å¼ºå¼•ç”¨ç€ keyObjectã€‚</span>

<span class="hljs-comment">// æˆ‘ä»¬å°è¯•â€œå¿˜è®°â€keyObjectï¼ŒæŠŠå¯¹å®ƒçš„æ‰€æœ‰å…¶ä»–å¼•ç”¨éƒ½æ–­å¼€</span>
keyObject = <span class="hljs-literal">null</span>;

<span class="hljs-comment">// æ­¤æ—¶ï¼ŒkeyObject è¿˜èƒ½è¢«è®¿é—®åˆ°å—ï¼Ÿ</span>
<span class="hljs-comment">// ç­”æ¡ˆæ˜¯ï¼šå¯ä»¥ï¼Œé€šè¿‡ myMapã€‚</span>
<span class="hljs-comment">// å› ä¸º myMap å†…éƒ¨çš„å¼•ç”¨æ˜¯å¼ºå¼•ç”¨ï¼Œæ‰€ä»¥ { id: 1 } è¿™ä¸ªå¯¹è±¡æ— æ³•è¢«åƒåœ¾å›æ”¶ã€‚</span>
<span class="hljs-comment">// è¿™å°±é€ æˆäº†æ½œåœ¨çš„å†…å­˜æ³„æ¼ï¼åªè¦ myMap å­˜åœ¨ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ°¸è¿œå­˜åœ¨ã€‚</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myMap.<span class="hljs-title function_">keys</span>().<span class="hljs-title function_">next</span>().<span class="hljs-property">value</span>); <span class="hljs-comment">// { id: 1 }</span>
</code></pre>
<p><strong>ä½¿ç”¨Â WeakMapÂ (å¼±å¼•ç”¨) çš„æƒ…å†µï¼š</strong></p>
<p>codeJavaScript</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">let</span> myWeakMap = <span class="hljs-keyword">new</span> WeakMap();
<span class="hljs-keyword">let</span> keyObject = { id: <span class="hljs-number">1</span> };

myWeakMap.<span class="hljs-keyword">set</span>(keyObject, <span class="hljs-string">"ä¸€äº›å…ƒæ•°æ®"</span>);

<span class="hljs-comment">// ç°åœ¨ï¼ŒmyWeakMap å¼±å¼•ç”¨ç€ keyObjectã€‚</span>

<span class="hljs-comment">// æˆ‘ä»¬åŒæ ·å°è¯•â€œå¿˜è®°â€keyObject</span>
keyObject = <span class="hljs-literal">null</span>;

<span class="hljs-comment">// æ­¤æ—¶ï¼Œå†ä¹Ÿæ²¡æœ‰ä»»ä½•å¼ºå¼•ç”¨æŒ‡å‘ { id: 1 } è¿™ä¸ªå¯¹è±¡äº†ã€‚</span>
<span class="hljs-comment">// åƒåœ¾å›æ”¶æœºåˆ¶åœ¨ä¸‹ä¸€æ¬¡è¿è¡Œæ—¶ï¼Œå°±ä¼šå‘ç°è¿™ä¸ªå¯¹è±¡å¯ä»¥è¢«å®‰å…¨åœ°å›æ”¶ã€‚</span>
<span class="hljs-comment">// ä¸€æ—¦å¯¹è±¡è¢«å›æ”¶ï¼ŒWeakMap ä¸­å¯¹åº”çš„è¿™ä¸ªé”®å€¼å¯¹ä¹Ÿä¼šè¢«è‡ªåŠ¨ç§»é™¤ã€‚</span>

<span class="hljs-comment">// æ³¨æ„ï¼šæˆ‘ä»¬æ— æ³•ç›´æ¥éªŒè¯è¿™ä¸€ç‚¹ï¼Œå› ä¸ºåƒåœ¾å›æ”¶çš„æ—¶æœºæ˜¯ä¸ç¡®å®šçš„ã€‚</span>
<span class="hljs-comment">// ä½†æˆ‘ä»¬å¯ä»¥ç¡®ä¿¡ï¼Œè¿™ä¸ªé”®å€¼å¯¹ä¸ä¼šæ°¸ä¹…å­˜åœ¨ï¼Œä»è€Œé¿å…äº†å†…å­˜æ³„æ¼ã€‚</span>
</code></pre>
<p><strong>æ€»ç»“ä¸€ä¸‹å¼±å¼•ç”¨çš„æ•ˆæœï¼š</strong> Â WeakMapÂ å…è®¸ä½ å°†æ•°æ®ä¸ä¸€ä¸ªå¯¹è±¡å…³è”èµ·æ¥ï¼Œä½†å½“è¿™ä¸ªå¯¹è±¡åœ¨ç¨‹åºçš„å…¶ä»–åœ°æ–¹ä¸å†è¢«éœ€è¦ï¼ˆå³æ²¡æœ‰ä»»ä½•å¼ºå¼•ç”¨æŒ‡å‘å®ƒï¼‰æ—¶ï¼ŒWeakMapÂ ä¸ä¼šæˆä¸ºå®ƒç»§ç»­å­˜æ´»ä¸‹å»çš„â€œæ•‘å‘½ç¨»è‰â€ã€‚å®ƒä¼šè‡ªåŠ¨â€œæ”¾æ‰‹â€ï¼Œè®©åƒåœ¾å›æ”¶æœºåˆ¶æ¸…ç†å†…å­˜ã€‚</p>
<hr/>
<h4 data-id="heading-5">3.Â WeakMapÂ çš„ä¸»è¦ä½œç”¨å’Œåº”ç”¨åœºæ™¯</h4>
<p>åŸºäºâ€œå¼±å¼•ç”¨â€è¿™ä¸ªæ ¸å¿ƒç‰¹æ€§ï¼ŒWeakMapÂ ä¸»è¦è¢«ç”¨æ¥è§£å†³ä»¥ä¸‹å‡ ç±»é—®é¢˜ï¼š</p>
<h5 data-id="heading-6">åœºæ™¯ä¸€ï¼šå­˜å‚¨å¯¹è±¡çš„ç§æœ‰æ•°æ®æˆ–å…ƒæ•°æ®ï¼ˆæœ€ç»å…¸çš„åº”ç”¨ï¼‰</h5>
<p>å½“ä½ æƒ³è¦ä¸ºä¸€ä¸ªå¯¹è±¡é™„åŠ ä¸€äº›é¢å¤–ä¿¡æ¯ï¼Œä½†åˆä¸æƒ³ç›´æ¥ä¿®æ”¹è¿™ä¸ªå¯¹è±¡æœ¬èº«æ—¶ï¼ŒWeakMapÂ æ˜¯å®Œç¾çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p><strong>é—®é¢˜ï¼š</strong> Â å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªåº“ï¼Œéœ€è¦ä¸ºç”¨æˆ·ä¼ å…¥çš„å¯¹è±¡æ·»åŠ ä¸€äº›å†…éƒ¨çŠ¶æ€ï¼Œä½†ä½ ä¸èƒ½åœ¨å¯¹è±¡ä¸Šæ·»åŠ å±æ€§ï¼ˆæ¯”å¦‚Â userObject._myLibraryState = ...ï¼‰ï¼Œå› ä¸ºè¿™ä¼šæ±¡æŸ“å¯¹è±¡ï¼Œå¯èƒ½ä¸ç”¨æˆ·çš„ä»£ç å†²çªã€‚</p>
<p><strong>ä½¿ç”¨Â MapÂ çš„ç¼ºé™·ï¼š</strong> Â ä½ å¯ä»¥ç”¨ä¸€ä¸ªå…¨å±€çš„Â MapÂ æ¥å­˜å‚¨ï¼šmap.set(userObject, myState)ã€‚ä½†è¿™ä¼šå¯¼è‡´å‰é¢æåˆ°çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚å¦‚æœç”¨æˆ·ç”¨å®ŒÂ userObjectÂ å¹¶å°†å…¶è®¾ç½®ä¸ºÂ nullï¼Œä½ çš„Â MapÂ ä»ç„¶ä¼šâ€œæŠ“ä½â€å®ƒä¸æ”¾ã€‚</p>
<p><strong>WeakMapÂ çš„è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<p>codeJavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> privateData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();

<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-comment">// å°†ç§æœ‰æ•°æ®å­˜å‚¨åœ¨ WeakMap ä¸­ï¼Œç”¨ this (å®ä¾‹å¯¹è±¡) ä½œä¸ºé”®</span>
    privateData.<span class="hljs-title function_">set</span>(<span class="hljs-variable language_">this</span>, { <span class="hljs-attr">loginCount</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">lastLogin</span>: <span class="hljs-literal">null</span> });
  }

  <span class="hljs-title function_">login</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> data = privateData.<span class="hljs-title function_">get</span>(<span class="hljs-variable language_">this</span>);
    data.<span class="hljs-property">loginCount</span>++;
    data.<span class="hljs-property">lastLogin</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> ç™»å½•æˆåŠŸï¼Œå·²ç™»å½• <span class="hljs-subst">${data.loginCount}</span> æ¬¡ã€‚`</span>);
  }
}

<span class="hljs-keyword">let</span> user1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">'Bob'</span>);
user1.<span class="hljs-title function_">login</span>(); <span class="hljs-comment">// Bob ç™»å½•æˆåŠŸï¼Œå·²ç™»å½• 1 æ¬¡ã€‚</span>

<span class="hljs-comment">// å½“ user1 ä¸å†è¢«ä½¿ç”¨æ—¶ï¼Œæ¯”å¦‚ï¼š</span>
user1 = <span class="hljs-literal">null</span>;
<span class="hljs-comment">// åœ¨æœªæ¥çš„æŸä¸ªæ—¶åˆ»ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶ä¼šå›æ”¶åŸæ¥ user1 æŒ‡å‘çš„å¯¹è±¡ã€‚</span>
<span class="hljs-comment">// åŒæ—¶ï¼ŒprivateData ä¸­ä¸è¯¥å¯¹è±¡å…³è”çš„æ•°æ®ä¹Ÿä¼šè¢«è‡ªåŠ¨æ¸…é™¤ï¼Œä¸ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚</span>
</code></pre>
<p>è¿™ä¸ªæ¨¡å¼åœ¨ JavaScript å®ç°ç§æœ‰å±æ€§çš„æ—©æœŸæ¢ç´¢ä¸­éå¸¸æµè¡Œï¼ˆåœ¨Â #Â ç§æœ‰å­—æ®µè¯­æ³•æ™®åŠä¹‹å‰ï¼‰ã€‚</p>
<h5 data-id="heading-7">åœºæ™¯äºŒï¼šç¼“å­˜è®¡ç®—ç»“æœ (Memoization)</h5>
<p>å½“ä½ æœ‰ä¸€ä¸ªå¯¹å¯¹è±¡è¿›è¡Œå¤æ‚è®¡ç®—çš„å‡½æ•°æ—¶ï¼Œä½ å¯ä»¥ç”¨Â WeakMapÂ æ¥ç¼“å­˜ç»“æœï¼Œä»¥é¿å…é‡å¤è®¡ç®—ã€‚</p>
<p><strong>é—®é¢˜ï¼š</strong> Â æœ‰ä¸€ä¸ªå‡½æ•°Â process(obj)ï¼Œè®¡ç®—æˆæœ¬å¾ˆé«˜ã€‚å¦‚æœå¤šæ¬¡ä¼ å…¥åŒä¸€ä¸ªÂ objï¼Œæˆ‘ä»¬å¸Œæœ›ç›´æ¥è¿”å›ç¼“å­˜çš„ç»“æœã€‚</p>
<p><strong>WeakMapÂ çš„è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<p>codeJavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();

<span class="hljs-keyword">function</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">obj</span>) {
  <span class="hljs-comment">// å¦‚æœç¼“å­˜ä¸­æœ‰ï¼Œç›´æ¥è¿”å›</span>
  <span class="hljs-keyword">if</span> (cache.<span class="hljs-title function_">has</span>(obj)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ä»ç¼“å­˜ä¸­è¯»å–...'</span>);
    <span class="hljs-keyword">return</span> cache.<span class="hljs-title function_">get</span>(obj);
  }

  <span class="hljs-comment">// å¦åˆ™ï¼Œè¿›è¡Œå¤æ‚è®¡ç®—</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ­£åœ¨è¿›è¡Œå¤æ‚è®¡ç®—...'</span>);
  <span class="hljs-keyword">const</span> result = <span class="hljs-comment">/* ... ä¸€äº›éå¸¸è€—æ—¶çš„æ“ä½œ ... */</span> obj.<span class="hljs-property">value</span> * <span class="hljs-number">10</span>;

  <span class="hljs-comment">// å°†ç»“æœå­˜å…¥ç¼“å­˜</span>
  cache.<span class="hljs-title function_">set</span>(obj, result);
  <span class="hljs-keyword">return</span> result;
}

<span class="hljs-keyword">let</span> myObj = { <span class="hljs-attr">value</span>: <span class="hljs-number">5</span> };
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">process</span>(myObj)); <span class="hljs-comment">// æ­£åœ¨è¿›è¡Œå¤æ‚è®¡ç®—...  50</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">process</span>(myObj)); <span class="hljs-comment">// ä»ç¼“å­˜ä¸­è¯»å–...    50</span>

<span class="hljs-comment">// å½“ myObj ä¸å†éœ€è¦æ—¶</span>
myObj = <span class="hljs-literal">null</span>;
<span class="hljs-comment">// ç¼“å­˜ä¸­çš„ { value: 5 } -&gt; 50 è¿™æ¡è®°å½•ä¼šè‡ªåŠ¨è¢«æ¸…ç†ï¼Œé‡Šæ”¾å†…å­˜ã€‚</span>
<span class="hljs-comment">// å¦‚æœç”¨ Mapï¼Œè¿™æ¡ç¼“å­˜ä¼šä¸€ç›´å­˜åœ¨ã€‚</span>
</code></pre>
<h5 data-id="heading-8">åœºæ™¯ä¸‰ï¼šç®¡ç† DOM èŠ‚ç‚¹ä¸æ•°æ®çš„å…³è”</h5>
<p>åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦ä¸º DOM å…ƒç´ é™„åŠ ä¸€äº›çŠ¶æ€æˆ–æ•°æ®ã€‚</p>
<p><strong>é—®é¢˜ï¼š</strong> Â ä½ ä¸ºä¸€ä¸ªæŒ‰é’®æ·»åŠ äº†ä¸€ä¸ªç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨ï¼Œå¹¶ä¸”éœ€è¦å­˜å‚¨ä¸€äº›ä¸è¯¥æŒ‰é’®ç›¸å…³çš„çŠ¶æ€ã€‚å¦‚æœæŠŠè¿™äº›çŠ¶æ€å­˜åœ¨ä¸€ä¸ªå…¨å±€çš„Â MapÂ æˆ–å¯¹è±¡ä¸­ï¼Œå½“è¿™ä¸ªæŒ‰é’®ä»é¡µé¢ä¸Šè¢«ç§»é™¤åï¼ŒMapÂ ä¸­å¯¹å®ƒçš„å¼•ç”¨ä¾ç„¶å­˜åœ¨ï¼Œå¯¼è‡´è¿™ä¸ªï¼ˆå·²ç»åˆ†ç¦»çš„ï¼‰DOM èŠ‚ç‚¹æ— æ³•è¢«å›æ”¶ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚</p>
<p><strong>WeakMapÂ çš„è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<p>codeJavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> elementData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();

<span class="hljs-keyword">const</span> button = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'myButton'</span>);

elementData.<span class="hljs-title function_">set</span>(button, { <span class="hljs-attr">clickCount</span>: <span class="hljs-number">0</span> });

button.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> data = elementData.<span class="hljs-title function_">get</span>(button);
  data.<span class="hljs-property">clickCount</span>++;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æŒ‰é’®è¢«ç‚¹å‡»äº† <span class="hljs-subst">${data.clickCount}</span> æ¬¡`</span>);
});

<span class="hljs-comment">// å‡è®¾åœ¨æŸä¸ªæ—¶åˆ»ï¼Œæˆ‘ä»¬ä» DOM ä¸­ç§»é™¤äº†è¿™ä¸ªæŒ‰é’®</span>
<span class="hljs-comment">// button.parentNode.removeChild(button);</span>
<span class="hljs-comment">// å¹¶ä¸”æ²¡æœ‰å…¶ä»–åœ°æ–¹å¼•ç”¨è¿™ä¸ª button å˜é‡äº†ã€‚</span>
<span class="hljs-comment">// é‚£ä¹ˆè¿™ä¸ª DOM èŠ‚ç‚¹å°±ä¼šè¢«åƒåœ¾å›æ”¶ï¼ŒelementData ä¸­å¯¹åº”çš„æ•°æ®ä¹Ÿä¼šè¢«è‡ªåŠ¨æ¸…é™¤ã€‚</span>
</code></pre>
<hr/>
<h4 data-id="heading-9">4.Â WeakMapÂ çš„é™åˆ¶</h4>
<p>ä¸ºäº†å®ç°å¼±å¼•ç”¨å’Œè‡ªåŠ¨åƒåœ¾å›æ”¶ï¼ŒWeakMapÂ ä»˜å‡ºäº†ä¸€äº›ä»£ä»·ï¼Œå¯¼è‡´å®ƒæœ‰ä»¥ä¸‹é™åˆ¶ï¼š</p>
<ol>
<li><strong>é”®å¿…é¡»æ˜¯å¯¹è±¡</strong>ï¼šWeakMapÂ çš„é”®ä¸èƒ½æ˜¯åŸå§‹ç±»å‹å€¼ï¼ˆå¦‚Â string,Â number,Â symbolï¼‰ï¼Œå› ä¸ºåŸå§‹å€¼æ˜¯ä¸å¯å˜çš„ï¼Œæ²¡æœ‰è¢«åƒåœ¾å›æ”¶çš„æ¦‚å¿µã€‚</li>
<li><strong>ä¸å¯éå†</strong>ï¼šWeakMapÂ æ²¡æœ‰Â keys(),Â values(),Â entries()Â æ–¹æ³•ï¼Œä¹Ÿä¸æ”¯æŒÂ forEachÂ å¾ªç¯ï¼Œä¹Ÿæ²¡æœ‰Â sizeÂ å±æ€§ã€‚å› ä¸ºé”®å€¼å¯¹å¯èƒ½åœ¨ä»»ä½•æ—¶å€™è¢«åƒåœ¾å›æ”¶æœºåˆ¶ç§»é™¤ï¼Œæ‰€ä»¥å®ƒçš„æˆå‘˜åˆ—è¡¨æ˜¯ä¸ç¡®å®šçš„ï¼Œéå†å®ƒæ²¡æœ‰æ„ä¹‰ã€‚</li>
</ol>
<h4 data-id="heading-10">æ€»ç»“</h4>
<p>WeakMapÂ çš„æ ¸å¿ƒä½œç”¨æ˜¯<strong>åœ¨ä¸å½±å“å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„å‰æä¸‹ï¼Œå°†æ•°æ®ä¸è¯¥å¯¹è±¡è¿›è¡Œå…³è”</strong>ã€‚</p>
<h2 data-id="heading-11">âœ… WeakMap çš„ key å¯ä»¥æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>ğŸ‘‡ è¿™äº›éƒ½æ˜¯åˆæ³•çš„ keyï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">const</span> wm = <span class="hljs-keyword">new</span> WeakMap();

wm.<span class="hljs-keyword">set</span>({}, <span class="hljs-string">'obj'</span>);          <span class="hljs-comment">// æ™®é€šå¯¹è±¡</span>
wm.<span class="hljs-keyword">set</span>([], <span class="hljs-string">'array'</span>);        <span class="hljs-comment">// æ•°ç»„</span>
wm.<span class="hljs-keyword">set</span>(() =&gt; {}, <span class="hljs-string">'fn'</span>);     <span class="hljs-comment">// å‡½æ•°</span>
wm.<span class="hljs-keyword">set</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Map</span>(), <span class="hljs-string">'map'</span>);   <span class="hljs-comment">// Map</span>
wm.<span class="hljs-keyword">set</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Set</span>(), <span class="hljs-string">'set'</span>);   <span class="hljs-comment">// Set</span>
wm.<span class="hljs-keyword">set</span>(<span class="hljs-built_in">document</span>.body, <span class="hljs-string">'dom'</span>); <span class="hljs-comment">// DOM èŠ‚ç‚¹</span>
wm.<span class="hljs-keyword">set</span>(<span class="hljs-keyword">new</span> Number(<span class="hljs-number">1</span>), <span class="hljs-string">'wrapped number'</span>); <span class="hljs-comment">// åŒ…è£…å¯¹è±¡</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[äº†è§£å“åº”å¼Webè®¾è®¡ï¼šviewportç½‘é¡µå¯è§†åŒºåŸŸ]]></title>    <link>https://juejin.cn/post/7572459757106888758</link>    <guid>https://juejin.cn/post/7572459757106888758</guid>    <pubDate>2025-11-15T06:36:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572459757106888758" data-draft-id="7572405211442053163" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="äº†è§£å“åº”å¼Webè®¾è®¡ï¼šviewportç½‘é¡µå¯è§†åŒºåŸŸ"/> <meta itemprop="keywords" content="å‰ç«¯,HTML"/> <meta itemprop="datePublished" content="2025-11-15T06:36:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BBBåŠªåŠ›å­¦ä¹ ç¨‹åºè®¾è®¡"/> <meta itemprop="url" content="https://juejin.cn/user/3097787706900985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            äº†è§£å“åº”å¼Webè®¾è®¡ï¼šviewportç½‘é¡µå¯è§†åŒºåŸŸ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097787706900985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BBBåŠªåŠ›å­¦ä¹ ç¨‹åºè®¾è®¡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T06:36:39.000Z" title="Sat Nov 15 2025 06:36:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#444;background-image:linear-gradient(90deg,rgba(59,59,59,.1) 3%,transparent 0),linear-gradient(1turn,rgba(122,120,121,.1) 3%,transparent 0);background-size:30px 30px;background-position:50%;letter-spacing:1px;word-spacing:1px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;margin-top:34px;margin-bottom:16px;font-weight:700;line-height:1.3;cursor:text;color:#444;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body h1{font-size:41px;margin-bottom:34px;line-height:1.5}.markdown-body h1:before{content:""}.markdown-body h2{font-size:30px;padding-left:.4em;border-left:.4em solid #5e5e5e;border-bottom:1px solid #444}.markdown-body h2:after{content:"ğŸ•›";position:absolute;top:0;right:0;transition:all;animation:rotate 10s linear infinite}@keyframes rotate{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.markdown-body h3{border-left:.4em solid #8d8d8d;font-size:24px;padding-left:.4em}.markdown-body h4{font-size:20px}.markdown-body h5{font-size:16px}.markdown-body h6{font-size:14px}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body table,.markdown-body ul{margin:.8em 0}.markdown-body strong{font-weight:1000;position:relative;color:#444;padding:0 3px}.markdown-body em{font-weight:inherit}.markdown-body a{box-sizing:border-box;color:grey;position:relative}.markdown-body a:before{position:absolute;box-sizing:border-box;content:"Go -&gt;";left:0;width:100%;max-width:0;color:#fff;background-color:hsla(0,0%,50.2%,.8);white-space:nowrap;transition:.2s ease;pointer-events:none;overflow:hidden}.markdown-body a:after{content:"";position:absolute;bottom:0;left:0;width:100%;height:1px;background-color:grey}.markdown-body a:active:before,.markdown-body a:hover:before{max-width:100%;padding-left:8px;border-radius:5px}.markdown-body hr{position:relative;width:100%;height:1px;border:none;margin-top:36px;margin-bottom:36px;background:linear-gradient(90deg,grey,#f1f1f1,#444,#444,#f1f1f1,grey);overflow:visible}.markdown-body ol,.markdown-body ul{padding-left:32px}.markdown-body ol li,.markdown-body ul li{margin-bottom:6px;list-style:inherit}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol{counter-reset:my-counter}.markdown-body ol&gt;li{padding-left:6px;list-style:none;counter-increment:my-counter;position:relative}.markdown-body ol&gt;li:before{position:absolute;left:-1.5em;content:counter(my-counter);font-weight:700}.markdown-body ol&gt;li:first-child:before{content:"1ï¸âƒ£"}.markdown-body ol&gt;li:nth-child(2):before{content:"2ï¸âƒ£"}.markdown-body ol&gt;li:nth-child(3):before{content:"3ï¸âƒ£"}.markdown-body ol&gt;li:nth-child(4):before{content:"4ï¸âƒ£"}.markdown-body ol&gt;li:nth-child(5):before{content:"5ï¸âƒ£"}.markdown-body ol&gt;li:nth-child(6):before{content:"6ï¸âƒ£"}.markdown-body ol&gt;li:nth-child(7):before{content:"7ï¸âƒ£"}.markdown-body ol&gt;li:nth-child(8):before{content:"8ï¸âƒ£"}.markdown-body ol&gt;li:nth-child(9):before{content:"9ï¸âƒ£"}.markdown-body ol&gt;li:nth-child(10):before{content:"ğŸ”Ÿ"}.markdown-body ul&gt;li{list-style:none;position:relative}.markdown-body ul&gt;li:before{z-index:10;position:absolute;left:-1.57em;content:"ğŸ”¹";margin-right:12px}.markdown-body ul&gt;li input{margin-left:8px!important}.markdown-body blockquote{position:relative;background-color:#d3d3d3;padding:5px 10px;border-left:.2em solid #000;border-radius:3px;transition:all .8s ease}.markdown-body blockquote:hover{opacity:.7}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(69,69,77,.8);color:#fff;font-size:.87em;padding:.07em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:7px;overflow:hidden}.markdown-body pre:before{z-index:10;position:absolute;top:14px;left:14px;width:12px;height:12px;border-radius:50%;background:#fc625d;-webkit-box-shadow:20px 0 #fdbc40,40px 0 #35cd4b;box-shadow:20px 0 #fdbc40,40px 0 #35cd4b;content:" "}.markdown-body pre:after{z-index:9;content:"";position:absolute;width:100%;height:40px;top:0;background-color:#1a1a1a}.markdown-body pre&gt;code{display:block;font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#171717;color:#bababa;font-size:14px;padding:40px 20px 20px}.markdown-body del{color:grey}.markdown-body table{margin-bottom:1.25rem;border-collapse:collapse}.markdown-body table td,.markdown-body table th{margin:0;padding:8px;line-height:20px;vertical-align:middle;border:1px solid #ddd}.markdown-body table thead,.markdown-body table tr:nth-child(2n){background-color:#fcfcfc}.markdown-body table thead th,.markdown-body table tr:nth-child(2n) th{font-weight:700;vertical-align:middle;color:#444}.markdown-body table tbody tr td{font-weight:400;color:#444}.markdown-body table tbody tr:hover{background-color:#d3d3d3}.markdown-body table tbody tr:hover td{color:#fff}.markdown-body img{max-width:100%;margin:0 12px}@media (max-width:720px){.markdown-body h1{font-size:32.8px}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:19.2px}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:12.8px}}</style><style data-highlight="" data-highlight-key="hybrid">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1d1f21}.hljs::selection,.hljs span::selection{background:#373b41}.hljs::-moz-selection,.hljs span::-moz-selection{background:#373b41}.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#c5c8c6}.hljs-name,.hljs-title{color:#f0c674}.hljs-comment,.hljs-meta,.hljs-meta .hljs-keyword{color:#707880}.hljs-deletion,.hljs-link,.hljs-literal,.hljs-number,.hljs-symbol{color:#c66}.hljs-addition,.hljs-doctag,.hljs-regexp,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string{color:#b5bd68}.hljs-attribute,.hljs-code,.hljs-selector-id{color:#b294bb}.hljs-bullet,.hljs-keyword,.hljs-selector-tag,.hljs-tag{color:#81a2be}.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-variable{color:#8abeb7}.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-selector-class,.hljs-type{color:#de935f}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ç§»åŠ¨è®¾å¤‡æ™®åŠçš„ä»Šå¤©ï¼Œæˆ‘ä»¬è®¿é—®åŒä¸€ä¸ªç½‘é¡µæ—¶ï¼Œå¯èƒ½ä¼šåœ¨æ‰‹æœºã€å¹³æ¿ã€ç¬”è®°æœ¬ç”µè„‘ç­‰ä¸åŒå°ºå¯¸çš„è®¾å¤‡ä¸Šè·å¾—æˆªç„¶ä¸åŒçš„æµè§ˆä½“éªŒã€‚è¿™èƒŒåç¦»ä¸å¼€ä¸¤ä¸ªå…³é”®æŠ€æœ¯ï¼šå“åº”å¼Webè®¾è®¡å’Œviewportå¯è§†åŒºåŸŸæ§åˆ¶ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨è¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œå¸®åŠ©ä½ æ„å»ºçœŸæ­£é€‚é…å¤šè®¾å¤‡çš„ç°ä»£ç½‘é¡µã€‚</p>
<h2 data-id="heading-0">å“åº”å¼Webè®¾è®¡</h2>
<p>å“åº”å¼Webè®¾è®¡(Responsive Web Design)æ˜¯ä¸€ç§ç½‘é¡µè®¾è®¡æ–¹æ³•ï¼Œä½¿ç½‘ç«™èƒ½å¤Ÿå“åº”ä¸åŒè®¾å¤‡çš„å±å¹•å°ºå¯¸ã€æ–¹å‘å’Œåˆ†è¾¨ç‡ï¼Œè‡ªåŠ¨è°ƒæ•´å¸ƒå±€å’Œå†…å®¹å‘ˆç°æ–¹å¼ï¼Œä»¥æä¾›æœ€ä½³çš„ç”¨æˆ·ä½“éªŒã€‚</p>
<h2 data-id="heading-1">Viewportï¼šç½‘é¡µçš„å¯è§†åŒºåŸŸ</h2>
<h3 data-id="heading-2">æ¦‚å¿µ</h3>
<p>Viewportï¼ˆè§†å£ï¼‰æ˜¯æŒ‡ç”¨æˆ·åœ¨ç½‘é¡µä¸Šå¯è§çš„åŒºåŸŸã€‚åœ¨æ¡Œé¢æµè§ˆå™¨ä¸­ï¼Œviewportå°±æ˜¯æµè§ˆå™¨çª—å£çš„å¯è§åŒºåŸŸã€‚ä½†åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šï¼Œæƒ…å†µå°±å¤æ‚å¾—å¤šã€‚</p>
<h3 data-id="heading-3">ç§»åŠ¨è®¾å¤‡åˆ†ç±»</h3>
<ul>
<li>å¸ƒå±€viewportï¼šç½‘é¡µå®é™…æ¸²æŸ“çš„åŒºåŸŸ</li>
<li>å¯è§†viewportï¼šç”¨æˆ·åœ¨å±å¹•ä¸Šçœ‹åˆ°çš„åŒºåŸŸ</li>
</ul>
<h2 data-id="heading-4">ï¼ï¼æ³¨æ„ï¼š</h2>
<p>åœ¨æ²¡æœ‰è®¾ç½®viewportçš„æƒ…å†µä¸‹ï¼Œç§»åŠ¨æµè§ˆå™¨ä¼šé»˜è®¤ä½¿ç”¨ä¸€ä¸ªè¾ƒå®½çš„å¸ƒå±€viewportï¼ˆé€šå¸¸çº¦980pxï¼‰ï¼Œç„¶åå°†æ•´ä¸ªç½‘é¡µç¼©æ”¾è‡³å±å¹•å®½åº¦ï¼Œå¯¼è‡´æ–‡å­—è¿‡å°ï¼Œç”¨æˆ·éœ€è¦ç¼©æ”¾æ‰èƒ½é˜…è¯»ã€‚</p>
<h2 data-id="heading-5">Viewportå…ƒæ ‡ç­¾</h2>
<p>ä¸ºäº†è§£å†³ç§»åŠ¨è®¾å¤‡ä¸Šçš„æ˜¾ç¤ºé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨viewportå…ƒæ ‡ç­¾ï¼š</p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Viewportç¤ºä¾‹<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- é¡µé¢å†…å®¹ --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h2 data-id="heading-6">Viewportå±æ€§è¯¦è§£</h2>
<p>viewportå…ƒæ ‡ç­¾çš„<code>content</code>å±æ€§å¯ä»¥åŒ…å«å¤šä¸ªå€¼ï¼Œç”¨é€—å·åˆ†éš”ï¼š</p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"</span>&gt;</span>
</code></pre>
<h2 data-id="heading-7">å¸¸ç”¨å±æ€§è¯´æ˜</h2>























































<table><thead><tr><th>å±æ€§</th><th>å–å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>width</code></td><td><code>device-width</code></td><td>è®¾å¤‡å®½åº¦ï¼ˆæ¨èï¼‰</td></tr><tr><td/><td>å…·ä½“åƒç´ å€¼</td><td>å¦‚ <code>width</code>=600</td></tr><tr><td><code>height</code></td><td><code>device-height</code></td><td>è®¾å¤‡é«˜åº¦</td></tr><tr><td/><td>å…·ä½“åƒç´ å€¼</td><td>è®¾ç½®å¸ƒå±€è§†å£çš„é«˜åº¦ï¼ˆå¾ˆå°‘ä½¿ç”¨ï¼‰</td></tr><tr><td><code>initial-scale</code></td><td>æ•°å€¼</td><td>åˆå§‹ç¼©æ”¾æ¯”ä¾‹ï¼Œé€šå¸¸è®¾ä¸º 1.0</td></tr><tr><td><code>minimum-scale </code></td><td>æ•°å€¼</td><td>å…è®¸çš„æœ€å°ç¼©æ”¾æ¯”ä¾‹</td></tr><tr><td><code>maximum-scale</code></td><td>æ•°å€¼</td><td>å…è®¸çš„æœ€å¤§ç¼©æ”¾æ¯”ä¾‹</td></tr><tr><td><code> user-scalable</code></td><td><code>yes</code></td><td>å…è®¸ç¼©æ”¾</td></tr><tr><td/><td><code>no</code></td><td>ç¦æ­¢ç¼©æ”¾</td></tr></tbody></table>
<h2 data-id="heading-8">å®é™…åº”ç”¨ç¤ºä¾‹</h2>
<h3 data-id="heading-9">ç¤ºä¾‹1ï¼šåŸºç¡€Viewportè®¾ç½®</h3>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>åŸºç¡€Viewportè®¾ç½®<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">body</span> {
            <span class="hljs-attribute">font-family</span>: Arial, sans-serif;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.6</span>;
        }
        
        <span class="hljs-selector-class">.container</span> {
            <span class="hljs-attribute">max-width</span>: <span class="hljs-number">100%</span>;
        }
        
        <span class="hljs-selector-tag">h1</span> {
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
            <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">2px</span> solid <span class="hljs-number">#3498db</span>;
            <span class="hljs-attribute">padding-bottom</span>: <span class="hljs-number">10px</span>;
        }
        
        <span class="hljs-selector-class">.box</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#f9f9f9</span>;
            <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">10px</span> <span class="hljs-number">0</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;
        }
        
        <span class="hljs-keyword">@media</span> (<span class="hljs-attribute">min-width</span>: <span class="hljs-number">768px</span>) {
            <span class="hljs-selector-class">.container</span> {
                <span class="hljs-attribute">max-width</span>: <span class="hljs-number">750px</span>;
                <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
            }
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Viewportè®¾ç½®ç¤ºä¾‹<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>è¿™ä¸ªé¡µé¢æ­£ç¡®è®¾ç½®äº†Viewport<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šï¼Œè¿™ä¸ªé¡µé¢çš„æ–‡å­—å¤§å°åˆé€‚ï¼Œå¸ƒå±€æ­£å¸¸ï¼Œæ— éœ€ç”¨æˆ·ç¼©æ”¾ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>å°è¯•åœ¨æ‰‹æœºå’Œå¹³æ¿ä¸ŠæŸ¥çœ‹æ­¤é¡µé¢ï¼Œä½“éªŒæ­£ç¡®çš„æ˜¾ç¤ºæ•ˆæœã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Viewportçš„ä½œç”¨<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Viewportå…ƒæ ‡ç­¾å‘Šè¯‰æµè§ˆå™¨å¦‚ä½•æ§åˆ¶é¡µé¢çš„å°ºå¯¸å’Œç¼©æ”¾æ¯”ä¾‹ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>æ²¡æœ‰æ­£ç¡®è®¾ç½®viewportçš„ç½‘é¡µåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šä¼šæ˜¾ç¤ºä¸ºç¼©å°çš„æ¡Œé¢ç‰ˆæœ¬ï¼Œç”¨æˆ·éœ€è¦æ‰‹åŠ¨ç¼©æ”¾æ‰èƒ½é˜…è¯»å†…å®¹ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å¦‚ä½•æ£€æµ‹å½“å‰Viewport<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>è§†å£å®½åº¦: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"viewportWidth"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>px<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>è®¾å¤‡åƒç´ æ¯”: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"devicePixelRatio"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>å±å¹•å®½åº¦: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"screenWidth"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>px<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// æ˜¾ç¤ºå½“å‰è§†å£ä¿¡æ¯</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'viewportWidth'</span>).<span class="hljs-property">textContent</span> = 
            <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">clientWidth</span> || <span class="hljs-number">0</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> || <span class="hljs-number">0</span>);
        
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'devicePixelRatio'</span>).<span class="hljs-property">textContent</span> = 
            <span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>;
            
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'screenWidth'</span>).<span class="hljs-property">textContent</span> = 
            screen.<span class="hljs-property">width</span>;
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-10">ç¤ºä¾‹2ï¼šViewportè®¾ç½®å¯¹æ¯”</h3>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- è¿™ä¸ªé¡µé¢æ•…æ„ä¸è®¾ç½®viewportï¼Œç”¨äºå±•ç¤ºé—®é¢˜ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>æ— Viewportè®¾ç½®çš„é—®é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">body</span> {
            <span class="hljs-attribute">font-family</span>: Arial, sans-serif;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">980px</span>; <span class="hljs-comment">/* æ¨¡æ‹Ÿæ¡Œé¢ç‰ˆç½‘ç«™å®½åº¦ */</span>
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.6</span>;
        }
        
        <span class="hljs-selector-tag">h1</span> {
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">24px</span>;
        }
        
        <span class="hljs-selector-tag">p</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">15px</span>;
        }
        
        <span class="hljs-selector-class">.warning</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff3cd</span>;
            <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ffeaa7</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#856404</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">20px</span> <span class="hljs-number">0</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"warning"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>æ³¨æ„ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>è¿™ä¸ªé¡µé¢æ²¡æœ‰è®¾ç½®viewportï¼Œåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šä¼šæ˜¾ç¤ºä¸ºç¼©å°çš„æ¡Œé¢ç‰ˆæœ¬ã€‚
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æœªè®¾ç½®Viewportçš„ç½‘é¡µç¤ºä¾‹<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>è¿™ä¸ªé¡µé¢æ¨¡æ‹Ÿäº†æ²¡æœ‰è®¾ç½®viewportçš„æ¡Œé¢ç‰ˆç½‘ç«™ã€‚åœ¨ç§»åŠ¨è®¾å¤‡ä¸ŠæŸ¥çœ‹æ—¶ï¼Œä½ ä¼šå‘ç°ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>æ•´ä¸ªé¡µé¢è¢«ç¼©å°ä»¥é€‚åº”å±å¹•å®½åº¦<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>æ–‡å­—å¤ªå°ï¼Œéœ€è¦æ”¾å¤§æ‰èƒ½é˜…è¯»<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>éœ€è¦æ°´å¹³æ»šåŠ¨æ‰èƒ½çœ‹åˆ°å…¨éƒ¨å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>ç”¨æˆ·ä½“éªŒå¾ˆå·®<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç°ä»£ç½‘é¡µå¼€å‘å¿…é¡»è®¾ç½®viewportçš„åŸå› ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å¦‚ä½•ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Ÿ<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>åªéœ€åœ¨HTMLçš„<span class="hljs-symbol">&amp;lt;</span>head<span class="hljs-symbol">&amp;gt;</span>éƒ¨åˆ†æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">pre</span>&gt;</span><span class="hljs-symbol">&amp;lt;</span>meta name="viewport" content="width=device-width, initial-scale=1.0"<span class="hljs-symbol">&amp;gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">pre</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>æ·»åŠ è¿™è¡Œä»£ç åï¼Œç½‘é¡µåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå°±ä¼šæ­£å¸¸æ˜¾ç¤ºï¼Œæ–‡å­—å¤§å°åˆé€‚ï¼Œå¸ƒå±€è‡ªé€‚åº”å±å¹•å®½åº¦ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-11">ç¤ºä¾‹3ï¼šä¸åŒViewportè®¾ç½®çš„æ•ˆæœ</h3>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Viewportè®¾ç½®æ¯”è¾ƒ<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        * {
            <span class="hljs-attribute">box-sizing</span>: border-box;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
        }
        
        <span class="hljs-selector-tag">body</span> {
            <span class="hljs-attribute">font-family</span>: Arial, sans-serif;
            <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.6</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
        }
        
        <span class="hljs-selector-class">.container</span> {
            <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1000px</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
        }
        
        <span class="hljs-selector-tag">h1</span> {
            <span class="hljs-attribute">text-align</span>: center;
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">30px</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#2c3e50</span>;
        }
        
        <span class="hljs-selector-class">.comparison</span> {
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">flex-wrap</span>: wrap;
            <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">30px</span>;
        }
        
        <span class="hljs-selector-class">.example</span> {
            <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
            <span class="hljs-attribute">min-width</span>: <span class="hljs-number">300px</span>;
            <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
            <span class="hljs-attribute">overflow</span>: hidden;
        }
        
        <span class="hljs-selector-class">.example-header</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#3498db</span>;
            <span class="hljs-attribute">color</span>: white;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>;
            <span class="hljs-attribute">text-align</span>: center;
        }
        
        <span class="hljs-selector-class">.example-content</span> {
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
        }
        
        <span class="hljs-selector-tag">code</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#f8f9fa</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">2px</span> <span class="hljs-number">6px</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">3px</span>;
            <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Courier New'</span>, monospace;
        }
        
        <span class="hljs-selector-class">.note</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#e8f4fd</span>;
            <span class="hljs-attribute">border-left</span>: <span class="hljs-number">4px</span> solid <span class="hljs-number">#3498db</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">20px</span> <span class="hljs-number">0</span>;
        }
        
        <span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
            <span class="hljs-selector-class">.comparison</span> {
                <span class="hljs-attribute">flex-direction</span>: column;
            }
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>ä¸åŒViewportè®¾ç½®çš„æ•ˆæœæ¯”è¾ƒ<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"note"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>è¿™ä¸ªé¡µé¢å±•ç¤ºäº†ä¸åŒviewportè®¾ç½®å¯¹ç½‘é¡µåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ˜¾ç¤ºçš„å½±å“ã€‚è¯·å°è¯•åœ¨ç§»åŠ¨è®¾å¤‡ä¸ŠæŸ¥çœ‹æ­¤é¡µé¢ï¼Œæˆ–ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·æ¨¡æ‹Ÿç§»åŠ¨è®¾å¤‡ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"comparison"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"example"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"example-header"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>æ¨èè®¾ç½®<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"example-content"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>Viewportä»£ç ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">pre</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span><span class="hljs-symbol">&amp;lt;</span>meta name="viewport" content="width=device-width, initial-scale=1.0"<span class="hljs-symbol">&amp;gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">pre</span>&gt;</span>
                    
                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>æ•ˆæœï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>å¸ƒå±€è§†å£å®½åº¦ç­‰äºè®¾å¤‡å®½åº¦<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>åˆå§‹ç¼©æ”¾æ¯”ä¾‹ä¸º1.0<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>å…è®¸ç”¨æˆ·æ‰‹åŠ¨ç¼©æ”¾<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>é€‚åˆå¤§å¤šæ•°å“åº”å¼ç½‘ç«™<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"example"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"example-header"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å›ºå®šå®½åº¦<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"example-content"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>Viewportä»£ç ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">pre</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span><span class="hljs-symbol">&amp;lt;</span>meta name="viewport" content="width=600, initial-scale=1.0"<span class="hljs-symbol">&amp;gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">pre</span>&gt;</span>
                    
                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>æ•ˆæœï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>å¸ƒå±€è§†å£å®½åº¦å›ºå®šä¸º600px<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>åœ¨å°å±å¹•ä¸Šå¯èƒ½éœ€è¦æ°´å¹³æ»šåŠ¨<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>é€‚åˆéœ€è¦å›ºå®šå®½åº¦çš„ç‰¹æ®Šåœºæ™¯<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"example"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"example-header"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>ç¦æ­¢ç¼©æ”¾<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"example-content"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>Viewportä»£ç ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">pre</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span><span class="hljs-symbol">&amp;lt;</span>meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"<span class="hljs-symbol">&amp;gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">pre</span>&gt;</span>
                    
                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>æ•ˆæœï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>ç¦æ­¢ç”¨æˆ·ç¼©æ”¾é¡µé¢<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>å¯èƒ½å½±å“å¯è®¿é—®æ€§<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>ä»…åœ¨æŸäº›ç‰¹æ®Šåº”ç”¨ä¸­ä½¿ç”¨<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"note"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>æç¤ºï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ¨èçš„è®¾ç½®å³å¯ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span><span class="hljs-symbol">&amp;lt;</span>meta name="viewport" content="width=device-width, initial-scale=1.0"<span class="hljs-symbol">&amp;gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h2 data-id="heading-12">æ€»ç»“</h2>
<ul>
<li>Viewportå…ƒæ ‡ç­¾æ§åˆ¶ç½‘é¡µåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šçš„å¸ƒå±€è§†å£å’Œç¼©æ”¾è¡Œä¸º</li>
<li>æ²¡æœ‰æ­£ç¡®è®¾ç½®viewportçš„ç½‘é¡µåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šä½“éªŒå¾ˆå·®</li>
<li>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½¿ç”¨<code>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</code>æ˜¯æœ€ä½³é€‰æ‹©</li>
<li>è°¨æ…é™åˆ¶ç”¨æˆ·ç¼©æ”¾åŠŸèƒ½ï¼Œä»¥å…å½±å“å¯è®¿é—®æ€§</li>
<li>Viewportè®¾ç½®éœ€è¦ä¸å®é™…å†…å®¹å’Œå“åº”å¼è®¾è®¡ç»“åˆä½¿ç”¨</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åªæœ‰å‰ç«¯ Leader æ‰ä¼šå‘Šè¯‰ä½ ï¼šé‚£äº›å¹´è¸©è¿‡çš„æ¨¡å—åŠ è½½å¤±è´¥çš„å‘]]></title>    <link>https://juejin.cn/post/7572524368876126243</link>    <guid>https://juejin.cn/post/7572524368876126243</guid>    <pubDate>2025-11-15T05:28:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572524368876126243" data-draft-id="7572453554331156480" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åªæœ‰å‰ç«¯ Leader æ‰ä¼šå‘Šè¯‰ä½ ï¼šé‚£äº›å¹´è¸©è¿‡çš„æ¨¡å—åŠ è½½å¤±è´¥çš„å‘"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-11-15T05:28:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¹Ÿæ— é£é›¨ä¹Ÿé›¾æ™´"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åªæœ‰å‰ç«¯ Leader æ‰ä¼šå‘Šè¯‰ä½ ï¼šé‚£äº›å¹´è¸©è¿‡çš„æ¨¡å—åŠ è½½å¤±è´¥çš„å‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¹Ÿæ— é£é›¨ä¹Ÿé›¾æ™´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T05:28:19.000Z" title="Sat Nov 15 2025 05:28:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰ç«¯éƒ¨ç½²åæ¨¡å—åŠ è½½ 404ï¼šä»å´©æºƒåˆ°è‡ªåŠ¨æ¢å¤çš„è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-1">æµ‹è¯•æ—¶å‘ç°çš„è¯¡å¼‚é—®é¢˜</h3>
<p>æœ€è¿‘åœ¨å¼€å‘ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œç”¨çš„ Vite + React æŠ€æœ¯æ ˆï¼Œå¼€å‘ä½“éªŒæŒºä¸é”™ã€‚æµ‹è¯•é˜¶æ®µå´å‘ç°äº†ä¸€ä¸ªè¯¡å¼‚çš„é—®é¢˜ã€‚</p>
<p>æµ‹è¯•åŒå­¦åé¦ˆï¼šç‚¹å‡»æŸä¸ªåŠŸèƒ½æ¨¡å—æ—¶ï¼Œé¡µé¢ç›´æ¥ç™½å±äº†ã€‚æ‰“å¼€æ§åˆ¶å°ä¸€çœ‹ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">Failed <span class="hljs-keyword">to</span> <span class="hljs-keyword">fetch</span> dynamically imported <span class="hljs-keyword">module</span>: <span class="hljs-operator">/</span>assets<span class="hljs-operator">/</span>chat<span class="hljs-operator">-</span>abc123.js
<span class="hljs-keyword">GET</span> <span class="hljs-operator">/</span>assets<span class="hljs-operator">/</span>chat<span class="hljs-operator">-</span>abc123.js <span class="hljs-number">404</span> <span class="hljs-keyword">Not</span> Found
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1f1758465da4b53bad010364c3529ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763789391&amp;x-signature=b9w2P5lUov1SZRjP6KDepf0XAkg%3D" alt="image.png" loading="lazy"/></p>
<p>ç”¨æˆ·åˆ·æ–°é¡µé¢å°±åˆå¥½äº†ã€‚ä½†é—®é¢˜æ˜¯â€”â€”ç”¨æˆ·ä¸è¯¥çœ‹åˆ°è¿™ä¸ªé”™è¯¯é¡µé¢ã€‚</p>
<p>å‡ ä¸ªç–‘é—®ç«‹åˆ»å†’å‡ºæ¥ï¼š</p>
<ul>
<li>ä¸ºå•¥å¥½ç«¯ç«¯çš„ JS æ–‡ä»¶ä¼š 404ï¼Ÿ</li>
<li>ä¸ºå•¥ç”¨æˆ·åˆ·æ–°å°±å¥½äº†ï¼Ÿ</li>
<li>è¿™é—®é¢˜æ˜¯å¶å‘è¿˜æ˜¯å¿…ç°ï¼Ÿ</li>
<li>æ€ä¹ˆè®©ç”¨æˆ·æ— æ„ŸçŸ¥åœ°è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</li>
</ul>
<h3 data-id="heading-2">é—®é¢˜å¤ç›˜ï¼šä¸ºä»€ä¹ˆä¼š 404ï¼Ÿ</h3>
<p>æ‹äº†ä¸‹æ—¶é—´çº¿ï¼Œé—®é¢˜åŸå› å°±æ¸…æ™°äº†ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant U as ç”¨æˆ·æµè§ˆå™¨
    participant S as æœåŠ¡å™¨
    participant CI as CI/CD

    U-&gt;&gt;S: 10:00 æ‰“å¼€é¡µé¢
    S-&gt;&gt;U: è¿”å› index.html (å¼•ç”¨ chat.abc123.js)
    Note over U: ç”¨æˆ·ä¿æŒé¡µé¢æ‰“å¼€
    
    CI-&gt;&gt;S: 14:30 éƒ¨ç½²æ–°ç‰ˆæœ¬
    Note over S: chat.abc123.js â†’ chat.def456.js
    
    U-&gt;&gt;S: 15:00 ç‚¹å‡»èŠå¤©æŒ‰é’®
    U-&gt;&gt;S: è¯·æ±‚ chat.abc123.js
    S-&gt;&gt;U: 404 Not Found âŒ
    Note over U: é¡µé¢å´©æºƒ
</code></pre>
<p>è¯´ç™½äº†å°±æ˜¯ï¼š<strong>ç”¨æˆ·æµè§ˆå™¨é‡Œçš„ index.html æ˜¯æ—§çš„ï¼Œä½†æœåŠ¡å™¨ä¸Šçš„ JS æ–‡ä»¶å·²ç»æ˜¯æ–°çš„äº†</strong>ã€‚</p>
<p>è¿™é—®é¢˜åªåœ¨ä¸‰ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³æ—¶æ‰ä¼šå‡ºç°ï¼š</p>
<ol>
<li>ç”¨æˆ·é•¿æ—¶é—´ä¸åˆ·æ–°é¡µé¢ï¼ˆä¿æŒæ—§ç‰ˆ HTMLï¼‰</li>
<li>åç«¯éƒ¨ç½²äº†æ–°ç‰ˆæœ¬ï¼ˆæ—§ chunk è¢«æ›¿æ¢ï¼‰</li>
<li>ç”¨æˆ·è§¦å‘æ‡’åŠ è½½ï¼ˆåŠ¨æ€ import æ–°æ¨¡å—ï¼‰</li>
</ol>
<p>å¦‚æœé¡¹ç›®æ²¡ç”¨ä»£ç åˆ†å‰²ï¼Œæ‰€æœ‰ JS éƒ½åœ¨é¦–æ¬¡åŠ è½½ï¼Œåè€Œä¸ä¼šæœ‰è¿™é—®é¢˜ã€‚ä½†ä¸ºäº†æ€§èƒ½åšäº†æ‡’åŠ è½½ï¼Œç»“æœè¸©äº†è¿™ä¸ªå‘ã€‚</p>
<h3 data-id="heading-3">è§£å†³æ€è·¯ï¼šè‡ªåŠ¨åˆ·æ–° + å…œåº•æç¤º</h3>
<p>æƒ³äº†å‡ ç§æ–¹æ¡ˆï¼š</p>

























<table><thead><tr><th>æ–¹æ¡ˆ</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td><strong>ä¿ç•™æ—§ç‰ˆæœ¬æ–‡ä»¶</strong></td><td>å½»åº•é¿å… 404</td><td>éœ€è¦æ”¹é€ éƒ¨ç½²æµç¨‹ï¼Œæ¸…ç†ç­–ç•¥å¤æ‚</td></tr><tr><td><strong>ç‰ˆæœ¬æ£€æµ‹è½®è¯¢</strong></td><td>å¯ä»¥ä¸»åŠ¨é€šçŸ¥ç”¨æˆ·</td><td>å¢åŠ æœåŠ¡å™¨å‹åŠ›ï¼Œä½“éªŒä¸€èˆ¬</td></tr><tr><td><strong>æ•è·é”™è¯¯è‡ªåŠ¨åˆ·æ–°</strong></td><td>å®ç°ç®€å•ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥</td><td>éœ€è¦é˜²æ­¢æ— é™åˆ·æ–°</td></tr></tbody></table>
<p>æœ€åé€‰äº†ç¬¬ä¸‰ç§â€”â€”ç®€å•æœ‰æ•ˆï¼Œæ”¹åŠ¨æœ€å°ã€‚</p>
<p>æ ¸å¿ƒé€»è¾‘å¾ˆç®€å•ï¼š</p>
<ol>
<li>æ£€æµ‹åˆ°æ¨¡å—åŠ è½½å¤±è´¥ â†’ è‡ªåŠ¨åˆ·æ–°é¡µé¢</li>
<li>åˆ·æ–°åè¿˜å¤±è´¥ â†’ æ˜¾ç¤ºå‹å¥½é”™è¯¯æç¤º</li>
<li>ç”¨ sessionStorage é˜²æ­¢æ— é™åˆ·æ–°</li>
</ol>
<h3 data-id="heading-4">å…·ä½“å®ç°</h3>
<h4 data-id="heading-5">1. åˆ›å»ºé”™è¯¯å¤„ç†å·¥å…·å‡½æ•°</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/utils/moduleLoadErrorHandler.ts</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">RELOAD_FLAG_KEY</span> = <span class="hljs-string">'module_error_reloaded'</span>;

<span class="hljs-comment">// æ£€æµ‹æ˜¯ä¸æ˜¯æ¨¡å—åŠ è½½é”™è¯¯</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">isModuleLoadError</span>(<span class="hljs-params">error: <span class="hljs-built_in">Error</span> | <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-keyword">const</span> message = <span class="hljs-keyword">typeof</span> error === <span class="hljs-string">'string'</span> ? error : error.<span class="hljs-property">message</span> || <span class="hljs-string">''</span>;
  
  <span class="hljs-keyword">return</span> (
    <span class="hljs-comment">// å„ç§æ¨¡å—åŠ è½½é”™è¯¯çš„ç‰¹å¾</span>
    message.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'Failed to fetch dynamically imported module'</span>) ||
    message.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'Loading chunk'</span>) ||
    message.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'ChunkLoadError'</span>)
  );
}

<span class="hljs-comment">// å°è¯•è‡ªåŠ¨åˆ·æ–°ï¼ˆåªåˆ·ä¸€æ¬¡ï¼‰</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">attemptModuleErrorReload</span>(<span class="hljs-params"/>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-comment">// å·²ç»åˆ·è¿‡äº†ï¼Ÿé‚£å°±åˆ«å†åˆ·äº†</span>
  <span class="hljs-keyword">if</span> (sessionStorage.<span class="hljs-title function_">getItem</span>(<span class="hljs-variable constant_">RELOAD_FLAG_KEY</span>)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'âŒ æ¨¡å—åŠ è½½æŒç»­å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¼ºåˆ· (Ctrl+F5)'</span>);
    sessionStorage.<span class="hljs-title function_">removeItem</span>(<span class="hljs-variable constant_">RELOAD_FLAG_KEY</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

  <span class="hljs-comment">// æ ‡è®°ä¸€ä¸‹ï¼Œé˜²æ­¢æ— é™åˆ·æ–°</span>
  sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-variable constant_">RELOAD_FLAG_KEY</span>, <span class="hljs-string">'1'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'âš ï¸ æ£€æµ‹åˆ°æ¨¡å—åŠ è½½å¤±è´¥ï¼Œè‡ªåŠ¨åˆ·æ–°é¡µé¢...'</span>);
  
  <span class="hljs-comment">// ç¨å¾®å»¶è¿Ÿä¸€ä¸‹ï¼Œé¿å…é¡µé¢é—ªçƒ</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-title function_">reload</span>(), <span class="hljs-number">100</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}

<span class="hljs-comment">// å…¨å±€ç›‘å¬ï¼ˆå…œåº•æœºåˆ¶ï¼‰</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">setupModuleLoadErrorHandler</span>(<span class="hljs-params"/>): <span class="hljs-built_in">void</span> {
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">event: ErrorEvent</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isModuleLoadError</span>(event.<span class="hljs-property">message</span> || <span class="hljs-string">''</span>)) {
      <span class="hljs-title function_">attemptModuleErrorReload</span>();
    }
  });

  <span class="hljs-comment">// é¡µé¢æ­£å¸¸åŠ è½½å®Œï¼Œæ¸…é™¤æ ‡è®°</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'load'</span>, <span class="hljs-function">() =&gt;</span> {
    sessionStorage.<span class="hljs-title function_">removeItem</span>(<span class="hljs-variable constant_">RELOAD_FLAG_KEY</span>);
  });
}
</code></pre>
<p>å…³é”®ç‚¹ï¼š</p>
<ul>
<li><code>sessionStorage</code> å­˜æ´»æœŸåˆšå¥½æ˜¯ä¸€ä¸ªä¼šè¯ï¼Œå…³é—­æ ‡ç­¾é¡µå°±æ¸…é™¤</li>
<li>å»¶è¿Ÿ 100ms åˆ·æ–°ï¼Œé¿å…ç”¨æˆ·çœ‹åˆ°é—ªçƒ</li>
<li>åˆ·æ–°å¤±è´¥åç»™å‡ºæ˜ç¡®çš„æ‰‹åŠ¨æ“ä½œæç¤º</li>
</ul>
<h4 data-id="heading-6">2. åœ¨ ErrorBoundary ä¸­å¤„ç†</h4>
<p>React é¡¹ç›®ä¸€èˆ¬éƒ½æœ‰ ErrorBoundaryï¼Œæ­£å¥½åœ¨è¿™é‡Œç»Ÿä¸€å¤„ç†ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// src/components/ErrorBoundary/index.tsx</span>

<span class="hljs-title function_">componentDidCatch</span>(<span class="hljs-params">error: <span class="hljs-built_in">Error</span>, errorInfo: ErrorInfo</span>) {
  <span class="hljs-comment">// æ¨¡å—åŠ è½½é”™è¯¯ï¼Ÿè‡ªåŠ¨åˆ·æ–°è¯•è¯•</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isModuleLoadError</span>(error)) {
    <span class="hljs-title function_">attemptModuleErrorReload</span>();
    <span class="hljs-keyword">return</span>; <span class="hljs-comment">// é¡µé¢é©¬ä¸Šåˆ·æ–°ï¼Œä¸æ˜¾ç¤ºé”™è¯¯ç•Œé¢</span>
  }

  <span class="hljs-comment">// å…¶ä»–é”™è¯¯æ­£å¸¸æ˜¾ç¤º</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ error, errorInfo });
}
</code></pre>
<h4 data-id="heading-7">3. åº”ç”¨å…¥å£åˆå§‹åŒ–</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/main.tsx</span>
<span class="hljs-keyword">import</span> { setupModuleLoadErrorHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/moduleLoadErrorHandler'</span>;

<span class="hljs-comment">// å°½æ—©åˆå§‹åŒ–ï¼Œæ•è·æ‰€æœ‰é”™è¯¯</span>
<span class="hljs-title function_">setupModuleLoadErrorHandler</span>();
</code></pre>
<h3 data-id="heading-8">æµ‹è¯•éªŒè¯ï¼šæ¨¡æ‹ŸçœŸå®åœºæ™¯</h3>
<h4 data-id="heading-9">æ–¹æ³•ä¸€ï¼šChrome DevTools æ‹¦æˆªè¯·æ±‚ï¼ˆæœ€ç®€å•ï¼‰</h4>
<p>è¿™ä¸ªæ–¹æ³•ä¸ç”¨æ”¹ä»£ç ï¼Œç›´æ¥åœ¨æµè§ˆå™¨é‡Œæ¨¡æ‹Ÿï¼š</p>
<ol>
<li>æ‰“å¼€ DevToolsï¼Œåˆ‡åˆ° Network æ ‡ç­¾</li>
<li>å³ä¸Šè§’ä¸‰ä¸ªç‚¹ â†’ More tools â†’ Request blocking</li>
<li>æ·»åŠ æ‹¦æˆªè§„åˆ™ï¼š<code>*page/chat*</code> æˆ– <code>*chunk*</code></li>
<li>åˆ‡æ¢è·¯ç”±è§¦å‘æ‡’åŠ è½½</li>
</ol>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[æ·»åŠ æ‹¦æˆªè§„åˆ™] --&gt; B[è§¦å‘æ‡’åŠ è½½]
    B --&gt; C{é¦–æ¬¡å¤±è´¥?}
    C --&gt;|æ˜¯| D[è‡ªåŠ¨åˆ·æ–°é¡µé¢]
    C --&gt;|å¦| E[æ˜¾ç¤ºé”™è¯¯æç¤º]
    D --&gt; F[åˆ·æ–°åé‡è¯•]
    F --&gt; E
</code></pre>
<p>çœ‹åˆ°é¡µé¢è‡ªåŠ¨åˆ·æ–°å°±è¯´æ˜æˆåŠŸäº†ã€‚ä¿æŒæ‹¦æˆªè§„åˆ™ï¼Œå†è§¦å‘ä¸€æ¬¡ï¼Œåº”è¯¥ç›´æ¥æ˜¾ç¤ºé”™è¯¯ç•Œé¢ï¼ˆä¸ä¼šæ— é™åˆ·æ–°ï¼‰ã€‚</p>
<h4 data-id="heading-10">æ–¹æ³•äºŒï¼šæ¨¡æ‹ŸçœŸå®éƒ¨ç½²</h4>
<p>æ›´æ¥è¿‘ç”Ÿäº§ç¯å¢ƒçš„æµ‹è¯•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. æ„å»ºé¡¹ç›®</span>
pnpm build

<span class="hljs-comment"># 2. å¯åŠ¨é¢„è§ˆæœåŠ¡</span>
pnpm preview

<span class="hljs-comment"># 3. æ‰“å¼€é¡µé¢ï¼Œä¸è¦åˆ·æ–°</span>

<span class="hljs-comment"># 4. åˆ é™¤æŸä¸ª chunk æ–‡ä»¶ï¼ˆæ¨¡æ‹Ÿæ–°ç‰ˆæœ¬éƒ¨ç½²ï¼‰</span>
<span class="hljs-built_in">rm</span> dist/assets/chat-*.js

<span class="hljs-comment"># 5. åœ¨é¡µé¢ä¸­ç‚¹å‡»èŠå¤©æŒ‰é’®</span>
</code></pre>
<p>åº”è¯¥çœ‹åˆ°é¡µé¢è‡ªåŠ¨åˆ·æ–°ï¼Œç„¶åæ­£å¸¸åŠ è½½ï¼ˆå¦‚æœæ–‡ä»¶è¿˜åœ¨çš„è¯ï¼‰ã€‚</p>
<h3 data-id="heading-11">ä¸Šçº¿åçš„æ•ˆæœ</h3>
<p>éƒ¨ç½²è¿™ä¸ªæ–¹æ¡ˆä¸€å‘¨äº†ï¼Œæ•ˆæœæŒºå¥½ï¼š</p>
<ul>
<li>ç”¨æˆ·åé¦ˆçš„"é¡µé¢å´©æºƒ"é—®é¢˜æ¶ˆå¤±äº†</li>
<li>ç›‘æ§æ˜¾ç¤ºæ¨¡å—åŠ è½½é”™è¯¯å‡å°‘äº† 95%</li>
<li>å‰©ä¸‹ 5% æ˜¯çœŸçš„ç½‘ç»œé—®é¢˜ï¼Œæœ‰é”™è¯¯æç¤ºå…œåº•</li>
</ul>
<p>å”¯ä¸€çš„å°é—®é¢˜ï¼šç”¨æˆ·æ­£åœ¨å¡«è¡¨å•æ—¶å¦‚æœè§¦å‘äº†è‡ªåŠ¨åˆ·æ–°ï¼Œæ•°æ®ä¼šä¸¢å¤±ã€‚ä¸è¿‡è¿™ç§æƒ…å†µå¾ˆå°‘ï¼Œåç»­å¯ä»¥è€ƒè™‘åŠ ä¸ªè¡¨å•æ•°æ®ç¼“å­˜ã€‚</p>
<h3 data-id="heading-12">Nginx é…ç½®ï¼šä»æ ¹æºé¢„é˜²é—®é¢˜</h3>
<p>å‰ç«¯çš„è‡ªåŠ¨åˆ·æ–°æ˜¯å…œåº•ï¼Œæ›´é‡è¦çš„æ˜¯ Nginx é…ç½®è¦æ­£ç¡®ã€‚</p>
<h4 data-id="heading-13">å½“å‰çš„ nginx.conf é…ç½®</h4>
<pre><code class="hljs language-nginx" lang="nginx">server {
    listen       80;
    server_name  _;

    root   /usr/share/nginx/html;
    index  index.html;

    # é™æ€èµ„æºï¼šæ‰¾ä¸åˆ°ç›´æ¥è¿”å› 404ï¼Œä¸è¿”å› index.html
    location /assets/ {
        try_files $uri =404;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # SPA è·¯ç”±ï¼šHTML å®Œå…¨ä¸ç¼“å­˜
    location / {
        try_files $uri $uri/ /index.html;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }

    # gzip å‹ç¼©
    gzip on;
    gzip_types text/plain text/css application/javascript application/json application/xml image/svg+xml;
    gzip_min_length 1024;
}
</code></pre>
<h4 data-id="heading-14">é…ç½®è¯´æ˜</h4>
<p><strong>1. <code>/assets/</code> è·¯å¾„çš„å…³é”®é…ç½®</strong></p>
<pre><code class="hljs language-nginx" lang="nginx">try_files $uri =404;
</code></pre>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šchunk æ–‡ä»¶æ‰¾ä¸åˆ°æ—¶ï¼Œç›´æ¥è¿”å› 404ï¼Œè€Œä¸æ˜¯è¿”å› index.html</li>
<li><strong>ä¸ºä»€ä¹ˆé‡è¦</strong>ï¼šå¦‚æœè¿”å› HTMLï¼Œæµè§ˆå™¨ä¼šå°è¯•æŠŠ HTML å½“ä½œ JavaScript æ‰§è¡Œï¼Œå¯¼è‡´ MIME type é”™è¯¯</li>
<li><strong>æ•ˆæœ</strong>ï¼šå‰ç«¯èƒ½æ­£ç¡®æ•è·åˆ° 404 é”™è¯¯ï¼Œè§¦å‘è‡ªåŠ¨åˆ·æ–°</li>
</ul>
<p><strong>2. index.html ä¸ç¼“å­˜</strong></p>
<pre><code class="hljs language-nginx" lang="nginx">add_header Cache-Control "no-cache, no-store, must-revalidate";
</code></pre>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šç¡®ä¿ç”¨æˆ·æ¯æ¬¡è®¿é—®/åˆ·æ–°éƒ½è·å–æœ€æ–°çš„ index.html</li>
<li><strong>ä¸ºä»€ä¹ˆé‡è¦</strong>ï¼šæ–°ç‰ˆæœ¬ HTML ä¼šå¼•ç”¨æ–°çš„ chunk æ–‡ä»¶å</li>
<li><strong>å±€é™æ€§</strong>ï¼šåªå¯¹"åˆ·æ–°é¡µé¢"æœ‰æ•ˆï¼Œå¯¹"å·²æ‰“å¼€çš„é¡µé¢"æ— æ•ˆï¼ˆè¿™å°±æ˜¯ä¸ºä»€ä¹ˆéœ€è¦å‰ç«¯è‡ªåŠ¨åˆ·æ–°ï¼‰</li>
</ul>
<p><strong>3. é™æ€èµ„æºé•¿æœŸç¼“å­˜</strong></p>
<pre><code class="hljs language-nginx" lang="nginx">expires 1y;
add_header Cache-Control "public, immutable";
</code></pre>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šå¸¦ hash çš„æ–‡ä»¶åå¯ä»¥æ°¸ä¹…ç¼“å­˜</li>
<li><strong>å¥½å¤„</strong>ï¼šå‡å°‘å¸¦å®½æ¶ˆè€—ï¼Œæå‡åŠ è½½é€Ÿåº¦</li>
<li><strong>å®‰å…¨æ€§</strong>ï¼šæ–‡ä»¶åå˜äº†å°±æ˜¯æ–°æ–‡ä»¶ï¼Œä¸ä¼šæœ‰ç¼“å­˜é—®é¢˜</li>
</ul>
<h4 data-id="heading-15">ä¸ºä»€ä¹ˆè¿™æ ·é…ç½®ï¼Ÿ</h4>
<p>è¿™ä¸ªé…ç½®å®ç°äº†<strong>åŒå±‚é˜²æŠ¤</strong>ï¼š</p>
<pre><code class="hljs language-erlang" lang="erlang">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Nginx å±‚ï¼ˆé¢„é˜² <span class="hljs-number">60</span>-<span class="hljs-number">70</span><span class="hljs-comment">%ï¼‰         â”‚</span>
â”‚  - HTML ä¸ç¼“å­˜                   â”‚
â”‚  - <span class="hljs-number">404</span> æ­£ç¡®è¿”å›                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯å±‚ï¼ˆå…œåº• <span class="hljs-number">30</span>-<span class="hljs-number">40</span><span class="hljs-comment">%ï¼‰           â”‚</span>
â”‚  - ErrorBoundary è‡ªåŠ¨åˆ·æ–°        â”‚
â”‚  - window.error ç›‘å¬             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>Nginx èƒ½è§£å†³çš„åœºæ™¯</strong>ï¼š</p>
<ul>
<li>âœ… ç”¨æˆ·åˆ·æ–°é¡µé¢ â†’ è·å–æœ€æ–° HTML</li>
<li>âœ… æ–°ç”¨æˆ·è®¿é—® â†’ è·å–æœ€æ–°ç‰ˆæœ¬</li>
<li>âœ… æ­£ç¡®çš„ 404 å“åº” â†’ å‰ç«¯èƒ½æ•è·é”™è¯¯</li>
</ul>
<p><strong>Nginx ä¸èƒ½è§£å†³çš„åœºæ™¯</strong>ï¼š</p>
<ul>
<li>âŒ ç”¨æˆ·é•¿æ—¶é—´ä¸åˆ·æ–° + è§¦å‘æ‡’åŠ è½½</li>
<li>âŒ å¤šæ ‡ç­¾é¡µæ—§ç‰ˆæœ¬é—®é¢˜</li>
</ul>
<p>è¿™äº›åœºæ™¯å°±éœ€è¦å‰ç«¯çš„è‡ªåŠ¨åˆ·æ–°æ¥å…œåº•ã€‚</p>
<h3 data-id="heading-16">æœ¬æ¬¡ä»£ç ä¿®æ”¹è¯´æ˜</h3>
<p>è¿™æ¬¡ä¿®å¤ä¸»è¦è§£å†³äº†ä¸€ä¸ªå…³é”®é—®é¢˜ï¼š<strong>çº¿ä¸Šç¯å¢ƒæ¨¡å—åŠ è½½é”™è¯¯æ²¡æœ‰è§¦å‘è‡ªåŠ¨åˆ·æ–°</strong>ã€‚</p>
<h4 data-id="heading-17">é—®é¢˜åŸå› </h4>
<p>ä¹‹å‰åªåœ¨å…¨å±€ç›‘å¬äº† <code>window.error</code> äº‹ä»¶ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-comment">// å¤„ç†æ¨¡å—åŠ è½½é”™è¯¯</span>
});
</code></pre>
<p>ä½† React çš„ <code>ErrorBoundary</code> ä¼šå…ˆæ•è·é”™è¯¯ï¼Œå¯¼è‡´é”™è¯¯æ— æ³•å†’æ³¡åˆ° <code>window.error</code>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">React<span class="hljs-selector-class">.lazy</span>() åŠ è½½å¤±è´¥
    â†“
ErrorBoundary<span class="hljs-selector-class">.componentDidCatch</span>() æ•è· â† åœ¨è¿™é‡Œè¢«æ‹¦æˆªï¼
    â†“
æ˜¾ç¤ºé”™è¯¯ç•Œé¢ï¼Œç­‰å¾…ç”¨æˆ·ç‚¹å‡»
    â†“
âŒ window<span class="hljs-selector-class">.error</span> æ°¸è¿œä¸ä¼šè§¦å‘
    â†“
âŒ è‡ªåŠ¨åˆ·æ–°é€»è¾‘ä»æœªæ‰§è¡Œ
</code></pre>
<h4 data-id="heading-18">è§£å†³æ–¹æ¡ˆ</h4>
<p><strong>1. é‡æ„ä¸ºå¯å¤ç”¨çš„å·¥å…·å‡½æ•°</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å¯¼å‡ºæ£€æµ‹å‡½æ•°</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">isModuleLoadError</span>(<span class="hljs-params">error: <span class="hljs-built_in">Error</span> | <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">boolean</span>

<span class="hljs-comment">// å¯¼å‡ºåˆ·æ–°å‡½æ•°</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">attemptModuleErrorReload</span>(<span class="hljs-params"/>): <span class="hljs-built_in">boolean</span>

<span class="hljs-comment">// ä¿ç•™å…¨å±€ç›‘å¬ï¼ˆå…œåº•ï¼‰</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">setupModuleLoadErrorHandler</span>(<span class="hljs-params"/>): <span class="hljs-built_in">void</span>
</code></pre>
<p><strong>2. åœ¨ ErrorBoundary ä¸­é›†æˆ</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">componentDidCatch</span>(<span class="hljs-params">error: <span class="hljs-built_in">Error</span>, errorInfo: ErrorInfo</span>) {
  <span class="hljs-comment">// æ£€æµ‹å¹¶å¤„ç†æ¨¡å—åŠ è½½é”™è¯¯ - è‡ªåŠ¨åˆ·æ–°</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isModuleLoadError</span>(error)) {
    <span class="hljs-title function_">attemptModuleErrorReload</span>();
    <span class="hljs-keyword">return</span>; <span class="hljs-comment">// ä¸æ˜¾ç¤ºé”™è¯¯UIï¼Œé¡µé¢å³å°†åˆ·æ–°</span>
  }

  <span class="hljs-comment">// å…¶ä»–é”™è¯¯æ­£å¸¸å¤„ç†</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ error, errorInfo });
}
</code></pre>
<h4 data-id="heading-19">ä¿®æ”¹æ•ˆæœ</h4>
<p>ç°åœ¨æœ‰äº†<strong>åŒå±‚é˜²æŠ¤</strong>ï¼š</p>
<ol>
<li><strong>ErrorBoundaryï¼ˆç¬¬ä¸€é“é˜²çº¿ï¼‰</strong> - æ•è· React ç»„ä»¶é”™è¯¯ï¼Œå¿«é€Ÿå“åº”</li>
<li><strong>window.errorï¼ˆå…œåº•ï¼‰</strong> - æ•è·å…¶ä»–æœªå¤„ç†çš„é”™è¯¯</li>
</ol>
<p>æ— è®ºé”™è¯¯ä»å“ªé‡Œæ¥ï¼Œéƒ½èƒ½è¢«æ­£ç¡®å¤„ç†å¹¶è‡ªåŠ¨åˆ·æ–°ã€‚</p>
<hr/>
<h4 data-id="heading-20">å‚è€ƒèµ„æº</h4>
<ol>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fvitejs.dev%2Fguide%2Fbuild.html" target="_blank" title="https://vitejs.dev/guide/build.html" ref="nofollow noopener noreferrer">Vite æ–‡æ¡£ - æ„å»ºç”Ÿäº§ç‰ˆæœ¬</a></strong> - å…³äº chunk åˆ†å‰²çš„é…ç½®</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2Fimport" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/import" ref="nofollow noopener noreferrer">MDN - Dynamic import()</a></strong> - åŠ¨æ€å¯¼å…¥çš„åŸç†</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Freference%2Freact%2FComponent%23catching-rendering-errors-with-an-error-boundary" target="_blank" title="https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary" ref="nofollow noopener noreferrer">React Error Boundaries</a></strong> - é”™è¯¯è¾¹ç•Œçš„ä½¿ç”¨</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸµ Go Queryx å…¥é—¨æŒ‡å—ï¼šè®©æ•°æ®åº“æ“ä½œåƒå–å¥¶èŒ¶ä¸€æ ·ä¸æ»‘ï¼]]></title>    <link>https://juejin.cn/post/7572466174224482330</link>    <guid>https://juejin.cn/post/7572466174224482330</guid>    <pubDate>2025-11-15T04:08:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572466174224482330" data-draft-id="7569825640852799523" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸµ Go Queryx å…¥é—¨æŒ‡å—ï¼šè®©æ•°æ®åº“æ“ä½œåƒå–å¥¶èŒ¶ä¸€æ ·ä¸æ»‘ï¼"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-15T04:08:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="golangå­¦ä¹ è®°"/> <meta itemprop="url" content="https://juejin.cn/user/4371313964100990"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸµ Go Queryx å…¥é—¨æŒ‡å—ï¼šè®©æ•°æ®åº“æ“ä½œåƒå–å¥¶èŒ¶ä¸€æ ·ä¸æ»‘ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4371313964100990/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    golangå­¦ä¹ è®°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-15T04:08:48.000Z" title="Sat Nov 15 2025 04:08:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸ¬ å‰è¨€ï¼šä¸ºä»€ä¹ˆæ˜¯ Queryxï¼Ÿâ€”â€” å› ä¸º bug ç­‰ä¸åŠä½ ã€Œè¿è¡Œæ—¶æ‰å‘ç°ã€</h2>
<p>æƒ³è±¡ä¸€ä¸‹è¿™äº›ç»å…¸åœºæ™¯ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// ğŸš¨ GORM çš„â€œæƒŠå–œç›²ç›’â€</span>
db.Where(<span class="hljs-string">"nmae = ?"</span>, <span class="hljs-string">"john"</span>).Find(&amp;users) <span class="hljs-comment">// æ‹¼å†™é”™è¯¯ï¼Ÿç¼–è¯‘å™¨ï¼šæ²¡é—®é¢˜ ğŸ‘Œ  </span>
<span class="hljs-comment">// â†’ è¿è¡Œæ—¶ï¼šæŸ¥ä¸åˆ°æ•°æ®ï¼ŸğŸ¤” è°ƒè¯• 2 å°æ—¶ï¼šå“¦ï¼Œ`nmae` å°‘äº†ä¸ª `e` â€¦â€¦</span>

<span class="hljs-comment">// ğŸ§¨ åŸç”Ÿ SQL çš„â€œç±»å‹å½©ç¥¨â€</span>
rows, _ := db.Query(<span class="hljs-string">"SELECT * FROM users WHERE age &gt; ?"</span>, <span class="hljs-string">"18"</span>) 
<span class="hljs-comment">// å­—ç¬¦ä¸²ä¼ æ•°å­—ï¼ŸMySQLï¼šæˆ‘å…ˆ convert ä¸€ä¸‹ï½ï¼ˆå¯èƒ½æŠ¥é”™ï¼Œä¹Ÿå¯èƒ½é™é»˜æˆªæ–­ï¼ï¼‰</span>
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>Queryx çš„æ‰¿è¯º</strong>ï¼š<br/>
<em>â€œä½ å†™çš„æ¯ä¸€ä¸ªå­—æ®µã€æ¯ä¸€æ¡æ¡ä»¶ï¼Œéƒ½ç»è¿‡ Go ç¼–è¯‘å™¨çš„â€˜å®‰æ£€é—¨â€™â€”â€”<br/>
é”™åˆ«å­—ï¼Ÿç±»å‹é”™ï¼Ÿå…³è”æ¼ï¼Ÿâ€”â€” ç¼–è¯‘å°±æŠ¥é”™ï¼Œç»ä¸æ‹–åˆ°ç”Ÿäº§ç¯å¢ƒï¼â€</em></p>
</blockquote>
<hr/>
<h2 data-id="heading-1">ğŸ§ ç¬¬ä¸€ç« ï¼šå®‰è£… Queryx â€”â€” æ¯”æ³¡é¢è¿˜å¿«ï¼Œæ¯”ç‚¹å¤–å–è¿˜çœå¿ƒ</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ–¹æ³•ä¸€ï¼šä¸€é”®å®‰è£…ï¼ˆå®˜æ–¹æ¨èè„šæœ¬ï¼‰</span>
curl -sf https://raw.githubusercontent.com/swiftcarrot/queryx/main/install.sh | sh

<span class="hljs-comment"># æ–¹æ³•äºŒï¼šGo installï¼ˆé€‚åˆ CI/CDï¼‰</span>
go install github.com/swiftcarrot/queryx/cmd/queryx@latest
</code></pre>
<p>âœ… å®‰è£…åç»ˆç«¯å¤šä¸€ä¸ª <code>queryx</code> å‘½ä»¤â€”â€”ä½ çš„ <strong>æ•°æ®åº“è‡ªåŠ¨åŒ–ç®¡å®¶</strong> æ­£å¼ä¸Šå²—ï¼ğŸ©<br/>
ï¼ˆå®ƒä¼šå¸®ä½ ç”Ÿæˆä»£ç ã€åšè¿ç§»ã€æ£€æŸ¥ schemaï¼Œå°±æ˜¯ä¸å¸®ä½ å†™ä¸šåŠ¡é€»è¾‘ ğŸ˜ï¼‰</p>
<hr/>
<h2 data-id="heading-2">ğŸ“ ç¬¬äºŒç« ï¼šå®šä¹‰æ•°æ®æ¨¡å‹ â€”â€” åƒå†™æƒ…ä¹¦ä¸€æ ·ä¼˜é›…</h2>
<p>åˆ›å»º <code>schema.hcl</code> æ–‡ä»¶ï¼ˆQueryx çš„â€œé­”æ³•é…æ–¹ä¹¦â€ï¼‰ï¼š</p>
<pre><code class="hljs language-hcl" lang="hcl"># schema.hcl
database "db" {
  adapter = "postgresql"  # ä¹Ÿæ”¯æŒ mysql/sqlite

  config "development" {
    url = "postgres://postgres:postgres@localhost:5432/blog_dev?sslmode=disable"
  }

  config "production" {
    url = env("DATABASE_URL")  # ğŸ›¡ï¸ æ•æ„Ÿä¿¡æ¯èµ°ç¯å¢ƒå˜é‡ï¼
  }

  # ğŸ‘‰ å…³é”®ä¸€æ­¥ï¼šæŒ‡å®šç”Ÿæˆ Go å®¢æˆ·ç«¯
  generator "client-golang" {}
}

# å®šä¹‰ User æ¨¡å‹ â€”â€” åƒæè¿°ä½ çš„ç†æƒ³å‹
model "User" {
  column "name" {
    type = string
    null = false  # ä¸èƒ½ä¸ºç©ºï¼Œå°±åƒçˆ±æƒ…ä¸èƒ½å°†å°± ğŸ’–
  }

  column "email" {
    type = string
    unique = true  # é‚®ç®±å”¯ä¸€ï¼Œåƒèº«ä»½è¯å·
  }

  column "age" {
    type = integer
    null = true  # å¹´é¾„ï¼Ÿå¯ä»¥æ˜¯ç§˜å¯†ï½
  }

  column "created_at" {
    type = datetime
    default = "now()"  # è‡ªåŠ¨å¡«å……ï¼ŒçœŸè´´å¿ƒï¼
  }
}

# Post æ¨¡å‹ï¼šå› ä¸ºç”¨æˆ·æ€»è¦å‘å¸–å­
model "Post" {
  belongs_to "user" {}  # è‡ªåŠ¨åŠ  user_id å¤–é”®ï¼

  column "title"    { type = string }
  column "content"  { type = text }
}
</code></pre>
<blockquote>
<p>âœ… <strong>HCLï¼ˆHashiCorp Configuration Languageï¼‰</strong> çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>æ¯” YAML ä¸æ˜“ç¼©è¿›å‡ºé”™</li>
<li>æ¯” JSON æ”¯æŒæ³¨é‡Š + è¡¨è¾¾å¼</li>
<li>æ¯” Go Struct æ›´ä¸“æ³¨ <strong>æ•°æ®å»ºæ¨¡</strong>ï¼Œè€Œéå®ç°ç»†èŠ‚</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-3">ğŸª„ ç¬¬ä¸‰ç« ï¼šæ•°æ®åº“è¿ç§» â€”â€” åƒå˜é­”æœ¯ä¸€æ ·ä¸æ»‘</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. åˆ›å»ºæ•°æ®åº“ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰</span>
queryx db:create

<span class="hljs-comment"># 2. ç”Ÿæˆè¿ç§»æ–‡ä»¶ï¼ˆåŸºäº schema.hclï¼‰</span>
queryx db:migrate

<span class="hljs-comment"># 3. åº”ç”¨è¿ç§»ï¼ˆå»ºè¡¨ + çº¦æŸ + ç´¢å¼•ï¼‰</span>
queryx db:migrate:up
</code></pre>
<p>ğŸ”§ è¿è¡Œåï¼š</p>
<ul>
<li>è‡ªåŠ¨ç”Ÿæˆ <code>migrations/</code> ç›®å½• + ç‰ˆæœ¬åŒ– SQL</li>
<li>è‡ªåŠ¨å»º <code>users</code>ã€<code>posts</code> è¡¨ï¼Œå¸¦å¤–é”®ã€å”¯ä¸€ç´¢å¼•ã€é»˜è®¤å€¼</li>
<li>ä½ çš„åŒæ‰‹ç»ˆäºä» <code>CREATE TABLE</code> ä¸­è§£æ”¾äº†ï¼</li>
</ul>
<blockquote>
<p>ğŸ  <strong>æ¯”å–»æ—¶é—´</strong>ï¼š<br/>
ä½ å‘Šè¯‰ç®¡å®¶ï¼šâ€œæˆ‘è¦ä¸€ä¸ªä¸¤å±…å®¤ï¼Œä¸»å§æœå—ï¼Œå¸¦æ™ºèƒ½é©¬æ¡¶â€<br/>
ç®¡å®¶ç”¨ <code>schema.hcl</code> è®°ä¸‹éœ€æ±‚ â†’ <code>queryx db:migrate</code> â†’ äº¤é’¥åŒ™ï¼âœ¨</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">ğŸ® ç¬¬å››ç« ï¼šCRUD æ“ä½œ â€”â€” æ¯”æ‰“æ¸¸æˆåˆ·å‰¯æœ¬è¿˜çˆ½ï¼</h2>
<p>å…ˆç”Ÿæˆ Go ä»£ç ï¼ˆè®© Queryx ä¸ºä½ æ‰“å·¥ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">queryx g  <span class="hljs-comment"># or queryx generate</span>
<span class="hljs-comment"># â†’ ç”Ÿæˆ db/ ç›®å½•ï¼šå« clientã€modelsã€buildersã€migrations...</span>
</code></pre>
<p>ç„¶ååœ¨ä»£ç ä¸­äº«å—<strong>ç¼–è¯‘æ—¶ç±»å‹å®‰å…¨</strong>çš„å¿«ä¹ï¼š</p>
<h3 data-id="heading-5">4.1 ğŸ‰ åˆ›å»ºç”¨æˆ·ï¼šåƒè¿æ¥æ–°æœ‹å‹ä¸€æ ·æ¸©æš–</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"context"</span>
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"log"</span>

	<span class="hljs-string">"your-project/db"</span> <span class="hljs-comment">// â† Queryx ç”Ÿæˆçš„åŒ…ï¼</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	c, err := db.NewClient(context.Background())
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatal(<span class="hljs-string">"ğŸ’” è¿ä¸ä¸Šæ•°æ®åº“"</span>)
	}
	<span class="hljs-keyword">defer</span> c.Close()

	<span class="hljs-comment">// âœ… ç±»å‹å®‰å…¨ï¼SetName åªæ¥å— stringï¼ŒSetAge åªæ¥å— *int</span>
	newUser := c.ChangeUser().
		SetName(<span class="hljs-string">"Goè¯­è¨€å°ç‹å­"</span>).
		SetEmail(<span class="hljs-string">"gopher@example.com"</span>).
		SetAge(db.Int(<span class="hljs-number">25</span>)) <span class="hljs-comment">// æ³¨æ„ï¼šnil-safeï¼Œdb.Int(nil) è¡¨ç¤º NULL</span>

	user, err := c.QueryUser().Create(newUser)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatal(<span class="hljs-string">"åˆ›å»ºå¤±è´¥:"</span>, err) <span class="hljs-comment">// å¯èƒ½æ˜¯é‚®ç®±é‡å¤ï¼</span>
	}

	fmt.Printf(<span class="hljs-string">"âœ… ç”¨æˆ·åˆ›å»ºæˆåŠŸï¼ID: %d, å§“å: %s\n"</span>, user.ID, user.Name)
	<span class="hljs-comment">// è¾“å‡ºï¼šID: 1, å§“å: Goè¯­è¨€å°ç‹å­</span>
}
</code></pre>
<blockquote>
<p>ğŸ” <strong>å…³é”®ç»†èŠ‚</strong>ï¼ˆæ¥è‡ª Queryx çœŸå®è®¾è®¡ï¼‰ï¼š</p>
<ul>
<li><code>c.ChangeUser()</code> â†’ è¿”å› <strong>å˜æ›´æ„å»ºå™¨</strong>ï¼ˆBuilder Patternï¼‰</li>
<li><code>SetAge(db.Int(25))</code>ï¼šç”¨åŒ…è£…ç±»å‹æ”¯æŒ <code>NULL</code>ï¼ˆ<code>db.Int(nil)</code>ï¼‰</li>
<li>æ‰€æœ‰ <code>SetXxx()</code> æ–¹æ³•ï¼š<strong>ç¼–è¯‘æ—¶æŠ¥é”™</strong>ï¼å†™é”™å­—æ®µï¼ŸGo ç¼–è¯‘å™¨ç§’æ‹’ï¼</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-6">4.2 ğŸ” æŸ¥è¯¢ç”¨æˆ·ï¼šæ¯”ç¦å°”æ‘©æ–¯æ‰¾çº¿ç´¢è¿˜å‡†</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// ç²¾å‡†æŸ¥æ‰¾ï¼šæŒ‰ ID</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">findUserByID</span><span class="hljs-params">(c *db.Client, id <span class="hljs-type">int64</span>)</span></span> {
	user, err := c.QueryUser().Find(id)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		fmt.Println(<span class="hljs-string">"ğŸ«£ ç”¨æˆ·ä¸å­˜åœ¨"</span>)
		<span class="hljs-keyword">return</span>
	}
	fmt.Printf(<span class="hljs-string">"ğŸ‘¤ %s (%s, %då²)\n"</span>, user.Name, user.Email, user.Age)
}

<span class="hljs-comment">// æ¡ä»¶æŸ¥è¯¢ï¼šé“¾å¼ API å¦‚è¯—å¦‚ç”»</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">queryUsers</span><span class="hljs-params">(c *db.Client)</span></span> {
	<span class="hljs-comment">// æ‰¾ 18+ ç”¨æˆ·ï¼ŒæŒ‰åˆ›å»ºæ—¶é—´å€’åº</span>
	adults, err := c.QueryUser().
		Where(c.User.Age.GT(<span class="hljs-number">18</span>)).           <span class="hljs-comment">// å¹´é¾„ &gt; 18</span>
		OrderBy(c.User.CreatedAt.Desc()).   <span class="hljs-comment">// æ—¶é—´å€’åº</span>
		All()
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatal(<span class="hljs-string">"æŸ¥è¯¢ç¿»è½¦äº†"</span>)
	}

	fmt.Printf(<span class="hljs-string">"ğŸ‘¥ å…± %d ä½æˆå¹´ç”¨æˆ·ï¼š\n"</span>, <span class="hljs-built_in">len</span>(adults))
	<span class="hljs-keyword">for</span> _, u := <span class="hljs-keyword">range</span> adults {
		fmt.Printf(<span class="hljs-string">"â€¢ %sï¼ˆ%då²ï¼‰\n"</span>, u.Name, u.Age)
	}

	<span class="hljs-comment">// é‚®ç®±ç²¾å‡†åŒ¹é…ï¼ˆç¼–è¯‘æ—¶æ£€æŸ¥å­—æ®µï¼ï¼‰</span>
	user, err := c.QueryUser().
		Where(c.User.Email.EQ(<span class="hljs-string">"gopher@example.com"</span>)).
		First()
	<span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> {
		fmt.Printf(<span class="hljs-string">"ğŸ“§ é‚®ç®±ä¸»äººï¼š%s\n"</span>, user.Name)
	}
}
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>Queryx æŸ¥è¯¢æ„å»ºå™¨ä¸‰å¤§æ³•å®</strong>ï¼š</p>
<ol>
<li><code>c.User.Age.GT(18)</code> â€”â€” å­—æ®µè·¯å¾„ + æ“ä½œç¬¦ï¼ˆGT/LT/EQ/IN...ï¼‰</li>
<li><code>OrderBy(...).Limit(...).Offset(...)</code> â€”â€” é“¾å¼ç»„åˆ</li>
<li><code>First()</code> / <code>All()</code> / <code>Count()</code> â€”â€” æ¸…æ™°è¯­ä¹‰ï¼Œå‘Šåˆ« <code>Scan</code> åœ°ç‹±</li>
</ol>
</blockquote>
<hr/>
<h3 data-id="heading-7">4.3 âœï¸ æ›´æ–°ç”¨æˆ·ï¼šåƒç¾é¢œç›¸æœºä¸€æ ·ç²¾å‡†</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">updateUser</span><span class="hljs-params">(c *db.Client, id <span class="hljs-type">int64</span>)</span></span> {
	<span class="hljs-comment">// å…ˆæŸ¥åæ”¹ï¼ˆä¹è§‚é”å‹å¥½ï¼‰</span>
	user, err := c.QueryUser().Find(id)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span>
	}

	<span class="hljs-comment">// æ„å»ºæ›´æ–°ï¼šç±»å‹å®‰å…¨ï¼</span>
	update := c.ChangeUser().
		SetName(<span class="hljs-string">"Goè¯­è¨€å¤§ç¥"</span>).
		SetAge(db.Int(<span class="hljs-number">26</span>)).
		SetEmail(<span class="hljs-string">"master@golang.com"</span>)

	err = user.Update(update)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatal(<span class="hljs-string">"æ›´æ–°å¤±è´¥"</span>)
	}
	fmt.Println(<span class="hljs-string">"âœ¨ ç”¨æˆ·ä¿¡æ¯å·²å‡çº§ï¼"</span>)

	<span class="hljs-comment">// æ‰¹é‡æ›´æ–°ï¼šå…¨å…¬å¸å‘˜å·¥ +1 å²ï¼ˆç”Ÿæ—¥å¿«ä¹ğŸ‚ï¼‰</span>
	count, err := c.QueryUser().
		Where(c.User.Age.IsNotNull()). <span class="hljs-comment">// åªæ›´æ–°é NULL å¹´é¾„</span>
		UpdateAll(c.ChangeUser().SetAge(c.User.Age.Add(<span class="hljs-number">1</span>)))
	<span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> {
		fmt.Printf(<span class="hljs-string">"ğŸ‰ ç»™ %d ä½åŒäº‹è¿‡äº†ç”Ÿæ—¥ï¼\n"</span>, count)
	}
}
</code></pre>
<blockquote>
<p>ğŸŒŸ <strong>äº®ç‚¹</strong>ï¼š</p>
<ul>
<li><code>c.User.Age.Add(1)</code> â†’ ç”Ÿæˆ <code>age = age + 1</code>ï¼Œé¿å…ç«æ€</li>
<li><code>UpdateAll</code> æ”¯æŒè¡¨è¾¾å¼æ›´æ–°ï¼Œ<strong>æ—  N+1 é—®é¢˜</strong></li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-8">4.4 ğŸ—‘ï¸ åˆ é™¤ç”¨æˆ·ï¼šæ¯”åˆ†æ‰‹è¿˜å¹²å‡€åˆ©è½</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">deleteUser</span><span class="hljs-params">(c *db.Client, id <span class="hljs-type">int64</span>)</span></span> {
	<span class="hljs-comment">// æ–¹å¼1ï¼šå…ˆæŸ¥ååˆ ï¼ˆé€‚åˆå¸¦ä¸šåŠ¡é€»è¾‘æ ¡éªŒï¼‰</span>
	user, _ := c.QueryUser().Find(id)
	<span class="hljs-keyword">if</span> user != <span class="hljs-literal">nil</span> {
		err := user.Delete() <span class="hljs-comment">// è½¯åˆ é™¤ï¼Ÿç¡¬åˆ é™¤ï¼Ÿschema å†³å®šï¼</span>
		<span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> {
			fmt.Println(<span class="hljs-string">"âœ… ç”¨æˆ·å·²åˆ é™¤"</span>)
		}
	}

	<span class="hljs-comment">// æ–¹å¼2ï¼šæ¡ä»¶æ‰¹é‡åˆ ï¼ˆé«˜æ•ˆï¼ï¼‰</span>
	count, err := c.QueryUser().
		Where(c.User.Age.LT(<span class="hljs-number">18</span>)). <span class="hljs-comment">// æœªæˆå¹´</span>
		DeleteAll()
	<span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> {
		fmt.Printf(<span class="hljs-string">"ğŸ‘® æ¸…ç†äº† %d ä½æœªæˆå¹´ç”¨æˆ·\n"</span>, count)
	}
}
</code></pre>
<blockquote>
<p>âš ï¸ <strong>å®‰å…¨è®¾è®¡</strong>ï¼š<br/>
Queryx <strong>é»˜è®¤å¼€å¯è½¯åˆ é™¤</strong>ï¼ˆå¦‚æœ‰ <code>deleted_at</code> å­—æ®µï¼‰ï¼Œ<br/>
çœŸè¦ç¡¬åˆ ï¼Ÿéœ€æ˜¾å¼è°ƒç”¨ <code>ForceDelete()</code> â€”â€” é˜²æ‰‹æŠ–ç¬¬ä¸€é“é˜²çº¿ï¼</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">ğŸ¤ ç¬¬äº”ç« ï¼šå…³è”æŸ¥è¯¢ â€”â€” åƒç¤¾äº¤ç½‘ç»œä¸€æ ·è‡ªç„¶</h2>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// é¢„åŠ è½½å¸–å­ï¼ˆ1 æ¬¡æŸ¥è¯¢æå®šï¼Œæ—  N+1ï¼ï¼‰</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">userWithPosts</span><span class="hljs-params">(c *db.Client, userID <span class="hljs-type">int64</span>)</span></span> {
	user, err := c.QueryUser().
		Preload(c.User.Posts). <span class="hljs-comment">// â† å…³é”®ï¼ç”Ÿæˆ JOIN æˆ– IN æŸ¥è¯¢</span>
		Find(userID)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatal(<span class="hljs-string">"æŸ¥è¯¢å¤±è´¥"</span>)
	}

	fmt.Printf(<span class="hljs-string">"ğŸ“ %s çš„åšå®¢ï¼š\n"</span>, user.Name)
	<span class="hljs-keyword">for</span> _, p := <span class="hljs-keyword">range</span> user.Posts {
		fmt.Printf(<span class="hljs-string">"â€¢ %s\n"</span>, truncate(p.Title, <span class="hljs-number">30</span>))
	}
}

<span class="hljs-comment">// åˆ›å»ºã€Œç”¨æˆ·+å¸–å­ã€ç»„åˆæ•°æ®</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createUserWithPosts</span><span class="hljs-params">(c *db.Client)</span></span> {
	<span class="hljs-comment">// 1. åˆ›å»ºç”¨æˆ·</span>
	user, _ := c.QueryUser().Create(
		c.ChangeUser().SetName(<span class="hljs-string">"åšå®¢è¾¾äºº"</span>).SetEmail(<span class="hljs-string">"blogger@go.com"</span>),
	)

	<span class="hljs-comment">// 2. å…³è”åˆ›å»ºå¸–å­ï¼ˆè‡ªåŠ¨å¡« user_idï¼ï¼‰</span>
	posts := []db.CreatePostInput{
		{Title: <span class="hljs-string">"æˆ‘çš„ç¬¬ä¸€ä¸ª Go ç¨‹åº"</span>, Content: <span class="hljs-string">"Hello, Queryx!"</span>},
		{Title: <span class="hljs-string">"ä¸ºä»€ä¹ˆæˆ‘çˆ± Queryx"</span>, Content: <span class="hljs-string">"ç±»å‹å®‰å…¨è®©æˆ‘ç¡å¾—æ›´é¦™ï½"</span>},
	}

	<span class="hljs-keyword">for</span> _, p := <span class="hljs-keyword">range</span> posts {
		_, _ = c.QueryPost().Create(
			c.ChangePost().
				SetTitle(p.Title).
				SetContent(p.Content).
				SetUserID(user.ID), <span class="hljs-comment">// â† ç±»å‹å®‰å…¨ï¼ID æ˜¯ int64</span>
		)
	}
	fmt.Printf(<span class="hljs-string">"ğŸ“š ç”¨æˆ· %s å‘å¸ƒäº† 2 ç¯‡åšæ–‡ï¼\n"</span>, user.Name)
}

<span class="hljs-comment">// è¾…åŠ©ï¼šæˆªæ–­é•¿æ–‡æœ¬</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">truncate</span><span class="hljs-params">(s <span class="hljs-type">string</span>, n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">string</span> {
	<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(s) &lt;= n {
		<span class="hljs-keyword">return</span> s
	}
	<span class="hljs-keyword">return</span> s[:n] + <span class="hljs-string">"â€¦"</span>
}
</code></pre>
<blockquote>
<p>âœ… <strong>å…³è”ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><code>Preload(c.User.Posts)</code> â†’ è‡ªåŠ¨è¯†åˆ« <code>belongs_to</code> å…³ç³»</li>
<li>ç”Ÿæˆé«˜æ•ˆ SQLï¼ˆ<code>JOIN</code> æˆ– <code>SELECT ... WHERE id IN (...)</code>ï¼‰</li>
<li>ç¼–è¯‘æ—¶æ£€æŸ¥å…³è”è·¯å¾„ï¼š<code>c.User.Postxxx</code>ï¼ŸâŒ ä¸å­˜åœ¨ï¼</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-10">ğŸ§™ ç¬¬å…­ç« ï¼šé«˜çº§æŠ€å·§ â€”â€” æˆä¸º Queryx é«˜æ‰‹</h2>
<h3 data-id="heading-11">6.1 ğŸ’° äº‹åŠ¡å¤„ç†ï¼šè¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å›æ»š</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">transferPoints</span><span class="hljs-params">(c *db.Client, fromID, toID <span class="hljs-type">int64</span>, pts <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">error</span> {
	tx, err := c.Begin(context.Background())
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> err
	}
	<span class="hljs-keyword">defer</span> tx.Rollback() <span class="hljs-comment">// â† å¿˜è®°è¿™è¡Œï¼Ÿdefer ä¿ä½ å¹³å®‰</span>

	<span class="hljs-comment">// æ‰£æ¬¾æ–¹</span>
	from, err := tx.QueryUser().Find(fromID)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> || from.Points &lt; pts {
		<span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"ä½™é¢ä¸è¶³"</span>)
	}
	err = from.Update(c.ChangeUser().SetPoints(from.Points - pts))
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> err
	}

	<span class="hljs-comment">// æ”¶æ¬¾æ–¹</span>
	to, err := tx.QueryUser().Find(toID)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> err
	}
	err = to.Update(c.ChangeUser().SetPoints(to.Points + pts))
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> err
	}

	<span class="hljs-keyword">return</span> tx.Commit() <span class="hljs-comment">// ğŸ¯ æäº¤ï¼èµ„é‡‘åˆ°ä½ï¼</span>
}
</code></pre>
<blockquote>
<p>ğŸ” äº‹åŠ¡ä¸­æ‰€æœ‰æ“ä½œèµ° <code>tx.QueryUser()</code>ï¼Œé <code>c.QueryUser()</code> â€”â€” Queryx å¼ºåˆ¶ä½ åŒºåˆ†ï¼</p>
</blockquote>
<hr/>
<h3 data-id="heading-12">6.2 ğŸ“Š å¤æ‚æŸ¥è¯¢ï¼šåƒæ­ä¹é«˜ä¸€æ ·ç»„åˆ</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">userStats</span><span class="hljs-params">(c *db.Client)</span></span> {
	<span class="hljs-comment">// ç»Ÿè®¡ï¼šCOUNT + æ¡ä»¶</span>
	total, _ := c.QueryUser().Count()
	adults, _ := c.QueryUser().Where(c.User.Age.GTE(<span class="hljs-number">18</span>)).Count()
	active, _ := c.QueryUser().Where(c.User.LastLogin.GT(time.Now().Add(<span class="hljs-number">-30</span>*<span class="hljs-number">24</span>*time.Hour))).Count()

	fmt.Printf(<span class="hljs-string">`ğŸ“Š ç”¨æˆ·å¤§ç›˜ï¼š
   æ€»ç”¨æˆ·    : %d
   æˆå¹´ç”¨æˆ·  : %d
   è¿‘30å¤©æ´»è·ƒ: %d
`</span>, total, adults, active)
}

<span class="hljs-comment">// åˆ†ç»„ç»Ÿè®¡ï¼šå¹´é¾„åˆ†å¸ƒ</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ageDistribution</span><span class="hljs-params">(c *db.Client)</span></span> {
	<span class="hljs-keyword">var</span> results []<span class="hljs-keyword">struct</span> {
		AgeRange <span class="hljs-type">string</span> <span class="hljs-string">`db:"age_range"`</span>
		Count    <span class="hljs-type">int</span>    <span class="hljs-string">`db:"count"`</span>
	}

	<span class="hljs-comment">// Queryx æ”¯æŒ Raw SQL ç‰‡æ®µï¼ˆç´§æ€¥æ—¶çš„â€œåˆ›å¯è´´â€ï¼‰</span>
	err := c.QueryRaw(<span class="hljs-string">`
		SELECT 
			CASE 
				WHEN age &lt; 18 THEN 'æœªæˆå¹´'
				WHEN age BETWEEN 18 AND 35 THEN 'é’å£®å¹´'
				ELSE 'èµ„æ·±é’å¹´'
			END AS age_range,
			COUNT(*) AS count
		FROM users 
		WHERE age IS NOT NULL
		GROUP BY age_range
	`</span>).Scan(&amp;results)
	<span class="hljs-comment">// ...</span>
}
</code></pre>
<blockquote>
<p>âœ… åŸåˆ™ï¼š</p>
<ul>
<li>95% åœºæ™¯ç”¨ç±»å‹å®‰å…¨ Builder</li>
<li>5% é«˜çº§ SQL ç”¨ <code>QueryRaw()</code>ï¼Œä½†å‚æ•°ä»èµ° <code>?</code> å ä½é˜²æ³¨å…¥</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-13">âš–ï¸ ç¬¬ä¸ƒç« ï¼šQueryx vs å…¶ä»–æ–¹æ¡ˆ â€”â€” è°æ‰æ˜¯ä½ çš„çœŸå‘½å¤©â€œåº“â€ï¼Ÿ</h2>















































<table><thead><tr><th>ç‰¹æ€§</th><th>Queryx âœ…</th><th>GORM ğŸŸ¡</th><th>åŸç”Ÿ SQL âŒ</th></tr></thead><tbody><tr><td><strong>ç±»å‹å®‰å…¨</strong></td><td>âœ… ç¼–è¯‘æ—¶æŠ¥é”™</td><td>âŒ è¿è¡Œæ—¶æ‰å‘ç°</td><td>âŒ å…¨é äººçœ¼</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>âœ… é›¶åå°„ï¼Œé¢„ç”Ÿæˆä»£ç </td><td>ğŸŸ¡ åå°„å¼€é”€ï¼ˆä¸­å°é¡¹ç›®å¯å¿ï¼‰</td><td>âœ… æœ€å¿«</td></tr><tr><td><strong>å¼€å‘ä½“éªŒ</strong></td><td>âœ… IDE è‡ªåŠ¨è¡¥å…¨ + è·³è½¬</td><td>âœ… åŠŸèƒ½ä¸°å¯Œ</td><td>âŒ æ˜“é”™ã€éš¾ç»´æŠ¤</td></tr><tr><td><strong>å­¦ä¹ æ›²çº¿</strong></td><td>âœ… 1 0åˆ†é’Ÿä¸Šæ‰‹</td><td>ğŸŸ¡ éœ€ç†è§£ Scopes/Hooks</td><td>âœ… ä¼š SQL å°±è¡Œ</td></tr><tr><td><strong>å…³è”æŸ¥è¯¢</strong></td><td>âœ… <code>Preload()</code> é˜² N+1</td><td>âœ… <code>.Preload()</code></td><td>âŒ æ‰‹å†™ JOIN æ˜“å‡ºé”™</td></tr><tr><td><strong>è¿ç§»ç®¡ç†</strong></td><td>âœ… <code>queryx db:migrate</code></td><td>âœ… <code>AutoMigrate()</code></td><td>âŒ æ‰‹åŠ¨ç»´æŠ¤</td></tr></tbody></table>
<blockquote>
<p>ğŸ¯ <strong>é€‰å‹å»ºè®®</strong>ï¼š</p>
<ul>
<li>æƒ³<strong>æŒæ§ SQLã€è®¨åŒé­”æ³•ã€è¿½æ±‚è½»é‡é«˜æ•ˆ</strong> â†’ <strong>Queryx</strong></li>
<li>å›¢é˜Ÿå·²é‡åº¦ä¾èµ– GORMã€éœ€å¿«é€Ÿ CRUD â†’ <strong>GORM</strong></li>
<li>åš<strong>è¶…é«˜æ€§èƒ½åœºæ™¯ã€å¤æ‚æŠ¥è¡¨</strong> â†’ <strong>åŸç”Ÿ SQL + queryx.QueryRaw()</strong></li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-14">ğŸ ç»“è¯­ï¼šç”¨ Queryx çš„ä¸€å¤©ï¼Œæ˜¯å®‰å¿ƒå†™ä»£ç çš„ä¸€å¤©</h2>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// ç”¨ Queryx çš„å¹¸ç¦æ—¶åˆ» ğŸ‘‡</span>
user, err := c.QueryUser().
	Where(c.User.Email.EQ(<span class="hljs-string">"happy@coder.com"</span>)).
	Preload(c.User.Posts).
	First()

<span class="hljs-comment">// è€Œä¸æ˜¯ï¼š</span>
<span class="hljs-comment">// ğŸ¤¯ "ä¸ºä»€ä¹ˆå­—æ®µæ˜¯ç©ºçš„ï¼Ÿå“¦ï¼Œstruct tag å†™é”™äº†..."</span>
<span class="hljs-comment">// ğŸ¤¯ "ä¸ºä»€ä¹ˆæŠ¥é”™ï¼Ÿå“¦ï¼ŒSQL æ‹¼é”™äº†å…³é”®å­—..."</span>
<span class="hljs-comment">// ğŸ¤¯ "ä¸ºä»€ä¹ˆæ…¢ï¼Ÿå“¦ï¼ŒN+1 æŸ¥è¯¢äº† 1000 æ¬¡..."</span>
</code></pre>
<blockquote>
<p>ğŸŒˆ <strong>Queryx çš„å“²å­¦</strong>ï¼š<br/>
<em>â€œæˆ‘ä»¬ä¸ hide SQL â€”â€” æˆ‘ä»¬è®© SQL å†™å¾—æ›´å®‰å…¨ã€æ›´å¿«ä¹ã€æ›´ Goã€‚â€</em></p>
</blockquote>
<hr/>
<h3 data-id="heading-15">ğŸš€ ç°åœ¨å°±è¯•è¯•å§ï¼</h3>
<ol>
<li>
<p><code>go install github.com/swiftcarrot/queryx/cmd/queryx@latest</code></p>
</li>
<li>
<p>å†™ <code>schema.hcl</code></p>
</li>
<li>
<p><code>queryx db:create &amp;&amp; queryx g</code></p>
</li>
<li>
<p>æ„Ÿå—<strong>ç¼–è¯‘æ—¶æŠ¥é”™</strong>å¸¦æ¥çš„å®‰å…¨æ„Ÿ â¤ï¸</p>
</li>
</ol>
<hr/>
<blockquote>
<p><strong>æœ€åä¸€å¥çœŸå¿ƒè¯</strong>ï¼š<br/>
<em>â€œæ—©ç”¨ Queryxï¼Œå°‘ debug 2 å°æ—¶ï¼›<br/>
æ™šç”¨ Queryxï¼Œå¤šåŠ ç­ 3 é€šå®µã€‚â€</em></p>
</blockquote>
<p>Happy Querying! ğŸµğŸ‰<br/>
ï¼ˆå¥¶èŒ¶å·²ä¸‹å•ï¼Œä»£ç æ­£åœ¨è·‘ï½ï¼‰</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>