<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Flutter 3.38 发布，快来看看有什么更新吧]]></title>    <link>https://juejin.cn/post/7571693273728696356</link>    <guid>https://juejin.cn/post/7571693273728696356</guid>    <pubDate>2025-11-12T23:24:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571693273728696356" data-draft-id="7571646669202505770" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter 3.38  发布，快来看看有什么更新吧"/> <meta itemprop="keywords" content="前端,Android,Flutter"/> <meta itemprop="datePublished" content="2025-11-12T23:24:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="恋猫de小郭"/> <meta itemprop="url" content="https://juejin.cn/user/817692379985752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter 3.38  发布，快来看看有什么更新吧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692379985752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    恋猫de小郭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T23:24:02.000Z" title="Wed Nov 12 2025 23:24:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 11 月 13 日的 FlutterFlightPlans 直播中，Flutter 3.38 如期而至，本次版本主要涉及 <strong>Dot shorthands、Web 支持增强、性能改进、问题修复和控件预览等方面</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d433075975a4642bfafa8d84892238c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763594642&amp;x-signature=JYqE4ro93N2IYqBtQE2GNsCuD6g%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">Dot shorthands</h2>
<p>在 Dart 3.10 + Flutter 3.38 中开始默认支持 Dot shorthands ，通过 Dot shorthands 可以使用简写方式省略类型前缀，例如使用 <code>.start</code> 而不是 <code>MainAxisAlignment.start</code>  ：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// With shorthands</span>
Column(
  mainAxisAlignment: .start,
  crossAxisAlignment: .center,
  children: [ <span class="hljs-comment">/* ... */</span> ],
),

<span class="hljs-comment">// Without shorthands</span>
Column(
  mainAxisAlignment: MainAxisAlignment.start,
  crossAxisAlignment: CrossAxisAlignment.center,
  children: [ <span class="hljs-comment">/* … */</span> ],
),

</code></pre>
<p>类似的还有  <code>.all</code> 而不是 <code>EdgeInsets.all</code>：</p>
<pre><code class="hljs language-dart" lang="dart">Padding(
  padding: .all(<span class="hljs-number">8.0</span>),
  child: Text(<span class="hljs-string">'Hello world'</span>),
),
</code></pre>
<blockquote>
<p>详细可见我们在之前聊过的 <a href="https://juejin.cn/post/7500234308432445451" target="_blank" title="https://juejin.cn/post/7500234308432445451">《Flutter 合并 'dot-shorthands' 语法糖》</a> 。</p>
</blockquote>
<h2 data-id="heading-1">Web 增强</h2>
<p><code>flutter run</code> 命令现在支持设置 Web 的配置文件，可以在工程根目录放入 <code>web_dev_config.yaml</code> 来配置 web 主机、端口、证书、headers 等，例如：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">host:</span> <span class="hljs-string">"0.0.0.0"</span> <span class="hljs-comment"># Defines the binding address &lt;string&gt;</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span> <span class="hljs-comment"># Specifies the port &lt;int&gt; for the development server</span>
  <span class="hljs-attr">https:</span>
    <span class="hljs-attr">cert-path:</span> <span class="hljs-string">"/path/to/cert.pem"</span> <span class="hljs-comment"># Path &lt;string&gt; to your TLS certificate</span>
    <span class="hljs-attr">cert-key-path:</span> <span class="hljs-string">"/path/to/key.pem"</span> <span class="hljs-comment"># Path &lt;string&gt; to TLS certificate key</span>
</code></pre>
<p>通过支持代理 (proxy) 设置，还可以将请求转发到配置的路径到另一台服务器：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">proxy:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">target:</span> <span class="hljs-string">"http://localhost:5000/"</span> <span class="hljs-comment"># Base URL &lt;string&gt; of your backend</span>
      <span class="hljs-attr">prefix:</span> <span class="hljs-string">"/users/"</span> <span class="hljs-comment"># Path &lt;string&gt;</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">target:</span> <span class="hljs-string">"http://localhost:3000/"</span>
      <span class="hljs-attr">prefix:</span> <span class="hljs-string">"/data/"</span>
      <span class="hljs-attr">replace:</span> <span class="hljs-string">"/report/"</span> <span class="hljs-comment"># Replacement &lt;string&gt; of path in redirected URL (optional)</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">target:</span> <span class="hljs-string">"http://localhost:4000/"</span>
      <span class="hljs-attr">prefix:</span> <span class="hljs-string">"/products/"</span>
      <span class="hljs-attr">replace:</span> <span class="hljs-string">""</span>
</code></pre>
<p>最后 3.38 还增强了 Flutter Web 的 hot reload 并默认开启，当以 <code>-d web-server</code> 参数运行并在浏览器打开时，可以支持多个浏览器同时连接 hot reload 。</p>
<blockquote>
<p>当然，和  <code>-d chrome</code> 一样，你也可以使用 <code>--no-web-experimental-hot-reload</code> 标志暂时禁用，不过禁用功能将在将来的版本中删除。</p>
</blockquote>
<h2 data-id="heading-2">Framework</h2>
<p>本次 Framework 调整主要围绕交互优化相关，比如帮助开发人员可以更精细地控制 UI、导航和平台交互等。</p>
<p>首先是引入了新的 <code>OverlayPortal</code>，允许将子 Widget 渲染在任一 <code>Overlay</code> 上，通过 <code>overlayChildLayoutBuilder</code> 可以更灵活地显示弹出、对话框、通知等 UI ，例如：</p>
<pre><code class="hljs language-dart" lang="dart">
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_OverlayPortalExampleState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">OverlayPortalExample</span>&gt; </span>{
  <span class="hljs-keyword">final</span> OverlayPortalController _controller = OverlayPortalController();

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'OverlayPortal'</span>)),
      body: Center(
        child: OverlayPortal.overlayChildLayoutBuilder(
          controller: _controller,
          <span class="hljs-comment">/// <span class="markdown"><span class="hljs-strong">****</span>可以配置 root<span class="hljs-strong">****</span></span></span>
          overlayLocation: OverlayChildLocation.rootOverlay,
          child: ElevatedButton(
            onPressed: () =&gt; _controller.toggle(),
            child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'点击显示浮层'</span>),
          ),
          overlayChildBuilder: (context, info) {
            <span class="hljs-keyword">return</span> Material(
              elevation: <span class="hljs-number">4</span>,
              color: Colors.white,
              shape: RoundedRectangleBorder(
                borderRadius: BorderRadius.circular(<span class="hljs-number">8</span>),
              ),
              child: Container(
                padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">12</span>),
                child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'这是一个浮层'</span>),
              ),
            );
          },
        ),
      ),
    );
  }
}


</code></pre>
<p><strong>通过 <code>overlayChildLayoutBuilder</code> 可以拿到主 Widget 的位置信息</strong>，可将浮层显示在任意屏幕位置，比如按钮下方、屏幕中心、或与鼠标位置对齐。</p>
<p>接着是在 Android 平台下，<strong>使用 <code>MaterialApp</code> 时默认启用了预测后退路由转场 (predictive back route transitions)，后退手势时能看到当前界面预览</strong>，此外默认页面转换已从 <code>ZoomPageTransitionsBuilder</code> 更新为 <code>FadeForwardsPageTransitionsBuilder</code> 。</p>
<p>然后就是久违的 PC 端更新，<strong>针对 Windows 桌面开发增强</strong>：可访问已连接显示器列表，并查询每个显示器的分辨率、刷新率、物理尺寸等属性，算是对多窗口模式的增强，例如 <code>PlatformDispatcher.displays </code>获取到 当前所有显示器：</p>
<pre><code class="hljs language-dart" lang="dart">
<span class="hljs-keyword">void</span> printDisplayInfos() {
  <span class="hljs-keyword">final</span> platformDispatcher = WidgetsBinding.instance.platformDispatcher;
  <span class="hljs-keyword">final</span> displays = platformDispatcher.displays;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> display <span class="hljs-keyword">in</span> displays) {
    <span class="hljs-keyword">final</span> id = display.id;
    <span class="hljs-keyword">final</span> size = display.size; <span class="hljs-comment">// Size in logical pixels</span>
    <span class="hljs-keyword">final</span> dpr = display.devicePixelRatio;
    <span class="hljs-keyword">final</span> refreshRate = display.refreshRate;
  }
}
</code></pre>
<p>同时，现在如果在  Widget 生命周期回调中发生的错误（例如 <code>didUpdateWidget</code>）可以更优雅地处理，防止它们在元素树中导致级联故障 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F173148" target="_blank" title="https://github.com/flutter/flutter/pull/173148" ref="nofollow noopener noreferrer">#173148</a>），以前如果开发者在这些回调中抛出了异常（哪怕只是一个小错误），<strong>整个元素树可能会进入不一致状态或直接崩溃</strong>。</p>
<p>而现在 Framework 在这些生命周期阶段调用时， <strong>将内部异常捕获包装在更安全的范围内</strong>，也就是说，如果你的某个子 Widget 在 <code>didUpdateWidget()</code> 抛出错误， Flutter 会：</p>
<ul>
<li>捕获这个错误；</li>
<li>上报给 Flutter 的全局错误处理系统（<code>FlutterError.onError</code>）；</li>
<li>允许其他 widget 正常 rebuild；</li>
<li>避免整个 Element Tree 出现「级联错误」(cascade failure)</li>
</ul>
<p>也就是让错误隔离更强，不再因为一个 widget 的生命周期异常破坏整个界面，而 IDE 中仍然能看到详细的异常栈，从而让应用的健壮性显著提升（尤其对热重载、动态组件更新等场景）。</p>
<p>最后是一些问题修复，例如：</p>
<ul>
<li>修复了之前 <code>ResizeImage</code> 的 <code>==</code> 和 <code>hashCode</code> 实现不正确的问题，在之前即使两个 <code>ResizeImage</code> 指向同一底层图像和相同尺寸， Flutter 也认为它们不相等</li>
<li>在 Web 上继续修复 <code>RSuperellipse</code>，以防止在角半径大于 Widget 本身 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F172254" target="_blank" title="https://github.com/flutter/flutter/pull/172254" ref="nofollow noopener noreferrer">#172254</a>） 时出现渲染错误</li>
<li>对于国际用户来说，检测浏览器的首选区域设置得到优化，引擎现在使用标准的 <code>Intl.Locale</code> Web API 来解析浏览器语言，取代了以前的手动实现 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F172964" target="_blank" title="https://github.com/flutter/flutter/pull/172964" ref="nofollow noopener noreferrer">#172964</a>）</li>
<li>修复了 Android 的特定错误 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F171973" target="_blank" title="https://github.com/flutter/flutter/pull/171973" ref="nofollow noopener noreferrer">#171973</a>） ，主要影响配备硬件键盘的三星设备，以前在用户与 <code>TextField</code> 交互后，Android 输入法编辑器 （IME） 可能会陷入过时状态，导致 IME 错误地拦截“Enter”或“Space”键按下，从而阻止非文本 Widget （如<code>复选框</code>或<code>单选</code>按钮）接收事件，而本次的修复可以确保在文本连接关闭时正确重置 <code>InputMethodManager</code>，清除 IME 的过时状态，并为用户还原可预测的硬件键盘交互</li>
</ul>
<h2 data-id="heading-3">Material 和 Cupertino  更新</h2>
<p>在弃用 <code>MaterialState</code> 的基础上，3.38 继续内部迁移到更统一的 <code>WidgetState</code>，这提供了一种更一致的方式来定义控件在不同交互状态（例如按下、悬停或禁用）中的外观，并且开发这不需要对现有应用代码进行更改。</p>
<p>3.38 开始恰迁移已逐步应用在各种 Widget 及其主题，包括 <code>IconButton</code>、<code>ElevatedButton</code>、<code>Checkbox</code> 和 <code>Switch</code> （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F173893" target="_blank" title="https://github.com/flutter/flutter/pull/173893" ref="nofollow noopener noreferrer">#173893</a>），新的 API 还增加了功能和灵活性，例如：</p>
<ul>
<li><code>IconButton</code> 现在包括一个 <code>statesController</code> 属性 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F169821" target="_blank" title="https://github.com/flutter/flutter/pull/169821" ref="nofollow noopener noreferrer">#169821</a>），允许以编程方式控制其视觉状态</li>
<li><code>Badge.count</code> 构造函数现在包含一个 <code>maxCount</code> 参数 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F171054" target="_blank" title="https://github.com/flutter/flutter/pull/171054" ref="nofollow noopener noreferrer">#171054</a>） ，可以限制显示的计数（例如，显示“99+”而不是“100”）</li>
<li>为了实现更细粒度的手势控制，<code>InkWell</code> 现在具有 <code>onLongPressUp</code> 回调 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F173221" target="_blank" title="https://github.com/flutter/flutter/pull/173221" ref="nofollow noopener noreferrer">#173221</a>），可用于触发仅在用户抬起手指时才相应完成</li>
<li>Cupertino 也继续朝着更好的 iOS 保真度迈进， <code>CupertinoSlidingSegmentedControl</code>  添加了<code>isMomentary</code> 属性 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F164262" target="_blank" title="https://github.com/flutter/flutter/pull/164262" ref="nofollow noopener noreferrer">#164262</a>） 以允许控件触发而不保留选择，为了更好地匹配原生 iOS 行为，<code>CupertinoSheet</code> 在完全展开时向上拖动时具有微妙的“拉伸”效果 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F168547" target="_blank" title="https://github.com/flutter/flutter/pull/168547" ref="nofollow noopener noreferrer">#168547</a>）<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/181c61a77436444bbd5b552065ad4f29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763594642&amp;x-signature=hW72opbkHzAt77Iiy4Z5uHqwvzc%3D" alt="" loading="lazy"/></li>
<li>修复 <code>DropdownMenuFormField</code> 在窗体重置时正确清除其文本字段 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F174937" target="_blank" title="https://github.com/flutter/flutter/pull/174937" ref="nofollow noopener noreferrer">#174937</a>）</li>
<li>更新 <code>SegmentedButton</code> 改进焦点处理 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F173953" target="_blank" title="https://github.com/flutter/flutter/pull/173953" ref="nofollow noopener noreferrer">#173953</a>） 并确保其边框正确反映 Widget 的状态 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F172754" target="_blank" title="https://github.com/flutter/flutter/pull/172754" ref="nofollow noopener noreferrer">#172754</a>）</li>
<li>滚动 (Scrolling) 和 Sliver 系列控件改进，例如 <code>SliverMainAxisGroup</code> / <code>SliverCrossAxisGroup</code> 在复杂滚动布局中手势处理、点击响应、焦点导航更可靠，例如：
<ul>
<li>对多个 sliver 进行分组的开发人员会发现手势处理现在更加可靠，现在可以正确计算这些组中细片上的点击和其他指针事件的命中测试，确保用户交互按预期运行 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F174265" target="_blank" title="https://github.com/flutter/flutter/pull/174265" ref="nofollow noopener noreferrer">#174265</a>）</li>
<li>在 <code>SliverMainAxisGroup</code>  使用固定标题时过度滚动的问题已得到解决 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F173349" target="_blank" title="https://github.com/flutter/flutter/pull/173349" ref="nofollow noopener noreferrer">#173349</a>），调用 <code>showOnScreen</code> 显示 sliver 现在可以正常工作 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F171339" target="_blank" title="https://github.com/flutter/flutter/pull/171339" ref="nofollow noopener noreferrer">#171339</a>），并且内部滚动偏移量计算更加精确 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F174369" target="_blank" title="https://github.com/flutter/flutter/pull/174369" ref="nofollow noopener noreferrer">#174369</a>）。</li>
<li>对于构建自定义滚动视图的开发人员来说，新的 <code>SliverGrid.list</code> 构造函数 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F173925" target="_blank" title="https://github.com/flutter/flutter/pull/173925" ref="nofollow noopener noreferrer">#173925</a>） 提供了一种更简洁的方法，可以从简单的子列表创建网格<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a326d1ec07d48c98bffe3ba138b3480~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763594642&amp;x-signature=rnmSehJhqnH8%2BBC5aR%2F9GiKZg6w%3D" alt="" loading="lazy"/></li>
</ul>
</li>
<li>另外还改进了复杂布局中键盘和方向键用户的焦点导航，在具有不同滚动轴的嵌套滚动视图（例如水平轮播的垂直列表）中，定向焦点导航现在更具可预测性，可防止焦点在部分之间意外跳转 <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48ea7a9bac734572a7190b652606ddeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763594642&amp;x-signature=kNKSWqEOGlDf98aJZhs%2FFkMFL0Q%3D" alt="" loading="lazy"/></li>
</ul>
<p>最后， Material 和 Cupertino 与框架的解耦还在继续，核心内容就是，<strong>解耦后需要作为第一方官方包发布</strong>，需要自动化语义化版本管理，避免冲突，支持自定义发布（如跳过特定提交、批量破坏性变更），采用“批量发布”（Batch Release），使用 Cocoon cron job 每周生成合并 PR；开发者通过 “commit消息、PR 标签或独立changelog 文件标记变更，首选选项为 PR 独立 changelog 文件，由 bot 合并等。</p>
<p>另外就是 Widgets测试不导入Material/Cupertino；Cupertino不导入Material，Material负责所有多库导入测试，包括 Cupertino 兼容性和自适应等。</p>
<p>以下是一些关于Material 和 Cupertino 与框架的一些关键讨论地址：</p>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.google.com%2Fdocument%2Fu%2F1%2Fd%2F18kjoP-4LAXEllugVOQRg6vZELyD6MuxlKilLD4lFxSY%2Fedit" target="_blank" title="https://docs.google.com/document/u/1/d/18kjoP-4LAXEllugVOQRg6vZELyD6MuxlKilLD4lFxSY/edit" ref="nofollow noopener noreferrer">docs.google.com/document/u/…</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.google.com%2Fdocument%2Fd%2F1jUoFaawutbYsCI5oY3pDP_l-xpv6FhDKlcI1-EoT02s%2Fedit%3Ftab%3Dt.0" target="_blank" title="https://docs.google.com/document/d/1jUoFaawutbYsCI5oY3pDP_l-xpv6FhDKlcI1-EoT02s/edit?tab=t.0" ref="nofollow noopener noreferrer">docs.google.com/document/d/…</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.google.com%2Fdocument%2Fd%2F1y38TN9AUTyd0eTbu4kx4FiNgfsLDPvWvi92Fv5HWFjQ%2Fedit%3Ftab%3Dt.0%23heading%3Dh.pub7jnop54q0" target="_blank" title="https://docs.google.com/document/d/1y38TN9AUTyd0eTbu4kx4FiNgfsLDPvWvi92Fv5HWFjQ/edit?tab=t.0#heading=h.pub7jnop54q0" ref="nofollow noopener noreferrer">docs.google.com/document/d/…</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.google.com%2Fdocument%2Fd%2F1UHxALQqCbmgjnM1RNV9xE2pK3IGyx-UktGX1D7hYCjs%2Fedit%3Ftab%3Dt.0" target="_blank" title="https://docs.google.com/document/d/1UHxALQqCbmgjnM1RNV9xE2pK3IGyx-UktGX1D7hYCjs/edit?tab=t.0" ref="nofollow noopener noreferrer">docs.google.com/document/d/…</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fissues%2F177028" target="_blank" title="https://github.com/flutter/flutter/issues/177028" ref="nofollow noopener noreferrer">github.com/flutter/flu…</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.google.com%2Fdocument%2Fd%2F1oFezK5leJzTWA5lsw3BQGx7gLbhpSL8dMleU3HD7bNY%2Fedit%3Ftab%3Dt.0" target="_blank" title="https://docs.google.com/document/d/1oFezK5leJzTWA5lsw3BQGx7gLbhpSL8dMleU3HD7bNY/edit?tab=t.0" ref="nofollow noopener noreferrer">docs.google.com/document/d/…</a></p>
</li>
</ul>
<h2 data-id="heading-4">Accessibility</h2>
<p>对于构建复杂应用的开发人员，3.38 引入了使用 <code>WidgetsFlutterBinding.instance.ensureSemantics</code>   （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F174163" target="_blank" title="https://github.com/flutter/flutter/pull/174163" ref="nofollow noopener noreferrer">#174163</a>） 在 iOS 上默认打开辅助功能的功能，调试辅助功能问题现在变得更加容易，因为 <code>debugDumpSemanticsTree</code> 包含额外的文本输入验证结果信息，以帮助更快地诊断问题 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F174677" target="_blank" title="https://github.com/flutter/flutter/pull/174677" ref="nofollow noopener noreferrer">#174677</a>）。</p>
<p>为了在基于 sliver 的滚动视图中实现高级可访问性，3.38 增加了新的 <code>SliverSemantics</code>  （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F167300" target="_blank" title="https://github.com/flutter/flutter/pull/167300" ref="nofollow noopener noreferrer">#167300</a>） ，与现有的 <code>Semantics</code>  非常相似，开发人员可以在 <code>CustomScrollView</code> 中使用 <code>SliverSemantics</code> 使用特定语义信息注释其 sliver 树的某些部分，这对于注释标题、分配语义角色以及为屏幕阅读器向 sliver 添加描述性标签特别有用，从而为用户提供更易于理解和访问的体验。</p>
<p>最后，核心 Widget 的可访问性不断完善，现在默认情况下可以访问 <code>CupertinoExpansionTile</code> （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F174480" target="_blank" title="https://github.com/flutter/flutter/pull/174480" ref="nofollow noopener noreferrer">#174480</a>），<code>AutoComplete</code> 现在向用户宣布搜索结果的状态 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F173480" target="_blank" title="https://github.com/flutter/flutter/pull/173480" ref="nofollow noopener noreferrer">#173480</a>）， <code>TimePicker</code> （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F170060" target="_blank" title="https://github.com/flutter/flutter/pull/170060" ref="nofollow noopener noreferrer">#170060</a>） 中有更大的触摸目标，有助于提供更易于访问的开箱即用体验。</p>
<h2 data-id="heading-5">iOS</h2>
<p>iOS 平台已经完整支持最新的 iOS 26、Xcode 26、macOS 26，特别是在命令行部署使用 <code>devicectl</code> 替代必须启动 Xcode App 的流程，现在 Flutter 3.38 可以在大多数情况下仅依赖于 Xcode26 命令行 构建工具，更多可见：</p>
<ul>
<li><a href="https://juejin.cn/post/7560986017034190891" target="_blank" title="https://juejin.cn/post/7560986017034190891">Flutter 在 iOS 26 模拟器跑不起来？其实很简单</a></li>
<li><a href="https://juejin.cn/post/7542461507402924075" target="_blank" title="https://juejin.cn/post/7542461507402924075">Flutter 完成全新 devicectl + lldb 的 Debug JIT 运行支持</a></li>
</ul>
<blockquote>
<p>虽然官方说完全支持，但是 iOS26 问题还是有的，例如：<a href="https://juejin.cn/post/7571306072423448618" target="_blank" title="https://juejin.cn/post/7571306072423448618">《来了解一下，为什么你的 Flutter WebView 在 iOS 26 上有点击问题？》</a></p>
</blockquote>
<p>另外 Flutter 3.38 包括了对 Apple 强制的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Ftechnotes%2Ftn3187-migrating-to-the-uikit-scene-based-life-cycle" target="_blank" title="https://developer.apple.com/documentation/technotes/tn3187-migrating-to-the-uikit-scene-based-life-cycle" ref="nofollow noopener noreferrer">UIScene 生命周期</a>的基本支持，这是继 Apple 在 WWDC25 上宣布之后的一次关键的主动更新：“在 iOS 26 之后的版本中，任何使用最新 SDK 构建的 UIKit 应用都将需要使用 UIScene 生命周期，否则它将不会启动”。</p>
<blockquote>
<p>详细可见：<a href="https://juejin.cn/post/7565733796269981738" target="_blank" title="https://juejin.cn/post/7565733796269981738">iOS 26 开始强制 UIScene ，你的 Flutter 插件准备好迁移支持了吗？</a> ，因为适配  UIScene 需要 迁移官方提供了手动迁移和自动迁移的支持，其中自动迁移需要配置 <code>flutter config --enable-uiscene-migration</code> ，更多迁移细节可见：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.dev%2Frelease%2Fbreaking-changes%2Fuiscenedelegate%23migration-guide-for-flutter-apps" target="_blank" title="https://docs.flutter.dev/release/breaking-changes/uiscenedelegate#migration-guide-for-flutter-apps" ref="nofollow noopener noreferrer">docs.flutter.dev/release/bre…</a></p>
</blockquote>
<p>对于 UIScene 支持，更致命的主要还是插件开发者，对于插件作者而言 <code>UIScene</code> 迁移带来了更大的挑战：<strong>必须确保插件既能在已经迁移到 <code>UIScene</code> 的新应用中正常工作，也要能在尚未迁移的旧应用或旧版 iOS 系统上保持兼容</strong>，例如：</p>
<ul>
<li>一个依赖生命周期事件的插件（例如，一个在应用进入后台时暂停视频播放的插件）不能简单地把监听代码从 <code>AppDelegate</code> 移到 <code>SceneDelegate</code>，这样做会导致它在未迁移的应用中完全失效，因此插件必须能够同时处理两种生命周期模型</li>
<li>具体插件迁移步骤：
<ul>
<li><strong>注册场景事件监听</strong>：在插件的 <code>register(with registrar: FlutterPluginRegistrar)</code> 方法中，除了像以前一样通过 <code>registrar.addApplicationDelegate(self)</code> 注册 <code>AppDelegate</code> 事件监听外，还需要调用新的 API 来注册 <code>SceneDelegate</code> 事件的监听，Flutter 提供了相应的机制让插件可以接收到场景生命周期的回调</li>
<li><strong>实现双重生命周期处理</strong>：插件内部需要实现 <code>UISceneDelegate</code> 协议中的相关方法，在实现时要设计一种优雅降级的逻辑。例如同时实现 <code>applicationDidEnterBackground</code> 和 <code>sceneDidEnterBackground</code>，当 <code>sceneDidEnterBackground</code> 被调用时，执行相应逻辑并设置一个标志位，以避免 <code>applicationDidEnterBackground</code>中的逻辑重复执行（如果它也被意外调用的话）</li>
<li><strong>更新废弃的 API 调用</strong>：插件代码中任何对 <code>UIApplication.shared.keyWindow</code> 或其他与单一窗口相关的废弃 API 的调用都必须被替换</li>
</ul>
</li>
</ul>
<h2 data-id="heading-6">Android</h2>
<p>升级到 Flutter 3.38 是满足 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fguide%2Fpractices%2Fpage-sizes" target="_blank" title="https://developer.android.com/guide/practices/page-sizes" ref="nofollow noopener noreferrer">Google Play 16 KB 页面大小兼容性要求</a>的重要准备工作， 因为 3.38 的更改可确保你的应用在高 RAM 设备上正常运行，并提供性能优势，例如启动速度提高多达 30%。</p>
<blockquote>
<p>Flutter 3.38 将默认的 Android ndkVersion 更新为 NDK r28，这是原生代码实现 16 KB 支持正确对齐所需的最低要求。</p>
</blockquote>
<p>Flutter 3.38 还<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fissues%2F173770" target="_blank" title="https://github.com/flutter/flutter/issues/173770" ref="nofollow noopener noreferrer">修复（#173770）</a>了影响 Android 上所有 Flutter 应用的严重内存泄漏，该问题在 3.29.0 中引入，发生在退出时销毁 Activity 时出现。</p>
<p>对于 Flutter 3.38 版本，Android 环境目前的推荐配置：</p>
<ul>
<li><strong>Java 17</strong>：Flutter 3.38 中 Android 开发所需的最低版本</li>
<li><strong>KGP 2.2.20</strong>：该工具已知且支持]的最大 Kotlin Gradle 插件版本</li>
<li><strong>AGP 8.11.1</strong>：与 KGP 2.2.20 兼容的最新 Android Gradle 插件版本</li>
<li><strong>Gradle 8.14</strong>：此版本适用于所选版本的 Java、KGP 和 AGP，请注意 Gradle 8.13 是 AGP 8.11.1 所需的最低版本。</li>
</ul>
<p>为确保应用在 Flutter 版本之间无缝运行，强烈建议在构建文件中使用 Flutter SDK 提供的 API 级变量：</p>
<ul>
<li><code>flutter.compileSdkVersion</code> (API 36)</li>
<li><code>flutter.targetSdkVersion</code> (API 36)</li>
<li><code>flutter.minSdkVersion</code> (API 24) or higher</li>
</ul>
<h2 data-id="heading-7">Engine</h2>
<p>performance overlay  已经重构，现在提高效率的同时，减少了 Skia 和 Impeller 后端的渲染时间，这意味着可以以更少的开销获得更准确的性能数据。</p>
<p>对 Vulkan 和 OpenGL ES 后端的大量修复和改进提高了更广泛设备上的稳定性和性能，包括更好地处理管道缓存 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F176322" target="_blank" title="https://github.com/flutter/flutter/pull/176322" ref="nofollow noopener noreferrer">#176322</a>）、fence waiters （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F173085" target="_blank" title="https://github.com/flutter/flutter/pull/173085" ref="nofollow noopener noreferrer">#173085</a>） 和 image layout transitions （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F173884" target="_blank" title="https://github.com/flutter/flutter/pull/173884" ref="nofollow noopener noreferrer">#173884</a>）。</p>
<p>另外对于 Web，继续统一 CanvasKit 和 Skwasm 渲染器的工作，3.38 包括了它们的重大重构，以在两者之间共享更多代码，这将在未来带来更一致的体验和更快的开发 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F174588" target="_blank" title="https://github.com/flutter/flutter/pull/174588" ref="nofollow noopener noreferrer">#174588</a>）。</p>
<h4 data-id="heading-8">重点重点重点：iOS 和 Android 中已删除选择退出线程合并的功能。</h4>
<h2 data-id="heading-9">DevTools 和 IDE</h2>
<p>Flutter 3.35 引入了 Widget Previews，而 Flutter 3.38 版本对 Widget Previews 进行了重大改进，包括 VSCode 和 Intellij / Android Studio 插件都已更新，初步支持 Widget Previews ，<strong>可以直接在 IDE 中查看预览</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11176c554cdf463c8fee3a7effa04f19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763594642&amp;x-signature=%2B6oPANPXZtBEyHElel3UFlg0htg%3D" alt="" loading="lazy"/></p>
<p>在 IDE 中使用时，默认情况下  Widget Previews  环境配置为根据当前选定的源文件过滤显示的预览：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ba377af0ca5477fa9c6d7cef3aa0ec0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763594642&amp;x-signature=B1Iedivs7mtdZmkwduZz9aqeaU0%3D" alt="" loading="lazy"/></p>
<p>另外，Widget Previews  现在支持浅色和深色模式，以及自定义 IDE 配色方案以匹配开发环境，控件预览环境中的控件也进行了调整，以使用更少的空间，从而为渲染预览留出更多空间。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5781a9920d3b44b79435f1b2e9308df3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763594642&amp;x-signature=LKoXrgz6I1sA%2B4WXxbJcKmgkJg8%3D" alt="" loading="lazy"/></p>
<p>此外，览批注类不再标记为最终批注，现在可以扩展以创建自定义预览批注，从而减少常见预览类型的样板：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c71ad26d4124abfa90a53890136bcdb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763594642&amp;x-signature=cCVblZ%2BIGB2wwdcU3mnYeo296xM%3D" alt="" loading="lazy"/></p>
<p>并且新的 <code>MultiPreview</code> 基类允许从单个自定义注释创建多个预览变体：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8083a9e09ad4662b1e36f8b42a5c41f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763594642&amp;x-signature=cE52N522gxGE6kBIKeGTEkXE9gY%3D" alt="" loading="lazy"/></p>
<p><code>Preview</code> 类中的新 group 参数允许对相关预览进行分组，减少了对 <code>@Preview</code> 注释参数的限制，支持私有常量作为 <code>Preview</code> 注释的参数等。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ddf13e2bbbb54de2a1c74433bdcc8d49~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763594642&amp;x-signature=C5yTEtZHbMR26QKNEwL3alvsY6U%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>目前关于预览还有一些问题，例如 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fissues%2F178317" target="_blank" title="https://github.com/flutter/flutter/issues/178317" ref="nofollow noopener noreferrer">#178317</a> ，例如 Widget 预览器可能会在 <em>flutter pub get</em>  后崩溃或停止更新。</p>
</blockquote>
<p>其他关于 Tool 更新还有：</p>
<ul>
<li>Flutter DevTools Widget Inspector 正在增加支持适配预览</li>
<li>IDE 中预览的多项目支持：预览目前仅支持显示单个项目或 Pub 工作区中包含的预览，多项目正在支持</li>
<li>正在推进预览的性能改进的机会，以减少初始启动时间</li>
<li>Network Panel 的交互改进</li>
<li>Flutter Inspector 修复了选择 Widget 有时会打开底层框架源代码而不是用户源代码的错误</li>
<li>修复了 Flutter Inspector  偶尔阻止与“检查器”面板中的顶部按钮交互的错误</li>
</ul>
<h2 data-id="heading-10">弃用和重大变更</h2>
<p>首先，3.38 进行了可能影响自定义生成脚本的关键生成和工具更改，<strong>Flutter SDK 根目录的 <code>version</code> 文件已被删除</strong>，取而代之的是位于 <code>bin/cache</code> （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F172793" target="_blank" title="https://github.com/flutter/flutter/pull/172793" ref="nofollow noopener noreferrer">#172793</a>） 中的新 <code>flutter.version.json</code> 文件，此外默认情况下不再生成 <code>AssetManifest.json</code> 文件 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F172594" target="_blank" title="https://github.com/flutter/flutter/pull/172594" ref="nofollow noopener noreferrer">#172594</a>）。</p>
<p>另外还有：</p>
<ul>
<li>对于  predictable behavior，包含作的 SnackBar 将不再自动关闭 （<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F173084" target="_blank" title="https://github.com/flutter/flutter/pull/173084" ref="nofollow noopener noreferrer">#173084</a>）</li>
<li>前面介绍过的 <code>OverlayPortal.targetsRootOverlay</code> 构造函数已被弃用，取而代之的是更灵活的 <code>OverlayPortal</code>（ <code>overlayLocation: OverlayChildLocation.rootOverlay</code> ）</li>
<li><code>CupertinoDynamicColor</code> 上的几个属性（例如 <code>withAlpha</code> 和 <code>withOpacity</code>）现在已弃用，取而代之的是标准 <code>Color</code> 方法</li>
<li>Flutter 3.38 要求 Java 17 作为 Android 的最低版本，符合 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.gradle.org%2Fcurrent%2Fuserguide%2Fcompatibility.html" target="_blank" title="https://docs.gradle.org/current/userguide/compatibility.html" ref="nofollow noopener noreferrer">Gradle 8.14</a>（2025 年 7 月版）的最低要求</li>
</ul>
<h2 data-id="heading-11">最后</h2>
<p>本次 3.38 的更新还是挺丰富的，同时也是一个不得不升级的版本，<strong>不管是为了 iOS 26 适配和未来上架，还是为了安卓更稳定的 16KB 体验，这都是一个不得不升级的版本</strong>。</p>
<p>那么大家准备好直接吃 3.38.0 的螃蟹还是等 3.38.6 ?</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[重磅更新！满血GPT-5.1上线，全方位提升，很强]]></title>    <link>https://juejin.cn/post/7572137760447889449</link>    <guid>https://juejin.cn/post/7572137760447889449</guid>    <pubDate>2025-11-14T07:35:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572137760447889449" data-draft-id="7572147440314384447" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="重磅更新！满血GPT-5.1上线，全方位提升，很强"/> <meta itemprop="keywords" content="OpenAI,ChatGPT"/> <meta itemprop="datePublished" content="2025-11-14T07:35:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哪吒编程"/> <meta itemprop="url" content="https://juejin.cn/user/581021766790141"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            重磅更新！满血GPT-5.1上线，全方位提升，很强
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/581021766790141/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哪吒编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T07:35:45.000Z" title="Fri Nov 14 2025 07:35:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/915d880e9d2c44f6bfb7dac777574386~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOq5ZCS57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710545&amp;x-signature=rQpi2a%2FJ%2Frrh0sz95ixbttcGKeM%3D" alt="" loading="lazy"/></p>
<p>北京时间11月12日，OpenAI发布最新旗舰模型GPT-5.1，官方表示“GPT-5.1：更智能、更具对话性的聊天GPT”。</p>
<p>首先面向付费用户（Pro、Plus、Business）使用。</p>
<p>GPT-5.1 将成为唯一的默认模型，也就是GPT-5已经成为历史。</p>
<h2 data-id="heading-0">此次更新，最主要的两大模型：</h2>
<p><strong>GPT-5.1</strong> 的回答也更加清晰，减少了专业术语和未定义词汇的使用。这使得我们功能最强大的模型更易于理解和使用，尤其适用于工作中的复杂任务和解释技术概念。</p>
<p><strong>GPT-5.1 Thinking</strong> 能更精准地根据问题调整思考时间，在处理复杂问题时投入更多时间，而在处理简单问题时则更快响应。实际应用中，这意味着对于难题，它能给出更详尽的答案；而对于简单问题，它则能更快地给出响应。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cefaba116e34bf081c1dddb62ff592a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOq5ZCS57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710545&amp;x-signature=cVMPouApyoBduSvQ38NNAr6aFV8%3D" alt="" loading="lazy"/></p>
<p>如图所示，GPT-5.1 Thinking 在速度最快的任务上的速度大约是 GPT-5 Thinking 的两倍，而在速度最慢的任务上的速度则大约是 GPT-5 Thinking 的两倍。</p>
<h2 data-id="heading-1">国内直接使用GPT-5.1</h2>
<p>谷歌浏览器访问：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nezhasoft.cloud" target="_blank" title="https://www.nezhasoft.cloud" ref="nofollow noopener noreferrer">www.nezhasoft.cloud</a></p>
<p><strong>私信哪吒，备注体验ai，领取体验码。</strong></p>
<p>包含GPT-5.1、GPT-5.1 Thinking、Codex、Claude Sonnet 4.5、Gemini 2.5 Pro、Grok4、DeepSeek R1 0528等模型。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8fea4b5498f94aff9e9d6faf2815c5d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOq5ZCS57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710545&amp;x-signature=77OQSzFikAwBLUaqG%2BOchOoKb6c%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">GPT5.1升级了哪些内容：</h2>
<h3 data-id="heading-3">1、化整为零，统一入口</h3>
<p>对于大多数人：打开 ChatGPT 就是在用 GPT-5.1，不需要任何额外操作。</p>
<p>GPT-5.1会根据问题的复杂程度，自动切换GPT-5.1 Thinking。</p>
<h3 data-id="heading-4">2、推理能力大升级</h3>
<p>在 GPT-5 的系统卡里，官方强调它在编码、写作、医疗等真实任务里的表现显著提升，尤其在 “减少幻觉、提高遵守指令、减少阿谀奉承” 上做了大量训练。</p>
<p>GPT-5.1 在此基础上，做了两件关键事：</p>
<ol>
<li>
<p>推理更“自适应”：遇到复杂问题会“自动想久一点”，而不是一刀切地要你自己选“推理模型”。</p>
</li>
<li>
<p>推理过程可感知：</p>
<ul>
<li>有一个简化的“chain of thought” 展示，让普通用户感知到“它现在正在认真想”。</li>
<li>给你一个“Answer now”按钮，把控制权交回给你。</li>
</ul>
</li>
</ol>
<p>这不仅是交互设计上的改进，也是一种“让模型推理过程对用户半透明”的尝试。</p>
<h3 data-id="heading-5">3、上下文长度</h3>
<p>Fast / Instant：免费用户到 16K，Plus/Business 到 32K，Pro/Enterprise 可到 128K。</p>
<p>Thinking：付费用户可用到 196K 级别的长对话（也就是可以塞非常长的文档和上下文）。</p>
<h3 data-id="heading-6">4、工具支持“一把梭”：全功能都能用</h3>
<p>在 ChatGPT 里，GPT-5.1 支持所有工具：</p>
<ul>
<li>搜索网页</li>
<li>数据分析（含表格、代码执行）</li>
<li>图像分析</li>
<li>文件分析</li>
<li>生成图片</li>
<li>记忆（Memory）</li>
<li>自定义指令 / 人格</li>
</ul>
<h3 data-id="heading-7">5、安全升级</h3>
<p>在 GPT-5 的介绍和系统卡中，OpenAI 引入了新的 “安全完成（safe completion）” 训练框架：</p>
<p>遇到双重用途问题（比如生物实验、敏感技术），不是简单一刀切拒绝；而是尽量在安全边界内提供有帮助的高层次信息，必要时再拒绝，并说明原因。</p>
<p>同时他们还专门对“过度奉承”做了评估和校正：把那种一味顺着你、到处用 emoji 的风格砍掉一大半。</p>
<p>GPT-5.1 延续并加强了这条线：</p>
<p>在 Thinking 模式下，更多强调 严谨和可解释，减少“你想听什么我就说什么”。</p>
<h2 data-id="heading-8">GPT-5.1初体验</h2>
<h3 data-id="heading-9">用户真实体验：gpt5.1强大到令人难以置信</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2aa5612fd8e4b52b8173a9d34b7e1ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOq5ZCS57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710545&amp;x-signature=7Sb1ebXIdbprKNB5mGUjVsdcxbA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">1、版本号</h3>
<p>你是什么模型，具体是什么版本号，知识截止日期是几号</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/978e9cd77743486cbfab273c172eebf9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOq5ZCS57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710545&amp;x-signature=rtxOhwLKE4Toeg5dncpRBwpD8g0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">2、联网实时查询</h3>
<p>2024年诺贝尔文学奖得主都有谁?</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc48ac6da78d4238bb0122b2b768dd47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOq5ZCS57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710545&amp;x-signature=iA2WMI7DGskX%2BJozN011Fj4MR%2Fc%3D" alt="查询的是维基百科" loading="lazy"/></p>
<p>查询的是维基百科</p>
<h3 data-id="heading-12">3、写作</h3>
<p>在写作生成（包括创意写作、常规内容、对话生成）方面，GPT-5.1 被描述为“更有人情味”“更像人对话”——比 GPT-5 更擅长维持自然语气、亲和交互。</p>
<p>全国一卷作文题目："民族魂"</p>
<p>材料内容：</p>
<p>"他想要给孩子们唱上一段，可是心里直翻腾，开不了口。" ——老舍《鼓书艺人》 "假如我是一只鸟，我也应该用嘶哑的喉咙歌唱" ——艾青《我爱这土地》 "我要以带血的手和你们一一拥抱，因为一个民族已经起来" ——穆旦《赞美》</p>
<p>写作要求： 以上材料引发了你怎样的联想和思考？请写一篇文章。要求选准角度，确定立意，明确文体，自拟标题；不要套作，不得抄袭；不得泄露个人信息；不少于800字。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de626b2ee5ac4dec9f3da3fb9f1be2f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOq5ZCS57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710545&amp;x-signature=G3dgXmdAzU8NuhOBmL4jckgIsEI%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-13">4、编程</h3>
<p>GPT-5.1 在消息中被指出有“推理”与“思考”能力进一步强化，这意味着在编程场景（例如多步逻辑、复杂函数、API组合）可能表现更佳。</p>
<p>请用 Java 设计并实现一个支持高并发的电商微服务系统（基于 Spring Boot/Spring Cloud），要求包含订单、库存等服务，需解决分布式事务与超卖问题，使用 Redis/Kafka 进行异步解耦，并提供核心代码、配置及部署方案，同时说明高并发优化与容错限流设计思路。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a8461f99bc642d7b6068c224d25b966~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOq5ZCS57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710545&amp;x-signature=pKm55loIh2XEjlAyzMC8Z54x1ow%3D" alt="根据问题复杂度，开启thinking模式" loading="lazy"/></p>
<p>根据问题复杂度，开启thinking模式</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1012d5df366c4b199bb49cbc1c974b80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOq5ZCS57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710545&amp;x-signature=lDwqjvdpLHbOfMpo5uIzM%2FlNOHs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-14">5、多模态-识别图片</h3>
<p>GPT-5.1 被报道支持 “更长上下文”，尤其在复杂任务中能投入“深度思考”，暗示识别图片、读取/理解大型文档、长对话历史、甚至多文件场景时更强。</p>
<p>随机搜索一道考研数学真题。</p>
<p>解答此题，给出答案和解题思路</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9e67e70e55146dc93796916479eb87b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOq5ZCS57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710545&amp;x-signature=ld9VGHA%2Bm8SFxheJUKuMFm7sW8U%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-15">6、上传文件</h3>
<p>分别总结文件内容，2000字，中文回答</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7dfa2e7b45874808b352b7aa72ae255d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOq5ZCS57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710545&amp;x-signature=2nrgBx2QYYBqaJgiieyCnGHPlH4%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Dart 3.10 发布，快来看有什么更新吧]]></title>    <link>https://juejin.cn/post/7571693273728942116</link>    <guid>https://juejin.cn/post/7571693273728942116</guid>    <pubDate>2025-11-13T01:20:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571693273728942116" data-draft-id="7571731181197459492" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Dart 3.10 发布，快来看有什么更新吧"/> <meta itemprop="keywords" content="前端,Android,Flutter"/> <meta itemprop="datePublished" content="2025-11-13T01:20:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="恋猫de小郭"/> <meta itemprop="url" content="https://juejin.cn/user/817692379985752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Dart 3.10 发布，快来看有什么更新吧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692379985752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    恋猫de小郭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-13T01:20:12.000Z" title="Thu Nov 13 2025 01:20:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>和 <a href="https://juejin.cn/post/7571693273728696356" target="_blank" title="https://juejin.cn/post/7571693273728696356">Flutter 3.38</a> 一起更新的还有 Dart 3.10 ，同 Flutter 3.38 一样，Dart 3.10 也带来比较丰富的更新，其中包括 dot shorthands、Analyzer plugins、Build hooks、Deprecation annotations 和 pub.dev 更新。</p>
<h2 data-id="heading-0">Dot shorthands</h2>
<p>Dart 3.10 引入了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdart.dev%2Flanguage%2Fdot-shorthands" target="_blank" title="https://dart.dev/language/dot-shorthands" ref="nofollow noopener noreferrer"><strong>dot shorthands</strong></a>，这项新特性允许开发者在编译器能够从上下文推断出类型时，省略冗余的类名或枚举名，例如：</p>
<pre><code class="hljs language-markdown" lang="markdown">/<span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span>3.10 之前<span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-emphasis">*/
​
enum LogLevel { info, warning, error, debug }
​
void logMessage(String message, {LogLevel level = LogLevel.info}) {
  // ... implementation
}
​
// Somewhere else in your app
logMessage('Failed to connect to database', level: LogLevel.error);
​
​
/<span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span>Dot shorthands<span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span>*</span>/
​
enum LogLevel { info, warning, error, debug }
​
void logMessage(String message, {LogLevel level = .info}) {
  // ... implementation
}
​
// Somewhere else in your app
logMessage('Failed to connect to database', level: .error);
</code></pre>
<p>Dot shorthands 不仅仅用于枚举类型，你还可以将它们用于构造函数、静态方法和静态字段，例如：</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-comment">// Use dot shorthand syntax on enums:</span>
<span class="hljs-keyword">enum</span> <span class="hljs-type">Status</span> { none, running, stopped, paused }
​
<span class="hljs-type">Status</span> currentStatus = .running; <span class="hljs-comment">// Instead of Status.running</span>
​
<span class="hljs-comment">// Use dot shorthand syntax on a static method:</span>
int port = .parse('<span class="hljs-number">8080</span>'); <span class="hljs-comment">// Instead of int.parse('8080')</span>
​
<span class="hljs-comment">// Uses dot shorthand syntax on a constructor:</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Point</span> </span>{
  <span class="hljs-keyword">final</span> int x, y;
  <span class="hljs-type">Point</span>(<span class="hljs-keyword">this</span>.x, <span class="hljs-keyword">this</span>.y);
  <span class="hljs-type">Point</span>.origin() : x = <span class="hljs-number">0</span>, y = <span class="hljs-number">0</span>;
}
​
<span class="hljs-type">Point</span> origin = .origin(); <span class="hljs-comment">// Instead of Point.origin()</span>
​
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_PageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State&lt;Page&gt;</span> </span>{
  late <span class="hljs-keyword">final</span> <span class="hljs-type">AnimationController</span> _animationController = .<span class="hljs-keyword">new</span>(vsync: <span class="hljs-keyword">this</span>);
  <span class="hljs-keyword">final</span> <span class="hljs-type">ScrollController</span> _scrollController = .<span class="hljs-keyword">new</span>();
  <span class="hljs-keyword">final</span> <span class="hljs-type">GlobalKey</span>&lt;<span class="hljs-type">ScaffoldMessengerState</span>&gt; scaffoldKey = .<span class="hljs-keyword">new</span>();
  <span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, bool&gt;&gt; properties = .<span class="hljs-keyword">new</span>();
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<blockquote>
<p>更多可见：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdart.dev%2Flanguage%2Fdot-shorthands" target="_blank" title="https://dart.dev/language/dot-shorthands" ref="nofollow noopener noreferrer">dart.dev/language/do…</a> ，这个我们在之前的 <a href="https://juejin.cn/post/7500234308432445451" target="_blank" title="https://juejin.cn/post/7500234308432445451">《Flutter 合并 'dot-shorthands' 语法糖》</a>也聊过。</p>
</blockquote>
<h2 data-id="heading-1">Analyzer plugins</h2>
<p>Dart 3.10 为 Dart 分析器引入了全新插件系统，开发者现在可以编写和使用自己的静态分析规则，并将其直接集成到 IDE 和命令行工具（例如 <code>dart analyze</code> 和 <code>flutter analyze</code>） 中，例如：</p>
<ul>
<li>强制执行项目特定的规则，例如定制的代码检查和警告，以维护团队代码库中的规范</li>
<li>避免常见陷阱，并遵循开发者所在领域的最佳实践</li>
<li>通过提供快速修复和辅助功能，实现代码更改自动化，从而帮助自动纠正问题或迁移到新的 API</li>
</ul>
<p>要使用分析器插件，只需将配置添加到 <code>analysis_options.yaml</code> 文件中即可：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">analyzer:</span>
  <span class="hljs-attr">plugins:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">some_plugin</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">another_plugin</span>
</code></pre>
<p>Analyzer plugins扩展了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdart.dev%2Ftools%2Fanalysis" target="_blank" title="https://dart.dev/tools/analysis" ref="nofollow noopener noreferrer">Dart Analyzer的</a>功能，从而能够报告自定义信息，诊断功能（包括代码检查和警告）提供快速修复方案。，并提供辅助功能。</p>
<blockquote>
<p>详细可见：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdart.dev%2Ftools%2Fanalyzer-plugins" target="_blank" title="https://dart.dev/tools/analyzer-plugins" ref="nofollow noopener noreferrer">dart.dev/tools/analy…</a></p>
</blockquote>
<h2 data-id="heading-2">Build hooks</h2>
<p>这个我们在之前的 <a href="https://juejin.cn/post/7521356618174545962" target="_blank" title="https://juejin.cn/post/7521356618174545962">《Flutter 里的 Asset Transformer 和 Hooks》</a> 我们也聊过，它支持将原生代码（例如 C++、Rust 或 Swift）集成到 Dart 包中通常需要管理复杂的、特定于平台的构建文件，例如 CMake 或 Gradle，而 Dart 3.10 大大简化了这一过程。</p>
<p>目前 Build hooks 已经稳定，可以使用 hooks 编译原生代码或下载原生资源（例如动态库），并将它们直接打包到的 Dart 包中。</p>
<blockquote>
<p>这项功能让开发者在包内重用现有的原生代码或库，无需为不同的操作系统编写单独的构建文件，例如 SPM、Gradle 或 CMake。</p>
</blockquote>
<pre><code class="hljs language-scss" lang="scss">example_project/
    <span class="hljs-comment">// Project with hooks.</span>
    hook/
        <span class="hljs-comment">// Add hook scripts here.</span>
        build<span class="hljs-selector-class">.dart</span>
    lib/
        <span class="hljs-comment">// Use your assets here.</span>
        example<span class="hljs-selector-class">.dart</span>
    <span class="hljs-attribute">src</span>/
        <span class="hljs-comment">// Add native sources here.</span>
        example_native_library<span class="hljs-selector-class">.c</span>
        example_native_library<span class="hljs-selector-class">.h</span>
    test/
    <span class="hljs-comment">// Test your assets here.</span>
        example_test<span class="hljs-selector-class">.dart</span>
</code></pre>
<p>Build hooks 在每个包含原生代码的 Dart 包，会根据 Dart/Flutter 构建系统提供的配置，对包内的原生源代码（例如 C、C++、Rust 代码）进行编译、构建成目标平台可用的 Asset ，而这些 Asset 通常是动态链接库（如 <code>.so</code>, <code>.dll</code>, <code>.dylib</code>）或静态链接库（<code>.a</code>, <code>.lib</code>）</p>
<blockquote>
<p>也就是可以在插件里提供原生代码，然后最终跟随 App 再编译成平台库，这对于原生互操作场景也很重要。</p>
</blockquote>
<p>例如下方就是一个简单的 hook build 示例，其中构建了 3 个原生库，并且还存在依赖关系：</p>
<pre><code class="hljs language-php" lang="php">import <span class="hljs-string">'package:hooks/hooks.dart'</span>;
import <span class="hljs-string">'package:logging/logging.dart'</span>;
import <span class="hljs-string">'package:native_toolchain_c/native_toolchain_c.dart'</span>;
​
<span class="hljs-keyword">void</span> <span class="hljs-title function_ invoke__">main</span>(List&lt;String&gt; args) async {
  await <span class="hljs-title function_ invoke__">build</span>(args, (input, output) async {
    <span class="hljs-keyword">final</span> logger =
        <span class="hljs-title function_ invoke__">Logger</span>(<span class="hljs-string">''</span>)
          ..level = Level.ALL
          ..onRecord.<span class="hljs-title function_ invoke__">listen</span>((record) =&gt; <span class="hljs-keyword">print</span>(record.message));
​
    <span class="hljs-keyword">final</span> builders = [
      CBuilder.<span class="hljs-title function_ invoke__">library</span>(
       <span class="hljs-attr"> name</span>: <span class="hljs-string">'debug'</span>,
       <span class="hljs-attr"> assetName</span>: <span class="hljs-string">'debug'</span>,
       <span class="hljs-attr"> sources</span>: [<span class="hljs-string">'src/debug.c'</span>],
      ),
      CBuilder.<span class="hljs-title function_ invoke__">library</span>(
       <span class="hljs-attr"> name</span>: <span class="hljs-string">'math'</span>,
       <span class="hljs-attr"> assetName</span>: <span class="hljs-string">'math'</span>,
       <span class="hljs-attr"> sources</span>: [<span class="hljs-string">'src/math.c'</span>],
       <span class="hljs-attr"> libraries</span>: [<span class="hljs-string">'debug'</span>],
      ),
      CBuilder.<span class="hljs-title function_ invoke__">library</span>(
       <span class="hljs-attr"> name</span>: <span class="hljs-string">'add'</span>,
       <span class="hljs-attr"> assetName</span>: <span class="hljs-string">'add.dart'</span>,
       <span class="hljs-attr"> sources</span>: [<span class="hljs-string">'src/add.c'</span>],
       <span class="hljs-attr"> libraries</span>: [<span class="hljs-string">'math'</span>],
      ),
    ];
​
    <span class="hljs-comment">// Note: These builders need to be run sequentially because they depend on</span>
    <span class="hljs-comment">// each others output.</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> builder in builders) {
      await builder.<span class="hljs-title function_ invoke__">run</span>(<span class="hljs-attr">input</span>: input, <span class="hljs-attr">output</span>: output, <span class="hljs-attr">logger</span>: logger);
    }
  });
}
​
</code></pre>
<blockquote>
<p>更多详细可见：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdart.dev%2Ftools%2Fhooks" target="_blank" title="https://dart.dev/tools/hooks" ref="nofollow noopener noreferrer">dart.dev/tools/hooks</a></p>
</blockquote>
<h2 data-id="heading-3">移除弃用项 lint</h2>
<p>发布软件包的新主要版本（例如 1.0.0 或 0.2.0）时，最佳实践是移除之前标记为已弃用的 API，这可以保持软件包的整洁，并防止开发人员使用过时的代码，然而在发布过程中很容易忘记这一步骤。</p>
<p>为了解决这个问题，Dart 3.10 引入了一个新的代码检查工具： <code>remove_deprecations_in_breaking_versions</code> ，当软件包版本更新到新的主要版本时，该工具会检测遗留的已弃用元素，通过标记这些情况，该工具可以帮助确保软件包的 API 保持现代化，并易于用户理解。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48257de784fa4b0d8943d8f793725f7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763601611&amp;x-signature=axlQfWvjI3jNR%2BU8sl0BLL1%2BDGI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">Deprecated annotation</h2>
<p>现有的 <strong>@Deprecated</strong> 注解过于简单粗暴，它虽然告知开发者某个 API 已不再推荐使用，但无法体现细微差别，例如：</p>
<blockquote>
<p>如何表明某个类不应再被扩展，但仍然可以被实例化？</p>
</blockquote>
<p>为了让软件包作者能够更精确地控制其 API 的演变，Dart 3.10 引入了一套新的、更具体的弃用注释：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.dart.dev%2Fdev%2Flatest%2Fdart-core%2FDeprecated%2FDeprecated.extend.html" target="_blank" title="https://api.dart.dev/dev/latest/dart-core/Deprecated/Deprecated.extend.html" ref="nofollow noopener noreferrer">@Deprecated.extend()</a>: 扩展类的功能已弃用</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.dart.dev%2Fdev%2Flatest%2Fdart-core%2FDeprecated%2FDeprecated.implement.html" target="_blank" title="https://api.dart.dev/dev/latest/dart-core/Deprecated/Deprecated.implement.html" ref="nofollow noopener noreferrer">@Deprecated.implement()</a>: 实现类或 mixin 的功能已弃用</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.dart.dev%2Fdev%2Flatest%2Fdart-core%2FDeprecated%2FDeprecated.subclass.html" target="_blank" title="https://api.dart.dev/dev/latest/dart-core/Deprecated/Deprecated.subclass.html" ref="nofollow noopener noreferrer">@Deprecated.subclass()</a>: 继承（扩展或实现）类或 mixin 的功能已被弃用</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.dart.dev%2Fdev%2Flatest%2Fdart-core%2FDeprecated%2FDeprecated.mixin.html" target="_blank" title="https://api.dart.dev/dev/latest/dart-core/Deprecated/Deprecated.mixin.html" ref="nofollow noopener noreferrer">@Deprecated.mixin()</a>: 类中使用 mixin 功能已被弃用</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.dart.dev%2Fdev%2Flatest%2Fdart-core%2FDeprecated%2FDeprecated.instantiate.html" target="_blank" title="https://api.dart.dev/dev/latest/dart-core/Deprecated/Deprecated.instantiate.html" ref="nofollow noopener noreferrer">@Deprecated.instantiate()</a>: 实例化类的功能已弃用</li>
</ul>
<p>此外，现在可以使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.dart.dev%2Fdev%2Flatest%2Fdart-core%2FDeprecated%2FDeprecated.optional.html" target="_blank" title="https://api.dart.dev/dev/latest/dart-core/Deprecated/Deprecated.optional.html" ref="nofollow noopener noreferrer">@Deprecated.optional()</a> 来表明可选参数在未来的版本中将成为必需参数。</p>
<h2 data-id="heading-5">Pub 更新</h2>
<p>在 pub.dev 上管理收藏的软件包的功能迎来了重大升级，现在可以通过搜索功能或个人资料中的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fmy-liked-packages" target="_blank" title="https://pub.dev/my-liked-packages" ref="nofollow noopener noreferrer">Likes tab</a> 进行管理， 可以使用与常规搜索相同的熟悉控件来搜索、排序和筛选收藏的软件包。</p>
<p>排序方式包括按点赞数、pub 积分和受欢迎程度排序，此外还改进了取消收藏软件包的界面，让用户能够更轻松地保持收藏软件包列表的整洁和最新状态。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d61a86ddde1844c9a6ddc8b195a72109~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763601611&amp;x-signature=SAzvX%2B7BOWnYmpENtqIdLozIUpQ%3D" alt="" loading="lazy"/></p>
<p>如果选择使用搜索功能查找 liked packages，只需在查询中添加 <code>is:liked-by-me</code> 即可：<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba957d4d70454660b9333f6ad834c808~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763601611&amp;x-signature=oFWiaTzRbmuWPo98JUHjaSPIovE%3D" alt="" loading="lazy"/></p>
<p>另外，为了增强安全性并防止意外发布，现在可以禁用软件包的手动发布（pub publish）功能，这对于已启用自动发布工作流程，或不再积极发布的软件包来说非常理想。</p>
<p>可以在软件包的 <strong>Admin</strong> Tab 中使用 “Enable manual publishing” 来控制这个功能：<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a4f43bac3db499d8c397941968e76ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763601611&amp;x-signature=B4um3F5czy1vXgEHR5EIoKNbQjU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">最后</h2>
<p>这次更新，除了诚意满满的 <a href="https://juejin.cn/post/7571693273728696356" target="_blank" title="https://juejin.cn/post/7571693273728696356">Flutter 3.38</a> 之外， Dart 3.10 看起来也是非常不错，至少为了 Dot shorthands 和 Build hooks 就很值得更新，你觉得呢？</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[接口开发，咱得整得“优雅”点]]></title>    <link>https://juejin.cn/post/7571749988080435209</link>    <guid>https://juejin.cn/post/7571749988080435209</guid>    <pubDate>2025-11-13T00:02:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571749988080435209" data-draft-id="7571644531609042990" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="接口开发，咱得整得“优雅”点"/> <meta itemprop="keywords" content="Java,API,代码规范"/> <meta itemprop="datePublished" content="2025-11-13T00:02:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员晓凡"/> <meta itemprop="url" content="https://juejin.cn/user/1829211147871415"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            接口开发，咱得整得“优雅”点
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1829211147871415/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员晓凡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-13T00:02:33.000Z" title="Thu Nov 13 2025 00:02:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是晓凡。</p>
<h3 data-id="heading-0">一、为什么要“优雅”？</h3>
<p>产品一句话：  “凡哥，接口明天上线，支持 10w 并发，数据脱敏，不能丢单，不能重复，还要安全。”<br/>
优雅不是装，是为了让自己少加班、少背锅、少掉发。<br/>
今天晓凡就把压箱底的东西掏出来，手把手带你撸一套能扛生产的模板。</p>
<p>为方便阅读，晓凡以Java代码为例给出“核心代码 + 使用姿势”，全部亲测可直接使用。</p>
<h3 data-id="heading-1">二、项目骨架（Spring Boot 3.x）</h3>
<pre><code class="hljs language-arduino" lang="arduino">demo-api
├── src/main/java/com/example/demo
│   ├── config          <span class="hljs-comment">// 配置：限流、加解密、日志等</span>
│   ├── annotation      <span class="hljs-comment">// 自定义注解（幂等、日志、脱敏）</span>
│   ├── aspect          <span class="hljs-comment">// 切面统一干活</span>
│   ├── interceptor     <span class="hljs-comment">// 拦截器（签名、白名单）</span>
│   ├── common          <span class="hljs-comment">// 统一返回、异常、常量</span>
│   ├── controller      <span class="hljs-comment">// 对外暴露</span>
│   ├── service
│   └── DemoApplication.java
└── pom.xml
</code></pre>
<h3 data-id="heading-2">三、 签名（防篡改）</h3>
<blockquote>
<p>对外提供的接口要做签名认证，认证不通过的请求不允许访问接口、提供服务</p>
</blockquote>
<p><strong>思路</strong><br/>
“时间戳 + 随机串 + 业务参数”排好序，最后 <code>APP_SECRET</code> 拼后面，SHA256 一下。<br/>
前后端、第三方都统一，拒绝撕逼。</p>
<p><strong>工具类</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SignUtil</span> {
    <span class="hljs-comment">/**
     * 生成签名
     * <span class="hljs-doctag">@param</span> map  除 sign 外的所有参数
     * <span class="hljs-doctag">@param</span> secret 分配给你的私钥
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">sign</span><span class="hljs-params">(Map&lt;String, String&gt; map, String secret)</span> {
        <span class="hljs-comment">// 1. 参数名升序排列</span>
        Map&lt;String, String&gt; tree = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeMap</span>&lt;&gt;(map);
        <span class="hljs-comment">// 2. 拼成 k=v&amp;k=v</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">join</span> <span class="hljs-operator">=</span> tree.entrySet().stream()
                .map(e -&gt; e.getKey() + <span class="hljs-string">"="</span> + e.getValue())
                .collect(Collectors.joining(<span class="hljs-string">"&amp;"</span>));
        <span class="hljs-comment">// 3. 最后拼密钥</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">raw</span> <span class="hljs-operator">=</span> join + <span class="hljs-string">"&amp;key="</span> + secret;
        <span class="hljs-comment">// 4. SHA256</span>
        <span class="hljs-keyword">return</span> DigestUtils.sha256Hex(raw).toUpperCase();
    }

    <span class="hljs-comment">/** 验签：直接比对即可 */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">verify</span><span class="hljs-params">(Map&lt;String, String&gt; map, String secret, String requestSign)</span> {
        <span class="hljs-keyword">return</span> sign(map, secret).equals(requestSign);
    }
}
</code></pre>
<p><strong>拦截器统一验签</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SignInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> {
    <span class="hljs-meta">@Value("${sign.secret}")</span>
    <span class="hljs-keyword">private</span> String secret;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request,
                             HttpServletResponse response,
                             Object handler)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 只拦截接口</span>
        <span class="hljs-keyword">if</span> (!(handler <span class="hljs-keyword">instanceof</span> HandlerMethod)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

        Map&lt;String, String&gt; params = Maps.newHashMap();
        request.getParameterMap().forEach((k, v) -&gt; params.put(k, v[<span class="hljs-number">0</span>]));

        <span class="hljs-type">String</span> <span class="hljs-variable">sign</span> <span class="hljs-operator">=</span> params.remove(<span class="hljs-string">"sign"</span>);   <span class="hljs-comment">// 签名不参与计算</span>
        <span class="hljs-keyword">if</span> (!SignUtil.verify(params, secret, sign)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BizException</span>(<span class="hljs-string">"签名错误"</span>);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<h3 data-id="heading-3">四、 加密（防泄露）</h3>
<blockquote>
<p>敏感数据在网络传输过程中都应该加密处理</p>
</blockquote>
<p><strong>思路</strong><br/>
<code>AES </code>对称加密，密钥放配置中心，支持一键开关。<br/>
只对敏感字段加密，别一上来全包加密，排查日志想打人。</p>
<p><strong>AES 工具</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AesUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ALG</span> <span class="hljs-operator">=</span> <span class="hljs-string">"AES/CBC/PKCS5Padding"</span>;
    <span class="hljs-comment">// 16 位</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"1234567890abcdef"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">IV</span>  <span class="hljs-operator">=</span> <span class="hljs-string">"abcdef1234567890"</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">encrypt</span><span class="hljs-params">(String src)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Cipher</span> <span class="hljs-variable">cipher</span> <span class="hljs-operator">=</span> Cipher.getInstance(ALG);
            <span class="hljs-type">SecretKeySpec</span> <span class="hljs-variable">keySpec</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecretKeySpec</span>(KEY.getBytes(), <span class="hljs-string">"AES"</span>);
            <span class="hljs-type">IvParameterSpec</span> <span class="hljs-variable">ivSpec</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IvParameterSpec</span>(IV.getBytes());
            cipher.init(Cipher.ENCRYPT_MODE, keySpec, ivSpec);
            <span class="hljs-keyword">return</span> Base64.getEncoder().encodeToString(cipher.doFinal(src.getBytes()));
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"加密失败"</span>, e);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">decrypt</span><span class="hljs-params">(String src)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Cipher</span> <span class="hljs-variable">cipher</span> <span class="hljs-operator">=</span> Cipher.getInstance(ALG);
            <span class="hljs-type">SecretKeySpec</span> <span class="hljs-variable">keySpec</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecretKeySpec</span>(KEY.getBytes(), <span class="hljs-string">"AES"</span>);
            <span class="hljs-type">IvParameterSpec</span> <span class="hljs-variable">ivSpec</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IvParameterSpec</span>(IV.getBytes());
            cipher.init(Cipher.DECRYPT_MODE, keySpec, ivSpec);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(cipher.doFinal(Base64.getDecoder().decode(src)));
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"解密失败"</span>, e);
        }
    }
}
</code></pre>
<h3 data-id="heading-4">五、 IP 白名单</h3>
<blockquote>
<p>限制请求的IP，增加IP白名单，一般在网关层处理</p>
</blockquote>
<p><strong>配置</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">white:</span>
  <span class="hljs-attr">ips:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">,10.0.0.0/8,192.168.0.0/16</span>
</code></pre>
<p><strong>拦截器</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WhiteListInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> {
    <span class="hljs-meta">@Value("#{'${white.ips}'.split(',')}")</span>
    <span class="hljs-keyword">private</span> List&lt;String&gt; allowList;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request,
                             HttpServletResponse response,
                             Object handler)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">String</span> <span class="hljs-variable">ip</span> <span class="hljs-operator">=</span> IpUtil.getIp(request);
        <span class="hljs-type">boolean</span> <span class="hljs-variable">ok</span> <span class="hljs-operator">=</span> allowList.stream()
                .anyMatch(rule -&gt; IpUtil.match(ip, rule));
        <span class="hljs-keyword">if</span> (!ok) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BizException</span>(<span class="hljs-string">"IP 不允许访问"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<h3 data-id="heading-5">六、 限流（Sentinel 注解版）</h3>
<blockquote>
<p>尤其对外提供的接口，无法保障调用频率，应该做限流处理，保障接口服务正常的提供服务</p>
</blockquote>
<p><strong>依赖</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.csp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sentinel-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.8.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>配置</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">demo-api</span>
<span class="hljs-attr">sentinel:</span>
  <span class="hljs-attr">transport:</span>
    <span class="hljs-attr">dashboard:</span> <span class="hljs-string">localhost:8080</span>
</code></pre>
<p><strong>使用姿势</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@GetMapping("/order/{id}")</span>
<span class="hljs-meta">@SentinelResource(value = "getOrder",
        blockHandler = "getOrderBlock")</span>
<span class="hljs-keyword">public</span> Result&lt;OrderVO&gt; <span class="hljs-title function_">getOrder</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
    <span class="hljs-keyword">return</span> Result.success(orderService.get(id));
}

<span class="hljs-comment">// 限流兜底</span>
<span class="hljs-keyword">public</span> Result&lt;OrderVO&gt; <span class="hljs-title function_">getOrderBlock</span><span class="hljs-params">(Long id, BlockException e)</span> {
    <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">"访问太频繁，稍后再试"</span>);
}
</code></pre>
<h3 data-id="heading-6">七、 参数校验（JSR303 + 分组）</h3>
<blockquote>
<p>即使前端做了非空，规范性校验，服务端参数校验任然是必不可少的</p>
</blockquote>
<p><strong>DTO</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderCreateDTO</span> {
    <span class="hljs-meta">@NotNull(message = "用户 ID 不能为空")</span>
    <span class="hljs-keyword">private</span> Long userId;

    <span class="hljs-meta">@NotEmpty(message = "商品列表不能为空")</span>
    <span class="hljs-meta">@Size(max = 20, message = "一次最多买 20 件")</span>
    <span class="hljs-keyword">private</span> List&lt;Item&gt; items;

    <span class="hljs-meta">@Valid</span>
    <span class="hljs-meta">@NotNull</span>
    <span class="hljs-keyword">private</span> PayInfo payInfo;

    <span class="hljs-meta">@Data</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PayInfo</span> {
        <span class="hljs-meta">@Min(value = 1, message = "金额必须大于 0")</span>
        <span class="hljs-keyword">private</span> Integer amount;
    }
}
</code></pre>
<p><strong>分组接口</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Create</span> {}
</code></pre>
<p><strong>Controller</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@PostMapping("/order")</span>
<span class="hljs-keyword">public</span> Result&lt;Long&gt; <span class="hljs-title function_">create</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> <span class="hljs-meta">@Validated(Create.class)</span> OrderCreateDTO dto)</span> {
    <span class="hljs-type">Long</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> orderService.create(dto);
    <span class="hljs-keyword">return</span> Result.success(orderId);
}
</code></pre>
<h3 data-id="heading-7">八、 统一返回值</h3>
<blockquote>
<p>提供统一的返回结果，不应该返回值五花八门</p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Data</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Result</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> code;
    <span class="hljs-keyword">private</span> String msg;
    <span class="hljs-keyword">private</span> T data;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="hljs-title function_">success</span><span class="hljs-params">(T data)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>&lt;&gt;(<span class="hljs-number">200</span>, <span class="hljs-string">"success"</span>, data);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="hljs-title function_">fail</span><span class="hljs-params">(String msg)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>&lt;&gt;(<span class="hljs-number">500</span>, msg, <span class="hljs-literal">null</span>);
    }

    <span class="hljs-comment">/** 返回 200 但提示业务失败 */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="hljs-title function_">bizFail</span><span class="hljs-params">(<span class="hljs-type">int</span> code, String msg)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>&lt;&gt;(code, msg, <span class="hljs-literal">null</span>);
    }
}
</code></pre>
<h3 data-id="heading-8">九、 统一异常处理</h3>
<blockquote>
<p>系统报错信息需要提供友好的提示，避免暴露出SQL异常的信息给调用方和客户端。</p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestControllerAdvice</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(GlobalExceptionHandler.class);

    <span class="hljs-comment">/** 业务异常 */</span>
    <span class="hljs-meta">@ExceptionHandler(BizException.class)</span>
    <span class="hljs-keyword">public</span> Result&lt;Void&gt; <span class="hljs-title function_">handle</span><span class="hljs-params">(BizException e)</span> {
        log.warn(<span class="hljs-string">"业务异常：{}"</span>, e.getMessage());
        <span class="hljs-keyword">return</span> Result.bizFail(e.getCode(), e.getMessage());
    }

    <span class="hljs-comment">/** 参数校验失败 */</span>
    <span class="hljs-meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span>
    <span class="hljs-keyword">public</span> Result&lt;Void&gt; <span class="hljs-title function_">handleValid</span><span class="hljs-params">(MethodArgumentNotValidException e)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> e.getBindingResult()
                .getFieldErrors()
                .stream()
                .map(DefaultMessageSourceResolvable::getDefaultMessage)
                .collect(Collectors.joining(<span class="hljs-string">","</span>));
        <span class="hljs-keyword">return</span> Result.fail(msg);
    }

    <span class="hljs-comment">/** 兜底 */</span>
    <span class="hljs-meta">@ExceptionHandler(Exception.class)</span>
    <span class="hljs-keyword">public</span> Result&lt;Void&gt; <span class="hljs-title function_">handleAll</span><span class="hljs-params">(Exception e)</span> {
        log.error(<span class="hljs-string">"系统异常"</span>, e);
        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">"服务器开小差"</span>);
    }
}
</code></pre>
<h3 data-id="heading-9">十、 请求日志（切面 + 注解）</h3>
<blockquote>
<p>记录请求的入参日志和返回日志，出问题时方便快速定位。也给运维人员提供了方便</p>
</blockquote>
<p><strong>注解</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Target(ElementType.METHOD)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> ApiLog {}
</code></pre>
<p><strong>切面</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogAspect</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(<span class="hljs-string">"api.log"</span>);

    <span class="hljs-meta">@Around("@annotation(apiLog)")</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint p, ApiLog apiLog)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-type">ServletRequestAttributes</span> <span class="hljs-variable">attr</span> <span class="hljs-operator">=</span>
                (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">req</span> <span class="hljs-operator">=</span> attr.getRequest();

        <span class="hljs-type">String</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> req.getRequestURI();
        <span class="hljs-type">String</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> JSON.toJSONString(p.getArgs());

        Object result;
        <span class="hljs-keyword">try</span> {
            result = p.proceed();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"【{}】params={} error={}"</span>, uri, params, e.getMessage());
            <span class="hljs-keyword">throw</span> e;
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-type">long</span> <span class="hljs-variable">cost</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - start;
            log.info(<span class="hljs-string">"【{}】params={} cost={}ms"</span>, uri, params, cost);
        }
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<p><strong>用法</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@ApiLog</span>
<span class="hljs-meta">@PostMapping("/order")</span>
<span class="hljs-keyword">public</span> Result&lt;Long&gt; <span class="hljs-title function_">create</span><span class="hljs-params">(...)</span> {}
</code></pre>
<h3 data-id="heading-10">十一、幂等设计（Token &amp; 分布式锁双保险）</h3>
<blockquote>
<p>对于一些涉及到数据一致性的接口一定要做好幂等设计，以防数据出现重复问题</p>
</blockquote>
<p><strong>思路</strong></p>
<ol>
<li>下单前先申请一个幂等 Token（存在 Redis，5 分钟失效）。</li>
<li>下单时带着 Token，后端用 Lua 脚本“判断存在并删除”，原子性保证只能用一次。</li>
<li>对并发极高场景，再补一层分布式锁（Redisson）。</li>
</ol>
<p><strong>代码</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IdempotentService</span> {
    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> StringRedisTemplate redis;

    <span class="hljs-comment">/** 申请 Token */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createToken</span><span class="hljs-params">()</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> UUID.fastUUID().toString();
        redis.opsForValue().set(<span class="hljs-string">"token:"</span> + token, <span class="hljs-string">"1"</span>,
                Duration.ofMinutes(<span class="hljs-number">5</span>));
        <span class="hljs-keyword">return</span> token;
    }

    <span class="hljs-comment">/** 验证并删除 */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkToken</span><span class="hljs-params">(String token)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">"token:"</span> + token;
        <span class="hljs-comment">// 原子删除成功才算用过</span>
        <span class="hljs-keyword">return</span> Boolean.TRUE.equals(redis.delete(key));
    }
}
</code></pre>
<p><strong>Controller</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@GetMapping("/token")</span>
<span class="hljs-keyword">public</span> Result&lt;String&gt; <span class="hljs-title function_">getToken</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> Result.success(idempotentService.createToken());
}

<span class="hljs-meta">@PostMapping("/order")</span>
<span class="hljs-meta">@ApiLog</span>
<span class="hljs-keyword">public</span> Result&lt;Long&gt; <span class="hljs-title function_">create</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> <span class="hljs-meta">@Valid</span> OrderCreateDTO dto,
                           <span class="hljs-meta">@RequestHeader("Idempotent-Token")</span> String token)</span> {
    <span class="hljs-keyword">if</span> (!idempotentService.checkToken(token)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BizException</span>(<span class="hljs-string">"请勿重复提交"</span>);
    }
    <span class="hljs-type">Long</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> orderService.create(dto);
    <span class="hljs-keyword">return</span> Result.success(orderId);
}
</code></pre>
<h3 data-id="heading-11">十二、限制记录条数（分页 + SQL 保护）</h3>
<blockquote>
<p>对于批量数据接口，一定要限制返回的记录条数，不让会造成恶意攻击导致服务器宕机。</p>
</blockquote>
<p><strong>MyBatis-Plus 分页插件</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MybatisConfig</span> {
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> MybatisPlusInterceptor <span class="hljs-title function_">interceptor</span><span class="hljs-params">()</span> {
        <span class="hljs-type">MybatisPlusInterceptor</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MybatisPlusInterceptor</span>();
        i.addInnerInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PaginationInnerInterceptor</span>(DbType.MYSQL));
        <span class="hljs-keyword">return</span> i;
    }
}
</code></pre>
<p><strong>Service</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> Page&lt;OrderVO&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(OrderListDTO dto)</span> {
    <span class="hljs-comment">// 前端不传默认 10 条，最多 200</span>
    <span class="hljs-type">long</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> Math.min(dto.getPageSize(), <span class="hljs-number">200</span>);
    Page&lt;Order&gt; page = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(dto.getPageNo(), size);
    LambdaQueryWrapper&lt;Order&gt; w = Wrappers.lambdaQuery();
    <span class="hljs-keyword">if</span> (StrUtil.isNotBlank(dto.getUserName())) {
        w.like(Order::getUserName, dto.getUserName());
    }
    Page&lt;Order&gt; po = orderMapper.selectPage(page, w);
    <span class="hljs-keyword">return</span> po.convert(o -&gt; BeanUtil.copyProperties(o, OrderVO.class));
}
</code></pre>
<h3 data-id="heading-12">十三、 压测（JMeter + 自带脚本）</h3>
<blockquote>
<p>上线前，务必要对API接口进行压力测试，知道各个接口的qps情况。以便我们能够更好的预估，需要部署多少服务节点，对于API接口的稳定性至关重要。</p>
</blockquote>
<ol>
<li>
<p>起服务：<br/>
<code>java -jar -Xms1g -Xmx1g demo-api.jar</code></p>
</li>
<li>
<p>JMeter 线程组：<br/>
500 线程、Ramp-up 10s、循环 20。</p>
</li>
<li>
<p>观测：</p>
<ul>
<li>Sentinel 控制台看 QPS、RT</li>
<li><code>top -H</code> 看 CPU</li>
<li><code>arthas</code> 火焰图找慢方法</li>
</ul>
</li>
<li>
<p>调优：</p>
<ul>
<li>限流阈值 = 压测 80% 最高水位</li>
<li>发现慢 SQL 加索引</li>
<li>热点数据加本地缓存（Caffeine）</li>
</ul>
</li>
</ol>
<h3 data-id="heading-13">十四、异步处理</h3>
<blockquote>
<p>如果同步处理业务，耗时会非常长。这种情况下，为了提升API接口性能，我们可以改为异步处理</p>
</blockquote>
<p>下单成功后，发 MQ 异步发短信/扣库存，接口 RT 直接降一半。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Async("asyncExecutor")</span>   <span class="hljs-comment">// 自定义线程池</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendSmsAsync</span><span class="hljs-params">(Long userId, String content)</span> {
    smsService.send(userId, content);
}
</code></pre>
<h3 data-id="heading-14">十五、数据脱敏</h3>
<blockquote>
<p>业务中对与用户的敏感数据，如密码等需要进行脱敏处理</p>
</blockquote>
<p>返回前统一用 Jackson 序列化过滤器，字段加注解就行，代码零侵入。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@JsonSerialize(using = SensitiveSerializer.class)</span>
<span class="hljs-meta">@Target(ElementType.FIELD)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Sensitive {
    SensitiveType <span class="hljs-title function_">type</span><span class="hljs-params">()</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">SensitiveType</span> {
    PHONE, ID_CARD, BANK_CARD
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SensitiveSerializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JsonSerializer</span>&lt;String&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(String value, JsonGenerator g, SerializerProvider p)</span>
            <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-keyword">if</span> (StrUtil.isBlank(value)) {
            g.writeString(value);
            <span class="hljs-keyword">return</span>;
        }
        g.writeString(DesensitizeUtil.desPhone(value));
    }
}
</code></pre>
<h3 data-id="heading-15">十六、完整的接口文档（Knife4j）</h3>
<blockquote>
<p>提供在线接口文档，既方便开发调试接口，也方便运维人员排查错误</p>
</blockquote>
<p><strong>依赖</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.xiaoymin<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>knife4j-openapi3-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>配置</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">knife4j:</span>
  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">setting:</span>
    <span class="hljs-attr">language:</span> <span class="hljs-string">zh_cn</span>
</code></pre>
<p><strong>启动后访问</strong><br/>
<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8080%2Fdoc.html" target="_blank" title="http://localhost:8080/doc.html" ref="nofollow noopener noreferrer">http://localhost:8080/doc.html</a><br/>
支持在线调试、导出 PDF、Word。</p>
<h3 data-id="heading-16">十七、小结</h3>
<p>接口开发就像炒菜：</p>
<ul>
<li>签名、加密是“食材保鲜”</li>
<li>限流、幂等是“火候掌控”</li>
<li>日志、文档是“摆盘拍照”</li>
</ul>
<p>每道工序做到位，才能端到桌上“色香味”俱全。<br/>
上面 13 段核心代码，直接粘过去就能跑，跑通后再按业务微调，基本能扛 90% 的生产场景。<br/>
祝你在领导问起接口怎么样了？的时候，可以淡淡来一句：<br/>
“接口已经准备好了，压测报告发群里了。”</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零到一，记录docker运行一个web端项目]]></title>    <link>https://juejin.cn/post/7572126996178026531</link>    <guid>https://juejin.cn/post/7572126996178026531</guid>    <pubDate>2025-11-14T07:39:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572126996178026531" data-draft-id="7572161976593547316" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零到一，记录docker运行一个web端项目"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-14T07:39:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="web_bee"/> <meta itemprop="url" content="https://juejin.cn/user/428665740231"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零到一，记录docker运行一个web端项目
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/428665740231/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    web_bee
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T07:39:18.000Z" title="Fri Nov 14 2025 07:39:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>使用docker将一个前端项目打成一个镜像，并且将其创建一个容器运行起来；</p>
<h2 data-id="heading-0">一、docker安装及配置</h2>
<p>安装不详细描述，大家可以自行网上搜索相关教程</p>
<h3 data-id="heading-1">配置</h3>
<p>首先需要登陆 docker client；</p>
<p>其次需要配置国内镜像源，Docker Desktop 设置里 Settings → Docker Engine → 修改成：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"registry-mirrors"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"https://docker.mirrors.ustc.edu.cn"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"https://mirror.baidubce.com"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"https://registry.docker-cn.com"</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>保存重启，客户端的配置就差不多了。</p>
<h2 data-id="heading-2">二、前端项目的配置</h2>
<p>在前端项目需要新增两个文件：</p>
<h3 data-id="heading-3">2.1 <code>Dockerfile</code></h3>
<pre><code class="hljs language-bash" lang="bash">FROM node:lts-alpine
<span class="hljs-comment"># FROM node:8.4</span>
COPY . /app
WORKDIR /app
RUN npm install --registry=https://registry.npm.taobao.org
EXPOSE 3000
</code></pre>
<p>上面代码一共五行，含义如下&lt;摘自，阮一峰老师博客&gt;</p>
<blockquote>
<ul>
<li><code>FROM node:8.4</code>：该 image 文件继承官方的 node image，冒号表示标签，这里标签是<code>8.4</code>，即8.4版本的 node。</li>
<li><code>COPY . /app</code>：将当前目录下的所有文件（除了<code>.dockerignore</code>排除的路径），都拷贝进入 image 文件的<code>/app</code>目录。</li>
<li><code>WORKDIR /app</code>：指定接下来的工作路径为<code>/app</code>。</li>
<li><code>RUN npm install</code>：在<code>/app</code>目录下，运行<code>npm install</code>命令安装依赖。注意，安装后所有的依赖，都将打包进入 image 文件。</li>
<li><code>EXPOSE 3000</code>：将容器 3000 端口暴露出来， 允许外部连接这个端口。</li>
</ul>
</blockquote>
<p><strong>node:lts-alpine 介绍</strong></p>
<p><code>node:lts-alpine</code> 是一个 <strong>Docker 镜像标签（tag）</strong> ，它其实是对官方 Node.js 镜像的一种“轻量化版本”命名方式。</p>
<p><strong><code>node:lts-alpine</code></strong> = Node.js 官方长期支持版本（LTS） + 基于 Alpine Linux 的轻量系统。</p>





















<table><thead><tr><th>部分</th><th>含义</th></tr></thead><tbody><tr><td><code>node</code></td><td>镜像名称，来自 Docker Hub 官方 Node.js 仓库（<a href="https://link.juejin.cn?target=https%3A%2F%2Fhub.docker.com%2F_%2Fnode" target="_blank" title="https://hub.docker.com/_/node" ref="nofollow noopener noreferrer">hub.docker.com/_/node</a>）</td></tr><tr><td><code>lts</code></td><td>“Long Term Support” 长期支持版本（比如 20.x LTS）</td></tr><tr><td><code>alpine</code></td><td>镜像底层操作系统是 <strong>Alpine Linux</strong>，体积极小，非常适合生产环境部署</td></tr></tbody></table>
<h3 data-id="heading-4">2.2 <code>.dockerignore</code></h3>
<pre><code class="hljs language-lua" lang="lua">.git
node_modules
npm-<span class="hljs-built_in">debug</span>.<span class="hljs-built_in">log</span>
dist
.vscode
</code></pre>
<h2 data-id="heading-5">三、终端操作</h2>
<h3 data-id="heading-6">创建镜像：</h3>
<pre><code class="hljs language-arduino" lang="arduino">docker image build -t koa-demo .
</code></pre>
<ul>
<li><code>-t</code>参数用来指定 image 文件的名字，后面还可以用冒号指定标签。如果不指定，默认的标签就是<code>latest</code>。</li>
<li><code>.</code> 表示 Dockerfile 文件所在的路径，上例是当前路径，所以是一个点</li>
</ul>
<p>创建过程中遇到报错：</p>
<pre><code class="hljs language-ini" lang="ini">docker image build -t vite-vue .                                                            
<span class="hljs-section">[+]</span> Building 32.7s (3/3) FINISHED                                                                            docker:<span class="hljs-attr">desktop-linux</span>
 =&gt; <span class="hljs-section">[internal]</span> load build definition from <span class="hljs-attr">Dockerfile</span>       
 =&gt; =&gt; transferring dockerfile: <span class="hljs-attr">150B</span>         
 =&gt; ERROR <span class="hljs-section">[internal]</span> load metadata for docker.io/library/node:<span class="hljs-attr">20.19.0</span>      
 =&gt; <span class="hljs-section">[auth]</span> library/node:pull token for registry-1.docker.io                  
------
 &gt; <span class="hljs-section">[internal]</span> load metadata for docker.io/library/node:20.19.0:
------
Dockerfile:1
--------------------
   1 | &gt;&gt;&gt; FROM node:20.19.0
   2 |     COPY . /app
   3 |     WORKDIR /app
--------------------
ERROR: failed to build: failed to solve: node:20.19.0: failed to resolve source metadata for docker.io/library/node:20.19.0: pull access denied, repository does not exist or may require authorization: server message: insufficient_scope: authorization failed
</code></pre>
<p>解决方案：</p>
<p>由于配置的国内源无法使用造成，从新配置docker源，配置在上文中，然后执行：</p>
<pre><code class="hljs language-perl" lang="perl">docker info | <span class="hljs-keyword">grep</span> -i mirror         
返回：
 Registry Mirrors:
  https:<span class="hljs-regexp">//d</span>ocker.mirrors.ustc.edu.cn/
  https:<span class="hljs-regexp">//mirr</span>or.baidubce.com/
</code></pre>
<p>能正常返回数据，说明源能正常使用。至此，镜像创建完成✅</p>
<h3 data-id="heading-7">生成容器</h3>
<p>执行如下命令：</p>
<pre><code class="hljs language-arduino" lang="arduino">docker container run -p <span class="hljs-number">8000</span>:<span class="hljs-number">3000</span> -it vite-vue /bin/bash 
</code></pre>
<p>报错信息：</p>
<pre><code class="hljs language-php" lang="php">node:internal/modules/cjs/loader:<span class="hljs-number">1423</span>
​
<span class="hljs-keyword">throw</span> err;
​
^
​
<span class="hljs-built_in">Error</span>: Cannot find module <span class="hljs-string">'/bin/bash'</span>
​
at Module.<span class="hljs-title function_ invoke__">_resolveFilename</span> (<span class="hljs-attr">node</span>:internal/modules/cjs/<span class="hljs-attr">loader</span>:<span class="hljs-number">1420</span>:<span class="hljs-number">15</span>)
​
at <span class="hljs-title function_ invoke__">defaultResolveImpl</span> (<span class="hljs-attr">node</span>:internal/modules/cjs/<span class="hljs-attr">loader</span>:<span class="hljs-number">1058</span>:<span class="hljs-number">19</span>)
​
at <span class="hljs-title function_ invoke__">resolveForCJSWithHooks</span> (<span class="hljs-attr">node</span>:internal/modules/cjs/<span class="hljs-attr">loader</span>:<span class="hljs-number">1063</span>:<span class="hljs-number">22</span>)
​
at Module.<span class="hljs-title function_ invoke__">_load</span> (<span class="hljs-attr">node</span>:internal/modules/cjs/<span class="hljs-attr">loader</span>:<span class="hljs-number">1226</span>:<span class="hljs-number">37</span>)
​
at TracingChannel.<span class="hljs-title function_ invoke__">traceSync</span> (<span class="hljs-attr">node</span>:<span class="hljs-attr">diagnostics_channel</span>:<span class="hljs-number">328</span>:<span class="hljs-number">14</span>)
​
at <span class="hljs-title function_ invoke__">wrapModuleLoad</span> (<span class="hljs-attr">node</span>:internal/modules/cjs/<span class="hljs-attr">loader</span>:<span class="hljs-number">244</span>:<span class="hljs-number">24</span>)
​
at Module.executeUserEntryPoint [<span class="hljs-keyword">as</span> runMain] (node:internal/modules/run_main:<span class="hljs-number">154</span>:<span class="hljs-number">5</span>)
​
at node:internal/main/run_main_module:<span class="hljs-number">33</span>:<span class="hljs-number">47</span> {
​
code: <span class="hljs-string">'MODULE_NOT_FOUND'</span>,
​
requireStack: []
​
}
​
Node.js v24.<span class="hljs-number">11.0</span>
</code></pre>
<p>基础镜像是 <strong><code>node:lts-alpine</code></strong>，而 <strong>Alpine Linux 默认没有 <code>/bin/bash</code></strong>，只有 <code>/bin/sh</code>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f7861d4f3374deab6e4b169dec7675d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2ViX2JlZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710795&amp;x-signature=%2BJ7RxQyfDpwqYWDeT7b6Q5nFoIU%3D" alt="docker1.png" loading="lazy"/></p>
<h3 data-id="heading-8">运行前端项目</h3>
<pre><code class="hljs language-arduino" lang="arduino">npm run dev
</code></pre>
<p>报错，信息如下：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">vite-test</span>@<span class="hljs-number">0.0</span><span class="hljs-selector-class">.0</span> <span class="hljs-selector-tag">dev</span>
​
&gt; <span class="hljs-selector-tag">vite</span>
​
/<span class="hljs-selector-tag">app</span>/<span class="hljs-selector-tag">node_modules</span>/<span class="hljs-selector-tag">rollup</span>/<span class="hljs-selector-tag">dist</span>/<span class="hljs-selector-tag">native</span><span class="hljs-selector-class">.js</span>:<span class="hljs-number">59</span>
​
•   <span class="hljs-selector-tag">throw</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">Error</span>(
​
•      ^
​
<span class="hljs-attribute">Error</span>: Cannot find module <span class="hljs-variable">@rollup</span>/rollup-linux-arm64-musl. npm has a bug related to optional dependencies (<span class="hljs-attribute">https</span>:<span class="hljs-comment">//github.com/npm/cli/issues/4828). Please try `npm i` again after removing both package-lock.json and node_modules directory.</span>
​
Node.js v24.<span class="hljs-number">11.0</span>
</code></pre>
<p>原因：</p>
<ul>
<li><code>node:lts-alpine</code>，底层是 <strong>Alpine Linux</strong>；</li>
<li>Alpine 使用 <strong>musl libc</strong>（不是标准 glibc）；</li>
<li>Rollup 在安装时，会尝试下载一个针对系统架构的 <strong>预编译二进制包</strong>（例如 <code>@rollup/rollup-linux-arm64-musl</code>）；</li>
<li>npm 对 “optionalDependencies” 的安装逻辑在某些环境下会失败（尤其是 musl 系统），导致该模块没装上。</li>
</ul>
<p>解决方案：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">rm</span> -rf node_modules package-lock.json
npm install
</code></pre>
<p>然后运行 <code>npm run dev</code> 项目正常运行， 前端项目的端口是 3000，理论上映射到本机的 8000端口；但是当浏览器访问本地 8000 端口时，不能正常访问；</p>
<p>搜索之后得知：</p>
<p>前端项目监听的 host 必须是 <code>0.0.0.0</code>，否则只绑定容器内部的 <code>localhost</code>，宿主机访问不到。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">export</span> <span class="hljs-string">default</span> {
  <span class="hljs-attr">server:</span> {
    <span class="hljs-attr">host:</span> <span class="hljs-string">'0.0.0.0'</span>,
    <span class="hljs-attr">port:</span> <span class="hljs-number">3000</span>
  }
}
</code></pre>
<blockquote>
<p>详细解释</p>
<ul>
<li>
<p><strong><code>0.0.0.0</code> 的含义</strong>：这是一个特殊的 IP 地址，表示“所有可用网络接口”。</p>
</li>
<li>
<p><strong>作用</strong>：</p>
<ul>
<li>它允许你的开发服务器同时监听你的本地 IP 地址、Wi-Fi IP 地址等所有网络接口。</li>
<li>这非常适合在局域网环境中使用，例如你可以在手机或其他设备上通过你电脑的局域网 IP 地址来访问你正在开发的应用。</li>
</ul>
</li>
<li>
<p><strong>与 <code>localhost</code> 的区别</strong>：</p>
<ul>
<li><code>localhost</code>（或 <code>127.0.0.1</code>）只能让服务器在本地电脑上访问。</li>
<li/>
<li><code>0.0.0.0</code> 则将服务器开放给局域网内的其他设备。</li>
</ul>
</li>
</ul>
</blockquote>
<p>至此，本机已经能正常访问容器内部的服务了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于Nextjs15的学习手记]]></title>    <link>https://juejin.cn/post/7572147440314335295</link>    <guid>https://juejin.cn/post/7572147440314335295</guid>    <pubDate>2025-11-14T07:30:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572147440314335295" data-draft-id="7477105518038843443" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于Nextjs15的学习手记"/> <meta itemprop="keywords" content="JavaScript,前端,React.js"/> <meta itemprop="datePublished" content="2025-11-14T07:30:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xun_xing"/> <meta itemprop="url" content="https://juejin.cn/user/1821234275567431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于Nextjs15的学习手记
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1821234275567431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xun_xing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T07:30:09.000Z" title="Fri Nov 14 2025 07:30:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="tomorrow">.hljs-comment,.hljs-quote{color:#8e908c}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#c82829}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5871f}.hljs-attribute{color:#eab700}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#718c00}.hljs-section,.hljs-title{color:#4271ae}.hljs-keyword,.hljs-selector-tag{color:#8959a8}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#4d4d4c}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">基于Nextjs15的学习手记</h2>
<p>Next.js 是一个基于 React 的 <strong>全栈框架</strong>，由 Vercel 维护。它提供了 <strong>服务器端渲染（SSR）</strong> 、<strong>静态站点生成（SSG）</strong> 、<strong>增量静态再生（ISR）</strong> 等特性，使得开发者可以更轻松地构建高性能、SEO 友好的 Web 应用。目前Nextjs 15已经使用React 19版本，服务器组件更加强悍。</p>
<h3 data-id="heading-1">一、了解CSR/SSR/SSG</h3>
<p>CSR（Client-Side Rendering，客户端渲染）、SSR（Server-Side Rendering，服务器端渲染）和SSG（Static Site Generation，静态站点生成）是构建现代Web应用的不同的渲染方式。主要区别在于 <strong>页面的 HTML 何时生成、在哪里生成，以及对 SEO 和性能的影响</strong>，每种方式都有其优缺点，适用于不同的场景。</p>
<h4 data-id="heading-2">1.CSR（客户端渲染）</h4>
<p>将网页的内容生成和渲染都放在客户端（即浏览器）完成。初始的HTML文档中通常只包含基本的骨架和一些静态资源链接，如CSS和JavaScript文件。然后，浏览器会下载这些文件，并在客户端解析和执行JavaScript代码，动态地获取数据，并使用数据来生成和渲染页面的内容。</p>
<p>适用于<strong>单页应用（SPA）</strong> ，比如 <strong>React</strong>、<strong>Vue</strong> 项目</p>
<h5 data-id="heading-3">CSR渲染过程：</h5>
<p>①.下载初始HTML</p>
<p>②.解析HTML</p>
<p>③.下载和执行JavaScript文件</p>
<p>④.数据获取</p>
<p>⑤.数据处理和页面渲染</p>
<p>⑥.更新DOM</p>
<p>⑦.用户交互和动态更新</p>
<h5 data-id="heading-4">优点：</h5>
<ul>
<li>
<p>富交互性：客户端渲染允许创建富交互性的应用，因为所有的逻辑都在用户的浏览器中执行。</p>
</li>
<li>
<p>减轻服务器负载：服务器只需提供静态文件，大部分工作由客户端完成，减轻了服务器的负载。</p>
</li>
<li>
<p>更快的页面导航：在单页面应用（SPA）中，页面之间的导航可以无需重新加载整个页面，提供了更流畅的用户体验。</p>
</li>
</ul>
<h5 data-id="heading-5">缺点：</h5>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fbaike.baidu.com%2Fitem%2F%25E6%2590%259C%25E7%25B4%25A2%25E5%25BC%2595%25E6%2593%258E%25E4%25BC%2598%25E5%258C%2596%2F3132" target="_blank" title="https://baike.baidu.com/item/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E4%BC%98%E5%8C%96/3132" ref="nofollow noopener noreferrer">SEO</a>挑战：由于内容是在客户端动态生成的，搜索引擎可能难以抓取页面内容，这可能对SEO造成不利影响。</p>
</li>
<li>
<p>慢首屏加载：客户端渲染通常需要加载JavaScript框架和应用代码，然后才能渲染内容，这可能导致慢首屏加载时间。</p>
</li>
<li>
<p>JavaScript依赖：完全依赖于客户端JavaScript执行，如果用户禁用了JavaScript，或者JavaScript文件加载失败，那么用户将看不到任何内容。</p>
</li>
</ul>
<h5 data-id="heading-6">适用场景：</h5>
<ul>
<li><strong>后台管理系统</strong>（如 CMS、Admin 面板）。</li>
<li><strong>需要大量交互的 SPA</strong>（如 Gmail、React/Vue App）。</li>
<li><strong>对 SEO 要求不高的应用</strong>。</li>
</ul>
<h4 data-id="heading-7">2.SSR（服务器端渲染）</h4>
<p>在SSR中，服务器会在接收到客户端请求后，执行网页的渲染逻辑，并生成完整的HTML页面。生成的HTML页面包含了所有初始化的数据和已经渲染好的页面内容，然后服务器将该HTML页面发送给客户端浏览器进行展示。</p>
<h5 data-id="heading-8">SSR渲染过程：</h5>
<p>①.客户端请求</p>
<p>②.路由处理</p>
<p>③.数据获取</p>
<p>④.数据处理和页面渲染</p>
<p>⑤.HTML页面发送</p>
<p>⑥.客户端渲染</p>
<p>⑦.数据绑定和事件处理</p>
<p>⑧.用户交互和动态更新</p>
<h5 data-id="heading-9">优点：</h5>
<ul>
<li>
<p>SEO优化：服务器端渲染的页面可以提供完整的HTML内容，有助于搜索引擎更好地抓取和索引网站，从而提高SEO表现。</p>
</li>
<li>
<p>快速首屏加载：用户可以更快地看到完整渲染的页面，因为内容是在服务器上生成的，这提高了 perceived performance（用户感知的性能）。</p>
</li>
<li>
<p>更好的社交媒体共享：由于页面的元数据（如标题、描述、图片等）在服务器上已经渲染，分享链接时社交媒体平台能够正确显示预览信息。</p>
</li>
</ul>
<h5 data-id="heading-10">缺点：</h5>
<ul>
<li>
<p>服务器负载：服务器端渲染可能会增加服务器的负载，因为每个页面请求都需要服务器处理和渲染。</p>
</li>
<li>
<p>延迟：页面更新或导航可能会有延迟，因为需要从服务器获取新的HTML页面。</p>
</li>
<li>
<p>复杂的构建和部署：SSR应用可能需要特殊的服务器配置和更复杂的构建过程。</p>
</li>
</ul>
<h5 data-id="heading-11">适用场景：</h5>
<ul>
<li>
<p><strong>SEO 要求高的应用</strong>（如官网、博客、新闻站点）。</p>
</li>
<li>
<p><strong>内容动态变化的页面</strong>（如用户个性化主页）。</p>
</li>
</ul>
<h4 data-id="heading-12">3.SSG (静态网站生成)</h4>
<p>在构建（build）阶段生成静态HTML文件，将这些文件直接提供给客户端，而无需在每个请求上动态生成内容。</p>
<h5 data-id="heading-13">SSG渲染过程：</h5>
<p>①.构建阶段</p>
<p>②.生成静态文件</p>
<p>③.服务器提供静态文件</p>
<p>④.客户端渲染</p>
<h5 data-id="heading-14">优点：</h5>
<ul>
<li>
<p>最快的加载速度：用户访问时，直接从 <strong>CDN</strong> 获取 HTML，加载速度快。</p>
</li>
<li>
<p>SEO 友好：完整 HTML 可被爬虫抓取。</p>
</li>
<li>
<p>服务器压力低：只需要提供静态文件。</p>
</li>
</ul>
<h5 data-id="heading-15">缺点：</h5>
<ul>
<li>
<p>缺少灵活性：无法处理实时数据，页面内容不会随请求变化。</p>
</li>
<li>
<p>更新繁琐：如果数据更新，需要重新构建页面。</p>
</li>
</ul>
<h5 data-id="heading-16">适用场景：</h5>
<ul>
<li><strong>博客、文档、产品展示页</strong>（如 <strong>Next.js + Markdown 博客</strong>）。</li>
<li><strong>新闻站点（非实时）</strong> 。</li>
<li><strong>静态电商页面</strong>（如 Next.js + Shopify）。</li>
</ul>
<h4 data-id="heading-17">4.CSR / SSR / SSG 对比</h4>

































<table><thead><tr><th>渲染方式</th><th>HTML 生成时机</th><th>是否支持 SEO</th><th>首屏速度</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>CSR</strong></td><td>浏览器端</td><td>❌ 差</td><td>🐢 慢</td><td>SPA、后台管理系统</td></tr><tr><td><strong>SSR</strong></td><td>请求时</td><td>✅ 好</td><td>🚀 快</td><td>SEO 需求高、动态数据</td></tr><tr><td><strong>SSG</strong></td><td>构建时</td><td>✅ 最优</td><td>⚡ 超快</td><td>博客、文档、静态页面</td></tr></tbody></table>
<p><strong>CSR</strong>提供富交互和动态内容，能够实现流畅的用户体验，适用于单页应用和需要复杂前端逻辑的应用。</p>
<p><strong>SSR</strong>提供更快的首次加载速度、SEO友好和较好的性能，适用于需要复杂交互和对SEO重视的应用。</p>
<p><strong>SSG</strong>提供更快的加载速度、SEO友好和较好的可访问性，适用于内容相对稳定、对SEO要求较高或需要更快加载速度的应用。</p>
<h4 data-id="heading-18">5.同构（Isomorphic）渲染</h4>
<p>也叫 <strong>混合渲染（Hybrid Rendering）</strong>，结合了SSR和CSR的优点，首次请求由服务器渲染页面，提供快速的首屏加载和良好的SEO，之后的页面交互由客户端接管，提供富交互性。这种方式需要更复杂的配置和架构设计，但可以提供更好的用户体验和性能。</p>
<h4 data-id="heading-19">6.ISR（增量静态再生）</h4>
<p>ISR（Incremental Static Regeneration），SSG 的增强版，允许<strong>部分页面在后台自动更新</strong>，无需手动重新构建。</p>
<h4 data-id="heading-20">7.汇总</h4>
<p>Next.js 是一个 React 框架，可用于构建 SSR、CSR 和 SSG 网站和应用程序，且支持<strong>同构渲染</strong>和<strong>增量静态再生</strong>。 以及提供了许多内置功能，例如路由、数据获取和预渲染，Nextjs不仅当前强大，还在不断进化适合企业长期使用。</p>
<h3 data-id="heading-21">二、React 19新特性</h3>
<h3 data-id="heading-22">三、基于React 19的Nextjs 15</h3>
<pre><code class="hljs language-vbnet" lang="vbnet">- dev：运行<span class="hljs-keyword">next</span> dev启动 <span class="hljs-keyword">Next</span>.js开发模式。
- build：运行<span class="hljs-keyword">next</span> build构建生产应用包。
- start：运行<span class="hljs-keyword">next</span> start启动 <span class="hljs-keyword">Next</span>.js 生产应用包。
- lint：运行<span class="hljs-keyword">next</span> lint设置 <span class="hljs-keyword">Next</span>.js 的内置 ESLint 配置。
</code></pre>
<h4 data-id="heading-23">1.核心规则</h4>

























<table><thead><tr><th>组件类型</th><th>是否需要标记</th><th>说明</th></tr></thead><tbody><tr><td><strong>服务端组件</strong></td><td>不需要标记（默认启用）</td><td><code>.jsx</code>/<code>.tsx</code> 文件默认就是服务端组件</td></tr><tr><td><strong>客户端组件</strong></td><td>必须加 <code>'use client'</code></td><td>任何需要 useState/Effect/浏览器 API 的组件</td></tr><tr><td><strong>服务端动作</strong></td><td>必须加 <code>'use server'</code></td><td>处理表单提交等服务器端操作的函数</td></tr></tbody></table>
<h5 data-id="heading-24">CSR客户端组件</h5>
<p>文件起头添加<code>use client</code>标识，可以使用浏览器APi(如：localStorage等)，添加交互性事件和事件侦听器。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// pages/test01</span>
<span class="hljs-string">"use client"</span>
<span class="hljs-keyword">import</span> {useEffect, useState} <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;

<span class="hljs-keyword">export</span>  <span class="hljs-keyword">default</span>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">Test01</span> () {
    <span class="hljs-keyword">const</span> [name, setName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);

    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">fetch</span>(...).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> <span class="hljs-title function_">setName</span>(res));
    }, [])
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>name: {name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf9ccc8ad4d74e58bd626e7de9a9f7d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVuX3hpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710209&amp;x-signature=HZ6QAddJwAucg6waF9mLM3DFSRY%3D" alt="image.png" loading="lazy"/></p>
<p>浏览器第一时间得到的结果没有userName实际值,不利于SEO，结果需要等待请求到真实数据后，通过js操作dom进行回显</p>
<h5 data-id="heading-25">SSR服务端组件</h5>
<p><code>.jsx</code>/<code>.tsx</code> 文件默认就是服务端组件，可以使用内置方法<code>getServerSideProps</code>获取服务端数据，并以props形式回传给当前组件</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// pages/test02</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">Test02</span> ({ name }: { <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> }) {

    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>name: {name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getServerSideProps</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> name = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(...)
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">props</span>: { name }  }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4752817c03994b5e82f08e8192376725~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVuX3hpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710209&amp;x-signature=cUl8KhJ1rkcmtt7KwIvlZEfQ2W4%3D" alt="image.png" loading="lazy"/></p>
<p>在服务器中请求数据后，直接将数据拼接到html中，并将组合好数据的html结构传给浏览器，有利于SEO</p>
<h5 data-id="heading-26">RSC服务器组件</h5>
<p><code>React Server Components</code>也是服务端渲染，是基于SSR之上的方案，在<code>/app</code>目录下创建的页面，默认就是RSC服务器组件</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// app/page.jsx (默认RSC)</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 直接使用 async/await 获取数据、访问数据库</span>
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(...)
  
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{data}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre>
<p>通过流式处理（Suspense + lazy），您可以从服务器逐步呈现 UI。工作被拆分为块，并在客户端准备就绪时流式传输到客户端。这允许用户在整个内容完成渲染之前立即看到页面的某些部分。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac4d368ba91145918d4074f34ba9c5c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVuX3hpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710209&amp;x-signature=7ChevF0ttMiiUKwPy2f87Gc8680%3D" alt="image.png" loading="lazy"/></p>
<p>通过浏览器插件<strong>React Developer Tools</strong>，查看当前<code>app/page.jsx</code>页面组件层级，即可看到其底层组件层级。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ed3faace70a4342993869fa47f3ca56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVuX3hpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710209&amp;x-signature=LTYqpJKAWvV8FsGDyWJiRrO8Uas%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-27">2.服务端组件和客户端组件使用核规则</h4>
<p><code>尽量整个页面为服务器组件（RSC）</code>，即可灵活引入各类型组件。</p>
<h5 data-id="heading-28">客户端组件</h5>
<ul>
<li>客户端组件子组件必须是客户端组件</li>
</ul>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// src/components/Header</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Header</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(...);
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            header
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
}

<span class="hljs-comment">// src/pages/page1</span>
<span class="hljs-string">"use client"</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Header</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"@/components/Header"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page1</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Page1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
}
</code></pre>
<p>Header为服务端组件，作为子组件被客户端组件引用时，页面报错。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b43b9e6f48d4c0a877d5f745b427ec9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHVuX3hpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710209&amp;x-signature=PgmQmEU9PfktYUeSaSa2ialSYJo%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>
<p>服务器组件可以作为客户端组件的插槽</p>
</li>
<li>
<p>服务器组件可以作为客户端组件的属性</p>
</li>
<li>
<p>Context组件通信必须在客户端组件中来完成</p>
</li>
</ul>
<h5 data-id="heading-29">服务器组件</h5>
<ul>
<li>服务器组件和客户端组件都能作为服务器组件子组件</li>
</ul>
<h5 data-id="heading-30">外部依赖组件</h5>
<ul>
<li>如果当前页面需要引入外部依赖中的组件报错，可能是外部依赖组件没有使用<code>use client</code>标识，导致将其作为服务端组件进行使用从而你报错，可创建客户端组件包裹依赖组件即可。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别再只会用默认插槽了！Vue插槽这些高级用法让你的组件更强大]]></title>    <link>https://juejin.cn/post/7571646669202538538</link>    <guid>https://juejin.cn/post/7571646669202538538</guid>    <pubDate>2025-11-12T23:25:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571646669202538538" data-draft-id="7571646669202522154" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别再只会用默认插槽了！Vue插槽这些高级用法让你的组件更强大"/> <meta itemprop="keywords" content="Vue.js,JavaScript,前端"/> <meta itemprop="datePublished" content="2025-11-12T23:25:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="良山有风来"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别再只会用默认插槽了！Vue插槽这些高级用法让你的组件更强大
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    良山有风来
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T23:25:52.000Z" title="Wed Nov 12 2025 23:25:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是不是经常遇到这样的情况：写了一个通用组件，却发现有些地方需要微调样式，有些地方需要替换部分内容，但又不想为了这点小改动就写一个新的组件？</p>
<p>如果你还在用默认插槽来解决所有问题，那真的有点out了。今天我要分享的Vue插槽高级用法，能让你的组件灵活度提升好几个level！</p>
<p>读完这篇文章，你会彻底搞懂作用域插槽和具名插槽的实战技巧，让你的组件像乐高一样可以随意组合，再也不用担心产品经理那些“稍微改一下”的需求了。</p>
<h2 data-id="heading-0">从基础开始：插槽到底是什么？</h2>
<p>先来个简单的回忆。插槽就是Vue组件里的一个占位符，让使用组件的时候可以往里面塞自定义内容。</p>
<p>看个最简单的例子：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 定义一个带插槽的组件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">MyComponent</span> = {
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;div class="container"&gt;
      &lt;h2&gt;我是组件标题&lt;/h2&gt;
      &lt;slot&gt;&lt;/slot&gt;
    &lt;/div&gt;
  `</span>
}

<span class="hljs-comment">// 使用这个组件</span>
&lt;my-component&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这里的内容会显示在slot的位置<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>
&lt;/my-component&gt;
</code></pre>
<p>这个就是最基本的默认插槽。但现实开发中，我们经常遇到更复杂的需求，这时候就需要更高级的玩法了。</p>
<h2 data-id="heading-1">具名插槽：多个插槽怎么管理？</h2>
<p>想象一下，你要做一个卡片组件，这个卡片有头部、主体、底部三个部分，每个部分都需要自定义内容。如果还用默认插槽，代码就会变得很混乱。</p>
<p>这时候具名插槽就派上用场了：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 卡片组件定义</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">CardComponent</span> = {
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;div class="card"&gt;
      &lt;div class="card-header"&gt;
        &lt;slot name="header"&gt;&lt;/slot&gt;
      &lt;/div&gt;
      &lt;div class="card-body"&gt;
        &lt;slot name="body"&gt;&lt;/slot&gt;
      &lt;/div&gt;
      &lt;div class="card-footer"&gt;
        &lt;slot name="footer"&gt;&lt;/slot&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  `</span>
}
</code></pre>
<p>使用的时候，我们可以这样给不同的插槽传递内容：</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;card-component&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-slot:header</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>这是卡片标题<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
  
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-slot:body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这是卡片的主体内容，可以放任何你想放的东西<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>点击我<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
  
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-slot:footer</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>底部信息<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>链接<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
&lt;/card-component&gt;
</code></pre>
<p>看到没？每个部分都清晰明了，再也不用在默认插槽里堆砌一堆div还要用CSS来控制布局了。</p>
<p>这里有个小技巧，v-slot:header可以简写成#header，写起来更简洁：</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;card-component&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">header</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>简洁写法<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
&lt;/card-component&gt;
</code></pre>
<h2 data-id="heading-2">作用域插槽：让插槽内容访问组件数据</h2>
<p>这才是今天的大招！作用域插槽允许插槽内容访问子组件中的数据，这让组件的灵活性达到了新的高度。</p>
<p>举个实际例子：我们要做一个数据列表组件，但希望使用组件的人可以自定义每行怎么显示。</p>
<p>先看传统的做法有什么问题：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 传统做法 - 灵活性很差</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">DataList</span> = {
  <span class="hljs-attr">props</span>: [<span class="hljs-string">'items'</span>],
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;ul&gt;
      &lt;li v-for="item in items" :key="item.id"&gt;
        {{ item.name }} - {{ item.price }}
      &lt;/li&gt;
    &lt;/ul&gt;
  `</span>
}
</code></pre>
<p>这样写死的话，如果其他地方需要显示不同的字段，就得重新写一个组件。太麻烦了！</p>
<p>现在看作用域插槽的解决方案：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用作用域插槽的灵活版本</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">FlexibleList</span> = {
  <span class="hljs-attr">props</span>: [<span class="hljs-string">'items'</span>],
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;ul&gt;
      &lt;li v-for="item in items" :key="item.id"&gt;
        &lt;slot :item="item"&gt;&lt;/slot&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  `</span>
}
</code></pre>
<p>使用的时候，我们可以这样自定义每行的显示：</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;flexible-list :items=<span class="hljs-string">"productList"</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-slot</span>=<span class="hljs-string">"slotProps"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"product-item"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>{{ slotProps.item.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"price"</span>&gt;</span>¥{{ slotProps.item.price }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"addToCart(slotProps.item)"</span>&gt;</span>加入购物车<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
&lt;/flexible-list&gt;
</code></pre>
<p>这里的关键在于，我们在slot上绑定了item数据，然后在父组件中通过slotProps来接收这些数据。这样，使用组件的人就可以完全控制怎么显示每个item了。</p>
<h2 data-id="heading-3">实战进阶：作用域插槽 + 具名插槽组合使用</h2>
<p>真正强大的时候是当作用域插槽和具名插槽结合使用的时候。我们来看一个更复杂的例子：一个完整的数据表格组件。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 高级表格组件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">AdvancedTable</span> = {
  <span class="hljs-attr">props</span>: [<span class="hljs-string">'data'</span>, <span class="hljs-string">'columns'</span>],
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;div class="table-wrapper"&gt;
      &lt;table&gt;
        &lt;!-- 表头部分 --&gt;
        &lt;thead&gt;
          &lt;tr&gt;
            &lt;th v-for="col in columns" :key="col.key"&gt;
              &lt;slot name="header" :column="col"&gt;
                {{ col.title }}
              &lt;/slot&gt;
            &lt;/th&gt;
          &lt;/tr&gt;
        &lt;/thead&gt;
        
        &lt;!-- 表格主体 --&gt;
        &lt;tbody&gt;
          &lt;tr v-for="(row, index) in data" :key="row.id"&gt;
            &lt;td v-for="col in columns" :key="col.key"&gt;
              &lt;slot 
                name="cell" 
                :row="row" 
                :column="col"
                :index="index"
              &gt;
                {{ row[col.key] }}
              &lt;/slot&gt;
            &lt;/td&gt;
          &lt;/tr&gt;
        &lt;/tbody&gt;
        
        &lt;!-- 表格底部 --&gt;
        &lt;tfoot&gt;
          &lt;slot name="footer" :data="data"&gt;&lt;/slot&gt;
        &lt;/tfoot&gt;
      &lt;/table&gt;
    &lt;/div&gt;
  `</span>
}
</code></pre>
<p>这个组件提供了极大的灵活性：</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;advanced-table 
  :data=<span class="hljs-string">"userList"</span> 
  :columns=<span class="hljs-string">"tableColumns"</span>
&gt;
  &lt;!-- 自定义表头 --&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">header</span>=<span class="hljs-string">"slotProps"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-header"</span>&gt;</span>
      {{ slotProps.column.title }}
      <span class="hljs-tag">&lt;<span class="hljs-name">i</span> 
        <span class="hljs-attr">v-if</span>=<span class="hljs-string">"slotProps.column.sortable"</span> 
        <span class="hljs-attr">class</span>=<span class="hljs-string">"sort-icon"</span>
        @<span class="hljs-attr">click</span>=<span class="hljs-string">"sortTable(slotProps.column)"</span>
      &gt;</span>↑↓<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
  
  &lt;!-- 自定义单元格 --&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">cell</span>=<span class="hljs-string">"slotProps"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"slotProps.column.key === 'avatar'"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> 
        <span class="hljs-attr">:src</span>=<span class="hljs-string">"slotProps.row.avatar"</span> 
        <span class="hljs-attr">:alt</span>=<span class="hljs-string">"slotProps.row.name"</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"avatar"</span>
      &gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"slotProps.column.key === 'status'"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> 
        <span class="hljs-attr">:class</span>=<span class="hljs-string">"`status-badge status-${slotProps.row.status}`"</span>
      &gt;</span>
        {{ getStatusText(slotProps.row.status) }}
      <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else</span>&gt;</span>
      {{ slotProps.row[slotProps.column.key] }}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  
  <span class="hljs-comment">&lt;!-- 自定义底部 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">footer</span>=<span class="hljs-string">"slotProps"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">:colspan</span>=<span class="hljs-string">"tableColumns.length"</span>&gt;</span>
        共 {{ slotProps.data.length }} 条数据
      <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">advanced-table</span>&gt;</span></span>
</code></pre>
<p>这样的组件既保持了统一的表格功能，又给了使用者最大的自定义空间。</p>
<h2 data-id="heading-4">实际业务场景：配置化表单生成器</h2>
<p>我们再来看一个更贴近实际业务的例子。很多管理系统都需要动态表单，根据配置渲染不同的表单项。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 动态表单组件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">DynamicForm</span> = {
  <span class="hljs-attr">props</span>: [<span class="hljs-string">'fields'</span>, <span class="hljs-string">'formData'</span>],
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;form class="dynamic-form"&gt;
      &lt;div 
        v-for="field in fields" 
        :key="field.name"
        class="form-field"
      &gt;
        &lt;label&gt;{{ field.label }}&lt;/label&gt;
        
        &lt;slot 
          name="field" 
          :field="field" 
          :value="formData[field.name]"
          :onChange="(val) =&gt; $emit('update:formData', {
            ...formData,
            [field.name]: val
          })"
        &gt;
          &lt;!-- 默认的表单渲染 --&gt;
          &lt;input 
            v-if="field.type === 'text'"
            :type="field.type"
            :value="value"
            @input="onChange($event.target.value)"
            :placeholder="field.placeholder"
          &gt;
          
          &lt;select 
            v-else-if="field.type === 'select'"
            :value="value"
            @change="onChange($event.target.value)"
          &gt;
            &lt;option 
              v-for="option in field.options" 
              :key="option.value"
              :value="option.value"
            &gt;
              {{ option.label }}
            &lt;/option&gt;
          &lt;/select&gt;
        &lt;/slot&gt;
        
        &lt;!-- 错误信息插槽 --&gt;
        &lt;slot 
          name="error" 
          :field="field"
          :errors="fieldErrors[field.name]"
        &gt;
          &lt;div 
            v-if="fieldErrors[field.name]" 
            class="error-message"
          &gt;
            {{ fieldErrors[field.name] }}
          &lt;/div&gt;
        &lt;/slot&gt;
      &lt;/div&gt;
    &lt;/form&gt;
  `</span>
}
</code></pre>
<p>使用的时候，我们可以完全重写某个字段的渲染方式：</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;dynamic-form 
  :fields=<span class="hljs-string">"formConfig"</span> 
  :form-data=<span class="hljs-string">"formData"</span>
  @<span class="hljs-attr">update</span>:form-data=<span class="hljs-string">"handleFormUpdate"</span>
&gt;
  &lt;!-- 自定义头像上传字段 --&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">field</span>=<span class="hljs-string">"slotProps"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"slotProps.field.name === 'avatar'"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">image-uploader</span>
        <span class="hljs-attr">:value</span>=<span class="hljs-string">"slotProps.value"</span>
        @<span class="hljs-attr">change</span>=<span class="hljs-string">"slotProps.onChange"</span>
      /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 其他字段使用默认渲染 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">slot</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
  
  &lt;!-- 自定义错误提示样式 --&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">error</span>=<span class="hljs-string">"slotProps"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
      <span class="hljs-attr">v-if</span>=<span class="hljs-string">"slotProps.errors"</span> 
      <span class="hljs-attr">class</span>=<span class="hljs-string">"my-custom-error"</span>
    &gt;</span>
      ❌ {{ slotProps.errors }}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
&lt;/dynamic-form&gt;
</code></pre>
<h2 data-id="heading-5">性能优化和最佳实践</h2>
<p>虽然作用域插槽很强大，但也要注意一些使用技巧：</p>
<ol>
<li>
<p><strong>避免不必要的重新渲染</strong></p>
<p>作用域插槽每次都会创建新的作用域，如果数据没变但组件重新渲染了，可能是作用域插槽导致的。</p>
</li>
<li>
<p><strong>合理使用默认内容</strong></p>
<p>给插槽提供合理的默认内容，让组件开箱即用：</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;slot name=<span class="hljs-string">"empty"</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"empty-state"</span>&gt;</span>
    暂无数据
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/slot&gt;
</code></pre>
</li>
<li>
<p><strong>使用解构让代码更清晰</strong></p>
<p>作用域插槽的参数可以使用解构，让模板更简洁：</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;template #item=<span class="hljs-string">"{ id, name, price }"</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{{ name }} - {{ price }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;
</code></pre>
</li>
</ol>
<h2 data-id="heading-6">总结</h2>
<p>Vue插槽的高级用法真的能让你的组件开发体验完全不同。具名插槽解决了多插槽管理的难题，作用域插槽则打破了父子组件的数据隔离，让组件既保持封装性又具备灵活性。</p>
<p>记住这个进阶路径：默认插槽 → 具名插槽 → 作用域插槽 → 组合使用。每掌握一个层次，你的组件设计能力就提升一个档次。</p>
<p>现在回头看看你项目里的那些通用组件，是不是有很多地方可以用今天学到的技巧来重构？动手试试吧，你会惊讶于组件灵活度提升带来的开发效率变化！</p>
<p>如果你在实战中遇到了有趣的问题或者有更好的用法，欢迎在评论区分享你的经验！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[7 款最佳自托管 AI 工具，快速构建业务应用]]></title>    <link>https://juejin.cn/post/7572138663121518634</link>    <guid>https://juejin.cn/post/7572138663121518634</guid>    <pubDate>2025-11-14T07:40:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572138663121518634" data-draft-id="7572137760447922217" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="7 款最佳自托管 AI 工具，快速构建业务应用"/> <meta itemprop="keywords" content="开源,资讯,低代码"/> <meta itemprop="datePublished" content="2025-11-14T07:40:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NocoBase"/> <meta itemprop="url" content="https://juejin.cn/user/180779873743566"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            7 款最佳自托管 AI 工具，快速构建业务应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180779873743566/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NocoBase
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T07:40:44.000Z" title="Fri Nov 14 2025 07:40:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>原文链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2F7-self-hosted-ai-tools-build-business-app" target="_blank" title="https://www.nocobase.com/cn/blog/7-self-hosted-ai-tools-build-business-app" ref="nofollow noopener noreferrer">www.nocobase.com/cn/blog/7-s…</a></p>
<p>过去一年，我们一直在持续关注自托管生态。</p>
<p>从最初的<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fthe-ultimate-guide-to-awesome-self-hosted-solutions" target="_blank" title="https://www.nocobase.com/cn/blog/the-ultimate-guide-to-awesome-self-hosted-solutions" ref="nofollow noopener noreferrer">系统搭建指南</a>，再到后来的<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fdata-transformation-tools" target="_blank" title="https://www.nocobase.com/cn/blog/data-transformation-tools" ref="nofollow noopener noreferrer">数据管理与工具推荐</a>，为了帮助开发者快速了解行业趋势，我们还整理了<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fself-hsosted-projects-list" target="_blank" title="https://www.nocobase.com/cn/blog/self-hsosted-projects-list" ref="nofollow noopener noreferrer">《GitHub Star 数量前 13 的自托管项目》</a>，盘点了包括工作流、Git 管理、低代码、日志分析等的热门项目。</p>
<p>随着 AI 的加入，自托管生态正在进入一个更实用的阶段。</p>
<p>越来越多的平台开始将 AI 融入系统，它不仅能在本地读取数据、生成内容、执行任务，还能直接参与业务流程，以更灵活、更安全的方式为团队赋能。</p>
<p>这篇文章我们从一个新的角度切入：</p>
<blockquote>
<p>当人工智能与自托管结合，哪些工具真正能加速商业应用开发？</p>
</blockquote>
<p>我们挑选了7 款值得关注的项目。</p>
<p>它们都支持自主部署（Self-Hosted），并能在确保数据隐私与灵活扩展的前提下，帮助团队快速构建出具备 AI 能力的商业系统。</p>
<hr/>
<p>💬 嗨！你正在阅读 NocoBase 博客。NocoBase 是一个极易扩展的 AI 无代码/低代码开发平台，用于构建企业应用、内部工具和各类系统。它完全支持自托管，基于插件架构设计，开发者友好。→ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase" target="_blank" title="https://github.com/nocobase/nocobase" ref="nofollow noopener noreferrer">欢迎在 GitHub 上了解我们</a></p>
<hr/>
<h2 data-id="heading-0">快速浏览</h2>
<ol>
<li><strong>NocoBase</strong> —— 无代码 / 低代码开发平台（AI 员工协同完成业务流程与智能分析）</li>
<li><strong>Flowise AI</strong> —— 可视化 AI 工作流构建器（基于 LangChain）</li>
<li><strong>AnythingLLM</strong> —— 私有知识库与企业问答系统（支持 RAG）</li>
<li><strong>SuperAGI</strong> —— 多智能体协作框架（AI Agents 自主执行任务）</li>
<li><strong>n8n</strong>—— 自动化工作流平台（触发式 AI 集成）</li>
<li><strong>LibreChat</strong> —— ChatGPT 风格企业内部聊天界面（连接本地模型）</li>
<li><strong>DocsGPT</strong> —— 文档与知识自动化助手（生成 API 文档与 FAQ）</li>
</ol>
<h2 data-id="heading-1">NocoBase</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb06b78db487429f9c11a6018680cbc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710863&amp;x-signature=fM7K%2BdBqnikKO3GrnymtcUytmDo%3D" alt="NocoBase.png" loading="lazy"/></p>
<p><strong>官网</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2F" target="_blank" title="https://www.nocobase.com/cn/" ref="nofollow noopener noreferrer">www.nocobase.com/cn/</a></p>
<p><strong>GitHub</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase" target="_blank" title="https://github.com/nocobase/nocobase" ref="nofollow noopener noreferrer">github.com/nocobase/no…</a></p>
<p>⭐<strong>GitHub Stars</strong>：19.5k</p>
<p><strong>功能方向：</strong></p>
<p>自托管的无代码 / 低代码开发平台。</p>
<p><strong>核心亮点：</strong></p>
<ul>
<li><strong>AI 员工</strong>：系统可在内部直接调用语言模型，定义具备上下文记忆的 AI 角色，让 AI 参与数据录入、流程执行和内容生成。</li>
<li><strong>数据模型驱动架构</strong>：基于 data-model-driven 设计，不依赖传统表单结构，能灵活定义业务实体及关系，适合复杂企业级应用。</li>
<li><strong>插件化与私有部署</strong>：功能均以插件形式扩展，可对接外部数据库、API 或 LLM 服务；支持 Docker 与源码部署，确保系统完全自托管、数据可控。</li>
</ul>
<p><strong>适用场景：</strong></p>
<ul>
<li>快速构建 CRM、ERP、审批流、知识管理等内部系统。</li>
<li>在现有业务中引入 AI 协作或自动化的企业团队。</li>
<li>对数据安全、系统可控性和私有部署要求高的行业（如金融、医疗、教育）。</li>
<li>需要通过插件和模型持续扩展功能的中大型组织。</li>
</ul>
<p><strong>自托管支持：</strong>  ✅ Docker 镜像 / 源码部署（支持私有化环境、本地数据库与外部 LLM 连接）</p>
<h2 data-id="heading-2">Flowise AI</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d71074ce77f45398c8ee21ba76449ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710863&amp;x-signature=7Uw9Gd4iEY%2BWuyZT6iSwjDHsZy4%3D" alt="Flowise AI.png" loading="lazy"/></p>
<p><strong>官网</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fflowiseai.com" target="_blank" title="https://flowiseai.com" ref="nofollow noopener noreferrer">flowiseai.com</a></p>
<p><strong>GitHub</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFlowiseAI%2FFlowise" target="_blank" title="https://github.com/FlowiseAI/Flowise" ref="nofollow noopener noreferrer">github.com/FlowiseAI/F…</a></p>
<p>⭐<strong>GitHub Stars</strong>：46.5k</p>
<p><strong>功能方向：</strong>  可视化的 AI 工作流与智能体（Agent）构建平台。</p>
<p><strong>核心亮点：</strong></p>
<ul>
<li><strong>可视化流程设计</strong>：拖拽式节点界面，让模型、数据库、API 之间的逻辑搭建更直观，大幅降低了构建 AI 工作流的门槛。</li>
<li><strong>多模型与智能协作</strong>：基于 LangChain 架构，兼容 OpenAI、Claude、Ollama 等模型，支持多智能体协作与人机混合流程。</li>
<li><strong>流程监控与系统集成</strong>：提供执行日志与追踪功能，支持将流程导出为 REST API 或嵌入现有系统。</li>
</ul>
<p><strong>适用场景：</strong></p>
<ul>
<li>希望快速搭建基于 LLM 的问答、报告或内容生成流程的团队。</li>
<li>需要在企业内部构建 AI 自动化系统（客服、审批、数据处理）的组织。</li>
<li>想验证不同模型组合或插件逻辑的开发者与产品团队。</li>
<li>对数据安全、流程可控性有要求的企业。</li>
</ul>
<p><strong>自托管支持：</strong>  ✅ Docker 镜像 / 源码部署（支持本地模型、私有知识库与外部工具集成）</p>
<h2 data-id="heading-3">AnythingLLM</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffc2a82c17f34abb883372310e035158~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710863&amp;x-signature=uMSeerv92hozXgLJM912W0WFtl4%3D" alt="AnythingLLM.png" loading="lazy"/></p>
<p><strong>官网</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fanythingllm.com" target="_blank" title="https://anythingllm.com" ref="nofollow noopener noreferrer">anythingllm.com</a></p>
<p><strong>GitHub</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMintplex-Labs%2Fanything-llm" target="_blank" title="https://github.com/Mintplex-Labs/anything-llm" ref="nofollow noopener noreferrer">github.com/Mintplex-La…</a></p>
<p>⭐<strong>GitHub Stars</strong>：51k</p>
<p><strong>功能方向：</strong>  私有知识库与企业级问答系统。</p>
<p><strong>核心亮点：</strong></p>
<ul>
<li><strong>文档解析与知识检索</strong>：自动读取 PDF、Word、TXT 等文件，通过语义索引实现内容摘要与问答。</li>
<li><strong>多模型兼容与本地运行</strong>：支持 OpenAI、Anthropic、Ollama 等主流模型，可在本地完成知识问答与内容生成。</li>
<li><strong>数据隐私与本地优先</strong>：默认在本地存储与执行，不上传文档或对话数据；提供桌面端与服务器自托管版本。</li>
</ul>
<p><strong>适用场景：</strong></p>
<ul>
<li>在企业内部构建统一的知识问答系统，实现跨部门信息检索。</li>
<li>部署私有 AI 客服或知识助手，用于提升文档利用率和响应效率。</li>
<li>将知识检索功能嵌入现有 CRM、项目管理或门户系统。</li>
<li>在金融、医疗或政企等对数据安全和合规性要求较高的环境中使用。</li>
</ul>
<p><strong>自托管支持：</strong>  ✅ Docker 镜像 / 源码部署 + 桌面端运行（支持本地模型、向量数据库与插件扩展）</p>
<h2 data-id="heading-4">SuperAGI</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/677ce5698863469e94c3750d188ef7bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710863&amp;x-signature=wOD6WhjeT6elmU8UB7DGEws5KQE%3D" alt="SuperAGI.png" loading="lazy"/></p>
<p><strong>官网</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fsuperagi.com" target="_blank" title="https://superagi.com" ref="nofollow noopener noreferrer">superagi.com</a></p>
<p><strong>GitHub</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTransformerOptimus%2FSuperAGI" target="_blank" title="https://github.com/TransformerOptimus/SuperAGI" ref="nofollow noopener noreferrer">github.com/Transformer…</a></p>
<p>⭐<strong>GitHub Stars</strong>：16.9k</p>
<p><strong>功能方向：</strong> 自托管的自治 AI Agent 框架。</p>
<p><strong>核心亮点：</strong></p>
<ul>
<li><strong>多智能体管理</strong>：支持创建、运行和协作多个自治 Agent，可用于任务执行、流程自动化或工具集成。</li>
<li><strong>可扩展工具生态</strong>：通过 Toolkits 机制扩展 Agent 能力，支持调用数据库、记录执行日志、保存上下文记忆或自定义模型。</li>
<li><strong>并行执行与可监控性</strong>：框架可同时运行多个 Agent，内置性能与成本监控，支持多模型适配和 Token 管理。</li>
</ul>
<p><strong>适用场景：</strong></p>
<ul>
<li>希望在企业内部部署可控的 AI 自动化系统，用于邮件处理、报告生成或任务分配的团队。</li>
<li>需要构建多 Agent 协作平台，用于数据分析、客服运营等跨系统流程的企业。</li>
<li>想设计具备记忆、工具调用和任务协作特性的智能体流程，提高业务自动化与智能化水平的组织。</li>
<li>对数据隐私、执行透明度和系统可控性要求较高的公司。</li>
</ul>
<p><strong>自托管支持：</strong>  ✅ Docker 镜像 / 源码部署（支持本地数据库、工具集成与自定义 Agent）</p>
<h2 data-id="heading-5">n8n</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bc2b9ff0ecf4cb482ba1b72205f8457~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710863&amp;x-signature=dBXpTAZZeQyso5vdnyyVuSsD4NI%3D" alt="n8n.png" loading="lazy"/></p>
<p><strong>官网</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fn8n.io" target="_blank" title="https://n8n.io" ref="nofollow noopener noreferrer">n8n.io</a></p>
<p><strong>GitHub</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fn8n-io%2Fn8n" target="_blank" title="https://github.com/n8n-io/n8n" ref="nofollow noopener noreferrer">github.com/n8n-io/n8n</a></p>
<p>⭐<strong>GitHub Stars</strong>：156k</p>
<p><strong>功能方向：</strong> 自托管的工作流自动化平台，具备原生 AI 集成能力。</p>
<p><strong>核心亮点：</strong></p>
<ul>
<li><strong>可视化与代码混合构建</strong>：拖拽式节点结合 JS/Python 支持，兼顾灵活性与低代码效率。</li>
<li><strong>原生 AI 与丰富集成</strong>：内置 AI 工作流功能，可接入任意 LLM，支持 400+ 平台与服务集成，适合构建基于数据与模型的自动化系统。</li>
<li><strong>私有化与完全控制</strong>：支持完整自托管，包括 AI 模型部署，满足对数据安全与环境自由度要求高的使用场景。</li>
</ul>
<p><strong>适用场景：</strong></p>
<ul>
<li>构建跨系统自动化流程，如数据库同步、邮件触发或报告生成。</li>
<li>在现有业务逻辑中嵌入 AI 模型，实现智能化的流程编排与任务触发。</li>
<li>在企业内部搭建统一自动化平台，连接 CRM、ERP、客服与消息渠道。</li>
<li>适合希望自主部署、掌握数据并持续扩展自动化能力的用户。</li>
</ul>
<p><strong>自托管支持：</strong>  ✅ Docker 镜像 / 源码部署（支持私有模型、自定义节点与完全自控部署环境）</p>
<h2 data-id="heading-6">LibreChat</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/705d0c78501f4ea3b03ebf5692f7c345~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710863&amp;x-signature=G8Cc8RtFeb8eTOeSqE09HcxYhfc%3D" alt="LibreChat.png" loading="lazy"/></p>
<p><strong>官网</strong>： <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.librechat.ai" target="_blank" title="https://www.librechat.ai" ref="nofollow noopener noreferrer">www.librechat.ai</a></p>
<p><strong>GitHub</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdanny-avila%2FLibreChat" target="_blank" title="https://github.com/danny-avila/LibreChat" ref="nofollow noopener noreferrer">github.com/danny-avila…</a></p>
<p>⭐<strong>GitHub Stars</strong>：31.6k</p>
<p><strong>功能方向：</strong>  自托管的多模型聊天与知识交互平台。</p>
<p><strong>核心亮点：</strong></p>
<ul>
<li><strong>统一聊天界面</strong>：提供类似 ChatGPT 的使用体验，可连接 OpenAI、Azure OpenAI、ElevenLabs 等云端或本地模型。</li>
<li><strong>多用户与安全管理</strong>：支持 OAuth2、LDAP、邮件登录及多用户会话管理，适合企业级使用。</li>
<li><strong>灵活部署与本地优先</strong>：可通过 Docker 或本地环境运行，满足数据可控与部署灵活的需求。</li>
</ul>
<p><strong>适用场景：</strong></p>
<ul>
<li>构建企业内部聊天或知识交互平台，用于员工问答、内容生成或辅助决策。</li>
<li>为客服、产品或运营团队提供统一对话入口，连接插件与 API 执行任务。</li>
<li>在私有环境中部署多模型对话系统，实现本地数据存储与定制扩展。</li>
<li>满足对数据隐私、模型切换与多用户协作要求较高的使用场景。</li>
</ul>
<p><strong>自托管支持：</strong>  ✅ Docker 镜像 / 源码部署（支持多模型切换、自定义插件与多用户管理）</p>
<h2 data-id="heading-7">DocsGPT</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab57004facd94eccbe20ff4a4d0fc01a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710863&amp;x-signature=O5kxXmJsrLambMXbpIY%2B6cN6qgg%3D" alt="DocsGPT.png" loading="lazy"/></p>
<p><strong>官网</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.docsgpt.cloud" target="_blank" title="https://www.docsgpt.cloud" ref="nofollow noopener noreferrer">www.docsgpt.cloud</a></p>
<p><strong>GitHub</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Farc53%2FDocsGPT" target="_blank" title="https://github.com/arc53/DocsGPT" ref="nofollow noopener noreferrer">github.com/arc53/DocsG…</a></p>
<p>⭐<strong>GitHub Stars</strong>：17.4k</p>
<p><strong>功能方向：</strong> 自托管的文档与知识自动化助手平台。</p>
<p><strong>核心亮点：</strong></p>
<ul>
<li><strong>文档分析与智能问答</strong>：支持 PDF、Office 文档和网页内容解析，自动构建语义索引与问答系统。</li>
<li><strong>多模型与工具集成</strong>：可选择不同语言模型或在本地运行模型，支持 Agent 构建、API 和 Webhook 集成。</li>
<li><strong>私有部署与数据主权</strong>：强调“在任何环境下部署”，从本地到私有云均可运行，确保对知识库和数据源的完全控制。</li>
</ul>
<p><strong>适用场景：</strong></p>
<ul>
<li>自动生成 API 文档、SDK 指南、FAQ 与使用说明，并与代码或知识库保持同步。</li>
<li>构建企业内部知识检索系统，将分散的文档与数据整合为统一的问答入口。</li>
<li>在私有环境中部署知识平台，保障敏感文档与数据完全受控。</li>
<li>适合需要持续维护技术文档或知识内容的产品团队、客服支持部门与开发者。</li>
</ul>
<p><strong>自托管支持：</strong>  ✅ Docker 镜像 / 源码部署（支持本地模型、向量数据库与知识源集成）</p>
<h2 data-id="heading-8">结语</h2>
<p>希望这些工具能帮助你看到 <strong>AI 与自托管结合的更多可能性</strong>。 无论是构建业务系统、自动化流程，还是打造企业知识平台，相信你都能从中找到适合的方向和解决方案。</p>
<p>想了解更多 <strong>AI × 开源 × 无代码</strong> 的内容？欢迎访问我们的博客，也请分享给同样热爱探索的朋友</p>
<p>相关阅读：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2F6-in-depth-comparison-rbac-no-code-low-code-platforms" target="_blank" title="https://www.nocobase.com/cn/blog/6-in-depth-comparison-rbac-no-code-low-code-platforms" ref="nofollow noopener noreferrer">6 大企业级无代码低代码平台 RBAC 权限体系深度对比</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2F14-ai-low-code-platforms-github" target="_blank" title="https://www.nocobase.com/cn/blog/14-ai-low-code-platforms-github" ref="nofollow noopener noreferrer">GitHub 上最值得关注的 14 个开源 AI 低代码工具 </a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Ftop-11-github-open-source-no-code-ai-tools" target="_blank" title="https://www.nocobase.com/cn/blog/top-11-github-open-source-no-code-ai-tools" ref="nofollow noopener noreferrer">11 个在 GitHub 上最受欢迎的开源无代码 AI 工具 </a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fgithub-open-source-ai-agent-projects" target="_blank" title="https://www.nocobase.com/cn/blog/github-open-source-ai-agent-projects" ref="nofollow noopener noreferrer">GitHub 上 Star 数量前 18 的开源 AI Agent 项目</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fgithub-open-source-ai-projects" target="_blank" title="https://www.nocobase.com/cn/blog/github-open-source-ai-projects" ref="nofollow noopener noreferrer">GitHub 上 Star 数量前 20 的开源 AI 项目</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fgithub-open-source-mcp-projects" target="_blank" title="https://www.nocobase.com/cn/blog/github-open-source-mcp-projects" ref="nofollow noopener noreferrer">GitHub 上 Star 数量前 8 的开源 MCP 项目</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fgithub-open-source-web-applications" target="_blank" title="https://www.nocobase.com/cn/blog/github-open-source-web-applications" ref="nofollow noopener noreferrer">GitHub 上 Star 数量前 8 的开源 Web 应用项目</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vue3学习笔记]]></title>    <link>https://juejin.cn/post/7572147440314433599</link>    <guid>https://juejin.cn/post/7572147440314433599</guid>    <pubDate>2025-11-14T07:37:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572147440314433599" data-draft-id="7572142436127588371" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vue3学习笔记"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-11-14T07:37:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="乐一李"/> <meta itemprop="url" content="https://juejin.cn/user/3069492196551656"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vue3学习笔记
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3069492196551656/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    乐一李
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T07:37:03.000Z" title="Fri Nov 14 2025 07:37:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读23分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. Vue3简介</h2>
<ul>
<li>
<p>2020年9月18日，<code>Vue.js</code>发布版<code>3.0</code>版本，代号：<code>One Piece</code>（n</p>
</li>
<li>
<p>经历了：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvuejs%2Fcore%2Fcommits%2Fmain" target="_blank" title="https://github.com/vuejs/core/commits/main" ref="nofollow noopener noreferrer">4800+次提交</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvuejs%2Frfcs%2Ftree%2Fmaster%2Factive-rfcs" target="_blank" title="https://github.com/vuejs/rfcs/tree/master/active-rfcs" ref="nofollow noopener noreferrer">40+个RFC</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvuejs%2Fvue-next%2Fpulls%3Fq%3Dis%253Apr%2Bis%253Amerged%2B-author%253Aapp%252Fdependabot-preview%2B" target="_blank" title="https://github.com/vuejs/vue-next/pulls?q=is%3Apr+is%3Amerged+-author%3Aapp%2Fdependabot-preview+" ref="nofollow noopener noreferrer">600+次PR</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvuejs%2Fcore%2Fgraphs%2Fcontributors" target="_blank" title="https://github.com/vuejs/core/graphs/contributors" ref="nofollow noopener noreferrer">300+贡献者</a></p>
</li>
<li>
<p>官方发版地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvuejs%2Fcore%2Freleases%2Ftag%2Fv3.0.0" target="_blank" title="https://github.com/vuejs/core/releases/tag/v3.0.0" ref="nofollow noopener noreferrer">Release v3.0.0 One Piece · vuejs/core</a></p>
</li>
<li>
<p>截止2023年10月，最新的公开版本为：<code>3.3.4</code></p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de9d0dafdb1e4fdda8e22b7ec4940003~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmQ5LiA5p2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710623&amp;x-signature=qhBl903BEwTK25Q%2ByDCEyNNhVEs%3D" alt="1695089947298-161c1b47-eb86-42fb-b1f8-d6a4fcab8ee2.png" loading="lazy"/></p>
<h3 data-id="heading-1">1.1. 【性能的提升】</h3>
<ul>
<li>
<p>打包大小减少<code>41%</code>。</p>
</li>
<li>
<p>初次渲染快<code>55%</code>, 更新渲染快<code>133%</code>。</p>
</li>
<li>
<p>内存减少<code>54%</code>。</p>
</li>
</ul>
<h3 data-id="heading-2">1.2.【 源码的升级】</h3>
<ul>
<li>
<p>使用<code>Proxy</code>代替<code>defineProperty</code>实现响应式。</p>
</li>
<li>
<p>重写虚拟<code>DOM</code>的实现和<code>Tree-Shaking</code>。</p>
</li>
</ul>
<h3 data-id="heading-3">1.3. 【拥抱TypeScript】</h3>
<ul>
<li><code>Vue3</code>可以更好的支持<code>TypeScript</code>。</li>
</ul>
<h3 data-id="heading-4">1.4. 【新的特性】</h3>
<ol>
<li>
<p><code>Composition API</code>（组合<code>API</code>）：</p>
<ul>
<li>
<p><code>setup</code></p>
</li>
<li>
<p><code>ref</code>与<code>reactive</code></p>
</li>
<li>
<p><code>computed</code>与<code>watch</code></p>
<p>......</p>
</li>
</ul>
</li>
<li>
<p>新的内置组件：</p>
<ul>
<li>
<p><code>Fragment</code></p>
</li>
<li>
<p><code>Teleport</code></p>
</li>
<li>
<p><code>Suspense</code></p>
<p>......</p>
</li>
</ul>
</li>
<li>
<p>其他改变：</p>
<ul>
<li>
<p>新的生命周期钩子</p>
</li>
<li>
<p><code>data</code> 选项应始终被声明为一个函数</p>
</li>
<li>
<p>移除<code>keyCode</code>支持作为<code> v-on</code> 的修饰符</p>
<p>......</p>
</li>
</ul>
</li>
</ol>
<h2 data-id="heading-5">2. 创建Vue3工程</h2>
<h3 data-id="heading-6">2.1. 【基于 vue-cli 创建】</h3>
<p>点击查看<a href="https://link.juejin.cn?target=https%3A%2F%2Fcli.vuejs.org%2Fzh%2Fguide%2Fcreating-a-project.html%23vue-create" target="_blank" title="https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create" ref="nofollow noopener noreferrer">官方文档</a></p>
<blockquote>
<p>备注：目前<code>vue-cli</code>已处于维护模式，官方推荐基于 <code>Vite</code> 创建项目。</p>
</blockquote>
<pre><code class="hljs language-powershell" lang="powershell">## 查看@vue/cli版本，确保@vue/cli版本在4.5.0以上
vue --version

## 安装或者升级你的@vue/cli 
npm install -g @vue/cli

## 执行创建命令
vue create vue_test

##  随后选择3.x
##  Choose a version of Vue.js that you want to start the project with (Use arrow keys)
##  &gt; 3.x
##    2.x

## 启动
cd vue_test
npm run serve
</code></pre>
<hr/>
<h3 data-id="heading-7">2.2. 【基于 vite 创建】(推荐)</h3>
<p><code>vite</code> 是新一代前端构建工具，官网地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fvitejs.cn%2F" target="_blank" title="https://vitejs.cn/" ref="nofollow noopener noreferrer">vitejs.cn</a>，<code>vite</code>的优势如下：</p>
<ul>
<li>轻量快速的热重载（<code>HMR</code>），能实现极速的服务启动。</li>
<li>对 <code>TypeScript</code>、<code>JSX</code>、<code>CSS</code> 等支持开箱即用。</li>
<li>真正的按需编译，不再等待整个应用编译完成。</li>
<li><code>webpack</code>构建 与 <code>vite</code>构建对比图如下： <img src="转存失败，建议直接上传图片文件 images/1683167182037-71c78210-8217-4e7d-9a83-e463035efbbe.png" alt="webpack构建转存失败，建议直接上传图片文件" title="webpack构建" loading="lazy"/>	<img src="转存失败，建议直接上传图片文件 images/1683167204081-582dc237-72bc-499e-9589-2cdfd452e62f.png" alt="vite构建转存失败，建议直接上传图片文件" title="vite构建" loading="lazy"/></li>
</ul>

<ul>
<li>具体操作如下（点击查看<a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vuejs.org%2Fguide%2Fquick-start.html%23creating-a-vue-application" target="_blank" title="https://cn.vuejs.org/guide/quick-start.html#creating-a-vue-application" ref="nofollow noopener noreferrer">官方文档</a>）</li>
</ul>
<pre><code class="hljs language-powershell" lang="powershell">## 1.创建命令
npm create vue@latest

## 2.具体配置
## 配置项目名称
√ Project name: vue3_test
## 是否添加TypeScript支持
√ Add TypeScript?  Yes
## 是否添加JSX支持
√ Add JSX Support?  No
## 是否添加路由环境
√ Add Vue Router for Single Page Application development?  No
## 是否添加pinia环境
√ Add Pinia for state management?  No
## 是否添加单元测试
√ Add Vitest for Unit Testing?  No
## 是否添加端到端测试方案
√ Add an End-to-End Testing Solution? » No
## 是否添加ESLint语法检查
√ Add ESLint for code quality?  Yes
## 是否添加Prettiert代码格式化
√ Add Prettier for code formatting?  No
</code></pre>
<p>自己动手编写一个App组件</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="app"&gt;
    &lt;h1&gt;你好啊！&lt;/h1&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script lang="ts"&gt;
  export default {
    name:'App' //组件名
  }
&lt;/script&gt;

&lt;style&gt;
  .app {
    background-color: #ddd;
    box-shadow: 0 0 10px;
    border-radius: 10px;
    padding: 20px;
  }
&lt;/style&gt;
</code></pre>
<p>安装官方推荐的<code>vscode</code>插件：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/036abed54e08441e9f02d63827273fb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmQ5LiA5p2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710623&amp;x-signature=nRRaqoEuOIxqbbHlUqZfZgj7hwA%3D" alt="volar.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff07091c09fa493abc30065672d1da81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmQ5LiA5p2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710623&amp;x-signature=ix2prwrHU%2FfLi%2B%2BLiSrGC367KUg%3D" alt="image-20231218085906380.png" loading="lazy"/>
总结：</p>
<ul>
<li><code>Vite</code> 项目中，<code>index.html</code> 是项目的入口文件，在项目最外层。</li>
<li>加载<code>index.html</code>后，<code>Vite</code> 解析 <code>&lt;script type="module" src="xxx"&gt;</code> 指向的<code>JavaScript</code>。</li>
<li><code>Vue3</code>**中是通过 **<code>createApp</code> 函数创建一个应用实例。</li>
</ul>
<h3 data-id="heading-8">2.3. 【一个简单的效果】</h3>
<p><code>Vue3</code>向下兼容<code>Vue2</code>语法，且<code>Vue3</code>中的模板中可以没有根标签</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="person"&gt;
    &lt;h2&gt;姓名：{{name}}&lt;/h2&gt;
    &lt;h2&gt;年龄：{{age}}&lt;/h2&gt;
    &lt;button @click="changeName"&gt;修改名字&lt;/button&gt;
    &lt;button @click="changeAge"&gt;年龄+1&lt;/button&gt;
    &lt;button @click="showTel"&gt;点我查看联系方式&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script lang="ts"&gt;
  export default {
    name:'App',
    data() {
      return {
        name:'张三',
        age:18,
        tel:'13888888888'
      }
    },
    methods:{
      changeName(){
        this.name = 'zhang-san'
      },
      changeAge(){
        this.age += 1
      },
      showTel(){
        alert(this.tel)
      }
    },
  }
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-9">3. Vue3核心语法</h2>
<h3 data-id="heading-10">3.1.  【OptionsAPI 与 CompositionAPI】</h3>
<ul>
<li><code>Vue2</code>的<code>API</code>设计是<code>Options</code>（配置）风格的。</li>
<li><code>Vue3</code>的<code>API</code>设计是<code>Composition</code>（组合）风格的。</li>
</ul>
<h4 data-id="heading-11">Options API 的弊端</h4>
<p><code>Options</code>类型的 <code>API</code>，数据、方法、计算属性等，是分散在：<code>data</code>、<code>methods</code>、<code>computed</code>中的，若想新增或者修改一个需求，就需要分别修改：<code>data</code>、<code>methods</code>、<code>computed</code>，不便于维护和复用。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18e2dfdc45a345038960fbc3ea4d35cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmQ5LiA5p2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710623&amp;x-signature=BX4fF1ewe%2BL4nAl589XY3rojGrM%3D" alt="1696662197101-55d2b251-f6e5-47f4-b3f1-d8531bbf9279.gif" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5827c36bccb42b2aa14fe42900845ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmQ5LiA5p2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710623&amp;x-signature=YF7sGuLxZDJ9kTGlSqT05vK7A8Y%3D" alt="1696662200734-1bad8249-d7a2-423e-a3c3-ab4c110628be.gif" loading="lazy"/></p>
<h4 data-id="heading-12">Composition API 的优势</h4>
<p>可以用函数的方式，更加优雅的组织代码，让相关功能的代码更加有序的组织在一起。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edd869947b494b47b799193d1918606a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmQ5LiA5p2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710623&amp;x-signature=w2S7zKP9tp5PjuckD501R2OeHeg%3D" alt="1696662249851-db6403a1-acb5-481a-88e0-e1e34d2ef53a.gif" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3a47098551041d39ec959bddb7d063d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmQ5LiA5p2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710623&amp;x-signature=7so64LYSGxOtHAD6BbCj00l8yVg%3D" alt="1696662256560-7239b9f9-a770-43c1-9386-6cc12ef1e9c0.gif" loading="lazy"/></p>
<blockquote>
<p>说明：以上四张动图原创作者：大帅老猿</p>
</blockquote>
<h3 data-id="heading-13">3.2. 【拉开序幕的 setup】</h3>
<h4 data-id="heading-14">setup 概述</h4>
<p><code>setup</code>是<code>Vue3</code>中一个新的配置项，值是一个函数，它是 <code>Composition API</code> <strong>“表演的舞台</strong>***”***，组件中所用到的：数据、方法、计算属性、监视......等等，均配置在<code>setup</code>中。</p>
<p>特点如下：</p>
<ul>
<li><code>setup</code>函数返回的对象中的内容，可直接在模板中使用。</li>
<li><code>setup</code>中访问<code>this</code>是<code>undefined</code>。</li>
<li><code>setup</code>函数会在<code>beforeCreate</code>之前调用，它是“领先”所有钩子执行的。</li>
</ul>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="person"&gt;
    &lt;h2&gt;姓名：{{name}}&lt;/h2&gt;
    &lt;h2&gt;年龄：{{age}}&lt;/h2&gt;
    &lt;button @click="changeName"&gt;修改名字&lt;/button&gt;
    &lt;button @click="changeAge"&gt;年龄+1&lt;/button&gt;
    &lt;button @click="showTel"&gt;点我查看联系方式&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script lang="ts"&gt;
  export default {
    name:'Person',
    setup(){
      // 数据，原来写在data中（注意：此时的name、age、tel数据都不是响应式数据）
      let name = '张三'
      let age = 18
      let tel = '13888888888'

      // 方法，原来写在methods中
      function changeName(){
        name = 'zhang-san' //注意：此时这么修改name页面是不变化的
        console.log(name)
      }
      function changeAge(){
        age += 1 //注意：此时这么修改age页面是不变化的
        console.log(age)
      }
      function showTel(){
        alert(tel)
      }

      // 返回一个对象，对象中的内容，模板中可以直接使用
      return {name,age,tel,changeName,changeAge,showTel}
    }
  }
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-15">setup 的返回值</h4>
<ul>
<li>若返回一个<strong>对象</strong>：则对象中的：属性、方法等，在模板中均可以直接使用**（重点关注）。**</li>
<li>若返回一个<strong>函数</strong>：则可以自定义渲染内容，代码如下：</li>
</ul>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-title function_">setup</span>(<span class="hljs-params"/>){
  <span class="hljs-keyword">return</span> <span class="hljs-function">()=&gt;</span> <span class="hljs-string">'你好啊！'</span>
}
</code></pre>
<h4 data-id="heading-16">setup 与 Options API 的关系</h4>
<ul>
<li><code>Vue2</code> 的配置（<code>data</code>、<code>methos</code>......）中<strong>可以访问到</strong> <code>setup</code>中的属性、方法。</li>
<li>但在<code>setup</code>中<strong>不能访问到</strong><code>Vue2</code>的配置（<code>data</code>、<code>methos</code>......）。</li>
<li>如果与<code>Vue2</code>冲突，则<code>setup</code>优先。</li>
</ul>
<h4 data-id="heading-17">setup 语法糖</h4>
<p><code>setup</code>函数有一个语法糖，这个语法糖，可以让我们把<code>setup</code>独立出去，代码如下：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="person"&gt;
    &lt;h2&gt;姓名：{{name}}&lt;/h2&gt;
    &lt;h2&gt;年龄：{{age}}&lt;/h2&gt;
    &lt;button @click="changName"&gt;修改名字&lt;/button&gt;
    &lt;button @click="changAge"&gt;年龄+1&lt;/button&gt;
    &lt;button @click="showTel"&gt;点我查看联系方式&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script lang="ts"&gt;
  export default {
    name:'Person',
  }
&lt;/script&gt;

&lt;!-- 下面的写法是setup语法糖 --&gt;
&lt;script setup lang="ts"&gt;
  console.log(this) //undefined
  
  // 数据（注意：此时的name、age、tel都不是响应式数据）
  let name = '张三'
  let age = 18
  let tel = '13888888888'

  // 方法
  function changName(){
    name = '李四'//注意：此时这么修改name页面是不变化的
  }
  function changAge(){
    console.log(age)
    age += 1 //注意：此时这么修改age页面是不变化的
  }
  function showTel(){
    alert(tel)
  }
&lt;/script&gt;
</code></pre>
<p>扩展：上述代码，还需要编写一个不写<code>setup</code>的<code>script</code>标签，去指定组件名字，比较麻烦，我们可以借助<code>vite</code>中的插件简化</p>
<ol>
<li>第一步：<code>npm i vite-plugin-vue-setup-extend -D</code></li>
<li>第二步：<code>vite.config.ts</code></li>
</ol>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">VueSetupExtend</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-vue-setup-extend'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [ <span class="hljs-title class_">VueSetupExtend</span>() ]
})
</code></pre>
<ol start="3">
<li>第三步：<code>&lt;script setup lang="ts" name="Person"&gt;</code></li>
</ol>
<h3 data-id="heading-18">3.3. 【ref 创建：基本类型的响应式数据】</h3>
<ul>
<li>**作用：**定义响应式变量。</li>
<li><strong>语法：</strong><code>let xxx = ref(初始值)</code>。</li>
<li>**返回值：**一个<code>RefImpl</code>的实例对象，简称<code>ref对象</code>或<code>ref</code>，<code>ref</code>对象的<code>value</code><strong>属性是响应式的</strong>。</li>
<li><strong>注意点：</strong>
<ul>
<li><code>JS</code>中操作数据需要：<code>xxx.value</code>，但模板中不需要<code>.value</code>，直接使用即可。</li>
<li>对于<code>let name = ref('张三')</code>来说，<code>name</code>不是响应式的，<code>name.value</code>是响应式的。</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="person"&gt;
    &lt;h2&gt;姓名：{{name}}&lt;/h2&gt;
    &lt;h2&gt;年龄：{{age}}&lt;/h2&gt;
    &lt;button @click="changeName"&gt;修改名字&lt;/button&gt;
    &lt;button @click="changeAge"&gt;年龄+1&lt;/button&gt;
    &lt;button @click="showTel"&gt;点我查看联系方式&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts" name="Person"&gt;
  import {ref} from 'vue'
  // name和age是一个RefImpl的实例对象，简称ref对象，它们的value属性是响应式的。
  let name = ref('张三')
  let age = ref(18)
  // tel就是一个普通的字符串，不是响应式的
  let tel = '13888888888'

  function changeName(){
    // JS中操作ref对象时候需要.value
    name.value = '李四'
    console.log(name.value)

    // 注意：name不是响应式的，name.value是响应式的，所以如下代码并不会引起页面的更新。
    // name = ref('zhang-san')
  }
  function changeAge(){
    // JS中操作ref对象时候需要.value
    age.value += 1 
    console.log(age.value)
  }
  function showTel(){
    alert(tel)
  }
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-19">3.4. 【reactive 创建：对象类型的响应式数据】</h3>
<ul>
<li><strong>作用：<strong>定义一个</strong>响应式对象</strong>（基本类型不要用它，要用<code>ref</code>，否则报错）</li>
<li><strong>语法：</strong><code>let 响应式对象= reactive(源对象)</code>。</li>
<li>**返回值：**一个<code>Proxy</code>的实例对象，简称：响应式对象。</li>
<li><strong>注意点：</strong><code>reactive</code>定义的响应式数据是“深层次”的。</li>
</ul>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="person"&gt;
    &lt;h2&gt;汽车信息：一台{{ car.brand }}汽车，价值{{ car.price }}万&lt;/h2&gt;
    &lt;h2&gt;游戏列表：&lt;/h2&gt;
    &lt;ul&gt;
      &lt;li v-for="g in games" :key="g.id"&gt;{{ g.name }}&lt;/li&gt;
    &lt;/ul&gt;
    &lt;h2&gt;测试：{{obj.a.b.c.d}}&lt;/h2&gt;
    &lt;button @click="changeCarPrice"&gt;修改汽车价格&lt;/button&gt;
    &lt;button @click="changeFirstGame"&gt;修改第一游戏&lt;/button&gt;
    &lt;button @click="test"&gt;测试&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script lang="ts" setup name="Person"&gt;
import { reactive } from 'vue'

// 数据
let car = reactive({ brand: '奔驰', price: 100 })
let games = reactive([
  { id: 'ahsgdyfa01', name: '英雄联盟' },
  { id: 'ahsgdyfa02', name: '王者荣耀' },
  { id: 'ahsgdyfa03', name: '原神' }
])
let obj = reactive({
  a:{
    b:{
      c:{
        d:666
      }
    }
  }
})

function changeCarPrice() {
  car.price += 10
}
function changeFirstGame() {
  games[0].name = '流星蝴蝶剑'
}
function test(){
  obj.a.b.c.d = 999
}
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-20">3.5. 【ref 创建：对象类型的响应式数据】</h3>
<ul>
<li>其实<code>ref</code>接收的数据可以是：<strong>基本类型</strong>、<strong>对象类型</strong>。</li>
<li>若<code>ref</code>接收的是对象类型，内部其实也是调用了<code>reactive</code>函数。</li>
</ul>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="person"&gt;
    &lt;h2&gt;汽车信息：一台{{ car.brand }}汽车，价值{{ car.price }}万&lt;/h2&gt;
    &lt;h2&gt;游戏列表：&lt;/h2&gt;
    &lt;ul&gt;
      &lt;li v-for="g in games" :key="g.id"&gt;{{ g.name }}&lt;/li&gt;
    &lt;/ul&gt;
    &lt;h2&gt;测试：{{obj.a.b.c.d}}&lt;/h2&gt;
    &lt;button @click="changeCarPrice"&gt;修改汽车价格&lt;/button&gt;
    &lt;button @click="changeFirstGame"&gt;修改第一游戏&lt;/button&gt;
    &lt;button @click="test"&gt;测试&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script lang="ts" setup name="Person"&gt;
import { ref } from 'vue'

// 数据
let car = ref({ brand: '奔驰', price: 100 })
let games = ref([
  { id: 'ahsgdyfa01', name: '英雄联盟' },
  { id: 'ahsgdyfa02', name: '王者荣耀' },
  { id: 'ahsgdyfa03', name: '原神' }
])
let obj = ref({
  a:{
    b:{
      c:{
        d:666
      }
    }
  }
})

console.log(car)

function changeCarPrice() {
  car.value.price += 10
}
function changeFirstGame() {
  games.value[0].name = '流星蝴蝶剑'
}
function test(){
  obj.value.a.b.c.d = 999
}
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-21">3.6. 【ref 对比 reactive】</h3>
<p>宏观角度看：</p>
<blockquote>
<ol>
<li>
<p><code>ref</code>用来定义：<strong>基本类型数据</strong>、<strong>对象类型数据</strong>；</p>
</li>
<li>
<p><code>reactive</code>用来定义：<strong>对象类型数据</strong>。</p>
</li>
</ol>
</blockquote>
<ul>
<li>区别：</li>
</ul>
<blockquote>
<ol>
<li><code>ref</code>创建的变量必须使用<code>.value</code>（可以使用<code>volar</code>插件自动添加<code>.value</code>）。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f922661b8d5446484ec69d429f95b42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmQ5LiA5p2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710623&amp;x-signature=i%2F1SwB5Cf2TQkMyXe6l10U6AySw%3D" alt="自动补充value.png" loading="lazy"/></p>
<ol start="2">
<li><code>reactive</code>重新分配一个新对象，会<strong>失去</strong>响应式（可以使用<code>Object.assign</code>去整体替换）。</li>
</ol>
</blockquote>
<ul>
<li>使用原则：</li>
</ul>
<blockquote>
<ol>
<li>若需要一个基本类型的响应式数据，必须使用<code>ref</code>。</li>
<li>若需要一个响应式对象，层级不深，<code>ref</code>、<code>reactive</code>都可以。</li>
<li>若需要一个响应式对象，且层级较深，推荐使用<code>reactive</code>。</li>
</ol>
</blockquote>
<h3 data-id="heading-22">3.7. 【toRefs 与 toRef】</h3>
<ul>
<li>作用：将一个响应式对象中的每一个属性，转换为<code>ref</code>对象。</li>
<li>备注：<code>toRefs</code>与<code>toRef</code>功能一致，但<code>toRefs</code>可以批量转换。</li>
<li>语法如下：</li>
</ul>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="person"&gt;
    &lt;h2&gt;姓名：{{person.name}}&lt;/h2&gt;
    &lt;h2&gt;年龄：{{person.age}}&lt;/h2&gt;
    &lt;h2&gt;性别：{{person.gender}}&lt;/h2&gt;
    &lt;button @click="changeName"&gt;修改名字&lt;/button&gt;
    &lt;button @click="changeAge"&gt;修改年龄&lt;/button&gt;
    &lt;button @click="changeGender"&gt;修改性别&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script lang="ts" setup name="Person"&gt;
  import {ref,reactive,toRefs,toRef} from 'vue'

  // 数据
  let person = reactive({name:'张三', age:18, gender:'男'})
	
  // 通过toRefs将person对象中的n个属性批量取出，且依然保持响应式的能力
  let {name,gender} =  toRefs(person)
	
  // 通过toRef将person对象中的gender属性取出，且依然保持响应式的能力
  let age = toRef(person,'age')

  // 方法
  function changeName(){
    name.value += '~'
  }
  function changeAge(){
    age.value += 1
  }
  function changeGender(){
    gender.value = '女'
  }
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-23">3.8. 【computed】</h3>
<p>作用：根据已有数据计算出新数据（和<code>Vue2</code>中的<code>computed</code>作用一致）。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb17bffb189a4b148730c6ab55435a75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmQ5LiA5p2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710623&amp;x-signature=2RoFxLNJSpZBG6c5A%2BfYpQ5pBkc%3D" alt="computed.gif" loading="lazy"/></p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="person"&gt;
    姓：&lt;input type="text" v-model="firstName"&gt; &lt;br&gt;
    名：&lt;input type="text" v-model="lastName"&gt; &lt;br&gt;
    全名：&lt;span&gt;{{fullName}}&lt;/span&gt; &lt;br&gt;
    &lt;button @click="changeFullName"&gt;全名改为：li-si&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts" name="App"&gt;
  import {ref,computed} from 'vue'

  let firstName = ref('zhang')
  let lastName = ref('san')

  // 计算属性——只读取，不修改
  /* let fullName = computed(()=&gt;{
    return firstName.value + '-' + lastName.value
  }) */


  // 计算属性——既读取又修改
  let fullName = computed({
    // 读取
    get(){
      return firstName.value + '-' + lastName.value
    },
    // 修改
    set(val){
      console.log('有人修改了fullName',val)
      firstName.value = val.split('-')[0]
      lastName.value = val.split('-')[1]
    }
  })

  function changeFullName(){
    fullName.value = 'li-si'
  } 
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-24">3.9.【watch】</h3>
<ul>
<li>作用：监视数据的变化（和<code>Vue2</code>中的<code>watch</code>作用一致）</li>
<li>特点：<code>Vue3</code>中的<code>watch</code>只能监视以下<strong>四种数据</strong>：</li>
</ul>
<blockquote>
<ol>
<li><code>ref</code>定义的数据。</li>
<li><code>reactive</code>定义的数据。</li>
<li>函数返回一个值（<code>getter</code>函数）。</li>
<li>一个包含上述内容的数组。</li>
</ol>
</blockquote>
<p>我们在<code>Vue3</code>中使用<code>watch</code>的时候，通常会遇到以下几种情况：</p>
<h4 data-id="heading-25">* 情况一</h4>
<p>监视<code>ref</code>定义的【基本类型】数据：直接写数据名即可，监视的是其<code>value</code>值的改变。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="person"&gt;
    &lt;h1&gt;情况一：监视【ref】定义的【基本类型】数据&lt;/h1&gt;
    &lt;h2&gt;当前求和为：{{sum}}&lt;/h2&gt;
    &lt;button @click="changeSum"&gt;点我sum+1&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script lang="ts" setup name="Person"&gt;
  import {ref,watch} from 'vue'
  // 数据
  let sum = ref(0)
  // 方法
  function changeSum(){
    sum.value += 1
  }
  // 监视，情况一：监视【ref】定义的【基本类型】数据
  const stopWatch = watch(sum,(newValue,oldValue)=&gt;{
    console.log('sum变化了',newValue,oldValue)
    if(newValue &gt;= 10){
      stopWatch()
    }
  })
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-26">* 情况二</h4>
<p>监视<code>ref</code>定义的【对象类型】数据：直接写数据名，监视的是对象的【地址值】，若想监视对象内部的数据，要手动开启深度监视。</p>
<blockquote>
<p>注意：</p>
<ul>
<li>
<p>若修改的是<code>ref</code>定义的对象中的属性，<code>newValue</code> 和 <code>oldValue</code> 都是新值，因为它们是同一个对象。</p>
</li>
<li>
<p>若修改整个<code>ref</code>定义的对象，<code>newValue</code> 是新值， <code>oldValue</code> 是旧值，因为不是同一个对象了。</p>
</li>
</ul>
</blockquote>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="person"&gt;
    &lt;h1&gt;情况二：监视【ref】定义的【对象类型】数据&lt;/h1&gt;
    &lt;h2&gt;姓名：{{ person.name }}&lt;/h2&gt;
    &lt;h2&gt;年龄：{{ person.age }}&lt;/h2&gt;
    &lt;button @click="changeName"&gt;修改名字&lt;/button&gt;
    &lt;button @click="changeAge"&gt;修改年龄&lt;/button&gt;
    &lt;button @click="changePerson"&gt;修改整个人&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script lang="ts" setup name="Person"&gt;
  import {ref,watch} from 'vue'
  // 数据
  let person = ref({
    name:'张三',
    age:18
  })
  // 方法
  function changeName(){
    person.value.name += '~'
  }
  function changeAge(){
    person.value.age += 1
  }
  function changePerson(){
    person.value = {name:'李四',age:90}
  }
  /* 
    监视，情况一：监视【ref】定义的【对象类型】数据，监视的是对象的地址值，若想监视对象内部属性的变化，需要手动开启深度监视
    watch的第一个参数是：被监视的数据
    watch的第二个参数是：监视的回调
    watch的第三个参数是：配置对象（deep、immediate等等.....） 
  */
  watch(person,(newValue,oldValue)=&gt;{
    console.log('person变化了',newValue,oldValue)
  },{deep:true})
  
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-27">*  情况三</h4>
<p>监视<code>reactive</code>定义的【对象类型】数据，且默认开启了深度监视。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="person"&gt;
    &lt;h1&gt;情况三：监视【reactive】定义的【对象类型】数据&lt;/h1&gt;
    &lt;h2&gt;姓名：{{ person.name }}&lt;/h2&gt;
    &lt;h2&gt;年龄：{{ person.age }}&lt;/h2&gt;
    &lt;button @click="changeName"&gt;修改名字&lt;/button&gt;
    &lt;button @click="changeAge"&gt;修改年龄&lt;/button&gt;
    &lt;button @click="changePerson"&gt;修改整个人&lt;/button&gt;
    &lt;hr&gt;
    &lt;h2&gt;测试：{{obj.a.b.c}}&lt;/h2&gt;
    &lt;button @click="test"&gt;修改obj.a.b.c&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script lang="ts" setup name="Person"&gt;
  import {reactive,watch} from 'vue'
  // 数据
  let person = reactive({
    name:'张三',
    age:18
  })
  let obj = reactive({
    a:{
      b:{
        c:666
      }
    }
  })
  // 方法
  function changeName(){
    person.name += '~'
  }
  function changeAge(){
    person.age += 1
  }
  function changePerson(){
    Object.assign(person,{name:'李四',age:80})
  }
  function test(){
    obj.a.b.c = 888
  }

  // 监视，情况三：监视【reactive】定义的【对象类型】数据，且默认是开启深度监视的
  watch(person,(newValue,oldValue)=&gt;{
    console.log('person变化了',newValue,oldValue)
  })
  watch(obj,(newValue,oldValue)=&gt;{
    console.log('Obj变化了',newValue,oldValue)
  })
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-28">* 情况四</h4>
<p>监视<code>ref</code>或<code>reactive</code>定义的【对象类型】数据中的<strong>某个属性</strong>，注意点如下：</p>
<ol>
<li>若该属性值<strong>不是</strong>【对象类型】，需要写成函数形式。</li>
<li>若该属性值是<strong>依然</strong>是【对象类型】，可直接编，也可写成函数，建议写成函数。</li>
</ol>
<p>结论：监视的要是对象里的属性，那么最好写函数式，注意点：若是对象监视的是地址值，需要关注对象内部，需要手动开启深度监视。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="person"&gt;
    &lt;h1&gt;情况四：监视【ref】或【reactive】定义的【对象类型】数据中的某个属性&lt;/h1&gt;
    &lt;h2&gt;姓名：{{ person.name }}&lt;/h2&gt;
    &lt;h2&gt;年龄：{{ person.age }}&lt;/h2&gt;
    &lt;h2&gt;汽车：{{ person.car.c1 }}、{{ person.car.c2 }}&lt;/h2&gt;
    &lt;button @click="changeName"&gt;修改名字&lt;/button&gt;
    &lt;button @click="changeAge"&gt;修改年龄&lt;/button&gt;
    &lt;button @click="changeC1"&gt;修改第一台车&lt;/button&gt;
    &lt;button @click="changeC2"&gt;修改第二台车&lt;/button&gt;
    &lt;button @click="changeCar"&gt;修改整个车&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script lang="ts" setup name="Person"&gt;
  import {reactive,watch} from 'vue'

  // 数据
  let person = reactive({
    name:'张三',
    age:18,
    car:{
      c1:'奔驰',
      c2:'宝马'
    }
  })
  // 方法
  function changeName(){
    person.name += '~'
  }
  function changeAge(){
    person.age += 1
  }
  function changeC1(){
    person.car.c1 = '奥迪'
  }
  function changeC2(){
    person.car.c2 = '大众'
  }
  function changeCar(){
    person.car = {c1:'雅迪',c2:'爱玛'}
  }

  // 监视，情况四：监视响应式对象中的某个属性，且该属性是基本类型的，要写成函数式
  /* watch(()=&gt; person.name,(newValue,oldValue)=&gt;{
    console.log('person.name变化了',newValue,oldValue)
  }) */

  // 监视，情况四：监视响应式对象中的某个属性，且该属性是对象类型的，可以直接写，也能写函数，更推荐写函数
  watch(()=&gt;person.car,(newValue,oldValue)=&gt;{
    console.log('person.car变化了',newValue,oldValue)
  },{deep:true})
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-29">* 情况五</h4>
<p>监视上述的多个数据</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="person"&gt;
    &lt;h1&gt;情况五：监视上述的多个数据&lt;/h1&gt;
    &lt;h2&gt;姓名：{{ person.name }}&lt;/h2&gt;
    &lt;h2&gt;年龄：{{ person.age }}&lt;/h2&gt;
    &lt;h2&gt;汽车：{{ person.car.c1 }}、{{ person.car.c2 }}&lt;/h2&gt;
    &lt;button @click="changeName"&gt;修改名字&lt;/button&gt;
    &lt;button @click="changeAge"&gt;修改年龄&lt;/button&gt;
    &lt;button @click="changeC1"&gt;修改第一台车&lt;/button&gt;
    &lt;button @click="changeC2"&gt;修改第二台车&lt;/button&gt;
    &lt;button @click="changeCar"&gt;修改整个车&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script lang="ts" setup name="Person"&gt;
  import {reactive,watch} from 'vue'

  // 数据
  let person = reactive({
    name:'张三',
    age:18,
    car:{
      c1:'奔驰',
      c2:'宝马'
    }
  })
  // 方法
  function changeName(){
    person.name += '~'
  }
  function changeAge(){
    person.age += 1
  }
  function changeC1(){
    person.car.c1 = '奥迪'
  }
  function changeC2(){
    person.car.c2 = '大众'
  }
  function changeCar(){
    person.car = {c1:'雅迪',c2:'爱玛'}
  }

  // 监视，情况五：监视上述的多个数据
  watch([()=&gt;person.name,person.car],(newValue,oldValue)=&gt;{
    console.log('person.car变化了',newValue,oldValue)
  },{deep:true})

&lt;/script&gt;
</code></pre>
<h3 data-id="heading-30">3.10. 【watchEffect】</h3>
<ul>
<li>
<p>官网：立即运行一个函数，同时响应式地追踪其依赖，并在依赖更改时重新执行该函数。</p>
</li>
<li>
<p><code>watch</code>对比<code>watchEffect</code></p>
<blockquote>
<ol>
<li>
<p>都能监听响应式数据的变化，不同的是监听数据变化的方式不同</p>
</li>
<li>
<p><code>watch</code>：要明确指出监视的数据</p>
</li>
<li>
<p><code>watchEffect</code>：不用明确指出监视的数据（函数中用到哪些属性，那就监视哪些属性）。</p>
</li>
</ol>
</blockquote>
</li>
<li>
<p>示例代码：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="person"&gt;
    &lt;h1&gt;需求：水温达到50℃，或水位达到20cm，则联系服务器&lt;/h1&gt;
    &lt;h2 id="demo"&gt;水温：{{temp}}&lt;/h2&gt;
    &lt;h2&gt;水位：{{height}}&lt;/h2&gt;
    &lt;button @click="changePrice"&gt;水温+1&lt;/button&gt;
    &lt;button @click="changeSum"&gt;水位+10&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script lang="ts" setup name="Person"&gt;
  import {ref,watch,watchEffect} from 'vue'
  // 数据
  let temp = ref(0)
  let height = ref(0)

  // 方法
  function changePrice(){
    temp.value += 10
  }
  function changeSum(){
    height.value += 1
  }

  // 用watch实现，需要明确的指出要监视：temp、height
  watch([temp,height],(value)=&gt;{
    // 从value中获取最新的temp值、height值
    const [newTemp,newHeight] = value
    // 室温达到50℃，或水位达到20cm，立刻联系服务器
    if(newTemp &gt;= 50 || newHeight &gt;= 20){
      console.log('联系服务器')
    }
  })

  // 用watchEffect实现，不用
  const stopWtach = watchEffect(()=&gt;{
    // 室温达到50℃，或水位达到20cm，立刻联系服务器
    if(temp.value &gt;= 50 || height.value &gt;= 20){
      console.log(document.getElementById('demo')?.innerText)
      console.log('联系服务器')
    }
    // 水温达到100，或水位达到50，取消监视
    if(temp.value === 100 || height.value === 50){
      console.log('清理了')
      stopWtach()
    }
  })
&lt;/script&gt;
</code></pre>
</li>
</ul>
<h3 data-id="heading-31">3.11. 【标签的 ref 属性】</h3>
<p>作用：用于注册模板引用。</p>
<blockquote>
<ul>
<li>
<p>用在普通<code>DOM</code>标签上，获取的是<code>DOM</code>节点。</p>
</li>
<li>
<p>用在组件标签上，获取的是组件实例对象。</p>
</li>
</ul>
</blockquote>
<p>用在普通<code>DOM</code>标签上：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="person"&gt;
    &lt;h1 ref="title1"&gt;尚硅谷&lt;/h1&gt;
    &lt;h2 ref="title2"&gt;前端&lt;/h2&gt;
    &lt;h3 ref="title3"&gt;Vue&lt;/h3&gt;
    &lt;input type="text" ref="inpt"&gt; &lt;br&gt;&lt;br&gt;
    &lt;button @click="showLog"&gt;点我打印内容&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script lang="ts" setup name="Person"&gt;
  import {ref} from 'vue'
	
  let title1 = ref()
  let title2 = ref()
  let title3 = ref()

  function showLog(){
    // 通过id获取元素
    const t1 = document.getElementById('title1')
    // 打印内容
    console.log((t1 as HTMLElement).innerText)
    console.log((&lt;HTMLElement&gt;t1).innerText)
    console.log(t1?.innerText)
    
		/************************************/
		
    // 通过ref获取元素
    console.log(title1.value)
    console.log(title2.value)
    console.log(title3.value)
  }
&lt;/script&gt;
</code></pre>
<p>用在组件标签上：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 父组件App.vue --&gt;
&lt;template&gt;
  &lt;Person ref="ren"/&gt;
  &lt;button @click="test"&gt;测试&lt;/button&gt;
&lt;/template&gt;

&lt;script lang="ts" setup name="App"&gt;
  import Person from './components/Person.vue'
  import {ref} from 'vue'

  let ren = ref()

  function test(){
    console.log(ren.value.name)
    console.log(ren.value.age)
  }
&lt;/script&gt;


&lt;!-- 子组件Person.vue中要使用defineExpose暴露内容 --&gt;
&lt;script lang="ts" setup name="Person"&gt;
  import {ref,defineExpose} from 'vue'
	// 数据
  let name = ref('张三')
  let age = ref(18)
  /****************************/
  /****************************/
  // 使用defineExpose将组件中的数据交给外部
  defineExpose({name,age})
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-32">3.12. 【props】</h3>
<blockquote>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 定义一个接口，限制每个Person对象的格式</span>
<span class="hljs-keyword">export</span> interface <span class="hljs-title class_">PersonInter</span> {
 <span class="hljs-attr">id</span>:string,
 <span class="hljs-attr">name</span>:string,
    <span class="hljs-attr">age</span>:number
   }
   
<span class="hljs-comment">// 定义一个自定义类型Persons</span>
<span class="hljs-keyword">export</span> type <span class="hljs-title class_">Persons</span> = <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">PersonInter</span>&gt;
</code></pre>
<p><code>App.vue</code>中代码：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
	&lt;Person :list="persons"/&gt;
&lt;/template&gt;
  
&lt;script lang="ts" setup name="App"&gt;
  import Person from './components/Person.vue'
  import {reactive} from 'vue'
    import {type Persons} from './types'
  
    let persons = reactive&lt;Persons&gt;([
     {id:'e98219e12',name:'张三',age:18},
      {id:'e98219e13',name:'李四',age:19},
       {id:'e98219e14',name:'王五',age:20}
     ])
   &lt;/script&gt;
  
</code></pre>
<p><code>Person.vue</code>中代码：</p>
<pre><code class="hljs language-Vue" lang="Vue">&lt;template&gt;
&lt;div class="person"&gt;
 &lt;ul&gt;
     &lt;li v-for="item in list" :key="item.id"&gt;
        {{item.name}}--{{item.age}}
      &lt;/li&gt;
    &lt;/ul&gt;
   &lt;/div&gt;
   &lt;/template&gt;
  
&lt;script lang="ts" setup name="Person"&gt;
import {defineProps} from 'vue'
import {type PersonInter} from '@/types'
  
  // 第一种写法：仅接收
// const props = defineProps(['list'])
  
  // 第二种写法：接收+限制类型
// defineProps&lt;{list:Persons}&gt;()
  
  // 第三种写法：接收+限制类型+指定默认值+限制必要性
let props = withDefaults(defineProps&lt;{list?:Persons}&gt;(),{
     list:()=&gt;[{id:'asdasg01',name:'小猪佩奇',age:18}]
  })
   console.log(props)
  &lt;/script&gt;
</code></pre>
</blockquote>
<h3 data-id="heading-33">3.13. 【生命周期】</h3>
<ul>
<li>
<p>概念：<code>Vue</code>组件实例在创建时要经历一系列的初始化步骤，在此过程中<code>Vue</code>会在合适的时机，调用特定的函数，从而让开发者有机会在特定阶段运行自己的代码，这些特定的函数统称为：生命周期钩子</p>
</li>
<li>
<p>规律：</p>
<blockquote>
<p>生命周期整体分为四个阶段，分别是：<strong>创建、挂载、更新、销毁</strong>，每个阶段都有两个钩子，一前一后。</p>
</blockquote>
</li>
<li>
<p><code>Vue2</code>的生命周期</p>
<blockquote>
<p>创建阶段：<code>beforeCreate</code>、<code>created</code></p>
<p>挂载阶段：<code>beforeMount</code>、<code>mounted</code></p>
<p>更新阶段：<code>beforeUpdate</code>、<code>updated</code></p>
<p>销毁阶段：<code>beforeDestroy</code>、<code>destroyed</code></p>
</blockquote>
</li>
<li>
<p><code>Vue3</code>的生命周期</p>
<blockquote>
<p>创建阶段：<code>setup</code></p>
<p>挂载阶段：<code>onBeforeMount</code>、<code>onMounted</code></p>
<p>更新阶段：<code>onBeforeUpdate</code>、<code>onUpdated</code></p>
<p>卸载阶段：<code>onBeforeUnmount</code>、<code>onUnmounted</code></p>
</blockquote>
</li>
<li>
<p>常用的钩子：<code>onMounted</code>(挂载完毕)、<code>onUpdated</code>(更新完毕)、<code>onBeforeUnmount</code>(卸载之前)</p>
</li>
<li>
<p>示例代码：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="person"&gt;
    &lt;h2&gt;当前求和为：{{ sum }}&lt;/h2&gt;
    &lt;button @click="changeSum"&gt;点我sum+1&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;!-- vue3写法 --&gt;
&lt;script lang="ts" setup name="Person"&gt;
  import { 
    ref, 
    onBeforeMount, 
    onMounted, 
    onBeforeUpdate, 
    onUpdated, 
    onBeforeUnmount, 
    onUnmounted 
  } from 'vue'

  // 数据
  let sum = ref(0)
  // 方法
  function changeSum() {
    sum.value += 1
  }
  console.log('setup')
  // 生命周期钩子
  onBeforeMount(()=&gt;{
    console.log('挂载之前')
  })
  onMounted(()=&gt;{
    console.log('挂载完毕')
  })
  onBeforeUpdate(()=&gt;{
    console.log('更新之前')
  })
  onUpdated(()=&gt;{
    console.log('更新完毕')
  })
  onBeforeUnmount(()=&gt;{
    console.log('卸载之前')
  })
  onUnmounted(()=&gt;{
    console.log('卸载完毕')
  })
&lt;/script&gt;
</code></pre>
</li>
</ul>
<h3 data-id="heading-34">3.14. 【自定义hook】</h3>
<ul>
<li>
<p>什么是<code>hook</code>？—— 本质是一个函数，把<code>setup</code>函数中使用的<code>Composition API</code>进行了封装，类似于<code>vue2.x</code>中的<code>mixin</code>。</p>
</li>
<li>
<p>自定义<code>hook</code>的优势：复用代码, 让<code>setup</code>中的逻辑更清楚易懂。</p>
</li>
</ul>
<p>示例代码：</p>
<ul>
<li>
<p><code>useSum.ts</code>中内容如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> {ref,onMounted} <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>){
  <span class="hljs-keyword">let</span> sum = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">increment</span> = (<span class="hljs-params"/>)=&gt;{
    sum.<span class="hljs-property">value</span> += <span class="hljs-number">1</span>
  }
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">decrement</span> = (<span class="hljs-params"/>)=&gt;{
    sum.<span class="hljs-property">value</span> -= <span class="hljs-number">1</span>
  }
  <span class="hljs-title function_">onMounted</span>(<span class="hljs-function">()=&gt;</span>{
    <span class="hljs-title function_">increment</span>()
  })

  <span class="hljs-comment">//向外部暴露数据</span>
  <span class="hljs-keyword">return</span> {sum,increment,decrement}
}		
</code></pre>
</li>
<li>
<p><code>useDog.ts</code>中内容如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> {reactive,onMounted} <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> axios,{<span class="hljs-title class_">AxiosError</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>){
  <span class="hljs-keyword">let</span> dogList = reactive&lt;string[]&gt;([])

  <span class="hljs-comment">// 方法</span>
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getDog</span>(<span class="hljs-params"/>){
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 发请求</span>
      <span class="hljs-keyword">let</span> {data} = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'https://dog.ceo/api/breed/pembroke/images/random'</span>)
      <span class="hljs-comment">// 维护数据</span>
      dogList.<span class="hljs-title function_">push</span>(data.<span class="hljs-property">message</span>)
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-comment">// 处理错误</span>
      <span class="hljs-keyword">const</span> err = &lt;<span class="hljs-title class_">AxiosError</span>&gt;error
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err.<span class="hljs-property">message</span>)
    }
  }

  <span class="hljs-comment">// 挂载钩子</span>
  <span class="hljs-title function_">onMounted</span>(<span class="hljs-function">()=&gt;</span>{
    <span class="hljs-title function_">getDog</span>()
  })
	
  <span class="hljs-comment">//向外部暴露数据</span>
  <span class="hljs-keyword">return</span> {dogList,getDog}
}
</code></pre>
</li>
<li>
<p>组件中具体使用：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;h2&gt;当前求和为：{{sum}}&lt;/h2&gt;
  &lt;button @click="increment"&gt;点我+1&lt;/button&gt;
  &lt;button @click="decrement"&gt;点我-1&lt;/button&gt;
  &lt;hr&gt;
  &lt;img v-for="(u,index) in dogList.urlList" :key="index" :src="(u as string)"&gt; 
  &lt;span v-show="dogList.isLoading"&gt;加载中......&lt;/span&gt;&lt;br&gt;
  &lt;button @click="getDog"&gt;再来一只狗&lt;/button&gt;
&lt;/template&gt;

&lt;script lang="ts"&gt;
  import {defineComponent} from 'vue'

  export default defineComponent({
    name:'App',
  })
&lt;/script&gt;

&lt;script setup lang="ts"&gt;
  import useSum from './hooks/useSum'
  import useDog from './hooks/useDog'
	
  let {sum,increment,decrement} = useSum()
  let {dogList,getDog} = useDog()
&lt;/script&gt;
</code></pre>
</li>
</ul>
<hr/>
<h2 data-id="heading-35">4. 路由</h2>
<h3 data-id="heading-36">4.1. 【对路由的理解】</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4261dcf42dd5466eb33def880c9a2bba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmQ5LiA5p2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710623&amp;x-signature=RxRUIaH3%2Fs7bU8W9v4nd%2F65n2w8%3D" alt="image-20231018144351536.png" loading="lazy"/></p>
<h3 data-id="heading-37">4.2. 【基本切换效果】</h3>
<ul>
<li>
<p><code>Vue3</code>中要使用<code>vue-router</code>的最新版本，目前是<code>4</code>版本。</p>
</li>
<li>
<p>路由配置文件代码如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> {createRouter,createWebHistory} <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/pages/Home.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">News</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/pages/News.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">About</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/pages/About.vue'</span>

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({
	<span class="hljs-attr">history</span>:<span class="hljs-title function_">createWebHistory</span>(),
	<span class="hljs-attr">routes</span>:[
		{
			<span class="hljs-attr">path</span>:<span class="hljs-string">'/home'</span>,
			<span class="hljs-attr">component</span>:<span class="hljs-title class_">Home</span>
		},
		{
			<span class="hljs-attr">path</span>:<span class="hljs-string">'/about'</span>,
			<span class="hljs-attr">component</span>:<span class="hljs-title class_">About</span>
		}
	]
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router
</code></pre>
</li>
</ul>

<ul>
<li>
<p><code>main.ts</code>代码如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router/index'</span>
app.<span class="hljs-title function_">use</span>(router)

app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
</li>
</ul>

<ul>
<li>
<p><code>App.vue</code>代码如下</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="app"&gt;
    &lt;h2 class="title"&gt;Vue路由测试&lt;/h2&gt;
    &lt;!-- 导航区 --&gt;
    &lt;div class="navigate"&gt;
      &lt;RouterLink to="/home" active-class="active"&gt;首页&lt;/RouterLink&gt;
      &lt;RouterLink to="/news" active-class="active"&gt;新闻&lt;/RouterLink&gt;
      &lt;RouterLink to="/about" active-class="active"&gt;关于&lt;/RouterLink&gt;
    &lt;/div&gt;
    &lt;!-- 展示区 --&gt;
    &lt;div class="main-content"&gt;
      &lt;RouterView&gt;&lt;/RouterView&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script lang="ts" setup name="App"&gt;
  import {RouterLink,RouterView} from 'vue-router'  
&lt;/script&gt;
</code></pre>
</li>
</ul>
<h3 data-id="heading-38">4.3. 【两个注意点】</h3>
<blockquote>
<ol>
<li>
<p>路由组件通常存放在<code>pages</code> 或 <code>views</code>文件夹，一般组件通常存放在<code>components</code>文件夹。</p>
</li>
<li>
<p>通过点击导航，视觉效果上“消失” 了的路由组件，默认是被<strong>卸载</strong>掉的，需要的时候再去<strong>挂载</strong>。</p>
</li>
</ol>
</blockquote>
<h3 data-id="heading-39">4.4.【路由器工作模式】</h3>
<ol>
<li>
<p><code>history</code>模式</p>
<blockquote>
<p>优点：<code>URL</code>更加美观，不带有<code>#</code>，更接近传统的网站<code>URL</code>。</p>
<p>缺点：后期项目上线，需要服务端配合处理路径问题，否则刷新会有<code>404</code>错误。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({
  	<span class="hljs-attr">history</span>:<span class="hljs-title function_">createWebHistory</span>(), <span class="hljs-comment">//history模式</span>
  	<span class="hljs-comment">/******/</span>
})
</code></pre>
</blockquote>
</li>
<li>
<p><code>hash</code>模式</p>
<blockquote>
<p>优点：兼容性更好，因为不需要服务器端处理路径。</p>
<p>缺点：<code>URL</code>带有<code>#</code>不太美观，且在<code>SEO</code>优化方面相对较差。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({
  	<span class="hljs-attr">history</span>:<span class="hljs-title function_">createWebHashHistory</span>(), <span class="hljs-comment">//hash模式</span>
  	<span class="hljs-comment">/******/</span>
})
</code></pre>
</blockquote>
</li>
</ol>
<h3 data-id="heading-40">4.5. 【to的两种写法】</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 第一种：to的字符串写法 --&gt;
&lt;router-link active-class="active" to="/home"&gt;主页&lt;/router-link&gt;

&lt;!-- 第二种：to的对象写法 --&gt;
&lt;router-link active-class="active" :to="{path:'/home'}"&gt;Home&lt;/router-link&gt;
</code></pre>
<h3 data-id="heading-41">4.6. 【命名路由】</h3>
<p>作用：可以简化路由跳转及传参（后面就讲）。</p>
<p>给路由规则命名：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">routes</span>:[
  {
    <span class="hljs-attr">name</span>:<span class="hljs-string">'zhuye'</span>,
    <span class="hljs-attr">path</span>:<span class="hljs-string">'/home'</span>,
    <span class="hljs-attr">component</span>:<span class="hljs-title class_">Home</span>
  },
  {
    <span class="hljs-attr">name</span>:<span class="hljs-string">'xinwen'</span>,
    <span class="hljs-attr">path</span>:<span class="hljs-string">'/news'</span>,
    <span class="hljs-attr">component</span>:<span class="hljs-title class_">News</span>,
  },
  {
    <span class="hljs-attr">name</span>:<span class="hljs-string">'guanyu'</span>,
    <span class="hljs-attr">path</span>:<span class="hljs-string">'/about'</span>,
    <span class="hljs-attr">component</span>:<span class="hljs-title class_">About</span>
  }
]
</code></pre>
<p>跳转路由：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!--简化前：需要写完整的路径（to的字符串写法） --&gt;
&lt;router-link to="/news/detail"&gt;跳转&lt;/router-link&gt;

&lt;!--简化后：直接通过名字跳转（to的对象写法配合name属性） --&gt;
&lt;router-link :to="{name:'guanyu'}"&gt;跳转&lt;/router-link&gt;
</code></pre>
<h3 data-id="heading-42">4.7. 【嵌套路由】</h3>
<ol>
<li>
<p>编写<code>News</code>的子路由：<code>Detail.vue</code></p>
</li>
<li>
<p>配置路由规则，使用<code>children</code>配置项：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({
  <span class="hljs-attr">history</span>:<span class="hljs-title function_">createWebHistory</span>(),
	<span class="hljs-attr">routes</span>:[
		{
			<span class="hljs-attr">name</span>:<span class="hljs-string">'zhuye'</span>,
			<span class="hljs-attr">path</span>:<span class="hljs-string">'/home'</span>,
			<span class="hljs-attr">component</span>:<span class="hljs-title class_">Home</span>
		},
		{
			<span class="hljs-attr">name</span>:<span class="hljs-string">'xinwen'</span>,
			<span class="hljs-attr">path</span>:<span class="hljs-string">'/news'</span>,
			<span class="hljs-attr">component</span>:<span class="hljs-title class_">News</span>,
			<span class="hljs-attr">children</span>:[
				{
					<span class="hljs-attr">name</span>:<span class="hljs-string">'xiang'</span>,
					<span class="hljs-attr">path</span>:<span class="hljs-string">'detail'</span>,
					<span class="hljs-attr">component</span>:<span class="hljs-title class_">Detail</span>
				}
			]
		},
		{
			<span class="hljs-attr">name</span>:<span class="hljs-string">'guanyu'</span>,
			<span class="hljs-attr">path</span>:<span class="hljs-string">'/about'</span>,
			<span class="hljs-attr">component</span>:<span class="hljs-title class_">About</span>
		}
	]
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router
</code></pre>
</li>
<li>
<p>跳转路由（记得要加完整路径）：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;router-link to="/news/detail"&gt;xxxx&lt;/router-link&gt;
&lt;!-- 或 --&gt;
&lt;router-link :to="{path:'/news/detail'}"&gt;xxxx&lt;/router-link&gt;
</code></pre>
</li>
<li>
<p>记得去<code>Home</code>组件中预留一个<code>&lt;router-view&gt;</code></p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="news"&gt;
    &lt;nav class="news-list"&gt;
      &lt;RouterLink v-for="news in newsList" :key="news.id" :to="{path:'/news/detail'}"&gt;
        {{news.name}}
      &lt;/RouterLink&gt;
    &lt;/nav&gt;
    &lt;div class="news-detail"&gt;
      &lt;RouterView/&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
</li>
</ol>
<h3 data-id="heading-43">4.8. 【路由传参】</h3>
<h4 data-id="heading-44">query参数</h4>
<ol>
<li>
<p>传递参数</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 跳转并携带query参数（to的字符串写法） --&gt;
&lt;router-link to="/news/detail?a=1&amp;b=2&amp;content=欢迎你"&gt;
	跳转
&lt;/router-link&gt;
				
&lt;!-- 跳转并携带query参数（to的对象写法） --&gt;
&lt;RouterLink 
  :to="{
    //name:'xiang', //用name也可以跳转
    path:'/news/detail',
    query:{
      id:news.id,
      title:news.title,
      content:news.content
    }
  }"
&gt;
  {{news.title}}
&lt;/RouterLink&gt;
</code></pre>
</li>
<li>
<p>接收参数：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> {useRoute} <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>
<span class="hljs-keyword">const</span> route = <span class="hljs-title function_">useRoute</span>()
<span class="hljs-comment">// 打印query参数</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(route.<span class="hljs-property">query</span>)
</code></pre>
</li>
</ol>
<h4 data-id="heading-45">params参数</h4>
<ol>
<li>
<p>传递参数</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 跳转并携带params参数（to的字符串写法） --&gt;
&lt;RouterLink :to="`/news/detail/001/新闻001/内容001`"&gt;{{news.title}}&lt;/RouterLink&gt;
				
&lt;!-- 跳转并携带params参数（to的对象写法） --&gt;
&lt;RouterLink 
  :to="{
    name:'xiang', //用name跳转
    params:{
      id:news.id,
      title:news.title,
      content:news.title
    }
  }"
&gt;
  {{news.title}}
&lt;/RouterLink&gt;
</code></pre>
</li>
<li>
<p>接收参数：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> {useRoute} <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>
<span class="hljs-keyword">const</span> route = <span class="hljs-title function_">useRoute</span>()
<span class="hljs-comment">// 打印params参数</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(route.<span class="hljs-property">params</span>)
</code></pre>
</li>
</ol>
<blockquote>
<p>备注1：传递<code>params</code>参数时，若使用<code>to</code>的对象写法，必须使用<code>name</code>配置项，不能用<code>path</code>。</p>
<p>备注2：传递<code>params</code>参数时，需要提前在规则中占位。</p>
</blockquote>
<h3 data-id="heading-46">4.9. 【路由的props配置】</h3>
<p>作用：让路由组件更方便的收到参数（可以将路由参数作为<code>props</code>传给组件）</p>
<pre><code class="hljs language-js" lang="js">{
	<span class="hljs-attr">name</span>:<span class="hljs-string">'xiang'</span>,
	<span class="hljs-attr">path</span>:<span class="hljs-string">'detail/:id/:title/:content'</span>,
	<span class="hljs-attr">component</span>:<span class="hljs-title class_">Detail</span>,

  <span class="hljs-comment">// props的对象写法，作用：把对象中的每一组key-value作为props传给Detail组件</span>
  <span class="hljs-comment">// props:{a:1,b:2,c:3}, </span>

  <span class="hljs-comment">// props的布尔值写法，作用：把收到了每一组params参数，作为props传给Detail组件</span>
  <span class="hljs-comment">// props:true</span>
  
  <span class="hljs-comment">// props的函数写法，作用：把返回的对象中每一组key-value作为props传给Detail组件</span>
  <span class="hljs-title function_">props</span>(<span class="hljs-params">route</span>){
    <span class="hljs-keyword">return</span> route.<span class="hljs-property">query</span>
  }
}
</code></pre>
<h3 data-id="heading-47">4.10. 【 replace属性】</h3>
<ol>
<li>
<p>作用：控制路由跳转时操作浏览器历史记录的模式。</p>
</li>
<li>
<p>浏览器的历史记录有两种写入方式：分别为<code>push</code>和<code>replace</code>：</p>
<ul>
<li><code>push</code>是追加历史记录（默认值）。</li>
<li><code>replace</code>是替换当前记录。</li>
</ul>
</li>
<li>
<p>开启<code>replace</code>模式：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;RouterLink replace .......&gt;News&lt;/RouterLink&gt;
</code></pre>
</li>
</ol>
<h3 data-id="heading-48">4.11. 【编程式导航】</h3>
<p>路由组件的两个重要的属性：<code>$route</code>和<code>$router</code>变成了两个<code>hooks</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> {useRoute,useRouter} <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>

<span class="hljs-keyword">const</span> route = <span class="hljs-title function_">useRoute</span>()
<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(route.<span class="hljs-property">query</span>)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(route.<span class="hljs-property">parmas</span>)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(router.<span class="hljs-property">push</span>)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(router.<span class="hljs-property">replace</span>)
</code></pre>
<h3 data-id="heading-49">4.12. 【重定向】</h3>
<ol>
<li>
<p>作用：将特定的路径，重新定向到已有路由。</p>
</li>
<li>
<p>具体编码：</p>
<pre><code class="hljs language-js" lang="js">{
    <span class="hljs-attr">path</span>:<span class="hljs-string">'/'</span>,
    <span class="hljs-attr">redirect</span>:<span class="hljs-string">'/about'</span>
}
</code></pre>
</li>
</ol>
<h2 data-id="heading-50">5. pinia</h2>
<h3 data-id="heading-51">5.1【准备一个效果】</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0be59e1e140847d08939d73349dd98de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmQ5LiA5p2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710623&amp;x-signature=jPZ6KocWDgwx%2BxayBwDXL%2B0yZNw%3D" alt="pinia_example.gif" loading="lazy"/></p>
<h3 data-id="heading-52">5.2【搭建 pinia 环境】</h3>
<p>第一步：<code>npm install pinia</code></p>
<p>第二步：操作<code>src/main.ts</code></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>

<span class="hljs-comment">/* 引入createPinia，用于创建pinia */</span>
<span class="hljs-keyword">import</span> { createPinia } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>

<span class="hljs-comment">/* 创建pinia */</span>
<span class="hljs-keyword">const</span> pinia = <span class="hljs-title function_">createPinia</span>()
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)

<span class="hljs-comment">/* 使用插件 */</span>{}
app.<span class="hljs-title function_">use</span>(pinia)
app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<p>此时开发者工具中已经有了<code>pinia</code>选项</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50f1280ea7e243d7bfb4c6b900408adc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmQ5LiA5p2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710623&amp;x-signature=B9jzokxxi1%2FT6MyJRC8KTbiu8Lg%3D" loading="lazy"/>
<h3 data-id="heading-53">5.3【存储+读取数据】</h3>
<ol>
<li>
<p><code>Store</code>是一个保存：<strong>状态</strong>、<strong>业务逻辑</strong> 的实体，每个组件都可以<strong>读取</strong>、<strong>写入</strong>它。</p>
</li>
<li>
<p>它有三个概念：<code>state</code>、<code>getter</code>、<code>action</code>，相当于组件中的： <code>data</code>、 <code>computed</code> 和 <code>methods</code>。</p>
</li>
<li>
<p>具体编码：<code>src/store/count.ts</code></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 引入defineStore用于创建store</span>
<span class="hljs-keyword">import</span> {defineStore} <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>

<span class="hljs-comment">// 定义并暴露一个store</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCountStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'count'</span>,{
  <span class="hljs-comment">// 动作</span>
  <span class="hljs-attr">actions</span>:{},
  <span class="hljs-comment">// 状态</span>
  <span class="hljs-title function_">state</span>(<span class="hljs-params"/>){
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">sum</span>:<span class="hljs-number">6</span>
    }
  },
  <span class="hljs-comment">// 计算</span>
  <span class="hljs-attr">getters</span>:{}
})
</code></pre>
</li>
<li>
<p>具体编码：<code>src/store/talk.ts</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 引入defineStore用于创建store</span>
<span class="hljs-keyword">import</span> {defineStore} <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>

<span class="hljs-comment">// 定义并暴露一个store</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useTalkStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'talk'</span>,{
  <span class="hljs-comment">// 动作</span>
  <span class="hljs-attr">actions</span>:{},
  <span class="hljs-comment">// 状态</span>
  <span class="hljs-title function_">state</span>(<span class="hljs-params"/>){
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">talkList</span>:[
        {<span class="hljs-attr">id</span>:<span class="hljs-string">'yuysada01'</span>,<span class="hljs-attr">content</span>:<span class="hljs-string">'你今天有点怪，哪里怪？怪好看的！'</span>},
     		{<span class="hljs-attr">id</span>:<span class="hljs-string">'yuysada02'</span>,<span class="hljs-attr">content</span>:<span class="hljs-string">'草莓、蓝莓、蔓越莓，你想我了没？'</span>},
        {<span class="hljs-attr">id</span>:<span class="hljs-string">'yuysada03'</span>,<span class="hljs-attr">content</span>:<span class="hljs-string">'心里给你留了一块地，我的死心塌地'</span>}
      ]
    }
  },
  <span class="hljs-comment">// 计算</span>
  <span class="hljs-attr">getters</span>:{}
})
</code></pre>
</li>
<li>
<p>组件中使用<code>state</code>中的数据</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;h2&gt;当前求和为：{{ sumStore.sum }}&lt;/h2&gt;
&lt;/template&gt;

&lt;script setup lang="ts" name="Count"&gt;
  // 引入对应的useXxxxxStore	
  import {useSumStore} from '@/store/sum'
  
  // 调用useXxxxxStore得到对应的store
  const sumStore = useSumStore()
&lt;/script&gt;
</code></pre>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
	&lt;ul&gt;
    &lt;li v-for="talk in talkStore.talkList" :key="talk.id"&gt;
      {{ talk.content }}
    &lt;/li&gt;
  &lt;/ul&gt;
&lt;/template&gt;

&lt;script setup lang="ts" name="Count"&gt;
  import axios from 'axios'
  import {useTalkStore} from '@/store/talk'

  const talkStore = useTalkStore()
&lt;/script&gt;
</code></pre>
</li>
</ol>
<h3 data-id="heading-54">5.4.【修改数据】(三种方式)</h3>
<ol>
<li>
<p>第一种修改方式，直接修改</p>
<pre><code class="hljs language-ts" lang="ts">countStore.<span class="hljs-property">sum</span> = <span class="hljs-number">666</span>
</code></pre>
</li>
<li>
<p>第二种修改方式：批量修改</p>
<pre><code class="hljs language-ts" lang="ts">countStore.$patch({
  <span class="hljs-attr">sum</span>:<span class="hljs-number">999</span>,
  <span class="hljs-attr">school</span>:<span class="hljs-string">'atguigu'</span>
})
</code></pre>
</li>
<li>
<p>第三种修改方式：借助<code>action</code>修改（<code>action</code>中可以编写一些业务逻辑）</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCountStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'count'</span>, {
  <span class="hljs-comment">/*************/</span>
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-comment">//加</span>
    <span class="hljs-title function_">increment</span>(<span class="hljs-params">value:number</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">sum</span> &lt; <span class="hljs-number">10</span>) {
        <span class="hljs-comment">//操作countStore中的sum</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sum</span> += value
      }
    },
    <span class="hljs-comment">//减</span>
    <span class="hljs-title function_">decrement</span>(<span class="hljs-params">value:number</span>){
      <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">sum</span> &gt; <span class="hljs-number">1</span>){
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sum</span> -= value
      }
    }
  },
  <span class="hljs-comment">/*************/</span>
})
</code></pre>
</li>
<li>
<p>组件中调用<code>action</code>即可</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 使用countStore</span>
<span class="hljs-keyword">const</span> countStore = <span class="hljs-title function_">useCountStore</span>()

<span class="hljs-comment">// 调用对应action</span>
countStore.<span class="hljs-title function_">incrementOdd</span>(n.<span class="hljs-property">value</span>)
</code></pre>
</li>
</ol>
<h3 data-id="heading-55">5.5.【storeToRefs】</h3>
<ul>
<li>借助<code>storeToRefs</code>将<code>store</code>中的数据转为<code>ref</code>对象，方便在模板中使用。</li>
<li>注意：<code>pinia</code>提供的<code>storeToRefs</code>只会将数据做转换，而<code>Vue</code>的<code>toRefs</code>会转换<code>store</code>中数据。</li>
</ul>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
	&lt;div class="count"&gt;
		&lt;h2&gt;当前求和为：{{sum}}&lt;/h2&gt;
	&lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts" name="Count"&gt;
  import { useCountStore } from '@/store/count'
  /* 引入storeToRefs */
  import { storeToRefs } from 'pinia'

	/* 得到countStore */
  const countStore = useCountStore()
  /* 使用storeToRefs转换countStore，随后解构 */
  const {sum} = storeToRefs(countStore)
&lt;/script&gt;

</code></pre>
<h3 data-id="heading-56">5.6.【getters】</h3>
<ol>
<li>
<p>概念：当<code>state</code>中的数据，需要经过处理后再使用时，可以使用<code>getters</code>配置。</p>
</li>
<li>
<p>追加<code>getters</code>配置。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 引入defineStore用于创建store</span>
<span class="hljs-keyword">import</span> {defineStore} <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>

<span class="hljs-comment">// 定义并暴露一个store</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCountStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'count'</span>,{
  <span class="hljs-comment">// 动作</span>
  <span class="hljs-attr">actions</span>:{
    <span class="hljs-comment">/************/</span>
  },
  <span class="hljs-comment">// 状态</span>
  <span class="hljs-title function_">state</span>(<span class="hljs-params"/>){
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">sum</span>:<span class="hljs-number">1</span>,
      <span class="hljs-attr">school</span>:<span class="hljs-string">'atguigu'</span>
    }
  },
  <span class="hljs-comment">// 计算</span>
  <span class="hljs-attr">getters</span>:{
    <span class="hljs-attr">bigSum</span>:(state):<span class="hljs-function"><span class="hljs-params">number</span> =&gt;</span> state.<span class="hljs-property">sum</span> *<span class="hljs-number">10</span>,
    <span class="hljs-title function_">upperSchool</span>():string{
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>. school.<span class="hljs-title function_">toUpperCase</span>()
    }
  }
})
</code></pre>
</li>
<li>
<p>组件中读取数据：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> {increment,decrement} = countStore
<span class="hljs-keyword">let</span> {sum,school,bigSum,upperSchool} = <span class="hljs-title function_">storeToRefs</span>(countStore)
</code></pre>
</li>
</ol>
<h3 data-id="heading-57">5.7.【$subscribe】</h3>
<p>通过 store 的 <code>$subscribe()</code> 方法侦听 <code>state</code> 及其变化</p>
<pre><code class="hljs language-ts" lang="ts">talkStore.$subscribe(<span class="hljs-function">(<span class="hljs-params">mutate,state</span>)=&gt;</span>{
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'LoveTalk'</span>,mutate,state)
  <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'talk'</span>,<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(talkList.<span class="hljs-property">value</span>))
})
</code></pre>
<h3 data-id="heading-58">5.8. 【store组合式写法】</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> {defineStore} <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>
<span class="hljs-keyword">import</span> {nanoid} <span class="hljs-keyword">from</span> <span class="hljs-string">'nanoid'</span>
<span class="hljs-keyword">import</span> {reactive} <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useTalkStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'talk'</span>,<span class="hljs-function">()=&gt;</span>{
  <span class="hljs-comment">// talkList就是state</span>
  <span class="hljs-keyword">const</span> talkList = <span class="hljs-title function_">reactive</span>(
    <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'talkList'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>) || []
  )

  <span class="hljs-comment">// getATalk函数相当于action</span>
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getATalk</span>(<span class="hljs-params"/>){
    <span class="hljs-comment">// 发请求，下面这行的写法是：连续解构赋值+重命名</span>
    <span class="hljs-keyword">let</span> {<span class="hljs-attr">data</span>:{<span class="hljs-attr">content</span>:title}} = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'https://api.uomg.com/api/rand.qinghua?format=json'</span>)
    <span class="hljs-comment">// 把请求回来的字符串，包装成一个对象</span>
    <span class="hljs-keyword">let</span> obj = {<span class="hljs-attr">id</span>:<span class="hljs-title function_">nanoid</span>(),title}
    <span class="hljs-comment">// 放到数组中</span>
    talkList.<span class="hljs-title function_">unshift</span>(obj)
  }
  <span class="hljs-keyword">return</span> {talkList,getATalk}
})
</code></pre>
<h2 data-id="heading-59">6. 组件通信</h2>
<p><strong><code>Vue3</code>组件通信和<code>Vue2</code>的区别：</strong></p>
<ul>
<li>移出事件总线，使用<code>mitt</code>代替。</li>
</ul>

<ul>
<li><code>vuex</code>换成了<code>pinia</code>。</li>
<li>把<code>.sync</code>优化到了<code>v-model</code>里面了。</li>
<li>把<code>$listeners</code>所有的东西，合并到<code>$attrs</code>中了。</li>
<li><code>$children</code>被砍掉了。</li>
</ul>
<p><strong>常见搭配形式：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e190a0b21c054619b683bdd38fe14372~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmQ5LiA5p2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710623&amp;x-signature=FThDVHfGdd1rmChfZ8%2B%2FiIDUNEM%3D" alt="image-20231119185900990.png" loading="lazy"/></p>
<h3 data-id="heading-60">6.1. 【props】</h3>
<p>概述：<code>props</code>是使用频率最高的一种通信方式，常用与 ：<strong>父 ↔ 子</strong>。</p>
<ul>
<li>若 <strong>父传子</strong>：属性值是<strong>非函数</strong>。</li>
<li>若 <strong>子传父</strong>：属性值是<strong>函数</strong>。</li>
</ul>
<p>父组件：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="father"&gt;
    &lt;h3&gt;父组件，&lt;/h3&gt;
		&lt;h4&gt;我的车：{{ car }}&lt;/h4&gt;
		&lt;h4&gt;儿子给的玩具：{{ toy }}&lt;/h4&gt;
		&lt;Child :car="car" :getToy="getToy"/&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts" name="Father"&gt;
	import Child from './Child.vue'
	import { ref } from "vue";
	// 数据
	const car = ref('奔驰')
	const toy = ref()
	// 方法
	function getToy(value:string){
		toy.value = value
	}
&lt;/script&gt;
</code></pre>
<p>子组件</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="child"&gt;
    &lt;h3&gt;子组件&lt;/h3&gt;
		&lt;h4&gt;我的玩具：{{ toy }}&lt;/h4&gt;
		&lt;h4&gt;父给我的车：{{ car }}&lt;/h4&gt;
		&lt;button @click="getToy(toy)"&gt;玩具给父亲&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts" name="Child"&gt;
	import { ref } from "vue";
	const toy = ref('奥特曼')
	
	defineProps(['car','getToy'])
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-61">6.2. 【自定义事件】</h3>
<ol>
<li>概述：自定义事件常用于：<strong>子 =&gt; 父。</strong></li>
<li>注意区分好：原生事件、自定义事件。</li>
</ol>
<ul>
<li>原生事件：
<ul>
<li>事件名是特定的（<code>click</code>、<code>mosueenter</code>等等）</li>
<li>事件对象<code>$event</code>: 是包含事件相关信息的对象（<code>pageX</code>、<code>pageY</code>、<code>target</code>、<code>keyCode</code>）</li>
</ul>
</li>
<li>自定义事件：
<ul>
<li>事件名是任意名称</li>
<li><strong>事件对象<code>$event</code>: 是调用<code>emit</code>时所提供的数据，可以是任意类型！！！</strong></li>
</ul>
</li>
</ul>
<ol start="3">
<li>
<p>示例：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!--在父组件中，给子组件绑定自定义事件：--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Child</span> @<span class="hljs-attr">send-toy</span>=<span class="hljs-string">"toy = $event"</span>/&gt;</span>

<span class="hljs-comment">&lt;!--注意区分原生事件与自定义事件中的$event--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"toy = $event"</span>&gt;</span>测试<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//子组件中，触发事件：</span>
<span class="hljs-variable language_">this</span>.$emit(<span class="hljs-string">'send-toy'</span>, 具体数据)
</code></pre>
</li>
</ol>
<h3 data-id="heading-62">6.3. 【mitt】</h3>
<p>概述：与消息订阅与发布（<code>pubsub</code>）功能类似，可以实现任意组件间通信。</p>
<p>安装<code>mitt</code></p>
<pre><code class="hljs language-shell" lang="shell">npm i mitt
</code></pre>
<p>新建文件：<code>src\utils\emitter.ts</code></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 引入mitt </span>
<span class="hljs-keyword">import</span> mitt <span class="hljs-keyword">from</span> <span class="hljs-string">"mitt"</span>;

<span class="hljs-comment">// 创建emitter</span>
<span class="hljs-keyword">const</span> emitter = <span class="hljs-title function_">mitt</span>()

<span class="hljs-comment">/*
  // 绑定事件
  emitter.on('abc',(value)=&gt;{
    console.log('abc事件被触发',value)
  })
  emitter.on('xyz',(value)=&gt;{
    console.log('xyz事件被触发',value)
  })

  setInterval(() =&gt; {
    // 触发事件
    emitter.emit('abc',666)
    emitter.emit('xyz',777)
  }, 1000);

  setTimeout(() =&gt; {
    // 清理事件
    emitter.all.clear()
  }, 3000); 
*/</span>

<span class="hljs-comment">// 创建并暴露mitt</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> emitter
</code></pre>
<p>接收数据的组件中：绑定事件、同时在销毁前解绑事件：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> emitter <span class="hljs-keyword">from</span> <span class="hljs-string">"@/utils/emitter"</span>;
<span class="hljs-keyword">import</span> { onUnmounted } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;

<span class="hljs-comment">// 绑定事件</span>
emitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">'send-toy'</span>,<span class="hljs-function">(<span class="hljs-params">value</span>)=&gt;</span>{
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'send-toy事件被触发'</span>,value)
})

<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">()=&gt;</span>{
  <span class="hljs-comment">// 解绑事件</span>
  emitter.<span class="hljs-title function_">off</span>(<span class="hljs-string">'send-toy'</span>)
})
</code></pre>
<p>【第三步】：提供数据的组件，在合适的时候触发事件</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> emitter <span class="hljs-keyword">from</span> <span class="hljs-string">"@/utils/emitter"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">sendToy</span>(<span class="hljs-params"/>){
  <span class="hljs-comment">// 触发事件</span>
  emitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'send-toy'</span>,toy.<span class="hljs-property">value</span>)
}
</code></pre>
<p><strong>注意这个重要的内置关系，总线依赖着这个内置关系</strong></p>
<h3 data-id="heading-63">6.4.【v-model】</h3>
<ol>
<li>
<p>概述：实现 <strong>父↔子</strong> 之间相互通信。</p>
</li>
<li>
<p>前序知识 —— <code>v-model</code>的本质</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 使用v-model指令 --&gt;
&lt;input type="text" v-model="userName"&gt;

&lt;!-- v-model的本质是下面这行代码 --&gt;
&lt;input 
  type="text" 
  :value="userName" 
  @input="userName =(&lt;HTMLInputElement&gt;$event.target).value"
&gt;
</code></pre>
</li>
<li>
<p>组件标签上的<code>v-model</code>的本质：<code>:moldeValue</code> ＋ <code>update:modelValue</code>事件。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 组件标签上使用v-model指令 --&gt;
&lt;AtguiguInput v-model="userName"/&gt;

&lt;!-- 组件标签上v-model的本质 --&gt;
&lt;AtguiguInput :modelValue="userName" @update:model-value="userName = $event"/&gt;
</code></pre>
<p><code>AtguiguInput</code>组件中：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="box"&gt;
    &lt;!--将接收的value值赋给input元素的value属性，目的是：为了呈现数据 --&gt;
		&lt;!--给input元素绑定原生input事件，触发input事件时，进而触发update:model-value事件--&gt;
    &lt;input 
       type="text" 
       :value="modelValue" 
       @input="emit('update:model-value',$event.target.value)"
    &gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts" name="AtguiguInput"&gt;
  // 接收props
  defineProps(['modelValue'])
  // 声明事件
  const emit = defineEmits(['update:model-value'])
&lt;/script&gt;
</code></pre>
</li>
<li>
<p>也可以更换<code>value</code>，例如改成<code>abc</code></p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 也可以更换value，例如改成abc--&gt;
&lt;AtguiguInput v-model:abc="userName"/&gt;

&lt;!-- 上面代码的本质如下 --&gt;
&lt;AtguiguInput :abc="userName" @update:abc="userName = $event"/&gt;
</code></pre>
<p><code>AtguiguInput</code>组件中：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="box"&gt;
    &lt;input 
       type="text" 
       :value="abc" 
       @input="emit('update:abc',$event.target.value)"
    &gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts" name="AtguiguInput"&gt;
  // 接收props
  defineProps(['abc'])
  // 声明事件
  const emit = defineEmits(['update:abc'])
&lt;/script&gt;
</code></pre>
</li>
<li>
<p>如果<code>value</code>可以更换，那么就可以在组件标签上多次使用<code>v-model</code></p>
<pre><code class="hljs language-vue" lang="vue">&lt;AtguiguInput v-model:abc="userName" v-model:xyz="password"/&gt;
</code></pre>
</li>
</ol>
<h3 data-id="heading-64">6.5.【$attrs 】</h3>
<ol>
<li>
<p>概述：<code>$attrs</code>用于实现<strong>当前组件的父组件</strong>，向<strong>当前组件的子组件</strong>通信（<strong>祖→孙</strong>）。</p>
</li>
<li>
<p>具体说明：<code>$attrs</code>是一个对象，包含所有父组件传入的标签属性。</p>
<blockquote>
<p>注意：<code>$attrs</code>会自动排除<code>props</code>中声明的属性(可以认为声明过的 <code>props</code> 被子组件自己“消费”了)</p>
</blockquote>
</li>
</ol>
<p>父组件：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="father"&gt;
    &lt;h3&gt;父组件&lt;/h3&gt;
		&lt;Child :a="a" :b="b" :c="c" :d="d" v-bind="{x:100,y:200}" :updateA="updateA"/&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts" name="Father"&gt;
	import Child from './Child.vue'
	import { ref } from "vue";
	let a = ref(1)
	let b = ref(2)
	let c = ref(3)
	let d = ref(4)

	function updateA(value){
		a.value = value
	}
&lt;/script&gt;
</code></pre>
<p>子组件：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
	&lt;div class="child"&gt;
		&lt;h3&gt;子组件&lt;/h3&gt;
		&lt;GrandChild v-bind="$attrs"/&gt;
	&lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts" name="Child"&gt;
	import GrandChild from './GrandChild.vue'
&lt;/script&gt;
</code></pre>
<p>孙组件：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
	&lt;div class="grand-child"&gt;
		&lt;h3&gt;孙组件&lt;/h3&gt;
		&lt;h4&gt;a：{{ a }}&lt;/h4&gt;
		&lt;h4&gt;b：{{ b }}&lt;/h4&gt;
		&lt;h4&gt;c：{{ c }}&lt;/h4&gt;
		&lt;h4&gt;d：{{ d }}&lt;/h4&gt;
		&lt;h4&gt;x：{{ x }}&lt;/h4&gt;
		&lt;h4&gt;y：{{ y }}&lt;/h4&gt;
		&lt;button @click="updateA(666)"&gt;点我更新A&lt;/button&gt;
	&lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts" name="GrandChild"&gt;
	defineProps(['a','b','c','d','x','y','updateA'])
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-65">6.6. 【<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>e</mi><mi>f</mi><mi>s</mi><mtext>、</mtext></mrow><annotation encoding="application/x-tex">refs、</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">s</span><span class="mord cjk_fallback">、</span></span></span></span></span>parent】</h3>
<ol>
<li>
<p>概述：</p>
<ul>
<li><code>$refs</code>用于 ：<strong>父→子。</strong></li>
<li><code>$parent</code>用于：<strong>子→父。</strong></li>
</ul>
</li>
<li>
<p>原理如下：</p>

















<table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td><code>$refs</code></td><td>值为对象，包含所有被<code>ref</code>属性标识的<code>DOM</code>元素或组件实例。</td></tr><tr><td><code>$parent</code></td><td>值为对象，当前组件的父组件实例对象。</td></tr></tbody></table>
</li>
</ol>
<h3 data-id="heading-66">6.7. 【provide、inject】</h3>
<ol>
<li>
<p>概述：实现<strong>祖孙组件</strong>直接通信</p>
</li>
<li>
<p>具体使用：</p>
<ul>
<li>在祖先组件中通过<code>provide</code>配置向后代组件提供数据</li>
<li>在后代组件中通过<code>inject</code>配置来声明接收数据</li>
</ul>
</li>
<li>
<p>具体编码：</p>
<p>【第一步】父组件中，使用<code>provide</code>提供数据</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="father"&gt;
    &lt;h3&gt;父组件&lt;/h3&gt;
    &lt;h4&gt;资产：{{ money }}&lt;/h4&gt;
    &lt;h4&gt;汽车：{{ car }}&lt;/h4&gt;
    &lt;button @click="money += 1"&gt;资产+1&lt;/button&gt;
    &lt;button @click="car.price += 1"&gt;汽车价格+1&lt;/button&gt;
    &lt;Child/&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts" name="Father"&gt;
  import Child from './Child.vue'
  import { ref,reactive,provide } from "vue";
  // 数据
  let money = ref(100)
  let car = reactive({
    brand:'奔驰',
    price:100
  })
  // 用于更新money的方法
  function updateMoney(value:number){
    money.value += value
  }
  // 提供数据
  provide('moneyContext',{money,updateMoney})
  provide('car',car)
&lt;/script&gt;
</code></pre>
<blockquote>
<p>注意：子组件中不用编写任何东西，是不受到任何打扰的</p>
</blockquote>
<p>【第二步】孙组件中使用<code>inject</code>配置项接受数据。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="grand-child"&gt;
    &lt;h3&gt;我是孙组件&lt;/h3&gt;
    &lt;h4&gt;资产：{{ money }}&lt;/h4&gt;
    &lt;h4&gt;汽车：{{ car }}&lt;/h4&gt;
    &lt;button @click="updateMoney(6)"&gt;点我&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts" name="GrandChild"&gt;
  import { inject } from 'vue';
  // 注入数据
 let {money,updateMoney} = inject('moneyContext',{money:0,updateMoney:(x:number)=&gt;{}})
  let car = inject('car')
</code></pre>
</li>
</ol>

   ```
<h3 data-id="heading-67">6.8. 【pinia】</h3>
<p>参考之前<code>pinia</code>部分的讲解</p>
<h3 data-id="heading-68">6.9. 【slot】</h3>
<h4 data-id="heading-69">1. 默认插槽</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80691bf557094e278690747a2478457f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmQ5LiA5p2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763710623&amp;x-signature=xJUrOyGIuFi85PwMpNuYpCPVEJc%3D" alt="img" loading="lazy"/></p>
<pre><code class="hljs language-vue" lang="vue">父组件中：
        &lt;Category title="今日热门游戏"&gt;
          &lt;ul&gt;
            &lt;li v-for="g in games" :key="g.id"&gt;{{ g.name }}&lt;/li&gt;
          &lt;/ul&gt;
        &lt;/Category&gt;
子组件中：
        &lt;template&gt;
          &lt;div class="item"&gt;
            &lt;h3&gt;{{ title }}&lt;/h3&gt;
            &lt;!-- 默认插槽 --&gt;
            &lt;slot&gt;&lt;/slot&gt;
          &lt;/div&gt;
        &lt;/template&gt;
</code></pre>
<h4 data-id="heading-70">2. 具名插槽</h4>
<pre><code class="hljs language-vue" lang="vue">父组件中：
        &lt;Category title="今日热门游戏"&gt;
          &lt;template v-slot:s1&gt;
            &lt;ul&gt;
              &lt;li v-for="g in games" :key="g.id"&gt;{{ g.name }}&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/template&gt;
          &lt;template #s2&gt;
            &lt;a href=""&gt;更多&lt;/a&gt;
          &lt;/template&gt;
        &lt;/Category&gt;
子组件中：
        &lt;template&gt;
          &lt;div class="item"&gt;
            &lt;h3&gt;{{ title }}&lt;/h3&gt;
            &lt;slot name="s1"&gt;&lt;/slot&gt;
            &lt;slot name="s2"&gt;&lt;/slot&gt;
          &lt;/div&gt;
        &lt;/template&gt;
</code></pre>
<h4 data-id="heading-71">3. 作用域插槽</h4>
<ol>
<li>
<p>理解：<span>数据在组件的自身，但根据数据生成的结构需要组件的使用者来决定。</span>（新闻数据在<code>News</code>组件中，但使用数据所遍历出来的结构由<code>App</code>组件决定）</p>
</li>
<li>
<p>具体编码：</p>
<pre><code class="hljs language-vue" lang="vue">父组件中：
      &lt;Game v-slot="params"&gt;
      &lt;!-- &lt;Game v-slot:default="params"&gt; --&gt;
      &lt;!-- &lt;Game #default="params"&gt; --&gt;
        &lt;ul&gt;
          &lt;li v-for="g in params.games" :key="g.id"&gt;{{ g.name }}&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/Game&gt;

子组件中：
      &lt;template&gt;
        &lt;div class="category"&gt;
          &lt;h2&gt;今日游戏榜单&lt;/h2&gt;
          &lt;slot :games="games" a="哈哈"&gt;&lt;/slot&gt;
        &lt;/div&gt;
      &lt;/template&gt;

      &lt;script setup lang="ts" name="Category"&gt;
        import {reactive} from 'vue'
        let games = reactive([
          {id:'asgdytsa01',name:'英雄联盟'},
          {id:'asgdytsa02',name:'王者荣耀'},
          {id:'asgdytsa03',name:'红色警戒'},
          {id:'asgdytsa04',name:'斗罗大陆'}
        ])
      &lt;/script&gt;
</code></pre>
</li>
</ol>
<h2 data-id="heading-72">7. 其它 API</h2>
<h3 data-id="heading-73">7.1.【shallowRef 与 shallowReactive 】</h3>
<h4 data-id="heading-74"><code>shallowRef</code></h4>
<ol>
<li>
<p>作用：创建一个响应式数据，但只对顶层属性进行响应式处理。</p>
</li>
<li>
<p>用法：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> myVar = <span class="hljs-title function_">shallowRef</span>(initialValue);
</code></pre>
</li>
<li>
<p>特点：只跟踪引用值的变化，不关心值内部的属性变化。</p>
</li>
</ol>
<h4 data-id="heading-75"><code>shallowReactive</code></h4>
<ol>
<li>
<p>作用：创建一个浅层响应式对象，只会使对象的最顶层属性变成响应式的，对象内部的嵌套属性则不会变成响应式的</p>
</li>
<li>
<p>用法：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> myObj = <span class="hljs-title function_">shallowReactive</span>({ ... });
</code></pre>
</li>
<li>
<p>特点：对象的顶层属性是响应式的，但嵌套对象的属性不是。</p>
</li>
</ol>
<h4 data-id="heading-76">总结</h4>
<blockquote>
<p>通过使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vuejs.org%2Fapi%2Freactivity-advanced.html%23shallowref" target="_blank" title="https://cn.vuejs.org/api/reactivity-advanced.html#shallowref" ref="nofollow noopener noreferrer"><code>shallowRef()</code></a> 和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vuejs.org%2Fapi%2Freactivity-advanced.html%23shallowreactive" target="_blank" title="https://cn.vuejs.org/api/reactivity-advanced.html#shallowreactive" ref="nofollow noopener noreferrer"><code>shallowReactive()</code></a> 来绕开深度响应。浅层式 <code>API</code> 创建的状态只在其顶层是响应式的，对所有深层的对象不会做任何处理，避免了对每一个内部属性做响应式所带来的性能成本，这使得属性的访问变得更快，可提升性能。</p>
</blockquote>
<h3 data-id="heading-77">7.2.【readonly 与 shallowReadonly】</h3>
<h4 data-id="heading-78"><strong><code>readonly</code></strong></h4>
<ol>
<li>
<p>作用：用于创建一个对象的深只读副本。</p>
</li>
<li>
<p>用法：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> original = <span class="hljs-title function_">reactive</span>({ ... });
<span class="hljs-keyword">const</span> readOnlyCopy = <span class="hljs-title function_">readonly</span>(original);
</code></pre>
</li>
<li>
<p>特点：</p>
<ul>
<li>对象的所有嵌套属性都将变为只读。</li>
<li>任何尝试修改这个对象的操作都会被阻止（在开发模式下，还会在控制台中发出警告）。</li>
</ul>
</li>
<li>
<p>应用场景：</p>
<ul>
<li>创建不可变的状态快照。</li>
<li>保护全局状态或配置不被修改。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-79"><strong><code>shallowReadonly</code></strong></h4>
<ol>
<li>
<p>作用：与 <code>readonly</code> 类似，但只作用于对象的顶层属性。</p>
</li>
<li>
<p>用法：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> original = <span class="hljs-title function_">reactive</span>({ ... });
<span class="hljs-keyword">const</span> shallowReadOnlyCopy = <span class="hljs-title function_">shallowReadonly</span>(original);
</code></pre>
</li>
<li>
<p>特点：</p>
<ul>
<li>
<p>只将对象的顶层属性设置为只读，对象内部的嵌套属性仍然是可变的。</p>
</li>
<li>
<p>适用于只需保护对象顶层属性的场景。</p>
</li>
</ul>
</li>
</ol>
<h3 data-id="heading-80">7.3.【toRaw 与 markRaw】</h3>
<h4 data-id="heading-81"><code>toRaw</code></h4>
<ol>
<li>
<p>作用：用于获取一个响应式对象的原始对象， <code>toRaw</code> 返回的对象不再是响应式的，不会触发视图更新。</p>
<blockquote>
<p>官网描述：这是一个可以用于临时读取而不引起代理访问/跟踪开销，或是写入而不触发更改的特殊方法。不建议保存对原始对象的持久引用，请谨慎使用。</p>
</blockquote>
<blockquote>
<p>何时使用？ —— 在需要将响应式对象传递给非 <code>Vue</code> 的库或外部系统时，使用 <code>toRaw</code> 可以确保它们收到的是普通对象</p>
</blockquote>
</li>
<li>
<p>具体编码：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { reactive,toRaw,markRaw,isReactive } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;

<span class="hljs-comment">/* toRaw */</span>
<span class="hljs-comment">// 响应式对象</span>
<span class="hljs-keyword">let</span> person = <span class="hljs-title function_">reactive</span>({<span class="hljs-attr">name</span>:<span class="hljs-string">'tony'</span>,<span class="hljs-attr">age</span>:<span class="hljs-number">18</span>})
<span class="hljs-comment">// 原始对象</span>
<span class="hljs-keyword">let</span> rawPerson = <span class="hljs-title function_">toRaw</span>(person)


<span class="hljs-comment">/* markRaw */</span>
<span class="hljs-keyword">let</span> citysd = <span class="hljs-title function_">markRaw</span>([
  {<span class="hljs-attr">id</span>:<span class="hljs-string">'asdda01'</span>,<span class="hljs-attr">name</span>:<span class="hljs-string">'北京'</span>},
  {<span class="hljs-attr">id</span>:<span class="hljs-string">'asdda02'</span>,<span class="hljs-attr">name</span>:<span class="hljs-string">'上海'</span>},
  {<span class="hljs-attr">id</span>:<span class="hljs-string">'asdda03'</span>,<span class="hljs-attr">name</span>:<span class="hljs-string">'天津'</span>},
  {<span class="hljs-attr">id</span>:<span class="hljs-string">'asdda04'</span>,<span class="hljs-attr">name</span>:<span class="hljs-string">'重庆'</span>}
])
<span class="hljs-comment">// 根据原始对象citys去创建响应式对象citys2 —— 创建失败，因为citys被markRaw标记了</span>
<span class="hljs-keyword">let</span> citys2 = <span class="hljs-title function_">reactive</span>(citys)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">isReactive</span>(person))
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">isReactive</span>(rawPerson))
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">isReactive</span>(citys))
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">isReactive</span>(citys2))
</code></pre>
</li>
</ol>
<h4 data-id="heading-82"><code>markRaw</code></h4>
<ol>
<li>
<p>作用：标记一个对象，使其<strong>永远不会</strong>变成响应式的。</p>
<blockquote>
<p>例如使用<code>mockjs</code>时，为了防止误把<code>mockjs</code>变为响应式对象，可以使用 <code>markRaw</code> 去标记<code>mockjs</code></p>
</blockquote>
</li>
<li>
<p>编码：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/* markRaw */</span>
<span class="hljs-keyword">let</span> citys = <span class="hljs-title function_">markRaw</span>([
  {<span class="hljs-attr">id</span>:<span class="hljs-string">'asdda01'</span>,<span class="hljs-attr">name</span>:<span class="hljs-string">'北京'</span>},
  {<span class="hljs-attr">id</span>:<span class="hljs-string">'asdda02'</span>,<span class="hljs-attr">name</span>:<span class="hljs-string">'上海'</span>},
  {<span class="hljs-attr">id</span>:<span class="hljs-string">'asdda03'</span>,<span class="hljs-attr">name</span>:<span class="hljs-string">'天津'</span>},
  {<span class="hljs-attr">id</span>:<span class="hljs-string">'asdda04'</span>,<span class="hljs-attr">name</span>:<span class="hljs-string">'重庆'</span>}
])
<span class="hljs-comment">// 根据原始对象citys去创建响应式对象citys2 —— 创建失败，因为citys被markRaw标记了</span>
<span class="hljs-keyword">let</span> citys2 = <span class="hljs-title function_">reactive</span>(citys)
</code></pre>
</li>
</ol>
<h3 data-id="heading-83">7.4.【customRef】</h3>
<p>作用：创建一个自定义的<code>ref</code>，并对其依赖项跟踪和更新触发进行逻辑控制。</p>
<p>实现防抖效果（<code>useSumRef.ts</code>）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> {customRef } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">initValue:<span class="hljs-built_in">string</span>,delay:<span class="hljs-built_in">number</span></span>){
  <span class="hljs-keyword">let</span> msg = <span class="hljs-title function_">customRef</span>(<span class="hljs-function">(<span class="hljs-params">track,trigger</span>)=&gt;</span>{
    <span class="hljs-keyword">let</span> <span class="hljs-attr">timer</span>:<span class="hljs-built_in">number</span>
    <span class="hljs-keyword">return</span> {
      <span class="hljs-title function_">get</span>(<span class="hljs-params"/>){
        <span class="hljs-title function_">track</span>() <span class="hljs-comment">// 告诉Vue数据msg很重要，要对msg持续关注，一旦变化就更新</span>
        <span class="hljs-keyword">return</span> initValue
      },
      <span class="hljs-title function_">set</span>(<span class="hljs-params">value</span>){
        <span class="hljs-built_in">clearTimeout</span>(timer)
        timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
          initValue = value
          <span class="hljs-title function_">trigger</span>() <span class="hljs-comment">//通知Vue数据msg变化了</span>
        }, delay);
      }
    }
  }) 
  <span class="hljs-keyword">return</span> {msg}
}
</code></pre>
<p>组件中使用：</p>
<h2 data-id="heading-84">8. Vue3新组件</h2>
<h3 data-id="heading-85">8.1. 【Teleport】</h3>
<ul>
<li>什么是Teleport？—— Teleport 是一种能够将我们的<strong>组件html结构</strong>移动到指定位置的技术。</li>
</ul>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">teleport</span> <span class="hljs-attr">to</span>=<span class="hljs-string">'body'</span> &gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"modal"</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">"isShow"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>我是一个弹窗<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>我是弹窗中的一些内容<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"isShow = false"</span>&gt;</span>关闭弹窗<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">teleport</span>&gt;</span>
</code></pre>
<h3 data-id="heading-86">8.2. 【Suspense】</h3>
<ul>
<li>等待异步组件时渲染一些额外内容，让应用有更好的用户体验</li>
<li>使用步骤：
<ul>
<li>异步引入组件</li>
<li>使用<code>Suspense</code>包裹组件，并配置好<code>default</code> 与 <code>fallback</code></li>
</ul>
</li>
</ul>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { defineAsyncComponent,<span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Child</span> = <span class="hljs-title function_">defineAsyncComponent</span>(<span class="hljs-function">()=&gt;</span><span class="hljs-keyword">import</span>(<span class="hljs-string">'./Child.vue'</span>))
</code></pre>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
    &lt;div class="app"&gt;
        &lt;h3&gt;我是App组件&lt;/h3&gt;
        &lt;Suspense&gt;
          &lt;template v-slot:default&gt;
            &lt;Child/&gt;
          &lt;/template&gt;
          &lt;template v-slot:fallback&gt;
            &lt;h3&gt;加载中.......&lt;/h3&gt;
          &lt;/template&gt;
        &lt;/Suspense&gt;
    &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-87">8.3.【全局API转移到应用对象】</h3>
<ul>
<li><code>app.component</code></li>
<li><code>app.config</code></li>
<li><code>app.directive</code></li>
<li><code>app.mount</code></li>
<li><code>app.unmount</code></li>
<li><code>app.use</code></li>
</ul>
<h3 data-id="heading-88">8.4.【其他】</h3>
<ul>
<li>
<p>过渡类名 <code>v-enter</code> 修改为 <code>v-enter-from</code>、过渡类名 <code>v-leave</code> 修改为 <code>v-leave-from</code>。</p>
</li>
<li>
<p><code>keyCode</code> 作为 <code>v-on</code> 修饰符的支持。</p>
</li>
<li>
<p><code>v-model</code> 指令在组件上的使用已经被重新设计，替换掉了 <code>v-bind.sync。</code></p>
</li>
<li>
<p><code>v-if</code> 和 <code>v-for</code> 在同一个元素身上使用时的优先级发生了变化。</p>
</li>
<li>
<p>移除了<code>$on</code>、<code>$off</code> 和 <code>$once</code> 实例方法。</p>
</li>
<li>
<p>移除了过滤器 <code>filter</code>。</p>
</li>
<li>
<p>移除了<code>$children</code> 实例 <code>propert</code>。</p>
<p>......</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 源码学习之init进程]]></title>    <link>https://juejin.cn/post/7572132916576567332</link>    <guid>https://juejin.cn/post/7572132916576567332</guid>    <pubDate>2025-11-14T07:37:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572132916576567332" data-draft-id="7572138663121354794" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android 源码学习之init进程"/> <meta itemprop="keywords" content="架构,Android,操作系统"/> <meta itemprop="datePublished" content="2025-11-14T07:37:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="帅锅锅007"/> <meta itemprop="url" content="https://juejin.cn/user/1151943914296254"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android 源码学习之init进程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943914296254/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    帅锅锅007
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T07:37:15.000Z" title="Fri Nov 14 2025 07:37:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Boot ROM  - Boot Read-Only-Memory</p>
<p>在AOSP源码中，<code>system/core/init/main.cpp</code> 里的 <code>main</code> 函数是<strong>整个Android用户空间的起点</strong>。它是在Linux内核启动完成后，由内核直接调用的<strong>第一个也是唯一一个用户空间进程</strong>。</p>
<p>具体时机和调用链条如下：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph A["Linux 内核启动流程 (kernel/init/main.c)"]
        A1["start_kernel()"] --&gt; A2["arch_call_rest_init()"]
        A2 --&gt; A3["rest_init()"]
        A3 --&gt; A4["kernel_init()"]
    end
  
    subgraph B["关键函数说明"]
        A1 --&gt; B1["内核主入口点&lt;br/&gt;完成核心子系统初始化&lt;br/&gt;内存管理、调度器、中断等"]
        A2 --&gt; B2["体系结构相关的&lt;br/&gt;rest_init调用点"]
        A3 --&gt; B3["创建关键内核线程&lt;br/&gt;- 启动kernel_init(PID=1)&lt;br/&gt;- 启动kthreadd(PID=2)&lt;br/&gt;- 进入idle循环"]
        A4 --&gt; B4["内核初始化线程&lt;br/&gt;准备用户空间环境&lt;br/&gt;最终执行用户空间init进程"]
    end
  
    subgraph C["与Android的关系"]
        A4 --&gt; C1["通过execve执行&lt;br/&gt;/system/bin/init"]
        C1 --&gt; C2["Android init进程&lt;br/&gt;system/core/init/main.cpp"]
		C2 --&gt; C3["main()"]
		C3 --&gt; C4["FirstStageMain()"]

    end
	subgraph D["关键函数说明"]
		C3 --&gt; D1["init进程代码入口"]
	end

    style A fill:#e1f5fe
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style A1 fill:#ffeb3b
    style A4 fill:#ff9800
</code></pre>
<h3 data-id="heading-0">调用时机</h3>
<ol>
<li><strong>Linux内核启动</strong>：设备上电后，Bootloader会加载Linux内核到内存并启动它。</li>
<li><strong>内核初始化</strong>：内核进行自身的一系列初始化工作，包括驱动、内存管理等。</li>
<li><strong>挂载根文件系统</strong>：内核挂载初始RAM磁盘（<code>initramfs</code>）或者（在Android中常见的）直接挂载系统分区作为根文件系统。</li>
<li><strong>启动第一个用户空间进程</strong>：内核在完成所有核心初始化后，会尝试执行一个名为 <code>init</code> 的程序。这个程序的路径是在内核编译时指定的，通常就是根文件系统下的 <code>/init</code>。</li>
</ol>
<h3 data-id="heading-1">调用过程</h3>
<p>这个调用过程是由内核代码直接写死的，其逻辑大致如下：</p>
<ol>
<li><strong>内核入口点</strong>：在内核源码的 <code>init/main.c</code> 中，<code>kernel_init</code> 函数负责启动第一个用户空间进程。</li>
<li><strong>尝试执行</strong>：内核会尝试执行 <code>/sbin/init</code>， <code>/etc/init</code>， <code>/bin/init</code> 等路径。</li>
<li><strong>回退方案</strong>：如果上述路径都失败了，内核会尝试执行 <code>/bin/sh</code> 作为回退。</li>
<li><strong>在Android中的情况</strong>：在AOSP编译后，生成的 <code>init</code> 可执行文件被直接放置在了根文件系统的根目录下，即 <code>/init</code>。因此，内核会成功找到并执行它。</li>
</ol>
<p>这个 <code>/init</code> 程序，就是由 <code>system/core/init/</code> 目录下的源码编译而成的。</p>
<h3 data-id="heading-2"><code>main.cpp</code> 中的 <code>main</code> 函数</h3>
<p>所以，<code>main</code> 函数的调用时机非常明确：<strong>在Linux内核完成自身初始化，并准备将控制权交给用户空间的那一刻，由内核直接调用。</strong></p>
<p>它的执行流程可以简化为：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// system/core/init/main.cpp</span>

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>** argv)</span> </span>{
    <span class="hljs-comment">// 1. 处理内核命令行参数，例如 `androidboot.selinux=permissive`</span>
    <span class="hljs-comment">// 2. 创建必要的目录并挂载文件系统 (如 /dev, /proc, /sys 等)</span>
    <span class="hljs-comment">// 3. 初始化 Kernel Logging (kmsg)</span>
    <span class="hljs-comment">// 4. 进行第一次阶段初始化 (First Stage Mount) - 主要在 recovery 或 ramdisk 环境中</span>
    <span class="hljs-comment">// 5. 如果不是在 First Stage，则执行核心的 init 逻辑</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">FirstStageMain</span>(argc, argv); <span class="hljs-comment">// 或者 SecondStageMain(argv)</span>
}
</code></pre>
<p>在现代Android系统中（尤其是使用了动态分区和A/B更新的设备），init的启动被分成了多个阶段：</p>
<ul>
<li><strong>First Stage Init</strong>：在内核还挂载着初始 <code>rootfs</code> 时运行，主要负责挂载真正的系统分区、vendor分区等，并为第二阶段的init设置好环境。</li>
<li><strong>Second Stage Init</strong>：在必要的分区被挂载后，系统会 <code>execv</code> 重新执行位于新系统分区上的 <code>/system/bin/init</code>，进入第二阶段。这个阶段会建立完整的Android运行环境，包括启动属性服务、解析init.rc脚本、启动守护进程、Zygote等。</li>
</ul>
<h3 data-id="heading-3">总结</h3>

























<table><thead><tr><th align="left">项目</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><strong>调用者</strong></td><td align="left">Linux 内核</td></tr><tr><td align="left"><strong>调用时机</strong></td><td align="left">内核完成所有内部初始化之后，准备切换到用户空间时</td></tr><tr><td align="left"><strong>调用方式</strong></td><td align="left">内核通过<code>execve</code> 系统调用执行根文件系统中的 <code>/init</code> 程序</td></tr><tr><td align="left"><strong>程序路径</strong></td><td align="left">在设备根文件系统中为<code>/init</code>，在AOSP源码中位于 <code>system/core/init/</code></td></tr></tbody></table>
<p>因此，<code>init</code> 进程的PID永远是1，它是所有其他用户空间进程的祖先进程。它的 <code>main</code> 函数是Android系统用户空间的绝对起点。</p>
<p>---- 后续讲解FirstStageMain()相关流程----</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[还在为HTML转PDF发愁？再介绍两款工具，为你保驾护航！]]></title>    <link>https://juejin.cn/post/7571751304625569838</link>    <guid>https://juejin.cn/post/7571751304625569838</guid>    <pubDate>2025-11-13T02:12:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571751304625569838" data-draft-id="7571758212473749555" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="还在为HTML转PDF发愁？再介绍两款工具，为你保驾护航！"/> <meta itemprop="keywords" content="后端,Java,程序员"/> <meta itemprop="datePublished" content="2025-11-13T02:12:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SimonKing"/> <meta itemprop="url" content="https://juejin.cn/user/4001878056904584"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            还在为HTML转PDF发愁？再介绍两款工具，为你保驾护航！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4001878056904584/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SimonKing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-13T02:12:55.000Z" title="Thu Nov 13 2025 02:12:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>关注我的公众号：【编程朝花夕拾】，可获取首发内容。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42b0f46eac5946f38b0d0e83e709783b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763604775&amp;x-signature=XGfEVYv7IQa%2FVvf9k20KoVYhHjw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">01 引言</h2>
<p>在之前专门写了一篇文章《<code>SpringBoot</code>集成：5分钟实现<code>HTML</code>转<code>PDF</code>功能》，介绍三款<code>Html</code>转<code>PDF</code>的工具。这不，又发现了两款类似的工具，整理一下分享给大家。</p>
<h2 data-id="heading-1">02 itext-pdfhtml-java</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/024171cf2f7344d68ee3351459f33583~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763604775&amp;x-signature=GBk7ynYUKAr20K5UleVzP3Z9T7Q%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">2.1 简介</h3>
<p><code>iText pdfHTML</code>是<code>iText7</code>套件的一个附加组件，专门用于将<code>HTML</code>和<code>CSS</code>内容转换为<code>PDF</code>文档。它基于<code>iText</code>核心<code>PDF</code>生成引擎，提供了高质量的<code>HTML</code>到<code>PDF</code>转换功能。性能表现非常优异。</p>
<p>主要特性：</p>
<ul>
<li><strong>完整的<code>HTML5</code>和<code>CSS3</code>支持</strong>：能够处理现代网页布局和样式</li>
<li><strong>字体嵌入</strong>：自动处理Web字体和系统字体</li>
<li><strong>响应式设计</strong>：支持媒体查询和响应式布局</li>
<li><strong>高保真转换</strong>：保持HTML内容的视觉保真度</li>
<li><strong>Java原生</strong>：专为Java生态系统设计</li>
</ul>
<p><code>GitHub</code>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fitext%2Fitext-pdfhtml-java" target="_blank" title="https://github.com/itext/itext-pdfhtml-java" ref="nofollow noopener noreferrer">github.com/itext/itext…</a></p>
<p>官方地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fitextpdf.com%2Fproducts%2Fconvert-html-css-to-pdf-pdfhtml" target="_blank" title="https://itextpdf.com/products/convert-html-css-to-pdf-pdfhtml" ref="nofollow noopener noreferrer">itextpdf.com/products/co…</a></p>
<h3 data-id="heading-3">2.2 案例</h3>
<p>使用起来也非常简单，下面官方的案例：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca4a7ca81d0d437d9377dd672981f93a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763604775&amp;x-signature=n%2BufL%2FAX17Q1IJJb4bV64o6Je6A%3D" alt="" loading="lazy"/></p>
<p><strong>Maven依赖</strong>：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itextpdf<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>html2pdf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.2.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>实践代码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RequestMapping("index6")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">index6</span><span class="hljs-params">(Model model, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException {
    List&lt;Map&lt;String, Object&gt;&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
        Map&lt;String, Object&gt; item = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        item.put(<span class="hljs-string">"image1"</span>, <span class="hljs-string">"http://example.com/2eb97.jpg"</span>);
        item.put(<span class="hljs-string">"image2"</span>, <span class="hljs-string">"http://example.com/2f9c3.jpg"</span>);
        item.put(<span class="hljs-string">"vehicleName"</span>, <span class="hljs-string">"路虎Defender［卫士］（进口）2023款Defender130 48V［卫士 130 48V] 3.0T手自－体P400 HSE"</span>);
        item.put(<span class="hljs-string">"brandName"</span>, <span class="hljs-string">"路虎"</span>);
        item.put(<span class="hljs-string">"seriesName"</span>, <span class="hljs-string">"Defender［卫士］"</span>);
        item.put(<span class="hljs-string">"modelYear"</span>, <span class="hljs-string">"2023款"</span>);
        item.put(<span class="hljs-string">"licenseYear"</span>, SDF.format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()));
        item.put(<span class="hljs-string">"displayMileage"</span>, DF.format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"9657"</span>)));
        item.put(<span class="hljs-string">"dealDate"</span>, SDF.format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()));
        item.put(<span class="hljs-string">"dealPrice"</span>, DF.format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"702400"</span>)));

        item.put(<span class="hljs-string">"licenseCode"</span>, <span class="hljs-string">"沪A952714"</span>);

        list.add(item);
    }
    model.addAttribute(<span class="hljs-string">"list"</span>, list);
    Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    map.put(<span class="hljs-string">"list"</span>, list);

    <span class="hljs-type">Context</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Context</span>(Locale.getDefault(), map);
    <span class="hljs-type">String</span> <span class="hljs-variable">htmlContent</span> <span class="hljs-operator">=</span> templateEngine.process(<span class="hljs-string">"index"</span>, context);
    System.out.println(htmlContent);

    <span class="hljs-comment">// ---------------------------------------------------</span>
    <span class="hljs-comment">/*itext-html2pdf*/</span>
    <span class="hljs-type">ConverterProperties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConverterProperties</span>();

    <span class="hljs-type">FontProvider</span> <span class="hljs-variable">fontProvider</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FontProvider</span>();
    fontProvider.addSystemFonts();
<span class="hljs-comment">//        fontProvider.addFont("C:\\Windows\\Fonts\\simhei.ttf");</span>
    <span class="hljs-comment">// 添加系统字体</span>
    properties.setFontProvider(fontProvider);

    HtmlConverter.convertToPdf(htmlContent, response.getOutputStream(), properties);
}
</code></pre>
<p>同样默认是不支持中文的，需要通过<code>FontProvider</code>添加指定的字体。<code>fontProvider.addSystemFonts();</code>直接添加系统字体，也可以通过<code>addFont()</code>添加自定义字体。页面必须声明字体，否则会出现乱码。</p>
<h2 data-id="heading-4">03 x-easypdf</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f789e0271ef646d08c9ff65b1d160004~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763604775&amp;x-signature=MzcOsM2iWen1FdY%2FiDzfn9hrK68%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">3.1 简介</h3>
<p><code>x-easypdf</code>是一个<code>java</code>语言简化处理<code>pdf</code>的框架，包含<code>fop</code>模块与<code>pdfbox</code>模块，<code>fop</code>模块以创建功能为主，基于<code>xsl-fo</code>模板生成<code>pdf</code>文档，以数据源的方式进行模板渲染；<code>pdfbox</code>模块以编辑功能为主，对标准的<code>pdfbox</code>进行扩展，添加了成吨的功能。</p>
<p><code>Html</code>转<code>Pdf</code>是<code>pdfbox</code>模块下的一个转化器的功能，是基于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplaywright.dev%2Fjava%2Fdocs%2Fintro" target="_blank" title="https://playwright.dev/java/docs/intro" ref="nofollow noopener noreferrer">playwright</a> 实现的。而<code>playwright</code>的依赖需要手动引入。<code>Playwright</code>是一个跨语言的浏览器自动化库，由<code>Microsoft</code>开发。虽然主要用于端到端测试，但其强大的<code>PDF</code>生成功能也使其成为<code>HTML</code>转<code>PDF</code>的优秀工具。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92d45b8a6e1b4e38b12f17cd8b94a417~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763604775&amp;x-signature=auTpCKZiPq%2B8JF%2BTr%2B%2BXDxLnfnE%3D" alt="" loading="lazy"/></p>
<p><code>Gitee</code>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fdromara%2Fx-easypdf" target="_blank" title="https://gitee.com/dromara/x-easypdf" ref="nofollow noopener noreferrer">gitee.com/dromara/x-e…</a></p>
<p>官网地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fx-easypdf.cn%2F" target="_blank" title="https://x-easypdf.cn/" ref="nofollow noopener noreferrer">x-easypdf.cn/</a></p>
<h3 data-id="heading-6">3.2 案例</h3>
<p><code>x-easypdf</code>是对<code>playwrigh</code>的功能做了一层包装，使用起来更方便。</p>
<p><strong>Maven依赖</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.dromara<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>x-easypdf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.7<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.microsoft.playwright<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>playwright<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.53.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>实践代码01</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RequestMapping("index10")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">index10</span><span class="hljs-params">(HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-comment">// 获取html转换器</span>
    <span class="hljs-type">HtmlConvertor</span> <span class="hljs-variable">convertor</span> <span class="hljs-operator">=</span> PdfHandler.getDocumentConvertor().getHtmlConvertor();
    <span class="hljs-type">Document</span> <span class="hljs-variable">pdf</span> <span class="hljs-operator">=</span> convertor.toPdf(<span class="hljs-string">"http://127.0.0.1:8080/page/index"</span>);
    pdf.save(response.getOutputStream());
}
</code></pre>
<p><strong>注意事项</strong></p>
<p><code>playwrigh</code>是基于浏览器引擎的，首次调用会下载默认的浏览器，下载完成之后，后续的使用就流畅了。而且默认支持中文，因为使用浏览器引擎，所以对于<code>Html</code>和<code>Css</code>支持较好。但是消耗资源较高。</p>
<p>但是这里<code>convertor.toPdf()</code>目前支持传入地址和文件。不支持直接<code>html</code>内容直接转化的。但是<code>playwrigh</code>本身是支持的。</p>
<p>小编已经给<code>x-easypdf</code>作者提了<code>issues</code>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fdromara%2Fx-easypdf%2Fissues%2FID59TK" target="_blank" title="https://gitee.com/dromara/x-easypdf/issues/ID59TK" ref="nofollow noopener noreferrer">gitee.com/dromara/x-e…</a></p>
<p>**注意：**截止发稿，官方已经在<code>3.5.0</code>版本支持了<code>html</code>内容转<code>Pdf</code>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d21ec3c6eb54a7daec64c339549b078~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763604775&amp;x-signature=7kcF1hIUJPoWys6g%2FV4yWOgDTtA%3D" alt="" loading="lazy"/></p>
<p><strong>实战代码02</strong></p>
<p>使用模板引擎的方式：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90c01f3689904b9ab9a5bb5301649a2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763604775&amp;x-signature=2pIfLVnU7TbdmZd1c3Q33%2BohlO4%3D" alt="" loading="lazy"/></p>
<p>官网地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fx-easypdf.cn%2Fguide%2Fpdfbox%2Fadvance%2Ftemplater%2F%25E6%25A8%25A1%25E6%259D%25BF%25E5%25BC%2595%25E6%2593%258E.html%23thymeleaf" target="_blank" title="https://x-easypdf.cn/guide/pdfbox/advance/templater/%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E.html#thymeleaf" ref="nofollow noopener noreferrer">x-easypdf.cn/guide/pdfbo…</a></p>
<p>依然是建立在<code>playwrigh</code>基础之上。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RequestMapping("index12")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">index12</span><span class="hljs-params">(HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException {
    List&lt;Map&lt;String, Object&gt;&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
        Map&lt;String, Object&gt; item = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        item.put(<span class="hljs-string">"image1"</span>, <span class="hljs-string">"http://example.com/2eb97.jpg"</span>);
        item.put(<span class="hljs-string">"image2"</span>, <span class="hljs-string">"http://example.com/2f9c3.jpg"</span>);
        item.put(<span class="hljs-string">"vehicleName"</span>, <span class="hljs-string">"路虎Defender［卫士］（进口）2023款Defender130 48V［卫士 130 48V] 3.0T手自－体P400 HSE"</span>);
        item.put(<span class="hljs-string">"brandName"</span>, <span class="hljs-string">"路虎"</span>);
        item.put(<span class="hljs-string">"seriesName"</span>, <span class="hljs-string">"Defender［卫士］"</span>);
        item.put(<span class="hljs-string">"modelYear"</span>, <span class="hljs-string">"2023款"</span>);
        item.put(<span class="hljs-string">"licenseYear"</span>, SDF.format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()));
        item.put(<span class="hljs-string">"displayMileage"</span>, DF.format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"9657"</span>)));
        item.put(<span class="hljs-string">"dealDate"</span>, SDF.format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()));
        item.put(<span class="hljs-string">"dealPrice"</span>, DF.format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"702400"</span>)));

        item.put(<span class="hljs-string">"licenseCode"</span>, <span class="hljs-string">"沪A952714"</span>);

        list.add(item);
    }
    Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    map.put(<span class="hljs-string">"list"</span>, list);

    <span class="hljs-type">ThymeleafTemplater</span> <span class="hljs-variable">templater</span> <span class="hljs-operator">=</span> PdfHandler.getDocumentTemplater().getThymeleafTemplater();
    templater.setTemplatePath(<span class="hljs-string">"templates"</span>);
    templater.setTemplateName(<span class="hljs-string">"index.html"</span>);
    templater.setTemplateData(map);

    <span class="hljs-comment">// 获取 html 内容</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> templater.getHtmlContent();
    System.out.println(content);

    <span class="hljs-comment">// 转换文档</span>
    <span class="hljs-type">Document</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> templater.transform();
    document.save(response.getOutputStream());
}
</code></pre>
<p>这里需要说明的是：由于<code>x-easypdf</code>自行解析了<code>Thymeleaf</code>模版，所以无法使用<code>spring-boot-starter-thymeleaf</code>的配置。<code>templatePath</code>和<code>templateName</code>都需要写完整。<code>templatePath</code>指<code>classpath</code>下的路径。</p>
<p>模板引擎可能会出现<code>nested exception is java.lang.NoClassDefFoundError: ognl/PropertyAccessor</code>的错误，需要引入<code>ognl</code>，且版本不能超过<code>3.2</code>。从 <code>3.2</code> 开始，会报<code>java.lang.NoClassDefFoundError: ognl/DefaultMemberAccess</code>。有效版本：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>ognl<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ognl<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.1.28<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>边距可以通过打印样式控制：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@page</span> {
    size: A4;
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">20px</span>;
}
</code></pre>
<h3 data-id="heading-7">3.3 <code>playwrigh</code>原生写法</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RequestMapping("index11")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">index11</span><span class="hljs-params">(HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-keyword">try</span> (<span class="hljs-type">Playwright</span> <span class="hljs-variable">playwright</span> <span class="hljs-operator">=</span> Playwright.create();
         <span class="hljs-type">Browser</span> <span class="hljs-variable">browser</span> <span class="hljs-operator">=</span> playwright.chromium().launch()) {
        <span class="hljs-type">BrowserContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> browser.newContext();
        <span class="hljs-type">Page</span> <span class="hljs-variable">page</span> <span class="hljs-operator">=</span> context.newPage();

        <span class="hljs-comment">// 从HTML内容生成PDF</span>
        page.setContent(<span class="hljs-string">"&lt;h1&gt;Hello, Playwright!&lt;/h1&gt;"</span>);
        <span class="hljs-type">byte</span>[] pdf = page.pdf();

        <span class="hljs-type">ByteArrayInputStream</span> <span class="hljs-variable">bais</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(pdf);
        IOUtils.copy(bais, response.getOutputStream());
    }
}
</code></pre>
<h2 data-id="heading-8">04 小结</h2>
<p><code>iText pdfHTML</code>内存占用低，转换速度快，适合服务器端批量处理。而<code>Playwright</code>需要更多资源，但渲染质量极高，适合对视觉保真度要求高的场景，所以<code>x-easypdf</code>也是一样的。如果只是针对<code>Html</code>转<code>Pdf</code>的服务端转化的场景<code>iText pdfHTML</code>的优势更明显一下，关键它快！</p>
<p>也有粉丝朋友留言说<code>jasperreports</code>也很好用，小编也试了一下。<code>jasperreports</code>需要加载特定的模板，也许是因为不是很熟悉，用起来感觉有点别扭。这里就不推荐了，有兴趣的可以去试试！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Swift 6 实战：从“定时器轮询”到 AsyncSequence 的优雅实时推送]]></title>    <link>https://juejin.cn/post/7571751304624701486</link>    <guid>https://juejin.cn/post/7571751304624701486</guid>    <pubDate>2025-11-13T00:05:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571751304624701486" data-draft-id="7559481579463000106" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Swift 6 实战：从“定时器轮询”到 AsyncSequence 的优雅实时推送"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2025-11-13T00:05:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Swift 6 实战：从“定时器轮询”到 AsyncSequence 的优雅实时推送
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-13T00:05:07.000Z" title="Thu Nov 13 2025 00:05:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在 iOS 开发中，「实时刷新」需求随处可见：</p>
<ul>
<li>天气卡片 3 秒更新一次</li>
<li>座位状态由绿变红</li>
<li>股价、比分、配送进度……</li>
</ul>
<p>过去我们习惯用 <code>Timer.scheduledTimer</code> 写一个“死循环”，或者把 Combine 的 <code>Timer.publish</code> 拼成管道。</p>
<p>Swift 6 以后，官方把 AsyncSequence 推到 C 位，让我们用“流”的思维解决轮询。</p>
<h2 data-id="heading-1">核心概念速览</h2>



































<table><thead><tr><th>概念</th><th>一句话说明</th><th>本文对应示例</th></tr></thead><tbody><tr><td>AsyncSequence</td><td>一个可以 <code>for await</code> 遍历的异步序列，天生支持结构化并发与自动取消</td><td><code>AsyncStream&lt;WeatherCondition&gt;</code></td></tr><tr><td>AsyncStream</td><td>官方提供的 AsyncSequence 实现，适合“自己写生产端”的场景</td><td><code>pollingStream(api:)</code></td></tr><tr><td>Task.sleep</td><td>非阻塞的异步“睡眠”，不会卡住线程</td><td><code>try? await Task.sleep(for: .seconds(3))</code></td></tr><tr><td>Task.isCancelled</td><td>结构化并发中的“取消标记”，用 while 判断即可优雅退出</td><td><code>while !Task.isCancelled</code></td></tr><tr><td>MainActor.run</td><td>把闭包安全切回主线程，避免 UI 崩溃</td><td><code>await MainActor.run { … }</code></td></tr></tbody></table>
<h2 data-id="heading-2">三种实现逐行拆解</h2>
<h3 data-id="heading-3">基础API</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">WeatherCondition</span>: <span class="hljs-title class_">String</span>, <span class="hljs-title class_">CaseIterable</span> {
    <span class="hljs-keyword">case</span> clear, stormy
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">WeatherResponse</span> {
    <span class="hljs-keyword">let</span> condition: <span class="hljs-type">WeatherCondition</span>
}

<span class="hljs-keyword">actor</span> <span class="hljs-title class_">MockWeatherAPI</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">fetchWeather</span>() <span class="hljs-keyword">async</span> -&gt; <span class="hljs-type">WeatherResponse</span> {
        <span class="hljs-keyword">try?</span> <span class="hljs-keyword">await</span> <span class="hljs-type">Task</span>.sleep(for: .seconds(<span class="hljs-number">1</span>))
        <span class="hljs-keyword">return</span> <span class="hljs-type">WeatherResponse</span>(condition: <span class="hljs-type">WeatherCondition</span>.allCases.randomElement()<span class="hljs-operator">!</span>)
    }
}
</code></pre>
<h3 data-id="heading-4">定时器派：Timer.scheduledTimer</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 传统写法，功能可用，但坑最多</span>
<span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TimerViewModel</span>: <span class="hljs-title class_">ObservableObject</span> {
    <span class="hljs-meta">@Published</span> <span class="hljs-keyword">var</span> weather: <span class="hljs-type">WeatherCondition</span> <span class="hljs-operator">=</span> .clear
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> timer: <span class="hljs-type">Timer</span>?
    
    <span class="hljs-keyword">init</span>(<span class="hljs-params">api</span>: <span class="hljs-type">MockWeatherAPI</span>) {
        <span class="hljs-comment">// 每 3 秒在主线程回调一次</span>
        timer <span class="hljs-operator">=</span> <span class="hljs-type">Timer</span>.scheduledTimer(withTimeInterval: <span class="hljs-number">3.0</span>, repeats: <span class="hljs-literal">true</span>) { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">_</span> <span class="hljs-keyword">in</span>
            <span class="hljs-comment">// 必须在异步上下文调用 async 方法，所以包一层 Task</span>
            <span class="hljs-type">Task</span> {
                <span class="hljs-keyword">let</span> response <span class="hljs-operator">=</span> <span class="hljs-keyword">await</span> api.fetchWeather()
                <span class="hljs-comment">// 回到主线程改 UI</span>
                <span class="hljs-keyword">await</span> <span class="hljs-type">MainActor</span>.run { <span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.weather <span class="hljs-operator">=</span> response.condition }
            }
        }
    }
    
    <span class="hljs-keyword">deinit</span> {
        timer<span class="hljs-operator">?</span>.invalidate()   <span class="hljs-comment">// 忘了写就会内存泄漏</span>
    }
}
</code></pre>
<p>缺点小结</p>
<ol>
<li>忘记 <code>invalidate()</code> 直接泄漏</li>
<li>后台模式下容易“卡”计时器</li>
<li>单元测试必须真跑 3 秒，CI 极慢</li>
</ol>
<h3 data-id="heading-5">Combine 派：Timer.publish + Future</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CombineViewModel</span>: <span class="hljs-title class_">ObservableObject</span> {
    <span class="hljs-meta">@Published</span> <span class="hljs-keyword">var</span> weather: <span class="hljs-type">WeatherCondition</span> <span class="hljs-operator">=</span> .clear
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> cancellables <span class="hljs-operator">=</span> <span class="hljs-type">Set</span>&lt;<span class="hljs-type">AnyCancellable</span>&gt;()
    
    <span class="hljs-keyword">init</span>(<span class="hljs-params">api</span>: <span class="hljs-type">MockWeatherAPI</span>) {
        <span class="hljs-comment">// 1. 主线程每 3 秒发一个日期</span>
        <span class="hljs-type">Timer</span>.publish(every: <span class="hljs-number">3</span>, on: .main, in: .common)
            .autoconnect()
            <span class="hljs-comment">// 2. 把日期换成异步请求</span>
            .flatMap { <span class="hljs-keyword">_</span> <span class="hljs-keyword">in</span>
                <span class="hljs-type">Future</span> { promise <span class="hljs-keyword">in</span>
                    <span class="hljs-type">Task</span> {
                        <span class="hljs-keyword">let</span> response <span class="hljs-operator">=</span> <span class="hljs-keyword">await</span> api.fetchWeather()
                        promise(.success(response.condition))
                    }
                }
            }
            .receive(on: <span class="hljs-type">RunLoop</span>.main)   <span class="hljs-comment">// 3. 回到主线程</span>
            .assign(to: <span class="hljs-operator">&amp;</span><span class="hljs-variable">$weather</span>)        <span class="hljs-comment">// 4. 直接绑到属性</span>
    }
}
</code></pre>
<p>缺点小结</p>
<ul>
<li>异步/await 与 Combine 混写，心智负担高</li>
<li><code>Future</code> 只能完成一次，不能“持续”发值，需要 <code>flatMap</code> 不断新建</li>
<li>测试仍需跑真时间或使用 <code>TestScheduler</code></li>
</ul>
<h3 data-id="heading-6">AsyncSequence 派：AsyncStream 一统江湖</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StreamViewModel</span>: <span class="hljs-title class_">ObservableObject</span> {
    <span class="hljs-meta">@Published</span> <span class="hljs-keyword">var</span> weather: <span class="hljs-type">WeatherCondition</span> <span class="hljs-operator">=</span> .clear
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> task: <span class="hljs-type">Task</span>&lt;<span class="hljs-type">Void</span>, <span class="hljs-type">Never</span>&gt;?
    
    <span class="hljs-keyword">init</span>(<span class="hljs-params">api</span>: <span class="hljs-type">MockWeatherAPI</span>) {
        <span class="hljs-comment">// 结构化并发：启动一个子任务</span>
        task <span class="hljs-operator">=</span> <span class="hljs-type">Task</span> {
            <span class="hljs-comment">// 直接 for await 遍历自定义流</span>
            <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> update <span class="hljs-keyword">in</span> <span class="hljs-keyword">Self</span>.pollingStream(api: api) {
                <span class="hljs-keyword">await</span> <span class="hljs-type">MainActor</span>.run { <span class="hljs-keyword">self</span>.weather <span class="hljs-operator">=</span> update }
            }
        }
    }
    
    <span class="hljs-keyword">deinit</span> {
        task<span class="hljs-operator">?</span>.cancel()   <span class="hljs-comment">// 取消即停流，无需手动 invalidate</span>
    }
    
    <span class="hljs-comment">// MARK: - 核心工厂方法</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">pollingStream</span>(<span class="hljs-params">api</span>: <span class="hljs-type">MockWeatherAPI</span>) -&gt; <span class="hljs-type">AsyncStream</span>&lt;<span class="hljs-type">WeatherCondition</span>&gt; {
        <span class="hljs-type">AsyncStream</span> { continuation <span class="hljs-keyword">in</span>
            <span class="hljs-comment">// 真正生产端跑在子任务</span>
            <span class="hljs-type">Task</span> {
                <span class="hljs-comment">// 如果外部调用者取消 Task，这里会优雅退出</span>
                <span class="hljs-keyword">while</span> <span class="hljs-operator">!</span><span class="hljs-type">Task</span>.isCancelled {
                    <span class="hljs-keyword">let</span> update <span class="hljs-operator">=</span> <span class="hljs-keyword">await</span> api.fetchWeather()
                    continuation.yield(update.condition)          <span class="hljs-comment">// 向下游发一个值</span>
                    <span class="hljs-keyword">try?</span> <span class="hljs-keyword">await</span> <span class="hljs-type">Task</span>.sleep(for: .seconds(<span class="hljs-number">3</span>))       <span class="hljs-comment">// 等 3 秒再采</span>
                }
                continuation.finish()                             <span class="hljs-comment">// 告知“我发完了”</span>
            }
        }
    }
}
</code></pre>
<p>优点小结</p>
<p>✅ 取消即停：Task 取消后 <code>while</code> 自动结束</p>
<p>✅ 测试友好：用 <code>AsyncStream.makeAsyncIterator()</code> 可以同步拿值，无需真睡 3 秒</p>
<p>✅ 可组装：后续加 <code>timeout</code>、<code>debounce</code>、<code>buffer</code> 都只要包一层序列</p>
<h3 data-id="heading-7">视图层：SeatAvailabilityView</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">SeatAvailabilityView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-keyword">let</span> condition: <span class="hljs-type">WeatherCondition</span>
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">Circle</span>()
            .fill(condition <span class="hljs-operator">==</span> .clear <span class="hljs-operator">?</span> .green : .red)
            .frame(width: <span class="hljs-number">100</span>, height: <span class="hljs-number">100</span>)
            .overlay(<span class="hljs-type">Text</span>(condition.rawValue.capitalized))
    }
}
</code></pre>
<p>使用：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@StateObject</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> vm <span class="hljs-operator">=</span> <span class="hljs-type">StreamViewModel</span>(api: <span class="hljs-type">MockWeatherAPI</span>())
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">SeatAvailabilityView</span>(condition: vm.weather)
            .task {          <span class="hljs-comment">// 视图消失时自动取消内部的 Task</span>
                <span class="hljs-comment">// 如果这里还启动额外工作，可一并取消</span>
            }
    }
}
</code></pre>
<h4 data-id="heading-8">取消的 3 个姿势</h4>

























<table><thead><tr><th>场景</th><th>实现方式</th><th>代码片段</th></tr></thead><tbody><tr><td>视图消失</td><td><code>.task</code>修饰符</td><td><code>.task { … }</code>自动在 disappear 时 cancel</td></tr><tr><td>手动取消</td><td><code>deinit</code>调 <code>task?.cancel()</code></td><td>见 StreamViewModel</td></tr><tr><td>超时取消</td><td><code>AsyncThrowingStream</code>+ <code>withTimeout</code></td><td>见下方扩展</td></tr></tbody></table>
<h4 data-id="heading-9">单元测试：Swift Testing 示例</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> Testing
<span class="hljs-keyword">@testable</span> <span class="hljs-keyword">import</span> YourModule

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">WeatherPollingTests</span> {
    <span class="hljs-comment">// 验证流能正常 emit 值</span>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">streamEmitsValues</span>() <span class="hljs-keyword">async</span> <span class="hljs-keyword">throws</span> {
        <span class="hljs-keyword">let</span> api <span class="hljs-operator">=</span> <span class="hljs-type">MockWeatherAPI</span>()
        <span class="hljs-keyword">let</span> stream <span class="hljs-operator">=</span> <span class="hljs-type">StreamViewModel</span>.pollingStream(api: api)
        <span class="hljs-keyword">var</span> iterator <span class="hljs-operator">=</span> stream.makeAsyncIterator()
        <span class="hljs-keyword">let</span> first <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> iterator.next()
        #expect(first <span class="hljs-operator">!=</span> <span class="hljs-literal">nil</span>)
    }
    
    <span class="hljs-comment">// 验证外部取消后，循环会退出</span>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">streamCancellation</span>() <span class="hljs-keyword">async</span> <span class="hljs-keyword">throws</span> {
        <span class="hljs-keyword">let</span> api <span class="hljs-operator">=</span> <span class="hljs-type">MockWeatherAPI</span>()
        <span class="hljs-keyword">let</span> task <span class="hljs-operator">=</span> <span class="hljs-type">Task</span> {
            <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> <span class="hljs-keyword">_</span> <span class="hljs-keyword">in</span> <span class="hljs-type">StreamViewModel</span>.pollingStream(api: api) { }
        }
        task.cancel()
        #expect(task.isCancelled)
    }
}
</code></pre>
<p>测试提速技巧</p>
<ul>
<li>把 <code>Task.sleep</code> 抽象成 <code>Clock.sleep</code>，测试注入 <code>ImmediateClock</code> 即可 0 秒跑完</li>
<li>用 <code>AsyncStream.makeAsyncIterator()</code> 可以一条一条拿值，断言更细</li>
</ul>
<h2 data-id="heading-10">扩展场景</h2>
<h3 data-id="heading-11">带超时的轮询</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">extension</span> <span class="hljs-title class_">AsyncStream</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">withTimeout</span>&lt;<span class="hljs-type">C</span>: <span class="hljs-type">Clock</span>&gt;(<span class="hljs-keyword">_</span> <span class="hljs-params">duration</span>: <span class="hljs-type">C</span>.<span class="hljs-type">Instant</span>.<span class="hljs-type">Duration</span>, <span class="hljs-params">clock</span>: <span class="hljs-type">C</span>) <span class="hljs-keyword">async</span> <span class="hljs-keyword">throws</span> -&gt; <span class="hljs-keyword">Self</span> {
        <span class="hljs-comment">// 用 withThrowingTaskGroup 同时跑“生产值”和“倒计时”</span>
        <span class="hljs-comment">// 哪边先到就取消另一边</span>
    }
}
</code></pre>
<h3 data-id="heading-12">假 WebSocket 一键替换</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">MockWebSocket</span>: <span class="hljs-title class_">AsyncSequence</span> {
    <span class="hljs-keyword">typealias</span> <span class="hljs-type">Element</span> <span class="hljs-operator">=</span> <span class="hljs-type">WeatherCondition</span>
    
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">AsyncIterator</span>: <span class="hljs-title class_">AsyncIteratorProtocol</span> {
        <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">next</span>() <span class="hljs-keyword">async</span> -&gt; <span class="hljs-type">WeatherCondition</span>? {
            <span class="hljs-comment">// 2 秒随机一个值，模拟帧</span>
            <span class="hljs-keyword">try?</span> <span class="hljs-keyword">await</span> <span class="hljs-type">Task</span>.sleep(for: .seconds(<span class="hljs-number">2</span>))
            <span class="hljs-keyword">return</span> <span class="hljs-type">WeatherCondition</span>.allCases.randomElement()
        }
    }
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">makeAsyncIterator</span>() -&gt; <span class="hljs-type">AsyncIterator</span> { <span class="hljs-type">AsyncIterator</span>() }
}
</code></pre>
<p>把 <code>for await update in MockWebSocket()</code> 直接塞进 ViewModel，</p>
<p>将来换真 WebSocket 只要改一行，UI 层零改动。</p>
<h2 data-id="heading-13">总结与选型建议</h2>
<ol>
<li>新代码直接上 <code>AsyncStream</code>
<ul>
<li>取消简单、测试快、与 Swift Concurrency 原生一致</li>
</ul>
</li>
<li>老代码如果已用 Combine
<ul>
<li>可继续用 <code>Timer.publish</code>，但建议包一层 <code>AsyncPublisher</code> 逐步迁移</li>
</ul>
</li>
<li>纯定时器场景
<ul>
<li>只要最小依赖，也可以 <code>AsyncSequence</code> 一把梭，别再写 <code>Timer</code> 了</li>
</ul>
</li>
</ol>
<h2 data-id="heading-14">学习资料</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmedium.com%2F%40wesleymatlock%2Fasyncsequence-for-real-time-apis-from-legacy-polling-to-swift-6-elegance-c2b8139c21e0" target="_blank" title="https://medium.com/@wesleymatlock/asyncsequence-for-real-time-apis-from-legacy-polling-to-swift-6-elegance-c2b8139c21e0" ref="nofollow noopener noreferrer">medium.com/@wesleymatl…</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从擦除到恢复：JSON 库是如何“还原” Java 泛型信息的]]></title>    <link>https://juejin.cn/post/7571646669202571306</link>    <guid>https://juejin.cn/post/7571646669202571306</guid>    <pubDate>2025-11-13T00:04:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571646669202571306" data-draft-id="7571391088947822630" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从擦除到恢复：JSON 库是如何“还原” Java 泛型信息的"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-13T00:04:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="风象南"/> <meta itemprop="url" content="https://juejin.cn/user/2524134428655159"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从擦除到恢复：JSON 库是如何“还原” Java 泛型信息的
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2524134428655159/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    风象南
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-13T00:04:27.000Z" title="Thu Nov 13 2025 00:04:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    24
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">问题重现：泛型擦除的困扰</h2>
<p>在实际开发中，我们经常遇到这样的场景：收到一串用户列表的JSON数据，需要反序列化为<code>List&lt;UserDTO&gt;</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"张三"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"email"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"zhangsan@example.com"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"李四"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"email"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"lisi@example.com"</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">]</span>
</code></pre>
<p>如果直接这样写代码：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">objectMapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();
List&lt;UserDTO&gt; userList = objectMapper.readValue(jsonStr, List.class);

System.out.println(userList.get(<span class="hljs-number">0</span>).getName()); <span class="hljs-comment">// 运行时报错！</span>
</code></pre>
<p>运行时会抛出：<code>java.lang.ClassCastException: java.util.LinkedHashMap cannot be cast to UserDTO</code></p>
<p>根本原因在于Java的泛型擦除机制。</p>
<h3 data-id="heading-1">泛型擦除机制解析</h3>
<p>Java的泛型是编译期特性，运行时泛型信息会被擦除：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 编译期</span>
List&lt;UserDTO&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

<span class="hljs-comment">// 运行时（JVM看到的样子）</span>
<span class="hljs-type">List</span> <span class="hljs-variable">list</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>();  <span class="hljs-comment">// 泛型信息消失了</span>
</code></pre>
<p>由于运行时无法获取<code>List&lt;UserDTO&gt;</code>的类型信息，JSON库只能将其解析为<code>List&lt;Map&gt;</code>。</p>
<h2 data-id="heading-2">主流JSON库的解决方案</h2>
<h4 data-id="heading-3">Jackson：TypeReference方案</h4>
<p>Jackson通过<code>TypeReference</code>保留泛型信息：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">objectMapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();
List&lt;UserDTO&gt; userList = objectMapper.readValue(jsonStr,
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;List&lt;UserDTO&gt;&gt;() {});
</code></pre>
<p><strong>原理分析</strong>：
TypeReference利用匿名内部类的特性，在运行时通过反射获取父类的泛型参数：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TypeReference</span>&lt;T&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Type _type;

    <span class="hljs-keyword">protected</span> <span class="hljs-title function_">TypeReference</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Type</span> <span class="hljs-variable">superClass</span> <span class="hljs-operator">=</span> getClass().getGenericSuperclass();
        _type = ((ParameterizedType) superClass).getActualTypeArguments()[<span class="hljs-number">0</span>];
    }
}
</code></pre>
<h4 data-id="heading-4">Gson：TypeToken方案</h4>
<p>Gson提供了类似的<code>TypeToken</code>机制：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Gson</span> <span class="hljs-variable">gson</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Gson</span>();
<span class="hljs-type">Type</span> <span class="hljs-variable">userListType</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeToken</span>&lt;List&lt;UserDTO&gt;&gt;(){}.getType();
List&lt;UserDTO&gt; userList = gson.fromJson(jsonStr, userListType);
</code></pre>
<h4 data-id="heading-5">Fastjson2：TypeReference方案</h4>
<p>Fastjson2作为阿里开源的高性能JSON库，同样支持泛型处理：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Fastjson2的TypeReference使用</span>
<span class="hljs-type">String</span> <span class="hljs-variable">jsonStr</span> <span class="hljs-operator">=</span> <span class="hljs-string">"[{\"id\":1,\"name\":\"张三\"},{\"id\":2,\"name\":\"李四\"}]"</span>;
List&lt;UserDTO&gt; userList = JSON.parseObject(jsonStr,
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;List&lt;UserDTO&gt;&gt;() {});
</code></pre>
<h2 data-id="heading-6">复杂场景处理</h2>
<h4 data-id="heading-7">嵌套泛型</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// JSON: {"code": 200, "data": [{"id": 1, "name": "张三"}]}</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiResponse</span>&lt;T&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> code;
    <span class="hljs-keyword">private</span> T data;
}

<span class="hljs-comment">// Jackson</span>
ApiResponse&lt;List&lt;UserDTO&gt;&gt; response = objectMapper.readValue(
    jsonStr, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;ApiResponse&lt;List&lt;UserDTO&gt;&gt;&gt;() {});

<span class="hljs-comment">// Fastjson2</span>
ApiResponse&lt;List&lt;UserDTO&gt;&gt; response = JSON.parseObject(
    jsonStr, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;ApiResponse&lt;List&lt;UserDTO&gt;&gt;&gt;() {});
</code></pre>
<h4 data-id="heading-8">Map类型</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// JSON: {"1": {"name": "张三"}, "2": {"name": "李四"}}</span>

<span class="hljs-comment">// Jackson</span>
Map&lt;String, UserDTO&gt; userMap = objectMapper.readValue(
    jsonStr, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;Map&lt;String, UserDTO&gt;&gt;() {});

<span class="hljs-comment">// Fastjson2</span>
Map&lt;String, UserDTO&gt; userMap = JSON.parseObject(
    jsonStr, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;Map&lt;String, UserDTO&gt;&gt;() {});
</code></pre>
<h4 data-id="heading-9">在Spring框架中的应用</h4>
<h5 data-id="heading-10">Feign客户端</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@FeignClient(name = "user-service")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserClient</span> {
    <span class="hljs-meta">@GetMapping("/api/users")</span>
    ResponseEntity&lt;List&lt;UserDTO&gt;&gt; <span class="hljs-title function_">getUsers</span><span class="hljs-params">()</span>;
}
</code></pre>
<h5 data-id="heading-11">WebClient</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Spring WebFlux的WebClient</span>
List&lt;UserDTO&gt; users = webClient.get()
    .uri(<span class="hljs-string">"/api/users"</span>)
    .retrieve()
    .bodyToMono(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ParameterizedTypeReference</span>&lt;List&lt;UserDTO&gt;&gt;() {})
    .block();
</code></pre>
<h2 data-id="heading-12">工程实践建议</h2>
<h4 data-id="heading-13">1. 预定义常用类型</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TypeReferences</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> TypeReference&lt;List&lt;UserDTO&gt;&gt; USER_LIST =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;List&lt;UserDTO&gt;&gt;() {};

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> TypeReference&lt;Map&lt;String, UserDTO&gt;&gt; USER_MAP =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;Map&lt;String, UserDTO&gt;&gt;() {};

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> TypeReference&lt;ApiResponse&lt;List&lt;UserDTO&gt;&gt;&gt; API_USER_LIST =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;ApiResponse&lt;List&lt;UserDTO&gt;&gt;&gt;() {};
}
</code></pre>
<h4 data-id="heading-14">2. 性能优化策略</h4>
<p>在高并发场景下，考虑缓存TypeReference实例：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TypeReferenceCache</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;String, TypeReference&lt;?&gt;&gt; CACHE =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; TypeReference&lt;T&gt; <span class="hljs-title function_">get</span><span class="hljs-params">(String key,
            Supplier&lt;TypeReference&lt;T&gt;&gt; supplier)</span> {
        <span class="hljs-keyword">return</span> (TypeReference&lt;T&gt;) CACHE.computeIfAbsent(key, k -&gt; supplier.get());
    }
}
</code></pre>
<h2 data-id="heading-15">常见误区</h2>
<h4 data-id="heading-16">误区1：数组类型误用</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ❌ 错误：数组类型不需要TypeReference</span>
UserDTO[] users = objectMapper.readValue(jsonStr, UserDTO[].class);

<span class="hljs-comment">// ✅ 正确：数组类型直接传class即可</span>
</code></pre>
<h4 data-id="heading-17">误区2：库混淆</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Jackson的TypeReference</span>
<span class="hljs-keyword">import</span> com.fasterxml.jackson.core.type.TypeReference;

<span class="hljs-comment">// Spring的ParameterizedTypeReference</span>
<span class="hljs-keyword">import</span> org.springframework.core.ParameterizedTypeReference;

<span class="hljs-comment">// Fastjson2的TypeReference</span>
<span class="hljs-keyword">import</span> com.alibaba.fastjson2.TypeReference;
</code></pre>
<h4 data-id="heading-18">误区3：异常处理不当</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ❌ 错误：不处理异常</span>
<span class="hljs-keyword">try</span> {
    List&lt;UserDTO&gt; users = objectMapper.readValue(jsonStr,
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;List&lt;UserDTO&gt;&gt;() {});
} <span class="hljs-keyword">catch</span> (IOException e) {
    <span class="hljs-comment">// 应该记录日志并采取相应措施</span>
    log.error(<span class="hljs-string">"JSON反序列化失败"</span>, e);
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"数据格式错误"</span>);
}
</code></pre>
<h2 data-id="heading-19">技术选型建议</h2>





























<table><thead><tr><th>JSON库</th><th>性能</th><th>特性</th><th>适用场景</th></tr></thead><tbody><tr><td>Jackson</td><td>中等</td><td>功能全面，生态成熟</td><td>Spring全家桶，企业级应用</td></tr><tr><td>Gson</td><td>较低</td><td>API简洁，Android友好</td><td>移动端，轻量级应用</td></tr><tr><td>Fastjson2</td><td>高</td><td>性能优异，功能丰富</td><td>高并发，性能敏感场景</td></tr></tbody></table>
<p><strong>选择建议</strong>：</p>
<ul>
<li>Spring项目：优先Jackson，生态兼容性好</li>
<li>性能要求高：选择Fastjson2</li>
<li>Android开发：考虑Gson</li>
</ul>
<h2 data-id="heading-20">总结</h2>
<p>泛型擦除是Java语言的特性，但通过各JSON库提供的TypeReference/TypeToken机制，我们可以优雅地解决这个问题。掌握不同JSON库的泛型处理方法，能够让我们在实际项目中根据需求做出最合适的技术选型。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Swift 内存管理：吃透 ARC 、weak、unowned]]></title>    <link>https://juejin.cn/post/7571693273729007652</link>    <guid>https://juejin.cn/post/7571693273729007652</guid>    <pubDate>2025-11-13T01:28:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571693273729007652" data-draft-id="7554198745670303795" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Swift 内存管理：吃透 ARC 、weak、unowned"/> <meta itemprop="keywords" content="Swift,iOS"/> <meta itemprop="datePublished" content="2025-11-13T01:28:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Swift 内存管理：吃透 ARC 、weak、unowned
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-13T01:28:32.000Z" title="Thu Nov 13 2025 01:28:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>ARC 让 90% 的 iOS 开发者“无痛”管理内存，但剩下的 10% 却能把 App 拖进 OOM 深渊。</p>
<h2 data-id="heading-1">ARC 原理：一张图先记住</h2>
<pre><code class="hljs language-swift" lang="swift">实例创建 <span class="hljs-operator">➜</span> 强引用 <span class="hljs-operator">+</span><span class="hljs-number">1</span>
有强引用指针指向 <span class="hljs-operator">➜</span> 强引用 <span class="hljs-operator">+</span><span class="hljs-number">1</span>
引用离开作用域或被置 <span class="hljs-literal">nil</span> <span class="hljs-operator">➜</span> 强引用 <span class="hljs-operator">-</span><span class="hljs-number">1</span>
计数 <span class="hljs-operator">=</span> <span class="hljs-number">0</span> <span class="hljs-operator">➜</span> 执行 <span class="hljs-keyword">deinit</span> <span class="hljs-operator">➜</span> 内存归还
</code></pre>
<p>结构体 / 枚举是值类型，不走 ARC；只有类（class）才参与计数。</p>
<h2 data-id="heading-2">引用计数示例代码</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-keyword">let</span> name: <span class="hljs-type">String</span>
    <span class="hljs-keyword">init</span>(<span class="hljs-params">name</span>: <span class="hljs-type">String</span>) {
        <span class="hljs-keyword">self</span>.name <span class="hljs-operator">=</span> name
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"<span class="hljs-subst">\(name)</span> 正在初始化，分配内存"</span>)
    }
    <span class="hljs-keyword">deinit</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"<span class="hljs-subst">\(name)</span> 被析构，内存即将释放"</span>)
    }
}

<span class="hljs-comment">// 三个可选类型变量，默认 nil</span>
<span class="hljs-keyword">var</span> ref1: <span class="hljs-type">Person</span>?
<span class="hljs-keyword">var</span> ref2: <span class="hljs-type">Person</span>?
<span class="hljs-keyword">var</span> ref3: <span class="hljs-type">Person</span>?

<span class="hljs-comment">// 1. 创建对象 → 强引用计数 = 1</span>
ref1 <span class="hljs-operator">=</span> <span class="hljs-type">Person</span>(name: <span class="hljs-string">"John Appleseed"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-type">CFGetRetainCount</span>(ref1))

<span class="hljs-comment">// 2. 再挂两条强引用 → 计数 = 3</span>
ref2 <span class="hljs-operator">=</span> ref1
<span class="hljs-built_in">print</span>(<span class="hljs-type">CFGetRetainCount</span>(ref2))
ref3 <span class="hljs-operator">=</span> ref1
<span class="hljs-built_in">print</span>(<span class="hljs-type">CFGetRetainCount</span>(ref3))

<span class="hljs-comment">// 3. 断开两条 → 计数 = 1，对象仍在</span>
ref1 <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>
<span class="hljs-built_in">print</span>(<span class="hljs-type">CFGetRetainCount</span>(ref2))
ref2 <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>
<span class="hljs-built_in">print</span>(<span class="hljs-type">CFGetRetainCount</span>(ref3))

<span class="hljs-comment">// 4. 最后一条断开 → 计数 = 0，deinit 执行</span>
ref3 <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>          <span class="hljs-comment">// 控制台打印：John Appleseed 被析构</span>
<span class="hljs-built_in">print</span>(<span class="hljs-type">CFGetRetainCount</span>(ref3))
<span class="hljs-comment">/*
John Appleseed 正在初始化，分配内存
2
3
4
3
2
John Appleseed 被析构，内存即将释放
*/</span>
</code></pre>
<h2 data-id="heading-3">强引用循环（Retain Cycle）</h2>
<p>循环出现的条件：</p>
<p>两个类实例互相强引用，外部指针断开后，内部仍“手拉手”，计数永不为 0 → 内存泄漏。</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-keyword">let</span> name: <span class="hljs-type">String</span>
    <span class="hljs-keyword">init</span>(<span class="hljs-params">name</span>: <span class="hljs-type">String</span>) { <span class="hljs-keyword">self</span>.name <span class="hljs-operator">=</span> name; <span class="hljs-built_in">print</span>(<span class="hljs-string">"<span class="hljs-subst">\(name)</span> 初始化"</span>) }
    <span class="hljs-keyword">deinit</span> { <span class="hljs-built_in">print</span>(<span class="hljs-string">"<span class="hljs-subst">\(name)</span> 析构"</span>) }
    
    <span class="hljs-keyword">var</span> apartment: <span class="hljs-type">Apartment</span>?   <span class="hljs-comment">// 人可能没房</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Apartment</span> {
    <span class="hljs-keyword">let</span> unit: <span class="hljs-type">String</span>
    <span class="hljs-keyword">init</span>(<span class="hljs-params">unit</span>: <span class="hljs-type">String</span>) { <span class="hljs-keyword">self</span>.unit <span class="hljs-operator">=</span> unit; <span class="hljs-built_in">print</span>(<span class="hljs-string">"公寓 <span class="hljs-subst">\(unit)</span> 初始化"</span>) }
    <span class="hljs-keyword">deinit</span> { <span class="hljs-built_in">print</span>(<span class="hljs-string">"公寓 <span class="hljs-subst">\(unit)</span> 析构"</span>) }
    
    <span class="hljs-keyword">var</span> tenant: <span class="hljs-type">Person</span>?         <span class="hljs-comment">// 房可能没人</span>
}

<span class="hljs-keyword">var</span> john: <span class="hljs-type">Person</span>? <span class="hljs-operator">=</span> <span class="hljs-type">Person</span>(name: <span class="hljs-string">"张三"</span>)
<span class="hljs-keyword">var</span> unit4A: <span class="hljs-type">Apartment</span>? <span class="hljs-operator">=</span> <span class="hljs-type">Apartment</span>(unit: <span class="hljs-string">"4A"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"初始化后的引用计数 john:<span class="hljs-subst">\(CFGetRetainCount(john))</span> unit4A:<span class="hljs-subst">\(CFGetRetainCount(unit4A))</span>"</span>)
<span class="hljs-comment">// 互相挂强引用 → 形成循环</span>
john<span class="hljs-operator">!</span>.apartment <span class="hljs-operator">=</span> unit4A
unit4A<span class="hljs-operator">!</span>.tenant   <span class="hljs-operator">=</span> john
<span class="hljs-built_in">print</span>(<span class="hljs-string">"循环引用后的引用计数 john:<span class="hljs-subst">\(CFGetRetainCount(john))</span> unit4A:<span class="hljs-subst">\(CFGetRetainCount(unit4A))</span>"</span>)

<span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> weakUnit4A <span class="hljs-operator">=</span> unit4A
<span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> weakJohn <span class="hljs-operator">=</span> john
<span class="hljs-comment">// 外部指针断开，但内部仍互相强引用 → 泄漏</span>
john   <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>   <span class="hljs-comment">// 无析构日志</span>
unit4A <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>   <span class="hljs-comment">// 无析构日志</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"指针断开后的引用计数 john:<span class="hljs-subst">\(CFGetRetainCount(weakJohn))</span> unit4A:<span class="hljs-subst">\(CFGetRetainCount(weakUnit4A))</span>"</span>)
<span class="hljs-comment">/**
张三 初始化
公寓 4A 初始化
初始化后的引用计数 john:2 unit4A:2
循环引用后的引用计数 john:3 unit4A:3
指针断开后的引用计数 john:2 unit4A:2
*/</span>
</code></pre>
<h2 data-id="heading-4">破解循环的两把钥匙</h2>


























<table><thead><tr><th>引用类型</th><th>是否强持有</th><th>可否为 nil</th><th>适用场景</th><th>关键字</th></tr></thead><tbody><tr><td>weak</td><td>否</td><td>可以（自动置 nil）</td><td>对方寿命 ≤ 自己</td><td><code>weak</code></td></tr><tr><td>unowned</td><td>否</td><td>不可为 nil（不会自动置 nil，需程序员保证）</td><td>对方寿命 ≥ 自己</td><td><code>unowned</code></td></tr></tbody></table>
<ol>
<li>weak 版 Apartment</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Apartment</span> {
    <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> tenant: <span class="hljs-type">Person</span>?   <span class="hljs-comment">// 房不强持有住客</span>
}
</code></pre>
<p>执行结果：</p>
<p>外部 <code>john = nil</code> → Person 析构 → Apartment.tenant 自动变 nil → 再 <code>unit4A = nil</code> → Apartment 析构。</p>
<p>日志正确打印两行析构。</p>
<ol start="2">
<li>unowned 版 Customer &amp; CreditCard</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Customer</span> {
    <span class="hljs-keyword">var</span> card: <span class="hljs-type">CreditCard</span>?
    <span class="hljs-keyword">deinit</span> { <span class="hljs-built_in">print</span>(<span class="hljs-string">"Customer 析构"</span>) }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CreditCard</span> {
    <span class="hljs-keyword">unowned</span> <span class="hljs-keyword">let</span> customer: <span class="hljs-type">Customer</span>   <span class="hljs-comment">// 卡一定属于某客户，客户先死卡必死</span>
    <span class="hljs-keyword">init</span>(<span class="hljs-params">customer</span>: <span class="hljs-type">Customer</span>) { <span class="hljs-keyword">self</span>.customer <span class="hljs-operator">=</span> customer }
    <span class="hljs-keyword">deinit</span> { <span class="hljs-built_in">print</span>(<span class="hljs-string">"Card 析构"</span>) }
}

<span class="hljs-keyword">var</span> john: <span class="hljs-type">Customer</span>? <span class="hljs-operator">=</span> <span class="hljs-type">Customer</span>()
john<span class="hljs-operator">!</span>.card <span class="hljs-operator">=</span> <span class="hljs-type">CreditCard</span>(customer: john<span class="hljs-operator">!</span>)

john <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>   <span class="hljs-comment">// Customer 先析构 → Card 跟着析构，无循环</span>
</code></pre>
<h2 data-id="heading-5">闭包也能制造循环</h2>
<ol>
<li>
<p>循环原因</p>
<p>类 ➜ 强引用闭包属性；闭包体内又捕获 self → 互相强引用。</p>
</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HTMLElement</span> {
    <span class="hljs-keyword">let</span> name: <span class="hljs-type">String</span>
    <span class="hljs-keyword">var</span> text: <span class="hljs-type">String</span>?
    
    <span class="hljs-comment">// 1. 懒加载闭包属性，默认实现渲染 HTML</span>
    <span class="hljs-keyword">lazy</span> <span class="hljs-keyword">var</span> asHTML: () -&gt; <span class="hljs-type">String</span> <span class="hljs-operator">=</span> {
        <span class="hljs-comment">// 2. 这里默认捕获 self 是强引用！</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> text <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.text {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"&lt;<span class="hljs-subst">\(<span class="hljs-keyword">self</span>.name)</span>&gt;<span class="hljs-subst">\(text)</span>&lt;/<span class="hljs-subst">\(<span class="hljs-keyword">self</span>.name)</span>&gt;"</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"&lt;<span class="hljs-subst">\(<span class="hljs-keyword">self</span>.name)</span> /&gt;"</span>
        }
    }
    
    <span class="hljs-keyword">init</span>(<span class="hljs-params">name</span>: <span class="hljs-type">String</span>, <span class="hljs-params">text</span>: <span class="hljs-type">String</span>? <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>) {
        <span class="hljs-keyword">self</span>.name <span class="hljs-operator">=</span> name; <span class="hljs-keyword">self</span>.text <span class="hljs-operator">=</span> text
    }
    <span class="hljs-keyword">deinit</span> { <span class="hljs-built_in">print</span>(<span class="hljs-string">"<span class="hljs-subst">\(name)</span> 元素析构"</span>) }
}

<span class="hljs-keyword">var</span> p: <span class="hljs-type">HTMLElement</span>? <span class="hljs-operator">=</span> <span class="hljs-type">HTMLElement</span>(name: <span class="hljs-string">"p"</span>, text: <span class="hljs-string">"hello"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-type">CFGetRetainCount</span>(p))
<span class="hljs-built_in">print</span>(p<span class="hljs-operator">!</span>.asHTML())   <span class="hljs-comment">// &lt;p&gt;hello&lt;/p&gt;</span>
<span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> weakP <span class="hljs-operator">=</span> p
p <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>              <span class="hljs-comment">// 无析构日志 → 循环泄漏</span>
<span class="hljs-built_in">print</span>(<span class="hljs-type">CFGetRetainCount</span>(weakP))
<span class="hljs-comment">/**
 2
 &lt;p&gt;hello&lt;/p&gt;
 2
 */</span>
</code></pre>
<ol start="2">
<li>捕获列表（Capture List）破解</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">lazy</span> <span class="hljs-keyword">var</span> asHTML: () -&gt; <span class="hljs-type">String</span> <span class="hljs-operator">=</span> { [<span class="hljs-keyword">unowned</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span>
    <span class="hljs-comment">// 现在 self 是 unowned 引用，不会强持有</span>
    <span class="hljs-operator">...</span>
}
</code></pre>
<p>再把 <code>p = nil</code> → 立即打印“p 元素析构”。</p>
<h2 data-id="heading-6">一张表总结所有场景</h2>






























<table><thead><tr><th>场景</th><th>循环双方</th><th>推荐方案</th></tr></thead><tbody><tr><td>双向可选</td><td>A? ↔ B?</td><td>一端 weak</td></tr><tr><td>一端非可选</td><td>A ↔ B?</td><td>非可选端用 unowned</td></tr><tr><td>两端非可选</td><td>A ↔ B</td><td>一端 unowned + 一端隐式解包可选（如 Country-City）</td></tr><tr><td>closure 捕获 self</td><td>self ↔ closure</td><td>捕获列表 [weak self] 或 [unowned self]</td></tr></tbody></table>
<h2 data-id="heading-7">真实业务扩展</h2>
<ol>
<li>
<p>MVVM 绑定</p>
<p>ViewModel 持有网络回调闭包，闭包内刷新 UI 常用 <code>[weak self]</code> 避免 VC 被钉死。</p>
</li>
<li>
<p>委托（Delegate）模式</p>
<p>官方 UITableViewDelegate/UITableViewDataSource 都是 <code>weak</code> 声明，防止 VC 强引用 self。</p>
</li>
<li>
<p>RxSwift / Combine</p>
<p>订阅代码块几乎都要 <code>weak</code>/<code>unowned</code>，否则信号流无限期持有 VC。</p>
</li>
<li>
<p>单例持有块</p>
<p>单例寿命 = App 寿命，若强引用 VC 块，等于内存泄漏；务必 <code>[weak object]</code>。</p>
</li>
</ol>
<h2 data-id="heading-8">踩坑清单 &amp; 小结</h2>
<ul>
<li>只要出现“互相引用”，先画箭头图，确认谁该早死，再决定 weak/unowned。</li>
<li>weak 一定 optional，unowned 可 optional 也可非 optional，但千万别在 unowned 对象死后访问，会直接崩溃（野指针）。</li>
<li>闭包里的 self 90% 用 <code>[weak self]</code> 最保险；确定同生共死才用 <code>[unowned self]</code>。</li>
</ul>
<h2 data-id="heading-9">weak 引用什么时候变成 nil？</h2>
<p>官方文档没说的三句话</p>
<ol>
<li>weak 变量本身不会减 RC，它只是“围观群众”。</li>
<li>对象销毁时，runtime 会批量把指向它的所有 weak 指针置 nil（atomic 写）。</li>
<li>该操作发生在 deinit 刚被调用之后、内存尚未归还之际，因此 deinit 里仍能拿到 self，但 weak 已空。</li>
</ol>
<h3 data-id="heading-10">一张时间轴先记住</h3>
<pre><code class="hljs language-scss" lang="scss">外部最后一个 <span class="hljs-selector-tag">strong</span> 置 nil
    ↓
<span class="hljs-built_in">swift_release</span>() 发现 RC == <span class="hljs-number">0</span>
    ↓
调用 <span class="hljs-built_in">_swift_release_dealloc</span>()
    ↓
<span class="hljs-built_in">swift_deallocPartialClassInstance</span>()
    ├─ <span class="hljs-number">1</span>. 调用 deinit (self 仍完整)
    ├─ <span class="hljs-number">2</span>. 在 weak 表查找所有弱引用 → 原子置 nil
    └─ <span class="hljs-number">3</span>. 销毁实例内存、归还堆
</code></pre>
<h3 data-id="heading-11">源码级导读（Swift 5.9 主干）</h3>
<ol>
<li>入口：stdlib/public/runtime/HeapObject.cpp</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-built_in">void</span> <span class="hljs-attr">swift</span>::<span class="hljs-title function_">_swift_release_</span>(<span class="hljs-params">HeapObject *<span class="hljs-built_in">object</span></span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isValidPointerForNativeRelease</span>(<span class="hljs-built_in">object</span>))
    <span class="hljs-built_in">object</span>-&gt;refCounts.<span class="hljs-title function_">decrementAndMaybeDeinit</span>(<span class="hljs-variable constant_">RC_ONE</span>);
}
</code></pre>
<ol start="2">
<li>引用计数减到 0 → 立即 dealloc</li>
</ol>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">void</span> <span class="hljs-title class_">RefCounts</span>::<span class="hljs-title function_ invoke__">decrementAndMaybeDeinit</span>(swift::<span class="hljs-variable constant_">HeapObject</span> *<span class="hljs-keyword">object</span>) {
  <span class="hljs-keyword">if</span> (oldRC == RC_ONE) {
    <span class="hljs-title function_ invoke__">swift_deallocPartialClassInstance</span>(<span class="hljs-keyword">object</span>, dtor, metatype);
  }
}
</code></pre>
<ol start="3">
<li>dealloc 核心：</li>
</ol>
<pre><code class="hljs language-scss" lang="scss">static void <span class="hljs-built_in">swift_deallocPartialClassInstance</span>(HeapObject *object, ...) {
  <span class="hljs-comment">// 1. 调用 C++ destructor = 你的 deinit</span>
  <span class="hljs-selector-tag">object</span>-&gt;~<span class="hljs-built_in">HeapObject</span>();

  <span class="hljs-comment">// 2. 处理 weak 表</span>
  <span class="hljs-built_in">weakClearOldTable</span>(object);

  <span class="hljs-comment">// 3. 释放内存</span>
  <span class="hljs-built_in">free</span>(object);
}
</code></pre>
<ol start="4">
<li>weakClearOldTable 实现（swift/Runtime/WeakRef.cpp）</li>
</ol>
<pre><code class="hljs language-scss" lang="scss">void <span class="hljs-built_in">weakClearOldTable</span>(HeapObject *object) {
  auto &amp;<span class="hljs-selector-tag">table</span> = <span class="hljs-built_in">SideTables</span>()<span class="hljs-selector-attr">[object]</span>;
  mutex_lock <span class="hljs-built_in">lock</span>(table.mutex);
  for (auto *entry : table.weak_entries) {
    *entry-&gt;weakAddress = nil;   <span class="hljs-comment">// 原子写</span>
  }
  <span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.weak_entries</span><span class="hljs-selector-class">.clear</span>();
}
</code></pre>
<p>结论：所有 weak 指针在同一临界区被批量置 nil，不保证“立刻”但保证“早于 dealloc 完成”。</p>
<h2 data-id="heading-12">动手验证 —— 用代码看 timeline</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Foo</span> {
    <span class="hljs-keyword">deinit</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"deinit begin —— 此时 weak 已 nil"</span>)
        <span class="hljs-comment">// 断点 1：观察外部 weak 变量</span>
        <span class="hljs-type">Thread</span>.sleep(forTimeInterval: <span class="hljs-number">0.1</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"deinit end   —— 内存尚未归还"</span>)
    }
}

<span class="hljs-keyword">var</span> strong: <span class="hljs-type">Foo</span>? <span class="hljs-operator">=</span> <span class="hljs-type">Foo</span>()
<span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> weakRef <span class="hljs-operator">=</span> strong

<span class="hljs-type">DispatchQueue</span>.global().async {
    strong <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>          <span class="hljs-comment">// 后台线程释放</span>
}
<span class="hljs-keyword">while</span> weakRef <span class="hljs-operator">!=</span> <span class="hljs-literal">nil</span> {
    <span class="hljs-comment">// 空转等待 weak 被置空</span>
}
<span class="hljs-built_in">print</span>(<span class="hljs-string">"weak 已空，deinit 肯定跑过了"</span>)
</code></pre>
<p>控制台必打顺序：</p>
<pre><code class="hljs language-erlang" lang="erlang">deinit <span class="hljs-keyword">begin</span> ...
deinit <span class="hljs-keyword">end</span>   ...
weak 已空 ...
</code></pre>
<h2 data-id="heading-13">工程级注意点</h2>
<ol>
<li>
<p>deinit 里不要指望 weak 属性</p>
<p>它们已被清 nil，但 self 的存储属性仍可访问。</p>
</li>
<li>
<p>多线程安全</p>
<p>weak 置 nil 过程用 mutex 保护，读 weak 变量是原子；但解包再使用不是原子，需自己加锁或保证单线程。</p>
</li>
<li>
<p>性能误区</p>
<p>有人担心“weak 太多影响释放速度”。实测 10 M 个 weak 指针批量置 nil 耗时 &lt; 1 ms，除非极端场景，否则可忽略。</p>
</li>
</ol>
<h2 data-id="heading-14">与 Objective-C 的差异</h2>

























<table><thead><tr><th/><th>Swift</th><th>Objective-C</th></tr></thead><tbody><tr><td>置 nil 时机</td><td>deinit 之后、free 之前</td><td>相同（objc_clear_deallocating）</td></tr><tr><td>数据结构</td><td>SideTable + 位图哈希</td><td>SideTable（兼容 Swift）</td></tr><tr><td>空消息</td><td>向 nil 发消息无 crash</td><td>同左</td></tr></tbody></table>
<h2 data-id="heading-15">unowned 真的快但会炸？—— Swift 悬垂引用崩溃全记录与防炸方案</h2>
<ol>
<li>weak 是“保险丝”，unowned 是“裸电线”；性能高 8%，崩溃只需一次。</li>
<li>只要对象生命周期存在“提前释放”可能，就别用 unowned。</li>
<li>线上 100% 安全方案：调试阶段用 weak + assert，发布阶段用 unowned + 野指针防护钩子。</li>
</ol>
<h3 data-id="heading-16">崩溃现场还原</h3>
<p>以下代码 100% 必崩：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Teacher</span> {
    <span class="hljs-keyword">unowned</span> <span class="hljs-keyword">var</span> student: <span class="hljs-type">Student</span>
    <span class="hljs-keyword">init</span>(<span class="hljs-params">student</span>: <span class="hljs-type">Student</span>) { <span class="hljs-keyword">self</span>.student <span class="hljs-operator">=</span> student }
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">printName</span>() { <span class="hljs-built_in">print</span>(student.name) }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-keyword">let</span> name <span class="hljs-operator">=</span> <span class="hljs-string">"Tom"</span>
    <span class="hljs-keyword">deinit</span> { <span class="hljs-built_in">print</span>(<span class="hljs-string">"Student 已死"</span>) }
}

<span class="hljs-keyword">var</span> tom: <span class="hljs-type">Student</span>? <span class="hljs-operator">=</span> <span class="hljs-type">Student</span>()
<span class="hljs-keyword">let</span> teacher <span class="hljs-operator">=</span> <span class="hljs-type">Teacher</span>(student: tom<span class="hljs-operator">!</span>)
tom <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>          <span class="hljs-comment">// Student 释放</span>
teacher.printName() <span class="hljs-comment">// ❌ 野指针 → EXC_BAD_ACCESS</span>
</code></pre>
<p>控制台无 deinit 日志就崩溃，因为访问的是已回收内存。</p>
<h3 data-id="heading-17">底层发生了什么</h3>
<ol>
<li>Swift 对 unowned 采用 “非空断言 + 裸指针” 策略：
<ul>
<li>对象存在时：指针直接解包，无运行时检查。</li>
<li>对象释放时：runtime 把原内存标记为 “dead-unowned”，但不会帮你置 nil。</li>
</ul>
</li>
<li>再次访问 → 读到 “dead” 标记或无效地址 → 立即 trap（<code>swift_abortRetainUnowned</code>）。</li>
<li>与 Objective-C 的 <code>__unsafe_unretained</code> 完全一致，只是 Swift 在 -O0 时还会插桩报错，-O 后连报错都省了，直接崩。</li>
</ol>
<h3 data-id="heading-18">什么时候“敢”用 unowned</h3>
<p>必须同时满足：</p>
<ul>
<li>持有方与被持有方同生共死 → 生命周期完全重叠。</li>
<li>没有提前释放的可能，包括所有异常路径、early return。</li>
</ul>
<p>典型合法场景：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Country</span> {
    <span class="hljs-keyword">let</span> name: <span class="hljs-type">String</span>
    <span class="hljs-keyword">init</span>(<span class="hljs-params">name</span>: <span class="hljs-type">String</span>, <span class="hljs-params">capitalName</span>: <span class="hljs-type">String</span>) {
        <span class="hljs-keyword">self</span>.name <span class="hljs-operator">=</span> name
        <span class="hljs-comment">// Country 初始化完，self 已可用</span>
        <span class="hljs-keyword">self</span>.capitalCity <span class="hljs-operator">=</span> <span class="hljs-type">City</span>(name: capitalName, country: <span class="hljs-keyword">self</span>)
    }
    <span class="hljs-keyword">var</span> capitalCity: <span class="hljs-type">City</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">City</span> {
    <span class="hljs-keyword">unowned</span> <span class="hljs-keyword">let</span> country: <span class="hljs-type">Country</span>   <span class="hljs-comment">// 城市一定属于国家</span>
    <span class="hljs-keyword">init</span>(<span class="hljs-params">name</span>: <span class="hljs-type">String</span>, <span class="hljs-params">country</span>: <span class="hljs-type">Country</span>) {
        <span class="hljs-keyword">self</span>.country <span class="hljs-operator">=</span> country
    }
}
</code></pre>
<p>Country 实例只有走 <code>deinit</code> 才会销毁，而 City 在此之前已销毁，无悬垂可能。</p>
<h3 data-id="heading-19">发布阶段：野指针防护的三层滤网</h3>





























<table><thead><tr><th>层级</th><th>方案</th><th>代价</th><th>覆盖率</th></tr></thead><tbody><tr><td>编译期</td><td>把 80% 不确定的 unowned 改 weak</td><td>0 成本</td><td>60%</td></tr><tr><td>运行时</td><td>hook <code>swift_abortRetainUnowned</code></td><td>崩溃变日志，无损性能</td><td>95%</td></tr><tr><td>业务层</td><td>关键链路透传 @unowned 安全区</td><td>代码侵入</td><td>100%</td></tr></tbody></table>
<ol>
<li>hook 实现（Swift 5.9，arm64）</li>
</ol>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 私有符号，需 dlsym</span>
<span class="hljs-meta">#import <span class="hljs-string">"execinfo.h"</span></span>
<span class="hljs-meta">#import <span class="hljs-string">"malloc/_malloc.h"</span></span>
<span class="hljs-meta">#import <span class="hljs-string">"dlfcn.h"</span></span>
<span class="hljs-meta">#import <span class="hljs-string">"fishhook.h"</span></span>

<span class="hljs-comment">// 私有符号，需 dlsym</span>
<span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">void</span> <span class="hljs-params">(*UnownedAbortHook)</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></span>;
<span class="hljs-type">static</span> UnownedAbortHook orig = <span class="hljs-literal">NULL</span>;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">myUnownedAbort</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> </span>{
    <span class="hljs-comment">// 1. 堆栈快照</span>
    <span class="hljs-type">void</span>* callstack[<span class="hljs-number">128</span>];
    <span class="hljs-type">int</span> frames = <span class="hljs-built_in">backtrace</span>(callstack, <span class="hljs-number">128</span>);
    <span class="hljs-type">char</span>** strs = <span class="hljs-built_in">backtrace_symbols</span>(callstack, frames);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"==== unowned 悬垂访问"</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; frames; ++i) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%s"</span>, strs[i]);
    }
    <span class="hljs-built_in">free</span>(strs);
    <span class="hljs-comment">// 2. 不让进程死，直接 return</span>
    <span class="hljs-comment">//    ⚠️ 仅适用于 QA/灰度，线上可做熔断</span>
}

<span class="hljs-comment">// 启动时注册</span>
__attribute__((constructor))
<span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">installHook</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> </span>{
    <span class="hljs-type">void</span> *handle = <span class="hljs-built_in">dlopen</span>(<span class="hljs-literal">NULL</span>, RTLD_GLOBAL);
    orig = (UnownedAbortHook)<span class="hljs-built_in">dlsym</span>(handle, <span class="hljs-string">"swift_abortRetainUnowned"</span>);
    <span class="hljs-keyword">if</span> (orig) {
        <span class="hljs-built_in">rebind_symbols</span>((<span class="hljs-keyword">struct</span> rebinding[<span class="hljs-number">1</span>]){{<span class="hljs-string">"swift_abortRetainUnowned"</span>, myUnownedAbort, (<span class="hljs-type">void</span>*)&amp;orig}}, <span class="hljs-number">1</span>);
    }
}
</code></pre>
<p>效果：曾经必崩的野指针，现在只会上传日志，用户无感知。</p>
<ol start="2">
<li>安全区宏（可选）</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WeakBox</span>&lt;<span class="hljs-title class_">T</span>: <span class="hljs-title class_">AnyObject</span>&gt; {
    <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> value: <span class="hljs-type">T</span>?
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">init</span>(<span class="hljs-params">value</span>: <span class="hljs-type">T</span>?) {
        <span class="hljs-keyword">self</span>.value <span class="hljs-operator">=</span> value
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UnownedBox</span>&lt;<span class="hljs-title class_">T</span>: <span class="hljs-title class_">AnyObject</span>&gt; {
    <span class="hljs-keyword">unowned</span> <span class="hljs-keyword">var</span> value: <span class="hljs-type">T</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">init</span>(<span class="hljs-params">value</span>: <span class="hljs-type">T</span>) {
        <span class="hljs-keyword">self</span>.value <span class="hljs-operator">=</span> value
    }
}
<span class="hljs-keyword">#if</span> <span class="hljs-type">DEBUG</span>
    <span class="hljs-keyword">typealias</span> <span class="hljs-type">SafeUnowned</span>&lt;<span class="hljs-type">T</span>: <span class="hljs-type">AnyObject</span>&gt; <span class="hljs-operator">=</span> <span class="hljs-type">WeakBox</span>&lt;<span class="hljs-type">T</span>&gt;   <span class="hljs-comment">// 实际用 weak 包装</span>
<span class="hljs-keyword">#else</span>
    <span class="hljs-keyword">typealias</span> <span class="hljs-type">SafeUnowned</span>&lt;<span class="hljs-type">T</span>: <span class="hljs-type">AnyObject</span>&gt; <span class="hljs-operator">=</span> <span class="hljs-type">UnownedBox</span>&lt;<span class="hljs-type">T</span>&gt; <span class="hljs-comment">// 发布用 unowned</span>
<span class="hljs-keyword">#endif</span>
</code></pre>
<p>通过编译宏一键切换，调试抓虫 + 发布性能两不误。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 MediaPipe 在 Flutter web 中识别姿势]]></title>    <link>https://juejin.cn/post/7571725550710226971</link>    <guid>https://juejin.cn/post/7571725550710226971</guid>    <pubDate>2025-11-13T01:03:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571725550710226971" data-draft-id="7570268773333631003" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 MediaPipe 在 Flutter web 中识别姿势"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-13T01:03:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JarvanMo"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565845704"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 MediaPipe 在 Flutter web 中识别姿势
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565845704/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JarvanMo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-13T01:03:16.000Z" title="Thu Nov 13 2025 01:03:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读21分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>咱们就来像这样识别视频里的姿势吧！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e608c4b9f82e40af90d791828187de6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763600595&amp;x-signature=c5x0vWc2ZFbD1SLJwCr3jhKjjw8%3D" alt="image.png" loading="lazy"/></p>
<p>有一个名为 <a href="https://link.juejin.cn?target=https%3A%2F%2Fai.google.dev%2Fedge%2Fmediapipe%2Fsolutions%2Fguide" target="_blank" title="https://ai.google.dev/edge/mediapipe/solutions/guide" ref="nofollow noopener noreferrer">MediaPipe</a>的库，它可以在图像、文本和声音上完成许多识别和检测任务。其中包括一个用于在图像上<strong>识别姿势</strong>的模型。</p>
<p>你可以点击这里，试试它的官方演示： <a href="https://link.juejin.cn?target=https%3A%2F%2Fmediapipe-studio.webapps.google.com%2Fdemo%2Fpose_landmarker" target="_blank" title="https://mediapipe-studio.webapps.google.com/demo/pose_landmarker" ref="nofollow noopener noreferrer">mediapipe-studio.webapps.google.com/demo/pose_l…</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70063d1acd9b44f393718b4dbde931f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763600595&amp;x-signature=iN4pZWPO%2BqIZ5HSV%2ByvFEPyoNQ8%3D" alt="image.png" loading="lazy"/></p>
<p>它还有一个 <strong>CodePen 代码片段</strong>，方便你用 JavaScript 快速进行实践操作（或“上手”）： <a href="https://link.juejin.cn?target=https%3A%2F%2Fcodepen.io%2Fmediapipe-preview%2Fpen%2FabRLMxN" target="_blank" title="https://codepen.io/mediapipe-preview/pen/abRLMxN" ref="nofollow noopener noreferrer">codepen.io/mediapipe-p…</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4012e8799f24102b27156963b66fd11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763600595&amp;x-signature=rsSOlRtcqX48Pqe1MH4fA6bM6dg%3D" alt="image.png" loading="lazy"/></p>
<p>然而，该模型<strong>目前仅支持在 Android、iOS、Python 和 JavaScript 环境下运行，并不能直接在 Flutter 中使用</strong>。</p>
<p>有人曾创建了一个名为 <a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fflutter_mediapipe" target="_blank" title="https://pub.dev/packages/flutter_mediapipe" ref="nofollow noopener noreferrer">flutter_mediapipe</a> 的 package，但它已在四年前被弃用，并且<strong>不支持 Web 端</strong>。</p>
<p>因此，我们来将官方的 JavaScript 实现<strong>封装</strong>到我们自己的 <strong>Flutter 插件</strong>中。</p>
<p>你可以在这里查看第一个截图中的最终演示应用（<strong>仅支持 Chrome 浏览器</strong>）： <a href="https://link.juejin.cn?target=https%3A%2F%2Falexeyinkin.github.io%2Fflutter-mediapipe%2F" target="_blank" title="https://alexeyinkin.github.io/flutter-mediapipe/" ref="nofollow noopener noreferrer">alexeyinkin.github.io/flutter-med…</a></p>
<p>下载源代码以便跟着操作（我会跳过一些内容）： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falexeyinkin%2Fflutter-mediapipe" target="_blank" title="https://github.com/alexeyinkin/flutter-mediapipe" ref="nofollow noopener noreferrer">github.com/alexeyinkin…</a></p>
<h3 data-id="heading-0">🔌 创建插件 (Creating the plugin)</h3>
<p>插件（Plugin）是一种特殊的 Dart package，它会根据你编译的目标平台来<strong>置换</strong>（或“切换”）不同的实现。</p>
<hr/>
<h3 data-id="heading-1">📚 学习资源 (References)</h3>
<p>这份官方文章是编写插件的优秀教程： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.dev%2Fpackages-and-plugins%2Fdeveloping-packages" target="_blank" title="https://docs.flutter.dev/packages-and-plugins/developing-packages" ref="nofollow noopener noreferrer">docs.flutter.dev/packages-an…</a></p>
<p>另外，<code>url_launcher</code> 官方 package 的作者也撰写了一篇精彩的入门文章，专门介绍如何编写 Web 插件。它解释了 Flutter 刚开始支持 Web 时，他们是如何首次为该 package 添加 Web 支持的：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.flutter.dev%2Fhow-to-write-a-flutter-web-plugin-5e26c689ea1" target="_blank" title="https://blog.flutter.dev/how-to-write-a-flutter-web-plugin-5e26c689ea1" ref="nofollow noopener noreferrer">Part 1</a> 解释了基本方法，这与 Android 和 iOS 插件的做法相同，即使用一种称为 <strong>Method Channel（方法通道）</strong> 的机制，将任务委托给这些平台上的<strong>原生代码</strong>。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.flutter.dev%2Fhow-to-write-a-flutter-web-plugin-5e26c689ea1" target="_blank" title="https://blog.flutter.dev/how-to-write-a-flutter-web-plugin-5e26c689ea1" ref="nofollow noopener noreferrer">Part 2</a> 通过<strong>移除方法通道</strong>简化了流程，因为 Web 实现代码无论如何都是用 <strong>Dart</strong> 编写的，因此你可以直接调用特定实现的<strong>方法</strong>。</li>
</ul>
<p>这两篇文章都只使用了标准的浏览器 API，<strong>没有调用任何自定义的 JavaScript</strong>。因此，本文将在它们的基础上构建，并<strong>增加了导入和调用自定义 JavaScript 的功能</strong>。</p>
<hr/>
<p>遵循最新的 <code>url_launcher</code> 文章中的架构，我创建了三个 Dart packages：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b9bc5ee2038423987210b3a550cafd2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763600595&amp;x-signature=z1WDSVRYOeRWLObosVhXR4qa%2FuM%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>
<p><code>flutter_mediapipe_vision</code> 是<strong>主 package</strong>。所有想要在图像上识别姿势的应用都需要且仅需将其添加为依赖项。它会引入其他 package 作为依赖，并根据平台将调用<strong>转发</strong>给特定的实现。同时，Flutter 会对其他平台的实现进行<strong>摇树优化 (tree-shakes)</strong> 。</p>
</li>
<li>
<p><code>flutter_mediapipe_vision_platform_interface</code> <strong>定义了所有平台实现必须遵循的接口</strong>。这个 package 本身不执行任何实际工作，它的全部作用是在第一个 package 不知情的情况下<strong>置换</strong>（或“切换”）不同的实现。</p>
</li>
<li>
<p><code>flutter_mediapipe_vision_web</code> 是<strong>针对 Web 的特定实现</strong>，也是本文的主要关注点。它依赖于第二个 package，因为它实现了相同的接口。它对第一个 package 一无所知。反过来，第一个 package 依赖于它，只是为了<strong>递归地</strong>将其带入项目中。</p>
</li>
</ul>
<h2 data-id="heading-2"><code>lutter_mediapipe_vision</code></h2>
<p>我们希望为面向用户的 package 设计一个怎样的接口呢？如果我们想要<strong>可置换的实现</strong>，<strong>静态函数</strong>是最好的选择：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FlutterMediapipeVision</span> </span>{
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; ensureInitialized() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> FlutterMediapipeVisionPlatform.instance.ensureInitialized();
  }

  <span class="hljs-keyword">static</span> Future&lt;PoseLandmarkerResult&gt; detect(Uint8List bytes) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> FlutterMediapipeVisionPlatform.instance.detect(bytes);
  }
}
</code></pre>
<p>这个类会将<strong>静态函数调用</strong>转换为对特定实现上的<strong>实例方法调用</strong>。</p>
<hr/>
<h3 data-id="heading-3">🚀 <strong>接口函数设计</strong></h3>
<p>第一个函数将用于<strong>初始化模型</strong>。我们可以随意命名，但 <code>ensureInitialized()</code> 是这种操作的<strong>约定俗成</strong>的名称。可以参考 <code>WidgetsFlutterBinding.ensureInitialized()</code> 的命名方式。</p>
<p>第二个函数将接收图像的字节数据（例如来自摄像头的每一帧），并调用模型上的 <code>detect()</code> 函数。在所有平台实现中，它的命名都保持一致。</p>
<p>另外，请注意我们很快将定义的<strong>返回类型</strong>。</p>
<hr/>
<h2 data-id="heading-4"><code>flutter_mediapipe_vision_platform_interface</code></h2>
<h3 data-id="heading-5">📊 <strong>数据类型</strong> (Data types)</h3>
<p>我们从数据类型开始。我们将要连接的 JavaScript 库有用于已识别点和总聚合结果的数据类型。然而，我们需要插件返回<strong>与平台无关</strong>的结果，因此我们需要定义自己的类型。</p>
<p>这是一个地标点（landmark），即姿势中被识别出来的一个点：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NormalizedLandmark</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> x;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> y;

  <span class="hljs-keyword">const</span> NormalizedLandmark({<span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.x, <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.y});

  Offset <span class="hljs-keyword">get</span> offset =&gt; Offset(x, y);
}
</code></pre>
<p>它被称为<strong>归一化</strong>（normalized），是因为如果 <strong>x</strong> 和 <strong>y</strong> 坐标在画面帧内，它们的值范围就在 <strong>0 到 1</strong> 之间。</p>
<p>如果图像被裁剪，并且模型认为某个特定的点在图像外部，那么这些坐标也可能<strong>小于零或大于 1</strong>，就像下面这个网络摄像头示例一样：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33b0ff6a55aa4cb49a05c1be7d9d496f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763600595&amp;x-signature=KR7vUIQ62ILz49iV%2FIp387gx%2FXk%3D" alt="有些点在画面范围之外，模型试图猜测我的肘部会在哪里。" loading="lazy"/></p>
<p>为什么不直接使用来自 <code>dart:ui</code> 的 <strong><code>Offset</code></strong> 类型呢？</p>
<p>这个库（指 MediaPipe）还会给我们 <strong>z 轴坐标</strong>（即到摄像机的距离）以及一些我们目前不需要的其他信息，但<strong>以后能添加它们会很有益处</strong>。因此，<strong><code>Offset</code> 类型是不够的</strong>。</p>
<p>另外，这个 <strong><code>NormalizedLandmark</code></strong> 类型是在<strong>每个独立的实现</strong>中都有定义的：TypeScript、Java 等。所以，让我们保持一致性。</p>
<p>接下来，这是<strong>识别结果</strong>：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PoseLandmarkerResult</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">List</span>&lt;NormalizedLandmark&gt;&gt; landmarks;

  <span class="hljs-keyword">const</span> PoseLandmarkerResult.empty() : landmarks = <span class="hljs-keyword">const</span> [];

  <span class="hljs-keyword">const</span> PoseLandmarkerResult({<span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.landmarks});
}
</code></pre>
<p>该库返回<strong>已识别姿势的列表</strong>（即列表的第一个维度）。每个姿势都是一个<strong>地标点</strong>列表，它们位于特定的索引上（即列表的第二个维度）：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09422458f8e74132a1a68abd3c1aab10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763600595&amp;x-signature=trKdqjb356J3FEOhfTsXebLVX%2BQ%3D" alt="PoseLandmarkerResult中地标点（landmarks）的索引" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-6">💻 平台接口 (The platform interface)</h2>
<p>在数据类型定义完毕后，我们就可以定义<strong>每个插件都必须扩展（继承）的接口</strong>了：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FlutterMediapipeVisionPlatform</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PlatformInterface</span> </span>{
  FlutterMediapipeVisionPlatform() : <span class="hljs-keyword">super</span>(token: _token);

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">Object</span> _token = <span class="hljs-built_in">Object</span>();

  <span class="hljs-keyword">static</span> FlutterMediapipeVisionPlatform _instance =
    FlutterMediapipeVisionMethodChannel();

  <span class="hljs-keyword">static</span> FlutterMediapipeVisionPlatform <span class="hljs-keyword">get</span> instance =&gt; _instance;

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">set</span> instance(FlutterMediapipeVisionPlatform instance) {
    PlatformInterface.verify(instance, _token);
    _instance = instance;
  }

  Future&lt;<span class="hljs-keyword">void</span>&gt; ensureInitialized() {
    <span class="hljs-keyword">throw</span> UnimplementedError();
  }

  Future&lt;PoseLandmarkerResult&gt; detect(Uint8List bytes) {
    <span class="hljs-keyword">throw</span> UnimplementedError();
  }
}
</code></pre>
<h2 data-id="heading-7">📌 关键点解析</h2>
<p>这里涉及许多内容。</p>
<p>最重要的是，我们定义了两个<strong>业务逻辑函数</strong>：<code>ensureInitialized</code> 和 <code>detect</code>。</p>
<p>接下来，<code>_instance</code> 需要有一个<strong>默认值</strong>，因此我们创建了一个实例，我们稍后会讨论它。</p>
<p>最后，请注意名为 <code>_token</code> 的对象。这是我们需要它的原因。Flutter 保留向其 <strong><code>PlatformInterface</code></strong> 类添加内容的权利，而这对我们来说不应该成为一个<strong>破坏性变更 (breaking change)</strong> 。因此，规则是<strong>始终使用 <code>extends</code>（继承），而不是 <code>implements</code>（实现）</strong> 。</p>
<p>我们确保在这里使用了 <code>extends</code>，但通常任何人都可以为另一个平台编写我们平台接口的实现（甚至可以覆盖我们在同一平台上的实现），而我们无法控制他们使用 <code>extends</code> 还是 <code>implements</code>。如果他们使用了 <code>implements</code>，程序可能暂时能正常工作，但随后可能会突然停止对特定平台上的这个 package 进行构建。</p>
<p>因此，我们确保不等到那时，而是<strong>提前破坏（报错）</strong> 。为此，我们使用了 <code>_token</code> 对象，它唯一的职责就是确保<strong>一致性</strong>。如果别人的插件实现了我们的接口，它就不会拥有相同的 <code>_token</code>，并且 <code>set instance</code> 中的检查将会失败。</p>
<p>那么，那个<strong>默认实例</strong>到底是什么呢？</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">const</span> MethodChannel _channel = MethodChannel(<span class="hljs-string">'ainkin.com/flutter_mediapipe_vision'</span>);

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FlutterMediapipeVisionMethodChannel</span>
  <span class="hljs-keyword">extends</span> <span class="hljs-title">FlutterMediapipeVisionPlatform</span> </span>{
  <span class="hljs-meta">@override</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; ensureInitialized() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> _channel.invokeMethod&lt;<span class="hljs-keyword">void</span>&gt;(<span class="hljs-string">'ensureInitialized'</span>);
  }

  <span class="hljs-meta">@override</span>
  Future&lt;PoseLandmarkerResult&gt; detect(Uint8List bytes) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> native = <span class="hljs-keyword">await</span> _channel.invokeMethod&lt;<span class="hljs-keyword">void</span>&gt;(<span class="hljs-string">'detect'</span>);
    <span class="hljs-keyword">throw</span> UnimplementedError(<span class="hljs-string">'TODO: Convert.'</span>);
  }
}
</code></pre>
<h3 data-id="heading-8">🔙 回顾 Flutter 早期 (Back when Flutter only supported Android and iOS)</h3>
<p>回顾 Flutter <strong>仅支持 Android 和 iOS</strong> 的时期，调用任何平台特定功能的<strong>唯一方式</strong>是创建一个名为 <strong><code>MethodChannel</code></strong> 的对象，并使用 <code>invokeMethod(name)</code> 在其上“调用方法”。Flutter 会处理 <strong>Channel（通道）</strong> 和 <strong>Method（方法）</strong> 的名称，并将调用路由到特定的<strong>原生代码</strong>。Dart 代码中<strong>没有可置换的实例</strong>，因为所有的置换都是在<strong>构建应用时</strong>完成的。</p>
<p>为了<strong>保持向后兼容性</strong>，如果 Flutter 没有要求我们的插件做任何不同的事情，这就是我们需要默认采用的方式。这也是我们将此作为<strong>默认实例</strong>的原因。</p>
<hr/>
<h3 data-id="heading-9">🚧 默认实例的实现 (Default Instance Implementation)</h3>
<p>不过，我们暂时<strong>不会支持 Web 以外的平台</strong>。因此，我们不需要让 <code>MethodChannel</code> 的实现能够正常工作。调用一个假设的原生 <code>ensureInitializee()</code> 并等待它返回并不会有什么坏处。但是，我们不能在 <code>detect()</code> 中做任何有意义的事情，因为那需要一个用于与原生实现之间<strong>传递数据</strong>的契约。因此，我们可以在那里抛出一个<strong>错误</strong>。</p>
<hr/>
<h2 data-id="heading-10">💻 <code>flutter_mediapipe_vision_web</code></h2>
<p>让我们用以下代码开始我们的插件：</p>
<pre><code class="hljs language-dart" lang="dart">
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FlutterMediapipeVisionWeb</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">FlutterMediapipeVisionPlatform</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> registerWith(Registrar registrar) {
    FlutterMediapipeVisionPlatform.instance = FlutterMediapipeVisionWeb();
  }

  Future&lt;<span class="hljs-keyword">void</span>&gt;? _initFuture;

  <span class="hljs-meta">@override</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; ensureInitialized() =&gt;
      _initFuture ?? (_initFuture = _initOnce());

  Future&lt;<span class="hljs-keyword">void</span>&gt; _initOnce() <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// ...</span>
  }

  <span class="hljs-meta">@override</span>
  Future&lt;PoseLandmarkerResult&gt; detect(Uint8List bytes) <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// ...</span>
  }
}
</code></pre>
<h2 data-id="heading-11">✨ 注册与初始化 (<code>registerWith()</code>)</h2>
<p><code>registerWith()</code> 是一个“神奇”的函数。如果应用是为 <strong>Web 构建</strong>的，Flutter 会在<strong>很早的时候</strong>调用它。然后，我们创建当前类的一个实例，并将其设置为<strong>用于所有平台调用</strong>。</p>
<hr/>
<h2 data-id="heading-12">🌐 欢迎来到 Web！(Welcome to Web!)</h2>
<p>Dart 代码会被<strong>转译 (transpile)</strong> 成 JavaScript 或 WASM (WebAssembly)。无论是哪种方式，它都可以通过 <code>dart:js_interop</code> 导入提供的 <code>globalContext</code> 变量，直接访问浏览器的<strong>全局作用域</strong>。因此，Dart 对象和 JavaScript 对象之间几乎没有区别，它们对于运行我们应用的浏览器来说都只是<strong>对象</strong>。</p>
<hr/>
<h2 data-id="heading-13">📦 加载 MediaPipe 的 JavaScript (Loading MediaPipe’s JavaScript)</h2>
<p>我<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffirebase%2Fflutterfire%2Fblob%2F6c263de27e047260a00d2255b4c92c1478818b3b%2Fpackages%2Ffirebase_core%2Ffirebase_core_web%2Flib%2Fsrc%2Ffirebase_core_web.dart%23L135" target="_blank" title="https://github.com/firebase/flutterfire/blob/6c263de27e047260a00d2255b4c92c1478818b3b/packages/firebase_core/firebase_core_web/lib/src/firebase_core_web.dart#L135" ref="nofollow noopener noreferrer">借鉴了 Firebase 的这段代码</a>并做了一些简化。遗憾的是，我们需要重复这段较长的代码片段，而 Flutter 尚未为我们准备好一个<strong>单行代码 (one-liner)</strong> 解决方案。</p>
<p>这段代码从 <code>src</code> 加载一个脚本，并将其<strong>模块对象</strong>存储在一个由 <code>windowVar</code> 确定的<strong>全局变量</strong>中。</p>
<pre><code class="hljs language-dart" lang="dart">Future&lt;<span class="hljs-keyword">void</span>&gt; _injectSrcScript(<span class="hljs-built_in">String</span> src, <span class="hljs-built_in">String</span> windowVar) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> web.HTMLScriptElement script =
        web.<span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'script'</span>) <span class="hljs-keyword">as</span> web.HTMLScriptElement;
    script.type = <span class="hljs-string">'text/javascript'</span>;
    script.crossOrigin = <span class="hljs-string">'anonymous'</span>;

    <span class="hljs-keyword">final</span> stringUrl = src;
    script.text =
        <span class="hljs-string">'''
    window.my_trigger_<span class="hljs-subst">$windowVar</span> = async (callback) =&gt; {
      console.debug("Initializing MediaPipe <span class="hljs-subst">$windowVar</span>");
      callback(await import("<span class="hljs-subst">$stringUrl</span>"));
    };
    '''</span>;

    web.console.log(<span class="hljs-string">'Appending a script'</span>.toJS);
    web.<span class="hljs-built_in">document</span>.head!.appendChild(script);

    Completer completer = Completer();

    globalContext.callMethod(
      <span class="hljs-string">'my_trigger_<span class="hljs-subst">$windowVar</span>'</span>.toJS,
      (JSAny module) {
        globalContext[windowVar] = module;
        globalContext.delete(<span class="hljs-string">'my_trigger_<span class="hljs-subst">$windowVar</span>'</span>.toJS);
        completer.complete();
      }.toJS,
    );

    <span class="hljs-keyword">await</span> completer.future;
  }
</code></pre>
<p>现在，我们可以定义 <code>_windowVar</code>，让它的命名<strong>不会与 Flutter 或 MediaPipe 产生冲突</strong>，并开始用加载 MediaPipe 代码的方式来编写我们的 <code>_initOnce()</code> 函数：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">const</span> _windowVar = <span class="hljs-string">'flutter_mediapipe_vision'</span>;  
  
<span class="hljs-comment">// ...  </span>
  
Future&lt;<span class="hljs-keyword">void</span>&gt; _initOnce() <span class="hljs-keyword">async</span> {  
<span class="hljs-keyword">await</span> _injectSrcScript(  
<span class="hljs-string">'https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision/vision_bundle.js'</span>,  
_windowVar,  
);  
  
<span class="hljs-comment">// ...</span>

</code></pre>
<p>这会加载<strong>最新版本</strong>的脚本。另一种方法是下载它并与我们的资源（assets）一起打包，以<strong>减少外部依赖</strong>，但目前这种方式（直接加载最新版）就可以了。</p>
<p>这段加载完成后，<strong>MediaPipe 模块</strong>就会存在于<strong>全局变量</strong>中，并且可以通过 <code>globalContext[_windowVar]</code> 进行访问。我们现在就可以开始从它那里调用函数了：</p>
<pre><code class="hljs language-dart" lang="dart">globalContext[_windowVar][<span class="hljs-string">'PoseLandmarker'</span>].callMethod(  
<span class="hljs-string">'createFromOptions'</span>,  
...  
);
</code></pre>
<p>但是，最好对它进行<strong>某种类型安全</strong>的约束。</p>
<h2 data-id="heading-14">🛡️ 对 JavaScript 对象施加 Dart 接口 (Imposing Dart interfaces on JavaScript objects)</h2>
<p>还记得我们声明的 <strong><code>NormalizedLandmark</code></strong> 类吗？</p>
<p>在 JavaScript 端，它是一个带有 <code>x</code> 和 <code>y</code> 属性的<strong>常规对象</strong>，在我们的 Dart 代码中可以通过 <code>landmark['x']</code> 和 <code>landmark['y']</code> 这样的方式来访问。<strong>这很容易出错</strong>。幸运的是，我们可以像这样定义一个 Dart 接口：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">extension</span> type NormalizedLandmark._(JSObject _) <span class="hljs-keyword">implements</span> JSObject {  
<span class="hljs-keyword">external</span> <span class="hljs-built_in">num</span> <span class="hljs-keyword">get</span> x;  
<span class="hljs-keyword">external</span> <span class="hljs-built_in">num</span> <span class="hljs-keyword">get</span> y;  
}
</code></pre>
<p>如果我们将这样一个地标对象<strong>强制转换</strong>（cast）为这个类，我们就能以<strong>类型安全</strong>的方式来访问它的属性了：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> landmark = unsafeLandmark <span class="hljs-keyword">as</span> NormalizedLandmark;  
<span class="hljs-built_in">print</span>(landmark.x);
</code></pre>
<h2 data-id="heading-15">🌟 扩展类型 (Extension types)</h2>
<p>这个接口到底是什么呢？它是一种名为<strong>扩展类型</strong>（extension type）的构造，<strong>它在字面上给对象施加了一个接口，但并不会创建一个额外的包装器</strong>。它作为一种<strong>编译时抽象</strong>（compile-time abstraction）而存在，但在<strong>运行时</strong>并不存在。你可以在<a href="https://link.juejin.cn?target=https%3A%2F%2Fdart.dev%2Flanguage%2Fextension-types" target="_blank" title="https://dart.dev/language/extension-types" ref="nofollow noopener noreferrer">Dart 文档</a>中阅读有关此构造的更多信息：</p>
<p>我们先稍微绕个弯，学习更多关于<strong>扩展类型</strong>的知识，然后再带着这些新知识回到你的 <strong>JavaScript 工作</strong>中。</p>
<p>Dart 关于扩展类型的文档展示了这样一个示例，它将 <strong><code>int</code> 类型的接口范围缩小</strong>，只允许进行一个操作：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">extension</span> type IdNumber(<span class="hljs-built_in">int</span> id) {  
<span class="hljs-comment">// Wraps the 'int' type's '&lt;' operator:  </span>
<span class="hljs-keyword">operator</span> &lt;(IdNumber other) =&gt; id &lt; other.id;  
<span class="hljs-comment">// Doesn't declare the '+' operator, for example,  </span>
<span class="hljs-comment">// because addition does not make sense for ID numbers.  </span>
}  
  
<span class="hljs-comment">// ...  </span>
<span class="hljs-keyword">final</span> safeId = IdNumber(<span class="hljs-number">42</span>);
</code></pre>
<p>这段代码表明：</p>
<ul>
<li>
<p>我们将使用一个名为 <strong><code>IdNumber</code></strong> 的东西来处理一些 ID。</p>
</li>
<li>
<p>它<strong>不是一个在运行时存在的类</strong>，因为那样开销太大，因此我们使用了 <strong><code>extension type</code>（扩展类型）</strong> 。</p>
</li>
<li>
<p>相反，我们将使用 <strong><code>int</code></strong> 来存储这些 ID，因为 <code>int</code> 是存储数字的<strong>最有效</strong>方式。因此，类型名称后面紧跟的 <code>(int id)</code> 表示<strong>这个抽象包装了什么</strong>。</p>
</li>
<li>
<p>这个接口<strong>剥离了 <code>int</code> 的所有方法、操作符和属性</strong>，只保留了我们<strong>明确定义</strong>的部分。</p>
</li>
<li>
<p>我们定义了 <code>operator &lt;</code>，这也是你对这种 ID <strong>唯一能做的操作</strong>。</p>
</li>
</ul>
<hr/>
<h2 data-id="heading-16">💡 关于扩展类型的构造函数</h2>
<p>扩展类型的<strong>构造函数</strong>不像常规类型那样作为成员定义，因为常规类型可能有多个构造函数，因为<strong>构造</strong>对它们来说是<strong>实际的工作</strong>，我们可能希望以不同的方式完成。</p>
<p>另一方面，对于扩展类型来说，<strong>构造只是编译时的一种包装</strong>，它不会转换成任何实际的运行时操作，所以它<strong>总是只有一个构造函数</strong>。因此，将其作为成员来定义就没有意义了，所以它们的语法是将构造函数 <code>(int id)</code> 直接放在类型名称之后。</p>
<hr/>
<h2 data-id="heading-17">🧐 那么，这对我们的例子有什么用呢？</h2>
<p><strong>（即如何将扩展类型应用于我们的 JavaScript 互操作场景？）</strong></p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">extension</span> type NormalizedLandmark._(JSObject _) <span class="hljs-keyword">implements</span> JSObject {  
<span class="hljs-keyword">external</span> <span class="hljs-built_in">num</span> <span class="hljs-keyword">get</span> x;  
<span class="hljs-keyword">external</span> <span class="hljs-built_in">num</span> <span class="hljs-keyword">get</span> y;  
}
</code></pre>
<p>在我们的扩展类型中：</p>
<ul>
<li>我们<strong>包装了一个 <code>JSObject</code></strong> 并立即<strong>实现了 <code>JSObject</code> 接口</strong>。这意味着我们<strong>没有剥离</strong>该接口中的任何内容，而只是<strong>添加</strong>了新功能。我们需要这样做是因为我们很快就会有 <code>JSArray&lt;NormalizedLandmark&gt;</code>，而 <code>JSArray</code> <strong>只能包含 <code>JSObject</code> 及其子类</strong>。</li>
<li>我们使用 <code>_</code> 作为名称，因为与 ID 的示例不同，我们<strong>没有将任何功能委托</strong>给我们包装的对象，因此不需要一个名称。</li>
<li>我们使用<strong>私有构造函数</strong>，这是由于 <code>._</code> 的存在。</li>
</ul>
<p>因此，这个包装器<strong>永远不能像</strong>我们创建 <code>IdNumber</code> 那样（如 <code>final safeId = IdNumber(42);</code>）来创建。</p>
<p>相反，我们只能使用 <strong><code>as</code> 关键字</strong>对其进行<strong>强制转换 (cast)</strong> 。</p>
<p>我们把 getter 标记为 <strong><code>external</code></strong>。这意味着“它们已经在 JavaScript 中存在，可以直接工作”。</p>
<p>当我们使用<strong>扩展类型</strong>来表示来自外部 JavaScript 或 WASM 库的对象时，它被称为 <strong>“互操作类型”（interop type）</strong> ，源自 <strong>inter-operation（互操作）</strong> 。</p>
<hr/>
<h2 data-id="heading-18">✍️ 定义互操作类型 (Defining the interop types)</h2>
<p>我们需要更多的互操作类型来从 MediaPipe 库中创建 <strong>Landmarker 对象</strong>、调用它的方法并从<strong>结果对象</strong>中获取数据。</p>
<p>这些类型可以通过查看 MediaPipe 的 <strong>TypeScript 源代码</strong>手动编写出来：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogle-ai-edge%2Fmediapipe%2Fblob%2Fmaster%2Fmediapipe%2Ftasks%2Fweb%2Fcore%2Ffileset_resolver.ts.template" target="_blank" title="https://github.com/google-ai-edge/mediapipe/blob/master/mediapipe/tasks/web/core/fileset_resolver.ts.template" ref="nofollow noopener noreferrer">fileset_resolver.ts.template</a></li>
<li><code>landmark.d.ts</code></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogle-ai-edge%2Fmediapipe%2Fblob%2Fmaster%2Fmediapipe%2Ftasks%2Fweb%2Fcomponents%2Fcontainers%2Flandmark.d.ts" target="_blank" title="https://github.com/google-ai-edge/mediapipe/blob/master/mediapipe/tasks/web/components/containers/landmark.d.ts" ref="nofollow noopener noreferrer">pose_landmarker.ts</a></li>
<li><code>pose_landmarker_options.d.ts</code></li>
<li><code>pose_landmarker_result.ts</code></li>
<li><code>task_runner_options.d.ts</code></li>
<li><code>vision_task_options.d.ts</code></li>
</ul>
<p>Dart 中的互操作类型<strong>有可能</strong>可以从 TypeScript 源码生成，但我还没有探索过这一点。手动实践一段时间是有益的。</p>
<p>以下是我从 TypeScript 中提取出来的部分，<strong>仅包含我们将实际使用的方法和属性</strong>。</p>
<p><code>detect</code> 函数的结果是：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">extension</span> type PoseLandmarkerResult._(JSObject _) <span class="hljs-keyword">implements</span> JSObject {  
<span class="hljs-keyword">external</span> JSArray&lt;JSArray&lt;NormalizedLandmark&gt;&gt; <span class="hljs-keyword">get</span> landmarks;  
}
</code></pre>
<p>地标检测器 (The landmarker)：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">extension</span> type PoseLandmarker._(JSObject _) <span class="hljs-keyword">implements</span> JSObject {
  <span class="hljs-keyword">external</span> JSPromise&lt;PoseLandmarker&gt; createFromOptions(
    WasmFileset fileset,
    PoseLandmarkerOptions options,
  );

  <span class="hljs-keyword">external</span> <span class="hljs-keyword">void</span> detect(HTMLImageElement img, JSFunction callback);
}
</code></pre>
<p>创建地标检测器的选项：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">extension</span> type PoseLandmarkerOptions._(JSObject _) <span class="hljs-keyword">implements</span> JSObject {
  <span class="hljs-keyword">external</span> PoseLandmarkerOptions({
    BaseOptions baseOptions,
    <span class="hljs-built_in">int</span> numPoses,
    <span class="hljs-built_in">String</span> runningMode,
  });

  <span class="hljs-keyword">external</span> BaseOptions <span class="hljs-keyword">get</span> baseOptions;

  <span class="hljs-keyword">external</span> <span class="hljs-built_in">int</span> <span class="hljs-keyword">get</span> numPoses;

  <span class="hljs-keyword">external</span> <span class="hljs-built_in">String</span> <span class="hljs-keyword">get</span> runningMode;
}
</code></pre>
<p><code>PostLandmarkerOptions</code> 中的基础选项：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">extension</span> type BaseOptions._(JSObject _) <span class="hljs-keyword">implements</span> JSObject {  
    <span class="hljs-keyword">external</span> BaseOptions({<span class="hljs-built_in">String</span> modelAssetPath});  
  
    <span class="hljs-keyword">external</span> <span class="hljs-built_in">String</span> <span class="hljs-keyword">get</span> modelAssetPath;  
}
</code></pre>
<p>WasmFileset，不管它是什么：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">extension</span> type WasmFileset._(JSObject _) <span class="hljs-keyword">implements</span> JSObject {}
</code></pre>
<p>Fileset resolver:</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">extension</span> type FilesetResolver._(JSObject _) <span class="hljs-keyword">implements</span> JSObject {  
    <span class="hljs-keyword">external</span> JSPromise&lt;WasmFileset&gt; forVisionTasks(<span class="hljs-built_in">String</span> basePath);  
}
</code></pre>
<p>MediaPipe 模块的根对象:</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'fileset_resolver.dart'</span> <span class="hljs-keyword">as</span> fsr;
<span class="hljs-keyword">import</span> <span class="hljs-string">'pose_landmarker.dart'</span> <span class="hljs-keyword">as</span> plm;

<span class="hljs-keyword">extension</span> type MediaPipe._(JSObject _) <span class="hljs-keyword">implements</span> JSObject {
  <span class="hljs-keyword">external</span> fsr.FilesetResolver <span class="hljs-keyword">get</span> FilesetResolver;

  <span class="hljs-keyword">external</span> plm.PoseLandmarker <span class="hljs-keyword">get</span> PoseLandmarker;
}
</code></pre>
<h2 data-id="heading-19">⚙️ 模型初始化</h2>
<p>让我们继续编写设置插件的函数，并<strong>初始化模型</strong>：</p>
<pre><code class="hljs language-dart" lang="dart">MediaPipe <span class="hljs-keyword">get</span> mp =&gt; globalContext[_windowVar] <span class="hljs-keyword">as</span> MediaPipe;
PoseLandmarker? _landmarker;

Future&lt;<span class="hljs-keyword">void</span>&gt; _initOnce() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">await</span> _injectSrcScript(
    <span class="hljs-string">'https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision/vision_bundle.js'</span>,
    _windowVar,
  );

  <span class="hljs-keyword">final</span> fs = <span class="hljs-keyword">await</span> mp.FilesetResolver.forVisionTasks(
    <span class="hljs-string">'https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm'</span>,
  ).toDart;

  <span class="hljs-keyword">final</span> options = PoseLandmarkerOptions(
    baseOptions: BaseOptions(
      modelAssetPath:
          <span class="hljs-string">"packages/flutter_mediapipe_vision_platform_interface/assets/"</span>
          <span class="hljs-string">"assets/models/pose_landmarker_lite.task"</span>,
    ),
    numPoses: <span class="hljs-number">5</span>,
    runningMode: <span class="hljs-string">"IMAGE"</span>,
  );

  _landmarker = <span class="hljs-keyword">await</span> mp.PoseLandmarker.createFromOptions(fs, options).toDart;
}
</code></pre>
<h2 data-id="heading-20">💾 模型文件与存储</h2>
<p>模型文件本身可以在这里下载，我选择了 lite（轻量）版本：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fai.google.dev%2Fedge%2Fmediapipe%2Fsolutions%2Fvision%2Fpose_landmarker" target="_blank" title="https://ai.google.dev/edge/mediapipe/solutions/vision/pose_landmarker" ref="nofollow noopener noreferrer">ai.google.dev/edge/mediap…</a></p>
<p>由于模型是<strong>在不同实现之间共享</strong>的，最好将它们放入一个<strong>共享 package</strong> 中。<strong><code>flutter_mediapipe_vision_platform_interface</code></strong> 是最合适的，尽管从技术上讲它不属于接口范畴，但所有实现都已经依赖于它。</p>
<p>无论如何，当这个函数执行完毕时，我们就把 <strong>Landmarker</strong> 对象存储在了字段变量 <strong><code>_landmarker</code></strong> 中。</p>
<hr/>
<h2 data-id="heading-21">🧍 检测姿势 (Detecting poses)</h2>
<p>这就是执行实际工作的<strong>方法</strong>：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-meta">@override</span>  
Future&lt;PoseLandmarkerResult&gt; detect(Uint8List bytes) <span class="hljs-keyword">async</span> {  
<span class="hljs-keyword">final</span> el = <span class="hljs-keyword">await</span> _createImageFromBytes(bytes);  
<span class="hljs-comment">// ...  </span>
}
</code></pre>
<p>我们首先使用字节数据创建一个 <strong><code>HTMLImageElement</code></strong> 元素，因为这是 MediaPipe 的 <strong><code>detect</code> 函数实际接受</strong>的输入类型。我们这样做：</p>
<pre><code class="hljs language-dart" lang="dart">
Future&lt;web.HTMLImageElement&gt; _createImageFromBytes(Uint8List bytes) <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">final</span> completer = Completer();

  <span class="hljs-keyword">final</span> blob = web.Blob(
    [bytes.toJS].toJS,
    web.BlobPropertyBag(type: _detectImageFormat(bytes)),
  );
  <span class="hljs-keyword">final</span> imageUrl = web.URL.createObjectURL(blob);
  <span class="hljs-keyword">final</span> el = web.<span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>) <span class="hljs-keyword">as</span> web.HTMLImageElement;

  el.onload = () {
    web.URL.revokeObjectURL(imageUrl);
    completer.complete();
  }.toJS;
  el.onerror = () {
    web.URL.revokeObjectURL(imageUrl);
    completer.completeError(<span class="hljs-string">'Cannot load the image.'</span>);
  }.toJS;

  el.src = imageUrl;
  <span class="hljs-keyword">await</span> completer.future;
  <span class="hljs-keyword">return</span> el;
}
</code></pre>
<h2 data-id="heading-22">💾 创建 Blob 对象</h2>
<p>JavaScript 的 <strong><code>Blob</code></strong>（Binary Large Object，二进制大对象）构造函数接受一个<strong>二维字节数组</strong>。因此，我们首先对 <code>Uint8List</code> 调用 <strong><code>.toJS</code></strong>，将其转换为一个 JavaScript 数组。许多 Dart 类型都有这个 getter 方法，用于生成可以传递给 JavaScript 函数的数据。接着，我们将这个数组包装到另一个列表中，并也将其转换为 JavaScript 数组。</p>
<p>然后，我们通过读取前几个字节来确定图像类型，这里我将跳过 <code>_detectImageFormat</code> 函数的细节。</p>
<hr/>
<h2 data-id="heading-23">🔗 生成 Blob URL</h2>
<p>接下来，我们需要生成一个 URL 来设置给我们的 <code>img</code> 对象，因为这是将图像放入 HTML 元素的<strong>唯一方式</strong>。</p>
<p>这里涉及到一个概念叫做 <strong>Blob URL</strong>。我们基本上是在告诉浏览器：“<strong>嘿，我们需要在 <code>img</code> 元素中显示这些字节。请给我们一个指向它们的虚拟 URL。</strong> ”</p>
<p>浏览器随后会将这些字节存储到某个内部表中，并生成一个看起来像这样的 URL：</p>
<p>blob:<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A40000%2Ffd108f07-5e55-43d1-b5cd-691b973c03d6" target="_blank" title="http://localhost:40000/fd108f07-5e55-43d1-b5cd-691b973c03d6" ref="nofollow noopener noreferrer">http://localhost:40000/fd108f07-5e55-43d1-b5cd-691b973c03d6</a></p>
<p>这个 URL 是<strong>当前浏览器会话私有</strong>的，可以用于获取图像。有趣的是，你甚至可以在另一个标签页中打开它：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1423a3ef99014683a3164ef27a3f18bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763600595&amp;x-signature=g7lQWqdJAZkHKobdsYZK5IKL8Cg%3D" alt="在一个页面上创建的 Blob URL 可以在另一个标签页中打开。" loading="lazy"/></p>
<p>总之，我们创建了一个 <strong><code>img</code> 元素</strong>，并将其 <strong><code>src</code></strong> 属性设置为那个 URL。现在，我们需要<strong>等待它加载完成</strong>。为此，我们需要设置以下这些<strong>监听器</strong>：</p>
<pre><code class="hljs language-js" lang="js">el.<span class="hljs-property">onload</span> = () {  
web.<span class="hljs-property">URL</span>.<span class="hljs-title function_">revokeObjectURL</span>(imageUrl);  
completer.<span class="hljs-title function_">complete</span>();  
}.<span class="hljs-property">toJS</span>;  
el.<span class="hljs-property">onerror</span> = () {  
web.<span class="hljs-property">URL</span>.<span class="hljs-title function_">revokeObjectURL</span>(imageUrl);  
completer.<span class="hljs-title function_">completeError</span>(<span class="hljs-string">'Cannot load the image.'</span>);  
}.<span class="hljs-property">toJS</span>;
</code></pre>
<p>这两个监听器（<code>onload</code> 和 <code>onerror</code>）都会使 <strong><code>Completer</code> 完成</strong>，这样函数就可以返回<strong>准备就绪的 <code>img</code> 元素</strong>，或者<strong>因错误而中断</strong>。</p>
<p>它们也都<strong>清理</strong>（dispose）了 URL，这样它就不会浪费浏览器的内存。毕竟，我们将在<strong>每一帧</strong>都执行这个操作。</p>
<p>请注意，当我们向任何 JavaScript 例程传递 Dart 函数时，我们需要使用 <strong><code>.toJS</code> getter</strong> 将其转换为<strong>常规的 JavaScript 函数</strong>。</p>
<p>当我们拿到 <code>img</code> 元素后，就可以继续进行 <strong><code>detect</code> 函数</strong>的操作了：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'src/interop/pose_landmarker_result.dart'</span> <span class="hljs-keyword">as</span> js_plr;

<span class="hljs-comment">// ...</span>

  <span class="hljs-meta">@override</span>
  Future&lt;PoseLandmarkerResult&gt; detect(Uint8List bytes) <span class="hljs-keyword">async</span> {
    PoseLandmarkerResult r = PoseLandmarkerResult.empty();
    <span class="hljs-keyword">final</span> el = <span class="hljs-keyword">await</span> _createImageFromBytes(bytes);

    _landmarker!.detect(
      el,
      (js_plr.PoseLandmarkerResult? result) {
        r = result?.toDart ?? PoseLandmarkerResult.empty();
      }.toJS,
    );

    <span class="hljs-keyword">return</span> r;
  }
</code></pre>
<h2 data-id="heading-24">🔄 处理异步检测结果</h2>
<p>请注意，JavaScript 的 <strong><code>detect</code> 函数并不会直接返回结果</strong>。相反，我们会向它传递一个<strong>回调函数</strong>（callback），数据准备好后会通过这个回调函数被调用。</p>
<p>这种设计允许该函数在回调返回时<strong>释放资源</strong>，这有可能<strong>改进垃圾回收机制 (garbage collection)</strong> 。但在实践中，我注意到该对象在回调完成后仍然存在，不过我们不能依赖这种现象。我们必须将 JavaScript 返回的结果对象<strong>转换</strong>成我们定义的那个<strong>平台无关</strong>的对象（即我们在第二个 package 中定义的类型）。</p>
<p>至此，<strong>所有 package 的代码就完成了！</strong></p>
<hr/>
<h2 data-id="heading-25">🔗 整合 Packages (Tying the packages together)</h2>
<p>Web 实现 package 需要在其 <strong><code>pubspec.yaml</code></strong> 文件中<strong>声明</strong>它包含一个插件实现，这样 Flutter 才知道<strong>启动时应该调用哪个方法</strong>来置换（swap in）这个实现：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">flutter:</span>
  <span class="hljs-attr">plugin:</span>
    <span class="hljs-attr">platforms:</span>
      <span class="hljs-attr">web:</span>
        <span class="hljs-attr">pluginClass:</span> <span class="hljs-string">FlutterMediapipeVisionWeb</span>
        <span class="hljs-attr">fileName:</span> <span class="hljs-string">flutter_mediapipe_vision_web.dart</span>
</code></pre>
<p>平台接口（platform interface）需要在其代码中<strong>声明</strong>它的<strong>资源</strong>（assets），这样在使用它的应用的最终构建中，这些资源才能被<strong>打包</strong>进去：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">flutter:</span>
  <span class="hljs-attr">assets:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">assets/models/pose_landmarker_lite.task</span>
</code></pre>
<p>而<strong>面向用户的 package</strong> 需要<strong>正式认可</strong>（或“推荐使用”）这个插件：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">flutter:</span>
  <span class="hljs-attr">plugin:</span>
    <span class="hljs-attr">platforms:</span>
      <span class="hljs-attr">web:</span>
        <span class="hljs-attr">default_package:</span> <span class="hljs-string">flutter_mediapipe_vision_web</span>
</code></pre>
<h2 data-id="heading-26">📱 应用</h2>
<h3 data-id="heading-27">📹 显示摄像头视频 (Showing the camera video)</h3>
<p>我们需要做的第一件事是在屏幕上显示来自<strong>摄像头</strong>的视频流。让我们创建并初始化<strong>摄像头控制器</strong>，然后显示 <strong><code>CameraPreview</code></strong> 组件：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:camera/camera.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;

<span class="hljs-keyword">late</span> CameraController cameraController;

Future&lt;<span class="hljs-keyword">void</span>&gt; main() <span class="hljs-keyword">async</span> {
  WidgetsFlutterBinding.ensureInitialized();
  <span class="hljs-keyword">await</span> FlutterMediapipeVision.ensureInitialized();

  cameraController = CameraController(
    (<span class="hljs-keyword">await</span> availableCameras()).first,
    ResolutionPreset.low,
    enableAudio: <span class="hljs-keyword">false</span>,
  );
  <span class="hljs-keyword">await</span> cameraController.initialize();

  runApp(<span class="hljs-keyword">const</span> MyApp());
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">const</span> MyApp({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> MaterialApp(
      home: Scaffold(
        appBar: AppBar(title: Text(<span class="hljs-string">'MediaPipe demo'</span>)),
        body: Center(
          child: CameraPreview(cameraController),
        ),
      ),
    );
  }
}
</code></pre>
<h2 data-id="heading-28">📹 最小化应用示例</h2>
<p>这是一个在屏幕上显示摄像头视频的<strong>最小化应用</strong>。它并不完美，因为它会在显示任何内容之前<strong>阻塞</strong>（block），直到获得使用摄像头的<strong>权限</strong>，并且如果访问被拒绝，它也<strong>不会重试</strong>。但它能完成工作：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4cb17ddfa074f5c9e90274799dd25b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763600595&amp;x-signature=XzkorvTkVMJTNk57N8J%2B5kyMA4Y%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-29">📸 捕获和分析静止图像 (Capturing and analyzing stills)</h2>
<p>让我们创建一个<strong>控制器</strong>来进行识别：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InferenceController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ChangeNotifier</span> </span>{
  <span class="hljs-keyword">final</span> CameraController cameraController;

  PoseLandmarkerResult <span class="hljs-keyword">get</span> lastResult =&gt; _lastResult;
  PoseLandmarkerResult _lastResult = PoseLandmarkerResult.empty();

  InferenceController({<span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.cameraController});

  Future&lt;<span class="hljs-keyword">void</span>&gt; start() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) {
      <span class="hljs-keyword">await</span> _tick();
    }
  }

  Future&lt;<span class="hljs-keyword">void</span>&gt; _tick() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> file = <span class="hljs-keyword">await</span> cameraController.takePicture();
    <span class="hljs-keyword">final</span> bytes = <span class="hljs-keyword">await</span> file.readAsBytes();

    _lastResult = <span class="hljs-keyword">await</span> FlutterMediapipeVision.detect(bytes);
    notifyListeners();
  }
}
</code></pre>
<h2 data-id="heading-30">🏃 启动与循环 (Starting the Recognition)</h2>
<p>一旦调用了 <strong><code>start()</code></strong> 函数，它就会<strong>永远运行下去</strong>。这对于<strong>移动设备</strong>来说不太理想（因为应用可能会被系统从内存中清除），但对于这个<strong>最小化的 Web 版本</strong>来说是可以接受的。</p>
<p>在循环中，我们使用 <strong><code>cameraController.takePicture()</code></strong> 捕获一帧图像，然后将其作为<strong>字节数据</strong>传递给我们的插件，并获取经过分析的<strong>结果</strong>。</p>
<p>现在，让我们在 <strong><code>main()</code></strong> 函数中创建这个控制器：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">late</span> InferenceController inferenceController; <span class="hljs-comment">// CHANGED</span>

Future&lt;<span class="hljs-keyword">void</span>&gt; main() <span class="hljs-keyword">async</span> {
  WidgetsFlutterBinding.ensureInitialized();
  <span class="hljs-keyword">await</span> FlutterMediapipeVision.ensureInitialized();

  <span class="hljs-keyword">final</span> cameraController = CameraController(
    (<span class="hljs-keyword">await</span> availableCameras()).first,
    ResolutionPreset.low,
    enableAudio: <span class="hljs-keyword">false</span>,
  );
  <span class="hljs-keyword">await</span> cameraController.initialize();

  <span class="hljs-comment">// NEW:</span>
  inferenceController = InferenceController(cameraController: cameraController);
  unawaited(inferenceController.start());

  runApp(<span class="hljs-keyword">const</span> MyApp());
}
</code></pre>
<h2 data-id="heading-31">🦴 显示骨架覆盖层 (Showing the skeleton overlay)</h2>
<p>让我们创建一个 <strong><code>CameraOverlayWidget</code></strong> 组件来完成这项工作：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CameraOverlayWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> InferenceController inferenceController;

  <span class="hljs-keyword">const</span> CameraOverlayWidget({<span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.inferenceController});

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> ListenableBuilder(
        listenable: inferenceController,
        child: CameraPreview(inferenceController.cameraController),
        builder: (context, child) {
          <span class="hljs-keyword">return</span> CustomPaint(
            foregroundPainter: CameraOverlayPainter(
              inferenceController: inferenceController,
            ),
            willChange: <span class="hljs-keyword">true</span>,
            child: child,
          );
        }
    );
  }
}
</code></pre>
<h2 data-id="heading-32">👂 监听与重绘 (Listening and Rebuilding)</h2>
<p>这个组件<strong>监听</strong>来自控制器的<strong>通知</strong>，并在每次收到通知时进行<strong>重建</strong>（rebuilds）。</p>
<p>请注意，我们在 <strong><code>builder</code> 函数的外部</strong>创建了 <strong><code>CameraPreview</code></strong> 组件，并将其作为 <strong><code>child</code></strong> 传递给 <strong><code>ListenableBuilder</code></strong>。这样做可以将 <strong><code>CameraPreview</code></strong> <strong>排除在重建过程之外</strong>，从而使性能稍微快一些。</p>
<hr/>
<h2 data-id="heading-33">🎨 自定义绘制 (Custom Painting)</h2>
<p><strong><code>CustomPaint</code></strong> 组件使用 <strong><code>foregroundPainter</code></strong> 在 <strong><code>child</code></strong> 组件的<strong>上方覆盖一层</strong>进行绘制。</p>
<p>现在，让我们来创建这个 <strong><code>CameraOverlayPainter</code></strong>：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CameraOverlayPainter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CustomPainter</span> </span>{
  <span class="hljs-keyword">final</span> InferenceController inferenceController;

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> _paint = Paint()
    ..color = Colors.white
    ..isAntiAlias = <span class="hljs-keyword">true</span>
    ..style = PaintingStyle.fill
    ..strokeWidth = <span class="hljs-number">5</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> _pointRadius = <span class="hljs-number">5.0</span>;

  CameraOverlayPainter({<span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.inferenceController});

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> paint(Canvas canvas, Size size) {
    _paintPose(canvas, size);
  }

  <span class="hljs-keyword">void</span> _paintPose(Canvas canvas, Size size) {
    <span class="hljs-keyword">final</span> pose = inferenceController.lastResult.landmarks.firstOrNull;
    <span class="hljs-keyword">if</span> (pose == <span class="hljs-keyword">null</span>) {
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">final</span> leftShoulder = pose[Points.leftShoulder].offset.timesSize(size);
    <span class="hljs-keyword">final</span> rightShoulder = pose[Points.rightShoulder].offset.timesSize(size);
    <span class="hljs-comment">// Same for every point.</span>

    _paintLine(canvas, leftShoulder, rightShoulder);
    <span class="hljs-comment">// Same for every line.</span>

    _paintPoint(canvas, leftShoulder);
    _paintPoint(canvas, rightShoulder);
    <span class="hljs-comment">// Same for every point.</span>
  }

  <span class="hljs-keyword">void</span> _paintPoint(Canvas canvas, Offset offset) {
    canvas.drawCircle(offset, _pointRadius, _paint);
  }

  <span class="hljs-keyword">void</span> _paintLine(Canvas canvas, Offset pt1, Offset pt2) {
    canvas.drawLine(pt1, pt2, _paint);
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-built_in">bool</span> shouldRepaint(<span class="hljs-keyword">covariant</span> CustomPainter oldDelegate) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
  }
}

<span class="hljs-keyword">extension</span> <span class="hljs-keyword">on</span> Offset {
  Offset timesSize(Size size) =&gt; Offset(dx * size.width, dy * size.height);
}

<span class="hljs-keyword">abstract</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Points</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> leftShoulder = <span class="hljs-number">11</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> rightShoulder = <span class="hljs-number">12</span>;
  <span class="hljs-comment">// Same for every point.</span>
}
</code></pre>
<h2 data-id="heading-34">🎨 骨架绘制逻辑</h2>
<p>这个类（<code>CameraOverlayPainter</code>）只是从识别结果中<strong>选取所有兴趣点</strong>（points of interest），并用线条<strong>连接相邻的点</strong>。</p>
<p>由于坐标是从 <strong>0 到 1</strong> 的<strong>归一化值</strong>，所以它将这些坐标乘以 <strong><code>size</code></strong>——一个持有当前组件尺寸的参数。因为这个覆盖层（overlay）与摄像头预览是<strong>相同尺寸</strong>的，所以一切都恰到好处。</p>
<hr/>
<h2 data-id="heading-35">🎉 最终成果</h2>
<p>这最终为我们实现了我们想要的效果：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/341325465bb74197a32042037f572606~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmFydmFuTW8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763600595&amp;x-signature=zdjQxj%2BHaQhcy1admKRmNKjqTrQ%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-36">🚀 再次展示已部署的演示 (Deployed Demo Once Again)</h2>
<p>这是已部署的演示应用链接：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Falexeyinkin.github.io%2Fflutter-mediapipe%2F" target="_blank" title="https://alexeyinkin.github.io/flutter-mediapipe/" ref="nofollow noopener noreferrer">alexeyinkin.github.io/flutter-med…</a></p>
<hr/>
<h2 data-id="heading-37">🌐 浏览器兼容性 (Browser compatibility)</h2>
<ul>
<li>在 <strong>Chrome 浏览器</strong>中运行良好。</li>
<li>在 <strong>Firefox 144</strong> 中，它由于一个 <strong>camera package 的 bug</strong> 而崩溃，我很快会定位并提交这个问题。</li>
<li>在 <strong>Safari 浏览器</strong>中，它就是无法运行，<strong>没有任何明显的症状或错误信息</strong>。如果你知道问题出在哪里，请告诉我。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS preview 预览文件 Kit 的入门讲解]]></title>    <link>https://juejin.cn/post/7571650164844462114</link>    <guid>https://juejin.cn/post/7571650164844462114</guid>    <pubDate>2025-11-13T00:27:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571650164844462114" data-draft-id="7571650164844445730" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS preview 预览文件 Kit 的入门讲解"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-13T00:27:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="万少"/> <meta itemprop="url" content="https://juejin.cn/user/4441682708283191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS preview 预览文件 Kit 的入门讲解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4441682708283191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    万少
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.5 如鱼得水
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.5 如鱼得水" title="VIP.5 如鱼得水" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-13T00:27:59.000Z" title="Thu Nov 13 2025 00:27:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"/>
<p>本文以实际工程为例，快速上手 HarmonyOS <strong>元服务</strong> 的文件预览能力（PreviewKit），并配套一个后端用于提供示例文件。示例工程路径：</p>
<ul>
<li>客户端（HarmonyOS 端）：<code>client</code></li>
<li>后端（Node.js）：<code>server</code></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/483497220a0e4dab90956bf83e31c2b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763598479&amp;x-signature=8Glr9vfT23NNTaxvWoJD0GcGCQo%3D" alt="image-20251112090708795" loading="lazy"/></p>
<p>image-20251112090708795</p>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/509d3edb0c894064a95fa57bc8455e7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763598479&amp;x-signature=Pr%2BoGCJw90X%2BbVE60gOJf03Bmtk%3D" alt="image-20251112091151694" loading="lazy"/></p>
<p>image-20251112091151694</p>
<p>上图是将 1个pdf文件和3个图片一起预览，那么就只会现实第1个预览窗口。</p>
<p><strong>下图是移除pdf文件，将3个同类型的图片放在一起预览</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf61a49902b74a4eb3a63d5ddebce9d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763598479&amp;x-signature=dgmkow8C39Y8pshx%2Bc8aBXfvA6s%3D" alt="image-20251112091518239" loading="lazy"/></p>
<p>image-20251112091518239</p>
<hr/>
<p><strong>为了方便演示功能，需要先将一些可以预览的文件下载到元服务的沙箱内，是基于这个原因我们才需要引入后端来模拟这个下载的环境，所以元服务内需要先实现下载文件，存储到沙箱，然后再使用预览API filePreview.openPreview预览沙箱内的文件。</strong></p>
<h3 data-id="heading-1">1. 工程结构与目标</h3>
<ul>
<li><code>client/entry/src/main/ets/pages/Index.ets</code>：演示并发下载 4 个文件（<code>1.pdf</code>、<code>1.png</code>、<code>2.png</code>、<code>3.png</code>）并一次性预览。</li>
<li><code>server/index.js</code> 与 <code>server/public/</code>：提供静态文件下载接口 <code>/file/:filename</code>。</li>
</ul>
<p>目标：</p>
<ul>
<li>点击“下载”按钮，并发下载上述 4 个文件到应用沙箱目录。</li>
<li>下载成功后点击“预览”，一次性打开最多 4 个文件的预览窗口。</li>
</ul>
<hr/>
<h3 data-id="heading-2">2. PreviewKit 的核心：filePreview.openPreview</h3>
<p>HarmonyOS 提供了预览能力包 <code>@kit.PreviewKit</code>。在 ETS 代码中引入：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { filePreview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PreviewKit'</span>;
<span class="hljs-keyword">import</span> { fileUri } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;
</code></pre>
<p>核心调用是：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 先准备多个文件的预览信息</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">prewList</span>: filePreview.<span class="hljs-property">PreviewInfo</span>[] = []
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) {
  <span class="hljs-keyword">const</span> item = <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastDownloadedList</span>[i];
  <span class="hljs-keyword">const</span> <span class="hljs-attr">fileInfo</span>: filePreview.<span class="hljs-property">PreviewInfo</span> = {
    <span class="hljs-attr">title</span>: item.<span class="hljs-property">name</span>,                                  <span class="hljs-comment">// 预览标题</span>
    <span class="hljs-attr">uri</span>: fileUri.<span class="hljs-title function_">getUriFromPath</span>(item.<span class="hljs-property">path</span>),            <span class="hljs-comment">// 将沙箱路径转成 Uri</span>
    <span class="hljs-attr">mimeType</span>: item.<span class="hljs-property">mime</span> || <span class="hljs-string">'application/octet-stream'</span>, <span class="hljs-comment">// MIME 类型</span>
  };
  prewList.<span class="hljs-title function_">push</span>(fileInfo)
}

<span class="hljs-comment">// 一次性打开多个预览窗口</span>
filePreview.<span class="hljs-title function_">openPreview</span>(uiContext, prewList)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 打开成功</span>
  })
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {
    <span class="hljs-comment">// 打开失败处理</span>
  });
</code></pre>
<p>说明：</p>
<ul>
<li><code>PreviewInfo</code> 至少需要 <code>title</code>、<code>uri</code>、<code>mimeType</code>。</li>
<li><code>uri</code> 使用 <code>fileUri.getUriFromPath(沙箱文件路径)</code> 构造。</li>
<li>支持一次性传入一个 <code>PreviewInfo[]</code>，实现多文件预览。</li>
</ul>
<blockquote>
<p>图片占位：请补充一次性预览 4 个文件的窗口布局截图，标注窗口标题与 MIME 类型展示位置。</p>
</blockquote>
<hr/>
<h3 data-id="heading-3">3. 并发下载与状态反馈（客户端）</h3>
<p>示例使用 <code>Promise.allSettled</code> 并发下载 4 个后端文件，并按项展示“成功/失败”状态：</p>
<pre><code class="hljs language-ini" lang="ini">// 计划 + 状态
@Local private plannedFiles: DownloadPlan<span class="hljs-section">[]</span> = <span class="hljs-section">[]</span><span class="hljs-comment">;</span>
@Local private itemStatuses: string<span class="hljs-section">[]</span> = <span class="hljs-section">[]</span><span class="hljs-comment">;</span>
@Local private isDownloading: <span class="hljs-attr">boolean</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
@Local private statusMessage: <span class="hljs-attr">string</span> = <span class="hljs-string">''</span><span class="hljs-comment">;</span>

// 初始化计划（aboutToAppear）
<span class="hljs-attr">this.plannedFiles</span> = [
  new DownloadPlan(<span class="hljs-string">'1.pdf'</span>, `<span class="hljs-variable">${this.serverBase}</span>/<span class="hljs-number">1</span>.pdf`),
  new DownloadPlan(<span class="hljs-string">'1.png'</span>, `<span class="hljs-variable">${this.serverBase}</span>/<span class="hljs-number">1</span>.png`),
  new DownloadPlan(<span class="hljs-string">'2.png'</span>, `<span class="hljs-variable">${this.serverBase}</span>/<span class="hljs-number">2</span>.png`),
  new DownloadPlan(<span class="hljs-string">'3.png'</span>, `<span class="hljs-variable">${this.serverBase}</span>/<span class="hljs-number">3</span>.png`)
]<span class="hljs-comment">;</span>
<span class="hljs-attr">this.itemStatuses</span> = [<span class="hljs-string">'未下载'</span>,<span class="hljs-string">'未下载'</span>,<span class="hljs-string">'未下载'</span>,<span class="hljs-string">'未下载'</span>]<span class="hljs-comment">;</span>

// 点击“下载”
<span class="hljs-attr">this.isDownloading</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
<span class="hljs-attr">this.statusMessage</span> = <span class="hljs-string">'下载中...'</span><span class="hljs-comment">;</span>
<span class="hljs-attr">this.itemStatuses</span> = new Array(this.plannedFiles.length).fill(<span class="hljs-string">'下载中...'</span>)<span class="hljs-comment">;</span>

const promises: Promise&lt;DownloadInfo&gt;<span class="hljs-section">[]</span> = this.plannedFiles.map(<span class="hljs-attr">p</span> =&gt; this.downloadFile(p.url))<span class="hljs-comment">;</span>
const <span class="hljs-attr">settled</span> = await Promise.allSettled(promises)<span class="hljs-comment">;</span>

// 汇总结果并一次性触发 UI 刷新
const successes: DownloadInfo<span class="hljs-section">[]</span> = <span class="hljs-section">[]</span><span class="hljs-comment">;</span>
const nextStatuses: string<span class="hljs-section">[]</span> = new Array(this.plannedFiles.length).fill('未下载')<span class="hljs-comment">;</span>
for (let <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; settled.length; i++) {</span>
  const <span class="hljs-attr">name</span> = this.plannedFiles[i].name<span class="hljs-comment">;</span>
  const <span class="hljs-attr">r</span> = settled[i]<span class="hljs-comment">;</span>
  if (<span class="hljs-attr">r.status</span> === <span class="hljs-string">'fulfilled'</span>) {
    successes.push(r.value)<span class="hljs-comment">;</span>
    nextStatuses<span class="hljs-section">[i]</span> = `✓ 下载成功：${name}`<span class="hljs-comment">;</span>
  } else {
    nextStatuses<span class="hljs-section">[i]</span> = `✗ 下载失败：${name}（${this.errorToString(r.reason as Object)}）`<span class="hljs-comment">;</span>
  }
}
<span class="hljs-attr">this.itemStatuses</span> = nextStatuses<span class="hljs-comment">; // 重新赋值以触发 UI 刷新</span>
<span class="hljs-attr">this.lastDownloadedList</span> = successes<span class="hljs-comment">;</span>
<span class="hljs-attr">this.isDownloading</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
</code></pre>
<p>UI 渲染建议：</p>
<ul>
<li>使用 <code>ForEach(this.plannedFiles, ...)</code> 动态渲染状态行，避免硬编码索引。</li>
<li>将与 UI 绑定的字段用 <code>@Local</code> 或 <code>@State</code> 修饰，并“重新赋值数组”以触发刷新（不要在原数组上就地修改元素）。</li>
</ul>
<blockquote>
<p>图片占位：请补充“下载中→成功/失败”逐项状态变化的截图，便于读者理解响应式刷新。</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">4. HTTP 下载的细节与 ArkTS 限制规避</h3>
<ul>
<li>MIME 与扩展名：示例通过扩展名推断 MIME，若扩展名缺失则从响应头的 <code>Content-Type</code> 推断。</li>
<li>ArkTS 限制：不建议直接 <code>data.header['Content-Type']</code> 索引；示例使用序列化 + 正则方式提取避免 ArkTS 索引限制。</li>
</ul>

<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 通过序列化响应头并用正则提取 Content-Type</span>
<span class="hljs-keyword">private</span> <span class="hljs-title function_">tryGetContentTypeHeader</span>(<span class="hljs-attr">headerObj</span>: <span class="hljs-title class_">Object</span> | <span class="hljs-literal">null</span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">if</span> (!headerObj) <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> json = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(headerObj);
    <span class="hljs-keyword">if</span> (!json) <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
    <span class="hljs-keyword">const</span> match = json.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/"content-type"\s*:\s*"([^"]+)"/i</span>);
    <span class="hljs-keyword">return</span> match &amp;&amp; match.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span> ? match[<span class="hljs-number">1</span>] : <span class="hljs-string">''</span>;
  } <span class="hljs-keyword">catch</span> (_) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
  }
}
</code></pre>
<p>保存文件：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">filePath</span> = `<span class="hljs-variable">${this.filesDir}</span>/<span class="hljs-variable">${fileName}</span>`<span class="hljs-comment">;</span>
if (fileIo.accessSync(filePath)) {
  fileIo.unlinkSync(filePath)<span class="hljs-comment">;</span>
}
const <span class="hljs-attr">file</span> = fileIo.openSync(filePath, fileIo.OpenMode.CREATE | fileIo.OpenMode.WRITE_ONLY)<span class="hljs-comment">;</span>
const <span class="hljs-attr">bytesWritten</span> = fileIo.writeSync(file.fd, fileBuffer)<span class="hljs-comment">;</span>
fileIo.closeSync(file)<span class="hljs-comment">;</span>
</code></pre>
<p>权限：</p>
<ul>
<li>客户端需要在 <code>entry/src/main/module.json5</code> 声明 <code>ohos.permission.INTERNET</code> 才能进行网络请求。</li>
</ul>
<hr/>
<h3 data-id="heading-5">5. 后端：简单的静态文件下载接口</h3>
<p>示例后端路径：<code>d:\code\atoStudy\server</code>，目录 <code>public/</code> 放置 4 个演示文件。</p>
<p>核心路由：<code>GET /file/:filename</code></p>
<p>后端的简单目录结构：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/210e1a1877be4e7d948065c20a241e8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763598479&amp;x-signature=HCXQ0zRM6%2FTsE8T4irga3k6Uva0%3D" alt="image-20251112092243514" loading="lazy"/></p>
<p>image-20251112092243514</p>
<pre><code class="hljs language-ini" lang="ini">// index.js（简版示例）
const <span class="hljs-attr">express</span> = require(<span class="hljs-string">'express'</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">path</span> = require(<span class="hljs-string">'path'</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">app</span> = express()<span class="hljs-comment">;</span>

app.get('/file/:filename', (req, res) =&gt; {
  const <span class="hljs-attr">filename</span> = req.params.filename<span class="hljs-comment">;</span>
  const <span class="hljs-attr">filePath</span> = path.join(__dirname, <span class="hljs-string">'public'</span>, filename)<span class="hljs-comment">;</span>
  res.sendFile(filePath)<span class="hljs-comment">; // 或根据需要设置 Content-Type</span>
})<span class="hljs-comment">;</span>

app.listen(3000, () =&gt; {
  console.log('Server listening on http://localhost:3000')<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<p>客户端请求地址示例：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> serverBase: <span class="hljs-built_in">string</span> = <span class="hljs-string">"http://192.168.5.2:3000/file"</span>;
<span class="hljs-comment">// 组合完整 URL 示例：`${this.serverBase}/1.pdf`</span>
</code></pre>
<blockquote>
<p>注意：请按真实局域网 IP 替换 <code>192.168.5.2</code>，并保证手机/模拟器与后端在同一网络。</p>
</blockquote>
<hr/>
<h3 data-id="heading-6">6. 快速运行与验证</h3>
<p>后端：</p>
<ul>
<li>安装依赖并启动：<code>npm install &amp;&amp; node index.js</code></li>
<li>确认 <code>public/</code> 下存在 <code>1.pdf</code>、<code>1.png</code>、<code>2.png</code>、<code>3.png</code></li>
</ul>
<p>客户端：</p>
<ul>
<li>在 <code>module.json5</code> 中确保已声明 <code>ohos.permission.INTERNET</code></li>
<li>构建并安装到设备/模拟器</li>
<li>点击“下载”，观察逐项状态变化</li>
<li>下载成功后点击“预览”，验证多窗口预览是否正常</li>
</ul>
<blockquote>
<p>图片占位：请补充上述过程的关键截图（如“权限声明处”、“下载成功状态”、“多窗口预览”）。</p>
</blockquote>
<hr/>
<h3 data-id="heading-7">7. 常见问题与排查</h3>
<ul>
<li>权限错误（如 code=201 / “Permission denied”）：检查 <code>ohos.permission.INTERNET</code> 是否声明；确认真机/模拟器的网络可达性。</li>
<li>404 或下载失败：确认后端路由 <code>/file/:filename</code> 存在且文件确实在 <code>public/</code> 目录内；检查客户端 <code>serverBase</code> 地址是否正确。</li>
<li>MIME 与扩展名错配：优先使用后端返回的 <code>Content-Type</code>；如果缺失，则按扩展名推断。</li>
<li>UI 不刷新：在 ArkUI 中对数组进行“重新赋值”来触发刷新，避免原地修改元素（例如使用 <code>this.itemStatuses = [...nextStatuses]</code>）。</li>
</ul>
<hr/>
<h3 data-id="heading-8">8. 小结</h3>
<p><code>filePreview.openPreview</code> 是 HarmonyOS 文件预览能力的核心，支持一次性打开多文件预览。结合简单的后端静态文件服务与并发下载、响应式状态刷新，能够快速搭建一个“下载即预览”的演示工程。本文的示例工程完整覆盖了从后端文件提供、客户端下载与保存、到预览窗口打开的关键路径，适合作为入门教程与二次扩展的基础。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于LLM 的 RAG 应用开发实战]]></title>    <link>https://juejin.cn/post/7572161976593596468</link>    <guid>https://juejin.cn/post/7572161976593596468</guid>    <pubDate>2025-11-14T07:46:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572161976593596468" data-draft-id="7572141390857895936" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于LLM 的 RAG 应用开发实战"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-11-14T07:46:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="海尔智慧家技术平台"/> <meta itemprop="url" content="https://juejin.cn/user/3848721122725016"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于LLM 的 RAG 应用开发实战
            <!----> <!----></h1> <div class="container team-follow" data-v-d326b38e="" data-v-61fb5e44=""><div class="left" data-v-d326b38e=""><a href="/team/7156434854350389283/posts" data-v-d326b38e=""><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a4176c1a2e0b4e1b986f105126840cc9~tplv-k3u1fbpfcp-watermark.image?" class="icon" data-v-d326b38e=""/></a> <div class="content" data-v-d326b38e=""><div style="display: flex" data-v-d326b38e=""><a href="/team/7156434854350389283/posts" data-v-d326b38e=""><p class="title-line" data-v-d326b38e=""><span title="三翼鸟数字化技术团队" class="title" data-v-d326b38e="">三翼鸟数字化技术团队</span> <img src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/255e400027b783cbad76dc41527e7695.svg" alt="team icon" class="team-icon" data-v-d326b38e=""/></p></a></div> <div class="meta-box team" data-v-d326b38e="" data-v-61fb5e44=""><time datetime="2025-11-14T07:46:32.000Z" title="Fri Nov 14 2025 07:46:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-d326b38e="" data-v-61fb5e44="">
                2025-11-14
              </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-d326b38e="" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/></svg> <span class="views-count" style="display:none;" data-v-d326b38e="" data-v-61fb5e44="">
                0
              </span> <span class="read-time" data-v-d326b38e="" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-d326b38e="" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-d326b38e="" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-d326b38e="" data-v-61fb5e44=""/></svg>
                阅读9分钟
              </span> <!----> <!----></div></div></div> <button class="jj-follow-button follow-btn" style="display:none;" data-v-b60b2868="" data-v-d326b38e=""><span data-v-b60b2868="" data-v-d326b38e=""><i class="byte-icon byte-icon--plus" data-v-d326b38e=""><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 48 48"><path fill="none" d="M0 0h48v48H0z"/><path d="M24.7 4c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8V22h16.7c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8v1.4c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1H26v16.7c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1h-1.4c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8V26H5.3c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8v-1.4c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1H22V5.3c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1h1.4z"/></svg></i>
        关注
      </span></button></div> <div class="team-user block-hidden" data-v-61fb5e44=""><div class="avatar jj-avatar avatar" data-v-03256cc6="" data-v-61fb5e44=""><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="avatar" class="lazy avatar-img" data-v-5244ef91="" data-v-03256cc6=""/> </div> <!----> <span class="position ellipsis" data-v-61fb5e44="">
              @海尔优家智能科技（北京）有限公司
            </span></div> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"> 1. RAG 是什么</h2>
<p>在大模型应用领域，RAG（Retrieval-Augmented Generation，检索增强生成） 是一种将信息检索技术与大语言模型（LLM）的文本生成能力相结合的技术框架。它的核心目标是通过引入外部知识源来增强大模型生成内容的准确性、相关性和时效性，同时解决大模型固有的局限性（如知识幻觉、静态知识、缺乏领域专长等）。</p>
<h2 data-id="heading-1">2. RAG 工作原理</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae9c5f7719fb4370a61c2d687d646af8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW35bCU5pm65oWn5a625oqA5pyv5bmz5Y-w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763711191&amp;x-signature=JYJjGhaiGVumA9kf3wSy7%2FUy060%3D" alt="image.png" loading="lazy"/></p>
<p>RAG 的工作流程通常分为两个关键阶段：</p>
<ol>
<li>
<p><strong>检索（Retrieval）：</strong></p>
<ol>
<li>当用户输入一个查询（Query）时，RAG 系统首先会利用这个查询去搜索一个外部知识库。</li>
<li>这个知识库可以是：文档数据库、维基百科、企业内部文档、产品手册、代码库、知识图谱等任何结构化和非结构化数据。</li>
<li>检索过程通常使用语义搜索技术（如基于向量的相似度搜索，例如使用 OpenAI Embeddings 或 Sentence Transformers 等模型将文本转换为向量）。系统会找出与用户查询在语义上最相关的文本片段（Chunks）或文档。</li>
<li>检索的结果是一组最相关的信息片段。</li>
</ol>
</li>
<li>
<p><strong>增强生成（Augmented Generation）：</strong></p>
<ol>
<li>检索到的相关片段（作为“证据”或“上下文”）会被注入到发送给大语言模型（LLM）的提示（Prompt）中。</li>
<li>原始的查询 + 检索到的上下文信息共同构成了一个新的、信息更丰富的提示。</li>
<li>LLM 基于这个包含相关上下文的增强提示来生成最终的回答。</li>
<li>LLM 在生成时，会综合利用自身学到的通用知识以及提示中提供的具体外部信息。</li>
</ol>
</li>
</ol>
<h2 data-id="heading-2">3. RAG 的核心价值与优势</h2>
<ul>
<li>减少幻觉（Hallucination）：通过提供相关证据作为生成依据，极大降低了模型凭空捏造事实的可能性。生成的答案更倾向于基于提供的上下文。</li>
<li>知识更新与时效性：大模型的知识在训练完成后就固定了（截止到训练数据日期）。RAG 允许模型访问最新的、动态更新的外部知识库，使其能回答关于新事件、新研究、新产品的提问。</li>
<li>增强领域专业知识：可以将特定领域的专有知识（公司内部文档、技术手册、研究报告）注入到模型中，让通用大模型具备该领域的专业解答能力，而无需耗费巨大成本对整个模型进行微调（Fine-tuning）。</li>
<li>提高透明度和可验证性：因为答案是基于检索到的上下文生成的，系统可以追踪答案的来源（引用了哪个文档的哪一部分），提高了生成结果的可信度和可验证性。</li>
<li>成本效益：相对于微调一个大型模型（需要大量标注数据和计算资源），构建和维护一个检索知识库通常成本更低、更灵活。</li>
<li>处理私有/敏感数据：私有数据可以安全地存储在本地知识库中，无需上传到云端模型的训练服务器。RAG 在推理时按需检索这些数据，增强了隐私性和安全性。</li>
</ul>
<h2 data-id="heading-3">4. RAG 应用场景</h2>
<ul>
<li>企业内部知识库问答：回答基于特定文档集合（如产品手册、公司制度、技术文档）的问题。</li>
<li>客服问答系统：准确回答用户关于产品、服务、订单等具体问题，引用官方信息。</li>
<li>研究助手：帮助研究人员从大量论文、报告中查找和总结相关信息。</li>
<li>内容摘要：生成基于特定来源（如长报告、会议记录）的摘要。</li>
<li>代码助手：检索相关的 API 文档、代码片段来辅助生成或解释代码。</li>
</ul>
<h2 data-id="heading-4">5. 向量和向量数据库</h2>
<p>在构建 RAG（检索增强生成）系统之前，理解向量（Vector）和向量数据库（Vector Database）至关重要。向量数据库也是 RAG 的核心引擎，直接影响系统的性能和准确性。</p>
<h3 data-id="heading-5">5.1 向量是什么</h3>
<ul>
<li>向量是一组有序的数字序列（例如 <code>[0.2, -0.7, 1.4, ..., 0.05]</code>），用于在高维空间（如 768 维或 1536 维）中表示文本、图像或音频的语义特征。</li>
<li>由 嵌入模型（Embedding Model） 生成，模型将数据映射到数学空间（如 OpenAI 的 <code>text-embedding-3-small</code>）。</li>
</ul>
<h3 data-id="heading-6">5.2 向量为什么能表示语义</h3>
<ul>
<li>
<p>相似语义 ≈ 邻近向量，例如：</p>
<ul>
<li>“猫” 的向量 ≈ “猫咪” 的向量（余弦相似度 &gt;0.9）</li>
<li>“苹果” (水果) 的向量 ≠ “苹果” (公司) 的向量</li>
</ul>
</li>
<li>
<p>每个维度隐含抽象特征。例如：维度1可能表示“情感极性”，维度2表示“专业领域强度”。</p>
</li>
</ul>
<h3 data-id="heading-7">5.3 向量在 RAG 中的核心作用</h3>
<ol>
<li>
<p><strong>数据索引阶段</strong></p>
<ol>
<li>文本分块（Chunking）：将 文本、PDF等原始数据拆分为 512~1024 字符的文本块。</li>
<li>向量化（Embedding）：使用嵌入模型为每个块生成向量（如 <code>text-embedding-3-small</code> 输出 1536 维向量）。</li>
<li>索引构建：向量 + 元数据存入向量数据库。</li>
</ol>
</li>
<li>
<p><strong>检索阶段</strong></p>
<ol>
<li>查询向量化：用户问题 → 向量 <code>V_q</code>。</li>
<li>语义搜索：计算 <code>V_q</code> 与知识库所有向量的余弦相似度，返回 Top-5 最相关文本块。</li>
<li>关键优化：重排序（Reranking）：用交叉编码器（如 <code>bge-reranker</code>）精排 Top 结果，提升相关性。</li>
</ol>
</li>
</ol>
<h3 data-id="heading-8">5.4 向量数据库</h3>
<p>向量数据库是专为处理向量数据（多维数值数组）设计的数据库，核心功能是通过相似性搜索快速找到与目标向量最接近的数据。</p>
<p><strong>主要功能：</strong></p>
<ol>
<li><strong>高效存储：</strong> 管理海量高维向量（如AI模型生成的文本/图像嵌入向量）。</li>
<li><strong>相似性检索：</strong> 基于语义或特征匹配，实现“以图搜图”“语义搜索”等场景。</li>
<li><strong>支持AI应用：</strong> 为生成式AI（如RAG技术）、推荐系统、异常检测提供实时数据支撑。</li>
</ol>
<h4 data-id="heading-9">5.4.1 主流向量数据库</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6dc9697035164ccb903009548a1230ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW35bCU5pm65oWn5a625oqA5pyv5bmz5Y-w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763711191&amp;x-signature=s7PUKickM1Jjb1Kl2%2FGQH4nJRmY%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-10">5.4.2 Milvus 向量数据库基础用法</h4>
<h5 data-id="heading-11">基于 Docker 部署</h5>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># Download the configuration file</span>
<span class="hljs-variable">$ </span>wget <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/github.com/milvus</span>-io/milvus/releases/download/v2.<span class="hljs-number">6.0</span>/milvus-standalone-docker-compose.yml -O docker-compose.yml
<span class="hljs-comment"># Start Milvus</span>
<span class="hljs-variable">$ </span>sudo docker compose up -d
</code></pre>
<h5 data-id="heading-12">创建数据库</h5>
<pre><code class="hljs language-ini" lang="ini">from pymilvus import MilvusClient

<span class="hljs-attr">client</span> = MilvusClient(
    <span class="hljs-attr">uri</span>=<span class="hljs-string">"http://localhost:19530"</span>,
    <span class="hljs-attr">token</span>=<span class="hljs-string">"root:Milvus"</span>
)

client.create_database(
    <span class="hljs-attr">db_name</span>=<span class="hljs-string">"my_database_1"</span>
)
</code></pre>
<h5 data-id="heading-13">创建 Collections</h5>
<pre><code class="hljs language-ini" lang="ini">from pymilvus import MilvusClient, DataType

<span class="hljs-attr">client</span> = MilvusClient(
    <span class="hljs-attr">uri</span>=<span class="hljs-string">"http://localhost:19530"</span>,
    <span class="hljs-attr">token</span>=<span class="hljs-string">"root:Milvus"</span>
)

<span class="hljs-comment"># Create schema</span>
<span class="hljs-attr">schema</span> = MilvusClient.create_schema(
    <span class="hljs-attr">auto_id</span>=<span class="hljs-literal">False</span>,
    <span class="hljs-attr">enable_dynamic_field</span>=<span class="hljs-literal">True</span>,
)

<span class="hljs-comment"># Add fields to schema</span>
schema.add_field(<span class="hljs-attr">field_name</span>=<span class="hljs-string">"my_id"</span>, datatype=DataType.INT64, is_primary=<span class="hljs-literal">True</span>)
schema.add_field(<span class="hljs-attr">field_name</span>=<span class="hljs-string">"my_vector"</span>, datatype=DataType.FLOAT_VECTOR, dim=<span class="hljs-number">5</span>)
schema.add_field(<span class="hljs-attr">field_name</span>=<span class="hljs-string">"my_varchar"</span>, datatype=DataType.VARCHAR, max_length=<span class="hljs-number">512</span>)

<span class="hljs-comment"># Prepare index parameters</span>
<span class="hljs-attr">index_params</span> = client.prepare_index_params()

<span class="hljs-comment"># Add indexes</span>
index_params.add_index(
    <span class="hljs-attr">field_name</span>=<span class="hljs-string">"my_id"</span>,
    <span class="hljs-attr">index_type</span>=<span class="hljs-string">"AUTOINDEX"</span>
)

index_params.add_index(
    <span class="hljs-attr">field_name</span>=<span class="hljs-string">"my_vector"</span>, 
    <span class="hljs-attr">index_type</span>=<span class="hljs-string">"AUTOINDEX"</span>,
    <span class="hljs-attr">metric_type</span>=<span class="hljs-string">"COSINE"</span>
)

<span class="hljs-comment"># Create a collection with the index loaded simultaneously</span>
client.create_collection(
    <span class="hljs-attr">collection_name</span>=<span class="hljs-string">"customized_setup_1"</span>,
    <span class="hljs-attr">schema</span>=schema,
    <span class="hljs-attr">index_params</span>=index_params
)
</code></pre>
<h5 data-id="heading-14">插入实体</h5>
<pre><code class="hljs language-ini" lang="ini">from pymilvus import MilvusClient

<span class="hljs-attr">client</span> = MilvusClient(
    <span class="hljs-attr">uri</span>=<span class="hljs-string">"http://localhost:19530"</span>,
    <span class="hljs-attr">token</span>=<span class="hljs-string">"root:Milvus"</span>
)

<span class="hljs-attr">data</span>=[
    {<span class="hljs-string">"id"</span>: <span class="hljs-number">0</span>, <span class="hljs-string">"vector"</span>: [<span class="hljs-number">0.3580376395471989</span>, -<span class="hljs-number">0.6023495712049978</span>, <span class="hljs-number">0.18414012509913835</span>, -<span class="hljs-number">0.26286205330961354</span>, <span class="hljs-number">0.9029438446296592</span>], <span class="hljs-string">"color"</span>: <span class="hljs-string">"pink_8682"</span>},
    {<span class="hljs-string">"id"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"vector"</span>: [<span class="hljs-number">0.19886812562848388</span>, <span class="hljs-number">0.06023560599112088</span>, <span class="hljs-number">0.6976963061752597</span>, <span class="hljs-number">0.2614474506242501</span>, <span class="hljs-number">0.838729485096104</span>], <span class="hljs-string">"color"</span>: <span class="hljs-string">"red_7025"</span>},
    {<span class="hljs-string">"id"</span>: <span class="hljs-number">2</span>, <span class="hljs-string">"vector"</span>: [<span class="hljs-number">0.43742130801983836</span>, -<span class="hljs-number">0.5597502546264526</span>, <span class="hljs-number">0.6457887650909682</span>, <span class="hljs-number">0.7894058910881185</span>, <span class="hljs-number">0.20785793220625592</span>], <span class="hljs-string">"color"</span>: <span class="hljs-string">"orange_6781"</span>},
]

client.insert(
    <span class="hljs-attr">collection_name</span>=<span class="hljs-string">"quick_setup"</span>,
    <span class="hljs-attr">data</span>=data
)
</code></pre>
<h5 data-id="heading-15">基本向量搜索</h5>
<pre><code class="hljs language-ini" lang="ini">from pymilvus import MilvusClient

<span class="hljs-attr">client</span> = MilvusClient(
    <span class="hljs-attr">uri</span>=<span class="hljs-string">"http://localhost:19530"</span>,
    <span class="hljs-attr">token</span>=<span class="hljs-string">"root:Milvus"</span>
)

<span class="hljs-comment"># Single vector search</span>
<span class="hljs-attr">query_vector</span> = [<span class="hljs-number">0.3580376395471989</span>, -<span class="hljs-number">0.6023495712049978</span>, <span class="hljs-number">0.18414012509913835</span>, -<span class="hljs-number">0.26286205330961354</span>, <span class="hljs-number">0.9029438446296592</span>]
<span class="hljs-attr">res</span> = client.search(
    <span class="hljs-attr">collection_name</span>=<span class="hljs-string">"quick_setup"</span>,
    <span class="hljs-attr">anns_field</span>=<span class="hljs-string">"vector"</span>,
    <span class="hljs-attr">data</span>=[query_vector],
    <span class="hljs-attr">limit</span>=<span class="hljs-number">3</span>,
    <span class="hljs-attr">search_params</span>={<span class="hljs-string">"metric_type"</span>: <span class="hljs-string">"IP"</span>}
)

for hits in res:
    for hit in hits:
        print(hit)
</code></pre>
<h2 data-id="heading-16">6. 构建 RAG 系统</h2>
<h3 data-id="heading-17">6.1 常见的开发框架和平台</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/689ee587cd5a49889b8c590f5b55d31c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW35bCU5pm65oWn5a625oqA5pyv5bmz5Y-w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763711191&amp;x-signature=7vHr81mmrEeIIEDHF6YthfSkdyk%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-18">6.2 项目实战</h3>
<p>基于 RAG 构建智能问答系统，该系统可以根据给定的信息，回答用户关于“火星三日游”的咨询信息。</p>
<h4 data-id="heading-19">6.2.1 准备数据</h4>
<p>使用 Markdown 文档保存“火星三日游”套餐信息。</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 火星三日游套餐分类</span>
<span class="hljs-section">## <span class="hljs-strong">**套餐一：赤焰挑战者套餐**</span></span>
<span class="hljs-strong">**主题**</span>：极限探险
<span class="hljs-strong">**目标人群**</span>：冒险爱好者/年轻旅行者
<span class="hljs-strong">**核心卖点**</span>：太阳系最高火山速降 + 翼装穿越峡谷
<span class="hljs-strong">**三日行程**</span>：
<span class="hljs-bullet">-</span> <span class="hljs-strong">**Day1**</span>
<span class="hljs-bullet">  -</span> 奥林匹斯山磁力靴速降（2.1万米垂直落差）
<span class="hljs-bullet">  -</span> 夜宿熔岩管洞穴零重力睡眠舱
<span class="hljs-bullet">-</span> <span class="hljs-strong">**Day2**</span>
<span class="hljs-bullet">  -</span> 水手谷翼装穿越沙暴
<span class="hljs-bullet">  -</span> 尘魔旋风追击战（驾驶沙地战车）
<span class="hljs-bullet">-</span> <span class="hljs-strong">**Day3**</span>
<span class="hljs-bullet">  -</span> 地核钻井平台攀岩（采集氦-3晶体）
<span class="hljs-bullet">  -</span> 磁轨弹射器返回轨道站
<span class="hljs-strong">**客服触发关键词**</span>：刺激, 挑战, 独家体验
<span class="hljs-strong">**推荐话术**</span>：
<span class="hljs-quote">&gt; “检测到您追求肾上腺素飙升！推荐『赤焰套餐』：</span>
<span class="hljs-quote">&gt; - 死亡概率0.7%的火山速降（附NASA急救包）</span>
<span class="hljs-quote">&gt; - 将名字永久刻在火星登陆纪念碑”</span>

<span class="hljs-section">## <span class="hljs-strong">**套餐二：星火实验室套餐**</span></span>
<span class="hljs-strong">**主题**</span>：亲子科普
<span class="hljs-strong">**目标人群**</span>：6-15岁亲子家庭
<span class="hljs-strong">**核心卖点**</span>：基因编辑生命体 + 穹顶城建造
<span class="hljs-strong">**三日行程**</span>：
<span class="hljs-bullet">-</span> <span class="hljs-strong">**Day1**</span>
<span class="hljs-bullet">  -</span> CRISPR基因工坊（改造荧光土豆）
<span class="hljs-bullet">  -</span> 火星车水冰搜寻任务
<span class="hljs-bullet">-</span> <span class="hljs-strong">**Day2**</span>
<span class="hljs-bullet">  -</span> 熔岩管生态圈设计
<span class="hljs-bullet">  -</span> 火星土壤3D打印昆虫模型
<span class="hljs-bullet">-</span> <span class="hljs-strong">**Day3**</span>
<span class="hljs-bullet">  -</span> 发射自建迷你穹顶城
<span class="hljs-bullet">  -</span> 颁发「火星小科学家」证书
<span class="hljs-strong">**客服触发关键词**</span>：孩子, 学习, 安全
<span class="hljs-strong">**推荐话术**</span>：
<span class="hljs-quote">&gt; “识别到亲子需求！推荐『星火套餐』：</span>
<span class="hljs-quote">&gt; - 儿童卡通版抗辐射服</span>
<span class="hljs-quote">&gt; - 安全指数★★★★★</span>
<span class="hljs-quote">&gt; - 宇宙快递孩子培育的荧光植物回地球”</span>

<span class="hljs-section">## <span class="hljs-strong">**套餐三：红钻VIP套餐**</span></span>
<span class="hljs-strong">**主题**</span>：奢华体验
<span class="hljs-strong">**目标人群**</span>：企业高管/高端客户
<span class="hljs-strong">**核心卖点**</span>：火星土地产权 + 双月音乐会
<span class="hljs-strong">**三日行程**</span>：
<span class="hljs-bullet">-</span> <span class="hljs-strong">**Day1**</span>
<span class="hljs-bullet">  -</span> 悬崖酒店星空下午茶
<span class="hljs-bullet">  -</span> 磁悬浮火星沙画创作
<span class="hljs-bullet">-</span> <span class="hljs-strong">**Day2**</span>
<span class="hljs-bullet">  -</span> 双月全息声光秀
<span class="hljs-bullet">  -</span> 氦-3矿物温泉疗愈
<span class="hljs-bullet">-</span> <span class="hljs-strong">**Day3**</span>
<span class="hljs-bullet">  -</span> 认购1km²火星土地
<span class="hljs-bullet">  -</span> 竖立个人全息纪念雕塑
<span class="hljs-strong">**客服触发关键词**</span>：高端, 独家, 艺术
<span class="hljs-strong">**推荐话术**</span>：
<span class="hljs-quote">&gt; “尊享体验已就绪！选择『红钻套餐』可获得：</span>
<span class="hljs-quote">&gt; - 比尔·盖茨同款悬崖酒店</span>
<span class="hljs-quote">&gt; - 火星土地NFT证书（年涨幅+300%）</span>
<span class="hljs-quote">&gt; - 特权免星际隔离”</span>
&amp;&amp;
<span class="hljs-section"># 火星三日游套餐对比</span>
<span class="hljs-section">## 从多个维度对比火星三日游套餐</span>
<span class="hljs-strong">**维度：体力要求**</span>
<span class="hljs-bullet">-</span> 赤焰挑战者：极高（需体能测试）
<span class="hljs-bullet">-</span> 星火实验室：低（室内为主）
<span class="hljs-bullet">-</span> 红钻VIP：中等（艺术创作为主）

<span class="hljs-strong">**维度：独特权益**</span>
<span class="hljs-bullet">-</span> 赤焰挑战者：登陆纪念碑刻名
<span class="hljs-bullet">-</span> 星火实验室：穹顶城永久展示位
<span class="hljs-bullet">-</span> 红钻VIP：火星土地产权NFT

<span class="hljs-strong">**维度：主要风险**</span>
<span class="hljs-bullet">-</span> 赤焰挑战者：死亡概率0.7%
<span class="hljs-bullet">-</span> 星火实验室：基因污染风险
<span class="hljs-bullet">-</span> 红钻VIP：产权法律纠纷

<span class="hljs-strong">**维度：参考价格**</span>
<span class="hljs-bullet">-</span> 赤焰挑战者：$150,000/人
<span class="hljs-bullet">-</span> 星火实验室：$80,000/人（儿童半价）
<span class="hljs-bullet">-</span> 红钻VIP：$250,000/人

<span class="hljs-strong">**维度：最佳人群**</span>
<span class="hljs-bullet">-</span> 赤焰挑战者：25-40岁冒险者
<span class="hljs-bullet">-</span> 星火实验室：6-15岁亲子家庭
<span class="hljs-bullet">-</span> 红钻VIP：企业高管/情侣
</code></pre>
<h4 data-id="heading-20">6.2.2 基于 LangChain 框架构建</h4>
<h5 data-id="heading-21">数据嵌入及索引</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 导入 HuggingFace 的 Embedding 模型，用于将文本转为向量</span>
from langchain_huggingface import HuggingFaceEmbeddings
<span class="hljs-comment"># 导入文本加载器，用于加载本地 markdown 文本</span>
from langchain_community.document_loaders import TextLoader
<span class="hljs-comment"># 导入 Milvus 向量数据库的适配器</span>
from langchain_milvus.vectorstores import Milvus
<span class="hljs-comment"># 导入 MarkdownHeaderTextSplitter，用于按 markdown 标题分段</span>
from langchain.text_splitter import MarkdownHeaderTextSplitter

<span class="hljs-comment"># 指定 markdown 文件路径</span>
<span class="hljs-attr">markdown_path</span> = <span class="hljs-string">"rag_data.md"</span>
<span class="hljs-comment"># 加载 markdown 文件内容</span>
<span class="hljs-attr">loader</span> = TextLoader(file_path=markdown_path)
<span class="hljs-attr">data</span> = loader.load()

<span class="hljs-comment"># 设置分段规则：按一级标题（#）和二级标题（##）分段</span>
<span class="hljs-attr">headers_to_split_on</span> = [
    (<span class="hljs-string">"#"</span>, <span class="hljs-string">"Section"</span>),      <span class="hljs-comment"># 一级标题作为 Section</span>
    (<span class="hljs-string">"##"</span>, <span class="hljs-string">"Subsection"</span>), <span class="hljs-comment"># 二级标题作为 Subsection</span>
]

<span class="hljs-comment"># 初始化 markdown 分段器，strip_headers=False 表示保留标题内容</span>
<span class="hljs-attr">markdown_splitter</span> = MarkdownHeaderTextSplitter(
    <span class="hljs-attr">headers_to_split_on</span>=headers_to_split_on,
    <span class="hljs-attr">strip_headers</span>=<span class="hljs-literal">False</span>)
<span class="hljs-comment"># 按规则分割文档，得到分段后的文档列表</span>
<span class="hljs-attr">split_docs</span> = markdown_splitter.split_text(data[<span class="hljs-number">0</span>].page_content)

<span class="hljs-comment"># 选择用于生成文本向量的模型，这里用 BAAI/bge-m3</span>
<span class="hljs-attr">model_name</span> = <span class="hljs-string">"BAAI/bge-m3"</span>
<span class="hljs-attr">embeddings</span> = HuggingFaceEmbeddings(
    <span class="hljs-attr">model_name</span>=model_name,
    <span class="hljs-attr">model_kwargs</span>={<span class="hljs-string">'device'</span>: <span class="hljs-string">'cpu'</span>},  <span class="hljs-comment"># 指定在 CPU 上运行</span>
    <span class="hljs-attr">encode_kwargs</span>={<span class="hljs-string">'normalize_embeddings'</span>: <span class="hljs-literal">True</span>}  <span class="hljs-comment"># 向量归一化，便于相似度检索</span>
)

<span class="hljs-comment"># 连接远程 Milvus 向量数据库</span>
<span class="hljs-attr">vector_db</span> = Milvus(
    <span class="hljs-attr">embedding_function</span>=embeddings,  <span class="hljs-comment"># 指定 embedding 方法</span>
    <span class="hljs-attr">collection_name</span>=<span class="hljs-string">"rag_data_collection"</span>,  <span class="hljs-comment"># 集合名称</span>
    <span class="hljs-attr">connection_args</span>={
        "host": "localhost",  <span class="hljs-comment"># Milvus 服务地址</span>
        "port": "19530",
        "user": "root",
        "password": "Milvus"
    },
    <span class="hljs-attr">auto_id</span>=<span class="hljs-literal">True</span>,   <span class="hljs-comment"># 主键自增</span>
    <span class="hljs-attr">drop_old</span>=<span class="hljs-literal">True</span>   <span class="hljs-comment"># 如果已存在同名集合则先删除再新建</span>
)

<span class="hljs-comment"># 将分段后的文档插入到 Milvus 向量数据库中</span>
vector_db.add_documents(<span class="hljs-attr">documents</span>=split_docs)
</code></pre>
<h5 data-id="heading-22">数据检索增强生成</h5>
<pre><code class="hljs language-ini" lang="ini">from langchain_huggingface import HuggingFaceEmbeddings
from langchain_milvus.vectorstores import Milvus
from langchain import hub
from langchain_deepseek import ChatDeepSeek

<span class="hljs-attr">model_name</span> = <span class="hljs-string">"BAAI/bge-m3"</span>
<span class="hljs-attr">embeddings</span> = HuggingFaceEmbeddings(
    <span class="hljs-attr">model_name</span>=model_name,
    <span class="hljs-attr">model_kwargs</span>={<span class="hljs-string">'device'</span>: <span class="hljs-string">'cpu'</span>},
    <span class="hljs-attr">encode_kwargs</span>={<span class="hljs-string">'normalize_embeddings'</span>: <span class="hljs-literal">True</span>}
)

<span class="hljs-comment"># 连接远程 Milvus</span>
<span class="hljs-attr">vector_db</span> = Milvus(
    <span class="hljs-attr">embedding_function</span>=embeddings,
    <span class="hljs-attr">collection_name</span>=<span class="hljs-string">"rag_data_collection"</span>,  <span class="hljs-comment"># 添加集合名称参数</span>
    <span class="hljs-attr">connection_args</span>={
        "host": "localhost",  <span class="hljs-comment"># 确保这是正确的远程地址</span>
        "port": "19530",
        "user": "root",
        "password": "Milvus"
    },
    <span class="hljs-attr">auto_id</span>=<span class="hljs-literal">True</span>,
    <span class="hljs-attr">drop_old</span>=<span class="hljs-literal">False</span>  <span class="hljs-comment"># 首次运行时创建新集合</span>
)


<span class="hljs-attr">llm</span> = ChatDeepSeek(
    <span class="hljs-attr">model</span>=<span class="hljs-string">"deepseek-chat"</span>,
    <span class="hljs-attr">temperature</span>=<span class="hljs-number">0</span>,
    <span class="hljs-attr">max_tokens</span>=None,
    <span class="hljs-attr">timeout</span>=None,
    <span class="hljs-attr">max_retries</span>=<span class="hljs-number">2</span>,
    <span class="hljs-attr">api_key</span>=<span class="hljs-string">"sk-58d35df8d09******fe0243923099b42"</span>,
)

<span class="hljs-attr">prompt</span> = hub.pull(<span class="hljs-string">"rlm/rag-prompt"</span>)

def generate(query: str):
    <span class="hljs-attr">docs_content</span> = vector_db.similarity_search(query, k=<span class="hljs-number">3</span>)
    <span class="hljs-attr">messages</span> = prompt.invoke({<span class="hljs-string">"question"</span>: query, <span class="hljs-string">"context"</span>: docs_content})
    <span class="hljs-attr">response</span> = llm.invoke(messages)
    print({"answer": response.content})

generate("火星三日游有哪些套餐？")
<span class="hljs-comment"># {'answer': '火星三日游提供多种套餐，包括：  \n1. **赤焰挑战者套餐**：极限探险主题，含火山速降、翼装穿越等刺激项目，适合冒险爱好者。  \n2. **红钻VIP套餐**：奢华体验主题，含火星土地产权、双月音乐会等高端服务，适合企业高管。  \n3. **星火实验室套餐**（根据对比表补充）：亲子友好，以室内活动为主，适合家庭游客。'}</span>
generate("从不同维度对比火星三日游套餐")
<span class="hljs-comment"># {'answer': '从不同维度对比火星三日游套餐：  \n1. **体力要求**：赤焰挑战者（极高）、星火实验室（低）、红钻VIP（中等）。  \n2. **独特权益**：赤焰挑战者（登陆纪念碑刻名）、星火实验室（穹顶城展示位）、红钻VIP（火星土地NFT）。  \n3. **价格**：赤焰挑战者（15万美元）、星火实验室（8万美元）、红钻VIP（25万美元）。'}</span>
generate("商务人士适合哪个套餐")
<span class="hljs-comment"># {'answer': '商务人士适合**红钻VIP套餐**，该套餐专为企业高管/高端客户设计，提供奢华体验，包括火星土地产权和双月音乐会等独家权益。其体力要求中等，以艺术创作为主，参考价格为$250,000/人。'}</span>
</code></pre>
<h4 data-id="heading-23">6.2.3 基于 Dify 构建</h4>
<h5 data-id="heading-24">创建知识库，将 markdown 文档保存的“火星三日游”套餐信息导入</h5>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f963cd109f9459f9638effc5e9c09fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW35bCU5pm65oWn5a625oqA5pyv5bmz5Y-w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763711191&amp;x-signature=jUGy2AZVQzzuzBcd%2BlxFE7Cbp5k%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-25">将导入的文本进行分段</h5>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5359e6a82fd14dd4bf671be874a39926~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW35bCU5pm65oWn5a625oqA5pyv5bmz5Y-w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763711191&amp;x-signature=2cUv1ERUQl3CkEk8m02ARrswU2E%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-26">选择文本嵌入模型及检索设置</h5>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af5f2e346ece4867b65117d553ef2c2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW35bCU5pm65oWn5a625oqA5pyv5bmz5Y-w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763711191&amp;x-signature=JGjtnKgCeGccwWmVa%2BAbsTTH7dM%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-27">创建应用</h5>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/817cee89d5504d0a910325a491b57af1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW35bCU5pm65oWn5a625oqA5pyv5bmz5Y-w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763711191&amp;x-signature=BeV7ImYwgboReYeGzyUkjq2ax6M%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-28">添加知识检索节点，并关联刚才创建的知识库</h5>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b8f98408a144e01aa03fe4a3cade0cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW35bCU5pm65oWn5a625oqA5pyv5bmz5Y-w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763711191&amp;x-signature=3w7xbSvx6hwE9opRmvKYboSw7vY%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-29">选择模型，并设置系统提示词</h5>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18a3ac9ffc484b5ea9bba6f0a4338d9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW35bCU5pm65oWn5a625oqA5pyv5bmz5Y-w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763711191&amp;x-signature=AbA5ZZzLbDqPd%2FLkSRi0ZeNB7tw%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-30">运行并测试应用</h5>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/046ffbf3076a4933904e37154acdbbd9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW35bCU5pm65oWn5a625oqA5pyv5bmz5Y-w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763711191&amp;x-signature=wSf7PNQWRwDFym5y4x0dRd4fDHs%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6a25021915644b19f644b352523a744~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW35bCU5pm65oWn5a625oqA5pyv5bmz5Y-w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763711191&amp;x-signature=hOFZ%2BrmUpR5jytQELExwOizWXyQ%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92f6a494134749f6a77e087c21e896ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW35bCU5pm65oWn5a625oqA5pyv5bmz5Y-w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763711191&amp;x-signature=b7O0PkvmaVwrBE5K%2FrRfsAiShrQ%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-31">7. 团队介绍</h2>
<p>「<strong>三翼鸟数字化技术平台-ToC服务平台</strong>」以用户行为数据为基础，利用推荐引擎为用户提供“千人千面”的个性化推荐服务，改善用户体验，持续提升核心业务指标。通过构建高效、智能的线上运营系统，全面整合数据资产，实现数据分析-人群圈选-用户触达-后效分析-策略优化的运营闭环，并提供可视化报表，一站式操作提升数字化运营效率。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SCSS新手教学（知识点概览）]]></title>    <link>https://juejin.cn/post/7572161976593612852</link>    <guid>https://juejin.cn/post/7572161976593612852</guid>    <pubDate>2025-11-14T07:50:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572161976593612852" data-draft-id="7572207610494681122" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SCSS新手教学（知识点概览）"/> <meta itemprop="keywords" content="SCSS"/> <meta itemprop="datePublished" content="2025-11-14T07:50:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="thomaswade"/> <meta itemprop="url" content="https://juejin.cn/user/1514459496722620"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SCSS新手教学（知识点概览）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1514459496722620/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    thomaswade
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T07:50:27.000Z" title="Fri Nov 14 2025 07:50:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>scss：sass3以后的新语法，功能完全等价，语法上{
scss使用大括号，sass使用缩进
}不能混用，会报错
并且scss中可以直接写css</p>
<p><code>Sass</code>有三个版本<code>Dart Sass</code>、<code>libsass</code>和<code>Ruby Sass</code></p>
<p>npm install -g sass 全局安装sass</p>
<p>scss选择器嵌套语法 避免重复输入父选择器，提高开发效率，减少样式覆盖可能造成的异常问题
属性也可以嵌套，例.container {
font: {
family: fantasy;
size: 30em;
weight: bold;
}
}
等价于.container {
font-family: fantasy;
font-size: 30em;
font-weight: bold;
}避免重复输入相同的开头</p>
<p>父选择器&amp; 就是向上找一层，选择上外层的父选择器 用法 &amp;：  即可</p>
<p>注释/*   */编译时会被编译到css文件中
注释//     编译时不会编译到css文件中（scss专属注释）</p>
<p>变量
$ 赋值写法与css相同
{</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-number">1.</span> 变量以美元符号<span class="hljs-string">`$`</span>开头，后面跟变量名；
    
<span class="hljs-number">2.</span> 变量名是不以数字开头的可包含字母、数字、下划线、横线（连接符）；
    
<span class="hljs-number">3.</span> 通过连接符<span class="hljs-string">`-`</span>与下划线<span class="hljs-string">`_`</span>定义的同名变量为同一变量；
    
<span class="hljs-number">4.</span> 变量一定要先定义，后使用；
    
<span class="hljs-number">5.</span> 写法同<span class="hljs-string">`css`</span>，即变量名和值之间用冒号<span class="hljs-string">`:`</span>分隔；
</code></pre>
<p>}</p>
<p>变量作用域：嵌套规则内定义的变量只能在嵌套规则内使用，但声明在最外层的变量可以在任何地方使用，属于全局变量
！global可以将局部变量提升为全局变量</p>
<p>scss数据类型{</p>
<p>number；string；color；boolean；null；数组（用空格或逗号分开）；maps（类似于js的object 键值对）</p>
<p>}</p>
<p>！default“温柔默认值”，如果没有其他赋值，就使用！default所标注的赋值，有其他赋值就当！default不存在</p>
<p>==      !=     正常规则</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-quote">&gt;    &lt;     &gt;=    &lt;=     正常规则   </span>
</code></pre>
<p>and     or     not</p>
<p>加减乘除余（纯数字与百分号或单位运算时会自动转化成相应的百分比与单位值）</p>
<p>加还可连接字符串{</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> <span class="hljs-code">`+`</span>可用于连接字符串；
<span class="hljs-code">    
2. 如果有引号字符串（位于 + 左侧）连接无引号字符串，运算结果是有引号的；
    
3. 无引号字符串（位于 + 左侧）连接有引号字符串，运算结果则没有引号。
</span></code></pre>
<p>}</p>
<p>插值语句#{}     规则与js模版字符串类似</p>
<p>@import 导入文件   以下情况下，<code>@import</code> 仅作为普通的<code>css</code>语句，不会导入<code>scss</code>文件：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-number">1.</span> 文件拓展名是<span class="hljs-string">`.css`</span>；
    
<span class="hljs-number">2.</span> 文件名以 <span class="hljs-string">`http://`</span>开头；
    
<span class="hljs-number">3.</span> 文件名是<span class="hljs-string">`url()`</span>；
    
<span class="hljs-number">4.</span> <span class="hljs-string">`@import`</span>包含媒体查询。
</code></pre>
<p>@media媒体查询增强
<code>@media</code> 指令允许在<code>css</code>规则中嵌套，编译时，<code>@media</code> 将被编译到文件的最外层，包含嵌套的父选择器。
<code>@media</code>允许互相嵌套使用，编译时，<code>scss</code>自动添加 and</p>
<p>mixin  混入  定义可重复使用的样式     例
@mixin block {
width: 96%;
margin-left: 2%;
border-radius: 8px;
border: 1px #f6f6f6 solid;
}
.container {
.block {
@include block;
}
}
还可以传入参数
参数还可制定默认值，调用时携带参数则使用携带的参数，不携带则使用默认值</p>
<p>总结</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-number">1.</span> <span class="hljs-string">`mixin`</span>是可以重复使用的一组<span class="hljs-string">`css`</span>声明，有助于减少重复代码，只需声明一次，就可在文件中引用；
    
<span class="hljs-number">2.</span> 混合指令可以包含所有的 <span class="hljs-string">`css`</span>规则，绝大部分<span class="hljs-string">`scss`</span>规则，可以传递参数，输出多样化的样式；
    
<span class="hljs-number">3.</span> 使用参数时建议加上默认值；
    
<span class="hljs-number">4.</span> <span class="hljs-string">`@import`</span>导入局部模块化样式（类似功能、同一组件）；
    
<span class="hljs-number">5.</span> <span class="hljs-string">`@minix`</span>定义的是可重复使用的样式
</code></pre>
<p>@function 用于封装复杂的操作 用法与mixin类似
@function一般用来计算，而mixin用来封装样式</p>
<p>@extend 继承
@function和@mixin都是封装好一个函数，然后后续调用
而@extend则是写好一个样式后，在要调用这个样式的时候@extend+这个样式
可以使用多个@extend   继承也可以嵌套，实现多层继承</p>
<p>@use 代替 @import</p>
<p>@at-root 用来跳出嵌套进行操作
@without和with
默认<code>@at-root</code>只会跳出选择器嵌套，而不能跳出<code>@media</code>或<code>@support</code>，如果要跳出这两种，则需使用<code>@at-root (without: media)</code>或<code>@at-root (without: support)</code>，<code>@at-root</code>的关键词有四个：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-number">1.</span> <span class="hljs-string">`all`</span>表示所有；
    
<span class="hljs-number">2.</span> <span class="hljs-string">`rule`</span>表示常规<span class="hljs-string">`css`</span>选择器；
    
<span class="hljs-number">3.</span> <span class="hljs-string">`media`</span> 表示<span class="hljs-string">`media`</span>；
    
<span class="hljs-number">4.</span> <span class="hljs-string">`support`</span>表示<span class="hljs-string">`support`</span>（<span class="hljs-string">`@support`</span>主要是用于检测浏览器是否支持<span class="hljs-string">`css`</span>的某个属性）。
</code></pre>
<p>scss内置扩展</p>
<p>color <code>lighten()</code>与 <code>darken()</code>可用于调亮或调暗颜色，<code>opacify()</code>使颜色透明度减少，<code>transparent()</code>使颜色透明度增加，<code>mix()</code>用来混合两种颜色</p>
<p>String 向字符串添加引号的<code>quote()</code>、获取字符串长度的<code>string-length()</code>和将内容插入字符串给定位置的<code>string-insert()</code></p>
<p>math <code>percentage()</code>将无单元的数值转换为百分比，<code>round()</code>将数字四舍五入为最接近的整数，<code>min()</code>和<code>max()</code>获取几个数字中的最小值或最大值，<code>random()</code>返回一个随机数</p>
<p>list <code>length()</code>返回列表长度，<code>nth()</code>返回列表中的特定项，<code>join()</code>将两个列表连接在一起，a<code>ppend()</code>在列表末尾添加一个值</p>
<p><code>Map</code> <code>map-get()</code>根据键值获取<code>map</code>中的对应值，<code>map-merge()</code>来将两个<code>map</code>合并成一个新的<code>map</code>，<code>map-values()</code>映射中的所有值</p>
<p>selector <code>selector-append()</code>可以把一个选择符附加到另一个选择符，<code>selector-unify()</code>将两组选择器合成一个复合选择器</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Next.js路由全解析：Pages Router 与 App Router，你选对了吗？]]></title>    <link>https://juejin.cn/post/7572138663121567786</link>    <guid>https://juejin.cn/post/7572138663121567786</guid>    <pubDate>2025-11-14T07:58:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572138663121567786" data-draft-id="7572137760447987753" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Next.js路由全解析：Pages Router 与 App Router，你选对了吗？"/> <meta itemprop="keywords" content="前端,Next.js"/> <meta itemprop="datePublished" content="2025-11-14T07:58:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大前端历险记"/> <meta itemprop="url" content="https://juejin.cn/user/395479916219517"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Next.js路由全解析：Pages Router 与 App Router，你选对了吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/395479916219517/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大前端历险记
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T07:58:13.000Z" title="Fri Nov 14 2025 07:58:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>大家好，我是大鱼，一名热爱前端的普通开发者。</p>
</blockquote>
<p>今天我们来深入探讨Next.js中两个重要的路由系统：Pages Router和App Router。</p>
<h2 data-id="heading-0">什么是Next.js路由？</h2>
<p>在开始深入比较之前，让我们先简单回顾一下Next.js的路由系统。Next.js使用基于文件系统的路由，这意味着你文件目录的结构决定了你应用程序的路由结构。</p>
<p>多年来，Next.js开发者习惯将页面放置在"pages"目录中，这就是我们所说的<strong>Pages Router</strong>。</p>
<p>后来，Next.js推出了新的<strong>App Router</strong>，显著改变了我们创建页面的方式。</p>
<h2 data-id="heading-1">Pages Router：经典而成熟的选择</h2>
<h3 data-id="heading-2">基本结构</h3>
<p>在Pages Router中，你的项目结构通常是这样：</p>
<pre><code class="hljs language-markdown" lang="markdown">└── pages
<span class="hljs-code">    ├── about.js
    ├── index.js
    └── team.js
</span></code></pre>
<p>每个JavaScript/TypeScript文件对应一个路由，例如<code>pages/about.js</code>对应<code>/about</code>路由。</p>
<h3 data-id="heading-3">特点与使用方式</h3>
<p>Pages Router采用"客户端优先"的思维模式，通过<code>getServerSideProps</code>等函数"拉取"服务端能力。数据获取主要在页面级别，集中在<code>getStaticProps</code>/<code>getServerSideProps</code>中。</p>
<p>在Pages Router中，你可以使用<code>useRouter</code>Hook来实现页面跳转：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/router'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComponent</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>();
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"/>) =&gt; {
    router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/about'</span>);
  };
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleClick}</span>&gt;</span>
      跳转到关于页面
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  );
}
</code></pre>
<p>与浏览器原生的<code>window.location.href</code>赋值不同，使用<code>useRouter</code>的<code>push</code>方法不会导致整个页面的完全重加载，这对性能更加有利。</p>
<h2 data-id="heading-4">App Router：面向未来的新范式</h2>
<h3 data-id="heading-5">基本结构</h3>
<p>App Router引入了全新的目录结构：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">src</span>/
└── app
    ├── about
    │   └── page<span class="hljs-selector-class">.js</span>
    ├── globals<span class="hljs-selector-class">.css</span>
    ├── layout<span class="hljs-selector-class">.js</span>
    ├── login
    │   └── page<span class="hljs-selector-class">.js</span>
    ├── page<span class="hljs-selector-class">.js</span> 
    └── team
        └── route<span class="hljs-selector-class">.js</span>
</code></pre>
<p>创建应用程序的约定如下：</p>
<ul>
<li>应用中的每个页面都有自己的目录，目录名称定义URL路径</li>
<li>浏览器中访问路径时渲染的组件是page.js</li>
<li>每个页面的目录中可以放置几个具有保留名称的文件，如<code>loading.js</code>、<code>template.js</code>和<code>layout.js</code></li>
</ul>
<h3 data-id="heading-6">核心特性</h3>
<h4 data-id="heading-7">服务器组件与客户端组件</h4>
<p>App Router中最重大的变化是：默认情况下，应用程序目录中的任何组件都是<strong>服务器组件</strong>。这意味着：</p>
<ul>
<li><strong>服务器组件</strong>在服务器上呈现，所有代码都保留在服务器上</li>
<li>不能使用客户端功能如window对象或React中的典型钩子</li>
<li>可以通过在文件顶部声明"use client"来声明<strong>客户端组件</strong></li>
</ul>
<h4 data-id="heading-8">布局系统</h4>
<p>App Router原生支持布局，通过<code>layout.js</code>文件实现。布局组件可以应用于多个页面，如果子目录没有单独指定布局，则使用顶级布局。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// layout.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">LoginLayout</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'login-area'</span>&gt;</span>{children}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre>
<p>布局会自动应用于其下的所有页面，无需在页面文件中额外指定。</p>
<h4 data-id="heading-9">数据获取</h4>
<p>App Router引入了组件级数据获取，与Pages Router的页面级数据获取形成鲜明对比。在Server Component中可以直接使用async/await和fetch：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">BlogPost</span>(<span class="hljs-params">{ slug }</span>) {
  <span class="hljs-keyword">const</span> post = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/posts/<span class="hljs-subst">${slug}</span>`</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>());
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">article</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{post.title}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{post.content}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">article</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-10">深度对比：Pages Router vs App Router</h2>
<h3 data-id="heading-11">功能特性对比</h3>



































<table><thead><tr><th>特性</th><th>Pages Router</th><th>App Router</th></tr></thead><tbody><tr><td><strong>默认组件类型</strong></td><td>客户端组件</td><td>服务器组件</td></tr><tr><td><strong>思维模式</strong></td><td>"客户端优先"</td><td>"服务器优先"</td></tr><tr><td><strong>数据获取</strong></td><td>页面级别，集中在getStaticProps/getServerSideProps中</td><td>组件级别，在各个Server Component内部</td></tr><tr><td><strong>布局系统</strong></td><td>通过_app.js和getLayout模式实现，非原生</td><td>原生支持，文件系统结构天然支持嵌套</td></tr><tr><td><strong>客户端JS</strong></td><td>整个页面的所有组件代码都会被发送到客户端</td><td>只有标记为"use client"的组件及其子组件的JS会被发送</td></tr></tbody></table>
<h3 data-id="heading-12">性能对比</h3>
<p>在性能方面，App Router的架构优势是压倒性的。通过默认使用Server Components，它从根本上解决了客户端JavaScript过大的问题。</p>
<h3 data-id="heading-13">学习曲线与生态系统</h3>
<ul>
<li>
<p><strong>Pages Router</strong>：生态系统极其成熟，学习曲线较低，对于有React SPA经验的开发者来说非常熟悉</p>
</li>
<li>
<p><strong>App Router</strong>：生态系统正在快速发展中，学习曲线较高，需要理解Server/Client组件的区别等新概念</p>
</li>
</ul>
<h2 data-id="heading-14">决策指南：如何选择？</h2>
<h3 data-id="heading-15">选择 App Router，如果：</h3>
<ul>
<li>✅ 你正在开始一个全新的项目，没有历史包袱</li>
<li>✅ 性能是你的首要考量，你希望从一开始就构建最快、最轻量的应用</li>
<li>✅ 你的应用有复杂的、嵌套的布局和数据依赖关系</li>
<li>✅ 你的团队乐于学习和拥抱新技术</li>
<li>✅ 你正在构建一个数据密集型、内容驱动的应用（如仪表盘、电商网站、CMS前端）</li>
</ul>
<h3 data-id="heading-16">选择 Pages Router，如果：</h3>
<ul>
<li>🟡 你正在维护或迭代一个现有的、基于Pages Router的项目</li>
<li>🟡 你的项目高度依赖某个尚未完全支持App Router的第三方库</li>
<li>🟡 团队成员对RSC不熟悉，且项目交付时间非常紧张</li>
<li>🟡 你的应用是一个非常简单、以交互为主的轻量级SPA，服务端渲染的需求很低</li>
</ul>
<h3 data-id="heading-17">混合模式的可能性</h3>
<p>Next.js允许你在同一个项目中同时使用<code>app</code>和<code>pages</code>目录。这为渐进式迁移提供了一条平滑的路径。你可以先在现有项目中引入<code>app</code>目录来开发新功能，逐步体验App Router的优势。</p>
<h2 data-id="heading-18">实战建议</h2>
<h3 data-id="heading-19">从Pages Router迁移到App Router</h3>
<p>如果你计划从Pages Router迁移到App Router，可以考虑以下步骤：</p>
<ol>
<li><strong>逐步迁移</strong>：利用混合模式，逐步将页面从pages目录迁移到app目录</li>
<li><strong>组件适配</strong>：将使用React钩子或浏览器API的组件标记为客户端组件</li>
<li><strong>数据获取</strong>：将getStaticProps/getServerSideProps重构为组件级数据获取</li>
<li><strong>布局重构</strong>：利用App Router的布局系统简化你的布局代码</li>
</ol>
<h3 data-id="heading-20">开发技巧</h3>
<ol>
<li><strong>明确组件边界</strong>：在App Router中，要清晰界定服务器组件和客户端组件的职责</li>
<li><strong>利用流式渲染</strong>：App Router支持流式渲染，可以显著提升用户体验</li>
<li><strong>合理使用缓存</strong>：App Router提供了更精细的缓存控制机制</li>
</ol>
<h2 data-id="heading-21">结语</h2>
<p>App Router无疑是Next.js的未来。它通过React Server Components带来的架构革新，在性能、代码组织和开发体验上都提供了巨大的飞跃。对于新项目，除非有特定的生态限制，否则强烈建议从App Router开始。</p>
<p>希望这篇文章能帮助你理解Next.js中两种路由系统的区别，如果你有任何问题，欢迎在评论区留言讨论！</p>
<hr/>
<p><em>作者：大鱼，前端开发者，专注于大前端圈技术栈。欢迎关注我的微信公众号&lt;大前端历险记&gt;获取更多前端技术干货。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[FutureProvider会刷新两次的问题研究]]></title>    <link>https://juejin.cn/post/7572362484658733107</link>    <guid>https://juejin.cn/post/7572362484658733107</guid>    <pubDate>2025-11-14T07:54:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572362484658733107" data-draft-id="7572179176307081225" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="FutureProvider会刷新两次的问题研究"/> <meta itemprop="keywords" content="前端,Flutter"/> <meta itemprop="datePublished" content="2025-11-14T07:54:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="水木程序员"/> <meta itemprop="url" content="https://juejin.cn/user/2272005130029597"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            FutureProvider会刷新两次的问题研究
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2272005130029597/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    水木程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T07:54:53.000Z" title="Fri Nov 14 2025 07:54:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近在项目里面碰到了使用Riverpod的FutureProvider引起的一例屏幕组件闪烁的问题，深入研究了使用FutureProvider可能的存在的问题及规避方法。</p>
<h2 data-id="heading-0">问题复现</h2>
<p>页面里一个组件观察了<code>FutureProviderA</code>，根据<code>FutureProviderA</code> 返回的值决定组件是否展示，<code>FutureProviderA</code> 又<code>watch</code>了<code>FutureProviderB</code>，依赖结构如下</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0030b6222670420a8aad57d7b192aa02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rC05pyo56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763711693&amp;x-signature=hIeRtNxOAJ2O6jniKFJUUBwdpE4%3D" alt="image.png" loading="lazy"/></p>
<p>在app启动的时候，<code>FutureProviderB</code>由于某种原因会刷新很多次导致Widget会闪烁</p>
<p>Widget代码</p>
<pre><code class="hljs language-kotlin" lang="kotlin">child: futureProviderA.<span class="hljs-keyword">when</span>(
      <span class="hljs-keyword">data</span>: (<span class="hljs-keyword">data</span>) {
        <span class="hljs-keyword">return</span> Text(context, <span class="hljs-keyword">data</span>);
      }, error: (Object error, StackTrace stackTrace) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
      }, loading: () {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
      }),
)),
</code></pre>
<p>上面Widget在观察<code>FutureProviderA</code>，在when里面处理了三种情况，只有在data的情况下返回Text组件，其他情况返回null。</p>
<h2 data-id="heading-1">解决方法</h2>
<p>在when里面加一个参数<code>skipLoadingOnReload: true</code>即可。</p>
<p>FutureProvider返回的是AsyncValue，这个类有三种状态</p>
<ul>
<li>loading：代表数据正在加载</li>
<li>data：表示新数据已经加载好了</li>
<li>error：数据加载错误</li>
</ul>
<p>AsyncValue.when方法有两个参数</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">//是否在reload时跳过loading状态，也就是ref.watch的时候，如果watch的对象改变，会导致</span>
<span class="hljs-comment">//当前provider刷新进入loading，此时如果跳过loading状态，就不回调loading，而是</span>
<span class="hljs-comment">//调用error或者data，默认情况下不跳过</span>
<span class="hljs-type">bool</span> skipLoadingOnReload = <span class="hljs-literal">false</span>, 

<span class="hljs-comment">//是否在refresh的情况下跳过loading，也就是ref.invalidate时，provider进入loading状态</span>
<span class="hljs-comment">//此时是否调用loading，默认是跳过，如果没有错误，一般调用data</span>
<span class="hljs-type">bool</span> skipLoadingOnRefresh = <span class="hljs-literal">true</span>, 
</code></pre>
<p>再结合when的源码来看就比较清晰为什么会出现闪烁了，因为skipLoadingOnReload为false，ProviderB刷新了多次，导致进入loading多次，而我们在loading的时候是返回null的，因此会多次闪烁。而把skipLoadingOnReload改成true，在ProviderB刷新的时候，loading态调用的是data，也就是返回实际的组件，因此不会闪烁</p>
<pre><code class="hljs language-ini" lang="ini">R when&lt;R&gt;({
  bool <span class="hljs-attr">skipLoadingOnReload</span> = <span class="hljs-literal">false</span>,
  bool <span class="hljs-attr">skipLoadingOnRefresh</span> = <span class="hljs-literal">true</span>,
  bool <span class="hljs-attr">skipError</span> = <span class="hljs-literal">false</span>,
  required R Function(T data) data,
  required R Function(Object error, StackTrace stackTrace) error,
  required R Function() loading,
}) {
  if (isLoading) {
    bool skip<span class="hljs-comment">;</span>
    if (isRefreshing) {
      <span class="hljs-attr">skip</span> = skipLoadingOnRefresh<span class="hljs-comment">;</span>
    } else if (isReloading) {
      <span class="hljs-attr">skip</span> = skipLoadingOnReload<span class="hljs-comment">;</span>
    } else {
      <span class="hljs-attr">skip</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
    }
    if (!skip) return loading()<span class="hljs-comment">;</span>
  }

  if (hasError &amp;&amp; (!hasValue || !skipError)) {
    return error(this.error!, stackTrace!)<span class="hljs-comment">;</span>
  }

  return data(requireValue)<span class="hljs-comment">;</span>
}
</code></pre>
<h2 data-id="heading-2">FutureProvider导致组件build两次问题</h2>
<p>上面的问题是解决了，但是存在多次调用build的情况，为了解决这个，需要深入了解FutureProvider的使用方法</p>
<p>在下面的例子里面widget观察一个FutureProvider，provider在内部会delay一秒，然后返回true。我们把关键的链路上都加上日志，观察一下FutureProvider的行为</p>
<p>示例代码</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">MyApp</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">StatelessWidget</span> {
  <span class="hljs-selector-tag">MyApp</span>({<span class="hljs-selector-tag">super</span><span class="hljs-selector-class">.key</span>});

  <span class="hljs-comment">///------------数据生产侧-----------------</span>
  <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">futureProvider</span> = <span class="hljs-selector-tag">FutureProvider</span>&lt;<span class="hljs-selector-tag">bool</span>&gt;(
    (ref) async {
      <span class="hljs-selector-tag">print</span>(<span class="hljs-string">'tagtag provider刷新'</span>);
      <span class="hljs-selector-tag">await</span> <span class="hljs-selector-tag">Future</span><span class="hljs-selector-class">.delayed</span>(const <span class="hljs-built_in">Duration</span>(<span class="hljs-attribute">seconds</span>: <span class="hljs-number">1</span>));
      <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">true</span>;
    },
  );

  @<span class="hljs-selector-tag">override</span>
  <span class="hljs-selector-tag">Widget</span> <span class="hljs-selector-tag">build</span>(BuildContext context) {
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Scaffold</span>(
      <span class="hljs-attribute">appBar</span>: <span class="hljs-built_in">AppBar</span>(
        <span class="hljs-attribute">backgroundColor</span>: Theme.<span class="hljs-built_in">of</span>(context).colorScheme.inversePrimary,
        <span class="hljs-attribute">title</span>: <span class="hljs-built_in">Text</span>(<span class="hljs-string">'例子'</span>),
      ),
      <span class="hljs-comment">///------------消费侧-----------------</span>
      <span class="hljs-attribute">body</span>: <span class="hljs-built_in">Consumer</span>(<span class="hljs-attribute">builder</span>: (context, ref, _) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'tagtag build'</span>);
        var value = ref.<span class="hljs-built_in">watch</span>(futureProvider).<span class="hljs-built_in">when</span>(<span class="hljs-attribute">data</span>: (d) {
          <span class="hljs-built_in">print</span>(<span class="hljs-string">'tagtag on data ${d}'</span>);
          return d;
        }, <span class="hljs-attribute">error</span>: (_, stack) {
          <span class="hljs-built_in">print</span>(<span class="hljs-string">'tagtag on error'</span>);
        }, <span class="hljs-attribute">loading</span>: () {
          <span class="hljs-built_in">print</span>(<span class="hljs-string">'tagtag on loading'</span>);
        });
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'tagtag value is $value'</span>);
        return <span class="hljs-built_in">ElevatedButton</span>(
            <span class="hljs-attribute">onPressed</span>: () {
              ref.<span class="hljs-built_in">invalidate</span>(futureProvider);
            },
            <span class="hljs-attribute">child</span>: <span class="hljs-built_in">Text</span>(<span class="hljs-string">"点击"</span>));
      }),
    );
  }
}
</code></pre>
<p>打开页面第一次启动日志</p>
<pre><code class="hljs language-csharp" lang="csharp">--------第一次打印内容---------
tagtag build
tagtag provider刷新
tagtag <span class="hljs-keyword">on</span> loading

-------<span class="hljs-number">-1</span>秒之后打印内容---------
tagtag build
tagtag <span class="hljs-keyword">on</span> data <span class="hljs-literal">true</span>
</code></pre>
<p>上面的第一次日志很明显，FutureProvider进入loading状态，并调用了loading。1秒之后有值了，调用data</p>
<p>点击刷新，调用invalidate之后日志</p>
<pre><code class="hljs language-csharp" lang="csharp">--------第一次打印内容---------
tagtag provider刷新
tagtag build
tagtag <span class="hljs-keyword">on</span> data <span class="hljs-literal">true</span>

-------<span class="hljs-number">-1</span>秒之后打印内容---------
tagtag build
tagtag <span class="hljs-keyword">on</span> data <span class="hljs-literal">true</span>
</code></pre>
<p>上面因为我们是invalidate刷新provider，并且默认我们是跳过loading态的，因此进入loading状态时，调用的是data，1秒之后数据回来了就会进入data状态，调用data回调</p>
<p>在这个例子里面会发现组件被build了两次，这显然不是我们想要的。怎么才能只build一次？</p>
<p>使用provider的selector，上面的watch改成</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">ref</span>.watch(futureProvider.<span class="hljs-keyword">select</span>((selector) =&gt; selector.<span class="hljs-keyword">value</span>)) ??
    <span class="hljs-literal">false</span>;
</code></pre>
<p>select有稳定的作用，只要select里面函数的返回值不变，那么就不会触发重新build，上面的例子，不论点击刷新多少次都不会导致build，因为每次都返回true。</p>
<h2 data-id="heading-3">FutureProvider依赖引发的多次调用</h2>
<p>还有一种情况就是FutureProviderA依赖FutureProviderB，如果B发生变化，那么就会重建，而且会重建多次，如果在A里面调用了接口，那么就会引发一些副作用。因此要不然就在A里面使用上面说的select，要不然就不要在provider里面写太多业务逻辑</p>
<h2 data-id="heading-4">建议&amp;总结</h2>
<ol>
<li>组件在使用FutureProvider的时候，使用select，稳定结果的值，避免loading态导致的无谓刷新</li>
<li>FutureProvider里面避免依赖其他FutureProvider，否则可能会导致FutureProvider里面的逻辑多次执行</li>
<li>耗时获取数据等方法写到provider执行的外面，provider尽量只记录值的改变。业务逻辑可以内聚到Notifier里面，Notifier处理完之后赋值给Provider</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于Java 实现 PPT 到 PDF 的高效转换]]></title>    <link>https://juejin.cn/post/7572141912498749449</link>    <guid>https://juejin.cn/post/7572141912498749449</guid>    <pubDate>2025-11-14T05:55:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572141912498749449" data-draft-id="7572141912498634761" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于Java 实现 PPT 到 PDF 的高效转换"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-14T05:55:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="咕白m625"/> <meta itemprop="url" content="https://juejin.cn/user/775609987638480"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于Java 实现 PPT 到 PDF 的高效转换
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/775609987638480/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    咕白m625
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T05:55:50.000Z" title="Fri Nov 14 2025 05:55:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    19
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在日常开发中，经常会遇到将PPT文档批量或单文件转换为PDF的需求—PDF格式因其跨平台一致性、不可轻易篡改的特性，成为文档分发与归档的首选格式。Spire.Presentation for Java 作为一款轻量级且功能稳定的 PPT 处理组件，无需依赖 Microsoft Office 环境，即可快速实现 PowerPoint（.ppt/.pptx）到 PDF 的转换，同时支持对转换过程的灵活配置。本文将详细介绍其使用流程、核心代码与常见问题解决方案。</p>
<h2 data-id="heading-0">一、环境配置</h2>
<p>首先需要在项目中添加 Spire.Presentation for Java 的依赖：</p>
<h3 data-id="heading-1">Maven 配置</h3>
<p>在项目的<code>pom.xml</code>文件中添加如下仓库与依赖配置：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">repositories</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>com.e-iceblue<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>e-iceblue<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://repo.e-iceblue.com/nexus/content/groups/public/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">repositories</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>e-iceblue<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spire.presentation<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>10.10.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-2">Gradle 配置：</h3>
<pre><code class="hljs language-arduino" lang="arduino">implementation <span class="hljs-string">'e-iceblue:spire.presentation:10.10.2@jar'</span>
</code></pre>
<h2 data-id="heading-3">二、核心实现：3步完成PPT转PDF</h2>
<p>Spire.Presentation的API设计简洁，核心转换逻辑仅需3个关键步骤：<strong>加载PPT文件</strong> → <strong>执行转换操作</strong> → <strong>释放资源</strong>。以下分别介绍单文件转换、批量转换的实现方案，并提供完整可运行代码。</p>
<h3 data-id="heading-4">1. 单文件转换（基础版）</h3>
<p>适用于仅需转换单个PPT文件的场景，支持<code>.ppt</code>和<code>.pptx</code>两种格式，转换后自动保持原PPT的版式、图片、文字样式。</p>
<h4 data-id="heading-5">完整代码</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.spire.presentation.Presentation;
<span class="hljs-keyword">import</span> com.spire.presentation.FileFormat;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PptToPdfSingle</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 1. 定义PPT输入路径与PDF输出路径</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">pptInputPath</span> <span class="hljs-operator">=</span> <span class="hljs-string">"D:\Documents\示例演示文稿.pptx"</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">pdfOutputPath</span> <span class="hljs-operator">=</span> <span class="hljs-string">"D:\Documents\示例演示文稿_转换后.pdf"</span>;

        <span class="hljs-type">Presentation</span> <span class="hljs-variable">presentation</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 2. 创建Presentation对象，加载PPT文件</span>
            presentation = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Presentation</span>();
            presentation.loadFromFile(pptInputPath);

            <span class="hljs-comment">// 3. 调用saveToFile方法转换为PDF，指定输出格式为FileFormat.PDF</span>
            presentation.saveToFile(pdfOutputPath, FileFormat.PDF);

            System.out.println(<span class="hljs-string">"PPT转PDF成功！输出路径："</span> + pdfOutputPath);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
            System.out.println(<span class="hljs-string">"PPT转PDF失败："</span> + e.getMessage());
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// 4. 关闭Presentation对象，释放内存资源</span>
            <span class="hljs-keyword">if</span> (presentation != <span class="hljs-literal">null</span>) {
                presentation.dispose();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-6">2. 批量转换（进阶版）</h3>
<p>若需转换某个文件夹下的所有PPT文件，可结合 <code>java.io</code> 包遍历文件夹，批量执行转换逻辑，提高效率。</p>
<h4 data-id="heading-7">完整代码</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.spire.presentation.Presentation;
<span class="hljs-keyword">import</span> com.spire.presentation.FileFormat;
<span class="hljs-keyword">import</span> java.io.File;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PptToPdfBatch</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 1. 定义PPT文件夹路径与PDF输出文件夹路径</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">pptFolderPath</span> <span class="hljs-operator">=</span> <span class="hljs-string">"D:\Documents\PPT文件夹"</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">pdfOutputFolder</span> <span class="hljs-operator">=</span> <span class="hljs-string">"D:\Documents\PDF输出文件夹"</span>;

        <span class="hljs-comment">// 2. 检查输出文件夹，不存在则创建</span>
        <span class="hljs-type">File</span> <span class="hljs-variable">outputFolder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(pdfOutputFolder);
        <span class="hljs-keyword">if</span> (!outputFolder.exists()) {
            outputFolder.mkdirs();
        }

        <span class="hljs-comment">// 3. 遍历PPT文件夹，获取所有.ppt/.pptx文件</span>
        <span class="hljs-type">File</span> <span class="hljs-variable">pptFolder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(pptFolderPath);
        File[] pptFiles = pptFolder.listFiles((dir, name) -&gt; {
            <span class="hljs-comment">// 过滤后缀为.ppt或.pptx的文件（不区分大小写）</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">lowercaseName</span> <span class="hljs-operator">=</span> name.toLowerCase();
            <span class="hljs-keyword">return</span> lowercaseName.endsWith(<span class="hljs-string">".ppt"</span>) || lowercaseName.endsWith(<span class="hljs-string">".pptx"</span>);
        });

        <span class="hljs-comment">// 4. 批量转换每个PPT文件</span>
        <span class="hljs-keyword">if</span> (pptFiles != <span class="hljs-literal">null</span> &amp;&amp; pptFiles.length &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">for</span> (File pptFile : pptFiles) {
                convertSinglePptToPdf(pptFile.getAbsolutePath(), pdfOutputFolder);
            }
            System.out.println(<span class="hljs-string">"批量转换完成！所有PDF已保存至："</span> + pdfOutputFolder);
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"PPT文件夹中未找到.ppt/.pptx文件！"</span>);
        }
    }

    <span class="hljs-comment">/**
     * 单个PPT转换为PDF的工具方法
     * <span class="hljs-doctag">@param</span> pptInputPath PPT文件绝对路径
     * <span class="hljs-doctag">@param</span> pdfOutputFolder PDF输出文件夹路径
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">convertSinglePptToPdf</span><span class="hljs-params">(String pptInputPath, String pdfOutputFolder)</span> {
        <span class="hljs-type">Presentation</span> <span class="hljs-variable">presentation</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 加载PPT文件</span>
            presentation = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Presentation</span>();
            presentation.loadFromFile(pptInputPath);

            <span class="hljs-comment">// 获取PPT文件名（不含后缀），作为PDF文件名</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">pptFileName</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(pptInputPath).getName();
            <span class="hljs-type">String</span> <span class="hljs-variable">pdfFileName</span> <span class="hljs-operator">=</span> pptFileName.substring(<span class="hljs-number">0</span>, pptFileName.lastIndexOf(<span class="hljs-string">"."</span>)) + <span class="hljs-string">".pdf"</span>;
            <span class="hljs-type">String</span> <span class="hljs-variable">pdfOutputPath</span> <span class="hljs-operator">=</span> pdfOutputFolder + File.separator + pdfFileName;

            <span class="hljs-comment">// 转换为PDF</span>
            presentation.saveToFile(pdfOutputPath, FileFormat.PDF);
            System.out.println(<span class="hljs-string">"成功转换："</span> + pptFileName + <span class="hljs-string">" → "</span> + pdfFileName);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            System.out.println(<span class="hljs-string">"转换失败："</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(pptInputPath).getName() + <span class="hljs-string">"，原因："</span> + e.getMessage());
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (presentation != <span class="hljs-literal">null</span>) {
                presentation.dispose();
            }
        }
    }
}
</code></pre>
<h2 data-id="heading-8">三、代码深度解析：关键类与方法</h2>
<p>理解核心API的作用，有助于根据实际需求扩展功能（如设置PDF权限、调整转换质量等）。</p>





























<table><thead><tr><th>类/方法</th><th>作用说明</th></tr></thead><tbody><tr><td><code>Presentation</code></td><td>Spire.Presentation 的核心类，用于加载、操作PPT文件，管理幻灯片内容与格式。</td></tr><tr><td><code>loadFromFile(String path)</code></td><td>加载指定路径的 PPT 文件（支持绝对路径与相对路径，相对路径基于项目根目录）。</td></tr><tr><td><code>saveToFile(String path, FileFormat format)</code></td><td>将 PPT 保存为指定格式的文件，<code>FileFormat.PDF</code> 表示输出为 PDF。</td></tr><tr><td><code>dispose()</code></td><td>释放 <code>Presentation</code> 对象占用的内存资源，避免频繁创建对象导致内存泄漏。</td></tr><tr><td><code>FileFormat</code></td><td>枚举类，包含 PPT 支持的输入/输出格式（如<code>PPT</code>、<code>PPTX</code>、<code>PDF</code> 等）。</td></tr></tbody></table>
<h2 data-id="heading-9">四、常见问题与解决方案</h2>
<p>在实际使用中，可能会遇到加载失败、格式错乱、中文乱码等问题，以下是高频问题的解决办法：</p>
<h3 data-id="heading-10">问题1：PPT 加载失败，报错“File not found”或“Unsupported file format”</h3>
<ul>
<li><strong>原因1</strong>：文件路径错误（如路径含中文但未处理编码，或路径拼写错误）；</li>
</ul>
<p><strong>解决</strong>：使用绝对路径，确保路径中无特殊字符；若路径含中文，在JDK 1.8及以上环境下通常无需额外处理，低版本可尝试将路径转换为UTF-8编码。</p>
<ul>
<li><strong>原因2</strong>：PPT文件损坏或格式不支持（如加密PPT、WPS特殊格式PPT）；</li>
</ul>
<p><strong>解决</strong>：先通过Office/WPS验证PPT是否能正常打开，加密文件需先解密再转换。</p>
<h3 data-id="heading-11">问题2：转换后的 PDF 页面空白或内容缺失</h3>
<ul>
<li><strong>原因1</strong>：PPT 中包含特殊元素（如动态图表、ActiveX 控件），Spire.Presentation 暂不支持渲染；</li>
</ul>
<p><strong>解决</strong>：将特殊元素转为静态图片（如在 Office 中复制图表→粘贴为“图片”）后再转换。</p>
<ul>
<li><strong>原因2</strong>：组件版本过低，存在兼容性BUG；</li>
</ul>
<p><strong>解决</strong>：升级至最新版本。</p>
<hr/>
<h2 data-id="heading-12">五、总结</h2>
<p>Spire.Presentation for Java 为 PPT 转 PDF 需求提供了轻量、高效的解决方案，核心优势在于：</p>
<ol>
<li><strong>无环境依赖</strong>：无需安装Office/WPS，降低部署复杂度；</li>
<li><strong>API简洁</strong>：3步即可完成转换，代码易读易维护；</li>
<li><strong>格式兼容性强</strong>：支持<code>.ppt</code>/<code>.pptx</code>全版本，转换后保持原文档版式；</li>
<li><strong>支持扩展</strong>：可进一步实现PDF加密（设置打开密码/权限）、PPT转图片等功能。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从 Vue 构建错误到深度解析：::v-deep 引发的 CSS 压缩危机]]></title>    <link>https://juejin.cn/post/7572190151351336960</link>    <guid>https://juejin.cn/post/7572190151351336960</guid>    <pubDate>2025-11-14T06:13:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572190151351336960" data-draft-id="7572141390857535488" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从 Vue 构建错误到深度解析：::v-deep 引发的 CSS 压缩危机"/> <meta itemprop="keywords" content="CSS,前端工程化"/> <meta itemprop="datePublished" content="2025-11-14T06:13:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一川_"/> <meta itemprop="url" content="https://juejin.cn/user/2964722159722887"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从 Vue 构建错误到深度解析：::v-deep 引发的 CSS 压缩危机
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2964722159722887/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一川_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T06:13:53.000Z" title="Fri Nov 14 2025 06:13:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在日常的前端开发中，我们经常会遇到各种构建错误，有些错误信息明确，容易定位；而有些则像迷宫一样，需要一步步排查。最近在开发一个 Vue 2 项目时，我就遇到了一个令人头疼的 CSS 压缩错误，经过多轮排查和尝试，最终找到了问题的根源和解决方案。本文将详细记录这个问题的排查过程，并深入分析相关的技术原理。</p>
<h2 data-id="heading-1">问题初现</h2>
<p>那是一个普通的开发日，我正在为一个生产工单管理系统添加新功能。在完成代码编写后，我像往常一样执行构建命令：</p>
<pre><code class="hljs language-arduino" lang="arduino">npm run build:prod
</code></pre>
<p>然而，控制台却报出了令人困惑的错误：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-variable constant_">ERROR</span> <span class="hljs-title class_">Error</span>: <span class="hljs-variable constant_">CSS</span> minification <span class="hljs-attr">error</span>: <span class="hljs-title class_">Cannot</span> read property <span class="hljs-string">'trim'</span> <span class="hljs-keyword">of</span> <span class="hljs-literal">undefined</span>. <span class="hljs-title class_">File</span>: <span class="hljs-keyword">static</span>/css/chunk-25fbebba.59b3af06.<span class="hljs-property">css</span>
<span class="hljs-title class_">Error</span>: <span class="hljs-variable constant_">CSS</span> minification <span class="hljs-attr">error</span>: <span class="hljs-title class_">Cannot</span> read property <span class="hljs-string">'trim'</span> <span class="hljs-keyword">of</span> <span class="hljs-literal">undefined</span>. <span class="hljs-title class_">File</span>: <span class="hljs-keyword">static</span>/css/chunk-25fbebba.59b3af06.<span class="hljs-property">css</span>
    at <span class="hljs-attr">C</span>:\<span class="hljs-title class_">Users</span>\wzh\<span class="hljs-title class_">Desktop</span>\<span class="hljs-title class_">BatchProductionWorkOrderReport</span>\node_modules<span class="hljs-meta">@intervolga</span>\optimize-cssnano-plugin\index.<span class="hljs-property">js</span>:<span class="hljs-number">106</span>:<span class="hljs-number">21</span>
</code></pre>
<h2 data-id="heading-2">第一阶段：常规排查</h2>
<h3 data-id="heading-3">尝试方案一：清除缓存和重新安装</h3>
<p>面对构建错误，我的第一反应是清除缓存和重新安装依赖，这是前端开发中的"万能药"：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 清除 npm 缓存</span>
npm cache clean --force

<span class="hljs-comment"># 删除 node_modules 和 package-lock.json</span>
<span class="hljs-built_in">rm</span> -rf node_modules package-lock.json

<span class="hljs-comment"># 重新安装依赖</span>
npm install

<span class="hljs-comment"># 重新构建</span>
npm run build:prod
</code></pre>
<p>然而，这次"万能药"并没有奏效，同样的错误再次出现。</p>
<h3 data-id="heading-4">尝试方案二：更新相关依赖</h3>
<p>注意到控制台有一个警告："A new version of sass-loader is available"，我尝试更新相关依赖：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 更新 sass-loader</span>
npm update sass-loader

<span class="hljs-comment"># 更新 Vue CLI 和相关构建工具</span>
npm update @vue/cli-service

<span class="hljs-comment"># 更新 CSS 相关插件</span>
npm update @intervolga/optimize-cssnano-plugin cssnano postcss
</code></pre>
<p>更新后重新构建，问题依旧。</p>
<h2 data-id="heading-5">第二阶段：深入分析</h2>
<h3 data-id="heading-6">错误信息分析</h3>
<p>仔细分析错误信息，有几个关键点：</p>
<ol>
<li><strong>错误位置</strong>：<code>@intervolga/optimize-cssnano-plugin/index.js:106:21</code></li>
<li><strong>错误类型</strong>：<code>Cannot read property 'trim' of undefined</code></li>
<li><strong>涉及文件</strong>：<code>chunk-25fbebba.59b3af06.css</code></li>
</ol>
<p>这表明问题出现在 CSS 压缩阶段，某个 CSS 内容在压缩时变成了 <code>undefined</code>。</p>
<h3 data-id="heading-7">代码审查</h3>
<p>我开始审查项目中最近修改的代码，重点关注样式部分。发现问题出现在一个使用了 <code>::v-deep</code> 的 Vue 组件中：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.workorder-table</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
}

::v-deep .el-table__body-wrapper {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span> <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">overflow-y</span>: auto;
}

::v-deep .el-table th {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#e3e9f3</span> <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1f1f1f</span> <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">13px</span>;
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">2px</span> solid <span class="hljs-number">#c3c9d4</span> <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
}

::v-deep .el-table td {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h2 data-id="heading-8">第三阶段：技术原理探究</h2>
<h3 data-id="heading-9">什么是 ::v-deep？</h3>
<p><code>::v-deep</code> 是 Vue.js 中用于样式穿透的伪类选择器。在 Vue 的 scoped CSS 中，样式默认只作用于当前组件，但有时候我们需要修改子组件的样式，这时就需要使用样式穿透。</p>
<h3 data-id="heading-10">Vue 2 和 Vue 3 中的差异</h3>
<p>在排查过程中，我发现不同 Vue 版本对深度选择器的支持有所不同：</p>
<p><strong>Vue 2 支持的形式：</strong></p>
<ul>
<li><code>&gt;&gt;&gt;</code></li>
<li><code>/deep/</code></li>
<li><code>::v-deep</code></li>
</ul>
<p><strong>Vue 3 支持的形式：</strong></p>
<ul>
<li><code>:deep()</code></li>
<li><code>::v-deep</code>（已弃用）</li>
</ul>
<h3 data-id="heading-11">构建过程中的 CSS 处理流程</h3>
<p>理解构建过程中 CSS 的处理流程对于解决问题至关重要：</p>
<ol>
<li><strong>Vue Loader 处理</strong>：Vue Loader 解析 <code>.vue</code> 文件中的 <code>&lt;style&gt;</code> 块</li>
<li><strong>CSS 预处理</strong>：如果使用了 Sass/Less，会进行相应的预处理</li>
<li><strong>PostCSS 处理</strong>：应用各种 PostCSS 插件，包括 scoped CSS 处理</li>
<li><strong>CSS 提取</strong>：将 CSS 从 JavaScript 中提取出来</li>
<li><strong>CSS 压缩</strong>：使用 cssnano 等工具进行压缩</li>
</ol>
<h3 data-id="heading-12">问题根源分析</h3>
<p>经过深入分析，我发现问题的根源在于：</p>
<ol>
<li><strong>版本兼容性问题</strong>：项目中使用的 <code>@intervolga/optimize-cssnano-plugin</code> 版本与当前的 Vue CLI 版本存在兼容性问题</li>
<li><strong>深度选择器解析</strong>：在某些情况下，<code>::v-deep</code> 在构建过程中可能被解析为空的 CSS 规则</li>
<li><strong>CSS 压缩异常</strong>：当遇到这些异常的 CSS 规则时，压缩插件无法正确处理，导致 <code>undefined</code> 错误</li>
</ol>
<h2 data-id="heading-13">第四阶段：解决方案尝试</h2>
<h3 data-id="heading-14">方案一：使用 /deep/ 替代 ::v-deep</h3>
<p>这是最直接的解决方案，将所有的 <code>::v-deep</code> 替换为 <code>/deep/</code>：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.workorder-table</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
}

/deep/ <span class="hljs-selector-class">.el-table__body-wrapper</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span> <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">overflow-y</span>: auto;
}

/deep/ <span class="hljs-selector-class">.el-table</span> <span class="hljs-selector-tag">th</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#e3e9f3</span> <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1f1f1f</span> <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">13px</span>;
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">2px</span> solid <span class="hljs-number">#c3c9d4</span> <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
}

/deep/ <span class="hljs-selector-class">.el-table</span> <span class="hljs-selector-tag">td</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><strong>结果</strong>：构建成功！这是最快速的解决方案。</p>
<h3 data-id="heading-15">方案二：使用 CSS Modules</h3>
<p>为了更彻底地解决问题，我尝试了 CSS Modules 方案：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"workorder-page"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-table</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"$style.workorderTable"</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 表格内容 --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">el-table</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">module</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.workorderTable</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">min-width</span>: <span class="hljs-number">1400px</span>;
}

<span class="hljs-selector-class">.workorderTable</span> :<span class="hljs-built_in">global</span>(.el-table__body-wrapper) {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span> <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">overflow-y</span>: auto;
}

<span class="hljs-selector-class">.workorderTable</span> :<span class="hljs-built_in">global</span>(.el-table th) {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#e3e9f3</span> <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1f1f1f</span> <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">13px</span>;
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">2px</span> solid <span class="hljs-number">#c3c9d4</span> <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
}

<span class="hljs-selector-class">.workorderTable</span> :<span class="hljs-built_in">global</span>(.el-table td) {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><strong>结果</strong>：构建成功，且代码更加规范。</p>
<h3 data-id="heading-16">方案三：配置 vue.config.js</h3>
<p>如果必须使用 <code>::v-deep</code>，可以通过配置 <code>vue.config.js</code> 来解决问题：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">module.exports</span> = {
  css: {
    loaderOptions: {
      css: {
        // 启用 CSS Modules 模式避免深度选择器问题
        modules: false
      },
      postcss: {
        plugins: <span class="hljs-section">[
          require('autoprefixer')
        ]</span>
      }
    }
  },
  chainWebpack: <span class="hljs-attr">config</span> =&gt; {
    // 优化 CSS 压缩配置
    config.plugin('optimize-css').tap(<span class="hljs-attr">args</span> =&gt; {
      if (args<span class="hljs-section">[0]</span> &amp;&amp; args<span class="hljs-section">[0]</span>.cssnanoOptions) {
        args<span class="hljs-section">[0]</span>.<span class="hljs-attr">cssnanoOptions.preset</span> = [<span class="hljs-string">'default'</span>, {
          discardComments: {
            removeAll: <span class="hljs-literal">true</span>
          },
          normalizeWhitespace: <span class="hljs-literal">false</span>
        }]
      }
      return args
    })
  }
}
</code></pre>
<h2 data-id="heading-17">最终解决方案</h2>
<p>综合考虑项目现状和长期维护性，我选择了<strong>方案二（CSS Modules）</strong> 作为最终解决方案，原因如下：</p>
<ol>
<li><strong>符合现代前端开发规范</strong></li>
<li><strong>更好的样式隔离</strong></li>
<li><strong>避免深度选择器的兼容性问题</strong></li>
<li><strong>便于代码维护和重构</strong></li>
</ol>
<h2 data-id="heading-18">技术深度解析</h2>
<h3 data-id="heading-19">Vue Scoped CSS 原理</h3>
<p>Vue 的 scoped CSS 是通过 PostCSS 插件实现的，工作原理如下：</p>
<ol>
<li><strong>为每个选择器添加属性选择器</strong>：<code>.example</code> → <code>.example[data-v-xxxxxx]</code></li>
<li><strong>为模板元素添加属性</strong>：<code>&lt;div class="example"&gt;</code> → <code>&lt;div class="example" data-v-xxxxxx&gt;</code></li>
<li><strong>样式仅限于带有相同 data-v 属性的元素</strong></li>
</ol>
<h3 data-id="heading-20">深度选择器的实现机制</h3>
<p>深度选择器的工作原理是移除属性选择器：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 原始代码 */</span>
::v-deep .child-component { <span class="hljs-attribute">color</span>: red; }

<span class="hljs-comment">/* 转换后 */</span>
<span class="hljs-selector-attr">[data-v-xxxxxx]</span> <span class="hljs-selector-class">.child-component</span> { <span class="hljs-attribute">color</span>: red; }
</code></pre>
<h3 data-id="heading-21">CSS Modules 的优势</h3>
<ol>
<li><strong>真正的局部作用域</strong>：通过类名哈希实现</li>
<li><strong>无冲突的类名</strong>：每个模块的类名都是唯一的</li>
<li><strong>显式依赖</strong>：明确知道样式在哪里被使用</li>
<li><strong>代码压缩优化</strong>：类名可以被压缩得更短</li>
</ol>
<h2 data-id="heading-22">经验总结</h2>
<p>通过这次问题的排查和解决，我总结了以下几点经验：</p>
<h3 data-id="heading-23">1. 构建错误排查方法论</h3>
<ul>
<li><strong>从简单到复杂</strong>：先尝试清除缓存、重新安装等简单操作</li>
<li><strong>分析错误堆栈</strong>：仔细阅读错误信息，定位问题发生的具体位置</li>
<li><strong>版本兼容性检查</strong>：检查相关依赖的版本兼容性</li>
<li><strong>代码审查</strong>：重点关注最近修改的代码</li>
</ul>
<h3 data-id="heading-24">2. Vue 样式开发最佳实践</h3>
<ul>
<li><strong>Vue 2 项目</strong>：推荐使用 <code>/deep/</code> 或 CSS Modules</li>
<li><strong>Vue 3 项目</strong>：推荐使用 <code>:deep()</code> 选择器</li>
<li><strong>大型项目</strong>：优先考虑 CSS Modules 或 CSS-in-JS 方案</li>
</ul>
<h3 data-id="heading-25">3. 预防措施</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// 在 package.json 中固定关键依赖版本</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^2.6.14"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@vue/cli-service"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.5.19"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"sass-loader"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^10.2.1"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-26">结语</h2>
<p>这次 CSS 压缩错误的排查过程，让我对 Vue 的样式系统有了更深入的理解。从前端的表面现象到底层的构建原理，从简单的样式编写到复杂的工程化问题，每一个技术细节都值得深入探究。</p>
<p>作为前端开发者，我们不仅要会使用框架提供的便利功能，更要理解其背后的原理和实现机制。只有这样，当遇到问题时，我们才能快速定位并找到最优解决方案。</p>
<p>希望这篇文章能帮助到遇到类似问题的开发者，也欢迎大家分享自己的问题和解决方案，共同进步！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 对象数组去重的几种方法]]></title>    <link>https://juejin.cn/post/7572115057222713379</link>    <guid>https://juejin.cn/post/7572115057222713379</guid>    <pubDate>2025-11-14T06:20:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572115057222713379" data-draft-id="7571753301898854440" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 对象数组去重的几种方法"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-11-14T06:20:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="juejin_cn"/> <meta itemprop="url" content="https://juejin.cn/user/3016715636324125"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 对象数组去重的几种方法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3016715636324125/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    juejin_cn
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T06:20:38.000Z" title="Fri Nov 14 2025 06:20:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>部分内容由大模型生成</p>
</blockquote>
<p>根据对象的某个属性（如 <code>id</code>）对对象数组去重的几种方法。</p>
<h2 data-id="heading-0"><code>Map</code></h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> arr = [
  { <span class="hljs-attr">id</span>: <span class="hljs-string">'a'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Object A'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-string">'b'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Object B'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-string">'c'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Object C'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-string">'a'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Object A (重复)'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-string">'d'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Object D'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-string">'b'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Object B (重复)'</span> }
];

<span class="hljs-keyword">const</span> unique = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(arr.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> [item.<span class="hljs-property">id</span>, item])).<span class="hljs-title function_">values</span>()]

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(unique)
<span class="hljs-comment">// 输出: </span>
<span class="hljs-comment">// [</span>
<span class="hljs-comment">//   {id: 'a', name: 'Object A (重复)'}</span>
<span class="hljs-comment">//   {id: 'b', name: 'Object B (重复)'}</span>
<span class="hljs-comment">//   {id: 'c', name: 'Object C'}</span>
<span class="hljs-comment">//   {id: 'd', name: 'Object D'}</span>
<span class="hljs-comment">// ]</span>
</code></pre>
<p><code>Map</code> 的键（key）唯一，<code>map(item =&gt; [item.id, item])</code> 把每个对象用 <code>id</code> 当键，后面的重复项会覆盖。最后用 <code>.values()</code> 得到去重后的对象数组。</p>
<p><em>此方法会保留<strong>最后一个</strong>出现的 <code>id</code> 对应的对象。</em></p>
<h2 data-id="heading-1"><code>filter</code> &amp; <code>findIndex</code></h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> unique = arr.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item, index, self</span>) =&gt;</span>
  index === self.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> t.<span class="hljs-property">id</span> === item.<span class="hljs-property">id</span>)
)
<span class="hljs-comment">// 输出: </span>
<span class="hljs-comment">// [</span>
<span class="hljs-comment">//   {id: 'a', name: 'Object A'}</span>
<span class="hljs-comment">//   {id: 'b', name: 'Object B'}</span>
<span class="hljs-comment">//   {id: 'c', name: 'Object C'}</span>
<span class="hljs-comment">//   {id: 'd', name: 'Object D'}</span>
<span class="hljs-comment">// ]</span>
</code></pre>
<p><code>findIndex</code> 找到数组中首个 <code>id</code> 相同的元素位置，只有第一个匹配项会被保留。</p>
<h2 data-id="heading-2"><code>reduce</code> &amp; <code>some</code></h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> unique = arr.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, cur</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (!acc.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">id</span> === cur.<span class="hljs-property">id</span>)) {
    acc.<span class="hljs-title function_">push</span>(cur)
  }
  <span class="hljs-keyword">return</span> acc
}, [])
<span class="hljs-comment">// 输出: </span>
<span class="hljs-comment">// [</span>
<span class="hljs-comment">//   {id: 'a', name: 'Object A'}</span>
<span class="hljs-comment">//   {id: 'b', name: 'Object B'}</span>
<span class="hljs-comment">//   {id: 'c', name: 'Object C'}</span>
<span class="hljs-comment">//   {id: 'd', name: 'Object D'}</span>
<span class="hljs-comment">// ]</span>
</code></pre>
<p>累积构建一个新数组，遇到重复的 <code>id</code> 不再添加。</p>
<h2 data-id="heading-3"><code>filter</code> &amp; <code>Set</code></h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> seen = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
<span class="hljs-keyword">const</span> unique = arr.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> !seen.<span class="hljs-title function_">has</span>(item.<span class="hljs-property">id</span>) &amp;&amp; seen.<span class="hljs-title function_">add</span>(item.<span class="hljs-property">id</span>))
<span class="hljs-comment">// 输出: </span>
<span class="hljs-comment">// [</span>
<span class="hljs-comment">//   {id: 'a', name: 'Object A'}</span>
<span class="hljs-comment">//   {id: 'b', name: 'Object B'}</span>
<span class="hljs-comment">//   {id: 'c', name: 'Object C'}</span>
<span class="hljs-comment">//   {id: 'd', name: 'Object D'}</span>
<span class="hljs-comment">// ]</span>
</code></pre>
<p>利用 <code>Set</code> 记录已出现的 <code>id</code>，第一次出现才添加。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零开始学习大模型（LLM）: 学习路线与知识体系详解]]></title>    <link>https://juejin.cn/post/7572132916575993892</link>    <guid>https://juejin.cn/post/7572132916575993892</guid>    <pubDate>2025-11-14T06:30:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572132916575993892" data-draft-id="7572132916575944740" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零开始学习大模型（LLM）: 学习路线与知识体系详解"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-11-14T06:30:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零开始学习大模型（LLM）: 学习路线与知识体系详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T06:30:09.000Z" title="Fri Nov 14 2025 06:30:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>对于普通程序员而言，系统学习大模型技术是一次重要的职业升级。为了帮助你清晰地规划学习路径，我结合多个权威的学习路线，为你梳理出一套从基础到实战的<strong>结构化学习方案</strong>。</p>
<p>下面这张流程图汇总了核心的学习阶段与关键技能，你可以用它作为整体路线图。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/121ceb1513744df1a60a05f72e602066~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSVTmqZjlrZDnmq4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763707162&amp;x-signature=tRSXhNcZ061hkMZtr3ybBhUEj1I%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-0">💻 第一阶段：打好基础（约1-2个月）</h3>
<p>这个阶段的目标是重建知识体系，打下坚实的理论基础。</p>
<ul>
<li>
<p><strong>编程语言</strong>：熟练掌握 <strong>Python</strong>​ 是前提，特别是要熟悉 NumPy、Pandas 等数据科学库。</p>
</li>
<li>
<p><strong>数学基础</strong>：重点复习线性代数（矩阵运算）、概率统计（贝叶斯定理）和微积分（梯度下降），这些是理解模型原理的基石。</p>
</li>
<li>
<p><strong>机器学习与深度学习</strong>：学习经典的机器学习算法（如分类、聚类）和深度学习知识（神经网络、CNN/RNN），并选择 <strong>PyTorch</strong>​ 或 <strong>TensorFlow</strong>​ 中的一个框架进行实践。</p>
</li>
</ul>
<p><strong>学习建议</strong>：这个阶段可以结合吴恩达的机器学习课程和李沐的《动手学深度学习》进行学习。</p>
<h3 data-id="heading-1">🔬 第二阶段：深入核心技术（约2-3个月）</h3>
<p>这个阶段将直接切入大模型的核心技术。</p>
<ul>
<li>
<p><strong>Transformer架构</strong>：这是所有大模型的基石。必须理解其<strong>自注意力机制（Self-Attention）</strong> ​ 和工作原理。建议阅读著名的论文《Attention Is All You Need》。</p>
</li>
<li>
<p><strong>预训练与微调</strong>：理解大模型如何通过海量数据预训练获得通用能力，以及如何通过<strong>微调（Fine-tuning）</strong> ​ 使其适配特定任务。可以关注 <strong>LoRA</strong>​ 等高效的微调技术。</p>
</li>
<li>
<p><strong>Prompt工程</strong>：学习如何设计有效的提示词，以最大化激发模型的能力。这包括指令设计、少样本示例等技巧。</p>
</li>
</ul>
<p><strong>学习建议</strong>：强烈推荐使用 <strong>Hugging Face</strong>​ 库，它提供了丰富的预训练模型和工具，可以让你快速上手实验和体验。</p>
<h3 data-id="heading-2">🚀 第三阶段：应用开发实战（约2-3个月）</h3>
<p>学习技术的目的是为了应用。这个阶段你将开始构建真正可用的AI应用。</p>
<ul>
<li>
<p><strong>RAG（检索增强生成）</strong> ：这是当前企业的刚需技术。它通过为模型接入外部知识库（如公司文档），解决模型知识过时和“幻觉”问题。你需要学习文档解析、向量数据库（如Chroma）和LangChain等框架。</p>
</li>
<li>
<p><strong>智能体（Agent）</strong> ：智能体能让大模型具备自主规划、使用工具的能力。学习 <strong>ReAct</strong>​ 框架和 <strong>LangChain</strong>​ 等工具，可以开发出能自动完成复杂任务的AI。</p>
</li>
<li>
<p><strong>项目实战</strong>：最好的学习方式是实践。可以尝试：</p>
<ul>
<li>
<p>用 <strong>Ollama</strong>​ 部署一个开源模型，搭建一个PDF问答机器人。</p>
</li>
<li>
<p>使用 <strong>LangChain</strong>​ 构建一个能联网搜索信息的智能体。</p>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3">🧠 第四阶段：进阶与深耕</h3>
<p>如果你希望深入技术链条的更底层，或成为专家，可以继续探索以下方向。</p>
<ul>
<li>
<p><strong>模型微调与训练</strong>：深入研究全参数微调、高效微调技术（LoRA、QLoRA）的原理和实践。</p>
</li>
<li>
<p><strong>模型部署与优化</strong>：学习如何将模型部署到生产环境，涉及模型压缩、量化、推理加速（vLLM）等技术。</p>
</li>
<li>
<p><strong>多模态大模型</strong>：拓展到图像、语音等多模态领域，理解如CLIP、DALL-E等模型的工作原理。</p>
</li>
</ul>
<h3 data-id="heading-4">🌟 如何持续学习与规划职业</h3>
<ul>
<li>
<p><strong>保持学习</strong>：大模型技术迭代飞快。积极参与 <strong>Hugging Face</strong>、<strong>GitHub</strong>​ 等开源社区，关注arXiv上的最新论文，是保持技术敏锐度的关键。</p>
</li>
<li>
<p><strong>规划职业路径</strong>：大模型领域不仅需要研究者，更需要能将技术落地的工程师。你可以根据自己的兴趣和背景，选择不同的发展方向：</p>
<ul>
<li>
<p><strong>应用开发</strong>：利用API和框架快速构建AI应用，适合大多数程序员切入。</p>
</li>
<li>
<p><strong>数据方向</strong>：负责数据清洗、标注，为训练提供燃料。</p>
</li>
<li>
<p><strong>平台方向</strong>：负责分布式训练、资源调度等底层基础设施。</p>
</li>
<li>
<p><strong>部署方向</strong>：专注于模型推理加速和端侧部署。</p>
</li>
</ul>
</li>
</ul>
<p>希望这份详细的学习路线能为你扫清迷雾，助你在大模型的浪潮中成功转型。学习过程就像训练一个模型，需要大量的“数据”（知识输入）和“迭代”（实践反思）。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[代码隔离革命：用 JavaScript Realm 安全运行不可信代码]]></title>    <link>https://juejin.cn/post/7572190151351566336</link>    <guid>https://juejin.cn/post/7572190151351566336</guid>    <pubDate>2025-11-14T06:51:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572190151351566336" data-draft-id="7572161976593317940" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="代码隔离革命：用 JavaScript Realm 安全运行不可信代码"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-14T06:51:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大知闲闲i"/> <meta itemprop="url" content="https://juejin.cn/user/3799545205237111"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            代码隔离革命：用 JavaScript Realm 安全运行不可信代码
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3799545205237111/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大知闲闲i
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T06:51:12.000Z" title="Fri Nov 14 2025 06:51:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在多年的开发生涯中，我带领团队交付了无数中等规模的外包项目，遇到过各种棘手的技术挑战。但最近在调试一个复杂的多 iframe 应用时，我发现了一个被大多数开发者忽略的 JavaScript 特性，它彻底改变了我对代码安全性的认知。</p>
<p>======================================================================================================================</p>
<h2 data-id="heading-0">从一次生产事故说起</h2>
<p>想象这个场景：你为客户的xx平台开发了一个插件系统，允许商家编写自定义 JavaScript 来增强店铺功能。一切都很美好，直到某个商家写了这样的代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 某个"创新"商家的插件代码</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">push</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"哈哈，我重写了数组方法！"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-string">"搞破坏了"</span>;
};
</code></pre>
<p>结果如何？整个xx平台的购物车、商品列表、订单系统全线崩溃。这就是典型的全局污染问题——当不可信代码与核心业务共享同一个执行环境时，灾难随时可能发生。</p>
<h2 data-id="heading-1">Realm：JavaScript 的隔离解决方案</h2>
<h3 data-id="heading-2">什么是 Realm？</h3>
<p>Realm 是 JavaScript 的隔离执行环境，可以理解为"一套全新的 JavaScript 宇宙"。每个 Realm 都拥有自己独立的内置对象和全局作用域。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 主环境</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Array</span>); <span class="hljs-comment">// [Function: Array]</span>

<span class="hljs-comment">// 创建 iframe（自动生成新 Realm）</span>
<span class="hljs-keyword">const</span> iframe = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'iframe'</span>);
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(iframe);

<span class="hljs-comment">// iframe 中的 Array 是全新的构造器</span>
<span class="hljs-keyword">const</span> iframeArray = iframe.<span class="hljs-property">contentWindow</span>.<span class="hljs-property">Array</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Array</span> === iframeArray); <span class="hljs-comment">// false！</span>
</code></pre>
<p>看到这个结果时，我团队的小伙伴们都惊呆了。两个 Array 构造器功能完全相同，但却是完全独立的对象，这就是 Realm 的强大之处。</p>
<h3 data-id="heading-3">Realm 的组成要素</h3>
<p>每个 Realm 都包含完整的运行环境：</p>
<ul>
<li>
<p><strong>全局对象</strong>：浏览器中的 window 或 Node.js 中的 global</p>
</li>
<li>
<p><strong>内置构造器</strong>：Array、Object、Function、Error 等</p>
</li>
<li>
<p><strong>工具函数</strong>：setTimeout、fetch、JSON 等</p>
</li>
<li>
<p><strong>原型对象</strong>：Array.prototype、Object.prototype 等基础原型</p>
</li>
</ul>
<h2 data-id="heading-4">实战：三种 Realm 实现方案</h2>
<h3 data-id="heading-5">方案一：ShadowRealm（未来标准）</h3>
<p>ShadowRealm 是 TC39 标准提案（Stage 3），专为代码隔离设计：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 创建隔离环境</span>
<span class="hljs-type">const</span> realm = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ShadowRealm</span>();

<span class="hljs-comment">// 安全执行不可信代码</span>
<span class="hljs-type">const</span> result = realm.<span class="hljs-built_in">evaluate</span>(`
    <span class="hljs-comment">// 这里无法访问主环境的任何变量</span>
    <span class="hljs-type">const</span> sensitiveData = <span class="hljs-string">"这段数据很安全"</span>;
    <span class="hljs-number">2</span> + <span class="hljs-number">2</span>
`);

console.<span class="hljs-built_in">log</span>(result); <span class="hljs-comment">// 4</span>
console.<span class="hljs-built_in">log</span>(typeof sensitiveData); <span class="hljs-comment">// undefined（完全隔离）</span>
</code></pre>
<p>当前可用 polyfill：</p>
<pre><code class="hljs language-ini" lang="ini">npm install shadowrealm-api

import ShadowRealm from 'shadowrealm-api'<span class="hljs-comment">;</span>

const <span class="hljs-attr">realm</span> = new ShadowRealm()<span class="hljs-comment">;</span>
const <span class="hljs-attr">userCodeResult</span> = realm.evaluate(userSuppliedCode)<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-6">方案二：iframe 沙箱（生产环境首选）</h3>
<p>对于需要立即上线的项目，iframe 是最可靠的解决方案：</p>
<pre><code class="hljs language-ini" lang="ini">function createSafeSandbox() {
    const <span class="hljs-attr">frame</span> = document.createElement(<span class="hljs-string">'iframe'</span>)<span class="hljs-comment">;</span>
    
    // 关键配置：限制权限
    <span class="hljs-attr">frame.sandbox</span> = [
        <span class="hljs-string">'allow-scripts'</span>,     // 允许执行脚本
        // <span class="hljs-string">'allow-same-origin'</span> // 谨慎使用：允许同源访问
    ].join(<span class="hljs-string">' '</span>)<span class="hljs-comment">;</span>
    
    <span class="hljs-attr">frame.style.display</span> = <span class="hljs-string">'none'</span><span class="hljs-comment">;</span>
    document.body.appendChild(frame)<span class="hljs-comment">;</span>
    
    return {
        evaluate: (code) =&gt; frame.contentWindow.eval(code),
        destroy: () =&gt; frame.remove()
    }<span class="hljs-comment">;</span>
}

// 使用示例
const <span class="hljs-attr">sandbox</span> = createSafeSandbox()<span class="hljs-comment">;</span>
try {
    const <span class="hljs-attr">result</span> = sandbox.evaluate(<span class="hljs-string">'2 + 2'</span>)<span class="hljs-comment">;</span>
    console.log('安全计算结果:', result)<span class="hljs-comment">;</span>
} finally {
    sandbox.destroy()<span class="hljs-comment">;</span>
}
</code></pre>
<h3 data-id="heading-7">方案三：Web Worker（纯计算场景）</h3>
<p>对于 CPU 密集型任务，Web Worker 提供良好的隔离性：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 创建隔离的工作线程</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">workerCode</span> = `
    <span class="hljs-built_in">self</span>.onmessage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">result</span> = <span class="hljs-keyword">eval</span>(e.data.code);
            <span class="hljs-built_in">self</span>.<span class="hljs-title function_ invoke__">postMessage</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, result });
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-built_in">self</span>.<span class="hljs-title function_ invoke__">postMessage</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: error.message });
        }
    };
`;

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">blob</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([workerCode], { type: <span class="hljs-string">'application/javascript'</span> });
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">worker</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(URL.<span class="hljs-title function_ invoke__">createObjectURL</span>(blob));

worker.onmessage = (e) =&gt; {
    <span class="hljs-keyword">if</span> (e.data.success) {
        console.<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-string">'Worker 计算结果:'</span>, e.data.result);
    } <span class="hljs-keyword">else</span> {
        console.<span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">'执行出错:'</span>, e.data.error);
    }
};

<span class="hljs-comment">// 执行用户代码</span>
worker.<span class="hljs-title function_ invoke__">postMessage</span>({
    <span class="hljs-attr">code</span>: <span class="hljs-string">'Math.pow(2, 10)'</span> // 用户提供的代码
});
</code></pre>
<h2 data-id="heading-8">真实案例：插件系统安全改造</h2>
<p>我们最近为一家金融科技客户重构了他们的报表插件系统。改造前，第三方插件经常导致整个系统崩溃；改造后，即使插件代码存在问题，也只会影响自身运行。</p>
<h3 data-id="heading-9">改造前的问题代码：</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 老系统：直接执行插件代码</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">runPlugin</span>(<span class="hljs-params">pluginCode</span>) {
    <span class="hljs-comment">// 危险！插件可以访问和修改全局状态</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">eval</span>(pluginCode);
}
</code></pre>
<h3 data-id="heading-10">改造后的安全方案：</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PluginSandbox</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">iframe</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'iframe'</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">iframe</span>.<span class="hljs-property">sandbox</span> = <span class="hljs-string">'allow-scripts'</span>;
        <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">iframe</span>);
    }
    
    <span class="hljs-title function_">runPlugin</span>(<span class="hljs-params">pluginCode, api</span>) {
        <span class="hljs-comment">// 通过 postMessage 提供有限的 API</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">iframe</span>.<span class="hljs-property">contentWindow</span>.<span class="hljs-title function_">postMessage</span>({
            <span class="hljs-attr">type</span>: <span class="hljs-string">'EXECUTE'</span>,
            <span class="hljs-attr">code</span>: pluginCode,
            <span class="hljs-attr">api</span>: api
        }, <span class="hljs-string">'*'</span>);
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
            <span class="hljs-keyword">const</span> <span class="hljs-title function_">handler</span> = (<span class="hljs-params">event</span>) =&gt; {
                <span class="hljs-keyword">if</span> (event.<span class="hljs-property">data</span>.<span class="hljs-property">type</span> === <span class="hljs-string">'RESULT'</span>) {
                    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'message'</span>, handler);
                    <span class="hljs-title function_">resolve</span>(event.<span class="hljs-property">data</span>.<span class="hljs-property">result</span>);
                }
            };
            <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, handler);
        });
    }
}
</code></pre>
<h2 data-id="heading-11">何时应该使用 Realm 技术？</h2>
<p>根据我们的项目经验，以下场景强烈推荐使用 Realm：</p>
<ol>
<li>
<p><strong>用户代码执行</strong>：在线代码编辑器、教学平台</p>
</li>
<li>
<p><strong>第三方插件</strong>：CMS 系统、电商平台的扩展功能</p>
</li>
<li>
<p><strong>A/B 测试</strong>：隔离不同版本的代码逻辑</p>
</li>
<li>
<p><strong>单元测试</strong>：确保每个测试用例环境纯净</p>
</li>
<li>
<p><strong>微前端架构</strong>：隔离不同团队开发的子应用</p>
</li>
</ol>
<h2 data-id="heading-12">安全最佳实践</h2>
<p>在多个金融级项目中，我们总结出这些安全准则：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 安全配置示例</span>
<span class="hljs-keyword">const</span> SAFE_SANDBOX_CONFIG = [
    <span class="hljs-string">'allow-scripts'</span>,        <span class="hljs-comment">// 必需：执行脚本</span>
    <span class="hljs-comment">// 'allow-forms',       // 谨慎：表单提交</span>
    <span class="hljs-comment">// 'allow-popups',      // 谨慎：弹出窗口</span>
    <span class="hljs-comment">// 'allow-same-origin', // 危险：同源访问</span>
    <span class="hljs-comment">// 'allow-top-navigation' // 危险：顶级导航</span>
];

<span class="hljs-comment">// 永远验证输入</span>
<span class="hljs-function">function <span class="hljs-title">validateCode</span>(<span class="hljs-params">code</span>)</span> {
    <span class="hljs-keyword">const</span> blacklist = [
        <span class="hljs-string">'document.cookie'</span>,
        <span class="hljs-string">'localStorage'</span>,
        <span class="hljs-string">'XMLHttpRequest'</span>,
        <span class="hljs-string">'fetch'</span>,
        <span class="hljs-string">'window.parent'</span>
    ];
    
    <span class="hljs-keyword">return</span> !blacklist.some(<span class="hljs-keyword">unsafe</span> =&gt; code.includes(<span class="hljs-keyword">unsafe</span>));
}
</code></pre>
<h2 data-id="heading-13">未来展望</h2>
<p>ShadowRealm 标准落地后，JavaScript 代码隔离将变得更加简单高效。我们团队正在密切关注相关进展，并已在几个实验性项目中开始使用 polyfill 版本。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[对于Java程序员来说，学习大模型需要重点补足哪些Python生态知识？]]></title>    <link>https://juejin.cn/post/7572142436127358995</link>    <guid>https://juejin.cn/post/7572142436127358995</guid>    <pubDate>2025-11-14T06:53:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572142436127358995" data-draft-id="7572137760447561769" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="对于Java程序员来说，学习大模型需要重点补足哪些Python生态知识？"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-11-14T06:53:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            对于Java程序员来说，学习大模型需要重点补足哪些Python生态知识？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T06:53:03.000Z" title="Fri Nov 14 2025 06:53:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>了解您希望系统性地补足Python生态知识，以便更好地融入大模型领域。对于Java程序员来说，您的优势在于强大的工程化和系统设计能力，而学习Python生态更像是掌握一套新的、更适配AI领域的工具。关键在于理解思维方式的差异，并找到与您现有知识体系的连接点。</p>
<p>下面这个表格梳理了需要重点关注的Python生态知识，并提供了与Java技术的对比和学习的核心要点，可以帮助您更有针对性地学习。</p>








































<table><thead><tr><th>学习阶段</th><th>关键知识/工具</th><th>Java程序员的参考视角/学习重点</th></tr></thead><tbody><tr><td><strong>🚀 入门基础</strong>​</td><td><strong>Python语法基础</strong>​</td><td>重点关注与Java的差异：动态类型、缩进规则、列表/字典推导式等。您的面向对象编程思想可以无缝迁移。</td></tr><tr><td/><td><strong>核心数据科学生态</strong>​</td><td><strong>NumPy</strong>：可类比为进行高效数值计算的“超级数组”；其<code>ndarray</code>是几乎所有AI库的数据基础。<strong>Pandas</strong>：是处理结构化数据（如CSV、数据库表）的利器，其<code>DataFrame</code>概念类似数据库表或Excel表格，但功能强大得多。</td></tr><tr><td><strong>🔧 核心框架</strong>​</td><td><strong>深度学习框架（PyTorch / TensorFlow）</strong> ​</td><td><strong>PyTorch</strong>​ 因其动态图（定义即运行）更友好，易于调试，是当前研究和原型开发的主流。<strong>TensorFlow</strong>​ 的静态图在生产部署上有其优势。建议从<strong>PyTorch</strong>入手。</td></tr><tr><td/><td><strong>大模型核心库：Hugging Face</strong>​</td><td>这是大模型的“模型应用商店”和工具箱。其<code>transformers</code>库提供了数千个预训练模型，<code>datasets</code>库提供海量数据，通过几行代码即可调用最先进的模型。这是学习效率最高的工具。</td></tr><tr><td><strong>⚙️ 工程与集成</strong>​</td><td><strong>应用开发与部署工具</strong>​</td><td><strong>FastAPI</strong>：用于快速构建高性能的模型API，类似Java中的Spring Boot部分功能，但更轻量、异步支持好。<strong>Docker</strong>：用于容器化部署，实现环境隔离和一致性，概念与Java项目无异。</td></tr><tr><td/><td><strong>Java-Python桥接技术</strong>​</td><td><strong>DJL (Deep Java Library)</strong> ：允许在Java应用中直接调用PyTorch/TensorFlow模型，极大降低了在现有Java系统中集成AI能力的技术门槛。</td></tr></tbody></table>
<h3 data-id="heading-0">💡 如何高效学习与实践</h3>
<p>明确了学什么，接下来的关键在于如何高效地学，并让新知识产生价值。</p>
<ol>
<li>
<p><strong>转变学习思维</strong></p>
<ul>
<li>
<p><strong>从“严谨架构”到“快速迭代”</strong> ：Python生态的优势在于丰富的库和快速原型验证。初期不必过于追求Java式的完美架构，应接受“先跑起来，再优化”的探索式编程。</p>
</li>
<li>
<p><strong>善用工具链</strong>：熟练使用<strong>Jupyter Notebook</strong>进行代码实验和数据分析，它非常适合交互式学习和探索性研究。</p>
</li>
</ul>
</li>
<li>
<p><strong>规划学习路径</strong></p>
<ul>
<li>
<p><strong>第一步：Python基础与数据科学库</strong>。快速过一遍Python语法，然后重点练习用NumPy和Pandas进行数据操作。可以找一个CSV数据集，尝试进行数据清洗、筛选和简单统计。</p>
</li>
<li>
<p><strong>第二步：深度学习框架与Hugging Face</strong>。学习PyTorch的张量操作和自动求导机制，然后用Hugging Face的<code>pipeline</code>函数快速体验文本分类、摘要生成等任务，感受大模型的能力。</p>
</li>
<li>
<p><strong>第三步：项目实战</strong>。这是最关键的一步。选择一个感兴趣的小项目，例如：</p>
<ul>
<li>
<p><strong>入门级</strong>：用FastAPI将一个简单的文本分类模型包装成RESTful API，供您的Java服务调用。</p>
</li>
<li>
<p><strong>进阶级</strong>：使用<strong>LangChain</strong>框架构建一个基于私有文档的智能问答系统（RAG），这会综合用到Hugging Face、向量数据库等知识。</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>发挥你的Java优势</strong></p>
<p>您的Java背景不是负担，而是<strong>独特的竞争优势</strong>。大模型技术从研究到落地，迫切需要强大的工程化能力。您可以专注于：</p>
<ul>
<li>
<p><strong>AI应用工程化</strong>：思考如何将Python开发的模型用Docker容器化，如何用Java（通过DJL或HTTP API）集成模型并提供高可用、高并发的服务。</p>
</li>
<li>
<p><strong>系统架构设计</strong>：如何设计微服务来管理多个模型的生命周期？如何实现模型的版本管理、灰度发布和监控？这些都是您非常擅长而纯Python研究者可能薄弱的地方。</p>
</li>
</ul>
</li>
</ol>
<p>希望这份梳理能帮助您清晰地规划Python生态的学习。这是一个“磨刀不误砍柴工”的过程，一旦掌握了这些工具，您就能将强大的Java工程能力与前沿的AI模型能力相结合，真正具备成为“AI时代全栈工程师”的潜力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[你离前端动画高手只差这个秘籍！GSAP ScrollTrigger 动画完全指南！(第一章)]]></title>    <link>https://juejin.cn/post/7572157115907375154</link>    <guid>https://juejin.cn/post/7572157115907375154</guid>    <pubDate>2025-11-14T05:39:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572157115907375154" data-draft-id="7572039006529863716" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="你离前端动画高手只差这个秘籍！GSAP ScrollTrigger 动画完全指南！(第一章)"/> <meta itemprop="keywords" content="前端,动效"/> <meta itemprop="datePublished" content="2025-11-14T05:39:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="孟祥_成都"/> <meta itemprop="url" content="https://juejin.cn/user/96412752684744"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            你离前端动画高手只差这个秘籍！GSAP ScrollTrigger 动画完全指南！(第一章)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/96412752684744/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    孟祥_成都
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T05:39:47.000Z" title="Fri Nov 14 2025 05:39:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>这里没有冗长的理论，只有动画实战中的<strong>精华干货</strong>。本节不涉及复杂的技术细节，而是为你描绘学成后的蓝图 —— 你能实现怎样的效果，并能拿到源码亲手实践、欢迎一起交流。</p>
<p>本系列聚焦于网页 <code>scroll</code> 滚动动画，核心工具是 <code>gsap</code>。这个动画库在国外极为流行，但在国内知名度还不高（早期因收费门槛，近年已完全免费）。加上目前国内企业对动效的要求尚未普及，因此了解它的人并不多。</p>
<p>但请相信，如果你渴望做出令人惊叹的网页动画，看完我们最终要实现的效果，你一定会心动，并愿意加入我们的 <strong>「前端动画交流群」</strong>，一起进阶、一起成长。</p>
<h2 data-id="heading-1">GSAP 是什么？</h2>
<p>GSAP 是国外顶尖的专业动画库，大多数让人“眼前一亮”的网页动画，背后都有它的身影（当然，像 <code>Framer Motion</code> 这类新秀也同样强大，后续我们也会推出相关高阶教程）。</p>
<p>现在，就来看看 GSAP 能做出哪些<strong>炸裂的视觉效果</strong>吧！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bddd8e374bc47fe99b5f9719b002c88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763703587&amp;x-signature=G1SNM5vKkDZRDOlcoTnzbDlu5RU%3D" alt="all.gif" loading="lazy"/></p>
<p>里面涉及的 <code>3D</code> 效果，其实是结合了 <code>three.js</code> 与 <code>gsap</code> 共同实现的。也就是说，光会 <code>three.js</code>，离做出真正酷炫的动画还差一步。</p>
<p>所以，我们不妨<strong>从易到难</strong>，先掌握 <code>2D</code> 动画，做出看得见的效果——这不仅能帮你夯实基础，也会极大增强你的信心。</p>
<p>我们这个动画系列，将专注于 <code>gsap</code> 在 <strong>scroll 滚动动画</strong> 方面的应用。可能有同学会问：为什么只讲滚动动画？</p>
<h2 data-id="heading-2">为什么选择用它实现 Scroll 动画？</h2>
<ol>
<li>
<p><strong>更聚焦于一个技术点</strong><br/>
<code>gsap</code> 动画涉及的点太多了，如果全面展开，整个教程周期会拉得非常长。我们希望在有限时间内，带你学透一个真正实用的高价值模块。所以选择了 <code>scroll</code> 这块。</p>
</li>
<li>
<p><strong>GSAP 最牛的插件就是跟滚动相关的</strong><br/>
如果要问 GSAP 相较于其他动画库最强大的功能是什么，那一定是与滚动相关的 <strong>ScrollTrigger 插件</strong>。它到底能实现多震撼的效果？下面我们来看几个典型示例（这些案例在后续教程中都会一一实现）</p>
</li>
</ol>
<h2 data-id="heading-3">一些实现效果</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ad72c205d334880a960ef1aab34ccde~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763703587&amp;x-signature=H1b990dpdWpja1Qbs3xvZKfEd0s%3D" alt="Nov-14-2025 11-05-05.gif" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/256a18ceb89740b8a9c28b81768ee097~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763703587&amp;x-signature=XUSs3jwgU35n8jIYOmSbOr%2F94eU%3D" alt="Nov-14-2025 11-10-35.gif" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d47b4a193764ecc81a120438526ae38~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763703587&amp;x-signature=Y%2BBF2CKvlb482EuIMygIAvCjyI8%3D" alt="Nov-14-2025 11-11-20.gif" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7db11e48883846bf93507daab454c415~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763703587&amp;x-signature=WSXTnBIJ3Nb33smtw5No8Zb8P6E%3D" alt="Nov-14-2025 11-21-24.gif" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17a0d53b8a124b3ba7ef1921794d0817~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763703587&amp;x-signature=cRArGd8ASGp73Cat1IHSzmzt%2Fgk%3D" alt="Nov-14-2025 10-57-11.gif" loading="lazy"/></p>
<p>以上只是冰山一角，总共案例很多，目前手上有接近 <code>100</code> 个效果，但是后期逐步完成多少，现在还没具体规划，但至少几十个肯定有的！</p>
<h2 data-id="heading-4">关于本教程</h2>
<p>本系列内容融合了国外优质付费课程与多位大神的实战案例，虽是我个人学习与整合的成果，但在内容深度与体系性上，有信心达到国内 <strong>TOP 级别</strong>。纯为分享，希望与你一起进步。</p>
<p>作为前端开发者，很多人都是被那些“会动”的酷炫界面吸引入行的。遗憾的是，国内在这方面的高质量资源并不多。而我，不仅深深享受着做出流畅动画带来的成就感，也坚信自己会在这条路上走得更远，也希望有同行的伙伴！</p>
<p>这里也分享我个人的组件库项目：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flio-mengxiang%2Ft-ui" target="_blank" title="https://github.com/lio-mengxiang/t-ui" ref="nofollow noopener noreferrer">T-UI GitHub 地址</a>（如需访问请科学上网）。它的官网动效仅花了 <strong>1 个月</strong> 学习与实践完成，效果还算不错，欢迎看看源码、给个 Star ⭐️，我们一起交流！</p>
<h2 data-id="heading-5">教程安排</h2>
<p><strong>第一部分：系统入门</strong><br/>
基本上是拿国外很好一个技术教程来分享(同时提醒大家，学好英语是非常非常重要的，我也一直在坚持，大概1年时间，效果还是挺明显的，看这个教程基本上不看字幕能听懂百分之 80)</p>
<p>为什么选择这个教程呢，因为我对比过多个教程，这个教程优点非常突出。</p>
<ul>
<li>
<p>有 <strong>核心原理</strong> 讲解：这点至关重要。初学 <code>ScrollTrigger</code> 时，我经常会遇到一些莫名其妙的布局问题。（是因为 <code>ScrollTrigger</code> 插件会在某些情况下会影响到布局），如果不了解，很难去解决这些问题。</p>
</li>
<li>
<p><strong>案例丰富</strong>：该教程几乎覆盖了所有关键技术点与动画类型，能帮我们省去大量自己设计案例的时间。</p>
</li>
</ul>
<p><strong>第二部分：实战进阶</strong></p>
<p>我们将一起复现 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.awwwards.com%2F" target="_blank" title="https://www.awwwards.com/" ref="nofollow noopener noreferrer">Awwwards</a> 上的获奖网站效果。（如果全球最顶尖的网站动效在哪个网站，没错，就是这个网站了）这些效果在上面我们展示过，也是我之前看一些大神的博客、视频，然后学习的资料，发现确实很有帮助，也一起分享，算是巩固我自己所学的同时也能分享出来！</p>
<h2 data-id="heading-6">欢迎加入我们的技术交流群</h2>
<p>我们群是一个覆盖 <strong>前端动画</strong>、<strong>Node.js</strong>、<strong>AI Agent 开发</strong> 及我的组件库项目 <strong>T-UI</strong> 的综合性技术交流社区。</p>
<p>目前，<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flio-mengxiang%2Ft-ui" target="_blank" title="https://github.com/lio-mengxiang/t-ui" ref="nofollow noopener noreferrer">T-UI</a> 是群内最成熟、讨论最活跃的项目。从源码质量到官网效果，都经得起细看。欢迎你来交流想法、贡献代码，或 simply give it a star——❤️ 比心！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java进阶（二：Maven——Java项目管理工具）]]></title>    <link>https://juejin.cn/post/7572115057222533155</link>    <guid>https://juejin.cn/post/7572115057222533155</guid>    <pubDate>2025-11-14T05:44:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572115057222533155" data-draft-id="7572051762984058932" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java进阶（二：Maven——Java项目管理工具）"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-14T05:44:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="爱分享的鱼鱼"/> <meta itemprop="url" content="https://juejin.cn/user/3901536646733133"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java进阶（二：Maven——Java项目管理工具）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3901536646733133/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    爱分享的鱼鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T05:44:47.000Z" title="Fri Nov 14 2025 05:44:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><h2 data-id="heading-0">什么是Maven？</h2>
<p>Maven 是一个强大的 <strong>项目管理和构建自动化工具</strong>，主要用于 Java 项目。它通过项目对象模型（POM，Project Object Model）来描述项目，管理依赖、构建生命周期、插件等，极大地简化了 Java 项目的构建和管理过程。他极大的简化了java的依赖管理，同时让采用maven架构的项目长得一样整齐，便于维护二开。举几个没有maven的糟糕例子。</p>
<h3 data-id="heading-1">如果没有Maven</h3>
<p><strong>手动找 jar</strong>：打开搜索引擎 → 输入“spring-core-5.3.9.jar 下载” → 点进广告满天飞的论坛 → 下错版本 → 运行时报 NoSuchMethodError → 重下 → 再试。</p>
<p><strong>版本冲突靠眼神</strong>：A 框架要 log4j-1.2.17，B 框架要 log4j-1.2.15，你只有把两个 jar 都扔进 lib，classpath 里谁先谁后全凭天命。</p>
<p><strong>目录结构“百家争鸣”</strong>： 张三把源码放 <code>src/</code>，李四放 <code>source/</code>，王五把测试代码叫 <code>testSrc/</code>；新人入职第一件事是问“咱们这个项目咋编译？”</p>
<p><strong>构建脚本成“传家宝”</strong>:每人私藏一份 2000 行 Ant XML，里面硬编码了 <code>D:\tomcat\webapps</code> 路径；换台电脑就跑不起来。</p>
<p><strong>CI/CD 寸步难行</strong>: Jenkins 里要先把 jar 拷到 lib、再改版本号、再手动点按钮；上线一次 30 分钟，喝 3 杯咖啡等结果。</p>
<h3 data-id="heading-2">Maven 的核心功能：</h3>





























<table><thead><tr><th align="left">功能</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><strong>依赖管理</strong></td><td align="left">自动下载和管理项目所需的第三方库（如 Spring、MyBatis 等），避免手动导入 jar 包。</td></tr><tr><td align="left"><strong>项目构建</strong></td><td align="left">提供标准化的构建流程：编译、测试、打包、部署等。</td></tr><tr><td align="left"><strong>统一结构</strong></td><td align="left">规定项目目录结构（如 <code>src/main/java</code>、<code>src/test/java</code>），提高项目可读性和可维护性。</td></tr><tr><td align="left"><strong>插件机制</strong></td><td align="left">支持通过插件扩展功能，如打包成 jar、war，生成文档，运行测试等。</td></tr><tr><td align="left"><strong>多模块支持</strong></td><td align="left">支持大型项目的模块化开发，便于管理多个子项目。</td></tr></tbody></table>
<h2 data-id="heading-3">如何搭建第一个 Maven 工程</h2>
<h3 data-id="heading-4">1. 环境准备</h3>
<ul>
<li><strong>安装 JDK</strong>：确保已安装 Java Development Kit</li>
<li><strong>安装 Maven</strong>：下载并配置 Apache Maven 环境变量</li>
<li><strong>验证安装</strong>：在命令行执行以下命令确认安装成功
<pre><code class="hljs language-bash" lang="bash">mvn -version
</code></pre>
</li>
</ul>
<h3 data-id="heading-5">2. 创建 Maven 项目</h3>
<h4 data-id="heading-6">IDE创建</h4>
<p>在Idea等编辑器新建项目时在“构建系统”中选择Maven</p>
<h4 data-id="heading-7">使用命令行创建</h4>
<pre><code class="hljs language-bash" lang="bash">mvn archetype:generate -DgroupId=com.example -DartifactId=my-first-maven-project -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=<span class="hljs-literal">false</span>
</code></pre>
<h4 data-id="heading-8">手动创建项目结构</h4>
<pre><code class="hljs language-css" lang="css">my-first-maven-project/
├── <span class="hljs-attribute">src</span>/
│   ├── <span class="hljs-selector-tag">main</span>/
│   │   └── java/
│   │       └── com/
│   │           └── example/
│   │               └── App<span class="hljs-selector-class">.java</span>
│   └── test/
│       └── java/
│           └── com/
│               └── example/
│                   └── AppTest<span class="hljs-selector-class">.java</span>
└── pom<span class="hljs-selector-class">.xml</span>
</code></pre>
<h3 data-id="heading-9">3. 配置 pom.xml</h3>
<p>创建基本的 <code>pom.xml</code> 文件：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 
         http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>my-first-maven-project<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>
</code></pre>
<h3 data-id="heading-10">4. 编写代码</h3>
<p>在 <code>src/main/java/com/example/App.java</code> 中创建主类：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">App</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"Hello Maven!"</span>);
    }
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sayHello</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello "</span> + name + <span class="hljs-string">"!"</span>;
    }
}
</code></pre>
<h3 data-id="heading-11">5. 编译和构建</h3>
<h4 data-id="heading-12">编译项目</h4>
<pre><code class="hljs language-bash" lang="bash">mvn compile
</code></pre>
<h4 data-id="heading-13">运行测试</h4>
<pre><code class="hljs language-bash" lang="bash">mvn <span class="hljs-built_in">test</span>
</code></pre>
<h4 data-id="heading-14">打包项目</h4>
<pre><code class="hljs language-bash" lang="bash">mvn package
</code></pre>
<h4 data-id="heading-15">清理构建结果</h4>
<pre><code class="hljs language-bash" lang="bash">mvn clean
</code></pre>
<h3 data-id="heading-16">6. Maven 标准目录结构</h3>
<ul>
<li><code>src/main/java/</code>：Java 源代码</li>
<li><code>src/main/resources/</code>：资源文件</li>
<li><code>src/test/java/</code>：测试代码</li>
<li><code>src/test/resources/</code>：测试资源文件</li>
<li><code>target/</code>：构建输出目录</li>
<li><code>pom.xml</code>：项目对象模型文件</li>
</ul>
<h2 data-id="heading-17">POM 文件全解</h2>
<h3 data-id="heading-18">1. POM 基本概念</h3>
<p><code>Project Object Model</code> (<code>POM</code>) 是 Maven 项目的核心配置文件，定义了项目的基本信息、依赖关系、构建配置等内容。</p>
<h3 data-id="heading-19">2. POM 文件基本结构</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 
         http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 项目基本信息 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>my-app<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>jar<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 属性配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 依赖配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 依赖项 --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 构建配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 构建插件 --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>
</code></pre>
<h3 data-id="heading-20">3. 核心元素详解</h3>
<h4 data-id="heading-21">3.1 基本坐标信息</h4>
<ul>
<li><code>groupId</code>: 组织标识符，通常使用反向域名</li>
<li><code>artifactId</code>: 项目唯一标识符</li>
<li><code>version</code>: 项目版本号</li>
<li><code>packaging</code>: 打包方式（jar、war、pom等）</li>
</ul>
<h4 data-id="heading-22">3.2 属性配置 (<code>properties</code>)</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
</code></pre>
<h4 data-id="heading-23">3.3 依赖管理 (<code>dependencies</code>)</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h5 data-id="heading-24">依赖范围 (<code>scope</code>)</h5>
<ul>
<li><code>compile</code>: 编译依赖（默认）</li>
<li><code>provided</code>: 编译和测试时需要，运行时由容器提供</li>
<li><code>runtime</code>: 运行和测试时需要，编译不需要</li>
<li><code>test</code>: 仅测试时需要</li>
<li><code>system</code>: 系统级依赖</li>
</ul>
<h4 data-id="heading-25">3.4 继承与聚合</h4>
<h5 data-id="heading-26">父项目继承</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.7.14<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>
</code></pre>
<h5 data-id="heading-27">子模块聚合</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">modules</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>module1<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>module2<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">modules</span>&gt;</span>
</code></pre>
<h3 data-id="heading-28">4. 构建配置 (<code>build</code>)</h3>
<h4 data-id="heading-29">4.1 插件配置</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<h4 data-id="heading-30">4.2 资源配置</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/resources<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">filtering</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">filtering</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span>
</code></pre>
<h3 data-id="heading-31">5. 依赖管理进阶</h3>
<h4 data-id="heading-32">5.1 依赖管理 (<code>dependencyManagement</code>)</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span>
</code></pre>
<h4 data-id="heading-33">5.2 排除依赖</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-logging<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-34">6. Profiles 配置</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">profiles</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>dev<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">environment</span>&gt;</span>development<span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>prod<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">environment</span>&gt;</span>production<span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">profiles</span>&gt;</span>
</code></pre>
<h3 data-id="heading-35">7. 仓库配置</h3>
<h4 data-id="heading-36">7.1 远程仓库</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">repositories</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>central<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://repo.maven.apache.org/maven2<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">repositories</span>&gt;</span>
</code></pre>
<h4 data-id="heading-37">7.2 插件仓库</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">pluginRepositories</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">pluginRepository</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>central<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://repo.maven.apache.org/maven2<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">pluginRepository</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">pluginRepositories</span>&gt;</span>
</code></pre>
<h3 data-id="heading-38">8. 常用 Maven 属性</h3>
<ul>
<li><code>${project.groupId}</code>: 项目 groupId</li>
<li><code>${project.artifactId}</code>: 项目 artifactId</li>
<li><code>${project.version}</code>: 项目版本</li>
<li><code>${project.build.directory}</code>: 构建目录（target）</li>
<li><code>${project.build.outputDirectory}</code>: 输出目录（target/classes）</li>
<li><code>${project.build.testOutputDirectory}</code>: 测试输出目录（target/test-classes）</li>
</ul>
<p>POM 文件是 Maven 项目的核心，合理配置 POM 可以有效管理项目依赖、构建过程和发布流程。</p>
<h2 data-id="heading-39">Maven 生命周期与插件</h2>
<h3 data-id="heading-40">1. Maven 生命周期</h3>
<p>Maven 生命周期是 Maven 构建过程的抽象表示，定义了构建项目的各个阶段。</p>
<h4 data-id="heading-41">1.1 三套生命周期</h4>
<h5 data-id="heading-42">Clean Lifecycle（清理生命周期）</h5>
<ul>
<li><code>pre-clean</code>: 执行清理前的工作</li>
<li><code>clean</code>: 清理上一次构建生成的文件（删除 <code>target</code> 目录）</li>
<li><code>post-clean</code>: 执行清理后的工作</li>
</ul>
<h5 data-id="heading-43">Default Lifecycle（默认生命周期）</h5>
<ul>
<li><code>validate</code>: 验证项目正确性和必要信息</li>
<li><code>initialize</code>: 初始化构建状态</li>
<li><code>generate-sources</code>: 生成需要编译的源码</li>
<li><code>process-sources</code>: 处理源码</li>
<li><code>generate-resources</code>: 生成需要打包的资源文件</li>
<li><code>process-resources</code>: 处理资源文件并复制到目标目录</li>
<li><code>compile</code>: 编译项目的源码</li>
<li><code>process-classes</code>: 处理编译后的class文件</li>
<li><code>generate-test-sources</code>: 生成测试需要的源码</li>
<li><code>process-test-sources</code>: 处理测试源码</li>
<li><code>generate-test-resources</code>: 生成测试需要的资源文件</li>
<li><code>process-test-resources</code>: 处理测试资源文件</li>
<li><code>test-compile</code>: 编译测试源码</li>
<li><code>process-test-classes</code>: 处理编译后的测试class文件</li>
<li><code>test</code>: 使用单元测试框架运行测试</li>
<li><code>prepare-package</code>: 打包前的准备工作</li>
<li><code>package</code>: 将编译后的代码打包成可分发格式</li>
<li><code>pre-integration-test</code>: 集成测试前的准备工作</li>
<li><code>integration-test</code>: 处理和部署包到集成测试环境</li>
<li><code>post-integration-test</code>: 集成测试后的操作</li>
<li><code>verify</code>: 运行检查验证包是否有效且达到质量标准</li>
<li><code>install</code>: 将包安装到本地仓库</li>
<li><code>deploy</code>: 将最终的包复制到远程仓库</li>
</ul>
<h5 data-id="heading-44">Site Lifecycle（站点生命周期）</h5>
<ul>
<li><code>pre-site</code>: 生成站点文档前的处理</li>
<li><code>site</code>: 生成项目的站点文档</li>
<li><code>post-site</code>: 生成站点文档后的处理</li>
<li><code>site-deploy</code>: 将生成的站点文档部署到指定服务器</li>
</ul>
<h4 data-id="heading-45">1.2 生命周期特点</h4>
<ul>
<li>后面的阶段依赖于前面的阶段</li>
<li>跳转到某个阶段会自动执行前面的所有阶段</li>
<li>不同生命周期可以同时执行</li>
</ul>
<h3 data-id="heading-46">2. Maven 插件</h3>
<p>Maven 插件是实际执行构建任务的组件，每个阶段都由特定插件的目标（goal）来执行。</p>
<h4 data-id="heading-47">2.1 插件类型</h4>
<h5 data-id="heading-48">Build Plugins（构建插件）</h5>
<p>在构建生命周期中执行，在 <code>pom.xml</code> 的 <code>&lt;build&gt;</code> 元素中配置：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<h5 data-id="heading-49">Reporting Plugins（报告插件）</h5>
<p>在站点生成过程中执行，在 <code>pom.xml</code> 的 <code>&lt;reporting&gt;</code> 元素中配置：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">reporting</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-javadoc-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">reporting</span>&gt;</span>
</code></pre>
<h4 data-id="heading-50">2.2 常用核心插件</h4>


















































<table><thead><tr><th>插件</th><th>功能</th><th>默认绑定阶段</th></tr></thead><tbody><tr><td><code>maven-clean-plugin</code></td><td>清理构建产物</td><td>clean</td></tr><tr><td><code>maven-compiler-plugin</code></td><td>编译Java源码</td><td>compile, testCompile</td></tr><tr><td><code>maven-resources-plugin</code></td><td>处理资源文件</td><td>process-resources, process-test-resources</td></tr><tr><td><code>maven-surefire-plugin</code></td><td>运行单元测试</td><td>test</td></tr><tr><td><code>maven-jar-plugin</code></td><td>打包JAR文件</td><td>package</td></tr><tr><td><code>maven-war-plugin</code></td><td>打包WAR文件</td><td>package</td></tr><tr><td><code>maven-install-plugin</code></td><td>安装到本地仓库</td><td>install</td></tr><tr><td><code>maven-deploy-plugin</code></td><td>部署到远程仓库</td><td>deploy</td></tr></tbody></table>
<h4 data-id="heading-51">2.3 插件配置示例</h4>
<h5 data-id="heading-52">编译插件配置</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">encoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">encoding</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
</code></pre>
<h5 data-id="heading-53">打包插件配置</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mainClass</span>&gt;</span>com.example.Application<span class="hljs-tag">&lt;/<span class="hljs-name">mainClass</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
</code></pre>
<h3 data-id="heading-54">3. 命令行执行</h3>
<h4 data-id="heading-55">3.1 执行特定阶段</h4>
<pre><code class="hljs language-bash" lang="bash">mvn clean              <span class="hljs-comment"># 执行 clean 生命周期到 clean 阶段</span>
mvn compile            <span class="hljs-comment"># 执行 default 生命周期到 compile 阶段</span>
mvn <span class="hljs-built_in">test</span>               <span class="hljs-comment"># 执行 default 生命周期到 test 阶段</span>
mvn package            <span class="hljs-comment"># 执行 default 生命周期到 package 阶段</span>
mvn install            <span class="hljs-comment"># 执行 default 生命周期到 install 阶段</span>
mvn site               <span class="hljs-comment"># 执行 site 生命周期到 site 阶段</span>
</code></pre>
<h4 data-id="heading-56">3.2 执行特定插件目标</h4>
<pre><code class="hljs language-bash" lang="bash">mvn plugin:goal
mvn compiler:compile
mvn surefire:<span class="hljs-built_in">test</span>
mvn <span class="hljs-built_in">help</span>:describe -Dplugin=compiler
</code></pre>
<h4 data-id="heading-57">3.3 组合执行</h4>
<pre><code class="hljs language-bash" lang="bash">mvn clean install      <span class="hljs-comment"># 先清理再安装</span>
mvn clean compile <span class="hljs-built_in">test</span> <span class="hljs-comment"># 清理、编译、测试</span>
</code></pre>
<h3 data-id="heading-58">4. 自定义插件绑定</h3>
<p>可以在 <code>pom.xml</code> 中自定义插件绑定到特定阶段：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-antrun-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>echo-message<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>run<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">tasks</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">echo</span>&gt;</span>Hello from AntRun Plugin!<span class="hljs-tag">&lt;/<span class="hljs-name">echo</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">tasks</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<p>Maven 的生命周期和插件机制提供了强大的构建自动化能力，通过合理的配置可以满足各种复杂的构建需求。</p>
<h2 data-id="heading-59">其他构建框架</h2>
<p>除了Maven之外，Java生态中还有多种仓库管理工具，每种工具都有其独特的特点和适用场景‌。</p>
<ul>
<li>‌<strong>Ant</strong>‌ 是最早的构建工具，专注于通过XML脚本实现项目构建自动化，但缺乏内置的依赖管理功能‌56</li>
<li>‌<strong>Ivy</strong>‌ 是依赖管理工具，通常与Ant配合使用，为Ant项目提供依赖管理能力‌12</li>
<li>‌<strong>Maven</strong>‌ 在Ant基础上发展而来，集成了依赖管理、项目结构约定和构建生命周期，采用"约定优于配置"原则‌45</li>
<li>‌<strong>Gradle</strong>‌ 融合了Ant的灵活性和Maven的依赖管理，使用Groovy/Kotlin DSL，提供了更强大的构建能力‌34</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React 18 新特性深度解析]]></title>    <link>https://juejin.cn/post/7572087162231554090</link>    <guid>https://juejin.cn/post/7572087162231554090</guid>    <pubDate>2025-11-14T03:25:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572087162231554090" data-draft-id="7572138663120027690" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React 18 新特性深度解析"/> <meta itemprop="keywords" content="前端,JavaScript,React.js"/> <meta itemprop="datePublished" content="2025-11-14T03:25:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小小前端_我自坚强"/> <meta itemprop="url" content="https://juejin.cn/user/2335811609826423"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React 18 新特性深度解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2335811609826423/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小小前端_我自坚强
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T03:25:27.000Z" title="Fri Nov 14 2025 03:25:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="ocean">.hljs-comment,.hljs-quote{color:#65737e}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#bf616a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#d08770}.hljs-attribute{color:#ebcb8b}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#a3be8c}.hljs-section,.hljs-title{color:#8fa1b3}.hljs-keyword,.hljs-selector-tag{color:#b48ead}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b303b;color:#c0c5ce}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">React 18 新特性深度解析</h2>
<h3 data-id="heading-1">引言</h3>
<p>React 18 是 React 发展历程中的一个重要里程碑，它引入了许多激动人心的新特性和改进。作为前端开发者，理解和掌握这些新特性对于构建高性能、现代化的 React 应用至关重要。本文将深入探讨 React 18 的各项新特性，通过实际代码示例和详细分析，帮助读者全面掌握这一版本的核心功能。</p>
<h3 data-id="heading-2">第一章：React 18 概述</h3>
<h4 data-id="heading-3">1.1 React 18 的发布背景</h4>
<p>React 18 于 2022 年 3 月正式发布，这是 React 自 2013 年开源以来的又一次重大更新。与之前的版本相比，React 18 的主要目标是：</p>
<ol>
<li><strong>提升应用性能</strong>：通过并发渲染等新特性优化用户体验</li>
<li><strong>改善开发体验</strong>：提供更好的调试工具和开发工具链支持</li>
<li><strong>增强 API 一致性</strong>：统一自动批处理等行为</li>
<li><strong>为未来特性奠定基础</strong>：为 React Server Components 等未来特性做准备</li>
</ol>
<h4 data-id="heading-4">1.2 React 18 的核心特性</h4>
<p>React 18 引入了以下几个核心特性：</p>
<ol>
<li><strong>自动批处理（Automatic Batching）</strong></li>
<li><strong>并发渲染（Concurrent Rendering）</strong></li>
<li><strong>新的根 API（New Root API）</strong></li>
<li><strong>Suspense 的改进</strong></li>
<li><strong>新的 Hooks：useId、useSyncExternalStore、useInsertionEffect</strong></li>
</ol>
<h3 data-id="heading-5">第二章：自动批处理（Automatic Batching）</h3>
<h4 data-id="heading-6">2.1 什么是批处理</h4>
<p>批处理是指 React 将多个状态更新合并到单个重新渲染中，以提高性能。在 React 18 之前，React 只能在 React 事件处理程序中进行批处理，而在 Promise、setTimeout、原生事件处理程序等异步操作中不会自动批处理。</p>
<h4 data-id="heading-7">2.2 React 18 之前的批处理行为</h4>
<p>让我们先看看 React 18 之前的行为：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// React 17 及之前版本的行为</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> [flag, setFlag] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// React 17 中，这些更新会被批处理</span>
    <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c + <span class="hljs-number">1</span>);
    <span class="hljs-title function_">setFlag</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> !f);
    <span class="hljs-comment">// React 只会重新渲染一次</span>
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleAsyncClick</span>(<span class="hljs-params"/>) {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// React 17 中，这些更新不会被批处理</span>
      <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c + <span class="hljs-number">1</span>);
      <span class="hljs-title function_">setFlag</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> !f);
      <span class="hljs-comment">// React 会重新渲染两次</span>
    }, <span class="hljs-number">0</span>);
  }

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleClick}</span>&gt;</span>同步更新<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleAsyncClick}</span>&gt;</span>异步更新<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Count: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Flag: {String(flag)}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-8">2.3 React 18 的自动批处理</h4>
<p>React 18 通过引入自动批处理机制，解决了上述问题。现在，无论状态更新发生在何处，React 都会自动将它们批处理到单个重新渲染中。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// React 18 中的自动批处理</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> [flag, setFlag] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 这些更新会被批处理</span>
    <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c + <span class="hljs-number">1</span>);
    <span class="hljs-title function_">setFlag</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> !f);
    <span class="hljs-comment">// React 只会重新渲染一次</span>
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleAsyncClick</span>(<span class="hljs-params"/>) {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// 现在这些更新也会被批处理</span>
      <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c + <span class="hljs-number">1</span>);
      <span class="hljs-title function_">setFlag</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> !f);
      <span class="hljs-comment">// React 只会重新渲染一次</span>
    }, <span class="hljs-number">0</span>);
  }

  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleFetchClick</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/data'</span>);
      <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
      
      <span class="hljs-comment">// 这些更新也会被批处理</span>
      <span class="hljs-title function_">setCount</span>(data.<span class="hljs-property">count</span>);
      <span class="hljs-title function_">setFlag</span>(data.<span class="hljs-property">flag</span>);
      <span class="hljs-comment">// React 只会重新渲染一次</span>
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Fetch error:'</span>, error);
    }
  }

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleClick}</span>&gt;</span>同步更新<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleAsyncClick}</span>&gt;</span>异步更新<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleFetchClick}</span>&gt;</span>异步获取数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Count: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Flag: {String(flag)}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-9">2.4 手动控制批处理</h4>
<p>虽然自动批处理是默认行为，但在某些情况下，你可能需要手动控制批处理。React 18 提供了 <code>flushSync</code> 函数来强制 React 同步刷新状态更新。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { flushSync } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> [flag, setFlag] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 使用 flushSync 强制同步刷新</span>
    <span class="hljs-title function_">flushSync</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c + <span class="hljs-number">1</span>);
    });
    <span class="hljs-comment">// 此时组件已经重新渲染</span>
    
    <span class="hljs-title function_">flushSync</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">setFlag</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> !f);
    });
    <span class="hljs-comment">// 组件再次重新渲染</span>
    
    <span class="hljs-comment">// 总共重新渲染了两次</span>
  }

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleClick}</span>&gt;</span>强制同步更新<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Count: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Flag: {String(flag)}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-10">2.5 自动批处理的优势</h4>
<p>自动批处理带来了以下优势：</p>
<ol>
<li><strong>性能提升</strong>：减少了不必要的重新渲染次数</li>
<li><strong>一致性</strong>：无论更新发生在何处，行为都是一致的</li>
<li><strong>简化开发</strong>：开发者无需关心更新发生的位置</li>
</ol>
<h3 data-id="heading-11">第三章：并发渲染（Concurrent Rendering）</h3>
<h4 data-id="heading-12">3.1 什么是并发渲染</h4>
<p>并发渲染是 React 18 最重要的新特性之一。它允许 React 在准备更新时同时在后台渲染多个版本，从而实现更流畅的用户体验。并发渲染不是并行执行，而是中断和恢复的能力。</p>
<h4 data-id="heading-13">3.2 并发渲染的核心概念</h4>
<h5 data-id="heading-14">3.2.1 可中断渲染</h5>
<p>在 React 18 之前，一旦渲染开始，就无法中断。如果渲染过程很耗时，会导致界面卡顿。并发渲染允许 React 在必要时中断渲染，处理更高优先级的更新。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 模拟耗时组件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ExpensiveComponent</span>(<span class="hljs-params">{ items }</span>) {
  <span class="hljs-keyword">const</span> startTime = performance.<span class="hljs-title function_">now</span>();
  
  <span class="hljs-comment">// 模拟耗时计算</span>
  <span class="hljs-keyword">const</span> expensiveValue = items.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, item</span>) =&gt;</span> {
    <span class="hljs-comment">// 复杂计算</span>
    <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++) {
      result += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(item.<span class="hljs-property">value</span> * i);
    }
    <span class="hljs-keyword">return</span> acc + result;
  }, <span class="hljs-number">0</span>);
  
  <span class="hljs-keyword">const</span> duration = performance.<span class="hljs-title function_">now</span>() - startTime;
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>计算结果: {expensiveValue.toFixed(2)}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>计算耗时: {duration.toFixed(2)}ms<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h5 data-id="heading-15">3.2.2 优先级调度</h5>
<p>React 18 引入了优先级调度机制，允许不同类型的更新有不同的优先级。用户交互通常具有更高的优先级，而后台数据加载等操作优先级较低。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useState, useTransition } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [isPending, startTransition] = <span class="hljs-title function_">useTransition</span>();
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> [items, setItems] = <span class="hljs-title function_">useState</span>([]);

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleUrgentUpdate</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 紧急更新 - 高优先级</span>
    <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c + <span class="hljs-number">1</span>);
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleDeferredUpdate</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 延迟更新 - 低优先级</span>
    <span class="hljs-title function_">startTransition</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> newItems = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">10000</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> ({
        <span class="hljs-attr">id</span>: i,
        <span class="hljs-attr">value</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()
      }));
      <span class="hljs-title function_">setItems</span>(newItems);
    });
  }

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleUrgentUpdate}</span>&gt;</span>
        紧急更新 (Count: {count})
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleDeferredUpdate}</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">{isPending}</span>&gt;</span>
        {isPending ? '加载中...' : '延迟更新'}
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      
      {isPending &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>正在后台处理...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}
      
      <span class="hljs-tag">&lt;<span class="hljs-name">ExpensiveList</span> <span class="hljs-attr">items</span>=<span class="hljs-string">{items}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ExpensiveList</span>(<span class="hljs-params">{ items }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
      {items.map(item =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span>&gt;</span>{item.value.toFixed(4)}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-16">3.3 useTransition Hook</h4>
<p><code>useTransition</code> 是 React 18 提供的一个重要 Hook，用于标记某些状态更新为"过渡"更新，即低优先级更新。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useState, useTransition } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">SearchResults</span>(<span class="hljs-params">{ query }</span>) {
  <span class="hljs-keyword">const</span> [isPending, startTransition] = <span class="hljs-title function_">useTransition</span>();
  <span class="hljs-keyword">const</span> [results, setResults] = <span class="hljs-title function_">useState</span>([]);

  <span class="hljs-comment">// 模拟搜索功能</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">search</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">searchQuery</span>) =&gt; {
    <span class="hljs-comment">// 模拟 API 调用延迟</span>
    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1000</span>));
    
    <span class="hljs-comment">// 模拟搜索结果</span>
    <span class="hljs-keyword">const</span> mockResults = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(
      { <span class="hljs-attr">length</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">50</span>) },
      <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> <span class="hljs-string">`结果 <span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span> for "<span class="hljs-subst">${searchQuery}</span>"`</span>
    );
    
    <span class="hljs-keyword">return</span> mockResults;
  };

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSearch</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">e</span>) =&gt; {
    <span class="hljs-keyword">const</span> searchQuery = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>;
    
    <span class="hljs-comment">// 使用 transition 标记为低优先级更新</span>
    <span class="hljs-title function_">startTransition</span>(<span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-keyword">const</span> searchResults = <span class="hljs-keyword">await</span> <span class="hljs-title function_">search</span>(searchQuery);
      <span class="hljs-title function_">setResults</span>(searchResults);
    });
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
        <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>
        <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"输入搜索关键词..."</span>
        <span class="hljs-attr">onChange</span>=<span class="hljs-string">{handleSearch}</span>
      /&gt;</span>
      
      {isPending &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>搜索中...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}
      
      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
        {results.map((result, index) =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{index}</span>&gt;</span>{result}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-17">3.4 useDeferredValue Hook</h4>
<p><code>useDeferredValue</code> 是另一个与并发渲染相关的 Hook，它允许你延迟渲染 UI 的某些部分。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useState, useDeferredValue } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [text, setText] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> deferredText = <span class="hljs-title function_">useDeferredValue</span>(text);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
        <span class="hljs-attr">value</span>=<span class="hljs-string">{text}</span>
        <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setText(e.target.value)}
        placeholder="输入文本..."
      /&gt;
      
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>实时显示:<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{text}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>延迟显示:<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">SlowList</span> <span class="hljs-attr">text</span>=<span class="hljs-string">{deferredText}</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">SlowList</span>(<span class="hljs-params">{ text }</span>) {
  <span class="hljs-comment">// 模拟慢速渲染</span>
  <span class="hljs-keyword">const</span> items = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">5000</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{i}</span>&gt;</span>{text || '无内容'}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  ));

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{items}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<h4 data-id="heading-18">3.5 Suspense 的改进</h4>
<p>React 18 对 Suspense 进行了重大改进，使其能够与并发渲染更好地配合工作。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ProfilePage</span>(<span class="hljs-params">{ userId }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>用户资料<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">h2</span>&gt;</span>加载用户信息...<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>}&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">ProfileDetails</span> <span class="hljs-attr">userId</span>=<span class="hljs-string">{userId}</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">h2</span>&gt;</span>加载用户帖子...<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>}&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">ProfileTimeline</span> <span class="hljs-attr">userId</span>=<span class="hljs-string">{userId}</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 模拟异步组件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ProfileDetails</span>(<span class="hljs-params">{ userId }</span>) {
  <span class="hljs-comment">// 模拟数据获取</span>
  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">profileDetails</span>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">profileDetails</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">resolve</span>({
          <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>,
          <span class="hljs-attr">email</span>: <span class="hljs-string">'zhangsan@example.com'</span>,
          <span class="hljs-attr">bio</span>: <span class="hljs-string">'前端开发者'</span>
        });
      }, <span class="hljs-number">2000</span>);
    });
    <span class="hljs-keyword">throw</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">profileDetails</span>;
  }
  
  <span class="hljs-keyword">const</span> data = <span class="hljs-variable language_">window</span>.<span class="hljs-property">profileDetails</span>;
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>{data.name}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{data.email}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{data.bio}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ProfileTimeline</span>(<span class="hljs-params">{ userId }</span>) {
  <span class="hljs-comment">// 模拟数据获取</span>
  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">profileTimeline</span>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">profileTimeline</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">resolve</span>([
          { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'第一条帖子'</span> },
          { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'第二条帖子'</span> },
          { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'第三条帖子'</span> }
        ]);
      }, <span class="hljs-number">3000</span>);
    });
    <span class="hljs-keyword">throw</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">profileTimeline</span>;
  }
  
  <span class="hljs-keyword">const</span> posts = <span class="hljs-variable language_">window</span>.<span class="hljs-property">profileTimeline</span>;
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>用户帖子<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
      {posts.map(post =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{post.id}</span>&gt;</span>{post.content}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-19">第四章：新的根 API</h3>
<h4 data-id="heading-20">4.1 React 18 的新根 API</h4>
<p>React 18 引入了新的根 API，取代了旧的 <code>ReactDOM.render</code> 方法。新的 API 提供了更好的类型安全性和未来兼容性。</p>
<h5 data-id="heading-21">4.1.1 旧的 API</h5>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// React 17 及之前的写法</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App'</span>;

<span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">render</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>, <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'root'</span>));
</code></pre>
<h5 data-id="heading-22">4.1.2 新的 API</h5>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// React 18 的写法</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom/client'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App'</span>;

<span class="hljs-keyword">const</span> root = <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'root'</span>));
root.<span class="hljs-title function_">render</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>);

<span class="hljs-comment">// 如果需要卸载</span>
<span class="hljs-comment">// root.unmount();</span>
</code></pre>
<h4 data-id="heading-23">4.2 新根 API 的优势</h4>
<p>新的根 API 提供了以下优势：</p>
<ol>
<li><strong>更好的类型支持</strong>：TypeScript 用户可以获得更好的类型检查</li>
<li><strong>未来兼容性</strong>：为未来的 React 特性做好准备</li>
<li><strong>更清晰的 API</strong>：分离了根创建和渲染两个步骤</li>
</ol>
<h4 data-id="heading-24">4.3 服务端渲染的改进</h4>
<p>React 18 还改进了服务端渲染的 API：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// React 18 服务端渲染</span>
<span class="hljs-keyword">import</span> { renderToPipeableStream } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom/server'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">handler</span>(<span class="hljs-params">req, res</span>) {
  <span class="hljs-keyword">const</span> { pipe, abort } = <span class="hljs-title function_">renderToPipeableStream</span>(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>,
    {
      <span class="hljs-title function_">onShellReady</span>(<span class="hljs-params"/>) {
        res.<span class="hljs-property">statusCode</span> = <span class="hljs-number">200</span>;
        res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Content-type'</span>, <span class="hljs-string">'text/html'</span>);
        <span class="hljs-title function_">pipe</span>(res);
      },
      <span class="hljs-title function_">onShellError</span>(<span class="hljs-params">error</span>) {
        res.<span class="hljs-property">statusCode</span> = <span class="hljs-number">500</span>;
        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'&lt;!doctype html&gt;&lt;p&gt;Loading...&lt;/p&gt;&lt;script src="clientrender.js"&gt;&lt;/script&gt;'</span>);
      },
      <span class="hljs-title function_">onError</span>(<span class="hljs-params">error</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error);
        res.<span class="hljs-property">statusCode</span> = <span class="hljs-number">500</span>;
      }
    }
  );
  
  <span class="hljs-built_in">setTimeout</span>(abort, <span class="hljs-number">10000</span>);
}
</code></pre>
<h3 data-id="heading-25">第五章：新的 Hooks</h3>
<h4 data-id="heading-26">5.1 useId Hook</h4>
<p><code>useId</code> 是 React 18 引入的一个新 Hook，用于生成稳定的唯一 ID，特别适用于服务端渲染场景。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useId } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">PasswordField</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> id = <span class="hljs-title function_">useId</span>();
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">htmlFor</span>=<span class="hljs-string">{id}</span>&gt;</span>密码:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">{id}</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">PasswordField</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">PasswordField</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">PasswordField</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-27">5.2 useSyncExternalStore Hook</h4>
<p><code>useSyncExternalStore</code> 是一个用于订阅外部数据源的 Hook，确保服务端渲染和客户端渲染的一致性。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useSyncExternalStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// 外部存储示例</span>
<span class="hljs-keyword">const</span> store = {
  <span class="hljs-attr">state</span>: { <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> },
  <span class="hljs-attr">listeners</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(),
  
  <span class="hljs-title function_">setState</span>(<span class="hljs-params">newState</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = { ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>, ...newState };
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> <span class="hljs-title function_">listener</span>());
  },
  
  <span class="hljs-title function_">subscribe</span>(<span class="hljs-params">listener</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">add</span>(listener);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">delete</span>(listener);
  },
  
  <span class="hljs-title function_">getSnapshot</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;
  }
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">useStore</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">useSyncExternalStore</span>(
    store.<span class="hljs-property">subscribe</span>,
    store.<span class="hljs-property">getSnapshot</span>,
    store.<span class="hljs-property">getSnapshot</span> <span class="hljs-comment">// 服务端渲染时的 getSnapshot</span>
  );
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { count } = <span class="hljs-title function_">useStore</span>();
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Count: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> store.setState({ count: count + 1 })}&gt;
        增加
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-28">5.3 useInsertionEffect Hook</h4>
<p><code>useInsertionEffect</code> 是一个专门用于 CSS-in-JS 库的 Hook，它在 DOM 变更之前同步执行，确保样式在布局计算之前被注入。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useInsertionEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// 模拟 CSS-in-JS 库的使用</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useCSS</span>(<span class="hljs-params">style</span>) {
  <span class="hljs-title function_">useInsertionEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> styleElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'style'</span>);
    styleElement.<span class="hljs-property">textContent</span> = style;
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">appendChild</span>(styleElement);
    
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">removeChild</span>(styleElement);
    };
  }, [style]);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">StyledComponent</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  
  <span class="hljs-title function_">useCSS</span>(<span class="hljs-string">`
    .styled-button {
      background: blue;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .styled-button:hover {
      background: darkblue;
    }
  `</span>);
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Count: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
        <span class="hljs-attr">className</span>=<span class="hljs-string">"styled-button"</span>
        <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(c =&gt; c + 1)}
      &gt;
        增加
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-29">第六章：性能优化实践</h3>
<h4 data-id="heading-30">6.1 组件优化策略</h4>
<p>React 18 提供了多种优化组件性能的方法：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { memo, useMemo, useCallback } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// 使用 memo 优化函数组件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ExpensiveComponent</span> = <span class="hljs-title function_">memo</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">ExpensiveComponent</span>(<span class="hljs-params">{ data }</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ExpensiveComponent 渲染'</span>);
  
  <span class="hljs-comment">// 使用 useMemo 缓存昂贵的计算</span>
  <span class="hljs-keyword">const</span> processedData = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({
      ...item,
      <span class="hljs-attr">processed</span>: item.<span class="hljs-property">value</span> * <span class="hljs-number">2</span>
    }));
  }, [data]);
  
  <span class="hljs-comment">// 使用 useCallback 缓存回调函数</span>
  <span class="hljs-keyword">const</span> handleClick = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'点击项目:'</span>, id);
  }, []);
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {processedData.map(item =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleClick(item.id)}&gt;
          {item.name}: {item.processed}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
});

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> [
    { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'项目1'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">10</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'项目2'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">20</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'项目3'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">30</span> }
  ], []);
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(c =&gt; c + 1)}&gt;
        计数器: {count}
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ExpensiveComponent</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{data}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-31">6.2 虚拟滚动优化</h4>
<p>对于大量数据的列表渲染，虚拟滚动是提升性能的有效方法：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useState, useEffect, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">VirtualList</span>(<span class="hljs-params">{ items, itemHeight, windowHeight }</span>) {
  <span class="hljs-keyword">const</span> containerRef = <span class="hljs-title function_">useRef</span>();
  <span class="hljs-keyword">const</span> [scrollTop, setScrollTop] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  
  <span class="hljs-comment">// 计算可见项目范围</span>
  <span class="hljs-keyword">const</span> startIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(scrollTop / itemHeight);
  <span class="hljs-keyword">const</span> endIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(
    startIndex + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(windowHeight / itemHeight) + <span class="hljs-number">1</span>,
    items.<span class="hljs-property">length</span>
  );
  
  <span class="hljs-comment">// 可见项目</span>
  <span class="hljs-keyword">const</span> visibleItems = items.<span class="hljs-title function_">slice</span>(startIndex, endIndex);
  
  <span class="hljs-comment">// 总高度</span>
  <span class="hljs-keyword">const</span> totalHeight = items.<span class="hljs-property">length</span> * itemHeight;
  
  <span class="hljs-comment">// 上下空白高度</span>
  <span class="hljs-keyword">const</span> offsetY = startIndex * itemHeight;
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
      <span class="hljs-attr">ref</span>=<span class="hljs-string">{containerRef}</span>
      <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
        <span class="hljs-attr">height:</span> <span class="hljs-attr">windowHeight</span>,
        <span class="hljs-attr">overflow:</span> '<span class="hljs-attr">auto</span>'
      }}
      <span class="hljs-attr">onScroll</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setScrollTop(e.target.scrollTop)}
    &gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">height:</span> <span class="hljs-attr">totalHeight</span>, <span class="hljs-attr">position:</span> '<span class="hljs-attr">relative</span>' }}&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> 
          <span class="hljs-attr">transform:</span> `<span class="hljs-attr">translateY</span>(${<span class="hljs-attr">offsetY</span>}<span class="hljs-attr">px</span>)` 
        }}&gt;</span>
          {visibleItems.map((item, index) =&gt; (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
              <span class="hljs-attr">key</span>=<span class="hljs-string">{startIndex</span> + <span class="hljs-attr">index</span>}
              <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">height:</span> <span class="hljs-attr">itemHeight</span> }}
            &gt;</span>
              {item}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          ))}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-32">6.3 懒加载和代码分割</h4>
<p>React 18 继续支持懒加载和代码分割：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { lazy, <span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// 懒加载组件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">LazyComponent</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./LazyComponent'</span>));

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [showLazy, setShowLazy] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setShowLazy(true)}&gt;
        加载懒组件
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>加载中...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
        {showLazy &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">LazyComponent</span> /&gt;</span>}
      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-33">第七章：最佳实践和注意事项</h3>
<h4 data-id="heading-34">7.1 迁移到 React 18</h4>
<p>从 React 17 迁移到 React 18 需要注意以下几点：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 1. 更新根 API</span>
<span class="hljs-comment">// 旧写法</span>
<span class="hljs-comment">// import ReactDOM from 'react-dom';</span>
<span class="hljs-comment">// ReactDOM.render(&lt;App /&gt;, document.getElementById('root'));</span>

<span class="hljs-comment">// 新写法</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom/client'</span>;
<span class="hljs-keyword">const</span> root = <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'root'</span>));
root.<span class="hljs-title function_">render</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>);

<span class="hljs-comment">// 2. 处理自动批处理的变化</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Component</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> [flag, setFlag] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 在 React 18 中，这些更新会被自动批处理</span>
    <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c + <span class="hljs-number">1</span>);
    <span class="hljs-title function_">setFlag</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> !f);
  }, []);
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Count: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Flag: {String(flag)}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-35">7.2 并发渲染的最佳实践</h4>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useState, useTransition, <span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">SearchApp</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [query, setQuery] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> [isPending, startTransition] = <span class="hljs-title function_">useTransition</span>();
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSearch</span> = (<span class="hljs-params">newQuery</span>) =&gt; {
    <span class="hljs-title function_">setQuery</span>(newQuery);
    
    <span class="hljs-comment">// 使用 transition 处理搜索更新</span>
    <span class="hljs-title function_">startTransition</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// 这里可以触发数据获取等操作</span>
      <span class="hljs-title function_">fetchData</span>(newQuery);
    });
  };
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">SearchInput</span> 
        <span class="hljs-attr">query</span>=<span class="hljs-string">{query}</span> 
        <span class="hljs-attr">onSearch</span>=<span class="hljs-string">{handleSearch}</span>
        <span class="hljs-attr">isSearching</span>=<span class="hljs-string">{isPending}</span>
      /&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>加载搜索结果...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">SearchResults</span> <span class="hljs-attr">query</span>=<span class="hljs-string">{query}</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">SearchInput</span>(<span class="hljs-params">{ query, onSearch, isSearching }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span>
      <span class="hljs-attr">value</span>=<span class="hljs-string">{query}</span>
      <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> onSearch(e.target.value)}
      placeholder="搜索..."
      disabled={isSearching}
    /&gt;</span>
  );
}
</code></pre>
<h4 data-id="heading-36">7.3 错误处理和边界情况</h4>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ErrorBoundary</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-error-boundary'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span>
      <span class="hljs-attr">fallbackRender</span>=<span class="hljs-string">{({</span> <span class="hljs-attr">error</span>, <span class="hljs-attr">resetErrorBoundary</span> }) =&gt;</span> (
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>出现错误<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{error.message}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{resetErrorBoundary}</span>&gt;</span>重试<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      )}
    &gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>加载中...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">MyComponent</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-37">第八章：未来展望</h3>
<h4 data-id="heading-38">8.1 React Server Components</h4>
<p>React Server Components 是 React 团队正在开发的重要特性，它将进一步改变我们构建应用的方式：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 服务端组件示例（概念代码）</span>
<span class="hljs-keyword">import</span> db <span class="hljs-keyword">from</span> <span class="hljs-string">'db.server'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">NoteEditor</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'NoteEditor.client'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Note</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-comment">// 在服务端执行</span>
  <span class="hljs-keyword">const</span> note = db.<span class="hljs-property">notes</span>.<span class="hljs-title function_">get</span>(props.<span class="hljs-property">id</span>);
  
  <span class="hljs-comment">// 可以直接访问数据库</span>
  <span class="hljs-keyword">const</span> comments = db.<span class="hljs-property">comments</span>.<span class="hljs-title function_">forNote</span>(props.<span class="hljs-property">id</span>);
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{note.title}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{note.content}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      
      {/* 客户端组件 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">NoteEditor</span> <span class="hljs-attr">noteId</span>=<span class="hljs-string">{note.id}</span> /&gt;</span>
      
      {/* 服务端渲染的评论列表 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">CommentsList</span> <span class="hljs-attr">comments</span>=<span class="hljs-string">{comments}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-39">8.2 React Forget</h4>
<p>React Forget 是 React 团队正在开发的自动记忆化编译器，它将自动优化组件的性能：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 开发者编写的代码</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params">{ theme, onClick, text }</span>) {
  <span class="hljs-keyword">const</span> className = <span class="hljs-string">`button button-<span class="hljs-subst">${theme}</span>`</span>;
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{className}</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onClick}</span>&gt;</span>
      {text}
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// React Forget 自动优化后的代码</span>
<span class="hljs-keyword">const</span> $ = <span class="hljs-title function_">_c</span>(<span class="hljs-number">3</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params">{ theme, onClick, text }</span>) {
  <span class="hljs-keyword">const</span> className = $.<span class="hljs-title function_">memo</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-string">`button button-<span class="hljs-subst">${theme}</span>`</span>, [theme]);
  <span class="hljs-keyword">return</span> $.<span class="hljs-title function_">jsx</span>(<span class="hljs-string">'button'</span>, {
    className,
    onClick,
    <span class="hljs-attr">children</span>: text
  });
}
</code></pre>
<h3 data-id="heading-40">结语</h3>
<p>React 18 带来了许多令人兴奋的新特性和改进，从自动批处理到并发渲染，再到新的 Hooks 和 API。这些变化不仅提升了应用的性能和用户体验，也为未来的 React 发展奠定了坚实的基础。</p>
<p>作为前端开发者，我们需要：</p>
<ol>
<li><strong>深入理解新特性</strong>：掌握自动批处理、并发渲染等核心概念</li>
<li><strong>实践应用</strong>：在实际项目中运用这些新特性</li>
<li><strong>持续学习</strong>：关注 React 的发展动态和最佳实践</li>
<li><strong>性能优化</strong>：利用新特性优化应用性能</li>
</ol>
<p>React 18 是一个重要的里程碑，它标志着 React 正在朝着更加现代化、高性能的方向发展。通过合理运用这些新特性，我们可以构建出更加优秀的用户界面和应用体验。</p>
<p>未来，随着 React Server Components、React Forget 等特性的逐步成熟，React 生态将会变得更加完善和强大。作为开发者，我们需要保持学习的热情，紧跟技术发展的步伐，为用户提供更好的产品和服务。</p>
<p>希望本文能够帮助你更好地理解和掌握 React 18 的新特性，并在实际开发中发挥它们的价值。记住，技术的学习是一个持续的过程，只有不断实践和探索，我们才能真正掌握这些强大的工具。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeScript 类型工具与 NestJS Mapped Types]]></title>    <link>https://juejin.cn/post/7572052559823110150</link>    <guid>https://juejin.cn/post/7572052559823110150</guid>    <pubDate>2025-11-14T03:38:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572052559823110150" data-draft-id="7572048000301727785" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScript 类型工具与 NestJS Mapped Types"/> <meta itemprop="keywords" content="TypeScript,前端,后端"/> <meta itemprop="datePublished" content="2025-11-14T03:38:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹏北海"/> <meta itemprop="url" content="https://juejin.cn/user/1425415102792237"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScript 类型工具与 NestJS Mapped Types
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1425415102792237/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹏北海
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T03:38:42.000Z" title="Fri Nov 14 2025 03:38:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">概述</h2>
<p>在 NestJS 开发中，我们经常需要创建 DTO（Data Transfer Object）类。NestJS 提供了 <code>@nestjs/mapped-types</code> 包来帮助我们基于现有类创建新的 DTO 类，同时保留装饰器和验证元数据</p>
<h2 data-id="heading-1">TypeScript 内置类型工具 vs NestJS Mapped Types</h2>
<h3 data-id="heading-2">1. PartialType vs Partial</h3>
<h4 data-id="heading-3">TypeScript 内置 Partial</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Partial</span>&lt;T&gt; = {
  [P <span class="hljs-keyword">in</span> keyof T]?: T[P];
};

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">PartialUser</span> = <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">User</span>&gt;;
<span class="hljs-comment">// 结果：{ name?: string; age?: number; }</span>
</code></pre>
<p><strong>特点：</strong></p>
<ul>
<li>仅用于类型检查，编译后不存在</li>
<li>无法保留装饰器和验证元数据</li>
<li>不能用于 class-validator</li>
</ul>
<h4 data-id="heading-4">NestJS PartialType</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PartialType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/mapped-types'</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CreateUserDto</span> {
  <span class="hljs-meta">@IsString</span>()
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@IsNumber</span>()
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UpdateUserDto</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">PartialType</span>(<span class="hljs-title class_">CreateUserDto</span>) {}
<span class="hljs-comment">// 结果：一个类，保留了所有装饰器和验证元数据</span>
</code></pre>
<p><strong>特点：</strong></p>
<ul>
<li>运行时存在，是一个真正的类</li>
<li>保留装饰器和验证元数据</li>
<li>可用于 class-validator 和 NestJS DI</li>
</ul>
<h3 data-id="heading-5">2. PickType vs Pick</h3>
<h4 data-id="heading-6">TypeScript 内置 Pick</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Pick</span>&lt;T, K <span class="hljs-keyword">extends</span> keyof T&gt; = {
  [P <span class="hljs-keyword">in</span> K]: T[P];
};

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UserName</span> = <span class="hljs-title class_">Pick</span>&lt;<span class="hljs-title class_">User</span>, <span class="hljs-string">'name'</span>&gt;;
<span class="hljs-comment">// 结果：{ name: string; }</span>
</code></pre>
<h4 data-id="heading-7">NestJS PickType</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PickType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/mapped-types'</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserNameDto</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">PickType</span>(<span class="hljs-title class_">CreateUserDto</span>, [<span class="hljs-string">'name'</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>) {}
<span class="hljs-comment">// 结果：一个类，保留了 name 字段的装饰器</span>
</code></pre>
<h3 data-id="heading-8">3. OmitType vs Omit</h3>
<h4 data-id="heading-9">TypeScript 内置 Omit</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Omit</span>&lt;T, K <span class="hljs-keyword">extends</span> keyof T&gt; = <span class="hljs-title class_">Pick</span>&lt;T, <span class="hljs-title class_">Exclude</span>&lt;keyof T, K&gt;&gt;;

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UserWithoutAge</span> = <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">User</span>, <span class="hljs-string">'age'</span>&gt;;
<span class="hljs-comment">// 结果：{ name: string; }</span>
</code></pre>
<h4 data-id="heading-10">NestJS OmitType</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">OmitType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/mapped-types'</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserWithoutAgeDto</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">OmitType</span>(<span class="hljs-title class_">CreateUserDto</span>, [<span class="hljs-string">'age'</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>) {}
<span class="hljs-comment">// 结果：一个类，保留了剩余字段的装饰器</span>
</code></pre>
<h2 data-id="heading-11">关键区别对比</h2>



































<table><thead><tr><th>特性</th><th>TypeScript 内置类型</th><th>NestJS mapped-types</th></tr></thead><tbody><tr><td><strong>类型</strong></td><td>类型别名（Type Alias）</td><td>类（Class）</td></tr><tr><td><strong>运行时</strong></td><td>不存在（编译后消失）</td><td>存在（可在运行时使用）</td></tr><tr><td><strong>装饰器</strong></td><td>无法保留</td><td>保留装饰器和验证元数据</td></tr><tr><td><strong>验证</strong></td><td>无法用于 class-validator</td><td>可用于 class-validator</td></tr><tr><td><strong>依赖注入</strong></td><td>无法用于 DI</td><td>可用于 NestJS DI</td></tr></tbody></table>
<h2 data-id="heading-12">使用场景</h2>
<h3 data-id="heading-13">TypeScript 内置类型（适合纯类型操作）</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 仅用于类型检查，不涉及运行时</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateUser</span>(<span class="hljs-params">id: <span class="hljs-built_in">string</span>, data: Partial&lt;User&gt;</span>) {
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<h3 data-id="heading-14">NestJS mapped-types（适合 DTO 和验证）</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Controller</span>, <span class="hljs-title class_">Post</span>, <span class="hljs-title class_">Patch</span>, <span class="hljs-title class_">Body</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PartialType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/mapped-types'</span>;

<span class="hljs-meta">@Controller</span>(<span class="hljs-string">'users'</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
  <span class="hljs-meta">@Post</span>()
  <span class="hljs-title function_">create</span>(<span class="hljs-params"><span class="hljs-meta">@Body</span>() dto: CreateUserDto</span>) {
    <span class="hljs-comment">// class-validator 会自动验证</span>
  }

  <span class="hljs-meta">@Patch</span>(<span class="hljs-string">':id'</span>)
  <span class="hljs-title function_">update</span>(<span class="hljs-params"><span class="hljs-meta">@Body</span>() dto: UpdateUserDto</span>) {
    <span class="hljs-comment">// UpdateUserDto 继承了 CreateUserDto 的所有验证规则</span>
  }
}
</code></pre>
<h2 data-id="heading-15">最佳实践</h2>
<ol>
<li><strong>DTO 类使用 mapped-types</strong>：当需要创建可验证的 DTO 类时，使用 <code>@nestjs/mapped-types</code></li>
<li><strong>纯类型操作使用内置类型</strong>：当只需要类型层面的操作时，使用 TypeScript 内置类型</li>
<li><strong>保持一致性</strong>：在同一个项目中，保持使用方式的一致性</li>
</ol>
<h2 data-id="heading-16">相关资源</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.nestjs.com%2Fopenapi%2Fmapped-types" target="_blank" title="https://docs.nestjs.com/openapi/mapped-types" ref="nofollow noopener noreferrer">NestJS Mapped Types 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.typescriptlang.org%2Fdocs%2Fhandbook%2Futility-types.html" target="_blank" title="https://www.typescriptlang.org/docs/handbook/utility-types.html" ref="nofollow noopener noreferrer">TypeScript Utility Types 官方文档</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VSCode定制开发——内置中文翻译插件]]></title>    <link>https://juejin.cn/post/7572099468247597091</link>    <guid>https://juejin.cn/post/7572099468247597091</guid>    <pubDate>2025-11-14T03:42:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572099468247597091" data-draft-id="7572092283719286836" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VSCode定制开发——内置中文翻译插件"/> <meta itemprop="keywords" content="JavaScript,Visual Studio Code"/> <meta itemprop="datePublished" content="2025-11-14T03:42:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="zwq写js"/> <meta itemprop="url" content="https://juejin.cn/user/1022962441128904"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VSCode定制开发——内置中文翻译插件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1022962441128904/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    zwq写js
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T03:42:09.000Z" title="Fri Nov 14 2025 03:42:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>目前正在开发基于VSCode实现的公司内部编辑器，记录自定义修改了的模块开发流程。如果对某些功能实现看不懂或者想实现某些功能但是没头绪，可以评论区提问交流。</p>
<h2 data-id="heading-1">效果展示</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc8fd47afbd541019097d609c88b5b49~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgendx5YaZanM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763696529&amp;x-signature=qL1cNQ6ET%2F6qHC83MFCh92kqNHY%3D" alt="image.png" loading="lazy"/></p>
<p>在已安装插件列表中不存在翻译插件、命令面板中可切换中英文，说明这是内置的中文翻译插件，用户无法卸载。并且在自定义的主窗体中可以响应切换的中英文。</p>
<h2 data-id="heading-2">实现流程</h2>
<h3 data-id="heading-3">添加内置插件</h3>
<ol>
<li>下载主程序版本对应的翻译插件vsix文件</li>
</ol>
<ul>
<li>先在 <code>VSCode</code> 插件市场中找到中文翻译包的历史版本，对应你所自定义的开源Code版本。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a68425e15ef4b789de3a723d6358ada~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgendx5YaZanM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763696529&amp;x-signature=vPQY9Z%2BMr5fYbK6ay6pLWhgCogk%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>如果可以直接下载成功，则不需要这一步。获取到版本号后，在浏览器中替换此链接版本号下载插件文件 <code>https://ms-ceintl.gallery.vsassets.io/_apis/public/gallery/publisher/MS-CEINTL/extension/vscode-language-pack-zh-hans/1.104.2025091009/assetbyname/Microsoft.VisualStudio.Services.VSIXPackage</code>，并把下载后文件名字改为 <code>ms-ceintl.vscode-language-pack-zh-hans.vsix</code>。</li>
<li>把下载好的插件放置到<code>code</code>项目的 <code>extensions-vsix</code>目录下
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/973f5171ce814161ad547ee003820b91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgendx5YaZanM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763696529&amp;x-signature=PRMqfYxAy7lZ1tp5su4Pf7BhdrQ%3D" alt="image.png" loading="lazy"/></li>
</ul>
<ol start="2">
<li>在 <code>product.json</code>中添加内置翻译插件配置， sha256如果与我同版本则可以复用，如果不同版本，则在打包报错时改为使用报错输出给的sha256值。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f3a03caca064921a0ec20669954891b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgendx5YaZanM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763696529&amp;x-signature=m0LulfDcqbqjsmCheD6KL9ZHNDc%3D" alt="image.png" loading="lazy"/></li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"builtInExtensions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span>
			<span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ms-ceintl.vscode-language-pack-zh-hans"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.104.2025081708"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-attr">"sha256"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2015e764d028adb155bbaf143b0686c9504dc8f4c82d8804641cba93f1143630"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-attr">"repo"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://github.com/Microsoft/vscode-loc"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-attr">"vsix"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./extensions-vsix/ms-ceintl.vscode-language-pack-zh-hans.vsix"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-attr">"metadata"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
				<span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ms-ceintl.vscode-language-pack-zh-hans"</span><span class="hljs-punctuation">,</span>
				<span class="hljs-attr">"publisherId"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
					<span class="hljs-attr">"publisherId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ms-ceintl"</span><span class="hljs-punctuation">,</span>
					<span class="hljs-attr">"publisherName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ms-ceintl"</span><span class="hljs-punctuation">,</span>
					<span class="hljs-attr">"displayName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Microsoft"</span><span class="hljs-punctuation">,</span>
					<span class="hljs-attr">"flags"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"verified"</span>
				<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
				<span class="hljs-attr">"publisherDisplayName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Microsoft"</span>
			<span class="hljs-punctuation">}</span>
		<span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-4">问题与排查</h3>
<ul>
<li>此时直接打包并运行程序，会发现程序支持了命令面板中切换中英文，但是切换重启程序后并没有使用到中文的翻译；查看命令面板发现也是未切换。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8ce4fcc6c574458aaf853839231c9a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgendx5YaZanM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763696529&amp;x-signature=EmnQL4%2FntKvxX7xeGLEfCc6yWb0%3D" alt="image.png" loading="lazy"/></li>
<li>问题是出在了<code>插件安装</code>和<code>语言包加载</code>流程中，内置的插件是不走安装流程的，也就导致了无法写入到<code>languagePacks.json</code>配置中，启动项目时也就无法加载到翻译文件
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b161be7d25f94442beeed2b19c226c49~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgendx5YaZanM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763696529&amp;x-signature=3W7DyQW8Qj%2BwfXVakDCXG3q%2F1ZQ%3D" alt="image.png" loading="lazy"/></li>
</ul>
<h3 data-id="heading-5">解决问题思路</h3>
<ol>
<li>既然内置插件不走插件安装流程，且又需要确保翻译插件的数据添加到<code>languagePacks.json</code>文件中；那我们就干脆在启动时主动执行一次添加packs的操作。</li>
<li>由于是二次开发已有项目，那么就要尽量减少改动，遵循原程序的开发流程。所以我的实现方式是复用已有的方法，并且在app加载完<code>services</code>后再实现。以下是代码实现：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29271f4f0c02491bba9038b75f40f7a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgendx5YaZanM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763696529&amp;x-signature=ECItIa0%2Bft854KHV6JnBP%2FTh1IY%3D" alt="image.png" loading="lazy"/></li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 检测内置语言插件是否加载成功</span>
	private <span class="hljs-keyword">async</span> <span class="hljs-title function_">checkLangBuiltinExtensions</span>(<span class="hljs-params">instantiationService: IInstantiationService</span>) {
		<span class="hljs-keyword">const</span> userLocale = process.<span class="hljs-property">env</span>[<span class="hljs-string">'jerry_lang_reload'</span>]
		<span class="hljs-keyword">if</span> (userLocale) {
			<span class="hljs-comment">// const extensionsScannerService = accessor.get(IExtensionsScannerService);</span>
			<span class="hljs-comment">// const extensionManagementService = accessor.get(IExtensionManagementService);</span>
			<span class="hljs-keyword">const</span> productService = instantiationService.<span class="hljs-title function_">invokeFunction</span>(<span class="hljs-function"><span class="hljs-params">accessor</span> =&gt;</span> accessor.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">IProductService</span>));

			<span class="hljs-keyword">const</span> userDataProfileService = instantiationService.<span class="hljs-title function_">invokeFunction</span>(<span class="hljs-function"><span class="hljs-params">accessor</span> =&gt;</span> accessor.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">IUserDataProfilesMainService</span>));
			<span class="hljs-keyword">const</span> extensionScanner = instantiationService.<span class="hljs-title function_">createInstance</span>(<span class="hljs-title class_">ExtensionsScanner</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>());
			<span class="hljs-keyword">const</span> packCache = instantiationService.<span class="hljs-title function_">createInstance</span>(<span class="hljs-title class_">LanguagePacksCache</span>);

			<span class="hljs-keyword">const</span> packs = <span class="hljs-keyword">await</span> packCache.<span class="hljs-title function_">getLanguagePacks</span>()

			<span class="hljs-keyword">if</span> (!packs[userLocale]) {
				<span class="hljs-keyword">const</span> exts = <span class="hljs-keyword">await</span> extensionScanner.<span class="hljs-title function_">scanExtensions</span>(<span class="hljs-literal">null</span>, userDataProfileService.<span class="hljs-property">defaultProfile</span>.<span class="hljs-property">extensionsResource</span>, { <span class="hljs-attr">version</span>: productService.<span class="hljs-property">version</span>, <span class="hljs-attr">date</span>: productService.<span class="hljs-property">date</span> })
				<span class="hljs-comment">// const langPacks = await	packCache.update(exts)</span>
				<span class="hljs-keyword">const</span> packs2 = <span class="hljs-keyword">await</span> packCache.<span class="hljs-title function_">update</span>(exts)
				<span class="hljs-comment">// console.log({ packs, exts, packs2 });</span>
				<span class="hljs-variable language_">this</span>.<span class="hljs-property">logService</span>.<span class="hljs-title function_">debug</span>(<span class="hljs-string">'checkLangBuiltinExtensions:'</span>, userLocale, <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(packs2));
				<span class="hljs-variable language_">this</span>.<span class="hljs-property">lifecycleMainService</span>.<span class="hljs-title function_">relaunch</span>()
			}
		}
	}
</code></pre>
<p>用到的<code>env['jerry_lang-reload']</code>后面会讲解从何而来，此时要记得去导出<code>ExtensionsScanner</code>类；</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e35c5e3c3954c0cb065874ac967fa23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgendx5YaZanM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763696529&amp;x-signature=yPfH6Ozv5vg321iuud2qicHRm8c%3D" alt="image.png" loading="lazy"/>
4. 开始优化实现</p>
<ul>
<li>在 <code>src/main.ts</code>中优化默认使用语言
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9d80e56848446a4a47aa65a1ba76d09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgendx5YaZanM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763696529&amp;x-signature=kptZa2%2BOvWuKQWkFFzv0YFdkciA%3D" alt="image.png" loading="lazy"/></li>
<li>在解析nls配置时，标记环境变量判断是否需要走检测插件流程
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00347f5aba8940a39f19876f7182875a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgendx5YaZanM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763696529&amp;x-signature=a4K0osPhQ8Qe%2BdamWNF8V7CZ6t4%3D" alt="image.png" loading="lazy"/></li>
</ul>
<h2 data-id="heading-6">总结</h2>
<p>到此处，应该功能是已经正常实现了，可以打包之后测试一下。有其他模块想要自定义的可以说一下。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VonaJS: 序列化/数据脱敏(上)]]></title>    <link>https://juejin.cn/post/7572147440313221183</link>    <guid>https://juejin.cn/post/7572147440313221183</guid>    <pubDate>2025-11-14T03:50:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572147440313221183" data-draft-id="7572048000302743593" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VonaJS: 序列化/数据脱敏(上)"/> <meta itemprop="keywords" content="Node.js,TypeScript,NestJS"/> <meta itemprop="datePublished" content="2025-11-14T03:50:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="濮水大叔"/> <meta itemprop="url" content="https://juejin.cn/user/1119781972622208"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VonaJS: 序列化/数据脱敏(上)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1119781972622208/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    濮水大叔
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T03:50:11.000Z" title="Fri Nov 14 2025 03:50:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">序列化/数据脱敏</h2>
<p>VonaJS 提供了<code>序列化</code>能力，可以对 API 的响应数据进行转换，比如：排除密码字段，对 Email 和 Mobile 进行脱敏处理，等等</p>
<p>先介绍通用的序列化机制，再介绍一组工具函数。通过工具函数可以更加便利的使用序列化能力</p>
<h3 data-id="heading-1">创建Serializer Transform</h3>
<p>比如，在模块 demo-student 中创建一个 Serializer Transform: <code>upper</code>，将字段值转化为大写</p>
<h4 data-id="heading-2">1. Cli命令</h4>
<pre><code class="hljs language-bash" lang="bash">$ vona :create:bean serializerTransform upper --module=demo-student
</code></pre>
<h4 data-id="heading-3">2. 菜单命令</h4>
<pre><code class="hljs language-bash" lang="bash">右键菜单 - [模块路径]: `Vona Bean/Serializer Transform`
</code></pre>
<h3 data-id="heading-4">Serializer Transform定义</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">TypeSerializerTransformUpperValue</span> = <span class="hljs-built_in">string</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">TypeSerializerTransformUpperData</span> = <span class="hljs-built_in">unknown</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">TypeSerializerTransformUpperResult</span> = <span class="hljs-title class_">TypeSerializerTransformUpperValue</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ISerializerTransformOptionsUpper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IDecoratorSerializerTransformOptions</span> {}

<span class="hljs-meta">@SerializerTransform</span>&lt;<span class="hljs-title class_">ISerializerTransformOptionsUpper</span>&gt;()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SerializerTransformUpper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BeanBase</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">transform</span>(
    <span class="hljs-attr">value</span>: <span class="hljs-title class_">TypeSerializerTransformUpperValue</span>,
    <span class="hljs-attr">_data</span>: <span class="hljs-title class_">TypeSerializerTransformUpperData</span>,
    <span class="hljs-attr">_options</span>: <span class="hljs-title class_">ISerializerTransformOptionsUpper</span>,
  ): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">TypeSerializerTransformUpperResult</span>&gt; {
    <span class="hljs-keyword">return</span> value.<span class="hljs-title function_">toUpperCase</span>();
  }
}
</code></pre>
<ul>
<li><code>TypeSerializerTransformUpperValue</code>: 定义字段类型</li>
<li><code>TypeSerializerTransformUpperData</code>: 定义外层 object 对象类型</li>
<li><code>TypeSerializerTransformUpperResult</code>: 定义结果类型</li>
<li><code>transform</code>: 将字段值转为大写</li>
</ul>
<h3 data-id="heading-5">使用Serializer Transform</h3>
<p>比如学生 API<code>findOne</code>方法返回的结果类型是<code>EntityStudent</code>。下面将<code>EntityStudent</code>的<code>name</code>字段转为大写</p>
<h4 data-id="heading-6">1. 开启序列化</h4>
<p>需要为 API 开启序列化</p>
<pre><code class="hljs language-diff" lang="diff">class ControllerStudent {
  @Web.get(':id')
  @Api.body(v.optional(), v.object(EntityStudent))
<span class="hljs-addition">+ @Serializer.enable()</span>
  async findOne(id) {
    return await this.scope.service.student.findOne(id);
  }
}
</code></pre>
<ul>
<li><code>@Serializer.enable</code>: 开启序列化</li>
</ul>
<h4 data-id="heading-7">2. 设置字段</h4>
<pre><code class="hljs language-diff" lang="diff">class EntityStudent {
<span class="hljs-addition">+ @Serializer.transform('demo-student:upper')</span>
  @Api.field(v.title($locale('Name')), v.default(''), v.min(3))
  name: string;
}
</code></pre>
<ul>
<li><code>@Serializer.transform</code>: 传入 Serializer Transform 名称<code>demo-student:upper</code></li>
</ul>
<h3 data-id="heading-8">Filter参数</h3>
<p>可以为 Serializer Transform 传入 Filter 参数。系统先执行 Filter 函数，根据结果来控制当前 Serializer Transform 是否需要执行</p>
<p>比如，如果当前用户名是<code>admin</code>则不执行<code>upper</code>的转换逻辑</p>
<pre><code class="hljs language-diff" lang="diff">class EntityStudent {
  @Serializer.transform('demo-student:upper', {
<span class="hljs-addition">+   filter(this: VonaContext) {</span>
<span class="hljs-addition">+     return this.user.name !== 'admin';</span>
<span class="hljs-addition">+   },</span>
  })
  @Api.field(v.title($locale('Name')), v.default(''), v.min(3))
  name: string;
}
</code></pre>
<h3 data-id="heading-9">Serializer Transform参数</h3>
<p>可以为 Serializer Transform 定义参数，通过参数更灵活的配置转换逻辑</p>
<p>比如，为 Serializer Transform <code>upper</code>定义<code>first</code>参数，用于控制是否只将首字母转为大写</p>
<h4 data-id="heading-10">1. 定义参数类型</h4>
<pre><code class="hljs language-diff" lang="diff">export interface ISerializerTransformOptionsUpper extends IDecoratorSerializerTransformOptions {
<span class="hljs-addition">+ first?: boolean;</span>
}
</code></pre>
<h4 data-id="heading-11">2. 提供参数缺省值</h4>
<pre><code class="hljs language-diff" lang="diff">@SerializerTransform&lt;ISerializerTransformOptionsUpper&gt;({
<span class="hljs-addition">+ first: false,</span>
})
</code></pre>
<h4 data-id="heading-12">3. 使用参数</h4>
<pre><code class="hljs language-diff" lang="diff">export interface ISerializerTransformOptionsUpper extends IDecoratorSerializerTransformOptions {
  first?: boolean;
}

@SerializerTransform&lt;ISerializerTransformOptionsUpper&gt;({
  first: false,
})
class SerializerTransformUpper {
  async transform(
    value: TypeSerializerTransformUpperValue,
    _data: TypeSerializerTransformUpperData,
    options: ISerializerTransformOptionsUpper,
  ): Promise&lt;TypeSerializerTransformUpperResult&gt; {
<span class="hljs-deletion">-   return value.toUpperCase();</span>
<span class="hljs-addition">+   return options.first ? toUpperCaseFirstChar(value) : value.toUpperCase();</span>
  }
}
</code></pre>
<h4 data-id="heading-13">4. 使用时指定参数</h4>
<p>可以指定<code>@Serializer.transform</code>的参数</p>
<pre><code class="hljs language-diff" lang="diff">class EntityStudent {
<span class="hljs-addition">+ @Serializer.transform('demo-student:upper', { first: true })</span>
  @Api.field(v.title($locale('Name')), v.default(''), v.min(3))
  name: string;
}
</code></pre>
<h4 data-id="heading-14">5. App Config配置</h4>
<p>可以在 App Config 中配置 Serializer Transform 参数</p>
<p><code>src/backend/config/config/config.ts</code></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// onions</span>
config.<span class="hljs-property">onions</span> = {
  <span class="hljs-attr">serializerTransform</span>: {
    <span class="hljs-string">'demo-student:upper'</span>: {
      <span class="hljs-attr">first</span>: <span class="hljs-literal">true</span>,
    },
  },
};
</code></pre>
<h4 data-id="heading-15">6. 参数优先级</h4>
<p><code>使用时指定参数</code> &gt; <code>App Config配置</code> &gt; <code>参数缺省值</code></p>
<h3 data-id="heading-16">资源</h3>
<ul>
<li>Github：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvonajs%2Fvona" target="_blank" title="https://github.com/vonajs/vona" ref="nofollow noopener noreferrer">github.com/vonajs/vona</a></li>
<li>文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fvona.js.org" target="_blank" title="https://vona.js.org" ref="nofollow noopener noreferrer">vona.js.org</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[针对Element UI 浏览器自动填充账号密码导致的白色背景问题修复方案，这是CSS自动填充样式覆盖的经典问题]]></title>    <link>https://juejin.cn/post/7572132916575256612</link>    <guid>https://juejin.cn/post/7572132916575256612</guid>    <pubDate>2025-11-14T03:51:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572132916575256612" data-draft-id="7571815573933244479" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="针对Element UI 浏览器自动填充账号密码导致的白色背景问题修复方案，这是CSS自动填充样式覆盖的经典问题"/> <meta itemprop="keywords" content="CSS"/> <meta itemprop="datePublished" content="2025-11-14T03:51:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="apollo_qwe"/> <meta itemprop="url" content="https://juejin.cn/user/2788017221151342"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            针对Element UI 浏览器自动填充账号密码导致的白色背景问题修复方案，这是CSS自动填充样式覆盖的经典问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2788017221151342/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    apollo_qwe
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T03:51:28.000Z" title="Fri Nov 14 2025 03:51:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这个问题很常见，根源是浏览器对自动填充表单的默认 <code>-webkit-autofill</code> 伪类样式覆盖了 Element UI 的默认样式，优化核心是针对性覆盖该伪类样式。</p>
<h3 data-id="heading-0">一、核心优化方案（Vue 项目适用）</h3>
<p>通过样式穿透（<code>/deep/</code> 或 <code>:v-deep</code>）定位到 <code>el-input</code> 内部的 <code>input</code> 元素，覆盖浏览器自动填充的默认样式。</p>
<h4 data-id="heading-1">具体代码：</h4>
<pre><code class="hljs language-css" lang="css">&lt;el-<span class="hljs-selector-tag">input</span> type="password" class="no-autofill-bg"&gt;
// 修复自动填充背景色
:<span class="hljs-built_in">deep</span>(.no-autofill-bg) {
  <span class="hljs-selector-class">.el-input__wrapper</span> {
    <span class="hljs-attribute">box-shadow</span>:
      <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>) inset,
      <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1000px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">4</span>, <span class="hljs-number">44</span>, <span class="hljs-number">133</span>, <span class="hljs-number">0.7</span>) inset <span class="hljs-meta">!important</span>;

    &amp;:-webkit-autofill {
      -webkit-text-fill-<span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span> <span class="hljs-meta">!important</span>;
      <span class="hljs-attribute">transition</span>: background-color <span class="hljs-number">5000s</span> ease-in-out <span class="hljs-number">0s</span> <span class="hljs-meta">!important</span>;
      <span class="hljs-attribute">box-shadow</span>:
        <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>) inset,
        <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1000px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">4</span>, <span class="hljs-number">44</span>, <span class="hljs-number">133</span>, <span class="hljs-number">0.7</span>) inset <span class="hljs-meta">!important</span>;
    }

    &amp;:-webkit-autofill:focus {
      -webkit-text-fill-<span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span> <span class="hljs-meta">!important</span>;
      <span class="hljs-attribute">box-shadow</span>:
        <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1px</span> <span class="hljs-number">#409eff</span> inset,
        <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1000px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">4</span>, <span class="hljs-number">44</span>, <span class="hljs-number">133</span>, <span class="hljs-number">0.9</span>) inset <span class="hljs-meta">!important</span>;
    }
  }

  <span class="hljs-selector-class">.el-input__inner</span> {
    &amp;:-webkit-autofill {
      -webkit-text-fill-<span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span> <span class="hljs-meta">!important</span>;
      <span class="hljs-attribute">transition</span>: background-color <span class="hljs-number">5000s</span> ease-in-out <span class="hljs-number">0s</span> <span class="hljs-meta">!important</span>;
    }
  }
}
</code></pre>
<h4 data-id="heading-2">代码解释:</h4>
<h4 data-id="heading-3">1. 外层选择器 <code>:deep(.no-autofill-bg)</code></h4>
<ul>
<li><code>:deep()</code> 是 Vue 3 中的<strong>深度选择器</strong>，用于穿透组件的样式隔离（Vue 的 Scoped CSS 会限制样式仅作用于当前组件）。这里表示：要修改<strong>类名为 <code>no-autofill-bg</code> 的元素内部</strong>的子组件样式（这里特指 Element UI 的 <code>el-input</code> 组件）。</li>
<li>作用：让后续样式能影响到 <code>el-input</code> 组件内部的 DOM 结构（因为 <code>el-input</code> 是独立组件，默认情况下父组件的 Scoped CSS 无法修改其内部样式）。</li>
</ul>
<h4 data-id="heading-4">2. <code>.el-input__wrapper</code> 样式（输入框外层容器）</h4>
<p><code>el-input__wrapper</code> 是 Element UI 中输入框的外层容器类名，用于控制输入框的整体容器样式。</p>
<ul>
<li>
<p><strong>基础样式</strong>：</p>
<p>css</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">box-shadow</span>:
  <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>) inset,  <span class="hljs-comment">/* 1px 白色半透明内边框（模拟边框效果） */</span>
  <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1000px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">4</span>, <span class="hljs-number">44</span>, <span class="hljs-number">133</span>, <span class="hljs-number">0.7</span>) inset <span class="hljs-meta">!important</span>;  <span class="hljs-comment">/* 大尺寸内阴影模拟背景色（深蓝色半透明） */</span>
</code></pre>
<ul>
<li>用 <code>inset</code> 内阴影模拟背景色和边框：因为内阴影的优先级高于默认背景，且可以避免某些场景下背景色被覆盖的问题。</li>
<li><code>!important</code> 强制优先级，确保覆盖 Element UI 的默认样式。</li>
</ul>
</li>
<li>
<p><strong><code>: -webkit-autofill</code> 伪类</strong>（输入框被自动填充时）：浏览器自动填充（如记住的账号密码）时，WebKit 内核会默认给输入框添加黄色背景和特定文本色，这里用于覆盖默认样式：</p>
<p>css</p>
<pre><code class="hljs language-css" lang="css">-webkit-text-fill-<span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span> <span class="hljs-meta">!important</span>;  <span class="hljs-comment">/* 强制自动填充时文本为白色 */</span>
<span class="hljs-attribute">transition</span>: background-color <span class="hljs-number">5000s</span> ease-in-out <span class="hljs-number">0s</span> <span class="hljs-meta">!important</span>;  <span class="hljs-comment">/* 关键技巧：通过极长过渡时间阻止默认黄色背景（浏览器自动填充会触发背景色变化，这里让变化延迟5000秒，相当于"冻结"背景） */</span>
<span class="hljs-attribute">box-shadow</span>: ...;  <span class="hljs-comment">/* 保持和基础样式一致的内阴影（确保自动填充时背景不变） */</span>
</code></pre>
</li>
<li>
<p><strong><code>: -webkit-autofill:focus</code> 伪类</strong>（自动填充状态下且输入框获焦时）：当自动填充的输入框被点击（获得焦点）时，进一步调整样式：</p>
<p>css</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">box-shadow</span>:
  <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1px</span> <span class="hljs-number">#409eff</span> inset,  <span class="hljs-comment">/* 1px 蓝色内边框（Element UI 主题色，突出焦点状态） */</span>
  <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1000px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">4</span>, <span class="hljs-number">44</span>, <span class="hljs-number">133</span>, <span class="hljs-number">0.9</span>) inset <span class="hljs-meta">!important</span>;  <span class="hljs-comment">/* 背景色加深（比非焦点时更深的蓝色） */</span>
</code></pre>
</li>
</ul>
<h4 data-id="heading-5">3. <code>.el-input__inner</code> 样式（输入框内部输入元素）</h4>
<p><code>el-input__inner</code> 是 Element UI 中输入框内部实际的 <code>&lt;input&gt;</code> 标签类名，用于控制输入框本身的样式。</p>
<ul>
<li>
<p><strong><code>: -webkit-autofill</code> 伪类</strong>：补充控制输入框元素本身的自动填充样式，确保文本色和背景过渡与外层容器一致：</p>
<p>css</p>
<pre><code class="hljs language-css" lang="css">-webkit-text-fill-<span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span> <span class="hljs-meta">!important</span>;  <span class="hljs-comment">/* 强制文本为白色（和外层保持一致） */</span>
<span class="hljs-attribute">transition</span>: background-color <span class="hljs-number">5000s</span> ease-in-out <span class="hljs-number">0s</span> <span class="hljs-meta">!important</span>;  <span class="hljs-comment">/* 同样阻止默认黄色背景 */</span>
</code></pre>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VonaJS: 序列化/数据脱敏(下)]]></title>    <link>https://juejin.cn/post/7572138663120289834</link>    <guid>https://juejin.cn/post/7572138663120289834</guid>    <pubDate>2025-11-14T03:52:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572138663120289834" data-draft-id="7572138663120273450" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VonaJS: 序列化/数据脱敏(下)"/> <meta itemprop="keywords" content="Node.js,TypeScript,NestJS"/> <meta itemprop="datePublished" content="2025-11-14T03:52:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="濮水大叔"/> <meta itemprop="url" content="https://juejin.cn/user/1119781972622208"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VonaJS: 序列化/数据脱敏(下)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1119781972622208/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    濮水大叔
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T03:52:38.000Z" title="Fri Nov 14 2025 03:52:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>VonaJS 提供了<code>序列化</code>能力，可以对 API 的响应数据进行转换，比如：排除密码字段，对 Email 和 Mobile 进行脱敏处理，等等</p>
<p>前文介绍了<code>序列化</code>的一般用法。这里再介绍一组工具函数。通过工具函数可以更加便利的使用序列化能力</p>
<h2 data-id="heading-0">工具清单</h2>



































<table><thead><tr><th>工具: @Serializer</th><th>工具: v</th><th>说明</th></tr></thead><tbody><tr><td>@Serializer.transform</td><td>v.serializerTransform</td><td>使用Serializer Transform，参见: <a href="https://link.juejin.cn?target=https%3A%2F%2Fvona.js.org%2Fzh%2Fguide%2Ftechniques%2Fserialization%2Fintroduction.html" target="_blank" title="https://vona.js.org/zh/guide/techniques/serialization/introduction.html" ref="nofollow noopener noreferrer">序列化</a></td></tr><tr><td>@Serializer.exclude</td><td>v.serializerExclude</td><td>排除字段</td></tr><tr><td>@Serializer.replace</td><td>v.serializerReplace</td><td>对字段值进行脱敏处理</td></tr><tr><td>@Serializer.getter</td><td>v.serializerGetter</td><td>采用getter机制生成新的字段值</td></tr><tr><td>@Serializer.custom</td><td>v.serializerCustom</td><td>使用自定义函数对字段值进行处理</td></tr></tbody></table>
<pre><code class="hljs language-bash" lang="bash">既然`@Serializer`工具非常简洁，直观，为什么还要提供`v`工具？

1. `v`工具可以实现通过 App Config 修改配置
2. `v`工具和`@Serializer`工具底层逻辑是一致的
</code></pre>
<h2 data-id="heading-1">@Serializer.transform/v.serializerTransform</h2>
<p>比如，将<code>EntityStudent</code>中的<code>name</code>字段值转化为大写</p>
<p>我们直接使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fvona.js.org%2Fzh%2Fguide%2Ftechniques%2Fserialization%2Fintroduction.html" target="_blank" title="https://vona.js.org/zh/guide/techniques/serialization/introduction.html" ref="nofollow noopener noreferrer">序列化</a>中创建的 Serializer Transform <code>upper</code></p>
<h3 data-id="heading-2">1. @Serializer.transform</h3>
<pre><code class="hljs language-diff" lang="diff">class EntityStudent {
<span class="hljs-addition">+ @Serializer.transform('demo-student:upper')</span>
  @Api.field(v.title($locale('Name')))
  name: string;
}
</code></pre>
<h3 data-id="heading-3">2. v.serializerTransform</h3>
<pre><code class="hljs language-diff" lang="diff">class EntityStudent {
<span class="hljs-addition">+ @Api.field(v.serializerTransform('demo-student:upper'), v.title($locale('Name')))</span>
  name: string;
}
</code></pre>
<h3 data-id="heading-4">3. App Config</h3>
<p>可以在 App Config 中修改配置</p>
<p><code>src/backend/config/config/config.ts</code></p>
<ul>
<li>方法 1: 直接修改 Openapi 参数</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// onions</span>
config.<span class="hljs-property">onions</span> = {
  <span class="hljs-attr">entity</span>: {
    <span class="hljs-string">'demo-student:student'</span>: {
      <span class="hljs-attr">fields</span>: {
        <span class="hljs-attr">name</span>: {
          <span class="hljs-attr">serializerTransforms</span>: {
            <span class="hljs-string">'demo-student:upper'</span>: {},
          },
        },
      },
    },
  },
};
</code></pre>
<ul>
<li>方法 2: 构造一个新的 schema</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { $makeSchema, v } <span class="hljs-keyword">from</span> <span class="hljs-string">'vona-module-a-openapi'</span>;

<span class="hljs-comment">// onions</span>
config.<span class="hljs-property">onions</span> = {
  <span class="hljs-attr">entity</span>: {
    <span class="hljs-string">'demo-student:student'</span>: {
      <span class="hljs-attr">fields</span>: {
        <span class="hljs-attr">name</span>: $makeSchema(v.<span class="hljs-title function_">serializerTransform</span>(<span class="hljs-string">'demo-student:upper'</span>), z.<span class="hljs-title function_">string</span>()),
      },
    },
  },
};
</code></pre>
<h2 data-id="heading-5">@Serializer.exclude/v.serializerExclude</h2>
<p>比如，排除<code>EntityStudent</code>中的<code>name</code>字段</p>
<h3 data-id="heading-6">1. @Serializer.exclude</h3>
<pre><code class="hljs language-diff" lang="diff">class EntityStudent {
<span class="hljs-addition">+ @Serializer.exclude()</span>
  @Api.field(v.title($locale('Name')))
  name: string;
}
</code></pre>
<h3 data-id="heading-7">2. v.serializerExclude</h3>
<pre><code class="hljs language-diff" lang="diff">class EntityStudent {
<span class="hljs-addition">+ @Api.field(v.serializerExclude(), v.title($locale('Name')))</span>
  name: string;
}
</code></pre>
<h3 data-id="heading-8">3. App Config</h3>
<p>可以在 App Config 中修改配置</p>
<p><code>src/backend/config/config/config.ts</code></p>
<ul>
<li>方法 1: 直接修改 Openapi 参数</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// onions</span>
config.<span class="hljs-property">onions</span> = {
  <span class="hljs-attr">entity</span>: {
    <span class="hljs-string">'demo-student:student'</span>: {
      <span class="hljs-attr">fields</span>: {
        <span class="hljs-attr">name</span>: { <span class="hljs-attr">exclude</span>: <span class="hljs-literal">false</span> },
      },
    },
  },
};
</code></pre>
<ul>
<li>方法 2: 构造一个新的 schema</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { $makeSchema, v } <span class="hljs-keyword">from</span> <span class="hljs-string">'vona-module-a-openapi'</span>;

<span class="hljs-comment">// onions</span>
config.<span class="hljs-property">onions</span> = {
  <span class="hljs-attr">entity</span>: {
    <span class="hljs-string">'demo-student:student'</span>: {
      <span class="hljs-attr">fields</span>: {
        <span class="hljs-attr">name</span>: $makeSchema(v.<span class="hljs-title function_">serializerExclude</span>(), z.<span class="hljs-title function_">string</span>()),
      },
    },
  },
};
</code></pre>
<h2 data-id="heading-9">@Serializer.replace/v.serializerReplace</h2>
<p>比如，将<code>EntityStudent</code>中的<code>name</code>字段值进行脱敏处理</p>
<p>比如，name 原始值为<code>tom</code>，脱敏之后为<code>t***m</code></p>
<h3 data-id="heading-10">1. @Serializer.replace</h3>
<pre><code class="hljs language-diff" lang="diff">class EntityStudent {
<span class="hljs-addition">+ @Serializer.replace({ patternFrom: /(\w)(\w+)(\w)/, patternTo: '$1***$3' })</span>
  @Api.field(v.title($locale('Name')))
  name: string;
}
</code></pre>
<h3 data-id="heading-11">2. v.serializerReplace</h3>
<pre><code class="hljs language-diff" lang="diff">class EntityStudent {
  @Api.field(
<span class="hljs-addition">+   v.serializerReplace({ patternFrom: /(\w)(\w+)(\w)/, patternTo: '$1***$3' }),</span>
    v.title($locale('Name')),
  )
  name: string;
}
</code></pre>
<h3 data-id="heading-12">3. App Config</h3>
<p>可以在 App Config 中修改配置</p>
<p><code>src/backend/config/config/config.ts</code></p>
<ul>
<li>方法 1: 直接修改 Openapi 参数</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// onions</span>
config.<span class="hljs-property">onions</span> = {
  <span class="hljs-attr">entity</span>: {
    <span class="hljs-string">'demo-student:student'</span>: {
      <span class="hljs-attr">fields</span>: {
        <span class="hljs-attr">name</span>: {
          <span class="hljs-attr">serializerTransforms</span>: {
            <span class="hljs-string">'a-serialization:replace'</span>: {
              <span class="hljs-attr">patternFrom</span>: <span class="hljs-regexp">/(\w)(\w+)(\w)/</span>,
              <span class="hljs-attr">patternTo</span>: <span class="hljs-string">'$1***$3'</span>,
            },
          },
        },
      },
    },
  },
};
</code></pre>
<p><code>a-serialization:replace</code>: <code>a-serialization</code>模块提供的 Serializer Transform</p>
<ul>
<li>方法 2: 构造一个新的 schema</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { $makeSchema, v } <span class="hljs-keyword">from</span> <span class="hljs-string">'vona-module-a-openapi'</span>;

<span class="hljs-comment">// onions</span>
config.<span class="hljs-property">onions</span> = {
  <span class="hljs-attr">entity</span>: {
    <span class="hljs-string">'demo-student:student'</span>: {
      <span class="hljs-attr">fields</span>: {
        <span class="hljs-attr">name</span>: $makeSchema(
          v.<span class="hljs-title function_">serializerReplace</span>({ <span class="hljs-attr">patternFrom</span>: <span class="hljs-regexp">/(\w)(\w+)(\w)/</span>, <span class="hljs-attr">patternTo</span>: <span class="hljs-string">'$1***$3'</span> }),
          z.<span class="hljs-title function_">string</span>(),
        ),
      },
    },
  },
};
</code></pre>
<h2 data-id="heading-13">@Serializer.getter/v.serializerGetter</h2>
<p>比如，<code>EntityStudent</code>中的<code>fullName</code>字段由<code>firstName</code>和<code>lastName</code>字段组合而成</p>
<h3 data-id="heading-14">1. getter</h3>
<pre><code class="hljs language-diff" lang="diff">class EntityStudent {
  @Api.field()
  firstName: string;

  @Api.field()
  lastName: string;

  @Api.field()
<span class="hljs-addition">+ get fullName(): string | undefined {</span>
<span class="hljs-addition">+   return `${this.firstName} ${this.lastName}`;</span>
<span class="hljs-addition">+ }</span>
}
</code></pre>
<h3 data-id="heading-15">2. @Serializer.getter</h3>
<pre><code class="hljs language-diff" lang="diff">class EntityStudent {
<span class="hljs-addition">+ @Serializer.getter((data: EntityStudent) =&gt; {</span>
<span class="hljs-addition">+   return `${data.firstName} ${data.lastName}`;</span>
<span class="hljs-addition">+ })</span>
  @Api.field()
  fullName: string;
}
</code></pre>
<h3 data-id="heading-16">3. v.serializerGetter</h3>
<pre><code class="hljs language-diff" lang="diff">class EntityStudent {
<span class="hljs-addition">+ @Api.field(v.serializerGetter((data: EntityStudent) =&gt; {</span>
<span class="hljs-addition">+   return `${data.firstName} ${data.lastName}`;</span>
<span class="hljs-addition">+ }))</span>
  fullName: string;
}
</code></pre>
<h3 data-id="heading-17">4. App Config</h3>
<p>可以在 App Config 中修改配置</p>
<p><code>src/backend/config/config/config.ts</code></p>
<ul>
<li>方法 1: 直接修改 Openapi 参数</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// onions</span>
config.<span class="hljs-property">onions</span> = {
  <span class="hljs-attr">entity</span>: {
    <span class="hljs-string">'demo-student:student'</span>: {
      <span class="hljs-attr">fields</span>: {
        <span class="hljs-attr">fullName</span>: {
          <span class="hljs-attr">serializerTransforms</span>: {
            <span class="hljs-string">'a-serialization:getter'</span>: {
              <span class="hljs-attr">getter</span>: <span class="hljs-function">(<span class="hljs-params">data: EntityStudent</span>) =&gt;</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${data.firstName}</span> <span class="hljs-subst">${data.lastName}</span>`</span>;
              },
            },
          },
        },
      },
    },
  },
};
</code></pre>
<p><code>a-serialization:getter</code>: <code>a-serialization</code>模块提供的 Serializer Transform</p>
<ul>
<li>方法 2: 构造一个新的 schema</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { $makeSchema, v } <span class="hljs-keyword">from</span> <span class="hljs-string">'vona-module-a-openapi'</span>;

<span class="hljs-comment">// onions</span>
config.<span class="hljs-property">onions</span> = {
  <span class="hljs-attr">entity</span>: {
    <span class="hljs-string">'demo-student:student'</span>: {
      <span class="hljs-attr">fields</span>: {
        <span class="hljs-attr">fullName</span>: $makeSchema(
          v.<span class="hljs-title function_">serializerGetter</span>(<span class="hljs-function">(<span class="hljs-params">data: EntityStudent</span>) =&gt;</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${data.firstName}</span> <span class="hljs-subst">${data.lastName}</span>`</span>;
          }),
          z.<span class="hljs-title function_">string</span>(),
        ),
      },
    },
  },
};
</code></pre>
<h2 data-id="heading-18">@Serializer.custom/v.serializerCustom</h2>
<p>比如，将<code>EntityStudent</code>中的<code>name</code>字段值转换为大写</p>
<h3 data-id="heading-19">1. @Serializer.custom</h3>
<pre><code class="hljs language-diff" lang="diff">class EntityStudent {
<span class="hljs-addition">+ @Serializer.custom((value: string) =&gt; {</span>
<span class="hljs-addition">+   return value.toUpperCase();</span>
<span class="hljs-addition">+ })</span>
  @Api.field(v.title($locale('Name')))
  name: string;
}
</code></pre>
<h3 data-id="heading-20">2. v.serializerCustom</h3>
<pre><code class="hljs language-diff" lang="diff">class EntityStudent {
  @Api.field(
<span class="hljs-addition">+   v.serializerCustom((value: string) =&gt; {</span>
<span class="hljs-addition">+     return value.toUpperCase();</span>
<span class="hljs-addition">+   }),</span>
    v.title($locale('Name')),
  )
  name: string;
}
</code></pre>
<h3 data-id="heading-21">3. App Config</h3>
<p>可以在 App Config 中修改配置</p>
<p><code>src/backend/config/config/config.ts</code></p>
<ul>
<li>方法 1: 直接修改 Openapi 参数</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// onions</span>
config.<span class="hljs-property">onions</span> = {
  <span class="hljs-attr">entity</span>: {
    <span class="hljs-string">'demo-student:student'</span>: {
      <span class="hljs-attr">fields</span>: {
        <span class="hljs-attr">name</span>: {
          <span class="hljs-attr">serializerTransforms</span>: {
            <span class="hljs-string">'a-serialization:custom'</span>: {
              <span class="hljs-attr">custom</span>: <span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
                <span class="hljs-keyword">return</span> value.<span class="hljs-title function_">toUpperCase</span>();
              },
            },
          },
        },
      },
    },
  },
};
</code></pre>
<p><code>a-serialization:custom</code>: <code>a-serialization</code>模块提供的 Serializer Transform</p>
<ul>
<li>方法 2: 构造一个新的 schema</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { $makeSchema, v } <span class="hljs-keyword">from</span> <span class="hljs-string">'vona-module-a-openapi'</span>;

<span class="hljs-comment">// onions</span>
config.<span class="hljs-property">onions</span> = {
  <span class="hljs-attr">entity</span>: {
    <span class="hljs-string">'demo-student:student'</span>: {
      <span class="hljs-attr">fields</span>: {
        <span class="hljs-attr">name</span>: $makeSchema(
          v.<span class="hljs-title function_">serializerCustom</span>(<span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
            <span class="hljs-keyword">return</span> value.<span class="hljs-title function_">toUpperCase</span>();
          }),
          z.<span class="hljs-title function_">string</span>(),
        ),
      },
    },
  },
};
</code></pre>
<h2 data-id="heading-22">资源</h2>
<ul>
<li>Github：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvonajs%2Fvona" target="_blank" title="https://github.com/vonajs/vona" ref="nofollow noopener noreferrer">github.com/vonajs/vona</a></li>
<li>文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fvona.js.org" target="_blank" title="https://vona.js.org" ref="nofollow noopener noreferrer">vona.js.org</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[H5性能优化-打开效率提升了62%]]></title>    <link>https://juejin.cn/post/7572301616168583177</link>    <guid>https://juejin.cn/post/7572301616168583177</guid>    <pubDate>2025-11-14T03:06:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572301616168583177" data-draft-id="7572132100361175086" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="H5性能优化-打开效率提升了62%"/> <meta itemprop="keywords" content="前端,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-11-14T03:06:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="德哥0904"/> <meta itemprop="url" content="https://juejin.cn/user/2172290708277623"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            H5性能优化-打开效率提升了62%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2172290708277623/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    德哥0904
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T03:06:05.000Z" title="Fri Nov 14 2025 03:06:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、达成的结果</h2>
<p><strong>app嵌套h5 加载效率提升了62%。时间从平均2.259s 降到了0.852s</strong></p>
<h3 data-id="heading-1">二、优化过程</h3>
<p>思路：优化原生webview+h5 ，先测试webview点击到创建时间 120ms（无需优化）。webview 提供了 api 测试 加载url 的进度。但是没提供具体的类似pc端网络的工具。所以就通过ai搜索一些工具。发现阿里云的arms 方便引入。</p>
<p>测试设备 android荣耀50、华为meta9、华为p40、oppo</p>
<h2 data-id="heading-2">开发环境测试</h2>
<p>测试样本：优化前后各测试10次。</p>
<p>测试移动端h5 引入了阿里云的arms <a href="https://link.juejin.cn?target=https%3A%2F%2Farms.console.aliyun.com%2F" target="_blank" title="https://arms.console.aliyun.com/" ref="nofollow noopener noreferrer">arms.console.aliyun.com/</a> 可以查看加载某个url的时候 请求的js css、图片、网络请求 跟网页版的网络类似。</p>
<pre><code class="hljs language-php" lang="php">import ArmsRum <span class="hljs-keyword">from</span> <span class="hljs-string">'@arms/rum-browser'</span>

ArmsRum.<span class="hljs-title function_ invoke__">init</span>({
	<span class="hljs-attr">pid</span>: <span class="hljs-string">'ha63j3v892@efe71d242023cd5'</span>,
	<span class="hljs-attr">endpoint</span>: <span class="hljs-string">'https://ha63j3v892-default-cn.rum.aliyuncs.com'</span>,
	// 设置环境信息，参考值：<span class="hljs-string">'prod'</span> | <span class="hljs-string">'gray'</span> | <span class="hljs-string">'pre'</span> | <span class="hljs-string">'daily'</span> | <span class="hljs-string">'local'</span>
	<span class="hljs-attr">env</span>: <span class="hljs-string">'prod'</span>,
	// 设置路由模式， 参考值：<span class="hljs-string">'history'</span> | <span class="hljs-string">'hash'</span>
	<span class="hljs-attr">spaMode</span>: <span class="hljs-string">'hash'</span>,
	<span class="hljs-attr">collectors</span>: {
		// 页面性能指标监听开关，默认开启
		<span class="hljs-attr">perf</span>: <span class="hljs-literal">true</span>,
		// WebVitals指标监听开关，默认开启
		<span class="hljs-attr">webVitals</span>: <span class="hljs-literal">true</span>,
		// Ajax监听开关，默认开启
		<span class="hljs-attr">api</span>: <span class="hljs-literal">true</span>,
		// 静态资源开关，默认开启
		<span class="hljs-attr">staticResource</span>: <span class="hljs-literal">true</span>,
		// JS错误监听开关，默认开启
		<span class="hljs-attr">jsError</span>: <span class="hljs-literal">true</span>,
		// 控制台错误监听开关，默认开启
		<span class="hljs-attr">consoleError</span>: <span class="hljs-literal">true</span>,
		// 用户行为监听开关，默认开启
		<span class="hljs-attr">action</span>: <span class="hljs-literal">true</span>,
	},
	// 链路追踪配置开关，默认关闭
	<span class="hljs-attr">tracing</span>: <span class="hljs-literal">false</span>,
})

export <span class="hljs-keyword">default</span> ArmsRum
</code></pre>
<h4 data-id="heading-3">步骤一、懒加载echarts</h4>
<p>以前的代码</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Api</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api'</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> echarts <span class="hljs-keyword">from</span> <span class="hljs-string">'echarts'</span>
<span class="hljs-keyword">import</span> dayjs <span class="hljs-keyword">from</span> <span class="hljs-string">'dayjs'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
}
</code></pre>
<p>现在的代码</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">getRepairChart</span>(<span class="hljs-params"/>) {
			<span class="hljs-keyword">const</span> echarts = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'echarts'</span>)
			<span class="hljs-comment">// xxx</span>
			<span class="hljs-keyword">const</span> chartDom = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'repairChart'</span>)
			<span class="hljs-keyword">const</span> myChart = echarts.<span class="hljs-title function_">init</span>(chartDom)
			<span class="hljs-keyword">const</span> option = {
			}
			myChart.<span class="hljs-title function_">setOption</span>(option)
		},
</code></pre>
<p>通过F12查看网络 发现加载列表的时候有出现echartsxxx.js 而且有800多k ,所以就考虑加载列表不应该去加载数据看板的数据。</p>
<p>优化前，测试前日志打印</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0dbd0b0d0574836b87635f4672395ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b635ZOlMDkwNA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763694365&amp;x-signature=JjIizh2Qh96YCdiJ8gyQ9Oyy3lE%3D" alt="" loading="lazy"/></p>
<p>平<strong>均是3.234s</strong> 然后 当然还测试了华为p40 、oppo机器 由于系统不一样时间有些差别</p>
<p>测试后日志打印</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/507f10afc0d44d2ab45b362af9346614~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b635ZOlMDkwNA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763694365&amp;x-signature=3EwUj6aw3ZbISz61I4HQeX3z3og%3D" alt="" loading="lazy"/></p>
<p><strong>平均是1.71s</strong></p>
<hr/>
<p><strong>华为meta9 9年前的老手机打印log</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10b77023980b49afa462ed8747aaec03~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b635ZOlMDkwNA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763694365&amp;x-signature=4PG3Mtt1G52FU3DgsEsjIYweJRY%3D" alt="" loading="lazy"/></p>
<p>平均也2s多</p>
<p><strong>优化后</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adb8f84dfba94502895f733d232eb27c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b635ZOlMDkwNA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763694365&amp;x-signature=HO0DHnd8EtGmfhlRkKSuS7FxM3o%3D" alt="" loading="lazy"/></p>
<p>不到0.8s</p>
<h4 data-id="heading-4">步骤二、禁用预加载、路由懒加载</h4>
<p>通过查看网络发现请求<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev-haolipei.cias.cn%2Fapp%2F%23%2FtakeOrder" target="_blank" title="https://dev-haolipei.cias.cn/app/#/takeOrder" ref="nofollow noopener noreferrer">dev-haolipei.cias.cn/app/#/takeO…</a> 超级多的js 跟css</p>
<p>一张图都截取不完。当时就感觉肯定请求了很多无关紧要的资源。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e30553165f8741d18edb78fbd1c8bb68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b635ZOlMDkwNA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763694365&amp;x-signature=jOcbTm0pxN%2FmOD1Ql%2FOP%2F8R3KAo%3D" alt="" loading="lazy"/></p>
<p>npm run build 执行后查看dist目录index.html 的确很触目惊心 加载了太多没必要的资源了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e785136933746819cd30194ba01a6a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b635ZOlMDkwNA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763694365&amp;x-signature=8tyO6ZjvrUjcjk5%2BYj0sXUwzHc0%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-go" lang="go">module.exports = {
	publicPath,
	devServer: {
		disableHostCheck: <span class="hljs-literal">true</span>,
		<span class="hljs-comment">// host: 'localhost.cias.cn',</span>
		proxy: {
			<span class="hljs-string">'/api'</span>: {
				target,
				changeOrigin: <span class="hljs-literal">true</span>,
				<span class="hljs-comment">// 	cookieDomainRewrite在手机调试时用得上</span>
				<span class="hljs-comment">// cookieDomainRewrite: '',</span>
				pathRewrite: {
					<span class="hljs-string">'^/api'</span>: <span class="hljs-string">''</span>,
				},
			},
			<span class="hljs-string">'/media'</span>: {
				target,
				changeOrigin: <span class="hljs-literal">true</span>,
				pathRewrite: {
					<span class="hljs-string">'^/media'</span>: <span class="hljs-string">''</span>,
				},
			},
		},
	},
	chainWebpack: config =&gt; {
		<span class="hljs-comment">// 禁用预加载</span>
		config.plugins.<span class="hljs-built_in">delete</span>(<span class="hljs-string">'preload'</span>)
		config.plugins.<span class="hljs-built_in">delete</span>(<span class="hljs-string">'prefetch'</span>)
	},
}
</code></pre>
<h5 data-id="heading-5">禁用它们的核心好处</h5>
<h5 data-id="heading-6">1. <strong>减少不必要的网络请求，节省带宽</strong></h5>
<ul>
<li>preload 可能会强制加载一些 “非关键资源”（如配置不当的情况下，预加载了体积大但当前页面暂时用不到的资源），导致带宽浪费。</li>
<li>prefetch 会预加载未来可能访问的路由 chunk（如用户可能不会点击的低频页面），如果用户最终没有访问这些页面，预加载的资源就成了 “无效请求”，尤其对移动端用户（流量有限）不友好。</li>
</ul>
<p>禁用后，资源仅在<strong>明确需要时才会加载</strong>（如用户进入对应路由时），避免 “提前加载但用不上” 的浪费。</p>
<h5 data-id="heading-7">2. <strong>避免阻塞关键资源加载，提升首屏速度</strong></h5>
<ul>
<li>浏览器对同一域名的并发请求数有限制（HTTP/1.1 通常为 6 个）。preload 加载的资源会占用并发名额，可能阻塞当前页面真正需要的关键资源（如核心 JS/CSS），导致首屏渲染延迟。</li>
<li>例如：若 preload 预加载了一个 2MB 的非关键 chunk，可能会挤占首屏 JS 的加载带宽，导致页面 “白屏时间” 变长。</li>
</ul>
<p>禁用后，浏览器的并发资源会优先分配给当前页面的核心资源，减少阻塞。</p>
<h5 data-id="heading-8">3. <strong>避免缓存资源被 “无效资源” 占用</strong></h5>
<p>浏览器缓存空间有限，prefetch 预加载的大量 “未来可能用到” 的 chunk 会占用缓存空间，可能导致真正需要长期缓存的核心资源（如 <code>chunk-vendors.js</code>）被挤出缓存，下次访问时需要重新加载。</p>
<p>禁用后，缓存可优先保留关键资源，提升二次访问速度。</p>
<h5 data-id="heading-9">4. <strong>适配低网速 / 弱网环境</strong></h5>
<p>在 3G、偏远地区等弱网环境下，preload/prefetch 的预加载行为会加剧网络拥堵：</p>
<ul>
<li>预加载的资源可能耗时过长，导致当前页面的核心资源加载超时。</li>
<li>禁用后，资源加载更 “轻量化”，优先保证当前页面可用，符合弱网环境的用户体验需求。</li>
</ul>
<h5 data-id="heading-10">5. <strong>减少开发环境的冗余加载</strong></h5>
<p>在开发环境中，Webpack 会频繁编译资源，preload/prefetch 可能导致每次热更新时加载大量无关资源，拖慢开发服务器响应速度，影响开发体验。禁用后可简化开发环境的资源加载逻辑，提升热更新效率。</p>
<h5 data-id="heading-11">注意：并非所有场景都适合禁用</h5>
<p>preload/prefetch 本身是性能优化手段，若项目存在以下情况，可能需要保留或部分配置：</p>
<ul>
<li>首屏依赖的关键资源（如核心 CSS、字体）体积大，preload 可加速其加载。</li>
<li>高频访问的路由（如首页→列表页），prefetch 可提前加载列表页 chunk，提升跳转速度。</li>
</ul>
<p>因此，禁用的合理性取决于项目场景：<strong>资源体积大、用户网络不稳定、低频路由多的项目（如移动端 H5）更适合禁用；高频路由明确、网络环境好的项目可选择性保留</strong>。</p>
<h5 data-id="heading-12">路由懒加载</h5>
<p>必须写上 /* webpackChunkName: "system-setting" */</p>
<p>以前的代码</p>
<pre><code class="hljs language-css" lang="css">	{
				path: <span class="hljs-string">'/takeOrder'</span>,
				name: <span class="hljs-string">'HomeTakeOrder'</span>,
				component: () =&gt;
					<span class="hljs-built_in">import</span>(
						<span class="hljs-string">'@/views/baosi/orderList.vue'</span>
					),
				meta: {
					title: <span class="hljs-string">'推返修列表'</span>,
					keepAlive: true,
				},
  }
</code></pre>
<p>懒加载路由模式</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">HomeTakeOrder</span> = (<span class="hljs-params"/>) =&gt;
	<span class="hljs-title function_">import</span>(<span class="hljs-params"><span class="hljs-comment">/* webpackChunkName: "take-order" */</span> <span class="hljs-string">'@/views/baosi/orderList.vue'</span></span>)

  {
				<span class="hljs-attr">path</span>: <span class="hljs-string">'/takeOrder'</span>,
				<span class="hljs-attr">name</span>: <span class="hljs-string">'HomeTakeOrder'</span>,
				<span class="hljs-attr">component</span>: <span class="hljs-title class_">HomeTakeOrder</span>,
				<span class="hljs-attr">meta</span>: {
					<span class="hljs-attr">title</span>: <span class="hljs-string">'推返修列表'</span>,
					<span class="hljs-attr">keepAlive</span>: <span class="hljs-literal">true</span>,
				},
			},
</code></pre>
<p>这样的好处 打包后 会有路由名称</p>
<h4 data-id="heading-13"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7b280b895ee493a87d9460239a9cfbf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b635ZOlMDkwNA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763694365&amp;x-signature=iabYhwSGalWcvhjLKRDWXX0oMtQ%3D" alt="" loading="lazy"/></h4>
<p>对比</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c34df500b01c4662a03700458aa88097~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b635ZOlMDkwNA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763694365&amp;x-signature=%2BvxJkfWoCv8d7eGsOb0Qic8LHXk%3D" alt="" loading="lazy"/></p>
<p>继续测试打印log</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/690bb7e96f7443a8874bd60af99971f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b635ZOlMDkwNA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763694365&amp;x-signature=y28OeRDcmjFjlj7ncg12DnOSWCQ%3D" alt="" loading="lazy"/></p>
<p>可以看看网络请求 就只有5个js文件 总体积不到300k</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16650b9f8daa468fb8746bdd6dc37474~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b635ZOlMDkwNA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763694365&amp;x-signature=R6mK3fYJNW6KGrglwhiWdEMsIbs%3D" alt="" loading="lazy"/></p>
<p><strong>平均是0.852，基本达成要求</strong></p>
<p>通过npm run build 本地打包看看文件对比大小。</p>
<p>1、体积巨减！！！</p>
<p>2、加载的文件名称是路由名称+hash值</p>
<p>优化前</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b75ac1c5e3a43bd9bff19148bb52ca2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b635ZOlMDkwNA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763694365&amp;x-signature=HwC9djMy0ZnLIwAGgneaAZW2aMg%3D" alt="" loading="lazy"/></p>
<p>优化后</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06e23acce7114a64847029107ad8c6e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b635ZOlMDkwNA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763694365&amp;x-signature=HMcYNdNUP8jk51akjCBUsr6%2F6x4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-14">三、内部项目具体实践</h3>
<p>（增值移动端h5项目可以参考以下操作）</p>
<h4 data-id="heading-15">1、禁用预加载</h4>
<pre><code class="hljs language-go" lang="go">module.exports = {
	publicPath,
	devServer: {
		disableHostCheck: <span class="hljs-literal">true</span>,
		<span class="hljs-comment">// host: 'localhost.cias.cn',</span>
		proxy: {
			<span class="hljs-string">'/api'</span>: {
				target,
				changeOrigin: <span class="hljs-literal">true</span>,
				<span class="hljs-comment">// 	cookieDomainRewrite在手机调试时用得上</span>
				<span class="hljs-comment">// cookieDomainRewrite: '',</span>
				pathRewrite: {
					<span class="hljs-string">'^/api'</span>: <span class="hljs-string">''</span>,
				},
			},
			<span class="hljs-string">'/media'</span>: {
				target,
				changeOrigin: <span class="hljs-literal">true</span>,
				pathRewrite: {
					<span class="hljs-string">'^/media'</span>: <span class="hljs-string">''</span>,
				},
			},
		},
	},
	chainWebpack: config =&gt; {
		<span class="hljs-comment">// 禁用预加载</span>
		config.plugins.<span class="hljs-built_in">delete</span>(<span class="hljs-string">'preload'</span>)
		config.plugins.<span class="hljs-built_in">delete</span>(<span class="hljs-string">'prefetch'</span>)
	},
}
</code></pre>
<h4 data-id="heading-16">2、将路由全部改成懒加载</h4>
<p>并且路由需要/* webpackChunkName:"take-order" */</p>
<pre><code class="hljs language-css" lang="css">	{
				path: <span class="hljs-string">'/takeOrder'</span>,
				name: <span class="hljs-string">'HomeTakeOrder'</span>,
				component: () =&gt;
					<span class="hljs-built_in">import</span>(
						<span class="hljs-comment">/* webpackChunkName:"take-order" */</span> <span class="hljs-string">'@/views/baosi/orderList.vue'</span>
					),
				meta: {
					title: <span class="hljs-string">'推返修列表'</span>,
					keepAlive: true,
				},
  }
</code></pre>
<h4 data-id="heading-17">3、组件懒加载</h4>
<p>以前常见写法 就是一进来 把所有组件的都加载进来</p>
<p>比如这个车牌号组件有120k 对于比较大一点的组件可以用懒加载 。</p>
<pre><code class="hljs language-arduino" lang="arduino">	&lt;van-popup v-model=<span class="hljs-string">"showPlatePopup"</span> position=<span class="hljs-string">"bottom"</span> :overlay=<span class="hljs-string">"false"</span>&gt;
			&lt;keyboard
				v-model=<span class="hljs-string">"baseInfo.plateNumber"</span>
				:show.sync=<span class="hljs-string">"showPlatePopup"</span>
				@input=<span class="hljs-string">"handlePlateInput"</span>
			&gt;&lt;/keyboard&gt;


      <span class="hljs-keyword">import</span> <span class="hljs-built_in">Keyboard</span> from <span class="hljs-string">'@/components/numberplate/vnp-keyboard.vue'</span>

      <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  	name: <span class="hljs-string">'CreateOrder'</span>,
  	components: {
  		MultiSelectPopup,
  		DispatchingPopup,
  		DispatchFailPopup,
  		DispatchFinishPopup,
  		<span class="hljs-built_in">Keyboard</span>,
  	},
    
    }
</code></pre>
<p>懒加载代码</p>
<p>用这个方式可以直接在网络中查看到对应组件的名称和大小</p>
<pre><code class="hljs language-ini" lang="ini">&lt;van-popup
			<span class="hljs-attr">v-if</span>=<span class="hljs-string">"showPlatePopup"</span>
			<span class="hljs-attr">v-model</span>=<span class="hljs-string">"showPlatePopup"</span>
			<span class="hljs-attr">position</span>=<span class="hljs-string">"bottom"</span>
			:<span class="hljs-attr">overlay</span>=<span class="hljs-string">"false"</span>
		&gt;
			&lt;keyboard
				<span class="hljs-attr">v-model</span>=<span class="hljs-string">"baseInfo.plateNumber"</span>
				:<span class="hljs-attr">show.sync</span>=<span class="hljs-string">"showPlatePopup"</span>
				@<span class="hljs-attr">input</span>=<span class="hljs-string">"handlePlateInput"</span>
			&gt;&lt;/keyboard&gt;
		&lt;/van-popup&gt;

    export default {
	name: 'CreateOrder',
	components: {
		MultiSelectPopup,
		DispatchingPopup,
		DispatchFailPopup,
		DispatchFinishPopup,
		Keyboard: () =&gt;
			import(
				/* webpackChunkName: "keyboard" */
				'@/components/numberplate/vnp-keyboard.vue'
			),
	},
}
</code></pre>
<p>还有 特别大的第三方库 echart 懒加载 按需引入</p>
<h3 data-id="heading-18"><strong>四、总结</strong></h3>
<p>目前通过禁用预加载、路由懒加载、和第三方组件懒加载使用方式 基本能达到很大程度的优化效果。</p>
<p>但是看图 每次加载前面2个文件一个683k 另外一个285k 还是压缩了的文件 ，</p>
<p>我猜应该是main.js 引入了很多东西，后续还可以有优化空间。移动端的h5 入口文件尽量简洁。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64fefa5b359b4e3a819ba95e14261620~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b635ZOlMDkwNA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763694365&amp;x-signature=dar4oM2ZgYVe2Y8%2BTJ30TPCQ4A0%3D" alt="" loading="lazy"/></p>
<p>(自己写的页面 一定多注意看一下 网络 有多少个js 和css 图片) 资源过大就要考虑优化了。</p>
<p>性能优化一定要<strong>多测试验证、多测试验证、多测试验证</strong>，保证业务正常情况下优化性能。</p>
<p>性能优化参考。</p>
<p><a href="https://juejin.cn/post/7188894691356573754?searchId=202505171533085DD27F1786539CD8C958#heading-0" target="_blank" title="https://juejin.cn/post/7188894691356573754?searchId=202505171533085DD27F1786539CD8C958#heading-0">juejin.cn/post/718889…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 插槽检测：$slots 的妙用与最佳实践]]></title>    <link>https://juejin.cn/post/7572138663120338986</link>    <guid>https://juejin.cn/post/7572138663120338986</guid>    <pubDate>2025-11-14T03:55:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572138663120338986" data-draft-id="7572126996176928803" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 插槽检测：$slots 的妙用与最佳实践"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-11-14T03:55:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="P7Dreamer_Matt"/> <meta itemprop="url" content="https://juejin.cn/user/2506542244440894"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 插槽检测：$slots 的妙用与最佳实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2506542244440894/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    P7Dreamer_Matt
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T03:55:43.000Z" title="Fri Nov 14 2025 03:55:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Vue 组件开发中，插槽（Slots）是实现组件灵活性的重要特性。但有时候我们需要知道父组件是否传递了某个插槽内容，这时候 <code>$slots</code> 就派上了用场。本文将深入探讨 Vue 中的插槽检测机制。</p>
<h2 data-id="heading-0">什么是插槽检测？</h2>
<p>插槽检测是指在组件内部判断父组件是否传递了特定的插槽内容。Vue 提供了 <code>$slots</code> 对象来帮助我们实现这一功能。</p>
<h3 data-id="heading-1">基本语法</h3>
<pre><code class="hljs language-ini" lang="ini">// 在模板中
&lt;div <span class="hljs-attr">v-if</span>=<span class="hljs-string">"$slots.search"</span>&gt;
  &lt;slot <span class="hljs-attr">name</span>=<span class="hljs-string">"search"</span> /&gt;
&lt;/div&gt;

// 在 Composition API 中
import { useSlots } from 'vue'
const <span class="hljs-attr">slots</span> = useSlots()
const <span class="hljs-attr">hasSearchSlot</span> = !!slots.search
</code></pre>
<h2 data-id="heading-2">实际应用场景</h2>
<h3 data-id="heading-3">1. 条件渲染容器</h3>
<p>在开发 TablePickerDialog 组件时，我们希望在父组件传递了搜索框插槽时才显示搜索区域：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- TablePickerDialog.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Dialog</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"dialogVisible"</span> <span class="hljs-attr">:title</span>=<span class="hljs-string">"dialogTitle"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 搜索框插槽 - 只有父组件传递了才显示 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"$slots.search"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"search-slot"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"search"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">el-table</span> <span class="hljs-attr">:data</span>=<span class="hljs-string">"tableData"</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 表格内容 --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">el-table</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Dialog</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h3 data-id="heading-4">2. 动态表单布局</h3>
<p>在复杂的表单组件中，根据插槽内容动态调整布局：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- FollowRecordForm.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-form</span> <span class="hljs-attr">:model</span>=<span class="hljs-string">"formData"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 基础信息区域 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-section"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>基础信息<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"basic"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 扩展信息区域 - 有条件显示 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"$slots.extension"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-section"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>扩展信息<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"extension"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 附件区域 - 有条件显示 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"$slots.attachment"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-section"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>附件<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"attachment"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">el-form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h3 data-id="heading-5">3. 组件通信增强</h3>
<p>通过插槽检测实现更精细的组件通信：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- AudioPicker.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"audio-picker"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 切换按钮 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"switch-tabs"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-radio-group</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"audioSource"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-radio-button</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"upload"</span>&gt;</span>上传音频<span class="hljs-tag">&lt;/<span class="hljs-name">el-radio-button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-radio-button</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"record"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"$slots.record"</span>&gt;</span>
          选择录音
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-radio-button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-radio-group</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 上传区域 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"audioSource === 'upload'"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"upload"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 录音选择区域 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"audioSource === 'record' &amp;&amp; $slots.record"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"record"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h2 data-id="heading-6">Vue 2 与 Vue 3 的区别</h2>
<h3 data-id="heading-7">Vue 2 (Options API)</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 检测插槽是否存在</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$slots</span>.<span class="hljs-property">search</span>) <span class="hljs-comment">// 具名插槽</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$slots</span>.<span class="hljs-property">default</span>) <span class="hljs-comment">// 默认插槽</span>
  },
  
  <span class="hljs-attr">computed</span>: {
    <span class="hljs-title function_">hasSearchSlot</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> !!<span class="hljs-variable language_">this</span>.<span class="hljs-property">$slots</span>.<span class="hljs-property">search</span>
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-8">Vue 3 (Composition API)</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { useSlots, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> slots = <span class="hljs-title function_">useSlots</span>()

<span class="hljs-comment">// 计算属性方式</span>
<span class="hljs-keyword">const</span> hasSearchSlot = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> !!slots.<span class="hljs-property">search</span>)
<span class="hljs-keyword">const</span> hasActionSlot = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> !!slots.<span class="hljs-property">action</span>)

<span class="hljs-comment">// 或者在模板中直接使用</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"slots.search"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"search-slot"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"search"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h2 data-id="heading-9">最佳实践</h2>
<h3 data-id="heading-10">1. 性能优化</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 不推荐：总是渲染容器 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"search-slot"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"search"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 推荐：有条件渲染 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"$slots.search"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"search-slot"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"search"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h3 data-id="heading-11">2. 提供默认内容</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"component-wrapper"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 有条件渲染插槽，提供默认内容 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"$slots.header"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"header"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"default-header"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>默认标题<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 主要内容 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h3 data-id="heading-12">3. 组合式检测</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { useSlots, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> slots = <span class="hljs-title function_">useSlots</span>()

<span class="hljs-comment">// 检测多个插槽</span>
<span class="hljs-keyword">const</span> slotStatus = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> ({
  <span class="hljs-attr">hasSearch</span>: !!slots.<span class="hljs-property">search</span>,
  <span class="hljs-attr">hasAction</span>: !!slots.<span class="hljs-property">action</span>,
  <span class="hljs-attr">hasFooter</span>: !!slots.<span class="hljs-property">footer</span>,
  <span class="hljs-attr">hasDefault</span>: !!slots.<span class="hljs-property">default</span>
}))

<span class="hljs-comment">// 根据插槽状态计算样式类</span>
<span class="hljs-keyword">const</span> containerClass = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> ({
  <span class="hljs-string">'with-search'</span>: slotStatus.<span class="hljs-property">value</span>.<span class="hljs-property">hasSearch</span>,
  <span class="hljs-string">'with-footer'</span>: slotStatus.<span class="hljs-property">value</span>.<span class="hljs-property">hasFooter</span>,
  <span class="hljs-string">'compact'</span>: !slotStatus.<span class="hljs-property">value</span>.<span class="hljs-property">hasSearch</span> &amp;&amp; !slotStatus.<span class="hljs-property">value</span>.<span class="hljs-property">hasFooter</span>
}))
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>使用示例：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">TablePickerDialog</span> 
    <span class="hljs-attr">v-model</span>=<span class="hljs-string">"showDialog"</span> 
    <span class="hljs-attr">dialogTitle</span>=<span class="hljs-string">"选择录音"</span>
    <span class="hljs-attr">:tableData</span>=<span class="hljs-string">"tableData"</span>
    <span class="hljs-attr">:tableDefine</span>=<span class="hljs-string">"columns"</span>
  &gt;</span>
    <span class="hljs-comment">&lt;!-- 搜索框插槽 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">search</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-form</span> <span class="hljs-attr">:inline</span>=<span class="hljs-string">"true"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"呼叫类型"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-select</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"searchParams.callType"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">el-option</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"呼入"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"1"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">el-option</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"呼出"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"2"</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">el-select</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>&gt;</span>搜索<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-form</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 操作按钮插槽 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">action</span>=<span class="hljs-string">"{ row }"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">link</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"success"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handlePlay(row)"</span>&gt;</span>播放<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">link</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"warning"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleView(row)"</span>&gt;</span>详情<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 底部插槽 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">footer</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span>&gt;</span>自定义操作<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">TablePickerDialog</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h2 data-id="heading-13">总结</h2>
<p>插槽检测是 Vue 组件开发中的重要技巧，通过合理使用 <code>$slots</code> 可以实现：</p>
<ol>
<li><strong>条件渲染</strong>：避免渲染空的容器元素</li>
<li><strong>动态布局</strong>：根据插槽内容调整组件结构</li>
<li><strong>性能优化</strong>：减少不必要的 DOM 节点</li>
<li><strong>灵活配置</strong>：提供更友好的组件 API</li>
</ol>
<p>掌握插槽检测能让你的 Vue 组件更加灵活和健壮，提升开发效率和用户体验。</p>
<p>希望这篇文章能帮助你更好地理解和使用 Vue 的插槽检测功能！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue浅响应式如何解决深层响应式的性能问题？适用场景有哪些？]]></title>    <link>https://juejin.cn/post/7572157115907096626</link>    <guid>https://juejin.cn/post/7572157115907096626</guid>    <pubDate>2025-11-14T03:55:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572157115907096626" data-draft-id="7572180297735880713" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue浅响应式如何解决深层响应式的性能问题？适用场景有哪些？  "/> <meta itemprop="keywords" content="Trae,AI编程,前端"/> <meta itemprop="datePublished" content="2025-11-14T03:55:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="kknone"/> <meta itemprop="url" content="https://juejin.cn/user/1366025597879930"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue浅响应式如何解决深层响应式的性能问题？适用场景有哪些？  
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1366025597879930/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    kknone
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T03:55:34.000Z" title="Fri Nov 14 2025 03:55:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">浅响应式的概念：与深层响应式的区别</h2>
<p>Vue 的响应式系统默认是<strong>深层响应式</strong>的——当你用 <code>reactive</code> 或 <code>ref</code> 包裹对象时，Vue 会递归地将所有嵌套属性转换为响应式代理。比如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">const</span> obj = <span class="hljs-title function_">ref</span>({ <span class="hljs-attr">a</span>: { <span class="hljs-attr">b</span>: <span class="hljs-number">1</span> } })
obj.<span class="hljs-property">value</span>.<span class="hljs-property">a</span>.<span class="hljs-property">b</span> = <span class="hljs-number">2</span> <span class="hljs-comment">// 触发更新（深层响应式）</span>
</code></pre>
<p>这种行为很方便，但也会带来性能开销：如果对象非常大（比如包含 thousands 条数据的列表），或者内部状态由外部库管理（比如 axios 响应、第三方状态库），深层代理会浪费资源。</p>
<p><strong>浅响应式</strong>（Shallow Reactivity）就是为了解决这个问题：它只跟踪<strong>顶层属性</strong>的变化，不处理嵌套对象的响应式。Vue 提供了两个 API 实现浅响应式：<code>shallowReactive</code>（对应 <code>reactive</code>）和 <code>shallowRef</code>（对应 <code>ref</code>）。</p>
<h2 data-id="heading-1">shallowReactive：只跟踪顶层属性的响应式对象</h2>
<p><code>shallowReactive</code> 是 <code>reactive</code> 的<strong>浅版本</strong>，它仅将对象的<strong>顶层属性</strong>转换为响应式，嵌套对象不会被代理。也就是说：</p>
<ul>
<li>修改顶层属性（如 <code>state.a</code>）会触发更新；</li>
<li>修改嵌套属性（如 <code>state.b.c</code>）不会触发更新；</li>
<li>替换嵌套对象的引用（如 <code>state.b = { new: 'data' }</code>）会触发更新（因为 <code>b</code> 是顶层属性）。</li>
</ul>
<h3 data-id="heading-2">示例代码</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { shallowReactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 创建浅响应式对象</span>
<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">shallowReactive</span>({
  <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>,          <span class="hljs-comment">// 顶层属性（响应式）</span>
  <span class="hljs-attr">b</span>: { <span class="hljs-attr">c</span>: <span class="hljs-number">2</span> }    <span class="hljs-comment">// 嵌套对象（非响应式）</span>
})

<span class="hljs-comment">// 1. 响应式变化：修改顶层属性</span>
state.<span class="hljs-property">a</span> = <span class="hljs-number">2</span> <span class="hljs-comment">// ✅ 触发组件更新</span>

<span class="hljs-comment">// 2. 非响应式变化：修改嵌套属性</span>
state.<span class="hljs-property">b</span>.<span class="hljs-property">c</span> = <span class="hljs-number">3</span> <span class="hljs-comment">// ❌ 不会触发更新</span>

<span class="hljs-comment">// 3. 响应式变化：替换嵌套对象引用</span>
state.<span class="hljs-property">b</span> = { <span class="hljs-attr">c</span>: <span class="hljs-number">3</span> } <span class="hljs-comment">// ✅ 触发更新（因为 b 是顶层属性）</span>
</code></pre>
<h2 data-id="heading-3">shallowRef：只跟踪.value变化的浅引用</h2>
<p><code>shallowRef</code> 是 <code>ref</code> 的<strong>浅版本</strong>，它仅跟踪 <code>ref.value</code> 的<strong>替换操作</strong>，不处理 <code>value</code> 内部的深层响应式。也就是说：</p>
<ul>
<li>替换 <code>ref.value</code>（如 <code>obj.value = { new: 'data' }</code>）会触发更新；</li>
<li>修改 <code>ref.value</code> 的内部属性（如 <code>obj.value.a = 2</code>）不会触发更新。</li>
</ul>
<h3 data-id="heading-4">示例代码</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { shallowRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 创建浅引用</span>
<span class="hljs-keyword">const</span> obj = <span class="hljs-title function_">shallowRef</span>({ <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> })

<span class="hljs-comment">// 1. 响应式变化：替换.value</span>
obj.<span class="hljs-property">value</span> = { <span class="hljs-attr">a</span>: <span class="hljs-number">2</span> } <span class="hljs-comment">// ✅ 触发更新</span>

<span class="hljs-comment">// 2. 非响应式变化：修改.value内部属性</span>
obj.<span class="hljs-property">value</span>.<span class="hljs-property">a</span> = <span class="hljs-number">3</span> <span class="hljs-comment">// ❌ 不会触发更新</span>
</code></pre>
<p>注意：<code>shallowRef</code> 的 <code>.value</code> 本身是<strong>非响应式</strong>的——即使你用 <code>reactive</code> 包裹 <code>value</code>，<code>shallowRef</code> 也不会跟踪其内部变化。</p>
<h2 data-id="heading-5">浅响应式的应用场景：性能优化与外部状态管理</h2>
<p>浅响应式不是“替代”深层响应式，而是<strong>补充</strong>——当你需要<strong>减少响应式开销</strong>或<strong>不希望Vue跟踪内部状态</strong>时使用：</p>
<h3 data-id="heading-6">场景1：处理大型对象</h3>
<details>
<summary>往期文章归档</summary>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbe04b02d2723994632de0d4ca22a3391%2F" target="_blank" title="https://blog.cmdragon.cn/posts/be04b02d2723994632de0d4ca22a3391/" ref="nofollow noopener noreferrer">Vue 3组合式API中ref与reactive的核心响应式差异及使用最佳实践是什么？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbe04b02d2723994632de0d4ca22a3391%2F" target="_blank" title="https://blog.cmdragon.cn/posts/be04b02d2723994632de0d4ca22a3391/" ref="nofollow noopener noreferrer">Vue 3组合式API中ref与reactive的核心响应式差异及使用最佳实践是什么？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa0af08dd60a37b9a890a9957f2cbfc9f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a0af08dd60a37b9a890a9957f2cbfc9f/" ref="nofollow noopener noreferrer">Vue3响应式系统中，对象新增属性、数组改索引、原始值代理的问题如何解决？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbc287e1e36287afd90750fd907eca85e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bc287e1e36287afd90750fd907eca85e/" ref="nofollow noopener noreferrer">Vue 3中watch侦听器的正确使用姿势你掌握了吗？深度监听、与watchEffect的差异及常见报错解析 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F654b9447ef1ba7ec1126a1bc26a4726d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/654b9447ef1ba7ec1126a1bc26a4726d/" ref="nofollow noopener noreferrer">Vue响应式声明的API差异、底层原理与常见陷阱你都搞懂了吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F654b9447ef1ba7ec1126a1bc26a4726d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/654b9447ef1ba7ec1126a1bc26a4726d/" ref="nofollow noopener noreferrer">Vue响应式声明的API差异、底层原理与常见陷阱你都搞懂了吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc405a8d9950af5b7c63b56c348ac36b6%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c405a8d9950af5b7c63b56c348ac36b6/" ref="nofollow noopener noreferrer">为什么Vue 3需要ref函数？它的响应式原理与正确用法是什么？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa7e9abb9691a81e4404d9facabe0f7c3%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a7e9abb9691a81e4404d9facabe0f7c3/" ref="nofollow noopener noreferrer">Vue 3中reactive函数如何通过Proxy实现响应式？使用时要避开哪些误区？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbd995ea45161727597fb85b62566c43d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bd995ea45161727597fb85b62566c43d/" ref="nofollow noopener noreferrer">Vue3响应式系统的底层原理与实践要点你真的懂吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F53e3f270a80675df662c6857a3332c0f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/53e3f270a80675df662c6857a3332c0f/" ref="nofollow noopener noreferrer">Vue 3模板如何通过编译三阶段实现从声明式语法到高效渲染的跨越 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fddbce4f2a23aa72c96b1c0473900321e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ddbce4f2a23aa72c96b1c0473900321e/" ref="nofollow noopener noreferrer">快速入门Vue模板引用：从收DOM“快递”到调子组件方法，你玩明白了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F23a2d5a334e15575277814c16e45df50%2F" target="_blank" title="https://blog.cmdragon.cn/posts/23a2d5a334e15575277814c16e45df50/" ref="nofollow noopener noreferrer">快速入门Vue模板里的JS表达式有啥不能碰？计算属性为啥比方法更能打？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6be38de6382e31d282659b689c5b17f0%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6be38de6382e31d282659b689c5b17f0/" ref="nofollow noopener noreferrer">快速入门Vue的v-model表单绑定：语法糖、动态值、修饰符的小技巧你都掌握了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F60ce517684f4a418f453d66aa805606c%2F" target="_blank" title="https://blog.cmdragon.cn/posts/60ce517684f4a418f453d66aa805606c/" ref="nofollow noopener noreferrer">快速入门Vue3事件处理的挑战题：v-on、修饰符、自定义事件你能通关吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fe4ae7d5e4a9205bb11b2baccb230c637%2F" target="_blank" title="https://blog.cmdragon.cn/posts/e4ae7d5e4a9205bb11b2baccb230c637/" ref="nofollow noopener noreferrer">快速入门Vue3的v-指令：数据和DOM的“翻译官”到底有多少本事？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F999ce4fb32259ff4fbf4bf7bcb851654%2F" target="_blank" title="https://blog.cmdragon.cn/posts/999ce4fb32259ff4fbf4bf7bcb851654/" ref="nofollow noopener noreferrer">快速入门Vue3，插值、动态绑定和避坑技巧你都搞懂了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa6997d81b49cd232b87e1cf603888ad1%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a6997d81b49cd232b87e1cf603888ad1/" ref="nofollow noopener noreferrer">想让PostgreSQL快到飞起？先找健康密码还是先换引擎？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F1fee7afbb9abd4540b8aa9c141d6845d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/1fee7afbb9abd4540b8aa9c141d6845d/" ref="nofollow noopener noreferrer">想让PostgreSQL查询快到飞起？分区表、物化视图、并行查询这三招灵不灵？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F79c590fbd87ece535b11a71c9667884f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/79c590fbd87ece535b11a71c9667884f/" ref="nofollow noopener noreferrer">子查询总拖慢查询？把它变成连接就能解决？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F748cdac2536008199abf8a8a2cd0ec85%2F" target="_blank" title="https://blog.cmdragon.cn/posts/748cdac2536008199abf8a8a2cd0ec85/" ref="nofollow noopener noreferrer">PostgreSQL全表扫描慢到崩溃？建索引+改查询+更统计信息三招能破？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F32ca943703226d317d4276a8fb53b0dd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/32ca943703226d317d4276a8fb53b0dd/" ref="nofollow noopener noreferrer">复杂查询总拖后腿？PostgreSQL多列索引+覆盖索引的神仙技巧你get没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fca93f1d53aa910e7ba5ffd8df611c12b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ca93f1d53aa910e7ba5ffd8df611c12b/" ref="nofollow noopener noreferrer">只给表子集建索引？用函数结果建索引？PostgreSQL这俩操作凭啥能省空间又加速？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Ff507856ebfddd592448813c510a53669%2F" target="_blank" title="https://blog.cmdragon.cn/posts/f507856ebfddd592448813c510a53669/" ref="nofollow noopener noreferrer">B-tree索引像字典查词一样工作？那哪些数据库查询它能加速，哪些不能？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb2213bfcb5b88a862f2138404c03d596%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b2213bfcb5b88a862f2138404c03d596/" ref="nofollow noopener noreferrer">想抓PostgreSQL里的慢SQL？pg_stat_statements基础黑匣子和pg_stat_monitor时间窗，谁能帮你更准揪出性能小偷？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F26614eb7da6c476dde41d367ad888d2f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/26614eb7da6c476dde41d367ad888d2f/" ref="nofollow noopener noreferrer">PostgreSQL的“时光机”MVCC和锁机制是怎么搞定高并发的？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F69f99bc6972a860d559c74aad7280da4%2F" target="_blank" title="https://blog.cmdragon.cn/posts/69f99bc6972a860d559c74aad7280da4/" ref="nofollow noopener noreferrer">PostgreSQL性能暴涨的关键？内存IO并发参数居然要这么设置？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F7b7053f392147a8b3b1a16bebeb08d0a%2F" target="_blank" title="https://blog.cmdragon.cn/posts/7b7053f392147a8b3b1a16bebeb08d0a/" ref="nofollow noopener noreferrer">大表查询慢到翻遍整个书架？PostgreSQL分区表教你怎么“分类”才高效</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc856e3cb073822349f3bf2d29995dcfc%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c856e3cb073822349f3bf2d29995dcfc/" ref="nofollow noopener noreferrer">PostgreSQL 查询慢？是不是忘了优化 GROUP BY、ORDER BY 和窗口函数？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc096347d18e67b7431faacd2c4757093%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c096347d18e67b7431faacd2c4757093/" ref="nofollow noopener noreferrer">PostgreSQL里的子查询和CTE居然在性能上“掐架”？到底该站哪边？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F2eca89463454fd4250d7b66243b9fe5a%2F" target="_blank" title="https://blog.cmdragon.cn/posts/2eca89463454fd4250d7b66243b9fe5a/" ref="nofollow noopener noreferrer">PostgreSQL选Join策略有啥小九九？Nested Loop/Merge/Hash谁是它的菜？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F068ecb772a87d7df20a8c9fb4b233f8e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/068ecb772a87d7df20a8c9fb4b233f8e/" ref="nofollow noopener noreferrer">PostgreSQL新手SQL总翻车？这7个性能陷阱你踩过没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd498f63cd0a2d5a77e445c688a8b88db%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d498f63cd0a2d5a77e445c688a8b88db/" ref="nofollow noopener noreferrer">PostgreSQL索引选B-Tree还是GiST？“瑞士军刀”和“多面手”的差别你居然还不知道？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F9101b75bdec6faea9b35d54f14e37f36%2F" target="_blank" title="https://blog.cmdragon.cn/posts/9101b75bdec6faea9b35d54f14e37f36/" ref="nofollow noopener noreferrer">想知道数据库怎么给查询“算成本选路线”？EXPLAIN能帮你看明白？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd527f8ebb6e3dae2c7dfe4c8d8979444%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d527f8ebb6e3dae2c7dfe4c8d8979444/" ref="nofollow noopener noreferrer">PostgreSQL处理SQL居然像做蛋糕？解析到执行的4步里藏着多少查询优化的小心机？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6bfdae84f313cf7ad0bb7045c4392347%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6bfdae84f313cf7ad0bb7045c4392347/" ref="nofollow noopener noreferrer">PostgreSQL备份不是复制文件？物理vs逻辑咋选？误删还能精准恢复到1分钟前？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fde3672803de34dbad244d0a8d48b0eb5%2F" target="_blank" title="https://blog.cmdragon.cn/posts/de3672803de34dbad244d0a8d48b0eb5/" ref="nofollow noopener noreferrer">转账不翻车、并发不干扰，PostgreSQL的ACID特性到底有啥魔法？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fe463e8a2668abdf00a228c9b79324ded%2F" target="_blank" title="https://blog.cmdragon.cn/posts/e463e8a2668abdf00a228c9b79324ded/" ref="nofollow noopener noreferrer">银行转账不白扣钱、电商下单不超卖，PostgreSQL事务的诀窍是啥？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F5c967e595058c4a1fc4474a68e64031d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/5c967e595058c4a1fc4474a68e64031d/" ref="nofollow noopener noreferrer">PostgreSQL里的PL/pgSQL到底是啥？能让SQL从“说目标”变“讲步骤”？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F325047855e3e23b5ef82f7d2db134fbd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/325047855e3e23b5ef82f7d2db134fbd/" ref="nofollow noopener noreferrer">PostgreSQL视图不存数据？那它怎么简化查询还能递归生成序列和控制权限？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd2dba50bb6e4df7b27e735245a06a2a2%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d2dba50bb6e4df7b27e735245a06a2a2/" ref="nofollow noopener noreferrer">PostgreSQL索引这么玩，才能让你的查询真的“飞”起来？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F849ae5bab0f8c66e94c2f6ad1bb798e3%2F" target="_blank" title="https://blog.cmdragon.cn/posts/849ae5bab0f8c66e94c2f6ad1bb798e3/" ref="nofollow noopener noreferrer">PostgreSQL的表关系和约束，咋帮你搞定用户订单不混乱、学生选课不重复？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fef4800975ffa84f1ca51976a70a1585b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ef4800975ffa84f1ca51976a70a1585b/" ref="nofollow noopener noreferrer">PostgreSQL查询的筛子、排序、聚合、分组？你会用它们搞定数据吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbf54711525c507c5eacfa7b0151c39d2%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bf54711525c507c5eacfa7b0151c39d2/" ref="nofollow noopener noreferrer">PostgreSQL数据类型怎么选才高效不踩坑？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F887809b3e0375f5956873cd442f516d8%2F" target="_blank" title="https://blog.cmdragon.cn/posts/887809b3e0375f5956873cd442f516d8/" ref="nofollow noopener noreferrer">想解锁PostgreSQL查询从基础到进阶的核心知识点？你都get了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F934be1203725e8be9d6f6e9104e5abcc%2F" target="_blank" title="https://blog.cmdragon.cn/posts/934be1203725e8be9d6f6e9104e5abcc/" ref="nofollow noopener noreferrer">PostgreSQL DELETE居然有这些操作？返回数据、连表删你试过没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F0f0622e9b7402b599e618150d0596ffe%2F" target="_blank" title="https://blog.cmdragon.cn/posts/0f0622e9b7402b599e618150d0596ffe/" ref="nofollow noopener noreferrer">PostgreSQL UPDATE语句怎么玩？从改邮箱到批量更新的避坑技巧你都会吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F0e3bf7efc030b024ea67ee855a00f2de%2F" target="_blank" title="https://blog.cmdragon.cn/posts/0e3bf7efc030b024ea67ee855a00f2de/" ref="nofollow noopener noreferrer">PostgreSQL插入数据还在逐条敲？批量、冲突处理、返回自增ID的技巧你会吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb6cd3c86da6aac26ed829e472d34078e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b6cd3c86da6aac26ed829e472d34078e/" ref="nofollow noopener noreferrer">PostgreSQL的“仓库-房间-货架”游戏，你能建出电商数据库和表吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fba1f545a3410144552fbdbfcf31b5265%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ba1f545a3410144552fbdbfcf31b5265/" ref="nofollow noopener noreferrer">PostgreSQL 17安装总翻车？Windows/macOS/Linux避坑指南帮你搞定？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb5474d1480509c5072085abc80b3dd9f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b5474d1480509c5072085abc80b3dd9f/" ref="nofollow noopener noreferrer">能当关系型数据库还能玩对象特性，能拆复杂查询还能自动管库存，PostgreSQL凭什么这么香？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fcc098d8836e787baa8a4d92e4d56d5c5%2F" target="_blank" title="https://blog.cmdragon.cn/posts/cc098d8836e787baa8a4d92e4d56d5c5/" ref="nofollow noopener noreferrer">给接口加新字段又不搞崩老客户端？FastAPI的多版本API靠哪三招实现？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F46d05151c5bd31cf37a7bcf0b8f5b0b8%2F" target="_blank" title="https://blog.cmdragon.cn/posts/46d05151c5bd31cf37a7bcf0b8f5b0b8/" ref="nofollow noopener noreferrer">流量突增要搞崩FastAPI？熔断测试是怎么防系统雪崩的？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F65ce343cc5df9faf3a8e2eeaab42ae45%2F" target="_blank" title="https://blog.cmdragon.cn/posts/65ce343cc5df9faf3a8e2eeaab42ae45/" ref="nofollow noopener noreferrer">FastAPI秒杀库存总变负数？Redis分布式锁能帮你守住底线吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Feed6cd8985d9be0a4b092a7da38b3e0c%2F" target="_blank" title="https://blog.cmdragon.cn/posts/eed6cd8985d9be0a4b092a7da38b3e0c/" ref="nofollow noopener noreferrer">FastAPI的CI流水线怎么自动测端点，还能让Allure报告美到犯规？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6157d87338ce894d18c013c3c4777abb%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6157d87338ce894d18c013c3c4777abb/" ref="nofollow noopener noreferrer">如何用GitHub Actions为FastAPI项目打造自动化测试流水线？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Ffc4ef84559e04693a620d0714cb30787%2F" target="_blank" title="https://blog.cmdragon.cn/posts/fc4ef84559e04693a620d0714cb30787/" ref="nofollow noopener noreferrer">如何用Git Hook和CI流水线为FastAPI项目保驾护航？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F02b0c96842d1481c72dab63a149ce0dd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/02b0c96842d1481c72dab63a149ce0dd/" ref="nofollow noopener noreferrer">FastAPI如何用契约测试确保API的「菜单」与「菜品」一致？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc9c1e3bb0fdc15303b9b3b1f20124b0b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c9c1e3bb0fdc15303b9b3b1f20124b0b/" ref="nofollow noopener noreferrer">为什么TDD能让你的FastAPI开发飞起来？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fddbfa0447a5d0d6f9af12e7a6b206f70%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ddbfa0447a5d0d6f9af12e7a6b206f70/" ref="nofollow noopener noreferrer">如何用FastAPI玩转多模块测试与异步任务，让代码不再“闹脾气”？ - cmdragon's Blog</a></li>
</ul>
</details>
<details>
<summary>免费好用的热门在线工具</summary>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fraid-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/raid-calculator" ref="nofollow noopener noreferrer">RAID 计算器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fphotoshop-online" target="_blank" title="https://tools.cmdragon.cn/zh/apps/photoshop-online" ref="nofollow noopener noreferrer">在线PS - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmermaid-live-editor" target="_blank" title="https://tools.cmdragon.cn/zh/apps/mermaid-live-editor" ref="nofollow noopener noreferrer">Mermaid 在线编辑器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmath-solver-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/math-solver-calculator" ref="nofollow noopener noreferrer">数学求解计算器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsmart-teleprompter" target="_blank" title="https://tools.cmdragon.cn/zh/apps/smart-teleprompter" ref="nofollow noopener noreferrer">智能提词器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmagic-resume" target="_blank" title="https://tools.cmdragon.cn/zh/apps/magic-resume" ref="nofollow noopener noreferrer">魔法简历 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-puzzle-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-puzzle-tool" ref="nofollow noopener noreferrer">Image Puzzle Tool - 图片拼图工具 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsubtitle-downloader" target="_blank" title="https://tools.cmdragon.cn/zh/apps/subtitle-downloader" ref="nofollow noopener noreferrer">字幕下载工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Flyrics-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/lyrics-generator" ref="nofollow noopener noreferrer">歌词生成工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcloud-drive-search" target="_blank" title="https://tools.cmdragon.cn/zh/apps/cloud-drive-search" ref="nofollow noopener noreferrer">网盘资源聚合搜索 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fascii-art-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ascii-art-generator" ref="nofollow noopener noreferrer">ASCII字符画生成器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fjwt-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/jwt-tool" ref="nofollow noopener noreferrer">JSON Web Tokens 工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbcrypt-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/bcrypt-tool" ref="nofollow noopener noreferrer">Bcrypt 密码工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fgif-composer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/gif-composer" ref="nofollow noopener noreferrer">GIF 合成器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fgif-decomposer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/gif-decomposer" ref="nofollow noopener noreferrer">GIF 分解器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-steganography" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-steganography" ref="nofollow noopener noreferrer">文本隐写术 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh" target="_blank" title="https://tools.cmdragon.cn/zh" ref="nofollow noopener noreferrer">CMDragon 在线工具 - 高级AI工具箱与开发者套件 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%3Fcategory%3Dtrending" target="_blank" title="https://tools.cmdragon.cn/zh/apps?category=trending" ref="nofollow noopener noreferrer">应用商店 - 发现1000+提升效率与开发的AI工具和实用程序 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fchangelog" target="_blank" title="https://tools.cmdragon.cn/zh/changelog" ref="nofollow noopener noreferrer">CMDragon 更新日志 - 最新更新、功能与改进 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fsponsor" target="_blank" title="https://tools.cmdragon.cn/zh/sponsor" ref="nofollow noopener noreferrer">支持我们 - 成为赞助者 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-to-image-ai" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-to-image-ai" ref="nofollow noopener noreferrer">AI文本生成图像 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftemp-email" target="_blank" title="https://tools.cmdragon.cn/zh/apps/temp-email" ref="nofollow noopener noreferrer">临时邮箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fqrcode-parser" target="_blank" title="https://tools.cmdragon.cn/zh/apps/qrcode-parser" ref="nofollow noopener noreferrer">二维码解析器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-to-mindmap" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-to-mindmap" ref="nofollow noopener noreferrer">文本转思维导图 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fregex-visualizer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/regex-visualizer" ref="nofollow noopener noreferrer">正则表达式可视化工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsteganography-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/steganography-tool" ref="nofollow noopener noreferrer">文件隐写工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fiptv-explorer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/iptv-explorer" ref="nofollow noopener noreferrer">IPTV 频道探索器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsnapdrop" target="_blank" title="https://tools.cmdragon.cn/zh/apps/snapdrop" ref="nofollow noopener noreferrer">快传 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Flucky-draw" target="_blank" title="https://tools.cmdragon.cn/zh/apps/lucky-draw" ref="nofollow noopener noreferrer">随机抽奖工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fanime-scene-finder" target="_blank" title="https://tools.cmdragon.cn/zh/apps/anime-scene-finder" ref="nofollow noopener noreferrer">动漫场景查找器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftime-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/time-toolkit" ref="nofollow noopener noreferrer">时间工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fspeed-test" target="_blank" title="https://tools.cmdragon.cn/zh/apps/speed-test" ref="nofollow noopener noreferrer">网速测试 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbackground-remover" target="_blank" title="https://tools.cmdragon.cn/zh/apps/background-remover" ref="nofollow noopener noreferrer">AI 智能抠图工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbackground-replacer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/background-replacer" ref="nofollow noopener noreferrer">背景替换工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fartistic-qrcode" target="_blank" title="https://tools.cmdragon.cn/zh/apps/artistic-qrcode" ref="nofollow noopener noreferrer">艺术二维码生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fopen-graph-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/open-graph-generator" ref="nofollow noopener noreferrer">Open Graph 元标签生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-comparison" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-comparison" ref="nofollow noopener noreferrer">图像对比工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-compressor" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-compressor" ref="nofollow noopener noreferrer">图片压缩专业版 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fpassword-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/password-generator" ref="nofollow noopener noreferrer">密码生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsvg-optimizer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/svg-optimizer" ref="nofollow noopener noreferrer">SVG优化器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcolor-palette" target="_blank" title="https://tools.cmdragon.cn/zh/apps/color-palette" ref="nofollow noopener noreferrer">调色板生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fonline-metronome" target="_blank" title="https://tools.cmdragon.cn/zh/apps/online-metronome" ref="nofollow noopener noreferrer">在线节拍器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-geolocation" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-geolocation" ref="nofollow noopener noreferrer">IP归属地查询 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcss-grid-layout" target="_blank" title="https://tools.cmdragon.cn/zh/apps/css-grid-layout" ref="nofollow noopener noreferrer">CSS网格布局生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Femail-validator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/email-validator" ref="nofollow noopener noreferrer">邮箱验证工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcalligraphy-practice" target="_blank" title="https://tools.cmdragon.cn/zh/apps/calligraphy-practice" ref="nofollow noopener noreferrer">书法练习字帖 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ffinance-calculator-suite" target="_blank" title="https://tools.cmdragon.cn/zh/apps/finance-calculator-suite" ref="nofollow noopener noreferrer">金融计算器套件 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fchinese-kinship-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/chinese-kinship-calculator" ref="nofollow noopener noreferrer">中国亲戚关系计算器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fprotobuf-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/protobuf-toolkit" ref="nofollow noopener noreferrer">Protocol Buffer 工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-geolocation" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-geolocation" ref="nofollow noopener noreferrer">IP归属地查询 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-upscaler" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-upscaler" ref="nofollow noopener noreferrer">图片无损放大 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-compare" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-compare" ref="nofollow noopener noreferrer">文本比较工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-batch-lookup" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-batch-lookup" ref="nofollow noopener noreferrer">IP批量查询工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fdomain-finder" target="_blank" title="https://tools.cmdragon.cn/zh/apps/domain-finder" ref="nofollow noopener noreferrer">域名查询工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fdns-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/dns-toolkit" ref="nofollow noopener noreferrer">DNS工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ffavicon-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/favicon-generator" ref="nofollow noopener noreferrer">网站图标生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fsitemap_index.xml" target="_blank" title="https://tools.cmdragon.cn/sitemap_index.xml" ref="nofollow noopener noreferrer">XML Sitemap</a></li>
</ul>
</details>
<p>如果你的对象包含大量数据（比如表格的 thousands 条记录），但只需要跟踪顶层状态（如 <code>isLoading</code>、<code>currentPage</code>），用 <code>shallowReactive</code> 可以避免递归代理所有嵌套属性：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> tableState = <span class="hljs-title function_">shallowReactive</span>({
  <span class="hljs-attr">isLoading</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">currentPage</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">data</span>: [] <span class="hljs-comment">// 大数组，内部变化无需Vue跟踪</span>
})
</code></pre>
<h3 data-id="heading-7">场景2：外部管理的状态</h3>
<p>如果对象的内部状态由<strong>外部库</strong>管理（比如 axios 的响应对象、Redux 的 store、第三方组件的状态），Vue 不需要跟踪其内部变化，用浅响应式更合适：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { shallowRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>

<span class="hljs-comment">// 用shallowRef包裹axios响应，只跟踪.value的替换</span>
<span class="hljs-keyword">const</span> response = <span class="hljs-title function_">shallowRef</span>(<span class="hljs-literal">null</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/data'</span>)
  response.<span class="hljs-property">value</span> = res.<span class="hljs-property">data</span> <span class="hljs-comment">// ✅ 触发更新（替换.value）</span>
}
</code></pre>
<h2 data-id="heading-8">实践示例：用shallowReactive管理外部API状态</h2>
<p>假设你有一个用户详情页，需要：</p>
<ul>
<li>跟踪 <code>isLoading</code>（加载状态，顶层属性）；</li>
<li>展示用户数据（由API返回，内部变化无需Vue跟踪）。</li>
</ul>
<h3 data-id="heading-9">完整组件代码</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { shallowReactive } from 'vue'

// 浅响应式状态：只跟踪顶层属性
const userState = shallowReactive({
  isLoading: true,
  userData: null // 由API填充，内部变化不触发Vue更新
})

// 模拟API请求
const fetchUser = async () =&gt; {
  userState.isLoading = true
  // 假设userData由外部API返回，内部状态无需Vue跟踪
  const res = await fetch('/api/user/1')
  const data = await res.json()
  userState.userData = data // ✅ 触发更新（替换顶层属性userData）
  userState.isLoading = false // ✅ 触发更新（修改顶层属性isLoading）
}

// 初始化加载
fetchUser()
&lt;/script&gt;

&lt;template&gt;
  &lt;div class="user-page"&gt;
    &lt;!-- 加载状态（响应式） --&gt;
    &lt;div v-if="userState.isLoading" class="loading"&gt;加载中...&lt;/div&gt;
    
    &lt;!-- 用户数据（非响应式内部变化） --&gt;
    &lt;div v-else class="user-details"&gt;
      &lt;h2&gt;{{ userState.userData.name }}&lt;/h2&gt;
      &lt;p&gt;年龄：{{ userState.userData.age }}&lt;/p&gt;
      &lt;p&gt;邮箱：{{ userState.userData.email }}&lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-10">效果说明</h3>
<ul>
<li>当 <code>isLoading</code> 或 <code>userData</code> 变化时（都是顶层属性），组件会更新；</li>
<li>如果 <code>userData</code> 内部的 <code>name</code> 变化（比如 <code>userState.userData.name = 'Bob'</code>），组件不会更新——因为这是嵌套属性，浅响应式不跟踪。</li>
</ul>
<h2 data-id="heading-11">课后Quiz：巩固浅响应式知识</h2>
<h3 data-id="heading-12">问题1（多选）</h3>
<p>以下关于 <code>shallowReactive</code> 的描述，正确的是？<br/>
A. <code>shallowReactive</code> 会使对象的所有属性（包括嵌套）响应式<br/>
B. <code>shallowReactive</code> 只使对象的顶层属性响应式<br/>
C. 修改 <code>shallowReactive</code> 对象的嵌套属性会触发更新<br/>
D. 替换 <code>shallowReactive</code> 对象的嵌套对象引用会触发更新</p>
<p><strong>答案</strong>：B、D<br/>
<strong>解析</strong>：<code>shallowReactive</code> 仅处理顶层属性，所以 B 正确；替换嵌套对象的引用（如 <code>state.b = { new: 'data' }</code>）是顶层属性的变化，会触发更新，所以 D 正确。</p>
<h3 data-id="heading-13">问题2（单选）</h3>
<p>当使用 <code>shallowRef</code> 时，以下哪种操作会触发组件更新？<br/>
A. 修改 <code>ref.value</code> 的内部属性（如 <code>obj.value.a = 2</code>）<br/>
B. 替换 <code>ref.value</code>（如 <code>obj.value = { a: 2 }</code>）<br/>
C. 修改 <code>ref</code> 的非 <code>.value</code> 属性（如 <code>obj.a = 2</code>）<br/>
D. 以上都不会</p>
<p><strong>答案</strong>：B<br/>
<strong>解析</strong>：<code>shallowRef</code> 只跟踪 <code>.value</code> 的替换操作，所以 B 正确；A 是内部属性变化，不会触发；C 是错误操作（<code>ref</code> 没有 <code>a</code> 属性，只有 <code>.value</code>）。</p>
<h2 data-id="heading-14">常见报错与解决方案</h2>
<h3 data-id="heading-15">报错场景1：修改shallowRef内部属性不触发更新</h3>
<p><strong>错误代码</strong>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { shallowRef } from 'vue'

const user = shallowRef({ name: 'Alice' })

// 修改内部属性，但页面不更新
const changeName = () =&gt; {
  user.value.name = 'Bob'
}
&lt;/script&gt;

&lt;template&gt;
  &lt;p&gt;{{ user.value.name }}&lt;/p&gt;
  &lt;button @click="changeName"&gt;改名&lt;/button&gt;
&lt;/template&gt;
</code></pre>
<p><strong>原因</strong>：<code>shallowRef</code> 不跟踪 <code>.value</code> 内部的变化。<br/>
<strong>解决方案</strong>：</p>
<ol>
<li>改用 <code>ref</code>（需要深层响应式时）：
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">ref</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> })
</code></pre>
</li>
<li>手动触发更新（用 <code>triggerRef</code>）：
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { shallowRef, triggerRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">shallowRef</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> })

<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeName</span> = (<span class="hljs-params"/>) =&gt; {
  user.<span class="hljs-property">value</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'Bob'</span>
  <span class="hljs-title function_">triggerRef</span>(user) <span class="hljs-comment">// ✅ 手动触发更新</span>
}
</code></pre>
</li>
</ol>
<h3 data-id="heading-16">报错场景2：修改shallowReactive嵌套属性不触发更新</h3>
<p><strong>错误代码</strong>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { shallowReactive } from 'vue'

const state = shallowReactive({
  user: { name: 'Alice' }
})

// 修改嵌套属性，页面不更新
const changeName = () =&gt; {
  state.user.name = 'Bob'
}
&lt;/script&gt;

&lt;template&gt;
  &lt;p&gt;{{ state.user.name }}&lt;/p&gt;
  &lt;button @click="changeName"&gt;改名&lt;/button&gt;
&lt;/template&gt;
</code></pre>
<p><strong>原因</strong>：<code>shallowReactive</code> 不处理嵌套对象的响应式。<br/>
<strong>解决方案</strong>：</p>
<ol>
<li>改用 <code>reactive</code>（需要深层响应式时）：
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">user</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> } })
</code></pre>
</li>
<li>替换嵌套对象引用（触发顶层属性变化）：
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">changeName</span> = (<span class="hljs-params"/>) =&gt; {
  state.<span class="hljs-property">user</span> = { ...state.<span class="hljs-property">user</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span> } <span class="hljs-comment">// ✅ 替换引用，触发更新</span>
}
</code></pre>
</li>
</ol>
<h2 data-id="heading-17">参考链接</h2>
<ul>
<li>Vue 官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fapi%2Freactivity-advanced.html%23shallowref" target="_blank" title="https://vuejs.org/api/reactivity-advanced.html#shallowref" ref="nofollow noopener noreferrer">Shallow Reactivity</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端性能优化实战：打造极致用户体验]]></title>    <link>https://juejin.cn/post/7572132916575141924</link>    <guid>https://juejin.cn/post/7572132916575141924</guid>    <pubDate>2025-11-14T03:31:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572132916575141924" data-draft-id="7572132916575109156" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端性能优化实战：打造极致用户体验"/> <meta itemprop="keywords" content="前端,性能优化"/> <meta itemprop="datePublished" content="2025-11-14T03:31:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小小前端_我自坚强"/> <meta itemprop="url" content="https://juejin.cn/user/2335811609826423"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端性能优化实战：打造极致用户体验
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2335811609826423/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小小前端_我自坚强
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T03:31:05.000Z" title="Fri Nov 14 2025 03:31:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="vs2015">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1e1e1e;color:#dcdcdc}.hljs-keyword,.hljs-link,.hljs-literal,.hljs-name,.hljs-symbol{color:#569cd6}.hljs-link{text-decoration:underline}.hljs-built_in,.hljs-type{color:#4ec9b0}.hljs-class,.hljs-number{color:#b8d7a3}.hljs-meta-string,.hljs-string{color:#d69d85}.hljs-regexp,.hljs-template-tag{color:#9a5334}.hljs-formula,.hljs-function,.hljs-params,.hljs-subst,.hljs-title{color:#dcdcdc}.hljs-comment,.hljs-quote{color:#57a64a;font-style:italic}.hljs-doctag{color:#608b4e}.hljs-meta,.hljs-meta-keyword,.hljs-tag{color:#9b9b9b}.hljs-template-variable,.hljs-variable{color:#bd63c5}.hljs-attr,.hljs-attribute,.hljs-builtin-name{color:#9cdcfe}.hljs-section{color:gold}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-bullet,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-selector-tag{color:#d7ba7d}.hljs-addition{background-color:#144212}.hljs-addition,.hljs-deletion{display:inline-block;width:100%}.hljs-deletion{background-color:#600}</style><h2 data-id="heading-0">前端性能优化实战：打造极致用户体验</h2>
<h3 data-id="heading-1">引言</h3>
<p>在当今数字化时代，网页性能直接影响用户体验和业务转化率。研究表明，页面加载时间每增加1秒，转化率可能下降7%，跳出率增加38%。因此，前端性能优化不仅是技术问题，更是商业问题。</p>
<p>本文将深入探讨前端性能优化的各个方面，包括加载优化、渲染优化、运行时优化等，并通过实际案例展示如何系统地提升网页性能。</p>
<h3 data-id="heading-2">第一章：性能指标体系</h3>
<h4 data-id="heading-3">1.1 关键性能指标（KPIs）</h4>
<h5 data-id="heading-4">Core Web Vitals（核心网页指标）</h5>
<ul>
<li><strong>Largest Contentful Paint (LCP)</strong>：衡量加载性能，目标：&lt;2.5秒</li>
<li><strong>First Input Delay (FID)</strong>：衡量交互性，目标：&lt;100毫秒</li>
<li><strong>Cumulative Layout Shift (CLS)</strong>：衡量视觉稳定性，目标：&lt;0.1</li>
</ul>
<h5 data-id="heading-5">其他重要指标</h5>
<ul>
<li><strong>First Contentful Paint (FCP)</strong>：首次内容绘制</li>
<li><strong>Time to Interactive (TTI)</strong>：可交互时间</li>
<li><strong>Total Blocking Time (TBT)</strong>：总阻塞时间</li>
</ul>
<h4 data-id="heading-6">1.2 性能测量工具</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 Performance API 获取关键指标</span>
<span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function">(<span class="hljs-params">list</span>) =&gt;</span> {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> entry <span class="hljs-keyword">of</span> list.<span class="hljs-title function_">getEntries</span>()) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(entry.<span class="hljs-property">name</span>, entry.<span class="hljs-property">startTime</span>, entry.<span class="hljs-property">duration</span>);
  }
});

observer.<span class="hljs-title function_">observe</span>({<span class="hljs-attr">entryTypes</span>: [<span class="hljs-string">'navigation'</span>, <span class="hljs-string">'paint'</span>, <span class="hljs-string">'largest-contentful-paint'</span>]});
</code></pre>
<h3 data-id="heading-7">第二章：资源加载优化</h3>
<h4 data-id="heading-8">2.1 资源压缩与合并</h4>
<h5 data-id="heading-9">JavaScript/CSS 压缩</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// webpack.config.js 示例</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">optimization</span>: {
    <span class="hljs-attr">minimize</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">minimizer</span>: [
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">TerserPlugin</span>({
        <span class="hljs-attr">terserOptions</span>: {
          <span class="hljs-attr">compress</span>: {
            <span class="hljs-attr">drop_console</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 移除console</span>
            <span class="hljs-attr">drop_debugger</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 移除debugger</span>
          },
        },
      }),
    ],
  },
};
</code></pre>
<h5 data-id="heading-10">图片优化策略</h5>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 使用 picture 元素实现响应式图片 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">picture</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">media</span>=<span class="hljs-string">"(max-width: 799px)"</span> <span class="hljs-attr">srcset</span>=<span class="hljs-string">"small.webp"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/webp"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">media</span>=<span class="hljs-string">"(min-width: 800px)"</span> <span class="hljs-attr">srcset</span>=<span class="hljs-string">"large.webp"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/webp"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"default.jpg"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"描述"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">picture</span>&gt;</span>
</code></pre>
<h4 data-id="heading-11">2.2 资源懒加载</h4>
<h5 data-id="heading-12">图片懒加载实现</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Intersection Observer 实现图片懒加载</span>
<span class="hljs-keyword">const</span> imageObserver = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntersectionObserver</span>(<span class="hljs-function">(<span class="hljs-params">entries, observer</span>) =&gt;</span> {
  entries.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">isIntersecting</span>) {
      <span class="hljs-keyword">const</span> img = entry.<span class="hljs-property">target</span>;
      img.<span class="hljs-property">src</span> = img.<span class="hljs-property">dataset</span>.<span class="hljs-property">src</span>;
      img.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'lazy'</span>);
      observer.<span class="hljs-title function_">unobserve</span>(img);
    }
  });
});

<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'img[data-src]'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">img</span> =&gt;</span> {
  imageObserver.<span class="hljs-title function_">observe</span>(img);
});
</code></pre>
<h5 data-id="heading-13">组件懒加载</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue 动态导入组件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">AsyncComponent</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-keyword">import</span>(<span class="hljs-string">'./AsyncComponent.vue'</span>);

<span class="hljs-comment">// React 代码分割</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">LazyComponent</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./LazyComponent'</span>));
</code></pre>
<h4 data-id="heading-14">2.3 预加载策略</h4>
<h5 data-id="heading-15">DNS预解析</h5>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"dns-prefetch"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"//example.com"</span>&gt;</span>
</code></pre>
<h5 data-id="heading-16">资源预加载</h5>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 预加载关键资源 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preload"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"critical.css"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"style"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preload"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"hero-image.jpg"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"image"</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 预连接 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preconnect"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://fonts.googleapis.com"</span>&gt;</span>
</code></pre>
<h3 data-id="heading-17">第三章：网络传输优化</h3>
<h4 data-id="heading-18">3.1 HTTP/2 优化</h4>
<p>HTTP/2 的多路复用、头部压缩等特性可以显著提升资源加载速度：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 启用 HTTP/2 Push（服务端配置）</span>
<span class="hljs-comment">// nginx.conf 示例</span>
location / {
  http2_push /critical.<span class="hljs-property">css</span>;
  http2_push /critical.<span class="hljs-property">js</span>;
}
</code></pre>
<h4 data-id="heading-19">3.2 Service Worker 缓存策略</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// service-worker.js</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CACHE_NAME</span> = <span class="hljs-string">'my-site-v1'</span>;
<span class="hljs-keyword">const</span> urlsToCache = [
  <span class="hljs-string">'/'</span>,
  <span class="hljs-string">'/styles/main.css'</span>,
  <span class="hljs-string">'/scripts/main.js'</span>
];

self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'install'</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
  event.<span class="hljs-title function_">waitUntil</span>(
    caches.<span class="hljs-title function_">open</span>(<span class="hljs-variable constant_">CACHE_NAME</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">cache</span> =&gt;</span> cache.<span class="hljs-title function_">addAll</span>(urlsToCache))
  );
});

self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'fetch'</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
  event.<span class="hljs-title function_">respondWith</span>(
    caches.<span class="hljs-title function_">match</span>(event.<span class="hljs-property">request</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
        <span class="hljs-comment">// 缓存命中则返回缓存，否则发起网络请求</span>
        <span class="hljs-keyword">return</span> response || <span class="hljs-title function_">fetch</span>(event.<span class="hljs-property">request</span>);
      })
  );
});
</code></pre>
<h4 data-id="heading-20">3.3 CDN 优化</h4>
<p>合理使用 CDN 可以大幅减少资源加载时间：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// webpack 配置 CDN 路径</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">publicPath</span>: <span class="hljs-string">'https://cdn.example.com/assets/'</span>
  }
};
</code></pre>
<h3 data-id="heading-21">第四章：渲染性能优化</h3>
<h4 data-id="heading-22">4.1 CSS 优化</h4>
<h5 data-id="heading-23">避免强制同步布局</h5>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 避免触发重排的样式 */</span>
<span class="hljs-selector-class">.expensive-style</span> {
  <span class="hljs-comment">/* 避免使用这些属性 */</span>
  <span class="hljs-attribute">width</span>: <span class="hljs-number">50%</span>; <span class="hljs-comment">/* 触发重排 */</span>
  <span class="hljs-attribute">height</span>: <span class="hljs-number">50%</span>; <span class="hljs-comment">/* 触发重排 */</span>
  
  <span class="hljs-comment">/* 更好的替代方案 */</span>
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.5</span>); <span class="hljs-comment">/* 只触发合成 */</span>
}
</code></pre>
<h5 data-id="heading-24">使用 will-change 提升动画性能</h5>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.animated-element</span> {
  <span class="hljs-attribute">will-change</span>: transform;
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-selector-class">.animated-element</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">10px</span>);
}
</code></pre>
<h4 data-id="heading-25">4.2 JavaScript 渲染优化</h4>
<h5 data-id="heading-26">虚拟滚动实现</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">VirtualList</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">container, itemHeight, items</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span> = container;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">itemHeight</span> = itemHeight;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span> = items;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">visibleItems</span> = [];
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();
  }
  
  <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 监听滚动事件</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onScroll</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
    
    <span class="hljs-comment">// 初始化可见项</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateVisibleItems</span>();
  }
  
  <span class="hljs-title function_">onScroll</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 节流处理</span>
    <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateVisibleItems</span>();
    });
  }
  
  <span class="hljs-title function_">updateVisibleItems</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> scrollTop = <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-property">scrollTop</span>;
    <span class="hljs-keyword">const</span> containerHeight = <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-property">clientHeight</span>;
    
    <span class="hljs-keyword">const</span> startIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(scrollTop / <span class="hljs-variable language_">this</span>.<span class="hljs-property">itemHeight</span>);
    <span class="hljs-keyword">const</span> endIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(
      startIndex + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(containerHeight / <span class="hljs-variable language_">this</span>.<span class="hljs-property">itemHeight</span>) + <span class="hljs-number">1</span>,
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-property">length</span>
    );
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderItems</span>(startIndex, endIndex);
  }
  
  <span class="hljs-title function_">renderItems</span>(<span class="hljs-params">startIndex, endIndex</span>) {
    <span class="hljs-comment">// 只渲染可见区域的元素</span>
    <span class="hljs-keyword">const</span> fragment = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createDocumentFragment</span>();
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = startIndex; i &lt; endIndex; i++) {
      <span class="hljs-keyword">const</span> item = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createItemElement</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>[i], i);
      fragment.<span class="hljs-title function_">appendChild</span>(item);
    }
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">''</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">appendChild</span>(fragment);
  }
  
  <span class="hljs-title function_">createItemElement</span>(<span class="hljs-params">itemData, index</span>) {
    <span class="hljs-keyword">const</span> element = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
    element.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.itemHeight}</span>px`</span>;
    element.<span class="hljs-property">textContent</span> = itemData.<span class="hljs-property">text</span>;
    <span class="hljs-keyword">return</span> element;
  }
}
</code></pre>
<h5 data-id="heading-27">使用 DocumentFragment 减少 DOM 操作</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 批量添加元素的优化方式</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">addItemsToList</span>(<span class="hljs-params">items</span>) {
  <span class="hljs-keyword">const</span> fragment = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createDocumentFragment</span>();
  
  items.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> li = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'li'</span>);
    li.<span class="hljs-property">textContent</span> = item;
    fragment.<span class="hljs-title function_">appendChild</span>(li);
  });
  
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'list'</span>).<span class="hljs-title function_">appendChild</span>(fragment);
}
</code></pre>
<h3 data-id="heading-28">第五章：运行时性能优化</h3>
<h4 data-id="heading-29">5.1 内存泄漏检测与修复</h4>
<h5 data-id="heading-30">常见内存泄漏场景</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 忘记清理定时器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Component</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">timer</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// 定时任务</span>
    }, <span class="hljs-number">1000</span>);
  }
  
  <span class="hljs-title function_">destroy</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 销毁时清理定时器</span>
    <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">timer</span>);
  }
}

<span class="hljs-comment">// 2. 事件监听器未移除</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">EventManager</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleClick</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleClick</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleClick</span>);
  }
  
  <span class="hljs-title function_">handleClick</span>(<span class="hljs-params">e</span>) {
    <span class="hljs-comment">// 处理点击事件</span>
  }
  
  <span class="hljs-title function_">destroy</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 移除事件监听器</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleClick</span>);
  }
}
</code></pre>
<h4 data-id="heading-31">5.2 防抖与节流优化</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 防抖函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">func, delay</span>) {
  <span class="hljs-keyword">let</span> timeoutId;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {
    <span class="hljs-built_in">clearTimeout</span>(timeoutId);
    timeoutId = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> func.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args), delay);
  };
}

<span class="hljs-comment">// 节流函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">throttle</span>(<span class="hljs-params">func, limit</span>) {
  <span class="hljs-keyword">let</span> inThrottle;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">if</span> (!inThrottle) {
      func.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
      inThrottle = <span class="hljs-literal">true</span>;
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> inThrottle = <span class="hljs-literal">false</span>, limit);
    }
  };
}

<span class="hljs-comment">// 应用场景</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-title function_">debounce</span>(handleResize, <span class="hljs-number">300</span>));
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-title function_">throttle</span>(handleScroll, <span class="hljs-number">100</span>));
</code></pre>
<h4 data-id="heading-32">5.3 Web Workers 并行计算</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">const</span> worker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(<span class="hljs-string">'worker.js'</span>);

worker.<span class="hljs-title function_">postMessage</span>({<span class="hljs-attr">data</span>: largeDataSet});

worker.<span class="hljs-property">onmessage</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'计算结果:'</span>, e.<span class="hljs-property">data</span>);
};

<span class="hljs-comment">// worker.js</span>
self.<span class="hljs-property">onmessage</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">performHeavyCalculation</span>(e.<span class="hljs-property">data</span>);
  self.<span class="hljs-title function_">postMessage</span>(result);
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">performHeavyCalculation</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-comment">// 执行大量计算</span>
  <span class="hljs-keyword">return</span> data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item * <span class="hljs-number">2</span>);
}
</code></pre>
<h3 data-id="heading-33">第六章：移动端性能优化</h3>
<h4 data-id="heading-34">6.1 响应式设计优化</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 使用 CSS Grid 和 Flexbox 优化布局 */</span>
<span class="hljs-selector-class">.grid-container</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fit, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">300px</span>, <span class="hljs-number">1</span>fr));
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">1rem</span>;
}

<span class="hljs-selector-class">.flex-container</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-wrap</span>: wrap;
  <span class="hljs-attribute">justify-content</span>: space-between;
}
</code></pre>
<h4 data-id="heading-35">6.2 触摸优化</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 优化触摸体验 */</span>
<span class="hljs-selector-class">.touch-target</span> {
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">44px</span>;
  <span class="hljs-attribute">min-width</span>: <span class="hljs-number">44px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
}

<span class="hljs-comment">/* 硬件加速 */</span>
<span class="hljs-selector-class">.animated-element</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateZ</span>(<span class="hljs-number">0</span>);
  <span class="hljs-attribute">will-change</span>: transform;
}
</code></pre>
<h4 data-id="heading-36">6.3 PWA 优化</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// manifest.json</span>
{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"My App"</span>,
  <span class="hljs-string">"short_name"</span>: <span class="hljs-string">"App"</span>,
  <span class="hljs-string">"start_url"</span>: <span class="hljs-string">"/"</span>,
  <span class="hljs-string">"display"</span>: <span class="hljs-string">"standalone"</span>,
  <span class="hljs-string">"background_color"</span>: <span class="hljs-string">"#ffffff"</span>,
  <span class="hljs-string">"theme_color"</span>: <span class="hljs-string">"#000000"</span>
}

<span class="hljs-comment">// 注册 Service Worker</span>
<span class="hljs-keyword">if</span> (<span class="hljs-string">'serviceWorker'</span> <span class="hljs-keyword">in</span> navigator) {
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'load'</span>, <span class="hljs-function">() =&gt;</span> {
    navigator.<span class="hljs-property">serviceWorker</span>.<span class="hljs-title function_">register</span>(<span class="hljs-string">'/sw.js'</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">registration</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'SW registered'</span>))
      .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'SW registration failed'</span>));
  });
}
</code></pre>
<h3 data-id="heading-37">第七章：监控与分析</h3>
<h4 data-id="heading-38">7.1 性能监控实现</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 自定义性能监控</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PerformanceMonitor</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span> = {};
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();
  }
  
  <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 页面加载完成后的性能数据</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'load'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">collectMetrics</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">reportMetrics</span>();
      }, <span class="hljs-number">0</span>);
    });
  }
  
  <span class="hljs-title function_">collectMetrics</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> navigation = performance.<span class="hljs-title function_">getEntriesByType</span>(<span class="hljs-string">'navigation'</span>)[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">const</span> paint = performance.<span class="hljs-title function_">getEntriesByType</span>(<span class="hljs-string">'paint'</span>);
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span> = {
      <span class="hljs-comment">// 页面加载时间</span>
      <span class="hljs-attr">loadTime</span>: navigation.<span class="hljs-property">loadEventEnd</span> - navigation.<span class="hljs-property">fetchStart</span>,
      
      <span class="hljs-comment">// DNS 查询时间</span>
      <span class="hljs-attr">dnsTime</span>: navigation.<span class="hljs-property">domainLookupEnd</span> - navigation.<span class="hljs-property">domainLookupStart</span>,
      
      <span class="hljs-comment">// TCP 连接时间</span>
      <span class="hljs-attr">tcpTime</span>: navigation.<span class="hljs-property">connectEnd</span> - navigation.<span class="hljs-property">connectStart</span>,
      
      <span class="hljs-comment">// FP 和 FCP</span>
      <span class="hljs-attr">firstPaint</span>: paint.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.<span class="hljs-property">name</span> === <span class="hljs-string">'first-paint'</span>)?.<span class="hljs-property">startTime</span> || <span class="hljs-number">0</span>,
      <span class="hljs-attr">firstContentfulPaint</span>: paint.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.<span class="hljs-property">name</span> === <span class="hljs-string">'first-contentful-paint'</span>)?.<span class="hljs-property">startTime</span> || <span class="hljs-number">0</span>
    };
  }
  
  <span class="hljs-title function_">reportMetrics</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 上报性能数据到服务器</span>
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/performance'</span>, {
      <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>
      },
      <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span>)
    });
  }
}

<span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceMonitor</span>();
</code></pre>
<h4 data-id="heading-39">7.2 用户体验监控</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 监控用户交互延迟</span>
<span class="hljs-keyword">let</span> firstInputDelay;
<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousedown'</span>, storeEventTiming, {<span class="hljs-attr">once</span>: <span class="hljs-literal">true</span>});
<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keydown'</span>, storeEventTiming, {<span class="hljs-attr">once</span>: <span class="hljs-literal">true</span>});
<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'touchstart'</span>, storeEventTiming, {<span class="hljs-attr">once</span>: <span class="hljs-literal">true</span>});

<span class="hljs-keyword">function</span> <span class="hljs-title function_">storeEventTiming</span>(<span class="hljs-params">event</span>) {
  firstInputDelay = event.<span class="hljs-property">timeStamp</span> - performance.<span class="hljs-property">timing</span>.<span class="hljs-property">navigationStart</span>;
  
  <span class="hljs-comment">// 上报 FID 数据</span>
  <span class="hljs-keyword">if</span> (firstInputDelay &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-title function_">sendToAnalytics</span>({<span class="hljs-attr">metric</span>: <span class="hljs-string">'FID'</span>, <span class="hljs-attr">value</span>: firstInputDelay});
  }
}
</code></pre>
<h3 data-id="heading-40">第八章：现代优化技术</h3>
<h4 data-id="heading-41">8.1 Webpack 优化配置</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// webpack.prod.js</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">mode</span>: <span class="hljs-string">'production'</span>,
  <span class="hljs-attr">optimization</span>: {
    <span class="hljs-attr">splitChunks</span>: {
      <span class="hljs-attr">chunks</span>: <span class="hljs-string">'all'</span>,
      <span class="hljs-attr">cacheGroups</span>: {
        <span class="hljs-attr">vendor</span>: {
          <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/]/</span>,
          <span class="hljs-attr">name</span>: <span class="hljs-string">'vendors'</span>,
          <span class="hljs-attr">chunks</span>: <span class="hljs-string">'all'</span>,
        },
      },
    },
    <span class="hljs-attr">runtimeChunk</span>: <span class="hljs-string">'single'</span>,
  },
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompressionPlugin</span>({
      <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'gzip'</span>,
      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(js|css|html|svg)$/</span>,
      <span class="hljs-attr">threshold</span>: <span class="hljs-number">8192</span>,
      <span class="hljs-attr">minRatio</span>: <span class="hljs-number">0.8</span>,
    }),
  ],
};
</code></pre>
<h4 data-id="heading-42">8.2 Tree Shaking 优化</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 ES6 模块语法启用 Tree Shaking</span>
<span class="hljs-comment">// utils.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">utilityA</span>(<span class="hljs-params"/>) { <span class="hljs-comment">/* ... */</span> }
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">utilityB</span>(<span class="hljs-params"/>) { <span class="hljs-comment">/* ... */</span> }
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">utilityC</span>(<span class="hljs-params"/>) { <span class="hljs-comment">/* ... */</span> }

<span class="hljs-comment">// main.js - 只导入需要的函数</span>
<span class="hljs-keyword">import</span> { utilityA } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils'</span>;
<span class="hljs-title function_">utilityA</span>();
</code></pre>
<h4 data-id="heading-43">8.3 代码分割策略</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 路由级别的代码分割</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">Home</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-keyword">import</span>(<span class="hljs-string">'./views/Home.vue'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title function_">About</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-keyword">import</span>(<span class="hljs-string">'./views/About.vue'</span>);

<span class="hljs-keyword">const</span> routes = [
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">Home</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/about'</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">About</span> }
];

<span class="hljs-comment">// 条件加载</span>
<span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'development'</span>) {
  <span class="hljs-keyword">import</span>(<span class="hljs-string">'./dev-tools'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">devTools</span> =&gt;</span> {
    devTools.<span class="hljs-title function_">init</span>();
  });
}
</code></pre>
<h3 data-id="heading-44">第九章：性能测试与评估</h3>
<h4 data-id="heading-45">9.1 Lighthouse 自动化测试</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// lighthouse-config.js</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">extends</span>: <span class="hljs-string">'lighthouse:default'</span>,
  <span class="hljs-attr">settings</span>: {
    <span class="hljs-attr">onlyCategories</span>: [<span class="hljs-string">'performance'</span>, <span class="hljs-string">'accessibility'</span>, <span class="hljs-string">'best-practices'</span>],
    <span class="hljs-attr">throttlingMethod</span>: <span class="hljs-string">'simulate'</span>,
    <span class="hljs-attr">throttling</span>: {
      <span class="hljs-attr">rttMs</span>: <span class="hljs-number">40</span>,
      <span class="hljs-attr">throughputKbps</span>: <span class="hljs-number">10240</span>,
      <span class="hljs-attr">cpuSlowdownMultiplier</span>: <span class="hljs-number">1</span>
    }
  }
};

<span class="hljs-comment">// 自动化测试脚本</span>
<span class="hljs-keyword">const</span> lighthouse = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lighthouse'</span>);
<span class="hljs-keyword">const</span> chromeLauncher = <span class="hljs-built_in">require</span>(<span class="hljs-string">'chrome-launcher'</span>);

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">runLighthouse</span>(<span class="hljs-params">url</span>) {
  <span class="hljs-keyword">const</span> chrome = <span class="hljs-keyword">await</span> chromeLauncher.<span class="hljs-title function_">launch</span>({<span class="hljs-attr">chromeFlags</span>: [<span class="hljs-string">'--headless'</span>]});
  <span class="hljs-keyword">const</span> options = {<span class="hljs-attr">logLevel</span>: <span class="hljs-string">'info'</span>, <span class="hljs-attr">output</span>: <span class="hljs-string">'html'</span>, <span class="hljs-attr">port</span>: chrome.<span class="hljs-property">port</span>};
  <span class="hljs-keyword">const</span> runnerResult = <span class="hljs-keyword">await</span> <span class="hljs-title function_">lighthouse</span>(url, options);
  
  <span class="hljs-comment">// 输出报告</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Performance Score:'</span>, runnerResult.<span class="hljs-property">lhr</span>.<span class="hljs-property">categories</span>.<span class="hljs-property">performance</span>.<span class="hljs-property">score</span> * <span class="hljs-number">100</span>);
  
  <span class="hljs-keyword">await</span> chrome.<span class="hljs-title function_">kill</span>();
}
</code></pre>
<h4 data-id="heading-46">9.2 性能基准测试</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 Benchmark.js 进行性能测试</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Benchmark</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'benchmark'</span>);
<span class="hljs-keyword">const</span> suite = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Benchmark</span>.<span class="hljs-property">Suite</span>;

suite
  .<span class="hljs-title function_">add</span>(<span class="hljs-string">'RegExp#test'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-regexp">/o/</span>.<span class="hljs-title function_">test</span>(<span class="hljs-string">'Hello World!'</span>);
  })
  .<span class="hljs-title function_">add</span>(<span class="hljs-string">'String#indexOf'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-string">'Hello World!'</span>.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'o'</span>) &gt; -<span class="hljs-number">1</span>;
  })
  .<span class="hljs-title function_">on</span>(<span class="hljs-string">'cycle'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">String</span>(event.<span class="hljs-property">target</span>));
  })
  .<span class="hljs-title function_">on</span>(<span class="hljs-string">'complete'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Fastest is '</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-string">'fastest'</span>).<span class="hljs-title function_">map</span>(<span class="hljs-string">'name'</span>));
  })
  .<span class="hljs-title function_">run</span>({ <span class="hljs-string">'async'</span>: <span class="hljs-literal">true</span> });
</code></pre>
<h3 data-id="heading-47">第十章：案例分析与最佳实践</h3>
<h4 data-id="heading-48">10.1 电商网站性能优化案例</h4>
<p>某电商平台通过以下优化措施将首屏加载时间从 5.2 秒降低到 1.8 秒：</p>
<ol>
<li><strong>图片优化</strong>：采用 WebP 格式，实施懒加载</li>
<li><strong>资源压缩</strong>：JS/CSS 文件压缩率达 70%</li>
<li><strong>服务端渲染</strong>：关键内容 SSR，提升首屏渲染速度</li>
<li><strong>缓存策略</strong>：合理使用浏览器缓存和 CDN</li>
</ol>
<h4 data-id="heading-49">10.2 移动端新闻应用优化案例</h4>
<p>某新闻应用通过以下优化将平均页面加载时间从 3.5 秒降至 1.2 秒：</p>
<ol>
<li><strong>虚拟列表</strong>：长列表只渲染可视区域内容</li>
<li><strong>离线缓存</strong>：Service Worker 缓存关键资源</li>
<li><strong>骨架屏</strong>：提升用户感知加载速度</li>
<li><strong>字体优化</strong>：使用 font-display: swap</li>
</ol>
<h4 data-id="heading-50">10.3 单页应用性能优化清单</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## 加载阶段优化</span>
<span class="hljs-bullet">-</span> [ ] 实施代码分割和懒加载
<span class="hljs-bullet">-</span> [ ] 压缩和混淆 JS/CSS 资源
<span class="hljs-bullet">-</span> [ ] 优化图片资源格式和大小
<span class="hljs-bullet">-</span> [ ] 使用 CDN 分发静态资源
<span class="hljs-bullet">-</span> [ ] 启用 Gzip/Brotli 压缩
<span class="hljs-bullet">-</span> [ ] 实施合理的缓存策略

<span class="hljs-section">## 渲染阶段优化</span>
<span class="hljs-bullet">-</span> [ ] 避免强制同步布局
<span class="hljs-bullet">-</span> [ ] 减少重绘和重排
<span class="hljs-bullet">-</span> [ ] 使用 CSS3 硬件加速
<span class="hljs-bullet">-</span> [ ] 实施骨架屏或加载指示器
<span class="hljs-bullet">-</span> [ ] 优化字体加载策略

<span class="hljs-section">## 运行时优化</span>
<span class="hljs-bullet">-</span> [ ] 实施防抖和节流
<span class="hljs-bullet">-</span> [ ] 避免内存泄漏
<span class="hljs-bullet">-</span> [ ] 使用 Web Workers 处理密集计算
<span class="hljs-bullet">-</span> [ ] 优化事件处理器
<span class="hljs-bullet">-</span> [ ] 实施虚拟滚动

<span class="hljs-section">## 监控和维护</span>
<span class="hljs-bullet">-</span> [ ] 集成性能监控工具
<span class="hljs-bullet">-</span> [ ] 设置性能预算
<span class="hljs-bullet">-</span> [ ] 定期进行性能审计
<span class="hljs-bullet">-</span> [ ] 建立性能回归测试
</code></pre>
<h3 data-id="heading-51">结语</h3>
<p>前端性能优化是一个持续的过程，需要我们不断学习新技术、关注行业动态，并根据具体业务场景制定合适的优化策略。记住，优化的目标不仅仅是技术指标的提升，更重要的是为用户提供流畅、愉悦的使用体验。</p>
<p>成功的性能优化需要综合考虑多个方面：</p>
<ol>
<li><strong>测量先行</strong>：先了解现状，再制定优化方案</li>
<li><strong>用户导向</strong>：始终以用户体验为中心</li>
<li><strong>渐进优化</strong>：从小处着手，逐步改进</li>
<li><strong>持续监控</strong>：建立长期的性能保障机制</li>
</ol>
<p>随着 Web 技术的发展，新的优化技术和工具层出不穷。保持学习的心态，紧跟技术趋势，是每个前端工程师必备的素质。希望本文的内容能够帮助你在前端性能优化的道路上走得更远，创造出更好的用户体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[重生之我在浏览器里“蹦迪”]]></title>    <link>https://juejin.cn/post/7572115057222385699</link>    <guid>https://juejin.cn/post/7572115057222385699</guid>    <pubDate>2025-11-14T05:22:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572115057222385699" data-draft-id="7572092283720122420" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="重生之我在浏览器里“蹦迪”"/> <meta itemprop="keywords" content="前端,three.js,JavaScript"/> <meta itemprop="datePublished" content="2025-11-14T05:22:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CC码码"/> <meta itemprop="url" content="https://juejin.cn/user/3800389147179720"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            重生之我在浏览器里“蹦迪”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3800389147179720/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CC码码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T05:22:05.000Z" title="Fri Nov 14 2025 05:22:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是CC，在这里欢迎大家的到来～</p>
<p><strong>工作时机械麻木，蹦迪时欢乐激情，边工作边蹦迪，是怎样的呢？</strong></p>
<p>这个想法源于我初入职场时对于 3D 的好奇和蹦迪的憧憬，刷着网上的视频，想着不如实现自己的蹦迪主场。</p>
<h2 data-id="heading-0">蹦迪舞台</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvite-project-sepia-xi.vercel.app%2F%23%2Fabout%2FdjClub" target="_blank" title="https://vite-project-sepia-xi.vercel.app/#/about/djClub" ref="nofollow noopener noreferrer">预览地址</a></p>
<h2 data-id="heading-1">实现流程</h2>
<p>基于 Three.js 实现，整合舞动的人形模型、摇摆聚光灯、固定的点灯和嗨翻天的背景音乐。</p>
<h3 data-id="heading-2">创建 canvas</h3>
<pre><code class="hljs language-javascript" lang="javascript">&lt;template&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"djClub"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span></span>
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-3">添加三要素</h3>
<p>场景、相机、渲染器统称为 3D 场景下的三要素。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"djClub"</span>)

<span class="hljs-comment">// 场景</span>
scene = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scene</span>()
scene.<span class="hljs-property">background</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Color</span>(<span class="hljs-number">0xdcdcdc</span>)

<span class="hljs-comment">// 相机</span>
camera = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">35</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>)
camera.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">77.59014070493724</span>, <span class="hljs-number">27.281956522211484</span>, <span class="hljs-number">173.9190071215408</span>)

<span class="hljs-comment">// 渲染器</span>
renderer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebGLRenderer</span>({
    canvas,
    <span class="hljs-attr">antialias</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">alpha</span>: <span class="hljs-literal">true</span>,
})
renderer.<span class="hljs-property">shadowMap</span>.<span class="hljs-property">enabled</span> = <span class="hljs-literal">true</span>
renderer.<span class="hljs-property">shadowMap</span>.<span class="hljs-property">type</span> = <span class="hljs-title class_">PCFSoftShadowMap</span> <span class="hljs-comment">// 默认 PCFShadowMap // 阴影类型</span>
renderer.<span class="hljs-title function_">setClearColor</span>(<span class="hljs-number">0xffffff</span>)
renderer.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>)
renderer.<span class="hljs-title function_">setSize</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>)
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(renderer.<span class="hljs-property">domElement</span>)
</code></pre>
<h3 data-id="heading-4">添加素材</h3>
<p>素材包括房屋、草地、前后舞台和天花板。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 雾</span>
scene.<span class="hljs-property">fog</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Fog</span>(<span class="hljs-number">0xdcdcdc</span>, <span class="hljs-number">200</span>, <span class="hljs-number">1000</span>)
<span class="hljs-comment">// 创建纹理贴图加载器</span>
textureLoader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextureLoader</span>()
<span class="hljs-comment">// 添加长方体草地</span>
<span class="hljs-keyword">const</span> addGrassland = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BoxGeometry</span>(landSide, <span class="hljs-number">10</span>, landSide * <span class="hljs-number">2</span>)
    <span class="hljs-keyword">const</span> materials = [
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">MeshBasicMaterial</span>({ 
          <span class="hljs-attr">map</span>: textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-string">'/mesh/around.png'</span>),
          <span class="hljs-attr">side</span>: <span class="hljs-title class_">DoubleSide</span>
        }),
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">MeshBasicMaterial</span>({
          <span class="hljs-attr">map</span>: textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-string">'/mesh/around.png'</span>),
          <span class="hljs-attr">side</span>: <span class="hljs-title class_">DoubleSide</span>
        }),
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">MeshPhongMaterial</span>({
            <span class="hljs-attr">map</span>: textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-string">'/mesh/grasslight-big.jpg'</span>),
            <span class="hljs-attr">side</span>: <span class="hljs-title class_">DoubleSide</span>
        }),
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">MeshBasicMaterial</span>({
          <span class="hljs-attr">map</span>: textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-string">'/mesh/bottom.png'</span>),
          <span class="hljs-attr">side</span>: <span class="hljs-title class_">DoubleSide</span>
        }),
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">MeshBasicMaterial</span>({
          <span class="hljs-attr">map</span>: textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-string">'/mesh/around.png'</span>),
          <span class="hljs-attr">side</span>: <span class="hljs-title class_">DoubleSide</span>
        }),
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">MeshBasicMaterial</span>({
          <span class="hljs-attr">map</span>: textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-string">'/mesh/around.png'</span>),
          <span class="hljs-attr">side</span>: <span class="hljs-title class_">DoubleSide</span>
        }),
    ]
    grassland = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mesh</span>(geometry, materials)
    grassland.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = -<span class="hljs-number">5</span>
    grassland.<span class="hljs-property">name</span> = <span class="hljs-string">'grassland'</span>
    grassland.<span class="hljs-property">receiveShadow</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 开启接收阴影投影</span>
    scene.<span class="hljs-title function_">add</span>(grassland)
}

<span class="hljs-comment">// 添加前置舞台</span>
<span class="hljs-keyword">const</span> addFrontStage = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PlaneGeometry</span>(<span class="hljs-number">200</span>, <span class="hljs-number">60</span>)
    <span class="hljs-keyword">const</span> gt = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-string">'/mesh/front.png'</span>)
    <span class="hljs-keyword">const</span> materials = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MeshPhongMaterial</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">0xffffff</span>, <span class="hljs-attr">map</span>: gt, <span class="hljs-attr">side</span>: <span class="hljs-title class_">DoubleSide</span> })
    <span class="hljs-keyword">const</span> frontStage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mesh</span>(geometry, materials)
    frontStage.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>
    frontStage.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>
    frontStage.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">200</span>
    frontStage.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">30</span>
    scene.<span class="hljs-title function_">add</span>(frontStage)
}

<span class="hljs-comment">// 添加后置舞台</span>
<span class="hljs-keyword">const</span> addBackStage = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PlaneGeometry</span>(<span class="hljs-number">200</span>, <span class="hljs-number">60</span>)
    <span class="hljs-keyword">const</span> gt = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-string">'/mesh/back.png'</span>)
    <span class="hljs-keyword">const</span> materials = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MeshPhongMaterial</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">0xffffff</span>, <span class="hljs-attr">map</span>: gt, <span class="hljs-attr">side</span>: <span class="hljs-title class_">DoubleSide</span> })
    <span class="hljs-keyword">const</span> backStage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mesh</span>(geometry, materials)
    backStage.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>
    backStage.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = -<span class="hljs-number">200</span>
    backStage.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">30</span>
    scene.<span class="hljs-title function_">add</span>(backStage)
}

<span class="hljs-comment">// 添加左右墙壁</span>
<span class="hljs-keyword">const</span> addLeftRightStage = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PlaneGeometry</span>(<span class="hljs-number">400</span>, <span class="hljs-number">60</span>)
    <span class="hljs-keyword">const</span> gt = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-string">'/mesh/hardwood2_diffuse.jpg'</span>)
    <span class="hljs-keyword">const</span> materials = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MeshPhongMaterial</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">0xffffff</span>, <span class="hljs-attr">map</span>: gt, <span class="hljs-attr">side</span>: <span class="hljs-title class_">DoubleSide</span> })
    <span class="hljs-keyword">const</span> leftStage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mesh</span>(geometry, materials)
    leftStage.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>
    leftStage.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">100</span>
    leftStage.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">30</span>
    leftStage.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">0</span>
    scene.<span class="hljs-title function_">add</span>(leftStage)

    <span class="hljs-keyword">const</span> rightStage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mesh</span>(geometry, materials)
    rightStage.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>
    rightStage.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = -<span class="hljs-number">100</span>
    rightStage.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">30</span>
    rightStage.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">0</span>
    scene.<span class="hljs-title function_">add</span>(rightStage)
}

<span class="hljs-comment">// 添加天花板</span>
<span class="hljs-keyword">const</span> addUpStage = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PlaneGeometry</span>(<span class="hljs-number">400</span>, <span class="hljs-number">200</span>)
    <span class="hljs-keyword">const</span> gt = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-string">'/mesh/up.png'</span>)
    <span class="hljs-keyword">const</span> materials = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MeshPhongMaterial</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">0xffffff</span>, <span class="hljs-attr">map</span>: gt, <span class="hljs-attr">side</span>: <span class="hljs-title class_">DoubleSide</span> })
    <span class="hljs-keyword">const</span> frontStage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mesh</span>(geometry, materials)
    frontStage.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>
    frontStage.<span class="hljs-property">rotation</span>.<span class="hljs-property">z</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>
    frontStage.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">0</span>
    frontStage.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">60</span>
    scene.<span class="hljs-title function_">add</span>(frontStage)
}
</code></pre>
<h3 data-id="heading-5">加载人形模型蹦迪</h3>
<p>使用 Three.js 官网上的模型，且自带了一些动作。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 模型站位坐标数据</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> modelPosition = [
    {
        <span class="hljs-attr">path</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">z</span>: <span class="hljs-number">50</span>,
        <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,
    },
    {
        <span class="hljs-attr">path</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">z</span>: <span class="hljs-number">40</span>,
        <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,
    },
    {
        <span class="hljs-attr">path</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">z</span>: <span class="hljs-number">30</span>,
        <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,
    },
    {
        <span class="hljs-attr">path</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">z</span>: <span class="hljs-number">20</span>,
        <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,
    },
    {
        <span class="hljs-attr">path</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">z</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,
    },
    {
        <span class="hljs-attr">path</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">z</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,
    },
    {
        <span class="hljs-attr">path</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">z</span>: -<span class="hljs-number">10</span>,
        <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,
    },
    {
        <span class="hljs-attr">path</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">z</span>: -<span class="hljs-number">20</span>,
        <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,
    },
    {
        <span class="hljs-attr">path</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">z</span>: -<span class="hljs-number">30</span>,
        <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,
    },
    {
        <span class="hljs-attr">path</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">z</span>: -<span class="hljs-number">40</span>,
        <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,
    },
    {
        <span class="hljs-attr">path</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">x</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">z</span>: <span class="hljs-number">40</span>,
        <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,
    },
    {
        <span class="hljs-attr">path</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">x</span>: <span class="hljs-number">20</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">z</span>: <span class="hljs-number">30</span>,
        <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,
    },
    {
        <span class="hljs-attr">path</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">x</span>: <span class="hljs-number">30</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">z</span>: <span class="hljs-number">20</span>,
        <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,
    },
    {
        <span class="hljs-attr">path</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">x</span>: <span class="hljs-number">40</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">z</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,
    },
    {
        <span class="hljs-attr">path</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">x</span>: -<span class="hljs-number">40</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">z</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,
    },
    {
        <span class="hljs-attr">path</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">x</span>: -<span class="hljs-number">30</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">z</span>: <span class="hljs-number">20</span>,
        <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,
    },
    {
        <span class="hljs-attr">path</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">x</span>: -<span class="hljs-number">20</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">z</span>: <span class="hljs-number">30</span>,
        <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,
    },
    {
        <span class="hljs-attr">path</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">x</span>: -<span class="hljs-number">10</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">z</span>: <span class="hljs-number">40</span>,
        <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,
    },   
]
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 加载模型</span>
<span class="hljs-keyword">const</span> loadModels = <span class="hljs-keyword">function</span>(<span class="hljs-params">path: string</span>) {
    <span class="hljs-keyword">const</span> loader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FBXLoader</span>()
    loader.<span class="hljs-title function_">load</span>(path, <span class="hljs-function">(<span class="hljs-params">obj: any</span>) =&gt;</span> {

        obj.<span class="hljs-title function_">traverse</span>(<span class="hljs-function">(<span class="hljs-params">child : Mesh</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (child.<span class="hljs-property">isMesh</span>) {
                child.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span>
                child.<span class="hljs-property">receiveShadow</span> = <span class="hljs-literal">true</span>
            }
        })

        <span class="hljs-keyword">let</span> <span class="hljs-attr">models</span>: any[] = []

        modelPosition.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
            <span class="hljs-keyword">const</span> model1 = <span class="hljs-title class_">SkeletonUtils</span>.<span class="hljs-title function_">clone</span>(obj)
            <span class="hljs-keyword">const</span> mixer1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnimationMixer</span>(model1)
            mixer1.<span class="hljs-title function_">clipAction</span>(obj.<span class="hljs-property">animations</span>[<span class="hljs-number">0</span>]).<span class="hljs-title function_">play</span>()
            model1.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(item.<span class="hljs-property">x</span>, item.<span class="hljs-property">y</span>, item.<span class="hljs-property">z</span>)
            model1.<span class="hljs-property">scale</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0.08</span>, <span class="hljs-number">0.08</span>, <span class="hljs-number">0.08</span>)
            models.<span class="hljs-title function_">push</span>(model1)
            mixers.<span class="hljs-title function_">push</span>(mixer1)
        })
        scene.<span class="hljs-title function_">add</span>(...models)
    })
}
</code></pre>
<h3 data-id="heading-6">加载花式光源</h3>
<p>光源才是可以烘托气氛的，于是加了很多光源。</p>
<p>聚光灯是不断旋转角度的，还有一些固定点位的点光源起到微照明的作用。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 聚光灯光源信息坐标</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> spotLights = [
    {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'幕布左上角第一个'</span>,
        <span class="hljs-attr">spotLight</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-number">0xff0000</span>,
            <span class="hljs-attr">intensity</span>: <span class="hljs-number">100</span>,
            <span class="hljs-attr">distance</span>: <span class="hljs-number">200</span>,
            <span class="hljs-attr">angle</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">36</span>,
            <span class="hljs-attr">penumbra</span>: <span class="hljs-number">0.05</span>,
            <span class="hljs-attr">decay</span>: <span class="hljs-number">2</span>
        },
        <span class="hljs-attr">position</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">50</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">100</span>
        },
        <span class="hljs-attr">range</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">100</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">200</span>
        }
    },
    {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'幕布左上角第二个'</span>,
        <span class="hljs-attr">spotLight</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-number">0x54FF9F</span>,
            <span class="hljs-attr">intensity</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">distance</span>: <span class="hljs-number">200</span>,
            <span class="hljs-attr">angle</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">36</span>,
            <span class="hljs-attr">penumbra</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">decay</span>: <span class="hljs-number">2</span>
        },
        <span class="hljs-attr">position</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">25</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">100</span>
        },
        <span class="hljs-attr">range</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">100</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">200</span>
        }
    },
    {
        <span class="hljs-attr">spotLight</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-number">0x483D8B</span>,
            <span class="hljs-attr">intensity</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">distance</span>: <span class="hljs-number">200</span>,
            <span class="hljs-attr">angle</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">36</span>,
            <span class="hljs-attr">penumbra</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">decay</span>: <span class="hljs-number">2</span>
        },
        <span class="hljs-attr">position</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">100</span>
        },
        <span class="hljs-attr">range</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">100</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">200</span>
        }
    },
    {
        <span class="hljs-attr">spotLight</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-number">0x1E90FF</span>,
            <span class="hljs-attr">intensity</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">distance</span>: <span class="hljs-number">200</span>,
            <span class="hljs-attr">angle</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">36</span>,
            <span class="hljs-attr">penumbra</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">decay</span>: <span class="hljs-number">2</span>
        },
        <span class="hljs-attr">position</span>: {
            <span class="hljs-attr">x</span>: -<span class="hljs-number">25</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">100</span>
        },
        <span class="hljs-attr">range</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">100</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">200</span>
        }
    },
    {
        <span class="hljs-attr">spotLight</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-number">0xffff00</span>,
            <span class="hljs-attr">intensity</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">distance</span>: <span class="hljs-number">200</span>,
            <span class="hljs-attr">angle</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">36</span>,
            <span class="hljs-attr">penumbra</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">decay</span>: <span class="hljs-number">2</span>
        },
        <span class="hljs-attr">position</span>: {
            <span class="hljs-attr">x</span>: -<span class="hljs-number">50</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">100</span>
        },
        <span class="hljs-attr">range</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">100</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">200</span>
        }
    },
    {
        <span class="hljs-attr">spotLight</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-number">0x1E90FF</span>,
            <span class="hljs-attr">intensity</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">distance</span>: <span class="hljs-number">200</span>,
            <span class="hljs-attr">angle</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">36</span>,
            <span class="hljs-attr">penumbra</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">decay</span>: <span class="hljs-number">2</span>
        },
        <span class="hljs-attr">position</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">50</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">50</span>
        },
        <span class="hljs-attr">range</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">100</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">200</span>
        }
    },
    {
        <span class="hljs-attr">spotLight</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-number">0x1E90FF</span>,
            <span class="hljs-attr">intensity</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">distance</span>: <span class="hljs-number">200</span>,
            <span class="hljs-attr">angle</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">36</span>,
            <span class="hljs-attr">penumbra</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">decay</span>: <span class="hljs-number">2</span>
        },
        <span class="hljs-attr">position</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">50</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">0</span>
        },
        <span class="hljs-attr">range</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">100</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">200</span>
        }
    },
    {
        <span class="hljs-attr">spotLight</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-number">0xffff00</span>,
            <span class="hljs-attr">intensity</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">distance</span>: <span class="hljs-number">200</span>,
            <span class="hljs-attr">angle</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">36</span>,
            <span class="hljs-attr">penumbra</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">decay</span>: <span class="hljs-number">2</span>
        },
        <span class="hljs-attr">position</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">50</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: -<span class="hljs-number">50</span>
        },
        <span class="hljs-attr">range</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">100</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">200</span>
        }
    },
    {
        <span class="hljs-attr">spotLight</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-number">0xffff00</span>,
            <span class="hljs-attr">intensity</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">distance</span>: <span class="hljs-number">200</span>,
            <span class="hljs-attr">angle</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">36</span>,
            <span class="hljs-attr">penumbra</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">decay</span>: <span class="hljs-number">2</span>
        },
        <span class="hljs-attr">position</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">50</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: -<span class="hljs-number">100</span>
        },
        <span class="hljs-attr">range</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">100</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">200</span>
        }
    },
    {
        <span class="hljs-attr">spotLight</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-number">0x1E90FF</span>,
            <span class="hljs-attr">intensity</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">distance</span>: <span class="hljs-number">200</span>,
            <span class="hljs-attr">angle</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">36</span>,
            <span class="hljs-attr">penumbra</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">decay</span>: <span class="hljs-number">2</span>
        },
        <span class="hljs-attr">position</span>: {
            <span class="hljs-attr">x</span>: -<span class="hljs-number">50</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">50</span>
        },
        <span class="hljs-attr">range</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">100</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">200</span>
        }
    },
    {
        <span class="hljs-attr">spotLight</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-number">0x1E90FF</span>,
            <span class="hljs-attr">intensity</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">distance</span>: <span class="hljs-number">200</span>,
            <span class="hljs-attr">angle</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">36</span>,
            <span class="hljs-attr">penumbra</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">decay</span>: <span class="hljs-number">2</span>
        },
        <span class="hljs-attr">position</span>: {
            <span class="hljs-attr">x</span>: -<span class="hljs-number">50</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">0</span>
        },
        <span class="hljs-attr">range</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">100</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">200</span>
        }
    },
    {
        <span class="hljs-attr">spotLight</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-number">0xffff00</span>,
            <span class="hljs-attr">intensity</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">distance</span>: <span class="hljs-number">200</span>,
            <span class="hljs-attr">angle</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">36</span>,
            <span class="hljs-attr">penumbra</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">decay</span>: <span class="hljs-number">2</span>
        },
        <span class="hljs-attr">position</span>: {
            <span class="hljs-attr">x</span>: -<span class="hljs-number">50</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: -<span class="hljs-number">50</span>
        },
        <span class="hljs-attr">range</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">100</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">200</span>
        }
    },
    {
        <span class="hljs-attr">spotLight</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-number">0xffff00</span>,
            <span class="hljs-attr">intensity</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">distance</span>: <span class="hljs-number">200</span>,
            <span class="hljs-attr">angle</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">36</span>,
            <span class="hljs-attr">penumbra</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">decay</span>: <span class="hljs-number">2</span>
        },
        <span class="hljs-attr">position</span>: {
            <span class="hljs-attr">x</span>: -<span class="hljs-number">50</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: -<span class="hljs-number">100</span>
        },
        <span class="hljs-attr">range</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">100</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">200</span>
        }
    }
]
<span class="hljs-comment">// 点光源信息坐标</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> pointLights = [
    {
        <span class="hljs-attr">pointLight</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-number">0xFFF68F</span>,
            <span class="hljs-attr">intensity</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">distance</span>: <span class="hljs-number">200</span>,
            <span class="hljs-attr">decay</span>: <span class="hljs-number">10</span>
        },
        <span class="hljs-attr">position</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">37.5</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">55</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">180</span>
        }
    },
    {
        <span class="hljs-attr">pointLight</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-number">0xFFF68F</span>,
            <span class="hljs-attr">intensity</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">distance</span>: <span class="hljs-number">200</span>,
            <span class="hljs-attr">decay</span>: <span class="hljs-number">10</span>
        },
        <span class="hljs-attr">position</span>: {
            <span class="hljs-attr">x</span>: -<span class="hljs-number">37.5</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">55</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">180</span>
        }
    },
    {
        <span class="hljs-attr">pointLight</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-number">0xFFF68F</span>,
            <span class="hljs-attr">intensity</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">distance</span>: <span class="hljs-number">200</span>,
            <span class="hljs-attr">decay</span>: <span class="hljs-number">10</span>
        },
        <span class="hljs-attr">position</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">37.5</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">55</span>,
            <span class="hljs-attr">z</span>: -<span class="hljs-number">180</span>
        }
    },
    {
        <span class="hljs-attr">pointLight</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-number">0xFFF68F</span>,
            <span class="hljs-attr">intensity</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">distance</span>: <span class="hljs-number">200</span>,
            <span class="hljs-attr">decay</span>: <span class="hljs-number">10</span>
        },
        <span class="hljs-attr">position</span>: {
            <span class="hljs-attr">x</span>: -<span class="hljs-number">37.5</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">55</span>,
            <span class="hljs-attr">z</span>: -<span class="hljs-number">180</span>
        }
    },
    {
        <span class="hljs-attr">pointLight</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-number">0xFFF68F</span>,
            <span class="hljs-attr">intensity</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">distance</span>: <span class="hljs-number">200</span>,
            <span class="hljs-attr">decay</span>: <span class="hljs-number">10</span>
        },
        <span class="hljs-attr">position</span>: {
            <span class="hljs-attr">x</span>: <span class="hljs-number">60</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">55</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">0</span>
        }
    },
    {
        <span class="hljs-attr">pointLight</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-number">0xFFF68F</span>,
            <span class="hljs-attr">intensity</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">distance</span>: <span class="hljs-number">200</span>,
            <span class="hljs-attr">decay</span>: <span class="hljs-number">10</span>
        },
        <span class="hljs-attr">position</span>: {
            <span class="hljs-attr">x</span>: -<span class="hljs-number">60</span>,
            <span class="hljs-attr">y</span>: <span class="hljs-number">55</span>,
            <span class="hljs-attr">z</span>: <span class="hljs-number">0</span>
        }
    }
]
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 添加聚光灯</span>
<span class="hljs-keyword">const</span> addSpotLight = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    spotLights.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> spotLightRed = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpotLight</span>(item.<span class="hljs-property">spotLight</span>.<span class="hljs-property">color</span>, item.<span class="hljs-property">spotLight</span>.<span class="hljs-property">intensity</span>, item.<span class="hljs-property">spotLight</span>.<span class="hljs-property">distance</span>, item.<span class="hljs-property">spotLight</span>.<span class="hljs-property">angle</span>, item.<span class="hljs-property">spotLight</span>.<span class="hljs-property">penumbra</span>, item.<span class="hljs-property">spotLight</span>.<span class="hljs-property">decay</span>)
        spotLightRed.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(item.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>, item.<span class="hljs-property">position</span>.<span class="hljs-property">y</span>, item.<span class="hljs-property">position</span>.<span class="hljs-property">z</span>)
        spotLightRed.<span class="hljs-property">target</span> = grassland

        spotLightRed.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span>

        spotLightRed.<span class="hljs-property">shadow</span>.<span class="hljs-property">mapSize</span>.<span class="hljs-property">width</span> = <span class="hljs-number">1024</span>
        spotLightRed.<span class="hljs-property">shadow</span>.<span class="hljs-property">mapSize</span>.<span class="hljs-property">height</span> = <span class="hljs-number">1024</span>

        <span class="hljs-comment">// 设置计算阴影的区域，注意包裹对象的周围</span>
        spotLightRed.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">near</span> = <span class="hljs-number">1</span>
        spotLightRed.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">far</span> = <span class="hljs-number">300</span>
        spotLightRed.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">fov</span> = <span class="hljs-number">20</span>
        spotLightRed.<span class="hljs-property">shadow</span>.<span class="hljs-property">focus</span> = <span class="hljs-number">1</span>

        scene.<span class="hljs-title function_">add</span>(spotLightRed)
        spotObject.<span class="hljs-title function_">push</span>(spotLightRed)

        <span class="hljs-keyword">const</span> spotLightRedHelper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpotLightHelper</span>(spotLightRed)
        spotObjectHelper.<span class="hljs-title function_">push</span>(spotLightRedHelper)
    })
}

<span class="hljs-comment">// 聚光灯动画</span>
<span class="hljs-keyword">const</span> spotLightTween = <span class="hljs-keyword">function</span>(<span class="hljs-params">light: SpotLight, spot: any</span>) {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Tween</span>(light).<span class="hljs-title function_">to</span>({
        <span class="hljs-attr">angle</span>: (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">0.7</span>) + <span class="hljs-number">0.1</span>,
        <span class="hljs-attr">penumbra</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() + <span class="hljs-number">1</span>
    }, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">3000</span> + <span class="hljs-number">2000</span>).<span class="hljs-title function_">easing</span>(<span class="hljs-title class_">Easing</span>.<span class="hljs-property">Quadratic</span>.<span class="hljs-property">Out</span>).<span class="hljs-title function_">start</span>()

    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Tween</span>(light.<span class="hljs-property">position</span>).<span class="hljs-title function_">to</span>({
        <span class="hljs-attr">x</span>: (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * spot.<span class="hljs-property">range</span>.<span class="hljs-property">x</span>) * (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">100</span>) % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>),
        <span class="hljs-attr">y</span>: spot.<span class="hljs-property">range</span>.<span class="hljs-property">y</span>,
        <span class="hljs-attr">z</span>: (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * spot.<span class="hljs-property">range</span>.<span class="hljs-property">z</span>) * (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">100</span>) % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>)
    }, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">3000</span> + <span class="hljs-number">2000</span>).<span class="hljs-title function_">easing</span>(<span class="hljs-title class_">Easing</span>.<span class="hljs-property">Quadratic</span>.<span class="hljs-property">Out</span>).<span class="hljs-title function_">start</span>()
}

<span class="hljs-comment">// 多个聚光灯动画执行</span>
<span class="hljs-keyword">const</span> spotLightAnimate = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; spotLights.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-title function_">spotLightTween</span>(spotObject[i], spotLights[i])
    }
    <span class="hljs-built_in">setTimeout</span>(spotLightAnimate, <span class="hljs-number">1000</span>)
}

<span class="hljs-comment">// 添加点光源 灯泡</span>
<span class="hljs-keyword">const</span> addPointLight = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    pointLights.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
        <span class="hljs-keyword">let</span> pointLight = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PointLight</span>(item.<span class="hljs-property">pointLight</span>.<span class="hljs-property">color</span>, item.<span class="hljs-property">pointLight</span>.<span class="hljs-property">intensity</span>, item.<span class="hljs-property">pointLight</span>.<span class="hljs-property">distance</span>, item.<span class="hljs-property">pointLight</span>.<span class="hljs-property">decay</span>)
        pointLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(item.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>, item.<span class="hljs-property">position</span>.<span class="hljs-property">y</span>, item.<span class="hljs-property">position</span>.<span class="hljs-property">z</span>)
        scene.<span class="hljs-title function_">add</span>(pointLight)
    })
}
</code></pre>
<p>在调整光源时可以使用光源辅助线进行位置的调整。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 添加辅助线</span>
<span class="hljs-keyword">const</span> addHelper = <span class="hljs-keyword">function</span>(<span class="hljs-params">sunLight : DirectionalLight</span>) {
    <span class="hljs-comment">// 添加辅助线</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">gridHelper</span>: any = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GridHelper</span>(landSide, landSide);
    gridHelper.<span class="hljs-property">material</span>.<span class="hljs-property">opacity</span> = <span class="hljs-number">0</span>;
    gridHelper.<span class="hljs-property">material</span>.<span class="hljs-property">transparent</span> = <span class="hljs-literal">true</span>;
    scene.<span class="hljs-title function_">add</span>(gridHelper);
    <span class="hljs-comment">// 添加三维箭头坐标</span>
    <span class="hljs-comment">// X</span>
    <span class="hljs-keyword">let</span> dirX = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vector3</span>(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) <span class="hljs-comment">// 三维向量</span>
    dirX.<span class="hljs-title function_">normalize</span>()
    <span class="hljs-keyword">let</span> origin = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vector3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
    <span class="hljs-keyword">let</span> length = <span class="hljs-number">1</span>
    <span class="hljs-keyword">let</span> hexX = <span class="hljs-number">0xff0000</span>
    <span class="hljs-keyword">let</span> arrowHelperX = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrowHelper</span>(dirX, origin, length, hexX)
    scene.<span class="hljs-title function_">add</span>(arrowHelperX)
    <span class="hljs-comment">// Y</span>
    <span class="hljs-keyword">let</span> dirY = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vector3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0</span>) <span class="hljs-comment">// 三维向量</span>
    dirX.<span class="hljs-title function_">normalize</span>()
    <span class="hljs-keyword">let</span> hexY = <span class="hljs-number">0xffff00</span>
    <span class="hljs-keyword">let</span> arrowHelperY = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrowHelper</span>(dirY, origin, length, hexY)
    scene.<span class="hljs-title function_">add</span>(arrowHelperY)
    <span class="hljs-comment">// Z</span>
    <span class="hljs-keyword">let</span> dirZ = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vector3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>) <span class="hljs-comment">// 三维向量</span>
    dirZ.<span class="hljs-title function_">normalize</span>()
    <span class="hljs-keyword">let</span> hexZ = <span class="hljs-number">0x0000ff</span>
    <span class="hljs-keyword">let</span> arrowHelperZ = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrowHelper</span>(dirZ, origin, length, hexZ)
    scene.<span class="hljs-title function_">add</span>(arrowHelperZ)

    <span class="hljs-comment">// 简单模拟3个坐标轴的对象  红色代表 X 轴. 绿色代表 Y 轴. 蓝色代表 Z 轴</span>
    <span class="hljs-keyword">let</span> axesHelper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AxesHelper</span>(landSide / <span class="hljs-number">2</span>)
    scene.<span class="hljs-title function_">add</span>(axesHelper)

    <span class="hljs-comment">// 模拟相机视锥体的辅助对象</span>
    <span class="hljs-keyword">let</span> cameraHelper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CameraHelper</span>(sunLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>)
    scene.<span class="hljs-title function_">add</span>(cameraHelper)
}
</code></pre>
<h3 data-id="heading-7">添加播放嗨曲</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'dblclick'</span>, addMusic)

<span class="hljs-comment">// 添加音乐</span>
<span class="hljs-keyword">const</span> addMusic = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> listener = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AudioListener</span>()
    camera.<span class="hljs-title function_">add</span>(listener)

    <span class="hljs-keyword">let</span> sound = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PositionalAudio</span>(listener)

    <span class="hljs-keyword">let</span> audioLoader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AudioLoader</span>()
    audioLoader.<span class="hljs-title function_">load</span>(<span class="hljs-string">'/music/wavefile_short.mp3'</span>, <span class="hljs-function">(<span class="hljs-params">buffer: any</span>) =&gt;</span> {
        sound.<span class="hljs-title function_">setBuffer</span>(buffer)
        sound.<span class="hljs-title function_">setRefDistance</span>(<span class="hljs-number">100</span>)
        sound.<span class="hljs-title function_">play</span>()
    })
    <span class="hljs-keyword">const</span> sphere = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SphereGeometry</span>(<span class="hljs-number">20</span>, <span class="hljs-number">32</span>, <span class="hljs-number">16</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3.11645991236108</span>, <span class="hljs-number">6.283185307179586</span>, <span class="hljs-number">3.19185813604723</span>)
    <span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MeshPhongMaterial</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">0xffffff</span>, <span class="hljs-attr">side</span>: <span class="hljs-title class_">DoubleSide</span> })
    <span class="hljs-keyword">const</span> mesh = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mesh</span>(sphere, material)
    mesh.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-number">60</span>, <span class="hljs-number">0</span>)
    mesh.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>
    scene.<span class="hljs-title function_">add</span>(mesh)
    grassland.<span class="hljs-title function_">add</span>(sound)

    <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'dblclick'</span>, addMusic)
}
</code></pre>
<h3 data-id="heading-8">蹦起来</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建时钟</span>
clock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Clock</span>()

<span class="hljs-comment">// 渲染</span>
<span class="hljs-keyword">const</span> render = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    stats.<span class="hljs-title function_">begin</span>()
    
    <span class="hljs-keyword">let</span> delta = clock.<span class="hljs-title function_">getDelta</span>()
    <span class="hljs-comment">// 模型动画的执行更新</span>
    <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">const</span> mixer <span class="hljs-keyword">of</span> mixers ) mixer.<span class="hljs-title function_">update</span>(delta)
    renderer.<span class="hljs-title function_">render</span>(scene, camera)
    <span class="hljs-variable constant_">TWEEN</span>.<span class="hljs-title function_">update</span>()
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; spotObjectHelper.<span class="hljs-property">length</span>; i++) {
        spotObjectHelper[i].<span class="hljs-title function_">update</span>()
    }
  
    stats.<span class="hljs-title function_">end</span>()
    <span class="hljs-title function_">requestAnimationFrame</span>(render)
}
</code></pre>
<h3 data-id="heading-9">性能监控</h3>
<p>3D 场景下对浏览器和电脑的性能要求更高，可以通过性能监控判断来进行优化。</p>
<p>依赖于 stats.js，在 render 时进行进行监听。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Stats</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'stats.js'</span>

<span class="hljs-comment">// 性能监视器</span>
<span class="hljs-keyword">const</span> loadStats = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  stats = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stats</span>()
  stats.<span class="hljs-title function_">showPanel</span>(<span class="hljs-number">0</span>) <span class="hljs-comment">// 0: fps, 1: ms, 2: mb, 3+: custom</span>
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(stats.<span class="hljs-property">dom</span>)
}

<span class="hljs-keyword">const</span> render = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  stats.<span class="hljs-title function_">begin</span>()
  <span class="hljs-comment">// 监听内容代码...</span>
  stats.<span class="hljs-title function_">end</span>()
  <span class="hljs-title function_">requestAnimationFrame</span>(render)
}
</code></pre>
<h3 data-id="heading-10">尽善尽美</h3>
<p>页面响应式才可以有更好的体验。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">onWindowResize</span>(), <span class="hljs-literal">false</span>)

<span class="hljs-comment">// 响应式</span>
<span class="hljs-keyword">const</span> onWindowResize = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    renderer.<span class="hljs-title function_">setSize</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>)
    camera.<span class="hljs-property">aspect</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>
    camera.<span class="hljs-title function_">updateProjectionMatrix</span>()
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文搞懂 CSS 定位：relative、absolute、fixed、sticky]]></title>    <link>https://juejin.cn/post/7572141390857240576</link>    <guid>https://juejin.cn/post/7572141390857240576</guid>    <pubDate>2025-11-14T05:27:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572141390857240576" data-draft-id="7572099468247924771" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文搞懂 CSS 定位：relative、absolute、fixed、sticky"/> <meta itemprop="keywords" content="前端,CSS"/> <meta itemprop="datePublished" content="2025-11-14T05:27:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="烟袅"/> <meta itemprop="url" content="https://juejin.cn/user/1845419006243504"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文搞懂 CSS 定位：relative、absolute、fixed、sticky
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1845419006243504/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    烟袅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T05:27:15.000Z" title="Fri Nov 14 2025 05:27:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在前端开发中，CSS 的 <code>position</code> 属性是布局的核心之一。理解不同定位方式的原理和使用场景，能让你轻松应对各种页面布局需求。</p>
<p>今天我们就来梳理一下常见的几种定位方式：<code>relative</code>、<code>absolute</code>、<code>fixed</code> 和 <code>sticky</code>，以及它们与文档流的关系。</p>
<hr/>
<h2 data-id="heading-0">🌐 什么是文档流？</h2>
<p>文档流是 HTML 元素默认的布局方式：</p>
<ul>
<li>块级元素垂直排列</li>
<li>行内元素水平排列</li>
<li>遵循从上到下、从左到右的自然顺序</li>
</ul>
<p>当一个元素脱离了文档流，它不再占据原来的位置，后面的元素会“填补”它的空间。</p>
<hr/>
<h2 data-id="heading-1">🔹 1. <code>position: relative</code> —— 相对定位</h2>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">position</span>: relative;
</code></pre>
<ul>
<li><strong>相对于自身原本位置进行偏移</strong></li>
<li><strong>不会脱离文档流</strong>，原位置依然保留</li>
<li>后续元素仍按标准流布局</li>
</ul>
<blockquote>
<p>✅ 适用于需要微调位置但不破坏布局的场景，比如配合 <code>top/bottom/left/right</code> 调整元素位置。</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">🔹 2. <code>position: absolute</code> —— 绝对定位</h2>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">position</span>: absolute;
</code></pre>
<ul>
<li><strong>脱离文档流</strong>，不再占据空间</li>
<li>相对于最近的 <strong>拥有定位属性的父元素</strong> 定位</li>
<li>如果父元素没有定位，则以 <code>body</code> 或最近非 <code>static</code> 的祖先为参考</li>
</ul>
<blockquote>
<p>⚠️ 使用时注意：绝对定位的元素会“漂浮”在其他元素之上，需谨慎控制层级（z-index）。</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">🔹 3. <code>position: fixed</code> —— 固定定位</h2>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">position</span>: fixed;
</code></pre>
<ul>
<li><strong>以浏览器窗口为参照物</strong></li>
<li><strong>脱离文档流</strong></li>
<li>滚动页面时，元素位置固定不变</li>
</ul>
<blockquote>
<p>✅ 常用于顶部导航栏、侧边栏等需要“固定显示”的组件。</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">🔹 4. <code>position: sticky</code> —— 粘性定位</h2>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">position</span>: sticky;
</code></pre>
<ul>
<li><strong>结合 relative 和 fixed 的特性</strong></li>
<li>默认行为像 <code>relative</code></li>
<li>当滚动到指定阈值（如 <code>top: 0</code>）时，变为 <code>fixed</code>，固定在视口某处</li>
</ul>
<blockquote>
<p>💡 例如：粘性标题、悬浮菜单，用户体验更友好。</p>
</blockquote>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.sticky-header</span> {
  <span class="hljs-attribute">position</span>: sticky;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;
}
</code></pre>
<hr/>
<h2 data-id="heading-5">🔹 5. <code>position: static</code> —— 静态定位（默认）</h2>
<pre><code class="hljs language-arduino" lang="arduino">position: <span class="hljs-type">static</span>; <span class="hljs-comment">/* 默认值 */</span>
</code></pre>
<ul>
<li>元素按照正常文档流布局</li>
<li><code>top</code>、<code>bottom</code>、<code>left</code>、<code>right</code> 无效</li>
<li>一般不需要显式声明，除非要重置定位</li>
</ul>
<hr/>
<h2 data-id="heading-6">🧩 总结对比表</h2>









































<table><thead><tr><th>定位方式</th><th>是否脱离文档流</th><th>参考对象</th><th>适用场景</th></tr></thead><tbody><tr><td><code>relative</code></td><td>❌ 不脱离</td><td>自身原始位置</td><td>微调位置</td></tr><tr><td><code>absolute</code></td><td>✅ 脱离</td><td>最近定位父元素或 body</td><td>弹窗、遮罩层</td></tr><tr><td><code>fixed</code></td><td>✅ 脱离</td><td>浏览器窗口</td><td>固定导航、悬浮按钮</td></tr><tr><td><code>sticky</code></td><td>部分脱离</td><td>视口 + 文档流</td><td>粘性头部、侧边栏</td></tr><tr><td><code>static</code></td><td>❌ 不脱离</td><td>无</td><td>默认状态，无需设置</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-7">✅ 小贴士</h2>
<ul>
<li>使用 <code>absolute</code> 时，记得给父容器设置 <code>position: relative</code>，避免定位混乱。</li>
<li><code>sticky</code> 需要设置 <code>top</code>/<code>bottom</code> 等属性才生效。</li>
<li><code>display: none</code> 会隐藏元素且<strong>不占空间</strong>，与定位无关，但常被混淆。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Trae 推出 Solo 模式：AI 开发的“一人一项目”时代来了？]]></title>    <link>https://juejin.cn/post/7572161976592924724</link>    <guid>https://juejin.cn/post/7572161976592924724</guid>    <pubDate>2025-11-14T05:31:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572161976592924724" data-draft-id="7572115057222451235" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Trae 推出 Solo 模式：AI 开发的“一人一项目”时代来了？"/> <meta itemprop="keywords" content="前端,人工智能,Solo"/> <meta itemprop="datePublished" content="2025-11-14T05:31:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="烟袅"/> <meta itemprop="url" content="https://juejin.cn/user/1845419006243504"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Trae 推出 Solo 模式：AI 开发的“一人一项目”时代来了？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1845419006243504/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    烟袅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T05:31:42.000Z" title="Fri Nov 14 2025 05:31:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>“产品经理找程序员写原型？不需要了。产品经理就是程序员。”</p>
</blockquote>
<p>最近，AI 开发平台 <strong>Trae</strong> 正式推出了全新功能 —— <strong>Solo 模式</strong>，彻底重构了传统软件开发流程。它不再只是“代码生成器”，而是进化为一个<strong>全栈 AI 开发工程师</strong>，从需求到交付，全程高能。</p>
<p>这不仅是工具的升级，更是一场<strong>开发范式的革命</strong>。</p>
<hr/>
<h2 data-id="heading-0">🚀 什么是 Solo 模式？</h2>
<p><strong>Solo 模式</strong> 是 Trae 提出的全新 AI 驱动开发范式，旨在打造<strong>沉浸式的智能开发体验</strong>。</p>
<p>你可以把它理解为：<br/>
👉 <strong>你只需提出一个想法，AI 就能独立完成从需求分析、产品设计、UI 构建、状态管理、API 对接、数据库设计、测试到部署的全过程。</strong></p>
<p>换句话说：</p>
<blockquote>
<p>✅ 只需一句话，就能让 AI 从零构建一个完整网站或应用。</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">💡 为什么叫“Solo”？</h2>
<p>因为——<strong>一个人，一个想法，就能启动一个项目</strong>。</p>
<p>过去，一个产品上线需要：</p>
<ul>
<li>产品经理写 PRD</li>
<li>UI 设计师出稿</li>
<li>前后端开发协作</li>
<li>测试、运维跟进</li>
</ul>
<p>而现在，<strong>你只需要提出需求，剩下的交给 AI 完成</strong>。</p>
<hr/>
<h2 data-id="heading-2">🎯 实战演示：用 Solo 模式创建“绘本岛”</h2>
<p>我们来试试看，如何用 Trae 的 Solo 模式，快速搭建一个名为 <strong>“绘本岛”</strong> 的亲子阅读网站。</p>
<h3 data-id="heading-3">第一步：提出需求</h3>
<pre><code class="hljs language-diff" lang="diff">创建一个名为“绘本岛”的亲子阅读网站。
品牌调性：温馨、童趣、色彩明亮。
核心功能：
<span class="hljs-deletion">- 用户注册/登录</span>
<span class="hljs-deletion">- 分类浏览绘本（按年龄、主题）</span>
<span class="hljs-deletion">- 在线阅读（支持翻页动画）</span>
<span class="hljs-deletion">- 收藏与分享</span>
<span class="hljs-deletion">- 每日推荐</span>
视觉风格：扁平化 + 卡通插画风，主色调为蓝色和橙色。
</code></pre>
<blockquote>
<p>👉 这些信息就像你在跟一位全能的 AI 工程师对话。</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">第二步：AI 自动生成完整方案</h3>
<p>Trae 的 Solo 模式会自动完成以下步骤：</p>
<ol>
<li><strong>生成 PRD（产品需求文档）</strong></li>
<li><strong>输出设计稿（含交互逻辑）</strong></li>
<li><strong>产出技术方案（前端架构 + 后端接口设计）</strong></li>
<li><strong>自动生成数据库结构（如用户表、绘本表、收藏表）</strong></li>
<li><strong>编写前端代码（React/Vue + Tailwind）</strong></li>
<li><strong>搭建 API 服务（Node.js 或 Python）</strong></li>
<li><strong>配置测试用例</strong></li>
<li><strong>一键部署至云环境</strong></li>
</ol>
<blockquote>
<p>⚡️ 所有过程无需人工干预，AI 自动规划、分步执行。</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">第三步：一键启动</h3>
<p>点击「启动项目」按钮，整个系统自动运行，<strong>几分钟内即可看到可交互的原型页面</strong>。</p>
<p>你甚至可以：</p>
<ul>
<li>直接在浏览器中预览</li>
<li>修改文案或样式</li>
<li>快速迭代功能</li>
</ul>
<blockquote>
<p>🌐 从此，<strong>非技术人员也能拥有自己的产品原型</strong>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-6">🔁 传统流程 vs. Solo 模式对比</h2>



































<table><thead><tr><th>环节</th><th>传统方式</th><th>Solo 模式</th></tr></thead><tbody><tr><td>需求沟通</td><td>多方协调，耗时长</td><td>一次输入，AI 理解并执行</td></tr><tr><td>原型设计</td><td>UI 设计师手绘 → 评审 → 修改</td><td>AI 自动生成交互原型</td></tr><tr><td>技术方案</td><td>开发团队讨论 → 写文档</td><td>AI 输出完整技术架构</td></tr><tr><td>代码实现</td><td>手动编码，易出错</td><td>AI 编写高质量代码</td></tr><tr><td>部署上线</td><td>手动部署，依赖运维</td><td>一键部署，自动完成</td></tr></tbody></table>
<blockquote>
<p>✅ <strong>效率提升 10 倍以上，成本近乎归零。</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-7">🤔 谁会受益？</h2>
<ul>
<li><strong>产品经理</strong>：不用再找程序员写 demo，自己就能验证想法。</li>
<li><strong>创业者</strong>：快速验证 MVP，降低试错成本。</li>
<li><strong>非技术人员</strong>：轻松实现创意落地。</li>
<li><strong>开发者</strong>：专注复杂业务逻辑，不再重复造轮子。</li>
</ul>
<blockquote>
<p>💡 未来，<strong>人人都是产品经理，人人都是开发者</strong>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-8">🔮 未来展望：AI Development，不只是 AI Coding</h2>
<p>Trae 的目标是实现 <strong>AI Development（整体系统构建）</strong> ，而不仅仅是 <strong>AI Coding（代码生成）</strong> 。</p>
<p>这意味着：</p>
<ul>
<li>AI 不再是辅助工具</li>
<li>而是<strong>主导开发流程的智能体</strong></li>
<li>编辑器、终端、文档、浏览器……全部整合进 AI 工作流</li>
</ul>
<blockquote>
<p>🌐 我们正在进入一个“AI 主导开发”的新时代。</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">✅ 总结</h2>
<p>Trae 的 <strong>Solo 模式</strong>，不是一次功能更新，而是一次<strong>开发模式的颠覆</strong>。</p>
<p>它让我们看到：</p>
<ul>
<li>未来的开发，可能是“提需求 → 等结果”</li>
<li>产品的边界，将由想法决定，而非资源限制</li>
</ul>
<blockquote>
<p>🚀 <strong>当你还在写 PRD 时，别人已经用 AI 把产品跑起来了。</strong></p>
</blockquote>
<hr/>
<p>📌 <strong>如果你也想体验这种“一人一项目”的开发快感，不妨关注 Trae 的官方动态，第一时间尝鲜 Solo 模式！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Canvas绘图基础：坐标、线条与圆形的艺术]]></title>    <link>https://juejin.cn/post/7572138663120601130</link>    <guid>https://juejin.cn/post/7572138663120601130</guid>    <pubDate>2025-11-14T05:46:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572138663120601130" data-draft-id="7569871848793227283" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Canvas绘图基础：坐标、线条与圆形的艺术"/> <meta itemprop="keywords" content="前端,HTML"/> <meta itemprop="datePublished" content="2025-11-14T05:46:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BBB努力学习程序设计"/> <meta itemprop="url" content="https://juejin.cn/user/3097787706900985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Canvas绘图基础：坐标、线条与圆形的艺术
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097787706900985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BBB努力学习程序设计
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T05:46:53.000Z" title="Fri Nov 14 2025 05:46:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;color:#282d36}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px;color:#2f845e}.markdown-body h2{font-size:22px;display:inline-block;font-weight:700;background:#2f845e;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(47,132,194,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 32px);border-bottom:3px solid #2f845e}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%;box-shadow:6px 6px 6px #888}.markdown-body hr{border:none;border-top:1px solid rgba(66,185,131,.15);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:16px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#262626;border:1px solid #2f845e;border-top:8px solid #2f845e;background:linear-gradient(180deg,rgba(66,185,131,.1),transparent)!important}.markdown-body pre&gt;code.hljs[lang]:before{top:8px!important;color:#2f845e!important}.markdown-body pre&gt;code.language-awesome_error{border:1px solid #ff4d4f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ff4d4f!important;background:#fff2f0!important}.markdown-body pre&gt;code.language-awesome_error:before{content:"!"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ff4d4f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_warn{border:1px solid #ffc46f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ffc46f!important;background:#fffbe6!important}.markdown-body pre&gt;code.language-awesome_warn:before{content:"☂"!important;position:absolute;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ffc46f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_success{border:1px solid #52c41a!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#52c41a!important;background:#f6ffed!important}.markdown-body pre&gt;code.language-awesome_success:before{content:"✓"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#52c41a!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_info{border:1px solid #1890ff!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#1890ff!important;background:#e6f7ff!important}.markdown-body pre&gt;code.language-awesome_info:before{content:"i"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#1890ff!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body strong{background-color:inherit;color:#2f845e}.markdown-body em{background-color:inherit;color:#949415}.markdown-body a{text-decoration:none;color:#2f8e54;border-bottom:1px solid #3f9e64}.markdown-body a:active,.markdown-body a:hover{color:#3f9e64}.markdown-body a[class^=footnote]{margin-left:4px}.markdown-body a:before{content:"➤ "}.markdown-body table{font-size:12px;width:100%;max-width:100%;overflow:auto;border:2px solid #2f8e54}.markdown-body thead{background:#2f8e54;color:#fff;text-align:left;font-weight:700}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:22px}.markdown-body td{min-width:120px}.markdown-body blockquote{padding:1px 22px;margin:22px 0;border-left:6px solid #2f845e;background-color:rgba(66,185,131,.1);border-radius:2px}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#2f845e}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px;color:#282d36}.markdown-body del{color:#2f845e}.markdown-body input[type=checkbox]:checked:before{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/klEQVQ4T72TMU7DQBBF318XdFR06egQEnAXRINEGlqgowoIR8AF4AZOZ4JEGq5AC5EixBU4A55BNrEVHAcSBTHlaubt37/zxZKlcn7n6mDPXJvz8IJ89HzWu8t7C8D2dfsY52ae4apHnLx0ktsCsHXZjiUuFgG40x2eJ/H/AhztB+zDUTpLwWj8jGkzxSHiHaMPrDQC8sMoilKzLAUqiKQjmb+ZuAdW80tmelCHODoNgSfP7AFprTTaRTzsJN1GEyuIZ7uW6TEEHwCtyV/6EVBKJHhfzgC0Xv/iXwEFBF4FG0378bd7sPQq5xK/hSnk6sdlX3mZrKkwLZKBeu8n9XuWEUE7X+YAAAAASUVORK5CYII=);position:relative;top:-1px;left:-1px}.markdown-body .math .katex{font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}@media (max-width:720px){.markdown-body h1{font-size:22px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在Canvas绘图的世界里，理解坐标系统是绘制一切图形的基础。就像在地图上找位置需要经纬度一样，在Canvas中绘制图形也需要精确的坐标定位。今天，我们将深入探索Canvas的坐标系统，并学习如何利用这个系统绘制线条和圆形——这两种构成复杂图形的基本元素。</p>
<h2 data-id="heading-0">Canvas坐标系统</h2>
<h3 data-id="heading-1">基本概念</h3>
<p>Canvas使用基于<strong>左上角</strong>的二维笛卡尔坐标系，这与我们数学中常见的坐标系有所不同：</p>
<ul>
<li><strong>原点(0,0)</strong> ：位于画布的左上角</li>
<li><strong>X轴</strong>：向右为正方向</li>
<li><strong>Y轴</strong>：向下为正方向</li>
</ul>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Canvas坐标系统演示<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">canvas</span> {
            <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#333</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#f9f9f9</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"coordinateCanvas"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"600"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'coordinateCanvas'</span>);
        <span class="hljs-keyword">const</span> ctx = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'2d'</span>);
        
        <span class="hljs-comment">// 绘制坐标轴</span>
        ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">'#333'</span>;
        ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">1</span>;
        
        <span class="hljs-comment">// X轴</span>
        ctx.<span class="hljs-title function_">beginPath</span>();
        ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">0</span>, <span class="hljs-number">200</span>);
        ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">600</span>, <span class="hljs-number">200</span>);
        ctx.<span class="hljs-title function_">stroke</span>();
        
        <span class="hljs-comment">// Y轴</span>
        ctx.<span class="hljs-title function_">beginPath</span>();
        ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">300</span>, <span class="hljs-number">0</span>);
        ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">300</span>, <span class="hljs-number">400</span>);
        ctx.<span class="hljs-title function_">stroke</span>();
        
        <span class="hljs-comment">// 标记原点</span>
        ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'red'</span>;
        ctx.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">298</span>, <span class="hljs-number">198</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>);
        ctx.<span class="hljs-title function_">fillText</span>(<span class="hljs-string">'原点 (0,0)'</span>, <span class="hljs-number">310</span>, <span class="hljs-number">190</span>);
        
        <span class="hljs-comment">// 标记坐标点示例</span>
        ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'blue'</span>;
        ctx.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>); <span class="hljs-comment">// 点(100,100)</span>
        ctx.<span class="hljs-title function_">fillText</span>(<span class="hljs-string">'(100,100)'</span>, <span class="hljs-number">110</span>, <span class="hljs-number">90</span>);
        
        ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'green'</span>;
        ctx.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">400</span>, <span class="hljs-number">300</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>); <span class="hljs-comment">// 点(400,300)</span>
        ctx.<span class="hljs-title function_">fillText</span>(<span class="hljs-string">'(400,300)'</span>, <span class="hljs-number">410</span>, <span class="hljs-number">290</span>);
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h2 data-id="heading-2">绘制线条</h2>
<h3 data-id="heading-3">基本语法</h3>
<p>绘制线条需要使用<strong>路径(Path)</strong>  API，遵循以下步骤：</p>
<ol>
<li><code>beginPath()</code> - 开始新路径</li>
<li><code>moveTo(x, y)</code> - 移动到起点</li>
<li><code>lineTo(x, y)</code> - 绘制到终点</li>
<li><code>stroke()</code> - 描边路径</li>
</ol>
<h4 data-id="heading-4">线条样式属性：</h4>



































<table><thead><tr><th>属性名</th><th>说明</th><th>可选值/示例</th></tr></thead><tbody><tr><td><code>lineWidth</code></td><td>设置线条的宽度（单位：像素）</td><td><code>3</code>、<code>5</code>、<code>10</code></td></tr><tr><td><code>strokeStyle</code></td><td>设置线条的颜色或样式</td><td><code>'red'</code>、<code>'#ff0000'</code>、<code>'rgba(255,0,0,0.5)'</code></td></tr><tr><td><code>lineCap</code></td><td>设置线条末端的样式</td><td><code>'butt'</code>（平直）、<code>'round'</code>（圆形）、<code>'square'</code>（方形）</td></tr><tr><td><code>lineJoin</code></td><td>设置两条线段连接处的样式</td><td><code>'miter'</code>（尖角）、<code>'round'</code>（圆角）、<code>'bevel'</code>（斜角）</td></tr><tr><td><code>setLineDash()</code></td><td>设置虚线模式</td><td><code>[5, 3]</code>（5px实线，3px空白）</td></tr></tbody></table>
<h2 data-id="heading-5">绘制圆形和圆弧</h2>
<h3 data-id="heading-6">基本语法</h3>
<p>Canvas使用<code>arc()</code>方法绘制圆形和圆弧：</p>
<pre><code class="hljs language-javascript" lang="javascript">ctx.<span class="hljs-title function_">arc</span>(x, y, radius, startAngle, endAngle, anticlockwise);
</code></pre>
<h4 data-id="heading-7">属性说明：</h4>








































<table><thead><tr><th>参数名</th><th>说明</th><th>例子</th></tr></thead><tbody><tr><td><code>x</code></td><td>圆心的X坐标</td><td><code>100</code></td></tr><tr><td><code>y</code></td><td>圆心的Y坐标</td><td><code>150</code></td></tr><tr><td><code>radius</code></td><td>圆的半径</td><td><code>50</code></td></tr><tr><td><code>startAngle</code></td><td>起始角度（弧度制）</td><td><code>0</code></td></tr><tr><td><code>endAngle</code></td><td>结束角度（弧度制）</td><td><code>Math.PI * 2</code></td></tr><tr><td><code>anticlockwise</code></td><td>绘制方向</td><td><code>false</code></td></tr></tbody></table>
<h3 data-id="heading-8">角度与弧度转换</h3>
<p>Canvas使用<strong>弧度制</strong>而非角度制：</p>
<ul>
<li>180° = π 弧度</li>
<li>360° = 2π 弧度</li>
<li>转换公式：<code>弧度 = 角度 * (Math.PI / 180)</code></li>
</ul>
<h4 data-id="heading-9">代码示例：绘制完整圆形，圆形边框，半圆，四分之一圆，复杂圆弧（扇形），使用arcTo绘制圆角</h4>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Canvas圆形绘制<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">canvas</span> {
            <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#333</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"circleCanvas"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"600"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'circleCanvas'</span>);
        <span class="hljs-keyword">const</span> ctx = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'2d'</span>);
        
        <span class="hljs-comment">// 示例1：绘制完整圆形（填充）</span>
        ctx.<span class="hljs-title function_">beginPath</span>();
        ctx.<span class="hljs-title function_">arc</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">60</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>); <span class="hljs-comment">// 完整圆形</span>
        ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'rgba(52, 152, 219, 0.7)'</span>;
        ctx.<span class="hljs-title function_">fill</span>();
        
        <span class="hljs-comment">// 示例2：绘制圆形边框</span>
        ctx.<span class="hljs-title function_">beginPath</span>();
        ctx.<span class="hljs-title function_">arc</span>(<span class="hljs-number">250</span>, <span class="hljs-number">100</span>, <span class="hljs-number">60</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>);
        ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">'#e74c3c'</span>;
        ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">5</span>;
        ctx.<span class="hljs-title function_">stroke</span>();
        
        <span class="hljs-comment">// 示例3：绘制半圆</span>
        ctx.<span class="hljs-title function_">beginPath</span>();
        ctx.<span class="hljs-title function_">arc</span>(<span class="hljs-number">400</span>, <span class="hljs-number">100</span>, <span class="hljs-number">60</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>); <span class="hljs-comment">// 0到π = 180度</span>
        ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'#2ecc71'</span>;
        ctx.<span class="hljs-title function_">fill</span>();
        
        <span class="hljs-comment">// 示例4：绘制四分之一圆</span>
        ctx.<span class="hljs-title function_">beginPath</span>();
        ctx.<span class="hljs-title function_">arc</span>(<span class="hljs-number">100</span>, <span class="hljs-number">250</span>, <span class="hljs-number">60</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>); <span class="hljs-comment">// 0到π/2 = 90度</span>
        ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">'#f39c12'</span>;
        ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">5</span>;
        ctx.<span class="hljs-title function_">stroke</span>();
        
        <span class="hljs-comment">// 示例5：绘制复杂圆弧（扇形）</span>
        ctx.<span class="hljs-title function_">beginPath</span>();
        ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">250</span>, <span class="hljs-number">250</span>); <span class="hljs-comment">// 移动到圆心</span>
        ctx.<span class="hljs-title function_">arc</span>(<span class="hljs-number">250</span>, <span class="hljs-number">250</span>, <span class="hljs-number">60</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">4</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">1.5</span>); <span class="hljs-comment">// 45度到270度</span>
        ctx.<span class="hljs-title function_">closePath</span>(); <span class="hljs-comment">// 连接回圆心形成扇形</span>
        ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'rgba(155, 89, 182, 0.7)'</span>;
        ctx.<span class="hljs-title function_">fill</span>();
        
        <span class="hljs-comment">// 示例6：使用arcTo绘制圆角</span>
        ctx.<span class="hljs-title function_">beginPath</span>();
        ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">350</span>, <span class="hljs-number">200</span>);
        ctx.<span class="hljs-title function_">arcTo</span>(<span class="hljs-number">450</span>, <span class="hljs-number">200</span>, <span class="hljs-number">450</span>, <span class="hljs-number">300</span>, <span class="hljs-number">30</span>); <span class="hljs-comment">// 创建圆角</span>
        ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">450</span>, <span class="hljs-number">300</span>);
        ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">'#34495e'</span>;
        ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">3</span>;
        ctx.<span class="hljs-title function_">stroke</span>();
        
        <span class="hljs-comment">// 添加说明文字</span>
        ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'#333'</span>;
        ctx.<span class="hljs-property">font</span> = <span class="hljs-string">'12px Arial'</span>;
        ctx.<span class="hljs-title function_">fillText</span>(<span class="hljs-string">'完整圆形'</span>, <span class="hljs-number">80</span>, <span class="hljs-number">180</span>);
        ctx.<span class="hljs-title function_">fillText</span>(<span class="hljs-string">'圆形边框'</span>, <span class="hljs-number">230</span>, <span class="hljs-number">180</span>);
        ctx.<span class="hljs-title function_">fillText</span>(<span class="hljs-string">'半圆'</span>, <span class="hljs-number">385</span>, <span class="hljs-number">180</span>);
        ctx.<span class="hljs-title function_">fillText</span>(<span class="hljs-string">'四分之一圆'</span>, <span class="hljs-number">75</span>, <span class="hljs-number">330</span>);
        ctx.<span class="hljs-title function_">fillText</span>(<span class="hljs-string">'扇形'</span>, <span class="hljs-number">240</span>, <span class="hljs-number">330</span>);
        ctx.<span class="hljs-title function_">fillText</span>(<span class="hljs-string">'arcTo圆角'</span>, <span class="hljs-number">370</span>, <span class="hljs-number">330</span>);
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-10">圆弧绘制方法</h3>
<ol>
<li><strong>arc()</strong>  - 绘制标准圆弧，最常用</li>
<li><strong>arcTo()</strong>  - 通过两个控制点绘制圆弧，适合创建圆角</li>
<li><strong>ellipse()</strong>  - 绘制椭圆弧（可控制椭圆半径和旋转）</li>
</ol>
<h5 data-id="heading-11">综合示例：绘制简单笑脸</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4c4ac88f77344579b7aceedee5a1dc9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQkJC5Yqq5Yqb5a2m5Lmg56iL5bqP6K6-6K6h:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763704013&amp;x-signature=nUCAuL3BO%2Bs8ke8vpQQRUL92Gx8%3D" alt="屏幕截图 2025-11-08 212855.png" loading="lazy"/></p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Canvas笑脸绘制<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">canvas</span> {
            <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#333</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"smileyCanvas"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'smileyCanvas'</span>);
        <span class="hljs-keyword">const</span> ctx = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'2d'</span>);
        
        <span class="hljs-comment">// 绘制脸部（圆形）</span>
        ctx.<span class="hljs-title function_">beginPath</span>();
        ctx.<span class="hljs-title function_">arc</span>(<span class="hljs-number">200</span>, <span class="hljs-number">200</span>, <span class="hljs-number">150</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>);
        ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'#FFD700'</span>; <span class="hljs-comment">// 金黄色</span>
        ctx.<span class="hljs-title function_">fill</span>();
        ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">'#D4AF37'</span>;
        ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">3</span>;
        ctx.<span class="hljs-title function_">stroke</span>();
        
        <span class="hljs-comment">// 绘制左眼</span>
        ctx.<span class="hljs-title function_">beginPath</span>();
        ctx.<span class="hljs-title function_">arc</span>(<span class="hljs-number">150</span>, <span class="hljs-number">160</span>, <span class="hljs-number">25</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>);
        ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'white'</span>;
        ctx.<span class="hljs-title function_">fill</span>();
        ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">'#333'</span>;
        ctx.<span class="hljs-title function_">stroke</span>();
        
        <span class="hljs-comment">// 绘制左眼珠</span>
        ctx.<span class="hljs-title function_">beginPath</span>();
        ctx.<span class="hljs-title function_">arc</span>(<span class="hljs-number">150</span>, <span class="hljs-number">160</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>);
        ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'#333'</span>;
        ctx.<span class="hljs-title function_">fill</span>();
        
        <span class="hljs-comment">// 绘制右眼</span>
        ctx.<span class="hljs-title function_">beginPath</span>();
        ctx.<span class="hljs-title function_">arc</span>(<span class="hljs-number">250</span>, <span class="hljs-number">160</span>, <span class="hljs-number">25</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>);
        ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'white'</span>;
        ctx.<span class="hljs-title function_">fill</span>();
        ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">'#333'</span>;
        ctx.<span class="hljs-title function_">stroke</span>();
        
        <span class="hljs-comment">// 绘制右眼珠</span>
        ctx.<span class="hljs-title function_">beginPath</span>();
        ctx.<span class="hljs-title function_">arc</span>(<span class="hljs-number">250</span>, <span class="hljs-number">160</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>);
        ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'#333'</span>;
        ctx.<span class="hljs-title function_">fill</span>();
        
        <span class="hljs-comment">// 绘制嘴巴（微笑弧线）</span>
        ctx.<span class="hljs-title function_">beginPath</span>();
        ctx.<span class="hljs-title function_">arc</span>(<span class="hljs-number">200</span>, <span class="hljs-number">220</span>, <span class="hljs-number">80</span>, <span class="hljs-number">0.1</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>, <span class="hljs-number">0.9</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>); <span class="hljs-comment">// 微笑弧度</span>
        ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">'#333'</span>;
        ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">5</span>;
        ctx.<span class="hljs-title function_">stroke</span>();
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h2 data-id="heading-12">总结</h2>
<p>Canvas绘图的三个核心基础：</p>
<ol>
<li><strong>坐标系统</strong>：理解基于左上角的坐标系是精确定位的基础</li>
<li><strong>线条绘制</strong>：学会使用路径API创建直线、折线和虚线</li>
<li><strong>圆形绘制</strong>：掌握使用<code>arc()</code>方法绘制圆形、圆弧和扇形</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[不只是设计师的工具：Photoshop在前端开发中的高频操作指南]]></title>    <link>https://juejin.cn/post/7572137760447119401</link>    <guid>https://juejin.cn/post/7572137760447119401</guid>    <pubDate>2025-11-14T05:48:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572137760447119401" data-draft-id="7569910533508317203" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="不只是设计师的工具：Photoshop在前端开发中的高频操作指南"/> <meta itemprop="keywords" content="前端,HTML"/> <meta itemprop="datePublished" content="2025-11-14T05:48:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BBB努力学习程序设计"/> <meta itemprop="url" content="https://juejin.cn/user/3097787706900985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            不只是设计师的工具：Photoshop在前端开发中的高频操作指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097787706900985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BBB努力学习程序设计
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T05:48:00.000Z" title="Fri Nov 14 2025 05:48:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;color:rgba(46,36,36,.87);overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{margin-bottom:5px;font-size:30px;font-weight:500}.markdown-body h1:before{content:"#";margin-right:10px;color:#1976d2}.markdown-body h2{font-size:28px;font-weight:400;border-left:5px solid #454545;margin-top:20px;padding-left:10px;transition:all .3s ease-in-out}.markdown-body h2:hover{border-color:#1976d2}.markdown-body h3{font-size:24px;font-weight:400;margin-top:15px;padding-bottom:0}.markdown-body h4{font-size:20px;font-weight:500}.markdown-body h5{font-size:16px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h2:first-letter,.markdown-body h3:first-letter,.markdown-body p:first-letter{text-transform:capitalize}.markdown-body em{text-emphasis:dot;text-emphasis-position:under}.markdown-body img{display:block;margin:0 auto!important;max-width:100%;border-radius:2px;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)!important}.markdown-body hr{position:relative;width:98%;height:1px;border:none;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#ddd,#999,#ddd);overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center}.markdown-body code{font-weight:900;word-break:break-word;border-radius:2px;overflow-x:auto;font-size:.87em;padding:.065em .4em;background-color:#fbe5e1;color:#c0341d}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:0 4px}.markdown-body pre&gt;code{font-weight:400;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{margin:0 4px;text-decoration:none;color:#027fff;transition:all .3s ease-in-out;padding-bottom:4px;border-bottom:2px solid transparent}.markdown-body a:after{content:"";display:inline-block;width:18px;height:18px;margin-left:4px;vertical-align:middle;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2U9IiMwMjdGRkYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PHBhdGggZD0iTTkuODE1IDYuNDQ4bDEuOTM2LTEuOTM2YzEuMzM3LTEuMzM2IDMuNTgtMS4yNTkgNS4wMTMuMTczIDEuNDMyIDEuNDMyIDEuNTEgMy42NzYuMTczIDUuMDEzbC0xLjQ1MiAxLjQ1Mi0uOTY4Ljk2OGMtMS4zMzcgMS4zMzYtMy41ODEgMS4yNTktNS4wMTMtLjE3MyIvPjxwYXRoIGQ9Ik0xMS4yNjcgMTUuMzY3bC0xLjkzNiAxLjkzNmMtMS4zMzYgMS4zMzctMy41OCAxLjI2LTUuMDEyLS4xNzMtMS40MzItMS40MzItMS41MS0zLjY3Ni0uMTczLTUuMDEybDEuNDUyLTEuNDUyLjk2OC0uOTY4YzEuMzM2LTEuMzM3IDMuNTgtMS4yNiA1LjAxMi4xNzMiLz48L2c+PC9zdmc+);background-size:cover;background-repeat:no-repeat}.markdown-body a:hover{border-color:#027fff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body a.footnote-backref:after,.markdown-body a.footnote-ref:after,.markdown-body sup a:after{display:none!important}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border:2px solid #c6c6c6}.markdown-body table img{box-shadow:none!important}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body del{color:rgba(0,0,0,.6)}.markdown-body blockquote{position:relative;color:#666;padding:5px 23px 1px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:hsla(0,0%,78.4%,.12);transition:all .2s ease-in-out}.markdown-body blockquote:hover{border-color:#1976d2}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;font-size:24px;font-weight:800;line-height:24px;color:#cbcbcb;opacity:.6}.markdown-body blockquote:before{content:"“";top:4px;left:6px}.markdown-body blockquote:after{content:"”";right:8px;bottom:-8px}.markdown-body blockquote&gt;p,.markdown-body blockquote blockquote{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body details{outline:none;border:none;border-left:4px solid #1976d2;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary:hover::-webkit-details-marker{color:#1976d2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>很多刚入门前端的同学会有个疑问：“我是写代码的，为什么还要学Photoshop？” 事实上，PS 对于前端开发者来说，不仅是查看设计稿的工具，更是获取精确数据、提取资源和理解视觉实现的“瑞士军刀”。今天，我们就来聊聊那些前端工程师必须掌握的 PS 常见操作。</p>
<h2 data-id="heading-0"><strong>一、核心概念：为什么前端要懂点PS？</strong></h2>
<p>前端工程师的使命是将设计师的静态稿（通常是 PSD 或 Sketch 文件）转化为动态的、可交互的网页。在这个过程中，PS 能帮助我们：</p>
<ol>
<li><strong>获取精确尺寸与间距</strong>：精准测量元素的大小、边距、行高，实现“像素级”还原。</li>
<li><strong>提取切图资源</strong>：获取页面中使用的图标、Logo、特殊按钮等图片素材。</li>
<li><strong>拾取颜色值</strong>：获取设计稿中使用的精确颜色，包括不常用的渐变和阴影色。</li>
<li><strong>分析复杂样式</strong>：理解图层混合模式、阴影、模糊等效果的参数，以便用 CSS 代码实现。</li>
</ol>
<h2 data-id="heading-1"><strong>二、常见操作、代码示例与注意点</strong></h2>
<h3 data-id="heading-2"><strong>1. 获取尺寸与间距</strong></h3>
<p>这是最基础也是最常用的操作。</p>
<p><strong>操作流程</strong>：</p>
<ol>
<li>在 PS 中打开设计稿。</li>
<li>选择 <code>移动工具</code> (快捷键 V)。</li>
<li>在上方选项栏勾选 <code>自动选择</code> 并选择 <code>图层</code>。</li>
<li>点击你想测量的元素，在图层面板中会自动定位到该图层。</li>
<li>使用 <code>矩形选框工具</code> (M) 框选要测量的区域，信息面板 (F8) 会显示宽 (W) 和高 (H)。</li>
</ol>
<h4 data-id="heading-3">CSS代码示例:假设我们测量到一个按钮的宽度为 <code>120px</code>，高度为 <code>40px</code>，距离左边元素 <code>20px</code>。</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.my-button</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">120px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">20px</span>; <span class="hljs-comment">/* 测量到的间距 */</span>
}
</code></pre>
<h3 data-id="heading-4"><strong>2. 提取图片资源（切图）</strong></h3>
<p>当设计稿中有无法用 CSS 绘制的图片、图标或 Logo 时，我们需要将它们“切”出来。</p>
<ul>
<li>
<p><strong>操作流程（传统方式）</strong> ：</p>
<ol>
<li>使用 <code>切片工具</code> (C)。</li>
<li>框选你需要导出的区域。</li>
<li>点击菜单栏 <code>文件</code> -&gt; <code>导出</code> -&gt; <code>存储为 Web 所用格式</code> (旧版)。</li>
<li>选择格式（如 PNG-24, PNG-8, JPG），调整质量，点击存储，并选择“选中的切片”。</li>
</ol>
</li>
<li>
<p><strong>操作流程（更高效的方式 - 导出为）</strong> ：</p>
<ol>
<li>在图层面板，右键点击你需要导出的图层或图层组。</li>
<li>选择 <code>导出为...</code>。</li>
<li>在弹出的对话框中选择格式（如 PNG, JPG, SVG）和大小（1x, 2x等）。</li>
<li>点击 <code>导出全部</code>。</li>
</ol>
</li>
</ul>
<h4 data-id="heading-5">HTML代码示例:假设我们导出了一个名为 <code>icon-search.png</code> 的图标。</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"style.css"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 使用切图资源 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"search-btn"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"images/icon-search.png"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"搜索图标"</span>&gt;</span>
    搜索
  <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-6"><strong>3. 获取颜色值</strong></h3>
<p>确保页面颜色与设计稿一致的关键。</p>
<ul>
<li>
<p><strong>操作流程</strong>：</p>
<ol>
<li>使用 <code>吸管工具</code> (快捷键 I)。</li>
<li>在设计稿上点击你想要取色的位置。</li>
<li>查看前景色块，点击它会弹出 <code>拾色器</code> 对话框，可以获取到 HEX、RGB 等格式的颜色值。</li>
</ol>
</li>
</ul>
<h4 data-id="heading-7">CSS代码示例:假设我们取到一个主题色为 <code>#3a86ff</code>，一个带透明度的黑色 <code>rgba(0, 0, 0, 0.5)</code>。</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--primary-color</span>: <span class="hljs-number">#3a86ff</span>; <span class="hljs-comment">/* 从PS拾色器获取的HEX值 */</span>
  <span class="hljs-attr">--overlay-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>); <span class="hljs-comment">/* 从PS拾色器获取的RGBA值 */</span>
}

<span class="hljs-selector-class">.header</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--primary-color);
}

<span class="hljs-selector-class">.modal-overlay</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--overlay-color);
}
</code></pre>
<h3 data-id="heading-8"><strong>4. 解析阴影效果</strong></h3>
<p>CSS 的 <code>box-shadow</code> 属性可以完美实现 PS 中的投影效果，但需要获取正确的参数。</p>
<ul>
<li>
<p><strong>操作流程</strong>：</p>
<ol>
<li>在图层面板，双击想要查看效果的图层，打开 <code>图层样式</code> 对话框。</li>
<li>选择 <code>投影</code>。</li>
<li>记录下 <code>混合模式</code>、<code>不透明度</code>、<code>角度</code>、<code>距离</code>、<code>扩展</code>、<code>大小</code> 等参数。</li>
</ol>
</li>
</ul>
<h4 data-id="heading-9">CSS代码示例:假设我们从图层样式中看到参数为：不透明度 25%，角度 120度，距离 5px，扩展 0px，大小 10px。</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.card</span> {
  <span class="hljs-comment">/* box-shadow: h-offset v-offset blur spread color; */</span>
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">5px</span> <span class="hljs-number">5px</span> <span class="hljs-number">10px</span> <span class="hljs-number">0</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.25</span>);
  <span class="hljs-comment">/* 
    解释：
    h-offset (水平偏移): 5px (根据角度和距离换算，这里简化为5px)
    v-offset (垂直偏移): 5px
    blur (模糊大小): 10px
    spread (扩展大小): 0px
    color: rgba(0, 0, 0, 0.25) (黑色，25%不透明度)
  */</span>
}
</code></pre>
<h3 data-id="heading-10">注意：</h3>
<p>PS 中的“角度”是一个全局光的角度，需要手动换算为 <code>h-offset</code> 和 <code>v-offset</code>。可以使用 <code>距离 * sin(角度)</code> 和 <code>距离 * cos(角度)</code> 来粗略计算，但通常直接手动调整 <code>h-offset</code> 和 <code>v-offset</code> 直到视觉上匹配即可。</p>
<h2 data-id="heading-11">总结</h2>
<p>Photoshop 不是一个需要精通绘图的软件，而是一个  <strong>“数据提取器和视觉解析器”</strong> 。</p>
<ul>
<li><strong>核心价值</strong>：在于<strong>精准地获取构建页面所需的数值</strong>（尺寸、间距）、资源（图片）和<strong>样式参数</strong>（颜色、阴影） 。</li>
<li><strong>工作流</strong>：可以概括为  <strong>“测量 -&gt; 提取 -&gt; 编码”</strong>  的循环。</li>
<li><strong>终极目标</strong>：通过与设计师的无缝协作，将这些视觉数据转化为高质量的 CSS 和 HTML 代码，最终实现与设计稿高度一致的网页。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[3 个顶呱呱的 GitHub 开源项目，有点意思啊。]]></title>    <link>https://juejin.cn/post/7572126996177354787</link>    <guid>https://juejin.cn/post/7572126996177354787</guid>    <pubDate>2025-11-14T05:45:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572126996177354787" data-draft-id="7572115057222107171" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="3 个顶呱呱的 GitHub 开源项目，有点意思啊。"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-11-14T05:45:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="逛逛GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            3 个顶呱呱的 GitHub 开源项目，有点意思啊。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    逛逛GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T05:45:30.000Z" title="Fri Nov 14 2025 05:45:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">01、快速把网页打包成 APP</h2>
<p>这个 GitHub 开源项目有 6.5K 的 Star 了。</p>
<p><strong>它是一个打包神器，能把你平时用的网站，比如油管、小红书或者你自己写的网页项目，快速变成一个独立的、小巧的电脑或手机软件。</strong></p>
<p>能在 Mac、Windows、Linux，或者安卓、苹果上安装访问。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45557d1eebee435d9463103fa5086782~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763703930&amp;x-signature=gI6bGZh9N%2FAoRN7ZdWpnzNC87Bc%3D" alt="图片" loading="lazy"/></p>
<p>PakePlus 体积超小，不到 5MB，比传统工具快 10 倍。</p>
<p>比如下面是把 YouTube 网页变成独立 APP 的操作演示：</p>
<p>把它变成一个像 QQ、微信那样的桌面软件。</p>
<p>你只需要在电脑上双击这个软件的图标，就能直接打开 YouTube，不用再经过浏览器了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b87eedc87a14ed69a8039f98bab0e32~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763703930&amp;x-signature=fzXpTIDK60gMAdJ9h%2FNZj4cTDVI%3D" alt="图片" loading="lazy"/></p>
<p>打包网页超级简单：你只需要一个 GitHub 账号的 Token，在 PakePlus 中点几下，它就能自动在云端帮你把软件打包好，你完全不用在自己电脑上安装复杂的编程环境。</p>
<p>如果你懂点技术，也可以在自己电脑上打包，过程也很快。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9259be9c511d42cd943faadab8e44ebd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763703930&amp;x-signature=ANSxD4zX57W0rjedDPEnUMFmSnI%3D" alt="图片" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05c8b66445ca49b3b0a53e23e6d6fd9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763703930&amp;x-signature=KOW35oijg6oWAeyww2wAZg%2BiSh4%3D" alt="图片" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p>而且你还可以给打包的网站加一些自己的 JavaScript 代码，比如去掉烦人的广告、增加一些自动化操作。</p>
<p>甚至可以让你注入的代码调用电脑的系统功能，如下载文件、执行命令等。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e9d224f02ed4e119a9b97fa50513881~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763703930&amp;x-signature=czwhAfqW2Sfs%2F8%2B6o2XfSGNBJ70%3D" alt="图片" loading="lazy"/></p>
<p>看到开发者在开源项目上备注了一下，因为之前有人滥用这个项目去打包非法软件，所以<strong>它的前端代码部分不再开源了</strong>。你不能修改它用户界面了，但仍然可以正常使用它提供的在线服务或编译好的客户端来打包你自己的应用。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f99fd4fe3d1a486cb39f8e087565396d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763703930&amp;x-signature=fNdBNUWpRU2Ux4o6S2%2FYYqgKpj8%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/Sjj1024/PakePlus</span>
</code></pre>
<h2 data-id="heading-1">02、网页时光机</h2>
<p>这个叫做 ArchiveBox 的 GitHub 项目有点好玩， 目前已经获得 25K 星了。</p>
<p>你可以把他理解成你的「私人网页时光机」，一款能自己部署、完全掌控数据的网页备份工具。</p>
<p>防止喜欢的网页失效、被修改，把内容永久存下来。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/057421b1ef3a4d33b6c85708962fe2cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763703930&amp;x-signature=n%2BD6qWAeZfmiQ0hInOfREK70gt0%3D" alt="图片" loading="lazy"/></p>
<p>不管是浏览器书签、浏览记录，还是 Pocket、RSS 订阅里的链接，都能交给它备份，而且会存成 PDF、截图、纯文本、HTML、MP4 啥的格式。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7c04ff69c614387806e76e58acffc04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763703930&amp;x-signature=jWf2cmUxrEYvfTEFlJrca72n9t0%3D" alt="图片" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48545fae4ab94e8a8375ae527455b6ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763703930&amp;x-signature=H%2BFrbq%2FcqRvJhark1u136ULE8ys%3D" alt="图片" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6ee4b1ed2794bed96575c0512a07610~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763703930&amp;x-signature=wk70ns6%2B8N%2BKraFOfUf8%2BoaDlYo%3D" alt="图片" loading="lazy"/></p>
<p>不搞复杂格式，存的都是 HTML、PNG、MP4 这些通用文件，就算以后不用 ArchiveBox 了，直接打开文件夹也能看。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/407d9fe797c94cc792d23645874bb343~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763703930&amp;x-signature=VNnV5rQxHwVb7JFgr51Z0mvOvzQ%3D" alt="图片" loading="lazy"/></p>
<p>可以直接通过 pip 安装 archivebox，当然还支持 Docker 啥的，可以直接去 readme 看看。</p>
<pre><code class="hljs language-javascript" lang="javascript">pip install archiveboxmkdir -p ~<span class="hljs-regexp">/archivebox/</span>data &amp;&amp; cd ~<span class="hljs-regexp">/archivebox/</span>dataarchivebox init --setup
</code></pre>
<p>执行 archivebox add '<a href="https://link.juejin.cn?target=https%3A%2F%2Fexample.com" target="_blank" title="https://example.com" ref="nofollow noopener noreferrer">example.com</a>' 就能保持网页了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7682d1cbfe24789941b3d319cb6620c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763703930&amp;x-signature=vUBgXT2lzKssURGxBabeSpyTtY8%3D" alt="图片" loading="lazy"/></p>
<p>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FArchiveBox%2FArchiveBox" target="_blank" title="https://github.com/ArchiveBox/ArchiveBox" ref="nofollow noopener noreferrer">github.com/ArchiveBox/…</a></p>
<h2 data-id="heading-2">03、安卓上的极简番茄钟</h2>
<p>这个是一个专为安卓手机设计的专注工具，用番茄工作法帮你高效做事，界面还挺好看的。</p>
<p>如果你想学习 Google 为 Android 平台推出的全新设计语言 Material 3 Expressive，这个开源项目可以帮你入门。</p>
<p>因为它就是基于 Material 3 Expressive 开发的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5a83d00231340e581b050bfee164cf1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763703930&amp;x-signature=UG2iuyUAPJHNT8B06rVA8ncroOY%3D" alt="图片" loading="lazy"/></p>
<p>它分专注模式、短休息、长休息，默认 25 分钟工作、5 分钟休息，也能自己调时间。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0dd5bd35d55f4bc1ac34c64b01441fc8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763703930&amp;x-signature=WmlvYaP0Q%2Fowefa8LX0wziknnjU%3D" alt="图片" loading="lazy"/></p>
<p>能统计你每天、每周、每月的专注时长，还能看自己哪个时间段最有效率，比如早上 9 点到 11 点。界面极简无广告，支持安卓 16 及以上的实时更新功能，适合学生、上班族用来对抗拖延。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/617e11fbc6ab4fb38e1945f9d34965ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763703930&amp;x-signature=SM2b0woxd4iT6wHu%2FohmFYdKArg%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/nsh07/Tomato</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[qinkun的缓存机制也有弊端，建议官方个参数控制]]></title>    <link>https://juejin.cn/post/7572141390857437184</link>    <guid>https://juejin.cn/post/7572141390857437184</guid>    <pubDate>2025-11-14T05:54:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572141390857437184" data-draft-id="7572141390857355264" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="qinkun的缓存机制也有弊端，建议官方个参数控制"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-14T05:54:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="石小石Orz"/> <meta itemprop="url" content="https://juejin.cn/user/660148845294712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            qinkun的缓存机制也有弊端，建议官方个参数控制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/660148845294712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    石小石Orz
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T05:54:49.000Z" title="Fri Nov 14 2025 05:54:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>公司前端基于qiankun架构，主应用通过qiankun加载子应用，子应用也可能通过qiankun继续加载子应用，反复套娃。经过测试，不断打开子应用后，会导致内存不断上上。通过<strong>快照分析</strong>，发现内存升高的元凶是qiankun内置的# <code>import-html-entry</code>。</p>
<h2 data-id="heading-0"><code>import-html-entry</code> 的作用是什么</h2>
<p><code>import-html-entry</code> 是 qiankun / single-spa 微前端生态的核心模块之一，用来：</p>
<p>加载远程 HTML 入口文件（entry HTML），并提取出其中的 <strong>JS / CSS / 静态资源</strong>，然后按需执行或注入。</p>
<p>比如：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { importEntry } <span class="hljs-keyword">from</span> <span class="hljs-string">'import-html-entry'</span>;

<span class="hljs-keyword">const</span> { execScripts } = <span class="hljs-keyword">await</span> importEntry(<span class="hljs-string">'https://wwww.石小石.com/'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-built_in">exports</span> = <span class="hljs-keyword">await</span> <span class="hljs-title function_">execScripts</span>(<span class="hljs-variable language_">window</span>);
</code></pre>
<p>简单来说，<code>import-html-entry</code> 负责做三件事：</p>
<p><strong>下载远程 HTML 文件</strong></p>
<ul>
<li>使用 <code>fetch(url)</code> 请求远程 HTML。</li>
<li>解析 HTML 中的 <code>&lt;script&gt;</code> 与 <code>&lt;link&gt;</code> 标签。</li>
</ul>
<p><strong>提取资源并缓存</strong></p>
<ul>
<li>提取脚本与样式资源 URL。</li>
<li>通过自定义逻辑加载（并缓存）外部脚本与样式内容。</li>
<li>将 <code>&lt;link&gt;</code> 替换为内联 <code>&lt;style&gt;</code>，提升加载性能。</li>
</ul>
<p><strong>执行脚本</strong></p>
<ul>
<li>通过 <code>eval</code> 在隔离作用域中执行 JS（防止污染主应用的 window）。</li>
<li>支持 <code>proxy</code> 代理对象（qiankun 沙箱核心）。</li>
<li>支持同步、异步脚本的加载与执行顺序。</li>
</ul>
<h2 data-id="heading-1">核心源码</h2>
<p>它的 源码中包含这些关键函数：</p>





































<table><thead><tr><th>函数名</th><th>作用</th></tr></thead><tbody><tr><td><code>importHTML(url, opts)</code></td><td>主入口，加载远程 HTML</td></tr><tr><td><code>processTpl</code></td><td>解析 HTML 模板，提取 script/link</td></tr><tr><td><code>_getExternalScripts</code></td><td>加载并缓存 JS</td></tr><tr><td><code>_getExternalStyleSheets</code></td><td>加载并缓存 CSS</td></tr><tr><td><code>_execScripts</code></td><td>按顺序执行脚本</td></tr><tr><td><code>getExecutableScript</code></td><td>包装脚本为沙箱可执行代码</td></tr><tr><td><code>evalCode</code></td><td>实际执行脚本（带缓存）</td></tr></tbody></table>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d15c7fdf3934c71b9dd3ec6df5a8d9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-z5bCP55-zT3J6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763704488&amp;x-signature=G%2B%2FqsBPclaVS5jjITApXNbmMbXQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">缓存机制</h2>
<p><code>import-html-entry</code> 内部维护了四个全局缓存对象， 这些缓存的目的是 <strong>在同一个浏览器会话中</strong>，当多个子应用或同一个子应用多次加载同一个 URL 时，避免重复网络请求，从而加快微前端加载速度。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> styleCache = {};    <span class="hljs-comment">// 样式字符缓存</span>
<span class="hljs-keyword">var</span> scriptCache = {};   <span class="hljs-comment">// js字符缓存</span>
<span class="hljs-keyword">var</span> embedHTMLCache = {};<span class="hljs-comment">// html字符缓存</span>
<span class="hljs-keyword">var</span> evalCache = {};     <span class="hljs-comment">// 编译后的脚本缓存</span>
</code></pre>
<p>styleCache对应源码：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/defb9b5ef19e454bafcf764484954996~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-z5bCP55-zT3J6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763704488&amp;x-signature=6aMhNluZPpL%2FU8pOHHDAvXajSsI%3D" alt="" loading="lazy"/></p>
<p>scriptCache对应源码：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fbad9bdf25c47fc9a6749bde4708b57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-z5bCP55-zT3J6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763704488&amp;x-signature=OAqOpZLHoq3WLRHkorygs5rt3L4%3D" alt="" loading="lazy"/></p>
<p>embedHTMLCache对应源码：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edb39ab801534a1995e5463272564844~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-z5bCP55-zT3J6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763704488&amp;x-signature=AfmAWTHzROiKuUZwe2DABZ%2BtQSo%3D" alt="" loading="lazy"/></p>
<p>evalCache对应源码：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b4a81fc3e804d7f9381634ff94d55ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-z5bCP55-zT3J6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763704488&amp;x-signature=mv66vzlkCzBCobkAB%2Bw6RrqajUw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">缓存机制在子应用多开频繁销毁创建场景中的弊端</h2>
<p>在单实例的 <strong>qiankun 架构</strong> 中，<code>import-html-entry</code> 的缓存仅会存在一份，对内存的占用影响有限，缓存带来的性能收益相对较高。<br/>
但如果系统存在大量qiankun加载子应用的场景，比如要频繁打开若干子应用（类似于菜单），子应用需要频繁打开销毁（tab切换等），同时其内部的部分功能模块又会再次通过 <code>qiankun</code> 动态加载子应用。这种嵌套加载结构会导致 <code>import-html-entry</code> 在多个层级重复缓存资源，即使资源内容相同，也会被多次存储。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8dd52ac49dc84c40bc67d7d4d21ba135~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-z5bCP55-zT3J6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763704488&amp;x-signature=GjY2cixQRUuh0k7iCBjHJyJXprM%3D" alt="" loading="lazy"/></p>
<p>因此，子应用的频繁打开与卸载，会导致内存占用持续增长，从而引发明显的性能下降（国产CPU可能更明显）。</p>
<p>因此，<strong>移除或禁用</strong> <code>import-html-entry</code> <strong>的缓存机制</strong>，能极大缓解内存泄漏问题，<strong>提升系统在复杂场景下的运行性能与稳定性</strong>。</p>
<h2 data-id="heading-4">优化方案</h2>



































<table><thead><tr><th>缓存名</th><th>缓存内容</th><th>缓存目的</th><th>禁用影响</th></tr></thead><tbody><tr><td><strong>styleCache</strong></td><td>每个 CSS 链接的内容（文本）</td><td>避免重复请求相同样式文件</td><td>每次重新请求 CSS（但浏览器会命中协商缓存，影响极小）</td></tr><tr><td><strong>scriptCache</strong></td><td>每个 JS 链接的内容（文本）</td><td>避免重复请求相同脚本文件</td><td>每次重新请求 JS（命中浏览器缓存，影响较小）</td></tr><tr><td><strong>embedHTMLCache</strong></td><td>整个 HTML 模板字符串</td><td>避免重复请求入口 HTML 文件</td><td>每次重新请求入口文件，性能略降</td></tr><tr><td><strong>evalCache</strong></td><td>每个脚本的已编译函数 <code>(function(){...})</code></td><td><strong>避免多次 eval 编译同一脚本字符串</strong>，提升运行性能</td><td>每次都重新 eval 解析 JS 字符串，会略微影响性能（CPU 负担）</td></tr></tbody></table>
<p>浏览器自带的协商缓存已能高效复用 HTML、JS、CSS 资源，因此禁用 <code>import-html-entry</code> 的缓存逻辑几乎不影响加载性能。<br/>
<code>evalCache</code> 的移除可能短暂增加 CPU 开销降低性能，但整体影响可能较小，需要综合评估。</p>
<p><strong>通过在 qiankun 集成层中移除多余缓存，可有效降低内存占用，缓解泄漏问题，并显著提升系统性能与稳定性。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3实现拖拽排序]]></title>    <link>https://juejin.cn/post/7572161976592990260</link>    <guid>https://juejin.cn/post/7572161976592990260</guid>    <pubDate>2025-11-14T05:54:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572161976592990260" data-draft-id="7572141390857388032" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3实现拖拽排序"/> <meta itemprop="keywords" content="Vue.js,JavaScript"/> <meta itemprop="datePublished" content="2025-11-14T05:54:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户971417181427"/> <meta itemprop="url" content="https://juejin.cn/user/2200564916558794"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3实现拖拽排序
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2200564916558794/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户971417181427
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T05:54:03.000Z" title="Fri Nov 14 2025 05:54:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue3 + Element Plus + SortableJS 实现表格拖拽排序功能</h2>
<h3 data-id="heading-1">📋 目录</h3>
<ul>
<li><a href="#%E5%8A%9F%E8%83%BD%E6%A6%82%E8%BF%B0" title="#%E5%8A%9F%E8%83%BD%E6%A6%82%E8%BF%B0">功能概述</a></li>
<li><a href="#%E6%8A%80%E6%9C%AF%E6%A0%88" title="#%E6%8A%80%E6%9C%AF%E6%A0%88">技术栈</a></li>
<li><a href="#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF" title="#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF">实现思路</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0" title="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0">代码实现</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E8%A6%81%E7%82%B9" title="#%E6%A0%B8%E5%BF%83%E8%A6%81%E7%82%B9">核心要点</a></li>
<li><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98" title="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">常见问题</a></li>
<li><a href="#%E6%80%BB%E7%BB%93" title="#%E6%80%BB%E7%BB%93">总结</a></li>
</ul>
<h3 data-id="heading-2">功能概述</h3>
<p>在管理后台系统中，表格数据的排序功能是一个常见的需求。本文介绍如何使用 Vue3、Element Plus 和 SortableJS 实现一个完整的表格拖拽排序功能，支持：</p>
<ul>
<li>✅ 通过拖拽图标对表格行进行排序</li>
<li>✅ 实时更新数据顺序</li>
<li>✅ 支持数据过滤后的排序</li>
<li>✅ 切换标签页时自动初始化</li>
<li>✅ 优雅的动画效果</li>
</ul>
<p>先看实现效果：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c73de6a194d442aebd5b55829a911490~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTcxNDE3MTgxNDI3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763704442&amp;x-signature=bl%2F2pUzi4HtZc5FXWMg0yHD%2B%2FFk%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-3">技术栈</h3>
<ul>
<li><strong>Vue 3</strong> - 渐进式 JavaScript 框架</li>
<li><strong>Element Plus</strong> - Vue 3 组件库</li>
<li><strong>SortableJS</strong> - 轻量级拖拽排序库</li>
<li><strong>TypeScript</strong> - 类型安全的 JavaScript 超集</li>
</ul>
<h3 data-id="heading-4">实现思路</h3>
<h4 data-id="heading-5">1. 整体架构</h4>
<pre><code class="hljs language-markdown" lang="markdown">用户拖拽表格行
<span class="hljs-code">    ↓
SortableJS 监听拖拽事件
    ↓
触发 onEnd 回调
    ↓
更新 Vue 响应式数据
    ↓
表格自动重新渲染
</span></code></pre>
<h4 data-id="heading-6">2. 关键步骤</h4>
<ol>
<li><strong>安装依赖</strong>：引入 SortableJS 库</li>
<li><strong>获取 DOM</strong>：获取表格 tbody 元素</li>
<li><strong>初始化 Sortable</strong>：创建拖拽实例</li>
<li><strong>处理回调</strong>：在拖拽结束时更新数据</li>
<li><strong>生命周期管理</strong>：在适当时机初始化和销毁实例</li>
</ol>
<h3 data-id="heading-7">代码实现</h3>
<h4 data-id="heading-8">1. 安装依赖</h4>
<pre><code class="hljs language-bash" lang="bash">npm install sortablejs
<span class="hljs-comment"># 或</span>
pnpm add sortablejs
</code></pre>
<h4 data-id="heading-9">2. 导入必要的模块</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { ref, nextTick, watch, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Sortable</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"sortablejs"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Operation</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@element-plus/icons-vue"</span>;<span class="hljs-comment">//图标</span>
</code></pre>
<h4 data-id="heading-10">3. 定义数据结构</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">TypeItem</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">enabled</span>: <span class="hljs-built_in">boolean</span>;
  <span class="hljs-attr">sortOrder</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">const</span> typeData = ref&lt;<span class="hljs-title class_">TypeItem</span>[]&gt;([
  { <span class="hljs-attr">id</span>: <span class="hljs-string">"1"</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"楼宇性质1"</span>, <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">sortOrder</span>: <span class="hljs-number">1</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-string">"2"</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"楼宇性质2"</span>, <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">sortOrder</span>: <span class="hljs-number">2</span> },
  <span class="hljs-comment">// ... 更多数据</span>
]);
</code></pre>
<h4 data-id="heading-11">4. 模板结构</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;el-table ref="typeTableRef" :data="filteredTypeData" stripe row-key="id"&gt;
    &lt;!-- 排序列：显示拖拽图标 --&gt;
    &lt;el-table-column label="排序" width="131"&gt;
      &lt;template #default&gt;
        &lt;el-icon class="drag-handle"&gt;
          &lt;Operation /&gt;
        &lt;/el-icon&gt;
      &lt;/template&gt;
    &lt;/el-table-column&gt;
    
    &lt;!-- 其他列 --&gt;
    &lt;el-table-column prop="name" label="名称" /&gt;
    &lt;el-table-column prop="enabled" label="启用/禁用"&gt;
      &lt;template #default="{ row }"&gt;
        &lt;el-switch v-model="row.enabled" /&gt;
      &lt;/template&gt;
    &lt;/el-table-column&gt;
  &lt;/el-table&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-12">5. 核心实现代码</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 表格引用</span>
<span class="hljs-keyword">const</span> typeTableRef = ref&lt;<span class="hljs-title class_">InstanceType</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">ElTable</span>&gt;&gt;();

<span class="hljs-comment">// Sortable 实例（用于后续销毁）</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">sortableInstance</span>: <span class="hljs-title class_">Sortable</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;

<span class="hljs-comment">/**
 * 初始化拖拽排序功能
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">initSortable</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 1. 销毁旧实例，避免重复创建</span>
  <span class="hljs-keyword">if</span> (sortableInstance) {
    sortableInstance.<span class="hljs-title function_">destroy</span>();
    sortableInstance = <span class="hljs-literal">null</span>;
  }

  <span class="hljs-comment">// 2. 等待 DOM 更新完成</span>
  <span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 3. 获取表格的 tbody 元素</span>
    <span class="hljs-keyword">const</span> tbody = typeTableRef.<span class="hljs-property">value</span>?.<span class="hljs-property">$el</span>?.<span class="hljs-title function_">querySelector</span>(
      <span class="hljs-string">".el-table__body-wrapper tbody"</span>
    );
    
    <span class="hljs-keyword">if</span> (!tbody) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// 4. 创建 Sortable 实例</span>
    sortableInstance = <span class="hljs-title class_">Sortable</span>.<span class="hljs-title function_">create</span>(tbody, {
      <span class="hljs-comment">// 指定拖拽手柄（只能通过拖拽图标来拖拽）</span>
      <span class="hljs-attr">handle</span>: <span class="hljs-string">".drag-handle"</span>,
      
      <span class="hljs-comment">// 动画时长（毫秒）</span>
      <span class="hljs-attr">animation</span>: <span class="hljs-number">300</span>,
      
      <span class="hljs-comment">// 拖拽结束回调</span>
      <span class="hljs-attr">onEnd</span>: <span class="hljs-function">(<span class="hljs-params">{ newIndex, oldIndex }</span>) =&gt;</span> {
        <span class="hljs-comment">// 5. 更新数据顺序</span>
        <span class="hljs-keyword">if</span> (
          newIndex !== <span class="hljs-literal">undefined</span> &amp;&amp;
          oldIndex !== <span class="hljs-literal">undefined</span> &amp;&amp;
          filterStatus.<span class="hljs-property">value</span> === <span class="hljs-string">"all"</span> <span class="hljs-comment">// 只在"全部"状态下允许排序</span>
        ) {
          <span class="hljs-comment">// 获取被移动的项</span>
          <span class="hljs-keyword">const</span> movedItem = typeData.<span class="hljs-property">value</span>[oldIndex];
          
          <span class="hljs-comment">// 从原位置删除</span>
          typeData.<span class="hljs-property">value</span>.<span class="hljs-title function_">splice</span>(oldIndex, <span class="hljs-number">1</span>);
          
          <span class="hljs-comment">// 插入到新位置</span>
          typeData.<span class="hljs-property">value</span>.<span class="hljs-title function_">splice</span>(newIndex, <span class="hljs-number">0</span>, movedItem);
          
          <span class="hljs-comment">// 更新排序字段</span>
          typeData.<span class="hljs-property">value</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
            item.<span class="hljs-property">sortOrder</span> = index + <span class="hljs-number">1</span>;
          });
        }
      }
    });
  });
};
</code></pre>
<h4 data-id="heading-13">6. 生命周期管理</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * 监听标签页切换，初始化拖拽
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">watchActiveTab</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (activeTab.<span class="hljs-property">value</span> === <span class="hljs-string">"type"</span>) {
    <span class="hljs-comment">// 延迟初始化，确保表格已完全渲染</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">initSortable</span>();
    }, <span class="hljs-number">300</span>);
  }
};

<span class="hljs-comment">// 组件挂载时初始化</span>
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">watchActiveTab</span>();
});

<span class="hljs-comment">// 监听标签页切换</span>
<span class="hljs-title function_">watch</span>(activeTab, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">watchActiveTab</span>();
});

<span class="hljs-comment">// 监听过滤器变化，重新初始化拖拽</span>
<span class="hljs-title function_">watch</span>(filterStatus, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (activeTab.<span class="hljs-property">value</span> === <span class="hljs-string">"type"</span>) {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">initSortable</span>();
    }, <span class="hljs-number">100</span>);
  }
});
</code></pre>
<h4 data-id="heading-14">7. 样式定义</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 拖拽手柄样式 */</span>
<span class="hljs-selector-class">.drag-handle</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#909399</span>;
  <span class="hljs-attribute">cursor</span>: move;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>;
  <span class="hljs-attribute">transition</span>: color <span class="hljs-number">0.3s</span>;
}

<span class="hljs-selector-class">.drag-handle</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1890ff</span>;
}

<span class="hljs-comment">/* 表格样式 */</span>
<span class="hljs-selector-class">.type-table</span> {
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">0</span>;
}

:<span class="hljs-built_in">deep</span>(.type-table .el-table__header-wrapper) {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f9fafc</span>;
}

:<span class="hljs-built_in">deep</span>(.type-table .el-table th) {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f9fafc</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#33425cfa</span>;
  <span class="hljs-attribute">font-family</span>: PingFang SC;
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#dcdfe6</span>;
}
</code></pre>
<h3 data-id="heading-15">核心要点</h3>
<h4 data-id="heading-16">1. 实例管理</h4>
<p><strong>问题</strong>：如果不管理 Sortable 实例，切换标签页或过滤器时会创建多个实例，导致拖拽行为异常。</p>
<p><strong>解决</strong>：使用变量保存实例引用，在创建新实例前先销毁旧实例。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">sortableInstance</span>: <span class="hljs-title class_">Sortable</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">initSortable</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 先销毁旧实例</span>
  <span class="hljs-keyword">if</span> (sortableInstance) {
    sortableInstance.<span class="hljs-title function_">destroy</span>();
    sortableInstance = <span class="hljs-literal">null</span>;
  }
  <span class="hljs-comment">// 再创建新实例</span>
  <span class="hljs-comment">// ...</span>
};
</code></pre>
<h4 data-id="heading-17">2. DOM 获取时机</h4>
<p><strong>问题</strong>：如果直接获取 DOM，可能表格还未渲染完成，导致获取失败。</p>
<p><strong>解决</strong>：使用 <code>nextTick</code> 等待 Vue 完成 DOM 更新，或使用 <code>setTimeout</code> 延迟执行。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> tbody = typeTableRef.<span class="hljs-property">value</span>?.<span class="hljs-property">$el</span>?.<span class="hljs-title function_">querySelector</span>(
    <span class="hljs-string">".el-table__body-wrapper tbody"</span>
  );
  <span class="hljs-comment">// ...</span>
});
</code></pre>
<h4 data-id="heading-18">3. 拖拽手柄</h4>
<p><strong>问题</strong>：如果不指定拖拽手柄，整行都可以拖拽，可能与其他交互冲突（如点击编辑按钮）。</p>
<p><strong>解决</strong>：使用 <code>handle</code> 选项指定只有拖拽图标可以触发拖拽。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Sortable</span>.<span class="hljs-title function_">create</span>(tbody, {
  <span class="hljs-attr">handle</span>: <span class="hljs-string">".drag-handle"</span>, <span class="hljs-comment">// 只允许通过 .drag-handle 元素拖拽</span>
  <span class="hljs-comment">// ...</span>
});
</code></pre>
<h4 data-id="heading-19">4. 数据更新策略</h4>
<p><strong>问题</strong>：直接操作 DOM 顺序不会更新 Vue 的响应式数据。</p>
<p><strong>解决</strong>：在 <code>onEnd</code> 回调中手动更新数据数组的顺序。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">onEnd</span>: <span class="hljs-function">(<span class="hljs-params">{ newIndex, oldIndex }</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> movedItem = typeData.<span class="hljs-property">value</span>[oldIndex];
  typeData.<span class="hljs-property">value</span>.<span class="hljs-title function_">splice</span>(oldIndex, <span class="hljs-number">1</span>);
  typeData.<span class="hljs-property">value</span>.<span class="hljs-title function_">splice</span>(newIndex, <span class="hljs-number">0</span>, movedItem);
  <span class="hljs-comment">// 更新排序字段</span>
  typeData.<span class="hljs-property">value</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
    item.<span class="hljs-property">sortOrder</span> = index + <span class="hljs-number">1</span>;
  });
}
</code></pre>
<h4 data-id="heading-20">5. 过滤状态处理</h4>
<p><strong>问题</strong>：当表格数据被过滤后，拖拽的索引可能不准确。</p>
<p><strong>解决</strong>：只在"全部"状态下允许排序，或根据过滤后的数据计算正确的索引。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">onEnd</span>: <span class="hljs-function">(<span class="hljs-params">{ newIndex, oldIndex }</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (filterStatus.<span class="hljs-property">value</span> === <span class="hljs-string">"all"</span>) {
    <span class="hljs-comment">// 只在全部状态下允许排序</span>
    <span class="hljs-comment">// ...</span>
  }
}
</code></pre>
<h3 data-id="heading-21">常见问题</h3>
<h4 data-id="heading-22">Q1: 拖拽后数据没有更新？</h4>
<p><strong>A</strong>: 检查是否正确更新了响应式数据。SortableJS 只负责 DOM 操作，不会自动更新 Vue 数据。</p>
<h4 data-id="heading-23">Q2: 切换标签页后拖拽失效？</h4>
<p><strong>A</strong>: 需要在标签页切换时重新初始化 Sortable 实例，因为 DOM 已经重新渲染。</p>
<h4 data-id="heading-24">Q3: 拖拽时整行都可以拖，如何限制？</h4>
<p><strong>A</strong>: 使用 <code>handle</code> 选项指定拖拽手柄元素。</p>
<h4 data-id="heading-25">Q4: 拖拽动画不流畅？</h4>
<p><strong>A</strong>: 调整 <code>animation</code> 参数的值，通常 200-300ms 效果较好。</p>
<h4 data-id="heading-26">Q5: 如何保存排序结果？</h4>
<p><strong>A</strong>: 在 <code>onEnd</code> 回调中，将更新后的数据发送到后端 API。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">onEnd</span>: <span class="hljs-function">(<span class="hljs-params">{ newIndex, oldIndex }</span>) =&gt;</span> {
  <span class="hljs-comment">// 更新本地数据</span>
  <span class="hljs-comment">// ...</span>
  
  <span class="hljs-comment">// 保存到后端</span>
  <span class="hljs-title function_">saveSortOrder</span>(typeData.<span class="hljs-property">value</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({
    <span class="hljs-attr">id</span>: item.<span class="hljs-property">id</span>,
    <span class="hljs-attr">sortOrder</span>: item.<span class="hljs-property">sortOrder</span>
  })));
}
</code></pre>
<h3 data-id="heading-27">完整示例代码</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="type-setting"&gt;
    &lt;!-- 过滤器 --&gt;
    &lt;div class="filter-actions"&gt;
      &lt;el-button
        :type="filterStatus === 'all' ? 'primary' : ''"
        @click="filterStatus = 'all'"
      &gt;
        全部
      &lt;/el-button&gt;
      &lt;el-button
        :type="filterStatus === 'enabled' ? 'primary' : ''"
        @click="filterStatus = 'enabled'"
      &gt;
        启用
      &lt;/el-button&gt;
    &lt;/div&gt;

    &lt;!-- 表格 --&gt;
    &lt;el-table
      ref="typeTableRef"
      :data="filteredTypeData"
      stripe
      row-key="id"
    &gt;
      &lt;el-table-column label="排序" width="131"&gt;
        &lt;template #default&gt;
          &lt;el-icon class="drag-handle"&gt;
            &lt;Operation /&gt;
          &lt;/el-icon&gt;
        &lt;/template&gt;
      &lt;/el-table-column&gt;
      &lt;el-table-column prop="name" label="名称" /&gt;
      &lt;el-table-column prop="enabled" label="启用/禁用"&gt;
        &lt;template #default="{ row }"&gt;
          &lt;el-switch v-model="row.enabled" /&gt;
        &lt;/template&gt;
      &lt;/el-table-column&gt;
      &lt;el-table-column label="操作"&gt;
        &lt;template #default="{ row }"&gt;
          &lt;el-button type="primary" link @click="handleEdit(row)"&gt;
            编辑
          &lt;/el-button&gt;
        &lt;/template&gt;
      &lt;/el-table-column&gt;
    &lt;/el-table&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref, nextTick, watch, onMounted } from "vue";
import { ElTable } from "element-plus";
import Sortable from "sortablejs";
import { Operation } from "@element-plus/icons-vue";

interface TypeItem {
  id: string;
  name: string;
  enabled: boolean;
  sortOrder: number;
}

const typeData = ref&lt;TypeItem[]&gt;([
  { id: "1", name: "楼宇性质1", enabled: true, sortOrder: 1 },
  { id: "2", name: "楼宇性质2", enabled: true, sortOrder: 2 },
  { id: "3", name: "楼宇性质3", enabled: false, sortOrder: 3 },
]);

const filterStatus = ref&lt;"all" | "enabled" | "disabled"&gt;("all");
const typeTableRef = ref&lt;InstanceType&lt;typeof ElTable&gt;&gt;();
let sortableInstance: Sortable | null = null;

const filteredTypeData = computed(() =&gt; {
  if (filterStatus.value === "all") return typeData.value;
  if (filterStatus.value === "enabled") {
    return typeData.value.filter(item =&gt; item.enabled);
  }
  return typeData.value.filter(item =&gt; !item.enabled);
});

const initSortable = () =&gt; {
  if (sortableInstance) {
    sortableInstance.destroy();
    sortableInstance = null;
  }

  nextTick(() =&gt; {
    const tbody = typeTableRef.value?.$el?.querySelector(
      ".el-table__body-wrapper tbody"
    );
    if (!tbody) return;

    sortableInstance = Sortable.create(tbody, {
      handle: ".drag-handle",
      animation: 300,
      onEnd: ({ newIndex, oldIndex }) =&gt; {
        if (
          newIndex !== undefined &amp;&amp;
          oldIndex !== undefined &amp;&amp;
          filterStatus.value === "all"
        ) {
          const movedItem = typeData.value[oldIndex];
          typeData.value.splice(oldIndex, 1);
          typeData.value.splice(newIndex, 0, movedItem);
          typeData.value.forEach((item, index) =&gt; {
            item.sortOrder = index + 1;
          });
        }
      }
    });
  });
};

onMounted(() =&gt; {
  setTimeout(() =&gt; initSortable(), 300);
});

watch(filterStatus, () =&gt; {
  setTimeout(() =&gt; initSortable(), 100);
});
&lt;/script&gt;

&lt;style scoped&gt;
.drag-handle {
  color: #909399;
  cursor: move;
  font-size: 18px;
}

.drag-handle:hover {
  color: #1890ff;
}
&lt;/style&gt;
</code></pre>
<h3 data-id="heading-28">总结</h3>
<p>通过本文的介绍，我们实现了一个完整的表格拖拽排序功能。关键点包括：</p>
<ol>
<li>✅ <strong>正确的实例管理</strong>：避免重复创建和内存泄漏</li>
<li>✅ <strong>合适的初始化时机</strong>：确保 DOM 已完全渲染</li>
<li>✅ <strong>数据同步更新</strong>：手动更新 Vue 响应式数据</li>
<li>✅ <strong>良好的用户体验</strong>：指定拖拽手柄，添加动画效果</li>
<li>✅ <strong>完善的错误处理</strong>：处理边界情况</li>
</ol>
<p>这个方案可以轻松应用到其他需要拖拽排序的场景，如菜单管理、分类排序等。希望本文对您有所帮助！</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[解决访问 https 网站时，后端重定向或获取 URL 变成 http 的问题]]></title>    <link>https://juejin.cn/post/7572138663120371754</link>    <guid>https://juejin.cn/post/7572138663120371754</guid>    <pubDate>2025-11-14T04:09:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572138663120371754" data-draft-id="7572048000302825513" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解决访问 https 网站时，后端重定向或获取 URL 变成 http 的问题"/> <meta itemprop="keywords" content="后端,Java,Nginx"/> <meta itemprop="datePublished" content="2025-11-14T04:09:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mzlogin"/> <meta itemprop="url" content="https://juejin.cn/user/1890815727118414"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解决访问 https 网站时，后端重定向或获取 URL 变成 http 的问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1890815727118414/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mzlogin
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T04:09:32.000Z" title="Fri Nov 14 2025 04:09:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>一种常见的服务部署架构是 Nginx 反向代理后端 Java 应用服务器，Nginx 监听 443 端口处理 https 请求，然后转发给后端服务器。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/113072053cce4c44815057a72ee7a785~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=361&amp;h=293&amp;s=7062&amp;e=png&amp;a=1&amp;b=d4e7d3" alt="图片" loading="lazy"/></p>
<p>对应的 Nginx 配置大致如下：</p>
<pre><code class="hljs language-ini" lang="ini">upstream www {
    server 192.168.1.101:8080  <span class="hljs-attr">weight</span>=<span class="hljs-number">100</span> max_fails=<span class="hljs-number">3</span> fail_timeout=<span class="hljs-number">10</span>s<span class="hljs-comment">;</span>
    server 192.168.1.102:8080  <span class="hljs-attr">weight</span>=<span class="hljs-number">100</span> max_fails=<span class="hljs-number">3</span> fail_timeout=<span class="hljs-number">10</span>s<span class="hljs-comment">;</span>
}
server {
    listen 443 ssl<span class="hljs-comment">;</span>
    server_name example.com<span class="hljs-comment">;</span>
    ssl_certificate /path/to/cert.pem<span class="hljs-comment">;</span>
    ssl_certificate_key /path/to/key.pem<span class="hljs-comment">;</span>
    location / {
        proxy_pass http://www<span class="hljs-comment">;</span>
    }
}
</code></pre>
<p>即：客户端与 Nginx 之间是 https，Nginx 与后端 Java 应用服务器之间是 http。</p>
<p>这样可能会遇到一些问题，如：</p>
<ol>
<li>
<p><code>HttpServletRequest.getRequestURL()</code></p>
<p>获取到的 URL 是 Nginx 与后端服务器之间的 http URL，比如 <code>http://192.168.1.101:8080/xxx</code>；</p>
</li>
<li>
<p><code>HttpServletResponse.sendRedirect()</code></p>
<p>生成的重定向 URL 也是 http URL。</p>
</li>
</ol>
<p>要解决这些问题，可以通过 Nginx 配置 + 少量后端代码修改来实现。</p>
<h2 data-id="heading-0">解决应用中获取到的 URL 的问题</h2>
<p>用户实际访问的是 <code>https://example.com/xxx</code>，但是后端应用获取到的 URL 是 <code>http://192.168.1.101:8080/xxx</code>，如何让后端应用获取到正确的 URL 呢？</p>
<p>第一步，Nginx 可以通过 <code>proxy_set_header Host</code> 指令将客户端请求的 Host 头传递给后端服务器：</p>
<pre><code class="hljs language-bash" lang="bash">location / {
    <span class="hljs-comment"># ...</span>
    proxy_set_header Host <span class="hljs-variable">$host</span>;
}
</code></pre>
<p>这样，后端应用通过 <code>HttpServletRequest.getRequestURL()</code> 获取到的 URL 就是 <code>http://example.com/xxx</code> 了。</p>
<p>但此时，协议仍然不对，还是 http。</p>
<p>要给后端应用传递正确的协议，通常的做法是使用 <code>X-Forwarded-Proto</code> 头：</p>
<pre><code class="hljs language-bash" lang="bash">location / {
    <span class="hljs-comment"># ...</span>
    proxy_set_header X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;
}
</code></pre>
<p>添加这个头之后并不会让 <code>HttpServletRequest.getRequestURL()</code> 直接返回 https URL，需要在后端应用中做一些处理。以 Java 应用为例，可以通过一个过滤器（Filter）来修改 request 的 scheme：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.servlet.*;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequestWrapper;
<span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">XForwardedProtoFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span>
            <span class="hljs-keyword">throws</span> IOException, ServletException {
        <span class="hljs-keyword">if</span> (request <span class="hljs-keyword">instanceof</span> HttpServletRequest) {
            <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">httpRequest</span> <span class="hljs-operator">=</span> (HttpServletRequest) request;
            <span class="hljs-type">String</span> <span class="hljs-variable">xForwardedProto</span> <span class="hljs-operator">=</span> httpRequest.getHeader(<span class="hljs-string">"X-Forwarded-Proto"</span>);
            <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(xForwardedProto) &amp;&amp; !xForwardedProto.equalsIgnoreCase(httpRequest.getScheme()) &amp;&amp; xForwardedProto.equalsIgnoreCase(<span class="hljs-string">"https"</span>)) {
                httpRequest = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpServletRequestWrapper</span>(httpRequest) {
                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getScheme</span><span class="hljs-params">()</span> {
                        <span class="hljs-keyword">return</span> xForwardedProto;
                    }
                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-keyword">public</span> StringBuffer <span class="hljs-title function_">getRequestURL</span><span class="hljs-params">()</span> {
                        <span class="hljs-type">StringBuffer</span> <span class="hljs-variable">requestURL</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.getRequestURL();
                        <span class="hljs-keyword">if</span> (requestURL != <span class="hljs-literal">null</span> &amp;&amp; requestURL.length() &gt; <span class="hljs-number">0</span>) {
                            <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> requestURL.indexOf(<span class="hljs-string">"://"</span>);
                            <span class="hljs-keyword">if</span> (index &gt; <span class="hljs-number">0</span>) {
                                requestURL.replace(<span class="hljs-number">0</span>, index, xForwardedProto);
                            }
                        }
                        <span class="hljs-keyword">return</span> requestURL;
                    }

                };
            }
            chain.doFilter(httpRequest, response);
        } <span class="hljs-keyword">else</span> {
            chain.doFilter(request, response);
        }
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException {
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> {
    }
}
</code></pre>
<p>至此，后端应用通过 <code>HttpServletRequest.getRequestURL()</code> 获取到的 URL 就是 <code>https://example.com/xxx</code> 了。</p>
<h2 data-id="heading-1">解决重定向 URL 的问题</h2>
<p>后端应用通过 <code>HttpServletResponse.sendRedirect()</code> 生成的重定向 URL 也是 http URL，如何让它变成 https 呢？</p>
<p>这个问题可以通过 Nginx 的另一指令 <code>proxy_redirect</code> 来解决，该指令用于修改从后端服务器返回的 <code>Location</code> 和 <code>Refresh</code> 响应头。</p>
<pre><code class="hljs language-perl" lang="perl">location / {
    <span class="hljs-comment"># ...</span>
    proxy_redirect http:<span class="hljs-regexp">//</span> $scheme:<span class="hljs-regexp">//</span>;
}
</code></pre>
<p>这样，当后端应用返回一个重定向响应时，Nginx 会将 <code>Location</code> 头中的 <code>http://</code> 替换为 <code>$scheme://</code>，即 <code>https://</code>。</p>
<h2 data-id="heading-2">进一步思考：当 Nginx 前面还有负载均衡器时</h2>
<p>在很多情况下，Nginx 前面可能还有商用负载均衡器（如 AWS ELB、阿里云 SLB 等），这时需要考虑负载均衡器与 Nginx 之间的协议问题。</p>
<p>如果负载均衡器与 Nginx 之间是 http，而 Nginx 与后端应用之间是 http，那么就需要在负载均衡器和 Nginx 之间添加 <code>X-Forwarded-Proto</code> 头，以便 Nginx 能够正确地识别原始请求的协议。</p>
<p>主流的负载均衡器配置项里应该都有添加 <code>X-Forwarded-Proto</code> 头的选项开关，比如阿里云：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/378eb621996f4a7ea3f16535fc290261~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=974&amp;h=438&amp;s=89095&amp;e=png&amp;b=fefefe" alt="图片" loading="lazy"/></p>
<p>需要注意的是这样配置后，Nginx 配置也需要做相应的调整，将 <code>$scheme</code> 替换为 <code>$http_x_forwarded_proto</code>：<br/>
（此种场景 <code>$scheme</code> 为负载均衡器与 Nginx 之间的协议 http，<code>$http_x_forwarded_proto</code> 为负载均衡器通过 Header 透传过来的前端访问协议 https。）</p>
<pre><code class="hljs language-perl" lang="perl">location / {
    <span class="hljs-comment"># ...</span>
    proxy_set_header X-Forwarded-Proto $http_x_forwarded_proto;
    proxy_redirect http:<span class="hljs-regexp">//</span> $http_x_forwarded_proto:<span class="hljs-regexp">//</span>;
}
</code></pre>
<h2 data-id="heading-3">参考链接</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnginx.org%2Fen%2Fdocs%2Fhttp%2Fngx_http_proxy_module.html%23proxy_set_header" target="_blank" title="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_set_header" ref="nofollow noopener noreferrer">Nginx 官方文档 - proxy_set_header</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnginx.org%2Fen%2Fdocs%2Fhttp%2Fngx_http_proxy_module.html%23proxy_redirect" target="_blank" title="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_redirect" ref="nofollow noopener noreferrer">Nginx 官方文档 - proxy_redirect</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnginx.org%2Fen%2Fdocs%2Fhttp%2Fngx_http_core_module.html%23variables" target="_blank" title="https://nginx.org/en/docs/http/ngx_http_core_module.html#variables" ref="nofollow noopener noreferrer">Nginx 官方文档 - Embedded Variables</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[不小心更新了trae，发现...]]></title>    <link>https://juejin.cn/post/7572092283719925812</link>    <guid>https://juejin.cn/post/7572092283719925812</guid>    <pubDate>2025-11-14T04:13:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572092283719925812" data-draft-id="7572092283719614516" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="不小心更新了trae，发现..."/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2025-11-14T04:13:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="龙在天"/> <meta itemprop="url" content="https://juejin.cn/user/3760787883819464"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            不小心更新了trae，发现...
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3760787883819464/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    龙在天
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T04:13:03.000Z" title="Fri Nov 14 2025 04:13:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">发现</h2>
<p>国际版的 <strong>Trade Solo</strong> 最近推了个大更新，真的挺重磅的。
除了原本就有的 <strong>Solo Builder</strong>，现在又新增了一个 <strong>Solo Coder</strong>，功能更狠。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fe8776b94104c7e8b0366d90ff84933~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763698383&amp;x-signature=aibkNMAbkZGYvOdMJ606Kd%2BYVnA%3D" alt="image.png" loading="lazy"/></p>
<p>先说 Solo Coder。
它里面有个 <strong>Plan 模式</strong>，点进去之后可以用来排查各种问题。它会先自动给你生成一份任务文档，你确认没问题之后，它就能按照这个计划一步步去执行，特别省心。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4756802e64df4e75b3a04cf3b70e8a8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763698383&amp;x-signature=IwImPc3Y%2F7LomGZdLkzZlHz6cLY%3D" alt="image.png" loading="lazy"/></p>
<p>再来就是 <strong>编辑工具</strong> 这块。
你可以往里面加 <strong>MCP 工具</strong>，这一点非常强。
比如：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3316c6648a2a48028e59490ede33f5ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763698383&amp;x-signature=sd9g0Yv0MOvc71VEWLcaFKFwGa0%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>给它接一个前端相关的 MCP，它就能当前端程序员用；</li>
<li>给它接一个 MySQL，它立马能充当后端；</li>
<li>给它输入业务资料，它还能做需求分析。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b5d2baae8d9483ca448ae031557a5b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763698383&amp;x-signature=HtkJ59Dk3b60LmeDcrrN7m8w7iQ%3D" alt="image.png" loading="lazy"/></p>
<p>相当于你给它什么，它就能变成什么，全靠你给的 MCP 工具组合。</p>
<p>而且 <strong>Solo Coder 支持并发执行任务</strong>。
像我这边已经同时开了五个任务一起跑了，它还可以继续加新的任务进去一起执行。官方建议最多开十个并发任务，这样效果最好。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f240f9e41d8c46b1b59357e618c2bd42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763698383&amp;x-signature=IFWKydB12qz1yhBXBMx4lHXDl%2Fs%3D" alt="image.png" loading="lazy"/></p>
<p>最关键的是：
<strong>现在限时免费</strong>！
到 11 月 15 号凌晨之前都可以白嫖试用一下。</p>
<p>总之，这次更新是真有点猛，喜欢折腾工具的可以赶紧去玩玩。</p>
<h2 data-id="heading-1">实战 - 浏览器插件</h2>
<p><strong>🚀 零基础也能做浏览器插件！用 Trae 10 分钟开发一个“网页黑白切换”扩展</strong></p>
<p>浏览器插件（Extension）听起来像是专业开发者才能碰的东西？
今天我用 Trae（AI 开发工具）带你<strong>从零到一</strong>做一个完全可用的 Chrome / Edge / 国产浏览器通用插件。</p>
<p><strong>你不需要任何编程基础。
你只需要会复制粘贴。</strong></p>
<p>最终效果👇
点击浏览器右上角插件按钮 → 当前网页变黑白
再点一下 → 恢复彩色
再点 → 再变黑白……无限切换。</p>
<p>真的很酷，也很适合作为你的第一个 AI 编程作品。</p>
<h3 data-id="heading-2">提示词</h3>
<pre><code class="hljs language-html" lang="html">我是一个零基础用户，请帮我创建一个浏览器插件（Chrome / Edge / 360 / 夸克 都可以用）。  
插件功能：

-   点击浏览器工具栏按钮后把当前网页变成黑白模式（grayscale）。
-   再次点击按钮要恢复彩色。
-   支持反复切换。
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d69a7e7790348ba80fcbb33fb59150f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763698383&amp;x-signature=b7M99M234knWyCyGO%2FWbfGpahtk%3D" alt="image.png" loading="lazy"/></p>
<p>我们使用<code>Builder智能体+SOLO Coder Plan 模式</code>，在输入框里输入我们这段要求，直接回车，等待它帮我们写代码。<br/>
注意，我们这要实现这个功能，是要做一个浏览器插件的，所以提示词里一定要告诉它：我们要做一个浏览器插件。<br/>
这个浏览器插件做好之后，大部分的浏览器都可以通用的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a63433049df34303b134caecdb12d424~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763698383&amp;x-signature=TmTaoc43sqpaXHZnn5TGOklrHtg%3D" alt="image.png" loading="lazy"/></p>
<p>好了，看到这个位置显示“任务完成”，那么就说明它全部已经编完了。</p>
<h3 data-id="heading-3">实时跟随</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3cf1543ecb2a47e781b832867d837bc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763698383&amp;x-signature=wJKvviBcdXxT%2Fh6iWwkj%2F34K3Eg%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5cba4b790ab48958759290da10bf80b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763698383&amp;x-signature=RHexzwVErL5eh9CXq9Fjze%2FetzU%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fcc1c77ec47b4a58a1abd1af087b704b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763698383&amp;x-signature=SU7US6DggTgYBh%2BC3EqwAt767IY%3D" alt="image.png" loading="lazy"/></p>
<p><strong>// manifest.json</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"manifest_version"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"一键黑白"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"点击扩展按钮，让当前网页变成黑白（灰度）效果。"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"default_title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"一键黑白"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"background"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"service_worker"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"background.js"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"permissions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"scripting"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"activeTab"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>接下来来到浏览器里，点右上角，找到你的扩展管理（我这用的是Chrome浏览器）。<br/>
打开之后，在左侧要开启“开发人员模式”，然后把我们刚才创建的文件夹，整个的都给它拖到我们浏览器里面，这样的话就安装成功了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b394118714d4f1d858537ec4e29442b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763698383&amp;x-signature=6P0NeK%2BTVQOKrB7XMkREAmKXot4%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f1eea9b0f5b4e3ca5fad66581ad1dc9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763698383&amp;x-signature=%2FaDGlji8HL0Mj1VYtRffQeiLkPg%3D" alt="image.png" loading="lazy"/>
点击右上角这个插件的图标，可以看到我们所有的插件。<br/>
在最后可以看到我们的插件——这个“黑白化网页”的插件。<br/>
好，点击这个固定按钮，把它固定在插件的菜单里。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fa4c7150f464e84a34c52207f17062a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763698383&amp;x-signature=%2BZs5gD5XihmLoanXy8kkjGGJy34%3D" alt="image.png" loading="lazy"/></p>
<p>然后我们打开百度去试一下：点击按钮，就能够立刻把它变成黑白色。<br/>
然后再打开淘宝试一下，也没有问题，整个网页都变成了黑白色。<br/>
但是这时候我们再想把它换回来，就没法换了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa3a509b16544d70ba6756b3b9f3bbe0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763698383&amp;x-signature=CC2q6STxWc5%2BDomhUfB6y%2BWr43g%3D" alt="image.png" loading="lazy"/></p>
<p>所以我们再加一个功能，把这段要求发给它，等待它帮我们继续优化迭代。</p>
<p>我们再来到插件管理里面，重新加载一下插件，然后重新打开淘宝看一下效果。<br/>
这样我们重复的点击这个小按钮，就能够让这个网页在黑白色和彩色之间来回切换。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aec5ae7fc5ff481ba6591e6d3d8faeb5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763698383&amp;x-signature=avFy4RRWp6ATxffE6Hh8Zovd95o%3D" alt="image.png" loading="lazy"/></p>
<p>好了，那么这个功能咱们就做完了。<br/>
如果你还有更好玩的AI编程想法的话，可以在评论区里留言，我看到合适的会把它实现，然后分享出来。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【转载】 OpenAI 推出 GPT-5.1：面向开发者的智能模型]]></title>    <link>https://juejin.cn/post/7572086215028932650</link>    <guid>https://juejin.cn/post/7572086215028932650</guid>    <pubDate>2025-11-14T03:13:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572086215028932650" data-draft-id="7572087162231390250" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【转载】 OpenAI 推出 GPT-5.1：面向开发者的智能模型"/> <meta itemprop="keywords" content="ChatGPT,GPT"/> <meta itemprop="datePublished" content="2025-11-14T03:13:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="是魔丸啊"/> <meta itemprop="url" content="https://juejin.cn/user/3217622495411292"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【转载】 OpenAI 推出 GPT-5.1：面向开发者的智能模型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3217622495411292/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    是魔丸啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T03:13:17.000Z" title="Fri Nov 14 2025 03:13:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fopenai.com%2Findex%2Fgpt-5-1-for-developers%2F" target="_blank" title="https://openai.com/index/gpt-5-1-for-developers/" ref="nofollow noopener noreferrer">原文链接</a></p>
<p><strong>发布日期：</strong> 2025年11月13日</p>
<blockquote>
<p>gpt应该是第一个把fast apply工程能力内置到工具的吧</p>
</blockquote>
<hr/>
<p>今天我们在 API 平台发布了 GPT‑5.1，这是 GPT‑5 系列中平衡智能和速度的下一代模型，适用于广泛的代理和编程任务。GPT‑5.1 根据任务复杂性动态调整思考时间，使模型在更简单的日常任务中显著更快且更节省 token。该模型还具备"无推理"模式，可在不需要深度思考的任务中更快响应，同时保持 GPT‑5.1 的前沿智能。</p>
<p>为了使 GPT‑5.1 更加高效，我们发布了扩展的提示缓存，最长可保留 24 小时缓存，以更低成本为后续问题提供更快响应。我们的优先处理客户也将在 GPT‑5.1 上体验到比 GPT‑5 明显更快的性能。</p>
<p>在编程方面，我们与 Cursor、Cognition、Augment Code、Factory 和 Warp 等初创公司密切合作，以改善 GPT‑5.1 的编程特性、可控性和代码质量。总体而言，GPT‑5.1 在编程方面感觉更直观易用，并且在完成任务时提供更多面向用户的更新。</p>
<p>最后，我们为 GPT‑5.1 引入了两个新工具：一个用于更可靠编辑代码的 apply_patch 工具，以及一个让模型运行 shell 命令的 shell 工具。</p>
<p>GPT‑5.1 是 GPT‑5 系列的下一个进步，我们计划继续投资更智能、更强大的模型，以帮助开发者构建可靠的代理工作流程。</p>
<hr/>
<h2 data-id="heading-0">跨任务的高效推理</h2>
<h3 data-id="heading-1">自适应推理</h3>
<p>为了使 GPT‑5.1 更快，我们彻底改革了训练其思考的方式。在直接明了的任务中，GPT‑5.1 使用更少的 token 进行思考，实现更快捷的产品体验和更低的 token 费用。在需要额外思考的困难任务中，GPT‑5.1 保持坚持，探索选项并检查其工作，以最大化可靠性。</p>
<p>Balyasny Asset Management 表示，GPT‑5.1"在我们完整的动态评估套件中超越了 GPT‑4.1 和 GPT‑5，同时运行速度比 GPT‑5 快 2-3 倍"。他们还说，在他们工具繁重的推理任务中，GPT‑5.1"始终使用大约领先竞争对手一半的 token，同时达到相似或更好的质量"。同样，AI 保险 BPO Pace 也测试了该模型并表示他们的代理在 GPT‑5.1 上运行"速度快 50%，同时在我们的评估中超越了 GPT‑5 和其他领先模型的准确性"。</p>
<p>与 GPT‑5 相比，GPT‑5.1 更动态地调整其思考时间。在 ChatGPT 任务的代表性分布中，GPT‑5.1 在更容易的任务上快得多，即使在高的推理努力下也是如此。</p>
<p>例如，当被要求"显示列出全局安装包的 npm 命令"时，GPT‑5.1 在 2 秒内回答，而不是 10 秒。</p>
<p><strong>GPT-5 (Medium) 耗时 ~250 tokens (~10 秒)</strong></p>
<pre><code class="hljs language-css" lang="css">show an npm command <span class="hljs-selector-tag">to</span> list globally installed packages
npm list -g <span class="hljs-attr">--depth</span>=<span class="hljs-number">0</span>
</code></pre>
<p><strong>GPT-5.1 (Medium) 耗时 ~50 tokens (~2 秒)</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">show</span> an npm command <span class="hljs-keyword">to</span> list globally installed packages
You can list globally installed npm packages <span class="hljs-keyword">with</span>:
<span class="hljs-operator">-</span> Just package names: npm ls <span class="hljs-operator">-</span>g <span class="hljs-comment">--depth=0</span>
<span class="hljs-operator">-</span> Including their install paths: npm ls <span class="hljs-operator">-</span>g
The <span class="hljs-keyword">first</span> <span class="hljs-keyword">one</span> <span class="hljs-keyword">is</span> usually what you want.
</code></pre>
<h3 data-id="heading-2">新的"无推理"模式</h3>
<p>开发者现在可以通过将 reasoning_effort 设置为 'none' 来使用不带推理的 GPT‑5.1。这使得模型在延迟敏感的用例中表现为非推理模型，具有 GPT‑5.1 的高智能和高性能工具调用的额外优势。相对于具有'minimal'推理的 GPT‑5，具有无推理的 GPT‑5.1 在并行工具调用（本身提高了端到端任务完成速度）、编程任务、遵循指令和使用搜索工具方面表现更好——并在我们的 API 平台支持网络搜索。Sierra 分享说，GPT‑5.1 在"无推理"模式下的真实评估显示"与 GPT‑5 最小推理相比，低延迟工具调用性能提高了 20%"。</p>
<p>随着在 reasoning_effort 中引入 'none' 作为值，开发者现在对速度、成本和智能之间的平衡有了更大的灵活性和控制权。GPT‑5.1 默认为 'none'，这对于延迟敏感的工作负载是理想的。我们建议开发者为更复杂的任务选择 'low' 或 'medium'，在智能和可靠性比速度更重要时选择 'high'。</p>
<h3 data-id="heading-3">扩展的提示缓存</h3>
<p>扩展缓存通过允许提示在缓存中保持活跃长达 24 小时（而不是目前支持的几分钟）来提高推理效率。通过更长的保留窗口，更多的后续请求可以利用缓存上下文——从而降低延迟、减少成本，并为多轮对话、编程会话或知识检索工作流程等长时间运行的交互提供更流畅的性能。</p>
<p>提示缓存定价保持不变，缓存的输入 token 比未缓存的 token 便宜 90%，并且缓存写入或存储不收取额外费用。要在 GPT‑5.1 中使用扩展缓存，请在 Responses 或 Chat Completions API 上添加参数"prompt_cache_retention='24h'"。有关更多详细信息，请参阅提示缓存文档。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"prompt_cache_retention='24h'"</span>
</code></pre>
<hr/>
<h2 data-id="heading-4">编程</h2>
<p>GPT‑5.1 在 GPT‑5 的编程能力基础上，具有更可控的编程特性、更少的过度思考、改进的代码质量、在工具调用序列期间更好的面向用户的更新消息（前言），以及更实用的前端设计——特别是在低推理努力下。</p>
<p>在简单的编程任务（如快速代码编辑）中，GPT‑5.1 的更快速度使来回迭代更容易。GPT‑5.1 在简单任务上的更快速度不会降低在困难任务上的性能。在 SWE-bench Verified 上，GPT‑5.1 的工作时间甚至比 GPT‑5 更长，达到 76.3%。</p>
<p>在 SWE-bench Verified 中，模型被给予一个代码仓库和问题描述，必须生成一个补丁来解决问题。标签表示推理努力。准确性在所有 500 个问题上平均。所有模型都使用了带有基于 JSON 的 apply_patch 工具的集成。</p>
<p>我们从一些编程公司那里获得了关于 GPT‑5.1 的早期反馈。以下是他们的印象：</p>
<ul>
<li><strong>Augment Code</strong> 称 GPT‑5.1"更加慎重，浪费的行动更少，推理更高效，任务专注度更好"，他们看到"更准确的变更、更平滑的 pull requests 以及跨多文件项目的更快迭代"。</li>
<li><strong>Cline</strong> 分享说，在他们的评估中，"GPT‑5.1 在我们的差异编辑基准上达到了 SOTA，提高了 7%，展示了在复杂编程任务中卓越的可靠性"。</li>
<li><strong>CodeRabbit</strong> 称 GPT‑5.1 是他们"PR 审阅的首选顶级模型"。</li>
<li><strong>Cognition</strong> 表示 GPT‑5.1"明显更善于理解你的要求并与你合作完成任务"。</li>
<li><strong>Factory</strong> 表示"GPT‑5.1 提供明显更快的响应，并根据任务调整其推理深度，减少过度思考并改善整体开发者体验"。</li>
<li><strong>Warp</strong> 正在将 GPT‑5.1 设为新用户的默认选择，表示它"建立在 GPT‑5 系列引入的令人印象深刻的智能增益基础上，同时是一个响应更快的模型"。</li>
</ul>
<blockquote>
<p>"GPT 5.1 不仅仅是另一个 LLM——它是真正具有代理性的，我测试过的最自然的自主模型。它像你一样写作，像你一样编程，毫不费力地遵循复杂指令，并在前端任务中表现出色，完美融入你现有的代码库。你可以在 Responses API 中真正释放它的全部潜力，我们很高兴在我们的 IDE 中提供它。"</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">GPT‑5.1 中的新工具</h2>
<p>我们为 GPT‑5.1 引入了两个新工具，以帮助开发者在 Responses API 中充分利用模型：一个自由的 apply_patch 工具，使代码编辑更可靠而无需 JSON 转义，以及一个 shell 工具，让模型编写命令在本地机器上运行。</p>
<h3 data-id="heading-6">Apply_patch 工具</h3>
<p>自由格式的 apply_patch 工具让 GPT‑5.1 使用结构化差异在代码库中创建、更新和删除文件。模型不是仅仅建议编辑，而是发出补丁操作，由应用程序应用并报告回，实现迭代、多步骤的代码编辑工作流程。</p>
<p>要在 Responses API 中使用 apply_patch 工具，请在 tools 数组中包含它，使用<code>"tools": [{"type": "apply_patch"}]</code>，并在输入中包含文件内容或给模型与文件系统交互的工具。模型将为创建、更新或删除文件生成 apply_patch_call 项目，其中包含你在文件系统上应用的差异。有关如何与 apply_patch 工具集成的更多信息，请查看我们的开发者文档。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"tools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"apply_patch"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
</code></pre>
<h3 data-id="heading-7">Shell 工具</h3>
<p>shell 工具允许模型通过受控的命令行界面与本地计算机交互。模型提出 shell 命令；开发者的集成执行它们并返回输出。这创建了一个简单的计划-执行循环，让模型可以检查系统、运行实用程序并收集数据，直到它们可以完成任务。</p>
<p>要在 Responses API 中使用 shell 工具，开发者可以在 tools 数组中包含它，使用<code>"tools": [{"type": "shell"}]</code>。API 将生成包含要执行的 shell 命令的"shell_call"项目。开发者在本地环境中执行命令，并在下一个 API 请求的"shell_call_output"项目中传回执行结果。在我们的开发者文档中了解更多信息。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"tools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"shell"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
</code></pre>
<hr/>
<h2 data-id="heading-8">定价和可用性</h2>
<p>GPT‑5.1 和 gpt-5.1-chat-latest 对 API 中所有付费层级的开发者可用。定价和速率限制与 GPT‑5 相同。我们还在 API 中发布了 gpt-5.1-codex 和 gpt-5.1-codex-mini。虽然 GPT‑5.1 在大多数编程任务上表现出色，但 gpt-5.1-codex 模型针对在 Codex 或类似 Codex 集成中的长时间运行、代理编程任务进行了优化。</p>
<p>开发者可以开始使用我们的 GPT‑5.1 开发者文档和模型提示指南进行构建。我们目前不打算在 API 中弃用 GPT‑5，如果我们决定这样做，将提前通知开发者。</p>
<hr/>
<h2 data-id="heading-9">下一步</h2>
<p>我们致力于迭代部署最强大、最可靠的模型用于真实的代理和编程工作——能够高效思考、快速迭代并处理复杂任务，同时让开发者保持流畅状态的模型。凭借自适应推理、更强的编程性能、更清晰的面向用户更新，以及像 apply_patch 和 shell 这样的新工具，GPT‑5.1 旨在帮助您以更少的摩擦进行构建。我们仍在继续大量投资于此：您可以期待在接下来的几周和几个月内出现更强大的代理和编程模型。</p>
<hr/>
<h2 data-id="heading-10">附录：模型评估</h2>























































<table><thead><tr><th>评估</th><th>GPT‑5.1 (high)</th><th>GPT‑5 (high)</th></tr></thead><tbody><tr><td>SWE-bench Verified (全部 500 个问题)</td><td>76.3%</td><td>72.8%</td></tr><tr><td>GPQA Diamond (无工具)</td><td>88.1%</td><td>85.7%</td></tr><tr><td>AIME 2025 (无工具)</td><td>94.0%</td><td>94.6%</td></tr><tr><td>FrontierMath (使用 Python 工具)</td><td>26.7%</td><td>26.3%</td></tr><tr><td>MMMU</td><td>85.4%</td><td>84.2%</td></tr><tr><td>Tau2-bench Airline</td><td>67.0%</td><td>62.6%</td></tr><tr><td>Tau2-bench Telecom*</td><td>95.6%</td><td>96.7%</td></tr><tr><td>Tau2-bench Retail</td><td>77.9%</td><td>81.1%</td></tr><tr><td>BrowseComp Long Context 128k</td><td>90.0%</td><td>90.0%</td></tr></tbody></table>
<ul>
<li>对于 Tau2-bench Telecom，我们给 GPT‑5.1 一个简短的、通用有用的提示来提高其性能。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>